<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüåæ üëãüèº üë®üèø‚Äçü§ù‚Äçüë®üèº Toute la v√©rit√© sur RTOS. Article # 31. Diagnostics et v√©rification des erreurs RTOS üëù üéΩ üôÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La gestion des erreurs n'est pas la chose la plus courante pour les syst√®mes d'exploitation con√ßus pour les applications de syst√®mes embarqu√©s. Il s'a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Toute la v√©rit√© sur RTOS. Article # 31. Diagnostics et v√©rification des erreurs RTOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463403/"><img src="https://habrastorage.org/webt/ot/7b/f6/ot7bf602l2thhfxphukcduobth8.jpeg"><br><br>  La gestion des erreurs n'est pas la chose la plus courante pour les syst√®mes d'exploitation con√ßus pour les applications de syst√®mes embarqu√©s.  Il s'agit d'un r√©sultat in√©vitable de ressources limit√©es, car tous les syst√®mes embarqu√©s ont certaines restrictions.  Et seul un petit nombre de ces syst√®mes ont la capacit√© de se comporter comme des syst√®mes de bureau, c'est-√†-dire d'offrir √† l'utilisateur la possibilit√© de choisir des actions en cas d'√©v√©nements exceptionnels. <br><br>  Dans Nucleus SE, en g√©n√©ral, il existe trois types de v√©rification des erreurs: <br><ul><li>  des moyens pour v√©rifier la sant√© de la configuration s√©lectionn√©e pour s'assurer que les param√®tres s√©lectionn√©s ne conduisent pas √† des erreurs; </li><li>  √©ventuellement inclus du code pour v√©rifier le comportement d'ex√©cution; </li><li>  Certaines fonctions API qui contribuent au d√©veloppement de code plus robuste. </li>
</ul><br>  Tout cela sera discut√© dans cet article, ainsi que quelques id√©es concernant les diagnostics par l'utilisateur. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Articles pr√©c√©dents de la s√©rie:</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 30.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Proc√©dures d'initialisation et de d√©marrage de Nucleus SE</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 29.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Interruptions dans Nucleus SE</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 28.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Minuteries logicielles</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 27.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Heure syst√®me</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 26.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Canaux: services auxiliaires et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 25.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Canaux de donn√©es: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 24.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Files d'attente: services auxiliaires et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 23.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Files d'attente: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 22.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bo√Ætes aux lettres: services auxiliaires et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 21.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bo√Ætes aux lettres: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 20.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">S√©maphores: services auxiliaires et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 19.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">S√©maphores: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 18.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Groupes d'indicateurs d'√©v√©nements: services d'assistance et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Groupes de drapeaux d'√©v√©nements: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Signaux</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partitions de m√©moire: services et structures de donn√©es</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sections de m√©moire: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Structures de donn√©es de t√¢che et appels d'API non pris en charge</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Services pour travailler avec des t√¢ches</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T√¢ches: configuration et introduction √† l'API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Scheduler: fonctionnalit√©s avanc√©es et pr√©servation du contexte</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Scheduler: impl√©mentation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nucleus SE: conception interne et d√©ploiement</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nucleus SE: Introduction</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Autres services RTOS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Interaction et synchronisation des t√¢ches</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T√¢ches, changement de contexte et interruptions</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T√¢ches et planification</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RTOS: Structure et mode temps r√©el</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RTOS: introduction.</a> <br></div></div><br><br><h2>  V√©rifier les param√®tres </h2><br>  Nucleus SE a √©t√© con√ßu en mettant l'accent sur une configurabilit√© utilisateur √©lev√©e, ce qui devrait garantir la meilleure utilisation des ressources disponibles.  Une telle configurabilit√© est une t√¢che complexe, car le nombre de param√®tres possibles et les interd√©pendances entre eux sont √©normes.  Comme indiqu√© dans de nombreux articles pr√©c√©dents, la plupart des √©tapes utilisateur pour configurer Nucleus SE sont effectu√©es √† l'aide des directives <b>#define</b> dans le fichier <b>nuse_config.h</b> . <br><br>  Pour aider √† identifier les erreurs de configuration, <b>nuse_config_check.h est</b> inclus dans le fichier <b>nuse_config.c</b> via <b>#include</b> , qui effectue des v√©rifications d'int√©grit√© sur les directives <b>#define</b> .  Voici un extrait de ce fichier: <br><pre><code class="plaintext hljs">/*** Tasks and task control ***/ #if NUSE_TASK_NUMBER &lt; 1 || NUSE_TASK_NUMBER &gt; 16 #error NUSE: invalid number of tasks - must be 1-16 #endif #if NUSE_TASK_RELINQUISH &amp;&amp; (NUSE_SCHEDULER_TYPE == NUSE_PRIORITY_SCHEDULER) #error NUSE: NUSE_Task_Relinquish() selected - not valid with priority scheduler #endif #if NUSE_TASK_RESUME &amp;&amp; !NUSE_SUSPEND_ENABLE #error NUSE: NUSE_Task_Resume() selected - task suspend not enabled #endif #if NUSE_TASK_SUSPEND &amp;&amp; !NUSE_SUSPEND_ENABLE #error NUSE: NUSE_Task_Suspend() selected - task suspend not enabled #endif #if NUSE_INITIAL_TASK_STATE_SUPPORT &amp;&amp; !NUSE_SUSPEND_ENABLE #error NUSE: Initial task state enabled - task suspend not enabled #endif /*** Partition pools ***/ #if NUSE_PARTITION_POOL_NUMBER &gt; 16 #error NUSE: invalid number of partition pools - must be 0-16 #endif #if NUSE_PARTITION_POOL_NUMBER == 0 #if NUSE_PARTITION_ALLOCATE #error NUSE: NUSE_Partition_Allocate() enabled ‚Äì no partition pools configured #endif #if NUSE_PARTITION_DEALLOCATE #error NUSE: NUSE_Partition_Deallocate() enabled ‚Äì no partition pools configured #endif #if NUSE_PARTITION_POOL_INFORMATION #error NUSE: NUSE_Partition_Pool_Information() enabled ‚Äì no partition pools configured #endif #endif</code> </pre> <br>  Le code ci-dessus effectue les v√©rifications suivantes: <br><ul><li>  v√©rifier qu'au moins une, mais pas plus de seize t√¢ches sont configur√©es; </li><li>  Confirmation que les fonctions API s√©lectionn√©es sont compatibles avec le planificateur s√©lectionn√© et d'autres param√®tres sp√©cifi√©s; </li><li>  v√©rification que pas plus de seize instances d'autres objets du noyau ont √©t√© cr√©√©es; </li><li>  Confirmation que les fonctions API li√©es aux objets non d√©clar√©s n'ont pas √©t√© s√©lectionn√©es. </li><li>  s'assurer que les fonctions API pour les signaux et l'heure syst√®me ne sont pas utilis√©es lorsque la prise en charge de ces services est d√©sactiv√©e; </li><li>  v√©rification du type d'ordonnanceur s√©lectionn√© et des param√®tres associ√©s. </li></ul><br>  Dans tous les cas, la d√©tection d'erreurs conduit √† l'ex√©cution de la directive <b>#error</b> lors de la compilation.  Cela provoque g√©n√©ralement l'arr√™t de la compilation et l'affichage du message correspondant. <br><br>  Ce fichier ne garantit pas l'impossibilit√© de cr√©er une configuration / configuration incorrecte, mais le rend tr√®s peu probable. <br><br><h2>  V√©rification des param√®tres de l'API </h2><br>  Comme Nucleus RTOS, Nucleus SE a la possibilit√© d'inclure du code pour v√©rifier les param√®tres d'appel des fonctions API au moment de l'ex√©cution.  Habituellement, cela n'est utilis√© que lors du d√©bogage et des tests initiaux, car dans le code de programme final, une consommation excessive de m√©moire n'est pas souhaitable. <br><br>  La v√©rification des param√®tres est activ√©e en d√©finissant le param√®tre <b>NUSE_API_PARAMETER_CHECKING</b> dans le fichier <b>nuse_config.h</b> sur <b>TRUE</b> .  Cela conduit √† la compilation du code suppl√©mentaire requis.  Voici un exemple de v√©rification des param√®tres d'une fonction API: <br><pre> <code class="plaintext hljs">STATUS NUSE_Mailbox_Send(NUSE_MAILBOX mailbox, ADDR *message, U8 suspend) { STATUS return_value; #if NUSE_API_PARAMETER_CHECKING if (mailbox &gt;= NUSE_MAILBOX_NUMBER) { return NUSE_INVALID_MAILBOX; } if (message == NULL) { return NUSE_INVALID_POINTER; } #if NUSE_BLOCKING_ENABLE if ((suspend != NUSE_NO_SUSPEND) &amp;&amp; (suspend != NUSE_SUSPEND)) { return NUSE_INVALID_SUSPEND; } #else if (suspend != NUSE_NO_SUSPEND) { return NUSE_INVALID_SUSPEND; } #endif #endif</code> </pre><br>  Une telle v√©rification des param√®tres peut conduire au fait que l'appel API produira un code d'erreur.  Il s'agit d'une valeur n√©gative de la forme <b>NUSE_INVALID_xxx</b> (par exemple, <b>NUSE_INVALID_POINTER</b> ) - un ensemble complet de d√©finitions est contenu dans le fichier <b>nuse_codes.h</b> . <br><br>  Pour traiter les valeurs d'erreur, un code d'application suppl√©mentaire (√©ventuellement cr√©√© √† l'aide d'une compilation conditionnelle) peut √™tre ajout√©, cependant, pour les d√©tecter, il est pr√©f√©rable d'utiliser les outils de surveillance des donn√©es des d√©bogueurs de firmware modernes. <br><br>  La v√©rification des param√®tres entra√Æne une consommation de m√©moire suppl√©mentaire (code suppl√©mentaire) et affecte les performances du code, par cons√©quent, son utilisation affectera l'ensemble du syst√®me.  √âtant donn√© que l'int√©gralit√© du code source de Nucleus SE est disponible pour le d√©veloppeur, la v√©rification et le d√©bogage peuvent √™tre effectu√©s manuellement sur le code d'application final si une pr√©cision absolue est requise. <br><br><h2>  V√©rification de la pile des t√¢ches </h2><br>  Jusqu'√† ce que le planificateur d'ex√©cution jusqu'√† l'ex√©cution soit utilis√©, Nucleus SE offre la possibilit√© de v√©rifier la pile de t√¢ches, qui est similaire √† une fonction similaire dans Nucleus RTOS et affiche l'espace restant sur la pile.  Cet appel d'utilitaire API ( <b>NUSE_Task_Check_Stack ()</b> ) a √©t√© d√©crit en d√©tail dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> (# 12).  Quelques id√©es pour v√©rifier les erreurs de pile sont fournies plus loin dans cet article dans la section Diagnostics personnalis√©s. <br><br><h2>  Informations sur la version </h2><br>  Nucleus RTOS et Nucleus SE ont une fonction API qui renvoie simplement les informations de version / build du noyau. <br><br><h3>  Appel de l'API Nucleus RTOS </h3><br>  Prototype d'appel de service: <br>  CHAR * NU_Release_Information (VOID); <br><br>  Param√®tres: aucun. <br><br>  Valeur de retour: <br>  Pointeur vers une cha√Æne contenant des informations de version se terminant par un octet nul. <br><br><h3>  Appel API Nucleus SE </h3><br>  Cet appel d'API prend en charge la fonctionnalit√© principale de l'API Nucleus RTOS. <br><br>  Prototype d'appel de service: <br>  char * NUSE_Release_Information (void); <br><br>  Param√®tres: aucun. <br><br>  Valeur de retour: <br>  Pointeur vers une cha√Æne contenant des informations de version se terminant par un octet nul. <br><br><h3>  Passer un appel pour obtenir des informations sur l'assemblage Nucleus SE </h3><br>  L'impl√©mentation de cet appel API est assez simple.  Un pointeur est renvoy√© sur la ligne constante <b>NUSE_Release_Info</b> , qui est d√©clar√©e et initialis√©e dans le fichier <b>nuse_globals.c</b> . <br><br>  Cette ligne a la forme Nucleus SE - <b>Xyymmmdd</b> , o√π: <br>  <b>X</b> - √©tat de construction: <b>A</b> = alpha;  <b>B</b> = b√™ta;  <b>R</b> = lib√©ration <br>  <b>aa</b> - ann√©e de sortie <br>  <b>mm</b> - mois de sortie <br>  <b>jj</b> - jour de sortie <br><br><h2>  Compatible avec Nucleus RTOS </h2><br>  Nucleus RTOS contient la prise en charge optionnelle du magazine historique.  Le noyau enregistre les d√©tails des diff√©rentes actions du syst√®me.  Il existe des fonctions API qui permettent aux programmes de: <br><ul><li>  activer / d√©sactiver la journalisation; </li><li>  cr√©er une entr√©e de journal; </li><li>  Obtenez une entr√©e de journal. </li></ul><br>  Cette fonctionnalit√© n'est pas prise en charge dans Nucleus SE. <br><br>  Nucleus RTOS dispose √©galement de plusieurs macros de gestion des erreurs qui vous permettent de ne pas effectuer de confirmation d'erreur (ASSERT) et offrent la possibilit√© d'appeler des fonctions d'erreur critique d√©finies par l'utilisateur.  Ils sont √©ventuellement inclus dans l'assemblage du syst√®me d'exploitation.  Nucleus SE ne prend pas en charge cette fonctionnalit√©. <br><br><h3>  Diagnostics utilisateur </h3><br>  Jusqu'√† pr√©sent, dans cet article, nous avons examin√© les outils de diagnostic et de v√©rification des erreurs fournis par Nucleus SE lui-m√™me.  Maintenant, il vaut la peine de dire comment les outils de diagnostic d√©finis par l'utilisateur ou orient√©s vers une application sp√©cifique peuvent √™tre impl√©ment√©s en utilisant les outils fournis par le noyau et / ou nos connaissances sur sa structure interne et son impl√©mentation <br><br><h3>  Diagnostics sp√©cifiques √† l'application </h3><br>  Dans presque toutes les applications, vous pouvez ajouter du code suppl√©mentaire pour v√©rifier son int√©grit√© lors de l'ex√©cution.  Le noyau multit√¢che facilite et simplifie la cr√©ation d'une t√¢che sp√©ciale pour ce travail.  √âvidemment, dans cet article, nous ne consid√©rerons pas les cas de diagnostic trop inhabituels, mais consid√©rons quelques id√©es g√©n√©rales. <br><br><h3>  V√©rifications de la m√©moire </h3><br>  De toute √©vidence, le bon fonctionnement de la m√©moire est essentiel √† l'int√©grit√© de tout syst√®me de processeur.  Il n'est pas moins √©vident qu'une erreur critique ne vous permettra pas d'ex√©cuter, pas seulement des diagnostics, mais l'ensemble du produit logiciel dans son ensemble ( <i>Note du traducteur: Au fait, c'est exactement le cas que nous avons examin√© dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article ¬´Fake Blue Pill¬ª</a></i> ).  Cependant, il existe des situations o√π une certaine erreur appara√Æt, ce qui est une source de grave pr√©occupation, mais n'interf√®re pas avec l'ex√©cution du code.  Les tests de m√©moire sont un sujet assez compliqu√© qui d√©passe le cadre de cet article, donc je ne donnerai que quelques id√©es g√©n√©rales. <br><br>  Les deux erreurs les plus courantes qui se produisent dans la RAM sont: <br><ul><li>  ¬´Bits collants¬ª lorsque le bit a une valeur de 0 ou 1, qui ne peut pas √™tre modifi√©e; </li><li>  ¬´Diaphonie¬ª lorsque des bits adjacents provoquent des interf√©rences entre eux. </li></ul><br>  Les deux erreurs peuvent √™tre v√©rifi√©es en √©crivant et en lisant tour √† tour certains mod√®les de test dans chaque zone RAM.  Certaines v√©rifications ne peuvent √™tre effectu√©es qu'au d√©marrage, avant m√™me la formation de la pile ( <i>note du traducteur: dans l'article mentionn√© ci-dessus, il s'est av√©r√© que c'√©tait la premi√®re utilisation de la pile qui d√©truisait tout √† la fois</i> ).  Par exemple, une v√©rification ¬´unit√© en cours d'ex√©cution¬ª, dans laquelle chaque bit de m√©moire se voit attribuer une valeur de un, et tous les autres bits sont v√©rifi√©s pour s'assurer qu'ils sont √©gaux √† z√©ro.  D'autres mod√®les de test au niveau du bit peuvent √™tre effectu√©s pendant le fonctionnement, √† condition que, m√™me si la zone RAM est endommag√©e, la commutation de contexte ne se produira pas.  L'utilisation des macros de restriction des sections critiques de <b>Nucleus SE NUSE_CS_Enter ()</b> et <b>NUSE_CS_Exit ()</b> est assez simple et √©volutive. <br><br>  Diff√©rents types de ROM sont √©galement sujets √† des erreurs p√©riodiques, mais il n'y a pas beaucoup d'outils pour les v√©rifier.  Une somme de contr√¥le calcul√©e apr√®s assemblage du code pourrait √™tre utile ici.  Cette v√©rification peut √™tre effectu√©e au d√©marrage et √©ventuellement au moment de l'ex√©cution. <br><br>  Une erreur dans la logique d'adressage de la m√©moire peut affecter √† la fois la ROM et la RAM.  Vous pouvez d√©velopper une v√©rification sp√©ciale pour cette erreur, mais elle sera tr√®s probablement d√©tect√©e dans le cadre des v√©rifications d√©crites ci-dessus. <br><br><h3>  Test des p√©riph√©riques </h3><br>  En plus du CPU, les circuits p√©riph√©riques peuvent √©galement √™tre sujets aux erreurs.  Bien s√ªr, cela varie consid√©rablement d'un syst√®me √† l'autre, cependant, dans la plupart des appareils, il existe diff√©rentes fa√ßons de v√©rifier leur int√©grit√© √† l'aide d'un logiciel de diagnostic.  Par exemple, un canal de communication peut avoir un mode de v√©rification de bouclage dans lequel toutes les donn√©es entrant dans le canal sont imm√©diatement renvoy√©es. <br><br><h3>  Service de surveillance </h3><br>  Les d√©veloppeurs int√©gr√©s utilisent souvent un chien de garde.  Il s'agit d'un p√©riph√©rique qui interrompt le CPU et attend une r√©ponse, ou (plus pr√©f√©rablement) n√©cessite un acc√®s p√©riodique depuis le logiciel.  Dans les deux cas, un r√©sultat courant d'une horloge de surveillance est une r√©initialisation du syst√®me. <br><br>  L'utilisation efficace d'un chien de garde dans un environnement multit√¢che est un probl√®me complexe.  Si vous effectuez une t√¢che qui y acc√®de p√©riodiquement (horloge de surveillance), cela confirmera que cette t√¢che particuli√®re fonctionne.  Une solution possible pourrait √™tre la mise en ≈ìuvre de la ¬´t√¢che de r√©partiteur¬ª.  Un exemple d'une telle t√¢che sera donn√© ci-dessous. <br><br><h3>  V√©rification du d√©passement de pile </h3><br>  Si vous n'utilisez pas le Planificateur d'ex√©cution jusqu'√† la fin, une pile sera cr√©√©e pour chaque t√¢che dans l'application Nucleus SE.  L'int√©grit√© de ces piles est tr√®s importante, mais la quantit√© de RAM est susceptible d'√™tre limit√©e, par cons√©quent, il est important de rendre la taille d'application optimale.  La pr√©vision statique des exigences pour la pile de chaque t√¢che est possible, mais tr√®s difficile.  La pile doit √™tre suffisamment grande pour m√™me les fonctions les plus imbriqu√©es, ainsi que le gestionnaire d'interruption le plus exigeant.  Une approche plus simple pour r√©soudre ce probl√®me serait d'utiliser des tests d'ex√©cution exhaustifs. <br><br>  De mani√®re g√©n√©rale, il existe deux approches pour v√©rifier la pile.  Si vous utilisez un d√©bogueur de logiciel int√©gr√© sophistiqu√©, les limites de la pile peuvent √™tre surveill√©es et toutes les violations seront d√©tect√©es.  L' <b>emplacement</b> et la taille des piles Nucleus SE sont disponibles dans les structures de donn√©es ROM globales: <b>NUSE_Task_Stack_Base []</b> et <b>NUSE_Task_Stack_Size []</b> . <br><br>  Une alternative est le test d'ex√©cution.  Une approche courante consiste √† utiliser des ¬´mots de garde¬ª √† la fin de chaque pile, g√©n√©ralement le premier √©l√©ment de chaque zone des donn√©es de la pile.  Ces mots sont initialis√©s avec une valeur non nulle reconnue.  La t√¢che de service / diagnostic v√©rifie ensuite si ces mots ont chang√© et effectue les actions appropri√©es.  √âcraser le mot de s√©curit√© ne signifie pas que la pile est pleine, mais indique que cela est sur le point de se produire.  Par cons√©quent, le logiciel peut continuer √† fonctionner, vous devrez peut-√™tre prendre des mesures correctives ou signaler une erreur √† l'utilisateur. <br><br><h3>  T√¢che du superviseur </h3><br>  Malgr√© le fait que Nucleus SE ne r√©serve aucune des seize t√¢ches possibles √† ses propres besoins, l'utilisateur peut s√©lectionner une t√¢che pour les diagnostics.  Il peut s'agir d'une t√¢che de faible priorit√© qui utilise simplement n'importe quel temps de processeur ¬´libre¬ª ou d'une t√¢che de haute priorit√© qui s'ex√©cute p√©riodiquement, en prenant une courte p√©riode de temps, ce qui garantit que les diagnostics sont effectu√©s r√©guli√®rement. <br><br>  Voici un exemple de fonctionnement d'une t√¢che similaire. <br><br>  Les indicateurs de signal de la t√¢che de r√©partiteur sont utilis√©s pour suivre le fonctionnement de six t√¢ches syst√®me critiques.  Chacune de ces t√¢ches utilise un indicateur sp√©cifique (du bit 0 au bit 5) et doit le d√©finir r√©guli√®rement.  La t√¢che de r√©partiteur r√©initialise tous les indicateurs, puis suspend son travail pendant une certaine p√©riode de temps.  Lorsqu'elle reprend le travail, elle s'attend √† ce que les six t√¢ches soient "v√©rifi√©es" en d√©finissant l'indicateur appropri√©, puis elle recherche une correspondance exacte avec la valeur de <b>b00111111</b> (√† partir du fichier <b>nuse_binary.h</b> ).  Si tout r√©pond aux exigences, il r√©initialise les indicateurs et s'arr√™te √† nouveau.  Sinon, il appelle la routine de gestion des erreurs critiques, qui √† son tour peut, par exemple, red√©marrer le syst√®me. <br><br>  Dans une impl√©mentation alternative, des groupes de drapeaux d'√©v√©nements pourraient √™tre utilis√©s.  Cela a du sens si les signaux ne sont pas utilis√©s ailleurs dans l'application (sinon cela entra√Ænera une utilisation excessive de la RAM par toutes les t√¢ches) et surtout si les indicateurs d'√©v√©nement sont utilis√©s √† d'autres fins. <br><br><h2>  Tra√ßage et profilage </h2><br>  Malgr√© le fait que de nombreux d√©bogueurs de logiciels embarqu√©s modernes ont un haut degr√© de personnalisation et peuvent √™tre utilis√©s pour fonctionner avec RTOS, le d√©bogage d'une application multithread peut toujours √™tre difficile.  Une approche largement utilis√©e est le profilage post-ex√©cution, dans lequel le code (RTOS) est mis en ≈ìuvre afin qu'un audit d√©taill√© de son travail puisse √™tre analys√© r√©trospectivement.  En r√®gle g√©n√©rale, la mise en ≈ìuvre d'un tel service comprend deux composants: <br><ol><li>  Un code suppl√©mentaire est ajout√© au RTOS pour consigner les actions.  En r√®gle g√©n√©rale, il sera envelopp√© dans des directives de pr√©processeur pour utiliser la compilation conditionnelle.  Ce code enregistre plusieurs octets d'informations lorsqu'un √©v√©nement important se produit (par exemple, appeler une fonction API ou changer de contexte).  Ces informations peuvent comprendre: <br><ul><li>  adresse actuelle (PC); </li><li>  ID de la t√¢che en cours (index); </li><li>  indices d'autres objets utilis√©s; </li><li>  code correspondant √† l'op√©ration effectu√©e. </li></ul><br></li><li>  T√¢che allou√©e pour d√©charger le tampon d'informations de profil sur un stockage externe, g√©n√©ralement sur l'ordinateur h√¥te. </li></ol><br>  L'analyse des donn√©es ainsi obtenues n√©cessitera √©galement un certain travail, mais ce n'est pas plus compliqu√© que d'utiliser une feuille de calcul Excel r√©guli√®re. <br><br>  Dans le prochain article, nous examinerons en d√©tail la compatibilit√© de Nucleus SE et Nucleus RTOS. <br><br>  <b>√Ä propos de l'auteur:</b> Colin Walls travaille dans l'industrie √©lectronique depuis plus de trente ans, consacrant la majeure partie de son temps au micrologiciel.  Il est maintenant ing√©nieur firmware chez Mentor Embedded (une division de Mentor Graphics).  Colin Walls intervient souvent lors de conf√©rences et s√©minaires, auteur de nombreux articles techniques et de deux livres sur le firmware.  Vit au Royaume-Uni.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Blog</a> professionnel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de Colin</a> , e-mail: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463403/">https://habr.com/ru/post/fr463403/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463391/index.html">Comment √©pouser tout le monde (mariage √† un, deux et trois sexes) du point de vue des math√©matiques et pourquoi les hommes gagnent toujours</a></li>
<li><a href="../fr463393/index.html">Votre entreprise est-elle une famille ou une √©quipe sportive?</a></li>
<li><a href="../fr463397/index.html">March√© des changes et ing√©nierie financi√®re au Moyen √Çge</a></li>
<li><a href="../fr463399/index.html">Pr√©sentation de 3CX 16 Update 3 Alpha - DNS avanc√© et reconnexion des clients mobiles</a></li>
<li><a href="../fr463401/index.html">Naples √† Rome: nouveaux processeurs AMD EPYC</a></li>
<li><a href="../fr463405/index.html">La deuxi√®me couche de d√©veloppement (jeu mobile), quoi, quand et pourquoi</a></li>
<li><a href="../fr463411/index.html">Ne travaillez pas dans de mauvais projets</a></li>
<li><a href="../fr463415/index.html">Security Week 33: int√©ressant avec Black Hat / DEF CON 2019</a></li>
<li><a href="../fr463417/index.html">Portage du syst√®me d'exploitation vers Aarch64</a></li>
<li><a href="../fr463419/index.html">√âv√©nements num√©riques √† Moscou du 12 au 18 ao√ªt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>