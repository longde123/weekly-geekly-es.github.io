<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👃🏽 🕵🏽 🧒🏽 在VPN隧道内部和外部连接时会发生什么 🤲🏼 🦆 👨🏿‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="从信件到Tucha技术支持，这些文章诞生了。 因此，最近有一位客户与我们联系，要求澄清在用户办公室与云环境之间的VPN隧道内部连接以及在VPN隧道外部连接时发生的情况。 因此，下面的全文是一封真实的信，我们根据他的问题发给其中一位客户。 当然，我们更改了IP地址，以免使客户端匿名。 但是，是的，Tu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>在VPN隧道内部和外部连接时会发生什么</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477854/"> 从信件到Tucha技术支持，这些文章诞生了。 因此，最近有一位客户与我们联系，要求澄清在用户办公室与云环境之间的VPN隧道内部连接以及在VPN隧道外部连接时发生的情况。 因此，下面的全文是一封真实的信，我们根据他的问题发给其中一位客户。 当然，我们更改了IP地址，以免使客户端匿名。 但是，是的，Tucha技术支持确实以其全面的答案和内容丰富的信函而闻名。  :-) <br><br> 当然，我们知道对于许多人来说，这篇文章不是启示。 但是，由于不定期出现在Habr上的有关初学者的文章，并且由于该文章是写给真实客户的真实来信，因此我们仍将在此处共享此信息。 很可能对某人有用。 <br> 因此，我们详细说明了如果通过站点到站点网络连接云服务器和办公室之间会发生什么情况。 请注意，在这种情况下，部分服务仅可从办公室使用，而部分服务可从Internet的任何地方使用。 <br><br> 我们将立即说明，我们的客户希望他可以通过RDP从任何地方访问服务器<b>192.168.A.1</b> ，并连接到<b>AAA2：13389</b> ，并且<b>仅从</b>通过以下方式连接的办公室<b>（192.168.B.0 / 24）</b>连接到其他服务<b>：</b>虚拟专用网 此外，客户端最初配置为办公室中的机器<b>192.168.B.2</b>也可以通过RDP从任何地方访问，并连接到<b>BBB1：11111</b> 。 我们帮助组织了云与办公室之间的IPSec连接，客户的IT专家开始询问有关在这种情况下会发生什么的问题。 为了回答所有这些问题，实际上，我们在下面给他写了所有您可以阅读的内容。 <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/yi/h8/nm/yih8nmxyw3h1kvhvrv8grwlqt14.jpeg"><br><p> 现在更详细地考虑这些过程。 </p><br><h3> 第一名 </h3><br> 当某物从<b>192.168.B.0 / 24</b>发送到<b>192.168.A.0 / 24</b>或从<b>192.168.A.0 / 24</b>发送到<b>192.168.B.0 / 24时</b> ，它进入了VPN。 也就是说，此数据包被额外加密并在<b>BBB1</b>和<b>AAA1</b>之间传输，但是<b>192.168.A.1</b>恰好看到了来自<b>192.168.B.1</b>的数据包。 他们可以通过任何协议相互通信。 返回响应也以相同的方式通过VPN传输，这意味着从<b>192.168.A.1</b>到<b>192.168.B.1</b>的数据包将作为ESP数据报从<b>AAA1</b>发送到<b>BBB1</b> ，路由器将在另一侧部署该数据包，从中获取该数据包并将其发送到<b>192.168.B.1</b>作为来自<b>192.168.A.1</b>的数据包。 <br><br> 具体示例： <br><br>  1） <b>192.168.B.1</b>访问<b>192.168.A.1</b> ，要与<b>192.168.A.1</b>建立TCP连接<b>：3389</b> ; <br><br>  2） <b>192.168.B.1</b>从<b>192.168.B.1</b>发送请求建立连接<b>：55555</b> （他选择要反馈的端口，以下我们将使用数字55555作为系统在生成TCP-时选择的端口号的示例）连接）到<b>192.168.A.1：3389</b> ; <br><br>  3）在地址为<b>192.168.B.1</b>的计算机上运行的操作系统决定将此数据包传输到路由器的网关地址（在本例中为<b>192.168.B.254</b> ），因为<b>192.168.A.1</b>还有其他更具体的路由，因此，它不会沿默认路由（0.0.0.0/0）传递数据包； <br><br>  4）为此，她尝试在ARP协议的缓存表中找到IP地址<b>192.168.B.254</b>的MAC地址。 如果未找到，它将从地址<b>192.168.B.1</b>向网络<b>192.168.B.0 / 24</b>发送广播请求对象。  <b>192.168.B.254</b>将其MAC地址发送回给它时，系统会为其发送一个以太网数据包并将此信息存储在其缓存表中； <br><br>  5）路由器接收到该数据包并决定将其发送到何处：它具有以下策略：它应通过<b>BBB1</b>和<b>AAA1</b>之间的VPN连接传输<b>192.168.B.0 / 24</b>和<b>192.168.A.0 / 24</b>之间的所有数据包； <br><br>  6）路由器生成从<b>BBB1</b>到<b>AAA1</b>的ESP数据报； <br><br>  7）路由器决定将该数据包发送给谁，因为它没有比0.0.0.0/0更具体的<b>AAA1</b>路由，所以将其发送到<b>BBB254</b> （Internet提供商的网关）； <br><br>  8）以与上述相同的方式，找到<b>BBB254</b>的MAC地址并将数据包发送到Internet提供商的网关； <br><br>  9）互联网提供商通过其网络从<b>BBB1</b>到<b>AAA1</b>传输ESP数据报； <br><br>  10） <b>AAA1</b>上的虚拟路由器接收此数据报，对其进行解密，并从<b>192.168.B.1：55555</b>接收一个针对<b>192.168.A.1：3389</b>的数据包； <br><br>  11）虚拟路由器检查应将其发送给谁，在路由表中找到网络<b>192.168.A.0 / 24</b>并将其直接发送到<b>192.168.A.1</b> ，因为它具有接口<b>192.168.A.254 / 24</b> ； <br><br>  12）为此，虚拟路由器找到<b>192.168.A.1</b>的MAC地址，并通过虚拟以太网将该数据包传递给它； <br><br>  13） <b>192.168.A.1</b>在端口3389上收到此数据包，同意建立连接并形成一个数据包，以响应从<b>192.168.A.1：3389</b>到<b>192.168.B.1：55555的问题</b> ； <br><br>  14）他的系统将此数据包发送到虚拟路由器的网关地址（在本例中为<b>192.168.A.254</b> ），因为它没有针对<b>192.168.B.1的</b>其他更特定的路由，因此，它必须沿该路由传输数据包默认值（0.0.0.0/0）; <br><br>  15）以与以前的情况相同的方式，在地址为<b>192.168.A.1</b>的服务器上运行的系统会找到MAC地址<b>192.168.A.254</b> ，因为它与接口<b>192.168.A.1 /</b>在同一网络上<b>24</b> ; <br><br>  16）虚拟路由器接收此数据包并决定将其发送到何处：它具有以下策略：它应通过<b>AAA1</b>和<b>BBB1</b>之间的VPN连接传输<b>192.168.A.0 / 24</b>和<b>192.168.B.0 / 24</b>之间的所有数据包; <br><br>  17）虚拟路由器生成从<b>AAA1</b>到<b>BBB1</b>的ESP数据报； <br><br>  18）虚拟路由器决定应将此数据包发送给谁，然后将其发送到<b>AAA254</b> （Internet提供商的网关，在这种情况下，这也是我们），因为到<b>BBB1的</b>路由比0.0.0.0/0更具体； <br><br>  19）互联网提供商通过其网络从<b>AAA1</b>向<b>BBB1</b>传输ESP数据报； <br><br>  20） <b>BBB1</b>上的路由器接收到该数据报，对其进行解密，并从<b>192.168.A.1：3389</b>接收一个针对<b>192.168.B.1：55555</b>的数据包； <br><br>  21）他知道应该将其传输到<b>192.168.B.1</b> ，因为他和他在同一个网络上，因此，他在路由表中有一个相应的条目，迫使他为整个<b>192.168.B.0 /</b>发送数据包直接<b>24个</b> ； <br><br>  22）路由器找到<b>192.168.B.1</b>的MAC地址并发送此数据包； <br><br>  23）地址为<b>192.168.B.1</b>的计算机上的操作系统从<b>192.168.A.1：3389</b>接收到<b>192.168.B.1：55555</b>的数据包，并启动以下步骤以建立TCP连接。 <br><br> 这个示例非常简洁，简单（您可以在此处回忆很多细节）描述了2-4级时发生的情况。 不考虑1、5-7级。 <br><br><h3> 第二位置 </h3><br> 如果从<b>192.168.B.0 / 24</b>向<b>AAA2</b>专门发送了某些内容，则该内容不会直接转到VPN。 也就是说，如果来自地址<b>192.168.B.1</b>的用户访问<b>AAA2：13389</b> ，则此数据包将从地址<b>BBB1</b>磨损，传递到<b>AAA2</b> ，然后路由器在<b>此处</b>接收并将其发送到<b>192.168.A.1</b> 。  <b>192.168.A.1</b>对<b>192.168.B.1</b>一无所知，他看到了来自<b>BBB1</b>的数据包，因为他理解了。 因此，此请求的答案沿一般路线进行，从地址<b>AAA2</b>到<b>BBB1完全相同</b> ，该路由器将此答案提供给<b>192.168.B.1</b> ，从<b>AAA2中</b>看到答案，并向其寻址。 <br><br> 具体示例： <br><br>  1） <b>192.168.B.1</b>地址<b>AAA2</b> ，要与<b>AAA2</b>建立TCP连接<b>：13389</b> ; <br><br>  2） <b>192.168.B.1</b>发送一个建立连接的请求，该连接从<b>192.168.B.1：55555</b> （此数字，如前面的示例，可能有所不同）到<b>AAA2：13389</b> ； <br><br>  3）在地址为<b>192.168.B.1</b>的计算机上运行的操作系统决定将此数据包传输到路由器的网关地址（在本例中为<b>192.168.B.254</b> ），因为它没有其他更具体的<b>AAA2</b>路由，这意味着它将沿着默认路由（0.0.0.0/0）发送数据包； <br><br>  4）为此，正如我们在前面的示例中提到的，她尝试在ARP协议的缓存表中查找IP地址<b>192.168.B.254</b>的MAC地址。 如果未找到，它将从地址<b>192.168.B.1</b>向网络<b>192.168.B.0 / 24</b>发送广播请求对象。  <b>192.168.B.254</b>向其发送回其MAC地址时，系统会为其发送一个以太网数据包，并将此信息存储在其缓存表中； <br><br>  5）路由器接收到该数据包并决定将其发送到何处：它具有以下策略：必须将所有从<b>192.168.B.0 / 24的</b>数据包转发（替换为返回地址）到其他Internet节点； <br><br>  6）由于此策略意味着返回地址必须与该数据包将通过其传输的接口上的最低地址一致，因此路由器首先决定应将该数据包确切地传输给谁，并且如上例所示，他应将其发送给<b>BBB254</b> （Internet服务提供商网关），因为它没有比0.0.0.0/0更具体的到<b>AAA2的</b>路由； <br><br>  7）因此，路由器将替换数据包的返回地址，此后将数据包从<b>BBB1：44444</b> （端口号，当然可能有所不同）更改为<b>AAA2：13389</b> ； <br><br>  8）路由器记住它所做的事情，这意味着当<b>收到</b>从<b>AAA2：</b> <b>13389</b>到<b>BBB1：44444</b>的<b>响应</b>时，它将知道它将接收者的地址和端口更改为<b>192.168.B.1：55555</b> 。 <br><br>  9）现在，路由器必须通过<b>BBB254</b>将其传输到Internet提供商的网络，因此，按照我们已经提到的相同方式，它找到<b>BBB254</b>的MAC地址并将数据包发送到Internet提供商的网关； <br><br>  10）互联网提供商在其网络<b>上将</b>数据包从<b>BBB1</b>传输到<b>AAA2</b> ； <br><br>  11） <b>AAA2</b>上的虚拟路由器在端口<b>13389上</b>接收到此数据包； <br><br>  12）虚拟路由器上有一条规则，规定从任何发件人到此端口的数据包都应发送到<b>192.168.A.1：3389</b> ； <br><br>  13）虚拟路由器在路由表中找到网络<b>192.168.A.0 / 24</b> ，并将其直接发送到<b>192.168.A。</b>  1，因为它具有接口<b>192.168.A.254 / 24</b> ； <br><br>  14）为此，虚拟路由器找到<b>192.168.A.1</b>的MAC地址，并通过虚拟以太网将该数据包传递给它； <br><br>  15） <b>192.168.A.1</b>在端口3389上接收到此数据包，同意建立连接并在<b>BBB1：44444</b>上响应<b>192.168.A.1：3389</b>形成数据包； <br><br>  16）他的系统将此数据包发送到虚拟路由器的网关地址（在本例中为<b>192.168.A.254</b> ），因为它没有针对<b>BBB1的</b>其他更特定的路由，因此，它必须沿默认路由（0.0。 0.0 / 0）; <br><br>  17）以与以前的情况相同的方式，在地址为<b>192.168.A.1</b>的服务器上运行的系统会找到MAC地址<b>192.168.A.254</b> ，因为它与接口<b>192.168.A.1</b>处于同一网络上<b>/ 24</b> ; <br><br>  18）虚拟路由器接受此数据包。 应当注意，他记得他收到了来自<b>AAA2：13389的BBB1：44444</b>的数据包， <b>并将</b>接收者地址和端口更改为<b>192.168.A.1：3389</b> ，因此，他将数据包从<b>192.168.A.1：3389</b>更改为<b>BBB1：44444</b> <b>AAA2</b>上的发件人地址<b>：13389</b> ; <br><br>  19）虚拟路由器决定应将此数据包发送给谁，因为它没有比0.0.0.0/0更具体的<b>BBB1</b>路由，所以将其发送到<b>AAA254</b> （Internet提供商的网关，在这种情况下，也是我们）。 <br><br>  20）Internet提供商在其网络<b>上将</b>数据包从<b>AAA2</b>传输到<b>BBB1</b> ； <br><br>  21） <b>BBB1</b>上的路由器接收到此数据包，并回想起它从<b>192.168.B.1：55555</b>发送数据包到<b>AAA2：13389时</b> ，将其地址和发送方端口更改为<b>BBB1：44444</b> ，这意味着这是需要传输的答案在<b>192.168.B.1：55555上</b> （实际上，还有其他几条支票，但我们不进行讨论）； <br><br>  22）他知道应该将它们直接发送到<b>192.168.B.1</b> ，因为他和他在同一个网络上，因此，他在路由表中有一个对应的条目，迫使他为整个<b>192.168.B.0 / 24</b>发送数据包直接 <br><br>  23）路由器找到<b>192.168.B.1</b>的MAC地址并发送此数据包； <br><br>  24）地址为<b>192.168.B.1</b>的计算机上的操作系统从<b>AAA2：13389</b>接收到<b>192.168.B.1：55555</b>的数据包，并启动以下步骤以建立TCP连接。 <br><br> 应该注意的是，在这种情况下，地址为<b>192.168.B.1</b>的计算机对地址为<b>192.168.A.1</b>的服务器<b>一无所知</b> ，它仅与<b>AAA2</b>通信。 同样，地址为<b>192.168.A.1</b>的服务器对地址为<b>192.168.B.1</b>的计算机一无所知。 他认为他们是从地址<b>BBB1</b>与他建立联系的，因此，他一无所知。 <br><br> 还应注意，如果此计算机访问<b>AAA2：1540</b> ，将不会建立连接，因为即使在虚拟网络<b>192.168.A.0</b>中的任何服务器上，也未在虚拟路由器上配置到端口1540的连接转发配置<b>/ 24</b> （例如，在地址为<b>192.168.A.1</b>的服务器上），并且某些服务正在等待此端口上的连接。 如果绝对需要使用地址<b>192.168.B.1</b>的计算机用户建立与此服务的连接，则他必须使用VPN，即 直接通过<b>192.168.A.1：1540</b>与我们联系。 <br><br> 应该强调的是，任何与<b>AAA1</b>建立连接的尝试（除了来自<b>BBB1</b>的IPSec连接都不会成功。除与端口<b>13389</b>的连接之外，与<b>AAA2</b>建立连接的任何尝试都将失败。 <br> 还要注意，如果其他人<b>呼叫AAA2</b> （例如UDP），则第10-20段中指示的所有内容也将适用于他。 之前和之后发生的情况取决于其背后的确切内容。我们不拥有此类信息，因此，我们建议您向该地址的地址咨询网站管理员。 <br><br><h3> 第三位置 </h3><br> 反之亦然，如果某物从<b>192.168.A.1</b>发送到某个配置为内部转发到BBB1的端口（例如11111），它也不会进入VPN，而是从<b>AAA1</b>调皮到<b>BBB1</b> ，并且已经有人将其传输到<b>192.168.B.2：3389中的</b>某个位置。 他看到的不是来自<b>192.168.A.1的</b>包，而是来自<b>AAA1的包</b> 。 并且，当<b>192.168.B.2</b>应答时，数据包从<b>BBB1</b>转到<b>AAA1</b> <b>，</b>随后到达连接发起方<b>-192.168.A.1</b> 。 <br><br> 具体示例： <br><br>  1） <b>192.168.A.1</b>地址为<b>BBB1</b> ，要与<b>BBB1</b>建立TCP连接<b>：11111</b> ; <br><br>  2） <b>192.168.A.1</b>在<b>BBB1：11111</b>上发送从<b>192.168.A.1：55555</b>建立连接的请求（此数字，如上例所示，可能有所不同）； <br><br>  3）在地址为<b>192.168.A.1</b>的服务器上运行的操作系统决定将此数据包传输到路由器的网关地址（在本例中为<b>192.168.A.254</b> ），因为它没有针对<b>BBB1的</b>其他更具体的路由，因此，它将沿着默认路由（0.0.0.0/0）发送数据包； <br><br>  4）为此，正如我们在前面的示例中提到的，她尝试在ARP协议的缓存表中查找IP地址<b>192.168.A.254</b>的MAC地址。 如果未找到，它将从地址<b>192.168.A.1</b>向网络<b>192.168.A.0 / 24</b>发送广播请求对象。 当<b>192.168.A.254</b>向其发送回其MAC地址时，系统将为其发送以太网数据包，并将此信息输入其高速缓存表； <br><br>  5）虚拟路由器接收到该数据包并决定将其传输到何处：它具有一项策略，必须将所有从<b>192.168.A.0 / 24的</b>数据包转发（替换为返回地址）到其他Internet节点； <br><br>  6）由于此策略假定返回地址必须与该数据包将通过其传输的接口上的最低地址一致，因此虚拟路由器首先决定应将该数据包确切地传输给谁，并且如上例所示，他应将其发送给谁在<b>AAA254</b> （Internet提供商的网关，在这种情况下，这也是我们）上，因为到<b>BBB1的</b>路由比0.0.0.0/0更具体； <br><br>  7）这意味着虚拟路由器将替换数据包的返回地址，因此它是从<b>AAA1：44444</b> （端口号，当然可能有所不同）到<b>BBB1：11111的数据包</b> ； <br><br>  8）虚拟路由器记住了他所做的事情，因此，当从<b>BBB1：11111收到AAA1</b> <b>：44444</b>的<b>响应</b>时，他会知道他应该将接收者的地址和端口更改为<b>192.168.A.1：55555</b> 。 <br><br>  9）现在，虚拟路由器必须通过<b>AAA254</b>将其传输到Internet提供商的网络，这意味着，正如我们已经提到的，它找到<b>AAA254</b>的MAC地址并将数据包发送到Internet提供商的网关； <br><br>  10）互联网提供商在其网络<b>上将</b>数据包从<b>AAA1</b>传输<b>到BBB1</b> ； <br><br>  11） <b>BBB1</b>上的路由器在端口11111上收到此数据包； <br><br>  12）虚拟路由器上有一条规则，规定从任何发件人接收到此端口的数据包都应传输到<b>192.168.B.2：3389</b> ； <br><br>  13）路由器在路由表中找到网络<b>192.168.B.0 / 24</b> ，并将其直接发送到<b>192.168.B.2</b> ，因为它具有接口<b>192.168.B.254 / 24</b> ； <br><br>  14）为此，虚拟路由器找到<b>192.168.B.2</b>的MAC地址，并通过虚拟以太网将该数据包传递给它； <br><br>  15） <b>192.168.B.2</b>在端口3389上接收到此数据包，同意建立连接并形成一个数据包，以响应<b>192.168.B.2：3389</b>到<b>AAA1：44444的</b>请求； <br><br>  16）他的系统将此数据包发送到路由器的网关地址（在本例中为<b>192.168.B.254</b> ），因为它没有<b>AAA1的</b>其他更特定的路由，因此，它必须沿默认路由（0.0.0.0）传递数据包。 / 0）; <br><br>  17）与以前的情况相同，在地址为<b>192.168.B.2</b>的计算机上运行的系统会找到MAC地址<b>192.168.B.254</b> ，因为它与接口<b>192.168.B.2</b>在同一网络上<b>/ 24</b> ; <br><br>  18）路由器接受此数据包。 应当注意，他记得他收到了来自<b>BBB1：11111</b>上<b>AAA1</b>的数据包，并将接收者地址和端口更改为<b>192.168.B.2：3389</b> ，因此，他将发件人地址更改为<b>AAA1：44444的</b>从<b>192.168.B.2：3389</b>的数据包。在<b>BBB1：11111</b> ; <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19）路由器决定将该数据包转发给谁。他将其发送到</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BBB254</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Internet提供商的网关，我们不知道其确切地址），因为与</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AAA1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相比</font><font style="vertical-align: inherit;">，它没有</font><font style="vertical-align: inherit;">比0.0.0.0/0 </font><font style="vertical-align: inherit;">更具体的路由</font><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20）互联网服务提供商传递他们的网络封装</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BBB1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AAA1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ; </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21），虚拟路由器</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AAA1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接受程序包和回忆，当他路过一个包的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.A.1：55555</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BBB1：11111</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，他改变了他的地址和端口</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AAA1：44444</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。因此，这是需要传输到</font><b><font style="vertical-align: inherit;">192.168.A.1</font></b><font style="vertical-align: inherit;">的答案</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：55555</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（实际上，正如我们在前面的示例中提到的那样，那里还有更多的检查，但是这次我们也不再赘述）；</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22）他理解应该将其直接发送到</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.A.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为他和他在同一个网络上，这意味着他在路由表中有一个相应的条目，迫使他为整个</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.A.0 /</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送数据包</font><font style="vertical-align: inherit;">直接</font><b><font style="vertical-align: inherit;">24个</font></b><font style="vertical-align: inherit;">；</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23）路由器找到</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.A.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的MAC地址</font><font style="vertical-align: inherit;">并发送此数据包；</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24）地址为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.A.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的服务器上的操作系统</font><font style="vertical-align: inherit;">从</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BBB1：1111</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1 </font><font style="vertical-align: inherit;">接收到</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.A.1：55555</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的数据包，</font><font style="vertical-align: inherit;">并启动以下步骤以建立TCP连接。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以同样的方式在以前的情况，在这种情况下，地址服务器</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.A.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不知道计算机的地址什么</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.B.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，他只与通信</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BBB1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">地址为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.B.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的计算机</font><font style="vertical-align: inherit;">也不了解地址为</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.A.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的服务器</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">他认为他们从地址</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AAA1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到他</font><font style="vertical-align: inherit;">，其余的对他隐藏了。</font></font><br><br><h3> 结论 </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当在客户端办公室和云环境之间的VPN隧道内部连接时以及在VPN隧道外部连接时，就会发生这种情况。</font><font style="vertical-align: inherit;">如果您仍然有疑问或需要我们的帮助来解决云问题，</font></font><a href="https://tucha.ua/ru/contacts"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请联系24x7。</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN477854/">https://habr.com/ru/post/zh-CN477854/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN477842/index.html">Gennady Zelenko和Sergey Popov的故事-苏联的技术普及者</a></li>
<li><a href="../zh-CN477844/index.html">使用SAP Data Intelligence从思想到机器学习的实际应用的5个步骤</a></li>
<li><a href="../zh-CN477848/index.html">大心脏的小秘密：历史上的第一个蓝鲸心电图</a></li>
<li><a href="../zh-CN477850/index.html">React Native-解决所有问题的灵丹妙药吗？ 我们如何为Profi.ru选择跨平台工具</a></li>
<li><a href="../zh-CN477852/index.html">无毒伪善</a></li>
<li><a href="../zh-CN477856/index.html">从800GB到6.4TB的PCI-E闪存加速器：从普通PC /服务器的黎明到死</a></li>
<li><a href="../zh-CN477858/index.html">台下工作：预加速后真正发现了哪些项目？</a></li>
<li><a href="../zh-CN477860/index.html">Yandex Cloud中如何安排托管数据库服务</a></li>
<li><a href="../zh-CN477862/index.html">这样有可能吗？ 一站式科学与IT</a></li>
<li><a href="../zh-CN477864/index.html">TabPy，用于处理Tableau中ClickHouse中的数据</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>