<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ¦ï¸ âœ… ğŸ•” æˆ‘ä»¬å°†åœ¨çº¿åœ°å›¾è¿æ¥åˆ°æ™ºèƒ½æ‰‹æœºä¸Šçš„å¯¼èˆªå™¨ã€‚ ç¬¬3éƒ¨åˆ†-å¤©æ¡¥æ¶¡è½®å¢å‹ ğŸŒ· ğŸ‘¬ ğŸ˜¤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘ä»¬å°†å…ˆå‰åˆ›å»ºçš„è„šæœ¬è½¬æ¢ä¸ºAPIï¼Œä»¥é€šè¿‡æ™ºèƒ½æ‰‹æœºçš„å¯¼èˆªåº”ç”¨ç¨‹åºä»OverpassTurbo.euç½‘ç«™æŸ¥çœ‹äº¤äº’å¼åœ°å›¾ã€‚ 


 å†…å®¹ï¼š 


 1- ç®€ä»‹ã€‚ æ ‡å‡†æ …æ ¼å›¾ 
 2- ç»§ç»­ã€‚ ä¸ºçŸ¢é‡åœ°å›¾ç¼–å†™ä¸€ä¸ªç®€å•çš„å…‰æ …åŒ–å™¨ 
 3-ç‰¹ä¾‹ã€‚ æˆ‘ä»¬è¿æ¥äº†OverpassTurboå¡ 
 ä»€ä¹ˆæ˜¯ç«‹äº¤æ¡¥ï¼Ÿ 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æˆ‘ä»¬å°†åœ¨çº¿åœ°å›¾è¿æ¥åˆ°æ™ºèƒ½æ‰‹æœºä¸Šçš„å¯¼èˆªå™¨ã€‚ ç¬¬3éƒ¨åˆ†-å¤©æ¡¥æ¶¡è½®å¢å‹</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461073/"><p> æˆ‘ä»¬å°†å…ˆå‰åˆ›å»ºçš„è„šæœ¬è½¬æ¢ä¸ºAPIï¼Œä»¥é€šè¿‡æ™ºèƒ½æ‰‹æœºçš„å¯¼èˆªåº”ç”¨ç¨‹åºä»OverpassTurbo.euç½‘ç«™æŸ¥çœ‹äº¤äº’å¼åœ°å›¾ã€‚ </p><a name="habracut"></a><br><p> å†…å®¹ï¼š </p><br><p>  1- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç®€ä»‹ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ ‡å‡†æ …æ ¼å›¾</a> <br>  2- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»§ç»­ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸ºçŸ¢é‡åœ°å›¾ç¼–å†™ä¸€ä¸ªç®€å•çš„å…‰æ …åŒ–å™¨</a> <br>  3-ç‰¹ä¾‹ã€‚ æˆ‘ä»¬è¿æ¥äº†OverpassTurboå¡ </p><br><h3 id="chto-takoe-overpassturbo"> ä»€ä¹ˆæ˜¯ç«‹äº¤æ¡¥ï¼Ÿ </h3><br><p>è¿™æ ·å•Š æœ‰ä¸€ä¸ªåœ°å›¾æ•°æ®åº“ï¼Œä¾‹å¦‚OpenStreetMapsã€‚ å®ƒåŒ…å«äº†æ‰€æœ‰å†…å®¹ï¼šæµ·æ´‹ï¼Œå„å¤§æ´²çš„è½®å»“ï¼Œå±±è„‰ï¼Œæ£®æ—ï¼Œé“è·¯ï¼Œå»ºç­‘ç‰©ï¼Œæ¸¸ä¹åœºï¼Œç”šè‡³å‡é€Ÿå¸¦ã€‚ æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåç§°ï¼Œåæ ‡å’Œå±æ€§ã€‚ ä¾‹å¦‚ï¼Œé€šè¿‡é“è·¯-æ¶‚å±‚ææ–™ï¼Œé€šè¿‡å»ºç­‘ç‰©-æ¥¼å±‚æ•°ç­‰ã€‚ </p><br><p> æ‰€ä»¥åœ¨è¿™é‡Œã€‚ å½“ä»ŠInternetä¸Šæ˜¾ç¤ºçš„å¤§å¤šæ•°å¡éƒ½æ˜¯åŸºäºæ­¤ç‰¹å®šæ•°æ®åº“ç”Ÿæˆçš„ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‰€æœ‰è¿™äº›ç°æˆçš„å¡éƒ½ä¸é€‚åˆæˆ‘ä»¬æ€ä¹ˆåŠï¼Ÿ æ‚¨å¯ä»¥è‡ªå·±åšï¼ å¥½å§ï¼Œæˆ–è€…è‡³å°‘è¡¥å……ç°æœ‰çš„ï¼Œè¿™è¦å®¹æ˜“å¾—å¤šã€‚ </p><br><p> è¿™å°±æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">OverpassTurbo.eu</a>æ‰€åšçš„ã€‚ è¿™æ˜¯ä¸€ä¸ªåœ¨çº¿IDEã€‚ ä½¿ç”¨å®ƒï¼Œæ‚¨å¯ä»¥æŸ¥è¯¢OSMæ•°æ®åº“ã€‚ æˆ‘ä»¬å•å‡»<strong>å¼€å§‹</strong>æŒ‰é’®ï¼Œè¯·æ±‚è½¬åˆ°æ•°æ®åº“ï¼Œä¸€æ®µæ—¶é—´åæ•°æ®è¿”å›ç»™æˆ‘ä»¬ã€‚  OverpassTurboä»¥ä½äºèƒŒæ™¯å±‚é¡¶éƒ¨çš„çŸ¢é‡æ ‡è®°å’Œçº¿æ¡çš„å½¢å¼å¯è§†åŒ–æ­¤æ•°æ®-æ¥è‡ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">OpenSteerMap.org</a>çš„åœ°å›¾ã€‚ </p><br><p> ä½œä¸ºæ‚¨å¯ä»¥å¯¹OverpassTurboè¿›è¡Œæ“ä½œçš„ä¸€ä¸ªç¤ºä¾‹ï¼Œæˆ‘æƒ³å‘æ‚¨å±•ç¤ºæˆ‘æœ€å–œæ¬¢çš„è„šæœ¬ã€‚ å®ƒç”±ç”¨æˆ·ä»¥æ˜µç§°Erelenç¼–å†™ã€‚ å› æ­¤ï¼šæ­¤è„šæœ¬åœ¨åœ°å›¾ä¸Šç»˜åˆ¶äº†å„ç§é¥®ç”¨æ°´æ¥æºåŠå…¶åç§°ã€‚ æˆ‘è®¤ä¸ºè¿™éå¸¸æœ‰ç”¨è€Œä¸”éå¸¸æ¸…æ¥šã€‚ è¦æŸ¥çœ‹æ­¤è„šæœ¬çš„å·¥ä½œåŸç†ï¼Œåªéœ€ç‚¹å‡»é“¾æ¥ï¼Œç„¶åå•å‡»<strong>å¼€å§‹</strong> ã€‚  ï¼ˆå¦‚æœç«™ç‚¹æä¾›äº†é”™è¯¯ï¼Œè¯·é€šè¿‡VPNå¹¶é‡è¯•ï¼‰ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">https://overpass-turbo.eu/s/z95</a> </p><br><p><img src="https://habrastorage.org/webt/64/fa/g4/64fag4skex-vyoy75agsaqvt0_w.png"></p><br><p> æˆ–è€…è¿™æ˜¯æˆ‘å·²ç»ä¸ºæ»¡è¶³è‡ªå·±éœ€è¦è€Œç¼–å†™çš„è„šæœ¬ã€‚ æœ‰äº†å®ƒï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°åœ¨é™Œç”Ÿçš„å…¬å›­ä¸­æ‰¾åˆ°è‰¯å¥½çš„æ…¢è·‘è·¯çº¿ã€‚ ä¸ºæ­¤ï¼Œè„šæœ¬çªå‡ºæ˜¾ç¤ºäº†æ•´æ´çš„ç ¾çŸ³è·¯ï¼šæŒ‰ç…§æˆ‘çš„å£å‘³ï¼Œæ²¿ç€è¿™äº›è·¯æœ€æ–¹ä¾¿ã€‚ æ²¥é’æ ‡è®°ä¸ºç™½è‰²ã€‚ é»‘è‰²çš„æ™®é€šåœŸè·¯ã€‚ ä½†æ˜¯æ‰€æœ‰å¸¦æœ‰â€œéš¾ä»¥åˆ°è¾¾â€æˆ–â€œæ¶‚å±‚è´¨é‡å·®â€æ ‡ç­¾çš„è·¯å¾„éƒ½å°†ç”¨ä¸æ˜¾çœ¼çš„è™šçº¿æ ‡è®°ï¼šä¸ºäº†å‡å°‘ç»Šå€’çš„æ¬¡æ•°ï¼Œæˆ‘å°½é‡é¿å…ä½¿ç”¨å®ƒä»¬ã€‚ é€šå¸¸ï¼Œåˆ¶ä½œåœ°å›¾çš„ç›®çš„æ˜¯ä½¿æ‚¨å¯ä»¥æ²¿æœ€å¼•äººæ³¨ç›®çš„ç›´çº¿ç®€å•åœ°è·å–è·¯çº¿ã€‚ æœ€ç»ˆï¼Œè¿™æ¡è·¯çº¿æ˜¯æˆåŠŸçš„ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">http://overpass-turbo.eu/s/KXU</a> </p><br><p><img src="https://habrastorage.org/webt/gi/8n/pa/gi8npad8i2az-pu8q2x2gb7xziw.png"></p><br><p> å®é™…ä¸Šï¼Œä½¿ç”¨æ­¤å·¥å…·å¯ä»¥ä¸ºåœ°å›¾æ·»åŠ æ‰€éœ€çš„ä»»ä½•æ•°æ®ã€‚ è€Œä¸”ï¼Œæˆ‘æ³¨æ„åˆ°è¿™éå¸¸éå¸¸ä»¤äººå…´å¥‹ã€‚ ä½†æ˜¯è¿™ç¯‡æ–‡ç« ä¸æ˜¯å…³äºè¿™ä¸ªçš„ã€‚ å¦‚æœæ‚¨å¯¹æ­¤ä¸»é¢˜æ„Ÿå…´è¶£ï¼Œå¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">åœ¨æ­¤å¤„</a>ç†Ÿæ‚‰å¤©æ¡¥çš„åŸºç¡€çŸ¥è¯†ã€‚ </p><br><p> ä½†æ˜¯åœ¨ç»§ç»­ç¼–å†™ä»£ç ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬åº”è¯¥å¾—åˆ°çš„æœ€ç»ˆç»“æœã€‚ </p><br><h3 id="instrukciya-dlya-polzovateley-kak-polzovatsya-nashim-api"> ç”¨æˆ·è¯´æ˜ï¼šå¦‚ä½•ä½¿ç”¨æˆ‘ä»¬çš„API </h3><br><p> è¿™æ ·å•Š å‡è®¾æ‚¨å·²ç»æœ‰ä¸€ä¸ªé€‚ç”¨äºOverpassTurboçš„ç°æˆè„šæœ¬ï¼Œæ‚¨å¸Œæœ›åœ¨æ™ºèƒ½æ‰‹æœºä¸ŠæŸ¥çœ‹å…¶ç»“æœã€‚ è€Œä¸æ˜¯åœ¨æµè§ˆå™¨ä¸­ï¼Œè€Œæ˜¯åœ¨å¯¼èˆªå™¨ä¸­ã€‚ ä¸ºæ­¤ï¼Œè¯·å°†æ‚¨çš„è„šæœ¬è½¬æ¢ä¸ºä»¥ä¸‹æ ¼å¼ã€‚ </p><br><pre><code class="css hljs"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[bbox:{{bbox}}]</span></span>; ( //     <span class="hljs-selector-tag"><span class="hljs-selector-tag">node</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[amenity=waste_basket]</span></span>; ); <span class="hljs-selector-tag"><span class="hljs-selector-tag">out</span></span>;&gt;;<span class="hljs-selector-tag"><span class="hljs-selector-tag">out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">skel</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">qt</span></span>;</code> </pre> <br><p> ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬å¯¹ç¬¬ä¸€è¡Œæ„Ÿå…´è¶£ï¼šæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†æ›¿æ¢å®ƒã€‚ </p><br><p> ä¹‹åï¼Œå•å‡»â€œ <strong>å…±äº«â€</strong>æŒ‰é’®ã€‚ ç¡®ä¿å–æ¶ˆé€‰ä¸­<strong>æ˜¾ç¤ºåœ°å›¾</strong>çš„<strong>å¯ç”¨çŠ¶æ€</strong>æ¡†ã€‚ </p><br><p><img src="https://habrastorage.org/webt/vi/75/ug/vi75ughpyooqulnwtesjmeftlwk.png"></p><br><p> ä¹‹åï¼Œå¤åˆ¶é“¾æ¥ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å‡è®¾æ‚¨å¤åˆ¶çš„é“¾æ¥å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><p> <code>http://overpass-turbo.eu/s/KEy</code> </p> <br><p> ç°åœ¨çœ‹çœ‹æˆ‘ä»¬çš„API </p><br><p> <code>https://anygis.herokuapp.com/mapshoter/overpass/{x}/{y}/{z}/{crossZoom}?script={script}</code> </p> <br><p> ä½¿ç”¨<strong>{x}ï¼Œ{y}</strong>å’Œ<strong>{z}ï¼Œ</strong>ä¸€åˆ‡ä¼¼ä¹éƒ½å¾ˆæ¸…æ¥šï¼šè¿™äº›æ˜¯æ‰€éœ€å›¾å—çš„åæ ‡ã€‚ </p><br><p> æ‚¨éœ€è¦æ›¿æ¢è„šæœ¬<strong>ID</strong>æ¥ä»£æ›¿<strong>{script}</strong> ã€‚ åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œ <strong>s / Key</strong> ã€‚ </p><br><p> ä½†æ˜¯<strong>{crossZoom}æ˜¯</strong>ä»€ä¹ˆï¼Ÿ å‡è®¾æ‚¨æœ‰15ä¸ªã€‚ç„¶åï¼Œå¦‚æœæ‚¨è¯·æ±‚ç¼©æ”¾æ¯”ä¾‹å°äº15çš„å›¾å—ï¼ŒæœåŠ¡å™¨å°†ä¸ä¼šå¯¹OverpassTurboå‘å‡ºç¼“æ…¢çš„è¯·æ±‚ï¼Œè€Œåªæ˜¯å°†æ‚¨é‡å®šå‘åˆ°å…·æœ‰ç©ºOpenStreetMapsèƒŒæ™¯å±‚çš„åœ°å›¾ï¼ˆè¯¥å›¾å±‚å°†ç«‹å³åŠ è½½ï¼‰ã€‚ éœ€è¦è¿™ç§æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨å¿…è¦æ—¶å¯ä»¥å°†åœ°å›¾ç§»å¼€ï¼Œå¿«é€Ÿæ»šåŠ¨åˆ°æ„Ÿå…´è¶£çš„åœ°æ–¹ï¼Œæ”¾å¤§å¹¶ç­‰å¾…ã€‚ ç­‰åˆ°OverpassTurboç”ŸæˆåŒ…å«ç»“æœçš„åœ°å›¾ã€‚ </p><br><p> æˆ‘å¸Œæœ›åŸºæœ¬åŸåˆ™æ˜¯æ˜ç¡®çš„ã€‚ ç°åœ¨ï¼ŒæŸ¥çœ‹æˆ‘ä»¬çš„è¯·æ±‚çš„å®Œæ•´URLã€‚ æˆ‘è®¤ä¸ºç°åœ¨ä½¿ç”¨æˆ‘ä»¬çš„APIå¯¹æ‚¨æ¥è¯´å¹¶ä¸å›°éš¾ï¼šåªéœ€å°†<strong>S / KEy</strong>æ›¿æ¢<strong>ä¸º</strong>è„šæœ¬çš„<strong>ID</strong> ã€‚ </p><br><p> <code>https://anygis.herokuapp.com/mapshoter/overpass/{x}/{y}/{z}/15?script=s/KEy</code> </p> <br><p> åŒæ—¶ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•å®ç°è¿™æ ·çš„åº”ç”¨ç¨‹åºã€‚ </p><br><h3 id="scenariy-3--poisk-s-pomoschyu-url-i-kesha-brauzera"> æ–¹æ¡ˆ3-ä½¿ç”¨URLå’Œæµè§ˆå™¨ç¼“å­˜è¿›è¡Œæœç´¢ </h3><br><p> è¿™æ ·å•Š è®©æˆ‘ä»¬ä»<strong>router.js</strong>æ–‡ä»¶å¼€å§‹ã€‚ è®©æˆ‘ä»¬çš„æ–¹æ³•æ¥å—<strong>crossZoom</strong>å’Œ<strong>è„šæœ¬</strong>å‚æ•°ã€‚ ç„¶åæˆ‘ä»¬å°†å®ƒä»¬ä¼ é€’ç»™å·¥äººã€‚ æˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€ä¸ªé€‰é¡¹ï¼Œå¦‚æœè¯·æ±‚çš„ç¼©æ”¾æ¯”ä¾‹è¿‡ä½ï¼Œè¯¥é€‰é¡¹å°†ä¸­æ–­è„šæœ¬å¹¶å°†ç”¨æˆ·é‡å®šå‘åˆ°å¦ä¸€ä¸ªç«™ç‚¹ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>( <span class="hljs-string"><span class="hljs-string">'express'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PORT = process.env.PORT || <span class="hljs-number"><span class="hljs-number">5000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = express() app.listen( PORT, () =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log( <span class="hljs-string"><span class="hljs-string">'    '</span></span>, PORT ) }) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { StaticPool } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>( <span class="hljs-string"><span class="hljs-string">'node-worker-threads-pool'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> worker = <span class="hljs-string"><span class="hljs-string">"./worker.js"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> workersPool = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StaticPool({ <span class="hljs-attr"><span class="hljs-attr">size</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">task</span></span>: worker, <span class="hljs-attr"><span class="hljs-attr">workerData</span></span>: <span class="hljs-string"><span class="hljs-string">"no"</span></span> }) <span class="hljs-comment"><span class="hljs-comment">//     app.get( '/:x/:y/:z/:crossZoom', async ( req, res, next ) =&gt; { const x = req.params.x const y = req.params.y const z = req.params.z const crossZoom = req.params.crossZoom const scriptName = req.query.script //     if ( Number( z ) &lt; Number( crossZoom ) ) { res.redirect( `http://tile.openstreetmap.org/${z}/${x}/${y}.png` ) } //      const screenshot = await workersPool.exec( { x, y, z, scriptName } ) const imageBuffer = Buffer.from( screenshot, 'base64' ) res.writeHead( 200, { 'Content-Type': 'image/png', 'Content-Length': imageBuffer.length }) res.end( imageBuffer ) })</span></span></code> </pre><br><p>  <strong>worker.js</strong>æ–‡ä»¶æ²¡æœ‰å¤ªå¤§å˜åŒ–ã€‚ åªæ˜¯è¿›ä¸€æ­¥è½¬å‘æ–°å˜é‡ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { parentPort, workerData } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>( <span class="hljs-string"><span class="hljs-string">'worker_threads'</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> puppeteer = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>( <span class="hljs-string"><span class="hljs-string">'puppeteer'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mapshoter = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>( <span class="hljs-string"><span class="hljs-string">'./mapshoter'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> browser = <span class="hljs-string"><span class="hljs-string">"empty"</span></span> parentPort.on( <span class="hljs-string"><span class="hljs-string">"message"</span></span>, ( params ) =&gt; { doMyAsyncCode( params ) .then( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> result </span></span></span><span class="hljs-function">) =&gt;</span></span> { parentPort.postMessage( result ) }) }) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doMyAsyncCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> params </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> prepareEnviroment() <span class="hljs-comment"><span class="hljs-comment">//   const screenshot = await mapshoter.makeTile( params.x, params.y, params.z, params.scriptName, browser ) return screenshot } async function prepareEnviroment( ) { if ( browser === "empty" ) { const herokuDeploymentParams = {'args' : ['--no-sandbox', '--disable-setuid-sandbox']} browser = await puppeteer.launch( herokuDeploymentParams ) } }</span></span></code> </pre> <br><p> ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<strong>mapshoter.js</strong> ã€‚ é¦–å…ˆï¼Œçœ‹ä¸€ä¸‹ä»£ç ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> puppeteer = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>( <span class="hljs-string"><span class="hljs-string">'puppeteer'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> geoTools = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>( <span class="hljs-string"><span class="hljs-string">'./geoTools'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeTile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> x, y, z, scriptName, browserLink </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      const runButtonSelector = '#navs &gt; div &gt; div.buttons &gt; div:nth-child(1) &gt; a:nth-child(1)' const codeEditorSelector = '#editor &gt; div.CodeMirror.CodeMirror-wrap &gt; div:nth-child(1) &gt; textarea' //          const coordinates = geoTools.getAllCoordinates( x, y, z ) const bBox = `[bbox:${coordinates.bBox.latMin}, ${coordinates.bBox.lonMin}, ${coordinates.bBox.latMax}, ${coordinates.bBox.lonMax}];` const centerCoordinates = `${coordinates.center.lat};${coordinates.center.lon};${z}` //      const browser = await browserLink const page = await browser.newPage() await page.setViewport( { width: 850, height: 450 } ) //  ,   : //      await page.waitFor( randomInt( 0, 500 ) ) //        URL var pageUrl = `http://overpass-turbo.eu/?C=${centerCoordinates}` await page.goto( pageUrl, { waitUntil: 'networkidle2', timeout: 10000 } ) //       URL pageUrl = 'http://overpass-turbo.eu/' + scriptName await page.goto( pageUrl, { waitUntil: 'networkidle0', timeout: 20000 } ) //      await page.focus( codeEditorSelector ) //        , //     await page.keyboard.type( bBox + ' //' ) // ,  -IDE   await page.waitFor( 100 ) //     - await page.click( runButtonSelector ) // ,      . //     . await page.waitForFunction(() =&gt; !document.querySelector('body &gt; div.modal &gt; div &gt; ul &gt; li:nth-child(1)'), {polling: 'mutation'}); await page.waitFor( 1000 ) //    const cropOptions = { fullPage: false, clip: { x: 489, y: 123, width: 256, height: 256 } } const screenshot = await page.screenshot( cropOptions ) //   await page.close() return screenshot } //       function randomInt( low, high ) { return Math.floor( Math.random() * ( high - low ) + low ) } module.exports.makeTile = makeTile</span></span></code> </pre> <br><p> é¦–å…ˆï¼Œå‡ºäºå¤šæ ·æ€§è€ƒè™‘ï¼Œåœ¨æ­¤è„šæœ¬ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ™®é€šçš„å…ƒç´ é€‰æ‹©å™¨ï¼ˆä¸æ˜¯<strong>XPath</strong> ï¼‰ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸Šä¸€ç¯‡æ–‡ç« ä¸­</a>ä»‹ç»äº†å¦‚ä½•æ‰¾åˆ°å®ƒä»¬ã€‚ </p><br><p> æ¥ä¸‹æ¥æˆ‘ä»¬å¾—åˆ°åæ ‡ã€‚ ä»…è¿™æ¬¡ï¼Œé™¤äº†ä¸­å¿ƒåæ ‡å¤–ï¼Œè¿˜éœ€è¦<strong>å¹³é“º</strong>è¾¹æ¡†ï¼ˆ <strong>bBox</strong> ï¼‰çš„åæ ‡ã€‚ </p><br><p> æ¥ä¸‹æ¥ï¼Œå¯åŠ¨æµè§ˆå™¨ã€‚ è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆå…¸å‹ã€‚ ä½†æ˜¯åœ¨ç»§ç»­åŠ è½½é¡µé¢ä¹‹å‰ï¼Œè®©è„šæœ¬ç­‰å¾…0åˆ°500æ¯«ç§’çš„éšæœºæ—¶é—´ã€‚ è¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šåŒæ—¶æ”¶åˆ°å¤ªå¤šç›¸åŒçš„è¯·æ±‚ï¼Œå› æ­¤æˆ‘ä»¬ä¸ä¼šè¢«ç¦æ­¢ã€‚ </p><br><p> ä¹‹åï¼Œæˆ‘ä»¬è½¬åˆ°æ·»åŠ äº†ç£è´´ä¸­å¿ƒåæ ‡çš„URLæ‰€åœ¨çš„ç«™ç‚¹ã€‚ ç»“æœï¼ŒæœŸæœ›çš„ä½ç½®åœ¨åœ°å›¾çš„ä¸­å¿ƒã€‚ </p><br><p> ä¹‹åï¼Œè½¬åˆ°å¦ä¸€ä¸ªURLã€‚ è¿™æ¬¡<strong>æ˜¯</strong>æˆ‘ä»¬è„šæœ¬çš„<strong>ID</strong> ã€‚ ç»“æœï¼Œæˆ‘ä»¬çš„è„šæœ¬å°†å‡ºç°åœ¨ä»£ç ç¼–è¾‘å™¨çš„æ–‡æœ¬ä¸­ã€‚ </p><br><p>  ï¼ˆè¯·æ³¨æ„ï¼Œå¦‚æœåœ¨â€œ <strong>å…±äº«â€</strong>èœå•ä¸­å¤åˆ¶è„šæœ¬çš„URLæ—¶ï¼Œæˆ‘ä»¬ä¸ä¼šå–æ¶ˆé€‰ä¸­â€œ <strong>ä¿å­˜åœ°å›¾çš„çŠ¶æ€â€</strong>å¤é€‰æ¡†ï¼Œåˆ™åœ°å›¾ä¼šç§»åŠ¨ã€‚æˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦å®ƒï¼‰ </p><br><p> ç°åœ¨ï¼Œæˆ‘å°†å¯¹è¿™ä¸ªé—®é¢˜åšå‡ºåˆç†çš„å›ç­”ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä¸¤æ¬¡è®¿é—®è¯¥URLï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨åŠ è½½è¯¥ç½‘ç«™ä¸ŠèŠ±è´¹äº†ä¸¤æ¬¡ï¼Ÿ æˆ‘å›ç­”ã€‚ å› ä¸ºï¼Œé¦–å…ˆï¼Œæˆ‘æ‰¾ä¸åˆ°å¦‚ä½•åœ¨ä¸€ä¸ªURLè¯·æ±‚ä¸­ç»“åˆè„šæœ¬åŠ è½½å’Œè½¬æ¢åˆ°æŒ‡å®šåæ ‡çš„æ–¹æ³•ã€‚ å…¶æ¬¡ï¼Œç”±äºæŸç§åŸå› ï¼ŒPuppeteeræ‰“å°æ–‡æœ¬çš„é€Ÿåº¦éå¸¸æ…¢ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨è¯¥ç«™ç‚¹ä¸Šçš„ç•Œé¢å…ƒç´ ã€‚ ä¸€åˆ†åŠé’Ÿå³å¯æ‰“å°ï¼ å› æ­¤ï¼Œå°±åƒåœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­æ‰€åšçš„é‚£æ ·ï¼Œå°†åæ ‡æ’å…¥æœç´¢å­—æ®µä¸­ï¼Œç„¶åå•å‡»ç¼©æ”¾æŒ‰é’®çš„æƒ³æ³•è¢«å†³å®šæ‹’ç»ã€‚ ç»“æœï¼ŒåŒå‡»é“¾æ¥æ¯”å®Œæˆæ‰€æœ‰æ“ä½œè¦å¿«å¾—å¤šã€‚ ä¹Ÿè®¸è¿™æ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œè¿Ÿæ—©ä¼šå¾—åˆ°è§£å†³ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨å®ƒã€‚ </p><br><p>  lasï¼Œæ‚¨å°†æ— æ³•å®Œå…¨ç¦»å¼€æ–‡æœ¬è¾“å…¥ã€‚ æˆ‘ä»¬å°†ä¸å¾—ä¸æ›¿æ¢ä»£ç ç¼–è¾‘å™¨çª—å£ä¸­çš„ç¬¬ä¸€è¡Œã€‚ ç›®å‰ï¼Œå¥¹æŠ¥å‘Šè¯´æœ‰å¿…è¦ä»æ•°æ®åº“ä¸‹è½½å½“å‰å±å¹•ä¸Šæ•´ä¸ªé¢†åœŸçš„ä¿¡æ¯ã€‚ </p><br><pre> <code class="javascript hljs">[bbox:{{bbox}}];</code> </pre> <br><p> æˆ‘ä»¬å°†å…¶æ›¿æ¢ä¸ºå›¾å—è¾¹æ¡†çš„åæ ‡ã€‚ è¿™æ˜¯ä¸ºäº†é¿å…æµªè´¹å¤ªå¤šæ—¶é—´ä»æ•°æ®åº“ä¸‹è½½ã€‚ å› æ­¤ï¼Œè„šæœ¬åœ¨ç¬¬ä¸€è¡Œä¸­æ˜¾ç¤ºçš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="javascript hljs">[bbox:<span class="hljs-number"><span class="hljs-number">55.6279</span></span>, <span class="hljs-number"><span class="hljs-number">37.5622</span></span>, <span class="hljs-number"><span class="hljs-number">55.6341</span></span>, <span class="hljs-number"><span class="hljs-number">37.5732</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//</span></span></code> </pre> <br><p> ä¸ºäº†ä¸å¿…åˆ é™¤åŸå§‹è¡Œï¼ˆå¤šæ¬¡ä¸ºæ­¤ç¼“æ…¢åœ°æŒ‰<strong>Deleteé”®</strong> ï¼‰ï¼Œæˆ‘ä»¬åªéœ€å¯¹å…¶è¿›è¡Œæ³¨é‡Šå³å¯ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†å°½å¯èƒ½å‡å°‘è¾“å…¥æ–‡æœ¬æ‰€èŠ±è´¹çš„æ—¶é—´ä»¥åŠä»æ•°æ®åº“ä¸­åŠ è½½çš„æ—¶é—´ã€‚ ç»“æœï¼Œç¬¬ä¸€è¡Œå°†å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="javascript hljs">[bbox:<span class="hljs-number"><span class="hljs-number">55.6279</span></span>, <span class="hljs-number"><span class="hljs-number">37.5622</span></span>, <span class="hljs-number"><span class="hljs-number">55.6341</span></span>, <span class="hljs-number"><span class="hljs-number">37.5732</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//[bbox:{{bbox}}];</span></span></code> </pre> <br><p> ä¹‹åï¼Œæˆ‘ä»¬çš„è„šæœ¬å¿…é¡»å•å‡»â€œ <strong>å¼€å§‹â€</strong>æŒ‰é’®ï¼Œç¨ç­‰ç‰‡åˆ»ï¼Œè·å–åœ°å›¾çš„å±å¹•æˆªå›¾å¹¶å°†å…¶å‘é€ç»™ç”¨æˆ·ã€‚ æ‰€æœ‰ï¼šä»»åŠ¡å·²å®Œæˆï¼ </p><br><p> å¦‚æœè¦æŸ¥çœ‹ç”Ÿæˆçš„è„šæœ¬çš„ç¤ºä¾‹ï¼Œå¯ä»¥å•å‡»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ­¤é“¾æ¥</a> ã€‚ </p><br><h3 id="zaklyuchenie"> ç»“è®º </h3><br><p> å¥½å§ï¼Œç”±äºä¸éš¾å‡è®¾ï¼Œæ­¤ç‰ˆæœ¬çš„è„šæœ¬å°†æ¯”ä»¥å‰çš„ç‰ˆæœ¬è¿è¡Œå¾—æ›´æ…¢ã€‚ æ¯•ç«Ÿï¼Œç°åœ¨è¯¥ç½‘ç«™å°†æ—¶é—´èŠ±è´¹åœ¨ç¬¬ä¸‰æ–¹æ•°æ®åº“çš„è¯·æ±‚ä¸Šã€‚ å°±å…¶æœ¬èº«è€Œè¨€ï¼Œå®ƒå¹¶ä¸èƒ½å¤ªå¿«åœ°å·¥ä½œã€‚ ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•éå¸¸å®¹æ˜“ï¼ˆå°½ç®¡å¾ˆæ…¢ï¼‰æ¥è·å¾—å”¯ä¸€çš„ï¼Œå®šåˆ¶çš„å¡ç‰‡ã€‚ è€Œä¸”ï¼ŒåŸºäºæœ€æ–°æ•°æ®ã€‚ æœ‰æ—¶è¿™å¯èƒ½éå¸¸æœ‰ç”¨ã€‚ å› æ­¤ï¼Œå€¼å¾—è®°ä½è¿™ç§æ–¹æ³•ã€‚ </p><br><p> ä»…æ­¤è€Œå·²ã€‚ ä¸ºäº†ä»¥é˜²ä¸‡ä¸€ï¼Œæˆ‘æé†’æ‚¨ï¼Œæˆ‘çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">AnyGIS</a>ç½‘ç«™ä¸Š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æœ‰ä¸€ä¸ª</a>é’ˆå¯¹è½¨è¿¹ï¼ŒOsmAndå’ŒGuruMapså¯¼èˆªå™¨çš„ç°æˆé¢„ç½®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">çš„</a>å­˜æ¡£ã€‚ æœ‰æ …æ ¼åœ°å›¾å’Œâ€œæ …æ ¼åŒ–â€çŸ¢é‡åœ°å›¾ï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›æ–‡ç« ä¸­æè¿°çš„åº”ç”¨ç¨‹åºè¿›è¡ŒæŸ¥çœ‹ã€‚ å¿«æ¥ä½¿ç”¨ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN461073/">https://habr.com/ru/post/zh-CN461073/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN461061/index.html">é•åˆé‡‘ï¼ŒåŒæ™¶ç•Œå’Œåæ</a></li>
<li><a href="../zh-CN461063/index.html">Rä¸Microsoft SQL Serverå’Œå…¶ä»–DBMSä¸Šçš„æ•°æ®åº“çš„äº¤äº’</a></li>
<li><a href="../zh-CN461067/index.html">æ‚¨åº”è¯¥åœ¨2019å¹´å‡†å¤‡çš„å·¥ä½œé¢è¯•ä¸­çš„å‰65ä¸ªSQLé—®é¢˜ã€‚ ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN461069/index.html">è¯ºè´å°”æˆ·å¤–IPæ‘„åƒæœºï¼šIvideonè§†é¢‘ç›‘æ§ç³»ç»Ÿçš„æµ‹è¯•ï¼ŒæŠ€æœ¯å’ŒåŠŸèƒ½</a></li>
<li><a href="../zh-CN461071/index.html">é’ˆå¯¹å»ºç­‘å•†çš„B2BæœåŠ¡ç¤ºä¾‹ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢</a></li>
<li><a href="../zh-CN461075/index.html">å•†ä¸šæ™ºèƒ½ã€‚ ITå¯¹è±¡ï¼Œç»„ä»¶ï¼Œå·¥å…·</a></li>
<li><a href="../zh-CN461077/index.html">æ¸—é€æµ‹è¯•è€…å¦‚ä½•çƒ¹é¥ªï¼Ÿ æ•°å­—å®‰å…¨å®ä¹ ç”Ÿçš„å…¥å­¦æµ‹è¯•</a></li>
<li><a href="../zh-CN461079/index.html">æ²¡æœ‰äº¤é€šæ‹¥å µçš„åŸå¸‚</a></li>
<li><a href="../zh-CN461081/index.html">æ¸¡æ¸¡é¸Ÿåœæ³Šçš„é‚£ä¸€å¤©ã€‚ å¼‚æ­¥è„šæœ¬</a></li>
<li><a href="../zh-CN461083/index.html">ç¼–å†™å…·æœ‰å®¢æˆ·ç«¯æœåŠ¡å™¨å®ç”¨ç¨‹åºWindowsåŠŸèƒ½çš„è½¯ä»¶ï¼Œç¬¬02éƒ¨åˆ†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>