<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧢 👩‍🔬 👋🏿 如何交朋友通过Docker编译的PHPstorm，xDebug和远程分支？ 太简单了... 🙏 👩🏾‍🤝‍👨🏿 🙅🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="美好的一天，哈伯！ 

 一年前，我在PHP中调试代码的过程包括两行： 



var_dump($variable); die();  
 当然，我有时会不得不使用更多的“复杂”结构： 



 console.log(data); 


 echo json_encode($variable, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>如何交朋友通过Docker编译的PHPstorm，xDebug和远程分支？ 太简单了...</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423337/"> 美好的一天，哈伯！ <br><br> 一年前，我在PHP中调试代码的过程包括两行： <br><br><pre><code class="php hljs">var_dump($variable); <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>();</code> </pre> <br> 当然，我有时会不得不使用更多的“复杂”结构： <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(data);</code> </pre><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($variable, JSON_UNESCAPED_UNICODE); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>();</code> </pre> <br> 不，你是什么！ 我知道-在我们这个时代，文化程序员不适合这样做 <br><br><div class="spoiler">  <b class="spoiler_title">古代工艺</b> <div class="spoiler_text"> 关于另一种古老工艺的玩笑 <br></div></div><br> 但老实说，我总是害怕自己不了解的东西。 包括xDebug <s>打印机</s> ，尤其是如何配置整个设备。 有一天，我设法在汽车上和一个本地项目中做到了–欢乐无止境。 几个月后，我遇到了一个新问题，如果该项目是由docker通过CI远程构建的，那么如何通过xDebug在PHPstorm中进行调试。 <br><br> 如果您像我一样，在配置其他内容方面遇到困难，欢迎来到猫这里，我将讲讲我在使用诸如Docker，xDebug，CI之类的令人恐惧的词来设置调试环境方面的经验。 <br><a name="habracut"></a><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">对于那些不喜欢水并且想直接进入环境本质的人。</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><br></a> <br><h3> 为什么要摆脱发霉的调试方法并转向使用适当的技术？ </h3><br> 我欺骗了那只猫，从事手工调试，这不仅是因为我害怕配置某些东西，不是因为它太笨，而是因为我不需要更方便的东西。 大多数时候，我在功能强大的计算机上本地处理项目，而且任务并不那么复杂，因此调试过程开始占据相当重要的位置。 <br><br> 在某个时候，我自己意识到自己不舒服，并在进行本地项目时尝试结识xDebug和PHPstorm。 麻烦的是，我发现的大多数文档和指南都暗示阅读本书的人员精通主题领域并且理解所有内容，在我的情况下并非如此，我在第一个xDebug设置上花费了4-5下午2点。 这在道德上是很难的，我感到无聊。 然而，事实证明可以配置，一切正常！ <br><br> 是的，它变得更方便，无论是在本地还是在家里，但是在主要工作中，我都是远程完成站点的操作，而且大多数情况下，由于机器性能低下或部署过程不便，我无法在本地卸载站点，或者由于以下原因而影响服务器设置：因此，托管可以进行“实时”的编辑和调试，以进行html注释的print_r（在该工作中它是“正常的”，尽管对此经验并不感到骄傲）。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffd/cd1/3af/ffdcd13af6a976ca99ff2f26976458e9.jpg" alt="图片"><br><br> 但是，三个月前，我搬到一家凉爽的公司，开始从事一个非常认真的高负荷项目。 这对我来说已经发生了很多变化。 基础结构和开发过程大致如下：有一个GitLab服务器，每个项目都有其自己的存储库，任务来到Jira，您通过任务编号创建分支，使用CI创建分支时，自动创建您自己的沙箱以及您安静地工作的站点，每次推送重新组装分支，在您完成对代码审查的工作之后，将分支倒入master。 <br><br> 除了一个BUT之外，其他一切都很酷，就我而言，每个分支重建一个大约需要10秒钟。 在开发本身的过程中，这是一个微不足道的时间，因为由于不确定性和很少的经验，我已经过了必须检查几乎每行代码的可操作性的阶段。 但是，当我切换到调试时，这10秒钟开始发挥实际作用。 这种调试的过程如下所示： <br><br><ul><li> 加2行 </li><li>  Pushu提交 </li><li> 我等十秒钟 </li><li> 检查，看看有什么问题 </li><li> 重覆 </li></ul><br> 根据粗略的估计，一个可合并的分支大约有20％的有用提交和80％的调试提交。 假设我用300次提交完成了一个分支的工作，其中240次提交实际上只消耗了我40分钟的工作时间（而这仅仅是分支装配的等待时间，没有考虑加起来的分钟数，即添加2行）然后删除它们）。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b9a/810/70f/b9a81070f5d6091988cee3ff3ac88463.png" alt="图片"><br><br> 在某种程度上，我对此感到厌倦，因此决定配置xDebug以使调试过程的成本降低。 不幸的是，我目前的同事们没有使用这种技术（我在等一个“我有一家很酷的公司，没人使用xDebug”的笑话），或者他们不知道/不记得在分支机构如何与xDebug IDE交朋友通过CI进行远程操作，并且由于我从没有devOps，并且如上所述，所以设置过程对我来说是一个痛苦的过程，它花费了大约6个小时的纯时间，因此最终它起作用了，并且我理解了该过程，这样就足够方便了。 <br><a name="process"></a><br><h3> 设定程序 </h3><br> 通常，我不会详细介绍如何固定CI，Docker，以及如何组装基础架构，假定已完成所有工作，剩下的一切只是建立您的个人环境。 <br><br> 假设我们的存储库具有以下结构： <br><br><img src="https://habrastorage.org/getpro/habr/post_images/56d/3ea/285/56d3ea285e90fed97ea116ac79715381.jpg" alt="图片"><br><br> 首先，我们需要检查xDebug本身是否在当前映像中，为此，您可以使用<b>phpinfo（）;</b> <br><br> 如果xDebug已包含在程序集中-很好，如果没有，请查看<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此源</a> ，它直接对设置本身有帮助，但是，我采取了一些不同的方法。 <br><br><h4> 配置php.ini </h4><br> 为了最终一切正常，两个xDebug设置对我们很重要： <br><br><ul><li>  xdebug.remote_enable </li><li>  xdebug.remote_host </li></ul><br> 在远程分支的最终组装中，必须启用<b>remote_enable</b> ，并且必须在<b>remote_host</b>中分配计算机在网络上的IP。 让我们在构建中包括这些设置。 <br><br> 首先，您需要找出php设置的存储位置，它们可以位于<b>/usr/local/etc/php/conf.d/php.ini中</b> ，或者.ini文件本身的名称可以不同，在我的情况下为<b>/ usr / local /等/ php / conf.d / php-settings.ini</b> 。 您可以从所收集图像的设置中查找。 <br><br> 我们通过相同的php-settings.ini文件在分支中创建其他设置，并将其放置在<b>./build_env/php/php-settings.ini中</b> <br> 我们在上面的设置中写入2个： <br> <code>xdebug.remote_enable = on <br> xdebug.remote_host = IP...</code> <br> <br> 接下来，我们需要将此文件添加到“父”图像设置中。 我通过将行添加到./build_env/docker-compose/docker-compose.tmpl中来完成此操作： <br> <code>- ${PROJECT_DIR}/build_env/php/php-settings.ini:/usr/local/etc/php/conf.d/php-settings.ini</code> <br> <br> 这是docker-compose.tmpl在我的项目中的样子： <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a9/dfc/03d/6a9dfc03d0adf60127a3c03ede9b0f3e.jpg" alt="图片"><br><br> 下次构建分支时，可以检查是否通过相同的<b>phpinfo（）</b>绑定了新设置<b>；</b> 如果是的话-非常好，如果不是-您不走运，您将不得不像我第一次做的那样:( <br><br><h4> 在PHPstorm中自定义映射 </h4><br> 接下来，您需要配置PHPstorm本身。 我决定不使用DBgp代理，以免每次都不在弹出窗口中配置映射。 就我而言，我使用的服务器模板将包含必要的映射。 <br><br> 转到<b>设置/首选项|</b>  <b>语言和框架|</b>  <b>Php |</b>  <b>伺服器</b> <br><br><ol><li> 创建服务器模板 </li><li> 姓名：BRANCH </li><li> 主持人：任何，不影响 </li><li> 端口：任何，不影响 </li><li> 调试器：xDebug </li><li> 放任使用路径映射 </li><li> 我们放下适当的映射，工作的本地文件夹应与收集的分支所在的服务器上的文件夹相对应，在我的情况下，收集的内部版本位于/ var / www / builds / your_namespace / your_project / your_branch文件夹中 </li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/c0b/fb9/268/c0bfb9268a256e387f3464e7ce100cc0.jpg" alt="图片"><br><br> 我们保存这些设置，每次使用新分支时都将对其进行更改。 例如，如果今天我使用web-2233分支，则将映射更改为<b>/ var / www / builds / build_path / web-2233</b> <br><br><h4> 添加一个新的环境变量，以便IDE自动提取映射 </h4><br> 现在是一个很重要但不是最明显的观点。 当我们开始调试时，PHPstorm需要了解哪些本地文件与远程服务器上的文件相对应。 如果服务器未进行特定安装，则会显示一个弹出窗口，您需要在其中手动映射路径。 为了使PHPstorm立即从名称为BRANCH的服务器获取映射，您需要将<b>PHP_IDE_CONFIG</b>环境变量添加到我们的程序<b>集中</b> <br><br> 在<b>./build_env/docker-compose/docker-compose.tmpl</b>中，在环境中创建一个新的环境变量： <br> <code>PHP_IDE_CONFIG: ${PHP_IDE_CONFIG}</code> <br> <br><img src="https://habrastorage.org/getpro/habr/post_images/793/5d1/274/7935d1274fadf298d10e57a2b6d6aba8.jpg" alt="图片"><br><br> 在<b>.gitlab-ci.yml中，我们</b>设置以下变量： <br> <code>- export PHP_IDE_CONFIG="serverName=BRANCH"</code> <br> <br><img src="https://habrastorage.org/getpro/habr/post_images/336/529/676/336529676de2d579e86a5820e02f06dc.jpg" alt="图片"><br><br><h4> 做完了！ </h4><br> 我们不需要浏览器扩展，不需要传递URL XDEBUG_SESSION_START = IDE_KEY来获取参数，我们不需要添加其他配置。 <br><br> 只需打开窃听 <img src="https://habrastorage.org/getpro/habr/post_images/f5f/cb7/dbd/f5fcb7dbd0b27a12b5be3ce65f1e9936.jpg" alt="图片"> 并刷新站点页面，当我们偶然发现第一个断点时，应用程序将在其上停止 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/457/99c/352/45799c352fe12908ae598f93d1271aeb.jpg" alt="图片"><br><br> 谢谢您的关注，我希望本文对您有所帮助，并且有人会节省时间，而又不会像我一样踩ke :) <br><br> 我在初始设置期间使用的来源： <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://gist.github.com/chadrien/c90927ec2d160ffea9c4</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://confluence.jetbrains.com/display/PhpStorm/Docker+Support+in+PhpStorm#DockerSupportinPhpStorm-调试在Docker容器中运行的PHP Web应用程序</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN423337/">https://habr.com/ru/post/zh-CN423337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN423319/index.html">Vivaldi代码集成。 我们的开发人员告诉</a></li>
<li><a href="../zh-CN423321/index.html">保护GitHub存储库免受恶意提交</a></li>
<li><a href="../zh-CN423323/index.html">“您需要变得懒惰才能成为一名优秀的测试人员。”</a></li>
<li><a href="../zh-CN423329/index.html">准备接受五大公司的采访</a></li>
<li><a href="../zh-CN423335/index.html">如何以每月60万卢布的价格击败Y.Direct和AdWords中的点击</a></li>
<li><a href="../zh-CN423339/index.html">Windows 98下是否有生命，第一部分-关于硬件</a></li>
<li><a href="../zh-CN423341/index.html">在公众压力下，索尼承认巴赫的作品不属于她。</a></li>
<li><a href="../zh-CN423343/index.html">用塑料制成的文化价值开始衰退</a></li>
<li><a href="../zh-CN423345/index.html">恐惧的绞索</a></li>
<li><a href="../zh-CN423347/index.html">我的钱花花公子在哪里：设计和Steam捆绑包，本地化和分销商</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>