<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ½â€ğŸ”¬ ğŸ‘  ğŸ‘©ğŸ½â€âš•ï¸ Panduan Discovery.js: Mulai Cepat ğŸ‘… ğŸ‘©â€ğŸŒ¾ ğŸ‘©ğŸ»â€ğŸ¤â€ğŸ‘¨ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Panduan ini dan panduan berikut akan memandu Anda melalui proses membuat solusi berdasarkan proyek Discovery.js . Tujuan kami adalah membuat inspektur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Panduan Discovery.js: Mulai Cepat</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/469115/"><p> Panduan ini dan panduan berikut akan memandu Anda melalui proses membuat solusi berdasarkan proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Discovery.js</a> .  Tujuan kami adalah membuat inspektur untuk dependensi NPM, yaitu antarmuka untuk memeriksa struktur <code>node_modules</code> . </p><br><p><img src="https://habrastorage.org/webt/ih/d_/sc/ihd_schofzsmx1xbptuvltrxmu8.png"></p><br><blockquote>  Catatan: Discovery.js berada pada tahap awal pengembangan, jadi seiring waktu, sesuatu akan menyederhanakan dan menjadi lebih bermanfaat.  Jika Anda memiliki ide tentang cara meningkatkan sesuatu, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tulis kepada kami</a> . </blockquote><br><h2 id="annotaciya">  Anotasi </h2><br><p>  Di bawah ini Anda akan menemukan gambaran umum konsep-konsep kunci dari Discovery.js.  Anda dapat mempelajari seluruh kode manual <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dalam repositori di GitHub</a> , atau Anda dapat mencoba <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">cara kerjanya secara online</a> . </p><a name="habracut"></a><br><h2 id="nachalnye-usloviya">  Kondisi awal </h2><br><p>  Pertama-tama, kita perlu memilih proyek untuk dianalisis.  Ini bisa berupa proyek yang baru dibuat atau yang sudah ada, yang utamanya adalah berisi <code>node_modules</code> (objek analisis kami). </p><br><p>  Pertama, instal paket inti <code>discoveryjs</code> dan alat konsolnya: </p><br><pre> <code class="bash hljs">npm install @discoveryjs/discovery @discoveryjs/cli</code> </pre> <br><p>  Selanjutnya, luncurkan server Discovery.js: </p><br><pre> <code class="plaintext hljs">&gt; npx discovery No config is used Models are not defined (model free mode is enabled) Init common routes ... OK Server listen on http://localhost:8123</code> </pre> <br><p>  Jika Anda membuka <code>http://localhost:8123</code> di browser, Anda dapat melihat yang berikut: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4e6/fc9/228/4e6fc922872955e6a2f3355e2856b3d1.png" alt="Penemuan tanpa konfigurasi"></p><br><p>  Ini adalah mode tanpa model, yaitu mode ketika tidak ada yang dikonfigurasi.  Tetapi sekarang, dengan menggunakan tombol "Muat data", Anda dapat memilih file JSON apa saja, atau cukup seret ke halaman dan mulai analisis. </p><br><p>  Namun, kami membutuhkan sesuatu yang spesifik.  Secara khusus, kita perlu melihat struktur <code>node_modules</code> .  Untuk melakukan ini, tambahkan konfigurasi. </p><br><h2 id="dobavlyaem-konfiguraciyu">  Tambahkan konfigurasi </h2><br><p>  Seperti yang mungkin Anda perhatikan, pesan <code>No config is used</code> ditampilkan ketika server mulai.  Mari kita membuat file konfigurasi <code>.discoveryrc.js</code> dengan konten berikut: </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Node modules structure'</span></span>, data() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">hello</span></span>: <span class="hljs-string"><span class="hljs-string">'world'</span></span> }; } };</code> </pre> <br><p>  Catatan: jika Anda membuat file di direktori kerja saat ini (yaitu, di root proyek), maka tidak ada lagi yang diperlukan.  Jika tidak, Anda perlu meneruskan path ke file konfigurasi menggunakan opsi <code>--config</code> , atau mengatur path di <code>package.json</code> : </p><br><pre> <code class="json hljs">{ ... <span class="hljs-attr"><span class="hljs-attr">"discovery"</span></span>: <span class="hljs-string"><span class="hljs-string">"path/to/discovery/config.js"</span></span>, ... }</code> </pre> <br><p>  Mulai ulang server sehingga konfigurasi diterapkan: </p><br><pre> <code class="plaintext hljs">&gt; npx discovery Load config from .discoveryrc.js Init single model default Define default routes ... OK Cache: DISABLED Init common routes ... OK Server listen on http://localhost:8123</code> </pre> <br><p>  Seperti yang Anda lihat, sekarang file yang kami buat digunakan.  Dan model default yang dijelaskan oleh kami diterapkan (Discovery dapat bekerja dalam mode banyak model, kami akan berbicara tentang fitur ini dalam manual berikut).  Mari kita lihat apa yang telah berubah di browser: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/16f/f45/ac8/16ff45ac8eef467b6ccd0ff5624c9652.png" alt="Dengan konfigurasi dasar"></p><br><p>  Apa yang bisa dilihat di sini: </p><br><ul><li>  <code>name</code> digunakan sebagai judul halaman; </li><li>  hasil pemanggilan metode <code>data</code> ditampilkan sebagai konten utama halaman. </li></ul><br><blockquote>  Catatan: metode <code>data</code> harus mengembalikan data atau Janji, yang memutuskan untuk data. </blockquote><p>  Pengaturan dasar dibuat, Anda dapat melanjutkan. </p><br><h2 id="kontekst">  Konteks </h2><br><p>  Mari kita lihat halaman laporan khusus (klik <code>Make report</code> ): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/def/52b/57a/def52b57a6be174730f07fe55273517a.png" alt="Halaman laporan"></p><br><p>  Pada pandangan pertama, ini tidak jauh berbeda dari halaman awal ... Tetapi di sini Anda dapat mengubah segalanya!  Misalnya, kami dapat dengan mudah membuat ulang tampilan halaman awal: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c6c/919/de1/c6c919de17d2fed5bdb0501fe1ff9dae.png" alt="Rekreasi halaman awal"></p><br><p>  Perhatikan bagaimana tajuk didefinisikan: <code>"h1:#.name"</code> .  Ini adalah tajuk tingkat pertama dengan isi <code>#.name</code> , yang merupakan permintaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Jora</a> .  <code>#</code> mengacu pada konteks permintaan.  Untuk melihat isinya, cukup masukkan <code>#</code> di editor kueri dan gunakan tampilan default: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/524/7a6/2cc/5247a62cc6194ab9bd4797c21ab084b9.png" alt="Nilai konteks"></p><br><p>  Sekarang Anda tahu cara mendapatkan ID halaman saat ini, parameternya, dan nilai berguna lainnya. </p><br><h2 id="sbor-dannyh">  Pengumpulan data </h2><br><p>  Sekarang kami menggunakan rintisan dalam proyek bukan data nyata, tetapi kami membutuhkan data nyata.  Untuk melakukan ini, buat modul dan ubah nilai <code>data</code> dalam konfigurasi (omong-omong, setelah perubahan ini tidak perlu me-restart server): </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Node modules structure'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./collect-node-modules-data'</span></span>) };</code> </pre> <br><p>  Isi dari <code>collect-node-modules-data.js</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> scanFs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@discoveryjs/scan-fs'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> packages = []; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> scanFs({ <span class="hljs-attr"><span class="hljs-attr">include</span></span>: [<span class="hljs-string"><span class="hljs-string">'node_modules'</span></span>], <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\/package.json$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">extract</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file, content</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pkg = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(content); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pkg.name &amp;&amp; pkg.version) { packages.push({ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: pkg.name, <span class="hljs-attr"><span class="hljs-attr">version</span></span>: pkg.version, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: path.dirname(file.filename), <span class="hljs-attr"><span class="hljs-attr">dependencies</span></span>: pkg.dependencies }); } } }] }).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> packages); };</code> </pre> <br><p>  Saya menggunakan paket <code>@discoveryjs/scan-fs</code> , yang menyederhanakan pemindaian sistem file.  Contoh menggunakan paket dijelaskan dalam readme-nya, saya mengambil contoh ini sebagai dasar dan diselesaikan sesuai kebutuhan.  Sekarang kami memiliki beberapa informasi tentang isi <code>node_modules</code> : </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d0c/f24/64c/d0cf2464cadda8a8bc0433871200ae9b.png" alt="Data dikumpulkan"></p><br><p>  Apa yang kamu butuhkan!  Dan terlepas dari kenyataan bahwa ini adalah JSON biasa, kita sudah dapat menganalisisnya dan menarik beberapa kesimpulan.  Misalnya, menggunakan popup struktur data, Anda dapat mengetahui jumlah paket dan mencari tahu berapa banyak dari mereka yang memiliki lebih dari satu contoh fisik (karena perbedaan dalam versi atau masalah dengan deduplikasi mereka). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/8f3/93e/5e0/8f393e5e05a1385aa11aad92d8ad15a0.png" alt="Penelitian struktur data"></p><br><p>  Terlepas dari kenyataan bahwa kami sudah memiliki beberapa data, kami membutuhkan lebih banyak detail.  Sebagai contoh, akan menyenangkan untuk mengetahui instance fisik mana yang menyelesaikan setiap dependensi yang dideklarasikan dari modul tertentu.  Namun, upaya meningkatkan ekstraksi data berada di luar cakupan panduan ini.  Oleh karena itu, kami akan menggantinya dengan paket <code>@discoveryjs/node-modules</code> (yang juga didasarkan pada <code>@discoveryjs/scan-fs</code> ) untuk mengambil data dan mendapatkan detail yang diperlukan tentang paket.  Akibatnya, <code>collect-node-modules-data.js</code> sangat disederhanakan: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchNodeModules = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@discoveryjs/node-modules'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fetchNodeModules(); };</code> </pre> <br><p>  Sekarang informasi tentang <code>node_modules</code> terlihat seperti ini: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/1f5/1c2/187/1f51c2187d527694cbf71089e8d74ba8.png" alt="Struktur data baru"></p><br><h2 id="skript-podgotovki">  Script persiapan </h2><br><p>  Seperti yang mungkin Anda perhatikan, beberapa objek yang menggambarkan paket berisi <code>deps</code> - daftar dependensi.  Setiap ketergantungan memiliki bidang yang <code>resolved</code> yang nilainya merupakan referensi ke instance fisik paket.  Tautan semacam itu adalah nilai <code>path</code> salah satu paket, unik.  Untuk menyelesaikan tautan ke paket, Anda perlu menggunakan kode tambahan (misalnya, <code>#.data.pick(&lt;path=resolved&gt;)</code> ).  Dan tentu saja, akan jauh lebih nyaman jika tautan seperti itu sudah dipecahkan menjadi referensi objek. </p><br><p>  Sayangnya, pada tahap pengumpulan data, kami tidak dapat menyelesaikan tautan, karena ini akan menyebabkan koneksi sirkuler, yang akan menciptakan masalah mentransfer data tersebut dalam bentuk JSON.  Namun, ada solusinya: ini naskah <code>prepare</code> khusus.  Ini didefinisikan dalam konfigurasi dan dipanggil setiap kali data baru ditugaskan ke instance Discovery.  Mari kita mulai dengan konfigurasi: </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { ... prepare: __dirname + <span class="hljs-string"><span class="hljs-string">'/prepare.js'</span></span>, <span class="hljs-comment"><span class="hljs-comment">// :   ,    ... };</span></span></code> </pre> <br><p>  Tentukan <code>prepare.js</code> : </p><br><pre> <code class="javascript hljs">discovery.setPrepare(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  -  data /   discovery });</span></span></code> </pre> <br><p>  Dalam modul ini, kami mendefinisikan fungsi <code>prepare</code> untuk instance Discovery.  Fungsi ini dipanggil setiap kali sebelum menerapkan data ke instance Discovery.  Ini adalah tempat yang baik untuk memungkinkan nilai dalam referensi objek: </p><br><pre> <code class="javascript hljs">discovery.setPrepare(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> packageIndex = data.reduce(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">map, pkg</span></span></span><span class="hljs-function">) =&gt;</span></span> map.set(pkg.path, pkg), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>()); data.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pkg</span></span></span><span class="hljs-function"> =&gt;</span></span> pkg.deps.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dep</span></span></span><span class="hljs-function"> =&gt;</span></span> dep.resolved = packageIndex.get(dep.resolved) ) ); });</code> </pre> <br><p>  Di sini kami telah membuat indeks paket di mana kuncinya adalah nilai <code>path</code> paket (unik).  Kemudian kita pergi melalui semua paket dan dependensinya, dan dalam dependensi kita mengganti nilai yang <code>resolved</code> dengan referensi ke objek paket.  Hasil: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/95b/277/dd6/95b277dd63dc3aff1fdf3716c6881356.png" alt="Deps yang diterbitkan.  Terselesaikan"></p><br><p>  Sekarang jauh lebih mudah untuk membuat query grafik dependensi.  Ini adalah bagaimana Anda bisa mendapatkan sekelompok dependensi (mis. Dependensi, dependensi dependensi, dll.) Untuk paket tertentu: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c64/793/a78/c64793a78d40961af1b234fc111e4dc2.png" alt="Contoh Cluster Ketergantungan"></p><br><blockquote>  Sebuah kisah sukses yang tak terduga: ketika mempelajari data selama penulisan manual, saya menemukan masalah di <code>@discoveryjs/cli</code> (menggunakan kueri <code>.[deps.[not resolved]]</code> ), yang memiliki kesalahan ketik pada peerDependencies.  Masalahnya segera <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">diperbaiki</a> .  Kasing merupakan contoh yang baik tentang bagaimana alat tersebut membantu. </blockquote><p>  Mungkin sudah waktunya untuk menunjukkan pada halaman awal beberapa nomor dan paket dengan memakan waktu. </p><br><h2 id="nastraivaem-startovuyu-stranicu">  Kustomisasi Halaman Awal </h2><br><p>  Pertama, kita perlu membuat modul halaman, misalnya, <code>pages/default.js</code> .  Kami menggunakan <code>default</code> , karena ini adalah pengidentifikasi untuk halaman awal, yang dapat kami timpa (dalam Discovery.js, Anda dapat menimpa banyak).  Mari kita mulai dengan sesuatu yang sederhana, misalnya: </p><br><pre> <code class="javascript hljs">discovery.page.define(<span class="hljs-string"><span class="hljs-string">'default'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'h1:#.name'</span></span>, <span class="hljs-string"><span class="hljs-string">'text:"Hello world!"'</span></span> ]);</code> </pre> <br><p>  Sekarang dalam konfigurasi Anda perlu menghubungkan modul halaman: </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Node modules structure'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./collect-node-modules-data'</span></span>), <span class="hljs-attr"><span class="hljs-attr">view</span></span>: { <span class="hljs-attr"><span class="hljs-attr">assets</span></span>: [ <span class="hljs-string"><span class="hljs-string">'pages/default.js'</span></span> <span class="hljs-comment"><span class="hljs-comment">//     ] } };</span></span></code> </pre> <br><p>  Periksa di browser: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e0c/d07/8d5/e0cd078d55637ef62a697809544909b9.png" alt="Halaman Awal yang Digantikan"></p><br><p>  Itu berhasil! </p><br><p>  Sekarang mari kita cari beberapa counter.  Untuk melakukan ini, buat perubahan pada <code>pages/default.js</code> : </p><br><pre> <code class="javascript hljs">discovery.page.define(<span class="hljs-string"><span class="hljs-string">'default'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'h1:#.name'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">view</span></span>: <span class="hljs-string"><span class="hljs-string">'inline-list'</span></span>, <span class="hljs-attr"><span class="hljs-attr">item</span></span>: <span class="hljs-string"><span class="hljs-string">'indicator'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-string"><span class="hljs-string">`[ { label: 'Package entries', value: size() }, { label: 'Unique packages', value: name.size() }, { label: 'Dup packages', value: group(&lt;name&gt;).[value.size() &gt; 1].size() } ]`</span></span> } ]);</code> </pre> <br><p>  Di sini kita mendefinisikan daftar indikator inline.  Nilai <code>data</code> adalah kueri Jora yang membuat array rekaman.  Daftar paket (akar data) digunakan sebagai dasar untuk kueri, jadi kami mendapatkan panjang daftar ( <code>size()</code> ), jumlah nama paket unik ( <code>name.size()</code> ) dan jumlah nama paket yang memiliki duplikat ( <code>group(&lt;name&gt;).[value.size() &gt; 1].size()</code> ). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ebf/c97/8a2/ebfc978a2b2da44214a99a8382e17107.png" alt="Tambahkan indikator ke halaman awal"></p><br><p>  Tidak buruk.  Namun demikian, akan lebih baik untuk memiliki, selain angka, tautan ke sampel yang sesuai: </p><br><pre> <code class="javascript hljs">discovery.page.define(<span class="hljs-string"><span class="hljs-string">'default'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'h1:#.name'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">view</span></span>: <span class="hljs-string"><span class="hljs-string">'inline-list'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Package entries'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Unique packages'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">'name'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Dup packages'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">'group(&lt;name&gt;).[value.size() &gt; 1]'</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">item</span></span>: <span class="hljs-string"><span class="hljs-string">`indicator:{ label, value: value.query(#.data, #).size(), href: pageLink('report', { query: value, title: label }) }`</span></span> } ]);</code> </pre> <br><p>  Pertama-tama, kami mengubah nilai <code>data</code> , sekarang ini adalah array reguler dengan beberapa objek.  Selain itu, metode <code>size()</code> telah dihapus dari permintaan nilai. </p><br><p>  Selain itu, subquery telah ditambahkan ke tampilan <code>indicator</code> .  Jenis kueri ini membuat objek baru untuk setiap elemen di mana <code>value</code> dan <code>href</code> dihitung.  Untuk <code>value</code> , kueri dieksekusi menggunakan metode <code>query()</code> , yang datanya ditransfer dari konteks, dan kemudian metode <code>size()</code> diterapkan pada hasil kueri.  Untuk <code>href</code> , metode <code>pageLink()</code> digunakan, yang menghasilkan tautan ke halaman laporan dengan permintaan dan tajuk tertentu.  Setelah semua perubahan ini, indikator menjadi dapat diklik (perhatikan bahwa nilainya telah menjadi biru) dan lebih fungsional. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e72/104/33c/e7210433ca45798701f34c6625cae050.gif" alt="Indikator yang dapat diklik"></p><br><p>  Untuk membuat halaman awal lebih bermanfaat, tambahkan tabel dengan paket yang memiliki duplikat. </p><br><pre> <code class="javascript hljs">discovery.page.define(<span class="hljs-string"><span class="hljs-string">'default'</span></span>, [ <span class="hljs-comment"><span class="hljs-comment">// ...      'h2:"Packages with more than one physical instance"', { view: 'table', data: ` group(&lt;name&gt;) .[value.size() &gt; 1] .sort(&lt;value.size()&gt;) .reverse() `, cols: [ { header: 'Name', content: 'text:key' }, { header: 'Version &amp; Location', content: { view: 'list', data: 'value.sort(&lt;version&gt;)', item: [ 'badge:version', 'text:path' ] } } ] } ]);</span></span></code> </pre> <br><p>  Tabel ini menggunakan data yang sama dengan indikator <code>Dup packages</code> .  Daftar paket diurutkan berdasarkan ukuran grup dalam urutan terbalik.  Sisa pengaturan terkait dengan kolom (omong-omong, biasanya mereka tidak perlu disetel).  Untuk kolom <code>Version &amp; Location</code> , kami mendefinisikan daftar bersarang (diurutkan berdasarkan versi), di mana setiap elemen adalah pasangan nomor versi dan jalur ke instance. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a50/5fd/4ab/a505fd4aba48f6a0d025fc5cd4b84b24.png" alt="Contoh tabel dengan paket yang memiliki lebih dari satu contoh fisik"></p><br><h2 id="stranica-paketov">  Halaman Paket </h2><br><p>  Sekarang kami hanya memiliki gambaran umum tentang paket.  Tetapi akan bermanfaat untuk memiliki halaman dengan detail tentang paket tertentu.  Untuk melakukan ini, buat <code>pages/package.js</code> modul baru <code>pages/package.js</code> dan tentukan halaman baru: </p><br><pre> <code class="javascript hljs">discovery.page.define(<span class="hljs-string"><span class="hljs-string">'package'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">view</span></span>: <span class="hljs-string"><span class="hljs-string">'context'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-string"><span class="hljs-string">`{ name: #.id, instances: .[name = #.id] }`</span></span>, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: [ <span class="hljs-string"><span class="hljs-string">'h1:name'</span></span>, <span class="hljs-string"><span class="hljs-string">'table:instances'</span></span> ] });</code> </pre> <br><p>  Dalam modul ini, kami mendefinisikan halaman dengan <code>package</code> pengenal.  Komponen <code>context</code> digunakan sebagai representasi awal.  Ini adalah komponen non-visual yang membantu Anda menentukan data untuk pemetaan bersarang.  Perhatikan bahwa kami menggunakan <code>#.id</code> untuk mendapatkan nama paket, yang diambil dari URL seperti ini <code>http://localhost:8123/#package:{id}</code> . </p><br><p>  Jangan lupa untuk memasukkan modul baru dalam konfigurasi: </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { ... view: { <span class="hljs-attr"><span class="hljs-attr">assets</span></span>: [ <span class="hljs-string"><span class="hljs-string">'pages/default.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'pages/package.js'</span></span> <span class="hljs-comment"><span class="hljs-comment">//   ] } };</span></span></code> </pre> <br><p>  Hasil dalam browser: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3ee/698/da0/3ee698da0907aebaa1ace032942c0575.png" alt="Contoh Halaman Paket"></p><br><p>  Tidak terlalu mengesankan, tetapi untuk saat ini.  Kami akan membuat pemetaan yang lebih kompleks di manual selanjutnya. </p><br><h2 id="bokovaya-panel">  Panel samping </h2><br><p>  Karena kita sudah memiliki halaman paket, alangkah baiknya memiliki daftar semua paket.  Untuk melakukan ini, Anda dapat menentukan tampilan khusus - <code>sidebar</code> , yang ditampilkan jika sudah ditentukan (tidak ditentukan secara default).  Buat <code>views/sidebar.js</code> modul baru <code>views/sidebar.js</code> : </p><br><pre> <code class="javascript hljs">discovery.view.define(<span class="hljs-string"><span class="hljs-string">'sidebar'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">view</span></span>: <span class="hljs-string"><span class="hljs-string">'list'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-string"><span class="hljs-string">'name.sort()'</span></span>, <span class="hljs-attr"><span class="hljs-attr">item</span></span>: <span class="hljs-string"><span class="hljs-string">'link:{ text: $, href: pageLink("package") }'</span></span> });</code> </pre> <br><p>  Sekarang kami memiliki daftar semua paket: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/503/326/a02/503326a020869af76a3b2076c5df2394.png" alt="Bilah sisi ditambahkan"></p><br><p>  Itu terlihat bagus.  Tetapi dengan filter itu akan lebih baik.  Kami memperluas definisi <code>sidebar</code> : </p><br><pre> <code class="javascript hljs">discovery.view.define(<span class="hljs-string"><span class="hljs-string">'sidebar'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">view</span></span>: <span class="hljs-string"><span class="hljs-string">'content-filter'</span></span>, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: { <span class="hljs-attr"><span class="hljs-attr">view</span></span>: <span class="hljs-string"><span class="hljs-string">'list'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-string"><span class="hljs-string">'name.[no #.filter or $~=#.filter].sort()'</span></span>, <span class="hljs-attr"><span class="hljs-attr">item</span></span>: { <span class="hljs-attr"><span class="hljs-attr">view</span></span>: <span class="hljs-string"><span class="hljs-string">'link'</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-string"><span class="hljs-string">'{ text: $, href: pageLink("package"), match: #.filter }'</span></span>, <span class="hljs-attr"><span class="hljs-attr">content</span></span>: <span class="hljs-string"><span class="hljs-string">'text-match'</span></span> } } });</code> </pre> <br><p>  Di sini kami membungkus daftar dalam komponen <code>content-filter</code> yang mengubah nilai input dalam bidang input ke ekspresi reguler (atau <code>null</code> jika bidang kosong) dan menyimpannya sebagai nilai <code>filter</code> dalam konteks (nama dapat diubah dengan opsi <code>name</code> ).  Juga, untuk memfilter data untuk daftar, kami menggunakan <code>#.filter</code> .  Akhirnya, kami menerapkan pemetaan tautan untuk menyorot bagian yang cocok dengan <code>text-match</code> .  Hasil: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d55/74f/67e/d5574f67e7a2dd222194c66f5ecf0673.png" alt="Filter daftar"></p><br><p>  Jika Anda tidak menyukai desain default, Anda dapat menyesuaikan gaya sesuai keinginan.  Katakanlah Anda ingin mengubah lebar bilah sisi, untuk ini Anda perlu membuat file gaya (katakanlah, <code>views/sidebar.css</code> ): </p><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.discovery-sidebar</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">300px</span></span>; }</code> </pre> <br><p>  Dan tambahkan tautan ke file ini dalam konfigurasi, serta ke modul JavaScript: </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { ... view: { <span class="hljs-attr"><span class="hljs-attr">assets</span></span>: [ ... <span class="hljs-string"><span class="hljs-string">'views/sidebar.css'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//  assets    *.css  'views/sidebar.js' ] } };</span></span></code> </pre> <br><h2 id="avtossylki">  Tautan Otomatis </h2><br><p>  Bab terakhir dari panduan ini dikhususkan untuk tautan.  Sebelumnya, menggunakan metode <code>pageLink()</code> , kami membuat tautan ke halaman paket.  Namun selain tautan, Anda juga harus mengatur teks tautan.  Tetapi bagaimana kita membuatnya lebih mudah? </p><br><p>  Untuk menyederhanakan pekerjaan tautan, kita perlu mendefinisikan aturan untuk menghasilkan tautan.  Ini paling baik dilakukan dalam skrip <code>prepare</code> : </p><br><pre> <code class="javascript hljs">discovery.setPrepare(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ ... const packageIndex = data.reduce( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">map, item</span></span></span><span class="hljs-function">) =&gt;</span></span> map .set(item, item) <span class="hljs-comment"><span class="hljs-comment">// key is item itself .set(item.name, item), // and `name` value new Map() ); discovery.addEntityResolver(value =&gt; { value = packageIndex.get(value) || packageIndex.get(value.name); if (value) { return { type: 'package', id: value.name, name: value.name }; } }); });</span></span></code> </pre> <br><p>  Kami menambahkan peta baru (indeks) paket dan menggunakannya untuk resolver entitas.  Penyelesai entitas mencoba, jika mungkin, untuk mengubah nilai yang diteruskan ke entitas descriptor.  Deskriptor berisi: </p><br><ul><li>  <code>type</code> - tipe entitas </li><li>  <code>id</code> - referensi unik ke instance entitas yang digunakan dalam tautan sebagai ID </li><li>  <code>name</code> - digunakan sebagai teks tautan </li></ul><br><p>  Terakhir, Anda perlu menetapkan jenis ini ke halaman tertentu (tautannya mengarah ke suatu tempat, bukan?). </p><br><pre> <code class="javascript hljs">discovery.page.define(<span class="hljs-string"><span class="hljs-string">'package'</span></span>, { ... }, { <span class="hljs-attr"><span class="hljs-attr">resolveLink</span></span>: <span class="hljs-string"><span class="hljs-string">'package'</span></span> <span class="hljs-comment"><span class="hljs-comment">//    `package`    });</span></span></code> </pre> <br><p>  Konsekuensi pertama dari perubahan ini adalah bahwa beberapa nilai dalam tampilan <code>struct</code> sekarang ditandai dengan tautan ke halaman paket: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/eb2/dcd/502/eb2dcd5024f589a3ba8180f2b1ec538f.png" alt="Tautan otomatis dalam struct"></p><br><p>  Dan sekarang Anda juga dapat menerapkan komponen <code>auto-link</code> ke objek atau nama paket: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/64d/3c2/f24/64d3c2f244164a22c55ff433409f6e22.png" alt="Menggunakan tautan otomatis"></p><br><p>  Dan, sebagai contoh, Anda dapat sedikit mengolah ulang bilah samping: </p><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//   item: { view: 'link', data: '{ text: $, href: pageLink("package"), match: #.filter }', content: 'text-match' }, //   `auto-link` item: { view: 'auto-link', content: 'text-match:{ text, match: #.filter }' }</span></span></code> </pre> <br><h2 id="zaklyuchenie">  Kesimpulan </h2><br><p>  Anda sekarang memiliki pemahaman dasar tentang konsep-konsep kunci dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Discovery.js</a> .  Dalam panduan berikut kami akan melihat lebih dekat topik yang dibahas. </p><br><p>  Anda dapat melihat seluruh kode sumber panduan dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">repositori di GitHub</a> atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mencoba cara kerjanya secara online</a> . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ikuti @js_discovery</a> di Twitter untuk mengikuti berita terbaru! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id469115/">https://habr.com/ru/post/id469115/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id469097/index.html">Server web CentOS 8 dengan php7, node.js dan redis</a></li>
<li><a href="../id469099/index.html">Menguji tugas saat wawancara dengan pengembang - apakah masuk akal?</a></li>
<li><a href="../id469101/index.html">Belajar Bahasa Inggris: cara belajar berbicara sebagai penutur asli</a></li>
<li><a href="../id469109/index.html">Mainan Kayu, Bagian Tiga - 1989</a></li>
<li><a href="../id469111/index.html">Ganti Obyek dengan var: apa yang bisa salah?</a></li>
<li><a href="../id469117/index.html">Pemrograman di bawah BC 0010 pada tahun 2019</a></li>
<li><a href="../id469119/index.html">Alamat IPv4 di RIPE sudah berakhir. Benar-benar selesai ...</a></li>
<li><a href="../id469125/index.html">Tema gelap Thunderbird sebagai alasan untuk menjalankan penganalisis kode</a></li>
<li><a href="../id469127/index.html">Optimasi atau cara tidak menembak diri sendiri di kaki</a></li>
<li><a href="../id469129/index.html">Karena tema yang gelap, Thunderbird harus menjalankan penganalisa kode</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>