<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüöí ‚ÅâÔ∏è üå®Ô∏è Playrix CI / CD: comment nous construisons et testons nos jeux ü§∞üèæ üë©üèª‚Äçüéì üßôüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'√©quipe devrait se concentrer sur la cr√©ation de jeux magnifiques et r√©ussis, pour tout le reste, il y a CI. 

 O√π appliquons-nous CI? Quelles approc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Playrix CI / CD: comment nous construisons et testons nos jeux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/playrix/blog/479966/">  L'√©quipe devrait se concentrer sur la cr√©ation de jeux magnifiques et r√©ussis, pour tout le reste, il y a CI. <br><br>  O√π appliquons-nous CI?  Quelles approches et quels concepts utilisons-nous?  Pourquoi construire et tester des builds?  L'histoire d√©taill√©e de CI et de son organisation dans Playrix dessinera un cours magistral.  Sous la coupe - une br√®ve pression et quelques accents. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4e/54d/ab2/b4e54dab26c1357b27e3e31b88c9378d.png"></div><a name="habracut"></a><br>  Salut <br><br>  Tout d'abord, un petit √©chauffement: qu'est-ce que l'int√©gration continue?  Si l'√©quipe utilise le r√©f√©rentiel et collecte les builds de nuit - est-ce d√©j√† CI?  Quelle est la diff√©rence entre le d√©ploiement continu et la livraison?  C'est presque sans importance.  D√©tails - pour un cercle restreint de sp√©cialistes.  Si vous souhaitez impliquer l'ensemble de l'entreprise dans un processus, trouvez-en un nom simple et bon.  Dans Playrix, nous appelons toutes ces approches CI.  C'est une telle marque locale et un logo sympa: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebe/d97/d8e/ebed97d8e7a2fff88508b8e73c6b0e97.png" width="500"></div><br><h2>  Id√©e </h2><br>  L'IC n'est pas un objectif, c'est un outil.  Il doit y avoir un objectif que vous souhaitez atteindre avec l'int√©gration continue, un probl√®me qui doit √™tre r√©solu.  Il arrive que les processus de d√©veloppement et de sortie d'une √©quipe soient construits sur le principe ¬´pri√© et en production¬ª.  Parfois, c'est justifi√©, mais rarement. <br><br>  Nous avons formul√© notre objectif comme suit: minimiser la probabilit√© de probl√®mes d'int√©gration, minimiser les ressources n√©cessaires pour corriger les erreurs trouv√©es, r√©duire le temps des √©quipes de d√©veloppement de projet pour soutenir et soutenir les processus CI. <br>  CI est une automatisation des processus de construction, des tests de code et sa livraison √† divers environnements, l'automatisation des processus de d√©veloppement de routine, l'int√©gration mutuelle des services que nous utilisons tous. <br><br>  L'id√©e est dans un syst√®me qui collecte automatiquement tout automatiquement, le fait souvent, teste et fournit une g√©n√©ration, et signale √©galement de mani√®re cibl√©e un rapport pratique en cas de probl√®me. <br><br><h2>  O√π appliquons-nous CI? </h2><br><ul><li>  Moteur et utilitaires, </li><li>  nos jeux pour toutes les plateformes, </li><li>  code serveur </li><li>  analytique, services marketing, automatisation divers, services CI, </li><li>  l'infrastructure. </li></ul><br>  C'est partout ou presque partout. <br><br>  L'assemblage et le test des conteneurs, le d√©ploiement automatique dans les mises √† jour Test, Staging et Prod, Rolling et Canary - tout cela que nous avons et plus applicable aux services et applications Web.  Aujourd'hui, nous allons nous concentrer sur CI pour les jeux: construire des builds, les tester et les livrer. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e87/bab/b31/e87babb31e40c7d90e3994f45be77792.png" width="500"></div><br><h2>  Paradigmes </h2><br>  Pour atteindre les objectifs √©nonc√©s ci-dessus, vous devez r√©soudre plusieurs probl√®mes.  Vous trouverez ci-dessous un plan que nous suivons lorsque nous automatisons un processus en cours de d√©veloppement, par exemple, l'assemblage d'un client de jeu mobile.  Il est tr√®s pratique d'avoir une liste de questions auxquelles vous pouvez r√©soudre tout probl√®me qui rel√®ve de l'√©quipe CI. <br><br><ul><li><h3>  La documentation </h3></li></ul><br>  Les instructions d'assemblage sont une documentation, une description de notre processus automatis√©.  Une telle documentation est souvent √† la t√™te des programmeurs.  Si une √©quipe a un super-sp√©cialiste dans la construction de builds et sans lui, personne ne peut plus construire une build rapide et sans erreur - il est temps de changer quelque chose, il n'y aura pas de soumission. <br><br>  Eh bien, si une telle documentation est encadr√©e sous la forme d'un script: j'ai entr√© une ligne de commande et un ensemble de param√®tres sur une machine avec un environnement pr√©par√© - j'ai eu une build. <br><br>  La meilleure documentation de processus est le code <s>cat</s> .  M√™me si, pour une raison quelconque, vous devez r√©p√©ter l'op√©ration manuellement, vous pouvez toujours le faire en l'examinant. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc1/b35/41c/bc1b3541c1eaf585466131dfc966a466.png" width="500"></div><ul><li><h3>  Journalisation </h3></li></ul><br>  Le journal de build vous permet de toujours dire avec certitude: qui, quand, √† partir de quel commit, et avec quel r√©sultat telle ou telle build a √©t√© collect√©e.  Hier, la construction √©tait sur le point, mais aujourd'hui, ce n'√©tait pas le cas.  Nous regardons dans le journal, nous trouvons la premi√®re g√©n√©ration de disquette, nous voyons la liste des commits qui y sont arriv√©s - profit. <br><br>  Le magazine est encore plus utile lorsqu'il s'agit, par exemple, de code serveur.  S'il n'y a aucune information sur qui a mis √† jour le prod et quand, alors dans le cas g√©n√©ral, on ne sait pas quel code y travaille actuellement.  Et parfois, c'est tr√®s important, tr√®s. <br><br>  Vous pouvez conserver un tel journal dans le grand livre, de pr√©f√©rence dans un tableau ou un wiki.  La liste des builds dans le syst√®me CI est inestimable. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4dc/a88/26c/4dca8826cad8ae341be5df436c3fcab4.png"></div><br><ul><li><h3>  La s√©curit√© </h3></li></ul><br>  Quand il s'agit de construire une build et de d√©ployer sur une sorte d'environnement, la question se pose toujours: o√π stocker les mots de passe de connexion / acc√®s?  Ils ont g√©n√©ralement besoin de beaucoup: au r√©f√©rentiel pour t√©l√©charger les donn√©es source, au stockage de fichiers pour remplir les ressources du jeu, √† HockeyApp pour envoyer des personnages, au serveur pour mettre √† jour le code, etc. <br><br>  Il arrive que tous les acc√®s n√©cessaires soient stock√©s dans le r√©f√©rentiel.  Il y a une hypoth√®se que ce n'est pas tr√®s bon.  Souvent, vous pouvez voir le champ "enter password", disons, √† Jenkins, o√π l'auteur de la construction entre les caract√®res cach√©s. <br><br>  Se souvenir de tous les mots de passe par c≈ìur est une bonne comp√©tence.  Notre serveur CI lui-m√™me re√ßoit les acc√®s n√©cessaires en fonction de l'assemblage.  Habituellement, ce sont des jetons de courte dur√©e qui sont g√©n√©r√©s au d√©but de la g√©n√©ration et donnent des droits minimaux exactement l√† o√π nous d√©ployons quelque chose ou o√π nous lisons quelque chose. <br><br>  La gestion centralis√©e de l'assemblage et du d√©ploiement vous permet de r√©soudre le probl√®me de la diff√©renciation des droits d'acc√®s √† l'infrastructure.  Pourquoi donner √† quelqu'un l'acc√®s au serveur si vous ne pouvez donner acc√®s qu'√† l'assembly de la build correspondante qui effectue l'op√©ration n√©cessaire sur ce serveur?  Et comme il y a une version, nous avons de la documentation et de la journalisation, eh bien, vous comprenez. <br><br><ul><li><h3>  Tra√ßabilit√© </h3></li></ul><br>  Il y a g√©n√©ralement beaucoup de traces laiss√©es pendant la construction.  Non, pas comme √ßa: lors de la construction, il faut laisser autant de traces que possible.  Dans le r√©f√©rentiel, dans le tracker de t√¢ches, dans le syst√®me de distribution de build.  Partout, o√π que vous rencontriez un build, il devrait y avoir des traces qui vous conduisent √† compl√©ter les informations le concernant. <br><br>  Ces traces n'ont pas besoin d'√™tre balay√©es, au contraire, elles doivent √™tre soigneusement laiss√©es et soigneusement conserv√©es.  De plus, je vais vous en dire plus √† ce sujet, mais nous devons d'abord r√©cup√©rer notre build.  Allons-y. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75c/436/e91/75c436e91724a70d5442af7c6432516d.png" width="500"></div><h2>  Crochets de pr√©-validation </h2><br>  Encore une fois, l'id√©e est un syst√®me qui recueille, teste et rapporte tout.  Mais pourquoi construire un build si vous ne pouvez pas le construire? <br><br>  Tous les d√©veloppeurs de nos jeux ont install√© des crochets de pr√©-validation, c'est-√†-dire  un ensemble de v√©rifications qui sont effectu√©es lors de la tentative de validation de quelque chose.  Les v√©rifications ne s'ex√©cutent que pour les fichiers modifi√©s, mais nous avons impl√©ment√© un syst√®me de recherche interd√©pendant tr√®s astucieux pour v√©rifier √©galement tout le contenu associ√©.  C'est-√†-dire  si l'artiste a ajout√© une texture, les crochets v√©rifieront qu'ils n'ont pas oubli√© de l'enregistrer l√† o√π c'est n√©cessaire et ne l'ont jamais scell√©e. <br><br>  Il s'av√®re que les crochets attrapent une partie importante des petites erreurs.  Ils √©conomisent les ressources du syst√®me de construction et aident le d√©veloppeur √† r√©soudre rapidement le probl√®me: il voit un message qui explique en d√©tail ce qui n'a pas fonctionn√©.  Et il n'a pas besoin de basculer entre les t√¢ches: il vient litt√©ralement d'apporter des modifications et est en contexte.  Le temps de correction des erreurs est minime. <br><br>  Nous l'avons tellement aim√© que nous avons m√™me cr√©√© un syst√®me qui v√©rifie si des hooks ont √©t√© faits pour une validation qui est entr√©e dans le r√©f√©rentiel.  Sinon, l'auteur d'une telle validation recevra automatiquement une t√¢che lui demandant de les configurer et des instructions d√©taill√©es sur la fa√ßon de proc√©der. <br><br>  Les crochets sont standardis√©s pour tous les projets.  Le nombre de tests personnalis√©s est minime.  Il y a une personnalisation pratique, y compris en fonction de l'utilisateur qui ex√©cute: c'est tr√®s pratique pour tester les tests. <br><br><h2>  Construire </h2><br>  Pour voir le probl√®me dans la version le plus t√¥t possible, vous devez collecter et tester ces versions aussi souvent que possible.  Les clients de nos jeux se r√©unissent pour toutes les plateformes, pour chaque commit, pour tous les projets.  Il y a probablement quelques exceptions, mais pas beaucoup. <br><br>  En r√®gle g√©n√©rale, un client, en particulier un mobile, a plusieurs versions diff√©rentes: avec et sans triche, sign√© diff√©remment, etc.  Pour chaque commit, nous collectons des builds "r√©guliers", que les d√©veloppeurs et les testeurs utilisent constamment. <br><br>  Il y a des builds qui sont utilis√©s tr√®s rarement, par exemple, le store ios build - une seule fois dans une soumission, c'est-√†-dire  environ une fois par mois.  Cependant, nous pensons que toutes les versions doivent √™tre collect√©es r√©guli√®rement.  Si un probl√®me survient avec ce type d'assemblage, c√¥t√© d√©veloppement ou infrastructure, l'√©quipe du projet en sera inform√©e non pas le jour de la livraison, mais bien plus t√¥t, et sera en mesure de r√©pondre et de r√©soudre le probl√®me √† l'avance. <br><br>  En cons√©quence, nous avons une r√®gle simple: toute version est lanc√©e au moins une fois par jour.  L'√©quipe de d√©veloppement du projet d√©couvre la pr√©sence de tout probl√®me sur n'importe quelle plate-forme dans le pire des cas le lendemain matin, apr√®s l'apparition de ce probl√®me dans le r√©f√©rentiel. <br><br>  Une telle fr√©quence d'assemblages et de tests n√©cessite une approche particuli√®re pour optimiser leur temps d'ex√©cution. <br><br><ul><li>  Toutes les versions client r√©guli√®res sont incr√©mentielles. </li><li>  L'emballage des atlas et la pr√©paration des ressources sont √©galement progressifs. </li><li>  Les assemblages sont granulaires: certaines √©tapes sont dans des configurations de construction distinctes - cela vous permet de les ex√©cuter en parall√®le, ainsi que de r√©utiliser les r√©sultats interm√©diaires. </li></ul><br>  Il s'agit d'une capture d'√©cran presque compl√®te de la cha√Æne de builds et de tests pour WildScapes.  Le plein n'a pas pu √™tre fait: il est environ deux fois plus grand. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/672/415/771/67241577111cb4d6b5d1df70a54337e5.png"></div><br><h2>  Tests statiques </h2><br>  Apr√®s l'assemblage, des tests statiques sont effectu√©s: nous prenons le dossier avec la construction et effectuons un ensemble de v√©rifications de tout le contenu qui s'y trouve.  Le code est √©galement du contenu, donc son analyse statique (cppcheck + PVS-Studio) est √©galement ici. <br><br>  Sur un habr il y <a href="https://habr.com/ru/company/playrix/blog/452926/">avait un mat√©riel d√©taill√©</a> sur la fa√ßon dont nous avons impl√©ment√© les tests statiques, je le recommande.  Je souligne seulement que les tests statiques apr√®s la construction et dans les hooks de pr√©-validation sont ex√©cut√©s par le m√™me code.  Cela simplifie consid√©rablement la prise en charge du syst√®me. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/69f/195/0dd/69f1950dd3434591d233507574609672.png" width="500"></div><br><h2>  Tests d'ex√©cution </h2><br>  Si la g√©n√©ration de tests statiques a r√©ussi, vous pouvez continuer et essayer d'ex√©cuter la g√©n√©ration assembl√©e.  Nous testons des builds sur toutes les plateformes sauf UWP, c'est-√†-dire  Windows, MacOs, iOS, Android.  UWP - le sera aussi, mais un peu plus tard. <br><br>  Pourquoi tester les versions de bureau si elles ne semblent n√©cessaires qu'en d√©veloppement?  La r√©ponse √† la question est: c'est mauvais si un artiste ou un level designer obtient une version qui plante au d√©marrage pour une raison ridicule.  Par cons√©quent, Smoke-Test, l'ensemble minimal de v√©rifications pour l'ex√©cutabilit√© et le gameplay de base, est effectu√© pour toutes les plateformes. <br><br>  Tout ce qui a √©t√© √©crit ci-dessus sur les builds est √©galement vrai pour les tests sur les appareils - au moins une fois par jour.  √Ä quelques exceptions pr√®s: il y a de tr√®s longs tests qui n'ont pas le temps de se terminer en une journ√©e. <br><br>  Des tests de fum√©e sont ex√©cut√©s pour chaque commit.  La r√©ussite des v√©rifications de base est une condition pr√©alable pour que la version p√©n√®tre dans le syst√®me de distribution.  Habituellement, cela n'a aucun sens de donner √† quelqu'un l'acc√®s √† une version qui ne fonctionne √©videmment pas.  Ici, vous pouvez vous opposer et proposer des exceptions.  Les projets ont une solution de contournement pour donner acc√®s √† une version non fonctionnelle, mais ils l'utilisent √† peine. <br><br>  Quels sont les autres tests: <br><br><ul><li>  Benchmark: nous v√©rifions les performances sur le FPS et la m√©moire dans diverses situations et sur tous les appareils. </li><li>  Tests unitaires Match-3: chaque √©l√©ment et chaque m√©canique sont test√©s individuellement et dans toutes les combinaisons d'interaction. </li><li>  Le passage du jeu entier du d√©but √† la fin. </li><li>  Divers tests de r√©gression, par exemple, des tests de localisation, ou que toutes les fen√™tres de l'interface utilisateur s'ouvrent correctement, ou que les sc√®nes fishdom dans Fishdom se lisent sans erreurs. </li><li>  Tout de m√™me, mais avec <a href="https://en.wikipedia.org/wiki/AddressSanitizer">AddressSanitizer</a> . </li><li>  Tests de compatibilit√© pour les versions de jeu: prenez le fichier de sauvegarde de l'utilisateur des versions pr√©c√©dentes, ouvrez-le dans la nouvelle version et assurez-vous que tout va bien. </li><li>  Divers tests personnalis√©s pertinents pour la m√©canique d'un projet particulier. </li></ul><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c7a/24e/992/c7a24e992e95338aa4e884f367168b9e.png" width="500"></div><br>  Pour ex√©cuter les tests, nous utilisons notre propre banc d'essai d'appareils iOS et Android.  Cela nous permet de lancer de mani√®re flexible les versions dont nous avons besoin sur les appareils, d'interagir avec l'appareil √† partir du code.  Nous avons un contr√¥le total, un niveau de fiabilit√© compr√©hensible, nous savons quels probl√®mes nous pouvons rencontrer et combien de temps il faudra pour les r√©soudre.  Aucun des services cloud qui fournissent des appareils de test n'offre un tel confort. <br><br><h2>  CHATS </h2><br>  Les tests r√©pertori√©s ci-dessus sont impl√©ment√©s dans le code du projet.  Cela permet en th√©orie de faire un test de toute complexit√©, mais n√©cessite des efforts et des ressources de la part du d√©veloppement du projet pour impl√©menter et supporter ces tests.  Ces ressources ne sont souvent pas disponibles et il est difficile et inutile de tester plusieurs r√©gressions √† la main.  Je voulais vraiment que les testeurs eux-m√™mes fassent l'automatisation des tests.  Et nous avons trouv√© un cadre pour eux - le syst√®me de test d'automatisation continue, ou CATS. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f1/40d/aab/9f140daab4981b2700a9e40358ceb51e.png" width="500"></div><br>  Quelle est l'id√©e: permettre aux auteurs de scripts de test d'interagir avec l'application de jeu, sans se soucier de la fa√ßon dont tout cela fonctionne.  Nous √©crivons des scripts en python primitif, nous acc√©dons √† l'application via un ensemble d'abstractions.  Par exemple: "Homescapes, ouvrez-moi une fen√™tre d'achat et achetez tel ou tel produit."  V√©rifiez le r√©sultat, bingo. <br><br>  L'impl√©mentation compl√®te des commandes de script est cach√©e derri√®re un ensemble d'abstractions.  L'API qui impl√©mente l'interaction avec l'application vous permet d'effectuer n'importe quelle action de plusieurs mani√®res: <br><br><ul><li>  envoyer une requ√™te http au serveur, qui est int√©gr√© au moteur de jeu, avec une sorte de commande.  Cette commande est trait√©e par le code du jeu.  Habituellement, c'est une sorte de triche, elle peut √™tre arbitrairement simple ou complexe.  Par exemple, "donnez-moi les coordonn√©es du centre du bouton avec l'identifiant sp√©cifi√©."  Ou "passez-moi le jeu d'ici au niveau avec le num√©ro indiqu√©." </li><li>  Nous pouvons ouvrir une fen√™tre √† travers la triche ou d√©couvrir les coordonn√©es du bouton par lequel cette fen√™tre s'ouvre, nous pouvons √©muler en cliquant sur ce bouton, nous pouvons effectuer un clic virtuel dessus. </li><li>  Enfin, nous pouvons effectuer un ¬´vrai¬ª clic sur les coordonn√©es sp√©cifi√©es comme si cela avait √©t√© fait avec un doigt sur l'√©cran. </li></ul><br>  Cette derni√®re m√©thode ouvre la porte √† l'imagination des testeurs qui souhaitent souvent tester des builds ¬´combat¬ª, o√π il n'y a pas de triche.  Le maintien de tels sc√©narios est plus difficile, mais une ¬´construction de combat¬ª est une construction de ¬´combat¬ª. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e25/0de/9ce/e250de9ce8a6e45d5ecfc8495eec7cb2.png"></div><br>  Il s'est av√©r√© tr√®s pratique de travailler avec les coordonn√©es du centre du bouton: les coordonn√©es changent parfois, mais les identifiants des boutons sont rares.  Cela a conduit √† une autre propri√©t√© importante du syst√®me: la possibilit√© d'√©crire un script de test pour toutes les plates-formes et toutes les r√©solutions d'√©cran. <br><br><h2>  Livraison, rapports et traces </h2><br>  Avec la livraison, tout s'est av√©r√© assez simple: nous utilisons un seul stockage partag√© pour construire des artefacts et pour le stockage dans le syst√®me de distribution.  Le ¬´chargement¬ª de la build revient √† invoquer une paire de requ√™tes vers l'api du service de distribution de build, essentiellement l'enregistrement.  De cette fa√ßon, nous avons √©conomis√© un peu de temps sur le pompage des constructions et de l'argent pour leur stockage. <br><br>  Rappelez-vous, vous avez parl√© de minimiser les ressources n√©cessaires pour corriger les erreurs trouv√©es dans les versions?  Rapports et pistes - √† peu pr√®s ceci: <br><br><ul><li>  Signaler un probl√®me d√©tect√© est une t√¢che dans Asana.  Il est facile √† contr√¥ler, √† l'assigner au bon d√©veloppeur, √† le transf√©rer √† l'√©quipe CI en cas de probl√®me dans l'infrastructure. </li><li>  Nous collectons des builds pour chaque commit.  Nous connaissons l'auteur de ce commit, donc lui seul verra cette t√¢che.  Nous gagnons donc du temps pour les autres d√©veloppeurs: ils n'ont pas besoin d'√™tre distraits par des probl√®mes avec lesquels ils n'ont rien √† voir et aident √† les r√©soudre, ce qu'ils ne seront probablement pas en mesure de r√©soudre. </li><li>  Si vous cr√©ez une build √† partir du prochain commit, il est tr√®s probable qu'elle soit toujours rompue.  Il y aura un commentaire dans la t√¢che: "La construction est toujours cass√©e", l'auteur du nouveau commit ne verra pas la t√¢che et ne perdra pas de temps sur le probl√®me de quelqu'un d'autre. </li><li>  Nous envoyons des rapports √† Slack.  N√©cessairement - personnellement √† celui qui a "cass√©" la construction, et si le projet le veut - √† une cha√Æne sp√©ciale ou √† tout employ√© de Playrix.  Tout est aussi flexible que possible. </li></ul><br>  Des traces sont n√©cessaires pour que partout il y ait des informations compl√®tes sur la construction et les modifications √† partir desquelles elle a √©t√© collect√©e.  Afin de ne rien chercher, pour que tout soit √† port√©e de main et qu'il ne soit pas n√©cessaire de passer du temps √† rechercher les d√©tails qui sont souvent n√©cessaires lors de la recherche d'un probl√®me. <br><br><ul><li>  Le rapport contient un lien vers la g√©n√©ration, vers le journal de g√©n√©ration, le texte de l'erreur de compilation trouv√©e et les noms des tests invers√©s.  Souvent, un programmeur, apr√®s avoir re√ßu une t√¢che de rapport, peut imm√©diatement corriger l'erreur: le nom du fichier, la ligne et le texte de l'erreur figurent dans le rapport. </li><li>  Le message dans Slack contient tout de m√™me + un lien vers la t√¢che dans Asana. </li><li>  Dans Teamcity, un lien vers une t√¢che.  L'ing√©nieur de construction peut imm√©diatement se lancer dans la t√¢che, en un clic, vous n'avez rien √† chercher. </li><li>  Dans github - statut avec un lien vers la build, dans le commentaire du commit - un lien vers la t√¢che pour laquelle cette build a √©t√© faite.  Dans la t√¢che - un commentaire avec un lien vers la validation. </li><li>  Dans le service de distribution de build: lien vers la build, lien vers la validation. </li></ul><br>  Il n'y a rien √† retenir, mais vous avez compris l'id√©e: des liens vers tout, partout.  Cela acc√©l√®re consid√©rablement l'√©tude de toute situation incompr√©hensible. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/94d/4dc/1a0/94d4dc1a015d9f068e9c5dce0461b17a.png"></div><h2>  Ferme </h2><br>  Nous collectons et testons des versions pour toutes les plateformes.  Pour cela, nous avons besoin de nombreux agents diff√©rents.  Leur suivi et leur maintenance manuellement sont longs et difficiles.  Tous les agents sont pr√©par√©s automatiquement.  Nous utilisons Packer et Ansible. <br><br>  Tous les journaux de tous les agents, Teamcity, tous les services qui sont autour, nous les enregistrons (dans notre cas - dans ELK).  Tous les services, traitant une build, ajoutent le num√©ro de cette build √† chaque ligne de journaux.  Nous pouvons voir dans une seule demande l'ensemble du cycle de vie de la build depuis son apparition dans la file d'attente jusqu'√† la fin de l'envoi de tous les rapports. <br><br>  Nous avons mis en place notre propre m√©canisme d'optimisation de file d'attente.  Celui de Teamcity ne fonctionne pas tr√®s bien avec nos chiffres.  En parlant de chiffres: <br><br><ul><li>  Nous collectons environ 5 000 versions chaque jour.  Cela repr√©sente environ 500 heures de travail. </li><li>  La trois millioni√®me construction remonte √† un mois. </li><li>  Nous avons plus de 50 serveurs de build dans 10 endroits diff√©rents. </li><li>  Plus de 40 appareils mobiles sur un banc d'essai. </li><li>  Exactement 1 serveur Teamcity. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e8/4eb/797/5e84eb79776709b09b73921f78cbb41a.png" width="500"></div><br><h2>  CI en tant que service </h2><br>  Playrix CI est un service.  Il y a beaucoup de projets, beaucoup d'id√©es aussi. <br><br>  Nous optimisons le temps entre la mise en file d'attente du build et la fin de son ex√©cution, car c'est exactement ce que le ¬´temps de build¬ª est consid√©r√© par l'utilisateur du service, le d√©veloppeur.  Cela nous permet de rechercher et de trouver un √©quilibre entre le temps de g√©n√©ration et le temps pass√© dans la file d'attente.  Il semble logique qu'avec la croissance de l'entreprise et le nombre de projets, la ferme de construction qui recueille ces projets grandira √©galement.  Mais gr√¢ce aux optimisations, le taux de croissance de la ferme est loin derri√®re le taux de croissance de l'entreprise. <br><br>  Toute optimisation commence par la surveillance, avec une collecte m√©thodique de statistiques.  Nous collectons beaucoup de statistiques et nous savons absolument tout sur nos builds.  Mais en plus du volume de la batterie de build, il existe √©galement une √©quipe qui prend en charge le syst√®me CI et fait en sorte que personne n'ait besoin de penser √† l'origine des builds. <br><br>  L'optimisation des processus dans cette √©quipe est √©galement un processus int√©ressant et divertissant.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par exemple, nous √©crivons des tests pour d√©finir des configurations de builds, car il y a beaucoup de ces configurations, sans tests similaires, il n'est pas facile de trouver tous les endroits qui doivent √™tre modifi√©s. </font><font style="vertical-align: inherit;">Pour presque tous les changements, nous √©crivons d'abord un test, puis nous les faisons, c'est-√†-dire, en fait, nous avons TDD. </font><font style="vertical-align: inherit;">Il existe de nombreux processus li√©s aux t√¢ches, √† la gestion des incidents et √† la planification du flux des t√¢ches entrantes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les d√©veloppeurs doivent se concentrer sur la cr√©ation de jeux g√©niaux et r√©ussis sans se soucier de l'origine des builds. </font><font style="vertical-align: inherit;">Pour cela, Playrix a un CI. </font><font style="vertical-align: inherit;">Il doit y avoir un objectif que vous souhaitez atteindre avec l'int√©gration continue, un probl√®me qui doit √™tre r√©solu. </font><font style="vertical-align: inherit;">Il est important de ne pas trouver de probl√®me, √† savoir de le trouver. </font><font style="vertical-align: inherit;">Et quand vous la trouverez, souvenez-vous de notre exp√©rience et faites mieux. </font><font style="vertical-align: inherit;">Et rappelez-vous: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CI ne dort jamais A bient√¥t </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">!</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/796/1f2/f01/7961f2f01ed13cee81c7ea0e604e7ace.png" width="500"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr479966/">https://habr.com/ru/post/fr479966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr479950/index.html">L'histoire des processeurs vid√©o, partie 4: l'av√®nement du GPU √† usage g√©n√©ral</a></li>
<li><a href="../fr479952/index.html">√Ä l'int√©rieur de shawarma: microservices, syst√®mes distribu√©s et Kafka. Partage de documents de Backend United # 5</a></li>
<li><a href="../fr479954/index.html">Tutoriel d'administration de Spring Boot</a></li>
<li><a href="../fr479958/index.html">Vuln√©rabilit√©s du micrologiciel et du processeur</a></li>
<li><a href="../fr479960/index.html">Le mod√®le de l'efficacit√© de la publicit√© m√©diatique pour les boutiques en ligne</a></li>
<li><a href="../fr479968/index.html">Le bureau de Nginx est perquisitionn√© en raison du proc√®s du groupe Rambler. Le service de presse plaignant a confirm√© le proc√®s</a></li>
<li><a href="../fr479970/index.html">Mille et un bogues d'interface utilisateur, ou comment aider un d√©veloppeur √† √©viter les erreurs d'interface utilisateur courantes</a></li>
<li><a href="../fr479972/index.html">Historique des correctifs Apple</a></li>
<li><a href="../fr479974/index.html">Attaques z√©ro clic: lorsque votre s√©curit√© ne d√©pend pas de vous</a></li>
<li><a href="../fr479978/index.html">Comme sans douleur, sans captcha et gratuitement pour apporter des extraits du Fonds f√©d√©ral des biens de l'√âtat du Registre d'√âtat unifi√© des droits de l'homme sous une forme lisible par l'homme (*)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>