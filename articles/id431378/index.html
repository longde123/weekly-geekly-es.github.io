<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç¶ üöµüèΩ üë∂üèº Seluruh kebenaran tentang RTOS. Artikel # 23. Antrian: pengantar dan layanan dasar üíñ üë®‚Äçüíº üßõüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Antrian disebutkan dalam salah satu artikel sebelumnya (# 5). Mereka menyediakan cara yang lebih fleksibel untuk mentransfer pesan sederhana antar tug...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Seluruh kebenaran tentang RTOS. Artikel # 23. Antrian: pengantar dan layanan dasar</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431378/"><img src="https://habrastorage.org/webt/oy/fg/jv/oyfgjvk1xivp4zfhajjwfzycshs.jpeg"><br><br>  Antrian disebutkan dalam salah satu artikel sebelumnya (# 5).  Mereka menyediakan cara yang lebih fleksibel untuk mentransfer pesan sederhana antar tugas dibandingkan dengan kotak surat. <br><a name="habracut"></a><br>  Artikel sebelumnya dalam seri: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 22.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kotak Surat: Layanan Tambahan dan Struktur Data</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 21.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kotak Surat: Pengantar dan Layanan Dasar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 20.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Semaphores: Layanan Tambahan dan Struktur Data</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 19.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Semaphores: pengantar dan layanan dasar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 18.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Grup Bendera Acara: Layanan Pembantu dan Struktur Data</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Grup Bendera Acara: Pengantar dan Layanan Dasar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sinyal</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Partisi Memori: Layanan dan Struktur Data</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagian memori: pengantar dan layanan dasar</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Struktur data tugas dan panggilan API yang tidak didukung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Layanan untuk bekerja dengan tugas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tugas: konfigurasi dan pengantar API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Penjadwal: fitur canggih dan pelestarian konteks</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Penjadwal: implementasi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Nucleus SE: Desain dan Penyebaran Internal</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Nucleus SE: Pendahuluan</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Layanan RTOS lainnya</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Interaksi tugas dan sinkronisasi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tugas, pengalihan konteks, dan interupsi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tugas dan Perencanaan</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RTOS: Struktur dan mode waktu-nyata</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel # 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RTOS: pengantar.</a> <br><br><h2>  Menggunakan Antrian </h2><br>  Dalam Nucleus SE, antrian didefinisikan selama fase build.  Aplikasi dapat memiliki hingga 16 antrian.  Jika tidak ada antrian dalam aplikasi, struktur data atau kode layanan yang terkait dengan antrian tidak termasuk dalam aplikasi. <br><br>  Antrian adalah seperangkat area dalam memori yang cukup besar untuk satu elemen jenis <b>ADDR</b> dan yang dapat diakses dengan aman sehingga beberapa tugas dapat menggunakannya.  Tugas dapat menulis data ke antrian sampai semua area penuh.  Tugas dapat membaca data dari antrian, dengan data biasanya masuk berdasarkan FIFO (First-in-First-Out).  Mencoba untuk menulis data ke antrian yang ramai atau untuk membaca data dari antrian kosong dapat mengakibatkan kesalahan atau jeda tugas, tergantung pada parameter panggilan API yang dipilih dan konfigurasi Nucleus SE. <br><br><h2>  Antrean dan tautan data </h2><br>  Nucleus SE mendukung saluran data, yang juga disebutkan dalam artikel sebelumnya (# 5) dan akan dibahas secara rinci di salah satu berikut ini.  Perbedaan utama antara antrian dan saluran adalah ukuran pesan.  Antrian berisi pesan yang terdiri dari satu variabel dari jenis <b>ADDR</b> (biasanya pointer).  Saluran ini berisi pesan-pesan berukuran sewenang-wenang, masing-masing untuk setiap saluran dalam aplikasi dan ditugaskan selama pengaturan parameter. <br><br><h2>  Pengaturan Antrian </h2><br><h3>  Jumlah antrian </h3><br>  Seperti kebanyakan objek Nucleus SE, konfigurasi antrian terutama dikendalikan oleh arahan <b>#define</b> dalam file <b>nuse_config.h</b> .  Parameter utama adalah <b>NUSE_QUEUE_NUMBER</b> , yang menentukan jumlah antrian yang dikonfigurasi dalam aplikasi.  Nilai default adalah nol (yaitu, tidak ada antrian dalam aplikasi) dan dapat mengambil nilai hingga 16. Nilai yang salah akan menyebabkan kesalahan selama kompilasi, yang akan dihasilkan selama verifikasi dalam file <b>nuse_config_check.h</b> (ini termasuk dalam file <b>nuse_config.c</b> dan dikompilasi bersama dengan itu), yang akan memicu arahan <b>#error</b> . <br><br>  Memilih nilai bukan nol berfungsi sebagai aktivator utama untuk antrian.  Parameter ini digunakan ketika mendefinisikan struktur data dan ukurannya tergantung pada nilainya (lebih lanjut tentang ini di artikel berikutnya).  Selain itu, nilai bukan nol mengaktifkan pengaturan API. <br><br><h3>  Aktifkan Panggilan API </h3><br>  Setiap fungsi API (panggilan utilitas) di Nucleus SE memiliki <b>#define</b> directive directive di <b>nuse_config.h</b> .  Untuk antrian, arahan ini adalah: <br><br><pre><code class="plaintext hljs">NUSE_QUEUE_SEND NUSE_QUEUE_RECEIVE NUSE_QUEUE_JAM NUSE_QUEUE_RESET NUSE_QUEUE_INFORMATION NUSE_QUEUE_COUNT</code> </pre> <br>  Secara default, mereka diatur ke <b>FALSE</b> , sehingga menonaktifkan semua panggilan layanan dan memblokir masuknya kode yang mengimplementasikannya.  Untuk mengkonfigurasi antrian dalam aplikasi, Anda harus memilih panggilan API yang diperlukan dan mengaturnya ke <b>TRUE</b> . <br><br>  Berikut ini adalah cuplikan kode dari file <b>nuse_config.h</b> : <br><br><pre> <code class="plaintext hljs">#define NUSE_QUEUE_NUMBER 0 /* Number of queues in the system - 0-16 */ /* Service call enablers */ #define NUSE_QUEUE_SEND FALSE #define NUSE_QUEUE_RECEIVE FALSE #define NUSE_QUEUE_JAM FALSE #define NUSE_QUEUE_RESET FALSE #define NUSE_QUEUE_INFORMATION FALSE #define NUSE_QUEUE_COUNT FALSE</code> </pre><br>  Jika fungsi API antrian diaktifkan, tetapi tidak ada antrian dalam aplikasi (kecuali untuk <b>NUSE_Queue_Count ()</b> , yang selalu diaktifkan), kesalahan kompilasi akan muncul.  Jika kode Anda menggunakan panggilan API yang belum diaktifkan, ini akan menyebabkan kesalahan tata letak karena kode implementasi tidak termasuk dalam aplikasi. <br><br><h2>  Panggil Antrian </h2><br>  Nucleus RTOS mendukung sepuluh panggilan layanan antrian yang menyediakan fungsionalitas berikut: <br><br><ul><li>  Mengantri pesan.  Nucleus SE diimplementasikan dalam fungsi <b>NUSE_Queue_Send ()</b> . </li><li>  Menerima pesan dari antrian.  Nucleus SE mengimplementasikan fungsi <b>NUSE_Queue_Receive ()</b> . </li><li>  Posting ke kepala antrian.  Di Nucleus SE, diterapkan di <b>NUSE_Queue_Jam ()</b> . </li><li>  Mengembalikan antrian ke status yang tidak digunakan dengan melepaskan semua tugas yang ditangguhkan (reset).  Nucleus SE diimplementasikan di <b>NUSE_Queue_Reset ()</b> . </li><li>  Memberikan informasi tentang antrian tertentu.  Nucleus SE diimplementasikan dalam <b>NUSE_Queue_Information ()</b> . </li><li>  Mengembalikan jumlah antrian yang saat ini dikonfigurasi dalam aplikasi.  Di Nucleus SE, diterapkan di <b>NUSE_Queue_Count ()</b> . </li><li>  Menambahkan antrian baru ke aplikasi (membuat antrian).  Nucleus SE tidak diimplementasikan. </li><li>  Menghapus antrian dari aplikasi.  Nucleus SE tidak diimplementasikan. </li><li>  Kembalikan pointer ke semua antrian dalam aplikasi.  Nucleus SE tidak diimplementasikan. </li><li>  Mengirim pesan ke semua tugas yang ditangguhkan dalam antrian (siaran).  Nucleus SE tidak diimplementasikan. </li></ul><br>  Implementasi dari masing-masing panggilan overhead ini dijelaskan secara rinci di bawah ini. <br><br><h2>  Panggilan layanan untuk menulis dan membaca dari antrian </h2><br>  Operasi dasar yang dilakukan pada antrian adalah menulis (yang kadang-kadang disebut pesan antrian) dan membaca (juga dikenal sebagai menerima pesan).  Dimungkinkan juga untuk menulis ke awal antrian (jamming).  Nucleus RTOS dan Nucleus SE menyediakan tiga panggilan API dasar untuk operasi ini, yang akan dibahas di bawah ini. <br><br><h3>  Antrian </h3><br>  Panggilan utilitas Nucleus RTOS API untuk menulis ke antrian sangat fleksibel dan memungkinkan Anda untuk menjeda tugas secara implisit, atau dengan batas waktu tertentu jika operasi tidak dapat diselesaikan dengan segera (misalnya, ketika mencoba menulis ke antrian penuh).  Nucleus SE menyediakan fitur yang sama, tetapi tugas jeda adalah opsional dan batas waktu tidak diterapkan. <br><br>  <b><i>Sebut Antrian di Nucleus RTOS</i></b> <br><br>  Prototipe panggilan layanan: <br><br>  <b>STATUS NU_Send_To_Queue (NU_QUEUE * antrian, pesan VOID *, ukuran TANDA TANGAN, penangguhan TANDA TANGAN);</b> <br><br>  Parameter: <br><br>  <b>queue</b> - pointer ke blok kontrol antrian yang disediakan oleh pengguna; <br>  <b>message</b> - penunjuk ke pesan yang akan dikirim; <br>  <b>size</b> - jumlah elemen data <b>TANDA TANGAN</b> dalam pesan.  Jika antrian mendukung pesan dengan panjang variabel, parameter ini harus sama dengan ukuran pesan atau kurang dari ukuran pesan yang didukung oleh antrian.  Jika antrian mendukung pesan dengan ukuran tetap, parameter ini harus sama persis dengan ukuran pesan yang didukung oleh antrian; <br>  <b>menangguhkan</b> - spesifikasi penangguhan tugas, dapat mengambil nilai <b>NU_NO_SUSPEND</b> atau <b>NU_SUSPEND</b> atau nilai batas waktu. <br><br>  Nilai pengembalian: <br><br>  <b>NU_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NU_INVALID_QUEUE</b> - penunjuk antrian tidak valid; <br>  <b>NU_INVALID_POINTER</b> - null pointer ke pesan ( <b>NULL</b> ); <br>  <b>NU_INVALID_SIZE</b> - ukuran pesan tidak sesuai dengan ukuran pesan yang didukung oleh antrian; <br>  <b>NU_INVALID_SUSPEND</b> - penangguhan dilakukan dari utas yang tidak terkait tugas; <br>  <b>NU_QUEUE_FULL</b> - antrian penuh, dan penangguhan tidak ditentukan; <br>  <b>NU_TIMEOUT</b> - antrian penuh bahkan setelah tugas ditangguhkan untuk batas waktu yang ditentukan; <br>  <b>NU_QUEUE_DELETED</b> - antrian dihapus saat tugas ditangguhkan; <br>  <b>NU_QUEUE_RESET</b> - Antrian diatur ulang saat tugas ditangguhkan. <br><br>  <b><i>Mengantri pesan di Nucleus SE</i></b> <br>  Panggilan layanan API ini mendukung fungsionalitas inti API Nucleus RTOS. <br><br>  Prototipe panggilan layanan: <br><br>  <b>STATUS NUSE_Queue_Send (NUSE_QUEUE antrian, pesan ADDR *, U8 ditangguhkan);</b> <br><br>  Parameter: <br><br>  <b>antrian</b> - indeks <b>antrian</b> (ID); <br>  <b>message</b> - pointer ke pesan yang akan dikirim; itu adalah salah satu variabel dari jenis <b>ADDR</b> ; <br>  <b>menangguhkan</b> - spesifikasi untuk menjeda tugas, dapat mengambil nilai <b>NUSE_NO_SUSPEND atau NUSE_SUSPEND</b> . <br><br>  Nilai pengembalian: <br><br>  <b>NUSE_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NUSE_INVALID_QUEUE</b> - indeks antrian tidak valid; <br>  <b>NUSE_INVALID_POINTER</b> - null pointer ke pesan ( <b>NULL</b> ); <br>  <b>NUSE_INVALID_SUSPEND</b> - berupaya menjeda tugas dari utas yang tidak terkait dengan tugas atau saat panggilan layanan API dinonaktifkan untuk memblokir tugas; <br>  <b>NUSE_QUEUE_FULL</b> - antrian penuh dan penangguhan tidak ditentukan; <br>  <b>NUSE_QUEUE_WAS_RESET</b> - Antrian diatur ulang saat tugas ditangguhkan. <br><br>  <b><i>Terapkan Antrian di Nucleus SE</i></b> <br>  Varian kode fungsi API <b>NUSE_Queue_Send ()</b> (setelah memeriksa parameter) dipilih menggunakan kompilasi bersyarat, tergantung pada apakah dukungan untuk penguncian tugas diaktifkan atau tidak.  Kami akan mempertimbangkan kedua opsi tersebut. <br><br>  Jika penguncian tugas tidak diaktifkan, kode untuk panggilan layanan ini cukup sederhana: <br><br><pre> <code class="plaintext hljs">if (NUSE_Queue_Items[queue] == NUSE_Queue_Size[queue]) /* queue full */ { return_value = NUSE_QUEUE_FULL; } else /* queue element available */ { NUSE_Queue_Data[queue][NUSE_Queue_Head[queue]++] = *message; if (NUSE_Queue_Head[queue] == NUSE_Queue_Size[queue]) { NUSE_Queue_Head[queue] = 0; } NUSE_Queue_Items[queue]++; return_value = NUSE_SUCCESS; }</code> </pre><br>  Fungsi ini hanya memeriksa untuk melihat apakah ada ruang kosong dalam antrian, dan menggunakan indeks <b>NUSE_Queue_Head []</b> untuk menyimpan pesan di area data antrian. <br><br>  Jika penguncian tugas diaktifkan, kode menjadi lebih kompleks: <br><br><pre> <code class="plaintext hljs">do { if (NUSE_Queue_Items[queue] == NUSE_Queue_Size[queue]) /* queue full */ { if (suspend == NUSE_NO_SUSPEND) { return_value = NUSE_QUEUE_FULL; } else { /* block task */ NUSE_Queue_Blocking_Count[queue]++; NUSE_Suspend_Task(NUSE_Task_Active, (queue &lt;&lt; 4) | NUSE_QUEUE_SUSPEND); return_value = NUSE_Task_Blocking_Return[NUSE_Task_Active]; if (return_value != NUSE_SUCCESS) { suspend = NUSE_NO_SUSPEND; } } } else { /* queue element available */ NUSE_Queue_Data[queue][NUSE_Queue_Head[queue]++] = *message; if (NUSE_Queue_Head[queue] == NUSE_Queue_Size[queue]) { NUSE_Queue_Head[queue] = 0; } NUSE_Queue_Items[queue]++; if (NUSE_Queue_Blocking_Count[queue] != 0) { U8 index; /* check whether a task is blocked on this queue */ NUSE_Queue_Blocking_Count[queue]--; for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_QUEUE_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == queue)) { NUSE_Task_Blocking_Return[index] = NUSE_SUCCESS; NUSE_Wake_Task(index); break; } } } return_value = NUSE_SUCCESS; suspend = NUSE_NO_SUSPEND; } } while (suspend == NUSE_SUSPEND);</code> </pre><br>  Beberapa klarifikasi mungkin bermanfaat. <br><br>  Kode terlampir dalam <b>do ... while</b> , yang berjalan ketika parameter jeda tugas adalah <b>NUSE_SUSPEND</b> . <br><br>  Jika antrian penuh dan <b>penangguhan</b> adalah <b>NUSE_NO_SUSPEND</b> , panggilan API berakhir dengan <b>NUSE_QUEUE_FULL</b> .  Jika parameter penangguhan adalah <b>NUSE_SUSPEND</b> , tugas dihentikan sementara.  Setelah selesai (yaitu, ketika tugas dilanjutkan), jika nilai kembali adalah <b>NUSE_SUCCESS</b> , yaitu, tugas dilanjutkan karena pesan dibaca (dan bukan karena antrian diatur ulang), kode kembali ke awal loop. <br>  Jika antrian tidak penuh, pesan yang disediakan disimpan menggunakan indeks <b>NUSE_Queue_Head []</b> di area data antrian.  Ia memeriksa untuk melihat apakah ada tugas yang ditangguhkan (pesan menunggu) dalam antrian.  Jika ada tugas seperti itu, yang pertama dilanjutkan.  Variabel penangguhan diatur ke <b>NUSE_NO_SUSPEND</b> , dan panggilan API selesai dengan nilai <b>NUSE_SUCCESS</b> . <br><br><h3>  Membaca dari antrian </h3><br>  Panggilan utilitas Nucleus RTOS API untuk membaca dari antrian sangat fleksibel dan memungkinkan Anda untuk menjeda tugas secara implisit, atau dengan batas waktu tertentu jika operasi tidak dapat diselesaikan dengan segera (misalnya, ketika mencoba membaca dari antrian kosong).  Nucleus SE menyediakan fungsionalitas yang sama, tetapi tugas jeda adalah opsional dan batas waktu tidak diterapkan. <br><br>  <b><i>Panggilan untuk menerima pesan dari antrian di Nucleus RTOS</i></b> <br>  Prototipe panggilan layanan: <br><br>  <b>STATUS NU_Receive_From_Queue (NU_QUEUE * pesan, VOID * pesan, ukuran TANDA TANGAN, TANDA TANDA * actual_size, tunda sementara TANDA TANGAN);</b> <br><br>  Parameter: <br><br>  <b>queue</b> - pointer ke blok kontrol antrian yang disediakan oleh pengguna; <br>  <b>message</b> - pointer ke penyimpanan untuk pesan yang diterima; <br>  <b>size</b> - jumlah elemen data <b>TANDA TANGAN</b> dalam pesan.  Nomor ini harus sesuai dengan ukuran pesan yang ditentukan ketika antrian dibuat; <br>  <b>menangguhkan</b> - spesifikasi penangguhan tugas, dapat mengambil nilai <b>NU_NO_SUSPEND</b> atau <b>NU_SUSPEND</b> atau nilai batas waktu. <br><br>  Nilai pengembalian: <br><br>  <b>NU_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NU_INVALID_QUEUE</b> - penunjuk antrian tidak valid; <br>  <b>NU_INVALID_POINTER</b> - null pointer ke pesan ( <b>NULL</b> ); <br>  <b>NU_INVALID_SUSPEND -</b> berupaya menjeda tugas dari utas yang tidak terkait dengan tugas; <br>  <b>NU_QUEUE_EMPTY</b> - antrian kosong, dan penangguhan tidak ditentukan; <br>  <b>NU_TIMEOUT</b> - menunjukkan bahwa antrian masih kosong, bahkan setelah tugas ditangguhkan untuk jangka waktu tertentu; <br>  <b>NU_QUEUE_DELETED</b> - antrian dihapus saat tugas ditangguhkan; <br>  <b>NU_QUEUE_RESET</b> - Antrian diatur ulang saat tugas ditangguhkan. <br><br>  <b><i>Panggilan untuk menerima pesan dari Nucleus SE Queue</i></b> <br>  Panggilan API ini mendukung fungsionalitas inti API Nucleus RTOS. <br><br>  Prototipe panggilan layanan: <br><br>  <b>STATUS NUSE_Queue_Receive (NUSE_QUEUE antrian, pesan ADDR *, U8 ditangguhkan);</b> <br><br>  Parameter: <br><br>  <b>antrian</b> - indeks <b>antrian</b> (ID); <br>  <b>message</b> - pointer ke repositori untuk pesan yang diterima, itu adalah salah satu variabel dari jenis <b>ADDR</b> ; <br>  <b>menangguhkan</b> - spesifikasi penangguhan tugas, dapat mengambil nilai <b>NUSE_NO_SUSPEND</b> atau <b>NUSE_SUSPEND</b> . <br><br>  Nilai pengembalian: <br><br>  <b>NUSE_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NUSE_INVALID_QUEUE</b> - indeks antrian tidak valid; <br>  <b>NUSE_INVALID_POINTER</b> - null pointer ke pesan ( <b>NULL</b> ); <br>  <b>NUSE_INVALID_SUSPEND</b> - upaya untuk menangguhkan tugas dari utas yang tidak terkait dengan tugas atau dengan dukungan yang dinonaktifkan untuk pemblokiran tugas; <br>  <b>NUSE_QUEUE_EMPTY</b> - antrian kosong, dan penangguhan tidak ditentukan; <br>  <b>NUSE_QUEUE_WAS_RESET</b> - Antrian diatur ulang saat tugas ditangguhkan. <br><br>  <b><i>Implementasi menerima pesan dari antrian di Nucleus SE</i></b> <br>  Varian kode fungsi API <b>NUSE_Queue_Receive ()</b> (setelah memeriksa parameter) dipilih menggunakan kompilasi bersyarat, tergantung pada apakah dukungan untuk penguncian tugas diaktifkan atau tidak.  Pertimbangkan kedua opsi tersebut. <br><br>  Jika dukungan kunci diaktifkan, kode untuk panggilan API ini cukup sederhana: <br><br><pre> <code class="plaintext hljs">if (NUSE_Queue_Items[queue] == 0) /* queue empty */ { return_value = NUSE_QUEUE_EMPTY; } else { /* message available */ *message = NUSE_Queue_Data[queue][NUSE_Queue_Tail[queue]++]; if (NUSE_Queue_Tail[queue] == NUSE_Queue_Size[queue]) { NUSE_Queue_Tail[queue] = 0; } NUSE_Queue_Items[queue]--; return_value = NUSE_SUCCESS; }</code> </pre><br>  Fungsi ini hanya memeriksa untuk melihat apakah ada pesan dalam antrian, dan menggunakan indeks <b>NUSE_Queue_Tail []</b> untuk mengambil pesan dari antrian dan mengembalikan data menggunakan pointer ke pesan. <br><br>  Jika penguncian tugas diaktifkan, kode menjadi lebih kompleks: <br><br><pre> <code class="plaintext hljs">do { if (NUSE_Queue_Items[queue] == 0) /* queue empty */ { if (suspend == NUSE_NO_SUSPEND) { return_value = NUSE_QUEUE_EMPTY; } else { /* block task */ NUSE_Queue_Blocking_Count[queue]++; NUSE_Suspend_Task(NUSE_Task_Active, (queue &lt;&lt; 4) | NUSE_QUEUE_SUSPEND); return_value = NUSE_Task_Blocking_Return[NUSE_Task_Active]; if (return_value != NUSE_SUCCESS) { suspend = NUSE_NO_SUSPEND; } } } else { /* message available */ *message = NUSE_Queue_Data[queue][NUSE_Queue_Tail[queue]++]; if (NUSE_Queue_Tail[queue] == NUSE_Queue_Size[queue]) { NUSE_Queue_Tail[queue] = 0; } NUSE_Queue_Items[queue]--; if (NUSE_Queue_Blocking_Count[queue] != 0) { U8 index; /* check whether a task is blocked */ /* on this queue */ NUSE_Queue_Blocking_Count[queue]--; for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { if ((LONIB(NUSE_Task_Status[index]) == NUSE_QUEUE_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == queue)) { NUSE_Task_Blocking_Return[index] = NUSE_SUCCESS; NUSE_Wake_Task(index); break; } } } return_value = NUSE_SUCCESS; suspend = NUSE_NO_SUSPEND; } } while (suspend == NUSE_SUSPEND);</code> </pre><br>  Beberapa klarifikasi akan sangat membantu. <br><br>  Kode terlampir dalam <b>do ... while</b> , yang berjalan ketika parameter jeda tugas adalah <b>NUSE_SUSPEND</b> . <br><br>  Jika antriannya kosong dan ditangguhkan adalah <b>NUSE_NO_SUSPEND</b> , panggilan API berakhir dengan <b>NUSE_QUEUE_EMPTY</b> .  Jika parameter <b>penangguhan</b> adalah <b>NUSE_SUSPEND</b> , tugas dihentikan sementara.  Setelah selesai (yaitu, ketika tugas dilanjutkan), jika nilai kembali adalah <b>NUSE_SUCCESS</b> , yaitu, tugas dilanjutkan karena pesan dikirim (dan bukan karena antrian diatur ulang), kode kembali ke awal loop. <br><br>  Jika antrian berisi pesan, pesan yang disimpan dikembalikan menggunakan indeks <b>NUSE_Queue_Tail []</b> .  Ia memeriksa untuk melihat apakah ada tugas yang dijeda (tertunda) dalam antrian ini.  Jika ada tugas seperti itu, yang pertama dilanjutkan.  Variabel penangguhan diatur ke <b>NUSE_NO_SUSPEND</b> , dan panggilan API berakhir dengan kode <b>NUSE_SUCCESS</b> . <br><br><h3>  Menulis ke kepala antrian </h3><br>  Panggilan utilitas Nucleus RTOS API untuk menulis pesan ke kepala antrian sangat fleksibel dan memungkinkan Anda untuk menjeda tugas secara implisit, atau dengan batas waktu tertentu jika operasi tidak dapat diselesaikan dengan segera (misalnya, ketika mencoba menulis ke antrian ramai).  Nucleus SE menyediakan fungsionalitas yang sama, tetapi tugas jeda adalah opsional, dan batas waktu tidak diterapkan. <br><br>  <b><i>Panggilan untuk menulis pesan ke kepala antrian Nucleus RTOS</i></b> <br>  Prototipe panggilan layanan: <br><br>  <b>STATUS NU_Send_To_Front_Of_Queue (NU_QUEUE * antrian, pesan VOID *, ukuran UNSIGNED, suspend UNSIGNED);</b> <br><br>  Parameter: <br><br>  <b>queue</b> - pointer ke blok kontrol antrian yang disediakan oleh pengguna; <br>  <b>message</b> - penunjuk ke pesan yang akan dikirim; <br>  <b>size</b> - jumlah elemen data <b>TANDA TANGAN</b> dalam pesan.  Jika antrian mendukung pesan panjang variabel, parameter ini harus sama dengan ukuran pesan atau lebih kecil dari ukuran pesan yang didukung oleh antrian.  Jika antrian mendukung pesan dengan panjang tetap, parameter ini harus sama persis dengan ukuran pesan yang didukung oleh antrian; <br>  <b>menangguhkan</b> - spesifikasi penangguhan tugas, dapat mengambil nilai <b>NU_NO_SUSPEND</b> atau <b>NU_SUSPEND</b> atau nilai batas waktu. <br><br>  Nilai pengembalian: <br><br>  <b>NU_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NU_INVALID_QUEUE</b> - penunjuk antrian tidak valid; <br>  <b>NU_INVALID_POINTER</b> - null pointer ke pesan ( <b>NULL</b> ); <br>  <b>NU_INVALID_SIZE</b> - ukuran pesan tidak sesuai dengan ukuran pesan yang didukung oleh antrian; <br>  <b>NU_INVALID_SUSPEND</b> - berupaya menjeda dari aliran non-tugas <br>  <b>NU_QUEUE_FULL</b> - antrian penuh, dan penangguhan tidak ditentukan; <br>  <b>NU_TIMEOUT</b> - antrian penuh, bahkan setelah tugas ditangguhkan untuk batas waktu tertentu; <br>  <b>NU_QUEUE_DELETED</b> - antrian dihapus saat tugas ditangguhkan; <br>  <b>NU_QUEUE_RESET</b> - Antrian diatur ulang saat tugas ditangguhkan. <br><br>  <b><i>Panggilan untuk menulis pesan ke kepala antrian di Nucleus SE</i></b> <br>  Panggilan API ini mendukung fungsionalitas inti API Nucleus RTOS. <br><br>  Prototipe panggilan layanan: <br><br>  <b>STATUS NUSE_Queue_Jam (NUSE_QUEUE antrian, pesan ADDR *, U8 ditangguhkan);</b> <br><br>  Parameter: <br><br>  <b>antrian</b> - indeks <b>antrian</b> (ID); <br>  <b>message</b> - pointer ke sebuah pesan, adalah salah satu variabel dari tipe <b>ADDR</b> ; <br>  <b>menangguhkan</b> - spesifikasi penangguhan tugas, dapat mengambil nilai <b>NUSE_NO_SUSPEND</b> atau <b>NUSE_SUSPEND</b> . <br><br>  Nilai pengembalian: <br><br>  <b>NUSE_SUCCESS</b> - panggilan berhasil diselesaikan; <br>  <b>NUSE_INVALID_QUEUE</b> - indeks antrian tidak valid; <br>  <b>NUSE_INVALID_POINTER</b> - null pointer ke pesan ( <b>NULL</b> ); <br>  <b>NUSE_INVALID_SUSPEND</b> - upaya untuk menangguhkan tugas dari utas yang tidak terkait dengan tugas atau dengan dukungan yang dinonaktifkan untuk pemblokiran tugas; <br>  <b>NUSE_QUEUE_FULL</b> - antrian penuh dan penangguhan tidak ditentukan; <br>  <b>NUSE_QUEUE_WAS_RESET</b> - Antrian diatur ulang saat tugas ditangguhkan. <br><br>  <b><i>Menerapkan Catatan Top Antrian di Nucleus SE</i></b> <br>  Varian kode fungsi API <b>NUSE_Queue_Jam ()</b> sangat mirip dengan <b>NUSE_Queue_Send ()</b> , hanya data yang disimpan menggunakan indeks <b>NUSE_Queue_Tail []</b> , dengan demikian: <br><br><pre> <code class="plaintext hljs">if (NUSE_Queue_Items[queue] == NUSE_Queue_Size[queue]) /* queue full */ { return_value = NUSE_QUEUE_FULL; } else /* queue element available */ { if (NUSE_Queue_Tail[queue] == 0) { NUSE_Queue_Tail[queue] = NUSE_Queue_Size[queue] - 1; } else { NUSE_Queue_Tail[queue]--; } NUSE_Queue_Data[queue][NUSE_Queue_Tail[queue]] = *message; NUSE_Queue_Items[queue]++; return_value = NUSE_SUCCESS; }</code> </pre><br>  Artikel selanjutnya akan melihat panggilan API tambahan yang terkait dengan antrian, serta struktur data. <br><br>  <b>Tentang Pengarang:</b> Colin Walls telah bekerja di industri elektronik selama lebih dari tiga puluh tahun, mencurahkan sebagian besar waktunya untuk firmware.  Dia sekarang adalah seorang insinyur firmware di Mentor Embedded (sebuah divisi dari Mentor Graphics).  Colin Walls sering berbicara di konferensi dan seminar, penulis berbagai artikel teknis dan dua buku tentang firmware.  Tinggal di Inggris.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Blog</a> profesional <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Colin</a> , email: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id431378/">https://habr.com/ru/post/id431378/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id431362/index.html">Bagaimana seorang desainer bisa menyingkirkan rutinitas dan tetap tertarik pada pekerjaannya?</a></li>
<li><a href="../id431370/index.html">Laporan tercepat di barat liar. Dan beberapa bug di samping ...</a></li>
<li><a href="../id431372/index.html">Mengganggu dari perangkat eksternal dalam sistem x86. Bagian 2. Opsi boot kernel Linux</a></li>
<li><a href="../id431374/index.html">Penilaian terakhir: analisis indikator keuangan permainan di akses awal</a></li>
<li><a href="../id431376/index.html">Migrasi data di perusahaan berdarah: apa yang harus dianalisis, agar tidak membanjiri proyek</a></li>
<li><a href="../id431380/index.html">Mitap Netologiya dan Skyeng tentang soft skill "Apa yang perlu diketahui pengembang kecuali kode"</a></li>
<li><a href="../id431382/index.html">Hasil Survei Ekosistem JVM</a></li>
<li><a href="../id431384/index.html">CLion 2018.3: pengembangan jarak jauh, profiling kode, kinerja, dan lainnya</a></li>
<li><a href="../id431388/index.html">Dunia melalui mata mobil. Bagaimana drone melihatnya?</a></li>
<li><a href="../id431390/index.html">Tren digital 2019 dan dampaknya terhadap perubahan perilaku konsumen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>