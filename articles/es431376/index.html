<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê¶ üëÇ üö¥üèº Migraci√≥n de datos en la empresa sangrienta: qu√© analizar para no abrumar al proyecto ü§¨ üêá ü¶ç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Un proyecto de integraci√≥n de sistemas t√≠pico para nosotros se ve as√≠: el cliente tiene un conjunto de sistemas para clientes de contabilidad, la tare...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Migraci√≥n de datos en la empresa sangrienta: qu√© analizar para no abrumar al proyecto</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hflabs/blog/431376/"><img src="https://habrastorage.org/webt/yk/_w/ry/yk_wry8j7irc6ma2zn65mdw0ulq.jpeg"><br><br>  Un proyecto de integraci√≥n de sistemas t√≠pico para nosotros se ve as√≠: el cliente tiene un conjunto de sistemas para clientes de contabilidad, la tarea es recopilar las tarjetas de los clientes en una sola base de datos.  Y no solo para recolectar, sino tambi√©n para eliminar duplicados y basura.  Para obtener tarjetas de clientes limpias, estructuradas y completas. <br><br>  Para los principiantes, explicar√© que la migraci√≥n se realiza de acuerdo con este esquema: <i>fuentes ‚Üí conversi√≥n de datos ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ETL</a> o respuestas de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bus</a> ) ‚Üí receptor</i> . <br><br>  En un proyecto, perdimos tres meses simplemente porque un equipo de integradores de terceros no estudi√≥ los datos en los sistemas fuente.  Lo m√°s molesto fue que esto podr√≠a haberse evitado. <br><a name="habracut"></a><br>  Trabajaron as√≠: <br><br><ol><li>  Los integradores de sistemas personalizan el proceso ETL. </li><li>  ETL transforma los datos de origen y me los da. </li><li>  Estudio la descarga y env√≠o errores a los integradores. </li><li>  Los integradores corrigen los ETL y comienzan la migraci√≥n nuevamente. </li></ol><br>  En el art√≠culo mostrar√© c√≥mo analizar datos durante la integraci√≥n del sistema.  Estudi√© cargas ETL, fue muy √∫til.  Pero en los datos de origen, las mismas t√©cnicas acelerar√≠an el trabajo dos veces. <br><br>  Las sugerencias ser√°n √∫tiles para probadores, implementadores de productos empresariales, integradores de sistemas y analistas.  Las recepciones son universales para las bases de datos relacionales, y se divulgan completamente en vol√∫menes de un mill√≥n de clientes. <br><br>  Pero primero, sobre uno de los principales mitos de la integraci√≥n de sistemas. <br><br><h2>  La documentaci√≥n y el arquitecto ayudar√°n (en realidad no) </h2><br>  Los integradores a menudo no estudian los datos antes de la migraci√≥n; ahorran tiempo.  Leen la documentaci√≥n, miran la estructura, hablan con el arquitecto, y eso es suficiente.  Despu√©s de eso, ya est√°n planeando la integraci√≥n. <br><br>  Resulta malo  Solo el an√°lisis mostrar√° lo que realmente est√° sucediendo en la base de datos.  Si no ingresa a los datos con mangas enrolladas y una lupa, la migraci√≥n saldr√° mal. <br><br>  <b>La documentaci√≥n est√° mintiendo.</b>  Un sistema empresarial t√≠pico funciona de 5 a 20 a√±os.  Todos estos a√±os, los cambios han sido documentados por varios departamentos y contratistas.  Cada uno con su propio campanario.  Por lo tanto, no hay integridad en la documentaci√≥n, nadie comprende completamente la l√≥gica y la estructura del almacenamiento de datos.  Sin mencionar que los plazos siempre est√°n vigentes y no hay suficiente tiempo para la documentaci√≥n. <br><br>  Una historia com√∫n: en la tabla de clientes hay un campo "SNILS", en papel es muy importante.  Pero cuando miro los datos, veo que el campo est√° vac√≠o.  Como resultado, el cliente acepta que la base objetivo no tendr√° un campo para SNILS, ya que todav√≠a no hay datos. <br><br>  Un caso especial de documentaci√≥n son las regulaciones y las descripciones de los procesos comerciales: c√≥mo los datos ingresan a la base de datos, en qu√© circunstancias, en qu√© formato.  Todo esto tampoco ayudar√°. <br><br>  <b>Los procesos comerciales son perfectos solo en papel.</b>  Temprano en la ma√±ana, el somnoliento operador Anatoly entra a la oficina del banco en las afueras de Vyksa.  Debajo de la ventana gritaron toda la noche, y por la ma√±ana Anatoly tuvo una pelea con la ni√±a.  Odia al mundo entero. <br><br>  Los nervios a√∫n no se han puesto en orden, y Anatoly lleva completamente el nombre del nuevo cliente al campo de apellido.  Se olvida por completo de su cumplea√±os: el "01.01.1900 g" predeterminado permanece en el formulario.  ¬°¬°¬°No me importan las regulaciones cuando todo alrededor es tan enfurecedor !!! <br><br>  El caos derrota los procesos comerciales que est√°n muy bien formados en papel. <br><br>  <b>Un arquitecto de sistemas no lo sabe todo.</b>  Se trata nuevamente de la venerable vida √∫til de los sistemas empresariales.  Con los a√±os que trabajan, los arquitectos han cambiado.  Incluso si habla con el actual, las decisiones de las anteriores ser√°n sorpresas durante el proyecto. <br><br>  Y aseg√∫rese: incluso un arquitecto agradable en todos los aspectos mantendr√° en secreto sus fakaps y muletas del sistema. <br><br>  La integraci√≥n "por instrumentos" sin an√°lisis de datos es un error.  Mostrar√© c√≥mo en HFLabs aprendemos datos a trav√©s de la integraci√≥n del sistema.  En el √∫ltimo proyecto, solo analic√© las cargas ETL.  Pero cuando el cliente da acceso a los datos de origen, definitivamente lo verifico de acuerdo con los mismos principios. <br><br><h2>  Campos rellenos y valores nulos </h2><br>  Las comprobaciones m√°s simples son la integridad de las tablas en general y la integridad de los campos individuales.  Estoy empezando con ellos. <br><br>  <b>Cu√°ntas filas totales hay en la tabla.</b>  La solicitud m√°s simple posible. <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt;;</code> </pre> <br>  Obtengo el primer resultado. <br><div class="scrollable-table"><table><tbody><tr><th>  Individuos </th><th>  Cantidad </th></tr><tr><td>  Total </td><td>  99 966 324 </td></tr></tbody></table></div>  Aqu√≠ miro la adecuaci√≥n de los datos.  Si solo dos millones de clientes llegaron a la descarga de un banco grande, entonces algo est√° claramente mal.  Pero mientras todo se ve como se esperaba, sigue adelante. <br><br>  <b>Cu√°ntas l√≠neas se llenan para cada campo por separado.</b>  Reviso todas las columnas de la tabla. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt;, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> &lt;column_name&gt; cnt <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>;</code> </pre> <br>  El primero se encontr√≥ con un campo de feliz cumplea√±os, e inmediatamente curioso: por alguna raz√≥n, los datos no llegaron en absoluto. <br><div class="scrollable-table"><table><tbody><tr><th>  Individuos </th><th>  Cantidad </th></tr><tr><td>  Total </td><td>  99 966 324 </td></tr><tr><td>  DR </td><td>  0 0 </td></tr></tbody></table></div>  Si todos los valores en el campo son "NULL" en la carga, lo primero que veo es el sistema de origen.  Quiz√°s los datos se almacenan all√≠ correctamente, pero se perdieron durante la migraci√≥n. <br><br>  Veo que en el sistema fuente los cumplea√±os est√°n en su lugar.  Voy a los integradores: muchachos, error.  Result√≥ que en el proceso ETL, la funci√≥n de decodificaci√≥n funcionaba incorrectamente.  El c√≥digo fue corregido, en la pr√≥xima carga revisaremos los cambios. <br><br>  Voy m√°s all√° al campo con el TIN. <br><div class="scrollable-table"><table><tbody><tr><th>  Individuos </th><th>  Cantidad </th></tr><tr><td>  Total </td><td>  99 966 324 </td></tr><tr><td>  DR </td><td>  0 0 </td></tr><tr><td>  TIN </td><td>  65 136 </td></tr></tbody></table></div>  Hay 100 millones de personas en la base de datos, y solo 65 mil est√°n llenos de TIN, esto es 0.07%.  Una ocupaci√≥n tan d√©bil es una se√±al de que el campo en la base del receptor puede no ser necesario en absoluto. <br><br>  Compruebo el sistema de origen, todo est√° correcto: los TIN son similares a los reales, pero casi no hay ninguno.  Entonces, no se trata de migraci√≥n.  Queda por averiguar si el cliente necesita un campo casi vac√≠o debajo del TIN en la base de datos de destino. <br><br>  Llegu√© a la bandera de eliminaci√≥n del cliente. <br><div class="scrollable-table"><table><tbody><tr><th>  Individuos </th><th>  Cantidad </th></tr><tr><td>  Total </td><td>  99 966 324 </td></tr><tr><td>  DR </td><td>  0 0 </td></tr><tr><td>  TIN </td><td>  65 136 </td></tr><tr><td>  Eliminar bandera </td><td>  0 0 </td></tr></tbody></table></div>  Las banderas est√°n vac√≠as.  ¬øPero qu√©, la empresa no elimina clientes?  Miro el sistema fuente, hablo con el cliente.  Resulta que s√≠: la bandera es formal, en lugar de eliminar clientes, sus cuentas se eliminan.  Sin cuentas, como si el cliente hubiera sido eliminado. <br><br>  En el sistema de destino, se requiere el indicador de cliente remoto, esta es una caracter√≠stica de la arquitectura.  Por lo tanto, si el cliente tiene cero cuentas en el sistema receptor, debe cerrarse mediante l√≥gica adicional o no importarse en absoluto.  Entonces, c√≥mo decide el cliente. <br><br>  El siguiente es la placa de direcci√≥n.  Por lo general, algo est√° mal con tales tablas, porque las direcciones son algo complicado, se ingresan de diferentes maneras. <br><br>  Verifico la integridad de los componentes de la direcci√≥n. <br><div class="scrollable-table"><table><tbody><tr><th>  Direcciones </th><th>  Cantidad </th></tr><tr><td>  Total </td><td>  254 803 976 </td></tr><tr><td>  Pais </td><td>  229 256 090 </td></tr><tr><td>  Indice </td><td>  46 834 777 </td></tr><tr><td>  Ciudad </td><td>  6 474 841 </td></tr><tr><td>  Calle </td><td>  894,040 </td></tr><tr><td>  Casa </td><td>  20 903 </td></tr></tbody></table></div>  Las direcciones no est√°n llenas de manera uniforme, pero es demasiado pronto para sacar conclusiones: primero le preguntar√© al cliente para qu√© son.  Si para la segmentaci√≥n por pa√≠s, todo est√° bien: hay suficientes datos.  Si se trata de listas de correo, entonces el problema es: las casas est√°n casi vac√≠as, no hay apartamentos. <br><br>  Como resultado, el cliente vio que el ETL estaba tomando direcciones de una tableta vieja e irrelevante.  Ella est√° en la base como un monumento.  Pero hay otra tabla, nueva y buena, los datos deben tomarse de ella. <br><br>  Durante el an√°lisis, completo los campos que enlazan a directorios con particularidad.  La condici√≥n "NO ES NULL" no funciona con ellos: en lugar de "NULL", la celda suele ser "0".  Por lo tanto, verifique los campos de referencia por separado. <br><br>  <b>Cambios en el relleno de campos.</b>  Entonces, verifiqu√© la ocupaci√≥n general y la ocupaci√≥n de cada campo.  Problemas encontrados, los integradores arreglaron el proceso ETL y comenzaron la migraci√≥n nuevamente. <br><br>  Ejecuto la segunda descarga para todos los pasos enumerados anteriormente.  Escribo estad√≠sticas en el mismo archivo para ver los cambios. <br><br>  Integridad de todos los campos. <br><div class="scrollable-table"><table><tbody><tr><th>  Individuos </th><th>  Descarga 1 </th><th>  Descargando 2 </th><th>  Delta </th></tr><tr><td>  Total </td><td>  99 966 324 </td><td>  94 847 160 </td><td>  -5 119 164 </td></tr></tbody></table></div>  Entre cargas, 5 millones de registros desaparecieron.  Voy a los integradores, hago preguntas t√≠picas: <br><br><ul><li>  "¬øPor qu√© se perdieron los registros?"; </li><li>  "¬øQu√© datos se descartaron?"; </li><li>  "¬øQu√© datos dejaste?" </li></ul><br>  Resulta que no hay problema: simplemente eliminaron a los clientes "t√©cnicos" de la nueva descarga.  Est√°n en la base de datos para pruebas, no son personas vivas.  Pero con la misma probabilidad, los datos podr√≠an perderse por error, esto sucede. <br><br>  Pero los cumplea√±os en la nueva descarga aparecieron, como esperaba. <br><div class="scrollable-table"><table><tbody><tr><th>  Individuos </th><th>  Descarga 1 </th><th>  Descargando 2 </th><th>  Delta </th></tr><tr><td>  Total </td><td>  99 966 324 </td><td>  94 847 160 </td><td>  -5 119 164 </td></tr><tr><td>  DR </td><td>  0 0 </td><td>  77 046 780 </td><td>  77 046 780 </td></tr></tbody></table></div>  Pero!  No necesariamente es bueno cuando los datos que faltaban anteriormente aparecieron repentinamente en una nueva carga.  Por ejemplo, los cumplea√±os se pueden completar con fechas predeterminadas; no hay nada de qu√© alegrarse.  Por lo tanto, siempre verifico qu√© datos vinieron. <br><br>  <i>Qu√© comprobar, en pocas palabras.</i> <i><br><br></i> <ol><li>  <i>El n√∫mero total de entradas en las tablas.</i>  <i>¬øEs esta cantidad adecuada a las expectativas?</i> </li><li>  <i>El n√∫mero de l√≠neas rellenas en cada campo.</i> </li><li>  <i>La relaci√≥n entre el n√∫mero de filas llenas en cada campo y el n√∫mero de filas en la tabla.</i>  <i>Si es demasiado peque√±o, esta es una ocasi√≥n para pensar si arrastrar el campo a la base objetivo.</i> </li></ol> <i><br></i>  <i>Repita los primeros tres pasos para cada carga.</i>  <i>Siga la din√°mica: d√≥nde y por qu√© ha aumentado o disminuido.</i> <br><br><h2>  Longitud de valores en campos de cadena </h2><br>  Sigo una de las reglas b√°sicas de las pruebas: compruebo los valores l√≠mite. <br><br>  <b>Qu√© valores son demasiado cortos.</b>  Entre los valores m√°s cortos est√° lleno de basura, por lo que es interesante excavar aqu√≠. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>(&lt;column_name&gt;) &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> <br>  De esta manera, verifico el nombre, n√∫mero de tel√©fono, TIN, OKVED, direcciones de sitios web.  Las tonter√≠as aparecen como "A * 1", "0", "11", "-" y "...". <br><br>  <b>¬øEst√° todo bien con los valores m√°ximos?</b>  Cerrar campo es un marcador del hecho de que los datos no se ajustaron durante la transferencia, y se cortaron autom√°ticamente.  MySQL resuelve esto famoso sin previo aviso.  Al mismo tiempo, parece que la migraci√≥n se realiz√≥ sin problemas. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>(&lt;column_name&gt;) = <span class="hljs-number"><span class="hljs-number">65</span></span>;</code> </pre> <br>  De esta manera, encontr√© en el campo con el tipo de documento la l√≠nea "Certificado de registro de la solicitud del inmigrante para su reconocimiento".  Ella les dijo a los integradores que la longitud del campo fue corregida. <br><br>  <b>C√≥mo se distribuyen los valores a lo largo de la longitud.</b>  En HFLabs, llamamos a la tabla de distribuci√≥n de longitud para las filas. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>(&lt;column_name&gt;), <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(&lt;column_name&gt;) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>(&lt;column_name&gt;);</code> </pre> <br>  Aqu√≠ busco anomal√≠as en la distribuci√≥n a lo largo de la longitud.  Por ejemplo, aqu√≠ hay una frecuencia para una tabla con direcciones de correo. <br><div class="scrollable-table"><table><tbody><tr><th>  Longitud </th><th>  Cantidad </th></tr><tr><td>  122 </td><td>  120 </td></tr><tr><td>  123 </td><td>  90 </td></tr><tr><td>  124 </td><td>  130 </td></tr><tr><td>  125 </td><td>  1100 </td></tr><tr><td>  126 </td><td>  70 </td></tr></tbody></table></div>  Los valores con una longitud de 125 son demasiados.  Miro la base de datos de origen y encuentro que, por alguna raz√≥n, algunas de las direcciones se cortaron a 125 caracteres hace tres a√±os.  En otros a√±os, todo est√° bien.  Voy con este problema al cliente y a los integradores, entendemos. <br><br>  <i>Qu√© comprobar, en pocas palabras.</i> <i><br><br></i> <ol><li>  <i>Los valores m√°s cortos en los campos de cadena.</i>  <i>A menudo, las l√≠neas de menos de tres caracteres son basura.</i> </li><li>  <i>Valores que "se apoyan" a lo largo del ancho del campo.</i>  <i>A menudo est√°n circuncidados.</i> </li><li>  <i>Anomal√≠as en la distribuci√≥n de filas a lo largo de la longitud.</i> </li></ol><br><h2>  Valores populares </h2><br>  Divido en tres categor√≠as los valores que se encuentran entre los m√°s populares: <br><br><ul><li>  <i>muy com√∫n</i> , como el nombre "Tatyana" o el segundo nombre "Vladimirovich".  Aqu√≠ debe recordarse que, en el caso general, Tatyana no deber√≠a ser 100 veces m√°s popular que Anna, e Ismail dif√≠cilmente puede ser m√°s popular que Egor; </li><li>  <i>basura</i> , como ".", "1", "-" y similares; </li><li>  <i>Predeterminado</i> en el formulario de entrada, como "01/01/1900" para fechas. </li></ul><br>  Dos de cada tres casos son marcadores del problema, es √∫til buscarlos. <br><br>  Busco valores populares en tres tipos de campos: <br><br><ol><li>  Campos de cadena ordinarios. </li><li>  Campos de cadena de referencia.  Estos son campos de cadena ordinarios, pero el n√∫mero de valores diferentes en ellos est√°, por supuesto, regulado.  Estos campos almacenan pa√≠ses, ciudades, meses, tipos de tel√©fono. </li><li>  Campos de clasificador: contienen un enlace a una entrada en una tabla de clasificador de terceros. </li></ol><br>  Estudio los campos de cada uno de estos tipos un poco diferente. <br><br>  <b>Para los campos de cadena: ¬øcu√°les son los 100 valores m√°s populares?</b>  Si lo desea, puede tomar m√°s, pero en los primeros cien valores generalmente se colocan todas las anomal√≠as. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt;, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) cnt <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROWNUM</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre> <br>  Compruebo los campos de esta manera: <br><br><ul><li>  Nombre completo, as√≠ como apellidos, nombres y patron√≠micos por separado; </li><li>  fechas de nacimiento y generalmente cualquier fecha; </li><li>  direcciones  Tanto la direcci√≥n completa como sus componentes individuales, si est√°n almacenados en la base de datos; </li><li>  Tel√©fonos </li><li>  serie, n√∫mero, tipo, lugar de emisi√≥n de documentos. </li></ul><br>  Casi siempre entre los valores populares: prueba y valores predeterminados, algunos trozos. <br><br><img src="https://habrastorage.org/webt/hl/sg/cr/hlsgcrpcy9y1i-gpyfoead8byzg.png"><br><br>  Sucede que el problema encontrado no es un problema en absoluto.  Una vez encontr√© un n√∫mero de tel√©fono sospechosamente popular en la base de datos.  Result√≥ que los clientes indicaron este n√∫mero como trabajadores, y en la base de datos simplemente hab√≠a muchos empleados de una organizaci√≥n. <br><br>  En el camino, dicho an√°lisis mostrar√° campos de referencia ocultos.  L√≥gicamente, se supone que estos campos no son directorios, pero de hecho est√°n en la base de datos.  Por ejemplo, selecciono valores populares del campo "Posici√≥n", y solo hay cinco de ellos. <br><div class="scrollable-table"><table><tbody><tr><th>  T√≠tulo del trabajo </th></tr><tr><td>  Director </td></tr><tr><td>  Contable </td></tr><tr><td>  Especialista </td></tr><tr><td>  Secretaria </td></tr><tr><td>  Administrador del sistema </td></tr></tbody></table></div>  Quiz√°s la compa√±√≠a solo sirve cinco profesiones.  No es muy cierto, ¬øverdad?  M√°s bien, en la forma para los operadores, en lugar de una l√≠nea, hicieron un directorio y olvidaron volcar valores.  La pregunta importante aqu√≠ es: ¬øes aconsejable completar las publicaciones a trav√©s del directorio?  Entonces, a trav√©s del an√°lisis de datos, salgo a posibles problemas con el software del operador. <br><br>  <b>Para los campos de referencia y clasificadores, verifico la popularidad de todos los valores.</b>  Para empezar, descubro qu√© campos son directorios.  No puedes seguir con los scripts, tomo la documentaci√≥n y pretendo serlo.  Por lo general, los directorios se crean para valores, cuyo n√∫mero es, por supuesto, y relativamente peque√±o: <br><br><ul><li>  pa√≠ses </li><li>  idiomas </li><li>  monedas </li><li>  meses </li><li>  la ciudad </li></ul><br>  En un mundo ideal, los contenidos de los campos de referencia son claros y consistentes.  Pero nuestro mundo no es as√≠, as√≠ que verifico con una solicitud. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt;, <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) cnt <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>;</code> </pre> <br>  Por lo general, en los campos de cadena de directorios se encuentra esto. <br><div class="scrollable-table"><table><tbody><tr><th>  Lugar de nacimiento </th><th>  Cantidad </th></tr><tr><td>  Tayikist√°n </td><td>  467 599 </td></tr><tr><td>  Tayikist√°n </td><td>  410 484 </td></tr><tr><td>  Rusia </td><td>  292,585 </td></tr><tr><td>  Tayikist√°n </td><td>  234,465 </td></tr><tr><td>  Rusia </td><td>  158 163 </td></tr><tr><td>  Rusia </td><td>  76 367 </td></tr></tbody></table></div>  Problemas comunes: <br><br><ul><li>  errores tipogr√°ficos </li><li>  espacios </li><li>  Caso diferente. </li></ul><br>  Habiendo encontrado un desastre, voy a los integradores con ejemplos a mano.  Perm√≠tales dejar basura en la fuente y eliminar las discrepancias.  Luego, en la base de datos de destino por rigor, ser√° posible convertir las l√≠neas de referencia en clasificadores. <br><br>  Compruebo los valores populares en los campos del clasificador para detectar la falta de opciones.  Ante tales casos. <br><div class="scrollable-table"><table><tbody><tr><th>  G√©nero </th><th>  Tipo de tel√©fono </th></tr><tr><td><ol><li>  Hembra </li><li>  No definido </li></ol></td><td><ol><li>  Inicio </li></ol></td></tr></tbody></table></div>  Dichos clasificadores se ven muy extra√±os, deben mostrarse al cliente.  Cada vez que tuve un error detr√°s de tales casos: o algo est√° mal en la base de datos, o los datos se descargaron del lugar equivocado. <br><br>  <i>Qu√© comprobar, en pocas palabras.</i> <i><br><br></i> <ol><li>  <i>Qu√© campos de cadena son de referencia y cu√°les no.</i> </li><li>  <i>Para campos de cadena simples, los principales valores populares.</i>  <i>Por lo general, en la basura superior y los datos predeterminados.</i> </li><li>  <i>Para los campos de referencia de cadena, la distribuci√≥n de todos los valores por popularidad.</i>  <i>La selecci√≥n mostrar√° discrepancias en los valores de referencia.</i> </li><li>  <i>Para clasificadores: ¬øhay suficientes opciones en la base de datos?</i> </li></ol><br><h2>  Consistencia y reconciliaci√≥n cruzada </h2><br>  Desde el an√°lisis de datos dentro de las tablas, paso al an√°lisis de las relaciones. <br><br>  <b>Si los datos est√°n destinados a estar relacionados.</b>  Llamamos a este par√°metro "consistencia".  Tomo la mesa subordinada, por ejemplo, con tel√©fonos.  Para ello en una pareja: la tabla principal de clientes.  Y veo cu√°ntos clientes en la tabla subordinada son identificadores que no est√°n en el padre. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;ID1&gt; <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name_1&gt;) <span class="hljs-keyword"><span class="hljs-keyword">MINUS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;ID2&gt; <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name_2&gt;));</code> </pre> <br>  Si la solicitud dio un delta, significa que no hubo suerte: hay datos no relacionados en la carga.  As√≠ que reviso las mesas con tel√©fonos, contratos, direcciones, facturas, etc.  Una vez, durante un proyecto, encontr√≥ 23 millones de n√∫meros que simplemente colgaban en el aire. <br><br>  Tambi√©n funciona en la direcci√≥n opuesta: estoy buscando clientes que por alguna raz√≥n no tienen un solo contrato, direcci√≥n o n√∫mero de tel√©fono.  A veces est√° bien, bueno, el cliente no tiene una direcci√≥n.  Aqu√≠ debe averiguarlo el cliente, la documentaci√≥n enga√±ar√° f√°cilmente. <br><br>  <b>¬øHay duplicaciones de claves primarias en diferentes tablas?</b>  A veces, las entidades id√©nticas se almacenan en tablas diferentes.  Por ejemplo, clientes heterosexuales.  (Nadie sabe por qu√©, porque Brezhnev todav√≠a reclam√≥ la estructura). Pero la tabla en el receptor es √∫nica, y al migrar, los identificadores del cliente entrar√°n en conflicto. <br><br>  Giro la cabeza y miro la estructura de la base: donde es posible la fragmentaci√≥n de entidades similares.  Pueden ser tablas de clientes, tel√©fonos de contacto, pasaportes, etc. <br><br>  Si hay varias tablas con entidades similares, hago una verificaci√≥n cruzada: compruebo la intersecci√≥n de los identificadores.  Intersecar: pegue un parche.  Por ejemplo, recopilamos identificadores para una sola tabla de acuerdo con el esquema "nombre de la tabla fuente + ID". <br><br>  <i>Qu√© comprobar, en pocas palabras.</i> <i><br><br></i> <ol><li>  <i>Cu√°ntos datos no relacionados hay en tablas vinculadas.</i> </li><li>  <i>¬øHay posibles conflictos clave primarios?</i> </li></ol><br><h2>  ¬øQu√© m√°s revisar? </h2><br>  <b>¬øHay caracteres latinos a los que no pertenecen?</b>  Por ejemplo, en apellidos. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REGEXP_LIKE</span></span>(&lt;column_name&gt;, <span class="hljs-string"><span class="hljs-string">'[AZ]'</span></span>, <span class="hljs-string"><span class="hljs-string">'i'</span></span>);</code> </pre> <br>  As√≠ que capto la maravillosa letra latina "C", que coincide con el cir√≠lico.  El error es desagradable, porque de acuerdo con el nombre con la "C" latina, el operador nunca encontrar√° un cliente. <br><br>  <b>¬øHay caracteres extra√±os en los campos de cadena destinados a n√∫meros?</b> <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> &lt;column_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> &lt;table_name&gt; <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REGEXP_LIKE</span></span>(&lt;column_name&gt;, <span class="hljs-string"><span class="hljs-string">'[^0-9]'</span></span>);</code> </pre> <br>  Aparecen problemas en los campos con el n√∫mero de pasaporte de la Federaci√≥n de Rusia o TIN.  Los tel√©fonos son iguales, pero all√≠ permito m√°s, corchetes y guiones.  La solicitud tambi√©n revelar√° la letra "O", que se estableci√≥ en lugar de cero. <br><br>  <b>Cu√°n adecuados son los datos.</b>  Nunca se sabe d√≥nde surgir√° el problema, as√≠ que siempre estoy en guardia.  Conoc√≠ tales casos: <br><br><ul><li>  <i>¬øEs ‚ÄúSofya Vladimirovna‚Äù un cliente de 50,000 tel√©fonos? ¬øEs esto normal?</i>  Respuesta: no es normal.  El cliente es t√©cnico, le pusieron n√∫meros de tel√©fono "sin due√±o" para enviar correos electr√≥nicos.  No es necesario llevar al cliente a una nueva base; </li><li>  <i>Los TIN se llenan, de hecho, la columna contiene "79853617764", "89109462345", "4956780966" y as√≠ sucesivamente.</i>  ¬øQu√© tipo de tel√©fonos, okuda?  ¬øD√≥nde est√° la posada?  Respuesta: qu√© tipo de n√∫meros, no se sabe qui√©n lo puso, no est√° claro.  Nadie los usa.  El TIN actual se almacena en otro campo de otra tabla, tomado de all√≠; </li><li>  <i>el campo "direcci√≥n en una l√≠nea" no corresponde a los campos en los que la direcci√≥n se almacena en partes.</i>  ¬øPor qu√© son diferentes las direcciones?  Respuesta: una vez que los operadores llenaron las direcciones con una l√≠nea, y el sistema externo clasific√≥ las direcciones en campos separados.  Para la segmentaci√≥n  A medida que pas√≥ el tiempo, las personas cambiaron de direcci√≥n.  Los operadores los actualizaban regularmente, pero solo como una cadena: la direcci√≥n segu√≠a siendo antigua en algunas partes. </li></ul><br><h2>  Todo lo que necesitas es SQL y Excel </h2><br>  Para analizar datos, no se necesita un software costoso.  Suficiente Excel y conocimiento de SQL. <br><br>  Excel uso para compilar una consulta larga.  Por ejemplo, verifico si los campos est√°n completos y hay 140 en la tabla. Escribir√© con las manos antes de la conspiraci√≥n de la zanahoria, as√≠ que recojo la solicitud con las f√≥rmulas en la placa de Excel. <br><br><img src="https://habrastorage.org/webt/ww/m3/br/wwm3br0qxpp7gudattxhkxnx1fm.png"><br>  <sub>En la columna "A" inserto los nombres de los campos, los tomo en la documentaci√≥n o en las tablas de servicio.</sub>  <sub>En la columna "B": una f√≥rmula para pegar una solicitud</sub> <br><br>  Inserto los nombres de los campos, escribo la primera f√≥rmula en la columna "B", doblo la esquina y listo. <br><br><img src="https://habrastorage.org/webt/1r/ld/ct/1rldctxhypv2xw3era05-lkixhu.gif"><br>  <sub>Funciona en Excel, y en Google Docs, y en Excel Online (disponible en Yandex.Disk)</sub> <br><br>  El an√°lisis de datos ahorra el autom√≥vil del tiempo y los nervios de los gerentes.  Con ella es m√°s f√°cil cumplir con la fecha l√≠mite.  Si el proyecto es grande, el an√°lisis ahorrar√° millones de rublos y una reputaci√≥n. <br><br><h2>  No n√∫meros, sino conclusiones </h2><br>  Ella formul√≥ una regla para s√≠ misma: no mostrar n√∫meros desnudos al cliente, todav√≠a no obtendr√° el efecto.  Mi tarea es analizar los datos y sacar conclusiones, y adjuntar los n√∫meros como evidencia.  Las conclusiones son primarias, los n√∫meros son secundarios. <br><br>  Lo que recojo para el informe: <br><br><ul><li>  <i>La redacci√≥n de los problemas en forma de hip√≥tesis o pregunta</i> : ‚ÄúEl TIN se llena en un 0.07%.  ¬øC√≥mo utiliza estos datos, qu√© tan relevante es, c√≥mo interpretarlos?  ¬øHay solo un INN en una mesa?  No puede culpar: "Su TIN no est√° lleno en absoluto".  En respuesta, recibir√°s solo agresi√≥n; </li><li>  <i>ejemplos de problemas</i>  Estas son las tabletas de las cuales hay tantas en el art√≠culo; </li><li>  <i>opciones sobre c√≥mo hacerlo:</i> "Puede valer la pena eliminar el TIN de la base objetivo para no producir campos vac√≠os". </li></ul><br>  No tengo derecho a decidir qu√© elegir exactamente de la base de datos de origen y c√≥mo cambiar los datos durante la migraci√≥n.  Por lo tanto, con el informe, voy al cliente o a los integradores, y descubrimos c√≥mo proceder. <br><br>  A veces, el cliente, al ver el problema, responde: ‚ÄúNo se preocupe, no preste atenci√≥n.  Compraremos un terabyte extra de memoria, eso es todo.  Es m√°s barato que optimizar ".  No puede aceptar esto: si toma todo en una fila, no habr√° calidad en el receptor.  Se est√°n migrando los mismos datos redundantes basura. <br><br>  Por lo tanto, le preguntamos de manera suave pero constante: "D√≠ganos c√≥mo utilizar√° estos datos en particular en el sistema de destino".  No "por qu√© lo necesita", es decir, "c√≥mo lo va a utilizar".  Las respuestas "entonces se nos ocurrir√°n" o "por si acaso" no son adecuadas.  Tarde o temprano, el cliente comprende qu√© datos se pueden prescindir. <br><br>  Lo principal es encontrar y resolver todos los problemas hasta que el sistema se inicie en prod.  Para cambiar la arquitectura y el modelo de datos con vida, perder√° la cabeza. <br><br>  Eso es todo con comprobaciones b√°sicas, ¬°estudia los datos! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es431376/">https://habr.com/ru/post/es431376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es431360/index.html">Explicar la puerta trasera en event-stream</a></li>
<li><a href="../es431362/index.html">¬øC√≥mo puede un dise√±ador deshacerse de la rutina y mantener el inter√©s en su trabajo?</a></li>
<li><a href="../es431370/index.html">Los informes m√°s r√°pidos en el salvaje oeste. Y un pu√±ado de errores adem√°s ...</a></li>
<li><a href="../es431372/index.html">Interrupciones de dispositivos externos en un sistema x86. Parte 2. Opciones de arranque del kernel de Linux</a></li>
<li><a href="../es431374/index.html">Juicio final: an√°lisis de indicadores financieros del juego en acceso temprano</a></li>
<li><a href="../es431378/index.html">Toda la verdad sobre RTOS. Art√≠culo 23. Colas: introducci√≥n y servicios b√°sicos.</a></li>
<li><a href="../es431380/index.html">Mitap Netologiya y Skyeng sobre habilidades blandas "Lo que un desarrollador necesita saber excepto el c√≥digo"</a></li>
<li><a href="../es431382/index.html">Resultados de la encuesta de ecosistemas de JVM</a></li>
<li><a href="../es431384/index.html">CLion 2018.3: desarrollo remoto, creaci√≥n de perfiles de c√≥digo, rendimiento y m√°s</a></li>
<li><a href="../es431388/index.html">El mundo a trav√©s de los ojos de un autom√≥vil. ¬øC√≥mo lo ven los drones?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>