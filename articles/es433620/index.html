<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéª üçç üìö C√≥mo funciona SystemUI en Android ü§∏ üö∞ ‚úÇÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo, analizar√© la arquitectura y el principio de funcionamiento de la aplicaci√≥n principal de Android: SystemUI. Me interes√≥ este tema, p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo funciona SystemUI en Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433620/"><img src="https://habrastorage.org/webt/ku/m2/2u/kum22urbaazxg7rq-uvmucnkbm8.png"><br><br>  En este art√≠culo, analizar√© la arquitectura y el principio de funcionamiento de la aplicaci√≥n principal de Android: SystemUI.  Me interes√≥ este tema, porque me pregunto c√≥mo funciona el sistema, que utilizan tantos usuarios y para el que miles de aplicaciones se descargan diariamente en Google Play o simplemente en Internet.  Adem√°s, estoy interesado en el problema de seguridad de la informaci√≥n de Android y las aplicaciones creadas para √©l. <br><br>  En Android, SystemUI es una aplicaci√≥n cuya ruta de c√≥digo fuente est√° en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">platform_frameworks_base / packages / SystemUI /</a> , en el dispositivo est√° en system / priv-app / -SystemUI. <br><br><a name="habracut"></a>  La aplicaci√≥n priv es el directorio donde se almacenan las aplicaciones privilegiadas.  Por cierto, en la ruta del sistema / aplicaci√≥n hay aplicaciones preinstaladas, y las aplicaciones comunes que instalamos en nuestro dispositivo se almacenan en datos / aplicaci√≥n. <br><br>  Esto plantea inmediatamente la pregunta: ¬øpor qu√© no todas las aplicaciones preinstaladas y privilegiadas se pueden insertar en un directorio, por qu√© es necesaria esta separaci√≥n? <br><br>  El hecho es que algunas aplicaciones son m√°s sist√©micas que otras :) Y esta separaci√≥n es necesaria para reducir la cobertura de explotaci√≥n de las aplicaciones del sistema, a fin de obtener acceso a operaciones protegidas.  Puede crear una aplicaci√≥n que tendr√° un ApplicationInfo.FLAG_SYSTEM especial y obtener m√°s derechos en el sistema, sin embargo, se colocar√° un archivo apk con este permiso en la secci√≥n del sistema. <br><br>  Entonces, SystemUI es un archivo apk, que es esencialmente una aplicaci√≥n normal.  Sin embargo, si observa el complejo dispositivo SystemUI, deja de parecer que es solo una aplicaci√≥n simple, ¬øverdad? <br><br><h4>  Esta aplicaci√≥n realiza funciones muy importantes: </h4><br><ul><li>  La navegaci√≥n </li><li>  Aplicaciones Recientes </li><li>  Ajustes r√°pidos </li><li>  Barra de notificaciones </li><li>  Pantalla de bloqueo </li><li>  Control de volumen </li><li>  Pantalla de inicio </li><li>  ... </li></ul><br><h3>  Iniciar SystemUI </h3><br>  Como dije anteriormente, SystemUI no es como una aplicaci√≥n normal, por lo que su lanzamiento no va acompa√±ado del lanzamiento de actividad, como es el caso con la mayor√≠a de las aplicaciones.  SystemUI es una <a href="">interfaz de usuario global</a> que se inicia durante el proceso de inicio del sistema y no se puede completar. <br><br><pre><code class="java hljs">&lt;application android:name=<span class="hljs-string"><span class="hljs-string">".SystemUIApplication"</span></span> android:persistent=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:allowClearUserData=<span class="hljs-string"><span class="hljs-string">"false"</span></span> android:allowBackup=<span class="hljs-string"><span class="hljs-string">"false"</span></span> android:hardwareAccelerated=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:label=<span class="hljs-string"><span class="hljs-string">"@string/app_label"</span></span> android:icon=<span class="hljs-string"><span class="hljs-string">"@drawable/icon"</span></span> android:process=<span class="hljs-string"><span class="hljs-string">"com.android.systemui"</span></span> android:supportsRtl=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:theme=<span class="hljs-string"><span class="hljs-string">"@style/Theme.SystemUI"</span></span> android:defaultToDeviceProtectedStorage=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:directBootAware=<span class="hljs-string"><span class="hljs-string">"true"</span></span> android:appComponentFactory=<span class="hljs-string"><span class="hljs-string">"androidx.core.app.CoreComponentFactory"</span></span>&gt;</code> </pre> <br>  Si entramos en SystemServer, que es uno de los dos pilares en el mundo de Android (el segundo es Zygote, pero hablar√© de eso en otro momento), entonces podemos encontrar el lugar donde se <a href="">inicia SystemUI</a> cuando se <a href="">inicia</a> el sistema. <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startSystemUi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, WindowManagerService windowManager)</span></span></span><span class="hljs-function"> </span></span>{ Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(); intent.setComponent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ComponentName(<span class="hljs-string"><span class="hljs-string">"com.android.systemui"</span></span>, <span class="hljs-string"><span class="hljs-string">"com.android.systemui.SystemUIService"</span></span>)); intent.addFlags(Intent.FLAG_DEBUG_TRIAGED_MISSING); <span class="hljs-comment"><span class="hljs-comment">//Slog.d(TAG, "Starting service: " + intent); context.startServiceAsUser(intent, UserHandle.SYSTEM); windowManager.onSystemUiStarted(); }</span></span></code> </pre> <br>  Aqu√≠ vemos c√≥mo el servicio SystemUI comienza a usar la API no p√∫blica startServiceAsUser.  Si quisieras usar esto, tendr√≠as que recurrir a la reflexi√≥n.  Pero si decide usar la API de reflexi√≥n en Android, piense algunas veces si vale la pena.  <s>Piensa cien veces :)</s> <br><br>  Entonces, aqu√≠ creamos un proceso separado para la aplicaci√≥n y, de hecho, cada secci√≥n de <a href="">SystemUI</a> es un servicio separado o un m√≥dulo independiente. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SystemUI</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SysUiServiceProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Context mContext; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Map&lt;Class&lt;?&gt;, Object&gt; mComponents; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onConfigurationChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Configuration newConfig)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dump</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FileDescriptor fd, PrintWriter pw, String[] args)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBootCompleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@SuppressWarnings</span></span>(<span class="hljs-string"><span class="hljs-string">"unchecked"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getComponent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;T&gt; interfaceType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T) (mComponents != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? mComponents.get(interfaceType) : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;T, C extends T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">putComponent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;T&gt; interfaceType, C component)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mComponents != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { mComponents.put(interfaceType, component); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overrideNotificationAppName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Notification.Builder n, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> system)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Bundle extras = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bundle(); String appName = system ? context.getString(com.android.internal.R.string.notification_app_name_system) : context.getString(com.android.internal.R.string.notification_app_name_settings); extras.putString(Notification.EXTRA_SUBSTITUTE_APP_NAME, appName); n.addExtras(extras); } }</code> </pre><br>  Se llama al m√©todo start () para iniciar <a href="">cada servicio</a> , que se enumeran a continuaci√≥n. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string-array</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"config_systemUIServiceComponents"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">translatable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.Dependency<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.util.NotificationChannels<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.statusbar.CommandQueue$CommandQueueStart<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.keyguard.KeyguardViewMediator<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.recents.Recents<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.volume.VolumeUI<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.stackdivider.Divider<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.SystemBars<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.usb.StorageNotification<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.power.PowerUI<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.media.RingtonePlayer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.keyboard.KeyboardUI<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.pip.PipUI<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.shortcut.ShortcutKeyDispatcher<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>@string/config_systemUIVendorServiceComponent<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.util.leak.GarbageMonitor$Service<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.LatencyTester<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.globalactions.GlobalActionsComponent<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.ScreenDecorations<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.fingerprint.FingerprintDialogImpl<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.SliceBroadcastRelayHandler<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string-array</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  Control de volumen </h3><br>  Usamos regularmente los botones de volumen en nuestros dispositivos, pero no pensamos en los procesos que deber√≠an ocurrir en el sistema para que podamos aumentar o disminuir el sonido.  La operaci√≥n parece bastante simple en palabras, pero si observa la VolumeUI, que se encuentra en una subcarpeta de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SystenUI / volume</a> , la interfaz tiene su propia variaci√≥n en diferentes modos. <br><br><img src="https://habrastorage.org/webt/tp/a0/nv/tpa0nvqhpyj6oeijp8dupz5poqw.png"><br>  Ya he dicho que los servicios de SystemUI se inician mediante el m√©todo start ().  Si miramos la clase <a href="">VolumeUI</a> , tambi√©n hereda de SystemUI. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VolumeUI</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SystemUI</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String TAG = <span class="hljs-string"><span class="hljs-string">"VolumeUI"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> LOGD = Log.isLoggable(TAG, Log.DEBUG); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Handler mHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Handler(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> mEnabled; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> VolumeDialogComponent mVolumeComponent; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> enableVolumeUi = mContext.getResources().getBoolean(R.bool.enable_volume_ui); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> enableSafetyWarning = mContext.getResources().getBoolean(R.bool.enable_safety_warning); mEnabled = enableVolumeUi || enableSafetyWarning; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mEnabled) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; mVolumeComponent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VolumeDialogComponent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, mContext, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); mVolumeComponent.setEnableDialogs(enableVolumeUi, enableSafetyWarning); putComponent(VolumeComponent.class, getVolumeComponent()); setDefaultVolumeController(); } ‚Ä¶</code> </pre> <br>  Aqu√≠ vemos que con mEnabled determinamos si mostrarnos un panel con ajustes de sonido.  Y a juzgar por el VolumeDialogComponent, VolumeUI muestra la barra de sonido como un cuadro de di√°logo.  Pero todas las acciones relacionadas con presionar las teclas de volumen se procesan en <a href="">PhoneWindow</a> . <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onKeyDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> featureId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> keyCode, KeyEvent event)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (keyCode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.KEYCODE_VOLUME_UP: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.KEYCODE_VOLUME_DOWN: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.KEYCODE_VOLUME_MUTE: { <span class="hljs-comment"><span class="hljs-comment">// If we have a session send it the volume command, otherwise // use the suggested stream. if (mMediaController != null) { mMediaController.dispatchVolumeButtonEventAsSystemService(event); } else { getMediaSessionManager().dispatchVolumeKeyEventAsSystemService(event, mVolumeControlStreamType); } return true; } ... protected boolean onKeyUp(int featureId, int keyCode, KeyEvent event) { final KeyEvent.DispatcherState dispatcher = mDecor != null ? mDecor.getKeyDispatcherState() : null; if (dispatcher != null) { dispatcher.handleUpEvent(event); } //Log.i(TAG, "Key up: repeat=" + event.getRepeatCount() // + " flags=0x" + Integer.toHexString(event.getFlags())); switch (keyCode) { case KeyEvent.KEYCODE_VOLUME_UP: case KeyEvent.KEYCODE_VOLUME_DOWN: { // If we have a session send it the volume command, otherwise // use the suggested stream. if (mMediaController != null) { mMediaController.dispatchVolumeButtonEventAsSystemService(event); } else { getMediaSessionManager().dispatchVolumeKeyEventAsSystemService( event, mVolumeControlStreamType); } return true; } ‚Ä¶</span></span></code> </pre> <br>  Hasta donde podemos ver, KEYCODE_VOLUME_UP (+) no se procesa y se procesar√° KEYCODE_VOLUME_DOWN (-).  En ambos eventos, tanto onKeyDown como onKeyUp, se llama al m√©todo <a href="">dispatchVolumeButtonEventAsSystemService</a> . <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatchVolumeButtonEventAsSystemService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NonNull KeyEvent keyEvent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (keyEvent.getAction()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.ACTION_DOWN: { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> direction = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (keyEvent.getKeyCode()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KeyEvent.KEYCODE_VOLUME_UP: direction = AudioManager.ADJUST_RAISE; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; ... mSessionBinder.adjustVolume(mContext.getPackageName(), mCbStub, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, direction, ... }</code> </pre><br>  Entonces, aqu√≠ llamamos al m√©todo ajustarVolumen, para que podamos verificar nuestra direcci√≥n a la que se asignar√° el par√°metro de evento. <br><br>  Como resultado, cuando lleguemos al <a href="">AudioService</a> , donde se <a href="">llamar√°</a> a <a href="">sendVolumeUpdate</a> , adem√°s de llamar al m√©todo postVolumeChanged, se instalar√° la interfaz HDMI. <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">// UI update and Broadcast Intent protected void sendVolumeUpdate(int streamType, int oldIndex, int index, int flags) { ... mVolumeController.postVolumeChanged(streamType, flags); } private int updateFlagsForSystemAudio(int flags) { ... if (mHdmiSystemAudioSupported &amp;&amp; ((flags &amp; AudioManager.FLAG_HDMI_SYSTEM_AUDIO_VOLUME) == 0)) { flags &amp;= ~AudioManager.FLAG_SHOW_UI; } ... } return flags; } public void postVolumeChanged(int streamType, int flags) { ... mController.volumeChanged(streamType, flags); ... }</span></span></code> </pre> <br><h3>  Ringtoneplayer </h3><br>  RingtonePlayer en Android act√∫a como jugador.  Tambi√©n hereda de SystemUI y en el m√©todo <a href="">start ()</a> vemos: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... mAudioService.setRingtonePlayer(mCallback); ... }</code> </pre> <br>  Aqu√≠ instalamos mCallback, que es esencialmente una instancia de <a href="">IRingtonePlayer</a> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IRingtonePlayer mCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IRingtonePlayer.Stub() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IBinder token, Uri uri, AudioAttributes aa, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> volume, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> looping)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> RemoteException </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IBinder token)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPlaying</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IBinder token)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPlaybackProperties</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IBinder token, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> volume, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> looping)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playAsync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Uri uri, UserHandle user, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> looping, AudioAttributes aa)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopAsync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTitle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Uri uri)</span></span></span><span class="hljs-function"> </span></span>{ ... } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ParcelFileDescriptor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openRingtone</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Uri uri)</span></span></span><span class="hljs-function"> </span></span>{ ... } };</code> </pre> <br>  Al final, puede controlar el RingtonePlayerService utilizando Binder para reproducir archivos de sonido. <br><br><h3>  Powerui </h3><br>  <a href="">PowerUI</a> es responsable de la administraci√≥n de energ√≠a y las notificaciones.  Se hereda de manera similar de SystemUI y tiene un m√©todo start (). <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mPowerManager = (PowerManager) mContext.getSystemService(Context.POWER_SERVICE); mHardwarePropertiesManager = (HardwarePropertiesManager) mContext.getSystemService(Context.HARDWARE_PROPERTIES_SERVICE); mScreenOffTime = mPowerManager.isScreenOn() ? -<span class="hljs-number"><span class="hljs-number">1</span></span> : SystemClock.elapsedRealtime(); mWarnings = Dependency.get(WarningsUI.class); mEnhancedEstimates = Dependency.get(EnhancedEstimates.class); mLastConfiguration.setTo(mContext.getResources().getConfiguration()); ContentObserver obs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContentObserver(mHandler) { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> selfChange)</span></span></span><span class="hljs-function"> </span></span>{ updateBatteryWarningLevels(); } }; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ContentResolver resolver = mContext.getContentResolver(); resolver.registerContentObserver(Settings.Global.getUriFor( Settings.Global.LOW_POWER_MODE_TRIGGER_LEVEL), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, obs, UserHandle.USER_ALL); updateBatteryWarningLevels(); mReceiver.init(); showThermalShutdownDialog(); initTemperatureWarning(); }</code> </pre> <br>  Como podemos ver en el c√≥digo anterior, se suscriben los cambios de Settings.Global.LOW_POWER_MODE_TRIGGER_LEVEL y luego se llama a <a href="">mReceiver.init ()</a> . <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Register for Intent broadcasts for... IntentFilter filter = new IntentFilter(); filter.addAction(PowerManager.ACTION_POWER_SAVE_MODE_CHANGED); filter.addAction(Intent.ACTION_BATTERY_CHANGED); filter.addAction(Intent.ACTION_SCREEN_OFF); filter.addAction(Intent.ACTION_SCREEN_ON); filter.addAction(Intent.ACTION_USER_SWITCHED); mContext.registerReceiver(this, filter, null, mHandler); }</span></span></code> </pre> <br>  Aqu√≠ se registra el receptor de difusi√≥n, con la ayuda de la cual se realiza el seguimiento de cambios. <br><br><h3>  Las tareas </h3><br>  <a href="">Recientes</a> es una caracter√≠stica principal y de uso frecuente en dispositivos m√≥viles Android. <br><br><h4>  Las funciones principales: </h4><br><ul><li>  Mostrar todas las tareas </li><li>  Cambiar entre tareas </li><li>  Eliminar tareas </li></ul><br><br>  Adem√°s, Recientes tambi√©n se hereda de SystemUI.  RecentsActivity crea y actualiza las √∫ltimas tareas para que podamos verlas en nuestra pantalla. <br><br><img src="https://habrastorage.org/webt/82/m5/ms/82m5ms1gauzrja6tv5-m47jq62k.png"><br>  Y al usar <a href="">RecentTaskInfo</a> podemos obtener informaci√≥n sobre una tarea espec√≠fica. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecentTaskInfo</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parcelable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> persistentId; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Intent baseIntent; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ComponentName origActivity; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ComponentName realActivity; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CharSequence description; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stackId; ...</code> </pre> <br>  En general, las tareas en ejecuci√≥n se pueden colocar en un tema separado.  Lo estudi√© por todos lados, porque quer√≠a desenfocar la pantalla de la aplicaci√≥n antes de cambiar la aplicaci√≥n a segundo plano, de modo que se mostrara una versi√≥n ilegible de la instant√°nea en RecentsTask.  Sin embargo, el problema es que la instant√°nea de la aplicaci√≥n se toma antes de que se llame a onPause ().  Este problema puede resolverse de varias maneras.  O configure la bandera para que el sistema simplemente oculte el contenido de la pantalla con <br><br><pre> <code class="java hljs">getWindow().setFlags(WindowManager.LayoutParams.FLAG_SECURE, WindowManager.LayoutParams.FLAG_SECURE);</code> </pre> <br>  De lo que habl√© en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo anterior</a> sobre solo instant√°neas. <br><br>  En general, puede asegurarse de que la actividad espec√≠fica de la aplicaci√≥n no aparezca en las tareas colocando en el manifiesto <br><br><pre> <code class="xml hljs">android:excludeFromRecents = "true"</code> </pre> <br>  O puedes usar el truco con <br><br><pre> <code class="java hljs">Intent.FLAG_ACTIVITY_MULTIPLE_TASK</code> </pre> <br>  Puede establecer la actividad principal sobre el indicador <i>excludeFromRecents = true</i> , para que su pantalla no est√© en las tareas en ejecuci√≥n, pero cuando se carga la aplicaci√≥n, ejecute una tarea separada que mostrar√° una captura de pantalla borrosa de la actividad principal o cualquier otra imagen.  M√°s detalladamente c√≥mo se puede hacer esto se describe en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n oficial</a> sobre el ejemplo de Google Drive. <br><br><h3>  Pantalla de bloqueo </h3><br>  Keyguard ya es m√°s complicado que todos los m√≥dulos anteriores.  Es un servicio que se ejecuta en SystemUI y se administra mediante KeyguardViewMediator. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupLocked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">// Assume keyguard is showing (unless it's disabled) until we know for sure, unless Keyguard // is disabled. if (mContext.getResources().getBoolean( com.android.keyguard.R.bool.config_enableKeyguardService)) { setShowingLocked(!shouldWaitForProvisioning() &amp;&amp; !mLockPatternUtils.isLockScreenDisabled( KeyguardUpdateMonitor.getCurrentUser()), mAodShowing, mSecondaryDisplayShowing, true /* forceCallbacks */); } else { // The system's keyguard is disabled or missing. setShowingLocked(false, mAodShowing, mSecondaryDisplayShowing, true); } ... mLockSounds = new SoundPool(1, AudioManager.STREAM_SYSTEM, 0); String soundPath = Settings.Global.getString(cr, Settings.Global.LOCK_SOUND); if (soundPath != null) { mLockSoundId = mLockSounds.load(soundPath, 1); } ... int lockSoundDefaultAttenuation = mContext.getResources().getInteger( com.android.internal.R.integer.config_lockSoundVolumeDb); mLockSoundVolume = (float)Math.pow(10, (float)lockSoundDefaultAttenuation/20); ... }</span></span></code> </pre> <br>  Sin embargo, en realidad, KeyguardService no funciona de forma independiente con la interfaz de la pantalla de bloqueo, solo transfiere informaci√≥n al m√≥dulo StatusBar, donde ya se toman medidas con respecto a la apariencia visual de la pantalla y la visualizaci√≥n de la informaci√≥n. <br><br><h3>  Barra de notificaciones </h3><br>  <a href="">SystemBars</a> tiene un dispositivo y una estructura bastante complejos.  Su obra se divide en dos etapas: <br><ol><li>  Inicializando SystemBars </li><li>  Mostrar notificaciones </li></ol><br>  Si nos fijamos en el lanzamiento de SystemBars <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createStatusBarFromConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String clsName = mContext.getString(R.string.config_statusBarComponent); ... cls = mContext.getClassLoader().loadClass(clsName); ... mStatusBar = (SystemUI) cls.newInstance(); ... }</code> </pre> <br>  Luego vemos un enlace al recurso desde el cual <a href="">se lee el nombre de la clase</a> y se crea una instancia. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"config_statusBarComponent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">translatable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">&gt;</span></span>com.android.systemui.statusbar.phone.StatusBar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Por lo tanto, vemos que aqu√≠ se llama una barra de estado, que funcionar√° con la notificaci√≥n y la salida de la interfaz de usuario. <br><br>  Creo que nadie dudaba de que Android es muy complicado y contiene muchos trucos que se describen en una gran cantidad de l√≠neas de c√≥digo.  SystemUI es una de las partes m√°s importantes de este sistema y disfrut√© aprendiendo sobre ello.  Debido al hecho de que hay muy poco material sobre este tema, si nota alg√∫n error, corr√≠jame. <br><br>  PD: Siempre expongo la selecci√≥n de material y art√≠culos m√°s cortos sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@paradisecurity</a> en telegramas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es433620/">https://habr.com/ru/post/es433620/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es433608/index.html">El auto del futuro. ¬øPantallas en lugar de vidrio autom√°tico?</a></li>
<li><a href="../es433610/index.html">Notas de un fitoqu√≠mico. Caqui</a></li>
<li><a href="../es433612/index.html">FCC: sat√©lites SpaceX en √≥rbita: una fuente de escombros peligrosa para los habitantes de la Tierra</a></li>
<li><a href="../es433614/index.html">C√≥mo tomar el control de su infraestructura de red. Cap√≠tulo uno Retenci√≥n</a></li>
<li><a href="../es433618/index.html">Sonido de "tubo caliente" con sus propias manos. ¬øQu√© pasa si cruzas una tienda, un club y un taller?</a></li>
<li><a href="../es433624/index.html">Rust de aprendizaje: c√≥mo chate√© UDP con Azul</a></li>
<li><a href="../es433628/index.html">Cultura de feedback: c√≥mo no caer en acusaciones</a></li>
<li><a href="../es433630/index.html">Un paso m√°s cerca de la vacuna contra el VIH: t√≠tulo mono de anticuerpos neutralizantes en suero</a></li>
<li><a href="../es433632/index.html">Otra aplicaci√≥n m√≥vil "filtr√≥" los datos de sus usuarios</a></li>
<li><a href="../es433634/index.html">Monitoreo de la colmena | Me Dadan y medio ucraniano | Redundancia de datos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>