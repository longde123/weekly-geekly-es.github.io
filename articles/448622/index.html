<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõåüèø üë®üèº‚Äçüåæ ‚ö∞Ô∏è PHP GR8: JIT mejorar√° el rendimiento de PHP 8 üëß üêæ üàÇÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PHP es uno de los principales lenguajes de desarrollo en Badoo. En nuestros centros de datos, miles de n√∫cleos de procesador est√°n ocupados ejecutando...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PHP GR8: JIT mejorar√° el rendimiento de PHP 8</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/448622/"><img src="https://habrastorage.org/webt/bw/fj/lk/bwfjlk2iy2btywbt8rqmlsok_-i.jpeg"><br><br>  <i>PHP es uno de los principales lenguajes de desarrollo en Badoo.</i>  <i>En nuestros centros de datos, miles de n√∫cleos de procesador est√°n ocupados ejecutando millones de l√≠neas de c√≥digo PHP.</i>  <i>Seguimos de cerca las noticias y buscamos activamente formas de mejorar la productividad, ya que incluso una peque√±a optimizaci√≥n en nuestros vol√∫menes conduce a importantes ahorros de recursos.</i>  <i>Una de las principales noticias de rendimiento de PHP es la aparici√≥n de JIT en la octava versi√≥n del lenguaje.</i>  <i>Esto, por supuesto, no podr√≠a permanecer sin nuestra atenci√≥n, y tradujimos el art√≠culo sobre qu√© es JIT, c√≥mo se implementar√° en PHP, por qu√© se decidi√≥ hacerlo y qu√© esperar de √©l.</i> <br><br>  Si no sali√≥ de la cueva o no vino del pasado (en este caso, bienvenido), ya sabe que PHP 8 tendr√° JIT: el otro d√≠a, votar√° en silencio y en paz, y la gran mayor√≠a de los participantes votaron a favor de la implementaci√≥n, por lo que todo est√° decidido . <br><br>  En un ataque de alegr√≠a, incluso puedes representar varios movimientos locos como en la foto (esto, por cierto, se llama "Detroit JIT": <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/ip/gp/gk/ipgpgk3stro-ora0on1jhgbxg-y.jpeg"><br><br>  Ahora, si√©ntate y lee este art√≠culo que desmiente el mito.  Quiero aclarar los malentendidos asociados con lo que es JIT y c√≥mo es √∫til, y hablar sobre c√≥mo funciona (pero no con demasiados detalles para que no te aburras). <br><br>  Como no s√© qui√©n leer√° el art√≠culo, pasar√© de preguntas simples a complejas.  Si ya conoce la respuesta a la pregunta en el t√≠tulo, puede omitir con seguridad el cap√≠tulo correspondiente. <br><br><h1>  ¬øQu√© es el JIT? </h1><br>  PHP se implementa sobre la base de una m√°quina virtual (lo llamamos Zend VM).  El lenguaje compila el c√≥digo fuente PHP en instrucciones que la m√°quina virtual comprende (esto se llama la etapa de compilaci√≥n).  Las instrucciones de la m√°quina virtual obtenidas en la etapa de compilaci√≥n se denominan c√≥digos de operaci√≥n.  En la etapa de tiempo de ejecuci√≥n, la VM Zend ejecuta los c√≥digos de operaci√≥n, realizando as√≠ el trabajo requerido. <br><br>  Este circuito funciona muy bien.  Adem√°s, herramientas como APC (antes) y OpCache (hoy) almacenan en cach√© los resultados de la etapa de compilaci√≥n, por lo que esta etapa solo se realiza si es necesario. <br><br>  En resumen, JIT es una estrategia de compilaci√≥n justo a tiempo (en el momento adecuado), en la que el c√≥digo se traduce primero en una representaci√≥n intermedia, que luego se convierte en un c√≥digo de m√°quina dependiente de la arquitectura durante la ejecuci√≥n. <br><br>  En PHP, esto significa que JIT considerar√° las instrucciones para la m√°quina virtual recibidas en la etapa de compilaci√≥n como una representaci√≥n intermedia y entregar√° el c√≥digo de la m√°quina que Zend VM ya no ejecutar√°, sino directamente el procesador. <br><br><h1>  ¬øPor qu√© PHP necesita JIT? </h1><br>  Poco antes de la llegada de PHP 7.0, el enfoque principal del equipo PHP era el rendimiento del lenguaje.  La mayor√≠a de los principales cambios en PHP 7.0 se produjeron en el parche PHPNG, que mejor√≥ enormemente la forma en que PHP usa la memoria y el procesador.  Desde entonces, cada uno de nosotros tiene que echar un vistazo al rendimiento del lenguaje. <br><br>  Despu√©s del lanzamiento de PHP 7.0, las mejoras de rendimiento continuaron: se optimiz√≥ una tabla hash (la estructura de datos principal en PHP), se implement√≥ la especializaci√≥n de ciertos c√≥digos de operaci√≥n en Zend VM y la especializaci√≥n de ciertas secuencias en el compilador, el Optimizador (componente OpCache) se mejor√≥ constantemente y se implementaron muchos otros cambios. <br><br>  La cruda realidad es que, como resultado de todas estas optimizaciones, nos estamos acercando r√°pidamente al l√≠mite de las oportunidades de mejora de la productividad. <br><br>  Tenga en cuenta: por "l√≠mite de oportunidades de mejora" me refiero al hecho de que las compensaciones que tiene que hacer en aras de nuevas mejoras ya no parecen atractivas.  Cuando se trata de optimizar el rendimiento, siempre hablamos de compensaciones.  A menudo, por el bien de la productividad, tenemos que sacrificar la simplicidad.  A todos les gustar√≠a pensar que el c√≥digo m√°s simple tambi√©n es el m√°s r√°pido, pero en el mundo moderno de la programaci√≥n en C esto no es as√≠.  El m√°s r√°pido es el c√≥digo que est√° preparado para aprovechar la estructura interna de la arquitectura o las estructuras integradas en la plataforma / compilador.  La simplicidad por s√≠ sola no garantiza un mejor rendimiento. <br><br>  Por lo tanto, en esta etapa, la mejor manera de obtener a√∫n m√°s rendimiento de PHP es implementar JIT. <br><br><h1>  ¬øJIT acelerar√° mi sitio? </h1><br>  Lo m√°s probable, insignificantemente. <br><br>  Es posible que esta no sea la respuesta que esperaba.  El hecho es que, en general, las aplicaciones PHP est√°n limitadas por entrada / salida (enlazado de E / S), y JIT funciona mejor con c√≥digo que est√° limitado por el procesador (enlazado a la CPU). <br><br><h1>  ¬øQu√© significa "limitado por E / S y procesador"? </h1><br>  Para describir las caracter√≠sticas del rendimiento general de alg√∫n c√≥digo o aplicaci√≥n, utilizamos los t√©rminos "limitado por entrada-salida" y "limitado por procesador". <br><br>  La definici√≥n m√°s simple: <br><br><ul><li>  el c√≥digo limitado por E / S funcionar√° mucho m√°s r√°pido si encontramos una manera de mejorar (reducir, optimizar) las operaciones de E / S realizadas; <br></li><li>  el c√≥digo limitado por el procesador funcionar√° mucho m√°s r√°pido si encontramos una manera de mejorar (reducir, optimizar) las instrucciones ejecutadas por el procesador o aumentar m√°gicamente la velocidad del reloj del procesador. <br></li></ul><br>  El c√≥digo y la aplicaci√≥n pueden estar limitados por E / S, por procesador o por ambos. <br><br>  En general, las aplicaciones PHP tienden a estar limitadas por E / S: su principal cuello de botella a menudo son las operaciones de E / S: conexi√≥n, lectura y escritura en la base de datos, cach√©s, archivos, sockets, etc. <br><br><h1>  ¬øC√≥mo se ve el c√≥digo PHP limitado por procesador? </h1><br>  Quiz√°s algunos programadores PHP son nuevos en el c√≥digo limitado por el procesador debido a la naturaleza de la mayor√≠a de las aplicaciones PHP: generalmente act√∫an como un enlace a la base de datos o cach√©, recogen y producen peque√±as cantidades de respuestas HTML / JSON / XML. <br><br>  Puede mirar su base de c√≥digo y encontrar una gran cantidad de c√≥digo que no tiene nada que ver con E / S, c√≥digo que llama a funciones que no tienen nada que ver con E / S.  Y puede estar confundido de que esto no limita el procesador a su aplicaci√≥n, aunque su c√≥digo tiene m√°s l√≠neas que no funcionan con E / S que el trabajo. <br><br>  El hecho es que PHP es uno de los lenguajes interpretados m√°s r√°pido.  No hay una diferencia notable entre llamar a una funci√≥n que no usa E / S en Zend VM y en el c√≥digo de m√°quina.  Por supuesto, hay alguna diferencia, pero tanto el c√≥digo de m√°quina como el Zend VM usan la convenci√≥n de llamada, por lo que no importa <code>-___()</code> llama a <code>-___()</code> en los <code>-___()</code> o en el c√≥digo de m√°quina; esto no tendr√° un efecto notable sobre el rendimiento de toda la aplicaci√≥n que realiza la llamada. <br><br>  <i>Nota: en t√©rminos simples, una convenci√≥n de llamada es una secuencia de instrucciones ejecutadas <b>antes de</b> ingresar a otra funci√≥n.</i>  <i>En ambos casos, la convenci√≥n de llamada pasa argumentos a la pila.</i> <br><br>  Usted pregunta: "¬øQu√© pasa con los bucles, las llamadas de cola y m√°s?"  PHP es lo suficientemente inteligente, y cuando Optimizer de OpCache est√° activado, su c√≥digo se convertir√° m√°gicamente en una versi√≥n m√°s eficiente de lo que escribi√≥. <br><br>  Cabe se√±alar aqu√≠ que JIT no cambiar√° las convenciones de llamadas de Zend VM.  Esto se hace porque PHP debe poder cambiar entre los modos JIT y VM en cualquier momento (por lo tanto, decidieron mantener las convenciones actuales).  Como resultado, cualquier llamada que vea en todas partes usando JIT no funcionar√° mucho m√°s r√°pido. <br><br>  Si desea ver c√≥mo se ve el c√≥digo PHP limitado por el procesador, eche un vistazo aqu√≠: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/php/php-src/blob/master/Zend/bench.php</a> .  Este es un ejemplo extremo, pero muestra que todo el esplendor de JIT se revela en las matem√°ticas. <br><br><h1>  ¬øTen√≠a que hacer un compromiso tan extremo para acelerar los c√°lculos matem√°ticos en PHP? </h1><br>  No  Hicimos esto en aras de ampliar el rango de aplicaci√≥n del lenguaje (y ampliar significativamente). <br><br>  No queremos alardear, pero PHP domina la web.  Si est√° involucrado en el desarrollo web y no considera usar PHP en su pr√≥ximo proyecto, entonces est√° haciendo algo mal (seg√∫n un desarrollador de PHP muy sesgado). <br><br>  A primera vista, puede parecer que la aceleraci√≥n de los c√°lculos matem√°ticos en PHP tiene una aplicaci√≥n muy limitada.  Sin embargo, esto nos abre el camino, por ejemplo, al aprendizaje autom√°tico, la representaci√≥n 3D, la representaci√≥n 2D (GUI) y el an√°lisis de datos. <br><br><h1>  ¬øPor qu√© no se puede implementar esto en PHP 7.4? </h1><br>  Arriba, llam√© a JIT un compromiso extremo, y realmente lo creo: esta es una de las estrategias de compilaci√≥n m√°s dif√≠ciles entre todas las existentes, si no la m√°s dif√≠cil.  La implementaci√≥n de JIT es un aumento significativo en la complejidad. <br><br>  Si le preguntas a Dmitry, el autor de JIT, si hizo que PHP sea complicado, √©l responder√°: "No, odio la complejidad" (esta es una cita). <br><br>  Esencialmente, "complejo" significa "lo que no entendemos".  Y hoy, pocos desarrolladores de lenguaje realmente entienden la implementaci√≥n existente de JIT. <br><br>  El trabajo en PHP 7.4 est√° progresando r√°pidamente, y la introducci√≥n de JIT en esta versi√≥n conducir√° al hecho de que solo unos pocos pueden depurar, corregir y mejorar el lenguaje.  Esto es inaceptable para quienes votaron en contra de JIT en PHP 7.4. <br><br>  Antes del lanzamiento de PHP 8, muchos de nosotros entenderemos la implementaci√≥n de JIT.  Hay caracter√≠sticas que queremos implementar y herramientas que queremos reescribir para la octava versi√≥n, por lo que primero debemos entender el JIT.  Necesitamos este tiempo, y estamos muy agradecidos de que la mayor√≠a vot√≥ para d√°rnoslo. <br><br>  Complejo no es sin√≥nimo de lo terrible.  La complejidad puede ser tan hermosa como una nebulosa de estrella, y esto es solo sobre JIT.  En otras palabras, incluso cuando 20 personas en nuestro equipo comienzan a entender JIT no peor que Dmitry, esto no cambiar√° la complejidad de la naturaleza de JIT. <br><br><h1>  ¬øSe ralentizar√° el desarrollo de PHP? </h1><br>  No hay raz√≥n para pensar eso.  Tenemos suficiente tiempo, por lo que se puede argumentar que para cuando PHP 8 est√© listo, habr√° suficientes entre nosotros que dominemos JIT lo suficiente como para trabajar de manera no menos eficiente que hoy cuando se trata de corregir errores y desarrollar PHP. <br><br>  Cuando intente relacionar esto con la idea de la complejidad original de JIT, recuerde que la mayor parte del tiempo que dedicamos a la introducci√≥n de nuevas funciones se dedica a debatirlas.  La mayor√≠a de las veces, cuando se trabaja en funciones y se corrigen errores, escribir un c√≥digo lleva minutos u horas, y las discusiones tardan semanas o meses.  En casos excepcionales, el c√≥digo debe escribirse durante horas o d√≠as, pero incluso as√≠ las discusiones siempre duran m√°s. <br><br>  Eso es todo lo que quer√≠a decir. <br><br><blockquote>  Y como estamos hablando de rendimiento, invito a mi colega Pavel Murzakov al informe el 17 de mayo en la conferencia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PHP Rusia.</a>  ¬°Pasha sabe c√≥mo exprimir la √∫ltima CPU del segundo c√≥digo PHP! </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/448622/">https://habr.com/ru/post/448622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448606/index.html">Sidorin: KnowledgeConf trata sobre c√≥mo mantener el conocimiento con una duraci√≥n promedio de trabajo en un lugar en 2-3 a√±os</a></li>
<li><a href="../448608/index.html">¬øC√≥mo dar los primeros pasos en rob√≥tica?</a></li>
<li><a href="../448610/index.html">Bricolaje: c√≥mo hicimos un calendario en vivo para Codefest X</a></li>
<li><a href="../448612/index.html">Lo que se congel√≥ en Feature Freeze 2019. Parte I. JSONPath</a></li>
<li><a href="../448618/index.html">Algoritmo Douglas-Pecker</a></li>
<li><a href="../448624/index.html">Ver los datos? No Entonces no lo veo, pero lo son. Destruimos datos en unidades SSD e incluso restauramos la velocidad</a></li>
<li><a href="../448626/index.html">DDoS para ayudar: c√≥mo realizamos pruebas de estr√©s y estr√©s</a></li>
<li><a href="../448628/index.html">Est√©tica t√©cnica y tecnolog√≠a sovi√©ticas</a></li>
<li><a href="../448632/index.html">¬øJava ya est√° pagado? Desacreditando rumores (¬øo no?)</a></li>
<li><a href="../448634/index.html">Lecciones ucranianas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>