<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌦️ 🕑 👨‍👩‍👧‍👦 Fichiers QVD - contenu 💰 💛 👨🏻‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="QlikView et son jeune frère QlikSense sont de merveilleux outils de BI assez populaires dans notre pays et à l'étranger. Très souvent, ces systèmes en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fichiers QVD - contenu</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/alfastrah/blog/454302/"><p>  QlikView et son jeune frère QlikSense sont de merveilleux outils de BI assez populaires dans notre pays et à l'étranger.  Très souvent, ces systèmes enregistrent les résultats «intermédiaires» de leur travail - des données qui visualisent leurs «tableaux de bord» - dans ce qu'on appelle des «fichiers QVD».  Les fichiers QVD sont souvent utilisés comme stockage principal dans les processus ETL à plusieurs étapes construits sur la base de Qlik.  Et puis certains (par exemple, je - je m'occupe de l'ingénierie des données dans l'entreprise) ont une question - est-il possible et comment utiliser ces données sans QlikView / QlikSense?  Ou un autre - et qu'y a-t-il et est-il exact qu'il a été compté? </p><br><p>  QVD est un format de fichier optimisé pour QlikView / QlikSense (la lecture des informations d'écriture par ces applications dans des fichiers de ce format est beaucoup plus rapide que dans des fichiers de tout autre format).  La structure de ce fichier est non documentée et recouverte d'une "morosité de propriété", il n'y a pratiquement aucune application capable de travailler avec de tels fichiers (en lecture et plus encore en écriture).  Dans cette série d'articles, je partagerai mon expérience et mes connaissances pratiques acquises: je sais comment QVD fonctionne, je peux y lire et écrire directement et rapidement. </p><br><p>  Qui sera intéressé par ces informations: tout d'abord, ceux qui travaillent avec QlikView / QlikSense, ainsi que ceux qui (comme moi) souhaitent utiliser les données stockées dans les fichiers QVD.  Et, bien sûr, à tout le monde curieux. </p><a name="habracut"></a><br><p>  Tout ce qui est écrit dans cette série est basé sur mon expérience personnelle, qui, bien sûr, n'est pas une «documentation» ou une «garantie» (que vos fichiers seront exactement les mêmes que ceux que j'ai décrits. Ou que ce sera pour toujours )  Je ne peux pas non plus garantir que j'ai compris tous les cas - il est certain que certains fichiers contiendront quelque chose que je n'ai pas décrit (ne serait-ce que parce que je n'ai pas trouvé de telles options).  Cependant, je dois noter que les informations sont vérifiées sur un grand (plusieurs centaines) ensemble de fichiers créés par différentes personnes de différents systèmes utilisant différentes versions de QlikView / QlikSense. </p><br><p>  Et un peu sur la façon dont je l'ai fait: j'ai commencé avec un simple - un petit exemple en ligne enregistré dans QVD.  Plus loin - l'analyse du fichier binaire, les efforts du cerveau, les tests et les erreurs.  Pour l'avenir (je vais en parler plus en détail dans la conclusion de la série), j'ai pu lire et écrire des fichiers QVD de taille moyenne (des centaines de gigaoctets) assez efficacement.  Le point de départ de mon voyage dans le monde QVD a été ce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> , merci beaucoup à l'auteur (a essayé de le contacter - ne répond pas). </p><br><p>  Quel était mon objectif (outre la curiosité et le désir de vérifier l'exactitude des données avec lesquelles QlikView / QlikSense fonctionne), j'avais besoin de lire le contenu du fichier QVD, c'est-à-dire  recréer une table relationnelle basée sur elle.  À l'inverse, téléchargez les données de la table relationnelle dans QVD afin que QlikView puisse les charger correctement. </p><br><p>  Comment je vois cette série d'articles </p><br><ul><li>  introduction, structure de fichiers, métadonnées (cet article) </li><li>  stockage <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des</a> informations <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de colonne</a> </li><li>  stockage des informations de ligne, réalisations, plans </li></ul><br><h2 id="struktura-fayla">  Structure des fichiers </h2><br><p>  Le fichier QVD est créé par le script QlikView / QlikSense dans le processus de chargement des données dans la mémoire de l'application (résultat de la commande STORE) et correspond à une table (relationnelle) QlikView / QlikSense.  Il se compose de deux parties </p><br><ul><li>  textuel (métadonnées) et </li><li>  binaire (colonnes et lignes) </li></ul><br><p>  Les métadonnées sont présentées au format XML (un exemple sera donné ci-dessous), la partie binaire commence immédiatement après le texte et se compose de deux blocs </p><br><ul><li>  valeurs uniques de toutes les colonnes (table source) </li><li>  lignes (table source) qui font référence à des valeurs de colonne uniques </li></ul><br><p><img src="https://habrastorage.org/webt/xc/jz/cd/xcjzcdlm5gquip77fzlnyxi93ea.png" alt="Structure des fichiers"></p><br><p>  Ainsi, pour une table de N colonnes, le fichier contiendra N + 1 blocs binaires.  Toutes les parties du dossier sont «étroitement collées» et se succèdent sans aucun remplissage ni «queue». </p><br><h2 id="metadannye-xml">  Métadonnées (XML) </h2><br><p>  Le fichier QVD contient beaucoup de métadonnées - "données sur les données".  C'est presque autosuffisant, jugez par vous-même, voici une courte liste de ce qui est dans les métadonnées (je les décrirai plus en détail ci-dessous): </p><br><ul><li>  version du logiciel qui a généré le fichier </li><li>  date et heure de création du fichier </li><li>  Fichier QlikView / QlikSense, dont le script a conduit à la création du fichier </li><li>  code source de script qui a généré le fichier QVD </li><li>  nom de table </li><li>  informations sur la colonne (noms, types, quantités de valeurs uniques) </li><li>  nombre de lignes </li></ul><br><p>  Les métadonnées sont stockées dans un fichier sous forme de texte et peuvent être vues dans n'importe quel programme qui peut afficher le fichier sous forme de texte (enfin presque n'importe quoi ... dans un qui n'a pas peur des gros fichiers).  Personnellement, je regarde les méta-informations avec plus - c'est assez pratique. <br>  Dans la présentation suivante, j'utiliserai la table de test (j'utilise la syntaxe QlikView, mais je pense qu'elle sera facile à conjecturer): </p><br><pre><code class="plaintext hljs">SET NULLINTERPRET =&lt;sym&gt;; tab1: LOAD * INLINE [ ID, NAME 123.12,"Pete" 124,12/31/2018 -2,"Vasya" 1,"John" &lt;sym&gt;,"None" ];</code> </pre> <br><p>  Je vais donner comme exemple les métadonnées de cette plaque </p><br><pre> <code class="plaintext hljs">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt; &lt;QvdTableHeader&gt; &lt;QvBuildNo&gt;7314&lt;/QvBuildNo&gt; &lt;CreatorDoc&gt;&lt;/CreatorDoc&gt; &lt;CreateUtcTime&gt;2019-04-03 06:24:33&lt;/CreateUtcTime&gt; &lt;SourceCreateUtcTime&gt;&lt;/SourceCreateUtcTime&gt; &lt;SourceFileUtcTime&gt;&lt;/SourceFileUtcTime&gt; &lt;SourceFileSize&gt;-1&lt;/SourceFileSize&gt; &lt;StaleUtcTime&gt;&lt;/StaleUtcTime&gt; &lt;TableName&gt;tab1&lt;/TableName&gt; &lt;Fields&gt; &lt;QvdFieldHeader&gt; &lt;FieldName&gt;ID&lt;/FieldName&gt; &lt;BitOffset&gt;0&lt;/BitOffset&gt; &lt;BitWidth&gt;3&lt;/BitWidth&gt; &lt;Bias&gt;-2&lt;/Bias&gt; &lt;NumberFormat&gt; &lt;Type&gt;0&lt;/Type&gt; &lt;nDec&gt;0&lt;/nDec&gt; &lt;UseThou&gt;0&lt;/UseThou&gt; &lt;Fmt&gt;&lt;/Fmt&gt; &lt;Dec&gt;&lt;/Dec&gt; &lt;Thou&gt;&lt;/Thou&gt; &lt;/NumberFormat&gt; &lt;NoOfSymbols&gt;4&lt;/NoOfSymbols&gt; &lt;Offset&gt;0&lt;/Offset&gt; &lt;Length&gt;40&lt;/Length&gt; &lt;/QvdFieldHeader&gt; &lt;QvdFieldHeader&gt; &lt;FieldName&gt;NAME&lt;/FieldName&gt; &lt;BitOffset&gt;3&lt;/BitOffset&gt; &lt;BitWidth&gt;5&lt;/BitWidth&gt; &lt;Bias&gt;0&lt;/Bias&gt; &lt;NumberFormat&gt; &lt;Type&gt;0&lt;/Type&gt; &lt;nDec&gt;0&lt;/nDec&gt; &lt;UseThou&gt;0&lt;/UseThou&gt; &lt;Fmt&gt;&lt;/Fmt&gt; &lt;Dec&gt;&lt;/Dec&gt; &lt;Thou&gt;&lt;/Thou&gt; &lt;/NumberFormat&gt; &lt;NoOfSymbols&gt;5&lt;/NoOfSymbols&gt; &lt;Offset&gt;40&lt;/Offset&gt; &lt;Length&gt;37&lt;/Length&gt; &lt;/QvdFieldHeader&gt; &lt;/Fields&gt; &lt;Compression&gt;&lt;/Compression&gt; &lt;RecordByteSize&gt;1&lt;/RecordByteSize&gt; &lt;NoOfRecords&gt;5&lt;/NoOfRecords&gt; &lt;Offset&gt;77&lt;/Offset&gt; &lt;Length&gt;5&lt;/Length&gt; &lt;/QvdTableHeader&gt;</code> </pre> <br><p>  Mon expérience avec QVD montre que la structure XML ne change pas d'un fichier à l'autre. </p><br><p>  Je commenterai les éléments de métadonnées les plus importants. </p><br><h2 id="obschaya-informaciya">  Informations générales </h2><br><p>  <strong>QvBuildNo</strong> </p><br><p>  Numéro de build de l'application QlikView / QlikSense qui a généré le fichier QVD. </p><br><p>  <strong>Creatordoc</strong> </p><br><p>  En règle générale, il contient le nom du fichier QVW, dont le script a généré le fichier QVD.  Cet exemple est vide, peut-être parce que l'édition personnelle a été utilisée. </p><br><p>  <strong>CreateUtcTime</strong> </p><br><p>  Heure de création du fichier QVD. </p><br><p>  <strong>SourceCreateUtcTime, SourceFileUtcTime, SourceFileSize, StaleUtcTime</strong> </p><br><p>  Je n'ai pas vu les fichiers dans lesquels ces champs seraient remplis - à un esprit curieux: peut-être que certains paramètres sont manquants? </p><br><p>  <strong>Tablename</strong> </p><br><p>  Le nom de la table dans QlikView (voir l'exemple ci-dessus). </p><br><h2 id="informaciya-o-polyah-kolonkah">  Informations sur les champs (colonnes) </h2><br><p>  Soit dit en passant, les mots "champ" et "colonne" sont des synonymes pour moi, ne vous inquiétez pas si je les utilise tous les deux (j'essaierai de ne pas le faire, mais quand même ...). </p><br><p>  Les informations sur chaque champ sont stockées dans QVD sur </p><br><p>  <strong>Nom de champ</strong> </p><br><p>  Le nom du champ (toujours en termes de QlikView, c'est-à-dire en tenant compte de "AS") </p><br><p>  <strong>BitOffset, BitWidth, Bias</strong> </p><br><p>  Pour l'instant, sautons - ce sont des informations pour "décoder des chaînes", nous considérerons dans la troisième partie quand il traitera des chaînes. </p><br><p>  <strong>Type, nDec, UseThou, Fmt, Dec, Thou</strong> </p><br><p>  Bien conçu (à en juger par les noms), mais absolument inutile du point de vue de la réalisation de mon objectif d'information (pour plus de détails, voir la deuxième partie, où nous parlerons de colonnes).  Pourquoi est-ce inutile?  - la balise "Type" ne correspond pas au type de données stockées dans la partie binaire.  Il est impossible d'en restaurer le type de colonne (il semblerait que cela pourrait être plus facile, il y a une balise Type!)  Dans 90% des cas, la valeur de cette balise sera la chaîne UNKNOWN ... </p><br><p>  Dans les métadonnées sur les colonnes, il y a encore de telles données (dans les métadonnées de l'exemple, ce n'est apparemment pas en raison de la petite taille) </p><br><pre> <code class="plaintext hljs">&lt;Comment&gt;&lt;/Comment&gt; &lt;Tags&gt; &lt;String&gt;$numeric&lt;/String&gt; &lt;String&gt;$integer&lt;/String&gt; &lt;/Tags&gt;</code> </pre> <br><p>  Le commentaire n'a pas besoin de commentaires (au fait, les fichiers avec lesquels j'ai travaillé sont 100% vides ...). </p><br><p>  Les balises sont également inutiles (du point de vue de la restauration de la structure de la table).  Mais à partir de là, vous pouvez approximativement deviner quel type d'informations est stocké dans la colonne.  Je vais aborder la saisie plus en détail dans la deuxième partie - quand je parlerai des colonnes: c'est important.  Mais un peu plus compliqué que je ne le souhaiterais. </p><br><p>  <strong>NoOfSymbols</strong> </p><br><p>  Le nombre d'entrées dans la partie binaire liées à cette colonne.  Comme nous le voyons, dans notre exemple, il s'agit de 5. Informations très importantes pour le décryptage. </p><br><p>  <strong>Décalage</strong> </p><br><p>  Décalage du bloc de données de cette colonne en octets par rapport au début de la partie binaire du fichier.  Aussi très important. </p><br><p>  <strong>La longueur</strong> </p><br><p>  La longueur de l'ensemble du bloc de données de cette colonne en octets.  Notez que la représentation binaire d'un élément de colonne (cellule de tableau) a généralement une longueur variable (ligne, par exemple), de sorte que la longueur ne peut pas être calculée, vous ne pouvez la prendre qu'à partir de cette balise (sourire). </p><br><h2 id="informaciya-o-strokah">  Informations sur les chaînes </h2><br><p>  <strong>La compression</strong> </p><br><p>  Jamais renseigné (dans les données avec lesquelles j'ai travaillé).  Peut-être que nous n'utilisons pas cette option ... </p><br><p>  <strong>RecordByteSize</strong> </p><br><p>  Taille de l'entrée de ligne en octets.  Toutes les chaînes sont représentées dans le bloc binaire de chaînes sous la forme d'un index binaire (plus d'informations à ce sujet dans la troisième partie), un index binaire se compose de lignes de même longueur. </p><br><p>  <strong>NoOfRecords</strong> </p><br><p>  Le nombre de lignes (dans l'index de bits et dans la table source). </p><br><p>  <strong>Décalage</strong> </p><br><p>  Décalage de l'index binaire (bloc contenant des informations de chaîne) en octets par rapport au début de la partie binaire du fichier. </p><br><p>  <strong>La longueur</strong> </p><br><p>  La longueur de l'index de bits en octets. </p><br><p>  Dans les métadonnées sur les chaînes, il y a encore de telles données (encore une fois - un court exemple ne vous permet pas de tout voir, mais il vous permet de comprendre le complexe) </p><br><pre> <code class="plaintext hljs">&lt;Lineage&gt; &lt;LineageInfo&gt; &lt;Discriminator&gt;Provider=OraOLEDB.Oracle.1;Persist Security Info=True;Data Source=XXXX;Extended Properties=&amp;quot;&amp;quot;&lt;/Discriminator&gt; &lt;Statement&gt;LinkTable: LOAD SOURCE_NAME &amp;amp; '_' &amp;amp; SOURCE_ID as SYSKEY, HID_PARTY;SQL SELECT * FROM UNITED_VIEW&lt;/Statement&gt; &lt;/LineageInfo&gt; &lt;LineageInfo&gt; &lt;Discriminator&gt;Provider=OraOLEDB.Oracle.1;Persist Security Info=True;Data Source=XXXX;Extended Properties=&amp;quot;&amp;quot;&lt;/Discriminator&gt; &lt;Statement&gt;SQL SELECT * FROM UNITED_VIEW&lt;/Statement&gt; &lt;/LineageInfo&gt; &lt;LineageInfo&gt; &lt;Discriminator&gt;STORE - \\xxx.ru\mfs\SPECIAL\Qlikview\QVData\LinkTable.qvd (qvd)&lt;/Discriminator&gt; &lt;Statement&gt;&lt;/Statement&gt; &lt;/LineageInfo&gt; &lt;/Lineage&gt; &lt;Comment&gt;&lt;/Comment&gt;</code> </pre> <br><p>  Je n'entrerai pas dans le vif du sujet, c'est assez compréhensible (les SELECT d'origine qui ont généré la table dans QlikView), je ne l'ai toujours pas encore compris (parfois ils doublent) ... (sauf pour un - 100% pas de commentaires (sourire)) . </p><br><h2 id="podytozhim">  Pour résumer </h2><br><ul><li>  Le fichier QVD est autonome (c'est-à-dire qu'il peut être analysé indépendamment des autres données) </li><li>  Le fichier QVD se compose de parties de texte (métadonnées) et binaires (colonnes et index binaires) </li><li>  les métadonnées sont XML avec une sémantique claire </li></ul><br><p>  Un lecteur curieux a le droit de demander ici: "Jusqu'à présent, rien de nouveau n'a été dit, tout ce qui précède peut être pris et visualisé dans l'en-tête XML du fichier QVD ... Cela a déjà été écrit à plusieurs reprises sur différents Internet, quelle est la nouveauté?"  C'est vrai - la première partie est presque entièrement consacrée aux métadonnées.  Mais ce n'est pas la fin. </p><br><p>  Que faire ensuite - <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans la partie suivante,</a></strong> nous examinerons en détail la structure de la <strong>partie binaire du</strong> fichier QVD contenant des informations sur les colonnes (valeurs uniques de toutes les colonnes du tableau). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr454302/">https://habr.com/ru/post/fr454302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr454292/index.html">JS. Proxy. Écueil à connaître</a></li>
<li><a href="../fr454294/index.html">«Sans expériences inutiles», ou comment nous avons lancé un accélérateur de banque</a></li>
<li><a href="../fr454296/index.html">Comment une école de Porto Rico donne vie à la chimie avec Minecraft: Éducation</a></li>
<li><a href="../fr454298/index.html">The Standoff: comment c'était</a></li>
<li><a href="../fr454300/index.html">Comment les CTT diffèrent des caloducs conventionnels et comment les appliquer</a></li>
<li><a href="../fr454304/index.html">Imprimante Delta 3D à faire soi-même pour la céramique</a></li>
<li><a href="../fr454306/index.html">Cinq erreurs que j'ai commises en tant que développeur principal</a></li>
<li><a href="../fr454308/index.html">AMA avec Habr. V.9.0. Podcast, conférence et concepts</a></li>
<li><a href="../fr454310/index.html">Fermeture de type générique en rouille</a></li>
<li><a href="../fr454312/index.html">Comment utiliser la bibliothèque jQuery avec le framework Angular (quand c'est vraiment nécessaire)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>