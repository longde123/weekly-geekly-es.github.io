<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚦 🌥️ ⛹🏽 Implémentation du modèle «Observer-Subscriber» à l'aide des rappels JNI dans Android (NDK) 🤳🏼 👌🏼 💪</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Implémentation Android (NDK) des rappels JNI, modèle Observer- Subscriber avec NDK et rappel, EventBus ou Rx auto-écrit 
 ... Je l'ai compris "il n'y ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implémentation du modèle «Observer-Subscriber» à l'aide des rappels JNI dans Android (NDK)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420389/"><p>  Implémentation Android (NDK) des rappels JNI, modèle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Observer-</a> Subscriber avec NDK et rappel, EventBus ou Rx auto-écrit </p><a name="habracut"></a><br><blockquote>  ...  Je l'ai compris "il n'y a aucune pièce réparable par l'utilisateur à l'intérieur".  Je veux voir ce qu'il y a. <br>  - Poupées russes d'emboîtement jusqu'aux profondeurs.  Vraiment, Orozco?  Juan n'a pas regardé ce qu'est une poupée russe de nidification. <br>  "Ce sont des ordures, professeur Gu."  Qui en a besoin - pour jouer avec ça? <br>  "La fin des arcs-en-ciel" Vinge Vernor </blockquote><p> Il existe de nombreuses applications Android qui combinent le code C ++ et Java.  Java implémente la logique métier, et C ++ fait tout le travail de l'informatique, souvent trouvé dans le traitement audio.  Le flux audio est traité quelque part à l'intérieur, et le frein avec gaz et embrayage est affiché à l'étage, et les données pour toutes sortes d'images drôles. <br>  Eh bien, depuis ReactiveX, c'est déjà familier, afin de ne pas changer de main, et de travailler avec le donjon JNI de manière familière, vous devez régulièrement implémenter le modèle Observer dans les projets avec NDK.  Eh bien, en même temps, la compréhensibilité du code pour <del>  archéologues </del>  ceux qui n'ont pas de chance de «comprendre le code de quelqu'un d'autre» augmentent. <br>  Donc, la meilleure façon d'apprendre quelque chose est de le faire vous-même. <br>  Disons que nous aimons et savons comment écrire nos vélos.  Et qu'obtiendrons-nous en conséquence: </p><br><ul><li>  quelque chose comme une publication du code C ++ aux signataires; </li><li>  gestion du traitement en code natif, c'est-à-dire que nous ne pouvons pas être contraints à des règlements lorsqu'il n'y a pas d'abonnés et qu'il n'y a personne pour les envoyer; </li><li>  le transfert de données entre différentes JVM peut être nécessaire; </li><li>  et pour ne pas se lever deux fois, en même temps envoyer des messages à l'intérieur des flux du projet. </li></ul><br><p>  Le code de travail complet est disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> .  L'article n'en fournit que des extraits. </p><br><p>  <strong>Un peu de théorie et d'histoire</strong> </p><br><p>  Récemment, j'étais à la réunion RX et j'ai été étonné du nombre de questions sur: à quelle vitesse est ReactiveX et comment cela fonctionne-t-il? <br>  Pour ReactiveX, je peux seulement dire que pour Java sa vitesse dépend beaucoup de la façon dont il est raisonnablement utilisé; s'il est utilisé correctement, sa vitesse est suffisante. <br>  Notre vélo est beaucoup plus léger, mais si vous avez besoin, par exemple, d'une file d'attente de messages (comme fluide), alors vous devez l'écrire vous-même.  Parce que vous savez que tous les problèmes ne sont que les vôtres. <br>  Un peu de théorie: le modèle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Observer-</a> Subscriber est un mécanisme qui permet à un objet de recevoir des alertes sur les changements d'état d'autres objets et donc de les observer.  Cela permet de réduire la connectivité et les dépendances entre les composants logiciels, ce qui permet de les utiliser et de les tester plus efficacement.  Un représentant vivant dans lequel le concept de langage est construit sur tout cela - Smalltalk, tous basés sur l'idée d'envoyer des messages.  Objectif affecté-C. </p><br><p>  <strong>Implémentation</strong> </p><br><p>  Essayons dans les meilleures traditions du bricolage, pour ainsi dire, «clignoter la LED».  Si vous utilisez JNI, dans le monde NDK Android, vous pouvez demander la méthode Java de manière asynchrone, dans n'importe quel thread.  C'est ce que nous utilisons pour construire notre «Observateur». </p><br><p>  Le projet de démonstration est basé sur le nouveau modèle de projet d'Android Studio. </p><br><p>  Il s'agit d'une méthode générée automatiquement.  Il a commenté: </p><br><pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Used to load the 'native-lib' library on application startup. static { System.loadLibrary("native-lib"); }</span></span></code> </pre> <br><p>  Maintenant pour toi.  La première étape est la méthode <code>nsubscribeListener</code> . </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">native</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nsubscribeListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JNIListener JNIListener)</span></span></span></span>;</code> </pre> <br><p>  Il permet au code C ++ d'obtenir un lien vers le code java pour activer un rappel vers un objet qui implémente l'interface <code>JNIListener.</code> </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JNIListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAcceptMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String string)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAcceptMessageVal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> messVal)</span></span></span></span>; }</code> </pre> <br><p>  Des valeurs seront transférées à la mise en œuvre de ses méthodes. </p><br><p>  Pour une mise en cache efficace des liens vers la machine virtuelle, nous enregistrons également le lien vers l'objet.  Nous obtenons un lien global pour cela. </p><br><pre> <code class="java hljs">Java_ua_zt_mezon_myjnacallbacktest_MainActivity_nsubscribeListener(JNIEnv *env, jobject instance, jobject listener) { env-&gt;GetJavaVM(&amp;jvm); <span class="hljs-comment"><span class="hljs-comment">//store jvm reference for later call store_env = env; jweak store_Wlistener = env-&gt;NewWeakGlobalRef(listener);</span></span></code> </pre> <br><p>  Comptez et enregistrez immédiatement les liens vers les méthodes.  Cela signifie que moins d'opérations sont nécessaires pour terminer le rappel. </p><br><pre> <code class="java hljs">jclass clazz = env-&gt;GetObjectClass(store_Wlistener); jmethodID store_method = env-&gt;GetMethodID(clazz, <span class="hljs-string"><span class="hljs-string">"onAcceptMessage"</span></span>, <span class="hljs-string"><span class="hljs-string">"(Ljava/lang/String;)V"</span></span>); jmethodID store_methodVAL = env-&gt;GetMethodID(clazz, <span class="hljs-string"><span class="hljs-string">"onAcceptMessageVal"</span></span>, <span class="hljs-string"><span class="hljs-string">"(I)V"</span></span>);</code> </pre> <br><p>  Les données d'abonné sont stockées sous forme d'enregistrements de classe <code>ObserverChain</code> . </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObserverChain</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ObserverChain(jweak pJobject, jmethodID pID, jmethodID pJmethodID); jweak store_Wlistener=NULL; jmethodID store_method = NULL; jmethodID store_methodVAL = NULL; };</code> </pre> <br><p>  Enregistrez l'abonné dans le tableau dynamique store_Wlistener_vector. </p><br><pre> <code class="cpp hljs">ObserverChain *tmpt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObserverChain(store_Wlistener, store_method, store_methodVAL); store_Wlistener_vector.push_back(tmpt);</code> </pre> <br><p>  Maintenant, comment les messages du code Java seront transmis. </p><br><p>  Un message envoyé à la méthode nonNext sera envoyé à tous les signataires. </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">native</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nonNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String message)</span></span></span></span>;</code> </pre> <br><p>  Réalisation: </p><br><pre> <code class="java hljs">Java_ua_zt_mezon_myjnacallbacktest_MainActivity_nonNext(JNIEnv *env, jobject instance, jstring message_) { txtCallback(env, message_); }</code> </pre> <br><p>  Fonction txtCallback (env, message_);  envoie des messages à tous les signataires. </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">txtCallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JNIEnv *env, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _jstring *message_)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!store_Wlistener_vector.empty()) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; store_Wlistener_vector.size(); i++) { env-&gt;CallVoidMethod(store_Wlistener_vector[i]-&gt;store_Wlistener, store_Wlistener_vector[i]-&gt;store_method, message_); } } }</code> </pre> <br><p>  Pour transférer des messages à partir du code C ++ ou C, nous utilisons la fonction test_string_callback_fom_c </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_string_callback_fom_c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *val)</span></span></span></span></code> </pre> <br><p>  Elle vérifie dès le début s'il y a des abonnés. </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (store_Wlistener_vector.empty()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br><p>  Il est facile de voir que la même fonction txtCallback est utilisée pour envoyer des messages: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_string_callback_fom_c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *val)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (store_Wlistener_vector.empty()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; __android_log_print(ANDROID_LOG_VERBOSE, <span class="hljs-string"><span class="hljs-string">"GetEnv:"</span></span>, <span class="hljs-string"><span class="hljs-string">" start Callback to JNL [%d] \n"</span></span>, val); JNIEnv *g_env; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span> == jvm) { __android_log_print(ANDROID_LOG_ERROR, <span class="hljs-string"><span class="hljs-string">"GetEnv:"</span></span>, <span class="hljs-string"><span class="hljs-string">" No VM \n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// double check it's all ok JavaVMAttachArgs args; args.version = JNI_VERSION_1_6; // set your JNI version args.name = NULL; // you might want to give the java thread a name args.group = NULL; // you might want to assign the java thread to a ThreadGroup int getEnvStat = jvm-&gt;GetEnv((void **) &amp;g_env, JNI_VERSION_1_6); if (getEnvStat == JNI_EDETACHED) { __android_log_print(ANDROID_LOG_ERROR, "GetEnv:", " not attached\n"); if (jvm-&gt;AttachCurrentThread(&amp;g_env, &amp;args) != 0) { __android_log_print(ANDROID_LOG_ERROR, "GetEnv:", " Failed to attach\n"); } } else if (getEnvStat == JNI_OK) { __android_log_print(ANDROID_LOG_VERBOSE, "GetEnv:", " JNI_OK\n"); } else if (getEnvStat == JNI_EVERSION) { __android_log_print(ANDROID_LOG_ERROR, "GetEnv:", " version not supported\n"); } jstring message = g_env-&gt;NewStringUTF(val);// txtCallback(g_env, message); if (g_env-&gt;ExceptionCheck()) { g_env-&gt;ExceptionDescribe(); } if (getEnvStat == JNI_EDETACHED) { jvm-&gt;DetachCurrentThread(); } }</span></span></code> </pre> <br><p>  Dans MainActivity, nous créons deux vues de texte et une vue d'édition. </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/sample_text_from_Presenter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:padding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Hello World!from_Presenter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintBottom_toTopOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintEnd_toStartOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintStart_toStartOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintTop_toTopOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/sample_text_from_act"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Hello World from_ac!"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintBottom_toTopOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintStart_toStartOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/sample_text_from_Presenter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintTop_toTopOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EditText</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/edit_text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Hello World!"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintBottom_toTopOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintStart_toStartOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/sample_text_from_act"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_constraintTop_toTopOf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"parent"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p>  Dans OnCreate, nous lions View avec des variables et décrivons que lorsque le texte est modifié dans EditText, un message sera envoyé aux abonnés. </p><br><pre> <code class="java hljs">mEditText = findViewById(R.id.edit_text); mEditText.addTextChangedListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextWatcher() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeTextChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CharSequence charSequence, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i2)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTextChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CharSequence charSequence, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i2)</span></span></span><span class="hljs-function"> </span></span>{ nonNext(charSequence.toString()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">afterTextChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Editable editable)</span></span></span><span class="hljs-function"> </span></span>{ } }); tvPresenter = (TextView) findViewById(R.id.sample_text_from_Presenter); tvAct = (TextView) findViewById(R.id.sample_text_from_act);</code> </pre> <br><p>  Nous commençons et enregistrons les abonnés: </p><br><pre> <code class="java hljs">mPresenter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MainActivityPresenterImpl(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); nsubscribeListener((MainActivityPresenterImpl) mPresenter); nlistener = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JNIListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAcceptMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String string)</span></span></span><span class="hljs-function"> </span></span>{ printTextfrActObj(string); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAcceptMessageVal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> messVal)</span></span></span><span class="hljs-function"> </span></span>{ } }; nsubscribeListener(nlistener);</code> </pre> <br><p>  Cela ressemble à ceci: </p><br><p><img src="https://habrastorage.org/webt/n2/yk/9a/n2yk9aykepfz92zblbxd_lej4xy.gif"></p><br><p>  Le code de travail complet est disponible sur GitHub <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/NickZt/MyJNACallbackTest</a> <br>  Faites-nous savoir dans les commentaires ce qu'il faut décrire plus en détail. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr420389/">https://habr.com/ru/post/fr420389/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr420377/index.html">Comment nous avons commencé les appels vidéo</a></li>
<li><a href="../fr420381/index.html">Pourquoi suffit-il de considérer les réseaux de neurones comme une boîte noire?</a></li>
<li><a href="../fr420383/index.html">"Yandex.Money ne vous intéresse pas pour saisir votre candidature."</a></li>
<li><a href="../fr420385/index.html">Tests d'intégration basés sur des conteneurs</a></li>
<li><a href="../fr420387/index.html">Trois Rubik's Cube intelligents: Xiaomi, Roobo et GoCube</a></li>
<li><a href="../fr420391/index.html">Salaires IT mi-2018</a></li>
<li><a href="../fr420393/index.html">PHP, YII2 et la formation de gros fichiers Excel</a></li>
<li><a href="../fr420395/index.html">Tablettes "gratuites" pour les détenus - pas du tout gratuites</a></li>
<li><a href="../fr420397/index.html">Les scientifiques ont trouvé un moyen d'inverser le processus de vieillissement des cellules</a></li>
<li><a href="../fr420405/index.html">Recherche sur le processus de vente informatique</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>