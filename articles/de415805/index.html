<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ±Ô∏è üîè üéñÔ∏è Modifikation des Doorhan GSM Barrier Moduls zur Internetsteuerung üíü üëàüèº üë∏üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="K√ºrzlich wurde beschlossen, in einem Mehrfamilienhaus eine Barriere mit Steuerung √ºber GSM zu installieren. Die Gr√ºnde und die Notwendigkeit f√ºr diese...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Modifikation des Doorhan GSM Barrier Moduls zur Internetsteuerung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415805/"><img src="https://habrastorage.org/webt/zr/za/t9/zrzat9esz7qihwci7atehv_qxeu.png"><br><br>  K√ºrzlich wurde beschlossen, in einem Mehrfamilienhaus eine Barriere mit Steuerung √ºber GSM zu installieren.  Die Gr√ºnde und die Notwendigkeit f√ºr diese L√∂sung gehen √ºber den Rahmen des Artikels hinaus, aber ich m√∂chte dar√ºber schreiben, wie ich "auf meinem Knie" eine Schnittstelle zur Steuerung des Moduls √ºber das Internet erstellt habe.  Und sogar ein bisschen mit Blackjack, der Verwaltung der Basis von Autos von einem Mobiltelefon aus und Fotos von Momenten des Eintritts von einer Stra√üenkamera.  Vielleicht m√∂chte es jemand zu Hause vorstellen. <br><br>  Ich warne Sie, dass der Artikel keine sofort einsatzbereite L√∂sung beschreibt, sondern einen Proof of Concept. <br><a name="habracut"></a><br><h3>  Teil 1. Warum so ein Controller </h3><br>  Vor der Installation des GSM-Moduls wurde eine Markt√ºberpr√ºfung solcher Systeme durchgef√ºhrt.  Ich wollte eine kosteng√ºnstige, zuverl√§ssige und bew√§hrte L√∂sung.  Nun, damit die ‚ÄûInstallateure‚Äú die Installateure hatten, hatten sie einige Erfahrung damit usw. <br><br>  Die Installateure zur Auswahl boten entweder ESIM 110/120 f√ºr ~ 12000r mit Internetzugang oder Doorhan GSM f√ºr ~ 6000r mit SMS-Steuerung oder Konfiguration √ºber ein USB-Kabel an. <br><br>  Die Option "Ihr Ger√§t aus einem Arduino + GSM-Modul f√ºr 3 US-Dollar herstellen" wurde nicht in Betracht gezogen, daher sollte die L√∂sung genau zuverl√§ssig und getestet sein.  Stellen Sie sich vor, jemand k√∂nnte nicht zu Hause anrufen?  Dann werden Sie alle Probleme bekommen. <br><br>  Ich wollte auch keine Lotterie mit dem Kauf eines Ger√§ts <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in China auf Ali</a> , um Probleme mit der Zuverl√§ssigkeit zu vermeiden.  Obwohl die Preise bei 1500r beginnen. <br><br>  Der Nachteil von ESIM120 war neben den Kosten f√ºr x2, dass GPRS-Internet f√ºr den Zugriff auf das Internet verwendet wurde.  F√ºr einige mag dies ein Plus sein, aber in unserem Fall verursacht es die Kosten f√ºr die Mobilkommunikation - Sie m√ºssen einen Tarif mit dem Internet abschlie√üen.  Jetzt ist ein Tarif ohne monatliche Geb√ºhr mit der SIM-Karte verbunden. Um zu verhindern, dass die Nummer gesperrt wird, plane ich, alle 2-3 Monate f√ºr 2-3 Rubel pro Tag f√ºr einen Tag eine Art kostenpflichtiges Abonnement vom pers√∂nlichen Konto des Betreibers zu verbinden.  Zum Beispiel "Wetter", "Witze" oder was sonst noch f√ºr die Barriere n√ºtzlich ist) <br><br>  √úber Doorhan GSM wusste ich, dass es neben der Verwaltung per SMS (nicht sehr interessant) auch eine Verbindung √ºber USB mit einem Computer herstellt und √ºber die eigene Software die Verwaltung der Zahlenbasis erm√∂glicht. <br><br><h3>  Teil 2. Weiterleitungskontrolle </h3><br>  Da geplant war, die Barrieresteuereinheit 20 Meter von dem Raum entfernt zu installieren, in dem sich der Heim-IP-Videorecorder und das Kommunikationszentrum des lokalen Internetproviders befinden, wurde beschlossen, Doorhan zu nehmen und USB √ºber einen Router wie TP-Link MR3020 im Wert von 1200 Rubel, OpenWRT und Programme aufzubauen aus dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">USBIP-</a> Projekt <br><br>  Mit dem Router stellte sich heraus, dass es noch etwas einfacher war - ich fand den alten ASUS WL500gP in den Beh√§ltern, der nach heutigen Ma√üst√§ben nicht sehr gut f√ºr das Internet geeignet ist, aber 2 USB-Anschl√ºsse hat.  Er hat es benutzt. <br><br>  F√ºr usbip musste ich am 12. September die alte Version von OpenWRT installieren, da dieses Kernelmodul auf neuen nicht funktioniert.  Ich werde die Verbindung des Routers mit dem Netzwerk nicht beschreiben.  Wenn jemand es nicht im lokalen Netzwerk hat, gibt es Optionen mit Portweiterleitung, UPNP oder dem Einrichten eines VPN nach Ihrem Geschmack. <br><br>  Installieren Sie kmod-usbip-server und √ºberpr√ºfen Sie, ob Sie von uns exportieren k√∂nnen <br><br><pre><code class="bash hljs">root@OpenWrt:~<span class="hljs-comment"><span class="hljs-comment"># opkg install kmod-usbip-server root@OpenWrt:~# usbip list -l Local USB devices ================= - busid 1-1 (0424:2502) 1-1:1.0 -&gt; hub - busid 1-1.1 (1a86:7523) 1-1.1:1.0 -&gt; ch341</span></span></code> </pre> <br>  Wir ben√∂tigen ein Busid-Ger√§t, 1-1.1, auf dem sich unser angeschlossener GSM-Controller befindet.  Mit Blick auf die Zukunft stellte sich heraus, dass dies ein banaler COM-&gt; USB-Konverter auf einem CH341-Chip ist <br><br>  Wir f√ºhren aus: <br><br><pre> <code class="hljs ruby">root@OpenWrt<span class="hljs-symbol"><span class="hljs-symbol">:~</span></span><span class="hljs-comment"><span class="hljs-comment">#usbipd -D root</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@OpenWrt</span></span></span><span class="hljs-comment">:~#usbip bind -b 1-1.1 bind device on busid 1-1.1: complete</span></span></code> </pre><br>  und in dmesg <br><br><pre> <code class="bash hljs"> usbip-host 1-1.1:1.0: usbip-host: register new device (bus 1 dev 57 ifn 0)</code> </pre><br>  Installieren Sie auf einem Computer mit Windows USBIP-Treiber und f√ºhren Sie sie aus <br><br><pre> <code class="dos hljs">usbip -a <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">16</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span>.<span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  wo 10.16.19.19 IP-Adresse unseres Routers mit OpenWRT.  Nat√ºrlich m√ºssen Sie zuerst den Zugriff entweder von Ihrer IP-Adresse auf den Router in der Firewall √∂ffnen oder eine Verbindung √ºber das lokale Netzwerk oder eine der 1000 anderen Optionen von VPN zu P2P herstellen. <br><br>  Wenn alles gut gegangen ist, erkl√§rt Windows gl√ºcklich, dass ein neues USB-zu-Seriell-Konverter-CH340-Ger√§t erkannt wurde. Wir geben ihm einen Treiber und ein COM-Anschluss wird im System angezeigt. <br><br>  Jetzt k√∂nnen wir das Programm aus dem Kit mit dem Controller ausf√ºhren und die Nummern in der Datenbank verwalten, w√§hrend wir zu Hause auf der Couch sitzen <br><br><img src="https://habrastorage.org/webt/4r/ag/oc/4ragoc7u7b1rgfyvjwuxod9fgdu.png"><br><br><h3>  Teil 3. Zugangskontrolle </h3><br>  Nachdem ich die Arbeit mit dem Controller auf meinem Heimcomputer eingerichtet und Benutzernummern aufgezeichnet hatte, entschied ich mich, etwas tiefer in die verf√ºgbaren Funktionen des COM-Anschlusses einzusteigen. <br><br>  Es stellt sich heraus, dass das GSM-Modul der Steuerung regelm√§√üig AT-Befehle mit dem Signalpegel an die Konsole sendet und auch die Telefonnummer schreibt, von der der Anruf beim T√§tigen eines Anrufs empfangen wird.  Die Verwaltung des AT-Moduls hat nicht funktioniert, anscheinend werden sie nicht vom Controller-Modul an das Modem-Modul gesendet. <br><br><img src="https://habrastorage.org/webt/sk/e0/zx/ske0zxaobnmlpfryp5t1k8ldfgs.png"><br><br>  Es ist sowieso ziemlich interessant.  W√§hrend ich die Idee mit dem GSM-Controller ausarbeitete, hoffte ich, dass diese Anrufe im Detail des Betreibers aufgezeichnet werden.  Da jedoch keine Verbindung hergestellt wird, enth√§lt der Drilldown keine Datens√§tze.  Jetzt k√∂nnen Sie direkt vom Controller aus die Protokolle desjenigen sammeln, der die Barriere ge√∂ffnet hat.  Oder wer hat das versucht. <br><br>  Installieren Sie dazu kmod-usb-serial-ch341 auf OpenWRT, deaktivieren Sie die USBIP-√úbersetzung mit dem Befehl usbip unbind -b 1-1.1 und f√ºhren Sie insmod ch341 aus. <br><br>  Danach k√∂nnen Sie direkt am Router eine Verbindung zu / dev / ttyUSB0 herstellen und beobachten, was mit Aufrufen im Controller geschieht. <br><br>  Um die Daten zu verarbeiten, habe ich zun√§chst ein einfaches Skript geschrieben, das mithilfe von Curl Daten √ºber einen eingehenden Anruf an einen externen Server mit PHP sendet, um sie zu verarbeiten und in der Datenbank zu speichern.  Sie k√∂nnen mit demselben Erfolg in die lokale Datei schreiben, obwohl der Speicher auf dem Router nicht dick ist. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cat /dev/ttyUSB0 | while read DATA; do if echo $DATA | grep -q CLIP ; then curl --silent --output /dev/null --data "data=$DATA" http://1.2.3.4:8081/border.php fi done</span></span></code> </pre><br>  Auf dem Server habe ich eine Datenbank in MySQL und ein paar Platten erstellt: mit den Telefonnummern unserer Bewohner und mit dem Anrufprotokoll.  Es wurde m√∂glich zu vergleichen, wer die Barriere zu welchem ‚Äã‚ÄãZeitpunkt ge√∂ffnet hat und ob sie versuchen, sie aus unbekannten Zahlen zu verwenden. <br><br>  Die zweite Idee, die mir in den Sinn kam, war, eine Verbindung zwischen dem Ereignis des √ñffnens der Barriere und einem Foto dieses Ereignisses herzustellen.  Die Sache ist, wie ich oben erw√§hnte, rund um das Haus AHD-Kameras, die auf den Rekorder schreiben und √ºber IP auf den Stream zugreifen.  Dar√ºber hinaus wurde eine der Kameras speziell auf die Barriere gedreht, in der Erwartung, dass sie diese brechen w√ºrde. <br><br>  Ich konnte nicht herausfinden, wie ich JPEG von unserem chinesischen Registrar entfernen kann, obwohl es in vielen Kameras eine Vorschau-URL gibt.  Deshalb ging ich frontal - zum Zeitpunkt des Anrufs bekomme ich RTSP und mache daraus JPG. <br><br><pre> <code class="bash hljs">ffmpeg -i <span class="hljs-string"><span class="hljs-string">"rtsp://2.3.4.5:554/user=user&amp;password=password&amp;channel=1&amp;stream=0.sdp?"</span></span> -y -f image2 -t 0.001 -ss 00:00:3 -s 1280*720 /tmp/screenshot.jpg</code> </pre> <br>  Mit dem gleichen Erfolg war es m√∂glich, kleine Clips in mp4 zu schreiben, aber ich fand das √ºberfl√ºssig. <br>  Fotos entschieden sich, Blobs in MySQL zu speichern.  Die Leistungsl√∂sung ist mittelm√§√üig, aber das "Ziehen" des Projekts wird einfacher. Sie m√ºssen nicht die Datenbank und die Dateien kopieren, sondern alles in der Datenbank.  Und die Last auf ihn ist im Wesentlichen keine. <br><br>  Infolgedessen sieht das Eintragsprotokoll ungef√§hr so ‚Äã‚Äãaus: <br><br><img src="https://habrastorage.org/webt/xg/53/g5/xg53g5nxegvogrwkccgei-5khwm.jpeg"><br><br><h3>  Teil 4. Laden von Nummern aus der SQL-Datenbank auf der Site in den Controller </h3><br>  Wenn Sie sorgf√§ltig gelesen haben, haben Sie wahrscheinlich bemerkt, dass der USB-Anschluss des Routers f√ºr die Registrierung von Eintr√§gen im Serial-zu-USB-Konvertermodus funktioniert hat. Um mit der Zahlenbasis im Controller zu arbeiten, musste ich ihn √ºber USBIP auf meinen Heimcomputer ‚Äûpushen‚Äú und dort √ºber das Windows-Programm erstellen √Ñnderungen.  Dies ist nicht sehr praktisch. Sie mussten die USB-Konsole auf Ihrem Heimcomputer l√∂sen / binden und sogar ausf√ºhren.  Nun, Sie k√∂nnen dies nur von zu Hause aus tun (wieder RDP / VPN usw.) und insbesondere nicht von einem Mobiltelefon aus.  Es wurde doppelt erhitzt, dass die Datenbank mit Zahlen sowohl im MDB-Format (das Programm f√ºr den Controller kann Daten in Access hochladen) als auch in der Webversion gepflegt werden musste. <br><br>  Ein flie√üendes Googeln des Doorhan GSM-Protokolls funktionierte nicht.  Ich schlie√üe jedoch nicht aus, dass dies eine Art chinesisches Ger√§t unter der Marke Doorhan ist.  Daher bewaffnete er sich mit einem Monitor (Sniffer) f√ºr den COM-Port und nahm mehrere Dumps, wenn er mit der urspr√ºnglichen Anwendung arbeitete. <br><br><img src="https://habrastorage.org/webt/ni/3u/u-/ni3uu-5expfpjazyacjotzm7r1q.png"><br><br>  Habe so etwas wie: <br>  Speicherl√∂schbefehl <code>aa 02 09 00 00 03 e8 01 00 00 00 00 ee</code> <br>  Die Antwort ist, dass alles gut <code>aa 20 00 ee</code> ist <code>aa 20 00 ee</code> <br>  Team, um eine Nummer aufzuzeichnen +79999999999 <br> <code>aa 03 10 00 01 2b 37 39 39 39 39 39 39 39 39 39 39 00 00 ee</code> <br> <br>  Daraus folgerte er: <br>  Beginn des Sendens von AA, Ende des Sendens von EE <br>  Die Antwort ist, dass das Team 20 00 akzeptiert wird <br>  Der Befehl zum Starten der Aufzeichnung der Nummer 03. Dann kommt die Anzahl der Nummern im Paket.  Es kann zwischen 1 und 5 liegen, dh f√ºr ein Paket k√∂nnen Sie mehrere Nummern gleichzeitig senden, das Paket mit dem EE-Befehl beenden und eine Best√§tigung pro Block erhalten. <br><br>  Nach dem Befehl zum Starten der Aufzeichnung gibt es 2 Bytes (das zweite ist genau, das erste wird wahrscheinlich verwendet, wenn die Anzahl der Nummern mehr als 256 betr√§gt, aber nicht √ºberpr√ºft wurde), die die Seriennummer des Datensatzes in der Zelle angeben.  Das hei√üt, wenn Sie in einen leeren Speicher schreiben, ist es zuerst 1, dann 2 und so weiter.  Dann kommen 14 Bytes der Telefonnummer.  Da unsere Zahlen in 12 Bytes (+79999999999) "enthalten" sind, werden die letzten 2 Bytes mit Nullen belegt.  Wahrscheinlich f√ºr alle Arten von internationalen Formaten wie +10.  Dies ist nicht korrekt, ich habe mich nicht eingehend damit befasst, da diese Daten ausreichten. <br><br>  Das Senden per Byte EE endet. <br><br>  Mit der Seriennummer der Zelle ist die Situation nicht ganz klar.  Angenommen, 10 Zahlen werden in die Steuerung geschrieben, der Speicher wurde nicht gel√∂scht.  Wenn Sie den Befehl "Schreiben Sie die Nummer in Zelle 5" senden, √§ndert sich die Nummer in dieser Zelle nach der Kontrollsubtraktion nicht, aber der Controller zeichnet 11 Nummern auf und die 11. ist leer.  Und wenn Sie den Befehl "Schreiben Sie die Nummer in Zelle 11" geben, wird er darauf geschrieben.  Dies ist wahrscheinlich auf die Befehle ADD und REPLACE (Hinzuf√ºgen und √Ñndern) zur√ºckzuf√ºhren, die per SMS gesendet werden k√∂nnen.  Da die urspr√ºngliche Anwendung jedoch nur das L√∂schen und das anschlie√üende Umschreiben der Liste vollst√§ndig durchf√ºhrt, kann die Hypothese nicht √ºberpr√ºft werden.  Daher hat er seine Version auch erstellt, indem er einen L√∂sch- und sequentiellen Schreibbefehl an eine Nummer gesendet hat (der Einfachheit halber). <br><br>  Wir haben also Befehle geschrieben, um die Liste der Teilnehmer an der Steuerung √ºber die serielle Schnittstelle zu verwalten.  Der Port befindet sich jedoch im Router und die Datenbank mit Benutzern auf einem externen Server.  Nat√ºrlich k√∂nnen Sie es auf einen Router √ºbertragen (Sie erhalten eine Komplettl√∂sung "out of the box"), aber ich war zu faul.  Ich bin in die andere Richtung gegangen - ich habe / dev / ttyUSB0 mit dem ser2net-Paket, das sich im openwrt-Paket befindet, auf tcp geworfen. <br><br>  Die config /etc/ser2net.conf ist einfach f√ºr unanst√§ndig <br><br><pre> <code class="hljs ruby"><span class="hljs-number"><span class="hljs-number">3333</span></span><span class="hljs-symbol"><span class="hljs-symbol">:raw</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/dev/ttyUSB0</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">9600</span></span>,remctl</code> </pre> <br>  Nach dem Start von ser2net k√∂nnen Sie eine Verbindung zum Telnet-Router an Port 3333 herstellen und das Ergebnis √ºberpr√ºfen. <br><br>  Ich m√∂chte eine Reservierung vornehmen: Nach dem Neustart des Routers funktionierte cat / dev / ttyUSB0 nicht pl√∂tzlich.  Das hat nat√ºrlich funktioniert, aber ich habe M√ºll auf die Konsole geschrieben.  Ich erinnerte mich, dass ich w√§hrend der Experimente mit dem Router Minicom ausgef√ºhrt habe, das wahrscheinlich die Portinitialisierung durchgef√ºhrt hat.  Nur das Einstellen des Modus 9600 8n1 hat nicht funktioniert, daher habe ich mit stty nachgesehen, welche Porteinstellungen sich im Status "Arbeiten" befinden, und die Initialisierung in rc.local eingegeben <br><br><pre> <code class="hljs powershell">stty <span class="hljs-operator"><span class="hljs-operator">-F</span></span> /dev/ttyUSB0 <span class="hljs-number"><span class="hljs-number">9600</span></span> ignbrk <span class="hljs-literal"><span class="hljs-literal">-brkint</span></span> <span class="hljs-literal"><span class="hljs-literal">-icrnl</span></span> <span class="hljs-literal"><span class="hljs-literal">-imaxbel</span></span> <span class="hljs-literal"><span class="hljs-literal">-opost</span></span> <span class="hljs-literal"><span class="hljs-literal">-onlcr</span></span> <span class="hljs-literal"><span class="hljs-literal">-isig</span></span> <span class="hljs-literal"><span class="hljs-literal">-icanon</span></span> <span class="hljs-literal"><span class="hljs-literal">-iexten</span></span> <span class="hljs-literal"><span class="hljs-literal">-echo</span></span> <span class="hljs-literal"><span class="hljs-literal">-echoe</span></span> <span class="hljs-literal"><span class="hljs-literal">-echok</span></span> <span class="hljs-literal"><span class="hljs-literal">-echoctl</span></span> <span class="hljs-literal"><span class="hljs-literal">-echoke</span></span></code> </pre> <br>  Sicherlich etwas √úberfl√ºssiges, Leser werden es m√∂glicherweise korrigieren.  Wenn Sie die Portparameter in ser2net.conf angeben, k√∂nnen Sie das stty-Paket nicht auf dem Router ablegen. <br><br>  Infolge dieser Manipulationen auf dem Server mit der WEB-Schnittstelle wurde uns die Controller-Konsole zur Verf√ºgung gestellt.  Daher werden wir den Anrufbearbeitungscode leicht umschreiben.  Ich habe in PHP geschrieben.  Es ist eine Schande, den gesamten Code anzuzeigen (ich bin am Ende kein Programmierer, ich habe die Einf√ºgungen aus dem Tutorial verwendet). Der Punkt ist also: <br><br><pre> <code class="php hljs"> $re = <span class="hljs-string"><span class="hljs-string">'/CLIP: ".(7\d{10})"/m'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    while (1) { $f=@fsockopen('tcp://10.16.19.19',3333, $errno, $errstr); //   while ($f &amp;&amp; $str=fread($f, 100)) { $test=preg_match($re, $str, $matches); if ($test) process_call($matches[1]); // ,       //           ,  ,   $f sync_phones($f); } if ($f) fclose($f); //-    sleep(5); // 5     }</span></span></code> </pre><br>  Ich denke, jeder implementiert den process_call nach Belieben, indem er Informationen in eine Protokolldatei schreibt, einen Foto- / Videoeintrag erstellt und √ºber einen Telegramm-Bot an das Telefon seines Ehepartners sendet sowie ein Team f√ºr eine Kaffeemaschine oder zum Aufw√§rmen von Borschtsch. <br><br>  Ich werde n√§her auf sync_phones eingehen, da es den sehr "nicht √∂ffentlichen" Algorithmus des Doorhan GSM-Controllers implementiert.  Und ja, kleines Gesicht, ich habe MySQL anstelle von PDO oder MySQL verwendet. <br><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sync_phones</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($f)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*   config   update.   -  val=1,        .     ,       mysql,     */</span></span> $result=mysql_query(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM config WHERE name='update' AND val=1"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mysql_num_rows($result)==<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; $init = pack(<span class="hljs-string"><span class="hljs-string">'H*'</span></span>,<span class="hljs-string"><span class="hljs-string">'aa1100ee'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//-        $clear = pack('H*','aa0209000003e80100000000ee'); //    (   -) $logfile=fopen("/tmp/border.log","a"); fwrite($logfile,"Update started at ".date('Ymd H:i:s')."\n"); fwrite($f,$init); sleep(1); $ans=fread($f, 40); fwrite($logfile,"Send init. Answer ".bin2hex ( $ans )."\n"); fwrite($f,$clear); sleep(1); $ans=fread($f, 40); fwrite($logfile,"Send clear. Answer ".bin2hex ( $ans )."\n"); $result=mysql_query("SELECT * FROM phones ORDER BY pid"); //  , select     ,      $n=1; while($row=mysql_fetch_array($result)) { $start = 'aa0310'; $pos = sprintf("%04x",$n); $phone = bin2hex('+'.$row['phone']).'0000'; $end = 'ee'; // "" $send=$start.$pos.$phone.$end; $bin=pack('H*',$send); fwrite($f,$bin); $ans=fread($f, 40); fwrite($logfile,"Write {$n} phone {$row['phone']}. Answer ".bin2hex ( $ans )."\n"); $n++; } fwrite($logfile,"End update\n"); fclose($logfile); //   "" ,   ,  .   ,     mysql_query("UPDATE config SET val=0,result='".bin2hex ( $ans )."',updated=NOW() WHERE name='update'"); } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><h3>  Teil 5. Fazit </h3><br>  Als Ergebnis erhielt (schrieb) ich eine WEB-Schnittstelle f√ºr die Barriere, √ºber die ich √ºber einen mobilen Browser die Nummern unserer Hausbewohner dort hinzuf√ºgen / entfernen / √§ndern, Notizen zu Wohnung, Name, Telefonnummer und Autonummer machen kann.  Es gibt Fotos von einem Auto, ein Protokoll der Eintr√§ge durch die Barriere mit einem Foto.  In Zukunft werde ich laut Protokoll sehen, wer die Barriere am st√§rksten belastet - er wird f√ºr die Reparatur bezahlen :) <br><br>  Nun, der Bonus war ein WIFI-Punkt auf dem Parkplatz in der N√§he des Hauses. <br><br>  Der Ausgabepreis betr√§gt 0 Rubel und der freie Tag am Computer. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de415805/">https://habr.com/ru/post/de415805/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de415791/index.html">Optimierung intelligenter Vertr√§ge. Wie sich Solidit√§tstypen auf die Transaktionskosten auswirken</a></li>
<li><a href="../de415793/index.html">Vollst√§ndige Anleitung zur Domain-Nachbestellung</a></li>
<li><a href="../de415795/index.html">Schreiben einer Snapchat-Benutzeroberfl√§che auf Swift</a></li>
<li><a href="../de415797/index.html">Regul√§re Ausdr√ºcke + logische Programmierung. Was ist das Ergebnis?</a></li>
<li><a href="../de415801/index.html">Google: Unsere "Telefon" -KI ist nicht gut genug, um gef√§hrlich zu sein</a></li>
<li><a href="../de415809/index.html">Verwendung von Soja, Requirejs und Backbone-Js in Plugins f√ºr Atlassian Jira</a></li>
<li><a href="../de415811/index.html">KI, praktischer Kurs. √úbersicht √ºber neuronale Netze zur Bildklassifizierung</a></li>
<li><a href="../de415813/index.html">Einige Hinweise zum aktuellen Status von Cloud Gaming</a></li>
<li><a href="../de415815/index.html">An der Spitze der Wissenschaft: eine Analyse der Artikel von arxiv.org</a></li>
<li><a href="../de415817/index.html">Wir √ºbertakten das Backup. Yandex Vortrag</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>