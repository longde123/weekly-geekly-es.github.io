<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧕🏻 🚰 🤾🏻 DateTimeOffset (Ketat) 🧡 🈂️ 🚶🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pagi ini temanku kirillkos menemui masalah. 
 Kode masalah 


 Ini kodenya: 


class Event { public string Message {get;set;} public DateTime EventTim...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DateTimeOffset (Ketat)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438946/"><p>  Pagi ini temanku <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">kirillkos</a> menemui masalah. </p><br><h2 id="problemnyy-kod">  Kode masalah </h2><br><p>  Ini kodenya: </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Event</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Message {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTime EventTime {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} } <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IEventProvider</span></span> { <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;Event&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre> <br><p>  Dan kemudian banyak, banyak implementasi dari <code>IEventProvider</code> yang <code>IEventProvider</code> data dari berbagai tabel dan basis data. </p><br><p>  <strong>Masalah</strong> : di semua pangkalan ini, semuanya ada di zona waktu yang berbeda.  Karena itu, ketika mencoba untuk menampilkan acara ke UI, semuanya sangat membingungkan. </p><br><p>  Kemuliaan bagi Halesberg, kami memiliki tipe, semoga mereka menyelamatkan kami! </p><a name="habracut"></a><br><h2 id="popytka-1">  Percobaan 1 </h2><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Event</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Message {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTimeOffset EventTime {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  <code>DateTimeOffset</code> tipe yang hebat, ia menyimpan informasi offset tentang UTC.  Ini sangat didukung oleh MS SQL dan Entity Framework (dan dalam versi 6.3 itu akan didukung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lebih baik</a> ).  Dalam gaya kode kami, itu wajib untuk semua kode baru. </p><br><p>  Sekarang kita dapat mengumpulkan informasi dari penyedia yang sama dan secara konsisten, bergantung pada jenisnya, menampilkan semuanya di UI.  Kemenangan! </p><br><p>  <strong>Masalah</strong> : <code>DateTimeOffset</code> dapat <em>secara implisit</em> mengkonversi dari <code>DateTime</code> . <br>  Kode berikut ini mengkompilasi dengan baik: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Event</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Message {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTimeOffset EventTime {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;Event&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event() {EventTime = DateTime.Now, Message = <span class="hljs-string"><span class="hljs-string">"Hello from unknown time!"</span></span>}, }; }</code> </pre> <br><p>  Ini karena <code>DateTimeOffset</code> operator pengecoran implisit yang ditentukan: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Local and Unspecified are both treated as Local public static implicit operator DateTimeOffset (DateTime dateTime);</span></span></code> </pre> <br><p>  Ini sama sekali bukan yang kita butuhkan.  Kami hanya ingin programmer <strong>untuk</strong> berpikir, ketika menulis kode: "Tapi di zona waktu apa peristiwa ini terjadi?"  Dari mana mendapatkan zona itu? "  Seringkali dari bidang yang sama sekali berbeda, kadang-kadang dari tabel terkait.  Dan kemudian melakukan kesalahan <em>tanpa berpikir</em> sangat mudah. </p><br><p>  Konversi tersirat yang terkutuk! </p><br><h2 id="popytka-2">  Percobaan 2 </h2><br><p>  Karena saya dengar <del>  palu </del>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">analisa statis</a> , semuanya menurut saya <del>  kuku </del>  kasus yang cocok untuk mereka.  Kita perlu menulis analisa statis yang melarang konversi implisit ini, dan menjelaskan mengapa ... Sepertinya banyak pekerjaan.  Bagaimanapun, itu adalah tugas kompiler untuk memeriksa jenis.  Untuk saat ini, cantumkan ide ini sebagai kata kerja. </p><br><h2 id="popytka-3">  Percobaan 3 </h2><br><p>  Sekarang, jika kita akan berada di dunia F #, kata <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">Kirillkos</a> . <br>  Kami kemudian akan: </p><br><pre> <code class="plaintext hljs">type DateTimeOffsetStrict = Value of DateTimeOffset</code> </pre> <br><p>  Dan selanjutnya <del>  tidak datang dengan improvisasi </del>  semacam sihir akan menyelamatkan kita.  Sayang sekali mereka tidak menulis F # di kantor kami, dan kami juga tidak benar-benar mengenal Kirillkos :-) </p><br><h2 id="popytka-4">  Percobaan 4 </h2><br><p>  Tidak bisakah sesuatu dilakukan di C #?  Itu mungkin, tetapi Anda tersiksa dengan mengubah bolak-balik.  Berhenti, tetapi kami baru saja melihat bagaimana Anda dapat melakukan konversi implisit! </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Same as </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;see cref="DateTimeOffset"/&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> but w/o implicit conversion from </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;see cref="DateTime"/&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> public readonly struct DateTimeOffsetStrict { private DateTimeOffset Internal { get; } private DateTimeOffsetStrict(DateTimeOffset @internal) { Internal = @internal; } public static implicit operator DateTimeOffsetStrict(DateTimeOffset dto) =&gt; new DateTimeOffsetStrict(dto); public static implicit operator DateTimeOffset(DateTimeOffsetStrict strict) =&gt; strict.Internal; }</span></span></code> </pre> <br><p>  Hal yang paling menarik tentang tipe ini adalah bahwa itu secara implisit dikonversi bolak-balik dari <code>DateTimeOffset</code> , tetapi upaya untuk secara implisit mengubahnya dari <code>DateTime</code> akan menyebabkan kesalahan kompilasi, konversi dari DateTime hanya mungkin secara eksplisit.  Kompiler tidak dapat menyebut "rantai" konversi implisit, jika mereka didefinisikan dalam kode kami, standar melarangnya ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kutipan dari SO</a> ).  Yaitu, kerjanya seperti ini: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Event</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Message {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTimeOffsetStrict EventTime {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;Event&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event() {EventTime = DateTimeOffset.Now, Message = <span class="hljs-string"><span class="hljs-string">"Hello from unknown time!"</span></span>}, }; }</code> </pre> <br><p>  tapi tidak seperti ini: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">IEnumerable&lt;Event&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event() {EventTime = DateTime.Now, Message = <span class="hljs-string"><span class="hljs-string">"Hello from unknown time!"</span></span>}, }; }</code> </pre> <br><p>  Apa yang kami butuhkan! </p><br><h2 id="itog">  Ringkasan </h2><br><p>  Kami belum tahu apakah kami akan mengimplementasikannya.  Hanya semua orang yang terbiasa dengan DateTimeOffset, dan sekarang menggantinya dengan tipe <em>kami</em> bodoh.  Ya, dan yang pasti masalah akan muncul di tingkat pengikatan parameter EF, ASP.NET, dan di ribuan tempat.  Tetapi solusinya sendiri nampak menarik bagi saya.  Saya menggunakan trik serupa untuk memantau keamanan input pengguna - Saya membuat jenis <code>UnsafeHtml</code> , yang secara implisit dikonversi <em>dari</em> string, tetapi Anda dapat mengubahnya kembali menjadi string atau <code>IHtmlString</code> hanya dengan memanggil pembersih. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id438946/">https://habr.com/ru/post/id438946/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id438932/index.html">Pengenalan Pola dalam Inteligensi Buatan Buatan</a></li>
<li><a href="../id438934/index.html">Buat dan konfigurasikan pembuatan portabel Lab dan Notebook Jupyter di Windows. Bagian 1</a></li>
<li><a href="../id438936/index.html">Kenalan BotMan</a></li>
<li><a href="../id438940/index.html">Kursus terbuka "Belajar dalam-dalam dengan jari"</a></li>
<li><a href="../id438942/index.html">Bayangan 2D pada Bidang Jarak yang Ditandatangani</a></li>
<li><a href="../id438948/index.html">Mengapa kita perlu optimasi tingkat rendah pada Elbrus atau bagaimana mempercepat sistem pengenalan satu setengah kali</a></li>
<li><a href="../id438950/index.html">Bank Sentral meluncurkan robot untuk mencari skema penghasilan di Internet</a></li>
<li><a href="../id438952/index.html">Apa yang dapat Anda pelajari saat mengembangkan pemutar audio untuk berbagai browser</a></li>
<li><a href="../id438954/index.html">Menggabungkan Bidang Jarak yang Ditandatangani dalam 2D</a></li>
<li><a href="../id438956/index.html">Magnetitis pada gigi: pengurutan transkriptom dari jaringan shell moluska radula</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>