<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçü§ù‚Äçüë®üèø üö£ ‚ûñ TelegramBot en la nube de Wolfram üëáüèΩ üìû ü§∂üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduccion 


 El per√≠odo ha pasado cuando cada segundo art√≠culo sobre Habrahabr se dedic√≥ a escribir su bot de telegramas. Adem√°s, pas√≥ un per√≠odo ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TelegramBot en la nube de Wolfram</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/wolfram/blog/422517/"><h2 id="vvedenie">  Introduccion </h2><br><p>  El per√≠odo ha pasado cuando cada segundo art√≠culo sobre Habrahabr se dedic√≥ a escribir su bot de telegramas.  Adem√°s, pas√≥ un per√≠odo de tiempo en el que el bot sin dificultades se pudo colocar en su computadora o en un servidor en Rusia.  Hace seis meses, mi bot reci√©n comenz√≥ en una computadora port√°til y no experiment√≥ ning√∫n problema al conectarse a la API.  Pero ahora, cuando pens√© en llevarlo de vuelta al trabajo, me di cuenta de que no ser√≠a tan f√°cil.  No quer√≠a buscar y configurar un servidor proxy, y m√°s a√∫n en el extranjero.  Adem√°s, antes de eso escrib√≠ el bot en Wolfram Language y no ten√≠a idea de c√≥mo funciona el lenguaje con los servidores proxy, ya que todav√≠a no los he usado.  ¬°Y entonces surgi√≥ una gran idea!  Utiliza Wolfram Cloud.  En este art√≠culo quiero mostrar cu√°n simple con el registro, pero sin SMS puede iniciar su bot de telegramas simple escrito en Wolfram Language.  De las herramientas solo necesitas un navegador. </p><a name="habracut"></a><br><h2 id="nemnogo-pro-oblako-wolfram">  Un poco sobre la nube de Wolfram </h2><br><p>  Para acceder a la nube, debe crear una cuenta Wolfram.  Para hacer esto, vaya a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://account.wolfram.com</a> y siga las instrucciones despu√©s de hacer clic en el bot√≥n Crear uno. </p><br><p><img src="https://habrastorage.org/webt/rl/er/tc/rlertcegmrslt0ner2zebqfajts.png"></p><br><p>  Despu√©s de todas las manipulaciones realizadas, en la p√°gina principal de la nube en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.wolframcloud.com</a> se mostrar√°n todos los productos y sus planes de uso.  Debe seleccionar la Plataforma de desarrollo y crear un nuevo cuaderno. </p><br><p><img src="https://habrastorage.org/webt/ji/nc/2i/jinc2iwgotacltqm6yh7n2gfboe.png"></p><br><p>  Todo el c√≥digo proporcionado m√°s adelante se ejecutar√° en este cuaderno en la nube en particular. </p><br><h2 id="sovsem-nemnogo-o-telegramm-botah">  Bastante sobre los bots de telegramas </h2><br><p>  Hay muchos art√≠culos dedicados a ellos.  Aqu√≠ solo es necesario decir que antes de realizar todas las acciones adicionales, el bot debe crearse de la manera est√°ndar.  Es decir, simplemente inicie una conversaci√≥n con el bot @BotFather y env√≠ele el comando: </p><br><pre><code class="plaintext hljs">/newbot</code> </pre> <br><p>  Luego solo tiene que seguir las instrucciones e ingresar el nombre e iniciar sesi√≥n.  Deje que su nombre sea Wolfram Cloud Bot e inicie sesi√≥n en @ WolframCloud5973827Bot. </p><br><p><img src="https://habrastorage.org/webt/ne/s1/xx/nes1xxki5xcpaumq5f0e6ykboxa.gif"></p><br><h2 id="realizaciya-api">  Implementaci√≥n API </h2><br><p>  Aprovechamos las recomendaciones de @BotFather y examinamos brevemente la API HTTP de los bots de telegramas.  La tarea de implementar toda la API a√∫n no merece la pena.  Para escribir un bot, solo una peque√±a parte es suficiente.  Compruebe que la API sea accesible y que el bot con el token especificado anteriormente exista.  Para hacer esto, solo haz una l√≠nea: </p><br><pre> <code class="plaintext hljs">URLExecute["https://api.telegram.org/bot753681357:AAFqdRFN_QoODJxsBy3VN2sVwWTPKJEqteY/getMe"]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Fuera [..]: = ...</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">{"ok" -&gt; True, "result" -&gt; {"id" -&gt; 753681357, "is_bot" -&gt; True, "first_name" -&gt; "Wolfram Cloud Bot", "username" -&gt; "WolframCloud5973827Bot"}}</code> </pre> </div></div><br><p>  El comando anterior es la forma m√°s f√°cil de realizar una solicitud HTTP desde Wolfram Language.  Pero vamos a complicarlo un poco para que sea f√°cil implementar todos los dem√°s m√©todos API.  Creemos un m√©todo general para ejecutar una solicitud de API: </p><br><pre> <code class="plaintext hljs">TelegramBot::usage = "TelegramBot[token]"; $telegramAPI = "https://api.telegram.org"; telegramExecute[ TelegramBot[token_String], method_String, parameters: {(_String -&gt; _)...}: {} ] := Module[{ request, requestURL, requestRules, requestBody, response, responseBody }, requestURL = URLBuild[{$telegramAPI, "bot" &lt;&gt; token, method}]; requestRules = DeleteCases[parameters, _[_String, Automatic | Null | None]]; requestBody = ImportString[ExportString[requestRules, "JSON"], "Text"]; request = HTTPRequest[requestURL, &lt;| Method -&gt; "POST", "ContentType" -&gt; "application/json; charset=utf-8", "Body" -&gt; requestBody |&gt;]; response = URLRead[request]; responseBody = response["Body"]; Return[ImportString[responseBody, "RawJSON"]] ]</code> </pre> <br><p>  Compruebe si esto funciona en el m√©todo ya probado anteriormente: </p><br><pre> <code class="plaintext hljs">token = "753681357:AAFqdRFN_QoODJxsBy3VN2sVwWTPKJEqteY"; bot = TelegramBot[token]; telegramExecute[bot, "getMe"]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Fuera [..]: = ...</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">&lt;|"ok" -&gt; True, "result" -&gt; &lt;|"id" -&gt; 753681357, "is_bot" -&gt; True, "first_name" -&gt; "Wolfram Cloud Bot", "username" -&gt; "WolframCloud5973827Bot"|&gt;|&gt;</code> </pre> </div></div><br><p>  Genial  Creemos una funci√≥n separada para realizar una verificaci√≥n de bot: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">getMe</a> - informaci√≥n del bot </li></ul><br><pre> <code class="plaintext hljs">getMe::usage="getMe[bot]"; TelegramBot /: getMe[bot_TelegramBot] := telegramExecute[bot, "getMe"] getMe[bot]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Fuera [..]: = ...</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">&lt;|"ok" -&gt; True, "result" -&gt; &lt;|"id" -&gt; 753681357, "is_bot" -&gt; True, "first_name" -&gt; "Wolfram Cloud Bot", "username" -&gt; "WolframCloud5973827Bot"|&gt;|&gt;</code> </pre> </div></div><br><p>  Ahora, de manera similar, queda por agregar los m√©todos b√°sicos que son necesarios para crear un bot en la nube: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">getUpdates</a> : obtiene todos los √∫ltimos mensajes escritos en el bot </li></ul><br><pre> <code class="plaintext hljs">getUpdates::usage = "getUpdates[bot, opts]"; Options[getUpdates] = { "offset" -&gt; Automatic, "limit" -&gt; Automatic, "timeout" -&gt; Automatic, "allowed_updates" -&gt; Automatic }; TelegramBot /: getUpdates[bot_TelegramBot, opts: OptionsPattern[getUpdates]] := telegramExecute[bot, "getUpdates", Flatten[{opts}]]</code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">setWebhook</a> : establece la direcci√≥n del servidor para procesar actualizaciones </li></ul><br><pre> <code class="plaintext hljs">setWebhook::usage = "setWebhook[bot, url, opts]"; Options[setWebhook] = { "certificate" -&gt; Automatic, "max_connections" -&gt; Automatic, "allowed_updates" -&gt; Automatic }; TelegramBot /: setWebhook[bot_TelegramBot, url_String, opts: OptionsPattern[setWebhook]] := telegramExecute[bot, "setWebhook", Join[{"url" -&gt; url}, Flatten[{opts}]]]</code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">deleteWebhook</a> : elimina un controlador </li></ul><br><pre> <code class="plaintext hljs">deleteWebhook::usage = "deleteWebhook[bot]"; TelegramBot /: deleteWebhook[bot_TelegramBot] := telegramExecute[bot, "deleteWebhook"]</code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">getWebhookInfo</a> : informaci√≥n sobre el controlador </li></ul><br><pre> <code class="plaintext hljs">getWebhookInfo::usage = "getWebhookInfo[bot]"; TelegramBot /: getWebhookInfo[bot_TelegramBot] := telegramExecute[bot, "getWebhookInfo"]</code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sendMessage</a> : env√≠a un mensaje de chat </li></ul><br><pre> <code class="plaintext hljs">sendMessage::usage = "sendMessage[bot, chat, text]"; Options[sendMessage] = { "parse_mode" -&gt; Automatic, "disable_web_page_preview" -&gt; Automatic, "disable_notification" -&gt; Automatic, "reply_to_message_id" -&gt; Automatic, "reply_markup" -&gt; Automatic }; TelegramBot /: sendMessage[bot_TelegramBot, chat_Integer, text_String, opts: OptionsPattern[sendMessage]] := telegramExecute[ bot, "sendMessage", Join[{"chat_id" -&gt; chat, "text" -&gt; text}, Flatten[{opts}]] ]</code> </pre> <br><p>  La versi√≥n m√≠nima de la API est√° lista.  Veamos c√≥mo funciona enviar un mensaje y recibir actualizaciones.  Para hacer esto, crea un chat con nuestro bot.  Cuando se crea el bot, se enviar√° el primer mensaje con el texto / inicio.  Veamos si entr√≥ en la lista de actualizaciones: </p><br><pre> <code class="plaintext hljs">updates = getUpdates[bot]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Fuera [..]: = ...</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">&lt;|"ok" -&gt; True, "result" -&gt; {&lt;|"update_id" -&gt; 570790461, "message" -&gt; &lt;|"message_id" -&gt; 1, "from" -&gt; &lt;|"id" -&gt; 490138492, "is_bot" -&gt; False, "first_name" -&gt; "Kirill", "last_name" -&gt; "Belov", "username" -&gt; "KirillBelovTest"|&gt;, "chat" -&gt; &lt;|"id" -&gt; 490138492, "first_name" -&gt; "Kirill", "last_name" -&gt; "Belov", "username" -&gt; "KirillBelovTest", "type" -&gt; "private"|&gt;, "date" -&gt; 1542182547, "text" -&gt; "/start", "entities" -&gt; {&lt;|"offset" -&gt; 0, "length" -&gt; 6, "type" -&gt; "bot_command"|&gt;}|&gt;|&gt;}|&gt;</code> </pre> </div></div><br><p>  Puede obtener los √∫ltimos datos de actualizaci√≥n de la lista de actualizaciones de la siguiente manera: </p><br><pre> <code class="plaintext hljs">lastUpdate = updates["result"][[-1]]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Fuera [..]: = ...</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">&lt;|"update_id" -&gt; 570790461, "message" -&gt; &lt;|"message_id" -&gt; 1, "from" -&gt; &lt;|"id" -&gt; 490138492, "is_bot" -&gt; False, "first_name" -&gt; "Kirill", "last_name" -&gt; "Belov", "username" -&gt; "KirillBelovTest"|&gt;, "chat" -&gt; &lt;|"id" -&gt; 490138492, "first_name" -&gt; "Kirill", "last_name" -&gt; "Belov", "username" -&gt; "KirillBelovTest", "type" -&gt; "private"|&gt;, "date" -&gt; 1542182547, "text" -&gt; "/start", "entities" -&gt; {&lt;|"offset" -&gt; 0, "length" -&gt; 6, "type" -&gt; "bot_command"|&gt;}|&gt;|&gt;</code> </pre> </div></div><br><p>  Y as√≠ es como puede obtener el chat del que vino el mensaje y el texto del mensaje en s√≠: </p><br><pre> <code class="plaintext hljs">chat = lastUpdate["message", "chat", "id"] text = lastUpdate["message", "text"]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Fuera [..]: = ...</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">490138492 /start</code> </pre> </div></div><br><p>  Como puede ver en el resultado, todo est√° en su lugar.  Ahora enviaremos un mensaje en nombre del bot usando sendMessage. </p><br><pre> <code class="plaintext hljs">sendMessage[bot, chat, "hello"]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Fuera [..]: = ...</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">&lt;|"ok" -&gt; True, "result" -&gt; &lt;|"message_id" -&gt; 2, "from" -&gt; &lt;|"id" -&gt; 753681357, "is_bot" -&gt; True, "first_name" -&gt; "Wolfram Cloud Bot", "username" -&gt; "WolframCloud5973827Bot"|&gt;, "chat" -&gt; &lt;|"id" -&gt; 490138492, "first_name" -&gt; "Kirill", "last_name" -&gt; "Belov", "username" -&gt; "KirillBelovTest", "type" -&gt; "private"|&gt;, "date" -&gt; 1542182601, "text" -&gt; "hello"|&gt;| &gt;</code> </pre> </div></div><br><p><img src="https://habrastorage.org/webt/df/-j/gd/df-jgdfzo0uejbmzxxbuja3koou.gif"></p><br><p>  En general, este conjunto de funciones ya es suficiente.  Sin embargo, usar el m√©todo getUpdates no es muy conveniente.  Debe encontrar una manera de manejar los mensajes usando webhook. </p><br><h2 id="sozdanie-webhook">  Creando webhook </h2><br><p>  Wolram Langauge tiene un tipo especial de funci√≥n que se crea usando APIFunction.  Aqu√≠ hay un ejemplo de uno de estos: </p><br><pre> <code class="plaintext hljs">apiFunc = APIFunction[{"n" -&gt; "Integer"}, Plot[Sin[#n * x], {x, -2Pi, 2Pi}]&amp;, "PNG"]; apiFunc[{"n"-&gt;3}]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Fuera [..]: = ...</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/tg/jk/vj/tgjkvjwyaje9k8yfqfspnpnwwpi.png"></p></div></div><br><p>  Estas caracter√≠sticas est√°n espec√≠ficamente dise√±adas para su implementaci√≥n en la nube.  Esta funci√≥n aceptar√° un par√°metro de solicitud como entrada.  Para implementarlo en la nube, simplemente transfiera la funci√≥n a CloudDeploy. </p><br><pre> <code class="plaintext hljs">apiObject = CloudDeploy[apiFunc, "Deploy/apiObject"]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Fuera [..]: = ...</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">CloudObject[https://www.wolframcloud.com/objects/kirillbelovtest/apiObject]</code> </pre> </div></div><br><p>  Luego puede seguir el enlace en el navegador y agregar un par√°metro de consulta: </p><br><p><img src="https://habrastorage.org/webt/__/th/nt/__thntqsmtke_w8lx_ysyiqagey.gif"></p><br><p>  La funci√≥n anterior maneja los par√°metros de solicitud.  Por lo tanto, debe crear la misma funci√≥n para procesar el cuerpo de la solicitud HTTP que proviene del bot de telegramas en forma de un objeto Actualizar.  Para generar la direcci√≥n, utilizamos un token para obtener acceso al objeto en la nube fue m√°s dif√≠cil.  Tambi√©n debe indicar que el objeto tiene acceso p√∫blico, de lo contrario, los telegramas no podr√°n acceder al webhook. </p><br><pre> <code class="plaintext hljs">deployWebhook[bot_TelegramBot, handler_] := CloudDeploy[APIFunction[{}, handler[HTTPRequestData["Body"]] &amp;], "Deploy/Webhooks/" &lt;&gt; Hash[bot, "SHA", "HexString"], Permissions -&gt; "Public" ]</code> </pre> <br><p>  manejador es otro manejador de funciones.  Deje que el controlador convierta la cadena del cuerpo de la solicitud en una asociaci√≥n, obtenga el identificador de chat desde all√≠ y env√≠e la palabra "hola". </p><br><pre> <code class="plaintext hljs">handlerHello[bot_TelegramBot][body_String] := Block[{json = ImportString[body, "RawJSON"], chat}, chat = json["message", "chat", "id"]; sendMessage[bot, chat, "hello"]; ]</code> </pre> <br><p>  Ahora despliega el funky en la nube. </p><br><pre> <code class="plaintext hljs">webhookObject = deployWebhook[bot, handlerHello[bot]]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Fuera [..]: = ...</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">CloudObject[https://www.wolframcloud.com/objects/kirillbelovtest/Deploy/Webhooks/b9bd74f89348faecd6b683ba02637dd4d4028a28]</code> </pre> </div></div><br><p>  Y el √∫ltimo paso es transferir la direcci√≥n de este objeto al bot de telegramas. </p><br><pre> <code class="plaintext hljs">setWebhook[bot, webhookObject[[1]]]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Fuera [..]: = ...</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">&lt;|"ok" -&gt; True, "result" -&gt; True, "description" -&gt; "Webhook was set"|&gt;</code> </pre> </div></div><br><p>  Ahora escribiremos algo para el bot y veremos qu√© dice: </p><br><p><img src="https://habrastorage.org/webt/3l/ft/by/3lftbys5dvmtauvrmvom1wtggtc.gif"></p><br><p>  El di√°logo puede considerarse v√°lido.  Para cambiar la l√≥gica de un controlador existente, simplemente vuelva a implementar el objeto en la nube.  Al mismo tiempo, ya no necesitar√° instalar webhook para el bot. </p><br><h2 id="logika-otvetov">  L√≥gica de respuestas </h2><br><p>  Esta ser√° la √∫ltima parte en el proceso de creaci√≥n de un bot en la nube de Wolfram.  Adem√°s, de la misma manera, puede complicar la l√≥gica y agregar nuevos m√©todos API.  Ahora sobre el di√°logo en s√≠.  Supongamos que despu√©s de enviar el comando / start, el bot devuelve una respuesta "Hola" y cambia el teclado del usuario.  Solo quedan dos botones en el teclado: "Hola" y "¬øQui√©n eres?"  Realizamos el di√°logo en forma de asociaci√≥n.  Las teclas ser√°n los comandos que el usuario env√≠a al bot.  Los valores clave son la respuesta del bot en s√≠ y el nuevo teclado.  En este caso, muchas teclas y botones deben coincidir exactamente.  De lo contrario, puede surgir una situaci√≥n cuando el bot no sabe qu√© responder.  En tales casos, por supuesto, puede agregar una respuesta predeterminada. </p><br><pre> <code class="plaintext hljs">keyboard[buttons : {__String}] := {"keyboard" -&gt; {Table[{"text" -&gt; button}, {button, buttons}]}, "resize_keyboard" -&gt; True} $answers = &lt;| (*user_text-&gt;&lt;|"answer"-&gt;bot_text,"keyboard"-&gt;next_text|&gt;*) "/start"-&gt;&lt;|"answer"-&gt;"","keyboard"-&gt; keyboard[{""," ?"}]|&gt;, ""-&gt;&lt;|"answer"-&gt;" ?", "keyboard" -&gt; keyboard[{" ?"}]|&gt; , " ?"-&gt;&lt;|"answer"-&gt;"", "keyboard" -&gt; keyboard[{""}]|&gt; , " ?"-&gt;&lt;|"answer"-&gt;"   Wolfram Language   ", "keyboard"-&gt;keyboard[{" ?"," ?"}]|&gt; , " ?"-&gt;&lt;|"answer"-&gt;"   :\nhttps://habr.com/post/422517/", "keyboard"-&gt;keyboard[{""," ?"}]|&gt; , " ?"-&gt;&lt;|"answer"-&gt;"  :\n@KirillBelovTest", "keyboard"-&gt;keyboard[{" ?",""}]|&gt; , ""-&gt;&lt;|"answer"-&gt;"", "keyboard"-&gt;keyboard[{""," ?"}]|&gt; |&gt;; answer[text_String] /; KeyExistsQ[$answers, text] := $answers[text]</code> </pre> <br><p>  Ahora cree un controlador: </p><br><pre> <code class="plaintext hljs">handlerAbout[bot_TelegramBot][body_String] := Block[{json = ImportString[body, "RawJSON"], chat, text}, chat = json["message", "chat", "id"]; text = json["message", "text"]; sendMessage[bot, chat, answer[text]["answer"], "reply_markup" -&gt; answer[text]["keyboard"]]; ]</code> </pre> <br><p>  Y vuelva a implementar el objeto en la nube: </p><br><pre> <code class="plaintext hljs">deployWebhook[bot, handlerAbout[bot]];</code> </pre> <br><p>  Verifiquemos qu√© sucedi√≥ en el chat con el bot.  Pero primero, borremos el historial de mensajes: </p><br><p><img src="https://habrastorage.org/webt/ar/rr/j0/arrrj0gaxdyrhcysog_vxleb4hw.gif"></p><br><h2 id="rasshirenie-funkcionalnosti">  Extensi√≥n de funcionalidad </h2><br><p>  Hasta ahora, no hay diferencias fundamentales con respecto a la gran cantidad de bots existentes.  ¬øQuiz√°s tampoco tiene sentido beberlo?  ¬°El significado de todo el trabajo realizado anteriormente ser√°, si comprende cu√°les son las ventajas de tal bot!  Despu√©s de todo, puede usar todas las caracter√≠sticas de Wolfram Language y Wolrfam Cloud.  ¬øEs necesario que el robot resuelva ecuaciones?  Es muy facil!  ¬°Solo necesita redefinir la respuesta! </p><br><pre> <code class="plaintext hljs">answer[text_String]["keyboard"] /; StringContainsQ[text, "  "] := Automatic answer[text_String]["answer"] /; StringContainsQ[text, "  "] := ToString[Flatten[Block[{args = StringSplit[text, "  "]}, Solve[ToExpression[args[[1]]], ToExpression[args[[2]]]] ]]] deployWebhook[bot, handlerAbout[bot]];</code> </pre> <br><p><img src="https://habrastorage.org/webt/ei/wc/ex/eiwcexe7iqdlhdtolosjrialh8q.gif"></p><br><p>  Si alguien tambi√©n tiene inter√©s en las capacidades de la nube, aqu√≠ encontrar√° una buena descripci√≥n de su funcionalidad. </p><br><h2 id="ogranicheniya">  Limitaciones </h2><br><p>  Wolfram Cloud es una plataforma que le permite utilizar el lenguaje Wolfram de forma gratuita, mientras que el producto principal de Wolfram Research, Mathematica, cuesta dinero.  En consecuencia, existen restricciones en el uso y, en mi opini√≥n, son muy fuertes.  Al usar la versi√≥n gratuita de la Plataforma de desarrollo, un usuario recibe 1000 cr√©ditos en la nube por mes.  Cada pr√©stamo en la nube da tiempo para calcular un tipo diferente.  Como el art√≠culo habla sobre CloudDeploy + APIFunction, tales objetos almacenados en la nube gastan 1 cr√©dito en 0.1 segundos de tiempo de computaci√≥n.  Es f√°cil calcular que el usuario recibe de forma gratuita solo 1 minuto y 40 segundos de tiempo de servidor para el funcionamiento de su aplicaci√≥n (en este caso, el bot).  No tengo nada que agregar aqu√≠, es muy, muy peque√±o.  El √©nfasis principal est√° en los usuarios que trabajan de forma independiente en la Plataforma de Desarrollo utilizando un navegador.  De hecho, en este modo no hay l√≠mites de tiempo, sino solo de acuerdo con la duraci√≥n de la sesi√≥n y los recursos asignados.  Con este uso, la plataforma de desarrollo es casi un Mathematica completo, pero no requiere instalaci√≥n ni licencia. </p><br><p>  ‚Üí <a href="">Art√≠culo y c√≥digo en Wolfram Cloud</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es422517/">https://habr.com/ru/post/es422517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es422507/index.html">PHP 7.3. Que hay de nuevo</a></li>
<li><a href="../es422509/index.html">Resumen del libro "Nunca comas solo"</a></li>
<li><a href="../es422511/index.html">Cargando datos en Splunk: Universal Forwarder vs Heavy Forwarder. Cual es la diferencia</a></li>
<li><a href="../es422513/index.html">7 consejos sobre c√≥mo no enfurecer a un colega probador en sus vacaciones</a></li>
<li><a href="../es422515/index.html">Dos seminarios web Apaita Ignite y computaci√≥n en memoria en septiembre</a></li>
<li><a href="../es422519/index.html">Distribuci√≥n Freebie: Subprocesos sin frenos en Java. Telar del proyecto</a></li>
<li><a href="../es422521/index.html">Presagio de lo inevitable</a></li>
<li><a href="../es422525/index.html">"La matriz de la amistad". El gr√°fico social m√°s antiguo para los m√°s peque√±os.</a></li>
<li><a href="../es422527/index.html">Resumen de noticias de PostgreSQL. N√∫mero 10</a></li>
<li><a href="../es422529/index.html">Curso especial del grupo IB: "Seguridad de aplicaciones m√≥viles"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>