<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêû ‚è∫Ô∏è üèùÔ∏è A hist√≥ria de um "desenvolvedor" ou como um iniciante deve escrever um aplicativo para iOS üõÑ üìÅ üó≥Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ent√£o, maio de 2018. Foram feitas 7 tentativas em 7 anos para come√ßar a programar algo para iOS. E cada vez a mesma coisa: Objective-C √© algo assustad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>A hist√≥ria de um "desenvolvedor" ou como um iniciante deve escrever um aplicativo para iOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469387/"><img src="https://habrastorage.org/webt/oe/bp/os/oebpos7zdtlt8gx_bn3xaeeqct0.png"><br><br>  Ent√£o, maio de 2018.  Foram feitas 7 tentativas em 7 anos para come√ßar a programar algo para iOS.  E cada vez a mesma coisa: Objective-C √© algo assustador e incompreens√≠vel, ent√£o n√£o h√° id√©ia.  E ent√£o Ol√° Mundo, uma vez por ano, em geral, as coisas n√£o corriam ... <br><br>  Desta vez, um novo Xcode e um novo idioma para mim, Swift ... E uma nova id√©ia, quero enviar notifica√ß√µes para o meu servidor Zabbix.  n√£o h√° estoque oficial e n√£o havia clientes naquele momento ... <br><br>  Antes disso, o bot enviou um pushgram para o push, mas come√ßou a afundar e Roskomnadzor chegou a tempo ... O bloqueio do carrinho n√£o desempenha um papel especial, porque  existe o Mikrotik e foi imediatamente "consertado". <br><br>  Foi decidido escrever uma notifica√ß√£o do Zabbix, que n√£o ser√° apenas para notifica√ß√µes. <br><a name="habracut"></a><br>  Como se viu, apenas enviar notifica√ß√µes n√£o funcionar√°.  Voc√™ precisa escrever um aplicativo, instal√°-lo, obter um token, elevar seu servidor para enviar notifica√ß√µes push ... <br><br>  A experi√™ncia de programa√ß√£o foi apenas em PHP.  Swift √© diferente, mas n√£o parecia t√£o intimidador quanto o Objective-C na √©poca.  E o pr√≥prio Xcode √© bom como um IDE que converte c√≥digo do antigo para o novo, faz sugest√µes. <br><br>  Primeiro, v√≠deos de treinamento, aprendendo a pr√≥pria API do Zabbix.  Mas ent√£o, um artigo ap√≥s o outro, como o NSURLSession funciona, quais estruturas existem. <br><br>  A primeira vers√£o s√≥ conseguiu fazer login no servidor Zabbix e fornecer acionadores e hosts.  Adicionadas visualiza√ß√µes de gr√°ficos, valores etc. <br><br>  Vou me debru√ßar sobre alguns pontos que encontrei ao escrever o aplicativo. <br><br><h2>  Frameworks </h2><br>  As estruturas n√£o entraram.  Eles s√£o "legais", confort√°veis, mas n√£o quero consertar o projeto mais tarde devido ao fato de que algo mudou.  E isso j√° aconteceu.  Por mim, decidi n√£o us√°-las, e √© melhor inventar minha bicicleta para entender como tudo funciona.  Para solicita√ß√µes JSON, existe o Alamofire, mas eu uso o NSURLSession interno porque  √© o suficiente para tudo. <br><br><h2>  Testes </h2><br>  Mais de um ano se passou at√© ent√£o, quando eu decidi adicionar testes :) <br>  Eu pensei que essa coisa fascinante salvaria o mundo ... Mas ... eu escrevi v√°rios testes diferentes, cutuquei aqui ... E a pregui√ßa veio.  At√© agora, n√£o vejo tarefas em um projeto t√£o pequeno para alocar tanto tempo para testes ... E isso √© apenas tempo para testes de c√≥digo, sem mencionar os testes de interface do usu√°rio. <br><br><img src="https://habrastorage.org/webt/o1/un/zo/o1unzoeht1dafvq0rfojui5fonk.png" alt="imagem"><br><h2>  Criptografia </h2><br>  Havia v√°rios pontos na criptografia. <br><br>  A Apple, de acordo com seus manuais, deseja que todos os pedidos sejam criptografados.  E isso est√° certo.  Mas, como a pr√°tica demonstrou, nem todo mundo queria fazer https para o seu Zabbix.  No come√ßo, eu n√£o tinha a op√ß√£o (Configura√ß√µes de seguran√ßa de transporte de aplicativos) que permitia tr√°fego http puro, para o qual fui crucificado nos coment√°rios na AppStore. Ent√£o liguei-o n√£o sem aventura.  O Xcode n√£o percebeu minha linha at√© eu recriar todo o arquivo Info.plist. <br><br>  Al√©m disso, a Apple quer saber tudo sobre o seu aplicativo, o tr√°fego https usual n√£o se enquadra nisso.  Mas se voc√™ quiser criptografar algo "de maneira complicada", informe as autoridades dos EUA. <br><br><img src="https://habrastorage.org/webt/vo/ok/q5/vookq5vegfsrnnm6zvovrcmpwro.png" alt="imagem"><br><br>  Ao se comunicar com um dos usu√°rios do aplicativo, houve uma solicita√ß√£o de criptografia de mensagens PUSH de ponta a ponta.  A mensagem deve ser criptografada no servidor Zabbix e descriptografada apenas no telefone.  Para tal, a Apple tem notifica√ß√µes "mut√°veis".  I.e.  se "conte√∫do mut√°vel" chegou, ent√£o, no impulso, voc√™ precisa alterar algo de acordo com o que escreve.  Eu tinha que descriptografar a mensagem. <br><br>  A pol√≠tica da Apple aqui n√£o √© contr√°ria ao uso de tipos padr√£o de criptografia.  Voc√™ quer algo seu, como escrevi acima, me d√™ um peda√ßo de papel e possa me mostrar a chave? ... <br><br>  Eu usei o CommonCrypto lib interno, portanto esse √© considerado o tipo padr√£o de criptografia.  Eu tive que mexer com o c√≥digo, porque  a maioria dos exemplos est√° muito desatualizada ou o Xcode gritou que n√£o era seguro, n√£o tinha nada para trabalhar com bytes e dados diretamente ou se divertiu com o IV OpenSSL-a, o deslocamento n√£o estava certo, ent√£o outra coisa n√£o estava certa.  Como resultado, foi poss√≠vel criar c√≥digo n√£o jurament√°vel e funcionar corretamente com o OpenSSL ao criptografar mensagens. <br><br><h2>  Curto-circuito </h2><br>  E o t√≥pico mais emocionante para mim ... eu n√£o conseguia escrever c√≥digo ass√≠ncrono ....  At√© agora, pelo menos eu n√£o entendi muito bem como esses fechamentos funcionam. <br><br><img src="https://habrastorage.org/webt/9b/gk/ob/9bgkobrxhssqlmyif-lm7glk09u.png" alt="imagem"><br><br>  Por padr√£o, o NSURLSession √© ass√≠ncrono e n√£o consegui entender como trabalhar com ele mais tarde ... Eu usei o DispatchSemaphore para tornar o c√≥digo s√≠ncrono ... Naturalmente, houve muitas reclama√ß√µes dos usu√°rios de que ele travava e travava ... <br><br>  Mesmo assim, percebi o que e como funcionava no circuito, o tempo limite no NSURLSession e o que √© o qu√™.  O c√≥digo foi completamente substitu√≠do pelo normal, manipuladores de erro foram adicionados.  E a vida se tornou melhor, a vida se tornou mais divertida. <br><br><h2>  Layout </h2><br><img src="https://habrastorage.org/webt/7t/my/fz/7tmyfzxt8je0azn4ygnesshmf0g.png"><br><br>  Sim, eu tenho tudo em um Storyboard.  Eu sei que isso n√£o √© muito, mas at√© agora existem poucas telas.  Talvez eu coloque no xibs mais tarde. <br><br>  O iOS 13 trouxe mudan√ßas para as telas.  Anteriormente, todas as novas telas eram mostradas como PUSH, ou seja,  tela cheia.  Agora, esta tela pode ser baixada e fechar√°. <br><br>  Em geral, houve um erro se voc√™ clicar em Logout e simplesmente recolher o formul√°rio de login novamente.  Isso s√≥ acontece se o √∫ltimo Xcode for montado 11. √â corrigido simplesmente configurando a op√ß√£o de visualiza√ß√£o para exibir somente em tela cheia. <br><br>  Tamb√©m no iOS 13, o SwiftUI apareceu, mas se voc√™ refazer o aplicativo agora, significa esquecer aqueles que o usam em dispositivos antigos com firmware antigo ... <br><br><h2>  Layout da AppStore </h2><br>  Embora tenha escrito o aplicativo para mim, decidi public√°-lo na AppStore.  Tudo √© pago apenas US $ 100 por ano e divulgado.  A verdade ainda est√° verificando o aplicativo, explique por que esse aplicativo etc. <br><br>  Porque  aplica√ß√£o para o Zabbix, no logotipo eu queria usar algo que diz sobre o Zabbix.  Mas n√£o estava l√°.  Escrevi uma carta para o Zabbix pedindo que fosse poss√≠vel usar o formato da letra Z ... Mas n√£o.  Por isso, pintei meu √≠cone, uma curva inclinada, mas a minha) <br><br><h2>  Finan√ßas </h2><br>  A aplica√ß√£o tem quase 2 anos.  Gastou US $ 200 apenas para ter o aplicativo na AppStore.  Al√©m do desenvolvimento e do servidor push. <br><br><img src="https://habrastorage.org/webt/pl/mi/vf/plmivfphkjfbv-f2wxo8gsjqamk.png" alt="imagem"><br>  O aplicativo possui um an√∫ncio do Google ... que trouxe ... ... $ 5 <br>  A desativa√ß√£o da publicidade gerou US $ 88 ... Mas o limite de retirada √© de US $ 150. <br>  Em seguida, excluirei os an√∫ncios em geral assim que atingir o limite de retirada. <br><br><h2>  Servidor push </h2><br>  Sim, sim, tudo come√ßou para ele ... As notifica√ß√µes por push est√£o sendo solicitadas.  Uma vez feito, para que voc√™ possa criptografar agressivamente, muitos mudaram para criptografados. <br><br>  Existem 2 servidores, Moscou e Holanda, a 2 rublos / dia.  Balanceamento de DNS, Nginx c Let's Encrypt, script PHP para recebimento e envio. <br><br>  Inicialmente, havia um servidor gratuito na Amazon (15 GB de tr√°fego ...), mas quando chegou a hora, comprei um VPS-ku para mudar para l√°.  E descobri o momento em que o DDOS estava indo para o provedor de hospedagem e o vps n√£o estava dispon√≠vel por 12 horas ... 2 rublos dos quais quero mais.  Bem, eu ainda estava na Amaz√¥nia e ainda n√£o me afetou.  Portanto, outro foi tomado por 2 rublos por dia, mas em um local diferente.  Pelo menos alguma toler√¢ncia a falhas e tr√°fego de 15 gigabytes ... As principais preocupa√ß√µes para o tr√°fego da Amazon, microddos e voc√™ conseguiu o dinheiro. <br><br>  Eu queria usar o Cloudflare como um balanceador, mas eles querem a delega√ß√£o de todo o dom√≠nio para eles, e n√£o para o dom√≠nio. <br><br><h2>  Algumas estat√≠sticas </h2><br>  Quase 6 mil downloads no total.  E o Brasil est√° no topo ... quem teria pensado) <br><br><img src="https://habrastorage.org/webt/zn/sd/ef/znsdefftcax1rqoctbocrnt3dp8.png" alt="imagem"><br><br><h2>  Conclus√µes </h2><br><ul><li>  Swift n√£o √© nada disso) </li><li>  A abund√¢ncia de artigos e a conveni√™ncia do IDE no mundo moderno permitem que voc√™ inicie rapidamente. </li><li>  O aplicativo foi escrito inicialmente para mim, mas acabou sendo uma boa experi√™ncia com o desenvolvimento e o layout na AppStore com cr√≠ticas positivas e negativas. </li><li>  O desenvolvimento limpa bem o c√©rebro. </li><li>  √â melhor ler as docas e n√£o tornar s√≠ncronas a partir do c√≥digo ass√≠ncrono :) </li><li>  Geralmente escreva, copie, estude.  Somente assim √© poss√≠vel entender na pr√°tica o que √© o qu√™. </li><li>  * Comunique-se mais com os usu√°rios, eles definitivamente dir√£o por que precisam e como querem v√™-lo.  Eu adicionei um ter√ßo da funcionalidade no aplicativo precisamente de acordo com os desejos dos usu√°rios. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt469387/">https://habr.com/ru/post/pt469387/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt469373/index.html">Os resultados do projeto para criar uma interface neural para pacientes completamente paralisados ‚Äã‚Äãquestionaram</a></li>
<li><a href="../pt469375/index.html">Por que Mozilla, Coil e Creative Commons destinam US $ 100 milh√µes para projetos de c√≥digo aberto?</a></li>
<li><a href="../pt469379/index.html">Aplica√ß√£o de m√©todos formais de valida√ß√£o de modelo para UI</a></li>
<li><a href="../pt469381/index.html">Agones, crie um servidor de jogos multiusu√°rio. Arquitetura e Instala√ß√£o</a></li>
<li><a href="../pt469383/index.html">Solu√ß√£o hiperconvergente AERODISK vAIR. Base - Sistema de Arquivos ARDFS</a></li>
<li><a href="../pt469389/index.html">Parametriza√ß√£o por uma rede neural de um modelo f√≠sico para resolver um problema de otimiza√ß√£o topol√≥gica</a></li>
<li><a href="../pt469391/index.html">Interfaces de √°udio: o som como fonte de informa√ß√£o na estrada, no escrit√≥rio e no c√©u</a></li>
<li><a href="../pt469393/index.html">Reda√ß√£o do Flare-On 2019</a></li>
<li><a href="../pt469395/index.html">Onde e como usar v√°rias colunas (colunas CSS)</a></li>
<li><a href="../pt469399/index.html">Wi-Fi no Arkhangelskoye Museum-Estate</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>