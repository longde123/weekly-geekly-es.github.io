<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüé® ‚è∏Ô∏è üßëüèø‚Äçü§ù‚Äçüßëüèª ESET: Nouveaux sch√©mas de livraison de porte d√©rob√©e OceanLotus Cybergroup üé∏ üëè ü§õüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans un article, nous d√©crirons comment le cyber-groupe OceanLotus (APT32 et APT-C-00) a r√©cemment utilis√© l'un des exploits publics pour CVE-2017-118...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ESET: Nouveaux sch√©mas de livraison de porte d√©rob√©e OceanLotus Cybergroup</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/446604/">  Dans un article, nous d√©crirons comment le cyber-groupe OceanLotus (APT32 et APT-C-00) a r√©cemment utilis√© l'un des exploits publics pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2017-11882</a> , la vuln√©rabilit√© de corruption de m√©moire dans Microsoft Office et comment le logiciel malveillant de groupe assure la persistance dans les syst√®mes compromis sans laisser de traces. .  Ensuite, nous d√©crivons comment, depuis le d√©but de 2019, le groupe a utilis√© des archives auto-extractibles pour ex√©cuter le code. <br><br>  OceanLotus est sp√©cialis√© dans le cyberespionnage, avec des objectifs prioritaires en Asie du Sud-Est.  Les attaquants falsifient des documents qui attirent l'attention des victimes potentielles pour les convaincre d'effectuer une porte d√©rob√©e et travaillent √©galement au d√©veloppement d'outils.  Les m√©thodes utilis√©es pour cr√©er des leurres varient selon les attaques - des fichiers √† "double extension", des archives auto-extractibles, des documents avec des macros aux exploits connus. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ap/h9/mc/aph9mchsgkupnlpka6cf7g_u13g.jpeg"></div><br><a name="habracut"></a><h2>  Utilisation d'un exploit dans Microsoft Equation Editor </h2><br>  Mi-2018, OceanLotus a lanc√© une campagne utilisant la vuln√©rabilit√© CVE-2017-11882.  Un des documents malveillants du cybergroupe a √©t√© analys√© par 360 experts du Threat Intelligence Center (une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©tude en chinois</a> ), y compris une description d√©taill√©e de l'exploit.  Dans le post ci-dessous, un aper√ßu d'un tel document malveillant. <br><br><h3>  Premi√®re √©tape </h3><br>  Le <code>FW Report on demonstration of former CNRP in Republic of Korea.doc</code> (SHA-1: <code>D1357B284C951470066AAA7A8228190B88A5C7C3</code> ) est similaire √† celui mentionn√© dans l'√©tude ci-dessus.  Il est int√©ressant en ce qu'il cible les utilisateurs int√©ress√©s par la politique cambodgienne (CNRP - Cambodian's National Salvation Party, dissous fin 2017).  Malgr√© l'extension .doc, le document a le format RTF (voir la figure ci-dessous), contient du code ind√©sirable et est √©galement d√©form√©. <br><br><img src="https://habrastorage.org/webt/a-/gt/6y/a-gt6ylnd0rbyzvs8eecjpi04-a.png"><br>  <i>Figure 1. Corbeille dans RTF</i> <br><br>  Malgr√© la pr√©sence d'√©l√©ments d√©form√©s, Word ouvre correctement ce fichier RTF.  Comme le montre la figure 2, voici la structure EQNOLEFILEHDR avec un d√©calage de 0xC00, suivie de l'en-t√™te MTEF, puis de l'entr√©e MTEF (figure 3) pour la police. <br><br><img src="https://habrastorage.org/webt/oh/ks/tb/ohkstbugzx97wthqqqnrdoo27di.png"><br>  <i>Figure 2. Valeurs d'enregistrement FONT</i> <br><br><img src="https://habrastorage.org/webt/jy/wj/b5/jywjb5bgsixdqywivkc_ndzcgiu.png"><br>  <i>Figure 3. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Format d'enregistrement FONT</a></i> <br><br>  Un d√©bordement dans le champ du <i>nom</i> est possible, car sa taille n'est pas v√©rifi√©e avant la copie.  Un nom trop long d√©clenche une vuln√©rabilit√©.  Comme le montre le contenu du fichier RTF (d√©calage 0xC26 sur la figure 2), le tampon est rempli de code shell, suivi d'une commande fictive ( <code>0x90</code> ) et d'une adresse de retour <code>0x402114</code> .  L'adresse est une bo√Æte de dialogue dans <code>EQNEDT32.exe</code> qui pointe vers une instruction <code>RET</code> .  Cela am√®ne EIP √† pointer vers le d√©but du champ de <i>nom</i> contenant le shellcode. <br><br><img src="https://habrastorage.org/webt/_9/gf/lo/_9gflo6k9zsefvvnq8jdaqosuua.png"><br>  <i>Figure 4. D√©but du shellcode d'exploitation</i> <br><br>  L'adresse <code>0x45BD3C</code> stocke une variable qui est d√©r√©f√©renc√©e jusqu'√† ce qu'elle atteigne un pointeur vers la structure <code>MTEFData</code> actuellement charg√©e.  Voici le reste du shellcode. <br><br>  Le but du code shell est d'ex√©cuter le deuxi√®me fragment du code shell incorpor√© dans un document ouvert.  Tout d'abord, le shellcode source essaie de trouver le descripteur de fichier du document ouvert, <code>NtQuerySystemInformation</code> sur tous les descripteurs syst√®me ( <code>NtQuerySystemInformation</code> avec l'argument <code>SystemExtendedHandleInformation</code> ) et v√©rifiant si le descripteur <i>PID</i> et le processus <i>PID de</i> <code>WinWord</code> et si le document a √©t√© ouvert avec le masque d'acc√®s - <code>0x12019F</code> . <br><br>  Pour confirmer la d√©tection du descripteur correct (et non le descripteur d'un autre document ouvert), le contenu du fichier est affich√© √† l'aide de la fonction <code>CreateFileMapping</code> , et le code shell v√©rifie si les quatre derniers octets du document correspondent √† " <code>yyyy</code> " (m√©thode de chasse aux ≈ìufs).  D√®s qu'une correspondance est trouv√©e, le document est copi√© dans un dossier temporaire ( <code>GetTempPath</code> ) en tant que <code>ole.dll</code> .  Ensuite, les 12 derniers octets du document sont lus. <br><br><img src="https://habrastorage.org/webt/w3/lq/xv/w3lqxvqbmerfijoryxi3vkitaao.png"><br>  <i>Figure 5. Marqueurs de fin de document</i> <br><br>  La valeur 32 bits entre les marqueurs <code>AABBCCDD</code> et <code>yyyy</code> est le d√©calage du prochain <code>AABBCCDD</code> .  Il est appel√© √† l'aide de la fonction <code>CreateThread</code> .  Extrait le m√™me shellcode utilis√© par OceanLotus auparavant.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le script d'√©mulation Python que</a> nous avons publi√© en mars 2018 fonctionne toujours pour vider la deuxi√®me √©tape. <br><br><h3>  Deuxi√®me √©tape </h3><br><h4>  R√©cup√©ration des composants </h4><br>  Les noms de fichiers et de r√©pertoires sont s√©lectionn√©s dynamiquement.  Le code s√©lectionne de mani√®re al√©atoire le nom d'un fichier ex√©cutable ou DLL dans <code>C:\Windows\system32</code> .  Il fait ensuite une demande √† ses ressources et r√©cup√®re le champ <code>FileDescription</code> pour l'utiliser comme nom de dossier.  Si cela ne fonctionne pas, le code s√©lectionne au hasard le nom du dossier dans les r√©pertoires <code>%ProgramFiles%</code> ou <code>C:\Windows</code> (dans GetWindowsDirectoryW).  Il √©vite l'utilisation d'un nom susceptible d'entrer en conflit avec les fichiers existants et garantit qu'il ne contient pas les mots suivants: <code>windows</code> , <code>Microsoft</code> , <code>desktop</code> , <code>system</code> , <code>system32</code> ou <code>syswow64</code> .  Si le r√©pertoire existe d√©j√†, "NLS_ {6 caract√®res}" est ajout√© au nom. <br><br>  La ressource <code>0x102</code> analys√©e et les fichiers sont transf√©r√©s dans <code>%ProgramFiles%</code> ou <code>%AppData%</code> , dans un dossier s√©lectionn√© de mani√®re al√©atoire.  Le temps de cr√©ation a chang√© pour avoir les m√™mes valeurs que <code>kernel32.dll</code> . <br><br>  Par exemple, voici un dossier et une liste de fichiers cr√©√©s en s√©lectionnant le fichier ex√©cutable <code>C:\Windows\system32\TCPSVCS.exe</code> comme source de donn√©es. <br><br><img src="https://habrastorage.org/webt/px/ls/xq/pxlsxqrz8s0beuxfybxu0cvz8dg.png"><br>  <i>Figure 6. Extraction de divers composants</i> <br><br>  La structure de la ressource <code>0x102</code> dans le compte-gouttes est assez compliqu√©e.  En r√©sum√©, il contient: <br>  - noms de fichiers <br>  - Taille et contenu des fichiers <br>  - Format de compression ( <code>COMPRESSION_FORMAT_LZNT1</code> utilis√© par la fonction <code>RtlDecompressBuffer</code> ) <br><br>  Le premier fichier est r√©initialis√© en tant que <code>TCPSVCS.exe</code> , qui est l' <code>AcroTranscoder.exe</code> l√©gitime (selon <code>FileDescription</code> , SHA-1: <code>2896738693A8F36CC7AD83EF1FA46F82F32BE5A3</code> ). <br><br>  Vous avez peut-√™tre remarqu√© que certains fichiers DLL d√©passent 11 Mo.  Cela est d√ª au fait qu'un grand tampon contigu de donn√©es al√©atoires se trouve √† l'int√©rieur du fichier ex√©cutable.  Il est possible que ce soit un moyen d'√©viter la d√©tection par certains produits de s√©curit√©. <br><br><h4>  Persistance </h4><br>  La ressource <code>0x101</code> dans le <code>0x101</code> contient deux entiers 32 bits qui d√©terminent comment maintenir la persistance.  La valeur de la premi√®re indique comment le logiciel malveillant conservera sa persistance sans droits d'administrateur. <br><br><img src="https://habrastorage.org/webt/f6/aw/1x/f6aw1xtjqv-tfril3uzrx_nzstw.png"><br>  <i>Tableau 1. M√©canisme de persistance sans droits d'administrateur</i> <br><br>  La valeur du deuxi√®me entier indique comment le malware doit garantir la persistance tout en travaillant en tant qu'administrateur. <br><br><img src="https://habrastorage.org/webt/db/p2/em/dbp2embzyazeoxdnk8h6uji9lm4.png"><br>  <i>Tableau 2. M√©canisme de persistance avec droits d'administrateur</i> <br><br>  Un nom de service est un nom de fichier sans extension;  le nom d'affichage est le nom du dossier, mais s'il existe d√©j√†, la cha√Æne ¬´ <code>Revision 1</code> ¬ª lui est ajout√©e (le nombre augmente jusqu'√† ce qu'un nom inutilis√© soit trouv√©).  Les op√©rateurs se sont assur√©s que la persistance √† travers le service √©tait stable - en cas de panne, le service devrait √™tre red√©marr√© apr√®s 1 seconde.  Ensuite, la valeur <code>WOW64</code> de la nouvelle cl√© de Registre de service est d√©finie sur 4, ce qui indique qu'il s'agit d'un service 32 bits. <br><br>  La t√¢che planifi√©e est cr√©√©e via plusieurs interfaces COM: <code>ITaskScheduler</code> , <code>ITask</code> , <code>ITaskTrigger</code> , <code>IPersistFile</code> et <code>ITaskScheduler</code> .  En substance, le programme malveillant cr√©e une t√¢che masqu√©e, d√©finit les informations de compte ainsi que des informations sur l'utilisateur ou l'administrateur actuel, puis d√©finit le d√©clencheur. <br><br>  Il s'agit d'une t√¢che quotidienne d'une dur√©e de 24 heures et d'intervalles entre deux cycles de 10 minutes, ce qui signifie qu'elle sera effectu√©e en continu. <br><br><h4>  Bit malveillant </h4><br>  Dans notre exemple, le fichier ex√©cutable <code>TCPSVCS.exe</code> ( <code>AcroTranscoder.exe</code> ) est un logiciel l√©gitime qui t√©l√©charge les DLL qui en sont vid√©es.  Dans ce cas, <code>Flash Video Extension.dll</code> pr√©sente un int√©r√™t. <br><br>  Sa fonction <code>DLLMain</code> appelle simplement une autre fonction.  Certains pr√©dicats flous sont pr√©sents: <br><br><img src="https://habrastorage.org/webt/b-/im/fe/b-imfeegcv30g23fj2n9qqowdeu.png"><br>  <i>Figure 7. Pr√©dicats flous</i> <br><br>  Apr√®s ces v√©rifications trompeuses, le code re√ßoit la section <code>.text</code> du fichier <code>TCPSVCS.exe</code> , modifie sa protection en <code>PAGE_EXECUTE_READWRITE</code> et l'√©crase en ajoutant des instructions factices: <br><br><img src="https://habrastorage.org/webt/dp/e7/fn/dpe7fnpq2lrioo0i15ki742mhro.png"><br>  <i>Figure 8. La s√©quence d'instructions</i> <br><br>  √Ä la fin, l'instruction <code>CALL</code> est ajout√©e √† l'adresse de la fonction <code>FLVCore::Uninitialize(void)</code> export√©e par <code>Flash Video Extension.dll</code> .  Cela signifie qu'apr√®s le chargement de la DLL malveillante, lorsque le runtime appelle <code>WinMain</code> dans <code>TCPSVCS.exe</code> , le pointeur d'instruction pointera vers NOP, entra√Ænant l'appel √† <code>FLVCore::Uninitialize(void)</code> , l'√©tape suivante. <br><br>  La fonction cr√©e simplement un mutex commen√ßant par <code>{181C8480-A975-411C-AB0A-630DB8B0A221}</code> suivi du nom d'utilisateur actuel.  Elle lit ensuite le fichier vid√© avec l'extension * .db3, qui contient du code ind√©pendant de la position, et utilise <code>CreateThread</code> pour ex√©cuter le contenu. <br><br>  Le contenu du fichier * .db3 est le shellcode couramment utilis√© par le groupe OceanLotus.  Encore une fois, nous avons r√©ussi √† d√©compresser sa charge utile √† l'aide du script d'√©mulateur que nous avons publi√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur GitHub</a> . <br><br>  Le script r√©cup√®re l'√©tape finale.  Ce composant est une porte d√©rob√©e que nous avons d√©j√† analys√©e dans une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pr√©c√©dente √©tude OceanLotus</a> .  Cela peut √™tre d√©termin√© par le GUID <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}</code> fichier binaire.  La configuration du logiciel malveillant est toujours chiffr√©e dans la ressource PE.  Il a √† peu pr√®s la m√™me configuration, mais les serveurs C&amp;C sont diff√©rents des pr√©c√©dents: <br><br> <code>- andreagahuvrauvin[.]com <br> - byronorenstein[.]com <br> - stienollmache[.]xyz</code> <br> <br>  OceanLotus d√©montre √† nouveau une combinaison de diff√©rentes techniques pour √©viter la d√©tection.  Ils sont revenus avec un aper√ßu ¬´raffin√©¬ª du processus d'infection.  En choisissant des noms al√©atoires et en remplissant les fichiers ex√©cutables avec des donn√©es al√©atoires, ils r√©duisent le nombre d'IoC de confiance (en fonction des hachages et des noms de fichiers).  De plus, gr√¢ce √† l'utilisation du chargement de DLL tiers, les attaquants n'ont qu'√† supprimer le binaire <code>AcroTranscoder</code> l√©gitime. <br><br><h2>  Archives auto-extractibles </h2><br>  Apr√®s les fichiers RTF, le groupe est pass√© aux archives auto-extractibles (SFX) avec des ic√¥nes de document communes pour embrouiller davantage l'utilisateur.  Ceci a √©t√© √©crit par Threatbook ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien en chinois</a> ).  Apr√®s le d√©marrage, les fichiers RAR auto-extractibles sont vid√©s et les DLL avec l'extension .ocx sont ex√©cut√©es, dont la charge utile finale a √©t√© pr√©c√©demment document√©e <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> .  Depuis la mi-janvier 2019, OceanLotus a r√©utilis√© cette technique, mais au fil du temps, certaines configurations ont chang√©.  Dans cette section, nous parlerons de la technologie et des changements. <br><br><h4>  Cr√©ation d'app√¢ts </h4><br>  Le document <code>THICH-THONG-LAC-HANH-THAP-THIEN-VIET-NAM (1).EXE</code> (SHA-1: <code>AC10F5B1D5ECAB22B7B418D6E98FA18E32BBDEAB</code> ) a √©t√© trouv√© en 2018.  Ce fichier SFX a √©t√© cr√©√© √† bon escient - la description ( <i>Info version</i> ) indique qu'il s'agit d'une image JPEG.  Le script SFX est le suivant: <br><br><img src="https://habrastorage.org/webt/i7/tg/nz/i7tgnzif_wi8kcy7g3liki3la4e.png"><br>  <i>Figure 9. Commandes SFX</i> <br><br>  Le malware r√©initialise <code>{9ec60ada-a200-4159-b310-8071892ed0c3}.ocx</code> (SHA-1: <code>EFAC23B0E6395B1178BCF7086F72344B24C04DCC</code> ), ainsi que l'image <code>2018 thich thong lac.jpg.</code> <br><br>  L'image de l'app√¢t est la suivante: <br><br><img src="https://habrastorage.org/webt/x2/xh/sn/x2xhsnoscn9jdpm_phc4x5bms4q.jpeg"><br>  <i>Figure 10. L'image de l'app√¢t</i> <br><br>  Vous avez peut-√™tre remarqu√© que les deux premi√®res lignes du script SFX appellent le fichier OSX deux fois, mais ce n'est pas une erreur. <br><br><h4>  {9ec60ada-a200-4159-b310-8071892ed0c3} .ocx (ShLd.dll) </h4><br>  Le flux de contr√¥le de fichiers OSX est tr√®s similaire √† d'autres composants OceanLotus - il existe de nombreuses s√©quences de commandes <code>JZ/JNZ</code> et <code>PUSH/RET</code> alternant avec du code ind√©sirable. <br><br><img src="https://habrastorage.org/webt/hs/1j/yd/hs1jydni8wxcqylyvtvimc7_ckm.png"><br>  <i>Figure 11. Code obscurci</i> <br><br>  Apr√®s avoir filtr√© le code ind√©sirable, l'exportation <code>DllRegisterServer</code> appel√©e par <code>regsvr32.exe</code> ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/qh/r3/ws/qhr3ws_knbm_pewxrzsqhrpzggi.png"><br>  <i>Figure 12. Code d'installation de base</i> <br><br>  En fait, la premi√®re fois que <code>DllRegisterServer</code> appel√© <code>DllRegisterServer</code> exportation d√©finit la valeur de Registre <code>HKCU\SOFTWARE\Classes\CLSID\{E08A0F4B-1F65-4D4D-9A09-BD4625B9C5A1}\Model</code> pour l'offset chiffr√© dans la DLL ( <code>0x10001DE0</code> ). <br><br>  Lorsqu'une fonction est appel√©e une deuxi√®me fois, elle lit la m√™me valeur et s'ex√©cute √† cette adresse.  De l√†, une ressource est lue et ex√©cut√©e et de nombreuses actions en RAM. <br><br>  Le shellcode est le m√™me chargeur PE utilis√© dans les campagnes OceanLotus pr√©c√©dentes.  Il peut √™tre √©mul√© en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notre script</a> .  Par cons√©quent, il <code>db293b825dcc419ba7dc2c49fa2757ee.dll</code> , le charge en m√©moire et ex√©cute <code>DllEntry</code> . <br><br>  La DLL extrait le contenu de sa ressource, la d√©chiffre (AES-256-CBC) et la d√©compresse (LZMA).  La ressource a un format sp√©cifique facile √† d√©compiler. <br><br><img src="https://habrastorage.org/webt/ge/l4/ss/gel4ssv32blxwcjjlxkc57g0vie.png"><br>  <i>Figure 13. Structure de configuration de l'installateur (KaitaiStruct Visualizer)</i> <br><br>  La configuration est d√©finie explicitement - selon le niveau de privil√®ge, les donn√©es binaires seront √©crites dans <code>%appdata%\Intel\logs\BackgroundUploadTask.cpl</code> ou <code>%windir%\System32\BackgroundUploadTask.cpl</code> (ou <code>SysWOW64</code> pour les syst√®mes 64 bits). <br><br>  La persistance est alors assur√©e en cr√©ant une t√¢che nomm√©e <code>BackgroundUploadTask[junk].job</code> , o√π <code>[junk]</code> est un ensemble d'octets <code>0x9D</code> et <code>0xA0</code> . <br><br>  Le nom d'application de la t√¢che est <code>%windir%\System32\control.exe</code> et la valeur du param√®tre est le chemin d'acc√®s au fichier binaire non charg√©.  La t√¢che cach√©e s'ex√©cute tous les jours. <br><br>  Structurellement, le fichier CPL est une DLL avec le nom interne <code>ac8e06de0a6c4483af9837d96504127e.dll</code> , qui exporte la fonction <code>CPlApplet</code> .  Ce fichier d√©chiffre sa seule ressource <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> , puis charge cette DLL et appelle sa seule exportation <code>DllEntry</code> . <br><br><h4>  Fichier de configuration de porte d√©rob√©e </h4><br>  La configuration de la porte d√©rob√©e est chiffr√©e et int√©gr√©e dans ses ressources.  La structure du fichier de configuration est tr√®s similaire √† la pr√©c√©dente. <br><br><img src="https://habrastorage.org/webt/as/2f/c8/as2fc8ivbc6_bku2pjs5h-6_qtw.png"><br>  <i>Figure 14. Structure de configuration de la porte d√©rob√©e (KaitaiStruct Visualizer)</i> <br><br>  Malgr√© la structure similaire, les valeurs de nombreux champs ont √©t√© mises √† jour par rapport aux donn√©es fournies dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notre ancien rapport</a> . <br><br>  Le premier √©l√©ment du tableau binaire contient la DLL ( <code>HttpProv.dll</code> MD5: <code>2559738D1BD4A999126F900C7357B759</code> ) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">identifi√©e par Tencent</a> .  Mais puisque le nom d'exportation a √©t√© supprim√© du binaire, les hachages ne correspondent pas. <br><br><h3>  Recherches suppl√©mentaires </h3><br>  En collectant des √©chantillons, nous avons attir√© l'attention sur certaines caract√©ristiques.  L'√©chantillon qui vient d'√™tre d√©crit est apparu vers juillet 2018, et d'autres l'aiment tout r√©cemment, √† la mi-janvier - d√©but f√©vrier 2019.  Une archive SFX a √©t√© utilis√©e comme vecteur d'infection, d√©versant un document d'app√¢t l√©gitime et un fichier OSX malveillant. <br><br>  Bien qu'OceanLotus utilise de faux horodatages, nous avons remarqu√© que les horodatages des fichiers SFX et OCX sont toujours les m√™mes ( <code>0x57B0C36A</code> ( <code>0x57B0C36A</code> √† 19h15 UTC) et <code>0x498BE80F</code> (02/06/2009 √† <code>0x498BE80F</code> UTC). ) respectivement).  Cela indique probablement que les auteurs ont un certain ¬´constructeur¬ª qui utilise les m√™mes mod√®les et modifie simplement certaines caract√©ristiques. <br><br>  Parmi les documents que nous avons √©tudi√©s depuis d√©but 2018, il existe diff√©rents noms qui indiquent les pays d'int√©r√™t des agresseurs: <br><br>  <i>- Les nouvelles coordonn√©es des m√©dias cambodgiens (nouveau) .xls.exe</i> <i><br></i>  <i>- ÊùéÂª∫ È¶ô (‰∏™‰∫∫ ÁÆÄÂéÜ) .exe (faux document pdf d'un CV)</i> <i><br></i>  <i>- feedback, rallye aux USA du 28 au 29 juillet 2018.exe</i> <br><br>  Depuis la d√©couverte de la porte d√©rob√©e <code>{A96B020F-0000-466F-A96D-A91BBF8EAC96}.dll</code> et la publication de son analyse par plusieurs chercheurs, nous avons observ√© certains changements dans les donn√©es de configuration des logiciels malveillants. <br><br>  Tout d'abord, les auteurs ont commenc√© √† supprimer les noms des DLL DLL auxiliaires ( <code>DNSprov.dll</code> et deux versions de <code>HttpProv.dll</code> ).  Ensuite, les op√©rateurs ont arr√™t√© de <code>HttpProv.dll</code> la troisi√®me DLL (la deuxi√®me version de <code>HttpProv.dll</code> ), choisissant d'en incorporer une seule. <br><br>  Deuxi√®mement, de nombreux champs de configuration de porte d√©rob√©e ont √©t√© modifi√©s, probablement pour √©viter la d√©tection, car de nombreux IoC sont devenus disponibles.  Parmi les domaines importants modifi√©s par les auteurs figurent les suivants: <br><br><ul><li>  Cl√© de registre AppX modifi√©e (voir IoC) </li><li>  cha√Æne de codage mutex ("def", "abc", "ghi") </li><li>  num√©ro de port </li></ul><br>  Enfin, dans toutes les nouvelles versions analys√©es, les nouveaux C&amp;C sont r√©pertori√©s dans la section IoCs. <br><br><h2>  Conclusions </h2><br>  OceanLotus continue d'√©voluer.  Le cybergroupe se concentre sur le raffinement et l'expansion des outils et des leurres.  Les auteurs masquent des charges utiles malveillantes √† l'aide de documents accrocheurs pertinents pour les victimes pr√©sum√©es.  Ils d√©veloppent de nouvelles conceptions et utilisent √©galement des outils accessibles au public, tels que l'exploit Equation Editor.  De plus, ils perfectionnent les outils pour r√©duire le nombre d'artefacts restant sur les machines des victimes, r√©duisant ainsi les chances de d√©tection par un logiciel antivirus. <br><br><h2>  Indicateurs de compromis </h2><br>  Les indicateurs de compromis ainsi que les attributs MITRE ATT &amp; CK sont disponibles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur Welivesecurity</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr446604/">https://habr.com/ru/post/fr446604/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr446588/index.html">V√©rification du code source de Roslyn</a></li>
<li><a href="../fr446590/index.html">39 nouvelles fonctionnalit√©s disponibles dans Java 12</a></li>
<li><a href="../fr446592/index.html">V√©rification du code source de Roslyn</a></li>
<li><a href="../fr446598/index.html">Recr√©ation de polices CRT</a></li>
<li><a href="../fr446602/index.html">Transistor √† effet de champ √† courant continu maximal</a></li>
<li><a href="../fr446606/index.html">V√©rifiez √† quel point vous √™tes bon en technologie additive</a></li>
<li><a href="../fr446608/index.html">Surmonter la troisi√®me loi de la gravit√© organisationnelle</a></li>
<li><a href="../fr446612/index.html">Au moment o√π nous avons commenc√© √† croire en l'innovation</a></li>
<li><a href="../fr446614/index.html">Syst√®mes de fichiers virtuels Linux: pourquoi sont-ils n√©cessaires et comment fonctionnent-ils? Partie 1</a></li>
<li><a href="../fr446616/index.html">Comment nous avons fait du cloud FaaS √† l'int√©rieur de Kubernetes et gagn√© au Tinkoff Hackathon</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>