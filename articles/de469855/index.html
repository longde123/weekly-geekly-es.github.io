<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêè üßï üõ°Ô∏è Gradle + LLVM üå•Ô∏è üç¢ üôèüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser kurze Beitrag kann f√ºr diejenigen n√ºtzlich sein, die schnell mit LLVM arbeiten m√∂chten, ohne den Quellcode herunterladen und das Framework erst...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gradle + LLVM</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469855/">  Dieser kurze Beitrag kann f√ºr diejenigen n√ºtzlich sein, die schnell mit <b>LLVM</b> arbeiten m√∂chten, ohne den Quellcode herunterladen und das Framework erstellen zu m√ºssen.  Wer m√∂chte nicht in obskuren CMake-Skripten st√∂bern, um das erwartete Ergebnis zu erzielen, und schlie√ülich nur f√ºr die Faulen :) <br><br>  Ich werde Ihnen sagen, wie Sie es elegant machen, nur ein paar Zeilen im Gradle-Build-Skript. <br><a name="habracut"></a><br>  Angesichts der Notwendigkeit, Code unter LLVM zu schreiben, erkannte ich diesen ‚ÄûTreffer‚Äú.  :) "Hit" befindet sich bereits in der Konfigurationsphase des Builds f√ºr das Projekt.  Ich musste das Projekt sowohl unter Linux als auch unter Windows einheitlich erstellen.  Unn√∂tig zu erw√§hnen, dass ich jedes Mal zusammen mit dem Projekt nicht das gesamte LLVM erstellen wollte.  Zuerst habe ich mich auf vorgefertigte Versionen der Bibliothek von ihrer offiziellen Website verlassen, aber wie sich herausstellte, gibt es tats√§chlich nur Linux-Bin√§rdateien, die ohne RTTI und Ausnahmen erstellt wurden.  Unter Windows gibt es ein Installationsprogramm, aber trotz der Tatsache, dass es <i>LLVM-xxx-win64.exe</i> hei√üt, <i>klirrt es</i> nur im Inneren. <br><br>  Nun, im Anhang des Builds befindet sich ein CMake-System, in dem Sie zum Erstellen der Release-Version f√ºr Linux in der Konfigurationsphase Folgendes festlegen m√ºssen: <br><br><pre><code class="bash hljs">cmake -DCMAKE_BUILD_TYPE=Release</code> </pre> <br>  Unter Windows reicht dies aus irgendeinem Grund nicht aus, und Sie m√ºssen die Konfiguration im Befehl build selbst noch zus√§tzlich √§ndern: <br><br><pre> <code class="bash hljs">cmake --build . --config Release</code> </pre> <br>  Im Allgemeinen habe ich beschlossen, meine Augen auf <b>Gradle</b> zu <b>richten</b> und ein gutes Plugin zu schreiben, das sich die M√ºhe macht, einen Build f√ºr mich zu konfigurieren und mich vor einer unn√∂tigen Routine zu bewahren, wobei nur die notwendigsten und wichtigsten Dinge in Sicht bleiben. <br><br>  In der folgenden Diskussion geht es ausschlie√ülich um ihn: <b>cpp-llvm</b> . <br>  Hier ist die Mindestkonfiguration, die f√ºr die Integration in LLVM erforderlich ist: <br><br><pre> <code class="javascript hljs">plugins { id <span class="hljs-string"><span class="hljs-string">'org.bitbucket.akornilov.cpp-llvm'</span></span> version <span class="hljs-string"><span class="hljs-string">'0.1'</span></span> } llvm { version = <span class="hljs-string"><span class="hljs-string">'9.0.0'</span></span> <span class="hljs-comment"><span class="hljs-comment">// Required version. }</span></span></code> </pre><br>  Voraussetzungen f√ºr die Arbeit: <br><br><ul><li>  Installiertes Java (8 und h√∂her). </li><li>  Installiertes Gradle (Ich habe zum Zeitpunkt des Schreibens des Artikels die neueste Version 5.6.2 verwendet und das Plug-In bei √§lteren Versionen nicht getestet.) </li><li>  Gcc / CLang (Versionen, die mindestens C ++ 11 unterst√ºtzen) unter Linux. </li><li>  MSVC 2019 (z. B. Community Edition) unter Windows. </li><li>  Das Plugin sollte in Verbindung mit 'cpp-application' oder 'cpp-library' verwendet werden. </li><li>  Zugriff auf das Netzwerk zum Zeitpunkt der ersten Erstellung zum Herunterladen von LLVM-Bin√§rdateien (oder Offline-Modus, siehe unten). </li></ul><br>  Unterst√ºtzte Versionen von LLVM: <br><br><ul><li>  9.0.0 </li><li>  8.0.0 </li></ul><br>  Inoffizielle Builds f√ºr x86_64 unter Windows (msvc 2019) und Linux (Debian 10.0 + CLang 10.0).  Erstellt mit aktiviertem RTTI und Ausnahmen in zwei Versionen Release und Debug. <br><br><ul><li>  7.1.0 </li><li>  7.0.1 </li><li>  7.0.0 </li><li>  6.0.1 </li><li>  6.0.0 </li><li>  5.0.2 </li><li>  5.0.1 </li><li>  5.0.0 </li><li>  4.0.1 </li><li>  4.0.0 </li><li>  3.9.1 </li><li>  3.9.0 </li><li>  3.8.1 </li><li>  3.8.0 </li><li>  3.7.1 </li><li>  3.7.0 </li><li>  3.6.2 </li><li>  3.6.1 </li><li>  3.6.0 </li><li>  3.5.2 </li><li>  3.5.1 </li><li>  3.5.0 </li><li>  3.4.2 </li><li>  3.4.1 </li><li>  3.4 </li><li>  3.3 </li><li>  3.2 </li><li>  3.1 </li><li>  3.0 </li></ul><br>  Offizielle Builds von LLVM-Servern, nur x86_64 unter Linux mit deaktiviertem RTTI und Ausnahmen. <br><br>  Mit dem folgenden Befehl k√∂nnen Sie die Liste der unterst√ºtzten Versionen f√ºr die aktuelle Plattform anzeigen: <br><br><pre> <code class="bash hljs">gradle llvmVersions</code> </pre> <br><pre> <code class="plaintext hljs">&gt; Task :llvm-app:llvmVersions 9.0.0 8.0.0 BUILD SUCCESSFUL in 2s 1 actionable task: 1 executed</code> </pre><br>  Alle f√ºr den Build erforderlichen LLVM-Bin√§rdateien werden in den lokalen Cache (im gradle-Ordner im Benutzerverzeichnis) geladen und f√ºr andere Builds wiederverwendet. <br><br>  Die Vorbereitung f√ºr den Bau kann beim ersten Start eine betr√§chtliche Zeit in Anspruch nehmen, weil  Etwa 300 MB f√ºr die Debug-Version oder 30 MB f√ºr die Release-Version werden aus dem Netzwerk heruntergeladen (offizielle Versionen wiegen ebenfalls etwa 300 MB). <br><br>  Es wird nur eine statische Verkn√ºpfung verwendet.  Aus einem unbekannten Grund kann die Build-LLVM-Bindung keine dynamischen Bibliotheken unter MSVC erstellen. <br><br><h3>  Andere Plugin-Konfiguration </h3><br><h4>  Sie k√∂nnen eine bestimmte Adresse zum Herunterladen des Archivs mit Bin√§rdateien angeben (.tar.xz oder .tar.gz). </h4><br><pre> <code class="javascript hljs">llvm { version = <span class="hljs-string"><span class="hljs-string">'7.0.1'</span></span> serverUrl = <span class="hljs-string"><span class="hljs-string">'http://releases.llvm.org/7.0.1/clang%2bllvm-7.0.1-x86_64-linux-gnu-ubuntu-18.04.tar.xz'</span></span> }</code> </pre><br>  Die Hauptsache ist, dass die angegebene Version (version = xxx) mit der √ºbereinstimmt, die in dem zum Download ausgew√§hlten Archiv echt ist, andernfalls ist die Build-Konfiguration m√∂glicherweise falsch. <br><br><h4>  Sie k√∂nnen autonom mit vorgefertigten LLVM-Bin√§rdateien (heruntergeladen oder selbst erstellt) arbeiten </h4><br><pre> <code class="javascript hljs">llvm { version = <span class="hljs-string"><span class="hljs-string">'7.0.1'</span></span> localPath = <span class="hljs-string"><span class="hljs-string">'&lt;path to unpacked LLVM build&gt;'</span></span> }</code> </pre><br>  localPath sollte auf einen vorhandenen Ordner im lokalen Dateisystem verweisen, in dem das Plugin erwartet, dass die Unterverzeichnisse 'include' und 'lib' angezeigt werden, d. h.  Verzeichnisstruktur, die in offiziellen Builds verwendet wird.  Wenn Sie nach der Selbstoptimierung eine andere Ordnerstruktur haben, m√ºssen Sie diese ‚Äûk√§mmen‚Äú.  :) :) <br><br>  Die Versionen sollten auch, wie bereits im vorherigen Absatz erw√§hnt, √ºbereinstimmen. <br>  In diesem Fall wird nichts, was mit LLVM zu tun hat, aus dem Netzwerk geladen. <br><br><h4>  Arbeiten Sie mit einzelnen Komponenten: </h4><br><pre> <code class="javascript hljs">llvm { version = <span class="hljs-string"><span class="hljs-string">'9.0.0'</span></span> components = [<span class="hljs-string"><span class="hljs-string">'Engine'</span></span>, <span class="hljs-string"><span class="hljs-string">'OrcJIT'</span></span>] }</code> </pre><br>  Wenn Sie nur mit einem bestimmten Teil von LLVM arbeiten, m√ºssen Sie diesen Parameter unbedingt beachten.  Wenn Sie beispielsweise nur OrcJIT ben√∂tigen, warum sollten Sie dann alle einhundertf√ºnfundvierzig statischen Bibliotheken verkn√ºpfen?  Die Auswahl bestimmter Komponenten erleichtert die Lebensdauer des Linkers erheblich und Sie sparen Zeit. <br><br>  Eine Liste aller verf√ºgbaren Komponenten finden Sie folgenderma√üen: <br><br><pre> <code class="bash hljs">gradle llvmComponents</code> </pre> <br><h4>  Unter Linux k√∂nnen Sie die Verbindungszeit in der Debug-Version erheblich reduzieren, wenn Sie diese Option verwenden </h4><br><pre> <code class="javascript hljs">llvm { version = <span class="hljs-string"><span class="hljs-string">'9.0.0'</span></span> forceReleaseLinux = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre><br>  In diesem Fall wird die erzwungene Version von LLVM f√ºr die Debug-Version Ihres Builds verwendet.  In den meisten F√§llen w√ºrde ich die Verwendung empfehlen, es sei denn, Sie m√ºssen LLVM selbst debuggen.  Dieser Parameter wirkt sich nicht auf die Assembly unter Windows aus, da MSVC 2019 leider nicht das Mischen von Release- und Release-Bibliotheken in einem Build zul√§sst. <br><br>  Abschlie√üend w√ºrde ich nat√ºrlich empfehlen, dieses Plugin in Verbindung mit meinen anderen Plugins zu verwenden :), √ºber die in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesem Artikel</a> gelesen werden kann. <br><br>  <b>cpp-build-tuner</b> hilft dabei, die Kompilierungszeit und die Gr√∂√üe der resultierenden Bin√§rdatei zu optimieren. <br><br>  <b>Mit cpp-ide-generator</b> k√∂nnen Sie problemlos mehrere IDEs integrieren, in deren Konfiguration bereits Pfade zu LLVM-Headern vorhanden sind und die IDE diese korrekt indizieren kann. <br><br><img src="https://habrastorage.org/webt/kb/m8/he/kbm8he9ajb1xkt8wnieerb1wrv8.png"><br><br>  M√∂gliches Problem bei Verwendung von cpp-ide-generator: <br><br><pre> <code class="plaintext hljs">FAILURE: Build failed with an exception. * What went wrong: A problem occurred configuring project ':llvm-app'. &gt; Cannot change dependencies of configuration ':llvm-app:cppCompileDebug' after it has been resolved.</code> </pre><br>  Wenn Sie dies gesehen haben, bedeutet dies nur, dass cpp-ide-generator nach cpp-llvm hinzugef√ºgt werden sollte, wie hier: <br><br><pre> <code class="javascript hljs">plugins { id <span class="hljs-string"><span class="hljs-string">'cpp-application'</span></span> id <span class="hljs-string"><span class="hljs-string">'org.bitbucket.akornilov.cpp-build-tuner'</span></span> version <span class="hljs-string"><span class="hljs-string">'0.7'</span></span> id <span class="hljs-string"><span class="hljs-string">'org.bitbucket.akornilov.cpp-llvm'</span></span> version <span class="hljs-string"><span class="hljs-string">'0.1'</span></span> id <span class="hljs-string"><span class="hljs-string">'org.bitbucket.akornilov.cpp-ide-generator'</span></span> version <span class="hljs-string"><span class="hljs-string">'0.5'</span></span> }</code> </pre><br>  Ein vollst√§ndiges Beispiel f√ºr die Verwendung des Plugins finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br>  <b>UPD:</b> <br>  Neue Version des <b>cpp-llvm v0.3</b> Plugins <b>ver√∂ffentlicht</b> : <br><br><ol><li>  Die <code>llvmCleanCache</code> Task wurde <code>llvmCleanCache</code> , um alle LLVM-Downloads im lokalen Cache des Benutzers zu l√∂schen. </li><li>  Unterst√ºtzung f√ºr dynamische Verkn√ºpfung hinzugef√ºgt.  Derzeit werden nur Version <b>9.0.0 von</b> Windows / Linux, GCC / MinGW-W64 / CLang und MSVC unterst√ºtzt. </li></ol><br><pre> <code class="javascript hljs">llvm { version = <span class="hljs-string"><span class="hljs-string">'9.0.0'</span></span> linkage = Linkage.SHARED }</code> </pre><br><br>  <b>UPD</b> <br><br>  Im Zusammenhang mit der √Ñnderung der Hosting-Plugins wurde die Gruppe ge√§ndert: <br><pre> <code class="javascript hljs">plugins { id <span class="hljs-string"><span class="hljs-string">'loggersoft.cpp-llvm'</span></span> version <span class="hljs-string"><span class="hljs-string">'0.5'</span></span> }</code> </pre><br>  Neue Projektadresse: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gradle-cpp.sourceforge.io</a> <br>  Dokumentation: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sourceforge.net/p/gradle-cpp/wiki/cpp-llvm</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de469855/">https://habr.com/ru/post/de469855/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de469835/index.html">Sowjetische Zukunftstr√§ume, Teil 2. Jetzt mit Grab</a></li>
<li><a href="../de469837/index.html">Erstes Flutter-Treffen in St. Petersburg: Videoberichte</a></li>
<li><a href="../de469839/index.html">Sicherheitsanf√§lligkeit in Pikabu-Spam</a></li>
<li><a href="../de469843/index.html">"Wo sind diese jungen Punks, die uns vom Erdboden abwischen werden?"</a></li>
<li><a href="../de469849/index.html">Das Spiel ‚ÄûAttack 51%‚Äú: Schreiben eines einfachen eigenst√§ndigen Spiels auf der Obyte-Plattform</a></li>
<li><a href="../de469861/index.html">Datenstrukturen f√ºr Spielprogrammierer: Massendaten</a></li>
<li><a href="../de469867/index.html">Wie wird daraus ein Sch√ºler (und was haben Brettspiele damit zu tun)</a></li>
<li><a href="../de469871/index.html">Als Tastaturen Tische waren</a></li>
<li><a href="../de469875/index.html">So sch√ºtzen Sie Ihre Passw√∂rter im Jahr 2019</a></li>
<li><a href="../de469877/index.html">Oh diese Newtonsche Methode</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>