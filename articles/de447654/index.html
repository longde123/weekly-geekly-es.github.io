<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äç‚úàÔ∏è üë®‚Äçüë©‚Äçüë¶‚Äçüë¶ ‚ôíÔ∏è Himbeer-Pi-Tank und GPS-Navigation ü§öüèº üöÑ üßëüèΩ‚Äçü§ù‚Äçüßëüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nachdem ich mit k√ºnstlicher Intelligenz experimentiert hatte, beschloss der Autopilot meines Panzers , einen Schritt zur√ºckzutreten und das Navigieren...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Himbeer-Pi-Tank und GPS-Navigation</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447654/">  Nachdem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ich</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mit k√ºnstlicher Intelligenz experimentiert hatte, beschloss der</a> Autopilot <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">meines Panzers</a> , einen Schritt zur√ºckzutreten und das Navigieren in den guten alten Satelliten zu lernen. <br><a name="habracut"></a><br>  Das Bild ist inszeniert und weist darauf hin, dass sich jeder GPS-Transport unter der Kontrolle eines Navigators selbst erw√§rmen kann. <br><br><img src="https://habrastorage.org/webt/3p/xs/fa/3pxsfapls6oxdmua6yzyhqd-jco.jpeg"><br><br><h3>  Himbeer Pi + GPS </h3><br>  Zun√§chst wurde ein einfaches USB-GPS-Modul gekauft. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anhand</a> des Artikels √ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Adafrukt habe</a> ich mit der Implementierung begonnen. <br><br>  Trotz der Tatsache, dass der Artikel vor 6 Jahren geschrieben wurde, hat sich in der Welt der Navigation der alten Schule nicht viel ge√§ndert. <br><br>  Nur einige Nuancen stimmten nicht √ºberein: <br><br><ul><li>  Das St√ºck Eisen wurde als / dev / ttyACM0 anstelle von / dev / ttyUSB0 entdeckt </li><li>  Bei der Installation von gpsd habe ich das Ger√§t selbst nicht gefunden. Es stellte sich heraus, dass eine Registrierung in / etc / default / gpsd erforderlich ist: <br><pre><code class="bash hljs">DEVICES=<span class="hljs-string"><span class="hljs-string">"/dev/ACM0"</span></span></code> </pre> </li><li>  f√ºr python-3 gps muss das paket von hand geliefert werden, es geht nicht mit gpsd </li></ul><br>  Das Ger√§t selbst sieht aus wie ein normaler USB-Stick: <br><br><img src="https://habrastorage.org/webt/jh/36/q6/jh36q6vcz8xngv4guhajby-ngi8.jpeg"><br><br>  Und dann blieb ich lange stecken, weil mein GPS die Koordinaten nicht sah. <br><br>  Das Ger√§t funktionierte, meldete die Version, den Hersteller und andere n√ºtzliche Informationen, aber nichts weiter. <br><br>  Zuerst dachte ich, dass er immer noch defekt war.  Aus fr√ºheren Experimenten habe ich noch eine SD-Karte von Raspbian 2017, auf der GPS funktioniert hat. <br><br>  Von ihm gebootet und - siehe da - GPS wurde lebendig und blinzelte mit einer Gl√ºhbirne und duschte in den Protokollkoordinaten. <br>  Ich habe mir eine Woche lang den Kopf zerbrochen, alle Konfigurationen verglichen, angefangen, auf einem neuen Buggy-Raspbian zu s√ºndigen, und war gerade dabei, gpsd im Debug neu zu erstellen, als ich pl√∂tzlich im Raspberry-Forum in einem der Themen zu GPS-Problemen (und es gibt viele davon dort) auf Ratschl√§ge stie√ü, zu denen ich das Ger√§t bringen sollte die Stra√üe bei klarem Wetter und lassen Sie es Satelliten finden, die bis zu einer halben Stunde dauern kann. <br><br>  Diese Idee kam mir in den Sinn, aber anscheinend war das Wetter nicht klar genug, aber dann stimmte alles √ºberein und das Ger√§t wurde lebendig.  Wenn Sie etwas tiefer graben, stellt sich heraus, dass die erforderlichen Informationen zu den Satelliten in der Firmware des Ger√§ts zwischengespeichert sind und nicht von Raspbian gesteuert werden k√∂nnen. <br><blockquote><h4>  Wie kann meine Anwendung Almanach- / Ephemeriden- / Pseudobereichsdaten abrufen? </h4><br>  Leider gibt es noch keine einfache M√∂glichkeit, diese Dinge √ºber GPSD zu erledigen.  Der Grund daf√ºr ist, dass es keine einheitliche M√∂glichkeit gibt, GPS-Empf√§nger dazu zu bringen, diese Informationen zu melden. <br><br>  Viele versenden es √ºberhaupt nicht.  Andere (einschlie√ülich einiger, aber nicht aller Ger√§te, die SiRF-Bin√§rpakete versenden) versenden es gelegentlich in SUBFRAME-Informationen, aber Sie m√ºssen genau wissen, wie Sie die SUBFRAME-Felder durchsuchen, um es zu erhalten, und die Dokumentation derjenigen in IS-GPS-200E (the over) -das Luftprotokoll, das von GPS-Satelliten verwendet wird) ist √§u√üerst dunkel.  Wieder andere Berichte variieren <cut></cut>  Teilmengen von Almanach- / Ephemeriden- / Pseudoentfernungsdaten auf relativ einfache Weise, jedoch in herstellerspezifischen S√§tzen, die f√ºr einzelne Empf√§ngertypen √§u√üerst spezifisch sind, schlecht dokumentiert oder nicht dokumentiert sind und h√§ufig durch gleicherma√üen spezifische und noch schlechtere Kontrollsequenzen aktiviert werden m√ºssen dokumentiert. </blockquote>  Der knifflige Mechanismus hat funktioniert und es ist Zeit, ihn auszunutzen. <br>  Das Skript zum Lesen von Daten aus gpsd in Python ist sehr einfach: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> gps gs = gps.gps(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>, <span class="hljs-string"><span class="hljs-string">"2947"</span></span>) gs.stream(gps.WATCH_ENABLE | gps.WATCH_NEWSTYLE) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>): report = gs.next() <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (report)</code> </pre><br><h3>  Google Maps API </h3><br>  Ich steuere den Tank vom Telefon aus, also musste ich lernen, mit Google Maps zu arbeiten. <br>  Google hat gute Arbeit geleistet, um die Arbeit mit Karten zu vereinfachen, sodass es keine Probleme gab. <br>  Android Studio kann ein leeres Projekt mit einer Karte erstellen, von der aus alle wichtigen Details sorgf√§ltig auf das Hauptprojekt √ºbertragen werden m√ºssen. <br><br>  Google ben√∂tigt eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schl√ºsselregistrierung</a> , um mit der Maps-API arbeiten zu k√∂nnen. Diese Registrierung ist (vorerst) kostenlos. <br><br>  Ich habe die REST-Oberfl√§che des Panzers so erweitert, dass er seine Koordinaten angibt, die Koordinaten auf die Karte √ºbertr√§gt, ein Panzersymbol zeichnet und alles recht anst√§ndig aussieht. <br><br>  Als n√§chstes m√ºssen Sie den Weg ebnen. <br><br>  Ein Punkt auf der Karte w√§hlt das Ziel aus und f√ºttert es in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wegbeschreibungs-API</a> . <br><br>  Directions ist ein Webdienst, der die Koordinaten von zwei Punkten verwendet und als Antwort eine Reihe von Informationen √ºber die zur√ºckgelegte Route ausgibt, einschlie√ülich Adressen, bemerkenswerter Namen und Erkl√§rungen.  Aber ich brauchte nur eine Abfolge von Schritten.  Wir w√§hlen die Koordinaten aus und zeichnen sie auf die Karte. <br><br>  Jetzt gibt es alles Notwendige f√ºr die visuelle Kontrolle und Verwaltung. <br><br><img src="https://habrastorage.org/webt/mh/ju/ur/mhjuurhjsg8aulcljli6orbr6_y.png"><br><br><h3>  GPS-Navigation </h3><br>  Weiter vom Telefon zum Tank wird der erste Punkt der Route √ºbertragen. <br><br>  Der Tank hat ein kleines Problem - zu Beginn kennt er seine Richtung nicht. <br>  Das Problem l√§sst sich leicht mit dem Kompass l√∂sen, aber jeder kann mit dem Kompass umgehen ... <br><br>  Es war m√∂glich, durch die Tatsache herauszukommen, dass der Panzer in den ersten Sekunden einfach vorausf√§hrt, die Koordinaten des Beginns und des Endes des Pfades empf√§ngt und daraus seine Richtung berechnet.  Es ist erw√§hnenswert, dass die gleichen Daten direkt vom GPS abgerufen werden k√∂nnen. Es gibt ein Trackfeld, das die Abweichung vom Winkel zum Nordpol anzeigt. <br><br>  In jedem Fall ist jedoch Bewegung erforderlich, damit sich das sp√§ter f√ºllt. <br><br>  Richtungsberechnung: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">azimuth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pos1, pos2)</span></span></span><span class="hljs-function">:</span></span> lat1 = toRadians(pos1[<span class="hljs-string"><span class="hljs-string">"lat"</span></span>]) lon1 = toRadians(pos1[<span class="hljs-string"><span class="hljs-string">"lon"</span></span>]) lat2 = toRadians(pos2[<span class="hljs-string"><span class="hljs-string">"lat"</span></span>]) lon2 = toRadians(pos2[<span class="hljs-string"><span class="hljs-string">"lon"</span></span>]) dlat = lat2 - lat1 dlon = lon2 - lon1 x = math.sin(dlon) * math.cos(lat2) y = math.cos(lat1) * math.sin(lat2) - math.sin(lat1) * math.cos(lat2) * math.cos(dlon) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> math.atan2(x, y)</code> </pre><br>  Ich stelle fest, dass GPS nicht immer genau funktioniert, und es kann sich herausstellen, dass die Koordinaten des Beginns und des Endes des Testpfads fehlerhaft sind und Messungen bedeutungslos machen (selbst in dem Ma√üe, in dem beim Vorw√§rtsbewegen die Koordinate des Endes des Pfads zur√ºckliegt). <br><br>  In diesem Fall gibt das GPS die Richtung durch die Spur ziemlich zuverl√§ssig an, daher wurde dieses Feld standardm√§√üig verwendet, und wenn es nicht vorhanden war, musste ich anhand der Koordinatendifferenz navigieren. <br><br>  Nachdem sich der Panzer am Gel√§nde orientiert hat, dreht er sich ungef√§hr bei Bedarf (ungef√§hr - weil es schwierig ist, die Richtung ohne Kompass oder Gyroskop genau zu bestimmen) und bewegt sich einige Sekunden lang.  Dann erh√§lt er wieder die Koordinaten, pr√ºft die Richtung, dreht sich um, f√§hrt.  Und so weiter, bis sich das Ziel innerhalb des Fehlerradius befindet. <br><br>  Im Allgemeinen ist das gr√∂√üte Problem der Fehler in den GPS-Koordinaten, wodurch der Tank die Richtung verliert und in verschiedene Richtungen zu rasen beginnt. <br><br>  Alles h√§ngt damit zusammen, dass man ohne Kompass nicht √ºberleben kann. <br><br><h3>  Referenzen </h3><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einf√ºhrungsartikel zum Einrichten eines GPS-Moduls f√ºr den Raspberry Pi</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dienst f√ºr die Arbeit mit GPS unter Linux</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">N√ºtzliche Stelle mit Formeln zur Berechnung der Entfernung und Richtung anhand der Koordinaten zweier Punkte</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quellcode der GPS-Tank-Firmware</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google Maps-Dokumentation f√ºr Android</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de447654/">https://habr.com/ru/post/de447654/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de447636/index.html">So werden Sie Designer Ihres Lebens: Tipps von Bill Burnett, Stanford Design Program Manager und Apple Veteran</a></li>
<li><a href="../de447638/index.html">Audiophiles Smartphone: Auswahlkriterien und einige typische Klassenvertreter</a></li>
<li><a href="../de447640/index.html">Cloud Firestore + Android ist nur</a></li>
<li><a href="../de447650/index.html">So trennen Sie Frontend und Backend unter Wahrung des gegenseitigen Verst√§ndnisses</a></li>
<li><a href="../de447652/index.html">Wochenenddesign: Einfacher MIDI-Adapter</a></li>
<li><a href="../de447656/index.html">Variabilit√§t der Evolution: Lebendgeburt und Eiablage gleichzeitig bei Eidechsen der Art Saiphos equalis</a></li>
<li><a href="../de447658/index.html">Action-Programmierspiele - Unterhaltung oder eine M√∂glichkeit, Kindern Algorithmen und Robotik n√§her zu bringen</a></li>
<li><a href="../de447660/index.html">Was Sie vom neuen Xeon E erwarten k√∂nnen Vergleichen Sie mit E3 und ziehen Sie Schlussfolgerungen</a></li>
<li><a href="../de447662/index.html">Grand Express: der erste private Zug in Russland</a></li>
<li><a href="../de447664/index.html">Querschnittlicher Vertrieb von Business Analytics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>