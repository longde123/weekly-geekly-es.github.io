<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∏üèΩ üßö üèÑ Comment nous avons collect√© des donn√©es sur les campagnes publicitaires des plateformes en ligne (le chemin √©pineux vers le produit) ü§Ω üí™üèª üî∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il semble que le domaine de la publicit√© en ligne devrait √™tre aussi technologique et automatis√© que possible. En effet, des g√©ants et des experts dan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons collect√© des donn√©es sur les campagnes publicitaires des plateformes en ligne (le chemin √©pineux vers le produit)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dentsuaegisnetworkrussia/blog/469625/">  Il semble que le domaine de la publicit√© en ligne devrait √™tre aussi technologique et automatis√© que possible.  En effet, des g√©ants et des experts dans leur domaine comme Yandex, Mail.Ru, Google et Facebook y travaillent.  Mais, il s'est av√©r√© qu'il n'y a pas de limite √† la perfection et qu'il y a toujours quelque chose √† automatiser. <br><br><img src="https://habrastorage.org/webt/gg/cq/j3/ggcqj3ws0e1dpcxixrkjdez28ry.png" alt="image"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><i>Source</i></a> <br><br>  Le groupe de communication <b>Dentsu Aegis Network Russia</b> est le plus grand acteur du march√© de la publicit√© num√©rique et investit activement dans la technologie, en essayant d'optimiser et d'automatiser ses processus commerciaux.  L'un des probl√®mes non r√©solus du march√© de la publicit√© en ligne √©tait la t√¢che de collecter des statistiques sur les campagnes publicitaires de diff√©rents sites en ligne.  La solution √† ce probl√®me a finalement abouti √† la cr√©ation du produit <b>D1.Digital</b> (lu comme DiVan), dont nous voulons parler de d√©veloppement. <br><a name="habracut"></a><br><h3>  Pourquoi? </h3><br>  1. Au moment du d√©marrage du projet, il n'y avait pas un seul produit fini sur le march√© qui ait r√©solu la t√¢che d'automatiser la collecte de statistiques sur les campagnes publicitaires.  <i>Cela signifie que personne d'autre que nous ne fermera nos besoins.</i> <br><br>  Des services tels que Improvado, Roistat, Supermetrics, SegmentStream, offrent une int√©gration avec des sites, des r√©seaux sociaux et Google Analitycs, et offrent √©galement la possibilit√© de cr√©er des tableaux de bord analytiques pour une analyse et un contr√¥le pratiques des campagnes publicitaires.  Avant de commencer √† d√©velopper notre produit, nous avons essay√© d'utiliser certains de ces syst√®mes dans notre travail pour collecter des donn√©es √† partir de sites, mais, malheureusement, ils n'ont pas pu r√©soudre nos probl√®mes. <br><br>  Le principal probl√®me √©tait que les produits test√©s √©taient repouss√©s des sources de donn√©es, affichant des statistiques de placements dans les sections par sites, et ne permettaient pas l'agr√©gation de statistiques sur les campagnes publicitaires.  Cette approche n'a pas permis de voir les statistiques de diff√©rents sites en un seul endroit et d'analyser l'√©tat de la campagne dans son ensemble. <br><br>  Un autre facteur √©tait qu'au d√©but, les produits √©taient orient√©s vers le march√© occidental et ne soutenaient pas l'int√©gration avec des sites russes.  Et pour les sites avec lesquels l'int√©gration a √©t√© mise en ≈ìuvre, toutes les m√©triques n√©cessaires avec suffisamment de d√©tails n'√©taient pas toujours t√©l√©charg√©es, et l'int√©gration n'√©tait pas toujours pratique et transparente, surtout lorsqu'il √©tait n√©cessaire d'obtenir quelque chose qui n'√©tait pas dans l'interface syst√®me. <br>  En g√©n√©ral, nous avons d√©cid√© de ne pas nous adapter aux produits tiers, mais nous avons commenc√© √† d√©velopper le n√¥tre ... <br><br>  2. Le march√© de la publicit√© en ligne cro√Æt d'ann√©e en ann√©e et, en 2018, il a traditionnellement d√©pass√© le plus grand march√© de la publicit√© t√©l√©vis√©e en termes de budgets publicitaires.  <i>Il y a donc une √©chelle</i> . <br><br>  3. Contrairement au march√© de la publicit√© t√©l√©vis√©e, o√π la vente de publicit√© commerciale est monopolis√©e, la masse des propri√©taires individuels de mat√©riel publicitaire de diff√©rentes tailles avec leurs r√©gies publicitaires travaille sur Internet.  √âtant donn√© que la campagne publicitaire, en r√®gle g√©n√©rale, s'ex√©cute sur plusieurs sites √† la fois, afin de comprendre l'√©tat de la campagne publicitaire, il est n√©cessaire de collecter les rapports de tous les sites et de les regrouper en un seul grand rapport qui montrera l'image enti√®re.  <i>Il y a donc un potentiel d'optimisation.</i> <br><br>  4. Il nous a sembl√© que les propri√©taires de l'inventaire publicitaire sur Internet disposaient d√©j√† d'une infrastructure pour collecter des statistiques et les afficher dans les r√©gies publicitaires, et ils pouvaient fournir une API pour ces donn√©es.  <i>Il y a donc une faisabilit√© technique.</i>  Nous dirons tout de suite que ce n'√©tait pas si simple. <br><br>  En g√©n√©ral, toutes les conditions pr√©alables √† la mise en ≈ìuvre du projet √©taient √©videntes pour nous, et nous avons couru pour mettre en ≈ìuvre le projet ... <br><br><h3>  Grand plan </h3><br>  Tout d'abord, nous avons form√© une vision d'un syst√®me id√©al: <br><br><ul><li>  Il devrait charger automatiquement les campagnes publicitaires du syst√®me d'entreprise 1C avec leurs noms, p√©riodes, budgets et emplacements sur diverses plates-formes. </li><li>  Pour chaque emplacement dans la campagne publicitaire, toutes les statistiques possibles des sites sur lesquels l'emplacement est en cours doivent √™tre t√©l√©charg√©es automatiquement, telles que le nombre d'impressions, de clics, de vues, etc. </li><li>  Certaines campagnes publicitaires sont surveill√©es par un contr√¥le tiers par les syst√®mes dits de publicit√©, tels que Adriver, Weborama, DCM, etc.  Il existe √©galement un compteur Internet industriel en Russie - Mediascope.  Selon notre id√©e, les donn√©es de surveillance ind√©pendante et industrielle devraient √©galement √™tre automatiquement t√©l√©charg√©es dans les campagnes publicitaires correspondantes. </li><li>  La plupart des campagnes publicitaires sur Internet visent certaines actions cibl√©es (achat, appel, enregistrement pour un essai routier, etc.), qui sont suivies √† l'aide de Google Analytics, et des statistiques sur lesquelles sont √©galement importantes pour comprendre l'√©tat de la campagne et doivent √™tre t√©l√©charg√©es sur notre outil . </li></ul><br><h3>  La premi√®re cr√™pe est grumeleuse </h3><br>  Compte tenu de notre engagement envers des principes flexibles de d√©veloppement de logiciels (agile, tout), nous avons d√©cid√© de d√©velopper MVP d'abord, puis de progresser vers l'objectif pr√©vu de mani√®re it√©rative. <br>  Nous avons d√©cid√© de construire MVP sur la base de notre produit <b>DANBo (Dentsu Aegis Network Board)</b> , qui est une application web avec des informations g√©n√©rales sur les campagnes publicitaires de nos clients. <br><br>  Pour MVP, le projet a √©t√© simplifi√© au maximum en termes de mise en ≈ìuvre.  Nous avons s√©lectionn√© une liste limit√©e de sites √† int√©grer.  Ce sont les principales plates-formes, telles que Yandex.Direct, Yandex.Display, RB.Mail, MyTarget, Adwords, DBM, VK, FB et les principaux syst√®mes de publicit√© Adriver et Weborama. <br><br>  Pour acc√©der aux statistiques sur les sites via l'API, nous avons utilis√© un seul compte.  Le responsable du groupe client, qui souhaitait utiliser la collecte automatique de statistiques sur la campagne publicitaire, a d'abord d√ª d√©l√©guer l'acc√®s au compte de la plateforme aux campagnes publicitaires n√©cessaires sur les sites. <br><br>  De plus, l'utilisateur du syst√®me <b>DANBo</b> devait t√©l√©charger un fichier d'un certain format dans le syst√®me Excel, dans lequel toutes les informations sur le placement (campagne publicitaire, site, format, p√©riode de placement, indicateurs pr√©vus, budget, etc.) et les identifiants des campagnes publicitaires correspondantes sur les sites √©taient √©crits et les compteurs dans les syst√®mes de publicit√©. <br><br>  C'√©tait franchement terrifiant: <br><br><img src="https://habrastorage.org/webt/ie/kc/sd/iekcsdiz6k8fltryf2ydfgi-f14.png" alt="image"><br><br>  Les donn√©es t√©l√©charg√©es ont √©t√© stock√©es dans la base de donn√©es, puis les services individuels ont collect√© des identifiants de campagne aupr√®s des sites et t√©l√©charg√© des statistiques √† leur sujet. <br><br>  Un service Windows distinct a √©t√© √©crit pour chaque site, qui une fois par jour passait sous un compte de service dans l'API du site et t√©l√©chargeait des statistiques sur les identifiants de campagne sp√©cifi√©s.  La m√™me chose s'est produite avec les syst√®mes de publicit√©. <br><br>  Les donn√©es t√©l√©charg√©es ont √©t√© affich√©es sur l'interface sous la forme d'un petit tableau de bord auto-√©crit: <br><br><img src="https://habrastorage.org/webt/8n/xy/bl/8nxyblj7gcdigcrczqpryslhoue.png" alt="image"><br><br>  De fa√ßon inattendue pour nous, MVP a gagn√© et commenc√© √† t√©l√©charger des statistiques actuelles sur les campagnes publicitaires sur Internet.  Nous avons impl√©ment√© le syst√®me sur plusieurs clients, mais lorsque nous avons essay√© de nous adapter, nous avons rencontr√© de s√©rieux probl√®mes: <br><br><ul><li>  Le principal probl√®me √©tait la difficult√© de pr√©parer les donn√©es √† charger dans le syst√®me.  De plus, les donn√©es de placement devaient √™tre r√©duites √† un format strictement fixe avant le t√©l√©chargement.  Dans le fichier √† charger, il √©tait n√©cessaire d'enregistrer les identifiants des entit√©s de diff√©rents sites.  Nous sommes confront√©s au fait qu'il est tr√®s difficile pour des utilisateurs techniquement inexp√©riment√©s d'expliquer o√π trouver ces identifiants sur le site et o√π les mettre dans le fichier.  Compte tenu du nombre d'employ√©s dans les divisions menant des campagnes sur les sites, et du chiffre d'affaires, cela s'est traduit par un √©norme soutien de notre c√¥t√©, ce qui ne nous convenait absolument pas. </li><li>  Un autre probl√®me √©tait que toutes les plateformes publicitaires ne disposaient pas de m√©canismes pour d√©l√©guer l'acc√®s √† des campagnes publicitaires √† d'autres comptes.  Mais m√™me si le m√©canisme de d√©l√©gation √©tait disponible, tous les annonceurs n'√©taient pas dispos√©s √† fournir un acc√®s √† un compte tiers √† leurs campagnes. </li><li>  Un facteur important a √©t√© l'indignation qui a amen√© les utilisateurs √† ce que tous les indicateurs planifi√©s et les d√©tails de placement qu'ils contribuent d√©j√† √† notre syst√®me comptable 1C soient √† nouveau saisis dans <b>DANBo</b> . </li></ul><br>  Cela nous a donn√© l'id√©e que la principale source d'informations sur l'emplacement devrait √™tre notre syst√®me 1C, dans lequel toutes les donn√©es sont saisies avec pr√©cision et √† temps (le fait est que sur la base des donn√©es 1C, des comptes sont form√©s, par cons√©quent, la saisie correcte des donn√©es dans 1C est pour tout le monde dans KPI).  Un nouveau concept de syst√®me est donc apparu ... <br><br><h3>  Concept </h3><br>  La premi√®re chose que nous avons d√©cid√© de faire √©tait de s√©parer le syst√®me de collecte de statistiques sur les campagnes publicitaires sur Internet en un produit distinct - <b>D1.Digital</b> . <br><br>  Dans le nouveau concept, nous avons d√©cid√© de charger des informations sur les campagnes publicitaires et les emplacements qu'elles <b>contiennent</b> de 1C √† <b>D1.Digital</b> , puis de tirer des statistiques des sites et des syst√®mes AdServing vers ces emplacements.  Cela √©tait cens√© simplifier consid√©rablement la vie des utilisateurs (et, comme d'habitude, ajouter du travail aux d√©veloppeurs) et r√©duire la quantit√© de support. <br><br>  Le premier probl√®me que nous avons rencontr√© √©tait de nature organisationnelle et √©tait li√© au fait que nous ne pouvions pas trouver une cl√© ou un attribut permettant de comparer des entit√©s de diff√©rents syst√®mes avec des campagnes et des placements de 1C.  Le fait est que le processus dans notre entreprise est organis√© de mani√®re √† ce que les campagnes publicitaires soient introduites dans diff√©rents syst√®mes par diff√©rentes personnes (lecteurs multim√©dias, achats, etc.). <br><br>  Pour r√©soudre ce probl√®me, nous avons d√ª inventer une cl√© de hachage unique, DANBoID, qui relierait les entit√©s de diff√©rents syst√®mes et qui pourrait √™tre identifi√©e assez facilement et sans ambigu√Øt√© dans les ensembles de donn√©es charg√©s.  Cet identifiant est g√©n√©r√© dans le syst√®me interne 1C pour chaque emplacement individuel et se jette dans les campagnes, les emplacements et les compteurs sur tous les sites et dans tous les syst√®mes AdServing.  La mise en ≈ìuvre de la pratique d'apposition de DANBoID sur tous les emplacements a pris du temps, mais nous l'avons fait :) <br><br>  Ensuite, nous avons d√©couvert que tous les sites ne disposent pas d'une API pour la collecte automatique de statistiques, et m√™me ceux qui ont une API ne renvoient pas toutes les donn√©es n√©cessaires. <br><br>  A ce stade, nous avons d√©cid√© de r√©duire consid√©rablement la liste des sites √† int√©grer et de nous concentrer sur les principaux sites impliqu√©s dans la grande majorit√© des campagnes publicitaires.  Cette liste comprend tous les plus grands acteurs du march√© publicitaire (Google, Yandex, Mail.ru), les r√©seaux sociaux (VK, Facebook, Twitter), les principaux syst√®mes de publicit√© et d'analyse (DCM, Adriver, Weborama, Google Analytics) et d'autres plateformes. <br><br>  La plupart des sites que nous avons s√©lectionn√©s disposaient d'une API qui nous fournissait les mesures n√©cessaires.  Dans les cas o√π l'API n'√©tait pas l√† ou ne disposait pas des donn√©es n√©cessaires, nous avons utilis√© des rapports qui arrivaient quotidiennement sur le courrier professionnel pour t√©l√©charger les donn√©es (dans certains syst√®mes, il est possible de configurer de tels rapports, dans d'autres, ils se sont mis d'accord sur le d√©veloppement de ces rapports pour nous). <br><br>  Lors de l'analyse des donn√©es de diff√©rents sites, nous avons constat√© que la hi√©rarchie des entit√©s n'est pas la m√™me dans les diff√©rents syst√®mes.  De plus, les informations provenant de diff√©rents syst√®mes doivent √™tre charg√©es de mani√®re diff√©rente. <br><br>  Pour r√©soudre ce probl√®me, le concept SubDANBoID a √©t√© d√©velopp√©.  L'id√©e de SubDANBoID est assez simple, nous marquons l'essence principale de la campagne sur le site avec le DANBoID g√©n√©r√©, et nous t√©l√©chargeons toutes les entit√©s imbriqu√©es avec des identifiants uniques du site et formons le SubDANBoID selon le principe DANBoID + identifiant de l'entit√© imbriqu√©e de premier niveau + identifiant de l'entit√© imbriqu√©e de deuxi√®me niveau + ... Cette approche nous a permis de nous associer campagnes publicitaires dans diff√©rents syst√®mes et t√©l√©charger des statistiques d√©taill√©es √† leur sujet. <br><br>  Nous avons √©galement d√ª r√©soudre le probl√®me d'acc√®s aux campagnes sur diff√©rents sites.  Comme nous l'avons √©crit ci-dessus, le m√©canisme de d√©l√©gation de l'acc√®s √† la campagne √† un compte technique distinct n'est pas toujours applicable.  Par cons√©quent, nous avons d√ª d√©velopper une infrastructure d'autorisation automatique via OAuth √† l'aide de jetons et de m√©canismes de mise √† jour pour ces jetons. <br><br>  Plus loin dans l'article, nous tenterons de d√©crire plus en d√©tail l'architecture de la solution et les d√©tails techniques de l'impl√©mentation. <br><br><h3>  Architecture de solution 1.0 </h3><br>  D√®s la mise en place d'un nouveau produit, nous avons compris qu'il fallait imm√©diatement pr√©voir la possibilit√© de connecter de nouveaux sites, nous avons donc d√©cid√© de suivre la voie de l'architecture de microservices. <br><br>  Lors de la conception de l'architecture, nous avons choisi des connecteurs de services distincts pour tous les syst√®mes externes - 1C, plates-formes publicitaires et syst√®mes de publicit√©. <br>  L'id√©e principale est que tous les connecteurs des sites ont la m√™me API et sont des adaptateurs qui am√®nent les API du site √† notre interface pratique. <br><br>  Au centre de notre produit se trouve une application Web, qui est un monolithe, qui est con√ßue pour pouvoir √™tre facilement d√©mont√©e en services.  Cette application est charg√©e de traiter les donn√©es t√©l√©charg√©es, de comparer les statistiques de diff√©rents syst√®mes et de les pr√©senter aux utilisateurs du syst√®me. <br><br>  Pour communiquer les connecteurs avec une application Web, nous avons d√ª cr√©er un service suppl√©mentaire, que nous avons appel√© Connector Proxy.  Il remplit les fonctions de d√©couverte de service et de planificateur de t√¢ches.  Ce service ex√©cute des t√¢ches de collecte de donn√©es pour chaque connecteur chaque nuit.  Il √©tait plus facile d'√©crire une couche de service que de connecter un courtier de messages, et pour nous, il √©tait important d'obtenir le r√©sultat le plus rapidement possible. <br><br>  Pour des raisons de simplicit√© et de rapidit√© de d√©veloppement, nous avons √©galement d√©cid√© que tous les services seraient une API Web.  Cela a permis de monter rapidement une preuve de concept et de v√©rifier que la conception enti√®re fonctionnait. <br><br><img src="https://habrastorage.org/webt/eb/_s/ui/eb_suixgwtg5u5e35t01dzqhuqw.png" alt="image"><br><br>  Une t√¢che distincte, plut√¥t difficile, consistait √† configurer l'acc√®s pour collecter les donn√©es de diff√©rentes armoires, qui, comme nous l'avons d√©cid√©, devraient √™tre effectu√©es par les utilisateurs via une interface Web.  Il se compose de deux √©tapes distinctes: d'abord, l'utilisateur via OAuth ajoute un jeton pour acc√©der au compte, puis configure la collecte de donn√©es pour le client √† partir d'un compte sp√©cifique.  L'obtention d'un token via OAuth est n√©cessaire, car, comme nous l'avons d√©j√† √©crit, il n'est pas toujours possible de d√©l√©guer l'acc√®s au cabinet souhait√© sur le site. <br><br>  Pour cr√©er un m√©canisme universel pour choisir une armoire √† partir de sites, nous avons d√ª ajouter une m√©thode √† l'API de connecteurs qui rend le sch√©ma JSON, qui est rendu dans le formulaire √† l'aide d'un composant JSONEditor modifi√©.  Les utilisateurs ont donc pu choisir les comptes √† partir desquels t√©l√©charger les donn√©es. <br><br>  Pour respecter les limites de demande qui existent sur les sites, nous combinons la demande de param√®tres dans le m√™me jeton, mais nous pouvons traiter diff√©rents jetons en parall√®le. <br><br>  Nous avons choisi MongoDB comme r√©f√©rentiel de donn√©es t√©l√©chargeables pour une application Web et des connecteurs, ce qui nous a permis de ne pas trop nous soucier de la structure des donn√©es dans les premiers stades de d√©veloppement, lorsque le mod√®le d'application change apr√®s une journ√©e. <br><br>  Bient√¥t, nous avons d√©couvert que toutes les donn√©es ne s'int√®grent pas bien dans MongoDB et, par exemple, les statistiques quotidiennes sont plus pratiques √† stocker dans une base de donn√©es relationnelle.  Par cons√©quent, pour les connecteurs dont la structure de donn√©es est plus adapt√©e √† une base de donn√©es relationnelle, nous avons commenc√© √† utiliser PostgreSQL ou MS SQL Server comme stockage. <br><br>  L'architecture et la technologie s√©lectionn√©es nous ont permis de construire et de lancer relativement rapidement le produit D1.Digital.  Au cours des deux ann√©es de d√©veloppement de produits, nous avons d√©velopp√© 23 connecteurs de sites, acquis une exp√©rience inestimable de travail avec des API tierces, appris √† contourner les √©cueils de diff√©rents sites qui avaient chacun leurs propres, contribu√© au d√©veloppement de l'API sur au moins 3 sites, t√©l√©charg√© automatiquement des informations sur pr√®s de 15000 campagnes et dans plus de 80 000 emplacements, nous avons recueilli de nombreux commentaires des utilisateurs sur le produit et avons r√©ussi √† modifier le processus principal du produit plusieurs fois, sur la base de ces commentaires. <br><br><h3>  Architecture de la solution 2.0 </h3><br>  Deux ans se sont √©coul√©s depuis le d√©but du d√©veloppement de <b>D1.Digital</b> .  L'augmentation constante de la charge sur le syst√®me et l'√©mergence de nouvelles sources de donn√©es ont r√©v√©l√© progressivement des probl√®mes dans l'architecture de solution existante. <br><br>  Le premier probl√®me est li√© √† la quantit√© de donn√©es t√©l√©charg√©es depuis les sites.  Nous √©tions confront√©s au fait que la collecte et la mise √† jour de toutes les donn√©es n√©cessaires des plus grands sites commen√ßaient √† prendre trop de temps.  Par exemple, la collecte de donn√©es sur le syst√®me de publicit√© AdRiver, avec lequel nous suivons les statistiques pour la plupart des emplacements, prend environ 12 heures. <br><br>  Pour r√©soudre ce probl√®me, nous avons commenc√© √† utiliser toutes sortes de rapports pour t√©l√©charger des donn√©es √† partir des sites, nous essayons de d√©velopper leurs API avec les sites afin que sa vitesse r√©ponde √† nos besoins et √† parall√©liser le chargement des donn√©es autant que possible. <br><br>  Un autre probl√®me est le traitement des donn√©es t√©l√©charg√©es.  Maintenant, avec l'arriv√©e de nouvelles statistiques sur le placement, un processus √† plusieurs √©tapes de recalcul des statistiques est lanc√©, qui comprend le chargement des donn√©es brutes, le calcul des statistiques agr√©g√©es pour chaque site, la comparaison des donn√©es provenant de diff√©rentes sources et le calcul des statistiques r√©capitulatives pour la campagne.  Cela entra√Æne une charge importante sur l'application Web, qui effectue tous les calculs.  Plusieurs fois, au cours du recomptage, l‚Äôapplication consomme toute la m√©moire du serveur, environ 10 √† 15 Go, ce qui a le plus d‚Äôeffets sur le travail de l‚Äôutilisateur avec le syst√®me. <br><br>  Les probl√®mes identifi√©s et les plans grandioses pour la poursuite du d√©veloppement du produit nous ont conduit √† la n√©cessit√© de r√©viser l'architecture de l'application. <br><br>  Nous avons commenc√© avec les connecteurs. <br>  Nous avons remarqu√© que tous les connecteurs fonctionnent selon le m√™me mod√®le, nous avons donc construit un pipeline-convoyeur dans lequel pour cr√©er le connecteur, il vous suffisait de programmer la logique des √©tapes, le reste √©tait universel.  Si un connecteur doit √™tre am√©lior√©, nous le transf√©rerons imm√©diatement dans un nouveau cadre tout en finalisant le connecteur. <br><br>  En parall√®le, nous avons commenc√© √† placer des connecteurs dans Docker et Kubernetes. <br>  Nous avions pr√©vu de passer √† Kubernetes pendant longtemps, exp√©riment√© avec les param√®tres CI / CD, mais avons commenc√© √† bouger uniquement lorsqu'un connecteur a commenc√© √† consommer plus de 20 Go de m√©moire sur le serveur en raison d'une erreur, tuant presque le reste des processus.  Au cours de l'enqu√™te, le connecteur a √©t√© d√©plac√© vers le cluster Kubernetes, o√π il est finalement rest√©, m√™me lorsque l'erreur a √©t√© corrig√©e. <br><br>  Tr√®s rapidement, nous avons r√©alis√© que Kubernetes √©tait pratique et en six mois, nous avons d√©plac√© 7 connecteurs et Proxy Connecteurs vers le cluster de production, qui consomme le plus de ressources. <br><br>  Suite aux connecteurs, nous avons d√©cid√© de changer l'architecture du reste de l'application. <br>  Le principal probl√®me √©tait que les donn√©es provenaient des connecteurs vers des proxys dans de grands ensembles, puis elles battaient sur DANBoID et √©taient transf√©r√©es vers une application Web centrale pour le traitement.  En raison du grand nombre de recalculs de m√©triques, une charge importante sur l'application se produit. <br><br>              ,   ,   web ,    ,  ,  -    . <br><br>        2.0. <br><br>        ,   Web API   RabbitMQ   MassTransit     .       Connectors Proxy,    Connectors Hub.   ,             ,       . <br><br>   web             ,                  .             . <br><br>           Kubernetes,         . <br><br><img src="https://habrastorage.org/webt/lx/3j/tw/lx3jtwply2iyyms99xajwhtnsie.png" alt="image"><br><br><h3>    </h3><br> Proof-of-concept  2.0  <b>D1.Digital</b>          .    ‚Äî   20    , ,    ,     ,      . <br><br>   ,              API,    . <br><br>        ,           ,      adserving . <br><br>     ,      web ,    Kubernetes.     ,     ,     . <br><br>          ,     MongoDB.        SQL-,     ,      ,      ,     . <br><br>  ,  ,   :) <br><br> <i>  R&amp;D Dentsu Aegis Network Russia:   ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">shmiigaa</a> ),   ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">hitexx</a> )</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr469625/">https://habr.com/ru/post/fr469625/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr469613/index.html">√Ä propos du syst√®me national de gestion des donn√©es</a></li>
<li><a href="../fr469615/index.html">Temps de haute pr√©cision: comment travailler avec des fractions de seconde en MySQL et PHP</a></li>
<li><a href="../fr469617/index.html">D√©truisez le monopole am√©ricain sur l'EDA. Innopolis fait le premier pas</a></li>
<li><a href="../fr469619/index.html">Recherche: si l'acheteur comprend qu'il parle avec le chat bot, l'achat n'aura pas lieu du tout</a></li>
<li><a href="../fr469623/index.html">GitLab 12.3 avec pare-feu d'application Web et analyse des performances</a></li>
<li><a href="../fr469629/index.html">L'atome pacifique n'est pas dans tous les foyers: des options inattendues pour les sources d'√©nergie des radionucl√©ides</a></li>
<li><a href="../fr469631/index.html">Acc√©l√©ration √† Figma. Besoin de plus de plugins</a></li>
<li><a href="../fr469633/index.html">Nous cr√©ons un jeu de donn√©es pour la reconnaissance des compteurs sur Yandex.Tolok</a></li>
<li><a href="../fr469635/index.html">Fonctionnement des transferts d'argent de carte √† carte</a></li>
<li><a href="../fr469637/index.html">Dans les ann√©es 90, le rappeur MC Hammer a d√©velopp√© le jeu, mais aujourd'hui U Can't Touch This</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>