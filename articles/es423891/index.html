<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìú üßñüèæ üìé √Årboles de expresi√≥n de desarrollo empresarial üßëüèΩ‚Äçü§ù‚Äçüßëüèº üòà üö°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Para la mayor√≠a de los desarrolladores, el uso del √°rbol de expresi√≥n se limita a las expresiones lambda en LINQ. A menudo no le damos importancia a c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>√Årboles de expresi√≥n de desarrollo empresarial</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/423891/">  Para la mayor√≠a de los desarrolladores, el uso del √°rbol de expresi√≥n se limita a las expresiones lambda en LINQ.  A menudo no le damos importancia a c√≥mo funciona la tecnolog√≠a "bajo el cap√≥". <br><br>  En este art√≠culo, le mostrar√© t√©cnicas avanzadas para trabajar con √°rboles de expresi√≥n: eliminar la duplicaci√≥n de c√≥digo en LINQ, generaci√≥n de c√≥digo, metaprogramaci√≥n, transpilaci√≥n, automatizaci√≥n de pruebas. <br><br>  Aprender√° c√≥mo usar el √°rbol de expresi√≥n directamente, qu√© dificultades ha preparado la tecnolog√≠a y c√≥mo sortearlas. <br><br><img src="https://habrastorage.org/webt/e5/qh/tt/e5qhttxqyi5a27s-4dtlt2jq1mo.png"><br><br>  Debajo del corte: transcripci√≥n de video y texto de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mi informe</a> con DotNext 2018 Piter. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/J2XzsCoJM4o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Mi nombre es Maxim Arshinov, soy cofundador de la empresa de outsourcing Hi-Tech Group.  Estamos desarrollando software para empresas, y hoy hablar√© sobre c√≥mo se utiliz√≥ la tecnolog√≠a del √°rbol de expresi√≥n en el trabajo diario y c√≥mo comenz√≥ a ayudarnos. <br><br>  Nunca quise espec√≠ficamente estudiar la estructura interna de los √°rboles de expresi√≥n, parec√≠a que esta era una especie de tecnolog√≠a interna para que funcione el equipo .NET para que LINQ funcionara, y los programadores de aplicaciones no necesitaban conocer su API.  Result√≥ que hab√≠a algunos problemas aplicados que deb√≠an resolverse.  Para que me gustara la soluci√≥n, tuve que subir al intestino. <br><br>  Toda esta historia se extiende en el tiempo, hubo diferentes proyectos, diferentes casos.  Algo sali√≥ y lo termin√©, pero me permitir√© sacrificar la veracidad hist√≥rica en favor de una presentaci√≥n m√°s art√≠stica, por lo que todos los ejemplos estar√°n en el mismo modelo de tema: una tienda en l√≠nea. <br><br><img src="https://habrastorage.org/webt/g5/yf/cr/g5yfcrf13ptoovmcheym1x15fdk.png"><br><br>  Imagine que todos estamos escribiendo una tienda en l√≠nea.  Tiene productos y una marca de verificaci√≥n "En venta" en el panel de administraci√≥n.  Solo mostraremos aquellos productos que tengan esta marca de verificaci√≥n marcada en la parte p√∫blica. <br><br><img src="https://habrastorage.org/webt/cg/_e/jt/cg_ejtgmxn1u0hq12ezlonenue8.png"><br><br>  Tomamos un poco de DbContext o NHibernate, escribimos Where (), sacamos IsForSale. <br><br>  Todo est√° bien, pero las reglas de negocio no son las mismas, de modo que las escribimos de una vez por todas.  Evolucionan con el tiempo.  Llega un gerente y dice que a√∫n debemos monitorear el saldo y mostrar solo los productos que tienen saldos en la parte p√∫blica, sin olvidar la marca de verificaci√≥n. <br><br><img src="https://habrastorage.org/webt/8e/b1/mz/8eb1mzde7casnjrrilroqxpp8ku.png"><br><br>  Agregamos f√°cilmente dicha propiedad.  Ahora que nuestras reglas comerciales est√°n encapsuladas, podemos reutilizarlas. <br><br><img src="https://habrastorage.org/webt/6s/yj/09/6syj09lcwmeiktufuwl4a4wzvyq.png"><br><br>  Intentemos editar LINQ.  ¬øEst√° todo bien aqu√≠? <br>  No, esto no funcionar√°, porque IsAvailable no se asigna a la base de datos, este es nuestro c√≥digo y el proveedor de consultas no sabe c√≥mo analizarlo. <br><br><img src="https://habrastorage.org/webt/qb/yt/dp/qbytdpgh5ybdiua4kjpc-rouxbs.png"><br><br>  Podemos decirle que nuestra propiedad tiene una historia as√≠.  Pero ahora esta lambda est√° duplicada tanto en la expresi√≥n de linq como en la propiedad. <br><br><pre><code class="cs hljs">Where(x =&gt; x.IsForSale &amp;&amp; x.InStock &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) IsAvailable =&gt; IsForSale &amp;&amp; InStock &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br>  Entonces, la pr√≥xima vez que cambie este lambda, tendremos que hacer Ctrl + Shift + F en el proyecto.  Naturalmente, no todos lo encontraremos: errores y tiempo.  Quiero evitar esto <br><br><img src="https://habrastorage.org/webt/8b/8b/j8/8b8bj8voopaagucck7rcl1j9tcg.png"><br><br>  Podemos ir desde este lado y poner otro ToList () delante de Where ().  Esta es una mala decisi√≥n, porque si hay un mill√≥n de productos en la base de datos, todo el mundo usa RAM y filtra all√≠. <br><br><img src="https://habrastorage.org/webt/ca/2t/2g/ca2t2gbdetsmcijcefubnokpfeu.png"><br><br>  Si tiene tres productos en una tienda, la soluci√≥n es buena, pero en el comercio electr√≥nico generalmente hay m√°s.  Esto funcion√≥ solo porque, a pesar de la similitud de las lambdas entre s√≠, tienen un tipo completamente diferente.  En el primer caso, este es un delegado de Func, y en el segundo, un √°rbol de expresi√≥n.  Se ve igual, los tipos son diferentes, el c√≥digo de bytes es completamente diferente. <br><br><img src="https://habrastorage.org/webt/2l/qi/ya/2lqiya8v9axdrfchqrdqtrxbe4o.png"><br><br>  Para pasar de la expresi√≥n a un delegado, solo necesita llamar al m√©todo Compile ().  Esta API proporciona .NET: hay expresi√≥n - compilada, recibi√≥ un delegado. <br><br>  ¬øPero c√≥mo volver?  ¬øHay algo en .NET para pasar de un delegado a √°rboles de expresi√≥n?  Si est√° familiarizado con LISP, por ejemplo, existe un mecanismo de citas que permite que el c√≥digo se interprete como una estructura de datos, pero en .NET no lo es. <br><br><h1>  Expresar o delegados? </h1><br>  Teniendo en cuenta que tenemos dos tipos de lambdas, podemos filosofar lo que es primario: √°rbol de expresi√≥n o delegados. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// so slo-oooooo-ow var delegateLambda = expressionLambda.Compile();</span></span></code> </pre> <br>  A primera vista, la respuesta es obvia: dado que hay un maravilloso m√©todo Compile (), el √°rbol de expresi√≥n es primario.  Y deber√≠amos recibir al delegado compilando la expresi√≥n.  Pero la compilaci√≥n es un proceso lento, y si comenzamos a hacer esto en todas partes, se degrada el rendimiento.  Adem√°s, lo recibiremos en lugares aleatorios, donde la expresi√≥n tuvo que compilarse en un delegado, habr√° una reducci√≥n de rendimiento.  Puede encontrar estos lugares, pero afectar√°n el tiempo de respuesta del servidor y al azar. <br><br><img src="https://habrastorage.org/webt/ur/jw/y_/urjwy_veoqpl7udanxvc3-ddsl8.png"><br><br>  Por lo tanto, necesitan ser almacenados en cach√© de alguna manera.  Si escuch√≥ una charla sobre estructuras de datos concurrentes, entonces sabe acerca de ConcurrentDictionary (o simplemente lo sabe).  Omitir√© detalles sobre los m√©todos de almacenamiento en cach√© (con bloqueos, no bloqueos).  Es solo que ConcurrentDictionary tiene un m√©todo GetOrAdd () simple, y la implementaci√≥n m√°s simple es introducirlo en ConcurrentDictionary y almacenarlo en cach√©.  La primera vez que obtenemos la compilaci√≥n, pero luego todo ser√° r√°pido, porque el delegado ya ha sido compilado. <br><br><img src="https://habrastorage.org/webt/h1/wp/gb/h1wpgbo_5pi3xhnfaivvvjsz4ks.png"><br><br>  Luego puede usar dicho m√©todo de extensi√≥n, puede usar y refactorizar nuestro c√≥digo con IsAvailable (), describir expresiones, compilar propiedades IsAvailable () y llamarlo en relaci√≥n con el objeto actual. <br><br>  Hay al menos dos paquetes que implementan esto: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Microsoft.Linq.Translations</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Signum Framework</a> (marco de c√≥digo abierto escrito por una empresa comercial).  Tanto all√≠ como hay casi la misma historia con la compilaci√≥n de delegados.  Una API un poco diferente, pero todo como lo mostr√© en la diapositiva anterior. <br><br>  Sin embargo, este no es el √∫nico enfoque, y puede pasar de delegados a expresiones.  Durante mucho tiempo ha habido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un art√≠culo</a> sobre Habre sobre el descompilador delegado, donde el autor afirma que toda compilaci√≥n es mala, porque durante mucho tiempo. <br><br>  En general, los delegados estaban antes de las expresiones, y puede pasar a ellos desde los delegados.  Para hacer esto, el autor utiliza el m√©todoBody.GetILAsByteArray ();  de Reflection, que realmente devuelve todo el c√≥digo IL del m√©todo como una matriz de bytes.  Si lo coloca m√°s en Reflection, puede obtener una representaci√≥n de objeto de este caso, recorrerlo con un bucle y construir un √°rbol de expresi√≥n.  Por lo tanto, tambi√©n es posible una transici√≥n inversa, pero debe hacerse a mano. <br><br><img src="https://habrastorage.org/webt/_r/pp/d5/_rppd5sfv3tmy9mfacmg6wydi3k.png"><br><br>  Para no ejecutar todas las propiedades, el autor sugiere colgar el atributo Computado para indicar que esta propiedad debe estar en l√≠nea.  Antes de la solicitud, subimos a IsAvailable (), extraemos su c√≥digo IL, lo convertimos al √°rbol de expresi√≥n y reemplazamos la llamada IsAvailable () con lo que est√° escrito en este getter.  Resulta una alineaci√≥n manual de este tipo. <br><br><img src="https://habrastorage.org/webt/nt/jx/g1/ntjxg17v2olokmu7ebckzs7v_uq.png"><br><br>  Para que esto funcione, antes de pasar todo a ToList (), llamamos al m√©todo especial Decompile ().  Proporciona un decorador para el original consultable y en l√≠nea.  Solo despu√©s de eso, pasamos todo al proveedor de consultas, y todo est√° bien para nosotros. <br><br><img src="https://habrastorage.org/webt/ze/cz/qw/zeczqw8mzr-k72ivpyfzqrpuhrm.png"><br><br>  El √∫nico problema con este enfoque es que Delegate Decompiler 0.23.0 no avanzar√°, no hay soporte de Core, y el autor mismo dice que este es alfa profundo, hay muchos inacabados, por lo que no puede usarlo en producci√≥n.  Aunque volveremos a este tema. <br><br><h1>  Operaciones booleanas </h1><br>  Resulta que hemos resuelto el problema de la duplicaci√≥n de condiciones espec√≠ficas. <br><br><img src="https://habrastorage.org/webt/gc/-u/5n/gc-u5nh7vip9kn5cq1d5gn3ivxm.png"><br><br>  Pero las condiciones a menudo deben combinarse utilizando la l√≥gica booleana.  Ten√≠amos IsForSale (), InStock ()&gt; 0, y entre ellos la condici√≥n "Y".  Si hay alguna otra condici√≥n, o se requiere una condici√≥n "O". <br><br><img src="https://habrastorage.org/webt/9f/xu/hy/9fxuhyfzinahcrlertade-zam2s.png"><br><br>  En el caso de "Y", puede hacer trampa y volcar todo el trabajo en el proveedor de consultas, es decir, escribir mucho Where () en una fila, √©l sabe c√≥mo hacerlo. <br><br><img src="https://habrastorage.org/webt/dd/hp/c9/ddhpc9tfdvmeiadkmyfmswnr4h8.png"><br><br>  Si se requiere "OR", esto no funcionar√° porque WhereOr () no est√° en LINQ y el operador | | no est√° sobrecargado con expresiones. <br><br><h1>  Especificaciones </h1><br>  Si est√° familiarizado con el libro DDD de Evans o simplemente sabe algo sobre el patr√≥n de Especificaci√≥n, es decir, un patr√≥n de dise√±o dise√±ado espec√≠ficamente para esto.  Existen varias reglas comerciales y desea combinar operaciones en l√≥gica booleana: implemente la Especificaci√≥n. <br><br><img src="https://habrastorage.org/webt/nj/cb/4n/njcb4n2xt0g8dk3joumhmsgmuyg.png"><br><br>  Una especificaci√≥n es un t√©rmino, un patr√≥n antiguo de Java.  Y en Java, especialmente en el anterior, no hab√≠a LINQ, por lo que se implement√≥ all√≠ solo en la forma del m√©todo isSatisfiedBy (), es decir, solo delegados, pero no se habl√≥ de expresiones.  Hay una implementaci√≥n en Internet llamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LinqSpecs</a> , en la diapositiva la ver√°.  Lo archiv√© un poco para m√≠, pero la idea pertenece a la biblioteca. <br><br>  Aqu√≠, todos los operadores booleanos est√°n sobrecargados, los operadores verdadero y falso est√°n sobrecargados para que los dos operadores "&amp;&amp;" y "||" funcionen, sin ellos solo funcionar√° un ampersand. <br><br><img src="https://habrastorage.org/webt/nh/8b/16/nh8b16hfmjec4t6yotlcmu5nbzi.png"><br><br>  A continuaci√≥n, agregamos declaraciones impl√≠citas que hacen que el compilador suponga que la especificaci√≥n es tanto expresiones como delegados.  En cualquier lugar donde Expression &lt;&gt; o Func &lt;&gt; entren en la funci√≥n, puede pasar la especificaci√≥n.  Como el operador impl√≠cito est√° sobrecargado, el compilador analizar√° y sustituir√° las propiedades Expression o IsSatisfiedBy. <br><br><img src="https://habrastorage.org/webt/pd/-t/jk/pd-tjkx5uxieorm3go74act-2gc.png"><br><br>  IsSatisfiedBy () se puede implementar almacenando en cach√© la expresi√≥n que vino.  En cualquier caso, resulta que venimos de Expression, el delegado corresponde a √©l, hemos agregado soporte para operadores booleanos.  Ahora todo esto se puede arreglar.  Las reglas comerciales se pueden poner en especificaciones est√°ticas, declaradas y combinadas. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Spec&lt;Product&gt; IsForSaleSpec = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Spec&lt;Product&gt;(x =&gt; x.IsForSale); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Spec&lt;Product&gt; IsInStockSpec = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Spec&lt;Product&gt;(x =&gt; x.InStock &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br><img src="https://habrastorage.org/webt/ru/ju/ya/rujuyaoj1ogssqq_resyqjmkutm.png"><br><br>  Cada regla de negocios se escribe solo una vez, no se perder√° en ning√∫n lado, no se duplicar√°, se pueden combinar.  Las personas que vienen al proyecto pueden ver lo que tienes, qu√© condiciones, entender el modelo de tema. <br><br><img src="https://habrastorage.org/webt/td/5l/zi/td5lzi5sx9bcq522numfdrylehg.png"><br><br>  Hay un peque√±o problema: la expresi√≥n no tiene los m√©todos And (), Or () y Not ().  Estos son m√©todos de extensi√≥n, deben implementarse independientemente. <br><br><img src="https://habrastorage.org/webt/l9/go/tj/l9gotjytui3drpptkcdtbyeymcc.png"><br><br>  El primer intento de implementaci√≥n fue este.  Sobre el √°rbol de expresi√≥n, hay bastante documentaci√≥n en Internet, y no todo est√° detallado.  Por lo tanto, intent√© simplemente tomar Expression, presion√© Ctrl + Espacio, vi OrElse (), le√≠ sobre eso.  Pas√≥ dos expresiones para compilar y obtener lambda.  Esto no va a funcionar. <br><br><img src="https://habrastorage.org/webt/v4/p3/8u/v4p38uvzgxubb2y8olt38ivbipq.png"><br><br>  El hecho es que esta expresi√≥n consta de dos partes: par√°metro y cuerpo.  El segundo tambi√©n consta de un par√°metro y un cuerpo.  En OrElse (), debe pasar los cuerpos de las expresiones, es decir, es in√∫til comparar lambdas con "AND" y "OR", esto no funcionar√°.  Lo arreglamos, pero no volver√° a funcionar. <br><br>  Pero si la √∫ltima vez hubo una excepci√≥n NotSupportedException de que el lambda no era compatible, ahora hay una historia extra√±a sobre el par√°metro 1, par√°metro 2, "algo est√° mal, no funcionar√©". <br><br><h1>  C # 7.0 en pocas palabras </h1><br>  Entonces pens√© que el m√©todo cient√≠fico no funcionar√≠a, necesito resolverlo.  Comenz√≥ a buscar en Google y encontr√≥ el sitio del libro de Albahari " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C # 7.0 en pocas palabras</a> ". <br><br><img src="https://habrastorage.org/webt/m6/0b/ag/m60bagpqsrrcakt5wz-p05lcfyq.png"><br><br>  Joseph Albahari, quien tambi√©n es el desarrollador de la popular biblioteca LINQKit y LINQPad, simplemente describe este problema.  que no puedes simplemente tomar y combinar Expression, y si tomas la expresi√≥n m√°gica.Invoke (), funcionar√°. <br><br>  Pregunta: ¬øqu√© es Expression.Invoke ()?  Ve a Google nuevamente.  Crea una InvocationExpression que aplica un delegado o una expresi√≥n lambda a la lista de argumentos. <br><br><img src="https://habrastorage.org/webt/br/du/mh/brdumhygufxqwgu5hfly1nlac0a.png"><br><br>  Si le leo este c√≥digo ahora que tomamos Expression.Invoke (), pasamos los par√°metros, entonces lo mismo est√° escrito en ingl√©s.  No se est√° aclarando.  Hay algo de Expression.Invoke m√°gico () que por alguna raz√≥n resuelve este problema con par√°metros.  Debemos creer, no es necesario entender. <br><br><img src="https://habrastorage.org/webt/ja/88/po/ja88po-nxrjqtzdya6f8xxnfwre.png"><br><br>  Al mismo tiempo, si intenta alimentar EFs como Expresi√≥n combinada, caer√° nuevamente y dir√° que Expression.Invoke () no es compatible.  Por cierto, EF Core comenz√≥ a admitir, pero EF 6 no se mantiene.  Pero Albahari solo ofrece escribir AsExpandable (), y todo funciona. <br><br><img src="https://habrastorage.org/webt/z5/4s/lq/z54slqaaitigetkidixpw-0a408.png"><br><br>  Y puede sustituir en subconsultas de expresi√≥n donde necesitamos un delegado.  Para que coincidan, escribimos Compile (), pero al mismo tiempo, si escribimos AsExpandable (), como sugiere Albahari, este Compile () en realidad no suceder√°, pero de alguna manera todo se har√° m√°gicamente correctamente. <br><br><img src="https://habrastorage.org/webt/u_/bd/wo/u_bdwop-dd-1gf_xvq3e_d9hbj8.png"><br><br>  No cre√≠ una palabra y sub√≠ a la fuente.  ¬øQu√© es el m√©todo AsExpandable ()?  Tiene consulta y QueryOptimizer.  Dejaremos el segundo entre par√©ntesis, ya que no es interesante, pero simplemente pega Expression: si hay 3 + 5, pondr√° 8. <br><br><img src="https://habrastorage.org/webt/l6/8j/tw/l68jtwqse6njinyczxh7xs3ilmw.png"><br><br>  Es interesante que el m√©todo Expand () se llame m√°s tarde, despu√©s de que el queryOptimizer, y luego todo se pase al proveedor de consultas de alguna manera rehecho despu√©s del m√©todo Expand (). <br><br><img src="https://habrastorage.org/webt/pr/dv/oc/prdvockxs8plz7f2lyciiyu0s5y.png"><br><br>  Lo abrimos, es Visitor, en el interior vemos el Compile no original (), que compila algo m√°s.  No le dir√© exactamente qu√©, aunque esto tenga un cierto significado, pero eliminamos una compilaci√≥n y la reemplazamos por otra.  Genial, pero huele a marketing de nivel 80 porque el impacto en el rendimiento no va a ninguna parte. <br><br><h1>  En busca de una alternativa </h1><br>  Pens√© que esto no funcionar√≠a y comenc√© a buscar otra soluci√≥n.  Y lo encontr√©.  Existe Pete Montgomery, que tambi√©n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">escribe</a> sobre este problema y afirma que Albahari fingi√≥. <br><img src="https://habrastorage.org/webt/k9/pu/hy/k9puhyrru6xqi3hyozftlav_lvk.png"><br>  Pete habl√≥ con los desarrolladores de EF, y le ense√±aron a combinar todo sin Expression.Evoke ().  La idea es muy simple: la emboscada fue con los par√°metros.  El hecho es que con la expresi√≥n de combinaci√≥n hay un par√°metro de la primera expresi√≥n y un par√°metro de la segunda.  No coinciden  Los cuerpos estaban pegados, pero los par√°metros permanec√≠an suspendidos en el aire.  Necesitan ser vendados de la manera correcta. <br><br>  Para hacer esto, necesita compilar un diccionario mirando los par√°metros de las expresiones, si la lambda no es de un par√°metro.  Redactamos un diccionario y volvemos a unir todos los par√°metros del segundo a los par√°metros del primero, de modo que los par√°metros iniciales ingresen a Expresi√≥n, conduzcan por todo el cuerpo que unimos. <br><img src="https://habrastorage.org/webt/yn/ct/37/ynct37iynt07424au-grgvhhz1o.png"><br>  Un m√©todo tan simple le permite deshacerse de todas las emboscadas con Expression.Invoke ().  Adem√°s, en la implementaci√≥n de Pete Montgomery, esto se hace a√∫n m√°s genial.  Tiene un m√©todo Compose () que le permite combinar cualquier expresi√≥n. <br><br><img src="https://habrastorage.org/webt/wc/of/fv/wcoffvtu4s62gggy_qqykowjtns.png"><br><br>  Tomamos expresi√≥n y a trav√©s de AndAlso tambi√©n nos conectamos, funciona sin Expandable ().  Es esta implementaci√≥n la que se usa en las operaciones booleanas. <br><br><h1>  Especificaciones y unidades </h1><br>  Todo estuvo bien hasta que qued√≥ claro que los agregados existen en la naturaleza.  Para aquellos que no est√°n familiarizados, explicar√©: si tiene un modelo de dominio y representa todas las entidades que est√°n relacionadas entre s√≠ en forma de √°rboles, entonces un √°rbol que cuelga por separado es un agregado.  El orden junto con los elementos del pedido se denominar√° agregado, y la esencia del pedido es la ra√≠z de agregaci√≥n. <br><br><img src="https://habrastorage.org/webt/zr/vr/6a/zrvr6af-865n3tluhcoivfjn68g.png"><br><br>  Si, adem√°s de los productos, todav√≠a hay categor√≠as con una regla comercial anunciada para ellos en forma de especificaci√≥n, que hay una cierta calificaci√≥n que deber√≠a ser m√°s de 50, como dijeron los especialistas en marketing y queremos usarla de esa manera, entonces esto es bueno. <br><br><img src="https://habrastorage.org/webt/tp/vh/u-/tpvhu-12wisjnbsdhnmddkqpkw4.png"><br><br>  Pero si queremos sacar los productos de una buena categor√≠a, entonces nuevamente es malo, porque nuestros tipos no coinciden.  Especificaci√≥n para la categor√≠a, pero se necesitan productos. <br><br><img src="https://habrastorage.org/webt/yz/cj/wp/yzcjwpjtf0jvuwff1dae8jef7ha.png"><br><br>  Nuevamente, necesitamos resolver el problema de alguna manera.  La primera opci√≥n: reemplazar Select () con SelectMany ().  No me gustan dos cosas aqu√≠.  En primer lugar, no s√© c√≥mo se implementa la compatibilidad con SelectMany () en todos los proveedores de consultas populares.  En segundo lugar, si alguien escribe un proveedor de consultas, lo primero que har√° es escribir excepci√≥n de lanzamiento no implementado y SelectMany ().  Y el tercer punto: la gente piensa que SelectMany () es funcionalidad o se une, generalmente no asociada con una consulta SELECT. <br><br><h1>  Composici√≥n </h1><br>  Me gustar√≠a usar Select (), no SelectMany (). <br><br><img src="https://habrastorage.org/webt/-_/bv/qm/-_bvqmi8jssf1sva8boyiuh1vsg.png"><br><br>  Casi al mismo tiempo, le√≠ sobre la teor√≠a de categor√≠as, sobre la composici√≥n funcional y pens√© que si hay especificaciones del producto en el bool a continuaci√≥n, hay alguna funci√≥n que puede ir del producto a la categor√≠a, hay una especificaci√≥n con respecto a la categor√≠a, y luego sustituyo la primera Funcionamos como argumento del segundo, obtenemos lo que necesitamos, una especificaci√≥n sobre el producto.  Absolutamente lo mismo que funciona la composici√≥n funcional, pero para los √°rboles de expresi√≥n. <br><br><img src="https://habrastorage.org/webt/hg/wp/7h/hgwp7h8a0nrpv2xsfphtltel160.png"><br><br>  Entonces ser√≠a posible escribir un m√©todo Where () que sea necesario pasar de productos a categor√≠as y aplicar la especificaci√≥n a esta entidad relacionada.  Tal sintaxis para mi gusto subjetivo parece bastante comprensible. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IQueryable&lt;T&gt; Where&lt;T, TParam&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> IQueryable&lt;T&gt; queryable, Expression&lt;Func&lt;T, TParam&gt;&gt; prop, Expression&lt;Func&lt;TParam, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">where</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> queryable.Where(prop.Compose(<span class="hljs-keyword"><span class="hljs-keyword">where</span></span>)); }</code> </pre> <br>  Con el m√©todo Compose (), esto tambi√©n se puede hacer f√°cilmente.  Tomamos la expresi√≥n de entrada de los productos y la combinamos con las especificaciones del producto y listo. <br><br><img src="https://habrastorage.org/webt/5p/5k/re/5p5krejfyvexk6c-hf50hymykss.png"><br><br>  Ahora puede escribir tales Where ().  Esto funcionar√° si tiene una m√°quina de cualquier longitud.  La categor√≠a tiene una Supercategor√≠a y cualquier n√∫mero de propiedades adicionales que se pueden sustituir. <br><br>  "Dado que tenemos una herramienta para la composici√≥n funcional, y dado que podemos compilarla, y dado que podemos ensamblarla din√°micamente, ¬°significa que huele a metaprogramaci√≥n!", Pens√©. <br><br><h1>  Proyecciones </h1><br>  ¬øD√≥nde podemos aplicar la metaprogramaci√≥n para que tengamos que escribir menos c√≥digo? <br><br><img src="https://habrastorage.org/webt/z6/dw/gi/z6dwgivuday4edqii5me2z0yuw0.png"><br><br>  La primera opci√≥n es la proyecci√≥n.  Sacar una entidad completa a menudo es demasiado costoso.  Muy a menudo lo pasamos al frente, serializamos JSON.  Pero no necesita toda la esencia junto con el agregado.  Puede hacer esto con LINQ de la manera m√°s eficiente posible escribiendo tal Select () manualmente.  No es dif√≠cil, pero aburrido. <br><br><img src="https://habrastorage.org/webt/1r/co/xd/1rcoxdmbzmuplg1vyuvkz5hrrqg.png"><br><br>  En cambio, sugiero que todos usen ProjectToType ().  Al menos hay dos bibliotecas que pueden hacer esto: Automapper y Mapster.  Por alguna raz√≥n, muchas personas saben que AutoMapper puede hacer mapeos en la memoria, pero no todos saben que tiene Extensiones consultables, tambi√©n tiene Expresi√≥n y puede construir una expresi√≥n SQL.  Si todav√≠a escribe consultas manuales y usa LINQ, ya que no tiene restricciones de rendimiento muy graves, entonces no tiene sentido hacerlo con las manos, este es el trabajo de la m√°quina, no de la persona. <br><br><h1>  Filtrado </h1><br>  Si podemos hacer esto con proyecciones, ¬øpor qu√© no hacerlo para filtrar? <br><br><img src="https://habrastorage.org/webt/wg/ei/pd/wgeipdnvwwusix--gk7_zch9nhs.png"><br><br>  Aqu√≠ est√° el c√≥digo tambi√©n.  Entra un filtro.  Muchas aplicaciones comerciales se ven as√≠: vino un filtro, agregue Where (), vino otro filtro, agregue Where ().  Cu√°ntos filtros hay, tantos y repite.  Nada complicado, pero mucho copiar y pegar. <br><br><img src="https://habrastorage.org/webt/fd/7r/wl/fd7rwlnpkuiluiadq0zppn7_t-y.png"><br><br>  Si nosotros, como AutoMapper, lo hacemos, escribimos AutoFilter, Project y Filter para que √©l haga todo por s√≠ mismo, ser√≠a un c√≥digo genial. <br><br><img src="https://habrastorage.org/webt/9g/es/tg/9gestgfo-ouzbolexklhu78gv8q.png"><br><br>  Esto no es nada complicado.  Tome Expression.Property, camine por el DTO y, en esencia.  Encontramos propiedades comunes que se llaman de forma id√©ntica.  Si se les llama igual, se ve como un filtro. <br><br>  A continuaci√≥n, debe buscar nulo, usar una constante para extraer el valor del DTO, sustituirlo en la expresi√≥n y agregar conversi√≥n en caso de que tenga Int y NullableInt u otro Nullable para que los tipos coincidan.  Y ponga, por ejemplo, Equals (), un filtro que verifica la igualdad. <br><br><img src="https://habrastorage.org/webt/09/x6/me/09x6mep3p-rrvwo0vodcnke_8eo.png"><br><br>  Luego recolecte lambda y vaya a cada propiedad: si hay muchas, rec√≥jalas a trav√©s de ‚ÄúY‚Äù o ‚ÄúO‚Äù, dependiendo de c√≥mo funcione el filtro para usted. <br><br><img src="https://habrastorage.org/webt/ha/vw/en/havwen3xvrbraul6plgdadjjusy.png"><br><br>  Se puede hacer lo mismo para ordenar, pero es un poco m√°s complicado, ya que el m√©todo OrderBy () tiene dos gen√©ricos, por lo que debe completarlos con las manos, usar Reflections para crear el m√©todo OrderBy () a partir de dos gen√©ricos, insertar el tipo de entidad que estamos tomando, el tipo de ordenable Propiedad.  En general, tambi√©n puede hacer esto, no es dif√≠cil. <br><br>  Surge la pregunta: d√≥nde colocar Where (): a nivel de entidad, como se anunciaron las especificaciones o despu√©s de la proyecci√≥n, y all√≠ y all√≠ funcionar√°. <br><br><img src="https://habrastorage.org/webt/e1/4g/4g/e14g4gelsidqhaeq7avs0wgp51i.png"><br><br>  Es cierto ambos, y as√≠, porque las especificaciones son, por definici√≥n, reglas comerciales, y debemos apreciarlas y apreciarlas y no equivocarnos con ellas.  Esta es una capa unidimensional.  Y los filtros tienen m√°s que ver con la interfaz de usuario, lo que significa que filtran por DTO.  Por lo tanto, puede poner dos Where ().  Hay preguntas m√°s probables sobre qu√© tan bien el proveedor de consultas manejar√° esto bien, pero creo que las soluciones ORM escriben SQL incorrecto de todos modos, y no ser√° mucho peor.  Si esto es muy importante para usted, entonces esta historia no trata sobre usted en absoluto. <br><br><img src="https://habrastorage.org/webt/46/wn/kc/46wnkcjkjayv9boma0pot5of0rs.png"><br><br>  Como dicen, es mejor ver una vez que escuchar cien veces. <br>  Ahora la tienda tiene tres productos: Snickers, Subaru Impreza y Mars.  Extra√±a tienda.  Intentemos encontrar Snickers.  Hay  Veamos qu√© cien rublos.  Tambi√©n Snickers.  ¬øY por 500?  Acercar, no hay nada.  Y para el 100500 Subaru Impreza.  Genial, lo mismo ocurre con la clasificaci√≥n. <br><br>  Ordenar alfab√©ticamente y por precio.  El c√≥digo all√≠ est√° escrito exactamente tanto como estaba.  Estos filtros funcionan para cualquier clase, lo que sea.  Si intenta buscar por nombre, entonces Subaru tambi√©n existe.  Y en mi presentaci√≥n fue Igual ().  ¬øC√≥mo es eso?  El hecho es que el c√≥digo aqu√≠ y en la presentaci√≥n son un poco diferentes.  Coment√© la l√≠nea sobre Equals () y agregu√© algo de magia callejera especial.  Si tenemos el tipo String, entonces no necesitamos Equals (), sino que llamamos a StartWith (), que tambi√©n recib√≠.  Por lo tanto, se crea un filtro diferente para las filas. <br><br><img src="https://habrastorage.org/webt/t7/fa/kp/t7fakpf7peg_v2swpq2xwksiecu.png"><br><br>  Esto significa que aqu√≠ puede presionar Ctrl + Shift + R, seleccionar el m√©todo y escribir no si, sino cambiar, o incluso puede implementar el patr√≥n de "Estrategia" y luego volverse loco.  Puede realizar cualquier deseo sobre el funcionamiento de los filtros.  Todo depende de los tipos con los que trabajas.  Lo m√°s importante, los filtros funcionar√°n igual. <br><br>  Puede aceptar que los filtros en todos los elementos de la interfaz de usuario deber√≠an funcionar as√≠: las cadenas se buscan de una manera, el dinero se busca en otra.  Coordine todo esto, escriba una vez, todo se har√° correctamente en diferentes interfaces, y ning√∫n otro desarrollador lo romper√°, porque este c√≥digo no est√° en el nivel de la aplicaci√≥n, sino en alg√∫n lugar de una biblioteca externa o en su n√∫cleo. <br><br><h1>  Validaci√≥n </h1><br>  Adem√°s del filtrado y la proyecci√≥n, puede hacer la validaci√≥n.  La biblioteca JS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">TComb.validation</a> surgi√≥ con esta idea.  TComb es una abreviatura de Type Combinators y se basa en un sistema de tipos, etc.  refinamientos, mejoras. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// null and undefined validate('a', t.Nil).isValid(); // =&gt; false validate(null, t.Nil).isValid(); // =&gt; true validate(undefined, t.Nil).isValid(); // =&gt; true // strings validate(1, t.String).isValid(); // =&gt; false validate('a', t.String).isValid(); // =&gt; true // numbers validate('a', t.Number).isValid(); // =&gt; false validate(1, t.Number).isValid(); // =&gt; true</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Primero, las primitivas se declaran correspondientes a todos los tipos JS, y un tipo de nulo adicional correspondiente a indefinido o cero. </font></font><br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// a predicate is a function with signature: (x) -&gt; boolean var predicate = function (x) { return x &gt;= 0; }; // a positive number var Positive = t.refinement(t.Number, predicate); validate(-1, Positive).isValid(); // =&gt; false validate(1, Positive).isValid(); // =&gt; true</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entonces comienza la diversi√≥n. </font><font style="vertical-align: inherit;">Cada tipo se puede mejorar con un predicado. </font><font style="vertical-align: inherit;">Si queremos n√∫meros mayores que cero, declaramos el predicado x&gt; = 0 y hacemos la validaci√≥n con respecto al tipo Positivo. </font><font style="vertical-align: inherit;">Entonces, desde los bloques de construcci√≥n, puede recopilar cualquiera de sus validaciones. </font><font style="vertical-align: inherit;">Notamos, probablemente, tambi√©n hay expresiones lambda. </font></font><br><br><img src="https://habrastorage.org/webt/ha/wx/lj/hawxljvmttn1bc0rhh5k4fvtywe.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La llamada es aceptada. </font><font style="vertical-align: inherit;">Tomamos el mismo refinamiento, lo escribimos en C #, escribimos el m√©todo IsValid (), y tambi√©n compilamos y ejecutamos Expression. </font><font style="vertical-align: inherit;">Ahora tenemos la oportunidad de realizar la validaci√≥n.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RefinementAttribute</span></span>: <span class="hljs-title"><span class="hljs-title">ValidationAttribute</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IValidator&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; Refinement { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RefinementAttribute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Type refinmentType</span></span></span><span class="hljs-function">)</span></span> { Refinement = (IValidator&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;) Activator.CreateInstance(refinmentType); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValid</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> =&gt; Refinement.Validate(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>).IsValid(); }</code> </pre> <br>     DataAnnotations  ASP.NET MVC,      .  RefinementAttribute(),    .   ,  RefinementAttribute ,      ,        .NET,  . <br><br><img src="https://habrastorage.org/webt/ml/e7/j9/mle7j92pbchiswi1ni7zfvizgou.png"><br><br>     . AdultRefinement,    18. <br><br><img src="https://habrastorage.org/webt/cp/2o/yt/cp2oytz1rrhql042hddkb3va8ug.png"><br><br>    ,        .  NoJS   JS   ,  . ,   C#     ,        JS.       JSX, ES6     JavaScript.   ?  Visitor, ,      JavaScript. <br><br><img src="https://habrastorage.org/webt/lg/qe/9y/lgqe9yl63oz8p8wmlkrmyfmkkky.png"><br><br>     ‚Äî   ,    .    regexp,  StringBuilder,  regexp.      ,   JS ‚Äî    ,      bool ,      .  ,   . <br><br><pre> <code class="cs hljs">{ predicate: ‚Äúx=&gt; (x &gt;= <span class="hljs-number"><span class="hljs-number">18</span></span>)‚Äù, errorMessage: ‚ÄúFor adults only¬ª }</code> </pre> <br>   ,    ,    ,    JS    errorMessage ¬´For adults only¬ª.   .  . ,   . <br><br>  React,       UserRefinment() Expression  errorMessage,  refinment  number,  eval,   .        ,    number,    JS.  , .  ,   ,  false . <br><br><img src="https://habrastorage.org/webt/km/vw/ls/kmvwlsxxw5csttfvkh_rxrpbwpe.png"><br><br>    alert.   onSubmit, alert ,    .      . <br><br><img src="https://habrastorage.org/webt/xj/hm/mz/xjhmmznmn7xgzlcxedk_tgvdzcu.png"><br><br>    Ok(ModelState.IsValid),  User,       JavaScript.    Refinement. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">DemoApp.Core</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">User</span></span>: <span class="hljs-title"><span class="hljs-title">HasNameBase</span></span> { [Refinement(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(AdultRefinement))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Age { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre><br>       ,     .      JavaScript. ,  -  C#,     ,  .   NoJS,    . <br><br><h1>  Prueba </h1><br><img src="https://habrastorage.org/webt/jz/fm/y0/jzfmy0ngjejazfvdrf5ld9y8cc4.png"><br><br>         .,   -,   Moq.    mock  -   ‚Äî  moq,    fluent-.  ,             . <br><br>    moq ‚Äî   Expression,  .     ,        Castle.DynamicProxy.       .      . <br><br><img src="https://habrastorage.org/webt/tc/xo/fk/tcxofk6igzdettbtprnfewltn_q.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un amigo m√≠o recientemente pregunt√≥ si hab√≠a algo como WCF en nuestro Core. Le respond√≠ que hay un WebAPI. Quer√≠a en WebAPI, como en WCF en WSDL, construir un proxy. Solo hay arrogancia en WebAPI. Pero swagger es solo texto, y un amigo no quer√≠a ver cada vez que cambia la API y qu√© se rompe. Cuando hubo WCF, habilit√≥ WSDL, si la especificaci√≥n ha cambiado en la API, la compilaci√≥n se rompi√≥.</font></font><br><br>     ,    ,    .    moq    GetResponse&lt;&gt;()    ProductController,  ,    ,  .   ,   ,  Ctrl+Space    ,     ,  ,   , dll  .  Intellisense,   ,    . <br><br> ,  Moq,     ,     ,   ,    API    .   ,  -   ,     ,      ,   POST-  GET-,   ,        ,    Intellisense  expression tree      . ,    ,      Web-. <br><br>  Reflection <br><br>    -,    Reflection. <br><br><img src="https://habrastorage.org/webt/gr/bq/r_/grbqr_q2oqe0rulsblvpejylomk.png"><br><br>  ,  Reflection ,    .        Expression.  ‚Äî   CreateInstance.      ,    Expression.New(),      ,      . <br><br><img src="https://habrastorage.org/webt/8u/me/lv/8umelvrhhu0ctn0gaunjp1ldmxg.png"><br><br>          .     - .  Activator,     ,     . Constructor_Invoke,    .   ‚Äî New  compiled-.       ,   ,   ,   ,     . <br><br><img src="https://habrastorage.org/webt/yr/sv/7k/yrsv7kspmbbmnfjxc1slzkemvx4.png"><br><br>         . <br><br><img src="https://habrastorage.org/webt/gf/2d/4e/gf2d4ebwaltmazxfjicoupxwrbk.png"><br><br>   .    -    Fast Memember    Fast Reflect,     ,    .  ,       , -    .  ,   ,       . <br><br><img src="https://habrastorage.org/webt/hi/x1/e7/hix1e7peelljkkm6kewh4blyhgq.png"><br><br>   ,   ,   , .       ,       ,     .   ,    , -     ,     ,  ,       ,   DSL, Little Languages  -,  . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todas estas son las mismas cosas cuando para alguna tarea se nos ocurre un conjunto de comandos y para √©l escribimos nuestro propio int√©rprete que realiza esto. Es decir, dentro de la aplicaci√≥n escribimos otro compilador o int√©rprete que sabe c√≥mo usar estos comandos. Esto es exactamente lo que se hace en DLR, en la parte que funciona con IronPython, los idiomas IronRuby. El √°rbol de expresi√≥n all√≠ se usa para ejecutar c√≥digo din√°mico en el CLR. Lo mismo puede hacerse en aplicaciones comerciales, pero hasta ahora no hemos notado tal necesidad y esto permanece fuera de los corchetes.</font></font><br><br><h1>  Resumen </h1><br>      ,         .   ,     .    ,    ,  -  ,   . <br><br>   ‚Äî    .    100    ,    .    ,     ,       ,      .    Expression Trees,  -      . <br><br>    ,   ,     ,     ,     ,    . <br><br>      ,       ,             .        ,     . <br><br>   ,        ,         Expression, Reflection,  ,  ,      .    ,  ,    API,    ,  Expression    .    . <br><br>      Expression.Compile()    .        ,  Expression' ,    Dictionary  .  -  ,    ,    ,    ,    ,     Compile()   .  ,   . <br><br>    ‚Äî     C#-,    ,   ,    Where(), - implicit- .     MSDN,  .    , ,    ,        ,          ,        ,  StackOverflow   ,     - . <br><br>  ,  ,      .   ,    ,  ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>  .     ,        ‚Äî   . <br><blockquote> 22-23     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DotNext 2018 Moscow</a> .       , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>     ( <b>  </b>   ). </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423891/">https://habr.com/ru/post/es423891/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es423877/index.html">29-31 de octubre: creaci√≥n de un cl√∫ster de Kubernetes listo para la producci√≥n</a></li>
<li><a href="../es423879/index.html">¬øEs f√°cil agregar nuevas funciones al marco anterior? Harina de elecci√≥n sobre el ejemplo del desarrollo de SObjectizer</a></li>
<li><a href="../es423881/index.html">¬øCu√°les fueron los soldadores para la √≥ptica (segunda parte)</a></li>
<li><a href="../es423885/index.html">Una invitaci√≥n a un espect√°culo de luces y un peque√±o conocedor de la futura plataforma Circle of Light en Mosc√∫</a></li>
<li><a href="../es423889/index.html">Mi decepci√≥n en el software</a></li>
<li><a href="../es423893/index.html">Hello World para recibir datos de un dispositivo Bluetooth (BLE) a trav√©s de C #</a></li>
<li><a href="../es423895/index.html">No necesitas un abogado. Pero eso no es seguro</a></li>
<li><a href="../es423897/index.html">Consejos √∫tiles para usar el asistente HyperLynx DDR para el an√°lisis QDR4</a></li>
<li><a href="../es423901/index.html">Cuando se necesita velocidad y escala: servidor de dispositivos iOS distribuidos</a></li>
<li><a href="../es423903/index.html">Inmersi√≥n en AD: analizamos ataques avanzados en Microsoft Active Directory y c√≥mo detectarlos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>