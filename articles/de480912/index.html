<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👍🏿 💇 🐻 Dap in Aktion. TodoMVC schreiben. Teil 1 ✍🏼 🚬 😶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Der erste Artikel über DAP wurde offensichtlich nicht zu meinem Erfolg beim Schreiben: Die überwiegende Mehrheit der Kommentare dazu lautete "Niasilil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dap in Aktion. TodoMVC schreiben. Teil 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480912/"> Der erste <a href="https://habr.com/ru/post/478330/">Artikel</a> über <a href="https://dap.js.org/" rel="nofollow">DAP</a> wurde offensichtlich nicht zu meinem Erfolg beim Schreiben: Die überwiegende Mehrheit der Kommentare dazu lautete "Niasilil" und "Niasilil, aber ich verurteile".  Und der Preis für <s>den</s> einzigen konstruktiven Top-Level-Kommentar geht an <a href="https://habr.com/en/users/oldvitus/" class="user_link">OldVitus</a> , um Ratschläge zu erhalten, wie die Dap am Beispiel von TodoMVC demonstriert werden kann, damit es etwas zu vergleichen gibt.  Was mache ich in diesem Artikel? <br><br>  <a href="http://todomvc.com/" rel="nofollow">TodoMVC</a> , falls jemand es nicht weiß, ist dies eine solche Standard-UI- <a href="http://todomvc.com/" rel="nofollow">Aufrufwelt</a> , mit der Sie Lösungen für dasselbe Problem - die bedingte "To-Do-Liste" - unter Verwendung verschiedener Frameworks vergleichen können.  Die Aufgabe ist bei all ihrer Einfachheit (ihre <a href="https://dap.js.org/samples/todo.html" rel="nofollow">Lösung für Dap</a> Breaks "in einem Bildschirm") sehr anschaulich.  Ich werde daher anhand ihres Beispiels versuchen zu zeigen, wie die für ein Web-Frontend typischen Aufgaben mit dap umgesetzt werden. <br><br>  Ich habe die formale Beschreibung des Problems nicht gesucht und studiert, sondern mich dazu entschlossen, eines der Beispiele einfach umzukehren.  Das Backend für diesen Artikel ist für uns nicht interessant, daher schreiben wir es nicht selbst, sondern verwenden <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">eines der fertigen</a> von der Website <a href="https://www.todobackend.com/" rel="nofollow">www.todobackend.com</a> . Von dort nehmen wir <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">einen Beispielclient</a> und eine Standard- <a href="" rel="nofollow">CSS-Datei</a> . <br><br>  Um dap zu verwenden, müssen Sie nichts herunterladen und installieren.  Keine <code>npm install</code> und das ist alles.  Es ist nicht erforderlich, Projekte mit einer bestimmten Verzeichnisstruktur, Manifesten und anderen Attributen für den IT-Erfolg zu erstellen.  Genug Texteditor und Browser.  Zum Debuggen von XHR-Anforderungen benötigen Sie möglicherweise auch einen ausreichend einfachen Webserver, z. B. diese <a href="https://chrome.google.com/webstore/detail/web-server-for-chrome/ofhbbkphhbklhfoeikjpcbhemlocgigb" rel="nofollow">Erweiterung</a> für Chrome.  Unser gesamtes Frontend besteht aus einer einzigen .html-Datei (natürlich unter Bezugnahme auf das DAP-Engine-Skript und die Standard-TodoMVC-CSS-Datei). <br><br>  Also von Grund auf neu. <br><a name="habracut"></a><br><h2>  1. Erstellen Sie eine HTML-Datei </h2><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Todo -- dap sample<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://www.todobackend.com/client/css/vendor/todomvc-common.css"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://dap.js.org/0.4.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">//   dap </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Die übliche HTML-Vorbereitung, in der wir die CSS-Datei, die freundlicherweise von der Site <a href="https://www.todobackend.com/" rel="nofollow">www.todobackend.com</a> bereitgestellt wird, und die DAP-Engine, die ebenfalls freundlicherweise von der Site <a href="https://dap.js.org/" rel="nofollow">dap.js.org</a> bereitgestellt wird, <a href="https://dap.js.org/" rel="nofollow">enthalten</a> <br><br><h2>  2. Kopieren Sie die DOM-Struktur des ursprünglichen Beispiels </h2><br>  Um die Standard-CSS-Datei unverändert zu verwenden, wird dieselbe DOM-Struktur wie im <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">ursprünglichen Beispiel verwendet</a> .  Öffnen Sie es im Chrome-Browser, drücken Sie Strg + Umschalt + I, wählen Sie die Registerkarte "Elemente" und stellen Sie sicher, dass sich die Anwendung selbst im Elementabschnitt <code>section id="todo-app"&gt;</code> <br><br><img src="https://habrastorage.org/webt/3d/ks/mq/3dksmqoxzyif_tgnxfc3v-wf_us.png"><br><br>  Indem wir diesen Teilbaum einzeln öffnen, schreiben wir seine Struktur in unsere .html-Datei.  Jetzt skizzieren wir einfach auf schnelle Weise und schreiben keinen Code. Deshalb schreiben wir die Signaturen der Elemente einfach in einfache Anführungszeichen und in Klammern ihrer Kinder.  Wenn es keine Kinder gibt, zeichnen wir leere Klammern.  Wir überwachen die Indizes und das Gleichgewicht der Klammern. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   dap '#todoapp'( '#header'( 'H1'() 'INPUT#new-todo placeholder="What needs to be done?" autofocus'() ) '#main'( '#toggle-all type=checkbox'() 'UL#todo-list'( 'LI'( 'INPUT.toggle type=checkbox'() 'LABEL'() 'BUTTON.destroy'() ) ) ) '#footer'( '#todo-count'() 'UL#filters'( 'LI'() ) '#clear-completed'() ) )</span></span></code> </pre><br>  Hinweis: Wenn Sie Elemente wiederholen (hier sind es beispielsweise <code>LI</code> Elemente), schreiben Sie einmal in die Struktur, auch wenn das Original mehrere Elemente enthält.  Offensichtlich sind dies Arrays aus dem gleichen Muster. <br><br>  Ich denke, das Signaturformat ist für jeden verständlich, der HTML und CSS mit den Händen geschrieben hat, daher werde ich mich im Moment nicht näher damit befassen.  Ich kann nur sagen, dass Tags in GROSSBUCHSTABEN geschrieben sind und das Fehlen eines Tags dem Vorhandensein eines DIV-Tags entspricht.  Die Fülle von # -Elementen (mit id) ist hier auf die Besonderheiten der enthaltenen CSS-Datei zurückzuführen, die hauptsächlich id-Selektoren verwendet. <br><br><h2>  3. Denken Sie daran, dass das DAP-Programm Javascript ist </h2><br>  Um uns unnötige Klammern im Code zu ersparen, <code>String.prototype</code> Engine mehrere Methoden direkt in <code>String.prototype</code> (mir ist bewusst, dass die Implementierung Ihrer Methoden in Standardobjekten ein Problem ist, aber ... kurz gesagt, wir haben es bestanden), das die Signaturzeichenfolge in DAP konvertiert vorlage.  Eine solche Methode ist <code>.d(rule, ...children)</code> .  Das erste Argument, das es braucht, ist eine Generierungsregel ( <i>d-Regel</i> ), und der Rest der Argumente ist eine willkürliche Anzahl von untergeordneten Elementen. <br><br>  Basierend auf diesem neuen Wissen fügen wir unseren Code so hinzu, dass wir anstelle jeder öffnenden Klammer die Sequenz <code>.d(""</code> haben und vor jedem öffnenden einfachen Anführungszeichen, mit Ausnahme des allerersten, ein Komma steht. Life Hack: Sie können die automatische Ersetzung verwenden. <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#header'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'H1'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'INPUT#new-todo placeholder="What needs to be done?" autofocus'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#main'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#toggle-all type=checkbox'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'LABEL'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'BUTTON.destroy'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ) ) ,<span class="hljs-string"><span class="hljs-string">'#footer'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#todo-count'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#filters'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#clear-completed'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) )</code> </pre><br>  Voila!  Wir haben eine <code>.d</code> von Aufrufen für die <code>.d</code> Methode erhalten, die in eine DAP-Vorlage umgewandelt werden kann.  Die leeren Zeichenfolgen <code>""</code> sind die Keime zukünftiger D-Regeln, und die untergeordneten Zeichen sind durch Kommas getrennte Argumente.  Formal ist dies ein gültiges DAP-Programm, wenn auch noch nicht vollständig mit dem Auspuff, den wir brauchen.  Aber es kann schon gestartet werden!  <code>.RENDER()</code> Sie dazu nach der schließenden <code>.RENDER()</code> die <code>.RENDER()</code> Methode hinzu.  Diese Methode rendert, wie der Name schon sagt, die resultierende Vorlage. <br><br>  Zu diesem Zeitpunkt liegt also eine HTML-Datei mit folgendem Inhalt vor: <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Todo -- dap sample&lt;/title&gt; &lt;link rel="stylesheet" href="https://www.todobackend.com/client/css/vendor/todomvc-common.css"/&gt; &lt;script src="https://dap.js.org/0.4.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; '#todoapp'.d("" ,'#header'.d("" ,'H1'.d("") ,'INPUT#new-todo placeholder="What needs to be done?" autofocus'.d("") ) ,'#main'.d("" ,'#toggle-all type=checkbox'.d("") ,'UL#todo-list'.d("" ,'LI'.d("" ,'INPUT.toggle type=checkbox'.d("") ,'LABEL'.d("") ,'BUTTON.destroy'.d("") ) ) ) ,'#footer'.d("" ,'#todo-count'.d("") ,'UL#filters'.d("" ,'LI'.d("") ) ,'#clear-completed'.d("") ) ) .RENDER() //   dap   &lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre><br>  Sie können <a href="http://dap.js.org/samples/tutorial/3.html" rel="nofollow">es in einem Browser öffnen</a> , um sicherzustellen, dass DOM-Elemente generiert und CSS-Stile angewendet werden. Sie müssen diese Vorlage nur noch mit Daten füllen. <br><br><h2>  4. Holen Sie sich die Daten </h2><br>  Wir gehen zur <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">Originalseite</a> , öffnen die Registerkarte Netzwerk in den Tools, aktivieren den XHR-Filter und sehen, woher die Daten kommen und in welcher Form. <br><br><img src="https://habrastorage.org/webt/vf/ff/4l/vfff4lreh7nhj6jpgb8re83wb-s.png"><br><br><img src="https://habrastorage.org/webt/qi/lh/ga/qilhganpuhmmtevpnyuytm1uadu.png"><br><br>  Okay, okay.  Die <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">Aufgabenliste</a> wird direkt von <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">todo-backend-express.herokuapp.com</a> als <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">JSON-</a> Array von Objekten übernommen.  Großartig <br><br>  Um Daten zu empfangen, verfügt dap über einen eingebauten Konverter <code>:query</code> der die URL asynchron in die von ihm empfangenen Daten "konvertiert".  Wir werden die URL selbst nicht direkt in die Regel schreiben, sondern sie mit den konstanten <code>todos</code> .  Dann sieht das gesamte Data Mining-Design folgendermaßen aus: <br><br><pre> <code class="javascript hljs">todos:query</code> </pre><br>  und schreiben Sie die <code>todos</code> Konstante selbst in das Wörterbuch - im Abschnitt <code>.DICT</code> direkt vor <code>.RENDER()</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ... ) .DICT({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span> : <span class="hljs-string"><span class="hljs-string">"https://todo-backend-express.herokuapp.com/"</span></span> }) .RENDER()</code> </pre><br>  Nachdem wir das Array <code>todos</code> , erstellen wir daraus eine <code>.title</code> -Do-Liste: Für jeden Fall nehmen wir den Namen aus dem Feld <code>.title</code> und schreiben ihn in das Element <code>LABEL</code> , und aus dem Feld <code>.completed</code> nehmen <code>.completed</code> das Vorzeichen für „Vollständigkeit“ und schreiben in die Eigenschaft <code>checked</code> des <code>checked</code> <code>INPUT.toggle</code> .  Es ist so gemacht: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ todos:query"</span></span> <span class="hljs-comment"><span class="hljs-comment">//  *       ,'LI'.d("" ,'INPUT.toggle type=checkbox'.d("#.checked=.completed") // #  " " ,'LABEL'.d("! .title") //  !      ,'BUTTON.destroy'.d("") ) )</span></span></code> </pre><br>  Wir aktualisieren unsere Seite im Browser und ... wenn Sie sie vom Dateisystem aus starten, passiert nichts.  Das Problem ist, dass moderne Browser keine domänenübergreifenden XHR-Anforderungen aus lokalen Dokumenten zulassen. <br><br><img src="https://habrastorage.org/webt/tm/fy/bi/tmfybiqw7s2geblqodepfg7k7lk.png"><br><br>  Es ist Zeit, unsere Seite über http anzuschauen - mit einem beliebigen lokalen Webserver.  Nun, oder wenn Sie nicht bereit sind, DAP mit Ihren eigenen Händen zu schreiben, sehen Sie sich die aufeinander folgenden Versionen der Seite unter Verwendung meiner Links an (vergessen Sie nicht, den Quellcode zu betrachten - in Chrome geschieht dies mit Strg + U). <br><br>  Also <a href="http://dap.js.org/samples/tutorial/4.html" rel="nofollow">gehen</a> wir <a href="http://dap.js.org/samples/tutorial/4.html" rel="nofollow">zu unserer Seite unter http: //</a> und sehen, dass die Daten kommen und die Liste erstellt wird.  Großartig!  Sie haben die Operatoren <code>*</code> und bereits gemeistert <code>!</code>  , converter <code>:query</code> , Konstanten und Zugriff auf die Felder des aktuellen Array-Elements.  Schauen Sie sich den resultierenden Code noch einmal an.  Scheint es Ihnen immer noch unlesbar? <br><br><h2>  5. Zustand hinzufügen </h2><br>  Möglicherweise haben Sie bereits versucht, auf die Häkchen in der Aufgabenliste zu klicken.  Die Kontrollkästchen selbst ändern die Farbe, aber im Gegensatz zum Original ändert das übergeordnete <code>LI</code> Element seinen Stil nicht (der „erledigte Auftrag“ sollte grau und durchgestrichen sein, dies geschieht jedoch nicht) - die Dinge ändern ihren <i>Status nicht</i> .  Diese Elemente haben jedoch noch keinen Status und können ihn dementsprechend nicht ändern.  Jetzt werden wir es reparieren. <br><br>  Fügen Sie dem <code>LI</code> Element den Status "Abgeschlossen" hinzu.  Definieren Sie dazu in seiner D-Regel die <i>Variable</i> <code>$completed</code> <i>state</i> .  Dem <code>INPUT.toggle</code> , das diesen Status ändern kann, wird eine entsprechende Reaktionsregel ( <i>ui-rule</i> ) zugewiesen, mit der die Variable <code>$completed</code> entsprechend ihrem eigenen aktivierten Flag gesetzt wird ("daw ist eingeschaltet").  Abhängig vom Status von <code>$completed</code> aktiviert oder deaktiviert das <code>LI</code> Element die CSS-Klasse "completed". <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ todos:query"</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed"</span></span><span class="hljs-comment"><span class="hljs-comment">//  ,    .completed ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") //       .ui("$completed=#.checked") //    $completed ,'LABEL'.d("! .title") ,'BUTTON.destroy'.d("") ) .a("!? $completed") //     $completed,    css- completed )</span></span></code> </pre><br>  Solche Manipulationen mit CSS-Klassen sind ziemlich verbreitet, es gibt also einen speziellen Operator in dap für sie !? <br>  Bitte beachten Sie, dass wir dies in der <i>Regel</i> tun (ab dem Wort akkumulieren).  Warum nicht in der D-Regel?  Der Unterschied zwischen diesen beiden Regeltypen besteht darin, dass die d-Regel beim Aktualisieren den Inhalt des Elements vollständig neu erstellt und dabei den alten und den neuen Inhalt wieder löscht, während die a-Regel den vorhandenen Inhalt des Elements nicht berührt, sondern das Ergebnis an das anfügt, was bereits vorhanden ist.  Das Ändern eines einzelnen Attributs eines <code>LI</code> Elements erfordert keine Umstrukturierung des restlichen Inhalts. Daher ist es rationaler, dies in der Regel zu tun. <br><br>  Wir schauen uns das <a href="http://dap.js.org/samples/tutorial/5-1.html" rel="nofollow">Ergebnis an</a> .  Es ist schon besser: Wenn Sie auf die Kontrollkästchen klicken, ändert sich der Status des entsprechenden Aufgabenelements, und entsprechend ändert sich auch der visuelle Stil des Elements.  Es besteht jedoch weiterhin ein Problem: Wenn die Liste der abgeschlossenen Aufgaben ursprünglich vorhanden war, werden sie nicht grau angezeigt, da die a-Regel standardmäßig nicht ausgeführt wird, wenn das Element generiert wird.  Um es auch während der Generierung auszuführen, fügen wir den Operator <code>a!</code> Zur d-Regel des Elements <code>LI</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">//      $completed    a-</span></span></code> </pre><br>  <a href="http://dap.js.org/samples/tutorial/5-2.html" rel="nofollow">Wir schauen</a>  Ok  Mit dem Status von <code>$completed</code> herausgefunden.  Abgeschlossene Fälle werden sowohl beim ersten Systemstart als auch beim anschließenden manuellen Umschalten korrekt stilisiert. <br><br><h2>  6. Bearbeiten von Fallnamen </h2><br>  Zurück zum <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">Original</a> .  Durch Doppelklick auf den Namen des Falls wird der Bearbeitungsmodus aktiviert, in dem dieser Name geändert werden kann.  Dort wird es so implementiert, dass die Ansichtsmodusvorlage „Ansicht“ (mit einer Morgendämmerung, einem Titel und einer Löschschaltfläche) vollständig ausgeblendet wird und das Element <code>INPUT class="edit"</code> angezeigt wird.  Wir werden es etwas anders machen - wir werden nur das <code>LABEL</code> Element verbergen, da die anderen beiden Elemente unsere Bearbeitung nicht stören.  <code>LABEL</code> einfach die <code>view</code> zum <code>LABEL</code> Element hinzu. <br><br>  Definieren Sie für den Status "Bearbeitung" die Variable " <code>$editing</code> im <code>LI</code> Element.  Anfangs wird es (Zustand) zurückgesetzt, durch <code>dblclick</code> auf das <code>LABEL</code> Element <code>LABEL</code> und <code>LABEL</code> , wenn das <code>INPUT.edit</code> Element nicht mehr im Fokus steht.  Also schreiben wir: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing=; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">//       ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") .ui("$completed=#.checked") ,'LABEL.view' .d("? $editing:!; ! .title") //  $editing ,     .e("dblclick","$editing=`yes") //  dblclick  $editing ,'INPUT.edit' .d("? $editing; !! .title@value") //  $editing  .ui(".title=#.value") //  .title   change (ui     INPUT) .e("blur","$editing=") //  $editing   blur ,'BUTTON.destroy'.d("") ).a("!? $completed $editing") //   $completed  $editing  css-  'LI'</span></span></code> </pre><br>  Jetzt können wir die Namen der Fälle bearbeiten. <br><br><h2>  7. Senden von Daten an den Server </h2><br>  Ok, wir können bereits Dinge im Browser bearbeiten, aber diese Änderungen müssen auch auf den Server übertragen werden.  Wir schauen, wie das Original es macht: <br><br><img src="https://habrastorage.org/webt/jd/r5/bw/jdr5bwsa8yi7wu4sbwxqr3bwcdi.png"><br><br>  Die Änderungen werden mithilfe der PATCH-Methode mit einer bestimmten URL in der Form <code>http://todo-backend-express.herokuapp.com/28185</code> an den Server gesendet, die natürlich für jeden Fall eindeutig ist.  Diese URL wird vom Server im Feld <code>.url</code> für jeden Fall in der Liste angegeben.  Das heißt, wir müssen lediglich eine PATCH-Anforderung an die im Feld <code>.url</code> angegebene Adresse <code>.url</code> , und zwar mit den geänderten Daten im JSON-Format: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT.edit'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"? $editing; !! .title@value"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url (@Content-type`application/json)@headers (.title):json.encode@body):query"</span></span>) .e(<span class="hljs-string"><span class="hljs-string">"blur"</span></span>,<span class="hljs-string"><span class="hljs-string">"$editing="</span></span>)</code> </pre><br>  Hier verwenden wir den gleichen Konverter <code>:query</code> , jedoch in einer detaillierteren Version.  Wenn <code>:query</code> auf eine einfache Zeichenfolge angewendet wird, wird diese Zeichenfolge als URL behandelt und eine GET-Anforderung ausgeführt.  Wenn <code>:query</code> ein komplexes Objekt empfängt, wie in diesem Fall, wird es als detaillierte Beschreibung der Anfrage mit den Feldern <code>.method</code> , <code>.url</code> , <code>.headers</code> und <code>.body</code> und die Anfrage entsprechend ausgeführt.  Hier senden <code>.title</code> unmittelbar nach der Aktualisierung von <code>.title</code> eine PATCH-Anfrage mit diesem aktualisierten <code>.title</code> den Server <br><br>  Aber es gibt eine Nuance.  Wir bekommen das <code>.url</code> Feld vom Server, es sieht <code>.url</code> aus: <code>http://todo-backend-express.herokuapp.com/28185</code> , <code>.url</code> das http: // -Protokoll ist darin fest codiert, wenn unser Client auch über http: // geöffnet ist dann ist alles in ordnung.  Wenn der Client jedoch über https: // geöffnet ist, tritt ein Problem auf: Aus Sicherheitsgründen blockiert der Browser den http-Verkehr von der https-Quelle. <br><br>  Es ist einfach gelöst: Wenn Sie das Protokoll aus <code>.url</code> entfernen, <code>.url</code> die Anforderung das <code>.url</code> .  Also lasst es uns tun: Schreiben Sie den entsprechenden Konverter - <code>dehttp</code> , und wir werden <code>.url</code> durchlaufen.  Benutzerdefinierte Konverter (und andere Funktionen) werden im Abschnitt <code>.FUNC</code> : <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp (@Content-type`application/json)@headers (.title):json.encode@body):query"</span></span>) ... .FUNC({ <span class="hljs-attr"><span class="hljs-attr">convert</span></span>:{ <span class="hljs-comment"><span class="hljs-comment">//  -         dehhtp: url=&gt;url.replace(/^https?\:/,'')//    URL } })</span></span></code> </pre><br>  Es ist auch sinnvoll, das Header-Objekt in das Wörterbuch einzufügen, damit es in anderen Abfragen verwendet werden kann: <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp headers (.title):json.encode@body):query"</span></span>) ... .DICT({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span> : <span class="hljs-string"><span class="hljs-string">"//todo-backend-express.herokuapp.com/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: {<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>:<span class="hljs-string"><span class="hljs-string">"application/json"</span></span>} })</code> </pre><br>  Nun, für Full Feng Shui werden wir eine andere nützliche Eigenschaft des Konverters verwenden <code>:query</code> - automatische Codierung des Anforderungskörpers in json gemäß dem <code>Content-type:application/json</code> Header.  Infolgedessen sieht die Regel folgendermaßen aus: <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp headers (.title)):query"</span></span>)</code> </pre><br>  Also <a href="http://dap.js.org/samples/tutorial/7-2.html" rel="nofollow">schau</a> .  Okay, Fallnamen ändern sich jetzt nicht nur im Browser, sondern auch auf dem Server.  Aber!  Es kann sich nicht nur der Name des Falls ändern, sondern auch sein Fertigstellungsgrad - <code>completed</code> .  Es muss also auch an den Server gesendet werden. <br>  Sie können dieselbe PATCH-Anfrage zum <code>INPUT.toggle</code> Element hinzufügen. Senden <code>INPUT.toggle</code> einfach <code>(.completed)</code> anstelle von <code>(.completed)</code> : <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"#.checked=.completed"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">"$completed=#.checked; (@method`PATCH .url:dehttp headers (.completed:?)):query"</span></span>)</code> </pre><br>  Und Sie können diese PATCH-Anfrage "aus Klammern" setzen: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing= $patch=; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">// $patch - ""   ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") .ui("$patch=($completed=#.checked)") //   $patch  completed ,'LABEL.view' .d("? $editing:!; ! .title") .e("dblclick","$editing=`yes") ,'INPUT.edit' .d("? $editing; !! .title@value") .ui("$patch=(.title=#.value)") //   $patch  title .e("blur","$editing=") ,'BUTTON.destroy'.d("") ) .a("!? $completed $editing") //  $patch  ,   ,   .u("? $patch; (@method`PATCH .url:dehttp headers $patch@):query $patch=")</span></span></code> </pre><br>  Hier ist das Ding.  Reaktionsregeln gehören zur Gruppe der „Aufwärtsregeln“, die „von unten nach oben“ ausgeführt werden - vom Nachkommen zum übergeordneten Element bis zur Wurzel selbst (diese Sequenz kann bei Bedarf unterbrochen werden).  Dies ähnelt Popup-Ereignissen im DOM.  Daher können einige Fragmente der Reaktion, die mehreren Nachkommen gemeinsam sind, einem gemeinsamen Vorfahren zugeordnet werden. <br><br>  Insbesondere ist in unserem Fall der Vorteil einer solchen Delegierung nicht besonders bemerkbar. Wenn jedoch mehr bearbeitbare Felder vorhanden wären, würde es sehr hilfreich sein, diese umfangreiche Anforderung (natürlich nach DAP-Standards) in eine allgemeine Regel zu packen, um den Code einfach und lesbar zu halten.  Also ich empfehle es. <br><br>  <a href="http://dap.js.org/samples/tutorial/7-3.html" rel="nofollow">Wir schauen</a> : Nun werden sowohl Namensänderungen als auch Statusänderungen an den Server gesendet. <br><br>  Wenn Sie im nächsten Artikel interessiert sind, sollten Sie Fälle hinzufügen, entfernen und filtern.  In der Zwischenzeit können Sie das <a href="https://dap.js.org/samples/todo.html" rel="nofollow">Endergebnis</a> und andere Beispiele für <a href="https://dap.js.org/docs/" rel="nofollow">DAP-</a> Code unter <a href="https://dap.js.org/docs/" rel="nofollow">dap.js.org/docs sehen</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de480912/">https://habr.com/ru/post/de480912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de480900/index.html">Bring mein Baby zurück! (N.-F. Geschichte)</a></li>
<li><a href="../de480902/index.html">Neue Postgres_exporter PostgreSQL-Überwachungsfunktionen</a></li>
<li><a href="../de480904/index.html">PHP Microservice Framework: Entwicklungsumgebung für Swoft</a></li>
<li><a href="../de480906/index.html">Ein einfaches Python-Spiel schreiben</a></li>
<li><a href="../de480910/index.html">Erstellen einer grundlegenden Testklasse für Selentests und Initialisieren über JUnit RuleChain</a></li>
<li><a href="../de480914/index.html">Microservices für Einsteiger</a></li>
<li><a href="../de480918/index.html">Apache Hadoop Code Qualität: Produktion VS Test</a></li>
<li><a href="../de480920/index.html">Test von TP-Link Switches mit Long Range PoE. Und ein bisschen über Upgrades alter Modelle</a></li>
<li><a href="../de480922/index.html">Evgeny Usvitsky: „Jeder auf der Welt weiß, wo er Geodaten frei bekommen kann - nur in OSM“</a></li>
<li><a href="../de480924/index.html">Wie und warum haben die Macher des Remakes von MediEvil den Kult-Boss des Spiels neu gestaltet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>