<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔳 🤷 🐽 Wir stellen virtuelle Maschinen aus dem fälschlicherweise initialisierten Datenspeicher wieder her. Die Geschichte eines Unsinns mit Happy End 🤶🏿 👨‍👨‍👦 🙌🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Haftungsausschluss: Der Hinweis ist unterhaltsam. Die spezifische Dichte nützlicher Informationen ist gering. Es wurde "für sich selbst" geschrieben. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir stellen virtuelle Maschinen aus dem fälschlicherweise initialisierten Datenspeicher wieder her. Die Geschichte eines Unsinns mit Happy End</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452928/"><blockquote>  <b>Haftungsausschluss: Der</b> Hinweis ist unterhaltsam.  Die spezifische Dichte nützlicher Informationen ist gering.  Es wurde "für sich selbst" geschrieben. </blockquote><br><h3>  Lyrische Einführung </h3><br>  Der Dateidump in unserer Organisation dreht sich auf einer virtuellen VMware ESXi 6-Maschine unter Windows Server 2016. Dies ist nicht nur ein Dump.  Dies ist ein Dateifreigabeserver zwischen strukturellen Abteilungen: Es gibt Zusammenarbeit, Projektdokumentation und Ordner von Netzwerkscannern.  Im Allgemeinen ist dies das gesamte Produktionsleben. <br><br>  Und dieser Container des gesamten Produktionslebens begann zu hängen.  Darüber hinaus konnte sich der Gast ruhig aufhängen, ohne den Rest zu beeinträchtigen.  Könnte nach sich den ganzen Host und dementsprechend alle anderen Gastmaschinen hängen.  Ich könnte mich aufhängen und die vSphere-Clientdienste auflegen: Das heißt, die Prozesse der anderen Gäste sind aktiv, die Computer funktionieren ordnungsgemäß und reagieren, aber es liegt keine Dateibeschädigung vor und der vSphere-Client klammert sich nicht an den Host.  Im Allgemeinen konnte kein System identifiziert werden.  Während einer schwachen Last können tagsüber Hänge auftreten.  Könnte nachts bei Nulllast sein.  Könnte nachts während der Differenzialsicherung und bei mittlerer Last.  Könnte am Wochenende während einer vollständigen Sicherung und hoher Auslastung.  Und es gab eine deutliche Verschlechterung der Situation.  Zuerst war es einmal im Jahr, dann alle sechs Monate.  Am Ende meiner Geduld zweimal pro Woche. <br><a name="habracut"></a><br>  Ich habe für RAM gesündigt.  Aber ich durfte den Müll auch am Wochenende nicht aufhalten und Memtest wegfahren.  Wartete auf die Maiferien.  In den Maiferien fuhr ich von Memtest ab und ... es wurden keine Fehler gefunden. <br><br>  Ich war erstaunt und beschloss, in den Urlaub zu fahren.  Während ich im Urlaub war, hatte die Müllkippe keinen einzigen Hang.  Und als am Montag der erste Tag zur Arbeit ging, hing die Mülltonne.  Erhielt eine vollständige Sicherung und am Ende hing es.  Ein so warmes Treffen aus dem Urlaub brachte mich zu der Entscheidung, die Gästefahrt physisch zu einem anderen Gastgeber zu ziehen. <br><br>  Und obwohl seit langem bekannt ist, dass am ersten Tag nach einem Urlaub nichts Ernstes getan werden kann, obwohl ich mich auf die Arbeit vorbereitet habe, hat meine Empörung über den nächsten Frost meinen Verstand und meine Stimmung und meine Gelübde umgehauen ... <br><br>  Die physischen Festplatten wurden auf einen anderen Host umgestellt.  Heiße Verbindung.  Festplatten werden in den Speichereinstellungen auf der Registerkarte <i>Laufwerke</i> angezeigt.  Auf der Registerkarte Datenspeicher <i>ist der</i> Speicher auf diesen Laufwerken nicht.  <i>Aktualisieren</i> - wird nicht angezeigt.  Der erste Impuls ist natürlich " <i>Speicher hinzufügen"</i> .  Der Assistent zum Hinzufügen sagt Ihnen, was er unterstützt.  Natürlich unterstützt es auch VMFS.  Ich hatte keinen Zweifel.  Ein kurzer Blick auf die Assistentenmeldungen bei jedem Schritt: Weiter, Weiter, Weiter, Fertig stellen.  Sein Blick näherte sich nicht einmal einem kleinen gelben Kreis mit einem Ausrufezeichen am unteren Rand des Fensters einer der Stufen des Meisters. <br><br>  Am Ende des Assistenten wurde ein neuer Datenspeicher in der Liste angezeigt ... und damit Datenspeicher von anderen physischen Datenträgern. <br><br>  Ich gehe zur Navigation im neu hinzugefügten Datenspeicher über und er ist leer.  Natürlich war ich wieder erstaunt.  8 Uhr morgens, die ersten 15 Minuten bei der Arbeit nach den Ferien, selbst der Zucker im Kaffee wurde noch nicht gerührt.  Und hier ist es.  Mein erster Gedanke war, dass ich das falsche Laufwerk vom "nativen" Host gezogen habe.  Ich habe nachgesehen, ob der erforderliche Datenspeicher auf dem "nativen" Host vorhanden ist: Nein, nicht vorhanden.  Der zweite Gedanke war: "shit # b!".  Ich bin mir nicht sicher, aber es scheint mir, dass der dritte, vierte und mindestens fünfte Gedanke der gleiche war. <br><br>  Um Zweifel auszuräumen, installierte ich schnell ein neues ESXi auf dem Beispiel, nahm das linke Laufwerk und ging nach dem Lesen die Schritte des Assistenten durch.  Ja  Wenn Sie mit dem Assistenten einen Datenspeicher hinzufügen, gehen alle Daten auf der Festplatte verloren, ohne dass der Vorgang zurückgesetzt und Daten wiederhergestellt werden können.  Später las ich in einem der Foren eine Einschätzung eines solchen Entwurfs durch den Meister: Scheiß Mist.  Und im Moment stimmte ich wirklich zu. <br><br>  Ab dem sechsten flossen die Gedanken konstruktiver.  Okay.  Die Initialisierung dauert selbst bei einem 3-TB-Laufwerk nur wenige Sekunden.  Das ist also eine Formatierung auf hoher Ebene.  Die Partitionstabelle wurde also einfach neu geschrieben.  Die Daten sind also immer noch da.  Lassen Sie uns nun nach etwas Unformat und Voila suchen. <br><br>  Ich lade das Auto aus dem Boot-Image von Strelec ... und finde heraus, dass Partitionswiederherstellungsprogramme allen außer VMFS bekannt sind.  Beispielsweise kennen sie das Partitionslayout von Synology, VMFS jedoch nicht. <br><br>  Das Aufzählen von Programmen ist nicht beruhigend: GetDataBack und R.Saver finden bestenfalls NTFS-Partitionen mit Live-Verzeichnisstrukturen und Live-Dateinamen.  Aber das passt nicht zu mir.  Ich benötige zwei VMDK-Dateien: mit einer Systemfestplatte und einer Mülltonne. <br><br>  Und dann verstehe ich, dass ich anscheinend jetzt Windows installieren und die Dateisicherung beenden werde.  Gleichzeitig erinnere ich mich, dass ich dort eine DFS-Wurzel hatte.  Und auch ein völlig wildes Volumen und verzweigtes System von Zugriffsrechten auf die Ordner von Einheiten.  Keine Option.  Die einzige zeitlich akzeptable Option besteht darin, den Status des Systems und der Festplatte mit Daten und allen Rechten wiederherzustellen. <br><br>  Wieder googeln, Foren, KB'shki und wieder Yaroslavna weinen: VMware ESXi bietet keinen Datenwiederherstellungsmechanismus.  Alle Diskussionsthreads haben zwei Endspiele: Jemand, der mit Hilfe von nicht billigem DiskInternals VMFS Recovery wiederhergestellt wurde, oder jemand, der seine Dienste <i>mithilfe</i> von <i>vmfs-tools</i> aktiv <i>bewarb</i> und <i>dd</i> half.  Die Option zum Kauf einer DiskInternals VMFS Recovery-Lizenz für 700 US-Dollar ist keine Option.  Die Zulassung eines Außenstehenden aus dem „Gebiet eines potenziellen Gegners“ zu Unternehmensdaten ist ebenfalls keine Option.  Es wurde jedoch gegoogelt, dass VMFS-Partitionen auch UFS Explorer lesen können. <br><br><h3>  DiskInternals VMFS-Wiederherstellung </h3><br>  Die Testversion wurde heruntergeladen und installiert.  Das Programm hat erfolgreich einen leeren VMFS-Abschnitt gesehen: <br><br><img src="https://habrastorage.org/webt/yy/pe/po/yypepobhgib-ilpc2lratezxrhc.png" alt="Bild"><br><br>  Im <i>Undelete-</i> Modus <i>(Fast Scan) habe</i> ich auch einen schäbigen Datenspeicher mit Ordnern für virtuelle Maschinen mit darin enthaltenen Datenträgern gefunden: <br><br><img src="https://habrastorage.org/webt/jr/y8/sk/jry8skays28vnmrhzl8ot6jpfyu.png"><br><br>  Vorschau zeigte, dass die Dateien live sind: <br><br><img src="https://habrastorage.org/webt/tt/f1/eo/ttf1eoyfh-l0lsyfxcwcazss7dw.png"><br><br>  Das Mounten der Partition in das System war erfolgreich, aber aus irgendeinem Grund hatten alle drei Ordner dieselbe virtuelle Maschine.  Natürlich ist das Gesetz der Gemeinheit nicht erforderlich. <br><br><div class="spoiler">  <b class="spoiler_title">Drei Zeilen der Schande</b> <div class="spoiler_text">  Ein Versuch, die Software schamlos zu sperren, schlug fehl.  Der UFS Explorer war jedoch gesperrt. <br><br><blockquote>  Ich sehe Software-Diebstahl äußerst negativ.  In keinem Fall fordere ich die Verwendung einer Umgehung des Schutzes vor nicht lizenzierter Verwendung. <br></blockquote><br>  Ich befand mich in einer katastrophalen Situation und war überhaupt nicht stolz auf die Maßnahmen, die ich ergriffen hatte. <br></div></div><br><h3>  UFS Explorer </h3><br>  Das Scannen der Festplatte ergab das Vorhandensein von 7 Knoten.  Die Anzahl der Knoten stimmte auf „erstaunliche Weise“ mit der Anzahl der von VMFS Recovery erkannten * -flat.vmdk-Dateien überein: <br><br><img src="https://habrastorage.org/webt/nc/kh/m0/nckhm0xgc35ajd7hcmt9xbqgz6o.png"><br><br>  Ein Vergleich der Dateigrößen und Knotengrößen ergab auch eine Übereinstimmung bis zu Byte.  Gleichzeitig wurden die Namen der * -flat.vmdk-Dateien und entsprechend deren Zugehörigkeit zu virtuellen Maschinen wiederhergestellt. <br><br><img src="https://habrastorage.org/webt/ru/o2/jm/ruo2jmc33trnezku3qnqzt3n1yy.png"><br><br>  Aus Sicht von ESXi bestehen VMDK-Datenträger im Allgemeinen aus zwei Dateien: einer Datendatei (&lt;Computername&gt; -flat.vmdk) und einer Partitionierungsdatei für physische Datenträger (&lt;Computername&gt; .vmdk).  Wenn Sie die Datei * -flat.vmdk vom lokalen Computer in den Datenspeicher hochladen, erkennt ESXi sie nicht als gültige Datenträgerdatei.  In der VMware-Wissensdatenbank finden Sie einen Artikel zum manuellen Erstellen einer Datenträgerdeskriptordatei: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kb.vmware.com/s/article/1002511. Dies</a> war jedoch nicht <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erforderlich</a> . Ich habe lediglich den Inhalt der entsprechenden Dateien aus dem Vorschaubereich für den Dateiinhalt in DiskInternals VMFS Recovery kopiert :: <br><br><img src="https://habrastorage.org/webt/wa/ra/m3/waram3hzq42ow0zefbooy1vacqk.png"><br><br>  Nach 4 Stunden Entladen eines 2,5-TB-Knotens aus dem UFS Explorer und 20 Stunden Laden in den Datenspeicher-Hypervisor wurden die ausgefallenen Datenträgerdateien mit einer neu erstellten virtuellen Maschine verbunden.  Räder aufgenommen.  Es wurde kein Datenverlust festgestellt. <br><br><img src="https://habrastorage.org/webt/-p/nc/73/-pnc73v0yy5rcpghk4qan_fownw.jpeg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de452928/">https://habr.com/ru/post/de452928/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de452914/index.html">ML auf der Scala mit einem Lächeln für diejenigen, die keine Angst vor Experimenten haben</a></li>
<li><a href="../de452916/index.html">Steh auf und geh. Wirbelsäulenchirurgie: Wann, was ist gefährlich?</a></li>
<li><a href="../de452922/index.html">Flexible CSS-Rastertabellen</a></li>
<li><a href="../de452924/index.html">Was Sie tun müssen, um zu verhindern, dass Ihr Google-Konto gestohlen wird</a></li>
<li><a href="../de452926/index.html">Statische Tests oder Private Ryan speichern</a></li>
<li><a href="../de452938/index.html">Die Pistolen vom 3D-Drucker sind zurück und können jetzt nicht mehr gestoppt werden</a></li>
<li><a href="../de452942/index.html">GeekBrains hält 12 kostenlose Online-Meetings mit Programmierexperten ab</a></li>
<li><a href="../de452944/index.html">Was wird der "Dialog" von Linguisten und Datenanalysespezialisten sein?</a></li>
<li><a href="../de452946/index.html">Lou Greenaws „Windows 95 / NT-Programmierphilosophie“ erneut lesen</a></li>
<li><a href="../de452952/index.html">JetBrains Tag der offenen Tür in St. Petersburg</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>