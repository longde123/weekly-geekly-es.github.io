<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòù ‚òÄÔ∏è üë®üèæ‚Äçüåæ PPM-zu-USB-Adapter auf STM32F3Discovery oder Wir verbinden die Flugzeugmodellkonsole als HID-Joystick mit STM32Cube an den Computer üßõüèª ‚òïÔ∏è üë©üèø‚Äçü§ù‚Äçüë®üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel werde ich Ihnen sagen, wie:
 

- Erstellen Sie ein Projekt in STM32CubeMX und richten Sie Timer f√ºr die Erfassung externer Signale e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PPM-zu-USB-Adapter auf STM32F3Discovery oder Wir verbinden die Flugzeugmodellkonsole als HID-Joystick mit STM32Cube an den Computer</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/384813/"><img src="https://habrastorage.org/files/42a/e17/45b/42ae1745bcc442529f2839504fdf51f4.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Artikel werde ich Ihnen sagen, wie:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie ein Projekt in STM32CubeMX und richten Sie Timer f√ºr die Erfassung externer Signale ein. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dekodieren Sie ein PPM-Signal von einer Flugzeugmodellkonsole. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen Sie ein Human Interface Device auf STM32 und schreiben Sie Ihren HID Report Descriptor. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fliegen Sie in einem Simulator auf einem Renn-Quadrocopter. </font><font style="vertical-align: inherit;">:) :)</font></font></li>
</ul><a name="habracut"></a><br>
<h3><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vorwort</font></font></b></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In letzter Zeit werden FPV-Rennen auf Quadrocoptern der 250. Klasse (FPV - First Person View) immer beliebter. </font><font style="vertical-align: inherit;">Die Zahl 250 bedeutet den Abstand zwischen den Achsen der Motoren diagonal, typisch f√ºr kleine wendige Hubschrauber. </font><font style="vertical-align: inherit;">Solche Ger√§te basieren auf langlebigen Carbonrahmen, die St√ºrzen und Kollisionen standhalten. </font><font style="vertical-align: inherit;">Propeller mit einem Durchmesser von 5 bis 6 Zoll mit einer gro√üen Stufe (Neigungswinkel der Bl√§tter) werden f√ºr einen dynamischsten Flug auf leistungsstarke Motoren gesetzt. </font><font style="vertical-align: inherit;">Das Bild vom analogen Steuerkurs-Camcorder wird mit einer Frequenz von 5,8 GHz an den Monitor oder die Videobrille des Piloten √ºbertragen. </font><font style="vertical-align: inherit;">Da die digitale √úbertragung √ºber WLAN eine lange Verz√∂gerung (200-300 ms) verursacht, wird das Video immer auf einem analogen Kanal √ºbertragen. </font><font style="vertical-align: inherit;">Um spektakul√§re Clips aufzunehmen, sind Action-Kameras an Bord (GoPro, Mobius, SJcam, Xiaomi Yi usw.).</font></font><br>
<br>
<div style="text-align:center;"><img width="40%" src="https://habrastorage.org/files/727/722/0e5/7277220e5a8c4b749415d16d28091648.jpg"></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier sind einige spannende Videos √ºber FPV-Copter:</font></font></b><div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/NsxyV-kgfio%3Ffeature%3Doembed&amp;usg=ALkJrhjH8aiwaSmVTYGYgCaRB0ji60JarA" frameborder="0" allowfullscreen=""></iframe><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/1MBW8zoZUR4%3Ffeature%3Doembed&amp;usg=ALkJrhiD55e8SUVSufNtMUpizVJag1J69A" frameborder="0" allowfullscreen=""></iframe><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/70pusNNunMA%3Ffeature%3Doembed&amp;usg=ALkJrhgUEnjYo98UxzPfQU_8rFvVDD64Vg" frameborder="0" allowfullscreen=""></iframe></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor ich meinen Mini-Quadrocopter baute, wollte ich in einem Simulator fliegen und sehen, ob ich an FPV-Rennen interessiert w√§re. F√ºr das Training ist der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FPV FreeRider-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Simulator gut geeignet </font><font style="vertical-align: inherit;">. Es ist kosteng√ºnstig, hat eine kostenlose Demoversion und ahmt nach Ansicht erfahrener Piloten die wahre Flugmechanik sehr genau nach.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sie k√∂nnen das Flugzeug im Simulator √ºber die Tastatur oder den Joystick steuern. Die Tastatur ist f√ºr die Steuerung schlecht geeignet, da die Tasten nur einen diskreten Wert √ºbertragen k√∂nnen (die Taste wird gedr√ºckt / nicht gedr√ºckt) und es unm√∂glich ist, gleichm√§√üig variierende Zwischenwerte zu √ºbertragen. Joysticks von Spielekonsolen mit analogen Sticks sind viel besser, aber sie haben einen sehr kleinen Stick, mit dem Sie das Ger√§t nicht genau genug steuern k√∂nnen. Eine ideale Option f√ºr einen Simulator ist eine Flugzeugmodellkonsole, die √ºber einen speziellen Adapter mit einem Computer verbunden ist, dank dessen das Betriebssystem sie als Joystick betrachtet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich hatte bereits einen Quadrocopter, der f√ºr gem√§chliche Fl√ºge und Fotografie zusammengestellt war, aber zu gro√ü und schwer f√ºr Rennen. Dementsprechend gab es eine Fernbedienung - Turnigy 9X (in der ersten Abbildung). Auf der R√ºckseite befindet sich ein Anschluss zum Anschlie√üen eines Adapters, an den ein PPM-Signal ausgegeben wird. Dieses Signal ist ein kurzer Impuls mit Intervallen von 1 bis 2 Millisekunden, deren Dauer der Position der Bedienelemente entspricht (mehr dazu im Abschnitt zur Decodierung).</font></font><br>
<br>
<div style="text-align:center;"><img width="33%" src="https://habrastorage.org/files/68b/cc1/4f0/68bcc14f02164d51a17401da82253df4.jpg"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich muss sagen, dass die Adapter zum Anschlie√üen der Fernbedienung von PPM an USB schon lange freigegeben sind und mit Macht und Kraft verkauft werden. </font><font style="vertical-align: inherit;">Ein √§hnlicher Adapter im Formfaktor des Flash-Laufwerks kann in China f√ºr 5 USD oder in russischen Gesch√§ften etwas teurer gekauft werden. </font><font style="vertical-align: inherit;">Es gibt auch </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Open-Source-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adapterprojekte auf AVR-Controllern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aber am sp√§ten Abend, als alle Moskauer Flugzeugmodelll√§den bereits geschlossen waren, kam mir sofort der akute Wunsch zu fliegen. </font><font style="vertical-align: inherit;">Ich wollte morgens nicht warten, es gab keine Zeit, die Platine mit ATmega zu vergiften und zu l√∂ten, und so entschied ich mich, einen PPM-USB-Adapter auf der STM32F3Discovery-Platine herzustellen, die lange Zeit im Leerlauf war und gerade zur Hand war.</font></font><br>
<br>
<h3><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was ist notwendig</font></font></b></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um einen Adapter herzustellen, ben√∂tigen Sie:</font></font><br>
<br>
<ul>
<li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">STM32F3Discovery</a>.     STM32,     USB,   . </li>
<li>  c - 3,5     ( Turnigy)   BLS-,   ,   ( Discovery).</li>
<li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">STM32CubeMX</a>. </li>
<li>IDE    ARM.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Keil uVision 5</a>.          32 ,      .</li>
<li> Turnigy 9X     PPM-.       FlySky FS-i6.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Discovery-Debug-Boards sind ziemlich teuer. </font><font style="vertical-align: inherit;">Der beschriebene F3 kostet ungef√§hr 20 US-Dollar und seine Funktionen sind f√ºr ein so einfaches Projekt √ºberfl√ºssig. </font><font style="vertical-align: inherit;">Ich habe es benutzt, weil dies zum Zeitpunkt des Schreibens das einzige Board mit Hardware-USB war, das ich zu Hause gefunden habe. </font><font style="vertical-align: inherit;">F√ºr diejenigen, die es noch nicht gekauft haben, kann ich Ihnen raten, auf Miniaturkarten mit dem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STM32F103C8T6-</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Controller </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">von AliExpress f√ºr 3 US-Dollar</font></a><font style="vertical-align: inherit;"> und dem ST-Link-Programmierer von dort </font><font style="vertical-align: inherit;">zu achten </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Der Prozess unterscheidet sich nicht von dem im Artikel beschriebenen. </font><font style="vertical-align: inherit;">Wenn zu Beginn kein anderer Regler ausgew√§hlt werden muss, weisen Sie auf das Vorhandensein eines Quarzresonators hin und verwenden Sie eine etwas andere Pinbelegung.</font></font><br>
<br>
<div style="text-align:center;"><img width="30%" src="https://habrastorage.org/files/cf1/88d/0a1/cf188d0a1da94acfb233350ff94830ae.jpg"></div><br>
<br>
<a name="cube"></a><h3><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstellen eines Projekts in STM32CubeMX</font></font></b></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
STM32Cube ist ein Paket, das von STMicroelectronics entwickelt wurde, um STM32-Ger√§teentwicklern das Leben zu erleichtern. Es besteht aus dem CubeMX-Grafikdienstprogramm, HAL-Treibern und Middleware-Komponenten. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CubeMX</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein Tool zum Erstellen von Projekten und Initialisieren von Peripherieger√§ten. W√§hlen Sie einfach die Steuerung aus, aktivieren Sie die Kontrollk√§stchen f√ºr die erforderlichen Module, w√§hlen Sie die erforderlichen Modi im Men√º aus und geben Sie die gew√ºnschten Werte in mehrere Felder ein. CubeMX generiert das Projekt und verbindet die erforderlichen Bibliotheken damit. Der Entwickler des Ger√§ts schreibt nur die Logik der Anwendung. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL-Fahrer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Hardware Abstraction Layer) sind eine API f√ºr die Arbeit mit Modulen und Peripherieger√§ten des Mikrocontrollers. Mit HAL k√∂nnen Sie die oberste Ebene der vom Entwickler erstellten Anwendung von der Arbeit mit Registern trennen und den Programmcode zwischen den STM32-Controller-Familien so portabel wie m√∂glich gestalten. </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zu den Middlewares</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oder Zwischenkomponenten geh√∂ren das FreeRTOS-Betriebssystem, eine Bibliothek zum Arbeiten mit dem Dateisystem, USB-Bibliotheken, TCP / IP usw.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es scheint, dass es jetzt m√∂glich ist, "mit der Maus zu programmieren", anstatt manuell Bits in Register zu schreiben. </font><font style="vertical-align: inherit;">Einfachheit und Bequemlichkeit heben jedoch nicht die Tatsache auf, dass Sie die Dokumentation studieren m√ºssen, insbesondere in F√§llen, in denen Sie die maximale Geschwindigkeit, den minimalen Stromverbrauch oder die Verwendung von Peripherieger√§ten in nicht standardm√§√üigen Modi reduzieren m√ºssen. </font><font style="vertical-align: inherit;">STM32Cube deckt noch nicht 100% aller Funktionen des Mikrocontrollers ab, n√§hert sich jedoch diesem. </font><font style="vertical-align: inherit;">STMicroelectronics aktualisiert Cube von Zeit zu Zeit, erweitert Funktionen und behebt Fehler. </font><font style="vertical-align: inherit;">Wenn Sie Cube bereits installiert haben, √ºberpr√ºfen Sie daher, ob es sich um die neueste Version handelt.</font></font><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grundeinstellungen</font></font></b></h5><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/acf/6b2/4fc/acf6b24fc6c449f58c2be3b9ce9d1c1e.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Arbeit mit dem Projekt beginnt mit der Wahl des Controllers. Starten Sie STM32CubeMX und klicken Sie auf </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Neues Projekt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Auf der Registerkarte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MCU-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Auswahl k√∂nnen Sie den gew√ºnschten Controller aus den Filtern ausw√§hlen. Da wir ein fertiges Debug-Board haben, </font><font style="vertical-align: inherit;">finden wir </font><font style="vertical-align: inherit;">auf der Registerkarte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Board Selector </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STM32F3Discovery</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nach Auswahl einer Karte wird ein Bild des Controllers mit hervorgehobenen und signierten Pins angezeigt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im oberen Teil des Fensters befinden sich vier gro√üe Registerkarten: </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pinbelegung</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - zum Konfigurieren der Pin-Funktionen und zum Voreinstellen von Modulen. Wir sind gerade dabei. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uhrenkonfiguration</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Uhreinstellung, PLL, Teiler. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfiguration</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Detailliertere Konfiguration von Peripherieger√§ten und Middleware.</font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stromverbrauchsrechner</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Berechnung des vom Mikrocontroller verbrauchten Stroms. </font></font><br>
<br>
<img src="https://habrastorage.org/files/d02/a54/3a7/d02a543a7fe148d99d67ae83ad6a8fc9.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im linken Men√º auf der Registerkarte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pinbelegung</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> k√∂nnen </font><i><font style="vertical-align: inherit;">Sie</font></i><font style="vertical-align: inherit;"> die gew√ºnschten Peripherieger√§te verwenden und </font><font style="vertical-align: inherit;">auf der </font><i><font style="vertical-align: inherit;">Steuerschaltung</font></i><font style="vertical-align: inherit;"> eine Funktion f√ºr einen der Ausg√§nge des Mikrocontrollers ausw√§hlen. Einige Elemente auf der linken Seite sind Warnsymbole. Dies bedeutet, dass die Module (in diesem Fall ADC, DAC, OPAMP2, RTC) jetzt unvollst√§ndig verwendet werden k√∂nnen, da einige ihrer Ausg√§nge bereits von anderen Funktionen belegt sind.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Konfigurierte Pins werden in der Steuerschaltung gr√ºn hervorgehoben. </font><font style="vertical-align: inherit;">Da wir uns nicht f√ºr einen nackten Controller ohne Umreifung entschieden haben, sondern f√ºr eine vorgefertigte F3-Discovery-Debugging-Karte, sind einige der Ausg√§nge bereits konfiguriert, z. B. ist eine blaue Taste an PA0 und LEDs an PE8 ... 15 angeschlossen. </font><font style="vertical-align: inherit;">Die Pins, an die einige externe Ger√§te in Discovery angeschlossen sind, werden orange hervorgehoben, aber die Peripheriemodule f√ºr sie wurden noch nicht konfiguriert. </font><font style="vertical-align: inherit;">Wie Sie sehen k√∂nnen, sind dies Pins f√ºr USB, Quarzresonatoren, SPI und I2C f√ºr Gyroskop und Kompass, DP und DM f√ºr USB. </font><font style="vertical-align: inherit;">Graue Schlussfolgerungen werden derzeit nicht verwendet, keine davon k√∂nnen wir f√ºr unsere Zwecke anwenden.</font></font><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eingangsauswahl</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden die Dauer der Impulse erfassen, daher muss der Eingang mit einem der Kan√§le eines beliebigen Timers verbunden sein. </font><font style="vertical-align: inherit;">Au√üerdem betr√§gt der Signalpegel bei Turnigy 9X nicht 3,3 V wie die Versorgungsspannung des STM32, sondern 5 V. </font><font style="vertical-align: inherit;">Wir sind zu faul, um den Spannungsteiler zu l√∂ten, daher m√ºssen Sie einen Eingang w√§hlen, der 5 V standh√§lt (diese Eing√§nge werden als 5 V-tolerant bezeichnet). </font><font style="vertical-align: inherit;">Geeignete Pins finden Sie im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Datenblatt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu STM32F303VCT6 im Abschnitt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pinbelegung und Pinbeschreibung</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es gibt viele Timer im STM32F3, die √ºber fast alle Pins verteilt sind. </font><font style="vertical-align: inherit;">Eine bequeme Option ist PC6. </font><font style="vertical-align: inherit;">Es kann 5 Volt standhalten und befindet sich in der unteren linken Ecke der Platine neben GND. </font><font style="vertical-align: inherit;">Weisen Sie diesem Pin den 1. Kanal des 3. Timers TIM3_CH1 zu.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/eb7/4b2/67e/eb74b267e70140b9842408158de617e8.png"></div><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uhreinstellung</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Damit der USB funktioniert, muss der Mikrocontroller mit einer sehr stabilen Frequenz getaktet werden, weshalb fast alle USB-Ger√§te √ºber Quarzresonatoren verf√ºgen. Die Frequenzstabilit√§t des eingebauten RC-Generators reicht f√ºr USB nicht aus. Aber auf dem STM32F3 Discovery Board waren Entwickler aus irgendeinem Grund gierig und haben keinen Quarz eingesetzt. Wenn Sie jedoch die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schaltung</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sorgf√§ltig untersuchen </font><font style="vertical-align: inherit;">, k√∂nnen Sie feststellen, dass das </font><i><font style="vertical-align: inherit;">MCO-</font></i><font style="vertical-align: inherit;"> Signal </font><font style="vertical-align: inherit;">an den Eingang </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PF0-OSC_IN angeschlossen ist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , an den der Quarz angeschlossen werden soll </font><font style="vertical-align: inherit;">. Es kommt vom ST-Link-Programmierer auf derselben Platine, auf der sich Quarz befindet. Das </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Benutzerhandbuch</font></a><font style="vertical-align: inherit;"> f√ºr F3 Discovery (UM1570) im Abschnitt </font><i><font style="vertical-align: inherit;">OSC Clock</font></i><font style="vertical-align: inherit;"> besagt, dass 8 MHz an diese Leitung </font><font style="vertical-align: inherit;">gesendet </font><font style="vertical-align: inherit;">werden.</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br>
<br>
<img width="30%" src="https://habrastorage.org/files/b5c/234/80f/b5c23480ffca498d8e52e6fef4c0892f.png"><img width="65%" src="https://habrastorage.org/files/c00/160/fb8/c00160fb809b4c7190390d8a8ccd3ac6.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Somit wird der Mikrocontroller von einer externen Quelle getaktet. Dieser Modus wird als Bypass bezeichnet. </font><i><font style="vertical-align: inherit;">W√§hlen Sie</font></i><font style="vertical-align: inherit;"> im Peripherie-Einstellungsmen√º im Abschnitt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RCC</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zum Takten der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hochgeschwindigkeitsuhr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Option BYPASS-Taktquelle aus</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img src="https://habrastorage.org/files/934/7e5/17e/9347e517e21540a88c922d35d881c009.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor wir zu einer detaillierteren Uhreinstellung √ºbergehen, stellen wir im Peripheriemen√º fest, dass der Mikrocontroller als USB-Ger√§t fungiert. </font></font><br>
<br>
<img src="https://habrastorage.org/files/597/c20/ddb/597c20ddbe2e4c2898c90db97110e454.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt k√∂nnen Sie zur n√§chsten gro√üen Registerkarte wechseln - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uhrenkonfiguration</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Hier sehen wir ein riesiges Diagramm, das zeigt, welche Taktsignale im Mikrocontroller vorhanden sind, woher sie kommen, wie sie sich verzweigen, multiplizieren und teilen. In gelb habe ich die Parameter hervorgehoben, die beachtet werden sollten. </font></font><br>
<br>
<img src="https://habrastorage.org/files/1a5/9a8/596/1a59a8596d434c1f8d09ee5e8335adee.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√úberpr√ºfen Sie die Eingangsfrequenz</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Eingangsfrequenz</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> betr√§gt 8 MHz. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir stellen den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PLL Source Mux-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Schalter </font><font style="vertical-align: inherit;">auf </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HSE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (High Speed ‚Äã‚ÄãExternal), um von einer externen Quelle anstatt von einer internen Quelle zu takten. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PLL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Phase Lock Loop oder PLL - Phase Locked Loop dient dazu, die externe Frequenz mehrmals zu multiplizieren. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stellen Sie den PLLMul-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Multiplikator </font><font style="vertical-align: inherit;">auf 9. Dann erreichen wir die maximal m√∂gliche Frequenz f√ºr den STM32F303 - 72 MHz. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der System Clock Mux</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> muss sich in der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PLLCLK-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Position befinden, </font><i><font style="vertical-align: inherit;">damit</font></i><font style="vertical-align: inherit;"> die Taktfrequenz mit der PLL multipliziert wird. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr das USB-Modul werden 48 MHz ben√∂tigt. Stellen Sie daher einen 1,5-Teiler vor USB. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Achten Sie auf die Frequenz</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der APB1-Timer taktet</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> auf der linken Seite der Schaltung. </font><font style="vertical-align: inherit;">Es geht an die Timer und ist f√ºr uns in Zukunft n√ºtzlich. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn eine Frequenz falsch konfiguriert ist, den maximal m√∂glichen Wert √ºberschreitet oder sich die Schalter in einer ung√ºltigen Position befinden, hebt CubeMX diese Stelle rot hervor.</font></font><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Timer-Einstellung</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Pulsdauer zu messen, starten wir den TIM3-Timer im Input Capture-Modus. Im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Referenzhandbuch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> finden Sie im Abschnitt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allzweck-Timer (TIM2 / TIM3 / TIM4)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ein Diagramm, das die Funktionsweise von Timern veranschaulicht. Mit Farben habe ich die im Input Capture-Modus verwendeten Signale und Register hervorgehoben. </font></font><br>
<br>
<img src="https://habrastorage.org/files/e76/54c/ea5/e7654cea52cb46c891e5a73e91068b71.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das gr√ºn hervorgehobene Taktsignal tritt kontinuierlich in das CNT-Z√§hlerregister ein und erh√∂ht seinen Wert bei jedem Taktzyklus um 1. Im </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prescaler PSC-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Teiler kann die </font><font style="vertical-align: inherit;">Taktfrequenz f√ºr eine langsamere Z√§hlung abnehmen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein </font><font style="vertical-align: inherit;">externes Signal wird </font><font style="vertical-align: inherit;">in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TIMx_CH1 eingegeben</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kantendetektor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es erkennt Flanken des Eingangssignals - √úberg√§nge von 0 nach 1 oder von 1 nach 0. Bei der Registrierung einer Front werden zwei gelb hervorgehobene Befehle ausgegeben: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Ein Befehl zum Schreiben des Werts des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CNT-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Z√§hlers </font><font style="vertical-align: inherit;">in das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Register Register Capture / Compare 1 (CCR1)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und Aufruf des </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CC1I-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Interrupts </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Ein Befehl f√ºr den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slave-Modus-Controller</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mit dem der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CNT-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wert </font><font style="vertical-align: inherit;">auf 0 zur√ºckgesetzt wird und der Countdown erneut startet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist eine Illustration des Prozesses in einer Zeitleiste:</font></font><br>
<br>
<img width="50%" src="https://habrastorage.org/files/3b5/80b/ab0/3b580bab0b894981b8d28eadd9f444b2.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn ein Interrupt auftritt, f√ºhren wir Aktionen mit dem erfassten Wert aus. Wenn die Eingangsimpulse zu oft auftreten und die im Interrupt-Handler auftretenden Aktionen zu lang sind, kann der Wert von CCR1 √ºberschrieben werden, bevor der vorherige gelesen wird. In diesem Fall m√ºssen Sie das Overcapture-Flag aktivieren oder DMA (Direct Memory Access) anwenden, wenn die Daten von CCR1 das vorbereitete Array automatisch in den Speicher f√ºllen. In unserem Fall hat der k√ºrzeste Impuls eine Dauer von 1 Millisekunde, und der Interrupt-Handler ist einfach und kurz. Machen Sie sich also keine Sorgen √ºber das √úberschreiben. </font><i><font style="vertical-align: inherit;">Kehren Sie zur</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Registerkarte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pinbelegung zur√ºck</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und stellen Sie den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TIM3-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Timer </font><font style="vertical-align: inherit;">im Men√º </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peripherieger√§te</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ein </font><font style="vertical-align: inherit;">. </font></font><br>
<br>
<img src="https://habrastorage.org/files/437/703/50b/43770350badf4efcb4d02a11ea2f9db0.png"><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slave-Modus: Reset-Modus</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- bedeutet, dass in einem bestimmten Fall der Timer auf 0 zur√ºckgesetzt wird. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Triggerquelle: TI1FP1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Das Ereignis, das zum Zur√ºcksetzen und Starten des Timers verwendet wird, ist die vom TI1-Eingang erfasste Signalflanke. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClockSource: Interne Uhr</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Der Timer wird vom internen Generator des Mikrocontrollers getaktet. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kanal 1: Input Capture Direct-Modus</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Erfassungsintervalle vom 1. Kanal im CCR1-Register. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der n√§chsten gro√üen Registerkarte " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfiguration" nehmen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir </font><font style="vertical-align: inherit;">zus√§tzliche Timer-Einstellungen vor.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/db8/b67/8d8/db8b678d8f7846c9af081a0bfdb0d7b1.png"></div><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/63b/6ac/c06/63b6acc06716451399d01566635d2f87.png"></div><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prescaler</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein Timer-Teiler. Wenn es 0 ist, wird die Frequenz direkt vom Taktbus APB Takt - 72 MHz genommen. Wenn der Vorteiler 1 ist, wird die Frequenz durch 2 geteilt und wird zu 36 MHz. Stellen Sie den Divisor auf 71 ein, so dass die Frequenz durch 72 geteilt wird. Dann betr√§gt die Timerfrequenz 1 MHz und die Intervalle werden mit einer Aufl√∂sung von 1 Mikrosekunde gemessen. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z√§hler Perioden</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - stellen Sie </font><font style="vertical-align: inherit;">den maximal m√∂glichen 16-Bit - </font><font style="vertical-align: inherit;">Wert 0xFFFF. Die Periode ist wichtig f√ºr die Erzeugung von Zeitschlitzen, beispielsweise f√ºr PWM. Die Periode ist jedoch f√ºr die Erfassung von Signalen nicht wichtig, wir werden bekannt geben, dass sie f√ºr alle Eingangsimpulse gro√ü ist. </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Polarit√§tsauswahl: Fallende</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Flanke - Timer-Werte werden an der fallenden Flanke des Eingangssignals erfasst. </font><i><font style="vertical-align: inherit;">Setzen Sie auf der</font></i></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Registerkarte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NVIC-Einstellungen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine Morgend√§mmerung</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Globaler TIM3-Interrupt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sodass Ereignisse, die sich auf den 3. Timer beziehen, einen Interrupt erzeugen.</font></font><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USB-Ger√§te-Setup</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben bereits festgestellt, dass der Controller ein USB-Ger√§t sein wird. </font><font style="vertical-align: inherit;">Da der Joystick zur Klasse der HID-Ger√§te geh√∂rt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> w√§hlen </font><i><font style="vertical-align: inherit;">Sie im Men√º Middlewares -&gt; USB_DEVICE die Option </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Class For FS IP: Human Interface Device Class (HID)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Anschlie√üend verbindet CubeMX Bibliotheken f√ºr das HID-Ger√§t mit dem Projekt. </font></font><br>
<br>
<img src="https://habrastorage.org/files/3fe/080/472/3fe0804729bd4b2f995c5f32a9173d47.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gehen wir zu den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USB_DEVICE-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Einstellungen </font><font style="vertical-align: inherit;">auf der Registerkarte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfiguration</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> im Abschnitt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Middlewares</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/574/ba7/dde/574ba7dde3794ce4911f955e628f7ce7.png"></div><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hersteller-ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Produkt-ID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sind zwei 16-Bit-Kennungen, die f√ºr jedes Modell eines USB-Ger√§ts eindeutig sind. VID entspricht dem Ger√§tehersteller, und jeder Hersteller weist PID zu, basierend auf seinen eigenen √úberlegungen. Ich konnte die offizielle Liste von VID und PID nicht finden, sondern nur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">die</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von Enthusiasten unterst√ºtzte </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Identifikatorbasis</font></a><font style="vertical-align: inherit;"> . Um Ihre eigene Vendor ID zu erhalten, m√ºssen Sie das USB Implementers Forum auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usb.org besuchen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und ein paar tausend Dollar bezahlen. Kleine Unternehmen oder Open-Source-Entwickler, die sich ihre VID nicht leisten k√∂nnen, k√∂nnen einen USB-Chip-Hersteller anfordern und offiziell ein VID / PID-Paar f√ºr ihr Projekt erhalten. Ein solcher Service wird beispielsweise von FTDI oder Silicon Laboratories angeboten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Sie zwei Ger√§te mit derselben VID / PID verbinden, jedoch von einem anderen Typ (z. B. eines ist ein HID-Ger√§t und das andere ist Massenspeicher), versucht das Betriebssystem, denselben Treiber f√ºr sie und mindestens eines davon zu installieren wird nicht funktionieren. Aus diesem Grund m√ºssen VID / PID-Paare f√ºr verschiedene Ger√§temodelle eindeutig sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da wir kein Ger√§t f√ºr uns selbst herstellen, werden wir es nicht verkaufen und vertreiben. Wir werden die VID 0x0483, die STMicroelectronics entspricht, verlassen und unsere eigene PID entwickeln. Standardm√§√üig bietet CubeMX die PID 0x5710 f√ºr das HID-Ger√§t an. Ersetzen Sie es beispielsweise durch 0x57FF. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ersetzen Sie die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Produktzeichenfolge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> durch den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STM32 PPM-USB-Adapter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dieser Name wird in der Liste der Ger√§te in der Windows-Systemsteuerung angezeigt. Wir werden die Seriennummer (S \ N) noch nicht √§ndern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn Windows erkennt, dass es ein Ger√§t mit einer Kombination aus VID, PID und S \ N erkennt, die es zuvor noch nicht gesehen hat, installiert das System den entsprechenden Treiber daf√ºr. Wenn die Kombination aus VID, PID und S \ N bereits verwendet wurde, ersetzt Windows automatisch den zuvor verwendeten Treiber. Sie k√∂nnen dies beispielsweise sehen, wenn Sie das Flash-Laufwerk an USB anschlie√üen. Das erste Anschlie√üen und Installieren dauert einige Zeit. Bei nachfolgenden Verbindungen beginnt das Laufwerk fast sofort zu arbeiten. Wenn Sie jedoch eine andere Instanz des Flash-Laufwerks desselben Modells mit einer anderen Seriennummer anschlie√üen, installiert das System einen neuen Treiber daf√ºr, obwohl es dieselbe VID und PID hat.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde erkl√§ren, warum dies wichtig ist. </font><font style="vertical-align: inherit;">Wenn Sie auf Ihrem STM32 eine USB-Maus mit Ihrer VID, PID und S \ N erstellt, diese an den Computer angeschlossen und dann einen USB-Joystick erstellt haben, ohne die VID, PID und S \ N zu √§ndern, erkennt Windows das neue Ger√§t als eine Maus, die bereits vorhanden ist wird im System verwendet und installiert den Joystick-Treiber nicht. </font><font style="vertical-align: inherit;">Dementsprechend funktioniert der Joystick nicht. </font><font style="vertical-align: inherit;">Wenn Sie den Typ Ihres Ger√§ts √§ndern m√∂chten und die VID / PID unver√§ndert lassen m√∂chten, m√ºssen Sie daher die Seriennummer √§ndern.</font></font><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projektgenerierung f√ºr IDE</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die letzten Einstellungen, die Sie vornehmen m√ºssen, sind die Einstellungen f√ºr die Projektgenerierung. Dies geschieht √ºber </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projekt -&gt; Einstellungen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... Dort legen wir den Namen, den Zielordner und die gew√ºnschte IDE fest, unter der CubeMX das Projekt erstellt. Ich w√§hlte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MDK-ARM V5</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , weil ich Keil uVision verwende 5. Auf dem </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code Generator</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Registerkarte </font><font style="vertical-align: inherit;">k√∂nnen Sie das √ºberpr√ºfen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kopieren Sie </font><font style="vertical-align: inherit;">nur die erforderlichen Bibliotheksdateien</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Checkbox , </font><font style="vertical-align: inherit;">um </font><font style="vertical-align: inherit;">das Projekt nicht mit unn√∂tigen Dateien zu vollstopfen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Klicken Sie auf die Schaltfl√§che </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projekt -&gt; Code generieren</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . CubeMX erstellt ein Projekt mit Code, der in Keil uVision ge√∂ffnet und ohne zus√§tzliche Einstellungen kompiliert und geflasht werden kann. In der Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in der Funktion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main (void)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es wurden bereits Funktionen zum Initialisieren von Uhr, Anschl√ºssen, Timer und USB eingef√ºgt. In ihnen werden die Mikrocontrollermodule gem√§√ü den in CubeMX festgelegten Modi konfiguriert. </font></font><br>
<br>
<img src="https://habrastorage.org/files/fb6/a32/393/fb6a323933734c7cb3ac4e11550d7420.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Code finden sich h√§ufig Konstruktionen dieser Art:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-comment">/* USER CODE BEGIN 0 */</span><font></font>
(...)<font></font>
<span class="hljs-comment">/* USER CODE END 0 */</span><font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wird davon ausgegangen, dass der Benutzer seinen Code in diese Abschnitte einbettet. Wenn die Option </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Benutzercode beim erneuten Generieren</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> beibehalten in den CubeMX-Projekteinstellungen aktiviert ist </font><font style="vertical-align: inherit;">, wird der zwischen diesen Zeilen eingeschlossene Code w√§hrend der sekund√§ren Generierung eines vorhandenen Projekts nicht √ºberschrieben. Leider werden nur von CubeMX erstellte Abschnitte gespeichert. </font><font style="vertical-align: inherit;">Vom Benutzer erstellte </font><font style="vertical-align: inherit;">Abschnitte </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ * USER CODE * /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gehen verloren. Wenn Sie nach dem Schreiben des Codes in die IDE zu CubeMX zur√ºckkehren und das Projekt mit den neuen Einstellungen erneut generieren m√∂chten, empfehle ich daher, eine Sicherungskopie des Projekts zu erstellen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In den Firmware-Einstellungen in uVision ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash -&gt; Flash-Tools konfigurieren</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) empfehle ich Ihnen, die Option </font><i><font style="vertical-align: inherit;">Nach Flash</font></i><font style="vertical-align: inherit;"> zur√ºcksetzen </font><font style="vertical-align: inherit;">zu aktivieren</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">so dass der Mikrocontroller sofort nach dem Blinken startet. </font><font style="vertical-align: inherit;">Standardm√§√üig ist es deaktiviert und nach jedem Blinken m√ºssen Sie die Reset-Taste auf der Karte dr√ºcken.</font></font><br>
<br>
<img src="https://habrastorage.org/files/1e1/a3d/20d/1e1a3d20dd994c1787f8a8758fcd200e.png"><br>
<br>
<a name="ppm"></a><h3><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPM-Decodierung</font></font></b></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PPM - Pulse Position Modulation - eine in der Flugzeugmodellelektronik weit verbreitete Methode zur Codierung √ºbertragener Signale. </font><font style="vertical-align: inherit;">Es ist eine Folge von Impulsen, deren Zeitintervalle den √ºbertragenen Zahlenwerten entsprechen.</font></font><br>
<br>
<div style="text-align:center;"><img width="80%" src="https://habrastorage.org/files/905/3ec/257/9053ec2573f8438b9a3053f2ef408739.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gem√§√ü diesem Protokoll sendet die Konsole Informationen an das sendende Funkmodul, das auf der R√ºckseite in die Konsole eingesetzt wird. Viele Empf√§nger, die an Bord des Copters platziert sind, k√∂nnen Steuersignale f√ºr den Flugregler √ºber PPM √ºbertragen. Dar√ºber hinaus verf√ºgt fast jede Konsole √ºber Anschl√ºsse zum Anschlie√üen einer zweiten Konsole im Trainer-Student-Modus und zum Anschlie√üen der Konsole an einen Simulator, der normalerweise auch PPM verwendet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir schreiben ein Signal vom Simulatorausgang von Turnigy 9X mit einem Logikanalysator:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/53e/da5/319/53eda5319a6d45b59ee6e265de445992.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jede Sequenz codiert den aktuellen Status der Steuerelemente auf der Fernbedienung. Normalerweise entsprechen die ersten vier Werte (auch Kan√§le genannt) der Position der Analogsticks und die nachfolgenden der Position der Kippschalter oder Potentiometer. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die minimale Position der Steuerung entspricht dem Intervall 1000 Œºs, das Maximum - 2000 Œºs, die durchschnittliche Position - 1500 Œºs. Impulsst√∂√üe oder Rahmen werden durch wesentlich l√§ngere Intervalle getrennt und folgen mit einer Periode von 20‚Äì25 ms. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schauen wir uns das Signal genauer an:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/703/86d/84e/70386d84efe24577a958767f8c5b7ae9.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen k√∂nnen, befinden sich drei St√∂cke in der neutralen Position (1, 3, 4) und einer in der extremen Position (2). </font><font style="vertical-align: inherit;">Drei Kippschalter sind ausgeschaltet (5, 6, 7) und der letzte ist eingeschaltet (8). </font><font style="vertical-align: inherit;">Der als Adapter fungierende Mikrocontroller muss eine solche Sequenz erfassen, die Werte einem Array hinzuf√ºgen und als Befehl vom Joystick √ºber USB senden. </font><font style="vertical-align: inherit;">Schreiben wir einen Pulssequenzdecoder.</font></font><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unterbrechung erfassen</font></font></b></h5><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Starten Sie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
nach der Initialisierung in </font><i><font style="vertical-align: inherit;">main.c</font></i><font style="vertical-align: inherit;"> vor der main </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while-Schleife</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> den TIM3-Timer im Input Capture-Erfassungsmodus von Kanal 1 aus, und generieren Sie Erfassungsunterbrechungen. </font><font style="vertical-align: inherit;">Verwenden Sie dazu die entsprechende Funktion von HAL:</font></font><br>
<br>
<pre><code class="cpp hljs">HAL_TIM_IC_Start_IT(&amp;htim3, TIM_CHANNEL_1);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">htim3</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Struktur </font><font style="vertical-align: inherit;">in deklarierten </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist die TIM3 timer - </font><font style="vertical-align: inherit;">Handler, der alle Variablen enth√§lt Strukturen und mit dem Zeitgeber verbunden ist </font><font style="vertical-align: inherit;">: Parameter f√ºr die </font><font style="vertical-align: inherit;">Initialisierung, Zeiger auf alle Zeitgeberregister (Z√§hlerwert, Teiler, alle Einstellungen, Interrupt - </font><font style="vertical-align: inherit;">Flags), Zeiger auf einem Handler-DMA, der mit diesem Timer usw. funktioniert Der Entwickler muss nicht suchen, welche Bits in welchem ‚Äã‚ÄãRegister f√ºr was verantwortlich sind, und diese manuell setzen und zur√ºcksetzen. Es reicht aus, den Handler an die HAL-Funktion zu √ºbergeben. HAL-Bibliotheken erledigen den Rest selbst. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Prinzipien der HAL-Struktur werden ausf√ºhrlicher im Dokument </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Beschreibung der STM32F3xx-HAL-Treiber beschrieben</font></a><font style="vertical-align: inherit;"> .</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(UM1786). Es ist zu beachten, dass die HAL-Bibliotheken selbst gut dokumentiert sind. Um zu verstehen, wie die HAL f√ºr den Timer funktioniert und wie sie verwendet wird, k√∂nnen Sie die Kommentare in den </font><i><font style="vertical-align: inherit;">Dateien </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stm32f3xx_hal_tim.h</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stm32f3xx_hal_tim.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lesen </font><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
F√ºr jeden Interrupt, den der TIM3-Timer generiert, wird der </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TIM3_IRQHandler-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Handler </font><i><font style="vertical-align: inherit;">aufgerufen</font></i><font style="vertical-align: inherit;"> . Es befindet sich in der Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stm32f3xx_it.c. </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daraufhin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wird der </font><font style="vertical-align: inherit;">f√ºr alle Timer standardm√§√üige </font><i><font style="vertical-align: inherit;">HAL_TIM_IRQHandler-</font></i><font style="vertical-align: inherit;"> Handler </font><i><font style="vertical-align: inherit;">aufgerufen</font></i><font style="vertical-align: inherit;"> und ein Zeiger auf die htim3-Struktur an ihn √ºbergeben.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">TIM3_IRQHandler</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><font></font><span class="hljs-function">
</span>{<font></font>
  <span class="hljs-comment">/* USER CODE BEGIN TIM3_IRQn 0 */</span><font></font>
<font></font>
  <span class="hljs-comment">/* USER CODE END TIM3_IRQn 0 */</span><font></font>
  HAL_TIM_IRQHandler(&amp;htim3);<font></font>
  <span class="hljs-comment">/* USER CODE BEGIN TIM3_IRQn 1 */</span><font></font>
<font></font>
  <span class="hljs-comment">/* USER CODE END TIM3_IRQn 1 */</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn wir in die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HAL_TIM_IRQHandler-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stm32f3xx_hal_tim.c schauen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sehen wir einen riesigen Handler, der die Interrupt-Flags auf Timer √ºberpr√ºft, eine R√ºckruffunktion verursacht und das Flag nach der Ausf√ºhrung l√∂scht. </font><font style="vertical-align: inherit;">Wenn ein Erfassungsereignis </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auftritt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ruft es die Funktion </font><i><font style="vertical-align: inherit;">HAL_TIM_IC_CaptureCallback auf</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Es sieht aus wie das:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function">__weak <span class="hljs-keyword">void</span> <span class="hljs-title">HAL_TIM_IC_CaptureCallback</span><span class="hljs-params">(TIM_HandleTypeDef *htim)</span></span><font></font><span class="hljs-function">
</span>{<font></font>
<span class="hljs-comment">/* NOTE : This function Should not be modified, when the callback is needed, the __HAL_TIM_IC_CaptureCallback could be implemented in the user file</span><font></font><span class="hljs-comment">
*/</span><font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies bedeutet, dass wir diese Funktion in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.c √ºberschreiben k√∂nnen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">F√ºgen Sie daher </font><font style="vertical-align: inherit;">diesen R√ºckruf </font><font style="vertical-align: inherit;">vor der Funktion </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int main (void) ein</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_TIM_IC_CaptureCallback</span><span class="hljs-params">(TIM_HandleTypeDef *htim)</span></span><font></font><span class="hljs-function">
</span>{<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich w√ºrde gerne sehen, wie der Interrupt ausgef√ºhrt wird. </font><font style="vertical-align: inherit;">F√ºgen Sie dazu ein kurzes Ein- und Ausschalten einer der Schlussfolgerungen hinzu:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_TIM_IC_CaptureCallback</span><span class="hljs-params">(TIM_HandleTypeDef *htim)</span></span><font></font><span class="hljs-function">
</span>{<font></font>
  HAL_GPIO_WritePin(GPIOE, GPIO_PIN_8, GPIO_PIN_SET);<font></font>
  __nop();__nop();__nop();__nop();__nop();__nop();<font></font>
  HAL_GPIO_WritePin(GPIOE, GPIO_PIN_8, GPIO_PIN_RESET);<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der PE8-Pin wurde bereits als Ausgang initialisiert. </font><font style="vertical-align: inherit;">Zwischen dem Ein- und Ausschalten werden </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__nop () -</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anweisungen eingef√ºgt </font><font style="vertical-align: inherit;">, die eine Verz√∂gerung von 1 Taktzyklus bilden. </font><font style="vertical-align: inherit;">Dies geschieht, damit mein chinesischer 8-Dollar-Logikanalysator, der mit 24 MHz arbeitet, keinen zu kurzen Impuls von einem 72-MHz-Mikrocontroller verpasst. </font><font style="vertical-align: inherit;">Kompilieren Sie nun das Projekt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projekt -&gt; Ziel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erstellen </font><font style="vertical-align: inherit;">und fragen Sie den </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Controller </font><i><font style="vertical-align: inherit;">-&gt; Download</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Wir werden das PPM von der Fernbedienung an PC6 anschlie√üen und sehen, was mit dem Analyseger√§t auf PC6 und PE8 passiert.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/abf/64c/e2c/abf64ce2c6874057933df9edb58dff8f.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
R√ºckruf wird wirklich im richtigen Moment aufgerufen - direkt nachdem das Eingangssignal von 1 auf 0 √ºbergegangen ist. Also wurde alles richtig gemacht.</font></font><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erfassen und verarbeiten Sie erfasste Daten</font></font></b></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir werden den R√ºckruf so bearbeiten, dass jeder erfasste Wert </font><font style="vertical-align: inherit;">unver√§ndert </font><font style="vertical-align: inherit;">zum </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erfassten_Wert-</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Puffer hinzugef√ºgt wird </font><font style="vertical-align: inherit;">. Wenn der Timer einen sehr gro√üen Wert erfasst (mehr als 5000 Œºs), bedeutet dies, dass eine Pause aufgezeichnet wurde, das Paket vollst√§ndig empfangen wurde und verarbeitet werden kann. Die verarbeiteten Werte werden dem Array </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rc_data</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mit 5 Elementen </font><font style="vertical-align: inherit;">hinzugef√ºgt </font><font style="vertical-align: inherit;">. In den ersten vier werden die Steuerkn√ºppelpositionen auf den Bereich [0; 1000], im f√ºnften werden einzelne Bits gem√§√ü den Kippschaltern gesetzt, die als Dr√ºcken von Tasten auf dem Gamepad interpretiert werden.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">uint16_t</span> captured_value[<span class="hljs-number">8</span>] = {<span class="hljs-number">0</span>};<font></font>
<span class="hljs-keyword">uint16_t</span> rc_data[<span class="hljs-number">5</span>] = {<span class="hljs-number">0</span>};<font></font>
<span class="hljs-keyword">uint8_t</span> pointer = <span class="hljs-number">0</span>;<font></font>
<span class="hljs-keyword">uint8_t</span> data_ready = <span class="hljs-number">0</span>;<font></font>
<font></font>
...<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_TIM_IC_CaptureCallback</span><span class="hljs-params">(TIM_HandleTypeDef *htim)</span></span><font></font><span class="hljs-function">
</span>{<font></font>
    <span class="hljs-keyword">uint8_t</span> i;<font></font>
    <span class="hljs-keyword">uint16_t</span> temp;<font></font>
    <span class="hljs-comment">//     </span><font></font>
    temp = HAL_TIM_ReadCapturedValue(htim, TIM_CHANNEL_1);<font></font>
    <span class="hljs-comment">//    , ,  </span><font></font>
    <span class="hljs-keyword">if</span> ((temp &gt; <span class="hljs-number">5000</span>) &amp;&amp; (!data_ready))<font></font>
    {<font></font>
        pointer = <span class="hljs-number">0</span>;<font></font>
        <span class="hljs-comment">//        [0;1000]</span><font></font>
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)<font></font>
        {<font></font>
            <span class="hljs-keyword">if</span> (captured_value[i] &lt; <span class="hljs-number">1000</span>)<font></font>
                captured_value[i] = <span class="hljs-number">1000</span>;<font></font>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (captured_value[i] &gt; <span class="hljs-number">2000</span>)<font></font>
                captured_value[i] = <span class="hljs-number">2000</span>;<font></font>
            rc_data[i] = captured_value[i]<span class="hljs-number">-1000</span>;<font></font>
        };<font></font>
        <span class="hljs-comment">//     </span><font></font>
        rc_data[<span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;<font></font>
        <span class="hljs-keyword">if</span> (captured_value[<span class="hljs-number">4</span>] &gt; <span class="hljs-number">1500</span>)<font></font>
            rc_data[<span class="hljs-number">4</span>] |= (<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">4</span>);<font></font>
        <span class="hljs-keyword">if</span> (captured_value[<span class="hljs-number">5</span>] &gt; <span class="hljs-number">1500</span>)<font></font>
            rc_data[<span class="hljs-number">4</span>] |= (<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">5</span>);<font></font>
        <span class="hljs-keyword">if</span> (captured_value[<span class="hljs-number">6</span>] &gt; <span class="hljs-number">1500</span>)<font></font>
            rc_data[<span class="hljs-number">4</span>] |= (<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">6</span>);<font></font>
        <span class="hljs-keyword">if</span> (captured_value[<span class="hljs-number">7</span>] &gt; <span class="hljs-number">1500</span>)<font></font>
            rc_data[<span class="hljs-number">4</span>] |= (<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">7</span>);<font></font>
        data_ready = <span class="hljs-number">1</span>;<font></font>
    }<font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-comment">//      </span><font></font>
    {<font></font>
        captured_value[pointer] = temp;<font></font>
        pointer++;<font></font>
    };<font></font>
    <span class="hljs-keyword">if</span> (pointer == <span class="hljs-number">8</span>) <span class="hljs-comment">//   </span><font></font>
        pointer = <span class="hljs-number">0</span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lassen Sie mich erkl√§ren, warum ich die den Schaltfl√§chen entsprechenden Bits nicht in den unteren 4 Bits, sondern in den f√ºnften bis achten Bits platziert habe. Im Simulator soll ein Gamepad von der Xbox angeschlossen werden, auf dem die Tasten LB, RB, Start und Back verwendet werden. Die Nummern 5 bis 8. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Hauptschleife wird das Flag data_ready kontinuierlich gedreht, wodurch Daten an den Computer gesendet werden.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (data_ready)<font></font>
  {<font></font>
    <span class="hljs-comment">//      </span><font></font>
    data_ready = <span class="hljs-number">0</span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um zu √ºberpr√ºfen, wie dies funktioniert, schlie√üen Sie die Fernbedienung an, kompilieren und flashen Sie sie erneut und starten Sie dann das Debuggen von </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug -&gt; Debug-Sitzung starten / stoppen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√ñffnen Sie das Fenster zum Verfolgen von Variablen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ansicht -&gt; Windows </font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">√ºberwachen </font></i><i><font style="vertical-align: inherit;">-&gt; 1 </font></i><i><font style="vertical-align: inherit;">√ºberwachen</font></i><font style="vertical-align: inherit;"> und f√ºgen </font><i><font style="vertical-align: inherit;">Sie dort den </font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erfassten </font></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wert</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und die </font><i><font style="vertical-align: inherit;">rc_data hinzu</font></i><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir starten das Debuggen mit dem Befehl </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug -&gt; Ausf√ºhren</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und in Echtzeit, ohne auch nur Haltepunkte hinzuzuf√ºgen, werden wir sehen, wie sich die Zahlen nach den Bewegungen der Sticks √§ndern.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/5cf/7da/c9c/5cf7dac9c152498e89ea3948a8549efb.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als N√§chstes m√ºssen Sie Daten in Form eines Joystick-Befehls an den Computer senden.</font></font><br>
<br>
<h3><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Konfigurieren Sie das HID-Ger√§t und erstellen Sie den HID-Berichtsdeskriptor</font></font></b></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
USB HID (Human Interface Device) ist eine Klasse von Ger√§ten f√ºr die Mensch-Computer-Interaktion. Dazu geh√∂ren Tastaturen, M√§use, Joysticks, Gamepads und Touchpanels. Der Hauptvorteil von HID-Ger√§ten besteht darin, dass sie in keinem Betriebssystem spezielle Treiber ben√∂tigen: Windows, OS X, Android und sogar iOS (√ºber den USB-Lightning-Adapter). Eine ausf√ºhrliche Beschreibung finden Sie im Dokument </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ger√§teklassendefinition f√ºr HID</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Das Wichtigste, was wir wissen m√ºssen, um einen PPM-USB-Adapter zu erstellen, ist, was </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HID Report</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HID Report Descriptor sind</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das HID-Ger√§t sendet Bytepakete in einem vordefinierten Format an den Computer. Jedes dieser Pakete ist ein HID-Bericht. Das Ger√§t informiert den Computer √ºber das Datenformat, wenn es eine Verbindung herstellt, und sendet einen HID-Berichtsdeskriptor, eine Paketbeschreibung, die angibt, wie viele Bytes das Paket enth√§lt und welchen Zweck jedes Byte und Bit im Paket hat. Beispielsweise besteht der HID-Bericht einer einfachen Maus aus vier Bytes: Das erste Byte enth√§lt Informationen zu den gedr√ºckten Tasten, das zweite und dritte Byte enthalten die relative Bewegung des Cursors entlang X und Y und das vierte Byte enth√§lt die Drehung des Scrollrads. Der Berichtsdeskriptor wird im Ger√§testeuerungsspeicher als Array von Bytes gespeichert.</font></font><br>
<br>
<div style="text-align:center;"><img width="35%" src="https://habrastorage.org/files/22f/dd2/aa6/22fdd2aa67154365a6f89f6a2f7f2798.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor ich einen Deskriptor erstelle, m√∂chte ich mich separat mit der Terminologie befassen. In der englischsprachigen Umgebung sind zwei Begriffe √ºblich - </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Joystick</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gamepad</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Das Wort </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Joystick wird</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> normalerweise als Manipulator bezeichnet, der mit einer Hand gehalten und in verschiedene Richtungen geneigt wird. Das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gamepad</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist ein Ger√§t mit Tasten und St√∂cken, das mit zwei H√§nden gehalten wird. Russisch sprechende Benutzer nennen den Joystick normalerweise sowohl diesen als auch einen anderen. In der Beschreibung des HID-Ger√§ts gibt es einen Unterschied zwischen dem Joystick und dem Gamepad. Die Flugzeugmodellkonsole √§hnelt in ihrem funktionalen Zweck eher einem Gamepad, daher werde ich in Zukunft manchmal den Begriff ‚ÄûGamepad‚Äú verwenden.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir haben ein Projekt erstellt, das angibt, dass das Ger√§t als Human Interface Device fungiert. </font><font style="vertical-align: inherit;">Dies bedeutet, dass eine USB-HID-Bibliothek mit dem Projekt verbunden ist und bereits ein Ger√§te-Deskriptor generiert wurde. </font><font style="vertical-align: inherit;">Es befindet sich in der Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usbd_hid.c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , beschreibt </font><font style="vertical-align: inherit;">den </font><i><font style="vertical-align: inherit;">Mausbericht</font></i><font style="vertical-align: inherit;"> und sieht folgenderma√üen aus:</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HID_Mouse_Report_Descriptor</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs">__ALIGN_BEGIN <span class="hljs-keyword">static</span> <span class="hljs-keyword">uint8_t</span> HID_MOUSE_ReportDesc[HID_MOUSE_REPORT_DESC_SIZE]  __ALIGN_END =<font></font>
{<font></font>
  <span class="hljs-number">0x05</span>,   <span class="hljs-number">0x01</span>,<font></font>
  <span class="hljs-number">0x09</span>,   <span class="hljs-number">0x02</span>,<font></font>
  <span class="hljs-number">0xA1</span>,   <span class="hljs-number">0x01</span>,<font></font>
  <span class="hljs-number">0x09</span>,   <span class="hljs-number">0x01</span>,<font></font>
<font></font>
  <span class="hljs-number">0xA1</span>,   <span class="hljs-number">0x00</span>,<font></font>
  <span class="hljs-number">0x05</span>,   <span class="hljs-number">0x09</span>,<font></font>
  <span class="hljs-number">0x19</span>,   <span class="hljs-number">0x01</span>,<font></font>
  <span class="hljs-number">0x29</span>,   <span class="hljs-number">0x03</span>,<font></font>
<font></font>
  <span class="hljs-number">0x15</span>,   <span class="hljs-number">0x00</span>,<font></font>
  <span class="hljs-number">0x25</span>,   <span class="hljs-number">0x01</span>,<font></font>
  <span class="hljs-number">0x95</span>,   <span class="hljs-number">0x03</span>,<font></font>
  <span class="hljs-number">0x75</span>,   <span class="hljs-number">0x01</span>,<font></font>
<font></font>
  <span class="hljs-number">0x81</span>,   <span class="hljs-number">0x02</span>,<font></font>
  <span class="hljs-number">0x95</span>,   <span class="hljs-number">0x01</span>,<font></font>
  <span class="hljs-number">0x75</span>,   <span class="hljs-number">0x05</span>,<font></font>
  <span class="hljs-number">0x81</span>,   <span class="hljs-number">0x01</span>,<font></font>
<font></font>
  <span class="hljs-number">0x05</span>,   <span class="hljs-number">0x01</span>,<font></font>
  <span class="hljs-number">0x09</span>,   <span class="hljs-number">0x30</span>,<font></font>
  <span class="hljs-number">0x09</span>,   <span class="hljs-number">0x31</span>,<font></font>
  <span class="hljs-number">0x09</span>,   <span class="hljs-number">0x38</span>,<font></font>
<font></font>
  <span class="hljs-number">0x15</span>,   <span class="hljs-number">0x81</span>,<font></font>
  <span class="hljs-number">0x25</span>,   <span class="hljs-number">0x7F</span>,<font></font>
  <span class="hljs-number">0x75</span>,   <span class="hljs-number">0x08</span>,<font></font>
  <span class="hljs-number">0x95</span>,   <span class="hljs-number">0x03</span>,<font></font>
<font></font>
  <span class="hljs-number">0x81</span>,   <span class="hljs-number">0x06</span>,<font></font>
  <span class="hljs-number">0xC0</span>,   <span class="hljs-number">0x09</span>,<font></font>
  <span class="hljs-number">0x3c</span>,   <span class="hljs-number">0x05</span>,<font></font>
  <span class="hljs-number">0xff</span>,   <span class="hljs-number">0x09</span>,<font></font>
<font></font>
  <span class="hljs-number">0x01</span>,   <span class="hljs-number">0x15</span>,<font></font>
  <span class="hljs-number">0x00</span>,   <span class="hljs-number">0x25</span>,<font></font>
  <span class="hljs-number">0x01</span>,   <span class="hljs-number">0x75</span>,<font></font>
  <span class="hljs-number">0x01</span>,   <span class="hljs-number">0x95</span>,<font></font>
<font></font>
  <span class="hljs-number">0x02</span>,   <span class="hljs-number">0xb1</span>,<font></font>
  <span class="hljs-number">0x22</span>,   <span class="hljs-number">0x75</span>,<font></font>
  <span class="hljs-number">0x06</span>,   <span class="hljs-number">0x95</span>,<font></font>
  <span class="hljs-number">0x01</span>,   <span class="hljs-number">0xb1</span>,<font></font>
<font></font>
  <span class="hljs-number">0x01</span>,   <span class="hljs-number">0xc0</span><font></font>
};<font></font>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das manuelle Erstellen des HID-Berichtsdeskriptors ist √§u√üerst zeitaufw√§ndig. </font><font style="vertical-align: inherit;">Um die Aufgabe zu erleichtern, gibt es ein Tool namens </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HID Descriptor Tool</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (DT). </font><font style="vertical-align: inherit;">Dieses Programm kann einen Deskriptor f√ºr Ihr Ger√§t erstellen. </font><font style="vertical-align: inherit;">Im Archiv finden Sie einige Beispiele f√ºr Deskriptoren f√ºr verschiedene Ger√§te.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/a3c/6fd/07c/a3c6fd07c997415ab94ba603edda628d.png"></div><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier ist ein</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sehr guter Artikel √ºber das Erstellen eines eigenen HID-Deskriptors f√ºr Maus und Tastatur (auf Englisch). Ich werde Ihnen auf Russisch sagen, wie man einen Griff f√ºr ein Gamepad macht. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der von der Konsole gesendete HID-Bericht muss vier 16-Bit-Werte f√ºr zwei Achsen von Analogsticks und 16 Ein-Bit-Werte f√ºr Tasten enthalten. Insgesamt 10 Bytes. Das in DT erstellte Handle sieht folgenderma√üen aus:</font></font><br>
<br>
<pre><code class="cpp hljs">    <span class="hljs-number">0x05</span>, <span class="hljs-number">0x01</span>,                    <span class="hljs-comment">// USAGE_PAGE (Generic Desktop)</span><font></font>
    <span class="hljs-number">0x09</span>, <span class="hljs-number">0x05</span>,                    <span class="hljs-comment">// USAGE (Game Pad)</span><font></font>
    <span class="hljs-number">0xa1</span>, <span class="hljs-number">0x01</span>,                    <span class="hljs-comment">// COLLECTION (Application)</span><font></font>
    <span class="hljs-number">0x09</span>, <span class="hljs-number">0x01</span>,                    <span class="hljs-comment">//   USAGE (Pointer)</span><font></font>
    <span class="hljs-number">0xa1</span>, <span class="hljs-number">0x00</span>,                    <span class="hljs-comment">//   COLLECTION (Physical)</span><font></font>
    <span class="hljs-number">0x09</span>, <span class="hljs-number">0x30</span>,                    <span class="hljs-comment">//     USAGE (X)</span><font></font>
    <span class="hljs-number">0x09</span>, <span class="hljs-number">0x31</span>,                    <span class="hljs-comment">//     USAGE (Y)</span><font></font>
    <span class="hljs-number">0x15</span>, <span class="hljs-number">0x00</span>,                    <span class="hljs-comment">//     LOGICAL_MINIMUM (0)</span><font></font>
    <span class="hljs-number">0x26</span>, <span class="hljs-number">0xe8</span>, <span class="hljs-number">0x03</span>,              <span class="hljs-comment">//     LOGICAL_MAXIMUM (1000)</span><font></font>
    <span class="hljs-number">0x75</span>, <span class="hljs-number">0x10</span>,                    <span class="hljs-comment">//     REPORT_SIZE (16)</span><font></font>
    <span class="hljs-number">0x95</span>, <span class="hljs-number">0x02</span>,                    <span class="hljs-comment">//     REPORT_COUNT (2)</span><font></font>
    <span class="hljs-number">0x81</span>, <span class="hljs-number">0x02</span>,                    <span class="hljs-comment">//     INPUT (Data,Var,Abs)</span><font></font>
    <span class="hljs-number">0xc0</span>,                          <span class="hljs-comment">//   END_COLLECTION</span><font></font>
    <span class="hljs-number">0xa1</span>, <span class="hljs-number">0x00</span>,                    <span class="hljs-comment">//   COLLECTION (Physical)</span><font></font>
    <span class="hljs-number">0x09</span>, <span class="hljs-number">0x33</span>,                    <span class="hljs-comment">//     USAGE (Rx)</span><font></font>
    <span class="hljs-number">0x09</span>, <span class="hljs-number">0x34</span>,                    <span class="hljs-comment">//     USAGE (Ry)</span><font></font>
    <span class="hljs-number">0x15</span>, <span class="hljs-number">0x00</span>,                    <span class="hljs-comment">//     LOGICAL_MINIMUM (0)</span><font></font>
    <span class="hljs-number">0x26</span>, <span class="hljs-number">0xe8</span>, <span class="hljs-number">0x03</span>,              <span class="hljs-comment">//     LOGICAL_MAXIMUM (1000)</span><font></font>
    <span class="hljs-number">0x75</span>, <span class="hljs-number">0x10</span>,                    <span class="hljs-comment">//     REPORT_SIZE (16)</span><font></font>
    <span class="hljs-number">0x95</span>, <span class="hljs-number">0x02</span>,                    <span class="hljs-comment">//     REPORT_COUNT (2)</span><font></font>
    <span class="hljs-number">0x81</span>, <span class="hljs-number">0x02</span>,                    <span class="hljs-comment">//     INPUT (Data,Var,Abs)</span><font></font>
    <span class="hljs-number">0xc0</span>,                          <span class="hljs-comment">//   END_COLLECTION</span><font></font>
    <span class="hljs-number">0x05</span>, <span class="hljs-number">0x09</span>,                    <span class="hljs-comment">//   USAGE_PAGE (Button)</span><font></font>
    <span class="hljs-number">0x19</span>, <span class="hljs-number">0x01</span>,                    <span class="hljs-comment">//   USAGE_MINIMUM (Button 1)</span><font></font>
    <span class="hljs-number">0x29</span>, <span class="hljs-number">0x10</span>,                    <span class="hljs-comment">//   USAGE_MAXIMUM (Button 16)</span><font></font>
    <span class="hljs-number">0x15</span>, <span class="hljs-number">0x00</span>,                    <span class="hljs-comment">//   LOGICAL_MINIMUM (0)</span><font></font>
    <span class="hljs-number">0x25</span>, <span class="hljs-number">0x01</span>,                    <span class="hljs-comment">//   LOGICAL_MAXIMUM (1)</span><font></font>
    <span class="hljs-number">0x75</span>, <span class="hljs-number">0x01</span>,                    <span class="hljs-comment">//   REPORT_SIZE (1)</span><font></font>
    <span class="hljs-number">0x95</span>, <span class="hljs-number">0x10</span>,                    <span class="hljs-comment">//   REPORT_COUNT (16)</span><font></font>
    <span class="hljs-number">0x81</span>, <span class="hljs-number">0x02</span>,                    <span class="hljs-comment">//   INPUT (Data,Var,Abs)</span><font></font>
    <span class="hljs-number">0xc0</span>                           <span class="hljs-comment">// END_COLLECTION</span><font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es sieht nicht weniger einsch√ºchternd aus als ein Mausdeskriptor. </font><font style="vertical-align: inherit;">Wenn Sie jedoch verstehen, was jede Zeile bedeutet, ist alles verst√§ndlich und logisch. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
USAGE zeigt, wie das System Daten interpretieren soll, die weiter gehen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt viele Verwendungsarten, sie sind in Gruppen sortiert - Verwendungsseiten. </font><font style="vertical-align: inherit;">Um eine bestimmte Verwendung auszuw√§hlen, m√ºssen Sie daher zun√§chst auf die entsprechende USAGE_PAGE verweisen. </font><font style="vertical-align: inherit;">Informationen zur Verwendung finden Sie im Dokument </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versteckte Verwendungstabellen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ganz am Anfang des Deskriptors geben wir an, dass der Joystick beschrieben wird:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USAGE_PAGE (generischer Desktop) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
USAGE (Game Pad)</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
COLLECTION kombiniert mehrere verwandte Datens√§tze. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die physische Sammlung wird f√ºr Daten verwendet, die sich auf einen bestimmten geometrischen Punkt beziehen, z. B. einen analogen Stick. </font><font style="vertical-align: inherit;">Die Anwendungssammlung wird verwendet, um verschiedene Funktionen in einem Ger√§t zu kombinieren. </font><font style="vertical-align: inherit;">Beispielsweise kann eine Tastatur mit einem integrierten Trackpad zwei Anwendungssammlungen haben. </font><font style="vertical-align: inherit;">Wir beschreiben nur den Joystick, was bedeutet, dass die Sammlung eine sein wird:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COLLECTION (Anwendung) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
END_COLLECTION</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Danach m√ºssen Sie angeben, dass die Elemente, die die Koordinaten √ºbertragen, beschrieben werden. </font><font style="vertical-align: inherit;">Der Verwendungszeiger beschreibt M√§use, Joysticks, Gamepads und Digitalisierer:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VERWENDUNG (Zeiger)</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Folgenden finden Sie Beschreibungen von analogen Sticks, die in einer Sammlung zusammengefasst sind:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAMMLUNG (physisch)</font></font><br>
 <blockquote>USAGE (X)<br>
 USAGE (Y)<br>
 LOGICAL_MINIMUM (0)<br>
 LOGICAL_MAXIMUM (1000)<br>
 REPORT_SIZE (16)<br>
 REPORT_COUNT (2)<br>
 INPUT (Data,Var,Abs)</blockquote>END_COLLECTION</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
USAGE gibt hier an, dass die Abweichungswerte entlang der beiden Achsen X und Y </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
verwendet werden </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">LOGICAL_MINIMUM und LOGICAL_MAXIMUM geben an, inwieweit der √ºbertragene Wert variieren kann. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
REPORT_COUNT und REPORT_SIZE legen jeweils fest, wie viele Zahlen und welche Gr√∂√üe √ºbertragen werden sollen, n√§mlich zwei 16-Bit-Zahlen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
INPUT (Data, Var, Abs) bedeutet, dass die Daten vom Ger√§t zum Computer gelangen und sich √§ndern k√∂nnen. Die Werte in unserem Fall sind absolut. Beispielsweise kommen relative Werte von der Maus, um den Cursor zu bewegen. Manchmal werden Daten als Const beschrieben, nicht als Var. Dies ist notwendig, um nicht signifikante Bits zu √ºbertragen. Beispielsweise werden in einem Mausbericht mit drei Schaltfl√§chen 3 Bit Var f√ºr Schaltfl√§chen und 5 Bit Const √ºbertragen, um die √úbertragungsgr√∂√üe auf ein Byte zu erg√§nzen.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen k√∂nnen, sind die Beschreibungen der X- und Y-Achse zusammengefasst. </font><font style="vertical-align: inherit;">Sie haben die gleiche Gr√∂√üe, die gleichen Grenzen. </font><font style="vertical-align: inherit;">Der gleiche analoge Stick k√∂nnte wie folgt beschrieben werden, wobei jede Achse einzeln beschrieben wird. </font><font style="vertical-align: inherit;">Ein solcher Deskriptor funktioniert √§hnlich wie der vorherige:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAMMLUNG (physisch)</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VERWENDUNG (X) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 LOGICAL_MINIMUM (0) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 LOGICAL_MAXIMUM (1000) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 REPORT_SIZE (16) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 REPORT_COUNT (1) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 EINGABE (Daten, Var, Abs)</font></font></blockquote><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VERWENDUNG (Y) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 LOGICAL_MINIMUM (0) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 LOGICAL_MAXIMUM (1000) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 REPORT_SIZE (16) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 REPORT_COUNT (1) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 EINGABE (Daten, Var, Abs)</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">END_COLLECTION</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem ersten Stick wird der zweite analoge Stick beschrieben. </font><font style="vertical-align: inherit;">Seine Achsen haben eine andere Verwendung, so dass Sie sie vom ersten Stick unterscheiden k√∂nnen - Rx und Ry:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAMMLUNG (physisch)</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VERWENDUNG (Rx) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 VERWENDUNG (Ry) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 LOGICAL_MINIMUM (0) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 LOGICAL_MAXIMUM (1000) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 REPORT_SIZE (16) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 REPORT_COUNT (2) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 EINGABE (Daten, Var, Abs)</font></font></blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">END_COLLECTION</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun m√ºssen Sie einige Schaltfl√§chen des Gamepads beschreiben. </font><font style="vertical-align: inherit;">Dies kann wie folgt erfolgen:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USAGE_PAGE (Schaltfl√§che) USAGE (Schaltfl√§che </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) </font><font style="vertical-align: inherit;">USAGE (Schaltfl√§che </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) </font><font style="vertical-align: inherit;">USAGE (Schaltfl√§che </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
USAGE (Schaltfl√§che 16)</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die umst√§ndliche Aufzeichnung von Schaltfl√§chen desselben Typs kann mithilfe des Verwendungsbereichs reduziert werden:</font></font><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USAGE_PAGE (Schaltfl√§che) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
USAGE_MINIMUM (Schaltfl√§che 1) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
USAGE_MAXIMUM (Schaltfl√§che 16)</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die von den Tasten √ºbertragenen Daten sind 16 Einzelbitwerte, die von 0 bis 1 variieren:</font></font><br>
<blockquote>LOGICAL_MINIMUM (0)<br>
LOGICAL_MAXIMUM (1)<br>
REPORT_SIZE (1)<br>
REPORT_COUNT (16)<br>
INPUT (Data,Var,Abs)</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Reihenfolge der Zeilen im Deskriptor ist nicht streng. Beispielsweise k√∂nnen Logical_Minimum und Logical_Maximum vor der Verwendung (Schaltfl√§che) geschrieben oder die Zeilen Report_Size und Report_Count ausgetauscht werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es ist wichtig, dass der Eingabebefehl alle erforderlichen Parameter f√ºr die Daten√ºbertragung enth√§lt (Verwendung, Minimum, Maximum, Gr√∂√üe, Anzahl). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn der Deskriptor gebildet wird, kann er mit dem Befehl </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deskriptor</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> analysieren </font><font style="vertical-align: inherit;">auf Fehler </font><font style="vertical-align: inherit;">√ºberpr√ºft </font><font style="vertical-align: inherit;">werden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wenn alles in Ordnung ist, exportieren Sie es mit der Erweiterung h. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ersetzen Sie in der</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Datei </font><i><font style="vertical-align: inherit;">usbd_hid.c</font></i><font style="vertical-align: inherit;"> den Deskriptor durch einen neuen und passen Sie in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usbd_hid.h die</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gr√∂√üe des Deskriptors </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HID_MOUSE_REPORT_DESC_SIZE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von 74 auf 61 an. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Berichte werden mit dem Flag </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data_ready</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gesendet </font><font style="vertical-align: inherit;">. Daf√ºr zu</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.c wird</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> die Header-Datei </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usbd_hid.h einschlie√üen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und in der Hauptschleife die Funktion zum Senden von Berichten aufrufen. </font><font style="vertical-align: inherit;">Das Array </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rc_data</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist vom Typ uint16, daher muss der Zeiger darauf in einen 8-Bit-Typ umgewandelt werden und die Gr√∂√üe 10 anstelle von 5 √ºbergeben.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"usbd_hid.h"</span></span><font></font>
...<font></font>
<span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<font></font>
{<font></font>
  <span class="hljs-keyword">if</span> (data_ready)<font></font>
  {<font></font>
    USBD_HID_SendReport(&amp;hUsbDeviceFS, (<span class="hljs-keyword">uint8_t</span>*)rc_data, <span class="hljs-number">10</span>);<font></font>
    data_ready = <span class="hljs-number">0</span>;<font></font>
  };<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wir kompilieren das Projekt und flashen es erneut.</font></font><br>
<br>
<h3><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anschluss und Verwendung</font></font></b></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Schlie√üen Sie das USB-Kabel vom ST-LINK-USB-Anschluss wieder an den USER-USB-Anschluss an. </font><font style="vertical-align: inherit;">Windows erkennt das neue Ger√§t und installiert den Treiber automatisch. </font><font style="vertical-align: inherit;">Gehen wir zur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Systemsteuerung -&gt; Ger√§te und Drucker</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und sehen unser STM32 USB-PPM-Adapterger√§t mit einem Gamepad-Symbol.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/1ee/5ad/846/1ee5ad84654545dfbcec807073ef8207.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In den Ger√§teparametern k√∂nnen Sie sehen, wie sich das Kreuz um das Feld bewegt und wie sich die Spalten bewegen, nachdem die Sticks bewegt wurden, und die Schaltfl√§chensymbole leuchten am Kippschalter auf. </font><font style="vertical-align: inherit;">Eine Kalibrierung ist nicht erforderlich, da die Minimal- und Maximalwerte bereits im Deskriptor festgelegt wurden.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/52c/4b0/9db/52c4b09db3074871b917aa74b3375de6.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Starten von FPV FreeRider sehen wir, wie sich die Sticks auf dem Hauptbildschirm des gezeichneten virtuellen Gamepads gem√§√ü unserer Fernbedienung bewegen. </font><font style="vertical-align: inherit;">Wenn die Achsen aus irgendeinem Grund nicht richtig zugewiesen sind, k√∂nnen Sie sie im Abschnitt </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controller kalibrieren</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> neu konfigurieren </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit den Kippschaltern, die den Tasten auf der Fernbedienung entsprechen, k√∂nnen Sie den Flugmodus (akrobatisch / stabilisiert) wechseln, die Kameraansicht (vom Brett / vom Boden aus) wechseln, einen Flug von Anfang an starten oder das Rennen f√ºr eine Weile einschalten.</font></font><br>
<br>
<div style="text-align:center;"><img width="70%" src="https://habrastorage.org/files/153/bc2/3a8/153bc23a87bd4fedad1dd9b04c2aae22.png"></div><br>
<br>
<h3><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geflogen!</font></font></b></h3><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.youtube.com/embed/ilMeTba4EOE%3Ffeature%3Doembed&amp;usg=ALkJrhh0TgSByuvnQrzwl9k1JrvfT0mT4Q" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf dem Video - das Ergebnis mehrerer Tage meines Trainings. W√§hrend ich mit Auto-Leveling fliege und nicht im akrobatischen Modus, wie es alle Meister des FPV-Rennsports tun. Wenn Sie im Akro-Modus die Sticks loslassen, kehrt der Copter nicht automatisch in die horizontale Position zur√ºck, sondern fliegt im gleichen Winkel weiter, in dem er geflogen ist. Das Verwalten im Akro-Modus ist viel schwieriger, aber Sie k√∂nnen eine h√∂here Geschwindigkeit und Man√∂vrierf√§higkeit erreichen, Umw√§lzungen in der Luft vornehmen und sogar verkehrt herum fliegen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu den </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Charpu-Meistern</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich bin noch sehr weit weg, aber ich trainiere weiter und ich kann mit Sicherheit sagen, dass mich die Idee eines Renn-Mini-Copter noch mehr interessiert hat. </font><font style="vertical-align: inherit;">Und bald werde ich definitiv mit dem Bau und den Fl√ºgen nicht mehr im Simulator besch√§ftigt sein, sondern in der harten Realit√§t, mit echten Abst√ºrzen, kaputten Propellern, kaputten Motoren und ausgebrannten Batterien. </font><font style="vertical-align: inherit;">Aber das ist ein Thema f√ºr andere Artikel :)</font></font><br>
<br>
<hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Projekt f√ºr Keil uVision 5 und STM32CubeMX ist auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de384813/">https://habr.com/ru/post/de384813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de384801/index.html">Letzter Tag in Pompeji: Italienische Wissenschaftler haben die √úberreste der Opfer der Katastrophe gescannt</a></li>
<li><a href="../de384803/index.html">Paul Graham: Ideen f√ºr ein Bio-Startup</a></li>
<li><a href="../de384805/index.html">IFixit-Spezialisten rei√üen AppleTV ab und Apple deinstalliert die iFixit-App aus dem AppStore</a></li>
<li><a href="../de384809/index.html">Papier oder "Nummer"? Beides: √úberpr√ºfung des NeoLAB Convergence Neo Smartpen N2 Smart Pen</a></li>
<li><a href="../de384811/index.html">Gutachten: Halbleitermaterialien in der Elektronik</a></li>
<li><a href="../de384815/index.html">Telefone f√ºr Kindersicherheit und elterlichen Frieden: bb-mobile Nachrichten</a></li>
<li><a href="../de384817/index.html">Tausende von Apollo-Fotos wurden auf Flickr hochgeladen</a></li>
<li><a href="../de384819/index.html">–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã ¬´–Ω–µ –±—ã—Ç—å –∑–ª–æ–º¬ª ¬´Google¬ª —Ç–µ–ø–µ—Ä—å ¬´–¥–µ–ª–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–µ—â–∏¬ª</a></li>
<li><a href="../de384821/index.html">Der Student stellte einen Handschuh vor, mit dem Menschen mit Sprachst√∂rungen kommunizieren k√∂nnen</a></li>
<li><a href="../de384823/index.html">Nicht standardisierte M√∂glichkeiten zur F√∂rderung von Handyspielen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>