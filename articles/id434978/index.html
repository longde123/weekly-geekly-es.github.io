<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎚️ 🐺 👃🏼 Memperkenalkan HealthKit #⃣ ✊🏻 🎁</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam artikel HealthKit ini, Anda akan belajar cara meminta izin untuk mengakses data HealthKit, serta membaca dan menulis data ke repositori HealthKi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Memperkenalkan HealthKit</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434978/"> Dalam artikel HealthKit ini, Anda akan belajar cara meminta izin untuk mengakses data HealthKit, serta membaca dan menulis data ke repositori HealthKit pusat.  Artikel ini menggunakan versi Swift 4, iOS 11, Xcode 9. <br><br>  <b>HealthKit</b> adalah API yang diperkenalkan di iOS 8. <i>HealthKit</i> berfungsi sebagai repositori pusat untuk semua data terkait kesehatan, yang memungkinkan pengguna untuk membuat profil biologis dan menyimpan data latihan. <br><br>  Saat Anda membaca artikel HealthKit, Anda akan membuat aplikasi pelacakan pelatihan yang paling sederhana dan belajar: <br><br><ul><li>  Cara meminta izin dan mengakses data HealthKit </li><li>  Cara membaca data HealthKit dan menampilkannya dalam UITableView </li><li>  Cara menulis data ke repositori HealthKit pusat </li></ul><br>  Sudah siap memulai dengan HealthKit?  Baca terus! <br><a name="habracut"></a><br>  <b>Catatan:</b> <i>Untuk mengerjakan tutorial ini, Anda memerlukan akun pengembang iOS aktif.</i>  <i>Tanpa ini, Anda tidak dapat mengaktifkan Kemampuan HealthKit dan mendapatkan akses ke repositori HealthKit.</i> <br><br><h3>  Mulai </h3><br>  Aplikasi pemula melacak pembakaran kalori selama program latihan.  Untuk orang dalam Hollywood dan sosialita, seharusnya jelas bahwa saya berbicara tentang <b>Prancercise</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sp/rk/if/sprkif8aw8ng01gh-y4vrroags8.png" alt="Prancercise" width="764" height="430"></div><br>  <a href="">Unduh proyek pemula dan buka dalam Xcode</a> . <br><br>  Kompilasi dan jalankan aplikasi.  Anda akan melihat "kerangka" dari antarmuka pengguna.  Selama dua artikel berikutnya, Anda secara bertahap akan menambahkan fungsionalitas untuk aplikasi ini. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c8f/68a/4a5/c8f68a4a5bea9dfc34c426606e443458.png" alt="gambar" width="281" height="500"></div><br><h3>  Menugaskan Tim </h3><br>  <b>HealthKit</b> adalah kerangka kerja khusus.  Aplikasi tidak akan dapat menggunakannya jika Anda tidak memiliki akun pengembang aktif.  Setelah Anda memiliki akun pengembang, Anda dapat menetapkan tim Anda. <br><br>  Pilih <b>PrancerciseTracker</b> di Project Navigator, dan kemudian pilih <b>target PrancerciseTracker</b> .  Buka tab <b>Umum</b> dan klik bidang <b>Tim</b> . <br><br>  Pilih perintah yang terkait dengan akun pengembang Anda: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/809/a3e/af2/809a3eaf2aa966919ed95ad1f8a4be38.png" alt="gambar" width="2020" height="752"></div><br><h3>  Izin / Hak </h3><br>  HealthKit juga memiliki serangkaian haknya sendiri, dan Anda harus mengaktifkannya untuk membuat aplikasi yang menggunakan kerangka kerja. <br><br>  Buka tab <b>Capabilities</b> di editor target dan aktifkan <b>HealthKit</b> , seperti yang ditunjukkan pada gambar di bawah: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dce/374/42e/dce37442eebca83d0e6e480113dcd3fc.png" alt="gambar"><br><br>  Tunggu Xcode untuk mengkonfigurasi HealthKit untuk Anda.  Sebagai aturan, tidak ada masalah di sini, tetapi Anda masih dapat menemukan beberapa jika Anda lupa menentukan Tim dan Bundle Identifier dengan benar. <br><br>  Sekarang semuanya sudah siap.  Anda hanya perlu meminta izin kepada pengguna untuk menggunakan HealthKit. <br><br><h3>  Izin </h3><br>  HealthKit bekerja dengan data rahasia dan sensitif.  Tidak semua orang merasa nyaman untuk memungkinkan aplikasi yang diinstal mengakses informasi ini. <br><br>  Itu sebabnya HealthKit memiliki sistem privasi yang kuat.  HealthKit hanya memiliki akses ke data yang disetujui pengguna untuk dibagikan.  Untuk membuat profil untuk pengguna Prancercise Tracker Anda, Anda harus terlebih dahulu mendapatkan izin untuk mengakses setiap jenis data. <br><br><h3>  Penggunaan Deskripsi Pembaruan </h3><br>  Pertama, Anda perlu menjelaskan mengapa Anda meminta indikator kesehatan dari pengguna Anda.  <b>Xcode</b> memberi Anda kemampuan untuk menentukan ini dalam file <b>Info.plist</b> aplikasi Anda. <br><br>  Buka <b>Info.plist</b> .  Kemudian tambahkan kunci berikut: <br>  <b>Privasi</b> - <b>Keterangan Penggunaan Saham Kesehatan</b> <br>  <b>Privasi</b> - <b>Keterangan Penggunaan Pembaruan Kesehatan</b> <br><br>  Kunci-kunci ini menyimpan teks yang akan ditampilkan ketika layar login HeathKit muncul.  <b>Uraian Penggunaan Saham Kesehatan</b> mengacu pada bagian data yang harus dibaca dari HealthKit.  <b>Deskripsi Penggunaan Pembaruan Kesehatan</b> sesuai dengan data yang ditulis ke HealthKit. <br><br>  Anda dapat "menambahkan" semua yang Anda inginkan di sana.  Ini biasanya deskripsi: "Kami akan menggunakan informasi kesehatan Anda untuk melacak latihan Anda dengan lebih baik." <br><br>  Perlu diingat bahwa jika kunci ini tidak diinstal, aplikasi akan macet ketika Anda mencoba masuk ke HealthKit. <br><br><h3>  Otoritas HealthKit </h3><br>  Buka file <i>HealthKitSetupAssistant.swift</i> di dalamnya yang merupakan metode kelas yang akan Anda gunakan untuk mengotorisasi di HealthKit. <br><br><pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">authorizeHealthKit</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">completion</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">escaping</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bool</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Error</span></span></span><span class="hljs-class">?) -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Swift</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">) </span></span>{ }</code> </pre> <br>  Metode authorizeHealthKit (completion :) tidak menerima parameter apa pun, dan memiliki <b>komplain</b> yang mengembalikan boolean ( <b>sukses</b> atau <b>gagal</b> ) dan kesalahan opsional jika terjadi kesalahan.  Jika kesalahan dikembalikan, Anda akan meneruskannya ke pengaduan dalam dua kasus: <br><br><ol><li>  HealthKit mungkin tidak tersedia di perangkat Anda.  Misalnya, jika aplikasi sedang berjalan di iPad. </li><li>  Beberapa tipe data mungkin tidak tersedia di versi HealthKit saat ini. </li></ol><br>  Mari kita hancurkan proses ini.  Untuk mengotorisasi HealthKit, metode otorizeHealthKit <i>(penyelesaian :)</i> harus menyelesaikan empat langkah berikut: <br><br><ol><li>  Periksa apakah Healthkit tersedia di perangkat ini.  Jika tidak demikian, kembalikan kegagalan dan kesalahan ke komplain. </li><li>  Mempersiapkan tipe data kesehatan.  Prancercise Tracker akan membaca dan menulis ke HealthKit. </li><li>  Atur data ini ke dalam daftar tipe untuk dibaca dan tipe untuk ditulis. </li><li>  Minta otorisasi.  Jika tindakan ini berhasil, maka semua kegiatan sudah benar dan selesai dengan benar. </li></ol><br><h3>  Pemeriksaan Ketersediaan HealthKit </h3><br>  Pertama-tama, Anda perlu memeriksa ketersediaan HealthKit di perangkat. <br>  Rekatkan kode berikut di awal metode <i>authorizeHealthKit (completion :)</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//1. ,      HealthKit guard HKHealthStore.isHealthDataAvailable() else { completion(false, HealthkitSetupError.notAvailableOnDevice) return }</span></span></code> </pre><br>  Anda akan sering berinteraksi dengan <b>HKHealthStore</b> .  Ini adalah pusat penyimpanan yang menyimpan data kesehatan pengguna.  Metode <i>isHealthDataAvailable ()</i> akan membantu Anda memahami jika perangkat pengguna saat ini mendukung data Heathkit. <br><br>  Pernyataan penjaga mencegah aplikasi mengeksekusi sisa metode otorizeHealthKit <i>(selesai :)</i> jika HealthKit tidak tersedia pada perangkat.  Ketika ini terjadi, blok penyelesaian <b>disebut</b> dengan kesalahan <b>notAvailableOnDevice</b> .  Anda hanya dapat menampilkan ini ke konsol atau di pengontrol utama untuk memproses langkah lebih lanjut jika terjadi kesalahan seperti itu. <br><br><h3>  Persiapan data </h3><br>  Setelah Anda mengetahui bahwa HealthKit tersedia di perangkat pengguna, sekarang saatnya mempersiapkan jenis data yang akan dibaca dan ditulis ke HealthKit. <br>  HealthKit bekerja dengan tipe <b>HKObjectType</b> .  Setiap jenis yang masuk atau kembali ke repositori HealthKit pusat adalah jenis <b>HKObjectType</b> .  Anda juga akan melihat HKSampleType dan <b>HKWorkoutType</b> .  Keduanya mewarisi dari <b>HKObjectType</b> , jadi pada dasarnya ini adalah hal yang sama. <br><br>  Tempel cuplikan kode berikut segera setelah cuplikan kode pertama: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//2.   ,     HealthKit guard let dateOfBirth = HKObjectType.characteristicType(forIdentifier: .dateOfBirth), let bloodType = HKObjectType.characteristicType(forIdentifier: .bloodType), let biologicalSex = HKObjectType.characteristicType(forIdentifier: .biologicalSex), let bodyMassIndex = HKObjectType.quantityType(forIdentifier: .bodyMassIndex), let height = HKObjectType.quantityType(forIdentifier: .height), let bodyMass = HKObjectType.quantityType(forIdentifier: .bodyMass), let activeEnergy = HKObjectType.quantityType(forIdentifier: .activeEnergyBurned) else { completion(false, HealthkitSetupError.dataTypeNotAvailable) return }</span></span></code> </pre><br>  Wow, ini <b>penjaga</b> besar!  Ini juga merupakan contoh bagus menggunakan penjaga tunggal untuk mengambil beberapa opsi. <br><br>  Untuk membuat <b>HKObjectType</b> untuk karakteristik ini, Anda harus menggunakan <i>HKObjectType.characteristicType (forIdentifier :)</i> atau <i>HKObjectType.quantityType (forIdentifier :)</i> <br>  Tipe karakteristik dan tipe kuantitas adalah enumerasi yang ditentukan oleh framework.  HealthKit melakukan booting bersama mereka. <br><br>  Anda juga akan melihat bahwa jika satu karakteristik atau jenis seleksi tidak tersedia, metode ini akan gagal.  Ini disengaja.  Aplikasi Anda harus selalu tahu persis jenis HealthKit yang dapat digunakan, jika ada. <br><br><h3>  Mempersiapkan daftar tipe data untuk membaca dan menulis </h3><br>  Sekarang saatnya menyiapkan daftar tipe data untuk membaca dan menulis. <br>  Tempel kode ketiga ini ke metode <i>authorizeHealthKit (selesai :)</i> segera setelah bagian kedua: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//3.   ,  HealthKit     let healthKitTypesToWrite: Set&lt;HKSampleType&gt; = [bodyMassIndex, activeEnergy, HKObjectType.workoutType()] let healthKitTypesToRead: Set&lt;HKObjectType&gt; = [dateOfBirth, bloodType, biologicalSex, bodyMassIndex, height, bodyMass, HKObjectType.workoutType()]</span></span></code> </pre><br>  HealthKit mengharapkan sekumpulan objek <b>HKSampleType</b> yang mewakili tipe data yang dapat ditulis pengguna Anda, dan juga mengharapkan sekumpulan objek HKObjectType yang akan ditampilkan untuk aplikasi Anda. <br><br>  <b>HKObjectType.workoutType ()</b> adalah tipe khusus dari <b>HKObjectType</b> .  Ini adalah latihan apa saja. <br><br><h3>  Otoritas HealthKit </h3><br>  Bagian terakhir adalah yang termudah.  Anda hanya perlu meminta otorisasi dari HealthKit.  Tempel potongan kode terakhir ini: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//4.    HKHealthStore().requestAuthorization(toShare: healthKitTypesToWrite, read: healthKitTypesToRead) { (success, error) in completion(success, error) }</span></span></code> </pre><br>  Kode ini meminta otorisasi dari HealthKit, dan kemudian memanggil penyelesaian.  Mereka menggunakan variabel untuk operasi yang sukses dan kesalahan yang lulus dari <i>requestAuthorization HKHealthStore (toShare: baca: selesai :)</i> metode. <br><br>  Anda dapat menganggapnya sebagai pengalihan.  Alih-alih menangani penyelesaian di dalam HealthKitSetupAssistant, Anda meneruskan paket ke pengontrol utama, yang dapat menampilkan peringatan atau mengambil tindakan lain. <br><br>  Proyek ini sudah memiliki tombol Otorisasi HealthKit, dan ia memanggil metode <i>authorizeHealthKit ()</i> di MasterViewController.  Ini adalah tempat yang tepat untuk memanggil metode otorisasi yang baru saja kami tulis. <br><br>  Buka <b>MasterViewController.swift</b> , cari metode <i>authorizeHealthKit (</i> ) dan rekatkan kode ini: <br><br><pre> <code class="swift hljs"><span class="hljs-type"><span class="hljs-type">HealthKitSetupAssistant</span></span>.authorizeHealthKit { (authorized, error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> authorized <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> baseMessage = <span class="hljs-string"><span class="hljs-string">"HealthKit Authorization Failed"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = error { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\(baseMessage). Reason: \(error.localizedDescription)"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(baseMessage) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"HealthKit Successfully Authorized."</span></span>) }</code> </pre><br>  Kode ini menggunakan metode <i>authorizeHealthKit (completion :)</i> yang baru saja Anda terapkan.  Ketika selesai, itu akan menampilkan pesan di konsol untuk menunjukkan apakah otorisasi berhasil di HealthKit. <br><br>  Luncurkan aplikasi.  Klik Otorisasi HealthKit di jendela utama dan Anda akan melihat layar otorisasi pop-up: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ef/2bc/500/4ef2bc50015fda69b7d916b9231a5f1a.png" alt="gambar" width="281" height="500"></div><br>  Nyalakan semua sakelar, gulir untuk melihat semuanya, dan tekan <b>Izinkan</b> .  Di konsol Anda akan melihat pesan seperti ini: <br><br><pre> <code class="swift hljs"><span class="hljs-type"><span class="hljs-type">HealthKit</span></span> <span class="hljs-type"><span class="hljs-type">Successfully</span></span> <span class="hljs-type"><span class="hljs-type">Authorized</span></span>.</code> </pre><br>  <b>Hebat!</b>  Aplikasi ini memiliki akses ke repositori pusat HealthKit.  Sekarang saatnya untuk mulai melacak item. <br><br><h3>  Karakteristik dan Sampel </h3><br>  Di bagian ini Anda akan belajar: <br><br><ul><li>  Cara membaca karakteristik biologis pengguna Anda. </li><li>  Cara membaca dan menulis berbagai jenis sampel (berat, tinggi, dll.) </li></ul><br>  Karakteristik biologis, sebagai suatu peraturan, adalah jenis elemen yang tidak berubah, sama seperti golongan darah Anda.  Sampel adalah elemen yang sering berubah, seperti berat badan. <br><br>  Untuk melacak dengan benar efektivitas <b>mode</b> latihan <b>Prancercise</b> , aplikasi <b>Prancercise Tracker</b> harus menerima sampel dari berat dan tinggi pengguna.  Bersama-sama, sampel-sampel ini dapat digunakan untuk menghitung indeks massa tubuh (BMI). <br><br>  <b>Catatan:</b> <i>Indeks Massa Tubuh (IMT) adalah indikator lemak tubuh yang banyak digunakan dan dihitung berdasarkan berat dan tinggi badan seseorang.</i>  <i>Cari tahu lebih lanjut di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .</i> <br><br><h3>  Spesifikasi bacaan </h3><br>  Prancercise Tracker tidak mencatat karakteristik biologis.  Dia mendapatkannya dari HealthKit.  Ini berarti bahwa karakteristik ini harus terlebih dahulu disimpan di repositori HeathKit pusat. <br><br>  Jika Anda belum melakukannya, sekarang saatnya untuk memberi tahu <b>HeathKit</b> lebih banyak tentang diri Anda. <br><br>  Buka aplikasi Kesehatan di perangkat atau simulator Anda.  Pilih tab Data Kesehatan.  Kemudian klik ikon profil di sudut kanan atas untuk melihat profil kesehatan Anda.  Klik <b>Edit</b> dan masukkan tanggal lahir, jenis kelamin, golongan informasi: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/324/285/ea4/324285ea449bb8049ff166c1e83ec76f.png" alt="gambar" width="1732" height="1540"></div><br>  Sekarang <b>HealthKit</b> mengetahui tanggal lahir, jenis kelamin, dan golongan darah Anda, sekarang saatnya untuk membaca fitur-fitur ini di <b>Prancercise Tracker</b> . <br><br>  Kembali ke <b>Xcode</b> dan buka <i>ProfileDataStore.swift</i> .  Kelas <b>ProfileDataStore</b> mewakili titik akses Anda ke semua data terkait kesehatan untuk pengguna Anda. <br><br>  Tempel metode berikut ke <b>ProfileDataStore</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getAgeSexAndBloodType</span></span></span><span class="hljs-class">() </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">throws</span></span></span><span class="hljs-class"> -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">age</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Int</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">biologicalSex</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKBiologicalSex</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bloodType</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKBloodType</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> healthKitStore = <span class="hljs-type"><span class="hljs-type">HKHealthStore</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-comment"><span class="hljs-comment">//1. This method throws an error if these data are not available. let birthdayComponents = try healthKitStore.dateOfBirthComponents() let biologicalSex = try healthKitStore.biologicalSex() let bloodType = try healthKitStore.bloodType() //2. Use Calendar to calculate age. let today = Date() let calendar = Calendar.current let todayDateComponents = calendar.dateComponents([.year], from: today) let thisYear = todayDateComponents.year! let age = thisYear - birthdayComponents.year! //3. Unwrap the wrappers to get the underlying enum values. let unwrappedBiologicalSex = biologicalSex.biologicalSex let unwrappedBloodType = bloodType.bloodType return (age, unwrappedBiologicalSex, unwrappedBloodType) } }</span></span></code> </pre><br>  Metode <i>getAgeSexAndBloodType ()</i> memanggil <b>HKHealthStore</b> , menanyakan tanggal lahir, jenis kelamin, dan golongan darah pengguna.  Ini juga menghitung usia pengguna menggunakan tanggal lahir. <br><br><ol><li>  Anda mungkin telah memperhatikan bahwa metode ini dapat menyebabkan kesalahan.  Ini terjadi ketika tanggal lahir, jenis kelamin atau golongan darah belum disimpan di repositori pusat HealthKit.  Karena Anda baru saja memasukkan informasi ini di aplikasi Anda, Anda seharusnya tidak menyebabkan kesalahan. </li><li>  Menggunakan kelas <b>Kalender</b> , Anda dapat mengonversi tanggal apa pun menjadi satu set <b>Komponen Tanggal</b> .  Ini benar-benar nyaman ketika Anda ingin mendapatkan satu tahun untuk kencan.  Kode ini hanya mendapatkan tahun kelahiran Anda, tahun ini, dan kemudian menghitung perbedaannya. </li><li>  Variabel "diperluas" dinamai sedemikian rupa sehingga jelas bahwa Anda perlu mengakses enumerasi dasar dari kelas wrapper ( <b>HKBiologicalSexObject</b> dan <b>HKBloodTypeObject</b> ). </li></ol><br><h3>  Pembaruan UI </h3><br>  Jika sekarang Anda mengkompilasi dan menjalankan aplikasi, Anda tidak akan melihat perubahan apa pun di antarmuka pengguna, karena Anda belum menghubungkan logika ini ke sana. <br>  Buka <b>ProfileViewController.swif</b> t dan temukan metode <i>loadAndDisplayAgeSexAndBloodType (</i> ) <br><br>  Metode ini akan menggunakan <b>ProfileDataStore</b> Anda untuk memuat karakteristik biologis ke antarmuka pengguna. <br><br>  Rekatkan kode berikut ini ke metode <i>loadAndDisplayAgeSexAndBloodType ()</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> userAgeSexAndBloodType = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.getAgeSexAndBloodType() userHealthProfile.age = userAgeSexAndBloodType.age userHealthProfile.biologicalSex = userAgeSexAndBloodType.biologicalSex userHealthProfile.bloodType = userAgeSexAndBloodType.bloodType updateLabels() } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: error) }</code> </pre><br>  Blok kode ini memuat usia, jenis kelamin, dan golongan darah sebagai tupel.  Dia kemudian menetapkan bidang ini dalam contoh lokal model UserHealthProfile.  Akhirnya, itu memperbarui antarmuka pengguna dengan bidang baru di <b>UserHealthProfile</b> dengan memanggil metode <i>updateLabels ()</i> . <br><br>  Karena metode <i>ProfileDataStore getAgeSexAndBloodType ()</i> dapat menimbulkan kesalahan, <b>ProfileViewController</b> harus menanganinya.  Dalam hal ini, Anda hanya mengambil kesalahan dan menyajikannya sebagai peringatan. <br><br>  Semua ini bagus, tetapi ada satu tangkapan.  Metode <i>updateLabels ()</i> belum <i>melakukan</i> apa <i>-</i> apa.  Ini hanya iklan kosong.  Kali ini, mari kita beralih ke antarmuka pengguna. <br><br>  Temukan metode <i>updateLabels ()</i> dan rekatkan kode ini ke dalamnya: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> age = userHealthProfile.age { ageLabel.text = <span class="hljs-string"><span class="hljs-string">"\(age)"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> biologicalSex = userHealthProfile.biologicalSex { biologicalSexLabel.text = biologicalSex.stringRepresentation } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bloodType = userHealthProfile.bloodType { bloodTypeLabel.text = bloodType.stringRepresentation }</code> </pre><br>  Kode ini cukup sederhana.  Jika pengguna telah menetapkan usia, itu akan diformat menjadi label.  Hal yang sama berlaku untuk jenis kelamin biologis dan golongan darah.  Variabel stringRepresentation mengubah enumerasi menjadi string untuk tujuan tampilan. <br><br>  Kompilasi dan jalankan aplikasi.  Pergi ke layar Profile &amp; BMI.  Klik tombol Baca Data HealthKit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e13/3a5/ed1/e133a5ed1cd1d13016f28cc1a3452af9.png" alt="gambar" width="281" height="500"></div><br>  Jika sebelumnya Anda memasukkan informasi dalam aplikasi, itu akan muncul di pintasan di layar ini.  Jika Anda belum melakukannya, pesan kesalahan akan muncul. <br><br>  Wow!  Anda membaca dan menampilkan data langsung dari <b>HealthKit</b> . <br><br><h3>  Sampel Pertanyaan </h3><br>  Sekarang saatnya untuk membaca berat dan tinggi pengguna.  Mereka akan digunakan untuk menghitung dan menampilkan BMI dalam tampilan profil. <br><br>  Karakteristik biologis sudah tersedia karena mereka hampir tidak pernah berubah.  Sampel memerlukan pendekatan yang jauh lebih kompleks.  Mereka menggunakan <b>HKQuery</b> , lebih tepatnya <b>HKSampleQuery</b> . <br><br>  Untuk meminta sampel dari HealthKit, Anda perlu: <br><br><ol><li>  Tentukan jenis sampel yang ingin Anda minta (berat, tinggi, dll.), </li><li>  Beberapa opsi tambahan yang membantu memfilter dan mengurutkan data.  Untuk melakukan ini, Anda dapat melewati <b>NSPredicate</b> opsional atau array <b>NSSortDescriptors</b> . </li></ol><br>  <b>Catatan:</b> <i>Jika Anda terbiasa dengan CoreData, Anda mungkin memperhatikan beberapa kesamaan.</i>  <i><b>HKSampleQuery</b> sangat mirip dengan <b>NSFetchedRequest</b> untuk tipe objek, di mana Anda menentukan predikat dan mengurutkan deskriptor, lalu mengatur konteks objek untuk mengeksekusi kueri untuk mendapatkan hasil.</i> <br><br>  Setelah kueri Anda diatur, Anda cukup memanggil metode <b>HKHealthStore</b> <i>ExecuteQuery ()</i> untuk mendapatkan hasilnya. <br><br>  Untuk <b>Prancercise Tracker,</b> Anda akan membuat fungsi tunggal universal yang mengunduh sampel terbaru dari jenis apa pun.  Dengan demikian, Anda dapat menggunakannya untuk berat dan tinggi badan. <br><br>  Buka <b>ProfileDataStore.swift</b> dan tempel metode berikut ke dalam kelas, tepat di bawah metode <i>getAgeSexAndBloodType ()</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getMostRecentSample</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sampleType</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKSampleType</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">completion</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">escaping</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKQuantitySample</span></span></span><span class="hljs-class">?, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Error</span></span></span><span class="hljs-class">?) -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Swift</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1.  HKQuery    . let mostRecentPredicate = HKQuery.predicateForSamples(withStart: Date.distantPast, end: Date(), options: .strictEndDate) let sortDescriptor = NSSortDescriptor(key: HKSampleSortIdentifierStartDate, ascending: false) let limit = 1 let sampleQuery = HKSampleQuery(sampleType: sampleType, predicate: mostRecentPredicate, limit: limit, sortDescriptors: [sortDescriptor]) { (query, samples, error) in //2.       . DispatchQueue.main.async { guard let samples = samples, let mostRecentSample = samples.first as? HKQuantitySample else { completion(nil, error) return } completion(mostRecentSample, nil) } } HKHealthStore().execute(sampleQuery) }</span></span></code> </pre><br>  Metode ini menggunakan jenis sampel (tinggi, berat, BMI, dll.).  Dia kemudian membuat kueri untuk mengambil sampel terakhir untuk jenis ini.  Jika Anda melihat jenis sampel untuk pertumbuhan, Anda akan kembali ke catatan pertumbuhan terakhir Anda. <br><br>  Banyak yang terjadi di sini.  Saya akan berhenti menjelaskan beberapa hal. <br><br><ol><li>  Ada beberapa metode dalam <b>HKQuery</b> yang dapat membantu Anda memfilter contoh kueri HealthKit Anda.  Dalam hal ini, kami menggunakan predikat tanggal bawaan. </li><li>  Meminta sampel dari HealthKit adalah proses yang tidak sinkron.  Inilah sebabnya mengapa kode dalam handler penyelesaian ditemukan di dalam blok Pengiriman.  Kepatuhan diperlukan di utas utama.  Jika tidak, aplikasi akan gagal. </li></ol><br>  Jika semuanya berjalan dengan baik, permintaan Anda akan dieksekusi dan Anda akan mendapatkan sampel yang rapi dikembalikan pada utas <b>utama</b> , di mana <b>ProfileViewController</b> dapat meletakkan kontennya di label.  Mari kita lakukan bagian ini sekarang. <br><br><h3>  Menampilkan sampel di antarmuka pengguna </h3><br>  Di bagian sebelumnya, Anda mengunduh data dari <b>HealthKit</b> .  Simpan sebagai model di <b>ProfileViewController</b> , lalu perbarui konten dalam baris menggunakan metode <i>ProfileViewController updateLabels ()</i> <br><br>  Yang harus Anda lakukan adalah memperluas proses ini dengan menambahkan fungsi yang memuat sampel, memprosesnya untuk antarmuka pengguna, dan kemudian memanggil <i>updateLabels ()</i> untuk mengisi label dengan teks. <br><br>  Buka file <i>ProfileViewController.swift</i> , cari metode <i>loadAndDisplayMostRecentHeight (</i> ) dan rekatkan kode berikut: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//1.  HealthKit      guard let heightSampleType = HKSampleType.quantityType(forIdentifier: .height) else { print("Height Sample Type is no longer available in HealthKit") return } ProfileDataStore.getMostRecentSample(for: heightSampleType) { (sample, error) in guard let sample = sample else { if let error = error { self.displayAlert(for: error) } return } //2.     ,   , //    . let heightInMeters = sample.quantity.doubleValue(for: HKUnit.meter()) self.userHealthProfile.heightInMeters = heightInMeters self.updateLabels() }</span></span></code> </pre><br><ol><li>  Metode ini dimulai dengan membuat jenis sampel pertumbuhan.  Dia kemudian meneruskan jenis sampel ini ke metode yang baru saja Anda tulis, yang akan mengembalikan sampel pertumbuhan pengguna terbaru yang dicatat dalam HealthKit. </li><li>  Segera setelah sampel kembali, pertumbuhan dikonversi ke meter dan disimpan dalam model UserHealthProfile.  Kemudian <b>UI</b> akan memperbarui. </li></ol><br>  <b>Catatan:</b> <i>Biasanya Anda ingin mengkonversi sampel kuantitas ke unit standar.</i>  <i>Untuk melakukan ini, kode di atas menggunakan metode <i>doubleValue (for :)</i> , yang memungkinkan Anda untuk <b>meneruskan</b> data yang relevan yang Anda butuhkan (dalam hal ini, meter) ke <b>HKUnit</b> .</i> <i><br><br></i>  <i>Anda dapat membuat berbagai jenis <b>HKUnits</b> menggunakan beberapa metode kelas umum yang tersedia melalui <b>HealthKit</b> .</i>  <i>Untuk mendapatkan penghitung, Anda cukup menggunakan metode meter () di <b>HKUnit</b> , dan itulah yang Anda butuhkan.</i> <br><br>  Dengan pertumbuhan disortir.  Bagaimana dengan beratnya?  Semuanya sangat mirip, tetapi Anda harus mengisi metode <i>loadAndDisplayMostRecentWeight ()</i> di <b>ProfileViewController</b> . <br><br>  Rekatkan kode berikut ke dalam metode <i>loadAndDisplayMostRecentWeight ()</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightSampleType = <span class="hljs-type"><span class="hljs-type">HKSampleType</span></span>.quantityType(forIdentifier: .bodyMass) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Body Mass Sample Type is no longer available in HealthKit"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.getMostRecentSample(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: weightSampleType) { (sample, error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sample = sample <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = error { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: error) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightInKilograms = sample.quantity.doubleValue(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: <span class="hljs-type"><span class="hljs-type">HKUnit</span></span>.gramUnit(with: .kilo)) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.userHealthProfile.weightInKilograms = weightInKilograms <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.updateLabels() }</code> </pre><br>  Anda membuat jenis sampel yang ingin Anda terima, meminta <b>HealthKit</b> untuk itu, melakukan beberapa konversi unit, menyimpannya dalam model Anda dan memperbarui antarmuka pengguna. <br><br>  Saat ini, itu dapat menunjukkan bahwa pekerjaan sudah selesai, tetapi ada hal lain.  Fungsi <i>updateLabels ()</i> tidak mengetahui data baru yang Anda sediakan untuk itu. <br><br>  Mari kita perbaiki. <br><br>  Tambahkan baris berikut ke fungsi <i>updateLabels ()</i> , tepat di bawah bagian tempat Anda memperluas golongan darah untuk menampilkannya di antarmuka pengguna: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weight = userHealthProfile.weightInKilograms { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightFormatter = <span class="hljs-type"><span class="hljs-type">MassFormatter</span></span>() weightFormatter.isForPersonMassUse = <span class="hljs-literal"><span class="hljs-literal">true</span></span> weightLabel.text = weightFormatter.string(fromKilograms: weight) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> height = userHealthProfile.heightInMeters { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> heightFormatter = <span class="hljs-type"><span class="hljs-type">LengthFormatter</span></span>() heightFormatter.isForPersonHeightUse = <span class="hljs-literal"><span class="hljs-literal">true</span></span> heightLabel.text = heightFormatter.string(fromMeters: height) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bodyMassIndex = userHealthProfile.bodyMassIndex { bodyMassIndexLabel.text = <span class="hljs-type"><span class="hljs-type">String</span></span>(format: <span class="hljs-string"><span class="hljs-string">"%.02f"</span></span>, bodyMassIndex) }</code> </pre><br>  Mengikuti templat asli dalam fungsi <i>updateLabels ()</i> , ia memperluas tinggi, berat, dan indeks massa tubuh dalam model <b>UserHealthProfile</b> Anda.  Jika tersedia, mereka menghasilkan garis yang sesuai dan menetapkannya ke label di layar pengguna. <br><br>  <b>MassFormatter</b> dan <b>LengthFormatter</b> melakukan pekerjaan mengubah nilai Anda menjadi string. <br><br>  Indeks massa tubuh sebenarnya tidak disimpan dalam model <b>UserHealthProfile</b> .  Ini adalah properti yang dihitung yang melakukan perhitungan untuk Anda. <br><br>  Klik pada properti <b>bodyMassIndex</b> dan Anda akan melihat apa yang saya maksud: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bodyMassIndex: <span class="hljs-type"><span class="hljs-type">Double?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightInKilograms = weightInKilograms, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> heightInMeters = heightInMeters, heightInMeters &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (weightInKilograms/(heightInMeters*heightInMeters)) }</code> </pre><br>  Indeks massa tubuh adalah properti opsional, yaitu, ia dapat mengembalikan nol jika Anda tidak menentukan tinggi atau berat badan (atau jika mereka diatur ke beberapa nomor yang tidak masuk akal).  Perhitungan yang sebenarnya hanyalah berat dibagi dengan tinggi kuadrat. <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan: </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Segera Anda akan membenamkan diri dalam semua ini jika Anda belum menambahkan data ke </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk dibaca oleh aplikasi. Jika Anda belum melakukannya, Anda harus membuat sampel tinggi dan berat badan, setidaknya. </font></font></i> <br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buka aplikasi Kesehatan dan buka tab Data Kesehatan. Di sana, pilih parameter Pengukuran Tubuh, lalu pilih Berat dan kemudian Tambahkan Data Point untuk menambahkan sampel berat baru. Ulangi proses untuk pertumbuhan.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pada titik ini, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pelacak Prancercise</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> harus dapat membaca sampel terbaru dari berat dan tinggi pengguna Anda, dan kemudian menampilkannya dalam teks. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kompilasi dan jalankan aplikasi. Buka </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profil &amp; BMI</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Kemudian klik tombol </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Baca Data HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/841/d4d/35d/841d4d35d54528b5578fe32a3b163c0a.png" alt="gambar" width="281" height="500"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luar biasa! </font><font style="vertical-align: inherit;">Anda baru saja membaca sampel pertama Anda dari repositori </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan menggunakannya untuk menghitung BMI.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Menyimpan Sampel </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prancercise Tracker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sudah memiliki indeks massa tubuh kalkulator berguna. </font><font style="vertical-align: inherit;">Mari kita gunakan untuk merekam sampel BMI pengguna Anda. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buka </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProfileDataStore.swift</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan tambahkan metode berikut:</font></font><br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">saveBodyMassIndexSample</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bodyMassIndex</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Double</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Date</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1. ,      guard let bodyMassIndexType = HKQuantityType.quantityType(forIdentifier: .bodyMassIndex) else { fatalError("Body Mass Index Type is no longer available in HealthKit") } //2.   HKUnit     let bodyMassQuantity = HKQuantity(unit: HKUnit.count(), doubleValue: bodyMassIndex) let bodyMassIndexSample = HKQuantitySample(type: bodyMassIndexType, quantity: bodyMassQuantity, start: date, end: date) //3.      HealthKit HKHealthStore().save(bodyMassIndexSample) { (success, error) in if let error = error { print("Error Saving BMI Sample: \(error.localizedDescription)") } else { print("Successfully saved BMI Sample") } } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Seperti jenis sampel lainnya, Anda harus terlebih dahulu memastikan bahwa jenis sampel tersedia di </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dalam hal ini, kode memeriksa apakah ada </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jenis kuantitas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk indeks massa tubuh. </font><font style="vertical-align: inherit;">Jika demikian, maka itu digunakan untuk membuat sampel kuantitas. </font><font style="vertical-align: inherit;">Jika tidak, aplikasi berhenti berfungsi.</font></font></li><li>  <i>count()</i>  <b>HKUnit</b>    ,       ,   .  -      ,    ,           . </li><li> <b>HKHealthStore</b>     ,        .      ,        . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hampir selesai. Untuk meringkas antarmuka pengguna. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buka </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProfileViewController.swif</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , temukan metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saveBodyMassIndexToHealthKit (</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Metode ini dipanggil ketika pengguna mengklik tombol Simpan BMI di tabel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Rekatkan kode berikut ke dalam metode:</font></font><br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bodyMassIndex = userHealthProfile.bodyMassIndex <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: <span class="hljs-type"><span class="hljs-type">ProfileDataError</span></span>.missingBodyMassIndex) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.saveBodyMassIndexSample(bodyMassIndex: bodyMassIndex, date: <span class="hljs-type"><span class="hljs-type">Date</span></span>())</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda ingat bahwa indeks massa tubuh adalah properti yang dihitung yang mengembalikan nilai ketika sampel tinggi dan berat diambil dari </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Kode ini mencoba menghitung properti ini, dan jika memungkinkan, ia akan diteruskan ke metode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saveBodyMassIndexSample (bodyMassIndex: date :)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> yang </font><font style="vertical-align: inherit;">baru saja Anda tulis. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ini juga menunjukkan peringatan yang nyaman jika indeks massa tubuh tidak dapat dihitung karena alasan apa pun. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kompilasi dan jalankan aplikasi. Pergi ke layar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profile &amp; BMI</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Unduh data dari </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HeathKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , lalu klik tombol Simpan BMI. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lihatlah konsolnya. Apakah kamu melihatnya?</font></font><br><br><pre> <code class="swift hljs">   <span class="hljs-type"><span class="hljs-type">BMI</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jika demikian, selamat! </font><font style="vertical-align: inherit;">Sampel BMI Anda sekarang disimpan di repositori pusat </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Mari kita lihat apakah kita dapat menemukannya. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Buka aplikasi Kesehatan, ketuk tab Data Kesehatan, klik Pengukuran Tubuh pada tampilan tabel, lalu klik Indeks Massa Tubuh.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/953/802/724/953802724c0ccad14b5184bd8b01b17f.png" alt="gambar" width="281" height="500"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id434978/">https://habr.com/ru/post/id434978/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../In144568/index.html">डेटा वेयरहाउस मेट्रिक्स</a></li>
<li><a href="../In144569/index.html">ड्रैगन स्पेसएक्स सफलतापूर्वक आईएसएस तक पहुंच गया</a></li>
<li><a href="../In144571/index.html">एक उत्तल बहुभुज में एक बिंदु का स्थानीयकरण</a></li>
<li><a href="../In144572/index.html">संभावित चश्मा लीक हो गया</a></li>
<li><a href="../In144573/index.html">रेटिना डिस्प्ले वाले उपयोगकर्ताओं के लिए साइट पर बड़ी छवियां - retina.js</a></li>
<li><a href="../id434968/index.html">Sesuatu tentang namespace</a></li>
<li><a href="../id434970/index.html">Tentang bisnis TI dan banyak lagi</a></li>
<li><a href="../id434972/index.html">Cara menulis unit test jika Anda tidak menyukainya sama sekali</a></li>
<li><a href="../id434974/index.html">Bekerja dengan format konfigurasi 1C: Enterprise</a></li>
<li><a href="../id434976/index.html">Fablab ITMO University: DIY-rekan kerja untuk orang-orang kreatif - tunjukkan apa yang ada di dalamnya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>