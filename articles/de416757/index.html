<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìã üßëüèΩ‚Äçü§ù‚Äçüßëüèª üïí Flockige Tests üöñ ü§¶üèΩ üõÄüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Was ist unangenehmer als der "rote Test"? Der Test ist entweder gr√ºn oder rot und es ist nicht klar warum. Auf unserer Heisenbug 2017 in Moskau sprach...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Flockige Tests</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/416757/">  Was ist unangenehmer als der "rote Test"?  Der Test ist entweder gr√ºn oder rot und es ist nicht klar warum.  Auf unserer Heisenbug 2017 in Moskau sprach <b>Andrei</b> Solntsev (Codeborne) dar√ºber, warum sie entstehen k√∂nnten und wie sie ihre Anzahl reduzieren k√∂nnten.  Beispiele in seinem Bericht sind solche, dass Sie den Schmerz direkt in der Haut f√ºhlen, wenn Sie mit ihnen kollidieren.  Die Tipps sind n√ºtzlich - und es lohnt sich, sowohl Tester als auch Entwickler kennenzulernen.  Es gibt etwas Unerwartetes: Sie k√∂nnen herausfinden, wie manchmal Sie ein Problem herausfinden k√∂nnen, wenn Sie sich vom Bildschirm l√∂sen und mit Ihrer Tochter W√ºrfel spielen. <br><br>  Infolgedessen sch√§tzte das Publikum den Bericht und wir beschlossen, nicht nur das Video zu ver√∂ffentlichen, sondern auch eine Textversion des Berichts f√ºr Habr zu erstellen. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/jLG3RXECQU8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="habracut"></a><br>  Flockentests sind meiner Meinung nach das relevanteste Thema in der Welt der Automatisierung.  Denn die Frage "Was wird in der Welt gemacht, wie geht es Ihnen mit Automatisierung?"  Alle antworten: ‚ÄûEs gibt keine Stabilit√§t!  Unsere Tests fallen regelm√§√üig. ‚Äú <br><br>  Sie haben einen Test bei Ihnen durchgef√ºhrt, es ist gr√ºn, noch zwei Tage gr√ºn, und dann einmal und pl√∂tzlich auf Jenkins gefallen.  Sie versuchen es zu wiederholen, starten es und es ist wieder gr√ºn.  Und am Ende wei√ü man nie: Ist es ein Fehler oder ist es nur ein Glucan-Test?  Und jedes Mal, wenn Sie verstehen m√ºssen. <br><br>  Oft sieht der Tester nach einem n√§chtlichen Start von Tests an Jenkins zuerst "30 Tests sind gefallen, Sie m√ºssen lernen", aber jeder wei√ü, was als n√§chstes passiert ... <br><br><img src="https://habrastorage.org/webt/fz/vg/jh/fzvgjhfo6snzfs6qa0d9clltgcc.jpeg"><br><br>  Sie haben nat√ºrlich erraten, welches unanst√§ndige Wort getarnt ist: "Ich werde neu starten."  "Heute gibt es keine Abneigung zu verstehen ..." So passiert es normalerweise und es ist eine echte Katastrophe. <br><br>  Es gibt keine genauen Statistiken, aber ich habe oft von verschiedenen Leuten geh√∂rt, dass sie ungef√§hr 30% der Tests haben - schuppig.  Grob gesagt starten sie tausend, von denen 300 regelm√§√üig rot sind, und pr√ºfen dann mit ihren H√§nden, ob sie tats√§chlich gefallen sind. <br><br>  Google hat vor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ein</a> paar Jahren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen Artikel</a> ver√∂ffentlicht: Es hei√üt, dass sie 1,5% der Flockentests haben und wie sie k√§mpfen, um ihre Anzahl zu reduzieren.  Ich kann ein wenig prahlen und sagen, dass mein Projekt bei Codeborne jetzt 0,1% betr√§gt.  Aber in der Tat ist das alles schlecht, sogar 0,1%.  Warum? <br><br>  Nehmen Sie 1,5%, diese Zahl scheint klein, aber was bedeutet es in der Praxis?  Angenommen, ein Projekt enth√§lt tausend Tests.  Dies kann bedeuten, dass 15 Tests in einem Build gefallen sind, die n√§chsten 12, dann 18. Und das ist schrecklich schlecht, weil in diesem Fall fast alle Builds rot sind und Sie st√§ndig mit Ihren H√§nden pr√ºfen m√ºssen, ob es wahr ist oder nicht. <br><br>  Und selbst unsere 1 ppm (0,1%) sind immer noch schlecht.  Angenommen, wir haben 1000 Tests, dann bedeutet 0,1%, dass regelm√§√üig einer von zehn St√ºrzen mit 1-2 roten Tests f√§llt.  Hier ist das wirkliche Bild von unseren Jenkins, und es stellt sich heraus: Mit einem Lauf fiel ein Flockentest, mit einem anderen Start ein anderer. <br><br><img src="https://habrastorage.org/webt/dv/gx/da/dvgxdacsvc67zygojg18pu50v-q.jpeg"><br><br>  Es stellt sich heraus, dass wir keinen Tag ohne roten K√∂rperbau haben.  Da es viel Gr√ºn gibt, scheint alles in Ordnung zu sein, aber der Kunde hat das Recht, uns zu fragen: "Leute, wir zahlen dir Geld und du versorgst uns immer mit Rot!"  Was machst du? " <br><br>  Ich w√§re beim Kunden unzufrieden, und zu erkl√§ren, "im Allgemeinen ist das in der Branche normal, alles ist f√ºr alle rot", ist nicht gut, oder?  Daher ist dies meiner Meinung nach ein sehr dringendes Problem, und wir sollten gemeinsam verstehen, wie wir damit umgehen sollen. <br><br>  Der Plan ist folgender: <br><br><ol><li>  Meine Sammlung instabiler Tests (aus meiner Praxis, absolut reale F√§lle, komplexe und interessante Detektivgeschichten) </li><li>  Ursachen der Instabilit√§t (einige haben sogar Jahre gebraucht, um zu forschen) </li><li>  Wie gehe ich mit ihnen um?  (hoffentlich ist dies der n√ºtzlichste Teil) </li></ol><br>  Beginnen wir also mit meiner Sammlung, die ich sehr sch√§tze: Sie hat mich viele Nachtstunden Leben und Debuggen gekostet.  Beginnen wir mit einem einfachen Beispiel. <br><br><h2>  Beispiel 1: klassisch </h2><br>  F√ºr Saatgut - das klassische Selenium-Skript: <br><br><pre><code class="java hljs">driver.navigate().to(<span class="hljs-string"><span class="hljs-string">"https://www.google.com/"</span></span>); driver.findElement(By.name(<span class="hljs-string"><span class="hljs-string">"q"</span></span>)).sendKeys(<span class="hljs-string"><span class="hljs-string">"selenide"</span></span>); driver.findElement(By.name(<span class="hljs-string"><span class="hljs-string">"btnK"</span></span>)).click(); assertEquals(<span class="hljs-number"><span class="hljs-number">9</span></span>, driver.findElements(By.cssSelector(<span class="hljs-string"><span class="hljs-string">"#ires .g"</span></span>)).size());</code> </pre> <br><ol><li>  Wir √∂ffnen WebDriver. </li><li>  Suchen Sie das Element q, geben Sie das Wort ein, um dort zu suchen. </li><li>  Suchen Sie das Element "Button" und klicken Sie auf. </li><li>  √úberpr√ºfen Sie, ob die Antwort neun Ergebnisse enth√§lt. </li></ol><br>  Frage: Welche Linie kann hier brechen? <br><br>  Das stimmt, wir alle wissen genau, dass es welche gibt!  Jede Linie kann aus ganz anderen Gr√ºnden brechen: <br><br>  Die erste Zeile ist das langsame Internet, der Dienst ist abgest√ºrzt, die Administratoren haben nichts konfiguriert. <br><br>  Die zweite Zeile - das Element hatte noch keine Zeit zum Rendern, wenn es dynamisch gezeichnet wird. <br>  Was k√∂nnte in der dritten Zeile brechen?  Hier war es f√ºr mich unerwartet: Ich habe diesen Test f√ºr die Konferenz geschrieben, ihn lokal ausgef√ºhrt und er ist mit diesem Fehler in die dritte Zeile gefallen: <br><br><img src="https://habrastorage.org/webt/8n/qu/4l/8nqu4l-8byopdwjdkbcrcgkhery.jpeg"><br><br>  Dies besagt, dass das Element an dieser Stelle nicht anklickbar ist.  Es scheint ein einfaches grundlegendes Google-Formular zu sein.  Das Geheimnis war, dass wir in der zweiten Zeile das Wort getroffen haben und Google bei der Eingabe bereits die ersten Ergebnisse gefunden, die ersten Ergebnisse in einem solchen Popup angezeigt und die n√§chste Schaltfl√§che geschlossen hat.  Und das passiert nicht in allen Browsern und nicht immer.  Das ist mir mit diesem Skript ungef√§hr einmal von f√ºnf passiert. <br><br>  Die vierte Linie kann beispielsweise fallen, weil dieses Element dynamisch gezeichnet wird und noch keine Zeit zum Zeichnen hatte. <br><br>  In diesem Beispiel m√∂chte ich sagen, dass meiner Erfahrung nach 90% der Flockentests auf denselben Gr√ºnden beruhen: <br><br><ul><li>  Ajax-Anforderungsgeschwindigkeit: Manchmal laufen sie langsamer, manchmal schneller. </li><li>  Die Reihenfolge der Ajax-Anfragen; </li><li>  Geschwindigkeit js. </li></ul><br>  Gl√ºcklicherweise gibt es aus diesen Gr√ºnden eine Heilung!  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Selenid</a> l√∂st diese Probleme.  Wie entscheidet es?  Wir schreiben unseren Google-Test auf Selenide neu - fast alles sieht so aus, nur die $ -Zeichen werden verwendet: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userCanLogin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ open(‚Äúhttp:<span class="hljs-comment"><span class="hljs-comment">//localhost:8080/login‚Äù); $(By.name(‚Äúusername‚Äù).setValue(‚Äújohn‚Äù); $(‚Äú#submit‚Äù).click(); $(‚Äú.menu‚Äù).shouldHave(text(‚ÄúHello, John!‚Äù)); }</span></span></code> </pre><br>  Dieser Test besteht immer.  Aufgrund der Tatsache, dass die Methoden setValue (), click () und shouldHave () intelligent sind: Wenn etwas keine Zeit zum Malen hat, warten sie etwas und versuchen es erneut (dies wird als "intelligente Erwartungen" bezeichnet). <br><br>  Wenn Sie etwas genauer hinschauen, sollten alle diese Methoden klug sein: <br><br><img src="https://habrastorage.org/webt/gq/x8/uq/gqx8uq3gjj6wudrx0n3uajntzdy.jpeg"><br><br>  Sie k√∂nnen bei Bedarf warten.  Standardm√§√üig warten sie bis zu 4 Sekunden, und dieses Zeitlimit ist nat√ºrlich konfigurierbar. Sie k√∂nnen jedes andere angeben.  Beispiel: mvn -Dselenide.timeout = 8000. <br><br><h2>  Beispiel 2: nbob </h2><br>  So werden 90% der Probleme mit Flockentests mit Selenide gel√∂st.  10% der viel komplexeren F√§lle haben jedoch weiterhin komplexe und verwirrende Gr√ºnde.  Genau √ºber sie m√∂chte ich heute sprechen, weil es so eine ‚ÄûGrauzone‚Äú ist.  Lassen Sie mich ein Beispiel geben: einen Flockentest, auf den ich in einem neuen Projekt sofort gesto√üen bin.  Auf den ersten Blick kann das einfach nicht passieren, aber das ist etwas Interessantes. <br><br>  Wir haben die Tastaturanwendung f√ºr die Anmeldung an Kiosken getestet.  Der Test wollte sich als Benutzer "bob" anmelden, dh drei Buchstaben in das Feld "login" eingeben: bob.  Dazu wurden die Schaltfl√§chen auf dem Bildschirm verwendet.  In der Regel funktionierte dies, aber manchmal st√ºrzte der Test ab und der Wert "nbob" blieb im Feld "login": <br><br><img src="https://habrastorage.org/webt/7u/hp/zs/7uhpzsf9wrppgubv_cra_ldg2ri.jpeg"><br><br>  Nat√ºrlich haben Sie Schwierigkeiten, nach dem Code zu suchen, in den wir "nbob" h√§tten schreiben k√∂nnen - aber im gesamten Projekt ist dies √ºberhaupt nicht der Fall (weder in der Datenbank noch im Code oder sogar in Excel-Dateien).  Wie ist das m√∂glich? <br><br>  Wir schauen uns den Code genauer an - es scheint, dass alles einfach ist, keine R√§tsel: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loginKiosk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ open(‚Äúhttp:<span class="hljs-comment"><span class="hljs-comment">//localhost:9000/kiosk‚Äù); $(‚Äúbody‚Äù).click(); $(By.name(‚Äúusername‚Äù)).sendKeys(‚Äúbob‚Äù); $(‚Äú#login‚Äù).click(); }</span></span></code> </pre><br>  Wir begannen weiter zu debattieren, Schritt f√ºr Schritt, und mit dieser Methode gelang es uns zu verstehen: Dieser Fehler erscheint manchmal nach der Zeile $ (‚Äûbody‚Äú). Click ().  Das hei√üt, in diesem Schritt wird "n" im Feld "Login" angezeigt, und in den folgenden Schritten wird "bob" hinzugef√ºgt.  Wer hat schon erraten, woher "n" kommt? <br><br>  So kam es, dass sich der Buchstabe N in der Mitte des Bildschirms befand und die Funktion click () zumindest in Chrome folgenderma√üen funktioniert: Sie berechnet die zentrale Koordinate eines Elements und klickt darauf.  Da der K√∂rper ein gro√ües Element ist, klickte sie in die Mitte des gesamten Bildschirms. <br><br><img src="https://habrastorage.org/webt/56/xh/k_/56xhk_clrm85lqkyn-wqeaa5hg4.jpeg"><br><br>  Und das ist nicht immer gefallen.  Wer wei√ü warum?  Tats√§chlich wei√ü ich es selbst nicht ganz.  M√∂glicherweise aufgrund der Tatsache, dass das Browserfenster st√§ndig in verschiedenen Gr√∂√üen ge√∂ffnet wurde und dies nicht immer in den Buchstaben N fiel. <br><br>  Sie haben wahrscheinlich eine Frage: Warum hat jemand $ ("body") gemacht. Click ()?  Ich wei√ü es auch nicht bis zum Ende, aber ich nehme an, den Fokus vom Feld zu entfernen.  In Selenium gibt es ein solches Problem, dass click () ist, unclick () jedoch nicht.  Wenn das Feld einen Fokus enth√§lt, kann dieser nicht entfernt werden. Sie k√∂nnen nur auf ein anderes Element klicken.  Und da es keine anderen vern√ºnftigen Elemente gab, klickten sie auf den K√∂rper und erzielten einen solchen Effekt. <br><br>  Daher die Moral: F√ºgen Sie nichts ein, was in den &lt;body&gt; gelangt.  Mit anderen Worten, Sie m√ºssen in Panik keine zus√§tzlichen Bewegungen ausf√ºhren.  Tats√§chlich passiert dies h√§ufig: Da ich mich mit Selenide besch√§ftige, erhalte ich h√§ufig Beschwerden, dass ‚Äûetwas nicht funktioniert‚Äú, und dann stellt sich heraus, dass irgendwo in den Setup-Methoden 15 zus√§tzliche Zeilen vorhanden waren, die nichts N√ºtzliches tun und st√∂ren .  Keine Notwendigkeit, sich in Tests wie "pl√∂tzlich wird es zuverl√§ssiger" zu besch√§ftigen und einzuf√ºgen. <br><br>  Infolgedessen erweitern wir die Liste der Gr√ºnde f√ºr instabile Tests: <br><br><ul><li>  Ajax-Anforderungsgeschwindigkeit; </li><li>  Die Reihenfolge der Ajax-Anfragen; </li><li>  Geschwindigkeit js; </li><li>  Browserfenstergr√∂√üe; </li><li>  Eitelkeit! </li></ul><br>  Gleichzeitig empfehle ich: F√ºhren Sie keine maximierten Tests durch (dh √∂ffnen Sie den Browser nicht in einem vollst√§ndigen Fenster).  In der Regel macht das jeder, und in Selenide war es standardm√§√üig (oder ist es immer noch).  Stattdessen rate ich Ihnen, immer einen Browser mit einer genau definierten Bildschirmaufl√∂sung zu starten, da dieser Zufallsfaktor dann ausgeschlossen ist.  Und ich rate Ihnen, die Mindestgr√∂√üe, die Ihre Anwendung unterst√ºtzt, gem√§√ü der Spezifikation festzulegen. <br><br><h2>  Beispiel 3: Phantomkonten </h2><br>  Ein Beispiel ist insofern interessant, als alles, was nur sofort zusammenfallen kann, zusammenfiel. <br><br>  Bei einem Test wurde √ºberpr√ºft, ob auf diesem Bildschirm 5 Konten vorhanden sein sollten. <br><br><img src="https://habrastorage.org/webt/td/hp/vl/tdhpvl7b-2ar4jxetsboygszf7m.jpeg"><br><br>  In der Regel war es gr√ºn, aber manchmal war nicht klar, unter welchen Bedingungen es fiel und es wurden nicht f√ºnf, sondern sechs Z√§hlungen auf dem Bildschirm angezeigt. <br><br>  Ich begann zu recherchieren, woher die zus√§tzliche Rechnung kommt.  Absolut unverst√§ndlich.  Es stellte sich die Frage: Vielleicht haben wir einen anderen Test, der w√§hrend des Tests ein neues Konto erstellt?  Es stellte sich heraus, dass es einen solchen LoansTest gibt.  Und zwischen ihm und dem fallenden AccountsTest (der f√ºnf Accounts erwartet) gibt es m√∂glicherweise eine Million anderer Tests. <br><br>  Wir versuchen zu verstehen, wie es so ist: Sollte der LoansTest, der das Konto erstellt, es nicht am Ende l√∂schen?  Wir schauen uns den Code an - ja, das sollte es, am Ende gibt es eine After-Funktion daf√ºr.  Dann sollte theoretisch alles in Ordnung sein, was ist das Problem? <br><br>  Vielleicht entfernt der Test es, aber es bleibt irgendwo zwischengespeichert?  Wir sehen uns den Produktionscode an, der die Konten l√§dt - er enth√§lt wirklich die Annotation @CacheFor und speichert die Konten f√ºnf Minuten lang zwischen. <br><br>  Es stellt sich die Frage: Sollte der Test diesen Cache nicht l√∂schen?  Es w√§re logisch, kann es nicht so einen Pfosten geben?  Wir sehen uns den Code an - ja, er l√∂scht den Cache wirklich vor jedem Test.  Was ist los?  Hier sind Sie bereits verloren, weil die Hypothesen vorbei sind: Das Objekt wird gel√∂scht, der Cache wird geleert, Baumsticks, was k√∂nnte sonst noch ein Problem sein?  Dann fing er an, den Code zu klettern, es dauerte einige Zeit, vielleicht sogar ein paar Tage.  Bis ich mir endlich diese Klasse und Superklasse ansah und dort eine verd√§chtige Sache fand: <br><br><img src="https://habrastorage.org/webt/ug/iz/qz/ugizqze3zr1gmexqfzgxfzqtb_o.jpeg"><br><br>  Jemand hat es schon bemerkt, oder?  Das ist richtig: In der untergeordneten und in der √ºbergeordneten Klasse gibt es eine Methode mit demselben Namen, die nicht super aufruft. <br><br>  In Java ist dies sehr einfach: Dr√ºcken Sie Alt + Eingabetaste oder Strg + Einf√ºgen in IntelliJ IDEA oder Eclipse. Standardm√§√üig wird die Methode setUp () f√ºr Sie erstellt, und Sie bemerken nicht, dass sie die Methode in der Oberklasse √ºberschreibt.  Das hei√üt, der Cache wurde immer noch nicht aufgerufen.  Als ich das sah, war ich wild w√ºtend.  Es freut mich jetzt. <br><br>  Daher die Moral: <br><br><ol><li>  In Tests ist es sehr wichtig, den sauberen Code zu √ºberwachen.  Wenn im Produktionscode jeder darauf achtet, f√ºhrt er eine Code√ºberpr√ºfung durch, dann in Tests - nicht immer. </li><li>  Wenn der Produktionscode durch Tests √ºberpr√ºft wird, wer testet dann die Tests?  Daher ist es besonders wichtig, √úberpr√ºfungen in der IDE zu verwenden. </li></ol><br>  Nach diesem Vorfall habe ich in IDEA eine solche standardm√§√üig deaktivierte √úberpr√ºfung gefunden, die √ºberpr√ºft: Wenn die Methode irgendwo √ºberschrieben wird, aber keine @ Overrid-Annotation vorhanden ist, wird dies als Fehler markiert.  Jetzt √ºberpr√ºfe ich dieses K√§stchen immer hysterisch. <br><br>  Fassen wir noch einmal zusammen: Wie ist das passiert, warum ist der Test nicht immer fehlgeschlagen?  Erstens hing es von der Reihenfolge dieser beiden Tests ab, sie laufen immer in zuf√§lliger Reihenfolge ab.  Ein weiterer Test hing davon ab, wie viel Zeit zwischen ihnen vergangen war.  Konten werden f√ºnf Minuten lang zwischengespeichert. Wenn mehr bestanden wurden, war der Test gr√ºn, und wenn weniger, fiel er, und dies geschah selten. <br><br>  Wir erweitern die Liste, warum Tests instabil sein k√∂nnen: <br><br><ul><li>  Ajax-Anforderungsgeschwindigkeit; </li><li>  Die Reihenfolge der Ajax-Anfragen; </li><li>  Geschwindigkeit js; </li><li>  Browserfenstergr√∂√üe; </li><li>  Anwendungscache; </li><li>  Daten aus fr√ºheren Tests; </li><li>  Zeit. </li></ul><br><h2>  Beispiel 4: Java-Zeit </h2><br>  Es gab einen Test, der auf allen unseren Computern und auf unseren Jenkins funktionierte, aber manchmal bei einem Jenkins-Kunden abst√ºrzte.  Wir schauen uns den Test an, verstehen warum.  Es stellte sich heraus, dass es fiel, denn bei der √úberpr√ºfung "das Zahlungsdatum sollte jetzt oder in der Vergangenheit sein" stellte sich heraus, dass es "in der Zukunft" war. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> payment.time &lt;= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Date();</code> </pre><br>  Wir schauen in den Code. K√∂nnen wir unter bestimmten Umst√§nden pl√∂tzlich ein Datum f√ºr die Zukunft festlegen?  Wir k√∂nnen nicht: An dem einzigen Ort, an dem die Zahlungszeit initialisiert wird, wird neues Datum () verwendet, und dies ist immer die aktuelle Zeit (in extremen F√§llen kann es in der Vergangenheit liegen, wenn der Test sehr langsam war).  Wie ist das √ºberhaupt m√∂glich?  Sie schlugen sich lange auf den Kopf, sie konnten es nicht verstehen. <br><br>  Und einmal haben sie in das Anwendungsprotokoll geschaut.  Daher die erste Moral - es ist sehr n√ºtzlich, wenn Sie Tests untersuchen, um in das Protokoll der Anwendung selbst zu schauen.  Hebe deine H√§nde, wer macht das?  Im Allgemeinen leider nicht die Mehrheit.  Und es gibt n√ºtzliche Informationen: Zum Beispiel das Anforderungsprotokoll, die eine oder andere URL wurde zu einem solchen Zeitpunkt ausgef√ºhrt und gab die eine oder andere Antwort. <br><br><img src="https://habrastorage.org/webt/z5/ca/cv/z5cacvqul4e4p9gw_lltdzoqk2c.jpeg"><br><br>  Gibt es hier etwas Verd√§chtiges?  Wir schauen auf die Zeit: Diese Anfrage wurde minus drei Sekunden bearbeitet.  Wie kann das sein?  Sie k√§mpften lange, konnten nicht verstehen.  Als uns schlie√ülich die Theorie ausgegangen war, trafen wir eine dumme Entscheidung: Jenkins schrieb ein einfaches Skript, das die aktuelle Zeit in einem Zyklus einmal pro Sekunde protokolliert.  Startete es.  Am n√§chsten Tag, als dieser schuppige Test einmal in der Nacht fiel, begannen sie, einen Auszug aus dieser Akte f√ºr die Zeit anzusehen, als er fiel: <br><br><img src="https://habrastorage.org/webt/yn/et/wx/ynetwxiyv1bc7kzmcgfafqolso8.jpeg"><br><br>  Also: 34 Sekunden, 35, 36, 37, 35, 39 ... Es ist cool, dass wir es gefunden haben, aber wie ist das √ºberhaupt m√∂glich?  Die Theorien endeten erneut, weitere zwei Tage kratzten sich am Kopf.  Das ist wirklich der Fall, wenn die Matrix mit Ihnen scherzt, oder? <br><br>  Bis mich endlich eine Idee traf ... Und das stellte sich heraus.  Linux verf√ºgt √ºber einen Zeitsynchronisierungsdienst, der auf einem zentralen Server ausgef√ºhrt wird und fragt, wie viele Millisekunden jetzt sind.  Und es stellt sich heraus, dass zwei verschiedene Dienste f√ºr diesen speziellen Jenkins gestartet wurden.  Der Test st√ºrzte ab, als Ubuntu auf diesem Server aktualisiert wurde. <br><br>  Dort wurde zuvor ein NTP-Dienst konfiguriert, der auf einen speziellen Bankenserver zugegriffen hat und von dort aus einige Zeit in Anspruch genommen hat.  Und mit der neuen Version von Ubuntu wurde standardm√§√üig ein neuer Lightweight-Service hinzugef√ºgt, beispielsweise systemd-timesyncd.  Und beide haben funktioniert.  Niemand hat das bemerkt.  Aus irgendeinem Grund gaben der Zentralbankserver und ein zentraler Ubuntu-Server eine Antwort mit einer Differenz von 3 Sekunden aus.  Nat√ºrlich haben sich diese beiden Dienste gegenseitig gest√∂rt.  Irgendwo tief in der Ubuntu-Dokumentation hei√üt es, dass man diese Situation nat√ºrlich nicht zul√§sst ... Nun, danke f√ºr die Info :) <br><br>  Gleichzeitig lernte ich eine interessante Nuance von Java, die ich vorher trotz meiner langj√§hrigen Erfahrung nicht kannte.  Eine der grundlegendsten Methoden in Java hei√üt System.currentTimeMillis (), mit deren Hilfe normalerweise etwas aufgerufen wird. Viele haben solchen Code geschrieben: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> start = System.currentTimeMillis(); <span class="hljs-comment"><span class="hljs-comment">// ... long end = System.currentTimeMillis(); log.info("Loaded in {} ms", end-start);</span></span></code> </pre><br>  Dieser Code befindet sich in den Bibliotheken von Apache Commons, Guava.  Das hei√üt, wenn Sie feststellen m√ºssen, wie viele Millisekunden ben√∂tigt wurden, um etwas aufzurufen, tun sie dies normalerweise.  Und viele haben wahrscheinlich geh√∂rt, dass dies nicht getan werden sollte.  Ich h√∂rte auch, wusste aber nicht warum und zu faul, um es zu verstehen.  Ich dachte, die Frage war genau, weil System.nanoTime () in einer Java-Version vorkam - es ist genauer, es erzeugt Nanosekunden, die millionenfach genauer sind.  Und da meine Anrufe in der Regel eine Sekunde oder eine halbe Sekunde dauern, ist diese Genauigkeit f√ºr mich nicht wichtig, und ich habe weiterhin System.currentTimeMillis () verwendet, das wir im Protokoll mit -3 Sekunden gesehen haben.  Der richtige Weg ist also, und jetzt habe ich herausgefunden, warum: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> start = System.nanoTime(); <span class="hljs-comment"><span class="hljs-comment">// ... long end = System.nanoTime(); log.info("Loaded in {} ms", (end-start)/1000000);</span></span></code> </pre><br>  Eigentlich ist dies in der Dokumentation der Methoden geschrieben, aber ich habe es einfach nie gelesen.  Ich habe mein ganzes Leben lang gedacht, dass System.currentTimeMillis () und System.nanoTime () dasselbe sind, nur mit einem millionenfachen Unterschied.  Es stellte sich jedoch heraus, dass dies grundlegend unterschiedliche Dinge sind. <br><br>  System.currentTimeMillis () gibt das aktuelle Datum zur√ºck - wie viele Millisekunden sind jetzt seit dem 1. Januar 1970.  Und System.nanoTime () ist eine Art abstrakter Z√§hler, der nicht an Echtzeit gebunden ist: Ja, es w√§chst garantiert jede Nanosekunde pro Einheit, aber es ist nicht mit der aktuellen Zeit verbunden, es kann sogar negativ sein.  Zu Beginn der JVM wird ein Zeitpunkt zuf√§llig ausgew√§hlt und beginnt zu wachsen.  Es war eine √úberraschung f√ºr mich.  F√ºr dich auch?  Nun, es ist nicht umsonst, dass er angekommen ist. <br><br><h2>  Beispiel 5: Der Fluch des gr√ºnen Knopfes </h2><br>  Hier f√ºllt unser Test ein bestimmtes Formular aus, klickt auf die gr√ºne Schaltfl√§che Best√§tigen und geht manchmal nicht weiter.  Warum es nicht geht, ist unverst√§ndlich. <br><br><img src="https://habrastorage.org/webt/cb/wq/fe/cbwqfenxe6_sfzyescgepr5m8tg.png"><br><br>  Wir fahren in vier Nullen und h√§ngen, gehen nicht zur n√§chsten Seite.  Das Klicken erfolgt fehlerfrei.  Ich habe mir alles angesehen: Ajax-Anfragen, Warten, Zeit√ºberschreitungen, Anwendungsprotokolle, Cache - ich habe nichts gefunden.  Die von Sergey Pirogov geschriebene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Videorecorder-</a> Bibliothek ist noch nicht erschienen.  Durch Hinzuf√ºgen einer Anmerkung zum Code k√∂nnen Sie Videos aufnehmen.  Dann konnte ich ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video von</a> diesem Test aufnehmen, es in Zeitlupe ansehen, und dies verdeutlichte schlie√ülich die Situation, die ich einige Monate vor dem Video nicht l√∂sen konnte. <br><br><img src="https://habrastorage.org/webt/i_/gz/_j/i_gz_jsw_vswjbeql9s2lwsefga.png"><br><br>  Der Fortschrittsbalken blockierte die Schaltfl√§che f√ºr den Bruchteil einer Sekunde, und der Klick funktionierte genau in diesem Moment und traf diesen Fortschrittsbalken.  Das hei√üt, der Fortschrittsbalken hat geklickt und ist verschwunden!  Und es wird in keinem Screenshot, in keinem Protokoll sichtbar sein, Sie werden nie wissen, was passiert ist. <br><br>  Im Prinzip handelt es sich in gewisser Weise um einen Anwendungsfehler: Ein Fortschrittsbalken wurde angezeigt, weil die Anwendung wirklich aus dem Bildschirmrand kriecht, und wenn Sie einen Bildlauf durchf√ºhren, stellt sich heraus, dass es sich um viele n√ºtzliche Daten handelt.  Aber die Benutzer haben sich nicht dar√ºber beschwert, weil alles auf den gro√üen Bildschirm passte, es passte nicht nur auf den kleinen. <br><br><h2>  Beispiel 6: Warum friert Chrome ein? </h2><br>  Eine zweij√§hrige Detektivuntersuchung ist ein absolut realer Fall.  Die Situation ist folgende: Unsere Tests waren ziemlich oft schuppig und fielen, und in den Stapelspuren war klar, dass Chrome einfriert: nicht unser Test, n√§mlich Chrome.  In den Protokollen war zu sehen, dass "Build l√§uft 36 Stunden ...". Sie begannen, Thread-Dumps und Stack-Traces zu entfernen. Sie zeigen, dass in den Tests alles in Ordnung ist, der Aufruf von Chromedriver h√§ngt und in der Regel zum Zeitpunkt des Abschlusses (wir nennen die Methode close). und diese Methode macht nichts, h√§ngt 36 Stunden).  Wenn es interessant ist, sieht die Stapelverfolgung folgenderma√üen aus: <br><br><img src="https://habrastorage.org/webt/fz/ew/1e/fzew1eu0u-e3oatl1age_oqhnso.jpeg"><br><br>  Wir haben versucht, alles zu tun, was uns nur in den Sinn kam: <br><br><ul><li>  Konfigurieren Sie das Zeitlimit f√ºr das √ñffnen / Schlie√üen des Browsers (wenn Sie den Browser nicht in 15 Sekunden √∂ffnen / schlie√üen konnten, versuchen Sie es nach 15 Sekunden erneut, bis zu drei Versuche).  √ñffnen und schlie√üen Sie den Browser in einem separaten Thread.  Ergebnis: Alle drei Versuche hingen gleich. </li><li>  Beenden Sie alte Chrome-Prozesse.  Sie haben einen separaten Job in Jenkins 'Kill-Chrome' erstellt. So k√∂nnen Sie beispielsweise alle Prozesse "beenden", die √§lter als eine Stunde sind: <br><br>  killall - √§lter als 1 Stunde Chromedriver <br>  killall - √§lter als 1h Chrom <br><br>  Dies gab zumindest Speicher frei, gab aber keine Antwort auf die Frage ‚ÄûWas passiert?‚Äú.  Tats√§chlich hat uns dieses Ding nur den Moment der Entscheidung verz√∂gert. </li><li>  Aktivieren Sie Debug-Anwendungsprotokolle. </li><li>  Aktivieren Sie WebDriver-Debugprotokolle. </li><li>  √ñffnen Sie den Browser nach jeweils 20 Tests erneut.  Es mag l√§cherlich erscheinen, aber der Gedanke war: "Was ist, wenn Chrome einfriert, weil es m√ºde ist?"  Nun, ein Speicherverlust oder etwas anderes. </li></ul><br>  Das Ergebnis des letzten Versuchs war v√∂llig unerwartet: Das Problem begann sich h√§ufiger zu wiederholen!  Und wir hatten gehofft, dass dies dazu beitragen w√ºrde, Chrome zu stabilisieren, damit es besser funktioniert.  Dies ist im Allgemeinen ein Gehirn-Imbiss.  Aber in der Tat, wenn das Problem √∂fter wieder auftritt, sollte man nicht traurig sein, sondern sich freuen!  Dies macht es m√∂glich, es besser zu studieren.  Wenn sie sich √∂fter zu wiederholen begann, sollte man sich daran festhalten: "Ja, ja, jetzt f√ºge ich noch etwas hinzu, Protokolle, Haltepunkte ..." <br><br>  Wir versuchen, das Problem zu wiederholen: Wir schreiben einen Zyklus von 1 bis 1000, in dem Zyklus √∂ffnen wir einfach den Browser und schlie√üen die erste Seite in unserer Anwendung.  Wir haben so einen Zyklus geschrieben und ... Bingo!  Ergebnis: Das Problem begann sich stabil zu wiederholen (allerdings ungef√§hr alle 80 Iterationen)!  Cool!  Diese Leistung hat zwar lange Zeit nichts gebracht.  Sie haben es gestartet, auf die 80. Iteration gewartet, Chrome ist abgest√ºrzt ... und was ist dann zu tun?  Sie sehen sich Stapelspuren, Speicherausz√ºge und Protokolle an - dort gibt es nichts N√ºtzliches.  Entwicklertools in Chrome k√∂nnten helfen, aber bis September 2017 funktionierten diese Tools nicht mit Selenium (die Ports standen in Konflikt: Sie starten Chrome von Selenium und DevTools werden nicht ge√∂ffnet).  Lange konnte ich mir nicht vorstellen, was ich tun sollte. <br><br>  Und hier in dieser Geschichte beginnt ein fabelhafter Moment.  Einmal, nach einer unendlichen Anzahl von Versuchen, habe ich diese Tests erneut ausgef√ºhrt. Bei einer Iteration wie der 56. h√§ngt sie erneut. Ich denke, "lasst uns etwas anderes graben" (obwohl ich nicht wei√ü, wo ich den Haltepunkt setzen soll oder was ein Protokoll hinzuf√ºgen).  In diesem Moment bietet meine Tochter an, W√ºrfel zu spielen, aber mein Test h√§ngt nur hier.  Ich sage: "Warte", sagte sie zu mir: "Was, du verstehst nicht, ich habe hier <b>ein b und ein a</b> !" <br><br>  Was zu tun ist, leider den Computer verlassen, W√ºrfel spielen ... Und pl√∂tzlich, nach ungef√§hr 20 Minuten, schaue ich versehentlich auf den Bildschirm und sehe ein v√∂llig unerwartetes Bild: <br><br><img src="https://habrastorage.org/webt/hm/7o/6p/hm7o6peoyj0zroryt-8g-osfvkc.jpeg"><br><br>  Was passiert: Es gibt einen Countdown, nach wie vielen Minuten die Sitzung abl√§uft und ich einen Turm aus W√ºrfeln baue, es gibt zwei, eine ... die Sitzung l√§uft ab, der Test wird fortgesetzt, l√§uft bis zum Ende und f√§llt ab (es gibt kein Element mehr, die Sitzung ist abgelaufen). <br><br>  Was passiert: Chrome ist nicht wirklich eingefroren, wie wir die ganze Zeit dachten, es hat die ganze Zeit auf etwas gewartet.  Als die Sitzung abgelaufen war, wartete, ging es weiter.  Was genau Chrome erwartet hatte - es ist v√∂llig unverst√§ndlich, dies zu verstehen. Ich musste den gesamten Code mit der bin√§ren Suchmethode schaufeln: die H√§lfte von JavaScript und HTML wegwerfen, versuchen, 80 Iterationen erneut zu wiederholen - es hing nicht, oh, das bedeutet irgendwo da drau√üen ... Im Allgemeinen haben wir experimentell verstanden dass das Problem hier ist: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timeout = setTimeout(sessionWatcher);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auf allen unseren Seiten gab es JavaScript - das zeigt das Fenster, in dem die Sitzung abl√§uft. Wahrscheinlich wissen alle JavaScript-Programmierer, dass dies nicht sehr korrekt ist: Alles, was in den &lt;script&gt; -Tags ausgef√ºhrt wird, beginnt sofort. Und dies ist normalerweise unsicher, da es m√∂glicherweise nicht funktioniert, wenn Elemente verwendet werden, die noch nicht geladen wurden. Daher wird immer empfohlen, JavaScript zu verpacken. Wenn Sie jQuery verwenden, dann in $, und alles im Funktionsblock beginnt erst, wenn alle Elemente bis zum Ende geladen sind:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timeout; $(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ timeout = setTimeout(...); });</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist das ABC der Webprogrammierung, das wahrscheinlich jeder kennt. Und wir hatten es nicht, wir hatten es falsch. Als ich dies √§nderte und das Experiment f√ºr 1000 Iterationen wiederholte, hing es nicht mehr. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zwar kenne ich nicht alle Antworten vollst√§ndig: Ich wei√ü zum Beispiel nicht, warum es nicht immer hing, sondern nur manchmal sehr selten. Vielleicht ist das ein Chrome-Bug, verdammt. Ja, es hat wirklich zwei Jahre gedauert, um dieses Problem zu untersuchen.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies bedeutet, dass einige F√§lle mit schuppigen Tests so unrealistisch sind, dass vielleicht nicht jeder sein Leben damit ruinieren m√∂chte. Wenn Sie versuchen, daraus zu schlie√üen, ist es im Allgemeinen interessant, dass sich der l√§cherlichste und d√ºmmste, lustigste und sinnloseste Versuch (einen m√ºden Browser neu zu starten) als erfolgreich erwiesen hat. Es war v√∂llig dumm, f√ºhrte aber pl√∂tzlich unerwartet zum Erfolg. Ich wei√ü nicht, welche Moral ich daraus ableiten soll: dumme Versuche machen? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Chrome hatten wir lange Zeit auch einen solchen Grund f√ºr Flockentests: Er wusste nicht immer, wie man native Alarmfenster schlie√üt, manchmal nicht, und der Prozess blieb h√§ngen, niemand t√∂tete ihn.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manchmal wirken sich auch UI-Effekte aus: Sie m√∂chten auf eine Schaltfl√§che klicken, und in diesem Moment bewegt sie sich oder bewegt sich von einer Ecke zur anderen. Sie rufen die click () -Methode auf, sie berechnet die Koordinaten des Mittelpunkts dieser Schaltfl√§che und der Feigen dort, und die Schaltfl√§che ist zu diesem Zeitpunkt bereits verlassen. Und vor allem, was passiert: Die click () -Methode hat fehlerfrei funktioniert, und Sie befinden sich nicht auf der n√§chsten Seite. Jemand hat wieder geklickt, oder?</font></font> :) :) <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Browser parallel gestartet werden, verlieren sie den Fokus. </font><font style="vertical-align: inherit;">Wenn es Funktionen gibt, die f√ºr den Fokus ausgelegt sind, schweben Sie, dann fallen sie auch, wenn sie parallel gestartet werden. </font><font style="vertical-align: inherit;">Dementsprechend rate ich, sie entweder nicht zu verwenden oder L√∂sungen zu verwenden, bei denen die Browser wirklich getrennt sind und auf verschiedenen Displays oder in verschiedenen Dockern ausgef√ºhrt werden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Beispiele sind vorbei. Lassen Sie uns nun eine Theorie geben, warum Tests instabil sind. </font><font style="vertical-align: inherit;">Erinnern wir uns an die typischen Probleme:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajax-Anforderungsgeschwindigkeit; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Die Reihenfolge der Ajax-Anfragen; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Geschwindigkeit js; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Browserfenstergr√∂√üe; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Anwendungscache; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Daten aus fr√ºheren Tests; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zeit; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Browser-Stabilit√§t; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UI-Effekte </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Parallele Browser (Fokusverlust). </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt auch echte Fehler f√ºr schuppige Tests, wie Sie sie finden k√∂nnen. Es kommt vor, dass Fehler und Bugs entdeckt werden, und dies ist ein einfacher Fall: Sie erhalten einen Fehler, sie beheben ihn. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auch f√ºr uns treten schwer reproduzierbare F√§lle auf. Es gibt "unrealistische" Fehler. Wir hatten F√§lle, in denen der Flockentest abgebrochen wurde, weil der Schutz der Anzahl der Klicks pro Sekunde auf die Schaltfl√§che mit derselben ID funktionierte und der Flockentest viele Male klicken konnte. Der echte Benutzer wird jedoch niemals Zeit daf√ºr haben. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt echte Fehler, aber unkritisch: Sie haben einen Test, der manchmal rot ist, aber niemand wird ihn beheben.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es kommt h√§ufig vor, dass ein Flockentest √ºber ein Problem mit der Benutzerfreundlichkeit spricht, beispielsweise √ºber einen Fortschrittsbalken, bei dem ein Teil des Bildschirms geschlossen wurde und der Flockentest dies zeigte. </font><font style="vertical-align: inherit;">Manchmal muss man den Falltest also aus einem solchen Blickwinkel betrachten. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Problem ist, dass, wenn Sie es nicht richtig rechtfertigen, niemand etwas korrigieren wird ... In j√ºngerer Zeit hatten wir einen Fall, als wir anfingen zu graben. Wir stellten fest, dass der schuppige Test einen Sicherheitsfehler fand, den gew√∂hnliche Tests nicht bemerkten. </font><font style="vertical-align: inherit;">Aber ich werde es heute nicht sagen, da es noch nicht repariert wurde! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lassen Sie uns dar√ºber sprechen, was Sie tun k√∂nnen, um die Anzahl der Flockentests zu minimieren:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Testpyramide; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Selenid </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Service-Emulatoren; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eine saubere Basis vor jedem Test. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Pyramide ist eine ewige Wahrheit. Warum ist es gerade im Hinblick auf Flockentests wichtig, dass es eine Gr√∂√üenordnung mehr Komponententests als UI-Tests gibt? Nicht weil sie schneller sind (obwohl dies wichtig ist), sondern weil sie viel stabiler sind und viel weniger schuppig sind. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úber Selenide schon gesagt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Emulatoren. W√§hrend der Tests k√∂nnen Sie in keinem Fall auf echte externe Dienste zugreifen (z. B. w√§hrend der Tests echte SMS / Briefe senden). Dies ist kein Scherz, ich h√∂re oft Fragen wie "Wie lese ich einen Brief aus einem Test?". Verwenden Sie f√ºr diese Dienste unbedingt Emulatoren, insbesondere da diese einfach zu erstellen sind. Artyom Eroshenko in </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seinem Bericht</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zeigte, ich werde nicht aufh√∂ren.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setzen Sie im Idealfall vor jedem Test den Status der Daten zur√ºck und bereinigen Sie den Status der Datenbank. </font><font style="vertical-align: inherit;">Wie genau dies zu tun ist, m√∂chte ich jetzt nicht sagen, dies ist ein technisches Problem, aber es gibt Optionen, wie dies ganz einfach zu tun ist. </font><font style="vertical-align: inherit;">Bei uns passiert das wirklich: Vor jedem Test ist die Datenbank ‚Äûvon Grund auf neu‚Äú, neu, immer mit demselben Datensatz (10 Benutzer, 20 Konten, einer mit einer Million, der andere mit zehn Rubel). </font><font style="vertical-align: inherit;">Es kann garantiert werden, dass alle Tests daf√ºr z√§hlen, und aufgrund der Daten sind keine Flocken vorhanden. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Was Sie anwenden m√ºssen, um Flockentests genauer zu untersuchen:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Protokolle fr√ºherer Builds; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Screenshots </font></font></li><li>  Video </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Punkt ‚ÄûSpeichern der Protokolle fr√ºherer Builds‚Äú mag ebenfalls offensichtlich erscheinen, aber in jedem Projekt, in das ich gekommen bin, habe ich diese Situation gesehen: Einige Fehler und Screenshots sind nur im letzten Build zu sehen. Wenn Ihr letzter Build "gr√ºn" und der vorherige "rot" war, ist das alles: Es gab einen Flockentest, aber Sie k√∂nnen nicht mehr erfahren, warum er flockig war. Keine Protokolle, nichts wurde aufbewahrt, und dies ist eine Katastrophe. Und das geht sehr einfach. Wenn Sie beispielsweise die Jenkins-Pipeline verwenden, reicht es in Jenkins aus, einen solchen Code zu schreiben:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { stage(<span class="hljs-string"><span class="hljs-string">"Reports"</span></span>) { junit <span class="hljs-string"><span class="hljs-string">'build/test-results/**/*.xml'</span></span> artifacts = <span class="hljs-string"><span class="hljs-string">'build./reports/**/*,build/test-results/**/*,logs/**/*'</span></span> archiveArtifacts artifacts: artifacts } }</code> </pre><br>  finally    ,    .   :    -  - .  Jenkins        ,  . ,   Jenkins       ,   .   ,  . <br><br>       (Selenide   ,     ).      flaky-.  ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Video Recorder</a> ,    :      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">video</a> ‚Äî  ,    ! <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine Alternative f√ºr diejenigen, die bereit sind, Tests in Docker auszuf√ºhren: Es gibt eine gute Bibliothek TestContainers (es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gab einen Bericht</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dar√ºber zu diesem Heisenbug </font><font style="vertical-align: inherit;">). Dort f√ºgen Sie auch eine </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und eine Anmerkung </font><font style="vertical-align: inherit;">in den Test ein. </font><font style="vertical-align: inherit;">Vor dem Test selbst wird der Docker mit der gew√ºnschten Version des Browsers bereitgestellt, das Video aufgezeichnet und am Ende des Tests beendet. In diesem Fall haben Sie auch ein Video √ºber den fehlgeschlagenen Test.</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Rule</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> BrowserWebDriverContainer chrome = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BrowserWebDriverContainer() .withRecordingMode(RECORD_ALL, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"build"</span></span>)) .withDesiredCapabilities(chrome());</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die letzte Nachricht. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuerst m√∂chte ich die Entwickler kontaktieren. Entwickler, meine Lieben, sollten unbedingt an Tests teilnehmen, Tests schreiben, Nachforschungen anstellen und interessierten Testern beim Lesen von Protokollen helfen. Weil sie solche schuppigen Tests in ihrem Leben niemals bew√§ltigen k√∂nnen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manager, Chefs dieser Entwickler! In der Regel liegt das Problem bei Ihnen :) Lassen Sie die Entwickler und ermutigen Sie die Entwickler, an Tests teilzunehmen. Wenn Sie dies nicht tun und sagen: "Sie haben keine Zeit daf√ºr, sie m√ºssen Code schreiben, sie sind teuer", verschwenden Sie Geld f√ºr die Automatisierung, da die Automatisierungseffizienz gering ist.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und die wichtigste Botschaft ist f√ºr die Automatisierungsexperten, die an Tests beteiligt sind, Falltests untersuchen und etwas mit ihnen unternehmen. </font><font style="vertical-align: inherit;">Wenn Sie zur Arbeit zur√ºckkehren, f√ºhren Sie die beschriebenen vorbeugenden Arbeiten durch, bewaffnen Sie sich mit den oben genannten Mitteln und ... warten Sie! </font><font style="vertical-align: inherit;">:) Und wenn dein Flockentest das n√§chste Mal f√§llt - freue dich: du gehst auf die Jagd!</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Ihnen dieser Bericht gefallen hat, achten Sie darauf: Am 6. und </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dezember kommt </font><b><font style="vertical-align: inherit;">Heisenbug wieder</font></b><font style="vertical-align: inherit;"> nach Moskau. </font><font style="vertical-align: inherit;">Es wird wieder n√ºtzliche Tipps und erstaunliche Geschichten geben, und die Welten der Tester und Entwickler werden wieder in Kontakt treten. </font><font style="vertical-align: inherit;">Sie k√∂nnen den aktuellen Status des Programms jederzeit auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">der Konferenzwebsite anzeigen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (und auf Wunsch ein Ticket kaufen) </font><font style="vertical-align: inherit;">.</font></font></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de416757/">https://habr.com/ru/post/de416757/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de416743/index.html">Bot f√ºr Starcraft in Rust, C und jeder anderen Sprache</a></li>
<li><a href="../de416745/index.html">Neuer ASUS ROG auf der Computex 2018</a></li>
<li><a href="../de416751/index.html">Sammlung von Kontextinformationen f√ºr die Protokollierung</a></li>
<li><a href="../de416753/index.html">Beliebtes Hola VPN Plugin kompromittiert</a></li>
<li><a href="../de416755/index.html">Extreme Likes - Untersuchungsausschuss gegen</a></li>
<li><a href="../de416759/index.html">Warum k√ºnstliche Intelligenz nicht alle Probleme l√∂st</a></li>
<li><a href="../de416761/index.html">Kosmische Sprache, Teil 1: Ist universelle Grammatik universell?</a></li>
<li><a href="../de416763/index.html">Puppet Salt Chef Ensemble: Vergleichen Sie Ansible, SaltStack, Chef und Puppet</a></li>
<li><a href="../de416765/index.html">Foliplast-Unternehmen: Ein vollst√§ndiger Zyklus der digitalen Produktion in Russland</a></li>
<li><a href="../de416767/index.html">Ein Deuce f√ºr Sie oder ein Audit mit Hacking</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>