<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>❔ 🏂🏾 🛂 Agones, buat server game multi-pengguna. Arsitektur dan Instalasi 👨🏽‍🎓 👨‍🌾 🧒🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Agones (dari agunan Yunani lainnya - "kompetisi") memungkinkan Anda untuk menyebarkan kluster server game menggunakan Kubernetes dengan Penskalaan Oto...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Agones, buat server game multi-pengguna. Arsitektur dan Instalasi</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469381/"><p>  Agones (dari agunan Yunani lainnya - "kompetisi") memungkinkan Anda untuk menyebarkan kluster server game menggunakan Kubernetes dengan Penskalaan Otomatis.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Proyek</a> open-source ini dibuat pada 2018, sudah mencetak 2.500 bintang, ada di Google I / O 2019, dan di Habré, sangat mengejutkan kami, belum disebutkan.  Topik ini menjelaskan kunjungan singkat ke arsitektur dan instruksi untuk memulai server uji pada mesin lokal.  Jika tertarik, selamat datang di kat, pergi! </p><br><img src="https://habrastorage.org/getpro/habr/post_images/af7/fce/4ea/af7fce4ea1dbb86b3bac94479a1b1f15.png" alt="Logo Agones"><a name="habracut"></a><br><h3>  Deskripsi Proyek </h3><br><p>  Agones adalah Sumber Daya Kustom ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ekstensi API Kubernetes</a> ). </p><br><p>  Proyek ini sebenarnya membutuhkan lebih banyak perhatian, karena memungkinkan Anda untuk menjalankan server game tunggal (GameServer) atau seluruh "armada" server (Armada) melalui file konfigurasi yaml, melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Agones API</a> .  Pada gilirannya, setiap server memberi peringatan tentang siklus hidupnya (siklus hidup GameServer), menjelaskan status saat ini (pemeriksaan kesehatan, informasi koneksi).  Server dalam cluster memiliki kemampuan untuk secara otomatis skala (Fleet Autoscaling), yang terintegrasi dengan kemampuan dasar Kubernetes.  Selain itu, ada output statistik di dasbor menggunakan Prometheus, Grafana atau Stackdriver, metrik diekspor melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OpenCensus</a> , yang memungkinkan Anda untuk menambahkan eksportir Anda sendiri.  Contoh dasbor di Stackdriver: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/991/03b/929/99103b9292365163e2b77ae292e4eba2.png" alt="gambar"></p><br><h3>  Arsitektur, elemen dasar </h3><br><p>  Agones sendiri bertugas meluncurkan, memperluas secara otomatis, dan meng-hosting server game menggunakan Kubernet sebagai dasarnya.  Ini memungkinkan Anda untuk fokus pada pengembangan server game multi-pemain itu sendiri, alih-alih mengembangkan infrastruktur dan dukungan lebih lanjut.  Anda bisa menggunakan server game apa saja yang bisa dijalankan di linux, dan itu bisa ditulis dalam bahasa pemrograman apa pun. </p><br><p>  API Agones Kubernetes dibagi menjadi tiga paket utama, yang masing-masing berisi sumber daya: agones.dev (GameServer, GameServerSet, Armada), alokasi.agones.dev (GameServerAllocation), autoscaling.agones.dev (FleetAutoscaler).  Seperti sumber daya Kubernet lainnya, file yaml digunakan untuk menjalankannya. </p><br><p>  Deskripsi singkat dari setiap sumber daya: </p><br><ul><li>  GameServer - membuat templat tertentu yang memungkinkan Anda menggunakan parameter Pod biasa, dengan beberapa tambahan, seperti hostPort dan containerPort untuk server game.  Agones SDK menyediakan wadah sespan opsional yang dengannya GameServer akan terus berkomunikasi </li><li>  GameServerSet - struktur data untuk beberapa GameServer, sangat mirip dengan hubungan antara Depoyment dan ReplicaSet </li><li>  Armada - membuat beberapa GameServer yang sudah jadi, menggunakan GameServerAllocation untuk mendistribusikan sumber daya </li><li>  GameServerAllocation - meminta GameServer dari Fleet untuk digunakan dan menandakan bahwa GameServer siap digunakan oleh pemain, sehingga GameServer tidak akan dihapus secara otomatis </li><li>  FleetAutoscaler - secara otomatis memperluas atau, sebaliknya, mengurangi jumlah server di Armada </li></ul><br><p>  Diagram ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dari sini</a> ) menunjukkan siklus hidup sumber daya GameServer: </p><br><p><img src="https://habrastorage.org/webt/_2/2x/gc/_22xgcnfs_6ercdwmte8hktzynw.png"></p><br><p>  Panah ungu menunjukkan Agones SDK, merah - API pengguna, biru - pengontrol server permainan, kuning - pengontrol aplikasi. </p><br><h3>  Instalasi </h3><br><p>  Di bagian ini dan selanjutnya, tim dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">instruksi</a> di situs web resmi digunakan, dengan beberapa tambahan.  Kami merekomendasikan menggunakan Kubernetes versi 1.12 (diuji oleh pengembang).  Untuk pengujian di komputer lokal, Anda dapat menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">minikube</a> , yang akan membutuhkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kubectl</a> dan hypervisor ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Hyper-V</a> atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">VirtualBox</a> ) yang didukung oleh sistem operasi. </p><br><p>  Untuk menginstal cluster dan Agones, Anda harus menjalankan perintah berikut: </p><br><pre><code class="bash hljs">minikube profile agones <span class="hljs-comment"><span class="hljs-comment">#    agones minikube start --kubernetes-version v1.12.10 --vm-driver hyperv #virtualbox minikube status #     kubectl create namespace agones-system #    agones kubectl apply -f https://raw.githubusercontent.com/googleforgames/agones/release-1.0.0/install/yaml/install.yaml</span></span></code> </pre> <br><p>  Perintah terakhir mengunduh file konfigurasi Agones yang membuat Custom Resource Definition (CRD) melalui API Kubernetes. </p><br><h3>  Meluncurkan GameServer </h3><br><p>  Sekarang Anda dapat memulai server UDP di kluster menggunakan server uji yang sudah jadi dari contoh, yang hanya akan menanggapi permintaan yang dikirim ke sana: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># GameServer  kubectl create -f https://raw.githubusercontent.com/googleforgames/agones/release-1.0.0/examples/simple-udp/gameserver.yaml kubectl get gameservers #  GameServer minikube ip #     kubectl describe gameserver #    GameServer kubectl get gs #  ,   GameServer</span></span></code> </pre> <br><p>  Untuk mengkonfirmasi bahwa server berfungsi, Anda dapat menggunakan NetCat, untuk linux program biasanya datang dengan sistem, untuk windows Anda perlu mengunduhnya, misalnya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .  NetCat harus dimulai dengan parameter <code>-u</code> (permintaan UDP), menentukan alamat minikube (lebih baik untuk menyalin alamat dari perintah <code>minikube ip</code> ) dan port GameServer aktif: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span> | nc -u $(minikube ip) 7331</code> </pre> <br><p>  Jika setelah menjalankan perintah di konsol, respons "ACK: hello" muncul, maka server berfungsi, Anda dapat mematikannya dengan perintah berikut, yang menginisialisasi: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"EXIT"</span></span> | nc -u $(minikube ip) 7331</code> </pre> <br><p>  Status server diperiksa oleh <code>kubectl describe gameserver</code> , itu harus berubah menjadi Shutdown. </p><br><h3>  Membuat perubahan pada GameServer </h3><br><p>  Menggunakan contoh sebelumnya, kami akan mengubah respons server.  Pertama, salin repositori proyek: </p><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git@github.com:googleforgames/agones.git</code> </pre> <br><p>  Dalam file <a href="">agones / example / simple-udp / main.go,</a> ubah baris 159 menjadi </p><br><pre> <code class="go hljs">respond(conn, sender, <span class="hljs-string"><span class="hljs-string">"ACKNOWLEDGED: "</span></span>+txt+<span class="hljs-string"><span class="hljs-string">"\n"</span></span>)</code> </pre> <br><p>  Dari folder root proyek, jalankan yang berikut untuk membuat gambar buruh pelabuhan dan simpan di minikube.  Untuk windows, Anda harus menjalankan <code>minikube docker-env | Invoke-Expression</code>  <code>minikube docker-env | Invoke-Expression</code> , untuk linux <code>eval $(minikube docker-env)</code> .  Ini akan memungkinkan Anda untuk membuat gambar buruh pelabuhan langsung di minikube. <br>  Buat gambar buruh pelabuhan: </p><br><pre> <code class="bash hljs">docker build -t agones-go:modified -f .\examples\simple-udp\Dockerfile .</code> </pre> <br><p>  Perintah ini mungkin memakan waktu, karena seluruh repositori proyek akan disalin ke gambar.  Ini dapat dihindari dengan hanya menyisakan folder sdks, main.go dan Dockerfile di direktori. </p><br><p>  Selanjutnya, dalam <a href="">contoh \ simple-udp \ gameserver.yaml,</a> ubah baris 28 ke <code>image: agones-go:modified</code> dan buat GameServer baru: </p><br><pre> <code class="bash hljs">kubectl create -f .\examples\simple-udp\gameserver.yaml</code> </pre> <br><p>  Periksa perubahan dan matikan server: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello"</span></span> | nc -u 172.17.113.72 7331 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"EXIT"</span></span> | nc -u 172.17.113.72 7331</code> </pre> <br><p>  Jika setelah menjalankan perintah di konsol respons "ACKNOWLEDGED: hello" muncul, maka perubahan berhasil. </p><br><h3>  Kami memulai server secara lokal </h3><br><p>  Anda dapat mengulangi perubahan untuk pengembangan yang nyaman tanpa Kubernetes, hanya menggunakan Agones SDK.  Saat server permainan berjalan, SDK berkomunikasi melalui TCP dengan server gRPC kecil yang dijalankan Agones dalam wadah di bawah namespace yang sama.  Wadah seperti itu di Kubernetes disebut sespan.  Oleh karena itu, untuk pengembangan lokal, Anda harus memulai proses SDK.  Untuk melakukan ini, Anda perlu menjalankan file sumbernya dengan parameter <code>-local</code> , yang mengaktifkan mode 'mode lokal'.  Mode ini memberi tahu proses untuk berada dalam mode pasif dan tidak terhubung di mana pun, cukup tampilkan log di konsol sehingga Anda dapat melihat apa yang dilakukan SDK saat server game sedang berjalan. </p><br><p>  Anda dapat mengunduh agonessdk-server terbaru dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">rilis</a> repositori proyek resmi.  Secara default, setelah memulai server SDK, kosong konfigurasi GameServer dibuat, yang digunakan untuk permintaan GameServer () dan WatchGameServer () SDK.  Saat startup, Anda dapat menentukan file konfigurasi Anda sendiri dalam format yaml atau json, untuk ini Anda memerlukan parameter <code>-file</code> atau versi singkatnya <code>-f</code> bersama dengan parameter <code>-local</code> . </p><br><pre> <code class="plaintext hljs">.\sdk-server --local -f .\examples\simple-udp\gameserver.yaml sdk-server : {"ctlConf":{"Address":"localhost","IsLocal":true,"LocalFile":".\\examples\\simple-udp\\gameserver.yaml","Timeout":0,"Test":""},"grpcPor t":59357,"httpPort":59358,"message":"Starting sdk sidecar","severity":"info","source":"main","time":"2019-09-29T12:45:59.8379817+02:00","version":"1.0.0"} {"filePath":"C:\\agones-release-1.0.0\\examples\\simple-udp\\gameserver.yaml","message":"Reading GameServer configuration","severity":"info","time":"2019-09-29T12:45:59.8479789+02:00"} {"message":"Starting SDKServer grpc service...","severity":"info","source":"main","time":"2019-09-29T12:45:59.8529791+02:00"} {"message":"Starting SDKServer grpc-gateway...","severity":"info","source":"main","time":"2019-09-29T12:46:00.1555756+02:00"}</code> </pre> <br><p>  Dilanjutkan ... </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id469381/">https://habr.com/ru/post/id469381/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id469369/index.html">Acara digital di Moskow dari 30 September hingga 06 Oktober</a></li>
<li><a href="../id469371/index.html">Deskripsi pendekatan untuk mengatur dan menguji kode menggunakan Redux Thunk</a></li>
<li><a href="../id469373/index.html">Hasil proyek untuk membuat antarmuka saraf untuk pasien yang lumpuh total dipertanyakan</a></li>
<li><a href="../id469375/index.html">Mengapa Mozilla, Coil, dan Creative Commons membagikan $ 100 juta untuk proyek sumber terbuka?</a></li>
<li><a href="../id469379/index.html">Penerapan metode validasi model formal untuk UI</a></li>
<li><a href="../id469383/index.html">Solusi Hyperconverged AERODISK vAIR. Dasar - Sistem File ARDFS</a></li>
<li><a href="../id469387/index.html">Kisah satu "pengembang" atau bagaimana pendatang baru menulis aplikasi untuk iOS</a></li>
<li><a href="../id469389/index.html">Parameterisasi oleh jaringan saraf model fisik untuk memecahkan masalah optimasi topologi</a></li>
<li><a href="../id469391/index.html">Audio Interfaces: Berbunyi sebagai sumber informasi di jalan, di kantor dan di langit</a></li>
<li><a href="../id469393/index.html">Flare-On 2019 menulis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>