<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔶 💲 👧🏿 Java应用程序中的验证 🧛 🕴🏼 🏅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="本文专门讨论各种数据验证方法：在Java应用程序中验证数据时，可能会碰到项目的陷阱以及应遵循的方法和技术。 





 我经常看到那些创建者不费吹灰之力选择数据验证方法的项目。 团队在截止日期和含糊要求等形式的巨大压力下进行了项目工作，结果，他们根本没有时间进行准确，一致的验证。 因此，它们的验证...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Java应用程序中的验证</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/427543/"><p>  <em>本文专门讨论各种数据验证方法：在Java应用程序中验证数据时，可能会碰到项目的陷阱以及应遵循的方法和技术。</em> </p><br><p><img src="https://habrastorage.org/webt/cj/yc/yj/cjycyj3zf_l1ai9ch_vsgzisstk.png" alt="验证方式"></p><br><p> 我经常看到那些创建者不费吹灰之力选择数据验证方法的项目。 团队在截止日期和含糊要求等形式的巨大压力下进行了项目工作，结果，他们根本没有时间进行准确，一致的验证。 因此，它们的验证代码分散在各处：Javascript代码段，屏幕控制器，业务逻辑箱，域实体，触发器和数据库约束。 这段代码中充满了if-else语句，引发了一系列异常，并试图找出那里的特定数据在哪里进行了验证...结果，随着项目的发展，遵守要求变得困难且昂贵（通常非常令人困惑），并且数据验证方法的一致性。 </p><br><p> 那么，有没有简单而优雅的方法来验证数据？ 有没有一种方法可以保护我们免受无法阅读的罪恶的侵扰，将所有验证逻辑放在一起，并且已经由流行的Java框架的开发人员为我们创建了？ </p><br><p> 是的，有这种方法。 </p><a name="habracut"></a><br><p> 对于我们<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBA平台</a>的开发人员而言，使用最佳实践非常重要。 我们认为验证代码应： </p><br><ol><li> 可重复使用并遵循DRY原则； </li><li> 自然且易于理解； </li><li> 放置在开发人员希望看到的地方； </li><li> 能够验证来自不同来源的数据：用户界面，SOAP调用，REST等。 </li><li> 在多线程环境中工作不会出现问题； </li><li> 自动在应用程序内部调用，无需手动运行检查； </li><li> 在简洁的对话框中为用户提供清晰，本地化的消息； </li><li> 遵守标准。 </li></ol><br><p> 让我们看看如何使用使用CUBA Platform框架编写的示例应用程序来实现这一点。 但是，由于CUBA基于Spring和EclipseLink，因此此处使用的大多数技术都可以在支持JPA和Bean验证规范的任何其他Java平台上运行。 </p><br><h2 id="validaciya-s-ispolzovaniem-database-constraints"> 使用数据库约束进行验证 </h2><br><p>验证数据的最常见，最明显的方法可能是在数据库级别使用限制，例如，必需标志（对于值不能为空的字段），字符串长度，唯一索引等。 此方法最适合企业应用程序，因为此类软件通常严格专注于数据处理。 但是，即使在这里，开发人员也经常通过为应用程序的每个级别分别设置限制来犯错。 通常，原因在于开发人员之间的责任分配。 </p><br><p> 考虑一个我们大多数人都知道的例子，甚至有一些我们自己的经验……如果规范说护照号码字段中应该有10个字符，那么很有可能每个人都会对此进行检查：DDL中的DB架构师，相应Entity中的后端开发人员以及REST服务，最后，UI开发人员直接在客户端。 然后此要求更改，并且字段增加到15个字符。  Devops会更改数据库中的约束值，但对用户而言则没有任何变化，因为在客户端，约束是相同的... </p><br><p> 任何开发人员都知道如何避免此问题-验证必须集中！ 在CUBA中，可以在JPA实体批注中找到这种验证。 基于此元信息，CUBA Studio将生成正确的DDL脚本并应用适当的客户端验证器。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/118/a16/f17/118a16f1705740a1676eb2c0ea164ef4.png" alt="约束样品"></p><br><p> 如果注释发生更改，CUBA将更新DDL脚本并生成迁移脚本，因此，下次您部署项目时，基于JPA的新限制将同时在界面和应用程序数据库中生效。 </p><br><p>尽管在数据库级别上的简单性和实现方式使该方法具有绝对的可靠性，但JPA注释的范围仅限于可以在DDL标准中表示的最简单的情况，并且不包括数据库触发器或存储过程。 因此，基于JPA的约束可以使实体字段唯一或必填，或设置最大列长。 您甚至可以使用<code>@UniqueConstraint</code>批注对列的组合设置唯一的限制。 但这可能就是全部。 </p><br><p> 如此一来，在需要更复杂的验证逻辑（例如，检查字段的最小值/最大值，使用正则表达式进行验证或仅针对您的应用程序执行自定义检查）的情况下，将应用称为<strong>“ Bean验证”</strong>的方法。 </p><br><h2 id="bean-validation">  Bean验证 </h2><br><p> 大家都知道，遵循具有较长生命周期的标准是一种很好的做法，其有效性已在数千个项目中得到证明。  Java Bean验证是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JSR</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">380、349</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">和303</a>及其应用程序（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Hibernate Validator</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Apache BVal）中记录的一种方法</a> 。 </p><br><p> 尽管许多开发人员都熟悉这种方法，但是它经常被低估。 这是一种即使在旧项目中也可以嵌入数据验证的简便方法，它使您可以清晰，简单，可靠且尽可能接近业务逻辑来构建验证。 </p><br><p> 使用Bean验证为该项目提供了许多优势： </p><br><ul><li> 验证逻辑位于主题区域旁边：对bin的字段和方法的限制的定义以自然且真正面向对象的方式发生。 </li><li>  Bean验证标准为我们提供了许多<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">验证注释</a> ，例如： <code>@Size</code> ， <code>@Min</code> <code>@Pattern</code> ， <code>@Email</code> ， <code>@Past</code> <code>@Pattern</code> ， <code>@Email</code> ， <code>@Past</code> <code>@Pattern</code> ， <code>@Email</code> ， <code>@Past</code> ，不太标准的<code>@URL</code> ， <code>@Length</code> ，功能最强大的<code>@ScriptAssert</code>等等。 </li><li> 该标准并不仅限于现成的注释，还允许我们创建自己的注释。 我们还可以通过组合多个其他注解来创建新的注解，或使用单独的Java类作为验证器对其进行定义。 <br> 例如，在上面的示例中，我们可以设置<code>@ValidPassportNumber</code>类的级别批注，以根据<code>country</code>字段的值来验证护照号码是否与格式匹配。 </li><li> 约束不仅可以在字段或类上设置，还可以在方法及其参数上设置。 这种方法称为<strong>“合同确认”</strong> ，将在稍后讨论。 </li></ul><br><p> 当用户提交输入的信息时， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBA平台</a> <em>（与其他框架一样）会</em>自动启动Bean验证，因此如果验证失败，它会立即显示错误消息，并且我们不需要手动运行bin验证器。 </p><br><p> 让我们返回带有护照号码的示例，但是这次我们将对Person实体的一些限制进行补充： </p><br><ul><li>  <code>name</code>字段必须是2个或更多字符，并且必须有效。  （如您所见，正则表达式并不简单，但是“ Charles Ogier de Batz de Castelmore Comte d'Artagnan”将通过测试，而“ R2D2”则不会通过）； </li><li>  <code>height</code> （高度）应在以下间隔内： <code>0 &lt; height &lt;= 300</code> cm; </li><li>  <code>email</code>字段必须包含与正确电子邮件格式匹配的字符串。 </li></ul><br><p> 经过所有这些检查，Person类将如下所示： </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Listeners</span></span>(<span class="hljs-string"><span class="hljs-string">"passportnumber_PersonEntityListener"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NamePattern</span></span>(<span class="hljs-string"><span class="hljs-string">"%s|name"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"PASSPORTNUMBER_PERSON"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span>(name = <span class="hljs-string"><span class="hljs-string">"passportnumber$Person"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ValidPassportNumber</span></span>(groups = {Default.class, UiCrossFieldChecks.class}) <span class="hljs-meta"><span class="hljs-meta">@FraudDetectionFlag</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> serialVersionUID = -<span class="hljs-number"><span class="hljs-number">9150857881422152651L</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Pattern</span></span>(message = <span class="hljs-string"><span class="hljs-string">"Bad formed person name: ${validatedValue}"</span></span>, regexp = <span class="hljs-string"><span class="hljs-string">"^[AZ][az]*(\\s(([az]{1,3})|(([az]+\\')?[AZ][az]*)))*$"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Length</span></span>(min = <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"NAME"</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> String name; <span class="hljs-meta"><span class="hljs-meta">@Email</span></span>(message = <span class="hljs-string"><span class="hljs-string">"Email address has invalid format: ${validatedValue}"</span></span>, regexp = <span class="hljs-string"><span class="hljs-string">"^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"EMAIL"</span></span>, length = <span class="hljs-number"><span class="hljs-number">120</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> String email; <span class="hljs-meta"><span class="hljs-meta">@DecimalMax</span></span>(message = <span class="hljs-string"><span class="hljs-string">"Person height can not exceed 300 centimeters"</span></span>, value = <span class="hljs-string"><span class="hljs-string">"300"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@DecimalMin</span></span>(message = <span class="hljs-string"><span class="hljs-string">"Person height should be positive"</span></span>, value = <span class="hljs-string"><span class="hljs-string">"0"</span></span>, inclusive = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"HEIGHT"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> BigDecimal height; <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"COUNTRY"</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Integer country; <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"PASSPORT_NUMBER"</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, length = <span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> String passportNumber; ... }</code> </pre> <br><p>  <a href="">人.java</a> </p><br><p> 我相信对<code>@DecimalMin</code> <code>@Length</code> ， <code>@Pattern</code> <code>@DecimalMin</code> ， <code>@Length</code> ， <code>@Pattern</code>之类的注释的使用非常明显，不需要注释。 让我们仔细看看<code>@ValidPassportNumber</code>批注的实现。 </p><br><p> 我们全新的<code>@ValidPassportNumber</code>检查<code>Person#passportNumber</code> <code>@ValidPassportNumber</code>是否与<code>Person#country</code>字段指定的每个国家的正则表达式模式匹配。 </p><br><p> 首先，让我们看一下文档（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBA</a>或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Hibernate</a>手册很好），根据它，我们需要用这个新的注释标记我们的类，并将<code>groups</code>参数传递给它，其中<code>UiCrossFieldChecks.class</code>意味着该验证应在交叉处运行。验证-检查所有单个字段后， <code>Default.class</code>将限制保存在默认验证组中。 </p><br><p> 批注描述如下所示： </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.TYPE) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Constraint</span></span>(validatedBy = ValidPassportNumberValidator.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ValidPassportNumber { <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> "Passport number is not valid"</span></span>; Class&lt;?&gt;[] groups() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; Class&lt;? extends Payload&gt;[] payload() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; }</code> </pre> <br><p>  <a href="">ValidPassportNumber.java</a> </p><br><p> 在这里， <code>@Target(ElementType.TYPE)</code>表示此运行时批注的目的是该类，而<code>@Constraint(validatedBy = … )</code>确定验证是由实现<code>ConstraintValidator&lt;...&gt;</code>接口的<code>ValidPassportNumberValidator</code>类执行的。 验证代码本身在<code>isValid(...)</code>方法中，该方法以相当简单的方式执行实际验证： </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ValidPassportNumberValidator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConstraintValidator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ValidPassportNumber</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ValidPassportNumber constraint)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Person person, ConstraintValidatorContext context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (person == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (person.country == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || person.passportNumber == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> doPassportNumberFormatCheck(person.getCountry(), person.getPassportNumber()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doPassportNumberFormatCheck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CountryCode country, String passportNumber)</span></span></span><span class="hljs-function"> </span></span>{ ... } }</code> </pre> <br><p>  <a href="">ValidPassportNumberValidator.java</a> </p><br><p> 仅此而已。 使用CUBA平台，我们无需编写任何代码，只需编写一行代码即可使我们的自定义验证工作并向用户提供错误消息。 <br> 没什么复杂的，对吧？ </p><br><p> 现在，让我们看看它是如何工作的。 在这里，CUBA还有其他功能：它不仅向用户显示错误消息，而且还在未通过bean验证的红色字段中突出显示： </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/310/83d/b2b/31083db2b14d67d88de169542b59748a.png" alt="UI表示"></p><br><p> 这不是一个优雅的解决方案吗？ 通过仅向主题区域的实体添加几个Java批注，可以在UI中充分显示验证错误。 </p><br><p> 总结本节，让我们再次简要列出Bean验证对实体的优势： </p><br><ol><li> 它是可以理解和可读的； </li><li> 允许您直接在实体类中定义值约束； </li><li> 可以定制和补充； </li><li> 集成到流行的ORM中，并在更改保存到数据库之前自动运行检查； </li><li> 当用户向UI发送数据时，某些框架还会自动运行Bean验证（如果没有，则很容易手动调用<code>Validator</code>接口）； </li><li>  Bean验证是公认的标准，并且在Internet上有完整的文档。 </li></ol><br><p> 但是，如果您需要对方法，构造函数或REST地址设置限制以验证来自外部系统的数据怎么办？ 或者，如果您需要声明性地检查方法参数的值，而无需在每个要测试的方法中编写带有许多if-else条件的无聊代码？ </p><br><p> 答案很简单：Bean验证也适用于方法！ </p><br><h2 id="validation-by-contract"> 合同确认 </h2><br><p> 有时有必要超越数据模型状态的验证。 许多方法可能会受益于参数和返回值的自动验证。 这可能不仅是必要的，以检查去往REST或SOAP地址的数据，而且在我们要记下方法调用的前提条件和后置条件以确保输入的数据在执行方法主体之前已验证或返回值的情况下，这是必要的。是在预期范围内，或者例如，我们只需要声明性地描述输入参数的值范围即可提高代码的可读性。 </p><br><p> 使用bean验证，可以将限制应用于方法和构造函数的输入参数以及返回值，以检查任何Java类中其调用的先决条件和后置条件。 与传统的检查参数和返回值有效性的方法相比，此路径具有多个优点： </p><br><ol><li> 不必以命令式方式手动执行检查（例如，通过抛出<code>IllegalArgumentException</code>等）。 您可以声明性地定义约束，并使代码更易于理解和表达。 </li><li> 可以配置，重用和配置约束：您无需为每个检查编写验证逻辑。 更少的代码意味着更少的错误。 </li><li> 如果类，方法的返回值或其参数用<code>@Validated</code>批注标记，则每次调用该方法时，平台都会自动执行检查。 </li><li> 如果该可执行文件带有<code>@Documented</code>批注，则其前提条件将包含在生成的JavaDoc中。 </li></ol><br><p> 使用<strong>“合同验证”，</strong>我们可以获得清晰，紧凑且易于维护的代码。 </p><br><p> 例如，让我们看一下CUBA应用程序的REST控制器的接口。  <code>PersonApiService</code>接口允许您使用<code>getPersons()</code>方法从数据库中获取人员列表，并使用<code>addNewPerson(...)</code>调用添加新人员。 </p><br><p> 并且不要忘记bean验证是继承的！ 换句话说，如果我们注释某个类，字段或方法，则所有继承该类或实现此接口的类都将经受相同的验证注释。 </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Validated</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonApiService</span></span></span><span class="hljs-class"> </span></span>{ String NAME = <span class="hljs-string"><span class="hljs-string">"passportnumber_PersonApiService"</span></span>; <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Valid</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequiredView</span></span>(<span class="hljs-string"><span class="hljs-string">"_local"</span></span>) <span class="hljs-function"><span class="hljs-function">List&lt;Person&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPersons</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addNewPerson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( @NotNull @Length(min = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">, max = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">255</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pattern</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Bad formed person name: ${validatedValue}"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, regexp = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"^[AZ][az]*(\\s(([az]{1,3})|(([az]+\\')?[AZ][az]*)))*$"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String name, @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DecimalMax</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Person height can not exceed 300 cm"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, value = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"300"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DecimalMin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Person height should be positive"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, value = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"0"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, inclusive = </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">false</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> BigDecimal height, @NotNull CountryCode country, @NotNull String passportNumber )</span></span>; }</code> </pre> <br><p>  <a href="">PersonApiService.java</a> </p><br><p> 这段代码是否足够清晰？ <br>  _（除了<code>@RequiredView(“_local”)</code>注释<code>@RequiredView(“_local”)</code> （特定于CUBA平台，并验证返回的<code>Person</code>对象包含<code>PASSPORTNUMBER_PERSON</code>表中的所有字段）。 </p><br><p>  <code>@Valid</code>定义了<code>getPersons()</code>方法返回的每个集合对象还必须根据<code>Person</code>类的限制进行验证。 </p><br><p> 在CUBA应用程序中，以下地址提供了这些方法： </p><br><ul><li>  / app / rest / v2 / services / passportnumber_PersonApiService / getPersons </li><li>  / app / rest / v2 / services / passportnumber_PersonApiService / addNewPerson </li></ul><br><p> 让我们打开Postman应用程序，并确保验证可以正常进行： </p><br><p><img src="https://habrastorage.org/webt/qg/ra/qj/qgraqjsxfyeqqa6qcjf2pkf7tcq.png" alt="邮递员应用"></p><br><p> 您可能已经注意到，在上面的示例中未验证护照号码。 这是因为此字段需要对<code>addNewPerson</code>方法的参数进行交叉检查，因为用于验证<code>addNewPerson</code>的正则表达式模板的选择取决于<code>country</code>字段的值。 这种交叉验证完全类似于类级别的实体限制！ </p><br><p>  JSR 349和380支持参数的交叉验证。您可以阅读<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">hibernate文档，</a>以了解如何实现自己的类/接口方法的交叉验证。 </p><br><h2 id="za-predelami-bean-validation"> 外部bean验证 </h2><br><p> 世界上没有完美的事物，因此bean验证有其缺点和局限性： </p><br><ol><li> 有时我们只需要在将更改保存到数据库之前检查对象的复杂图的状态即可。 例如，您需要确保将客户订单的所有元素都放在一个包装中。 这是一个相当困难的操作，每当用户向订单中添加新项目时执行该操作并不是一个好主意。 因此，这种检查可能只需要一次：在数据库中保存<code>Order</code>对象及其<code>OrderItem</code>子对象之前。 </li><li> 在事务内部需要进行一些检查。 例如，电子商店系统应该在将商品提交到数据库之前检查是否有足够的商品副本以履行订单。 这样的检查只能在交易内部执行，因为 该系统是多线程的，库存商品的数量可能随时更改。 </li></ol><br><p>  CUBA平台提供了两种预提交的数据验证机制，称为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">实体侦听器</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">事务侦听器</a> 。 让我们更详细地考虑它们。 </p><br><h3 id="entity-listemers"> 实体名单 </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBA中的实体侦听</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>PreUpdateEvent</code>与</a> JPA提供给开发人员的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>PreInsertEvent</code> ， <code>PreUpdateEvent</code>和<code>PredDeleteEvent</code>侦听</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">器</a>非常相似。 两种机制都允许您在实体对象存储在数据库中之前和之后检查实体对象。 </p><br><p> 在CUBA中，很容易创建和连接实体侦听器，为此您需要做两件事： </p><br><ol><li> 创建一个实现实体侦听器接口之一的托管Bean。  3个接口对于验证很重要： <br>  <code>BeforeDeleteEntityListener&lt;T&gt;</code> ， <br>  <code>BeforeInsertEntityListener&lt;T&gt;</code> ， <br> <code>BeforeUpdateEntityListener&lt;T&gt;</code> </li> <li> 将<code>@Listeners</code>批注添加到您计划跟踪的实体对象。 </li></ol><br><p> 仅此而已。 </p><br><p> 与JPA标准（JSR 338，第3.5节）相比，CUBA Platform侦听器接口具有类型，因此您无需将<code>Object</code>类型的参数<code>Object</code>转换为实体类型即可开始使用它。  CUBA平台为相关实体或EntityManager调用者添加了加载和修改其他实体的能力。 所有这些更改还将调用相应的实体侦听器。 </p><br><p>  CUBA平台还支持<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“软删除”</a> ，这种方法不是将记录实际从数据库中删除，而是仅将它们标记为已删除，并且无法正常使用。 因此，对于软删除，平台将调用<code>BeforeDeleteEntityListener</code> / <code>AfterDeleteEntityListener</code>侦听器，而标准实现将调用<code>PreUpdate</code> / <code>PostUpdate</code> 。 </p><br><p> 让我们来看一个例子。 在这里，事件侦听器bean仅使用一行代码即可连接到实体类： <code>@Listeners</code>批注，它使用侦听器类的名称： </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Listeners</span></span>(<span class="hljs-string"><span class="hljs-string">"passportnumber_PersonEntityListener"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NamePattern</span></span>(<span class="hljs-string"><span class="hljs-string">"%s|name"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"PASSPORTNUMBER_PERSON"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span>(name = <span class="hljs-string"><span class="hljs-string">"passportnumber$Person"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ValidPassportNumber</span></span>(groups = {Default.class, UiCrossFieldChecks.class}) <span class="hljs-meta"><span class="hljs-meta">@FraudDetectionFlag</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... }</code> </pre> <br><p>  <a href="">人.java</a> </p><br><p> 侦听器实现本身看起来像这样： </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Checks that there are no other persons with the same * passport number and country code * Ignores spaces in the passport number for the check. * So numbers "12 45 768007" and "1245 768007" and "1245768007" * are the same for the validation purposes. */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Component</span></span>(<span class="hljs-string"><span class="hljs-string">"passportnumber_PersonEntityListener"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonEntityListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeforeDeleteEntityListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class">&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeforeInsertEntityListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class">&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeforeUpdateEntityListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBeforeDelete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Person person, EntityManager entityManager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!checkPassportIsUnique(person.getPassportNumber(), person.getCountry(), entityManager)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ValidationException( <span class="hljs-string"><span class="hljs-string">"Passport and country code combination isn't unique"</span></span>); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBeforeInsert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Person person, EntityManager entityManager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// use entity argument to validate the Person object // entityManager could be used to access database // if you need to check the data // throw ValidationException object if validation check failed if (!checkPassportIsUnique(person.getPassportNumber(), person.getCountry(), entityManager)) throw new ValidationException( "Passport and country code combination isn't unique"); } @Override public void onBeforeUpdate(Person person, EntityManager entityManager) { if (!checkPassportIsUnique(person.getPassportNumber(), person.getCountry(), entityManager)) throw new ValidationException( "Passport and country code combination isn't unique"); } ... }</span></span></code> </pre> <br><p>  <a href="">PersonEntityListener.java</a> </p><br><p> 在以下情况下，实体侦听器是一个不错的选择： </p><br><ul><li> 在实体对象存储在数据库中之前，有必要检查事务中的数据； </li><li> 在验证过程中，有必要检查数据库中的数据，例如，检查是否有足够的产品库存来接受订单； </li><li> 您不仅需要查看诸如<code>Order</code>的实体对象，还需要查看相关的实体，例如<code>Order</code>实体的<code>OrderItems</code> ； </li><li> 我们只想跟踪某些实体类的插入，更新或删除操作，例如，只跟踪<code>Order</code>和<code>OrderItem</code> ，并且我们不需要在交易过程中检查其他实体类中的更改。 </li></ul><br><h3 id="transaction-listeners"> 交易监听器 </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBA事务侦听器</a>也在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">事务</a>上下文中起作用，但是与实体侦听器相比，每个数据库事务都会调用它们。 </p><br><p> 这些赋予了他们超强的力量： </p><br><ul><li> 没有什么可以逃避他们的注意。 </li></ul><br><p> 但是，它们的缺点也决定了这一点： </p><br><ul><li> 他们更难写； </li><li> 它们会大大降低性能； </li><li> 应该非常仔细地编写它们：事务侦听器中的错误可能会干扰应用程序的初始加载。 </li></ul><br><p> 因此，当您需要使用相同的算法检查不同类型的实体时，例如，使用为您的所有业务对象提供服务的单一服务检查所有数据是否存在网络欺诈，事务监听器是一个很好的解决方案。 </p><br><p><img src="https://habrastorage.org/webt/km/v9/co/kmv9cougmokpc3opta_dfk4egqk.jpeg" alt="你不会通过！"></p><br><p> 查看一个示例，该示例检查该实体是否具有<code>@FraudDetectionFlag</code>批注，如果有，则启动欺诈检测器。 我重复一遍：请记住， <strong>在提交每个数据库事务之前</strong> ，已在系统上调用此方法，因此代码应尝试检查尽可能少的对象。 </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span>(<span class="hljs-string"><span class="hljs-string">"passportnumber_ApplicationTransactionListener"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationTransactionListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeforeCommitTransactionListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Logger log = LoggerFactory.getLogger(ApplicationTransactionListener.class); <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeCommit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EntityManager entityManager, Collection&lt;Entity&gt; managedEntities)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Entity entity : managedEntities) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> StandardEntity &amp;&amp; !((StandardEntity) entity).isDeleted() &amp;&amp; entity.getClass().isAnnotationPresent(FraudDetectionFlag.class) &amp;&amp; !fraudDetectorFeedAndFastCheck(entity)) { logFraudDetectionFailure(log, entity); String msg = String.format( <span class="hljs-string"><span class="hljs-string">"Fraud detection failure in '%s' with id = '%s'"</span></span>, entity.getClass().getSimpleName(), entity.getId()); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ValidationException(msg); } } } ... }</code> </pre> <br><p>  <a href="">ApplicationTransactionListener.java</a> </p><br><p> 要成为事务侦听器，托管bean必须实现<code>BeforeCommitTransactionListener</code>接口和<code>beforeCommit</code>方法。 应用程序启动时，事务侦听器会自动绑定。  CUBA将所有实现<code>BeforeCommitTransactionListener</code>或<code>AfterCompleteTransactionListener</code>类注册为事务侦听器。 </p><br><h2 id="zaklyuchenie"> 结论 </h2><br><p>  Bean验证<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">（JPA 303、349和980）</a>是可以为公司项目中95％的数据验证案例提供可靠依据的方法。 这种方法的主要优点是，大多数验证逻辑直接集中在域模型类中。 因此，它易于发现，易于阅读且易于维护。  Spring，CUBA和其他许多库都支持这些标准，并在UI层上接收数据，调用经过验证的方法或通过ORM存储数据时自动执行验证检查，因此从开发人员的角度来看，Bean验证通常看起来像魔术。 </p><br><p> 一些软件开发人员将主题模型的类级别的验证视为不自然且过于复杂，他们说UI级别的数据验证是一种相当有效的策略。 但是，我认为组件和UI控制器中的众多验证点并不是最合理的方法。   ,  ,  ,    ,     ,       listener'        . </p><br><p>  ,  ,     : </p><br><ol><li> <strong>JPA </strong>   ,          ,        DDL. </li><li> <strong>Bean Validation</strong> — , , ,             .      ,       . </li><li> <strong>  </strong>  bean validation,    .        , ,   REST. </li><li> <strong>Entity listeners:</strong>      ,   Bean Validation,             . ,         .  Hibernate    . </li><li> <strong>Transaction listeners</strong> — ,   ,    .  ,      ,                    . </li></ol><br><p> <em>PS: ,              Java,      ,    ,    .</em> </p><br><hr><br><h2 id="poleznye-ssylki"> 有用的链接 </h2><br><div class="spoiler">  <b class="spoiler_title">隐藏文字</b> <div class="spoiler_text"><h3 id="standarty-i-ih-realizacii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 标准及其实施 </font></font></h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 303-Bean验证1.0</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 349-Bean验证1.1</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 349，Bean验证规范</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 380，Bean验证规范</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator 5.4.2（JSR 349）参考</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator 6.10（JSR 380）参考</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">休眠验证器主页</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator 6.10 API文档</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HV 6.10：声明和验证方法约束</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HV 6.10：交叉参数约束</font></font></a> </li></ul><br><h3 id="biblioteki"> 图书馆 </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CUBA bean验证</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Validation cookbook for CUBA applications</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JavaFX with Bean Validation and CDI 2.0</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OVal — non a JSR 303, 349, 380 compliant validation framework</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Spring, Java Bean Validation Basics</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Validation, Data Binding, and Type Conversion in Spring 4.1</a> </li></ul><br><h3 id="filosofiya-validacii-dannyh">    </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Form validation best practices</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JavaFX Form Validation</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Blah vs Bean Validation: you missed the point like Mars Climate Orbiter</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Avoiding Many If Blocks For Validation Checking</a> </li></ul><br><h3 id="materialy-dlya-dalneyshego-chteniya">     </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Validation cookbook for CUBA applications</a> </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN427543/">https://habr.com/ru/post/zh-CN427543/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN427533/index.html">无需充电的智能手表。 有很多吗？</a></li>
<li><a href="../zh-CN427535/index.html">我们推出集体选择的解决方案</a></li>
<li><a href="../zh-CN427537/index.html">如何成为一名成功的产品经理：立即为您提供培训的课程</a></li>
<li><a href="../zh-CN427539/index.html">欧洲上次定冬</a></li>
<li><a href="../zh-CN427541/index.html">亚马逊敦促彭博社在有关服务器中中国间谍软件模块的文章中放弃备受关注的声明</a></li>
<li><a href="../zh-CN427545/index.html">在俄罗斯进行航空运输登记的“预期着陆”信息系统</a></li>
<li><a href="../zh-CN427549/index.html">2018年罗马俱乐部报告，第1.6章：技术通配符</a></li>
<li><a href="../zh-CN427551/index.html">为什么我们不能放弃QWERTY键盘</a></li>
<li><a href="../zh-CN427555/index.html">人类已经学会使用脸部识别技术进行追踪的动物</a></li>
<li><a href="../zh-CN427557/index.html">11月的IT事件摘要（第一部分）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>