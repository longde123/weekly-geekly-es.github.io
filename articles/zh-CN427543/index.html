<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”¶ ğŸ’² ğŸ‘§ğŸ¿ Javaåº”ç”¨ç¨‹åºä¸­çš„éªŒè¯ ğŸ§› ğŸ•´ğŸ¼ ğŸ…</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ¬æ–‡ä¸“é—¨è®¨è®ºå„ç§æ•°æ®éªŒè¯æ–¹æ³•ï¼šåœ¨Javaåº”ç”¨ç¨‹åºä¸­éªŒè¯æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šç¢°åˆ°é¡¹ç›®çš„é™·é˜±ä»¥åŠåº”éµå¾ªçš„æ–¹æ³•å’ŒæŠ€æœ¯ã€‚ 





 æˆ‘ç»å¸¸çœ‹åˆ°é‚£äº›åˆ›å»ºè€…ä¸è´¹å¹ç°ä¹‹åŠ›é€‰æ‹©æ•°æ®éªŒè¯æ–¹æ³•çš„é¡¹ç›®ã€‚ å›¢é˜Ÿåœ¨æˆªæ­¢æ—¥æœŸå’Œå«ç³Šè¦æ±‚ç­‰å½¢å¼çš„å·¨å¤§å‹åŠ›ä¸‹è¿›è¡Œäº†é¡¹ç›®å·¥ä½œï¼Œç»“æœï¼Œä»–ä»¬æ ¹æœ¬æ²¡æœ‰æ—¶é—´è¿›è¡Œå‡†ç¡®ï¼Œä¸€è‡´çš„éªŒè¯ã€‚ å› æ­¤ï¼Œå®ƒä»¬çš„éªŒè¯...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Javaåº”ç”¨ç¨‹åºä¸­çš„éªŒè¯</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/427543/"><p>  <em>æœ¬æ–‡ä¸“é—¨è®¨è®ºå„ç§æ•°æ®éªŒè¯æ–¹æ³•ï¼šåœ¨Javaåº”ç”¨ç¨‹åºä¸­éªŒè¯æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šç¢°åˆ°é¡¹ç›®çš„é™·é˜±ä»¥åŠåº”éµå¾ªçš„æ–¹æ³•å’ŒæŠ€æœ¯ã€‚</em> </p><br><p><img src="https://habrastorage.org/webt/cj/yc/yj/cjycyj3zf_l1ai9ch_vsgzisstk.png" alt="éªŒè¯æ–¹å¼"></p><br><p> æˆ‘ç»å¸¸çœ‹åˆ°é‚£äº›åˆ›å»ºè€…ä¸è´¹å¹ç°ä¹‹åŠ›é€‰æ‹©æ•°æ®éªŒè¯æ–¹æ³•çš„é¡¹ç›®ã€‚ å›¢é˜Ÿåœ¨æˆªæ­¢æ—¥æœŸå’Œå«ç³Šè¦æ±‚ç­‰å½¢å¼çš„å·¨å¤§å‹åŠ›ä¸‹è¿›è¡Œäº†é¡¹ç›®å·¥ä½œï¼Œç»“æœï¼Œä»–ä»¬æ ¹æœ¬æ²¡æœ‰æ—¶é—´è¿›è¡Œå‡†ç¡®ï¼Œä¸€è‡´çš„éªŒè¯ã€‚ å› æ­¤ï¼Œå®ƒä»¬çš„éªŒè¯ä»£ç åˆ†æ•£åœ¨å„å¤„ï¼šJavascriptä»£ç æ®µï¼Œå±å¹•æ§åˆ¶å™¨ï¼Œä¸šåŠ¡é€»è¾‘ç®±ï¼ŒåŸŸå®ä½“ï¼Œè§¦å‘å™¨å’Œæ•°æ®åº“çº¦æŸã€‚ è¿™æ®µä»£ç ä¸­å……æ»¡äº†if-elseè¯­å¥ï¼Œå¼•å‘äº†ä¸€ç³»åˆ—å¼‚å¸¸ï¼Œå¹¶è¯•å›¾æ‰¾å‡ºé‚£é‡Œçš„ç‰¹å®šæ•°æ®åœ¨å“ªé‡Œè¿›è¡Œäº†éªŒè¯...ç»“æœï¼Œéšç€é¡¹ç›®çš„å‘å±•ï¼Œéµå®ˆè¦æ±‚å˜å¾—å›°éš¾ä¸”æ˜‚è´µï¼ˆé€šå¸¸éå¸¸ä»¤äººå›°æƒ‘ï¼‰ï¼Œå¹¶ä¸”æ•°æ®éªŒè¯æ–¹æ³•çš„ä¸€è‡´æ€§ã€‚ </p><br><p> é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰ç®€å•è€Œä¼˜é›…çš„æ–¹æ³•æ¥éªŒè¯æ•°æ®ï¼Ÿ æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ä¿æŠ¤æˆ‘ä»¬å…å—æ— æ³•é˜…è¯»çš„ç½ªæ¶çš„ä¾µæ‰°ï¼Œå°†æ‰€æœ‰éªŒè¯é€»è¾‘æ”¾åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å·²ç»ç”±æµè¡Œçš„Javaæ¡†æ¶çš„å¼€å‘äººå‘˜ä¸ºæˆ‘ä»¬åˆ›å»ºäº†ï¼Ÿ </p><br><p> æ˜¯çš„ï¼Œæœ‰è¿™ç§æ–¹æ³•ã€‚ </p><a name="habracut"></a><br><p> å¯¹äºæˆ‘ä»¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBAå¹³å°</a>çš„å¼€å‘äººå‘˜è€Œè¨€ï¼Œä½¿ç”¨æœ€ä½³å®è·µéå¸¸é‡è¦ã€‚ æˆ‘ä»¬è®¤ä¸ºéªŒè¯ä»£ç åº”ï¼š </p><br><ol><li> å¯é‡å¤ä½¿ç”¨å¹¶éµå¾ªDRYåŸåˆ™ï¼› </li><li> è‡ªç„¶ä¸”æ˜“äºç†è§£ï¼› </li><li> æ”¾ç½®åœ¨å¼€å‘äººå‘˜å¸Œæœ›çœ‹åˆ°çš„åœ°æ–¹ï¼› </li><li> èƒ½å¤ŸéªŒè¯æ¥è‡ªä¸åŒæ¥æºçš„æ•°æ®ï¼šç”¨æˆ·ç•Œé¢ï¼ŒSOAPè°ƒç”¨ï¼ŒRESTç­‰ã€‚ </li><li> åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å·¥ä½œä¸ä¼šå‡ºç°é—®é¢˜ï¼› </li><li> è‡ªåŠ¨åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨è°ƒç”¨ï¼Œæ— éœ€æ‰‹åŠ¨è¿è¡Œæ£€æŸ¥ï¼› </li><li> åœ¨ç®€æ´çš„å¯¹è¯æ¡†ä¸­ä¸ºç”¨æˆ·æä¾›æ¸…æ™°ï¼Œæœ¬åœ°åŒ–çš„æ¶ˆæ¯ï¼› </li><li> éµå®ˆæ ‡å‡†ã€‚ </li></ol><br><p> è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ä½¿ç”¨CUBA Platformæ¡†æ¶ç¼–å†™çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºæ¥å®ç°è¿™ä¸€ç‚¹ã€‚ ä½†æ˜¯ï¼Œç”±äºCUBAåŸºäºSpringå’ŒEclipseLinkï¼Œå› æ­¤æ­¤å¤„ä½¿ç”¨çš„å¤§å¤šæ•°æŠ€æœ¯éƒ½å¯ä»¥åœ¨æ”¯æŒJPAå’ŒBeanéªŒè¯è§„èŒƒçš„ä»»ä½•å…¶ä»–Javaå¹³å°ä¸Šè¿è¡Œã€‚ </p><br><h2 id="validaciya-s-ispolzovaniem-database-constraints"> ä½¿ç”¨æ•°æ®åº“çº¦æŸè¿›è¡ŒéªŒè¯ </h2><br><p>éªŒè¯æ•°æ®çš„æœ€å¸¸è§ï¼Œæœ€æ˜æ˜¾çš„æ–¹æ³•å¯èƒ½æ˜¯åœ¨æ•°æ®åº“çº§åˆ«ä½¿ç”¨é™åˆ¶ï¼Œä¾‹å¦‚ï¼Œå¿…éœ€æ ‡å¿—ï¼ˆå¯¹äºå€¼ä¸èƒ½ä¸ºç©ºçš„å­—æ®µï¼‰ï¼Œå­—ç¬¦ä¸²é•¿åº¦ï¼Œå”¯ä¸€ç´¢å¼•ç­‰ã€‚ æ­¤æ–¹æ³•æœ€é€‚åˆä¼ä¸šåº”ç”¨ç¨‹åºï¼Œå› ä¸ºæ­¤ç±»è½¯ä»¶é€šå¸¸ä¸¥æ ¼ä¸“æ³¨äºæ•°æ®å¤„ç†ã€‚ ä½†æ˜¯ï¼Œå³ä½¿åœ¨è¿™é‡Œï¼Œå¼€å‘äººå‘˜ä¹Ÿç»å¸¸é€šè¿‡ä¸ºåº”ç”¨ç¨‹åºçš„æ¯ä¸ªçº§åˆ«åˆ†åˆ«è®¾ç½®é™åˆ¶æ¥çŠ¯é”™ã€‚ é€šå¸¸ï¼ŒåŸå› åœ¨äºå¼€å‘äººå‘˜ä¹‹é—´çš„è´£ä»»åˆ†é…ã€‚ </p><br><p> è€ƒè™‘ä¸€ä¸ªæˆ‘ä»¬å¤§å¤šæ•°äººéƒ½çŸ¥é“çš„ä¾‹å­ï¼Œç”šè‡³æœ‰ä¸€äº›æˆ‘ä»¬è‡ªå·±çš„ç»éªŒâ€¦â€¦å¦‚æœè§„èŒƒè¯´æŠ¤ç…§å·ç å­—æ®µä¸­åº”è¯¥æœ‰10ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ¯ä¸ªäººéƒ½ä¼šå¯¹æ­¤è¿›è¡Œæ£€æŸ¥ï¼šDDLä¸­çš„DBæ¶æ„å¸ˆï¼Œç›¸åº”Entityä¸­çš„åç«¯å¼€å‘äººå‘˜ä»¥åŠRESTæœåŠ¡ï¼Œæœ€åï¼ŒUIå¼€å‘äººå‘˜ç›´æ¥åœ¨å®¢æˆ·ç«¯ã€‚ ç„¶åæ­¤è¦æ±‚æ›´æ”¹ï¼Œå¹¶ä¸”å­—æ®µå¢åŠ åˆ°15ä¸ªå­—ç¬¦ã€‚  Devopsä¼šæ›´æ”¹æ•°æ®åº“ä¸­çš„çº¦æŸå€¼ï¼Œä½†å¯¹ç”¨æˆ·è€Œè¨€åˆ™æ²¡æœ‰ä»»ä½•å˜åŒ–ï¼Œå› ä¸ºåœ¨å®¢æˆ·ç«¯ï¼Œçº¦æŸæ˜¯ç›¸åŒçš„... </p><br><p> ä»»ä½•å¼€å‘äººå‘˜éƒ½çŸ¥é“å¦‚ä½•é¿å…æ­¤é—®é¢˜-éªŒè¯å¿…é¡»é›†ä¸­ï¼ åœ¨CUBAä¸­ï¼Œå¯ä»¥åœ¨JPAå®ä½“æ‰¹æ³¨ä¸­æ‰¾åˆ°è¿™ç§éªŒè¯ã€‚ åŸºäºæ­¤å…ƒä¿¡æ¯ï¼ŒCUBA Studioå°†ç”Ÿæˆæ­£ç¡®çš„DDLè„šæœ¬å¹¶åº”ç”¨é€‚å½“çš„å®¢æˆ·ç«¯éªŒè¯å™¨ã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/118/a16/f17/118a16f1705740a1676eb2c0ea164ef4.png" alt="çº¦æŸæ ·å“"></p><br><p> å¦‚æœæ³¨é‡Šå‘ç”Ÿæ›´æ”¹ï¼ŒCUBAå°†æ›´æ–°DDLè„šæœ¬å¹¶ç”Ÿæˆè¿ç§»è„šæœ¬ï¼Œå› æ­¤ï¼Œä¸‹æ¬¡æ‚¨éƒ¨ç½²é¡¹ç›®æ—¶ï¼ŒåŸºäºJPAçš„æ–°é™åˆ¶å°†åŒæ—¶åœ¨ç•Œé¢å’Œåº”ç”¨ç¨‹åºæ•°æ®åº“ä¸­ç”Ÿæ•ˆã€‚ </p><br><p>å°½ç®¡åœ¨æ•°æ®åº“çº§åˆ«ä¸Šçš„ç®€å•æ€§å’Œå®ç°æ–¹å¼ä½¿è¯¥æ–¹æ³•å…·æœ‰ç»å¯¹çš„å¯é æ€§ï¼Œä½†JPAæ³¨é‡Šçš„èŒƒå›´ä»…é™äºå¯ä»¥åœ¨DDLæ ‡å‡†ä¸­è¡¨ç¤ºçš„æœ€ç®€å•çš„æƒ…å†µï¼Œå¹¶ä¸”ä¸åŒ…æ‹¬æ•°æ®åº“è§¦å‘å™¨æˆ–å­˜å‚¨è¿‡ç¨‹ã€‚ å› æ­¤ï¼ŒåŸºäºJPAçš„çº¦æŸå¯ä»¥ä½¿å®ä½“å­—æ®µå”¯ä¸€æˆ–å¿…å¡«ï¼Œæˆ–è®¾ç½®æœ€å¤§åˆ—é•¿ã€‚ æ‚¨ç”šè‡³å¯ä»¥ä½¿ç”¨<code>@UniqueConstraint</code>æ‰¹æ³¨å¯¹åˆ—çš„ç»„åˆè®¾ç½®å”¯ä¸€çš„é™åˆ¶ã€‚ ä½†è¿™å¯èƒ½å°±æ˜¯å…¨éƒ¨ã€‚ </p><br><p> å¦‚æ­¤ä¸€æ¥ï¼Œåœ¨éœ€è¦æ›´å¤æ‚çš„éªŒè¯é€»è¾‘ï¼ˆä¾‹å¦‚ï¼Œæ£€æŸ¥å­—æ®µçš„æœ€å°å€¼/æœ€å¤§å€¼ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒéªŒè¯æˆ–ä»…é’ˆå¯¹æ‚¨çš„åº”ç”¨ç¨‹åºæ‰§è¡Œè‡ªå®šä¹‰æ£€æŸ¥ï¼‰çš„æƒ…å†µä¸‹ï¼Œå°†åº”ç”¨ç§°ä¸º<strong>â€œ BeanéªŒè¯â€</strong>çš„æ–¹æ³•ã€‚ </p><br><h2 id="bean-validation">  BeanéªŒè¯ </h2><br><p> å¤§å®¶éƒ½çŸ¥é“ï¼Œéµå¾ªå…·æœ‰è¾ƒé•¿ç”Ÿå‘½å‘¨æœŸçš„æ ‡å‡†æ˜¯ä¸€ç§å¾ˆå¥½çš„åšæ³•ï¼Œå…¶æœ‰æ•ˆæ€§å·²åœ¨æ•°åƒä¸ªé¡¹ç›®ä¸­å¾—åˆ°è¯æ˜ã€‚  Java BeanéªŒè¯æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JSR</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">380ã€349</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å’Œ303</a>åŠå…¶åº”ç”¨ç¨‹åºï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Hibernate Validator</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Apache BValï¼‰ä¸­è®°å½•çš„ä¸€ç§æ–¹æ³•</a> ã€‚ </p><br><p> å°½ç®¡è®¸å¤šå¼€å‘äººå‘˜éƒ½ç†Ÿæ‚‰è¿™ç§æ–¹æ³•ï¼Œä½†æ˜¯å®ƒç»å¸¸è¢«ä½ä¼°ã€‚ è¿™æ˜¯ä¸€ç§å³ä½¿åœ¨æ—§é¡¹ç›®ä¸­ä¹Ÿå¯ä»¥åµŒå…¥æ•°æ®éªŒè¯çš„ç®€ä¾¿æ–¹æ³•ï¼Œå®ƒä½¿æ‚¨å¯ä»¥æ¸…æ™°ï¼Œç®€å•ï¼Œå¯é ä¸”å°½å¯èƒ½æ¥è¿‘ä¸šåŠ¡é€»è¾‘æ¥æ„å»ºéªŒè¯ã€‚ </p><br><p> ä½¿ç”¨BeanéªŒè¯ä¸ºè¯¥é¡¹ç›®æä¾›äº†è®¸å¤šä¼˜åŠ¿ï¼š </p><br><ul><li> éªŒè¯é€»è¾‘ä½äºä¸»é¢˜åŒºåŸŸæ—è¾¹ï¼šå¯¹binçš„å­—æ®µå’Œæ–¹æ³•çš„é™åˆ¶çš„å®šä¹‰ä»¥è‡ªç„¶ä¸”çœŸæ­£é¢å‘å¯¹è±¡çš„æ–¹å¼å‘ç”Ÿã€‚ </li><li>  BeanéªŒè¯æ ‡å‡†ä¸ºæˆ‘ä»¬æä¾›äº†è®¸å¤š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">éªŒè¯æ³¨é‡Š</a> ï¼Œä¾‹å¦‚ï¼š <code>@Size</code> ï¼Œ <code>@Min</code> <code>@Pattern</code> ï¼Œ <code>@Email</code> ï¼Œ <code>@Past</code> <code>@Pattern</code> ï¼Œ <code>@Email</code> ï¼Œ <code>@Past</code> <code>@Pattern</code> ï¼Œ <code>@Email</code> ï¼Œ <code>@Past</code> ï¼Œä¸å¤ªæ ‡å‡†çš„<code>@URL</code> ï¼Œ <code>@Length</code> ï¼ŒåŠŸèƒ½æœ€å¼ºå¤§çš„<code>@ScriptAssert</code>ç­‰ç­‰ã€‚ </li><li> è¯¥æ ‡å‡†å¹¶ä¸ä»…é™äºç°æˆçš„æ³¨é‡Šï¼Œè¿˜å…è®¸æˆ‘ä»¬åˆ›å»ºè‡ªå·±çš„æ³¨é‡Šã€‚ æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ç»„åˆå¤šä¸ªå…¶ä»–æ³¨è§£æ¥åˆ›å»ºæ–°çš„æ³¨è§£ï¼Œæˆ–ä½¿ç”¨å•ç‹¬çš„Javaç±»ä½œä¸ºéªŒè¯å™¨å¯¹å…¶è¿›è¡Œå®šä¹‰ã€‚ <br> ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®<code>@ValidPassportNumber</code>ç±»çš„çº§åˆ«æ‰¹æ³¨ï¼Œä»¥æ ¹æ®<code>country</code>å­—æ®µçš„å€¼æ¥éªŒè¯æŠ¤ç…§å·ç æ˜¯å¦ä¸æ ¼å¼åŒ¹é…ã€‚ </li><li> çº¦æŸä¸ä»…å¯ä»¥åœ¨å­—æ®µæˆ–ç±»ä¸Šè®¾ç½®ï¼Œè¿˜å¯ä»¥åœ¨æ–¹æ³•åŠå…¶å‚æ•°ä¸Šè®¾ç½®ã€‚ è¿™ç§æ–¹æ³•ç§°ä¸º<strong>â€œåˆåŒç¡®è®¤â€</strong> ï¼Œå°†åœ¨ç¨åè®¨è®ºã€‚ </li></ul><br><p> å½“ç”¨æˆ·æäº¤è¾“å…¥çš„ä¿¡æ¯æ—¶ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBAå¹³å°</a> <em>ï¼ˆä¸å…¶ä»–æ¡†æ¶ä¸€æ ·ï¼‰ä¼š</em>è‡ªåŠ¨å¯åŠ¨BeanéªŒè¯ï¼Œå› æ­¤å¦‚æœéªŒè¯å¤±è´¥ï¼Œå®ƒä¼šç«‹å³æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨è¿è¡ŒbinéªŒè¯å™¨ã€‚ </p><br><p> è®©æˆ‘ä»¬è¿”å›å¸¦æœ‰æŠ¤ç…§å·ç çš„ç¤ºä¾‹ï¼Œä½†æ˜¯è¿™æ¬¡æˆ‘ä»¬å°†å¯¹Personå®ä½“çš„ä¸€äº›é™åˆ¶è¿›è¡Œè¡¥å……ï¼š </p><br><ul><li>  <code>name</code>å­—æ®µå¿…é¡»æ˜¯2ä¸ªæˆ–æ›´å¤šå­—ç¬¦ï¼Œå¹¶ä¸”å¿…é¡»æœ‰æ•ˆã€‚  ï¼ˆå¦‚æ‚¨æ‰€è§ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¹¶ä¸ç®€å•ï¼Œä½†æ˜¯â€œ Charles Ogier de Batz de Castelmore Comte d'Artagnanâ€å°†é€šè¿‡æµ‹è¯•ï¼Œè€Œâ€œ R2D2â€åˆ™ä¸ä¼šé€šè¿‡ï¼‰ï¼› </li><li>  <code>height</code> ï¼ˆé«˜åº¦ï¼‰åº”åœ¨ä»¥ä¸‹é—´éš”å†…ï¼š <code>0 &lt; height &lt;= 300</code> cm; </li><li>  <code>email</code>å­—æ®µå¿…é¡»åŒ…å«ä¸æ­£ç¡®ç”µå­é‚®ä»¶æ ¼å¼åŒ¹é…çš„å­—ç¬¦ä¸²ã€‚ </li></ul><br><p> ç»è¿‡æ‰€æœ‰è¿™äº›æ£€æŸ¥ï¼ŒPersonç±»å°†å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Listeners</span></span>(<span class="hljs-string"><span class="hljs-string">"passportnumber_PersonEntityListener"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NamePattern</span></span>(<span class="hljs-string"><span class="hljs-string">"%s|name"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"PASSPORTNUMBER_PERSON"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span>(name = <span class="hljs-string"><span class="hljs-string">"passportnumber$Person"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ValidPassportNumber</span></span>(groups = {Default.class, UiCrossFieldChecks.class}) <span class="hljs-meta"><span class="hljs-meta">@FraudDetectionFlag</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> serialVersionUID = -<span class="hljs-number"><span class="hljs-number">9150857881422152651L</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Pattern</span></span>(message = <span class="hljs-string"><span class="hljs-string">"Bad formed person name: ${validatedValue}"</span></span>, regexp = <span class="hljs-string"><span class="hljs-string">"^[AZ][az]*(\\s(([az]{1,3})|(([az]+\\')?[AZ][az]*)))*$"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Length</span></span>(min = <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"NAME"</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> String name; <span class="hljs-meta"><span class="hljs-meta">@Email</span></span>(message = <span class="hljs-string"><span class="hljs-string">"Email address has invalid format: ${validatedValue}"</span></span>, regexp = <span class="hljs-string"><span class="hljs-string">"^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"EMAIL"</span></span>, length = <span class="hljs-number"><span class="hljs-number">120</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> String email; <span class="hljs-meta"><span class="hljs-meta">@DecimalMax</span></span>(message = <span class="hljs-string"><span class="hljs-string">"Person height can not exceed 300 centimeters"</span></span>, value = <span class="hljs-string"><span class="hljs-string">"300"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@DecimalMin</span></span>(message = <span class="hljs-string"><span class="hljs-string">"Person height should be positive"</span></span>, value = <span class="hljs-string"><span class="hljs-string">"0"</span></span>, inclusive = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"HEIGHT"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> BigDecimal height; <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"COUNTRY"</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Integer country; <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"PASSPORT_NUMBER"</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, length = <span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> String passportNumber; ... }</code> </pre> <br><p>  <a href="">äºº.java</a> </p><br><p> æˆ‘ç›¸ä¿¡å¯¹<code>@DecimalMin</code> <code>@Length</code> ï¼Œ <code>@Pattern</code> <code>@DecimalMin</code> ï¼Œ <code>@Length</code> ï¼Œ <code>@Pattern</code>ä¹‹ç±»çš„æ³¨é‡Šçš„ä½¿ç”¨éå¸¸æ˜æ˜¾ï¼Œä¸éœ€è¦æ³¨é‡Šã€‚ è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹<code>@ValidPassportNumber</code>æ‰¹æ³¨çš„å®ç°ã€‚ </p><br><p> æˆ‘ä»¬å…¨æ–°çš„<code>@ValidPassportNumber</code>æ£€æŸ¥<code>Person#passportNumber</code> <code>@ValidPassportNumber</code>æ˜¯å¦ä¸<code>Person#country</code>å­—æ®µæŒ‡å®šçš„æ¯ä¸ªå›½å®¶çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…ã€‚ </p><br><p> é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ–‡æ¡£ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBA</a>æˆ–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Hibernate</a>æ‰‹å†Œå¾ˆå¥½ï¼‰ï¼Œæ ¹æ®å®ƒï¼Œæˆ‘ä»¬éœ€è¦ç”¨è¿™ä¸ªæ–°çš„æ³¨é‡Šæ ‡è®°æˆ‘ä»¬çš„ç±»ï¼Œå¹¶å°†<code>groups</code>å‚æ•°ä¼ é€’ç»™å®ƒï¼Œå…¶ä¸­<code>UiCrossFieldChecks.class</code>æ„å‘³ç€è¯¥éªŒè¯åº”åœ¨äº¤å‰å¤„è¿è¡Œã€‚éªŒè¯-æ£€æŸ¥æ‰€æœ‰å•ä¸ªå­—æ®µåï¼Œ <code>Default.class</code>å°†é™åˆ¶ä¿å­˜åœ¨é»˜è®¤éªŒè¯ç»„ä¸­ã€‚ </p><br><p> æ‰¹æ³¨æè¿°å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.TYPE) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Constraint</span></span>(validatedBy = ValidPassportNumberValidator.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ValidPassportNumber { <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> "Passport number is not valid"</span></span>; Class&lt;?&gt;[] groups() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; Class&lt;? extends Payload&gt;[] payload() <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> {}; }</code> </pre> <br><p>  <a href="">ValidPassportNumber.java</a> </p><br><p> åœ¨è¿™é‡Œï¼Œ <code>@Target(ElementType.TYPE)</code>è¡¨ç¤ºæ­¤è¿è¡Œæ—¶æ‰¹æ³¨çš„ç›®çš„æ˜¯è¯¥ç±»ï¼Œè€Œ<code>@Constraint(validatedBy = â€¦ )</code>ç¡®å®šéªŒè¯æ˜¯ç”±å®ç°<code>ConstraintValidator&lt;...&gt;</code>æ¥å£çš„<code>ValidPassportNumberValidator</code>ç±»æ‰§è¡Œçš„ã€‚ éªŒè¯ä»£ç æœ¬èº«åœ¨<code>isValid(...)</code>æ–¹æ³•ä¸­ï¼Œè¯¥æ–¹æ³•ä»¥ç›¸å½“ç®€å•çš„æ–¹å¼æ‰§è¡Œå®é™…éªŒè¯ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ValidPassportNumberValidator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConstraintValidator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ValidPassportNumber</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ValidPassportNumber constraint)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Person person, ConstraintValidatorContext context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (person == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (person.country == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || person.passportNumber == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> doPassportNumberFormatCheck(person.getCountry(), person.getPassportNumber()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doPassportNumberFormatCheck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CountryCode country, String passportNumber)</span></span></span><span class="hljs-function"> </span></span>{ ... } }</code> </pre> <br><p>  <a href="">ValidPassportNumberValidator.java</a> </p><br><p> ä»…æ­¤è€Œå·²ã€‚ ä½¿ç”¨CUBAå¹³å°ï¼Œæˆ‘ä»¬æ— éœ€ç¼–å†™ä»»ä½•ä»£ç ï¼Œåªéœ€ç¼–å†™ä¸€è¡Œä»£ç å³å¯ä½¿æˆ‘ä»¬çš„è‡ªå®šä¹‰éªŒè¯å·¥ä½œå¹¶å‘ç”¨æˆ·æä¾›é”™è¯¯æ¶ˆæ¯ã€‚ <br> æ²¡ä»€ä¹ˆå¤æ‚çš„ï¼Œå¯¹å§ï¼Ÿ </p><br><p> ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ åœ¨è¿™é‡Œï¼ŒCUBAè¿˜æœ‰å…¶ä»–åŠŸèƒ½ï¼šå®ƒä¸ä»…å‘ç”¨æˆ·æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ï¼Œè€Œä¸”è¿˜åœ¨æœªé€šè¿‡beanéªŒè¯çš„çº¢è‰²å­—æ®µä¸­çªå‡ºæ˜¾ç¤ºï¼š </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/310/83d/b2b/31083db2b14d67d88de169542b59748a.png" alt="UIè¡¨ç¤º"></p><br><p> è¿™ä¸æ˜¯ä¸€ä¸ªä¼˜é›…çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ é€šè¿‡ä»…å‘ä¸»é¢˜åŒºåŸŸçš„å®ä½“æ·»åŠ å‡ ä¸ªJavaæ‰¹æ³¨ï¼Œå¯ä»¥åœ¨UIä¸­å……åˆ†æ˜¾ç¤ºéªŒè¯é”™è¯¯ã€‚ </p><br><p> æ€»ç»“æœ¬èŠ‚ï¼Œè®©æˆ‘ä»¬å†æ¬¡ç®€è¦åˆ—å‡ºBeanéªŒè¯å¯¹å®ä½“çš„ä¼˜åŠ¿ï¼š </p><br><ol><li> å®ƒæ˜¯å¯ä»¥ç†è§£å’Œå¯è¯»çš„ï¼› </li><li> å…è®¸æ‚¨ç›´æ¥åœ¨å®ä½“ç±»ä¸­å®šä¹‰å€¼çº¦æŸï¼› </li><li> å¯ä»¥å®šåˆ¶å’Œè¡¥å……ï¼› </li><li> é›†æˆåˆ°æµè¡Œçš„ORMä¸­ï¼Œå¹¶åœ¨æ›´æ”¹ä¿å­˜åˆ°æ•°æ®åº“ä¹‹å‰è‡ªåŠ¨è¿è¡Œæ£€æŸ¥ï¼› </li><li> å½“ç”¨æˆ·å‘UIå‘é€æ•°æ®æ—¶ï¼ŒæŸäº›æ¡†æ¶è¿˜ä¼šè‡ªåŠ¨è¿è¡ŒBeanéªŒè¯ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œåˆ™å¾ˆå®¹æ˜“æ‰‹åŠ¨è°ƒç”¨<code>Validator</code>æ¥å£ï¼‰ï¼› </li><li>  BeanéªŒè¯æ˜¯å…¬è®¤çš„æ ‡å‡†ï¼Œå¹¶ä¸”åœ¨Internetä¸Šæœ‰å®Œæ•´çš„æ–‡æ¡£ã€‚ </li></ol><br><p> ä½†æ˜¯ï¼Œå¦‚æœæ‚¨éœ€è¦å¯¹æ–¹æ³•ï¼Œæ„é€ å‡½æ•°æˆ–RESTåœ°å€è®¾ç½®é™åˆ¶ä»¥éªŒè¯æ¥è‡ªå¤–éƒ¨ç³»ç»Ÿçš„æ•°æ®æ€ä¹ˆåŠï¼Ÿ æˆ–è€…ï¼Œå¦‚æœæ‚¨éœ€è¦å£°æ˜æ€§åœ°æ£€æŸ¥æ–¹æ³•å‚æ•°çš„å€¼ï¼Œè€Œæ— éœ€åœ¨æ¯ä¸ªè¦æµ‹è¯•çš„æ–¹æ³•ä¸­ç¼–å†™å¸¦æœ‰è®¸å¤šif-elseæ¡ä»¶çš„æ— èŠä»£ç ï¼Ÿ </p><br><p> ç­”æ¡ˆå¾ˆç®€å•ï¼šBeanéªŒè¯ä¹Ÿé€‚ç”¨äºæ–¹æ³•ï¼ </p><br><h2 id="validation-by-contract"> åˆåŒç¡®è®¤ </h2><br><p> æœ‰æ—¶æœ‰å¿…è¦è¶…è¶Šæ•°æ®æ¨¡å‹çŠ¶æ€çš„éªŒè¯ã€‚ è®¸å¤šæ–¹æ³•å¯èƒ½ä¼šå—ç›Šäºå‚æ•°å’Œè¿”å›å€¼çš„è‡ªåŠ¨éªŒè¯ã€‚ è¿™å¯èƒ½ä¸ä»…æ˜¯å¿…è¦çš„ï¼Œä»¥æ£€æŸ¥å»å¾€RESTæˆ–SOAPåœ°å€çš„æ•°æ®ï¼Œè€Œä¸”åœ¨æˆ‘ä»¬è¦è®°ä¸‹æ–¹æ³•è°ƒç”¨çš„å‰ææ¡ä»¶å’Œåç½®æ¡ä»¶ä»¥ç¡®ä¿è¾“å…¥çš„æ•°æ®åœ¨æ‰§è¡Œæ–¹æ³•ä¸»ä½“ä¹‹å‰å·²éªŒè¯æˆ–è¿”å›å€¼çš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¯å¿…è¦çš„ã€‚æ˜¯åœ¨é¢„æœŸèŒƒå›´å†…ï¼Œæˆ–è€…ä¾‹å¦‚ï¼Œæˆ‘ä»¬åªéœ€è¦å£°æ˜æ€§åœ°æè¿°è¾“å…¥å‚æ•°çš„å€¼èŒƒå›´å³å¯æé«˜ä»£ç çš„å¯è¯»æ€§ã€‚ </p><br><p> ä½¿ç”¨beanéªŒè¯ï¼Œå¯ä»¥å°†é™åˆ¶åº”ç”¨äºæ–¹æ³•å’Œæ„é€ å‡½æ•°çš„è¾“å…¥å‚æ•°ä»¥åŠè¿”å›å€¼ï¼Œä»¥æ£€æŸ¥ä»»ä½•Javaç±»ä¸­å…¶è°ƒç”¨çš„å…ˆå†³æ¡ä»¶å’Œåç½®æ¡ä»¶ã€‚ ä¸ä¼ ç»Ÿçš„æ£€æŸ¥å‚æ•°å’Œè¿”å›å€¼æœ‰æ•ˆæ€§çš„æ–¹æ³•ç›¸æ¯”ï¼Œæ­¤è·¯å¾„å…·æœ‰å¤šä¸ªä¼˜ç‚¹ï¼š </p><br><ol><li> ä¸å¿…ä»¥å‘½ä»¤å¼æ–¹å¼æ‰‹åŠ¨æ‰§è¡Œæ£€æŸ¥ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡æŠ›å‡º<code>IllegalArgumentException</code>ç­‰ï¼‰ã€‚ æ‚¨å¯ä»¥å£°æ˜æ€§åœ°å®šä¹‰çº¦æŸï¼Œå¹¶ä½¿ä»£ç æ›´æ˜“äºç†è§£å’Œè¡¨è¾¾ã€‚ </li><li> å¯ä»¥é…ç½®ï¼Œé‡ç”¨å’Œé…ç½®çº¦æŸï¼šæ‚¨æ— éœ€ä¸ºæ¯ä¸ªæ£€æŸ¥ç¼–å†™éªŒè¯é€»è¾‘ã€‚ æ›´å°‘çš„ä»£ç æ„å‘³ç€æ›´å°‘çš„é”™è¯¯ã€‚ </li><li> å¦‚æœç±»ï¼Œæ–¹æ³•çš„è¿”å›å€¼æˆ–å…¶å‚æ•°ç”¨<code>@Validated</code>æ‰¹æ³¨æ ‡è®°ï¼Œåˆ™æ¯æ¬¡è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œå¹³å°éƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œæ£€æŸ¥ã€‚ </li><li> å¦‚æœè¯¥å¯æ‰§è¡Œæ–‡ä»¶å¸¦æœ‰<code>@Documented</code>æ‰¹æ³¨ï¼Œåˆ™å…¶å‰ææ¡ä»¶å°†åŒ…å«åœ¨ç”Ÿæˆçš„JavaDocä¸­ã€‚ </li></ol><br><p> ä½¿ç”¨<strong>â€œåˆåŒéªŒè¯â€ï¼Œ</strong>æˆ‘ä»¬å¯ä»¥è·å¾—æ¸…æ™°ï¼Œç´§å‡‘ä¸”æ˜“äºç»´æŠ¤çš„ä»£ç ã€‚ </p><br><p> ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹CUBAåº”ç”¨ç¨‹åºçš„RESTæ§åˆ¶å™¨çš„æ¥å£ã€‚  <code>PersonApiService</code>æ¥å£å…è®¸æ‚¨ä½¿ç”¨<code>getPersons()</code>æ–¹æ³•ä»æ•°æ®åº“ä¸­è·å–äººå‘˜åˆ—è¡¨ï¼Œå¹¶ä½¿ç”¨<code>addNewPerson(...)</code>è°ƒç”¨æ·»åŠ æ–°äººå‘˜ã€‚ </p><br><p> å¹¶ä¸”ä¸è¦å¿˜è®°beanéªŒè¯æ˜¯ç»§æ‰¿çš„ï¼ æ¢å¥è¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬æ³¨é‡ŠæŸä¸ªç±»ï¼Œå­—æ®µæˆ–æ–¹æ³•ï¼Œåˆ™æ‰€æœ‰ç»§æ‰¿è¯¥ç±»æˆ–å®ç°æ­¤æ¥å£çš„ç±»éƒ½å°†ç»å—ç›¸åŒçš„éªŒè¯æ³¨é‡Šã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Validated</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonApiService</span></span></span><span class="hljs-class"> </span></span>{ String NAME = <span class="hljs-string"><span class="hljs-string">"passportnumber_PersonApiService"</span></span>; <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Valid</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequiredView</span></span>(<span class="hljs-string"><span class="hljs-string">"_local"</span></span>) <span class="hljs-function"><span class="hljs-function">List&lt;Person&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPersons</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addNewPerson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( @NotNull @Length(min = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">, max = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">255</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pattern</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Bad formed person name: ${validatedValue}"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, regexp = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"^[AZ][az]*(\\s(([az]{1,3})|(([az]+\\')?[AZ][az]*)))*$"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String name, @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DecimalMax</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Person height can not exceed 300 cm"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, value = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"300"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DecimalMin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Person height should be positive"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, value = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"0"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, inclusive = </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">false</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> BigDecimal height, @NotNull CountryCode country, @NotNull String passportNumber )</span></span>; }</code> </pre> <br><p>  <a href="">PersonApiService.java</a> </p><br><p> è¿™æ®µä»£ç æ˜¯å¦è¶³å¤Ÿæ¸…æ™°ï¼Ÿ <br>  _ï¼ˆé™¤äº†<code>@RequiredView(â€œ_localâ€)</code>æ³¨é‡Š<code>@RequiredView(â€œ_localâ€)</code> ï¼ˆç‰¹å®šäºCUBAå¹³å°ï¼Œå¹¶éªŒè¯è¿”å›çš„<code>Person</code>å¯¹è±¡åŒ…å«<code>PASSPORTNUMBER_PERSON</code>è¡¨ä¸­çš„æ‰€æœ‰å­—æ®µï¼‰ã€‚ </p><br><p>  <code>@Valid</code>å®šä¹‰äº†<code>getPersons()</code>æ–¹æ³•è¿”å›çš„æ¯ä¸ªé›†åˆå¯¹è±¡è¿˜å¿…é¡»æ ¹æ®<code>Person</code>ç±»çš„é™åˆ¶è¿›è¡ŒéªŒè¯ã€‚ </p><br><p> åœ¨CUBAåº”ç”¨ç¨‹åºä¸­ï¼Œä»¥ä¸‹åœ°å€æä¾›äº†è¿™äº›æ–¹æ³•ï¼š </p><br><ul><li>  / app / rest / v2 / services / passportnumber_PersonApiService / getPersons </li><li>  / app / rest / v2 / services / passportnumber_PersonApiService / addNewPerson </li></ul><br><p> è®©æˆ‘ä»¬æ‰“å¼€Postmanåº”ç”¨ç¨‹åºï¼Œå¹¶ç¡®ä¿éªŒè¯å¯ä»¥æ­£å¸¸è¿›è¡Œï¼š </p><br><p><img src="https://habrastorage.org/webt/qg/ra/qj/qgraqjsxfyeqqa6qcjf2pkf7tcq.png" alt="é‚®é€’å‘˜åº”ç”¨"></p><br><p> æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­æœªéªŒè¯æŠ¤ç…§å·ç ã€‚ è¿™æ˜¯å› ä¸ºæ­¤å­—æ®µéœ€è¦å¯¹<code>addNewPerson</code>æ–¹æ³•çš„å‚æ•°è¿›è¡Œäº¤å‰æ£€æŸ¥ï¼Œå› ä¸ºç”¨äºéªŒè¯<code>addNewPerson</code>çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡æ¿çš„é€‰æ‹©å–å†³äº<code>country</code>å­—æ®µçš„å€¼ã€‚ è¿™ç§äº¤å‰éªŒè¯å®Œå…¨ç±»ä¼¼äºç±»çº§åˆ«çš„å®ä½“é™åˆ¶ï¼ </p><br><p>  JSR 349å’Œ380æ”¯æŒå‚æ•°çš„äº¤å‰éªŒè¯ã€‚æ‚¨å¯ä»¥é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">hibernateæ–‡æ¡£ï¼Œ</a>ä»¥äº†è§£å¦‚ä½•å®ç°è‡ªå·±çš„ç±»/æ¥å£æ–¹æ³•çš„äº¤å‰éªŒè¯ã€‚ </p><br><h2 id="za-predelami-bean-validation"> å¤–éƒ¨beanéªŒè¯ </h2><br><p> ä¸–ç•Œä¸Šæ²¡æœ‰å®Œç¾çš„äº‹ç‰©ï¼Œå› æ­¤beanéªŒè¯æœ‰å…¶ç¼ºç‚¹å’Œå±€é™æ€§ï¼š </p><br><ol><li> æœ‰æ—¶æˆ‘ä»¬åªéœ€è¦åœ¨å°†æ›´æ”¹ä¿å­˜åˆ°æ•°æ®åº“ä¹‹å‰æ£€æŸ¥å¯¹è±¡çš„å¤æ‚å›¾çš„çŠ¶æ€å³å¯ã€‚ ä¾‹å¦‚ï¼Œæ‚¨éœ€è¦ç¡®ä¿å°†å®¢æˆ·è®¢å•çš„æ‰€æœ‰å…ƒç´ éƒ½æ”¾åœ¨ä¸€ä¸ªåŒ…è£…ä¸­ã€‚ è¿™æ˜¯ä¸€ä¸ªç›¸å½“å›°éš¾çš„æ“ä½œï¼Œæ¯å½“ç”¨æˆ·å‘è®¢å•ä¸­æ·»åŠ æ–°é¡¹ç›®æ—¶æ‰§è¡Œè¯¥æ“ä½œå¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ å› æ­¤ï¼Œè¿™ç§æ£€æŸ¥å¯èƒ½åªéœ€è¦ä¸€æ¬¡ï¼šåœ¨æ•°æ®åº“ä¸­ä¿å­˜<code>Order</code>å¯¹è±¡åŠå…¶<code>OrderItem</code>å­å¯¹è±¡ä¹‹å‰ã€‚ </li><li> åœ¨äº‹åŠ¡å†…éƒ¨éœ€è¦è¿›è¡Œä¸€äº›æ£€æŸ¥ã€‚ ä¾‹å¦‚ï¼Œç”µå­å•†åº—ç³»ç»Ÿåº”è¯¥åœ¨å°†å•†å“æäº¤åˆ°æ•°æ®åº“ä¹‹å‰æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„å•†å“å‰¯æœ¬ä»¥å±¥è¡Œè®¢å•ã€‚ è¿™æ ·çš„æ£€æŸ¥åªèƒ½åœ¨äº¤æ˜“å†…éƒ¨æ‰§è¡Œï¼Œå› ä¸º è¯¥ç³»ç»Ÿæ˜¯å¤šçº¿ç¨‹çš„ï¼Œåº“å­˜å•†å“çš„æ•°é‡å¯èƒ½éšæ—¶æ›´æ”¹ã€‚ </li></ol><br><p>  CUBAå¹³å°æä¾›äº†ä¸¤ç§é¢„æäº¤çš„æ•°æ®éªŒè¯æœºåˆ¶ï¼Œç§°ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®ä½“ä¾¦å¬å™¨</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº‹åŠ¡ä¾¦å¬å™¨</a> ã€‚ è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°è€ƒè™‘å®ƒä»¬ã€‚ </p><br><h3 id="entity-listemers"> å®ä½“åå• </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBAä¸­çš„å®ä½“ä¾¦å¬</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>PreUpdateEvent</code>ä¸</a> JPAæä¾›ç»™å¼€å‘äººå‘˜çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>PreInsertEvent</code> ï¼Œ <code>PreUpdateEvent</code>å’Œ<code>PredDeleteEvent</code>ä¾¦å¬</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å™¨</a>éå¸¸ç›¸ä¼¼ã€‚ ä¸¤ç§æœºåˆ¶éƒ½å…è®¸æ‚¨åœ¨å®ä½“å¯¹è±¡å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ä¹‹å‰å’Œä¹‹åæ£€æŸ¥å®ä½“å¯¹è±¡ã€‚ </p><br><p> åœ¨CUBAä¸­ï¼Œå¾ˆå®¹æ˜“åˆ›å»ºå’Œè¿æ¥å®ä½“ä¾¦å¬å™¨ï¼Œä¸ºæ­¤æ‚¨éœ€è¦åšä¸¤ä»¶äº‹ï¼š </p><br><ol><li> åˆ›å»ºä¸€ä¸ªå®ç°å®ä½“ä¾¦å¬å™¨æ¥å£ä¹‹ä¸€çš„æ‰˜ç®¡Beanã€‚  3ä¸ªæ¥å£å¯¹äºéªŒè¯å¾ˆé‡è¦ï¼š <br>  <code>BeforeDeleteEntityListener&lt;T&gt;</code> ï¼Œ <br>  <code>BeforeInsertEntityListener&lt;T&gt;</code> ï¼Œ <br> <code>BeforeUpdateEntityListener&lt;T&gt;</code> </li> <li> å°†<code>@Listeners</code>æ‰¹æ³¨æ·»åŠ åˆ°æ‚¨è®¡åˆ’è·Ÿè¸ªçš„å®ä½“å¯¹è±¡ã€‚ </li></ol><br><p> ä»…æ­¤è€Œå·²ã€‚ </p><br><p> ä¸JPAæ ‡å‡†ï¼ˆJSR 338ï¼Œç¬¬3.5èŠ‚ï¼‰ç›¸æ¯”ï¼ŒCUBA Platformä¾¦å¬å™¨æ¥å£å…·æœ‰ç±»å‹ï¼Œå› æ­¤æ‚¨æ— éœ€å°†<code>Object</code>ç±»å‹çš„å‚æ•°<code>Object</code>è½¬æ¢ä¸ºå®ä½“ç±»å‹å³å¯å¼€å§‹ä½¿ç”¨å®ƒã€‚  CUBAå¹³å°ä¸ºç›¸å…³å®ä½“æˆ–EntityManagerè°ƒç”¨è€…æ·»åŠ äº†åŠ è½½å’Œä¿®æ”¹å…¶ä»–å®ä½“çš„èƒ½åŠ›ã€‚ æ‰€æœ‰è¿™äº›æ›´æ”¹è¿˜å°†è°ƒç”¨ç›¸åº”çš„å®ä½“ä¾¦å¬å™¨ã€‚ </p><br><p>  CUBAå¹³å°è¿˜æ”¯æŒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œè½¯åˆ é™¤â€</a> ï¼Œè¿™ç§æ–¹æ³•ä¸æ˜¯å°†è®°å½•å®é™…ä»æ•°æ®åº“ä¸­åˆ é™¤ï¼Œè€Œæ˜¯ä»…å°†å®ƒä»¬æ ‡è®°ä¸ºå·²åˆ é™¤ï¼Œå¹¶ä¸”æ— æ³•æ­£å¸¸ä½¿ç”¨ã€‚ å› æ­¤ï¼Œå¯¹äºè½¯åˆ é™¤ï¼Œå¹³å°å°†è°ƒç”¨<code>BeforeDeleteEntityListener</code> / <code>AfterDeleteEntityListener</code>ä¾¦å¬å™¨ï¼Œè€Œæ ‡å‡†å®ç°å°†è°ƒç”¨<code>PreUpdate</code> / <code>PostUpdate</code> ã€‚ </p><br><p> è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚ åœ¨è¿™é‡Œï¼Œäº‹ä»¶ä¾¦å¬å™¨beanä»…ä½¿ç”¨ä¸€è¡Œä»£ç å³å¯è¿æ¥åˆ°å®ä½“ç±»ï¼š <code>@Listeners</code>æ‰¹æ³¨ï¼Œå®ƒä½¿ç”¨ä¾¦å¬å™¨ç±»çš„åç§°ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Listeners</span></span>(<span class="hljs-string"><span class="hljs-string">"passportnumber_PersonEntityListener"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NamePattern</span></span>(<span class="hljs-string"><span class="hljs-string">"%s|name"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"PASSPORTNUMBER_PERSON"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span>(name = <span class="hljs-string"><span class="hljs-string">"passportnumber$Person"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ValidPassportNumber</span></span>(groups = {Default.class, UiCrossFieldChecks.class}) <span class="hljs-meta"><span class="hljs-meta">@FraudDetectionFlag</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardEntity</span></span></span><span class="hljs-class"> </span></span>{ ... }</code> </pre> <br><p>  <a href="">äºº.java</a> </p><br><p> ä¾¦å¬å™¨å®ç°æœ¬èº«çœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Checks that there are no other persons with the same * passport number and country code * Ignores spaces in the passport number for the check. * So numbers "12 45 768007" and "1245 768007" and "1245768007" * are the same for the validation purposes. */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Component</span></span>(<span class="hljs-string"><span class="hljs-string">"passportnumber_PersonEntityListener"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersonEntityListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeforeDeleteEntityListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class">&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeforeInsertEntityListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class">&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeforeUpdateEntityListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBeforeDelete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Person person, EntityManager entityManager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!checkPassportIsUnique(person.getPassportNumber(), person.getCountry(), entityManager)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ValidationException( <span class="hljs-string"><span class="hljs-string">"Passport and country code combination isn't unique"</span></span>); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBeforeInsert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Person person, EntityManager entityManager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// use entity argument to validate the Person object // entityManager could be used to access database // if you need to check the data // throw ValidationException object if validation check failed if (!checkPassportIsUnique(person.getPassportNumber(), person.getCountry(), entityManager)) throw new ValidationException( "Passport and country code combination isn't unique"); } @Override public void onBeforeUpdate(Person person, EntityManager entityManager) { if (!checkPassportIsUnique(person.getPassportNumber(), person.getCountry(), entityManager)) throw new ValidationException( "Passport and country code combination isn't unique"); } ... }</span></span></code> </pre> <br><p>  <a href="">PersonEntityListener.java</a> </p><br><p> åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œå®ä½“ä¾¦å¬å™¨æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼š </p><br><ul><li> åœ¨å®ä½“å¯¹è±¡å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ä¹‹å‰ï¼Œæœ‰å¿…è¦æ£€æŸ¥äº‹åŠ¡ä¸­çš„æ•°æ®ï¼› </li><li> åœ¨éªŒè¯è¿‡ç¨‹ä¸­ï¼Œæœ‰å¿…è¦æ£€æŸ¥æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„äº§å“åº“å­˜æ¥æ¥å—è®¢å•ï¼› </li><li> æ‚¨ä¸ä»…éœ€è¦æŸ¥çœ‹è¯¸å¦‚<code>Order</code>çš„å®ä½“å¯¹è±¡ï¼Œè¿˜éœ€è¦æŸ¥çœ‹ç›¸å…³çš„å®ä½“ï¼Œä¾‹å¦‚<code>Order</code>å®ä½“çš„<code>OrderItems</code> ï¼› </li><li> æˆ‘ä»¬åªæƒ³è·Ÿè¸ªæŸäº›å®ä½“ç±»çš„æ’å…¥ï¼Œæ›´æ–°æˆ–åˆ é™¤æ“ä½œï¼Œä¾‹å¦‚ï¼Œåªè·Ÿè¸ª<code>Order</code>å’Œ<code>OrderItem</code> ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸éœ€è¦åœ¨äº¤æ˜“è¿‡ç¨‹ä¸­æ£€æŸ¥å…¶ä»–å®ä½“ç±»ä¸­çš„æ›´æ”¹ã€‚ </li></ul><br><h3 id="transaction-listeners"> äº¤æ˜“ç›‘å¬å™¨ </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CUBAäº‹åŠ¡ä¾¦å¬å™¨</a>ä¹Ÿåœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº‹åŠ¡</a>ä¸Šä¸‹æ–‡ä¸­èµ·ä½œç”¨ï¼Œä½†æ˜¯ä¸å®ä½“ä¾¦å¬å™¨ç›¸æ¯”ï¼Œæ¯ä¸ªæ•°æ®åº“äº‹åŠ¡éƒ½ä¼šè°ƒç”¨å®ƒä»¬ã€‚ </p><br><p> è¿™äº›èµ‹äºˆäº†ä»–ä»¬è¶…å¼ºçš„åŠ›é‡ï¼š </p><br><ul><li> æ²¡æœ‰ä»€ä¹ˆå¯ä»¥é€ƒé¿ä»–ä»¬çš„æ³¨æ„ã€‚ </li></ul><br><p> ä½†æ˜¯ï¼Œå®ƒä»¬çš„ç¼ºç‚¹ä¹Ÿå†³å®šäº†è¿™ä¸€ç‚¹ï¼š </p><br><ul><li> ä»–ä»¬æ›´éš¾å†™ï¼› </li><li> å®ƒä»¬ä¼šå¤§å¤§é™ä½æ€§èƒ½ï¼› </li><li> åº”è¯¥éå¸¸ä»”ç»†åœ°ç¼–å†™å®ƒä»¬ï¼šäº‹åŠ¡ä¾¦å¬å™¨ä¸­çš„é”™è¯¯å¯èƒ½ä¼šå¹²æ‰°åº”ç”¨ç¨‹åºçš„åˆå§‹åŠ è½½ã€‚ </li></ul><br><p> å› æ­¤ï¼Œå½“æ‚¨éœ€è¦ä½¿ç”¨ç›¸åŒçš„ç®—æ³•æ£€æŸ¥ä¸åŒç±»å‹çš„å®ä½“æ—¶ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨ä¸ºæ‚¨çš„æ‰€æœ‰ä¸šåŠ¡å¯¹è±¡æä¾›æœåŠ¡çš„å•ä¸€æœåŠ¡æ£€æŸ¥æ‰€æœ‰æ•°æ®æ˜¯å¦å­˜åœ¨ç½‘ç»œæ¬ºè¯ˆï¼Œäº‹åŠ¡ç›‘å¬å™¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚ </p><br><p><img src="https://habrastorage.org/webt/km/v9/co/kmv9cougmokpc3opta_dfk4egqk.jpeg" alt="ä½ ä¸ä¼šé€šè¿‡ï¼"></p><br><p> æŸ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹æ£€æŸ¥è¯¥å®ä½“æ˜¯å¦å…·æœ‰<code>@FraudDetectionFlag</code>æ‰¹æ³¨ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å¯åŠ¨æ¬ºè¯ˆæ£€æµ‹å™¨ã€‚ æˆ‘é‡å¤ä¸€éï¼šè¯·è®°ä½ï¼Œ <strong>åœ¨æäº¤æ¯ä¸ªæ•°æ®åº“äº‹åŠ¡ä¹‹å‰</strong> ï¼Œå·²åœ¨ç³»ç»Ÿä¸Šè°ƒç”¨æ­¤æ–¹æ³•ï¼Œå› æ­¤ä»£ç åº”å°è¯•æ£€æŸ¥å°½å¯èƒ½å°‘çš„å¯¹è±¡ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span>(<span class="hljs-string"><span class="hljs-string">"passportnumber_ApplicationTransactionListener"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationTransactionListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeforeCommitTransactionListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Logger log = LoggerFactory.getLogger(ApplicationTransactionListener.class); <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeCommit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EntityManager entityManager, Collection&lt;Entity&gt; managedEntities)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Entity entity : managedEntities) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> StandardEntity &amp;&amp; !((StandardEntity) entity).isDeleted() &amp;&amp; entity.getClass().isAnnotationPresent(FraudDetectionFlag.class) &amp;&amp; !fraudDetectorFeedAndFastCheck(entity)) { logFraudDetectionFailure(log, entity); String msg = String.format( <span class="hljs-string"><span class="hljs-string">"Fraud detection failure in '%s' with id = '%s'"</span></span>, entity.getClass().getSimpleName(), entity.getId()); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ValidationException(msg); } } } ... }</code> </pre> <br><p>  <a href="">ApplicationTransactionListener.java</a> </p><br><p> è¦æˆä¸ºäº‹åŠ¡ä¾¦å¬å™¨ï¼Œæ‰˜ç®¡beanå¿…é¡»å®ç°<code>BeforeCommitTransactionListener</code>æ¥å£å’Œ<code>beforeCommit</code>æ–¹æ³•ã€‚ åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œäº‹åŠ¡ä¾¦å¬å™¨ä¼šè‡ªåŠ¨ç»‘å®šã€‚  CUBAå°†æ‰€æœ‰å®ç°<code>BeforeCommitTransactionListener</code>æˆ–<code>AfterCompleteTransactionListener</code>ç±»æ³¨å†Œä¸ºäº‹åŠ¡ä¾¦å¬å™¨ã€‚ </p><br><h2 id="zaklyuchenie"> ç»“è®º </h2><br><p>  BeanéªŒè¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ï¼ˆJPA 303ã€349å’Œ980ï¼‰</a>æ˜¯å¯ä»¥ä¸ºå…¬å¸é¡¹ç›®ä¸­95ï¼…çš„æ•°æ®éªŒè¯æ¡ˆä¾‹æä¾›å¯é ä¾æ®çš„æ–¹æ³•ã€‚ è¿™ç§æ–¹æ³•çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ï¼Œå¤§å¤šæ•°éªŒè¯é€»è¾‘ç›´æ¥é›†ä¸­åœ¨åŸŸæ¨¡å‹ç±»ä¸­ã€‚ å› æ­¤ï¼Œå®ƒæ˜“äºå‘ç°ï¼Œæ˜“äºé˜…è¯»ä¸”æ˜“äºç»´æŠ¤ã€‚  Springï¼ŒCUBAå’Œå…¶ä»–è®¸å¤šåº“éƒ½æ”¯æŒè¿™äº›æ ‡å‡†ï¼Œå¹¶åœ¨UIå±‚ä¸Šæ¥æ”¶æ•°æ®ï¼Œè°ƒç”¨ç»è¿‡éªŒè¯çš„æ–¹æ³•æˆ–é€šè¿‡ORMå­˜å‚¨æ•°æ®æ—¶è‡ªåŠ¨æ‰§è¡ŒéªŒè¯æ£€æŸ¥ï¼Œå› æ­¤ä»å¼€å‘äººå‘˜çš„è§’åº¦æ¥çœ‹ï¼ŒBeanéªŒè¯é€šå¸¸çœ‹èµ·æ¥åƒé­”æœ¯ã€‚ </p><br><p> ä¸€äº›è½¯ä»¶å¼€å‘äººå‘˜å°†ä¸»é¢˜æ¨¡å‹çš„ç±»çº§åˆ«çš„éªŒè¯è§†ä¸ºä¸è‡ªç„¶ä¸”è¿‡äºå¤æ‚ï¼Œä»–ä»¬è¯´UIçº§åˆ«çš„æ•°æ®éªŒè¯æ˜¯ä¸€ç§ç›¸å½“æœ‰æ•ˆçš„ç­–ç•¥ã€‚ ä½†æ˜¯ï¼Œæˆ‘è®¤ä¸ºç»„ä»¶å’ŒUIæ§åˆ¶å™¨ä¸­çš„ä¼—å¤šéªŒè¯ç‚¹å¹¶ä¸æ˜¯æœ€åˆç†çš„æ–¹æ³•ã€‚   ,  ,  ,    ,     ,       listener'        . </p><br><p>  ,  ,     : </p><br><ol><li> <strong>JPA </strong>   ,          ,        DDL. </li><li> <strong>Bean Validation</strong> â€” , , ,             .      ,       . </li><li> <strong>  </strong>  bean validation,    .        , ,   REST. </li><li> <strong>Entity listeners:</strong>      ,   Bean Validation,             . ,         .  Hibernate    . </li><li> <strong>Transaction listeners</strong> â€” ,   ,    .  ,      ,                    . </li></ol><br><p> <em>PS: ,              Java,      ,    ,    .</em> </p><br><hr><br><h2 id="poleznye-ssylki"> æœ‰ç”¨çš„é“¾æ¥ </h2><br><div class="spoiler">  <b class="spoiler_title">éšè—æ–‡å­—</b> <div class="spoiler_text"><h3 id="standarty-i-ih-realizacii"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ ‡å‡†åŠå…¶å®æ–½ </font></font></h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 303-BeanéªŒè¯1.0</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 349-BeanéªŒè¯1.1</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 349ï¼ŒBeanéªŒè¯è§„èŒƒ</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JSR 380ï¼ŒBeanéªŒè¯è§„èŒƒ</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator 5.4.2ï¼ˆJSR 349ï¼‰å‚è€ƒ</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator 6.10ï¼ˆJSR 380ï¼‰å‚è€ƒ</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä¼‘çœ éªŒè¯å™¨ä¸»é¡µ</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hibernate Validator 6.10 APIæ–‡æ¡£</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HV 6.10ï¼šå£°æ˜å’ŒéªŒè¯æ–¹æ³•çº¦æŸ</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HV 6.10ï¼šäº¤å‰å‚æ•°çº¦æŸ</font></font></a> </li></ul><br><h3 id="biblioteki"> å›¾ä¹¦é¦† </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CUBA beanéªŒè¯</font></font></a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Validation cookbook for CUBA applications</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JavaFX with Bean Validation and CDI 2.0</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">OVal â€” non a JSR 303, 349, 380 compliant validation framework</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Spring, Java Bean Validation Basics</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Validation, Data Binding, and Type Conversion in Spring 4.1</a> </li></ul><br><h3 id="filosofiya-validacii-dannyh">    </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Form validation best practices</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JavaFX Form Validation</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Blah vs Bean Validation: you missed the point like Mars Climate Orbiter</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Avoiding Many If Blocks For Validation Checking</a> </li></ul><br><h3 id="materialy-dlya-dalneyshego-chteniya">     </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Validation cookbook for CUBA applications</a> </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN427543/">https://habr.com/ru/post/zh-CN427543/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN427533/index.html">æ— éœ€å……ç”µçš„æ™ºèƒ½æ‰‹è¡¨ã€‚ æœ‰å¾ˆå¤šå—ï¼Ÿ</a></li>
<li><a href="../zh-CN427535/index.html">æˆ‘ä»¬æ¨å‡ºé›†ä½“é€‰æ‹©çš„è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="../zh-CN427537/index.html">å¦‚ä½•æˆä¸ºä¸€åæˆåŠŸçš„äº§å“ç»ç†ï¼šç«‹å³ä¸ºæ‚¨æä¾›åŸ¹è®­çš„è¯¾ç¨‹</a></li>
<li><a href="../zh-CN427539/index.html">æ¬§æ´²ä¸Šæ¬¡å®šå†¬</a></li>
<li><a href="../zh-CN427541/index.html">äºšé©¬é€Šæ•¦ä¿ƒå½­åšç¤¾åœ¨æœ‰å…³æœåŠ¡å™¨ä¸­ä¸­å›½é—´è°è½¯ä»¶æ¨¡å—çš„æ–‡ç« ä¸­æ”¾å¼ƒå¤‡å—å…³æ³¨çš„å£°æ˜</a></li>
<li><a href="../zh-CN427545/index.html">åœ¨ä¿„ç½—æ–¯è¿›è¡Œèˆªç©ºè¿è¾“ç™»è®°çš„â€œé¢„æœŸç€é™†â€ä¿¡æ¯ç³»ç»Ÿ</a></li>
<li><a href="../zh-CN427549/index.html">2018å¹´ç½—é©¬ä¿±ä¹éƒ¨æŠ¥å‘Šï¼Œç¬¬1.6ç« ï¼šæŠ€æœ¯é€šé…ç¬¦</a></li>
<li><a href="../zh-CN427551/index.html">ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½æ”¾å¼ƒQWERTYé”®ç›˜</a></li>
<li><a href="../zh-CN427555/index.html">äººç±»å·²ç»å­¦ä¼šä½¿ç”¨è„¸éƒ¨è¯†åˆ«æŠ€æœ¯è¿›è¡Œè¿½è¸ªçš„åŠ¨ç‰©</a></li>
<li><a href="../zh-CN427557/index.html">11æœˆçš„ITäº‹ä»¶æ‘˜è¦ï¼ˆç¬¬ä¸€éƒ¨åˆ†ï¼‰</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>