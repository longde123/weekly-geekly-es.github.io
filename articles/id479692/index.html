<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😦 ➕ 🕌 Mengindeks miliaran vektor teks 📠 🌄 💇🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saat mengekstraksi informasi, tugas sering muncul untuk menemukan fragmen teks seperti itu. Dalam konteks pencarian, kueri dapat dihasilkan oleh pengg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mengindeks miliaran vektor teks</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/479692/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/id/dd/fg/idddfg6zku7xq-zv9f0m8xemyiy.jpeg"></div><br>  Saat mengekstraksi informasi, tugas sering muncul untuk menemukan fragmen teks seperti itu.  Dalam konteks pencarian, kueri dapat dihasilkan oleh pengguna (misalnya, teks yang dimasukkan pengguna di mesin pencari) atau oleh sistem itu sendiri.  Seringkali kita perlu mencocokkan permintaan yang masuk dengan permintaan yang sudah diindeks.  Pada artikel ini kita akan melihat bagaimana Anda dapat membangun sistem yang memecahkan masalah ini sehubungan dengan miliaran permintaan tanpa menghabiskan banyak uang pada infrastruktur server. <br><a name="habracut"></a><br>  Pertama, kami mendefinisikan masalah secara formal: <br><br><blockquote>  Diberikan seperangkat pertanyaan tetap <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.838ex" height="2.419ex" viewBox="0 -780.1 791.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-51" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-1"> Q </script>  permintaan masuk <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.07ex" height="1.817ex" viewBox="0 -520.7 460.5 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-71" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>q</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> q </script>  dan integer <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-6B" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-3"> k </script>  .  Perlu menemukan subset pertanyaan seperti itu <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><merror><mtext>R&amp;#xA0;=&amp;#xA0;\&amp;#xA0;kiri&amp;#xA0;\&amp;#xA0;{q0,&amp;#xA0;q1,&amp;#xA0;...,&amp;#xA0;qk&amp;#xA0;\&amp;#xA0;right&amp;#xA0;\}&amp;#xA0;\&amp;#xA0;subset&amp;#xA0;Q</mtext></merror></math>" role="presentation"><span class="noError" aria-hidden="true" style="display: inline-block;">R&nbsp;=&nbsp;\&nbsp;kiri&nbsp;\&nbsp;{q0,&nbsp;q1,&nbsp;...,&nbsp;qk&nbsp;\&nbsp;right&nbsp;\}&nbsp;\&nbsp;subset&nbsp;Q</span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><merror><mtext>R&nbsp;=&nbsp;\&nbsp;kiri&nbsp;\&nbsp;{q0,&nbsp;q1,&nbsp;...,&nbsp;qk&nbsp;\&nbsp;right&nbsp;\}&nbsp;\&nbsp;subset&nbsp;Q</mtext></merror></math></span></span><script type="math/tex" id="MathJax-Element-4"> R = \ kiri \ {q0, q1, ..., qk \ right \} \ subset Q </script>  untuk setiap permintaan <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>q</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow></msub><mtext>&amp;#xA0;</mtext><mi>d</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>m</mi><mi>R</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.591ex" height="2.419ex" viewBox="0 -780.1 4559.8 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-71" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-69" x="631" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-64" x="1040" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-61" x="1564" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-6C" x="2093" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-61" x="2392" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-6D" x="2921" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-52" x="3800" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>q</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></msub><mtext>&nbsp;</mtext><mi>d</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>m</mi><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> q_ {i} \ dalam R </script>  lebih seperti <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.07ex" height="1.817ex" viewBox="0 -520.7 460.5 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-71" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>q</mi></math></span></span><script type="math/tex" id="MathJax-Element-6"> q </script>  dari permintaan lainnya di <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi><mo>&amp;#x2216;</mo><mi>R</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.443ex" height="2.419ex" viewBox="0 -780.1 2773.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-51" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJAMS-2216" x="1013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-52" x="2014" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo>∖</mo><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-7"> Q ∖ R </script>  . </blockquote><br>  Misalnya, dengan rangkaian kueri ini <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.838ex" height="2.419ex" viewBox="0 -780.1 791.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-51" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-8"> Q </script>  : <br><br><pre><code class="plaintext hljs">{tesla cybertruck, beginner bicycle gear, eggplant dishes, tesla new car, how expensive is cybertruck, vegetarian food, shimano 105 vs ultegra, building a carbon bike, zucchini recipes}</code> </pre> <br>  dan <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>=</mo><mn>3</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.472ex" height="2.057ex" viewBox="0 -780.1 2356.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-6B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMAIN-3D" x="799" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMAIN-33" x="1855" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi><mo>=</mo><mn>3</mn></math></span></span><script type="math/tex" id="MathJax-Element-9"> k = 3 </script>  Anda dapat mengharapkan hasil ini: <br><br><div class="scrollable-table"><table><tbody><tr><th>  Masukan permintaan <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.07ex" height="1.817ex" viewBox="0 -520.7 460.5 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-71" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>q</mi></math></span></span><script type="math/tex" id="MathJax-Element-10"> q </script><br></th><th>  Pertanyaan serupa <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>R</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.764ex" height="2.057ex" viewBox="0 -780.1 759.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-52" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-11"> R </script><br></th></tr><tr><td>  tesla pickup <br></td><td>  {tesla cybertruck, tesla mobil baru, seberapa mahal cybertruck} <br></td></tr><tr><td>  sepeda terbaik 2019 <br></td><td>  {shimano 105 vs ultegra, apakah sepeda karbon lebih baik, persneling sepeda} <br></td></tr><tr><td>  memasak dengan sayuran <br></td><td>  {hidangan terong, resep zucchini, makanan vegetarian} <br></td></tr></tbody></table></div><br>  Harap perhatikan bahwa kami belum menetapkan kriteria <i>kesamaan</i> .  Dalam konteks ini, ini bisa berarti hampir apa saja, tetapi biasanya bermuara pada beberapa bentuk kesamaan berdasarkan kata kunci atau vektor.  Menggunakan kesamaan berdasarkan kata kunci, kita dapat menemukan dua pertanyaan yang serupa jika mengandung cukup banyak kata-kata umum.  Misalnya, pertanyaan "membuka restoran di munich" dan "restoran terbaik munich" serupa karena berisi kata-kata "restoran" dan "munich".  Dan pertanyaan "restoran munich terbaik" dan "tempat makan di munich" sudah kurang mirip, karena mereka hanya memiliki satu kata umum.  Namun, seseorang yang mencari restoran di Munich akan lebih baik jika pasangan permintaan kedua ternyata serupa.  Dan dalam hal ini kami akan membantu perbandingan berdasarkan vektor. <br><br><h1>  Representasi vektor kata </h1><br>  Representasi vektor kata adalah teknik pembelajaran mesin yang digunakan dalam pemrosesan bahasa alami untuk mengubah teks atau kata menjadi vektor.  Memindahkan tugas ke dalam ruang vektor, kita dapat menggunakan operasi matematika dengan vektor - menjumlahkan dan menghitung jarak.  Untuk membuat tautan antara kata-kata yang mirip, Anda dapat menggunakan metode pengelompokan vektor tradisional.  <i>Arti dari</i> operasi ini dalam ruang kata aslinya mungkin tidak jelas, tetapi keuntungannya adalah bahwa sekarang kita memiliki akses ke berbagai alat matematika.  Jika Anda tertarik pada detail tentang vektor kata dan aplikasinya, baca tentang <a href="https://arxiv.org/pdf/1301.3781.pdf">word2vec</a> dan <a href="https://nlp.stanford.edu/pubs/glove.pdf">GloVe</a> . <br><br>  Kami memiliki cara untuk menghasilkan vektor dari kata-kata, sekarang kami akan mengumpulkannya menjadi vektor teks (vektor dokumen atau ekspresi).  Cara termudah untuk melakukan ini adalah dengan menambahkan (atau rata-rata) vektor semua kata dalam teks. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/692/bc5/b0c/692bc5b0ccbbe7a89392528365645708.png"><br>  <i><sup>Gambar 1: Vektor Kueri.</sup></i> <br><br>  Sekarang Anda dapat menentukan kesamaan dua potongan teks (atau kueri) dengan merepresentasikannya dalam ruang vektor dan menghitung jarak antara vektor.  Biasanya, jarak sudut digunakan untuk ini. <br><br>  Akibatnya, representasi vektor kata memungkinkan pencocokan teks dari jenis yang berbeda, yang melengkapi pencocokan berbasis kata kunci.  Anda dapat menjelajahi kesamaan semantik dari permintaan (misalnya, "restoran munich terbaik" dan "tempat makan di munich"), seperti yang tidak dapat kami lakukan sebelumnya. <br><br><h1>  Perkiraan Pencarian Tetangga Terdekat </h1><br>  Sekarang kita dapat memperbaiki masalah pencocokan kueri asli kami: <br><br><blockquote>  Diberi set vektor permintaan yang tetap <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.838ex" height="2.419ex" viewBox="0 -780.1 791.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-51" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-12"> Q </script>  vektor yang masuk <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.07ex" height="1.817ex" viewBox="0 -520.7 460.5 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-71" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>q</mi></math></span></span><script type="math/tex" id="MathJax-Element-13"> q </script>  dan integer <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.211ex" height="2.057ex" viewBox="0 -780.1 521.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-6B" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>k</mi></math></span></span><script type="math/tex" id="MathJax-Element-14"> k </script>  .  Anda perlu menemukan subset vektor seperti itu <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><merror><mtext>R&amp;#xA0;=&amp;#xA0;\&amp;#xA0;kiri&amp;#xA0;\&amp;#xA0;{q0,&amp;#xA0;q1,&amp;#xA0;...,&amp;#xA0;qk&amp;#xA0;\&amp;#xA0;right&amp;#xA0;\}&amp;#xA0;\&amp;#xA0;subset&amp;#xA0;Q</mtext></merror></math>" role="presentation"><span class="noError" aria-hidden="true" style="display: inline-block;">R&nbsp;=&nbsp;\&nbsp;kiri&nbsp;\&nbsp;{q0,&nbsp;q1,&nbsp;...,&nbsp;qk&nbsp;\&nbsp;right&nbsp;\}&nbsp;\&nbsp;subset&nbsp;Q</span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><merror><mtext>R&nbsp;=&nbsp;\&nbsp;kiri&nbsp;\&nbsp;{q0,&nbsp;q1,&nbsp;...,&nbsp;qk&nbsp;\&nbsp;right&nbsp;\}&nbsp;\&nbsp;subset&nbsp;Q</mtext></merror></math></span></span><script type="math/tex" id="MathJax-Element-15"> R = \ kiri \ {q0, q1, ..., qk \ right \} \ subset Q </script>  sehingga jarak sudut dari <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.07ex" height="1.817ex" viewBox="0 -520.7 460.5 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-71" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>q</mi></math></span></span><script type="math/tex" id="MathJax-Element-16"> q </script>  untuk setiap vektor <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>q</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow></msub><mtext>&amp;#xA0;</mtext><mi>d</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>m</mi><mi>R</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.591ex" height="2.419ex" viewBox="0 -780.1 4559.8 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-71" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-69" x="631" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-64" x="1040" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-61" x="1564" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-6C" x="2093" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-61" x="2392" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-6D" x="2921" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-52" x="3800" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>q</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></msub><mtext>&nbsp;</mtext><mi>d</mi><mi>a</mi><mi>l</mi><mi>a</mi><mi>m</mi><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-17"> q_ {i} \ dalam R </script>  lebih pendek dari jarak ke vektor lain di <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi><mo>&amp;#x2216;</mo><mi>R</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.443ex" height="2.419ex" viewBox="0 -780.1 2773.9 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-51" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJAMS-2216" x="1013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-52" x="2014" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><mo>∖</mo><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-18"> Q ∖ R </script>  . </blockquote><br>  Ini disebut tugas menemukan tetangga terdekat.  Ada <a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25B4%25D0%25B0%25D1%2587%25D0%25B0_%25D0%25BF%25D0%25BE%25D0%25B8%25D1%2581%25D0%25BA%25D0%25B0_%25D0%25B1%25D0%25BB%25D0%25B8%25D0%25B6%25D0%25B0%25D0%25B9%25D1%2588%25D0%25B5%25D0%25B3%25D0%25BE_%25D1%2581%25D0%25BE%25D1%2581%25D0%25B5%25D0%25B4%25D0%25B0">sejumlah algoritma</a> untuk solusi cepatnya di ruang dimensi rendah.  Tetapi ketika bekerja dengan representasi vektor dari kata-kata, kami biasanya beroperasi dengan vektor dimensi tinggi (100-1000 dimensi).  Dan di sini metode yang disebutkan tidak lagi berfungsi. <br><br>  Tidak ada cara yang cocok untuk dengan cepat menentukan tetangga terdekat dalam ruang dimensi tinggi.  Oleh karena itu, kami menyederhanakan masalah dengan mengizinkan penggunaan hasil perkiraan: alih-alih selalu mengembalikan vektor terdekat, kami akan puas hanya dengan beberapa tetangga terdekat atau <i>sampai batas tertentu</i> .  Ini disebut perkiraan pencarian tugas tetangga terdekat dan merupakan area penelitian aktif. <br><br><h3>  Dunia kecil hirarkis </h3><br>  Grafik Hierarchical Navigable Small-World ( <a href="https://arxiv.org/abs/1603.09320">HNSW</a> ) adalah salah satu algoritma tercepat untuk perkiraan pencarian tetangga terdekat.  Indeks pencarian di HNSW adalah struktur multi-level di mana setiap level adalah grafik kedekatan.  Setiap simpul grafik sesuai dengan salah satu vektor kueri. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/42e/55e/4b7/42e55e4b72cd088b45e5aff56159f7fb.png"><br>  <sup><i>Gambar 2: Grafik kedekatan bertingkat.</i></sup> <br>  Menemukan tetangga terdekat di HNSW menggunakan metode pembesaran.  Ini dimulai pada simpul input dari level tertinggi dan secara rekursif melakukan traversal grafik serakah di setiap level hingga mencapai minimum lokal di bagian bawah. <br><br>  Rincian tentang algoritma dan teknik pencarian dijelaskan dengan baik dalam karya ilmiah.  Penting untuk diingat bahwa setiap siklus pencarian untuk tetangga terdekat terdiri dari melintasi node grafik dengan menghitung jarak antara vektor.  Kami akan melihat langkah-langkah di bawah ini untuk menggunakan metode ini untuk membuat indeks skala besar. <br><br><h1>  Kesulitan mengindeks miliaran kueri </h1><br>  Misalkan kita perlu mengindeks 4 miliar vektor kueri 200-dimensi, dengan masing-masing dimensi diwakili oleh angka floating point empat byte (4 miliar cukup untuk membuat tugas menarik, tetapi Anda masih dapat menyimpan ID node dalam angka empat-byte reguler) .  Perhitungan kasar memberitahu kita bahwa ukuran vektor saja akan sekitar 3 TB.  Karena sebagian besar pustaka yang ada menggunakan kapasitas RAM untuk perkiraan pencarian tetangga terdekat, kami akan memerlukan server yang sangat besar untuk mendorong setidaknya vektor ke dalam RAM.  Harap perhatikan bahwa ini tidak memperhitungkan indeks pencarian tambahan, yang diperlukan untuk sebagian besar metode. <br><br>  Dalam seluruh sejarah pengembangan mesin pencari kami, kami telah menggunakan beberapa pendekatan berbeda untuk menyelesaikan masalah ini.  Mari kita pertimbangkan beberapa di antaranya. <br><br><h3>  Subset data </h3><br>  Pendekatan pertama dan paling sederhana, yang tidak memungkinkan kami untuk sepenuhnya menyelesaikan masalah, adalah membatasi jumlah vektor dalam indeks.  Mengambil sepersepuluh dari data, kami membuat indeks yang membutuhkan - kejutan - 10% dari memori.  Namun, kualitas pencarian telah memburuk, karena sekarang kami telah beroperasi dengan kueri yang lebih sedikit. <br><br><h3>  Kuantisasi </h3><br>  Di sini kami menggunakan semua data, tetapi menguranginya menggunakan <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B2%25D0%25B0%25D0%25BD%25D1%2582%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">kuantisasi</a> (kami menggunakan teknik kuantisasi yang berbeda, misalnya, kuantisasi produk, tetapi tidak dapat mencapai kualitas kerja yang diinginkan dengan jumlah data ini).  Dengan menyelesaikan beberapa kesalahan, kami dapat mengganti semua angka empat byte dalam vektor asli dengan versi byte tunggal yang dikuantisasi.  Jumlah RAM untuk vektor menurun hingga 75%.  Namun, kami masih membutuhkan memori 750 GB (belum termasuk ukuran indeks itu sendiri), dan ini masih merupakan server yang sangat besar. <br><br><h1>  Memecahkan masalah memori dengan Granne </h1><br>  Pendekatan yang dijelaskan memiliki kelebihan, tetapi membutuhkan banyak sumber daya dan memberikan kualitas pencarian yang buruk.  Meskipun <a href="http://ann-benchmarks.com/">ada perpustakaan</a> yang merespons dalam waktu kurang dari 1 ms, kami dapat mengorbankan kecepatan dengan imbalan persyaratan perangkat keras yang lebih rendah. <br><br>  <a href="https://github.com/granne/granne">Granne</a> (perkiraan tetangga terdekat terdekat berbasis grafik) adalah perpustakaan HNSW yang dikembangkan dan digunakan oleh Cliqz untuk mencari pertanyaan semacam itu.  Ini memiliki kode sumber terbuka, tetapi perpustakaan masih dalam pengembangan aktif.  Versi yang ditingkatkan akan dipublikasikan di <a href="https://crates.io/">crates.io</a> pada tahun 2020.  Itu ditulis dalam karat dengan sisipan Python, dirancang untuk menangani miliaran vektor menggunakan daya saing.  Dari sudut pandang vektor kueri, menarik bahwa Granne memiliki mode khusus yang membutuhkan memori jauh lebih sedikit dibandingkan dengan perpustakaan lain. <br><br><h3>  Representasi ringkas dari vektor kueri </h3><br>  Mengurangi ukuran vektor kueri akan memberi kita banyak manfaat.  Untuk melakukan ini, mari kembali dan pertimbangkan untuk membuat vektor.  Karena kueri terdiri dari kata-kata, dan vektor kueri adalah jumlah vektor kata, kita dapat secara eksplisit menolak menyimpan vektor-vektor kueri dan menghitungnya seperlunya. <br><br>  Anda bisa menyimpan kueri dalam bentuk kumpulan kata dan menggunakan tabel pencarian untuk menemukan vektor yang sesuai.  Namun, kami menghindari pengalihan dengan menyimpan setiap kueri sebagai daftar ID integer yang sesuai dengan vektor kata dalam kueri.  Misalnya, simpan kueri "restoran terbaik munich" sebagai <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>b</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><mo>,</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>r</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>t</mi></mrow></msub></mrow><mo>,</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>o</mi><mi>f</mi></mrow></msub></mrow><mo>,</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>m</mi><mi>u</mi><mi>n</mi><mi>i</mi><mi>c</mi><mi>h</mi></mrow></msub></mrow><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="26.541ex" height="2.78ex" viewBox="0 -832 11427.2 1197.1" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-69" x="0" y="0"></use><g transform="translate(345,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-62" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-65" x="429" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-73" x="896" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-74" x="1365" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMAIN-2C" x="1945" y="0"></use><g transform="translate(2390,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-69" x="0" y="0"></use><g transform="translate(345,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-65" x="451" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-73" x="918" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-74" x="1387" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-61" x="1749" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-75" x="2278" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-72" x="2851" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-61" x="3302" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-6E" x="3832" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-74" x="4432" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMAIN-2C" x="6225" y="0"></use><g transform="translate(6670,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-69" x="0" y="0"></use><g transform="translate(345,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-6F" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-66" x="485" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMAIN-2C" x="7848" y="0"></use><g transform="translate(8294,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-69" x="0" y="0"></use><g transform="translate(345,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-75" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-6E" x="1450" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-69" x="2051" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-63" x="2397" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-68" x="2830" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMAIN-5D" x="11148" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mrow class="MJX-TeXAtom-ORD"><msub><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>b</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><msub><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>r</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>t</mi></mrow></msub></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><msub><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>o</mi><mi>f</mi></mrow></msub></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><msub><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>m</mi><mi>u</mi><mi>n</mi><mi>i</mi><mi>c</mi><mi>h</mi></mrow></msub></mrow><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-19"> [{i_ {best}}, {i_ {restaurant}}, {i_ {of}}, {i_ {munich}}] </script>  dimana <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>b</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.871ex" height="2.298ex" viewBox="0 -728.2 1666.7 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-69" x="0" y="0"></use><g transform="translate(345,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-62" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-65" x="429" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-73" x="896" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-74" x="1365" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><msub><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mi>b</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></msub></mrow></math></span></span><script type="math/tex" id="MathJax-Element-20"> {i_ {best}} </script>  - ini adalah ID vektor dari kata "terbaik", dll. Misalkan kita memiliki kurang dari 16 juta vektor kata (lebih dari ini akan menelan biaya 1 byte per kata), maka Anda dapat menggunakan 3 byte untuk mewakili semua kata ID.  Artinya, alih-alih menyimpan 800 byte (atau 200 byte dalam kasus vektor terkuantisasi), kami hanya akan menyimpan 12 byte untuk permintaan ini (Ini tidak sepenuhnya benar. Karena permintaan terdiri dari jumlah kata yang berbeda, kami juga perlu menyimpan daftar offset dalam indeks kata. Untuk ini akan membutuhkan 5 byte per permintaan). <br><br>  Adapun kata vektor, kita semua membutuhkannya.  Namun, jumlah kata jauh lebih kecil dari jumlah kueri yang dapat dibuat dengan menggabungkan kata-kata ini.  Dan itu berarti ukuran kata tidak terlalu penting.  Jika Anda menyimpan vektor kata sebagai versi titik apung empat byte dalam larik sederhana <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>v</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.128ex" height="1.455ex" viewBox="0 -520.7 485.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/479692/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhggh1KV4rekp9KnN-YiUQzRKYnz7A#MJMATHI-76" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>v</mi></math></span></span><script type="math/tex" id="MathJax-Element-21"> v </script>  , maka kita membutuhkan kurang dari 1 GB untuk setiap juta kata.  Volume ini dapat dengan mudah masuk dalam RAM.  Sekarang vektor kueri terlihat seperti ini: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><merror><mtext>{v&amp;#xA0;_&amp;#xA0;{{i_&amp;#xA0;{best}}}&amp;#xA0;+&amp;#xA0;{v&amp;#xA0;_&amp;#xA0;{{i_&amp;#xA0;{restaurant}}}&amp;#xA0;+&amp;#xA0;{v&amp;#xA0;_&amp;#xA0;{{i_&amp;#xA0;{of}}}&amp;#xA0;+&amp;#xA0;{v&amp;#xA0;_&amp;#xA0;{{i_&amp;#xA0;{munich}}}}</mtext></merror></math>" role="presentation"><span class="noError" aria-hidden="true" style="display: inline-block;">{v&nbsp;_&nbsp;{{i_&nbsp;{best}}}&nbsp;+&nbsp;{v&nbsp;_&nbsp;{{i_&nbsp;{restaurant}}}&nbsp;+&nbsp;{v&nbsp;_&nbsp;{{i_&nbsp;{of}}}&nbsp;+&nbsp;{v&nbsp;_&nbsp;{{i_&nbsp;{munich}}}}</span><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><merror><mtext>{v&nbsp;_&nbsp;{{i_&nbsp;{best}}}&nbsp;+&nbsp;{v&nbsp;_&nbsp;{{i_&nbsp;{restaurant}}}&nbsp;+&nbsp;{v&nbsp;_&nbsp;{{i_&nbsp;{of}}}&nbsp;+&nbsp;{v&nbsp;_&nbsp;{{i_&nbsp;{munich}}}}</mtext></merror></math></span></span><script type="math/tex" id="MathJax-Element-22"> {v _ {{i_ {best}}} + {v _ {{i_ {restaurant}}} + {v _ {{i_ {of}}} + {v _ {{i_ {munich}}}} </script>  . <br><br>  Ukuran akhir pengiriman kueri tergantung pada jumlah total kata dalam kueri.  Untuk 4 miliar kueri, ini sekitar 80 GB (termasuk vektor kata).  Dengan kata lain, dibandingkan dengan vektor kata asli, ukurannya menurun sebesar 97%, dan dibandingkan dengan vektor terkuantisasi - sebesar 90%. <br><br>  Dan satu hal lagi.  Untuk satu pencarian, kita perlu mengunjungi sekitar 200-300 node grafik.  Setiap node memiliki 20-30 tetangga.  Jadi, kita perlu menghitung jarak dari vektor kueri input ke 4000-9000 vektor dalam indeks.  Dan terlebih lagi, kita perlu menghasilkan vektor.  Berapa lama untuk membuat vektor kueri dengan cepat? <br><br>  Ternyata dengan prosesor yang cukup baru masalah ini dapat diselesaikan dalam beberapa milidetik.  Permintaan yang dulu berjalan dalam 1 ms sekarang berjalan dalam sekitar 5 ms.  Tapi kemudian kami mengurangi jumlah memori untuk vektor sebesar 90%.  Kami dengan senang hati menerima kompromi seperti itu. <br><br><h3>  Tampilan dalam memori vektor dan indeks </h3><br>  Di atas, kami memecahkan masalah mengurangi jumlah memori untuk vektor.  Tetapi setelah kami memecahkan masalah ini, struktur indeks itu sendiri menjadi faktor pembatas.  Sekarang Anda perlu mengurangi ukurannya. <br><br>  Di Granne, struktur grafik secara kompak disimpan dalam bentuk daftar adjacency dengan jumlah variabel tetangga untuk setiap node.  Artinya, ingatan hampir tidak terbuang pada metadata.  Ukuran struktur indeks sangat tergantung pada parameter desain dan properti grafik.  Namun demikian, untuk mendapatkan gambaran tentang ukuran indeks, cukup untuk mengatakan bahwa kita dapat membangun indeks untuk 4 miliar vektor dengan ukuran total sekitar 240 GB.  Ini mungkin dapat diterima untuk penggunaan dalam memori pada server besar, tetapi dapat dilakukan dengan lebih baik. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e73/daa/0de/e73daa0dea90e3e84afe9aaec7bd6a8e.jpg"><br>  <sup><i>Gambar 3: Dua tata letak yang berbeda dalam RAM dan SSD.</i></sup> <br><br>  Properti penting dari Granne adalah kemampuan untuk <a href="https://ru.wikipedia.org/wiki/Mmap">menampilkan</a> indeks dan permintaan vektor <a href="https://ru.wikipedia.org/wiki/Mmap">dalam memori</a> .  Ini memungkinkan kita untuk memuat indeks dan berbagi memori dengan berbagai proses.  File indeks dan kueri dibagi menjadi file tampilan terpisah dalam memori dan dapat digunakan dalam tata letak yang berbeda dalam RAM dan pada SSD.  Jika persyaratan untuk penundaan sedikit lebih rendah, kemudian menempatkan indeks pada SSD, meminta RAM, kami mempertahankan kecepatan yang dapat diterima tanpa konsumsi memori yang berlebihan.  Di akhir artikel kita akan melihat bagaimana kompromi ini terlihat. <br><br><h3>  Meningkatkan lokalitas data </h3><br>  Dalam konfigurasi kami saat ini, ketika indeks pada SSD, setiap permintaan memerlukan hingga 200-300 bacaan dari disk.  Anda dapat mencoba meningkatkan lokalitas data dengan mengatur elemen-elemen yang vektornya sangat dekat sehingga node HNSW mereka terletak di indeks juga tidak jauh dari satu sama lain.  Lokalitas data meningkatkan kinerja, karena operasi baca tunggal (biasanya diekstraksi dari 4 KB) lebih cenderung mengandung node lain yang diperlukan untuk melintasi grafik.  Dan ini, pada gilirannya, mengurangi jumlah pengambilan data per satu pencarian. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f8/1d2/2f4/1f81d22f418256c704bb12b7514e68a1.jpg"><br>  <sup><i>Gambar 4: Lokalitas data mengurangi pencarian informasi.</i></sup> <br><br>  Perlu dicatat bahwa penataan ulang elemen tidak mempengaruhi hasil pencarian, ini adalah cara untuk mempercepatnya.  Artinya, urutannya bisa apa saja, tetapi tidak setiap opsi akan mempercepat pencarian.  Sangat sulit untuk menemukan urutan yang optimal.  Namun, heuristik yang berhasil kami gunakan adalah untuk mengurutkan kueri berdasarkan kata paling <i>penting</i> dalam setiap kueri. <br><br><h1>  Kesimpulan </h1><br>  Kami menggunakan Granne untuk membuat dan memelihara indeks bernilai miliaran dolar dengan vektor kueri untuk mencari kueri serupa dengan konsumsi memori yang relatif rendah.  Tabel di bawah ini menunjukkan persyaratan untuk berbagai metode.  Jadilah skeptis tentang nilai absolut dari keterlambatan selama pencarian, karena mereka sangat bergantung pada apa yang dianggap sebagai respons yang dapat diterima.  Namun, informasi ini menjelaskan kinerja relatif dari metode tersebut. <br><br><div class="scrollable-table"><table><tbody><tr><th></th><th>  Nilai awal <br></th><th>  Kuantisasi <br></th><th>  Granne (hanya RAM) <br></th><th>  Granne (RAM + SSD) <br></th></tr><tr><td>  <b>Memori</b> <br></td><td>  3000 + 240 GB <br></td><td>  750 + 240 GB <br></td><td>  80 + 240 GB <br></td><td>  80-150 GB * <br></td></tr><tr><td>  <b>SSD</b> <br></td><td>  - </td><td>  - </td><td>  - </td><td>  240 GB <br></td></tr><tr><td>  <b>Tunda</b> <br></td><td>  1 ms <br></td><td>  1 ms <br></td><td>  5 ms <br></td><td>  10-50 ms <br></td></tr></tbody></table></div><br>  <i>* Mengalokasikan indeks memori yang lebih besar dari jumlah yang diperlukan menyebabkan caching beberapa node (sering dikunjungi), yang mengurangi keterlambatan dalam pencarian.</i>  <i>Tidak ada cache internal yang digunakan untuk ini, hanya alat OS internal (kernel Linux).</i> <br><br>  Perlu dicatat bahwa beberapa optimasi yang disebutkan dalam artikel tidak dapat digunakan untuk menyelesaikan masalah umum menemukan tetangga terdekat dengan vektor yang tidak dapat dikomposasikan.  Namun, mereka berlaku dalam situasi di mana elemen dapat dihasilkan dari bagian yang lebih sedikit (seperti halnya dengan kata-kata dan pertanyaan).  Jika tidak, Anda masih dapat menggunakan Granne dengan vektor sumber, hanya membutuhkan lebih banyak memori, seperti perpustakaan lainnya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id479692/">https://habr.com/ru/post/id479692/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id479682/index.html">Laporan Penggunaan Kontainer Sysdig 2019: Kubernet Baru dan Detail Keamanan</a></li>
<li><a href="../id479684/index.html">Cara mengumpulkan kunci frekuensi rendah untuk SEO: 4 cara non-sepele</a></li>
<li><a href="../id479686/index.html">Tren Kunci dalam Pengalihdayaan TI setelah 2020</a></li>
<li><a href="../id479688/index.html">Di negara dan kota mana saja pengembang mendapatkan lebih banyak ketika Anda mempertimbangkan pajak dan biaya hidup?</a></li>
<li><a href="../id479690/index.html">Zork dan Z-Machine: bagaimana pengembang mentransfer game dari mainframe ke komputer rumahan 8-bit</a></li>
<li><a href="../id479696/index.html">Beberapa kata tentang Alter Table, atau bagaimana tidak melakukannya</a></li>
<li><a href="../id479700/index.html">CIMON-2: (tidak) Kiamat, atau bagaimana IBM Watson naik ke atas awan</a></li>
<li><a href="../id479702/index.html">Pemanggang roti, Lingkaran saya dan Freelansim menjadi bagian dari Habr</a></li>
<li><a href="../id479704/index.html">Eskalasi hak istimewa dalam klien EA Origin Windows (CVE-2019-19247 dan CVE-2019-19248)</a></li>
<li><a href="../id479708/index.html">Posting tidak resmi tentang rebranding Kompetisi Habr +</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>