<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯМзя╕П ЁЯСиЁЯП╜тАНЁЯПн ЁЯТм рдЯреЗрдиреНрд╕рд░рдлреНрд▓реЛ рдореЗрдВ рдХреЗрд░рд╕ рдлрдВрдХреНрд╢рдирд▓ рдПрдкреАрдЖрдИ ЁЯСЖЁЯП╝ ЁЯзР ЁЯУв</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдХреЗрд░рд╕ рдореЗрдВ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдЕрдиреБрдХреНрд░рдорд┐рдХ рдФрд░ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреЛ рдПрдкреАрдЖрдИ рд╣реИрдВред рдпрджрд┐ рдкрд╣рд▓рд╛ рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдЕрдиреБрдХреНрд░рдорд┐рдХ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЯреЗрдиреНрд╕рд░рдлреНрд▓реЛ рдореЗрдВ рдХреЗрд░рд╕ рдлрдВрдХреНрд╢рдирд▓ рдПрдкреАрдЖрдИ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483664/"><img src="https://habrastorage.org/webt/w1/zr/n8/w1zrn8ydafoxahso_ig7vx1stfg.png"><br><br>  рдХреЗрд░рд╕ рдореЗрдВ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдЕрдиреБрдХреНрд░рдорд┐рдХ рдФрд░ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреЛ рдПрдкреАрдЖрдИ рд╣реИрдВред  рдпрджрд┐ рдкрд╣рд▓рд╛ рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдЕрдиреБрдХреНрд░рдорд┐рдХ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рддреЛ рдлрд╝рдВрдХреНрд╢рдирд▓ рдПрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдПрдХ рдиреНрдпреВрд░рд▓ рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рдордирдорд╛рдиреЗ рдврдВрдЧ рд╕реЗ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдПрд╕рд╛рдЗрдХреНрд▓рд┐рдХ рдЧреНрд░рд╛рдл рдХреЗ рд░реВрдк рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдЬрдЯрд┐рд▓ рдореЙрдбрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЕрдзрд┐рдХ рдЕрд╡рд╕рд░ рджреЗрддрд╛ рд╣реИред  рдпрд╣ рд▓реЗрдЦ TensorFlow рд╡реЗрдмрд╕рд╛рдЗрдЯ рд╕реЗ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдлрд╝реАрдЪрд░ рдЧрд╛рдЗрдб рдХрд╛ рдЕрдиреБрд╡рд╛рдж рд╣реИред <br><a name="habracut"></a><br><h2>  рдкрд░рд┐рдЪрдп </h2><br>  рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдЖрдкрдХреЛ рдЕрдиреБрдХреНрд░рдорд┐рдХ рдПрдкреАрдЖрдИ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рд▓рдЪреАрд▓реЗ рдврдВрдЧ рд╕реЗ рдореЙрдбрд▓ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ; рдпрд╣ рдЧреИрд░-рд░реИрдЦрд┐рдХ рдЯреЛрдкреЛрд▓реЙрдЬреА рд╡рд╛рд▓реЗ рдореЙрдбрд▓, рд╕рд╛рдорд╛рдиреНрдп рдкрд░рддреЛрдВ рд╡рд╛рд▓реЗ рдореЙрдбрд▓ рдФрд░ рдХрдИ рдЗрдирдкреБрдЯ рдпрд╛ рдЖрдЙрдЯрдкреБрдЯ рд╡рд╛рд▓реЗ рдореЙрдбрд▓ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред <br><br>  рдпрд╣ рдЗрд╕ рддрдереНрдп рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ рдХрд┐ рдЧрд╣рди рд╢рд┐рдХреНрд╖рдг рдореЙрдбрд▓ рдЖрдорддреМрд░ рдкрд░ рдкрд░рддреЛрдВ рдХрд╛ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдЪрдХреНрд░реАрдп рдЧреНрд░рд╛рдл (рдбреАрдПрдЬреА) рд╣реИ <br><br>  рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ <b>рдкрд░рддреЛрдВ рдХреА рд╕рд╛рдЬрд┐рд╢ рд░рдЪрдиреЗ рдХреЗ</b> рд▓рд┐рдП рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдПрдХ рд╕рдореВрд╣ рд╣реИред <br><br>  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореЙрдбрд▓ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ: <br><br><blockquote>  (рдЗрдирдкреБрдЯ: 784-рдЖрдпрд╛рдореА рд╡реЗрдХреНрдЯрд░) <br>  тЖз <br>  [рдШрдиреА рдкрд░рдд (64 рддрддреНрд╡, рд░рд┐рд▓реЗ рдХреА рд╕рдХреНрд░рд┐рдпрддрд╛)] <br>  тЖз <br>  [рдШрдиреА рдкрд░рдд (64 рддрддреНрд╡, рд░рд┐рд▓реЗ рдХреА рд╕рдХреНрд░рд┐рдпрддрд╛)] <br>  тЖз <br>  [рд╕рдШрди рдкрд░рдд (10 рддрддреНрд╡, рд╕реЙрдлреНрдЯрдореИрдХреНрд╕ рдХреА рд╕рдХреНрд░рд┐рдпрддрд╛)] <br>  тЖз <br>  (рдЖрдЙрдЯрдкреБрдЯ: 10 рд╕реЗ рдЕрдзрд┐рдХ рд╡рд░реНрдЧреЛрдВ рдореЗрдВ рд╕рдВрднрд╛рд╡реНрдпрддрд╛ рд╡рд┐рддрд░рдг) </blockquote>  рдпрд╣ 3 рдкрд░рддреЛрдВ рдХрд╛ рдПрдХ рд╕рд░рд▓ рдЧреНрд░рд╛рдл рд╣реИред <br><br>  рдлрдВрдХреНрд╢рдирд▓ рдПрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕ рдореЙрдбрд▓ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдПрдХ рдЗрдирдкреБрдЯ рдиреЛрдб рдмрдирд╛рдХрд░ рд╢реБрд░реВ рдХрд░рдирд╛ рд╣реЛрдЧрд╛: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tensorflow <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> keras inputs = keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">784</span></span>,))</code> </pre> <br>  рдпрд╣рд╛рдВ рд╣рдо рдХреЗрд╡рд▓ рдЕрдкрдиреЗ рдбреЗрдЯрд╛ рдХреЗ рдЖрдпрд╛рдо рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВ: 784-рдЖрдпрд╛рдореА рд╡реИрдХреНрдЯрд░ред  рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдбреЗрдЯрд╛ рдХреА рдорд╛рддреНрд░рд╛ рд╣рдореЗрд╢рд╛ рдЫреЛрдбрд╝реА рдЬрд╛рддреА рд╣реИ, рд╣рдо рдХреЗрд╡рд▓ рдкреНрд░рддреНрдпреЗрдХ рддрддреНрд╡ рдХреЗ рдЖрдпрд╛рдо рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рдЫрд╡рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЗрдЪреНрдЫрд┐рдд рдЖрдХрд╛рд░ рджрд░реНрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (32, 32, 3) `, рд╣рдо рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ: <br><br><pre> <code class="python hljs">img_inputs = keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>))</code> </pre> <br>  <code>inputs</code> рд░рд┐рдЯрд░реНрди рдореЗрдВ рдЖрдХрд╛рд░ рдФрд░ рдбреЗрдЯрд╛ рдХреЗ рдкреНрд░рдХрд╛рд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕реЗ рдЖрдк рдЕрдкрдиреЗ рдореЙрдбрд▓ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛рддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs">inputs.shape</code> </pre> <br><pre> <code class="python hljs">TensorShape([<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">784</span></span>])</code> </pre> <br><pre> <code class="python hljs">inputs.dtype</code> </pre> <br><pre> <code class="python hljs">tf.float32</code> </pre> <br>  рдЖрдк рдЗрд╕ <code>inputs</code> рдСрдмреНрдЬреЗрдХреНрдЯ рдкрд░ рдкрд░рдд рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдкрд░рдд рдЧреНрд░рд╛рдл рдореЗрдВ рдПрдХ рдирдпрд╛ рдиреЛрдб рдмрдирд╛рддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tensorflow.keras <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> layers dense = layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>) x = dense(inputs)</code> </pre> <br>  "рдПрдХ рдкрд░рдд рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛" рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдИ рдЧрдИ рдкрд░рдд рдореЗрдВ "рдЗрдирдкреБрдЯ" рд╕реЗ рдПрдХ рддреАрд░ рдХреЛ рдЦреАрдВрдЪрдиреЗ рдХреЗ рд╕рдорд╛рди рд╣реИред  рд╣рдо <code>dense</code> рдкрд░рдд рдХреЗ рдЗрдирдкреБрдЯ рдХреЛ "рдкрд╛рд╕" рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рд╣рдореЗрдВ <code>x</code> рдорд┐рд▓рддрд╛ рд╣реИред <br><br>  рдЖрдЗрдП рд╣рдорд╛рд░реА рдкрд░рдд рдЧреНрд░рд╛рдл рдореЗрдВ рдХреБрдЫ рдФрд░ рдкрд░рддреЗрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs">x = layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) outputs = layers.Dense(<span class="hljs-number"><span class="hljs-number">10</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'softmax'</span></span>)(x)</code> </pre> <br>  рдЕрдм рд╣рдо рд▓реЗрдпрд░ рдЧреНрд░рд╛рдл рдореЗрдВ рдЗрд╕рдХреЗ рдЗрдирдкреБрдЯ рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдХреЗ рдПрдХ <code>Model</code> рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs">model = keras.Model(inputs=inputs, outputs=outputs)</code> </pre> <br>  рдЖрдЗрдП рдлрд┐рд░ рд╕реЗ рджреЗрдЦреЗрдВ рдкреВрд░реА рдореЙрдбрд▓ рдкрд░рд┐рднрд╛рд╖рд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛: <br><br><pre> <code class="python hljs">inputs = keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">784</span></span>,), name=<span class="hljs-string"><span class="hljs-string">'img'</span></span>) x = layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(inputs) x = layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) outputs = layers.Dense(<span class="hljs-number"><span class="hljs-number">10</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'softmax'</span></span>)(x) model = keras.Model(inputs=inputs, outputs=outputs, name=<span class="hljs-string"><span class="hljs-string">'mnist_model'</span></span>)</code> </pre> <br>  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдореЙрдбрд▓ рд╕рд╛рд░рд╛рдВрд╢ рдХреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ: <br><br><pre> <code class="python hljs">model.summary()</code> </pre> <br><pre> <code class="python hljs">Model: <span class="hljs-string"><span class="hljs-string">"mnist_model"</span></span> _________________________________________________________________ Layer (type) Output Shape Param <span class="hljs-comment"><span class="hljs-comment"># ================================================================= img (InputLayer) [(None, 784)] 0 _________________________________________________________________ dense_3 (Dense) (None, 64) 50240 _________________________________________________________________ dense_4 (Dense) (None, 64) 4160 _________________________________________________________________ dense_5 (Dense) (None, 10) 650 ================================================================= Total params: 55,050 Trainable params: 55,050 Non-trainable params: 0 _________________________________________________________________</span></span></code> </pre> <br>  рд╣рдо рдореЙрдбрд▓ рдХреЛ рдПрдХ рдЧреНрд░рд╛рдл рдХреЗ рд░реВрдк рдореЗрдВ рднреА рдЖрдХрд░реНрд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs">keras.utils.plot_model(model, <span class="hljs-string"><span class="hljs-string">'my_first_model.png'</span></span>)</code> </pre> <br><img src="https://habrastorage.org/webt/oq/4o/vl/oq4ovlxewr3hxczaldchmbeyfua.png" alt="рдЫрд╡рд┐"><br><br>  рдФрд░ рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ рдирд┐рд░реНрдорд┐рдд рдЧреНрд░рд╛рдл рдкрд░ рдкреНрд░рддреНрдпреЗрдХ рдкрд░рдд рдХреЗ рдЗрдирдкреБрдЯ рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рдЖрдпрд╛рдореЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ: <br><br><pre> <code class="python hljs">keras.utils.plot_model(model, <span class="hljs-string"><span class="hljs-string">'my_first_model_with_shape_info.png'</span></span>, show_shapes=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><img src="https://habrastorage.org/webt/fn/rm/hc/fnrmhcqknnsjdcgmqp9w6dpong8.png" alt="рдЫрд╡рд┐"><br><br>  рдпрд╣ рдЫрд╡рд┐ рдФрд░ рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рдХреЛрдб рд╕рдорд╛рди рд╣реИред  рдХреЛрдб рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ, рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рдПрд░реЛ рдХреЛ рдХреЗрд╡рд▓ рдХреЙрд▓ рдСрдкрд░реЗрд╢рдВрд╕ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  "рд▓реЗрдпрд░ рдЧреНрд░рд╛рдл" рдЧрд╣рд░реА рд╕реАрдЦрдиреЗ рдХреЗ рдореЙрдбрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╣реБрдд рд╣реА рд╕рд╣рдЬ рдорд╛рдирд╕рд┐рдХ рдЫрд╡рд┐ рд╣реИ, рдФрд░ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдореЙрдбрд▓ рдмрдирд╛рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╣реИ рдЬреЛ рдЗрд╕ рдорд╛рдирд╕рд┐рдХ рдЫрд╡рд┐ рдХреЛ рдмрд╛рд░реАрдХреА рд╕реЗ рджрд░реНрд╢рд╛рддрд╛ рд╣реИред <br><br><h2>  рдкреНрд░рд╢рд┐рдХреНрд╖рдг, рдореВрд▓реНрдпрд╛рдВрдХрди рдФрд░ рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br>  рд╕реЗрдХреНрд╢рдирд▓ рдореЙрдбрд▓ рдХреА рддрд░рд╣ рд╣реА рдлрдВрдХреНрд╢рдирд▓ рдПрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рдП рдЧрдП рдореЙрдбрд▓ рдХреЗ рд▓рд┐рдП рд╕реАрдЦрдирд╛, рдореВрд▓реНрдпрд╛рдВрдХрди рдФрд░ рд╡реНрдпреБрддреНрдкрдиреНрди рдХрд░рдирд╛ред <br><br>  рдПрдХ рддреНрд╡рд░рд┐рдд рдбреЗрдореЛ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред <br><br>  рдпрд╣рд╛рдВ рд╣рдо MNIST рдЫрд╡рд┐ рдбреЗрдЯрд╛рд╕реЗрдЯ рд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рд╡реИрдХреНрдЯрд░ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдбреЗрдЯрд╛ рдкрд░ рдореЙрдбрд▓ рдХреЛ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ (рдкрд░реАрдХреНрд╖рдг рдирдореВрдиреЗ рдкрд░ рдХрд╛рдо рдХреА рдЧреБрдгрд╡рддреНрддрд╛ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░рддреЗ рд╣реБрдП), рдФрд░ рдЕрдВрдд рдореЗрдВ рд╣рдо рдкрд░реАрдХреНрд╖рдг рдореЙрдбрд▓ рдкрд░ рдЕрдкрдиреЗ рдореЙрдбрд▓ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs">(x_train, y_train), (x_test, y_test) = keras.datasets.mnist.load_data() x_train = x_train.reshape(<span class="hljs-number"><span class="hljs-number">60000</span></span>, <span class="hljs-number"><span class="hljs-number">784</span></span>).astype(<span class="hljs-string"><span class="hljs-string">'float32'</span></span>) / <span class="hljs-number"><span class="hljs-number">255</span></span> x_test = x_test.reshape(<span class="hljs-number"><span class="hljs-number">10000</span></span>, <span class="hljs-number"><span class="hljs-number">784</span></span>).astype(<span class="hljs-string"><span class="hljs-string">'float32'</span></span>) / <span class="hljs-number"><span class="hljs-number">255</span></span> model.compile(loss=<span class="hljs-string"><span class="hljs-string">'sparse_categorical_crossentropy'</span></span>, optimizer=keras.optimizers.RMSprop(), metrics=[<span class="hljs-string"><span class="hljs-string">'accuracy'</span></span>]) history = model.fit(x_train, y_train, batch_size=<span class="hljs-number"><span class="hljs-number">64</span></span>, epochs=<span class="hljs-number"><span class="hljs-number">5</span></span>, validation_split=<span class="hljs-number"><span class="hljs-number">0.2</span></span>) test_scores = model.evaluate(x_test, y_test, verbose=<span class="hljs-number"><span class="hljs-number">2</span></span>) print(<span class="hljs-string"><span class="hljs-string">'Test loss:'</span></span>, test_scores[<span class="hljs-number"><span class="hljs-number">0</span></span>]) print(<span class="hljs-string"><span class="hljs-string">'Test accuracy:'</span></span>, test_scores[<span class="hljs-number"><span class="hljs-number">1</span></span>])</code> </pre> <br><h2>  рдмрдЪрдд рдФрд░ рд╕реАрд░рд┐рдпрд▓ рдХрд░рдирд╛ </h2><br>  рдХрд╛рд░реНрдпрд╛рддреНрдордХ API рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рдП рдЧрдП рдореЙрдбрд▓ рдХреЗ рд▓рд┐рдП рд╕рд╣реЗрдЬрдирд╛ рдФрд░ рдЕрдиреБрдХреНрд░рдорд┐рдд рдХрд░рдирд╛ рдЕрдиреБрдХреНрд░рдорд┐рдХ рдореЙрдбрд▓ рдХреЗ рд╕рдорд╛рди рд╣реА рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред <br><br>  рдлрд╝рдВрдХреНрд╢рдирд▓ рдореЙрдбрд▓ рдХреЛ рд╕рд╣реЗрдЬрдиреЗ рдХрд╛ рдорд╛рдирдХ рддрд░реАрдХрд╛ <code>model.save(</code> ) рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рд╣реИ, рдЬреЛ рдЖрдкрдХреЛ рдкреВрд░реЗ рдореЙрдбрд▓ рдХреЛ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╕рд╣реЗрдЬрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред <br><br>  рдЖрдк рдмрд╛рдж рдореЗрдВ рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдЙрд╕реА рдореЙрдбрд▓ рдХреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рднрд▓реЗ рд╣реА рдЖрдкрдХреЗ рдкрд╛рд╕ рдЙрд╕ рдХреЛрдб рддрдХ рдкрд╣реБрдВрдЪ рди рд╣реЛ рдЬреЛ рдореЙрдбрд▓ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реЛред <br><br>  рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: <br><br><ul><li>  рдореЙрдбрд▓ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ </li><li>  рдореЙрдбрд▓ рд╡рдЬрди (рдЬреЛ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреЗ рджреМрд░рд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛) </li><li>  рдореЙрдбрд▓ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд╡рд┐рдиреНрдпрд╛рд╕ (рдЖрдк <code>compile</code> рдореЗрдВ рдХреНрдпрд╛ рдкрд╛рд╕ рдХрд┐рдпрд╛ рд╣реИ) </li><li>  рдЖрд╢рд╛рд╡рд╛рджреА рдФрд░ рдЗрд╕рдХреА рд╕реНрдерд┐рддрд┐, рдЕрдЧрд░ рдпрд╣ рдерд╛ (рдпрд╣ рдЖрдкрдХреЛ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреЛ рдлрд┐рд░ рд╕реЗ рд╢реБрд░реВ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рд╕реЗ рдЖрдкрдиреЗ рдЫреЛрдбрд╝рд╛ рдерд╛) </li></ul><br><pre> <code class="python hljs">model.save(<span class="hljs-string"><span class="hljs-string">'path_to_my_model.h5'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">del</span></span> model <span class="hljs-comment"><span class="hljs-comment"># Recreate the exact same model purely from the file: model = keras.models.load_model('path_to_my_model.h5')</span></span></code> </pre><br><h2>  рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдореЙрдбрд▓реЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣реА рд▓реЗрдпрд░ рдЧреНрд░рд╛рдл рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </h2><br>  рдлрд╝рдВрдХреНрд╢рдирд▓ рдПрдкреАрдЖрдИ рдореЗрдВ, рд▓реЗрдпрд░ рдЧреНрд░рд╛рдл рдореЗрдВ рдЗрдирдкреБрдЯ рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рдбреЗрдЯрд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдХреЗ рдореЙрдбрд▓ рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдХ рд╕рд┐рдВрдЧрд▓ рд▓реЗрдпрд░ рдЧреНрд░рд╛рдл рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдИ рдореЙрдбрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br>  рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╣рдо рджреЛ рдореЙрдбрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рдкрд░рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ: <br>  рдПрдХ <code> (encoder)</code> рдореЙрдбрд▓ рдЬреЛ рдЗрдирдкреБрдЯ рдЫрд╡рд┐рдпреЛрдВ рдХреЛ 16-рдЖрдпрд╛рдореА рд╡реИрдХреНрдЯрд░ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдПрдХ рдПрдВрдб-рдЯреВ-рдПрдВрдб <code> (autoencoder)</code> рдореЙрдбрд▓ рд╣реИред <br><br><pre> <code class="python hljs">encoder_input = keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), name=<span class="hljs-string"><span class="hljs-string">'img'</span></span>) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(encoder_input) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) x = layers.MaxPooling2D(<span class="hljs-number"><span class="hljs-number">3</span></span>)(x) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) encoder_output = layers.GlobalMaxPooling2D()(x) encoder = keras.Model(encoder_input, encoder_output, name=<span class="hljs-string"><span class="hljs-string">'encoder'</span></span>) encoder.summary() x = layers.Reshape((<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>))(encoder_output) x = layers.Conv2DTranspose(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) x = layers.Conv2DTranspose(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) x = layers.UpSampling2D(<span class="hljs-number"><span class="hljs-number">3</span></span>)(x) x = layers.Conv2DTranspose(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) decoder_output = layers.Conv2DTranspose(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) autoencoder = keras.Model(encoder_input, decoder_output, name=<span class="hljs-string"><span class="hljs-string">'autoencoder'</span></span>) autoencoder.summary()</code> </pre><br>  рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╣рдо рдбрд┐рдХреЛрдбрд┐рдВрдЧ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЛ рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рд▓рд┐рдП рд╕рдЦреНрддреА рд╕реЗ рд╕рдордорд┐рдд рдмрдирд╛рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рд╣рдореЗрдВ рдЖрдЙрдЯрдкреБрдЯ рдбреЗрдЯрд╛ рдХрд╛ рдЖрдпрд╛рдо рдЗрдирдкреБрдЯ рдбреЗрдЯрд╛ <code>(28, 28, 1)</code> ред  <code>Conv2D</code> рд▓реЗрдпрд░, <code>Conv2D</code> рд▓реЗрдпрд░ рдХреЗ <code>Conv2D</code> рд╣реИ, рдФрд░ <code>MaxPooling2D</code> рд▓реЗрдпрд░ рд╡рд╛рдкрд╕ <code>MaxPooling2D</code> рд▓реЗрдпрд░ рдкрд░ рдЬрд╛рдПрдЧреАред <br><br><h2>  рдореЙрдбрд▓ рдХреЛ рдкрд░рдд рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╣рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </h2><br>  рдЖрдк рдХрд┐рд╕реА рднреА рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдХрд┐ рдпрд╣ рдПрдХ рдкрд░рдд рдереА, рдЗрд╕реЗ <code>Input</code> рдкрд░ рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рдкрд░рдд рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдкрд░ рдХреЙрд▓ рдХрд░рдирд╛ред <br><br>  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдПрдХ рдореЙрдбрд▓ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдХреЗ, рдЖрдк рди рдХреЗрд╡рд▓ рдЗрд╕рдХреА рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЖрдк рдЗрд╕рдХреЗ рд╡рдЬрди рдХрд╛ рднреА рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕реЗ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдореЗрдВ рджреЗрдЦрддреЗ рд╣реИрдВред  рдПрдХ рдСрдЯреЛ-рдПрдирдХреЛрдбрд░ рдХреЗ рдЙрджрд╛рд╣рд░рдг рдкрд░ рдПрдХ рдФрд░ рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВ, рдЬрдм рдПрдХ рдПрдирдХреЛрдбрд░ рдореЙрдбрд▓, рдПрдХ рдбрд┐рдХреЛрдбрд░ рдореЙрдбрд▓ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рд╡реЗ рдПрдХ рдСрдЯреЛ-рдПрдирдХреЛрдбрд░ рдореЙрдбрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреЛ рдХреЙрд▓ рдореЗрдВ рдЬреБрдбрд╝реЗ рд╣реЛрддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs">encoder_input = keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), name=<span class="hljs-string"><span class="hljs-string">'original_img'</span></span>) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(encoder_input) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) x = layers.MaxPooling2D(<span class="hljs-number"><span class="hljs-number">3</span></span>)(x) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) encoder_output = layers.GlobalMaxPooling2D()(x) encoder = keras.Model(encoder_input, encoder_output, name=<span class="hljs-string"><span class="hljs-string">'encoder'</span></span>) encoder.summary() decoder_input = keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">16</span></span>,), name=<span class="hljs-string"><span class="hljs-string">'encoded_img'</span></span>) x = layers.Reshape((<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>))(decoder_input) x = layers.Conv2DTranspose(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) x = layers.Conv2DTranspose(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) x = layers.UpSampling2D(<span class="hljs-number"><span class="hljs-number">3</span></span>)(x) x = layers.Conv2DTranspose(<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) decoder_output = layers.Conv2DTranspose(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) decoder = keras.Model(decoder_input, decoder_output, name=<span class="hljs-string"><span class="hljs-string">'decoder'</span></span>) decoder.summary() autoencoder_input = keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), name=<span class="hljs-string"><span class="hljs-string">'img'</span></span>) encoded_img = encoder(autoencoder_input) decoded_img = decoder(encoded_img) autoencoder = keras.Model(autoencoder_input, decoded_img, name=<span class="hljs-string"><span class="hljs-string">'autoencoder'</span></span>) autoencoder.summary()</code> </pre> <br>  рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдПрдХ рдореЙрдбрд▓ рдиреЗрд╕реНрдЯреЗрдб рд╣реЛ рд╕рдХрддрд╛ рд╣реИ: рдПрдХ рдореЙрдбрд▓ рдореЗрдВ рдПрдХ рд╕рдмрдореЙрдбрд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ (рдЪреВрдВрдХрд┐ рдореЙрдбрд▓ рдХреЛ рдПрдХ рдкрд░рдд рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ)ред <br><br>  рдШреЛрдВрд╕рд▓реЗ рдХреЗ рд╢рд┐рдХрд╛рд░ рдореЙрдбрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧ рдХрд╛ рдорд╛рдорд▓рд╛ рд╣реИред <br><br>  рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, рдпрд╣рд╛рдВ рдПрдХ рдореЙрдбрд▓ рдореЗрдВ рдПрдХ рдореЙрдбрд▓ рдХреЗ рд╕реЗрдЯ рдХреЛ рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рдЙрдирдХреЗ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдХреЛ рдФрд╕рдд рдХрд░рддрд╛ рд╣реИ: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> inputs = keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">128</span></span>,)) outputs = layers.Dense(<span class="hljs-number"><span class="hljs-number">1</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'sigmoid'</span></span>)(inputs) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keras.Model(inputs, outputs) model1 = get_model() model2 = get_model() model3 = get_model() inputs = keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">128</span></span>,)) y1 = model1(inputs) y2 = model2(inputs) y3 = model3(inputs) outputs = layers.average([y1, y2, y3]) ensemble_model = keras.Model(inputs=inputs, outputs=outputs)</code> </pre> <br><br><h2>  рдЬрдЯрд┐рд▓ рдЧреНрд░рд╛рдл рдЯреЛрдкреЛрд▓реЙрдЬреА рдореЗрдВ рд╣реЗрд░рдлреЗрд░ </h2><br><h3>  рдХрдИ рдЗрдирдкреБрдЯ рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд╕рд╛рде рдореЙрдбрд▓ </h3><br>  рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдХрдИ рдЗрдирдкреБрдЯ рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рдХреЗ рд╣реЗрд░рдлреЗрд░ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рддрд╛ рд╣реИред  рдпрд╣ рдЕрдиреБрдХреНрд░рдорд┐рдХ рдПрдкреАрдЖрдИ рдХреЗ рд╕рд╛рде рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br>  рдпрд╣рд╛рдБ рдПрдХ рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг рд╣реИред <br><br>  рдорд╛рди рд▓реАрдЬрд┐рдП рдЖрдк рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЧреНрд░рд╛рд╣рдХреЛрдВ рдХреЗ рдЖрд╡реЗрджрдиреЛрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╕рд╣реА рд╡рд┐рднрд╛рдЧ рдХреЛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рдгрд╛рд▓реА рдмрдирд╛ рд░рд╣реЗ рд╣реИрдВред <br><br>  рдЖрдкрдХреЗ рдореЙрдбрд▓ рдореЗрдВ 3 рдЗрдирдкреБрдЯ рд╣реЛрдВрдЧреЗ: <br><br><ul><li>  рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣реИрдбрд░ (рдкрд╛рда рдЗрдирдкреБрдЯ) </li><li>  рдЖрд╡реЗрджрди рдХреА рдкрд╛рда рд╕рд╛рдордЧреНрд░реА (рдкрд╛рда рдЗрдирдкреБрдЯ) </li><li>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рдХреЛрдИ рднреА рдЯреИрдЧ (рд╢реНрд░реЗрдгреАрдмрджреНрдз рдЗрдирдкреБрдЯ) </li></ul><br>  рдореЙрдбрд▓ рдореЗрдВ 2 рдЖрдЙрдЯрдкреБрдЯ рд╣реЛрдВрдЧреЗ: <br><br><ul><li>  0 рдФрд░ 1 (рд╕реНрдХреЗрд▓рд░ рд╕рд┐рдЧреНрдореЙрдЗрдб рдЖрдЙрдЯрдкреБрдЯ) рдХреЗ рдмреАрдЪ рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рд╕реНрдХреЛрд░ </li><li>  рдЬрд┐рд╕ рд╡рд┐рднрд╛рдЧ рдХреЛ рдЖрд╡реЗрджрди рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП (рдХрдИ рд╡рд┐рднрд╛рдЧреЛрдВ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕реЙрдлреНрдЯрдореИрдХреНрд╕ рдЖрдЙрдЯрдкреБрдЯ) </li></ul><br>  рдЪрд▓реЛ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдИ рд▓рд╛рдЗрдиреЛрдВ рдореЗрдВ рдПрдХ рдореЙрдбрд▓ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="python hljs">num_tags = <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-comment"><span class="hljs-comment">#     num_words = 10000 #         num_departments = 4 #     title_input = keras.Input(shape=(None,), name='title') #      body_input = keras.Input(shape=(None,), name='body') #      tags_input = keras.Input(shape=(num_tags,), name='tags') #    `num_tags` #      64-  title_features = layers.Embedding(num_words, 64)(title_input) #      64-  body_features = layers.Embedding(num_words, 64)(body_input) #        128-  title_features = layers.LSTM(128)(title_features) #        32-  body_features = layers.LSTM(32)(body_features) #          x = layers.concatenate([title_features, body_features, tags_input]) #         priority_pred = layers.Dense(1, activation='sigmoid', name='priority')(x) #       department_pred = layers.Dense(num_departments, activation='softmax', name='department')(x) #   ,     model = keras.Model(inputs=[title_input, body_input, tags_input], outputs=[priority_pred, department_pred])</span></span></code> </pre> <br>  рдЖрдЗрдП рдПрдХ рдореЙрдбрд▓ рдЧреНрд░рд╛рдл рдмрдирд╛рдПрдВ: <br><br><pre> <code class="python hljs">keras.utils.plot_model(model, <span class="hljs-string"><span class="hljs-string">'multi_input_and_output_model.png'</span></span>, show_shapes=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><img src="https://habrastorage.org/webt/gc/hk/uw/gchkuwc_zgefnaf4tx0ercck8bc.png"><br><br>  рдЗрд╕ рдореЙрдбрд▓ рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░рддреЗ рд╕рдордп, рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣рд╛рдирд┐ рдХрд╛рд░реНрдп рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдЖрдк рдкреНрд░рддреНрдпреЗрдХ рд▓рд░реНрдирд┐рдВрдЧ рдлрдВрдХреНрд╢рди рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╡рдЬрд╝рди рднреА рджреЗ рд╕рдХрддреЗ рд╣реИрдВ, рддрд╛рдХрд┐ рд╕рдордЧреНрд░ рд╢рд┐рдХреНрд╖рдг рд╣рд╛рдирд┐ рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ рдЙрдирдХреЗ рдпреЛрдЧрджрд╛рди рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред <br><br><pre> <code class="python hljs">model.compile(optimizer=keras.optimizers.RMSprop(<span class="hljs-number"><span class="hljs-number">1e-3</span></span>), loss=[<span class="hljs-string"><span class="hljs-string">'binary_crossentropy'</span></span>, <span class="hljs-string"><span class="hljs-string">'categorical_crossentropy'</span></span>], loss_weights=[<span class="hljs-number"><span class="hljs-number">1.</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>])</code> </pre> <br>  рдЪреВрдБрдХрд┐ рд╣рдордиреЗ рдЕрдкрдиреА рдЖрдЙрдЯрдкреБрдЯ рд▓реЗрдпрд░реНрд╕ рдХреЛ рдирд╛рдо рджрд┐рдпрд╛ рдерд╛, рд╣рдо рдиреБрдХрд╕рд╛рди рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рднреА рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs">model.compile(optimizer=keras.optimizers.RMSprop(<span class="hljs-number"><span class="hljs-number">1e-3</span></span>), loss={<span class="hljs-string"><span class="hljs-string">'priority'</span></span>: <span class="hljs-string"><span class="hljs-string">'binary_crossentropy'</span></span>, <span class="hljs-string"><span class="hljs-string">'department'</span></span>: <span class="hljs-string"><span class="hljs-string">'categorical_crossentropy'</span></span>}, loss_weights=[<span class="hljs-number"><span class="hljs-number">1.</span></span>, <span class="hljs-number"><span class="hljs-number">0.2</span></span>])</code> </pre> <br>  рд╣рдо рдЗрдирдкреБрдЯ рдбреЗрдЯрд╛ рдФрд░ рд▓реЗрдмрд▓ рдХреЗ Numpy рд╕рд░рдгрд┐рдпреЛрдВ рдХреА рд╕реВрдЪреА рдкрд╛рд╕ рдХрд░рдХреЗ рдореЙрдбрд▓ рдХреЛ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-comment"><span class="hljs-comment"># Dummy input data title_data = np.random.randint(num_words, size=(1280, 10)) body_data = np.random.randint(num_words, size=(1280, 100)) tags_data = np.random.randint(2, size=(1280, num_tags)).astype('float32') # Dummy target data priority_targets = np.random.random(size=(1280, 1)) dept_targets = np.random.randint(2, size=(1280, num_departments)) model.fit({'title': title_data, 'body': body_data, 'tags': tags_data}, {'priority': priority_targets, 'department': dept_targets}, epochs=2, batch_size=32)</span></span></code> </pre><br>  <code>([title_data, body_data, tags_data], [priority_targets, dept_targets])</code> рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рд╕рд╛рде рдлрд┐рдЯ рд╣реЛрдиреЗ рдкрд░, рдпрд╛ рддреЛ рд╕реВрдЪрд┐рдпреЛрдВ рдХрд╛ рдПрдХ рдЯрдкрд▓ <code>([title_data, body_data, tags_data], [priority_targets, dept_targets])</code> рдЬреИрд╕реЗ рдХрд┐ <code>([title_data, body_data, tags_data], [priority_targets, dept_targets])</code> , рдпрд╛ рд╢рдмреНрджрдХреЛрд╢реЛрдВ рдХрд╛ рдПрдХ рдЯрдкрд▓ <code>({'title': title_data, 'body': body_data, 'tags': tags_data}, {'priority': priority_targets, 'department': dept_targets})</code> рдХреЛ рд▓реМрдЯрд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред <code>({'title': title_data, 'body': body_data, 'tags': tags_data}, {'priority': priority_targets, 'department': dept_targets})</code> ред <br><br><h3>  рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд░реЗрдЬрд╝рдиреЗрдЯ рдореЙрдбрд▓ </h3><br>  рдХрдИ рдЗрдирдкреБрдЯ рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рд╡рд╛рд▓реЗ рдореЙрдбрд▓ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдлрдВрдХреНрд╢рдирд▓ рдПрдкреАрдЖрдИ рдЧреИрд░-рд▓реАрдирд┐рдпрд░ рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА рдХреЗ рд╕рд╛рде рдЯреЛрдкреЛрд▓реЙрдЬреА рдХреЗ рд╣реЗрд░рдлреЗрд░ рдХреЛ рд╕рд░рд▓ рдмрдирд╛рддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рддреН, рдРрд╕реЗ рдореЙрдбрд▓ рдЬрд┐рдирдореЗрдВ рдкрд░рддреЗрдВ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдореЗрдВ рдХрдиреЗрдХреНрдЯ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИрдВред  рдРрд╕реЗ рдореЙрдбрд▓ рднреА рдЕрдиреБрдХреНрд░рдорд┐рдХ рдПрдкреАрдЖрдИ (рдЬреИрд╕рд╛ рдХрд┐ рдирд╛рдо рдХрд╛ рдЕрд░реНрде рд╣реИ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br>  рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧ рдорд╛рдорд▓рд╛ рдЕрд╡рд╢рд┐рд╖реНрдЯ рдХрдиреЗрдХреНрд╢рди рд╣реИред <br><br>  рдЖрдЗрдП рдЗрд╕реЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП CIFAR10 рдХреЗ рд▓рд┐рдП рдПрдХ ResNet рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдореЙрдбрд▓ рдмрдирд╛рдПрдВред <br><br><pre> <code class="python hljs">inputs = keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>), name=<span class="hljs-string"><span class="hljs-string">'img'</span></span>) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(inputs) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) block_1_output = layers.MaxPooling2D(<span class="hljs-number"><span class="hljs-number">3</span></span>)(x) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>, padding=<span class="hljs-string"><span class="hljs-string">'same'</span></span>)(block_1_output) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>, padding=<span class="hljs-string"><span class="hljs-string">'same'</span></span>)(x) block_2_output = layers.add([x, block_1_output]) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>, padding=<span class="hljs-string"><span class="hljs-string">'same'</span></span>)(block_2_output) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>, padding=<span class="hljs-string"><span class="hljs-string">'same'</span></span>)(x) block_3_output = layers.add([x, block_2_output]) x = layers.Conv2D(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(block_3_output) x = layers.GlobalAveragePooling2D()(x) x = layers.Dense(<span class="hljs-number"><span class="hljs-number">256</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(x) x = layers.Dropout(<span class="hljs-number"><span class="hljs-number">0.5</span></span>)(x) outputs = layers.Dense(<span class="hljs-number"><span class="hljs-number">10</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'softmax'</span></span>)(x) model = keras.Model(inputs, outputs, name=<span class="hljs-string"><span class="hljs-string">'toy_resnet'</span></span>) model.summary()</code> </pre> <br>  рдЖрдЗрдП рдПрдХ рдореЙрдбрд▓ рдЧреНрд░рд╛рдл рдмрдирд╛рдПрдВ: <br><br><pre> <code class="python hljs">keras.utils.plot_model(model, <span class="hljs-string"><span class="hljs-string">'mini_resnet.png'</span></span>, show_shapes=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><img src="https://habrastorage.org/webt/qj/vi/bk/qjvibkpx9zrbp09rcfhj_drtlzc.png"><br><br>  рдФрд░ рдЙрд╕реЗ рд╕рд┐рдЦрд╛рдирд╛: <br><br><pre> <code class="python hljs">(x_train, y_train), (x_test, y_test) = keras.datasets.cifar10.load_data() x_train = x_train.astype(<span class="hljs-string"><span class="hljs-string">'float32'</span></span>) / <span class="hljs-number"><span class="hljs-number">255.</span></span> x_test = x_test.astype(<span class="hljs-string"><span class="hljs-string">'float32'</span></span>) / <span class="hljs-number"><span class="hljs-number">255.</span></span> y_train = keras.utils.to_categorical(y_train, <span class="hljs-number"><span class="hljs-number">10</span></span>) y_test = keras.utils.to_categorical(y_test, <span class="hljs-number"><span class="hljs-number">10</span></span>) model.compile(optimizer=keras.optimizers.RMSprop(<span class="hljs-number"><span class="hljs-number">1e-3</span></span>), loss=<span class="hljs-string"><span class="hljs-string">'categorical_crossentropy'</span></span>, metrics=[<span class="hljs-string"><span class="hljs-string">'acc'</span></span>]) model.fit(x_train, y_train, batch_size=<span class="hljs-number"><span class="hljs-number">64</span></span>, epochs=<span class="hljs-number"><span class="hljs-number">1</span></span>, validation_split=<span class="hljs-number"><span class="hljs-number">0.2</span></span>)</code> </pre> <br><h2>  рдкрд░рдд рдмрд╛рдВрдЯрдирд╛ </h2><br>  рдлрд╝рдВрдХреНрд╢рдирд▓ рдПрдкреАрдЖрдИ рдХрд╛ рдПрдХ рдФрд░ рдЕрдЪреНрдЫрд╛ рдЙрдкрдпреЛрдЧ рдРрд╕реЗ рдореЙрдбрд▓ рд╣реИрдВ рдЬреЛ рд╕рд╛рдорд╛рдиреНрдп рдкрд░рддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рд╕рд╛рдорд╛рдиреНрдп рдкрд░рддреЗрдВ рдкрд░рддреЛрдВ рдХреЗ рдЙрджрд╛рд╣рд░рдг рд╣реИрдВ рдЬреЛ рдПрдХ рд╣реА рдореЙрдбрд▓ рдореЗрдВ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ: рд╡реЗ рдЙрди рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рдкрд░рдд рдЧреНрд░рд╛рдл рдореЗрдВ рдХрдИ рдкрдереЛрдВ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИрдВред <br><br>  рдЖрдо рдкрд░рддреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдХреНрд╕рд░ рдЙрди рдЗрдирдкреБрдЯ рдбреЗрдЯрд╛ рдХреЛ рдПрдирдХреЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдПрдХ рд╣реА рд╕реНрдерд╛рди рд╕реЗ рдЖрддреЗ рд╣реИрдВ (рдЬреИрд╕реЗ рдХрд┐ рдкрд╛рда рдХреЗ рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЯреБрдХрдбрд╝реЛрдВ рдореЗрдВ, рдЬрд┐рд╕рдореЗрдВ рдПрдХ рд╣реА рд╢рдмреНрджрдХреЛрд╢ рд╣реИ), рдХреНрдпреЛрдВрдХрд┐ рд╡реЗ рдЗрди рд╡рд┐рднрд┐рдиреНрди рдбреЗрдЯрд╛ рдХреЗ рдмреАрдЪ рд╕реВрдЪрдирд╛рдУрдВ рдХрд╛ рдЖрджрд╛рди-рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рдРрд╕реЗ рдореЙрдбрд▓ рдХреЛ рдХрдо рдбреЗрдЯрд╛ рдкрд░ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдпрджрд┐ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╢рдмреНрдж рдЗрдирдкреБрдЯ рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдПрдХ рдкрд░ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ, рддреЛ рдпрд╣ рд╕рд╛рдорд╛рдиреНрдп рд╕реНрддрд░ рд╕реЗ рдЧреБрдЬрд░рдиреЗ рд╡рд╛рд▓реЗ рд╕рднреА рдЗрдирдкреБрдЯ рдкрд░ рдЗрд╕рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛ред <br><br>  рдлрд╝рдВрдХреНрд╢рдирд▓ рдПрдкреАрдЖрдИ рдореЗрдВ рдПрдХ рдкрд░рдд рд╕рд╛рдЭрд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдмрд╕ рдкрд░рдд рдХреЗ рдПрдХ рд╣реА рдЙрджрд╛рд╣рд░рдг рдХреЛ рдХрдИ рдмрд╛рд░ рдХреЙрд▓ рдХрд░реЗрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрд╣рд╛рдВ <code>Embedding</code> рд▓реЗрдпрд░ рдХреЛ рджреЛ рдЯреЗрдХреНрд╕реНрдЯ рдЗрдирдкреБрдЯ рдкрд░ рд╕рд╛рдЭрд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   1000    128-  shared_embedding = layers.Embedding(1000, 128) #     text_input_a = keras.Input(shape=(None,), dtype='int32') #     text_input_b = keras.Input(shape=(None,), dtype='int32') #           encoded_input_a = shared_embedding(text_input_a) encoded_input_b = shared_embedding(text_input_b)</span></span></code> </pre> <br><h2>  рдПрдХ рдкрд░рдд рдЧреНрд░рд╛рдл рдореЗрдВ рдиреЛрдбреНрд╕ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдФрд░ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ </h2><br>  рдЪреВрдВрдХрд┐ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдореЗрдВ рдЖрдк рдЬрд┐рд╕ рд▓реЗрдпрд░ рдЧреНрд░рд╛рдл рдореЗрдВ рд╣реЗрд░рдлреЗрд░ рдХрд░рддреЗ рд╣реИрдВ, рд╡рд╣ рд╕реНрдЯреИрдЯрд┐рдХ рдбреЗрдЯрд╛ рд╕реНрдЯреНрд░рдХреНрдЪрд░ рд╣реИ, рдЖрдк рдЗрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рд╣реИ рдХрд┐ рд╣рдо рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдореЙрдбрд▓ рдХреИрд╕реЗ рдмрдирд╛рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЫрд╡рд┐рдпреЛрдВ рдХреЗ рд░реВрдк рдореЗрдВред <br><br>  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рднреА рд╣реИ рдХрд┐ рд╣рдо рдордзреНрдпрд╡рд░реНрддреА рдкрд░рддреЛрдВ ("рдЧреНрд░рд╛рдл рдореЗрдВ" рдиреЛрдбреНрд╕) рдХреА рд╕рдХреНрд░рд┐рдпрддрд╛ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдиреНрдп рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рд▓рдХреНрд╖рдг рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЕрддреНрдпрдВрдд рдЙрдкрдпреЛрдЧреА рд╣реИ! <br><br>  рдПрдХ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦрддреЗ рд╣реИрдВред  рдпрд╣ рдПрдХ рд╡реАрдЬреАрдЬреА 19 рдореЙрдбрд▓ рд╣реИ, рдЬреЛ рдЗрдореЗрдЬрдиреЗрдЯ рдкрд░ рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рд╣реИ: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tensorflow.keras.applications <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VGG19 vgg19 = VGG19()</code> </pre> <br>  рдФрд░ рдпреЗ рдЧреНрд░рд╛рдл рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛ рдХреА рдХреНрд╡реЗрд░реА рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╛рдкреНрдд рдордзреНрдпрд╡рд░реНрддреА рдореЙрдбрд▓ рд╕рдХреНрд░рд┐рдпрдг рд╣реИрдВ: <br><br><pre> <code class="python hljs">features_list = [layer.output <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> layer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vgg19.layers]</code> </pre> <br>  рд╣рдо рдПрдХ рдирдИ рд╕реБрд╡рд┐рдзрд╛ рдирд┐рд╖реНрдХрд░реНрд╖рдг рдореЙрдбрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрди рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдордзреНрдпрд╡рд░реНрддреА рд╕реНрддрд░ рдХреЗ рд╕рдХреНрд░рд┐рдпрдг рдорд╛рди рд▓реМрдЯрд╛рддрд╛ рд╣реИ - рдФрд░ рд╣рдо рдЗрд╕реЗ 3 рдкрдВрдХреНрддрд┐рдпреЛрдВ рдореЗрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ <br><br><pre> <code class="python hljs">feat_extraction_model = keras.Model(inputs=vgg19.input, outputs=features_list) img = np.random.random((<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">224</span></span>, <span class="hljs-number"><span class="hljs-number">224</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)).astype(<span class="hljs-string"><span class="hljs-string">'float32'</span></span>) extracted_features = feat_extraction_model(img)</code> </pre> <br>  рдЕрдиреНрдп рдорд╛рдорд▓реЛрдВ рдХреА рддрд░рд╣, рддрдВрддреНрд░рд┐рдХрд╛ рд╢реИрд▓реА рд╣рд╕реНрддрд╛рдВрддрд░рдг рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╕рдордп рдпрд╣ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИред <br><br><h2>  рдХрд╕реНрдЯрдо рдкрд░рддреЛрдВ рдХреЛ рд▓рд┐рдЦрдХрд░ рдПрдкреАрдЖрдИ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рдирд╛ </h2><br>  <code>tf.keras</code> рдореЗрдВ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдкрд░рддреЛрдВ рдХреА рдПрдХ рд╡рд┐рд╕реНрддреГрдд рд╢реНрд░реГрдВрдЦрд▓рд╛ рд╣реИред  рдпрд╣рд╛рдБ рдХреБрдЫ рдЙрджрд╛рд╣рд░рдг рд╣реИрдВ: <br><br>  <code>Conv1D</code> рдкрд░рддреЗрдВ: <code>Conv1D</code> , <code>Conv2D</code> , <code>Conv3D</code> , <code>Conv2DTranspose</code> , рдЖрджрд┐ред <br>  <code>MaxPooling1D</code> рдкрд░рддреЗрдВ: <code>MaxPooling1D</code> , <code>MaxPooling2D</code> 2 <code>MaxPooling1D</code> , <code>MaxPooling2D</code> <code>MaxPooling3D</code> , <code>AveragePooling1D</code> , рдЖрджрд┐ред <br>  RNN рдкрд░рддреЗрдВ: <code>GRU</code> , <code>LSTM</code> , <code>ConvLSTM2D</code> , рдЖрджрд┐ред <br>  <code>BatchNormalization</code> , <code>Dropout</code> , <code>BatchNormalization</code> , рдЖрджрд┐ред <br><br>  рдпрджрд┐ рдЖрдкрдХреЛ рд╡рд╣ рдирд╣реАрдВ рдорд┐рд▓рд╛ рд╣реИ рдЬрд┐рд╕рдХреА рдЖрдкрдХреЛ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдЕрдкрдиреА рдЦреБрдж рдХреА рдкрд░рдд рдмрдирд╛рдХрд░ рдПрдкреАрдЖрдИ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИред <br><br>  рд╕рднреА <code>Layer</code> рд╡рд░реНрдЧ рдХреЛ рдЙрдкрд╡рд░реНрдЧрд┐рдд рдХрд░рддреА рд╣реИрдВ рдФрд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд░рддреА рд╣реИрдВ: <br><br>  <code>call</code> рд╡рд┐рдзрд┐ рдЬреЛ рдкрд░рдд рджреНрд╡рд╛рд░рд╛ рдХреА рдЧрдИ рдЧрдгрдирд╛ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреА рд╣реИред <br>  рд▓реЗрдпрд░ рд╡реЗрдЯ <code>build</code> рд╡рд╛рд▓реА <code>build</code> рд╡рд┐рдзрд┐ (рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рд╕рд┐рд░реНрдл рдПрдХ рд╕реНрдЯрд╛рдЗрд▓ рдХрдиреНрд╡реЗрдВрд╢рди рд╣реИ; рдЖрдк <code>__init__</code> рдореЗрдВ рд╡реЗрдЯ рднреА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ)ред <br><br>  рдпрд╣рд╛рдБ <code>Dense</code> рдкрд░рдд рдХрд╛ рдПрдХ рд╕рд░рд▓ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╣реИ: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomDense</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(layers.Layer)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, units=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">32</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super(CustomDense, self).__init__() self.units = units <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, input_shape)</span></span></span><span class="hljs-function">:</span></span> self.w = self.add_weight(shape=(input_shape[<span class="hljs-number"><span class="hljs-number">-1</span></span>], self.units), initializer=<span class="hljs-string"><span class="hljs-string">'random_normal'</span></span>, trainable=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) self.b = self.add_weight(shape=(self.units,), initializer=<span class="hljs-string"><span class="hljs-string">'random_normal'</span></span>, trainable=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, inputs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tf.matmul(inputs, self.w) + self.b inputs = keras.Input((<span class="hljs-number"><span class="hljs-number">4</span></span>,)) outputs = CustomDense(<span class="hljs-number"><span class="hljs-number">10</span></span>)(inputs) model = keras.Model(inputs, outputs)</code> </pre> <br>  рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрд╕реНрдЯрдо рд▓реЗрдпрд░ рдХреЛ рдХреНрд░рдорд╛рдВрдХрди рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ <code>get_config</code> рд╡рд┐рдзрд┐ рдХреЛ рднреА рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ рд▓реЗрдпрд░ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ рдХрдВрд╕реНрдЯреНрд░рдХреНрдЯрд░ рддрд░реНрдХреЛрдВ рдХреЛ рд▓реМрдЯрд╛рддрд╛ рд╣реИ: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomDense</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(layers.Layer)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, units=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">32</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> super(CustomDense, self).__init__() self.units = units <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, input_shape)</span></span></span><span class="hljs-function">:</span></span> self.w = self.add_weight(shape=(input_shape[<span class="hljs-number"><span class="hljs-number">-1</span></span>], self.units), initializer=<span class="hljs-string"><span class="hljs-string">'random_normal'</span></span>, trainable=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) self.b = self.add_weight(shape=(self.units,), initializer=<span class="hljs-string"><span class="hljs-string">'random_normal'</span></span>, trainable=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, inputs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tf.matmul(inputs, self.w) + self.b <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_config</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-string"><span class="hljs-string">'units'</span></span>: self.units} inputs = keras.Input((<span class="hljs-number"><span class="hljs-number">4</span></span>,)) outputs = CustomDense(<span class="hljs-number"><span class="hljs-number">10</span></span>)(inputs) model = keras.Model(inputs, outputs) config = model.get_config() new_model = keras.Model.from_config( config, custom_objects={<span class="hljs-string"><span class="hljs-string">'CustomDense'</span></span>: CustomDense})</code> </pre> <br>  рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ, рдЖрдк <code>from_config (cls, config)</code> рд╡рд░реНрдЧ рд╡рд┐рдзрд┐ рдХреЛ рднреА рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдХрд┐ рдЗрд╕рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╢рдмреНрджрдХреЛрд╢ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рд▓реЗрдпрд░ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИред  рдбрд┐рдлрд╝реЙрд▓реНрдЯ <code>from_config</code> рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from_config</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cls, config)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cls(**config)</code> </pre> <br><h2>  рдлрдВрдХреНрд╢рдирд▓ рдПрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдм рдХрд░реЗрдВ </h2><br>  рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдЬрдм рдирдП рдореЙрдбрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдмреЗрд╣рддрд░ рд╣реЛрддрд╛ рд╣реИ, рдпрд╛ рд╕реАрдзреЗ <code>Model</code> рд╕реАрдзреЗ рдЙрдкрд╡рд░реНрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ? <br><br>  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдлрдВрдХреНрд╢рдирд▓ рдПрдкреАрдЖрдИ рдЕрдзрд┐рдХ рдЙрдЪреНрдЪ-рд╕реНрддрд░реАрдп рдФрд░ рдЙрдкрдпреЛрдЧ рдореЗрдВ рдЖрд╕рд╛рди рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рдореЗрдВ рдХрдИ рдлрд╝рдВрдХреНрд╢рди рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдЙрдкрд╡рд░реНрдЧ рдореЙрдбрд▓ рджреНрд╡рд╛рд░рд╛ рд╕рдорд░реНрдерд┐рдд рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред <br><br>  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдореЙрдбрд▓ рдХреЛ рдЙрдкрд╡рд░реНрдЧ рдореЗрдВ рд░рдЦрдиреЗ рд╕реЗ рдЖрдкрдХреЛ рдмрд╣реБрдд рд▓рдЪреАрд▓рд╛рдкрди рдорд┐рд▓рддрд╛ рд╣реИ рдЬрдм рдРрд╕реЗ рдореЙрдбрд▓ рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрд╕рд╛рдиреА рд╕реЗ рдкрд░рддреЛрдВ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдЪрдХреНрд░реАрдп рдЧреНрд░рд╛рдл рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд░реНрдгрд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдЯреНрд░реА-рдЖрд░рдПрдирдПрди рдХреЛ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдХреЗ рд╕рд╛рде рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдкрдХреЛ рд╕реАрдзреЗ <code>Model</code> рдХреЛ рдЙрдк-рд╡рд░реНрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ)ред <br><br><h3>  рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдХреА рддрд╛рдХрдд: </h3><br>  рдиреАрдЪреЗ рд╕реВрдЪреАрдмрджреНрдз рдЧреБрдг рдЕрдиреБрдХреНрд░рдорд┐рдХ рдореЙрдбрд▓ (рдЬреЛ рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛ рднреА рд╣реИрдВ) рдХреЗ рд▓рд┐рдП рд╕рднреА рд╕рддреНрдп рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╡реЗ рдЙрдк-рд╡рд░реНрдЧ рдореЙрдбрд▓ (рдЬреЛ рдкрд╛рдпрдерди рдХреЛрдб рд╣реИрдВ, рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛ рдирд╣реАрдВ) рдХреЗ рд▓рд┐рдП рд╕рд╣реА рд╣реИрдВред <br><br><h4>  рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдЫреЛрдЯреЗ рдХреЛрдб рдХрд╛ рдЙрддреНрдкрд╛рджрди рдХрд░рддрд╛ рд╣реИред </h4><br>  рдХреЛрдИ <code>super(MyClass, self).__init__(...)</code> , рдиреЛ <code>def call(self, ...):</code> рдЖрджрд┐ред <br><br>  рдХреА рддреБрд▓рдирд╛ рдХрд░реЗрдВ: <br><br><pre> <code class="python hljs">inputs = keras.Input(shape=(<span class="hljs-number"><span class="hljs-number">32</span></span>,)) x = layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>)(inputs) outputs = layers.Dense(<span class="hljs-number"><span class="hljs-number">10</span></span>)(x) mlp = keras.Model(inputs, outputs)</code> </pre> <br>  рдЙрдкрд╡рд░реНрдЧрд┐рдд рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╕рд╛рде: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MLP</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(keras.Model)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super(MLP, self).__init__(**kwargs) self.dense_1 = layers.Dense(<span class="hljs-number"><span class="hljs-number">64</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'relu'</span></span>) self.dense_2 = layers.Dense(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, inputs)</span></span></span><span class="hljs-function">:</span></span> x = self.dense_1(inputs) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.dense_2(x) <span class="hljs-comment"><span class="hljs-comment">#   . mlp = MLP() #    . #            . _ = mlp(tf.zeros((1, 32)))</span></span></code> </pre> <br><h4>  рдЬреИрд╕рд╛ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ рд╡реИрд╕рд╛ рд╣реА рдЖрдкрдХрд╛ рдореЙрдбрд▓ рдорд╛рдиреНрдп рд╣реИред </h4><br>  рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдореЗрдВ, рдЗрдирдкреБрдЯ рд╡рд┐рдирд┐рд░реНрджреЗрд╢реЛрдВ (рдЖрдХрд╛рд░ рдФрд░ dtype) рдЕрдЧреНрд░рд┐рдо рдореЗрдВ (`рдЗрдирдкреБрдЯ` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ) рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдФрд░ рд╣рд░ рдмрд╛рд░ рдЬрдм рдЖрдк рдкрд░рдд рдХреЛ рдХреЙрд▓ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдкрд░рдд рдЬрд╛рдВрдЪрддреА рд╣реИ рдХрд┐ рдЗрд╕рдХреЗ рд▓рд┐рдП рдкрд╛рд░рд┐рдд рд╡рд┐рдирд┐рд░реНрджреЗрд╢ рдЗрд╕рдХреА рдорд╛рдиреНрдпрддрд╛рдУрдВ рд╕реЗ рдореЗрд▓ рдЦрд╛рддреЗ рд╣реИрдВ, рдпрджрд┐ рдпрд╣ рдорд╛рдорд▓рд╛ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдПрдХ рдЙрдкрдпреЛрдЧреА рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧрд╛ред ред <br><br>  рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдмрдирд╛рдП рдЧрдП рдХрд┐рд╕реА рднреА рдореЙрдбрд▓ рдореЗрдВ рдлрдВрдХреНрд╢рдирд▓ рдПрдкреАрдЖрдИ рд╢реБрд░реВ рд╣реЛред  рд╕рднреА рдбрд┐рдмрдЧрд┐рдВрдЧ (рдЕрднрд┐рд╕рд░рдг рдбрд┐рдмрдЧрд┐рдВрдЧ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдирд╣реАрдВ) рдореЙрдбрд▓ рдирд┐рд░реНрдорд╛рдг рдХреЗ рджреМрд░рд╛рди рд╕рд╛рдВрдЦреНрдпрд┐рдХреАрдп рд░реВрдк рд╕реЗ рдШрдЯрд┐рдд рд╣реЛрдЧреА, рдФрд░ рд░рди рд╕рдордп рдкрд░ рдирд╣реАрдВред  рдпрд╣ рдХрдВрдкрд╛рдЗрд▓рд░ рдореЗрдВ рдЯрд╛рдЗрдк рдЪреЗрдХрд┐рдВрдЧ рдХреЗ рд╕рдорд╛рди рд╣реИред <br><br><h4>  рдЖрдкрдХреЗ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдореЙрдбрд▓ рдХреЛ рдЧреНрд░рд╛рдлрд┐рдХ рд░реВрдк рд╕реЗ рджрд░реНрд╢рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдпрд╣ рдкрд░реАрдХреНрд╖рдг рдпреЛрдЧреНрдп рднреА рд╣реИред </h4><br>  рдЖрдк рдПрдХ рдЧреНрд░рд╛рдл рдХреЗ рд░реВрдк рдореЗрдВ рдореЙрдбрд▓ рдХреЛ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ рдЧреНрд░рд╛рдл рдХреЗ рдордзреНрдпрд╡рд░реНрддреА рдиреЛрдбреНрд╕ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдордзреНрдпрд╡рд░реНрддреА рдкрд░рддреЛрдВ рдХреЗ рд╕рдХреНрд░рд┐рдпрдг рдХреЛ рдирд┐рдХрд╛рд▓рдиреЗ рдФрд░ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рджреЗрдЦрд╛ рдерд╛: <br><br><pre> <code class="plaintext hljs">features_list = [layer.output for layer in vgg19.layers] feat_extraction_model = keras.Model(inputs=vgg19.input, outputs=features_list)</code> </pre> <br>  рдЪреВрдВрдХрд┐ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдореЙрдбрд▓ рдХреЛрдб рдХреЗ рдПрдХ рдЯреБрдХрдбрд╝реЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдХреНрд░рдордмрджреНрдз рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдПрдХрд▓ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рд╣реЗрдЬрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рд╕реНрд░реЛрдд рдХреЛрдб рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рдмрд┐рдирд╛ рдмрд┐рд▓реНрдХреБрд▓ рдЙрд╕реА рдореЙрдбрд▓ рдХреЛ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред <br><br><h3>  рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдХрдордЬреЛрд░рд┐рдпреЛрдВ </h3><br><h4>  рдпрд╣ рдЧрддрд┐рд╢реАрд▓ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред </h4><br>  рдХрд╛рд░реНрдпрд╛рддреНрдордХ API DAG рдкрд░рддреЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдореЙрдбрд▓ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рд╕рдмрд╕реЗ рдЧрд╣рд░реА рд╕реАрдЦрдиреЗ рд╡рд╛рд▓реЗ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХреЗ рд▓рд┐рдП рд╕рдЪ рд╣реИ, рд▓реЗрдХрд┐рди рд╣рд░ рдХрд┐рд╕реА рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ: рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреБрдирд░рд╛рд╡рд░реНрддреА рдиреЗрдЯрд╡рд░реНрдХ рдпрд╛ рдЯреНрд░реА рдЖрд░рдПрдирдПрди рдЗрд╕ рдзрд╛рд░рдгрд╛ рдХреЛ рдкреВрд░рд╛ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдореЗрдВ рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br><h4>  рдХрднреА-рдХрднреА рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рдЦрд░реЛрдВрдЪ рд╕реЗ рд╕рдм рдХреБрдЫ рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </h4><br>  рдЙрдиреНрдирдд рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рд▓рд┐рдЦрддреЗ рд╕рдордп, рдЖрдк рдХреБрдЫ рдРрд╕рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ "рдбреАрдПрдЬреА рдкрд░рддреЛрдВ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдирд╛" рд╕реЗ рдкрд░реЗ рд╣реЛ: рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдЕрдкрдиреЗ рдореЙрдбрд▓ рдХреЗ рдЙрджрд╛рд╣рд░рдг рдкрд░ рдХрдИ рдХрд╕реНрдЯрдо рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рд▓рд┐рдП рдЙрдкрд╡рд░реНрдЧ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред <br><br><h2>  рд╡рд┐рднрд┐рдиреНрди рдПрдкреАрдЖрдИ рд╢реИрд▓рд┐рдпреЛрдВ рдХрд╛ рд╕рдВрдпреЛрдЬрди рдФрд░ рд╕рдВрдпреЛрдЬрди </h2><br>  рдпрд╣ рдзреНрдпрд╛рди рд░рдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдпрд╛ рдореЙрдбрд▓ рдХреЛ рдЙрдкрд╡рд░реНрдЧ рдХреЗ рдмреАрдЪ рдЪреБрдирдирд╛ рдПрдХ рджреНрд╡рд┐рдЖрдзрд╛рд░реА рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдореЙрдбрд▓ рдХреА рдПрдХ рд╢реНрд░реЗрдгреА рддрдХ рд╕реАрдорд┐рдд рдХрд░рддрд╛ рд╣реИред<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tf.keras API рдХреЗ рд╕рднреА рдореЙрдбрд▓ рдПрдХ-рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рдЕрдиреБрдХреНрд░рдорд┐рдХ рдореЙрдбрд▓, рдлрд╝рдВрдХреНрд╢рдирд▓ рдореЙрдбрд▓ рдпрд╛ рд╕реНрдХреНрд░реИрдЪ рд╕реЗ рд▓рд┐рдЦреЗ рдЧрдП рдореЙрдбрд▓ / рдкрд░рддреЗрдВ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдк рд╣рдореЗрд╢рд╛ рдЙрдкрд╡рд┐рднрд╛рдЬрд┐рдд рдореЙрдбрд▓ / рдкрд░рдд рдХреЗ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдореЙрдбрд▓ рдпрд╛ рдЕрдиреБрдХреНрд░рдорд┐рдХ рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:</font></font><br><br><pre> <code class="python hljs">units = <span class="hljs-number"><span class="hljs-number">32</span></span> timesteps = <span class="hljs-number"><span class="hljs-number">10</span></span> input_dim = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-comment"><span class="hljs-comment"># Define a Functional model inputs = keras.Input((None, units)) x = layers.GlobalAveragePooling1D()(inputs) outputs = layers.Dense(1, activation='sigmoid')(x) model = keras.Model(inputs, outputs) class CustomRNN(layers.Layer): def __init__(self): super(CustomRNN, self).__init__() self.units = units self.projection_1 = layers.Dense(units=units, activation='tanh') self.projection_2 = layers.Dense(units=units, activation='tanh') # Our previously-defined Functional model self.classifier = model def call(self, inputs): outputs = [] state = tf.zeros(shape=(inputs.shape[0], self.units)) for t in range(inputs.shape[1]): x = inputs[:, t, :] h = self.projection_1(x) y = h + self.projection_2(state) state = y outputs.append(y) features = tf.stack(outputs, axis=1) print(features.shape) return self.classifier(features) rnn_model = CustomRNN() _ = rnn_model(tf.zeros((1, timesteps, input_dim)))</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд, рдЖрдк рдлрдВрдХреНрд╢рдирд▓ рдПрдкреАрдЖрдИ рдореЗрдВ рдХрд┐рд╕реА рднреА рдЙрдкрд╡рд░реНрдЧрд┐рдд рдкрд░рдд рдпрд╛ рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрджрд┐ рдЖрдк рдПрдХ рдРрд╕реА рд╡рд┐рдзрд┐ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ </font></font><code>call</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИрдВ рдЬреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреИрдЯрд░реНрди рдореЗрдВ рд╕реЗ рдПрдХ рд╕реЗ рдореЗрд▓ рдЦрд╛рддреА рд╣реИ: </font></font><br><br> <code>call(self, inputs, **kwargs)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬрд╣рд╛рдВ </font></font><code>inputs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреЗрдВрд╕рд░ рдпрд╛ рдиреЗрд╕реНрдЯреЗрдб рдЯреЗрдВрд╕рд░ рд╕рдВрд░рдЪрдирд╛ (рдЬреИрд╕реЗ рдЯреЗрдВрд╕рд░реЛрдВ рдХреА рд╕реВрдЪреА) рд╣реИ, рдФрд░ рдЬрд╣рд╛рдВ </font></font><code>**kwargs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧреИрд░-рдЯреЗрдирд╕рд░ рддрд░реНрдХ рд╣реИрдВ (рдЗрдирдкреБрдЯ рдирд╣реАрдВ) ред </font><font style="vertical-align: inherit;">рдмреВрд▓рд┐рдпрди рдорд╛рди </font></font><br> <code>call(self, inputs, training=None, **kwargs)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╣рд╛рдБ </font></font><code>training</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХрд┐рд╕ рдореЛрдб рдореЗрдВ рдкрд░рдд, рд╕реАрдЦрдиреЗ рдпрд╛ рдЖрдЙрдЯрдкреБрдЯ рдХрд╛ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред </font><font style="vertical-align: inherit;">рдмреВрд▓рд┐рдпрди рдорд╛рд╕реНрдХ рдЯреЗрдВрд╕рд░ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, RNN рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА) </font></font><br> <code>call(self, inputs, mask=None, **kwargs)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХрд╣рд╛рдБ </font></font><code>mask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИред </font></font><br> <code>call(self, inputs, training=None, mask=None, **kwargs)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдмреЗрд╢рдХ рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдкрд░рдд рдХреЗ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рджреЛрдиреЛрдВ рдкреИрд░рд╛рдореАрдЯрд░ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдЖрдк рдЕрдкрдиреЗ рдХрд╕реНрдЯрдо рд▓реЗрдпрд░ рдпрд╛ рдореЙрдбрд▓ рдкрд░ `get_config` рдкрджреНрдзрддрд┐ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЗрд╕рдХреЗ рд╕рд╛рде рдЬреЛ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдореЙрдбрд▓ рдмрдирд╛рддреЗ рд╣реИрдВ, рд╡рд╣ рдХреНрд░рдордмрджреНрдз рдФрд░ рдХреНрд▓реЛрди рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдиреАрдЪреЗ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдЙрджрд╛рд╣рд░рдг рд╣реИ рдЬрд╣рд╛рдВ рд╣рдо рдХрд╕реНрдЯрдо рдЖрд░рдПрдирдПрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рд╕реНрдХреНрд░реИрдЪ рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдореЙрдбрд▓ рд╕реЗ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ:</font></font><br><br><pre> <code class="python hljs">units = <span class="hljs-number"><span class="hljs-number">32</span></span> timesteps = <span class="hljs-number"><span class="hljs-number">10</span></span> input_dim = <span class="hljs-number"><span class="hljs-number">5</span></span> batch_size = <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomRNN</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(layers.Layer)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super(CustomRNN, self).__init__() self.units = units self.projection_1 = layers.Dense(units=units, activation=<span class="hljs-string"><span class="hljs-string">'tanh'</span></span>) self.projection_2 = layers.Dense(units=units, activation=<span class="hljs-string"><span class="hljs-string">'tanh'</span></span>) self.classifier = layers.Dense(<span class="hljs-number"><span class="hljs-number">1</span></span>, activation=<span class="hljs-string"><span class="hljs-string">'sigmoid'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, inputs)</span></span></span><span class="hljs-function">:</span></span> outputs = [] state = tf.zeros(shape=(inputs.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.units)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(inputs.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>]): x = inputs[:, t, :] h = self.projection_1(x) y = h + self.projection_2(state) state = y outputs.append(y) features = tf.stack(outputs, axis=<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.classifier(features) <span class="hljs-comment"><span class="hljs-comment">#           #  `batch_shape`,     `CustomRNN`  #    (     `state`). inputs = keras.Input(batch_shape=(batch_size, timesteps, input_dim)) x = layers.Conv1D(32, 3)(inputs) outputs = CustomRNN()(x) model = keras.Model(inputs, outputs) rnn_model = CustomRNN() _ = rnn_model(tf.zeros((1, 10, 5)))</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рд╣рдорд╛рд░реА рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдПрдкреАрдЖрдИ рдЧрд╛рдЗрдб рдХрд╛ рд╕рдорд╛рдкрди рдХрд░рддрд╛ рд╣реИ! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЕрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдЧрд╣рди рд╢рд┐рдХреНрд╖рдг рдореЙрдбрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдгреЛрдВ рдХрд╛ рдПрдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рд╕реЗрдЯ рд╣реИред</font></font><br><br>  <i>рд╕рддреНрдпрд╛рдкрди рдХреЗ рдмрд╛рдж, рдЕрдиреБрд╡рд╛рдж Tensorflow.org рдкрд░ рднреА рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ред</i>  <i>рдпрджрд┐ рдЖрдк рд░реВрд╕реА рдореЗрдВ Tensorflow.org рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреЗ рдкреНрд░рд▓реЗрдЦрди рдХреЗ рдЕрдиреБрд╡рд╛рдж рдореЗрдВ рднрд╛рдЧ рд▓реЗрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдХреГрдкрдпрд╛ рдПрдХ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдпрд╛ рдЯрд┐рдкреНрдкрдгреА рдореЗрдВ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВред</i>  <i>рдХрд┐рд╕реА рднреА рд╕реБрдзрд╛рд░ рдпрд╛ рдЯрд┐рдкреНрдкрдгреА рдХреА рд╕рд░рд╛рд╣рдирд╛ рдХреА рдЬрд╛рддреА рд╣реИред</i> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд┐рддреНрд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, рд╣рдордиреЗ рдЧреВрдЧрд▓реЗрдиреЗрдЯ рдореЙрдбрд▓ рдХреА рдЫрд╡рд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛, рдЬреЛ рдХрд┐ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдПрд╕рд╛рдЗрдХреНрд▓рд┐рдХ рдЧреНрд░рд╛рдл рднреА рд╣реИред</font></font></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi483664/">https://habr.com/ru/post/hi483664/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi483650/index.html">рднреВрдордзреНрдп рд░реЗрдЦрд╛ рдХреЗ рдХрд░реАрдм рдХреЙрд╕рдореЛрдбреНрд░реЛрдо - рд╡реЗрдирдЪрд╛рдВрдЧ рдЯреНрд░реЙрдкрд┐рдХрд▓ рдХреЙрд╕рдореЛрдбреНрд░реЛрдо</a></li>
<li><a href="../hi483652/index.html">рдпрджрд┐ рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдореЗрд░реЗ рдкрд╛рд╕ рд▓реЗрдЯреЗрдВ: рдПрдХ рд╕рд╛рдорд╛рдЬрд┐рдХ рдХреАрдЯрдкрд╛рд▓рдХ рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ</a></li>
<li><a href="../hi483654/index.html">рд░реИрд▓рд┐рдпреЛрдВ рдореЗрдВ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛, рдПрдХ рдкрд░ рдПрдХ, рдпрд╣ рдХреНрдпреЛрдВ рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдареАрдХ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХреИрд╕реЗ рдХрд░реЗрдВ?</a></li>
<li><a href="../hi483656/index.html">рдЦреБрджрд░рд╛ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдЭрд╛рдВрдХреА, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ?</a></li>
<li><a href="../hi483662/index.html">рд╕рд┐рд╕реНрдХреЛ рдереНрд░реЗрдЯ рд░рд┐рд╕реНрдкрд╛рдВрд╕ рдФрд░ рд╕рд┐рд╕реНрдХреЛ рд╕реНрдЯреАрд▓реНрдерд╡реЙрдЪ рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рдХрд╛ рдПрдХреАрдХрд░рдг</a></li>
<li><a href="../hi483666/index.html">Volodya рдФрд░ ozonizer рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ</a></li>
<li><a href="../hi483668/index.html">рдкрд┐рдЫрд▓реЗ рд╕рдкреНрддрд╛рд╣ рдирдВрдмрд░ 397 (6 рдЬрдирд╡рд░реА - 12, 2020) рдХреЗ рд▓рд┐рдП рдлреНрд░рдВрдЯ-рдПрдВрдб рдХреА рджреБрдирд┐рдпрд╛ рд╕реЗ рддрд╛рдЬрд╛ рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдкрд╛рдЪрди</a></li>
<li><a href="../hi483670/index.html">рд╕рдм рдХреБрдЫ рдЖрдк рдореИрдХ рдкрддреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддреЗ рдереЗ</a></li>
<li><a href="../hi483674/index.html">рдмрд╛рдЗрдирд░реА рдиреНрдпреВрд░рд▓ рдиреЗрдЯрд╡рд░реНрдХ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рд╡реЗ 2020 рдореЗрдВ рд▓реЛрдХрдкреНрд░рд┐рдп рдХреНрдпреЛрдВ рд╣реЛрдВрдЧреЗ</a></li>
<li><a href="../hi483676/index.html">рдПрдВрдб-рдЯреВ-рдПрдВрдб рдорд╛рд░реНрдХреЗрдЯрд┐рдВрдЧ рдПрдирд╛рд▓рд┐рдЯрд┐рдХреНрд╕ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдкреНрд░рднрд╛рд╡рд╢реАрд▓рддрд╛ рдФрд░ рд▓рд╛рдЧрдд рдХрд╛ рдЖрдХрд▓рди</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>