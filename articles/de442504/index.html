<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëåüèø ü§∞üèø üêª PHP Xdebug-Proxy: Wenn die Standardfunktionen von Xdebug nicht ausreichen üôçüèæ üåó üëºüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Verwenden Sie zum Debuggen von PHP-Programmen h√§ufig Xdebug . Die Standardfunktionen von IDE und Xdebug reichen jedoch nicht immer aus. Einige der Pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PHP Xdebug-Proxy: Wenn die Standardfunktionen von Xdebug nicht ausreichen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/442504/"><p><img src="https://habrastorage.org/webt/qr/30/pd/qr30pdoglljz7da1c8uooyutxu8.jpeg" alt="PHP Xdebug-Proxy: Wenn die Standardfunktionen von Xdebug nicht ausreichen"></p><br><p>  Verwenden Sie zum Debuggen von PHP-Programmen h√§ufig <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Xdebug</a> .  Die Standardfunktionen von IDE und Xdebug reichen jedoch nicht immer aus.  Einige der Probleme k√∂nnen mit dem Xdebug-Proxy - pydbgpproxy - gel√∂st werden, aber immer noch nicht alle.  Daher habe ich den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PHP Xdebug-Proxy</a> basierend auf dem asynchronen Amphp-Framework implementiert. </p><br><p>  Unter dem Schnitt werde ich Ihnen sagen, was mit pydbgpproxy nicht stimmt, was darin fehlt und warum ich es nicht ge√§ndert habe.  Ich werde auch anhand eines Beispiels erkl√§ren, wie der PHP Xdebug-Proxy funktioniert, und zeigen, wie er erweitert werden kann. <a name="habracut"></a></p><br><h2 id="pydbgpproxy-vs-php-xdebug-proxy">  Pydbgpproxy vs PHP Xdebug Proxy </h2><br><p>  Der Xdebug-Proxy ist ein Zwischendienst zwischen der IDE und Xdebug (Proxy-Anforderungen von Xdebug an die IDE und umgekehrt).  Am h√§ufigsten wird es f√ºr das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mehrbenutzer-Debugging verwendet</a> .  Dies ist der Fall, wenn Sie einen Webserver und mehrere Entwickler haben. </p><br><p>  Als Proxy wird normalerweise pydbgpproxy verwendet.  Aber er hat ein paar Probleme: </p><br><ul><li>  keine offizielle Seite; </li><li>  schwer zu finden, wo man es herunterladen kann;  Es stellt sich heraus, dass dies <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier m√∂glich ist</a> - pl√∂tzlich Python Remote Debugging Client; </li><li>  Ich habe das offizielle Repository nicht gefunden. </li><li>  Infolge des vorherigen Absatzes ist nicht klar, wohin die Pull-Anfrage gebracht werden soll. </li><li>  Proxy ist, wie der Name schon sagt, in Python geschrieben, was nicht allen PHP-Entwicklern bekannt ist, was bedeutet, dass die Erweiterung ein Problem darstellt. </li><li>  Fortsetzung des vorherigen Absatzes: Wenn in PHP Code vorhanden ist und dieser im Proxy verwendet werden muss, muss er nach Python portiert werden, und das Duplizieren von Code ist immer nicht sehr gut. </li></ul><br><p>  Eine Suche nach einem Xdebug-Proxy, der in PHP auf GitHub und im Internet geschrieben wurde, ergab keine Ergebnisse.  Also habe ich den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PHP Xdebug Proxy geschrieben</a> .  Unter der Haube habe ich das asynchrone <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Amphp-</a> Framework verwendet. </p><br><p>  Die Hauptvorteile von PHP Xdebug Proxy gegen√ºber Pydbgpproxy: </p><br><ul><li>  Der PHP Xdebug-Proxy ist in einer Sprache geschrieben, die PHP-Entwicklern vertraut ist. Dies bedeutet: <br><ul><li>  es ist einfacher, Probleme darin zu l√∂sen; </li><li>  es ist einfacher zu erweitern; </li></ul></li><li>  Der PHP Xdebug-Proxy verf√ºgt √ºber ein √∂ffentliches Repository. Dies bedeutet: <br><ul><li>  Sie k√∂nnen es nach Ihren W√ºnschen teilen und fertigstellen. </li><li>  Sie k√∂nnen eine Pull-Anfrage mit einer fehlenden Funktion oder einer L√∂sung f√ºr ein Problem senden. </li></ul></li></ul><br><h2 id="kak-rabotat-s-php-xdebug-proxy">  So arbeiten Sie mit dem PHP Xdebug-Proxy </h2><br><h3 id="ustanovka">  Installation </h3><br><p>  Der PHP Xdebug-Proxy kann √ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Composer</a> als Entwicklungsabh√§ngigkeit installiert werden: </p><br><pre><code class="bash hljs">composer.phar require mougrim/php-xdebug-proxy --dev</code> </pre> <br><p>  Wenn Sie jedoch keine zus√§tzlichen Abh√§ngigkeiten in Ihr Projekt ziehen m√∂chten, kann der PHP Xdebug-Proxy √ºber denselben Composer als Projekt installiert werden: </p><br><pre> <code class="bash hljs">composer.phar create-project mougrim/php-xdebug-proxy <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-xdebug-proxy</code> </pre> <br><p>  Der PHP Xdebug-Proxy ist erweiterbar, aber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ext-dom</a> ist standardm√§√üig erforderlich (die Erweiterung ist in PHP standardm√§√üig aktiviert), um XML und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">amphp / log</a> f√ºr die asynchrone <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Protokollierung zu analysieren</a> : </p><br><pre> <code class="bash hljs">composer.phar require amphp/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> <span class="hljs-string"><span class="hljs-string">'^1.0.0'</span></span></code> </pre> <br><h3 id="zapusk">  Starten </h3><br><p><img src="https://habrastorage.org/webt/jb/n4/dc/jbn4dcyqwpirx7koyqjzwxfwozc.jpeg" alt="PHP Xdebug-Proxy"></p><br><p>  Der Proxy startet wie folgt: </p><br><pre> <code class="bash hljs">bin/xdebug-proxy</code> </pre> <br><p>  Der Proxy beginnt mit den Standardeinstellungen: </p><br><pre> <code class="plaintext hljs">Using config path /path/to/php-xdebug-proxy/config [2019-02-14 10:46:24] xdebug-proxy.NOTICE: Use default ide: 127.0.0.1:9000 array ( ) array ( ) [2019-02-14 10:46:24] xdebug-proxy.NOTICE: Use predefined ides array ( 'predefinedIdeList' =&gt; array ( 'idekey' =&gt; '127.0.0.1:9000', ), ) array ( ) [2019-02-14 10:46:24] xdebug-proxy.NOTICE: [Proxy][IdeRegistration] Listening for new connections on '127.0.0.1:9001'... array ( ) array ( ) [2019-02-14 10:46:24] xdebug-proxy.NOTICE: [Proxy][Xdebug] Listening for new connections on '127.0.0.1:9002'... array ( ) array ( )</code> </pre> <br><p>  Aus dem Protokoll k√∂nnen Sie ersehen, dass der Standard-Proxy: </p><br><ul><li>  lauscht auf <code>127.0.0.1:9001</code> f√ºr IDE-Anmeldeverbindungen; </li><li>  lauscht auf <code>127.0.0.1:9002</code> f√ºr Xdebug-Verbindungen; </li><li>  verwendet <code>127.0.0.1:9000</code> als Standard-IDE und vordefinierte IDE mit Idekey-Schl√ºssel. </li></ul><br><h3 id="konfiguraciya">  Konfiguration </h3><br><p>  Wenn Sie √úberwachungsports usw. konfigurieren m√∂chten, k√∂nnen Sie den Pfad zum Einstellungsordner angeben.  Kopieren Sie einfach den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Konfigurationsordner</a> : </p><br><pre> <code class="bash hljs">cp -r /path/to/php-xdebug-proxy/config /your/custom/path</code> </pre> <br><p>  Der Einstellungsordner enth√§lt drei Dateien: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>config.php</code></a> : <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'xdebugServer'</span></span> =&gt; [ <span class="hljs-comment"><span class="hljs-comment">// host:port    Xdebug 'listen' =&gt; '127.0.0.1:9002', ], 'ideServer' =&gt; [ //  proxy    IDE,     IDE  , //    IDE  ,     . // IDE   ,  proxy    . 'defaultIde' =&gt; '127.0.0.1:9000', //  IDE    'idekey' =&gt; 'host:port', //   IDE  ,     . //  IDE ,   proxy  , //           proxy. 'predefinedIdeList' =&gt; [ 'idekey' =&gt; '127.0.0.1:9000', ], ], 'ideRegistrationServer' =&gt; [ // host:port     IDE, //     IDE,     . 'listen' =&gt; '127.0.0.1:9001', ], ];</span></span></code> </pre> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>logger.php</code></a> : Sie k√∂nnen den Logger konfigurieren.  Die Datei sollte ein Objekt zur√ºckgeben, das eine Instanz von <code>\Psr\Log\LoggerInterface</code> ist. Der Standardwert ist <code>\Monolog\Logger</code> mit <code>\Amp\Log\StreamHandler</code> (f√ºr nicht blockierende Aufzeichnung). Es werden Protokolle in stdout angezeigt. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>factory.php</code></a> : Sie k√∂nnen die Klassen konfigurieren, die im Proxy verwendet werden.  Die Datei sollte ein Objekt zur√ºckgeben, das eine Instanz von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>Factory\Factory</code></a> ist. Der Standardwert ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>Factory\DefaultFactory</code></a> . </li></ul><br><p>  Nach dem Kopieren der Dateien k√∂nnen Sie den Proxy bearbeiten und ausf√ºhren: </p><br><pre> <code class="bash hljs">bin/xdebug-proxy --configs=/your/custom/path/config</code> </pre> <br><h3 id="otladka">  Debuggen </h3><br><p>  Es wurden viele Artikel zum Debuggen von Code mit Xdebug geschrieben.  Ich werde die Hauptpunkte beachten. </p><br><p>  In der php.ini sollten sich die folgenden Einstellungen im Abschnitt <code>[xdebug]</code> (korrigieren Sie sie, wenn sie von den Standardeinstellungen abweichen): </p><br><ul><li>  idekey = idekey </li><li>  remote_host = 127.0.0.1 </li><li>  remote_port = 9002 </li><li>  remote_enable = Ein </li><li>  remote_autostart = Ein </li><li>  remote_connect_back = Aus </li></ul><br><p>  Dann k√∂nnen Sie debuggten PHP-Code ausf√ºhren: </p><br><pre> <code class="bash hljs">php /path/to/your/script.php</code> </pre> <br><p>  Wenn Sie alles richtig gemacht haben, beginnt das Debuggen am ersten Haltepunkt in der IDE.  Das Debuggen im PHP-Fpm-Modus durch mehrere Entwickler geht √ºber den Rahmen dieses Artikels hinaus, wird jedoch beispielsweise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier beschrieben</a> . </p><br><h2 id="rasshirenie-funkciy-proxy">  Erweiterungs-Proxy-Funktionen </h2><br><p>  Alles, was wir oben untersucht haben, ist auch Pydbgpproxy bis zu dem einen oder anderen Grad. </p><br><p>  Lassen Sie uns nun √ºber den interessantesten PHP Xdebug-Proxy sprechen.  Proxies k√∂nnen mit Ihrer eigenen Factory erweitert werden (erstellt in der Konfiguration <code>factory.php</code> , siehe oben).  Die Factory muss die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>Factory\Factory</code></a> Schnittstelle implementieren. </p><br><p>  Am m√§chtigsten sind die sogenannten Request Preparer.  Sie k√∂nnen Anforderungen von Xdebug an die IDE √§ndern und umgekehrt.  Um einen <code>Factory\DefaultFactory::createRequestPreparers()</code> hinzuzuf√ºgen, m√ºssen Sie die <code>Factory\DefaultFactory::createRequestPreparers()</code> -Methode <code>Factory\DefaultFactory::createRequestPreparers()</code> .  Die Methode gibt ein Array von Objekten zur√ºck, die die Schnittstelle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>RequestPreparer\RequestPreparer</code></a> implementieren.  Wenn eine Anforderung von Xdebug an die IDE weitergeleitet wird, werden sie in der direkten Reihenfolge ausgef√ºhrt. Wenn Sie eine Anforderung von der IDE an Xdebug weiterleiten, wird sie umgekehrt. </p><br><p>  Abfragehandler k√∂nnen beispielsweise verwendet werden, um Pfade zu Dateien zu √§ndern (in Haltepunkten und ausf√ºhrbaren Dateien). </p><br><h3 id="debag-perepisannyh-faylov">  Debuggen Sie √ºberschriebene Dateien </h3><br><p>  Um ein Beispiel f√ºr einen Vorbereiter zu geben, werde ich einen kleinen Exkurs machen.  In Unit-Tests verwenden wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Soft-Mocks</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub</a> ).  Mit Soft-Mocks k√∂nnen Sie Funktionen, statische Methoden, Konstanten usw. in Tests <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ersetzen</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dies</a> ist eine Alternative f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Runkit</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Uopz</a> .  Dies funktioniert, indem PHP-Dateien im laufenden Betrieb neu geschrieben werden.  Ebenso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">funktioniert AspectMock</a> immer noch. </p><br><p>  Mit den Standardfunktionen von Xdebug und IDE k√∂nnen Sie jedoch das neu geschriebene Debugging (mit einem anderen Pfad) anstelle der Originaldateien debuggen. </p><br><p>  Schauen wir uns das Debugging-Problem mit Soft-Mocks in Tests genauer an.  Nehmen Sie zun√§chst den Fall, in dem der PHP-Code lokal ausgef√ºhrt wird. </p><br><p>  Die ersten Schwierigkeiten treten beim Festlegen von Haltepunkten (Haltepunkten) auf.  In der IDE werden sie in den Originaldateien installiert, nicht in den neu geschriebenen.  Um einen Haltepunkt durch die IDE zu setzen, m√ºssen Sie die tats√§chlich neu geschriebene Datei finden.  Das Problem wird durch die Tatsache versch√§rft, dass jedes Mal, wenn die Originaldatei ge√§ndert wird, eine neue neu geschriebene Datei erstellt wird, dh f√ºr jeden eindeutigen Dateiinhalt wird eine eindeutige neu geschriebene Datei erstellt. </p><br><p>  Dieses Problem kann durch Aufrufen der Funktion <code>xdebug_break()</code> gel√∂st werden, die dem Festlegen eines Haltepunkts √§hnelt.  In diesem Fall muss nicht nach einer neu geschriebenen Datei gesucht werden. </p><br><p>  Betrachten Sie die Situation nun als komplizierter: Die Anwendung wird auf einem Remotecomputer ausgef√ºhrt. </p><br><p>  In diesem Fall k√∂nnen Sie den Ordner mit den neu geschriebenen Dateien beispielsweise √ºber SSHFS bereitstellen.  Wenn sich die lokalen und Remote-Pfade zum Ordner unterscheiden, m√ºssen Sie weiterhin Zuordnungen in der IDE registrieren. </p><br><p>  Auf die eine oder andere Weise unterscheidet sich diese Methode geringf√ºgig von der √ºblichen und erm√∂glicht es Ihnen, nur die kopierten Dateien zu debuggen, nicht jedoch die Originaldateien.  Trotzdem m√∂chte ich dieselben Originaldateien bearbeiten und debuggen. </p><br><p>  AspectMock hat das Problem umgangen, indem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">es den Debug-Modus aktiviert hat,</a> ohne ihn deaktivieren zu k√∂nnen: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $options = [])</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($options[<span class="hljs-string"><span class="hljs-string">'excludePaths'</span></span>])) { $options[<span class="hljs-string"><span class="hljs-string">'excludePaths'</span></span>] = []; } $options[<span class="hljs-string"><span class="hljs-string">'debug'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; $options[<span class="hljs-string"><span class="hljs-string">'excludePaths'</span></span>][] = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::init($options); }</code> </pre> <br><p>  In einem einfachen Testbeispiel ist der Debug-Modus um 20 Prozent langsamer. Ich habe jedoch nicht gen√ºgend AspectMock-Tests, um genauer abzusch√§tzen, wie langsam er ist.  Wenn Sie viele Tests mit AspectMock haben, w√ºrde ich mich freuen, wenn Sie den Vergleich in den Kommentaren teilen. </p><br><h3 id="ispolzovanie-xdebug-s-soft-mocks">  Verwenden von Xdebug mit Soft-Mocks </h3><br><p><img src="https://habrastorage.org/webt/eu/3d/ui/eu3duipif0jihrhzwlquhfpywuc.jpeg" alt="Xdebug + Soft-Mocks"></p><br><p>  Nachdem das Problem klar ist, √ºberlegen Sie, wie Sie es mit dem PHP Xdebug-Proxy l√∂sen k√∂nnen.  Der Hauptteil befindet sich in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>RequestPreparer\SoftMocksRequestPreparer</code></a> . </p><br><p>  Definieren Sie im Klassenkonstruktor den Pfad zum Soft-Mocks-Initialisierungsskript und f√ºhren Sie ihn aus (es wird davon ausgegangen, dass Soft-Mocks als Abh√§ngigkeit verbunden sind, aber jeder Pfad kann an den Konstruktor √ºbergeben werden): </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LoggerInterface $logger, string $initScript = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;logger = $logger; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$initScript) { $possibleInitScriptPaths = [ <span class="hljs-comment"><span class="hljs-comment">// proxy   , soft-mocks ‚Äî    __DIR__.'/../../vendor/badoo/soft-mocks/src/init_with_composer.php', // proxy  soft-mocks    __DIR__.'/../../../../badoo/soft-mocks/src/init_with_composer.php', ]; foreach ($possibleInitScriptPaths as $possiblInitScriptPath) { if (file_exists($possiblInitScriptPath)) { $initScript = $possiblInitScriptPath; break; } } } if (!$initScript) { throw new Error("Can't find soft-mocks init script"); } //  soft-mocks (       ..) require $initScript; }</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/9p/8t/u7/9p8tu7eatpdhaewvfxvv2ossunu.jpeg" alt="Xdebug + Soft-Mocks: von Xdebug zu IDE"></p><br><p>  Um eine Anforderung von Xdebug an die IDE vorzubereiten, m√ºssen Sie den Pfad zur neu geschriebenen Datei durch die Originaldatei ersetzen: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareRequestToIde</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(XmlDocument $xmlRequest, string $rawRequest)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $context = [ <span class="hljs-string"><span class="hljs-string">'request'</span></span> =&gt; $rawRequest, ]; $root = $xmlRequest-&gt;getRoot(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$root) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($root-&gt;getChildren() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $child) { <span class="hljs-comment"><span class="hljs-comment">//         : // - 'stack': https://xdebug.org/docs-dbgp.php#stack-get // - 'xde</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">bug:</span></span></span><span class="hljs-comment">message': https://xdebug.org/docs-dbgp.php#error-notification if (!in_array($child-&gt;getName(), ['stack', 'xde</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">bug:</span></span></span><span class="hljs-comment">message'], true)) { continue; } $attributes = $child-&gt;getAttributes(); if (isset($attributes['filename'])) { //         ,      $filename = $this-&gt;getOriginalFilePath($attributes['filename'], $context); if ($attributes['filename'] !== $filename) { $this-&gt;logger-&gt;info("Change '{$attributes['filename']}' to '{$filename}'", $context); $child-&gt;addAttribute('filename', $filename); } } } }</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/6h/qw/er/6hqwerwharffc9a_ylzobqxut9o.jpeg" alt="Xdebug + Soft-Mocks: von IDE zu Xdebug"></p><br><p>  Um eine Anforderung von der IDE an Xdebug vorzubereiten, m√ºssen Sie den Pfad zur Originaldatei durch den Pfad zur neu geschriebenen ersetzen: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareRequestToXdebug</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $request, CommandToXdebugParser $commandToXdebugParser)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       [$command, $arguments] = $commandToXdebugParser-&gt;parseCommand($request); $context = [ 'request' =&gt; $request, 'arguments' =&gt; $arguments, ]; if ($command === 'breakpoint_set') { //    -f,          // . https://xdebug.org/docs-dbgp.php#id3 if (isset($arguments['-f'])) { $file = $this-&gt;getRewrittenFilePath($arguments['-f'], $context); if ($file) { $this-&gt;logger-&gt;info("Change '{$arguments['-f']}' to '{$file}'", $context); $arguments['-f'] = $file; //    $request = $commandToXdebugParser-&gt;buildCommand($command, $arguments); } } else { $this-&gt;logger-&gt;error("Command {$command} is without argument '-f'", $context); } } return $request; }</span></span></code> </pre> <br><p>  Damit der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>Factory\DefaultFactory</code></a> funktioniert, m√ºssen Sie Ihre Factory-Klasse erstellen und entweder von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>Factory\DefaultFactory</code></a> erben oder die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>Factory\Factory</code></a> Schnittstelle implementieren.  F√ºr Soft-Mocks sieht die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>Factory\SoftMocksFactory</code></a> aus: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SoftMocksFactory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $config)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Config</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       return new SoftMocksConfig($config); } public function createRequestPreparers(LoggerInterface $logger, Config $config): array { $requestPreparers = parent::createRequestPreparers($logger, $config); return array_merge($requestPreparers, [$this-&gt;createSoftMocksRequestPreparer($logger, $config)]); } public function createSoftMocksRequestPreparer(LoggerInterface $logger, SoftMocksConfig $config): SoftMocksRequestPreparer { //     init-   return new SoftMocksRequestPreparer($logger, $config-&gt;getSoftMocks()-&gt;getInitScript()); } }</span></span></code> </pre> <br><p>  Hier ben√∂tigen Sie eine eigene Konfigurationsklasse, damit Sie den Pfad des Soft-Mocks-Init-Skripts angeben k√∂nnen.  Was es ist, k√∂nnen Sie in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Config \ SoftMocksConfig sehen</a> . </p><br><p>  Es blieb nur wenig √ºbrig: eine neue Factory zu erstellen und den Pfad zum Soft-Mocks-Init-Skript anzugeben.  Wie das geht, kann in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>softMocksConfig</code></a> eingesehen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>softMocksConfig</code></a> . </p><br><h3 id="neblokiruyuschiy-api">  Nicht blockierende API </h3><br><p>  Wie ich oben geschrieben habe, verwendet der PHP Xdebug-Proxy Amphp unter der Haube, was bedeutet, dass eine nicht blockierende API verwendet werden muss, um mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">E / A zu arbeiten.</a>  Apmphp verf√ºgt bereits √ºber viele Komponenten, die diese nicht blockierende API implementieren.  Wenn Sie den PHP Xdebug-Proxy erweitern und im Mehrbenutzermodus verwenden m√∂chten, m√ºssen Sie nicht blockierende APIs verwenden. </p><br><h2 id="vyvody">  Schlussfolgerungen </h2><br><p>  PHP Xdebug Proxy ist noch ein relativ junges Projekt, aber in Badoo wird es bereits aktiv zum Debuggen von Tests mit Soft-Mocks verwendet. </p><br><p>  PHP Xdebug-Proxy: </p><br><ul><li>  ersetzt pydbgpproxy beim Debuggen f√ºr mehrere Benutzer; </li><li>  kann mit Soft-Mocks arbeiten; </li><li>  kann erweitert werden: <br><ul><li>  Sie k√∂nnen die Pfade zu Dateien ersetzen, die von der IDE und von Xdebug stammen. </li><li>  Statistiken k√∂nnen gesammelt werden: Im Debug-Modus ist beim Debuggen mindestens der ausf√ºhrbare Kontext verf√ºgbar (Werte von Variablen und ausf√ºhrbare Codezeile). </li></ul></li></ul><br><p>  Wenn Sie den Xdebug-Proxy f√ºr etwas anderes als das Mehrbenutzer-Debugging verwenden, teilen Sie Ihren Fall und den Xdebug-Proxy, den Sie in den Kommentaren verwenden. </p><br><p>  Wenn Sie pydbgpproxy oder einen anderen Xdebug-Proxy verwenden, versuchen Sie es mit dem PHP Xdebug-Proxy, informieren Sie sich √ºber Ihre Probleme und teilen Sie Pull-Anforderungen.  Lassen Sie uns das Projekt gemeinsam entwickeln!  :) :) </p><br><p>  PS Vielen Dank an meinen Kollegen Yevgeny <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Makhrov</a> aka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eZH</a> f√ºr die Idee von Proxy <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">smdbgpproxy</a> ! </p><br><h2 id="eschyo-raz-ssylki">  Wieder Links </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PHP Xdebug-Proxy</a> - Xdebug-Proxy, der im Artikel behandelt wird; </li><li>  pydbgpproxy kann hier heruntergeladen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">werden</a> - pl√∂tzlich Python Remote Debugging Client; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">amphp</a> - asynchrones nicht blockierendes PHP-Framework; </li><li>  Werkzeuge f√ºr Mock-s: <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Soft-Mocks</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AspectMock</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">uopz</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Runkit</a> . </li></ul></li></ul><br><p>  Vielen Dank f√ºr Ihre Aufmerksamkeit! </p><br><p>  Ich freue mich √ºber Kommentare und Vorschl√§ge. </p><br><p>  Rinat Akhmadeev, Sr.  PHP-Entwickler </p><br><p>  <strong>UPD</strong> : Ver√∂ffentlichte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√úbersetzung des</a> Artikels ins Englische. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de442504/">https://habr.com/ru/post/de442504/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de442494/index.html">Figma-Komponente und Organisation von Instanzen am Beispiel von Userpic</a></li>
<li><a href="../de442496/index.html">Firmenschwein</a></li>
<li><a href="../de442498/index.html">Top 10 Berichte der C ++ Russia 2018 Konferenz: vollst√§ndige Videos, Folien, Kommentare</a></li>
<li><a href="../de442500/index.html">Detekt Static Analyzer f√ºr Kotlin</a></li>
<li><a href="../de442502/index.html">Wir verwandeln den Arbeitsplatz f√ºr 200 US-Dollar in ein Liegerad</a></li>
<li><a href="../de442506/index.html">Wird Russland f√ºr den illegalen Handel mit personenbezogenen Daten bestraft?</a></li>
<li><a href="../de442508/index.html">Wie udalenka die Innovation auf GitLab beschleunigt</a></li>
<li><a href="../de442512/index.html">Anpassung von Django ORM am Beispiel von ZomboDB</a></li>
<li><a href="../de442514/index.html">Verteilte Systeme. Entwurfsmuster. Buchbesprechung</a></li>
<li><a href="../de442516/index.html">Pandas Leitfaden zur Big Data-Analyse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>