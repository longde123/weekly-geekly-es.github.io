<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÑ üñêüèΩ ‚ö™Ô∏è Entendendo o c√≥digo gen√©tico dos criptoc√≥ticos üëäüèª üèä üèÇüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... e aprenda a trabalhar com as ferramentas de desenvolvedor Ethereum usando um exemplo da vida real. 

 Parte zero: o objeto apareceu 
 Acabei de te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Entendendo o c√≥digo gen√©tico dos criptoc√≥ticos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/wirex/blog/409345/">  ... e aprenda a trabalhar com as ferramentas de desenvolvedor Ethereum usando um exemplo da vida real. <br><br><h3>  Parte zero: o objeto apareceu </h3><br>  Acabei de terminar minhas palestras sobre o curso completo de desenvolvimento de aplicativos descentralizados baseados no Ethereum em Solidity em chin√™s.  Eu dei isso no meu tempo livre para aumentar o n√≠vel de conhecimento sobre blockchain e contratos inteligentes entre a comunidade chinesa de desenvolvedores.  Durante meu trabalho, fiz amizade com alguns alunos. <br><br>  E no final do curso, de repente nos encontramos cercados por essas criaturas: <br><br><img src="https://habrastorage.org/webt/ev/e-/ov/eve-ovga3bt6vx11ichn6jmkufm.png"><br><br>  <i>Imagem de cryptokitties.co</i> <br><br>  Como a maioria das pessoas que encontrou esse fen√¥meno, tamb√©m n√£o conseguimos resistir a essas cria√ß√µes fofas de criptografia e rapidamente nos tornamos viciadas no jogo.  Gost√°vamos de criar novos gatos e at√© substitu√≠mos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o m√©todo de patinho pelo m√©todo de cripto gato</a> .  Acredito que o v√≠cio em jogos seja ruim, mas n√£o neste caso, porque a paix√£o por criar gatinhos rapidamente nos levou √† pergunta: <br><br><h3>  Como certos gatos criptografados obt√™m seu conjunto de genes? </h3><br>  Decidimos dedicar o s√°bado √† noite para encontrar a resposta e achamos que conseguimos fazer algum progresso no desenvolvimento de software que nos permita determinar a muta√ß√£o gen√©tica de gatinhos cripto rec√©m-nascidos antes de nascerem.  Em outras palavras, este programa pode ajud√°-lo a verificar e determinar o tempo apropriado para a fertiliza√ß√£o da m√£e-gato e, assim, obter a muta√ß√£o mais interessante poss√≠vel. <br><br>  Publicamos este material na esperan√ßa de que sirva a todos como um artigo introdut√≥rio para se familiarizar com as ferramentas de desenvolvimento Ethereum muito √∫teis, assim como os pr√≥prios gatinhos de criptografia permitiram que muitas pessoas n√£o familiarizadas com o blockchain se unissem √†s fileiras de usu√°rios de criptomoedas. <a name="habracut"></a><br><br><h3>  Parte um: a l√≥gica de alto n√≠vel da gera√ß√£o de gatinhos </h3><br>  Para come√ßar, nos perguntamos: como √© o nascimento de gatinhos cripto? <br><br>  Para responder a essa pergunta, usamos o excelente condutor de blockchain Etherscan, que nos permite fazer muito mais do que apenas "estudar os par√¢metros e o conte√∫do dos blocos".  Ent√£o descobrimos o c√≥digo fonte do contrato CryptoKittiesCore: <br><br><img src="https://habrastorage.org/webt/co/od/v1/coodv1ao8ns32llhof2bhbpp3h8.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://etherscan.io/address/0x06012c8cf97bead5deae237070f9587f8e7a266d#code</a> <br><br>  Observe que o contrato expandido √© realmente um pouco diferente do usado no programa de recompensas.  De acordo com este c√≥digo, um filhote √© formado em duas etapas: 1) a m√£e gata √© fertilizada pelo gato;  2) um pouco mais tarde, quando o per√≠odo de matura√ß√£o do feto termina, a fun√ß√£o giveBirth √© chamada.  Essa fun√ß√£o geralmente √© chamada por um certo processo-dem√¥nio, mas, como voc√™ ver√° mais adiante, para obter muta√ß√µes interessantes, ser√° necess√°rio selecionar corretamente o bloco em que seu gatinho nasceu. <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">giveBirth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256 _matronId)</span></span></span><span class="hljs-function"> external whenNotPaused </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256)</span></span></span><span class="hljs-function"> </span></span>{ Kitty storage matron = kitties[_matronId]; <span class="hljs-comment"><span class="hljs-comment">// ,  - . require(matron.birthTime != 0); // ,       ! require(_isReadyToGiveBirth(matron)); //      -. uint256 sireId = matron.siringWithId; Kitty storage sire = kitties[sireId]; // ,         uint16 parentGen = matron.generation; if (sire.generation &gt; matron.generation) { parentGen = sire.generation; } //     . uint256 childGenes = geneScience.mixGenes(matron.genes, sire.genes, matron.cooldownEndBlock - 1);</span></span></code> </pre> <br>  No c√≥digo acima, voc√™ pode ver claramente que os genes de um gatinho rec√©m-nascido s√£o determinados no momento do nascimento, chamando a fun√ß√£o mixGenes do contrato inteligente externo de geneScience.  Essa fun√ß√£o usa tr√™s par√¢metros: o gene m√£e, o gene pai e o n√∫mero do bloco em que o gato estar√° pronto para dar √† luz. <br><br>  Voc√™ provavelmente ter√° uma pergunta l√≥gica: por que os genes n√£o s√£o determinados no momento da concep√ß√£o, como √© o caso no mundo real?  Como voc√™ ver√° no decorrer da narrativa subsequente, isso permite que voc√™ se defenda de maneira bastante elegante das tentativas de prever e decifrar genes.  Essa abordagem elimina a possibilidade de previs√£o 100% precisa dos genes dos gatinhos antes que o fato da gravidez entre m√£es e gatos seja registrado na blockchain.  E mesmo se voc√™ pudesse descobrir o c√≥digo exato respons√°vel pela mistura dos genes, isso n√£o lhe daria nenhuma vantagem. <br><br>  Seja como for, no come√ßo ainda n√£o sab√≠amos disso, ent√£o vamos continuar.  Agora precisamos descobrir o endere√ßo do contrato da geneScience.  Para fazer isso, use MyEtherWallet: <br><br> <a href=""><img src="https://habrastorage.org/webt/nf/fa/yl/nffaylnytgmybdkavya0so0ugmi.png"></a> <br><br>  <i>Endere√ßo do contrato GeneScience</i> <br><br>  √â assim que o bytecode do contrato se parece: <br><br><pre> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">0x60606040526004361061006c5763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630d9f5aed81146100715780631597ee441461009f57806354c15b82146100ee57806361a769001461011557806377a74a201461017e575b600080fd5b341561007c57600080fd5b61008d6004356024356044356101cd565b604051908152602001604051809</span></span>........</code> </pre> <br>  Pela apar√™ncia dele, voc√™ n√£o pode dizer que, como resultado, algo t√£o fofo quanto um gatinho aparece em tudo, mas temos muita sorte de que este seja um endere√ßo p√∫blico e n√£o precisamos procur√°-lo no reposit√≥rio).  De fato, acreditamos que n√£o deve ser t√£o facilmente acess√≠vel.  Se os desenvolvedores realmente quiserem garantir que o endere√ßo do contrato esteja correto, eles devem usar a fun√ß√£o checkScienceAddress, mas n√£o seremos incomodados. <br><br><h3>  Parte dois: o colapso de uma hip√≥tese simples </h3><br>  Ent√£o, o que queremos alcan√ßar no final?  Deve-se entender que n√£o estabelecemos o objetivo de compilar completamente o bytecode, transformando-o em um c√≥digo de solidez leg√≠vel por humanos.  Precisamos de um m√©todo barato (sem a necessidade de pagar por transa√ß√µes no blockchain de combate) para determinar os genes dos gatinhos, desde que saibamos quem s√£o seus pais.  √â isso que faremos. <br><br>  Para come√ßar, vamos usar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ferramenta opcode</a> Etherscan para uma an√°lise r√°pida.  √â assim: <br><br> <a href=""><img src="https://habrastorage.org/webt/m6/nt/72/m6nt72740bwhn4qz6dlkz0pc6qi.png"></a> <br><br>  <i>Muito mais claro</i> <br><br>  Seguimos a regra de ouro para decodificar o c√≥digo do assembler: come√ßamos com uma hip√≥tese simples e ousada sobre o comportamento do programa e, em vez de tentar entender seu trabalho como um todo, nos concentramos em confirmar a suposi√ß√£o feita.  Analisaremos o bytecode para responder a algumas perguntas: <br><br><ol><li>  Ele usa carimbos de data e hora?  N√£o, porque o c√≥digo de opera√ß√£o TIMESTAMP est√° ausente.  Se houver algum acidente simples, sua fonte √© definitivamente outro c√≥digo de opera√ß√£o. </li><li>  Um hash de bloco √© usado?  Sim, o BLOCKHASH ocorre duas vezes.  Portanto, a aleatoriedade, se houver, pode surgir de seus c√≥digos de opera√ß√£o, mas ainda n√£o temos certeza disso. </li><li>  Algum hashes √© usado?  Sim, existe o SHA3.  N√£o est√° claro, no entanto, o que ele est√° fazendo. </li><li>  O msg.sender √© usado?  N√£o, porque o c√≥digo de opera√ß√£o CALLER est√° ausente.  Portanto, nenhum controle de acesso √© aplicado ao contrato. </li><li>  Est√° sendo usado algum contrato externo?  N√£o, n√£o h√° c√≥digo de chamada CALL. </li><li>  O COINBASE √© usado?  N√£o, e, portanto, exclu√≠mos outra poss√≠vel fonte de aleatoriedade. </li></ol><br>  Tendo recebido a resposta para essas perguntas, apresentamos e pretendemos testar uma hip√≥tese simples: o resultado do mixGene √© determinado por tr√™s e apenas tr√™s par√¢metros de entrada dessa fun√ß√£o.  Se assim for, poder√≠amos simplesmente implantar esse contrato localmente, continuar chamando essa fun√ß√£o com os par√¢metros de interesse para n√≥s e, talvez, obtermos um kit de genes de gatinhos antes mesmo da fertiliza√ß√£o da m√£e-gato. <br><br>  Para verificar essa suposi√ß√£o, chamamos a fun√ß√£o mixGene na rede principal com tr√™s par√¢metros aleat√≥rios: 1111115, 80, 40 e obtemos algum resultado X. Em seguida, implante esse bytecode usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">trufa e testrpc</a> .  Portanto, nossa pregui√ßa levou a uma maneira um pouco fora do padr√£o de usar trufas. <br><br><pre> <code class="java hljs">contract GeneScienceSkeleton { <span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mixGenes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256 genes1, uint256 genes2, uint256 targetBlock)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint256)</span></span></span><span class="hljs-function"> </span></span>{} }</code> </pre> <br>  Come√ßamos com o esqueleto do contrato, colocamos na estrutura de pastas da estrutura de trufas e executamos a compila√ß√£o de trufas.  No entanto, em vez de migrar diretamente esse contrato vazio para o testrpc, substitu√≠mos o bytecode do contrato na pasta de constru√ß√£o pelo bytecode expandido real e pelo bytecode do contrato geneScience.  Essa √© uma maneira at√≠pica, mas r√°pida, se voc√™ deseja implantar um contrato com apenas bytecode e alguma interface aberta limitada para testes locais.  Depois disso, chamamos diretamente Mixgenes com os par√¢metros 1111115, 80, 40 e, infelizmente, obtemos um erro com a resposta reverter em resposta.  Ok, olhe mais fundo.  Como sabemos, a assinatura das fun√ß√µes mixGene √© 0x0d9f5aed; portanto, pegamos uma caneta e um papel e rastreamos a execu√ß√£o do bytecode, come√ßando no ponto de entrada dessa fun√ß√£o para explicar as altera√ß√µes na pilha e no armazenamento.  Ap√≥s alguns JUMPs, nos encontramos aqui: <br><br><pre> <code class="java hljs">[<span class="hljs-number"><span class="hljs-number">497</span></span>] DUP1 [<span class="hljs-number"><span class="hljs-number">498</span></span>] NUMBER [<span class="hljs-number"><span class="hljs-number">499</span></span>] DUP14 [<span class="hljs-number"><span class="hljs-number">500</span></span>] SWAP1 [<span class="hljs-number"><span class="hljs-number">501</span></span>] GT [<span class="hljs-number"><span class="hljs-number">504</span></span>] PUSH2 <span class="hljs-number"><span class="hljs-number">0x01fe</span></span> [<span class="hljs-number"><span class="hljs-number">505</span></span>] JUMPI [<span class="hljs-number"><span class="hljs-number">507</span></span>] PUSH1 <span class="hljs-number"><span class="hljs-number">0x00</span></span> [<span class="hljs-number"><span class="hljs-number">508</span></span>] DUP1 [<span class="hljs-number"><span class="hljs-number">509</span></span>] <span class="hljs-string"><span class="hljs-string">'fd'</span></span>(Unknown Opcode)</code> </pre> <br>  A julgar pelo conte√∫do dessas linhas, se o n√∫mero do bloco atual for menor que o terceiro par√¢metro, revert () ser√° chamado.  Bem, esse √© um comportamento bastante razo√°vel: chamar uma fun√ß√£o real em um jogo com um n√∫mero de bloco do futuro √© imposs√≠vel e isso √© l√≥gico. <br><br>  √â f√°cil contornar essa verifica√ß√£o de entrada: n√≥s apenas extra√≠mos alguns blocos no testrpc e chamamos a fun√ß√£o novamente.  Desta vez, a fun√ß√£o retorna Y com √™xito. <br><br>  Mas infelizmente X! = Y <br><br>  Que pena.  Isso significa que o resultado da execu√ß√£o da fun√ß√£o depende n√£o apenas dos par√¢metros de entrada, mas tamb√©m do estado do blockchain da rede principal, que, √© claro, difere do estado do falso blockchain testrpc. <br><br><h3>  Parte Tr√™s: arrega√ßar as mangas e cavar a pilha </h3><br>  Ok.  Ent√£o √© hora de arrega√ßar as mangas.  O papel n√£o √© mais adequado para rastrear o status da pilha.  Portanto, para um trabalho mais s√©rio, lan√ßaremos um desmontador EVM muito √∫til chamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">evmdis</a> . <br><br>  Comparado ao papel e caneta, este √© um passo tang√≠vel √† frente.  Vamos continuar com o que paramos no √∫ltimo cap√≠tulo.  A seguir, uma conclus√£o encorajadora com o evmdis: <br><br><pre> <code class="java hljs">............. :label22 # Stack: [@<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x88</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x1EB</span></span> PUSH(<span class="hljs-number"><span class="hljs-number">0x0</span></span>) <span class="hljs-number"><span class="hljs-number">0x1ED</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1EE</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1EF</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1F0</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1F1</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1F3</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x1F9</span></span> JUMPI(:label23, NUMBER() &gt; POP()) # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x88</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x1FA</span></span> PUSH(<span class="hljs-number"><span class="hljs-number">0x0</span></span>) <span class="hljs-number"><span class="hljs-number">0x1FC</span></span> DUP1 <span class="hljs-number"><span class="hljs-number">0x1FD</span></span> REVERT() :label23 # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x88</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x1FF</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x200</span></span> PUSH(BLOCKHASH(POP())) <span class="hljs-number"><span class="hljs-number">0x201</span></span> SWAP11 <span class="hljs-number"><span class="hljs-number">0x202</span></span> POP() <span class="hljs-number"><span class="hljs-number">0x203</span></span> DUP11 <span class="hljs-number"><span class="hljs-number">0x209</span></span> JUMPI(:label25, !!POP()) # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x200</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x88</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x20C</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x213</span></span> PUSH((NUMBER() &amp; ~<span class="hljs-number"><span class="hljs-number">0xFF</span></span>) + (POP() &amp; <span class="hljs-number"><span class="hljs-number">0xFF</span></span>)) <span class="hljs-number"><span class="hljs-number">0x214</span></span> SWAP13 <span class="hljs-number"><span class="hljs-number">0x215</span></span> POP() <span class="hljs-number"><span class="hljs-number">0x217</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x21E</span></span> JUMPI(:label24, !!(POP() &lt; NUMBER())) # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x200</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x213</span></span> @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x222</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x223</span></span> PUSH(POP() - <span class="hljs-number"><span class="hljs-number">0x100</span></span>) <span class="hljs-number"><span class="hljs-number">0x224</span></span> SWAP13 <span class="hljs-number"><span class="hljs-number">0x225</span></span> POP() :label24 # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x200</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> [@<span class="hljs-number"><span class="hljs-number">0x223</span></span> | @<span class="hljs-number"><span class="hljs-number">0x213</span></span>] @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x227</span></span> DUP13 <span class="hljs-number"><span class="hljs-number">0x228</span></span> PUSH(BLOCKHASH(POP())) <span class="hljs-number"><span class="hljs-number">0x229</span></span> SWAP11 <span class="hljs-number"><span class="hljs-number">0x22A</span></span> POP() :label25 # Stack: [<span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> @<span class="hljs-number"><span class="hljs-number">0x70E</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> [@<span class="hljs-number"><span class="hljs-number">0x200</span></span> | @<span class="hljs-number"><span class="hljs-number">0x228</span></span>] <span class="hljs-number"><span class="hljs-number">0x0</span></span> [@<span class="hljs-number"><span class="hljs-number">0x88</span></span> | @<span class="hljs-number"><span class="hljs-number">0x223</span></span> | @<span class="hljs-number"><span class="hljs-number">0x213</span></span>] @<span class="hljs-number"><span class="hljs-number">0x85</span></span> @<span class="hljs-number"><span class="hljs-number">0x82</span></span> :label3 @<span class="hljs-number"><span class="hljs-number">0x34</span></span>] <span class="hljs-number"><span class="hljs-number">0x22C</span></span> DUP11 <span class="hljs-number"><span class="hljs-number">0x22D</span></span> DUP16 <span class="hljs-number"><span class="hljs-number">0x22E</span></span> DUP16 ...........</code> </pre> <br>  O que evmdis realmente serve √© a sua utilidade para analisar o JUMPDEST nos r√≥tulos corretos, que n√£o podem ser superestimados. <br><br>  Ent√£o, depois de passarmos o requisito inicial, nos encontramos no r√≥tulo 23. Vemos o DUP13 e lembramos do cap√≠tulo anterior que o n√∫mero 13 na pilha √© nosso terceiro par√¢metro.  Ent√£o, estamos tentando obter o BLOCKHASH do nosso terceiro par√¢metro.  No entanto, a a√ß√£o do BLOCKHASH √© limitada a 256 blocos.  √â por isso que √© seguido por JUMPI (este √© um construto if).  Se traduzirmos a l√≥gica dos opcodes no idioma do pseudo-c√≥digo, obteremos algo assim: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">blockhash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentBlockNumber - p &lt; <span class="hljs-number"><span class="hljs-number">256</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash(p); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bhash = blockhash(thrid); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bhash == <span class="hljs-number"><span class="hljs-number">0</span></span>) { thirdProjection = (currentBlockNumber &amp; ~<span class="hljs-number"><span class="hljs-number">0xff</span></span>) + (thridParam &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (thirdProjection &gt; currentBlockNumber) { thirdProjection -= <span class="hljs-number"><span class="hljs-number">256</span></span>; } thirdParam = thirdProjection; bhash = blockhash(thirdProjection); } label <span class="hljs-number"><span class="hljs-number">25</span></span> and beyond ..... some more stuff related to thirdParam and bhash</code> </pre> <br>  mais algumas coisas relacionadas ao thirdParam e ao bhash - outro c√≥digo relacionado ao thirdParam e ao hash do bloco <br><br>  Agora acreditamos ter encontrado uma raz√£o pela qual nossos resultados diferem daqueles que observamos na rede principal.  Mais importante, aparentemente conseguimos descobrir a fonte do acaso.  A saber: o hash do bloco √© calculado com base no terceiro par√¢metro ou na <i>previs√£o do</i> terceiro par√¢metro.  √â importante observar que na pilha o terceiro par√¢metro tamb√©m √© substitu√≠do por esse n√∫mero de bloco previsto. <br><br>  Obviamente, durante a execu√ß√£o local fora da rede principal, n√£o temos uma op√ß√£o simples para impor um retorno BLOCKHASH que corresponda aos valores da rede principal.  Seja como for, como sabemos todos os tr√™s par√¢metros, podemos monitorar facilmente a rede principal e obter o hash do bloco H para o terceiro par√¢metro, bem como o hash do bloco previsto. <br><br>  Em seguida, podemos inserir esse hash diretamente no c√≥digo de bytes em nosso ambiente de teste local e, se tudo correr conforme o planejado, finalmente obteremos o conjunto correto de genes. <br><br>  Mas existe um problema: DUP13 e BLOCKHASH s√£o apenas 2 bytes no c√≥digo e, se os substituirmos por PUSH32 0x * hash * de 33 bytes, o contador do programa mudar√° completamente e precisaremos corrigir cada JUMP e JUMPI.  Ou teremos que fazer JUMP no final do c√≥digo e substituir as instru√ß√µes para o c√≥digo implantado, e assim por diante. <br><br>  Bem, desde que chegamos at√© aqui, cheiraremos um pouco mais.  Como inserimos o hash diferente de zero de 32 bytes na ramifica√ß√£o if, a condi√ß√£o sempre ser√° verdadeira e, portanto, tudo escrito na parte else pode ser simplesmente descartado para dar espa√ßo ao hash de 32 bytes.  Bem, em geral, foi o que fizemos: <br><br> <a href=""><img src="https://habrastorage.org/webt/n1/xx/-x/n1xx-xl6ew1nlx-xjwzkgtk90cs.png"></a> <br><br>  O ponto principal √© que, uma vez que abandonamos a outra parte da condi√ß√£o, precisamos substituir o terceiro par√¢metro de entrada da fun√ß√£o mixGene pela previs√£o do terceiro par√¢metro antes de cham√°-lo. <br><br>  Isso √© o ponto que, se voc√™ est√° tentando obter o resultado de uma opera√ß√£o <br>  mixGene (X, Y, Z), onde currentBlockNumber √© Z &lt;256, voc√™ s√≥ precisa substituir o hash PUSH32 pelo hash do bloco Z. <br>  No entanto, se voc√™ pretende fazer o seguinte <br>  mixGene (X, Y, Z), onde currentBlockNumber √© Z ‚â• 256, ser√° necess√°rio substituir o hash PUSH32 pelo hash do bloco proj_Z, em que proj_Z √© definido da seguinte forma: <br><br><pre> <code class="java hljs">proj_Z = (currentBlockNumber &amp; ~<span class="hljs-number"><span class="hljs-number">0xff</span></span>) + (Z &amp; <span class="hljs-number"><span class="hljs-number">0xff</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (proj_Z &gt; currentBlockNumber) { proj_Z -= <span class="hljs-number"><span class="hljs-number">256</span></span>; } &lt;b&gt;    Z  proj_Z   ,   mixGene(X, Y, proj_Z).&lt;/b&gt;</code> </pre> <br>  Observe que o proj_Z permanecer√° inalterado em um determinado intervalo de blocos.  Por exemplo, se Z &amp; 0xff = 128, o proj_Z muda apenas em cada bloco zero e 128¬∫. <br><br>  Para confirmar esta hip√≥tese e verificar se existem armadilhas √† frente, alteramos o bytecode e usamos outro utilit√°rio interessante chamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hevm</a> . <br><br> <a href=""><img src="https://habrastorage.org/webt/ey/d5/cx/eyd5cxlyauklees28j70widdisg.png"></a> <br><br>  Se voc√™ nunca usou o hevm, recomendo que experimente.  A ferramenta est√° dispon√≠vel junto com sua pr√≥pria estrutura, mas acima de tudo em seu conjunto, deve-se notar uma coisa indispens√°vel como um depurador de pilha interativo. <br><br><pre> <code class="java hljs">Usage: hevm exec --code TEXT [--calldata TEXT] [--address ADDR] [--caller ADDR] [--origin ADDR] [--coinbase ADDR] [--value W256] [--gas W256] [--number W256] [--timestamp W256] [--gaslimit W256] [--gasprice W256] [--difficulty W256] [--debug] [--state STRING] Available options: -h,--help</code> </pre> <br>  Acima est√£o as op√ß√µes de lan√ßamento.  O utilit√°rio permite que voc√™ especifique uma variedade de par√¢metros.  Entre eles est√° o --debug, que oferece a capacidade de depurar interativamente. <br><br>  Ent√£o, aqui fizemos v√°rias chamadas para o contrato de geneScience implantado na blockchain da rede principal e registramos os resultados.  Em seguida, usamos o hevm para executar nosso bytecode quebrado com dados preparados levando em conta as regras descritas acima e ... <br><br>  Os resultados s√£o os mesmos! <br><br><h3>  O √∫ltimo cap√≠tulo: conclus√£o e continua√ß√£o do trabalho (?) </h3><br>  Ent√£o, o que conseguimos alcan√ßar? <br><br>  Usando nosso software de hackers, voc√™ pode ter 100% de chance de prever um gene de 256 bits para um gatinho rec√©m-nascido se ele nascer na faixa de blocos [coolDownEndBlock (quando o beb√™ estiver pronto para aparecer), o bloco atual ser√° + 256 (aproximadamente)].  Voc√™ pode argumentar sobre isso da seguinte maneira: quando o beb√™ est√° no √∫tero da m√£e, seus genes sofrem muta√ß√µes ao longo do tempo, devido √† fonte de entropia na forma de um hash do bloco coolDownEndBlock previsto, que tamb√©m muda com o tempo.  Portanto, voc√™ pode usar este programa para verificar a apar√™ncia do gene do beb√™ se ele nasceu agora.  E se voc√™ n√£o gosta deste gene, pode esperar cerca de 256 blocos a mais (em m√©dia) e verificar o novo gene. <br><br>  Algu√©m pode dizer que isso n√£o √© suficiente, j√° que apenas 100% de precis√£o da previs√£o pode ser considerada um hacking ideal antes mesmo da gravidez de uma m√£e gata.  No entanto, isso n√£o √© poss√≠vel, j√° que o gene do gatinho √© determinado n√£o apenas pelos genes de seus pais, mas tamb√©m pelo hash previsto do bloco como um fator de muta√ß√£o, que simplesmente n√£o pode ser conhecido antes da fertiliza√ß√£o. <br><br>  O que pode ser melhorado e quais s√£o as nuances aqui? <br><br>  Examinamos rapidamente as altera√ß√µes que ocorrem na pilha na parte l√≥gica real do contrato inteligente (etiqueta 25 e tudo depois) e acreditamos que essa parte previs√≠vel do c√≥digo mixGene deve ser analisada e estudada.  Esperamos que o hash do bloco como fator de muta√ß√£o tamb√©m tenha algum significado f√≠sico, ajudando, por exemplo, a determinar qual gene deve ser mutado.  Se conseguirmos descobrir isso, obteremos o gene original, sem muta√ß√µes.  Isso √© √∫til porque, se voc√™ n√£o possui um bom gene fonte, mesmo a melhor muta√ß√£o pode n√£o ser suficiente. <br><br>  Tamb√©m n√£o medimos a correla√ß√£o entre o gene de 256 bits e as caracter√≠sticas do gatinho (cor dos olhos, tipo de cauda, ‚Äã‚Äãetc.), mas acreditamos que isso √© bem poss√≠vel com a ajuda de um bot de alto desempenho e um classificador simples. <br><br>  E, em geral, entendemos perfeitamente a inten√ß√£o da equipe de desenvolvimento do CryptoKitties de estabilizar a muta√ß√£o por um curto per√≠odo de tempo.  Mas o outro lado dessa abordagem √© a capacidade de realizar uma an√°lise como fizemos. <br><br>  Tamb√©m gostar√≠amos de agradecer √† maravilhosa comunidade ethereum por desenvolver ferramentas como Etherscan, hevm, evmdis, trufa, testrpc, myetherwallet e Solidity.  Esta √© uma comunidade muito legal e estamos felizes em fazer parte dela. <br><br>  E, finalmente, o c√≥digo modificado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/modong/GeneScienceCracked/</a> <br><br>  Lembre-se de alterar $ CONSTBLOCKHASH $ para o hash do bloco previsto. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/files/4bd/bf6/597/4bdbf659775744b1bdbb4d8a00a0a980.png" alt="imagem"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt409345/">https://habr.com/ru/post/pt409345/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt409335/index.html">Cientistas de Cambridge criaram um mod para o Civilization V com a implementa√ß√£o do cen√°rio para o desenvolvimento de uma IA forte</a></li>
<li><a href="../pt409337/index.html">Usando VR, AR e MR em simula√ß√µes e treinamento</a></li>
<li><a href="../pt409339/index.html">Vis√£o geral do DVR com informador GPS AdvoCam-FD Black-II GPS + GLONASS</a></li>
<li><a href="../pt409341/index.html">Desenvolvimento de uma unidade de controle eletr√¥nico para a lavadora Oriole</a></li>
<li><a href="../pt409343/index.html">Presentes de Ano Novo, parte tr√™s: se nos comportamos bem</a></li>
<li><a href="../pt409347/index.html">O aplicativo Haven para Android de Edward Snowden protege objetos f√≠sicos</a></li>
<li><a href="../pt409349/index.html">Voc√™ precisa de uma caneca ‚Äúinteligente‚Äù ou de uma forma bastante comum, ou da rapidez com que o caf√© esfria</a></li>
<li><a href="../pt409351/index.html">O espa√ßo russo explodir√° em 2018?</a></li>
<li><a href="../pt409355/index.html">Quanto deve custar o Bitcoin?</a></li>
<li><a href="../pt409357/index.html">Esta√ß√µes de trabalho Dell: para tarefas criativas e extrema produtividade</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>