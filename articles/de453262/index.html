<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè∫ üî¶ üòø Wo sind Ihre Konstanten auf dem CortexM-Mikrocontroller gespeichert (am Beispiel des C ++ IAR-Compilers)? üèáüèæ üìé üõéÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich bringe meinen Sch√ºlern den Umgang mit dem Mikrocontroller STM32F411RE bei, an dessen Bord sich bis zu 512 kB ROM und 128 kB RAM befinden 
 Normale...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wo sind Ihre Konstanten auf dem CortexM-Mikrocontroller gespeichert (am Beispiel des C ++ IAR-Compilers)?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453262/">  Ich bringe meinen Sch√ºlern den Umgang mit dem Mikrocontroller STM32F411RE bei, an dessen Bord sich bis zu 512 kB ROM und 128 kB RAM befinden <br>  Normalerweise wird auf diesem Mikrocontroller ein Programm in den <u>ROM-</u> Speicher geschrieben, und im <u>RAM sind die</u> zu <u>√§ndernden</u> Daten sehr oft erforderlich, um die Konstanten im <u>ROM</u> zu erstellen. <br>  Im STM32F411RE, <u>ROM-</u> Mikrocontroller, befindet sich der Speicher an Adressen mit <i>0x08000000 ... 0x0807FFFF</i> und <u>RAM</u> mit <i>0x20000000 ... 0x2001FFFF.</i> <br><br>  Und wenn alle Linker-Einstellungen korrekt sind, berechnet der Sch√ºler, dass in einem so einfachen Code seine Konstante im <u>ROM</u> liegt: <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WantToBeInROM</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: WantToBeInROM(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): i(value) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i; } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> WantToBeInROM </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myConstInROM</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; &amp;myConstInROM &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> ; }</code> </pre> <br>  Sie k√∂nnen auch versuchen, die Frage zu beantworten: Wo befindet sich die Konstante myConstInROM im <u>ROM</u> oder im <u>RAM</u> ? <br><br>  Wenn Sie diese Frage im <u>ROM</u> beantwortet haben, gratuliere ich Ihnen, wahrscheinlich liegt die Konstante im Allgemeinen im <u>RAM,</u> und um herauszufinden, wie Sie Ihre Konstanten korrekt und korrekt im <u>ROM platzieren k√∂nnen</u> - willkommen bei cat. <br><a name="habracut"></a><br><h3>  Einf√ºhrung </h3><br>  Zun√§chst ein kleiner Exkurs, warum sollte man sich √ºberhaupt darum k√ºmmern? <br>  Bei der Entwicklung sicherheitskritischer Software f√ºr Messger√§te, die IEC 61508-3: 2010 oder einem inl√§ndischen √Ñquivalent von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GOST IEC 61508-3-2018 entsprechen</a> , muss eine Reihe von Punkten ber√ºcksichtigt werden, die f√ºr herk√∂mmliche Software nicht kritisch sind. <br><br>  <i>Die Hauptbotschaft dieses Standards lautet, dass die Software jeden Fehler erkennen muss, der die Zuverl√§ssigkeit des Systems beeintr√§chtigt, und das System in den "Absturz" -Modus versetzen muss</i> <br><br>  Zus√§tzlich zu offensichtlichen mechanischen Fehlern, z. B. Sensorausfall oder -verschlechterung und Ausfall elektronischer Komponenten, sollten Fehler erkannt werden, die durch den Ausfall der Softwareumgebung verursacht werden, z. B. <u>RAM-</u> oder <u>ROM-</u> Mikrocontroller. <br><br>  Und wenn es in den ersten beiden F√§llen m√∂glich ist, einen Fehler nur auf ziemlich verwirrte indirekte Weise zu erkennen (es gibt Algorithmen, die den Sensorausfall bestimmen, beispielsweise eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Methode zur Beurteilung des Zustands eines Widerstandsthermokonverters</a> ), kann dies im Falle eines Softwareumgebungsausfalls viel einfacher durchgef√ºhrt werden, beispielsweise kann ein Speicherfehler sein √úberpr√ºfen Sie dies durch eine einfache √úberpr√ºfung der Datenintegrit√§t.  Wenn die Integrit√§t der Daten verletzt wird, interpretieren Sie dies als Speicherfehler. <br><br>  Wenn die Daten f√ºr eine lange Zeit im RAM liegen, ohne sie zu √ºberpr√ºfen und zu aktualisieren, steigt die Wahrscheinlichkeit, dass ihnen aufgrund eines <u>RAM-</u> Fehlers etwas passiert, mit der Zeit.  Ein Beispiel sind einige Kalibrierungskoeffizienten zur Berechnung der Temperatur, die werkseitig eingestellt und in ein externes EEPROM geschrieben wurden. Beim Start werden sie gelesen und in den <u>RAM geschrieben</u> und sind dort, bis die Stromversorgung ausgeschaltet wird.  Im Leben kann der Temperatursensor √ºber den gesamten Zeitraum des Interkalibrierungsintervalls bis zu 3-5 Jahre arbeiten.  Offensichtlich m√ºssen solche <u>RAM-</u> Daten gesch√ºtzt und regelm√§√üig auf ihre Integrit√§t √ºberpr√ºft werden. <br><br>  Es gibt aber auch Daten, wie eine Konstante, die nur zur besseren Lesbarkeit deklariert wurde, ein Objekt eines LCD-Treibers, SPI oder I2C, das nicht ge√§ndert werden sollte, einmal erstellt und erst nach dem Ausschalten gel√∂scht werden. <br><br>  Diese Daten werden am besten im <u>ROM</u> gespeichert.  Es ist aus technologischer Sicht zuverl√§ssiger und viel einfacher zu √ºberpr√ºfen. Es reicht aus, die Pr√ºfsumme des gesamten Nur-Lese-Speichers in einer Aufgabe mit niedriger Priorit√§t regelm√§√üig zu lesen.  Wenn die Pr√ºfsumme nicht √ºbereinstimmt, k√∂nnen Sie einfach den <u>ROM-</u> Fehler melden und das Diagnosesystem zeigt einen Unfall an. <br><br>  Wenn diese Daten im <u>RAM liegen</u> , w√§re es problematisch oder sogar unm√∂glich, ihre Integrit√§t zu bestimmen, da nicht klar ist, wo sich die unver√§nderlichen Daten im RAM befinden und wo sie ver√§nderbar sind. Der Linker platziert sie wie gew√ºnscht und sch√ºtzt jedes RAM-Objekt mit einer Pr√ºfsumme Paranoia. <br><br>  Daher ist es am einfachsten, 100% sicher zu sein, dass sich die konstanten Daten im <u>ROM befinden</u> .  Wie das geht, m√∂chte ich versuchen zu erkl√§ren.  Aber zuerst m√ºssen Sie √ºber die Organisation des Speichers in ARM sprechen. <br><br><h3>  Speicherorganisation </h3><br>  Wie Sie wissen, verf√ºgt der ARM-Kern √ºber eine Harvard-Architektur - die Daten- und Codebusse sind getrennt.  Normalerweise bedeutet dies, dass angenommen wird, dass es einen separaten Speicher f√ºr Programme und einen separaten Speicher f√ºr Daten gibt.  Tatsache ist jedoch, dass ARM eine modifizierte Harvard-Architektur ist, d.h.  Der Zugriff auf den Speicher erfolgt √ºber einen Bus, und die Speicherverwaltungsvorrichtung bietet bereits die Trennung von Bussen mithilfe von Steuersignalen: Lesen, Schreiben oder Ausw√§hlen eines Speicherbereichs. <br><br>  Somit k√∂nnen sich Daten und Code im selben Speicherbereich befinden.  In diesem einzelnen Adressraum k√∂nnen sich <u>ROM-</u> Speicher sowie <u>RAM</u> und Peripherieger√§te befinden.  Und das bedeutet, dass sowohl der Code als auch die Daten auch dort ankommen k√∂nnen, wo es vom Compiler und Linker abh√§ngt. <br><br>  Um zwischen den Speicherbereichen f√ºr <u>ROM (Flash)</u> und <u>RAM zu unterscheiden, werden</u> diese normalerweise in den Linker-Einstellungen angezeigt, z. B. in IAR 8.40.1 sieht dies folgenderma√üen aus: <br><br><pre> <code class="cpp hljs">define symbol __ICFEDIT_region_ROM_start__ = <span class="hljs-number"><span class="hljs-number">0x08000000</span></span>; define symbol __ICFEDIT_region_ROM_end__ = <span class="hljs-number"><span class="hljs-number">0x0807FFFF</span></span>; define symbol __ICFEDIT_region_RAM_start__ = <span class="hljs-number"><span class="hljs-number">0x20000000</span></span>; define symbol __ICFEDIT_region_RAM_end__ = <span class="hljs-number"><span class="hljs-number">0x2001FFFF</span></span>; define region ROM_region = mem:[from __ICFEDIT_region_ROM_start__ to __ICFEDIT_region_ROM_end__]; define region RAM_region = mem:[from __ICFEDIT_region_RAM_start__ to __ICFEDIT_region_RAM_end__];</code> </pre><br>  <u>Der RAM</u> in diesem Mikrocontroller befindet sich bei <i>0x20000000 ... 0x2001FFF</i> und der <u>ROM</u> bei <i>0x008000000 ... 0x0807FFFF</i> . <br>  Sie k√∂nnen die Startadresse ROM_start einfach in die RAM-Adresse √§ndern, z. B. RAM_start und die Endadresse ROM_end__ in RAM_end__, und Ihr Programm befindet sich vollst√§ndig im RAM. <br>  Sie k√∂nnen sogar das Gegenteil tun und <u>RAM</u> im <u>ROM-</u> Speicherbereich angeben, und Ihr Programm wird erfolgreich zusammengestellt und geflasht, obwohl es nicht funktioniert :) <br>  Einige Mikrocontroller, wie z. B. AVR, verf√ºgen zun√§chst √ºber einen separaten Adressraum f√ºr Programmspeicher, Datenspeicher und Peripherieger√§te. Daher funktionieren solche Tricks dort nicht, und das Programm wird standardm√§√üig in das <u>ROM</u> geschrieben. <br><br><blockquote>  Der gesamte Adressraum in CortexM ist einzeln, und Code und Daten k√∂nnen sich √ºberall befinden.  Mit den Linker-Einstellungen k√∂nnen Sie die Region f√ºr die <u>ROM-</u> und <u>RAM-</u> Adressen festlegen.  IAR <i>lokalisiert das Textcodesegment</i> im <u>ROM-</u> Bereich </blockquote><br><h3>  Objektdatei und Segmente </h3><br>  Oben habe ich das Codesegment erw√§hnt. Mal sehen, was es ist. <br><br>  F√ºr jedes kompilierte Modul wird eine separate Objektdatei erstellt, die die folgenden Informationen enth√§lt: <br><br><ul><li>  Code- und Datensegmente </li><li>  DWARF-Debugging-Informationen </li><li>  Zeichentabelle </li></ul><br>  Wir interessieren uns f√ºr Code- und <i>Datensegmente</i> .  <i>Ein Segment</i> ist ein solches Element, das einen Code oder Daten enth√§lt, die an einer physischen Adresse im Speicher abgelegt werden m√ºssen.  Ein Segment kann mehrere Fragmente enthalten, normalerweise ein Fragment f√ºr jede Variable oder Funktion.  Ein Segment kann sowohl im <u>ROM</u> als auch im <u>RAM platziert werden</u> . <br>  Jedes Segment hat einen Namen und ein Attribut, das seinen Inhalt definiert.  Das Attribut wird verwendet, um ein Segment in der Konfiguration f√ºr den Linker zu definieren.  Zum Beispiel k√∂nnen Attribute sein: <br><br><ul><li>  Code - ausf√ºhrbarer Code </li><li>  schreibgesch√ºtzt - konstante Variablen </li><li>  readwrite - initialisierte Variablen </li><li>  zeroinit - nullinitialisierte Variablen </li></ul><br>  Nat√ºrlich gibt es andere Arten von Segmenten, zum Beispiel Segmente, die Debugging-Informationen enthalten, aber wir werden nur an solchen interessiert sein, die Code oder Daten aus unserer Anwendung enthalten. <br><br>  Im Allgemeinen ist ein Segment der kleinste verkn√ºpfbare Block.  Bei Bedarf kann der Linker jedoch auch noch kleinere Bl√∂cke (Fragmente) anzeigen.  Wir werden diese Option nicht in Betracht ziehen, wir werden uns mit Segmenten befassen. <br><br>  W√§hrend der Kompilierung werden Daten und Funktionen in verschiedenen Segmenten platziert.  W√§hrend der Verkn√ºpfung weist der Linker verschiedenen Segmenten echte physische Adressen zu.  Der IAR-Compiler verf√ºgt √ºber vordefinierte Segmentnamen, von denen einige im Folgenden aufgef√ºhrt werden: <br><br><ul><li>  <i>.bss</i> - Enth√§lt statische und globale Variablen, die auf 0 initialisiert wurden </li><li>  <i>.CSTACK</i> - Enth√§lt den vom Programm verwendeten Stapel </li><li>  <i>.data</i> - Enth√§lt statische und global initialisierte Variablen </li><li>  <i>.data_init</i> - Enth√§lt die Anfangswerte f√ºr die Daten im Abschnitt .data, wenn die Initialisierungsanweisung f√ºr den Linker verwendet wird </li><li>  <i>HEAP</i> - Enth√§lt den Heap, der zum <i>Hosten</i> dynamischer Daten verwendet wird </li><li>  <i>.intvec</i> - Enth√§lt eine Interrupt- <i>Vektortabelle</i> </li><li>  <i>.rodata</i> - Enth√§lt konstante Daten </li><li>  <i>.text</i> - Enth√§lt Programmcode </li></ul><br>  Um zu verstehen, wo sich die Konstanten befinden, werden wir uns nur f√ºr Segmente interessieren <br>  <i>.rodata</i> - ein Segment, in dem Konstanten gespeichert sind, <br>  <i>.data</i> - ein Segment, in dem alle initialisierten statischen und globalen Variablen gespeichert sind. <br>  <i>.bss</i> - ein Segment, in dem alle statischen und globalen <i>.data-</i> Variablen gespeichert sind, die mit Null (0) initialisiert wurden. <br>  <i>.text</i> - ein Segment zum Speichern von Code. <br><br>  In der Praxis bedeutet dies, dass, wenn Sie die Variable <code>int val = 3</code> , die Variable selbst vom Compiler im <i>.data-</i> Segment <i>lokalisiert</i> und mit dem <i>readwrite-</i> Attribut markiert wird. Die Nummer 3 kann entweder im <i>.text-</i> Segment oder im <i>.rodata-</i> Segment oder, wenn, platziert werden Eine spezielle Direktive f√ºr den Linker in <i>.data_init wird angewendet</i> und auch von dieser als <i>schreibgesch√ºtzt</i> markiert. <br><br>  Das <i>.rodata-</i> Segment enth√§lt konstante Daten und enth√§lt konstante Variablen, Zeichenfolgen, aggregierte Literale usw.  Und <u><b>dieses Segment kann √ºberall im Speicher abgelegt werden.</b></u> <br><br>  Jetzt wird klarer, was in den Linker-Einstellungen vorgeschrieben ist und warum: <br><br><pre> <code class="cpp hljs">place in ROM_region { readonly }; <span class="hljs-comment"><span class="hljs-comment">//   .rodata  .data_init (  )  ROM: place in RAM_region { readwrite, //   .data, .bss,  .noinit block STACK }; //  STACK  HEAP  RAM</span></span></code> </pre><br>  Das hei√üt, alle mit dem Attribut <i>readonly</i> gekennzeichneten Daten sollten in ROM_region abgelegt werden.  Somit k√∂nnen Daten aus verschiedenen Segmenten, die jedoch mit dem Attribut readonly gekennzeichnet sind, in das ROM gelangen. <br><br><div class="spoiler">  <b class="spoiler_title">Nun, das bedeutet, dass alle Konstanten im ROM sein m√ºssen, aber warum liegt in unserem Code am Anfang des Artikels das konstante Objekt immer noch im RAM?</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WantToBeInROM</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: WantToBeInROM(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): i(value) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i; } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> WantToBeInROM </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myConstInROM</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; &amp;myConstInROM &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> ; }</code> </pre><br></div></div><br><br><h3>  Konstante Daten </h3><br>  Bevor wir die Situation kl√§ren, erinnern wir uns zun√§chst daran, dass globale Variablen im gemeinsamen Speicher erstellt werden, lokale Variablen, d. H.  Variablen, die in "normalen" Funktionen deklariert sind, werden auf dem Stapel oder in Registern erstellt, und statische lokale Variablen werden auch im gemeinsam genutzten Speicher erstellt. <br><br>  Was bedeutet das in C ++?  Schauen wir uns ein Beispiel an: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; C1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; C2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; C3, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; C4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; C5, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; C6)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; C1 &lt;&lt; C2 &lt;&lt; C3 &lt;&lt; C4 &lt;&lt; C5 &lt;&lt; C6 &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//     constexpr int Case1 = 1 ; //  (      ) const int Case2 = 2; int main() { //  . const int Case3 = 3 ; // . static const int Case4 = 4 ; //      ,     . constexpr int Case5 = Case1 + 5 ; //     . static constexpr int Case6 = 6 ; foo(Case1,Case2,Case3,Case4,Case5,Case6); return 1; }</span></span></code> </pre><br>  Dies sind alles konstante Daten.  F√ºr jeden von ihnen gilt jedoch die oben beschriebene Erstellungsregel. Lokale Variablen werden auf dem Stapel erstellt.  Daher sollte es mit unseren Linker-Einstellungen folgenderma√üen aussehen: <br><br><ul><li>  Die globale Konstante von Fall1 muss sich im <u>ROM befinden</u> .  Im Segment .rodata </li><li>  Die globale Konstante von Case2 muss sich im <u>ROM befinden</u> .  Im Segment .rodata </li><li>  Die lokale Konstante von Fall 3 muss im <u>RAM</u> liegen (die Konstante wurde auf dem Stapel im STACK-Segment erstellt). </li><li>  Die statische Konstante von Case4 muss sich im <u>ROM befinden</u> .  Im Segment .rodata </li><li>  Die lokale Konstante von Fall 5 muss im <u>RAM</u> liegen (ein interessanter Fall, der jedoch genau mit Fall 3 identisch ist). </li><li>  Die statische Konstante von Case6 muss sich im <u>ROM befinden</u> .  Im Segment .rodata </li></ul><br>  Schauen wir uns nun die Debugging-Informationen und die generierte Map-Datei an.  Der Debugger zeigt an, an welchen Adressen sich diese Konstanten befinden. <br><br><img src="https://habrastorage.org/webt/n_/x9/at/n_x9atq0wduhrlaqbrhiudu5qc8.png" alt="Bild"><br><br>  Wie ich bereits sagte, sind die Adressen 0x0800 ... das sind <u>ROM-</u> Adressen und 0x200 ... das sind <u>RAM</u> .  Mal sehen, in welchen Segmenten der Compiler diese Konstanten verteilt hat: <br><br><pre> <code class="cmake hljs"> .rodata const <span class="hljs-number"><span class="hljs-number">0</span></span>x800'<span class="hljs-number"><span class="hljs-number">4</span></span>e2c <span class="hljs-number"><span class="hljs-number">0</span></span>x4 main.o //Case1 .rodata const <span class="hljs-number"><span class="hljs-number">0</span></span>x800'<span class="hljs-number"><span class="hljs-number">4</span></span>e30 <span class="hljs-number"><span class="hljs-number">0</span></span>x4 main.o //Case2 .rodata const <span class="hljs-number"><span class="hljs-number">0</span></span>x800'<span class="hljs-number"><span class="hljs-number">4</span></span>e34 <span class="hljs-number"><span class="hljs-number">0</span></span>x4 main.o //Case4 .rodata const <span class="hljs-number"><span class="hljs-number">0</span></span>x800'<span class="hljs-number"><span class="hljs-number">4</span></span>e38 <span class="hljs-number"><span class="hljs-number">0</span></span>x4 main.o //Case6</code> </pre> <br>  Vier globale und statische Konstanten fielen in das <i>.rodata-</i> Segment, und zwei lokale Variablen fielen nicht in die Map-Datei, da sie auf dem Stapel erstellt wurden und ihre Adresse den Adressen des Stapels entspricht.  Das CSTACK-Segment beginnt bei 0x2000'2488 und endet bei 0x2000'0488.  Wie Sie auf dem Bild sehen k√∂nnen, werden die Konstanten erst am Anfang des Stapels erstellt. <br><br><blockquote>  Der Compiler platziert globale und statische Konstanten im <i>.rodata-</i> Segment, deren Position in den Linker-Einstellungen angegeben ist. <br></blockquote><br>  Ein weiterer wichtiger Punkt ist die <b>Initialisierung</b> .  Globale und statische Variablen, einschlie√ülich Konstanten, m√ºssen initialisiert werden.  Dies kann auf verschiedene Arten erfolgen.  Wenn es sich um eine Konstante handelt, die im <i>.rodata-</i> Segment liegt, erfolgt die Initialisierung in der Kompilierungsphase, d. H.  Der Wert wird sofort an die Adresse geschrieben, an der sich die Konstante befindet.  Wenn dies eine regul√§re Variable ist, kann die Initialisierung erfolgen, indem der Wert aus dem ROM-Speicher in die Adresse der globalen Variablen kopiert wird: <br><br>  Wenn beispielsweise die globale Variable <code>int i = 3</code> definiert ist, hat der Compiler sie im Daten-Datensegment definiert. Der Linker hat sie auf 0x20000000 gesetzt: <br>  <code>.data inited 0x2000'0000</code> , <br>  und sein Initialisierungswert (3) liegt im <i>.rodata-</i> Segment unter der Adresse 0x8000190: <br> <code>Initializer bytes const 0x800'0190</code> <br>  Wenn Sie diesen Code schreiben: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c = i;</code> </pre> <br>  Es ist offensichtlich, dass die globale Konstante <code></code> erst initialisiert wird, nachdem die globale Variable <code>i</code> initialisiert wurde, d. H. Zur Laufzeit.  In diesem Fall befindet sich die Konstante im <u>RAM</u> <br><br>  Nun, wenn wir zu unserem zur√ºckkehren <div class="spoiler">  <b class="spoiler_title">erstes Beispiel</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WantToBeInROM</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: WantToBeInROM(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): i(value) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i; } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> WantToBeInROM </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myConstInROM</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; &amp;myConstInROM &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> ; }</code> </pre><br></div></div>  Und wir fragen uns: In welchem ‚Äã‚ÄãSegment hat der Compiler das konstante Objekt <code>myConstInROM</code> ?  Und wir bekommen die Antwort: Die Konstante liegt im <i>.bss-</i> Segment <i>und</i> enth√§lt statische und globale Variablen, die auf Null (0) initialisiert sind. <br> <code>.bss inited 0x2000'0004 0x4 <br> myConstInROM 0x2000'0004 0x4</code> <br> <br>  Warum?  Denn in C ++ befindet sich ein Datenobjekt, das als Konstante deklariert ist und eine dynamische Initialisierung ben√∂tigt, im Lese- / Schreibspeicher und wird beim Erstellen initialisiert. <br><br>  In diesem Fall erfolgt eine dynamische Initialisierung, <code>const WantToBeInROM myConstInROM(10)</code> , und der Compiler <i>f√ºgt</i> dieses Objekt in das <i>.bss-</i> Segment ein, initialisiert zuerst alle Felder 0 und <i>ruft</i> dann beim Erstellen eines konstanten Objekts den Konstruktor auf, um das Feld <code>i</code> Wert 10 zu initialisieren. <br><br>  Wie k√∂nnen wir den Compiler dazu bringen, unser Objekt im <i>.rodata-</i> Segment zu platzieren?  Die Antwort auf diese Frage ist einfach. Sie sollten immer eine statische Initialisierung durchf√ºhren.  Sie k√∂nnen es so machen: <br><br>  1. In unserem Beispiel ist zu sehen, dass der Compiler die dynamische Initialisierung im Prinzip auf statisch optimieren kann, da der Konstruktor recht einfach ist.  F√ºr die IAR des Compilers k√∂nnen Sie die Konstante mit dem Attribut <i>__ro_placement</i> markieren <br> <code>__ro_placement const WantToBeInROM myConstInROM</code> <br>  Mit dieser Option platziert der Compiler die Variable an der Adresse im ROM: <br> <code>myConstInROM 0x800'0144 0x4 Data</code> <br>  Offensichtlich ist dieser Ansatz nicht universell und im Allgemeinen sehr spezifisch.  Deshalb gehen wir zur richtigen Methode √ºber :) <br><br>  2. Es ist ein <code>constexpr</code> Konstruktor zu <code>constexpr</code> .  Wir weisen den Compiler sofort an, die statische Initialisierung zu verwenden, d. H.  In der Kompilierungsphase wird das gesamte Objekt im Voraus vollst√§ndig "berechnet" und alle seine Felder sind bekannt.  Alles was wir tun m√ºssen, ist constexpr zum Konstruktor hinzuzuf√ºgen. <br><br><div class="spoiler">  <b class="spoiler_title">Objekt fliegt zum ROM</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WantToBeInROM</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WantToBeInROM</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i; } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> WantToBeInROM </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myConstInROM</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; &amp;myConstInROM &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> ; }</code> </pre><br></div></div><br>  Um sicherzugehen, dass sich Ihr konstantes Objekt im ROM befindet, m√ºssen Sie einfache Regeln befolgen: <br><blockquote><ol><li>  Das <i>.text-</i> Segment, in dem der Code platziert ist, sollte sich im ROM befinden.  Es wird in den Linker-Einstellungen konfiguriert. </li><li>  Das <i>.rodata-</i> Segment, in dem globale und statische Konstanten platziert sind, muss sich im ROM befinden.  Es wird in den Linker-Einstellungen konfiguriert. </li><li>  Die Konstante muss global oder statisch sein. </li><li>  Attribute einer konstanten Variablenklasse d√ºrfen nicht ver√§nderbar sein </li><li>  Die Initialisierung des Objekts muss statisch sein, d. H. Der Konstruktor der Klasse, dessen Objekt eine Konstante sein wird, muss konstexpr sein oder √ºberhaupt nicht definiert sein (es gibt keine dynamische Initialisierung). </li><li>  Wenn m√∂glich, wenn Sie sicher sind, dass das Objekt im ROM anstelle von const gespeichert werden soll, verwenden Sie constexpr </li></ol></blockquote><br>  Ein paar Worte zum constexpr und zum constexpr-Konstruktor.  Der Hauptunterschied zwischen const und constexpr besteht darin, dass die Initialisierung der const-Variablen bis zur Laufzeit verz√∂gert werden kann.  Die Variable constexpr muss zur Kompilierungszeit initialisiert werden. <br>  <b><u>Alle constexpr-Variablen sind vom Typ const.</u></b> <br><br>  Die Definition des constexpr-Konstruktors muss die folgenden Anforderungen erf√ºllen: <br><ul><li>  Eine Klasse darf keine virtuellen Basisklassen haben. <pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">D2</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> BASE { <span class="hljs-comment"><span class="hljs-comment">//error, D2 must not have virtual base class. constexpr D2() : BASE(), mem(55) { } private: int mem; };</span></span></code> </pre> </li><li>  Jeder der Parametertypen der Klasse muss ein Literaltyp sein. </li><li>  Der Konstruktork√∂rper muss <code>= delete</code> oder <code>= default</code> .  Oder erf√ºllen Sie die folgenden Anforderungen: </li><li>  Es gibt keine <code>try catch</code> Bl√∂cke im Konstruktork√∂rper. </li><li>  Der Konstruktork√∂rper kann <code>nullptr</code> </li><li>  Der Konstruktork√∂rper kann <code>static_assert</code> </li><li>  Im Hauptteil des Konstruktors kann <code>typedef</code> verwendet werden, das keine Klassen oder Aufz√§hlungen definiert </li><li>  Der Konstruktork√∂rper kann Direktiven und Deklarationen <code>using</code> </li><li>  Jedes nicht statische Mitglied einer Klasse oder Basisklasse muss initialisiert werden. </li><li>  Konstruktoren einer Klasse oder Basisklasse, die zum Initialisieren nicht statischer Elemente von Klassenmitgliedern und Unterobjekten der Basisklasse verwendet werden, m√ºssen <code>constexpr</code> . </li><li>  Initialisierer f√ºr alle nicht statischen Datenelemente m√ºssen <code>constexpr</code> </li><li>  Bei der Initialisierung von Klassenmitgliedern m√ºssen alle Typkonvertierungen in einem konstanten Ausdruck g√ºltig sein.  Die Verwendung von <code>reinterpret_cast</code> und das Umwandeln von <code>void*</code> in einen anderen Zeigertyp ist beispielsweise nicht zul√§ssig </li></ul><br>  Der implizite Standardkonstruktor ist der constexpr-Konstruktor.  Schauen wir uns nun einige Beispiele an: <br><br><div class="spoiler">  <b class="spoiler_title">Beispiel 1. Objekt im ROM</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Test() {} ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-number"><span class="hljs-number">1</span></span>; } } ; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Test test; <span class="hljs-comment"><span class="hljs-comment">//  ROM.    . i  0  . int main() { std::cout &lt;&lt; test.Get() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br>  Dies ist besser, nicht zu schreiben, da das Objekt in den RAM fliegt, sobald Sie sich entscheiden, das Attribut i zu initialisieren <br><br><div class="spoiler">  <b class="spoiler_title">Beispiel 2. Ein Objekt im RAM</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">// i.       constexpr . public: Test() {} ; //       ,       ,  constexpr int Get() const { return i + 1; } } ; const Test test; //  RAM. i     int main() { std::cout &lt;&lt; test.Get() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Beispiel 3. Ein Objekt im RAM</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Test(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): i(value) {} ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-number"><span class="hljs-number">1</span></span>; } } ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Test </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  RAM. i     int main() { std::cout &lt;&lt; test.Get() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Beispiel 4. Objekt im ROM</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{} ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-number"><span class="hljs-number">1</span></span>; } } ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Test </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ROM. i     constexpr  int main() { std::cout &lt;&lt; test.Get() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Beispiel 5. Ein Objekt im RAM</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{} ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-number"><span class="hljs-number">1</span></span>; } } ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Test </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  RAM.    std::cout &lt;&lt; test.Get() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Beispiel 6. Objekt im ROM</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{} ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-number"><span class="hljs-number">1</span></span>; } } ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Test </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ROM.    std::cout &lt;&lt; test.Get() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel 7. Kompilierungsfehler</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{} ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">// Get  ,  ,       (i),     .   ,       . { return i + 1; } } ; const Test test(10); int main() { std::cout &lt;&lt; test.Get() &lt;&lt; std::endl ; return 0; }</span></span></span></span></code> </pre> <br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel 8. Ein Objekt im ROM, das von einer abstrakten Klasse erbt</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITest</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Give</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j ; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value+</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{} ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i + <span class="hljs-number"><span class="hljs-number">1</span></span>; } } ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Test </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ROM. i     constexpr , j   constexpr  ITest int main() { std::cout &lt;&lt; test.Give() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel 9. Ein Objekt im ROM aggregiert ein Objekt im RAM</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITest</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Give</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j ; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: TestImpl(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): k(value), ITest(value) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j + <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ k = value; j = value + <span class="hljs-number"><span class="hljs-number">10</span></span>; } } ; <span class="hljs-function"><span class="hljs-function">TestImpl </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//    RAM. class Test: public ITest { private: int i; TestImpl &amp; obj; //    public: constexpr Test(int value, TestImpl &amp; ref): i(value), obj(ref), ITest(value+1) { } ; int Get() const override { return i + 1; } bool Set() const { obj.Set(100) ; //     return true; } } ; constexpr Test test(10, testImpl); //  ROM.     constexpr  int main() { std::cout &lt;&lt; test.Set() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel 10. Das gleiche, aber statische Objekt im ROM</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITest</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Give</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j ; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: TestImpl(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): k(value), ITest(value) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j + <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ k = value; j = value + <span class="hljs-number"><span class="hljs-number">10</span></span>; } } ; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; TestImpl &amp; obj; <span class="hljs-comment"><span class="hljs-comment">//    public: constexpr Test(int value, TestImpl &amp; ref): i(value), obj(ref),ITest(value+1) { } ; int Get() const override { return i + 1; } bool Set() const { obj.Set(100) ; //     return true; } } ; int main() { static TestImpl testImpl(1); //  static constexpr Test test(10, testImpl); //    ROM.     constexpr  std::cout &lt;&lt; test.Set() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel 11. Und jetzt ist das konstante Objekt nicht statisch und daher im RAM</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITest</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Give</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j ; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: TestImpl(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): k(value), ITest(value) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j + <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ k = value; j = value + <span class="hljs-number"><span class="hljs-number">10</span></span>; } } ; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; TestImpl &amp; obj; <span class="hljs-comment"><span class="hljs-comment">//    public: constexpr Test(int value, TestImpl &amp; ref): i(value), obj(ref),ITest(value+1) { } ; int Get() const override { return i + 1; } bool Set() const { obj.Set(100) ; //     return true; } } ; int main() { static TestImpl testImpl(1); //  const Test test(10, testImpl); //    RAM. std::cout &lt;&lt; test.Set() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel 12. Kompilierungsfehler.</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITest</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Give</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j ; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: TestImpl(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): k(value), ITest(value) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j + <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ k = value; j = value + <span class="hljs-number"><span class="hljs-number">10</span></span>; } } ; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; TestImpl obj; <span class="hljs-comment"><span class="hljs-comment">//   TestImpl public: constexpr Test(int value): i(value), obj(TestImpl(value)), //   constexpr   TestImpl ITest(value+1) { } ; int Get() const { return i + 1; } bool Set() const { obj.Set(100) ; //     return true; } } ; int main() { static TestImpl testImpl(1); //  static const Test test(10); //   std::cout &lt;&lt; test.Set() &lt;&lt; std::endl ; return 0; }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel 13. Kompilierungsfehler</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITest</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Give</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j ; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">k</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//   constexpr { } int Get() const override { return j + 10; } void Set(int value) //   ,  k  j.       ROM,        RAM { k = value; j = value + 10; } } ; class Test: public ITest { private: int i; TestImpl obj; public: constexpr Test(int value): i(value), obj(TestImpl(value)), // constexpr     obj,    obj  .rodata . ITest(value+1) { } ; int Get() const { return i + 1; } bool Set() const { obj.Set(100) ; //        constexpr     return true; } } ; int main() { static TestImpl testImpl(1); //  static const Test test(10); //   std::cout &lt;&lt; test.Set() &lt;&lt; std::endl ; return 0; }</span></span></span></span></code> </pre><br></div></div><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beispiel 14. Ein Objekt im ROM</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITest</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Give</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j ; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITest { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">k</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ITest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> j + <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//   const { //do something } } ; class Test: public ITest { private: int i; const TestImpl obj; // ,    constexpr  public: constexpr Test(int value): i(value), obj(TestImpl(value)), ITest(value+1) { } ; int Get() const { return i + 1; } bool Set() const { obj.Set(100) ; //   return true; } } ; int main() { //static TestImpl testImpl(1); //  static const Test test(10); //    ROM.     constexpr  std::cout &lt;&lt; test.Set() &lt;&lt; std::endl ; return 0; }</span></span></span></span></code> </pre><br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und schlie√ülich ein konstantes Objekt, das ein Array enth√§lt, mit Array-Initialisierung √ºber eine constexpr-Funktion. </font></font><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k[<span class="hljs-number"><span class="hljs-number">100</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; it: k) { it = i++ ; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">k</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ InitArray(); <span class="hljs-comment"><span class="hljs-comment">// constexpr     } int Get(int index) const { return k[index]; } } ; int main() { static const Test test; //    ROM.     ,  constexpr . std::cout &lt;&lt; test.Get(10) &lt;&lt; std::endl ; return 0; }</span></span></code> </pre><br><br>  Referenzen: <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IAR C / C ++ - Entwicklungshandbuch </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Constexpr-Konstruktoren (C ++ 11) </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">constexpr (C ++)</font></font></a> <br><br>  PS. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nach einer sehr n√ºtzlichen Diskussion mit </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Valdaros m√ºssen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie die folgenden </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;">Punkttangenskonstanten</font></a><font style="vertical-align: inherit;"> hinzuf√ºgen. </font><font style="vertical-align: inherit;">Gem√§√ü dem C ++ - Standard und diesem Dokument </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N1076.pdf</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1. Jede √Ñnderung an einem konstanten Objekt (mit Ausnahme von ver√§nderlichen Mitgliedern einer Klasse) w√§hrend seiner Lebensdauer f√ºhrt zu einem undefinierten Verhalten.</font></font> Das hei√üt, <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ci = <span class="hljs-number"><span class="hljs-number">1</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* iptr = <span class="hljs-keyword"><span class="hljs-keyword">const_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>*&gt;(&amp;ci); <span class="hljs-comment"><span class="hljs-comment">//UB,       *iptr = 2 ;</span></span></code> </pre><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* ci = &amp;i ; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* iptr = <span class="hljs-keyword"><span class="hljs-keyword">const_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *&gt; (ci); <span class="hljs-comment"><span class="hljs-comment">//   *iptr = 2 ; // UB,   i</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Das Problem ist, dass dies nur w√§hrend der gesamten Lebensdauer eines konstanten Objekts funktioniert, im Konstruktor und Destruktor jedoch nicht. </font><font style="vertical-align: inherit;">Daher ist es durchaus legitim, dies zu tun:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ foo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) ; } } ; Test *test1; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Test* value)</span></span></span><span class="hljs-function"> </span></span>{ value-&gt;i = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       0  1 test1 = value ; //           } const Test test; int main() { test1-&gt;i = 2; //          2. std::cout &lt;&lt; &amp;test &lt;&lt; std::endl; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und es gilt als legal. </font><font style="vertical-align: inherit;">Trotz der Tatsache, dass wir den Konstruktor constexpr und die darin enthaltene Funktion constexpr verwendet haben. </font><font style="vertical-align: inherit;">Das Objekt geht direkt in den RAM. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um dies zu vermeiden, verwenden Sie const - constexpr anstelle von const. Dann tritt ein Kompilierungsfehler auf, der Sie dar√ºber informiert, dass etwas nicht stimmt und das Objekt nicht konstant sein kann.</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ foo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) ; } } ; Test *test1; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Test* value)</span></span></span><span class="hljs-function"> </span></span>{ value-&gt;i = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       0  1 test1 = value ; //           } constexpr Test test; // / Error[Pe2400]: calling the default constructor for "Test" does not produce a constant value main.cpp 151 int main() { test1-&gt;i = 2; //          2. std::cout &lt;&lt; &amp;test &lt;&lt; std::endl; }</span></span></code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de453262/">https://habr.com/ru/post/de453262/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de453252/index.html">Wie wir das Sportmaster Club Programm gemacht haben</a></li>
<li><a href="../de453254/index.html">√úber GOSTs Code, Grasshopper, seine SBox und verlorene Samen</a></li>
<li><a href="../de453256/index.html">SObjectizer-5.6.0: Live schneiden, um weiter zu wachsen</a></li>
<li><a href="../de453258/index.html">Erstellen eines Reverb-Pedals mit PT2399-Chips (Teil 1)</a></li>
<li><a href="../de453260/index.html">DPI-Einstellungsfunktionen</a></li>
<li><a href="../de453264/index.html">Virtuali-Tee: Ein ‚Äûmedizinisches T-Shirt‚Äú, das nicht bedeckt, sondern freilegt</a></li>
<li><a href="../de453272/index.html">GitHub-Sponsoren: Ein neuer Weg, um zu Open Source beizutragen</a></li>
<li><a href="../de453274/index.html">Versteckte Provision Yandex.Money in Samsung Pay</a></li>
<li><a href="../de453276/index.html">Arduino und Timer unterbrechen</a></li>
<li><a href="../de453278/index.html">Warum k√ºmmern sich Ingenieure nicht um die Anwendungs√ºberwachung?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>