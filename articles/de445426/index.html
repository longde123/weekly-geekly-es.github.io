<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëáüèº üíî üëÉüèª Optimierung f√ºr die PostgreSQL-Serving-Rails-Anwendung üó£Ô∏è üï∫üèæ ü¶ê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Als Senior Software Engineer beim Aufbau einer Messaging-Plattform f√ºr das Gesundheitswesen bin ich einschlie√ülich anderer Aufgaben f√ºr die Leistung u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Optimierung f√ºr die PostgreSQL-Serving-Rails-Anwendung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445426/"><p> Als Senior Software Engineer beim Aufbau einer Messaging-Plattform f√ºr das Gesundheitswesen bin ich einschlie√ülich anderer Aufgaben f√ºr die Leistung unserer Anwendung verantwortlich.  Wir entwickeln einen ziemlich standardm√§√üigen Webdienst unter Verwendung der Ruby on Rails-Anwendung f√ºr Gesch√§ftslogik und API, React + Redux f√ºr Benutzeranwendungen mit nur einer Seite, da wir als Datenbank PostgreSQL verwenden.  H√§ufige Gr√ºnde f√ºr Leistungsprobleme in √§hnlichen Stacks sind umfangreiche Datenbankabfragen, und ich m√∂chte die Geschichte erz√§hlen, wie wir nicht standardm√§√üige, aber recht einfache Optimierungen angewendet haben, um die Leistung zu verbessern. </p><br><p>  Unser Gesch√§ft ist in den USA t√§tig, daher m√ºssen wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HIPAA-konform sein</a> und bestimmte Sicherheitsrichtlinien befolgen. Sicherheits√ºberpr√ºfungen sind etwas, auf das wir immer vorbereitet sind.  Um Risiken und Kosten zu reduzieren, verlassen wir uns auf einen speziellen Cloud-Anbieter, um unsere Anwendungen und Datenbanken auszuf√ºhren, √§hnlich wie bei Heroku.  Einerseits k√∂nnen wir uns auf den Aufbau unserer Plattform konzentrieren, andererseits wird unsere Infrastruktur zus√§tzlich eingeschr√§nkt.  Kurz gesagt - wir k√∂nnen nicht unendlich skalieren.  Als erfolgreicher Start verdoppeln wir alle paar Monate die Anzahl der Benutzer, und eines Tages ergab unsere √úberwachung, dass wir das Festplatten-E / A-Kontingent auf dem Datenbankserver √ºberschritten haben.  Das zugrunde liegende AWS begann mit der Drosselung, was zu einer erheblichen Leistungsverschlechterung f√ºhrte.  Die Ruby-Anwendung war nicht in der Lage, den gesamten eingehenden Datenverkehr zu bedienen, da die Mitarbeiter von Unicorn zu lange auf die Antwort der Datenbank warteten und die Kunden ungl√ºcklich waren. </p><a name="habracut"></a><br><h2 id="standard-solutions">  Standardl√∂sungen </h2><br><p>  Am Anfang des Artikels erw√§hnte ich den Ausdruck "nicht standardm√§√üige Optimierungen", da alle niedrig h√§ngenden Fr√ºchte bereits gepfl√ºckt waren: </p><br><ul><li>  Wir haben alle N + 1-Abfragen entfernt.  Ruby Gem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bullet</a> war das Hauptwerkzeug </li><li>  Alle ben√∂tigten Indizes in der Datenbank wurden hinzugef√ºgt, alle nicht ben√∂tigten wurden dank <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pg_stat_statements entfernt</a> </li><li>  Einige Abfragen mit mehreren Verkn√ºpfungen wurden zur Verbesserung der Effizienz neu geschrieben </li><li>  Wir haben Abfragen getrennt, um paginierte Sammlungen von Dekorationsabfragen abzurufen.  Zum Beispiel haben wir anfangs einen Z√§hler f√ºr Nachrichten pro Dialog hinzugef√ºgt, indem wir Tabellen verkn√ºpft haben, aber er wurde durch eine zus√§tzliche Abfrage ersetzt, um die Ergebnisse zu verbessern.  Die n√§chste Abfrage f√ºhrt <em>Index Only Scan durch</em> und ist wirklich g√ºnstig: </li></ul><br><pre><code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> COUNT(<span class="hljs-number"><span class="hljs-number">1</span></span>), dialog_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> messages <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> dialog_id <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> dialog_id;</code> </pre> <br><ul><li>  f√ºgte ein paar Caches hinzu.  Eigentlich hat das nicht gut funktioniert, weil wir als Messaging-Anwendung viele Updates haben </li></ul><br><p>  Alle diese Tricks haben ein paar Monate lang gro√üartige Arbeit geleistet, bis wir erneut mit dem gleichen Leistungsproblem konfrontiert waren - mehr Benutzer, h√∂here Last.  Wir haben nach etwas anderem gesucht. </p><br><h2 id="advanced-solutions">  Fortschrittliche L√∂sungen </h2><br><p>  Wir wollten keine schwere Artillerie einsetzen und Denormalisierung und Partitionierung implementieren, da diese L√∂sungen fundierte Kenntnisse in Datenbanken erfordern, den Fokus des Teams von der Implementierung von Funktionen auf die Wartung verlagern und am Ende die Komplexit√§t unserer Anwendung vermeiden wollten.  Zuletzt haben wir PostgreSQL 9.3 verwendet, bei dem Partitionen auf Triggern mit all ihren Kosten basieren.  KISS-Prinzip in Aktion. </p><br><h2 id="custom-solutions">  Kundenspezifische L√∂sungen </h2><br><h4 id="compress-data">  Daten komprimieren </h4><br><p>  Wir haben uns entschlossen, uns auf das Hauptsymptom zu konzentrieren - Disk IO.  Da weniger Daten gespeichert werden und weniger E / A-Kapazit√§t ben√∂tigt wird, war dies die Hauptidee.  Wir suchten nach M√∂glichkeiten, Daten zu komprimieren, und die ersten Kandidaten waren Spalten wie <code>user_type</code> die von <code>user_type</code> mit polymorphen Assoziationen versehen wurden.  In der Anwendung verwenden wir h√§ufig Module, die dazu f√ºhren, dass lange Zeichenfolgen wie <code>Module::SubModule::ModelName</code> f√ºr polymorphe Assoziationen verwendet werden.  Was wir getan haben - konvertieren Sie alle diese Spaltentypen von varchar nach ENUM.  Die Rails-Migration sieht folgenderma√üen aus: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddUserEnumType</span></span></span><span class="hljs-class"> &lt; ActiveRecord::Migration[5.2] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">disable_ddl_transaction!</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">up</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveRecord::Base</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">connection</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">execute</span></span></span><span class="hljs-class"> &lt;&lt;~</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SQL</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CREATE</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TYPE</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_type_enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AS</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ENUM</span></span></span><span class="hljs-class"> ( '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module::Submodule::UserModel1</span></span></span><span class="hljs-class">', '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module::Submodule::UserModel2</span></span></span><span class="hljs-class">', '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module::Submodule::UserModel3</span></span></span><span class="hljs-class">' );</span></span> SQL add_column <span class="hljs-symbol"><span class="hljs-symbol">:messages</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:sender_type_temp</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:user_type_enum</span></span> Message .in_batches(<span class="hljs-symbol"><span class="hljs-symbol">of:</span></span> <span class="hljs-number"><span class="hljs-number">10000</span></span>) .update_all(<span class="hljs-string"><span class="hljs-string">'sender_type_temp = sender_type::user_type_enum'</span></span>) safety_assured <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> rename_column <span class="hljs-symbol"><span class="hljs-symbol">:messages</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:sender_type</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:sender_type_old</span></span> rename_column <span class="hljs-symbol"><span class="hljs-symbol">:messages</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:sender_type_temp</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:sender_type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><p>  Einige Hinweise zu dieser Migration f√ºr Personen, die mit Rails nicht vertraut sind: </p><br><ul><li>  <em>disable_ddl_transaction!</em>  Deaktiviert die Transaktionsmigration.  Dies ist sehr riskant, aber wir wollten lange Transaktionen vermeiden.  Stellen Sie sicher, dass Sie Transaktionen bei der Migration nicht deaktivieren, ohne dass dies erforderlich ist. </li><li>  Im ersten Schritt erstellen wir einen neuen ENUM-Datentyp unter PostgreSQL.  Das beste Merkmal von ENUM ist eine geringe Gr√∂√üe, die im Vergleich zu Varchar wirklich klein ist.  ENUM hat einige Schwierigkeiten beim Hinzuf√ºgen neuer Werte, aber normalerweise f√ºgen wir nicht oft neue Benutzertypen hinzu. </li><li>  <em>F√ºgen</em> Sie eine neue Spalte <em>sender_type_temp</em> mit dem <em>user_type_enum hinzu</em> </li><li>  F√ºllen Sie die neue Spalte <em>in_batches</em> mit <em>Werten</em> , um eine lange Sperre der Tabellennachrichten zu vermeiden </li><li>  Der letzte Schritt tauscht die alte Spalte gegen eine neue aus.  Dies ist der gef√§hrlichste Schritt, denn wenn die Spalte <em>sender_type</em> in <em>sender_type_old</em> <em>ge√§ndert</em> w√ºrde, aber <em>sender_type_temp</em> nicht zu <em>sender_type</em> werden <em>k√∂nnte</em> , w√ºrden wir viele Probleme bekommen. </li><li>  <em>security_assured</em> stammt aus dem Juwel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">strong_migration,</a> das hilft, Fehler beim Schreiben von Migrationen zu vermeiden.  Das Umbenennen von Spalten ist kein sicherer Vorgang, daher mussten wir best√§tigen, dass wir verstehen, was wir taten.  Tats√§chlich gibt es einen sichereren, aber l√§ngeren Weg, der mehrere Bereitstellungen umfasst. </li></ul><br><p>  Es ist unn√∂tig zu erw√§hnen, dass wir alle √§hnlichen Migrationen w√§hrend der niedrigsten Aktivit√§tsperioden mit geeigneten Tests durchf√ºhren. </p><br><p>  Wir haben alle polymorphen Spalten in ENUM konvertiert, alte Spalten nach einigen Tagen der √úberwachung gel√∂scht und schlie√ülich VACUUM ausgef√ºhrt, um die Fragmentierung zu verringern.  Dies sparte uns aber rund 10% des gesamten Speicherplatzes <br>  Einige Tabellen mit einigen Spalten wurden zweimal komprimiert!  Was noch wichtiger war: Einige Tabellen wurden von PostgreSQL im Speicher zwischengespeichert (denken Sie daran, wir k√∂nnen nicht einfach mehr RAM hinzuf√ºgen), was die erforderliche Festplatten-E / A drastisch verringerte. </p><br><h4 id="dont-trust-your-service-provider">  Vertrauen Sie Ihrem Dienstanbieter nicht </h4><br><p>  Eine andere Sache wurde in dem Artikel gefunden. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wie eine einzelne √Ñnderung der PostgreSQL-Konfiguration die Leistung langsamer Abfragen um</a> das <em>50-fache</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">verbesserte</a> - unser PostgreSQL-Anbieter erstellt eine automatische Konfiguration f√ºr den Server basierend auf dem angeforderten RAM-, Festplatten- und CPU-Volumen, aber aus welchem ‚Äã‚ÄãGrund auch immer, er lie√ü den Parameter <em>random_page_cost</em> mit dem Standardwert 4, optimiert f√ºr Festplatte.  Sie verlangen von uns, dass wir Datenbanken auf SSD ausf√ºhren, haben PostgreSQL jedoch nicht ordnungsgem√§√ü konfiguriert.  Nachdem wir sie kontaktiert hatten, bekamen wir viel bessere Ausf√ºhrungspl√§ne: </p><br><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXPLAIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ANALYSE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> COUNT(*) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> count_dialog_id, dialog_id <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> dialog_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> messages <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> sender_type = <span class="hljs-string"><span class="hljs-string">'Module::Submodule::UserModel1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> sender_id = <span class="hljs-number"><span class="hljs-number">1234</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> dialog_id; db=# <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> random_page_cost = <span class="hljs-number"><span class="hljs-number">4</span></span>; QUERY PLAN <span class="hljs-comment"><span class="hljs-comment">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- HashAggregate (cost=76405.45..76411.92 rows=647 width=12) (actual time=2428.412..2428.420 rows=12 loops=1) Group Key: dialog_id -&gt; Bitmap Heap Scan on messages (cost=605.90..76287.72 rows=23545 width=4) (actual time=82.442..2376.033 rows=79466 loops=1) Recheck Cond: ((sender_id = 1234) AND (sender_type = 'Module::Submodule::UserModel1'::user_type_enum)) Heap Blocks: exact=23672 -&gt; Bitmap Index Scan on index_messages_on_sender_id_and_sender_type_and_message_type (cost=0.00..600.01 rows=23545 width=0) (actual time=76.067..76.068 rows=79466 loops=1) Index Cond: ((sender_id = 1234) AND (sender_type = 'Module::Submodule::UserModel1'::user_type_enum)) Planning time: 3.849 ms Execution time: 2428.691 ms (9 rows) db=# SET random_page_cost = 1; QUERY PLAN ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ HashAggregate (cost=21359.54..21366.01 rows=647 width=12) (actual time=97.905..97.913 rows=12 loops=1) Group Key: dialog_id -&gt; Index Scan using index_messages_on_sender_id_and_sender_type_and_message_type on messages (cost=0.56..21241.81 rows=23545 width=4) (actual time=0.058..60.444 rows=79466 loops=1) Index Cond: ((sender_id = 1234) AND (sender_type = 'Module::Submodule::UserModel1'::user_type_enum)) Planning time: 0.277 ms Execution time: 98.070 ms (6 rows)</span></span></code> </pre> <br><h4 id="move-data-away">  Verschieben Sie Daten weg </h4><br><p>  Wir haben eine riesige Tabelle in eine andere Datenbank verschoben.  Wir m√ºssen jede √Ñnderung des Systems gesetzlich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pr√ºfen</a> und diese Anforderung wird mit gem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PaperTrail umgesetzt</a> .  Diese Bibliothek erstellt eine Tabelle in der Produktionsdatenbank, in der alle √Ñnderungen der √ºberwachten Objekte gespeichert werden.  Wir verwenden Library <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Multiverse,</a> um eine weitere Datenbankinstanz in unsere Rails-App zu integrieren.  √úbrigens - es wird eine Standardfunktion von Rails 6 sein. Es gibt einige Konfigurationen: </p><br><p>  Beschreiben der Verbindung in der Datei <code>config/database.yml</code> </p><br><pre> <code class="plaintext hljs">external_default: &amp;external_default url: "&lt;%= ENV['AUDIT_DATABASE_URL'] %&gt;" external_development: &lt;&lt;: *external_default</code> </pre> <br><p>  Basisklasse f√ºr ActiveRecord-Modelle aus einer anderen Datenbank: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExternalRecord</span></span></span><span class="hljs-class"> &lt; ActiveRecord::Base </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abstract_class</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">establish_connection</span></span></span><span class="hljs-class"> :"</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">external_</span></span></span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#{Rails.env}" end</span></span></span></span></code> </pre> <br><p>  Modell, das PaperTrail-Versionen implementiert: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExternalVersion</span></span></span><span class="hljs-class"> &lt; ExternalRecord </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PaperTrail::VersionConcern</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Anwendungsfall im zu pr√ºfenden Modell: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span><span class="hljs-class"> &lt; ActiveRecord::Base </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">has_paper_trail</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class_name</span></span></span><span class="hljs-class">: "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExternalVersion</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><h2 id="summary">  Zusammenfassung </h2><br><p>  Wir haben unserer PostgreSQL-Instanz endlich mehr RAM hinzugef√ºgt und verbrauchen derzeit nur 10% der verf√ºgbaren Festplatten-E / A.  Wir haben bis zu diesem Zeitpunkt √ºberlebt, weil wir einige Tricks angewendet haben - komprimierte Daten in unserer Produktionsdatenbank, korrigierte Konfiguration und nicht relevante Daten entfernt.  Wahrscheinlich helfen diese in Ihrem speziellen Fall nicht weiter, aber ich hoffe, dieser Artikel kann einige Ideen zur benutzerdefinierten und einfachen Optimierung geben.  Vergessen Sie nat√ºrlich nicht, die am Anfang aufgef√ºhrte Checkliste der Standardprobleme durchzugehen. </p><br><p>  PS: Ich kann ein gro√üartiges <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DBA-Add-On f√ºr psql nur</a> empfehlen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de445426/">https://habr.com/ru/post/de445426/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de445416/index.html">Warum Schallplatten das digitale Zeitalter √ºberleben</a></li>
<li><a href="../de445418/index.html">Homo Sapiens? Nicht mehr</a></li>
<li><a href="../de445420/index.html">Es gibt 17 Milliarden Computer in der Hirnrinde</a></li>
<li><a href="../de445422/index.html">Welche Programmiersprachen sind am wenigsten sicher?</a></li>
<li><a href="../de445424/index.html">Erfahrung in der Entwicklung des Refund Tool-Dienstes mit einer asynchronen API auf Kafka</a></li>
<li><a href="../de445428/index.html">Hochwertiges WLAN - die Basis moderner Gastfreundschaft und der Motor des Gesch√§fts</a></li>
<li><a href="../de445432/index.html">Unity Package Manager</a></li>
<li><a href="../de445434/index.html">Bester schlechtester Job der Welt: Auf der Suche nach einem Habraautor</a></li>
<li><a href="../de445436/index.html">Umschulung in DevOps - worauf Sie sich vorbereiten m√ºssen</a></li>
<li><a href="../de445438/index.html">Bekanntschaft mit darauf basierenden Lit-Element- und Web-Komponenten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>