<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï∫üèø üìë üé¢ Programme d'affiliation open source d√©centralis√© sur la blockchain Waves ‚úåüèª üôÜüèø üßëüèº‚Äçü§ù‚Äçüßëüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Un programme d'affiliation d√©centralis√© sur la blockchain Waves, mis en ≈ìuvre dans le cadre d'une subvention Waves Labs par l'√©quipe Bettex. 

 La pub...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Programme d'affiliation open source d√©centralis√© sur la blockchain Waves</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459590/">  Un programme d'affiliation d√©centralis√© sur la blockchain Waves, mis en ≈ìuvre dans le cadre d'une subvention Waves Labs par l'√©quipe Bettex. <br><br><div class="spoiler">  <b class="spoiler_title">La publication n'est pas de la publicit√©</b> <div class="spoiler_text">  !  Le programme est open source, son utilisation et sa distribution sont gratuites.  L'application du programme stimule le d√©veloppement d'applications dApp et favorise g√©n√©ralement la d√©centralisation, ce qui est b√©n√©fique pour chaque utilisateur du r√©seau. <br></div></div><br><img src="https://habrastorage.org/webt/hn/xm/xk/hnxmxkdtj1phll6cwjyceneyczg.jpeg" alt="image"><br><a name="habracut"></a><br>  Introduit par dApp pour les programmes d'affiliation est un mod√®le pour les projets qui incluent l'affiliation dans le cadre de ses fonctionnalit√©s.  Le code peut √™tre utilis√© comme mod√®le de copie, comme biblioth√®que ou comme ensemble d'id√©es pour la mise en ≈ìuvre technique. <br><br>  En termes de fonctionnalit√©, il s'agit d'un syst√®me d'affiliation r√©gulier qui met en ≈ìuvre l'inscription avec une indication d'un r√©f√©rent, une accumulation √† plusieurs niveaux de r√©compenses pour les r√©f√©rences et une motivation pour l'inscription dans le syst√®me (cashback).  Le syst√®me est une pure dApp, c'est-√†-dire que l'application Web interagit directement avec la blockchain sans son backend, sa base de donn√©es, etc. <br><br>  Des techniques sont utilis√©es qui peuvent √©galement √™tre utiles dans de nombreux autres projets: <br><br><ul><li>  Appeler un compte intelligent √† cr√©dit avec remboursement imm√©diat (au moment de l'appel, il n'y a pas de jetons sur le compte pour payer l'appel, mais ils y apparaissent √† la suite de l'appel). </li><li>  PoW-captcha - protection contre les appels automatis√©s √† haute fr√©quence des fonctions de compte intelligent - un analogue du captcha, mais gr√¢ce √† la preuve de l'utilisation des ressources informatiques. </li><li>  Demande de cl√©s de donn√©es par mod√®le. </li></ul><br>  L'application se compose de: <br><br><ul><li>  code de compte intelligent dans la langue ride4dapps (qui, par conception, est fusionn√© dans le compte intelligent principal, pour lequel vous devez impl√©menter la fonctionnalit√© d'affiliation); </li><li>  les wrappers js qui impl√©mentent le niveau d'abstraction sur l'API WAVES NODE REST; </li><li>  code sur le framework vuejs, qui est un exemple d'utilisation de la biblioth√®que et du code RIDE. </li></ul><br>  Nous d√©crivons toutes ces fonctionnalit√©s. <br><br>  <b>Appelez un compte intelligent √† cr√©dit avec remboursement imm√©diat</b> <br><br>  Les appels InvokeScript n√©cessitent des frais du compte initiateur de transaction.  Ce n'est pas un probl√®me si vous faites un projet pour les geeks blockchain qui ont des jetons WAVES sur leur compte, mais si le produit est destin√© √† une utilisation g√©n√©ralis√©e, cela devient un probl√®me grave.  Apr√®s tout, l'utilisateur doit prendre soin d'acheter des jetons WAVES (ou un autre actif appropri√© avec lequel vous pouvez payer pour les transactions), ce qui augmente le seuil d√©j√† consid√©rable pour entrer dans le projet.  Nous pouvons distribuer des actifs aux utilisateurs, ce qui nous permettra de payer les transactions et de faire face au risque de leur mauvaise utilisation lorsque des syst√®mes automatis√©s sont cr√©√©s pour pomper des actifs liquides de notre syst√®me. <br><br>  Il serait tr√®s pratique de pouvoir effectuer un appel InvokeScript ¬´aux frais du destinataire¬ª (ce compte intelligent sur lequel le script est install√©), et une telle possibilit√©, bien que pas de mani√®re √©vidente, existe. <br><br>  Si vous ex√©cutez ScriptTransfer dans InvokeScript √† l'adresse de l'appelant, ce qui compense les jetons d√©pens√©s en frais, alors un tel appel r√©ussira, m√™me s'il n'y avait aucun actif sur le compte appelant au moment de l'appel.  Cela est possible du fait qu'un nombre suffisant de jetons est v√©rifi√© apr√®s l'appel d'une transaction, et non avant, de sorte qu'il est possible d'effectuer des transactions √† cr√©dit sous r√©serve de leur remboursement imm√©diat. <br><br>  <i>ScriptTransfer (i.caller, i.fee, unit)</i> <br><br>  Le code ci-dessous rembourse les frais d√©pens√©s aux frais du compte intelligent.  Pour vous prot√©ger contre une utilisation abusive de cette fonctionnalit√©, vous devez utiliser la v√©rification que l'appelant d√©pense des frais dans le bon actif et dans des limites raisonnables: <br><br><pre><code class="plaintext hljs">func checkFee(i:Invocation) = { if i.fee &gt; maxFee then throw(‚Äúunreasonable large fee‚Äù) else if i.feeAssetId != unit then throw(‚Äúfee must be in WAVES‚Äù) else true }</code> </pre> <br>  De plus, la protection contre le gaspillage de fonds malveillant et insens√© n√©cessite une protection contre les appels automatiques (PoW-captcha) <br><br>  <b>PoW-captcha</b> <br><br>  L'id√©e du captcha de preuve de travail n'est pas nouvelle et a d√©j√† √©t√© mise en ≈ìuvre dans divers projets, y compris ceux mis en ≈ìuvre sur la base de WAVES.  L'id√©e est que pour l'action qui gaspille les ressources de notre projet, l'appelant doit d√©penser ses propres ressources, ce qui rend assez co√ªteuse l'attaque contre l'√©puisement des ressources.  Pour une validation tr√®s simple et √† faible co√ªt que l'exp√©diteur de la transaction a r√©solu la t√¢che PoW, il y a une v√©rification pour l'ID de transaction: <br><br>  <i>si prendre (toBase58String (i.transactionId), 3)! = "123" puis jeter ("la preuve du travail a √©chou√©") sinon</i> <br><br>  Pour effectuer une transaction, l'appelant doit s√©lectionner de tels param√®tres afin que son code base58 (id) commence √† 123, ce qui correspond √† une moyenne de quelques dizaines de secondes de temps processeur et est g√©n√©ralement raisonnable pour notre t√¢che.  Si un PoW plus simple ou plus complexe est requis, alors la t√¢che est facile √† affiner de mani√®re √©vidente. <br><br>  <b>Demande de cl√©s de donn√©es par mod√®le</b> <br><br>  Afin d'utiliser la blockchain comme base de donn√©es, il est essentiel de disposer d'outils API pour interroger la base de donn√©es en tant que mod√®les de valeur-cl√©.  Une telle bo√Æte √† outils est apparue d√©but juillet 2019 en tant que param√®tre <i>? Matches</i> pour la demande <i>/ adresses / donn√©es</i> de l'API REST <i>? Matches = regexp</i> .  Maintenant, si nous devons obtenir non pas une cl√© et pas toutes les cl√©s d'une application Web √† la fois, mais seulement un groupe, nous pouvons faire une s√©lection par le nom de la cl√©.  Par exemple, dans ce projet, les transactions de retrait sont cod√©es comme <br><br><pre> <code class="plaintext hljs">withdraw_${userAddress}_${txid}</code> </pre> <br>  qui vous permet d'obtenir une liste des transactions pour retirer des fonds pour une adresse donn√©e selon le mod√®le: <br><br><pre> <code class="plaintext hljs">?matches=withdraw_${userAddress}_.*</code> </pre> <br>  Nous allons maintenant analyser les composants de la solution cl√© en main. <br><br>  <b>Code Vuejs</b> <br><br>  Le code est une d√©mo fonctionnelle proche d'un vrai projet.  Il impl√©mente la connexion via Waves Keeper et travaille avec la biblioth√®que affiliate.js, √† l'aide de laquelle il enregistre l'utilisateur dans le syst√®me, interroge les donn√©es de transaction et vous permet √©galement de retirer des fonds gagn√©s sur le compte de l'utilisateur. <br><br><img src="https://habrastorage.org/webt/ug/dv/e6/ugdve6bg3kaamx7flsyzkaubxma.jpeg" alt="image"><br><br>  <b>Code RIDE</b> <br><br>  Il consiste en des fonctions d'enregistrement, de financement et de retrait. <br><br>  La fonction d'enregistrement s'inscrit aupr√®s du syst√®me utilisateur.  Il a deux param√®tres: referer (adresse de r√©f√©rence) et le param√®tre salt, qui n'est pas utilis√© dans le code de fonction, qui est n√©cessaire pour s√©lectionner l'ID de transaction (t√¢che PoW-captcha). <br><br>  La fonction (comme les autres fonctions de ce projet) utilise la technique d'emprunt, le r√©sultat de la fonction est de financer des frais pour appeler cette fonction.  Gr√¢ce √† cette d√©cision, l'utilisateur qui vient de cr√©er le portefeuille peut imm√©diatement travailler avec le syst√®me et il n'a pas besoin d'√™tre intrigu√© par la question de l'achat ou de la r√©ception d'un bien qui vous permet de payer des frais de transaction. <br><br>  Le r√©sultat de la fonction d'enregistrement est deux entr√©es: <br><br><pre> <code class="plaintext hljs">${owner)_referer = referer ${referer}_referral_${owner} = owner</code> </pre> <br>  Cela permet des recherches directes et inverses (r√©f√©rent de cet utilisateur et toutes les r√©f√©rences de cet utilisateur). <br><br>  La fonction de fonds est plus probablement un mod√®le pour d√©velopper une fonctionnalit√© r√©elle.  Dans la forme pr√©sent√©e, il prend tous les fonds transf√©r√©s par la transaction et les distribue aux comptes des r√©f√©rents 1, 2, 3, au compte ¬´cashback¬ª et au compte ¬´change¬ª (tout ce qui reste lors de la distribution aux comptes pr√©c√©dents tombe ici). <br><br>  La remise en argent est un moyen de stimuler l'utilisateur final √† participer au syst√®me de r√©f√©rence.  L'utilisateur peut retirer la partie de la commission pay√©e par le syst√®me sous forme de ¬´cashback¬ª au m√™me titre que les r√©compenses pour les filleuls. <br><br>  Lors de l'utilisation du syst√®me de r√©f√©rence, la fonction de fonds doit √™tre modifi√©e, int√©gr√©e dans la logique principale du compte intelligent sur lequel le syst√®me fonctionnera.  Par exemple, si les frais de r√©f√©rence sont pay√©s pour le pari effectu√©, la fonction de fonds doit √™tre int√©gr√©e dans la logique dans laquelle le pari est effectu√© (ou une autre action cibl√©e est effectu√©e, pour laquelle les frais sont pay√©s).  Cette fonction encode trois niveaux de r√©compenses de parrainage.  Si vous devez faire plus ou moins de niveaux, cela est √©galement corrig√© dans le code.  Le pourcentage de r√©mun√©ration est fix√© par les constantes niveau1-niveau3, dans le code, il est consid√©r√© comme <i>montant * niveau / 1000</i> , c'est-√†-dire que la valeur 1 correspond √† 0,1% (cela peut √©galement √™tre modifi√© dans le code). <br><br>  L'appel de fonction modifie le solde du compte et cr√©e √©galement des entr√©es dans le but de se connecter dans le formulaire: <br><br><pre> <code class="1c hljs">fund_address_txid = address:owner:inc:level:timestamp <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  timestamp ( )     func getTimestamp() = { let block = extract(blockInfoByHeight(height)) toString(block.timestamp) }</code> </pre> <br>  Autrement dit, le temps de transaction est le temps du bloc dans lequel il se trouve.  C'est plus fiable que d'utiliser l'horodatage de la transaction elle-m√™me, d'autant plus qu'il n'est pas accessible depuis callable. <br>  La fonction de retrait affiche toutes les r√©compenses accumul√©es sur le compte utilisateur.  Cr√©e des entr√©es √† des fins de journalisation: <br><br><pre> <code class="plaintext hljs"># withdraw log: withdraw_user_txid=amount:timestamp</code> </pre> <br>  <b>App</b> <br><br>  La partie principale de l'application est la biblioth√®que affiliate.js, qui est un pont entre les mod√®les de donn√©es d'affiliation et l'API WAVES NODE REST.  Impl√©mente un niveau d'abstraction ind√©pendant du framework (n'importe lequel peut √™tre utilis√©).  Les fonctions actives (enregistrer, retirer) supposent que Waves Keeper est install√© dans le syst√®me, la biblioth√®que elle-m√™me ne v√©rifie pas cela. <br><br>  Met en ≈ìuvre des m√©thodes: <br><br><pre> <code class="plaintext hljs">fetchReferralTransactions fetchWithdrawTransactions fetchMyBalance fetchReferrals fetchReferer withdraw register</code> </pre> <br>  La fonctionnalit√© des m√©thodes est √©vidente √† partir des noms, les param√®tres et les donn√©es retourn√©es sont d√©crits dans le code.  La fonction d'enregistrement n√©cessite des commentaires suppl√©mentaires - elle d√©marre le cycle de correspondance des identifiants de transaction pour qu'il d√©marre √† 123 - c'est le PoW-captcha d√©crit ci-dessus, qui prot√®ge contre les enregistrements de masse.  La fonction recherche la transaction avec l'ID souhait√©, puis la signe via Waves Keeper. <br><br>  Le programme d'affiliation DEX est disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub.com</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr459590/">https://habr.com/ru/post/fr459590/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr459580/index.html">Syst√®mes t√©l√©phoniques virtuels</a></li>
<li><a href="../fr459582/index.html">Aper√ßu: comment acheter des actions de soci√©t√©s am√©ricaines √† la Russie</a></li>
<li><a href="../fr459584/index.html">J'ai trouv√© un super programmeur nomm√© Steve Wozniak</a></li>
<li><a href="../fr459586/index.html">Garden v0.10.0: Votre ordinateur portable n'a pas besoin de Kubernetes</a></li>
<li><a href="../fr459588/index.html">N'acceptez pas de d√©velopper ce que vous ne comprenez pas</a></li>
<li><a href="../fr459592/index.html">Trois conseils de gestion du temps pour ceux qui ont tout essay√©.</a></li>
<li><a href="../fr459594/index.html">Lire entre les notes: syst√®me de transfert de donn√©es dans la musique</a></li>
<li><a href="../fr459596/index.html">iOS Digest n ¬∞ 9 (28 juin - 11 juillet)</a></li>
<li><a href="../fr459598/index.html">Foire aux questions de SELinux (FAQ)</a></li>
<li><a href="../fr459602/index.html">Nous int√©grons l'interpr√©teur Lua dans le projet de microcontr√¥leur (stm32)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>