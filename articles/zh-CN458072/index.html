<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨â€âœˆï¸ ğŸ¤›ğŸ¼ ğŸ’º PVS-Studioèµ°å‘äº‘ç«¯-åœ¨Travis CIä¸Šå¯åŠ¨åˆ†æ ğŸ‘¸ğŸ½ ğŸ¡ ğŸ‘¨ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç›®å‰ï¼Œäº‘CIç³»ç»Ÿæ˜¯ä¸€é¡¹éå¸¸å—æ¬¢è¿çš„æœåŠ¡ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨PVS-Studioæä¾›çš„ç°æœ‰å·¥å…·ï¼Œä»¥Travis CIæœåŠ¡ä¸ºä¾‹ï¼Œå°†æºä»£ç åˆ†æä¸Cloud CIå¹³å°é›†æˆã€‚ 



 ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦çœ‹ç¬¬ä¸‰æ–¹äº‘è€Œä¸æ˜¯è‡ªå·±åšï¼Ÿ åŸå› æœ‰å¾ˆå¤šï¼Œä¸»è¦åŸå› æ˜¯SaaSæ˜¯ä¸€ä¸ªç›¸å½“æ˜‚è´µä¸”å›°éš¾çš„è¿‡ç¨‹ã€‚ å®é™…ä¸Šï¼Œå°†PV...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PVS-Studioèµ°å‘äº‘ç«¯-åœ¨Travis CIä¸Šå¯åŠ¨åˆ†æ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/458072/"> ç›®å‰ï¼Œäº‘CIç³»ç»Ÿæ˜¯ä¸€é¡¹éå¸¸å—æ¬¢è¿çš„æœåŠ¡ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨PVS-Studioæä¾›çš„ç°æœ‰å·¥å…·ï¼Œä»¥Travis CIæœåŠ¡ä¸ºä¾‹ï¼Œå°†æºä»£ç åˆ†æä¸Cloud CIå¹³å°é›†æˆã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee1/252/191/ee125219104f0ff7d27f8c9dfc2db8bf.png" alt="å›¾ç‰‡1"></div><br><a name="habracut"></a><br> ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦çœ‹ç¬¬ä¸‰æ–¹äº‘è€Œä¸æ˜¯è‡ªå·±åšï¼Ÿ åŸå› æœ‰å¾ˆå¤šï¼Œä¸»è¦åŸå› æ˜¯SaaSæ˜¯ä¸€ä¸ªç›¸å½“æ˜‚è´µä¸”å›°éš¾çš„è¿‡ç¨‹ã€‚ å®é™…ä¸Šï¼Œå°†PVS-Studioåˆ†æä¸ç¬¬ä¸‰æ–¹äº‘å¹³å°ç›´æ¥é›†æˆï¼ˆæ— è®ºæ˜¯CircleCIï¼ŒTravis CIï¼ŒGitLabä¹‹ç±»çš„å¼€æ”¾å¹³å°ï¼Œè¿˜æ˜¯ä»…åœ¨ä¸€ä¸ªç‰¹å®šå…¬å¸ä¸­ä½¿ç”¨çš„æŸäº›ä¸“ä¸šä¼ä¸šè§£å†³æ–¹æ¡ˆï¼‰éƒ½æ˜¯ç›¸å½“ç®€å•è€Œçç¢çš„ä»»åŠ¡ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è¯´<i>PVS-Studioå·²ç»â€œåœ¨äº‘ç«¯â€å¯ç”¨</i> ã€‚ å®Œå…¨ä¸åŒçš„é—®é¢˜æ˜¯24/7å…¨å¤©å€™å·¥ä½œçš„ç»„ç»‡å’ŒåŸºç¡€è®¾æ–½çš„æä¾›ã€‚ è¿™æ˜¯å®Œå…¨ä¸åŒçš„ä»»åŠ¡ï¼ŒPVS-Studioæ²¡æœ‰è®¡åˆ’ç›´æ¥æä¾›è‡ªå·±çš„äº‘å¹³å°æ¥åœ¨å…¶ä¸Šè¿è¡Œåˆ†æã€‚ <br><br>
<h2> æœ‰å…³æ‰€ç”¨è½¯ä»¶çš„ä¿¡æ¯ </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Travis CI</a>æ˜¯ç”¨äºæ„å»ºå’Œæµ‹è¯•ä½¿ç”¨GitHubä½œä¸ºå­˜å‚¨çš„è½¯ä»¶çš„æœåŠ¡ã€‚  Travis CIä¸éœ€è¦æ›´æ”¹ç¨‹åºä»£ç å³å¯ä½¿ç”¨è¯¥æœåŠ¡ï¼Œæ‰€æœ‰è®¾ç½®éƒ½åœ¨å­˜å‚¨åº“æ ¹ç›®å½•ä¸­çš„<i>.travis.yml</i>æ–‡ä»¶ä¸­è¿›è¡Œã€‚ <br><br> æˆ‘ä»¬å°†æŠŠ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LXC</a> ï¼ˆLinuxå®¹å™¨ï¼‰ä½œä¸ºä¸€ä¸ªæµ‹è¯•é¡¹ç›®ï¼Œä»¥ä½¿ç”¨PVS-Studioè¿›è¡Œæµ‹è¯•ã€‚ å®ƒæ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿçº§è™šæ‹ŸåŒ–ç³»ç»Ÿï¼Œç”¨äºåœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡ŒLinuxæ“ä½œç³»ç»Ÿçš„å¤šä¸ªå®ä¾‹ã€‚ <br><br> è¯¥é¡¹ç›®å¾ˆå°ï¼Œä½†è¶³ä»¥æ¼”ç¤ºã€‚  clocå‘½ä»¤çš„è¾“å‡ºï¼š <br><div class="scrollable-table"><table><tbody><tr><td> è¯­è¨€èƒ½åŠ› <br></td><td> æ¡£æ¡ˆ <br></td><td> ç©ºç™½ <br></td><td> è¯„è®º <br></td><td> ä»£å· <br></td></tr><tr><td>  Ã§ <br></td><td>  124 <br></td><td>  11937 <br></td><td>  6758 <br></td><td>  50836 <br></td></tr><tr><td>  C / C ++æ ‡é¢˜ <br></td><td>  65å² <br></td><td>  1117 <br></td><td>  3676 <br></td><td>  3774 <br></td></tr></tbody></table></div>  <b>æ³¨æ„ï¼š</b> LXCå¼€å‘äººå‘˜å·²ç»åœ¨ä½¿ç”¨Travis CIï¼Œå› æ­¤æˆ‘ä»¬å°†ä»¥ä»–ä»¬çš„é…ç½®æ–‡ä»¶ä¸ºåŸºç¡€å¹¶å¯¹å…¶è¿›è¡Œç¼–è¾‘ã€‚ <br><br><h2> å®¢åˆ¶åŒ– </h2><br> è¦å¼€å§‹ä½¿ç”¨Travis CIï¼Œè¯·<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç‚¹å‡»é“¾æ¥</a>å¹¶ä½¿ç”¨Giâ€‹â€‹tHubå¸æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ba/8fc/c5a/1ba8fcc5a0caf41da255093cf4feaa8e.png" alt="å›¾ç‰‡17"></div><br> åœ¨æ‰“å¼€çš„çª—å£ä¸­ï¼Œæ‚¨éœ€è¦æˆæƒTravis CIã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d7/aec/13d/2d7aec13dec45022c952ff0498a6acae.png" alt="å›¾ç‰‡16"></div><br> æˆæƒåï¼Œé‡å®šå‘åˆ°æ¬¢è¿é¡µé¢â€œç¬¬ä¸€æ¬¡æ¥è¿™é‡Œï¼Ÿ è®©æ‚¨å¼€å§‹å§ï¼â€  <b>ï¼Œ</b>ç®€è¦ä»‹ç»äº†ä¸‹ä¸€æ­¥éœ€è¦åšä»€ä¹ˆï¼š <br><br><ul><li> æ¿€æ´»å­˜å‚¨åº“ï¼› </li><li> å°†.travis.ymlæ–‡ä»¶æ·»åŠ åˆ°å­˜å‚¨åº“ä¸­ï¼› </li><li> è¿è¡Œç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚ </li></ul><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29c/17f/c83/29c17fc830db9fad9d6d9dcb7fa047d7.png" alt="å›¾ç‰‡18"></div><br> æˆ‘ä»¬å°†å¼€å§‹æ‰§è¡Œè¿™äº›è¦ç‚¹ã€‚ <br><br> è¦å°†æˆ‘ä»¬çš„å­˜å‚¨åº“æ·»åŠ åˆ°Travis CIï¼Œè¯·<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€šè¿‡é“¾æ¥</a>è½¬åˆ°é…ç½®æ–‡ä»¶è®¾ç½®ï¼Œç„¶åå•å‡»â€œæ¿€æ´»â€æŒ‰é’®ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ab8/1f7/75e/ab81f775edc51c92b3238bf30b40527d.png" alt="å›¾ç‰‡19"></div><br> å•å‡»åï¼Œå°†æ‰“å¼€ä¸€ä¸ªçª—å£ï¼Œå…¶ä¸­åŒ…å«å¯ä¾›Travis CIåº”ç”¨ç¨‹åºè®¿é—®çš„å­˜å‚¨åº“ã€‚ <br>  <b>æ³¨æ„ï¼š</b>è¦æä¾›å¯¹å­˜å‚¨åº“çš„è®¿é—®æƒé™ï¼Œè¯¥å¸æˆ·å¿…é¡»å…·æœ‰è¯¥å­˜å‚¨åº“çš„ç®¡ç†å‘˜æƒé™ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e8/4fe/351/1e84fe351a57fcff37b5b70ec77e9cc5.png" alt="å›¾ç‰‡38"></div><br> æˆ‘ä»¬é€‰æ‹©æ‰€éœ€çš„å­˜å‚¨åº“ï¼Œå•å‡»â€œæ‰¹å‡†å¹¶å®‰è£…â€æŒ‰é’®ç¡®è®¤é€‰æ‹©ï¼Œç„¶åæˆ‘ä»¬å°†è¢«é‡å®šå‘å›é…ç½®æ–‡ä»¶è®¾ç½®é¡µé¢ã€‚ <br><br> ç«‹å³åˆ›å»ºç”¨äºåˆ›å»ºåˆ†æå™¨è®¸å¯è¯æ–‡ä»¶å¹¶å‘é€å…¶æŠ¥å‘Šçš„å˜é‡ã€‚ ä¸ºæ­¤ï¼Œè¯·è½¬åˆ°è®¾ç½®é¡µé¢-æ‰€éœ€å­˜å‚¨åº“å³ä¾§çš„â€œè®¾ç½®â€æŒ‰é’®ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d35/f44/907/d35f449074bd079c1b35140dd8336173.png" alt="å›¾ç‰‡39"></div><br> è®¾ç½®çª—å£å°†æ‰“å¼€ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cfe/c5f/1a8/cfec5f1a8ea19bf2c6e9e63c7af4c68c.png" alt="å›¾ç‰‡41"></div><br> è®¾ç½®çš„ç®€çŸ­è¯´æ˜ï¼š <br><br><ul><li>  â€œå¸¸è§„â€éƒ¨åˆ†-è®¾ç½®è‡ªåŠ¨è¿è¡Œä»»åŠ¡çš„è§¦å‘å™¨ï¼› </li><li>  â€œè‡ªåŠ¨å–æ¶ˆâ€éƒ¨åˆ†-å…è®¸æ‚¨é…ç½®è‡ªåŠ¨å–æ¶ˆè£…é…ï¼› </li><li>  â€œç¯å¢ƒå˜é‡â€éƒ¨åˆ†-å…è®¸æ‚¨å®šä¹‰åŒ…å«å…¬å…±å’Œæœºå¯†ä¿¡æ¯ï¼ˆä¾‹å¦‚å‡­æ®ï¼Œsshå¯†é’¥ï¼‰çš„ç¯å¢ƒå˜é‡ï¼› </li><li>  â€œ Cron Jobsâ€éƒ¨åˆ†-è®¾ç½®ä»»åŠ¡å¯åŠ¨æ—¶é—´è¡¨ã€‚ </li></ul><br> åœ¨â€œç¯å¢ƒå˜é‡â€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬åˆ›å»º<i>PVS_USERNAME</i>å’Œ<i>PVS_KEY</i>å˜é‡ï¼Œåˆ†åˆ«åŒ…å«é™æ€åˆ†æå™¨çš„ç”¨æˆ·åå’Œè®¸å¯è¯å¯†é’¥ã€‚ å¦‚æœæ‚¨æ²¡æœ‰æ°¸ä¹…æ€§çš„PVS-Studioè®¸å¯è¯ï¼Œåˆ™å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç”³è¯·è¯•ç”¨è®¸å¯è¯</a> ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8aa/731/483/8aa731483fc391273980c7de338f83be.png" alt="å›¾ç‰‡5"></div><br> ç«‹å³åˆ›å»ºåŒ…å«é‚®ç®±ç”¨æˆ·åå’Œå¯†ç çš„å˜é‡<i>MAIL_USER</i>å’Œ<i>MAIL_PASSWORD</i> ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒä»¬å‘é€æŠ¥å‘Šã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/37d/a42/9b4/37da429b49812239ab900e3b6fe5a90d.png" alt="å›¾ç‰‡4"></div><br> å¯åŠ¨ä»»åŠ¡åï¼ŒTravis CIä»ä½äºå­˜å‚¨åº“æ ¹ç›®å½•çš„.travis.ymlæ–‡ä»¶ä¸­è·å–æŒ‡ä»¤ã€‚ <br><br> ä½¿ç”¨Travis CIï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œé™æ€åˆ†æï¼Œæˆ–ä¸ºæ­¤ä½¿ç”¨é¢„å…ˆé…ç½®çš„å®¹å™¨ã€‚ è¿™äº›æ–¹æ³•çš„ç»“æœäº’ä¸ç›¸åŒï¼Œä½†æ˜¯ä½¿ç”¨é¢„å…ˆé…ç½®çš„å®¹å™¨å¯èƒ½ä¼šæ´¾ä¸Šç”¨åœºï¼Œä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å·²ç»æ‹¥æœ‰ä¸€ä¸ªåœ¨å…¶ä¸­æ„å»ºå’Œæµ‹è¯•äº†è½¯ä»¶äº§å“çš„ç‰¹å®šç¯å¢ƒçš„å®¹å™¨ï¼Œå¹¶ä¸”ä¸å¸Œæœ›åœ¨Travis CIä¸­è¿˜åŸæ­¤ç¯å¢ƒã€‚ <br><br> è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œåˆ†æå™¨çš„é…ç½®ã€‚ <br><br> å¯¹äºç»„è£…å’Œæµ‹è¯•ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŸºäºUbuntu Trustyçš„è™šæ‹Ÿæœºï¼Œå…¶è¯´æ˜å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>æ‰¾åˆ°ã€‚ <br><br> é¦–å…ˆï¼Œæˆ‘ä»¬æŒ‡ç¤ºè¯¥é¡¹ç›®æ˜¯ç”¨Cç¼–å†™çš„ï¼Œå¹¶ä¸”åˆ—å‡ºäº†å°†ç”¨äºæ±‡ç¼–çš„ç¼–è¯‘å™¨ï¼š <br><br><pre><code class="cpp hljs">language: c compiler: - gcc - clang</code> </pre> <br>  <b>æ³¨æ„</b> ï¼šå¦‚æœæ‚¨æŒ‡å®šå¤šä¸ªç¼–è¯‘å™¨ï¼Œåˆ™å°†ä¸ºæ¯ä¸ªä»»åŠ¡å¹¶è¡Œå¯åŠ¨ä»»åŠ¡ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ–‡æ¡£ä¸­</a>é˜…è¯»æ›´å¤š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å†…å®¹</a> ã€‚ <br><br> åœ¨å¼€å§‹æ„å»ºä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ åˆ†æå™¨å­˜å‚¨åº“ï¼Œå®‰è£…ä¾èµ–é¡¹å’Œå…¶ä»–è½¯ä»¶åŒ…ï¼š <br><br><pre> <code class="cpp hljs">before_install: - sudo add-apt-repository ppa:ubuntu-lxc/daily -y - wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - - sudo wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - sudo apt-get update -qq - sudo apt-get install -qq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates</span></span></code> </pre> <br> åœ¨æ„å»ºé¡¹ç›®ä¹‹å‰ï¼Œæ‚¨éœ€è¦å‡†å¤‡ç¯å¢ƒï¼š <br><br><pre> <code class="cpp hljs">script: - ./coccinelle/run-coccinelle.sh -i - git diff --<span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>-code - <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> CFLAGS=<span class="hljs-string"><span class="hljs-string">"-Wall -Werror"</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> LDFLAGS=<span class="hljs-string"><span class="hljs-string">"-pthread -lpthread"</span></span> - ./autogen.sh - rm -Rf build - mkdir build - cd build - ../configure --enable-tests --with-distro=unknown</code> </pre> <br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå…·æœ‰è®¸å¯è¯çš„æ–‡ä»¶å¹¶è¿è¡Œé¡¹ç›®åˆ†æã€‚ <br><br> ç¬¬ä¸€ä¸ªå‘½ä»¤ä¸ºåˆ†æä»ªåˆ›å»ºè®¸å¯è¯æ–‡ä»¶ã€‚ å˜é‡<i>$ PVS_USERNAME</i>å’Œ<i>$ PVS_KEYçš„</i>æ•°æ®æ¥è‡ªé¡¹ç›®è®¾ç½®ã€‚ <br><br><pre> <code class="cpp hljs">- pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic</code> </pre> <br> ä»¥ä¸‹å‘½ä»¤å¯åŠ¨é¡¹ç›®ç¨‹åºé›†è·Ÿè¸ªï¼š <br><br><pre> <code class="cpp hljs">- pvs-studio-analyzer trace -- make -j4</code> </pre> <br> åœ¨æˆ‘ä»¬å¼€å§‹é™æ€åˆ†æä¹‹åã€‚ <br>  <b>æ³¨æ„ï¼š</b>ä½¿ç”¨è¯•ç”¨è®¸å¯è¯æ—¶ï¼Œå¿…é¡»æŒ‡å®š<i>--disableLicenseExpirationCheck</i>å‚æ•°ã€‚ <br><br><pre> <code class="cpp hljs"> - pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> â€“-disableLicenseExpirationCheck</code> </pre> <br> ä½¿ç”¨æœ€åä¸€æ¡å‘½ä»¤ï¼Œåˆ†æå™¨ç»“æœæ–‡ä»¶å°†è½¬æ¢ä¸ºhtmlæŠ¥å‘Šã€‚ <br><br><pre> <code class="cpp hljs">- plog-converter -t html PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> -o PVS-Studio-${CC}.html</code> </pre> <br> ç”±äºTravisCIä¸å…è®¸æ›´æ”¹ç”µå­é‚®ä»¶é€šçŸ¥çš„æ ¼å¼ï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨sendemailåŒ…åœ¨æœ€åä¸€æ­¥å‘é€æŠ¥å‘Šï¼š <br><br><pre> <code class="cpp hljs">- sendemail -t mail@domain.com -u <span class="hljs-string"><span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span></span> -m <span class="hljs-string"><span class="hljs-string">"PVS-Studio $CC report, commit:$TRAVIS_COMMIT"</span></span> -s smtp.gmail.com:<span class="hljs-number"><span class="hljs-number">587</span></span> -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> PVS-Studio-${CC}.html</code> </pre> <br> ç”¨äºåœ¨è™šæ‹Ÿæœºä¸­è¿è¡Œåˆ†æå™¨çš„é…ç½®æ–‡ä»¶çš„å…¨æ–‡ï¼š <br><br><pre> <code class="cpp hljs">language: c compiler: - gcc - clang before_install: - sudo add-apt-repository ppa:ubuntu-lxc/daily -y - wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - - sudo wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - sudo apt-get update -qq - sudo apt-get install -qq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates script: - ./coccinelle/run-coccinelle.sh -i - git diff --exit-code - export CFLAGS="-Wall -Werror" - export LDFLAGS="-pthread -lpthread" - ./autogen.sh - rm -Rf build - mkdir build - cd build - ../configure --enable-tests --with-distro=unknown - pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic - pvs-studio-analyzer trace -- make -j4 - pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-${CC}.log --disableLicenseExpirationCheck - plog-converter -t html PVS-Studio-${CC}.log -o PVS-Studio-${CC}.html - sendemail -t mail@domain.com -u "PVS-Studio $CC report, commit:$TRAVIS_COMMIT" -m "PVS-Studio $CC report, commit:$TRAVIS_COMMIT" -s smtp.gmail.com:587 -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.log PVS-Studio-${CC}.html</span></span></code> </pre> <br> è¦åœ¨å®¹å™¨ä¸­è¿è¡Œé™æ€åˆ†æå™¨ï¼Œè¯·é¦–å…ˆä½¿ç”¨ä»¥ä¸‹Dockerfileåˆ›å»ºå®ƒï¼š <br><br><pre> <code class="cpp hljs">FROM docker.io/ubuntu:trusty ENV CFLAGS=<span class="hljs-string"><span class="hljs-string">"-Wall -Werror"</span></span> ENV LDFLAGS=<span class="hljs-string"><span class="hljs-string">"-pthread -lpthread"</span></span> RUN apt-get update &amp;&amp; apt-get install -y software-properties-common wget \ &amp;&amp; wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - \ &amp;&amp; wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list \ &amp;&amp; apt-get update \ &amp;&amp; apt-get install -yqq coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls-dev libselinux1-dev linux-libc-dev pvs-studio git libtool autotools-dev automake pkg-config clang make libio-socket-ssl-perl libnet-ssleay-perl sendemail ca-certificates \ &amp;&amp; rm -rf /var/lib/apt/lists/*</span></span></code> </pre> <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé…ç½®æ–‡ä»¶å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="cpp hljs">before_install: - docker pull docker.io/oandreev/lxc env: - CC=gcc - CC=clang script: - docker run --rm --cap-add SYS_PTRACE -v $(pwd):/pvs -w /pvs docker.io/oandreev/lxc /bin/bash -c <span class="hljs-string"><span class="hljs-string">" ./coccinelle/run-coccinelle.sh -i &amp;&amp; git diff --exit-code &amp;&amp; ./autogen.sh &amp;&amp; mkdir build &amp;&amp; cd build &amp;&amp; ../configure CC=$CC &amp;&amp; pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic &amp;&amp; pvs-studio-analyzer trace -- make -j4 &amp;&amp; pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic -o PVS-Studio-$CC.log --disableLicenseExpirationCheck &amp;&amp; plog-converter -t html -o PVS-Studio-$CC.html PVS-Studio-$CC.log &amp;&amp; sendemail -t mail@domain.com -u 'PVS-Studio $CC report, commit:$TRAVIS_COMMIT' -m 'PVS-Studio $CC report, commit:$TRAVIS_COMMIT' -s smtp.gmail.com:587 -xu $MAIL_USER -xp $MAIL_PASSWORD -o tls=yes -f $MAIL_USER -a PVS-Studio-${CC}.log PVS-Studio-${CC}.html"</span></span></code> </pre> <br> å¦‚æ‚¨æ‰€è§ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ²¡æœ‰åœ¨è™šæ‹Ÿæœºå†…åšä»»ä½•äº‹æƒ…ï¼Œå¹¶ä¸”ç»„è£…å’Œæµ‹è¯•é¡¹ç›®çš„æ‰€æœ‰æ“ä½œç»å¯¹éƒ½åœ¨å®¹å™¨å†…è¿›è¡Œã€‚ <br><br>  <b>æ³¨æ„</b> ï¼šå¯åŠ¨å®¹å™¨æ—¶ï¼Œå¿…é¡»æŒ‡å®š<i>--cap-add SYS_PTRACE</i>æˆ–<i>--security-opt seccompï¼šunconfinedå‚æ•°</i> ï¼Œå› ä¸ºptraceç³»ç»Ÿè°ƒç”¨ç”¨äºç¼–è¯‘è·Ÿè¸ªã€‚ <br><br> æˆ‘ä»¬å°†é…ç½®æ–‡ä»¶åŠ è½½åˆ°å­˜å‚¨åº“çš„æ ¹ç›®å½•ä¸­ï¼Œç„¶åçœ‹åˆ°Travis CIæ”¶åˆ°æœ‰å…³é¡¹ç›®ä¸­å­˜åœ¨æ›´æ”¹çš„é€šçŸ¥ï¼Œå¹¶è‡ªåŠ¨å¯åŠ¨äº†ç¨‹åºé›†ã€‚ <br><br> å¯ä»¥åœ¨æ§åˆ¶å°ä¸­æŸ¥çœ‹æœ‰å…³ç»„è£…è¿›åº¦å’Œåˆ†æä»ªéªŒè¯çš„è¯¦ç»†ä¿¡æ¯ã€‚ <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/00a/846/95d/00a84695de9e00013c89760219f5292e.png" alt="å›¾ç‰‡2"></div><br> æµ‹è¯•å®Œæˆåï¼Œæˆ‘ä»¬å°†åœ¨é‚®ä»¶ä¸­æ”¶åˆ°2ä¸ªå­—æ¯ï¼šä¸€ä¸ªå¸¦æœ‰ä½¿ç”¨gccæ„å»ºé¡¹ç›®çš„é™æ€åˆ†æç»“æœï¼Œç¬¬äºŒä¸ªå¸¦æœ‰clangã€‚ <br><br><h2> ç®€è¦ä»‹ç»ä¸€ä¸‹æµ‹è¯•ç»“æœ </h2><br> æ€»çš„æ¥è¯´ï¼Œè¯¥é¡¹ç›®éå¸¸å¹²å‡€ï¼Œåˆ†æä»ªä»…å‘å‡º24æ¬¡ä¸¥é‡è­¦å‘Šå’Œ46æ¬¡å¹³å‡è­¦å‘Šã€‚ ä¸ºäº†æ¼”ç¤ºè¿™é¡¹å·¥ä½œï¼Œè¯·è€ƒè™‘å‡ ä¸ªæœ‰è¶£çš„é€šçŸ¥ï¼š <br><br><h3>  ifä¸­çš„å†—ä½™æ¡ä»¶ </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V590</a>è€ƒè™‘æ£€æŸ¥'retï¼=ï¼ˆ-1ï¼‰&amp;&amp; ret == 1'è¡¨è¾¾å¼ã€‚ è¡¨è¾¾å¼è¿‡å¤šæˆ–æ‰“å°é”™è¯¯ã€‚ é™„ä»¶107 <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EOF -1 static struct lxc_proc_context_info *lxc_proc_get_context_info(pid_t pid) { .... while (getline(&amp;</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">line</span></span></span><span class="hljs-meta">, &amp;line_bufsz, proc_file) != -1) { ret = sscanf(</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">line</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CapBnd: %llx"</span></span></span><span class="hljs-meta">, &amp;info-&gt;capability_mask); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (ret != EOF &amp;&amp; ret == 1) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// &lt;= { found = true; break; } } .... }</span></span></span></span></code> </pre> <br> å¦‚æœ<i>ret == 1</i> ï¼Œé‚£ä¹ˆå®ƒç»å¯¹ä¸ç­‰äº-1ï¼ˆEOFï¼‰ã€‚ éªŒè¯è¿‡å¤šï¼Œ <i>retï¼= EOF</i>å¯ä»¥åˆ é™¤ã€‚ <br><br> å‘å‡ºäº†å¦å¤–ä¸¤ä¸ªè­¦å‘Šï¼š <br><br><ul><li>  V590è€ƒè™‘æ£€æŸ¥'retï¼=ï¼ˆ-1ï¼‰&amp;&amp; ret == 1'è¡¨è¾¾å¼ã€‚ è¡¨è¾¾å¼è¿‡å¤šæˆ–æ‰“å°é”™è¯¯ã€‚ é™„ä»¶579 </li><li>  V590è€ƒè™‘æ£€æŸ¥'retï¼=ï¼ˆ-1ï¼‰&amp;&amp; ret == 1'è¡¨è¾¾å¼ã€‚ è¡¨è¾¾å¼è¿‡å¤šæˆ–æ‰“å°é”™è¯¯ã€‚ é™„ä»¶c.583 </li></ul><br><h3> é«˜ä½ä¸¢å¤± </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V784</a>ä½æ©ç çš„å¤§å°å°äºç¬¬ä¸€ä¸ªæ“ä½œæ•°çš„å¤§å°ã€‚ è¿™å°†å¯¼è‡´ä¸¢å¤±æ›´é«˜çš„ä½ã€‚  1879å¹´çš„ä¼šè®® <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mount_opt</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *name; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> clear; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> flag; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_mntopt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *opt, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *flags, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mount_opt</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mo</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* If opt is found in mount_opt, set or clear flags. * Otherwise append it to data. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (mo = &amp;mount_opt[<span class="hljs-number"><span class="hljs-number">0</span></span>]; mo-&gt;name != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; mo++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(opt, mo-&gt;name, <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(mo-&gt;name)) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mo-&gt;clear) { *flags &amp;= ~mo-&gt;flag; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } else { *flags |= mo-&gt;flag; } return; } } .... }</span></span></code> </pre> <br> åœ¨Linuxä¸‹ï¼Œ <i>long</i>æ˜¯64ä½æ•´æ•°å˜é‡ï¼Œ <i>mo-&gt;æ ‡å¿—</i>æ˜¯32ä½æ•´æ•°å˜é‡ã€‚ ä½¿ç”¨<i>mo-&gt;æ ‡å¿—</i>ä½œä¸ºä½æ©ç å°†å¯¼è‡´ä¸¢å¤±32ä¸ªæœ€é«˜æœ‰æ•ˆä½ã€‚ åœ¨æŒ‰ä½æ±‚ååï¼Œå°†ä½æ©ç éšå¼è½¬æ¢ä¸º64ä½æ•´æ•°å˜é‡ã€‚ æ­¤æ©ç çš„é«˜ä½å°†ä¸ºé›¶ã€‚ <br><br> ä¸¾ä¾‹è¯´æ˜ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> x; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> y; .... x &amp;= ~y;</code> </pre> <br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1a3/59f/a71/1a359fa7163d8a99c8632ffc17cf7eb0.png" alt="å›¾ç‰‡3"></div><br><br> æ­£ç¡®çš„ä»£ç æ˜¯ï¼š <br><br><pre> <code class="cpp hljs">*flags &amp;= ~(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)(mo-&gt;flag);</code> </pre> <br> åˆ†æä»ªå‘å‡ºäº†å¦ä¸€ä¸ªç±»ä¼¼çš„è­¦å‘Šï¼š <br><br><ul><li>  V784ä½æ©ç çš„å¤§å°å°äºç¬¬ä¸€ä¸ªæ“ä½œæ•°çš„å¤§å°ã€‚ è¿™å°†å¯¼è‡´ä¸¢å¤±æ›´é«˜çš„ä½ã€‚  1933å¹´ </li></ul><br><h3> å¯ç–‘å‘¨æœŸ </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V612</a>å¾ªç¯å†…æ— æ¡ä»¶çš„â€œè¿”å›â€ã€‚  3477å·ä¼šè®® <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> lxc_list_for_each(__iterator, __list) \ for (__iterator = (__list)-&gt;next; __iterator != __list; \ __iterator = __iterator-&gt;next) static bool verify_start_hooks(struct lxc_conf *conf) { char path[PATH_MAX]; struct lxc_list *it; lxc_list_for_each (it, &amp;conf-&gt;hooks[LXCHOOK_START]) { int ret; char *hookname = it-&gt;elem; ret = snprintf(path, PATH_MAX, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%s%s"</span></span></span><span class="hljs-meta">, conf-&gt;rootfs.path ? conf-&gt;rootfs.mount : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">, hookname); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (ret </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; 0 || ret &gt;= PATH_MAX) return false; ret = access(path, X_OK); if (ret &lt; 0) { SYSERROR("Start hook \"%s\" not found in container", hookname); return false; } return true; // &lt;= } return true; }</span></span></span></span></code> </pre> <br> å¾ªç¯å¼€å§‹ï¼Œå¹¶åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£æ—¶ä¸­æ–­ã€‚ ä¹Ÿè®¸è¿™æ˜¯æœ‰æ„çš„ï¼Œä½†æ˜¯å¯ä»¥çœç•¥è¯¥å¾ªç¯ã€‚ <br><br><h3> è¶…è¶Šæ•°ç»„çš„ç•Œé™ </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V557</a>é˜µåˆ—æ¬ è½½æ˜¯å¯èƒ½çš„ã€‚  â€œå­—èŠ‚-1â€ç´¢å¼•çš„å€¼å¯èƒ½è¾¾åˆ°-1ã€‚ ç½‘ç»œ.c 2570 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lxc_create_network_unpriv_exec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *lxcpath, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *lxcname, struct lxc_netdev *netdev, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">pid_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pid, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hooks_version)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bytes; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buffer[PATH_MAX] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; .... bytes = lxc_read_nointr(pipefd[<span class="hljs-number"><span class="hljs-number">0</span></span>], &amp;buffer, PATH_MAX); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytes &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { SYSERROR(<span class="hljs-string"><span class="hljs-string">"Failed to read from pipe file descriptor"</span></span>); close(pipefd[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { buffer[bytes - <span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; } .... }</code> </pre> <br> å­—èŠ‚ä»ç®¡é“è¯»å…¥ç¼“å†²åŒºã€‚ å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œ <i>lxc_read_nointr</i>å‡½æ•°å°†è¿”å›è´Ÿå€¼ã€‚ å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œåˆ™å°†nullç»ˆç«¯å†™å…¥æœ€åä¸€ä¸ªå…ƒç´ ã€‚ ä½†æ˜¯ï¼Œå¦‚æœè¯»å–0å­—èŠ‚ï¼Œåˆ™ç¼“å†²åŒºå°†è¶…å‡ºèŒƒå›´ï¼Œè¿™å°†å¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºã€‚ <br><br> åˆ†æä»ªå‘å‡ºäº†å¦ä¸€ä¸ªç±»ä¼¼çš„è­¦å‘Šï¼š <br><br><ul><li>  V557é˜µåˆ—æ¬ è½½æ˜¯å¯èƒ½çš„ã€‚  â€œå­—èŠ‚-1â€ç´¢å¼•çš„å€¼å¯èƒ½è¾¾åˆ°-1ã€‚ ç½‘ç»œ.c 2725 </li></ul><br><h3> ç¼“å†²åŒºæº¢å‡º </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V576</a>æ ¼å¼é”™è¯¯ã€‚ è€ƒè™‘æ£€æŸ¥â€œ sscanfâ€å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå®é™…å‚æ•°ã€‚ ä½¿ç”¨ä¸å¸¦å®½åº¦è¯´æ˜çš„å­—ç¬¦ä¸²è¯´æ˜ç¬¦å¾ˆå±é™©ã€‚ ç¼“å†²åŒºæº¢å‡ºæ˜¯å¯èƒ½çš„ã€‚  lxc_unshare.c 205 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lookup_user</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *oparg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uid_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *uid)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> name[PATH_MAX]; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(oparg, <span class="hljs-string"><span class="hljs-string">"%u"</span></span>, uid) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* not a uid -- perhaps a username */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(oparg, <span class="hljs-string"><span class="hljs-string">"%s"</span></span>, name) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { free(buf); return false; } .... } .... }</span></span></code> </pre> <br> åœ¨è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨<i>sscanf</i>å¯èƒ½ä¼šå¾ˆå±é™©ï¼Œå› ä¸ºå¦‚æœ<i>oparq</i>ç¼“å†²åŒºçš„é•¿åº¦å¤§äº<i>åç§°</i>ç¼“å†²åŒºçš„é•¿åº¦ï¼Œåˆ™åœ¨å½¢æˆ<i>åç§°</i>ç¼“å†²åŒºæ—¶å®ƒå°†<i>æ¶ˆå¤±</i> ã€‚ <br><br><h2> ç»“è®º </h2><br> å¦‚æˆ‘ä»¬æ‰€è§ï¼Œåœ¨äº‘ä¸­ä¸ºæˆ‘ä»¬çš„é¡¹ç›®è®¾ç½®é™æ€ä»£ç åˆ†æå™¨æ£€æŸ¥æ˜¯ä¸€é¡¹ç›¸å½“ç®€å•çš„ä»»åŠ¡ã€‚ ä¸ºæ­¤ï¼Œæ‚¨åªéœ€è¦å‘å­˜å‚¨åº“ä¸­æ·»åŠ ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶èŠ±è´¹æœ€å°‘çš„æ—¶é—´æ¥è®¾ç½®CIç³»ç»Ÿã€‚ ç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå·¥å…·ï¼Œè¯¥å·¥å…·ä½¿æ‚¨å¯ä»¥åœ¨ç¼–å†™é˜¶æ®µè¯†åˆ«å‡ºæœ‰é—®é¢˜çš„ä»£ç ï¼Œå¹¶ä¸”ä¸å…è®¸é”™è¯¯è¿›å…¥ä¸‹ä¸€é˜¶æ®µçš„æµ‹è¯•ï¼Œåœ¨è¯¥é˜¶æ®µçš„çº æ­£å°†èŠ±è´¹æ›´å¤šçš„æ—¶é—´å’Œèµ„æºã€‚ <br><br> å½“ç„¶ï¼Œç»“åˆä½¿ç”¨PVS-Studioå’Œäº‘å¹³å°ä¸é™äºTravis CIã€‚ ä¸æœ¬æ–‡ä¸­æè¿°çš„æ–¹æ³•ç±»ä¼¼ï¼ŒPVS-Studioåˆ†æå¯ä»¥ä¸å…¶ä»–æµè¡Œçš„åŸºäºäº‘çš„CIè§£å†³æ–¹æ¡ˆï¼ˆä¾‹å¦‚CircleCIï¼ŒGitLabç­‰ï¼‰é›†æˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å·®å¼‚æœ€å°ã€‚ <br><br><h2> æœ‰ç”¨çš„é“¾æ¥ </h2><br><ul><li> å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>æ‰¾åˆ°æœ‰å…³åœ¨Linuxå’ŒMacOSä¸Šå¯åŠ¨PVS-Studioçš„å…¶ä»–ä¿¡æ¯ã€‚ </li><li> æ‚¨å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ­¤å¤„</a>é˜…è¯»æœ‰å…³ä½¿ç”¨å·²å®‰è£…çš„PVS-Studioé™æ€åˆ†æå™¨åˆ›å»ºï¼Œé…ç½®å’Œä½¿ç”¨å®¹å™¨çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¿¡æ¯</a> ã€‚ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TravisCIæ–‡æ¡£</a> ã€‚ </li></ul><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png" align="left"></a> </p><br><br> å¦‚æœæ‚¨æƒ³ä¸è®²è‹±è¯­çš„è¯»è€…åˆ†äº«è¿™ç¯‡æ–‡ç« ï¼Œè¯·ä½¿ç”¨ç¿»è¯‘é“¾æ¥ï¼šOleg Andreevã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº‘ä¸­çš„PVS-Studio-åœ¨Travis CIä¸Šè¿è¡Œåˆ†æ</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN458072/">https://habr.com/ru/post/zh-CN458072/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN458060/index.html">åœ¨Unityå¼•æ“ä¸­åˆ›å»ºè‰ç€è‰²å™¨</a></li>
<li><a href="../zh-CN458062/index.html">UserGateå¹³å°æ¦‚è¿°</a></li>
<li><a href="../zh-CN458064/index.html">äº‘ä¸­çš„PVS-Studio-åœ¨Travis CIä¸Šè¿è¡Œåˆ†æ</a></li>
<li><a href="../zh-CN458068/index.html">PVS-Studio for Visual Studio</a></li>
<li><a href="../zh-CN458070/index.html">PVS-Studio for Visual Studio</a></li>
<li><a href="../zh-CN458074/index.html">è¯­è¨€ï¼šORMé€‰æ‹©</a></li>
<li><a href="../zh-CN458076/index.html">é€šè¿‡MLå†³ç­–è¿›è¡Œè¥é”€</a></li>
<li><a href="../zh-CN458080/index.html">7æœˆ25æ—¥ï¼Œè«æ–¯ç§‘-QIWI iOSèšä¼š</a></li>
<li><a href="../zh-CN458084/index.html">ç²¾é€‰äº†50ç§æœ‰å…³éŸ³ä¹å®¶çš„æ”¶å…¥ï¼Œæ¸¸æˆå’Œç”µå½±ä¸­çš„å£°éŸ³ï¼Œä¸å¯»å¸¸çš„ä¹å™¨ä»¥åŠè¢«é—å¿˜çš„å¤è€ä¹å™¨çš„èµ„æ–™</a></li>
<li><a href="../zh-CN458088/index.html">é€‚ç”¨äºæ—§è®¡ç®—æœºçš„æœ€ä½³Linuxå‘è¡Œç‰ˆ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>