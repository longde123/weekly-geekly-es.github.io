<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïã ‚òùüèΩ üìå C√≥mo ense√±arle a una m√°quina a comprender facturas y extraer datos de ellas üÜí „äóÔ∏è üï¥üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! Mi nombre es Stanislav Semenov, estoy trabajando en tecnolog√≠as para extraer datos de documentos en R&D ABBYY. En este art√≠culo hablar√© sob...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo ense√±arle a una m√°quina a comprender facturas y extraer datos de ellas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/abbyy/blog/440310/"><img src="https://habrastorage.org/webt/2o/qf/kq/2oqfkqjdbn7eidnnxrinw9f2p_q.png" align="left">  Hola Habr!  Mi nombre es Stanislav Semenov, estoy trabajando en tecnolog√≠as para extraer datos de documentos en R&amp;D ABBYY.  En este art√≠culo hablar√© sobre los enfoques b√°sicos para el procesamiento de documentos semiestructurados (facturas, recibos de efectivo, etc.) que utilizamos recientemente y que estamos utilizando en este momento.  Y hablaremos sobre c√≥mo los m√©todos de aprendizaje autom√°tico son aplicables para resolver este problema. <br><a name="habracut"></a><br>  Consideraremos las facturas como documentos, porque  en el mundo est√°n muy extendidos y tienen mayor demanda en t√©rminos de extracci√≥n de datos.  Por cierto, el procesamiento autom√°tico de facturas es uno de los escenarios m√°s populares entre nuestros clientes extranjeros.  Por ejemplo, con ABBYY FlexiCapture, American PepsiCo Imaging Technology <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">redujo el</a> tiempo de procesamiento de facturas y la cantidad de errores debidos al ingreso manual, mientras que el minorista europeo Sportina <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">comenz√≥ a ingresar datos</a> de cuentas en sistemas contables <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2 veces m√°s r√°pido</a> . <br><br>  <b>Las facturas</b> son documentos que se utilizan en la pr√°ctica comercial internacional y son de gran importancia para los negocios.  Algo similar a una factura en Rusia es, por ejemplo, una hoja de ruta.  Los datos de dichos documentos se encuentran en varios sistemas de contabilidad, y los errores all√≠, por decirlo suavemente, no son bienvenidos. <br><br>  Una factura ordinaria puede considerarse bastante estructurada; contiene dos clases principales de objetos: <br><br><ul><li>  varios campos del encabezado (n√∫mero de documento, fecha, remitente, destinatario, total, etc.), </li><li>  Los datos tabulares son una lista de bienes y servicios (cantidad, precio, descripci√≥n, etc.). </li></ul><br>  As√≠ es como se ve: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4s/9q/os/4s9qosz-tt19mh-3o_ogsnrmmx8.jpeg"></div><br><br>  Millones de horas hombre se gastan anualmente en el procesamiento de facturas.  Y es muy costoso.  Seg√∫n diversas estimaciones, para una empresa, el procesamiento de una factura en papel cuesta de $ 10 a $ 40, donde una parte importante de estos costos es mano de obra manual para ingresar y conciliar datos. <br><br>  Hay empresas que procesan millones de facturas por mes.  Para hacer esto, contienen un equipo completo de cientos, y algunas veces miles de personas.  Es f√°cil estimar que un aumento en la precisi√≥n del reconocimiento o la eficiencia de extracci√≥n de datos de solo el 1% puede reducir los costos de las grandes empresas en cientos de miles e incluso millones de d√≥lares anualmente. <br><br>  Por otro lado, hay una cantidad catastr√≥fica de documentos.  En 2017, Billentis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estim√≥ el</a> n√∫mero total de facturas / facturas generadas por a√±o en el mundo en 400 mil millones.  De estos, solo alrededor del 10% eran electr√≥nicos, y el resto requiere una entrada totalmente manual o una participaci√≥n humana intensiva.  Si imprime 400 mil millones de documentos en papel A4 est√°ndar, ¬°son miles de camiones de papel por d√≠a, o una pila de papel de aproximadamente una altura humana por segundo! <br><br><h2>  Algunas palabras sobre c√≥mo se desarroll√≥ la tecnolog√≠a <br></h2><br><br><img src="https://habrastorage.org/webt/cf/ck/pu/cfckpuf7coz-jabhthmcxmq8nr8.png" alt="imagen"><br><br>  Muchas compa√±√≠as est√°n desarrollando software especializado que puede reconocer documentos y extraer datos de ellos.  Pero la calidad del procesamiento de facturas a√∫n no es perfecta.  "¬øCu√°l es el problema?"  - usted pregunta <br><br>  Se trata de una gran variedad de facturas.  No existen est√°ndares para las facturas, y cada compa√±√≠a es libre de crear su propia versi√≥n del documento: el tipo, la estructura y la ubicaci√≥n de los campos. <br><br><h3>  Buscar campos por palabras clave <br></h3><br>  Los primeros intentos de extraer datos se redujeron a encontrar palabras clave especiales entre todas las palabras reconocidas, como, por ejemplo, N√∫mero de factura o Total, y luego en el peque√±o vecindario de estas palabras, por ejemplo, a la derecha o al final, para encontrar los significados por s√≠ mismas. <br><br>  <i>Ubicaci√≥n del n√∫mero de factura en diferentes facturas (se puede hacer clic):</i> <br><br> <a href=""><img src="https://habrastorage.org/webt/yn/ci/e0/yncie0dj7-4xll_bgcg3or_6ofu.jpeg"></a> <br><br>  Se program√≥ toda la l√≥gica, que existen tales campos, est√°n en tal y tal lugar del documento, alrededor de ellos hay otros campos a algunas distancias.  Y esto de alguna manera funcion√≥ hasta que apareci√≥ otra compa√±√≠a, que comenz√≥ a enviar sus documentos en una forma completamente diferente.  O la compa√±√≠a anterior cambi√≥ repentinamente el formato y todo dej√≥ de funcionar. <br><br><h3>  Patrones <br></h3><br>  Combatir esto, cada vez que reprogramaba algo, era irracional.  Por lo tanto, un nuevo paradigma vino al rescate: el uso de plantillas.  <b>Una plantilla</b> es un conjunto de campos que deben encontrarse en un documento y un conjunto de reglas sobre c√≥mo encontrar estos campos.  La principal ventaja aqu√≠ es que las plantillas se crean visualmente.  Por ejemplo, queremos buscar el N√∫mero de factura y el Total, seleccionar estos campos y configurar los par√°metros para que tal y tal campo aparezca inmediatamente despu√©s de tal y tal palabra clave, se encuentra en la parte superior del documento y contiene n√∫meros y signos de puntuaci√≥n. <br><br>  Se desarrollaron herramientas especializadas, los llamados editores de plantillas, donde los usuarios ya avanzados sin la ayuda de programadores pod√≠an establecer r√°pidamente alg√∫n tipo de l√≥gica manualmente.  Tan pronto como lleg√≥ un documento de un nuevo formulario, se cre√≥ una plantilla para √©l y todo comenz√≥ a funcionar m√°s o menos. <br><br>  <i>Plantilla de muestra (clicable):</i> <br> <a href=""><img src="https://habrastorage.org/webt/pk/wo/ak/pkwoakbxejcxdy3iwy5e83ql1ta.jpeg"></a> <br><br>  Pero para hacer una plantilla no es suficiente, deben hacerse cientos e incluso miles.  Y, por lo tanto, configurar un producto para cada cliente a veces puede llevar mucho tiempo.  Es imposible crear plantillas "universales" de antemano, que cubrir√°n toda la variedad de facturas. <br><br>  Usando plantillas, puede mejorar significativamente la calidad de la recuperaci√≥n de la tabla.  Pero a menudo se encuentran estructuras de tablas complejas, con representaci√≥n de datos no est√°ndar, varios niveles de anidamiento, y las plantillas en estos casos no siempre funcionan bien.  De nuevo, debe escribir algunos scripts que contienen muchos par√°metros, condiciones, excepciones, etc. seleccionados manualmente. <br><br><h2>  Usando Machine Learning <br></h2><br>  La tecnolog√≠a actual no se detiene, y con el desarrollo del aprendizaje autom√°tico, fue posible transferir la tarea de extraer datos de documentos a redes neuronales. <br><br>  Hoy en d√≠a, hay varios enfoques b√°sicos que se utilizan en la pr√°ctica: <br><br><ul><li>  <b>El primer enfoque</b> es trabajar directamente con la imagen de entrada del documento.  Es decir, una imagen (imagen) o fragmento se alimenta a la entrada de la red, y la red aprende a encontrar √°reas peque√±as donde se encuentran los campos necesarios, y luego el texto en estas √°reas se reconoce utilizando las tecnolog√≠as cl√°sicas de OCR (reconocimiento √≥ptico de caracteres).  Esta es una soluci√≥n integral que se puede implementar r√°pidamente.  Puede tomar una red preparada para buscar objetos en im√°genes, por ejemplo, YOLO o F-R-CNN m√°s r√°pida y entrenarla en im√°genes marcadas de documentos. <br><br>  La desventaja de este enfoque no es la mejor calidad de los datos extra√≠dos y la dificultad de extraer tablas.  De hecho, este enfoque es de alguna manera similar a la tarea de encontrar las palabras correctas en la imagen (localizaci√≥n de palabras), un problema fundamental del campo de la visi√≥n por computadora, solo que aqu√≠ no buscamos las palabras, sino los campos necesarios. </li><li>  <b>El segundo enfoque</b> es procesar el texto extra√≠do del documento.  Puede ser texto de un PDF o un documento OCR de p√°gina completa.  Utiliza la tecnolog√≠a de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">procesamiento de lenguaje natural (PNL)</a> .  Las l√≠neas se ensamblan a partir de palabras individuales, varios fragmentos de texto, p√°rrafos o columnas se forman a partir de l√≠neas, y en ellos la red ya est√° aprendiendo a distinguir varias entidades nombradas NER (Reconocimiento de entidades con nombre). <br><br>  Son posibles varias formas de formar fragmentos de texto.  Puede combinar el primer y el segundo enfoque, entrenar una red para encontrar bloques grandes con cierta informaci√≥n en las im√°genes, por ejemplo, datos sobre el remitente o datos sobre el destinatario, que contiene inmediatamente el nombre, direcci√≥n, detalles, etc., y luego transferir el texto de cada bloque a la segunda red NER. <br><br>  La calidad de este enfoque puede ser m√°s alta que solo en el primer enfoque, pero es bastante dif√≠cil construir un modelo efectivo.  Hoy en d√≠a, hay modelos bastante avanzados, por ejemplo, LSTM-CRF para NER, que pueden etiquetar palabras en el texto y definir entidades. </li><li>  <b>El tercer enfoque</b> es construir una representaci√≥n sem√°ntica del documento sin referencia al tipo de documento, es decir.  cuando no sabemos cu√°l es el documento que tenemos delante, pero tratamos de entenderlo durante el procesamiento.  Un conjunto de palabras del documento con sus diversos atributos (por ejemplo, si la palabra contiene solo letras o es un n√∫mero), la disposici√≥n geom√©trica de las palabras (coordenadas, sangr√≠as) y con varios delimitadores y conexiones identificadas durante el an√°lisis de imagen, se alimenta a la entrada de la red y la salida se obtiene para Cada palabra tiene su propio conjunto espec√≠fico de caracter√≠sticas.  En funci√≥n de las caracter√≠sticas obtenidas, se forman varios conjuntos de hip√≥tesis de posibles campos o tablas, que se clasifican y eval√∫an mediante un clasificador adicional.  Luego se selecciona la hip√≥tesis m√°s confiable de la estructura y el contenido del documento. <br><br>  Esto es t√©cnicamente la soluci√≥n m√°s dif√≠cil, pero puede resolver el problema de extraer datos de documentos de manera general. </li></ul><br><h2>  ¬øC√≥mo usamos las redes neuronales? <br></h2><br>  En ABBYY no solo monitoreamos de cerca los logros de la ciencia y la tecnolog√≠a, sino que tambi√©n creamos nuestras propias tecnolog√≠as avanzadas y las implementamos en varios productos. <br><br>  La siguiente figura muestra la arquitectura general de nuestra soluci√≥n utilizando redes neuronales. <br><br>  <i>Imagen en la que se puede hacer clic</i> <br> <a href=""><img src="https://habrastorage.org/webt/jx/gp/qn/jxgpqnpbllbnksrkcpvuhfably8.png"></a> <br><br>  Toda la p√°gina del documento se alimenta a la entrada de red.  Usando capas convolucionales (CNN), se forman varias caracter√≠sticas geom√©tricas, por ejemplo, la posici√≥n relativa de las palabras entre s√≠.  Adem√°s, estos signos se combinan con la representaci√≥n vectorial de palabras reconocidas (incrustaciones de palabras) y se sirven en capas recurrentes (LSTM) y completamente conectadas.  Hay varias capas de salida diferentes (aprendizaje de tareas m√∫ltiples), cada salida resuelve su propio problema: <br><br><ul><li>  determinaci√≥n del tipo de campo al que puede corresponder la palabra, </li><li>  hip√≥tesis de los l√≠mites de la mesa, </li><li>  hip√≥tesis de filas de tablas, l√≠mites de columnas, etc. </li></ul><br>  Si el documento es de varias p√°ginas, la red realiza su predicci√≥n para cada p√°gina individual y, a continuaci√≥n, los resultados se combinan. <br><br>  Luego, las hip√≥tesis se forman a partir de la posible disposici√≥n de campos y tablas, con la ayuda de una funci√≥n de regresi√≥n entrenada por separado, se eval√∫an y gana la hip√≥tesis m√°s segura. <br>  Para aumentar la precisi√≥n de la extracci√≥n de datos, adem√°s de separar los documentos por tipo (cheque, factura, contrato, etc.), se produce una agrupaci√≥n adicional dentro de su tipo de acuerdo con caracter√≠sticas adicionales. <br><br>  Por ejemplo, para las facturas puede ser un proveedor o simplemente una apariencia (de acuerdo con el grado de similitud de la ubicaci√≥n de los campos).  Y luego, dependiendo de un grupo particular (cl√∫ster), se aplican configuraciones de algoritmos espec√≠ficos.  T√©cnicamente, al tener ejemplos de facturas marcadas correctamente para diferentes grupos, es posible en el lado del usuario volver a capacitar los mecanismos para evaluar y elegir las hip√≥tesis correctas. <br><br>  Para configurar todo tipo de par√°metros de nuestros algoritmos y redes neuronales, utilizamos el m√©todo de evoluci√≥n diferencial, que se ha demostrado muy bien en la pr√°ctica. <br><br><h2>  Nuestros resultados de aprendizaje autom√°tico <br></h2><br><img src="https://habrastorage.org/webt/sj/0p/_h/sj0p_hpgpcue0u20mjar__vdrdc.jpeg" align="right"><ul><li>  El m√©todo desarrollado para extraer datos de documentos estructurados utilizando el aprendizaje autom√°tico en muchos casos muestra mejores resultados que las soluciones programadas basadas en heur√≠stica.  La ganancia de calidad en varias m√©tricas var√≠a de varias unidades a decenas de por ciento en varias entidades extra√≠bles. </li><li>  Existe una ventaja innegable sobre el enfoque cl√°sico: la capacidad de volver a capacitar a la red con nuevos datos.  En el caso de una variedad de formas de documentos, ahora esto no es un problema, sino m√°s bien una necesidad.  Cuantos m√°s, mejor;  cuanto mayor sea la capacidad de la red para generalizar y mayor ser√° la calidad. </li><li>  Hubo una oportunidad para lanzar la llamada soluci√≥n "lista para usar", cuando el usuario simplemente instala el producto (de hecho, una red capacitada), y todo comienza a funcionar inmediatamente con un resultado aceptable.  No hay necesidad de programar nada, personalizar largas y dolorosamente las plantillas, seleccionar todo tipo de par√°metros. </li></ul><br>  Un detalle importante que tambi√©n me gustar√≠a mencionar son los datos.  Ning√∫n aprendizaje autom√°tico puede suceder sin datos de calidad.  El aprendizaje autom√°tico ofrece mejores resultados que la ingenier√≠a del conocimiento, solo si hay una cantidad suficiente de datos etiquetados.  En el caso de las facturas, se trata de decenas de miles de documentos etiquetados manualmente, y esta cifra est√° en constante crecimiento. <br><br>  Adem√°s, utilizamos mecanismos avanzados de aumento de datos, cambiamos los nombres de organizaciones, direcciones, listas de productos y tipos de servicios en tablas, fechas, diversas caracter√≠sticas cuantitativas, como precio, cantidad, costo, etc.  Tambi√©n cambiamos la secuencia de varias entidades en los documentos, lo que nos permite generar millones de documentos completamente diferentes para la capacitaci√≥n. <br><br><h2>  En lugar de una conclusi√≥n </h2><br>  En conclusi√≥n, podemos decir que la programaci√≥n, por supuesto, no ha desaparecido, sino que est√° cambiando gradualmente su papel.  Con cada nuevo d√≠a, el aprendizaje autom√°tico comienza a hacer frente a las tareas que se le asignan cada vez mejor en una variedad de industrias, desplazando los enfoques cl√°sicos.  La ventaja innegable del aprendizaje autom√°tico en la eficiencia: docenas de a√±os de trabajo intelectual cuestan docenas de horas de aprendizaje.  Por lo tanto, en el futuro cercano vemos un mayor desarrollo y aplicabilidad de las redes en todos nuestros desarrollos.  Y si est√° interesado, siempre estamos abiertos a sugerencias y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cooperaci√≥n</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/440310/">https://habr.com/ru/post/440310/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../440300/index.html">10 comandos de consola para ayudar a debatir el c√≥digo JavaScript como un PRO</a></li>
<li><a href="../440302/index.html">CRM: costo de √©xito, costo de error, costo de propiedad</a></li>
<li><a href="../440304/index.html">Interrupciones de dispositivos externos en un sistema x86. Parte 3. Configuraci√≥n del enrutamiento de interrupci√≥n en el conjunto de chips utilizando el ejemplo coreboot</a></li>
<li><a href="../440306/index.html">Escalado de bases de datos en sistemas altamente cargados</a></li>
<li><a href="../440308/index.html">Divide y conquista, o escribe lentamente - lee r√°pidamente</a></li>
<li><a href="../440312/index.html">Hackquest 2018. Resultados y rese√±as. D√≠a 4-7</a></li>
<li><a href="../440314/index.html">Candidato de lanzamiento de JDK 12: Shenandoah, G1, JMH, Arm64. Los insectos en Swing contraatacan</a></li>
<li><a href="../440316/index.html">Distribuci√≥n uniforme de puntos en un tri√°ngulo.</a></li>
<li><a href="../440318/index.html">GDPR: c√≥mo trabajar con los datos personales de sus empleados, aut√≥nomos y empleados de contraparte europeos</a></li>
<li><a href="../440320/index.html">Mientras nosotros en el contador DMRSE Yandex registramos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>