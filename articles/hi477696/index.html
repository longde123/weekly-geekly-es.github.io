<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЪБ ЁЯд╢ЁЯП┐ ЁЯПе рдЯреАрдПрд▓рдПрд╕ 1.3 рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдлреНрд░рдВрдЯ-рдПрдВрдб рдбреЛрдореЗрдиред рднрд╛рдЧ реи ЁЯОж ЁЯС╕ЁЯП╝ ЁЯОг</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдкрд░рд┐рдЪрдп 
 рд▓реЗрдЦ рдХреЗ рдкрд╣рд▓реЗ рднрд╛рдЧ рдореЗрдВ , рд╣рдордиреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб SNI (eSNI) рддрдВрддреНрд░ рдХрд╛ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╡рд░рдг рджрд┐рдпрд╛ред рдЙрдиреНрд╣реЛрдВрдиреЗ рджрд┐рдЦрд╛рдпрд╛ рдХрд┐ рдХреИрд╕реЗ, рдЗрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдЖрдзреБрдирд┐рдХ рдбреАрдкреАрдЖрдИ рд╕рд┐рд╕реНрдЯрдо ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЯреАрдПрд▓рдПрд╕ 1.3 рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдлреНрд░рдВрдЯ-рдПрдВрдб рдбреЛрдореЗрдиред рднрд╛рдЧ реи</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477696/"><h3>  рдкрд░рд┐рдЪрдп </h3><br>  <a href="https://habr.com/ru/post/475372/">рд▓реЗрдЦ</a> рдХреЗ рдкрд╣рд▓реЗ рднрд╛рдЧ рдореЗрдВ <a href="https://habr.com/ru/post/475372/">,</a> рд╣рдордиреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб SNI (eSNI) рддрдВрддреНрд░ рдХрд╛ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╡рд░рдг рджрд┐рдпрд╛ред  рдЙрдиреНрд╣реЛрдВрдиреЗ рджрд┐рдЦрд╛рдпрд╛ рдХрд┐ рдХреИрд╕реЗ, рдЗрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдЖрдзреБрдирд┐рдХ рдбреАрдкреАрдЖрдИ рд╕рд┐рд╕реНрдЯрдо (рдмреАрд▓рд╛рдЗрди рдбреАрдкреАрдЖрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдФрд░ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЖрдИрдПрд▓рд╡реА рд░реВрдЯрд░рдХреНрд░рд╛рдЗрдм рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ) рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рд╕рд╛рде рд╣реА рдЗрд╕ рддрдВрддреНрд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдбреЛрдореЗрди рдлреНрд░рдВрдЯ-рдПрдВрдб рдХреЗ рдПрдХ рдирдП рд╕рдВрд╕реНрдХрд░рдг рдХреА рдЦреЛрдЬ рдХрд░рдирд╛ред <br><br>  рд▓реЗрдЦ рдХреЗ рджреВрд╕рд░реЗ рднрд╛рдЧ рдореЗрдВ, рд╣рдо рдФрд░ рдЕрдзрд┐рдХ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдЪреАрдЬреЛрдВ рдХреА рдУрд░ рдмрдврд╝реЗрдВрдЧреЗ рдЬреЛ RedTeam рдЕрдкрдиреЗ рдХрдард┐рди рдХрд╛рдо рдореЗрдВ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрдВрдЧреЗред  рдЕрдВрдд рдореЗрдВ, рд╣рдорд╛рд░рд╛ рд▓рдХреНрд╖реНрдп рдЕрд╡рд░реБрджреНрдз рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдирд╣реАрдВ рд╣реИ (рдРрд╕реА рд╕рд╛рдорд╛рдиреНрдп рдмрд╛рддреЛрдВ рдХреЗ рд▓рд┐рдП, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдЕрдЪреНрдЫрд╛ рдкреБрд░рд╛рдирд╛ рд╡реАрдкреАрдПрди рд╣реИ)ред  рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдмрд╣реБрдд рд╕рд╛рд░реЗ рд╡реАрдкреАрдПрди рдкреНрд░рджрд╛рддрд╛ рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рд╡реЗ рдХрд╣рддреЗ рд╣реИрдВ, рд╣рд░ рд╕реНрд╡рд╛рдж, рд░рдВрдЧ рдФрд░ рдмрдЬрдЯ рдХреЗ рд▓рд┐рдПред <br><br>  рд╣рдо рдЖрдзреБрдирд┐рдХ RedTeam рдЯреВрд▓ рдХреЗ рд▓рд┐рдП рдбреЛрдореЗрди-рдлреНрд░реЛрдиреНрдЯрд┐рдВрдЧ рддрдВрддреНрд░ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВрдЧреЗ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬреИрд╕реЗ рдХреЛрдмрд╛рд▓реНрдЯ рд╕реНрдЯреНрд░рд╛рдЗрдХ, рдПрдореНрдкрд╛рдпрд░ рдЗрддреНрдпрд╛рджрд┐, рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЖрдзреБрдирд┐рдХ рд╕рд╛рдордЧреНрд░реА рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреА рдирдХрд▓ рдХрд░рдиреЗ рдФрд░ рдЙрд╕реЗ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рдЕрд╡рд╕рд░ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред <br><a name="habracut"></a><br>  рдкрд┐рдЫрд▓реА рдмрд╛рд░, рд╣рдордиреЗ рдУрдкрдирдПрд╕рдПрд╕рдПрд▓ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдореЗрдВ рдИрдПрд╕рдПрдирдЖрдИ рддрдВрддреНрд░ рдХреЛ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдерд╛ рдФрд░ рдЗрд╕реЗ рдкрд░рд┐рдЪрд┐рдд рдХрд░реНрд▓ рдЙрдкрдпреЛрдЧрд┐рддрд╛ рдореЗрдВ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдерд╛ред  рд▓реЗрдХрд┐рди рдПрдХ рдХрд░реНрд▓, рдЬреИрд╕рд╛ рдХрд┐ рд╡реЗ рдХрд╣рддреЗ рд╣реИрдВ, рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реЛрдЧрд╛ред  рдмреЗрд╢рдХ, рдореИрдВ рдЙрдЪреНрдЪ-рд╕реНрддрд░реАрдп рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ рдХреБрдЫ рдЗрд╕реА рддрд░рд╣ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реВрдВред  рд▓реЗрдХрд┐рди, рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдиреЗрдЯрд╡рд░реНрдХ рдХреА рд╡рд┐рд╢рд╛рд▓рддрд╛ рдХреА рдПрдХ рд╕рд░рд╕рд░реА рдЦреЛрдЬ рд╣рдореЗрдВ рдирд┐рд░рд╛рд╢ рдХрд░рддреА рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ eSNI рддрдВрддреНрд░ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдерди рдХреЗрд╡рд▓ GOLANG рдореЗрдВ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд▓рд╛рдЧреВ рд╣реИред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдорд╛рд░реА рдкрд╕рдВрдж рдмрд╣реБрдд рдмрдбрд╝реА рдирд╣реАрдВ рд╣реИ: рд╣рдо рдпрд╛ рддреЛ рд╢реБрджреНрдз C рдпрд╛ C ++ рдореЗрдВ рд▓рд┐рдЦреЗ рдЧрдП OpenSSL рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рд▓рд┐рдЦрддреЗ рд╣реИрдВ, рдпрд╛ рд╣рдо CloudFlare рд╕реЗ рдПрдХ рдЕрд▓рдЧ GOLANG рдХрд╛рдВрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд╡рд╣рд╛рдВ рдЕрдкрдиреЗ рдЯреВрд▓ рдХреЛ рдкреЛрд░реНрдЯ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВред  рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдПрдХ рдФрд░ рд╡рд┐рдХрд▓реНрдк рд╣реИ, рдЕрдзрд┐рдХ рдХреНрд▓рд╛рд╕рд┐рдХ, рд▓реЗрдХрд┐рди рд╕рдордп рд▓реЗрдиреЗ рд╡рд╛рд▓реА рднреА - рдЕрдЬрдЧрд░ рдХреЗ рд▓рд┐рдП рдИрдПрд╕рдПрдирдЖрдИ рд╕рдорд░реНрдерди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рд╣реИред  рдЖрдЦрд┐рд░рдХрд╛рд░, https рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдкрд╛рдпрдерди рдУрдкрдирдПрд╕рдПрд╕рдПрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕ рд╡рд┐рдХрд▓реНрдк рдХреЛ рдХрд┐рд╕реА рдФрд░ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд╛рд╕ рдХреЗ рд▓рд┐рдП рдЫреЛрдбрд╝ рджреЗрдВрдЧреЗ, рдФрд░ рд╣рдо рдЧреЛрд▓рдВрдЧ рдкрд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЗ рд╕рд╛рде рд╕рдВрддреБрд╖реНрдЯ рд░рд╣реЗрдВрдЧреЗ, рдЦрд╛рд╕рдХрд░ рдЬрдм рд╕реЗ рд╣рдорд╛рд░реЗ рдкреНрд░рд┐рдп рдХреЛрдмрд╛рд▓реНрдЯ рд╕реНрдЯреНрд░рд╛рдЗрдХ рддреАрд╕рд░реЗ рдкрдХреНрд╖ рдХреЗ рдЙрдкрдХрд░рдг (рдмрд╛рд╣рд░реА рд╕реА 2 рдЪреИрдирд▓) рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдорд┐рдд рд╕рдВрдЪрд╛рд░ рдЪреИрдирд▓ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реИрдВ - рд╣рдо рд▓реЗрдЦ рдХреЗ рдЕрдВрдд рдореЗрдВ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗред <br><br><h3>  рдХрдард┐рди рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ ... </h3><br>  Go рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдП рдЧрдП рдЙрдкрдХрд░рдгреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдЕрдВрджрд░ рдкрд┐рд╡рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░рд╛ рд╡рд┐рдХрд╛рд╕ рд╣реИ - рд░рд╕реНрдХреЛрд╕реНрдЯреБрди <a href="https://github.com/mis-team/rsockstun">рдЯреНрдпреВрдирд░</a> , рдЬреЛ рдХрд┐ рд╕рдВрдпреЛрдЧрд╡рд╢, рдЕрдм Microsoft рдФрд░ Symantec рдЯреВрд▓ рджреНрд╡рд╛рд░рд╛ рдмрд╣реБрдд рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рд╡рд┐рд╢реНрд╡ рд╕реНрдерд┐рд░рддрд╛ рдХрд╛ рдЙрд▓реНрд▓рдВрдШрди рдХрд░рдирд╛ рд╣реИ ... <br><br><img src="https://habrastorage.org/webt/fg/mu/z4/fgmuz4c7bq1aazvf6su5qjbh32o.png"><br><br>  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдкрд┐рдЫрд▓реЗ рд╡рд┐рдХрд╛рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд╣реЛрдЧрд╛ред  рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рдПрдХ рдЫреЛрдЯреА рд╕реА рд╕рдорд╕реНрдпрд╛ рдкреИрджрд╛ рд╣реЛрддреА рд╣реИред  рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ rsockstun рд╢реБрд░реВ рдореЗрдВ рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рдПрдХ рддреБрд▓реНрдпрдХрд╛рд▓рд┐рдХ рдПрд╕рдПрд╕рдПрд▓ рд╕рдВрдЪрд╛рд░ рдЪреИрдирд▓ рдХреЗ рдЙрдкрдпреЛрдЧ рдХрд╛ рдЕрд░реНрде рд╣реИред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХрдиреЗрдХреНрд╢рди рдПрдХ рдмрд╛рд░ рд╕реНрдерд╛рдкрд┐рдд рд╣реИ рдФрд░ рд╕реБрд░рдВрдЧ рд╕рдВрдЪрд╛рд▓рди рдХреА рдкреВрд░реА рдЕрд╡рдзрд┐ рдХреЗ рд▓рд┐рдП рдореМрдЬреВрдж рд╣реИред  рдФрд░, рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рд╕рдордЭрддреЗ рд╣реИрдВ, https рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдСрдкрд░реЗрд╢рди рдХреЗ рдЗрд╕ рддрд░реАрдХреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ - рдпрд╣ рдЕрдиреБрд░реЛрдз-рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЛрдб рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рдкреНрд░рддреНрдпреЗрдХ рдирдпрд╛ http-рдЕрдиреБрд░реЛрдз рдПрдХ рдирдП tcp рдХрдиреЗрдХреНрд╢рди рдХреЗ рдврд╛рдВрдЪреЗ рдХреЗ рднреАрддрд░ рдореМрдЬреВрдж рд╣реЛрддрд╛ рд╣реИред <br><br>  рдЗрд╕ рдпреЛрдЬрдирд╛ рдХрд╛ рдореБрдЦреНрдп рдиреБрдХрд╕рд╛рди рдпрд╣ рд╣реИ рдХрд┐ рд╕рд░реНрд╡рд░ рддрдм рддрдХ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдбреЗрдЯрд╛ рдЯреНрд░рд╛рдВрд╕рдлрд░ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рддрдХ рдХрд┐ рдХреНрд▓рд╛рдЗрдВрдЯ рдПрдХ рдирдпрд╛ http рдЕрдиреБрд░реЛрдз рдирд╣реАрдВ рднреЗрдЬрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди, рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ - http рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбреЗрдЯрд╛ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдХрд░рдирд╛ (рдЕрдВрдд рдореЗрдВ, рд╣рдо рдХрд┐рд╕реА рддрд░рд╣ рдЕрдкрдиреЗ рдкрд╕рдВрджреАрджрд╛ рдЯреАрд╡реА рд╢реЛ рджреЗрдЦрддреЗ рд╣реИрдВ рдФрд░ https рдкрд░ рдЪрд▓рдиреЗ рд╡рд╛рд▓реЗ рдкреЛрд░реНрдЯрд▓реНрд╕ рд╕реЗ рд╕рдВрдЧреАрдд рд╕реБрдирддреЗ рд╣реИрдВ, рдФрд░ рд╡реАрдбрд┐рдпреЛ рдФрд░ рдСрдбрд┐рдпреЛ рдЯреНрд░рд╛рдВрд╕рдорд┐рд╢рди рд╡рд╣ рдирд╣реАрдВ рд╣реИ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдбреЗрдЯрд╛ рдХреЗ рдЕрд▓рд╛рд╡рд╛)ред  Http рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдкрд░ рдПрдХ рдкреВрд░реНрдг tcp рдХрдиреЗрдХреНрд╢рди рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддрдХрдиреАрдХреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ WebSockets рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдореБрдЦреНрдп рд╕рд╛рд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреЗ рдмреАрдЪ рдкреВрд░реНрдг рдиреЗрдЯрд╡рд░реНрдХ рдХрдиреЗрдХреНрд╢рди рдХрд╛ рд╕рдВрдЧрдарди рд╣реИред <br><br>  рд╣рдорд╛рд░реА рдХрд┐рд╕реНрдордд (hooray hooray !!!) рдХреЗ рд▓рд┐рдП, рдпрд╣ рддрдХрдиреАрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рднреА CloudFlare рдЯреИрд░рд┐рдл рдпреЛрдЬрдирд╛рдУрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ рдФрд░ eSNI рдХреЗ рд╕рд╛рде рд╕рдВрдпреЛрдЬрди рдореЗрдВ рдорд╣рд╛рди рдХрд╛рдо рдХрд░рддреА рд╣реИред  рдпрд╣ рд╡рд╣реА рд╣реИ рдЬреЛ рд╣рдо рдЕрдкрдиреА рд╕реБрд░рдВрдЧ рдХреЛ рдбреЛрдореЗрди-рдореЛрд░реНрдЪреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдФрд░ рдЖрдзреБрдирд┐рдХ рдбреАрдкреАрдЖрдИ рд╕реЗ рдЫрд┐рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред <br><br><h3>  WebSockets рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдереЛрдбрд╝рд╛ рд╕рд╛ </h3><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдФрд░ рд╕рд░рд▓ рд╢рдмреНрджреЛрдВ рдореЗрдВ рд╡реЗрдм рд╕реЙрдХреЗрдЯреНрд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛рдПрдВрдЧреЗ рддрд╛рдХрд┐ рд╕рднреА рдХреЛ рдЗрд╕ рдмрд╛рдд рдХрд╛ рдЕрдВрджрд╛рдЬрд╛ рд╣реЛ рдХрд┐ рд╣рдо рдХрд┐рд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░реЗрдВрдЧреЗред <br><br>  рд╡реЗрдм рд╕реЙрдХреЗрдЯ рддрдХрдиреАрдХ рдЖрдкрдХреЛ рд╕реНрдерд╛рдкрд┐рдд tcp рдХрдиреЗрдХреНрд╢рди рдХреЛ рддреЛрдбрд╝рдиреЗ рдХреЗ рдмрд┐рдирд╛ рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рд╕реЙрдХреЗрдЯ рдкрд░ рдорд╛рдирдХ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдбреЗрдЯрд╛ рдкрд░ http рдХрдиреЗрдХреНрд╢рди рд╕реЗ рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдЬрдм рдХреЛрдИ рдЧреНрд░рд╛рд╣рдХ рд╡реЗрдм рд╕реЙрдХреЗрдЯ рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдЕрдкрдиреЗ http рдЕрдиреБрд░реЛрдз рдореЗрдВ рдХрдИ http рд╣реЗрдбрд░ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред  рджреЛ рдЖрд╡рд╢реНрдпрдХ рд╣реЗрдбрд░ рд╣реИрдВ <i><b>рдХрдиреЗрдХреНрд╢рди: рдЕрдкрдЧреНрд░реЗрдб</b></i> рдФрд░ <i><b>рдЕрдкрдЧреНрд░реЗрдб: рд╡реЗрдмрд╕реНрдХреИрдЯ</b></i> ред  рдпрд╣ рд╡реЗрдмрд╕реЛрдХреЗрдЯ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╕рдВрд╕реНрдХрд░рдг ( <i><b>Sec-Websockset-Version: 13</b></i> ) рдФрд░ рдмреЗрд╕ 64 рд╡реЗрдм рд╕реЙрдХреЗрдЯ рдЖрдЗрдбреЗрдВрдЯрд┐рдлрд╛рдпрд░ ( <i><b>Sec-WebSocket-Key: DAGDJSiREI3 + KjDwwxm1FA ==</b></i> ) рдЬреИрд╕рд╛ рдХреБрдЫ рднреА рдордЬрдмреВрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рд╕рд░реНрд╡рд░ http-рдХреЛрдб 101 рд╕реНрд╡рд┐рдЪрд┐рдВрдЧ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░рддрд╛ рд╣реИ рдФрд░ <i><b>рдХрдиреЗрдХреНрд╢рди, рдЕрдкрдЧреНрд░реЗрдб</b></i> рдФрд░ <i><b>рд╕реЗрдХ-рд╡реЗрдм-рд╕реЙрдХреЗрдЯ-</b></i> рд╣реЗрдбрд░ рднреА рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред  рд╕реНрд╡рд┐рдЪрд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдиреАрдЪреЗ рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ рд╕рдЪрд┐рддреНрд░ рд╣реИ: <br><br><img src="https://habrastorage.org/webt/ci/tp/bg/citpbgee5m4fyv9-w5akwwq5t8q.png"><br><br>  рдЙрд╕рдХреЗ рдмрд╛рдж, WebSocket рдХрдиреЗрдХреНрд╢рди рдХреЛ рдкреВрд░рд╛ рдорд╛рдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рджреЛрдиреЛрдВ рдХрд╛ рдХреЛрдИ рднреА рдбреЗрдЯрд╛ рдЕрдм http рдХреЗ рд╕рд╛рде рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ WebSocket рд╣реЗрдбрд░ (рд╡реЗ рдмрд╛рдЗрдЯ 0x82 рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ) рдХреЗ рд╕рд╛рде рд╕рдкреНрд▓рд╛рдИ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдбреЗрдЯрд╛ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдм рд╕рд░реНрд╡рд░ рдХреЛ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реЗ рдЕрдиреБрд░реЛрдз рдХреЗ рд▓рд┐рдП рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ  tcp рдХрдиреЗрдХреНрд╢рди рдЯреВрдЯрд╛ рдирд╣реАрдВ рд╣реИред <br><br>  рд╡реЗрдм рд╕реЙрдХреЗрдЯ рд╕реЙрдХреЗрдЯреНрд╕ рдЧрд┐рд░реЛрд╣ рдореЗрдВ рдХрдИ рдкреБрд╕реНрддрдХрд╛рд▓рдп рд╣реИрдВред  рдЗрдирдореЗрдВ рд╕реЗ рд╕рдмрд╕реЗ рд▓реЛрдХрдкреНрд░рд┐рдп <a href="https://github.com/gorilla/websocket">рдЧреЛрд░рд┐рд▓реНрд▓рд╛ рд╡реЗрдмрд╕реНрдХреЗрдЯ</a> рдФрд░ рдорд╛рдирдХ <a href="https://godoc.org/golang.org/x/net/websocket">рд╡реЗрдмрд╕реЛрдХреЗрдЯ рд╣реИрдВ</a> ред  рд╣рдо рдмрд╛рдж рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ, рдХреНрдпреЛрдВрдХрд┐  рдпрд╣ рд╕рд░рд▓, рдЫреЛрдЯрд╛ рдФрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рд╡реЗ рдХрд╣рддреЗ рд╣реИрдВ, рдереЛрдбрд╝рд╛ рддреЗрдЬред <br><br>  Rsockstun рдХреНрд▓рд╛рдпрдВрдЯ рдХреЛрдб рдореЗрдВ, рд╣рдореЗрдВ рдиреЗрдЯрд╡рд░реНрде рдпрд╛ tls.dial рдХреЙрд▓реНрд╕ рдХреЛ рд╕рдВрдмрдВрдзрд┐рдд рд╡реИрдмрд╕рд╛рдЗрдЯ рд╕реЙрдХреЗрдЯ рд╕реЗ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛: <br><br><img src="https://habrastorage.org/webt/ye/dw/vy/yedwvync3yktwhl_ssd2vm8eniy.png"><br><br><img src="https://habrastorage.org/webt/mw/j3/fw/mwj3fwfivbj7aqqsbg7whlkt9ai.png"><br><br>  рд╣рдо рдЕрдкрдиреА рд╕реБрд░рдВрдЧ рдХреЗ рдЧреНрд░рд╛рд╣рдХ рдХреЛ рд╕рд╛рд░реНрд╡рднреМрдорд┐рдХ рдмрдирд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдФрд░ рджреЛрдиреЛрдВ рдХреЛ рдкреНрд░рддреНрдпрдХреНрд╖ ssl рдХрдиреЗрдХреНрд╢рди рдФрд░ WebSockset рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддреЗ рд╣реИрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ рдЕрд▓рдЧ рдлрд╝рдВрдХреНрд╢рди <i><b>func connectForWsSocks (рдПрдбреНрд░реЗрд╕ рд╕реНрдЯреНрд░рд┐рдВрдЧ, рдкреНрд░реЙрдХреНрд╕реА рд╕реНрдЯреНрд░рд┐рдВрдЧ) рддреНрд░реБрдЯрд┐ {...}</b></i> рдХреЛ <i><b>connectForSocks () рдХреЗ</b></i> рд╕рд╛рде <i><b>рдмрдирд╛рдПрдВрдЧреЗ</b></i> рдФрд░ рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡реЗрдм рд╕реЙрдХреЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВрдЧреЗ рдпрджрд┐ рд╕рд░реНрд╡рд░ рд╢реБрд░реВ рд╣реЛрдиреЗ рдкрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрдЧрд╛ред ws: рдпрд╛ wss: (рд╕рд┐рдХреНрдпреЛрд░ рд╡реЗрдмрд╕реНрдХреЗрдЯ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ)ред <br><br>  рд╕реБрд░рдВрдЧ рдХреЗ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдХреЗ рд▓рд┐рдП, рд╣рдо рд╡реЗрдм рд╕реЙрдХреЗрдЯ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдХрд╛рд░реНрдп рдХрд░реЗрдВрдЧреЗред  Http рд╡рд░реНрдЧ рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдЗрд╕рдореЗрдВ рдмрдирд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдПрдХ http рдХрдиреЗрдХреНрд╢рди рд╣реИрдВрдбрд▓рд░ (wsHandler рдлрд╝рдВрдХреНрд╢рди) рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛: <br><br><img src="https://habrastorage.org/webt/2a/r7/cv/2ar7cvjzjc7wauwsb45ursxie2q.png"><br><br>  рдФрд░ рд╣рдо рдХрдиреЗрдХреНрд╢рди рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рднреА рддрд░реНрдХ рдбрд╛рд▓реЗрдВрдЧреЗ (рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд╕рд╛рде рдЕрдзрд┐рдХреГрдд рдХрд░рдирд╛, рдпрдордХреНрд╕ рд╕рддреНрд░ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рдФрд░ рд╕рдорд╛рдкреНрдд рдХрд░рдирд╛) рд╡реЗрдмрд╕реЛрдХреЗрдЯ рдХрдиреЗрдХреНрд╢рди рд╣реИрдВрдбрд▓рд░ рдореЗрдВ: <br><br><img src="https://habrastorage.org/webt/6r/kz/ay/6rkzays7haarsd9vyhak3xe4kbw.png"><br><br>  рд╣рдо рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рд╕рд░реНрд╡рд░ рднрд╛рдЧ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre><code class="go hljs">./rsockstun тАУlisten ws:<span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span> тАУpass P@ssw0rd</code> </pre> <br>  рдФрд░ рдлрд┐рд░ рдЧреНрд░рд╛рд╣рдХ рд╣рд┐рд╕реНрд╕рд╛: <br><br><pre> <code class="go hljs">./rsockstun -connect ws:<span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">8080</span></span> тАУpass P@ssw0rd</code> </pre> <br>  рдФрд░ рд╣рдо рд╕реНрдерд╛рдиреАрдп рд╣реЛрд╕реНрдЯ рдкрд░ рдХрд╛рдо рдХреА рдЬрд╛рдБрдЪ рдХрд░рддреЗ рд╣реИрдВ: <br><br><img src="https://habrastorage.org/webt/ci/tl/jh/citljhc7govgdkorfy6xm--c-dw.png"><br><br><img src="https://habrastorage.org/webt/cp/6m/mu/cp6mmuhm2xk5iaupu2wh0kato2s.png"><br><br><h3>  рд╣рдо рдбреЛрдореЗрди-рдлреНрд░реЛрдВрдЯрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдкрд╛рд╕ рд╣реЛрддреЗ рд╣реИрдВ </h3><br>  рд╣рдореЗрдВ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рд╡реЗрдм рд╕реЙрдХреЗрдЯреНрд╕ рдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЕрдм рдЖрдЗрдП рд╕реАрдзреЗ eSNI рдФрд░ рдбреЛрдореЗрди-рдореЛрд░реНрдЪреЛрдВ рдкрд░ рдЬрд╛рдПрдВред  рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, DoH рдФрд░ eSNI рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ <a href="https://github.com/cloudflare/tls-tris">CloudFlare</a> рд╕реЗ рдЧреЛрд▓рдВрдЧ рдХреА рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╢рд╛рдЦрд╛ рд▓реЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рд╣рдореЗрдВ eSNI рд╕рдорд░реНрдерди (pwu / esni) рдХреЗ рд╕рд╛рде рдПрдХ рд╢рд╛рдЦрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  рд╣рдо рдЗрд╕реЗ рд╕реНрдерд╛рдиреАрдп рд╕реНрддрд░ рдкрд░ рдЦреБрдж рдХреЛ рдХреНрд▓реЛрди рдХрд░рддреЗ рд╣реИрдВ рдпрд╛ рд╕рдВрдмрдВрдзрд┐рдд рдЬрд╝рд┐рдк рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre> <code class="plaintext hljs">git clone -b pwu/esni https://github.com/cloudflare/tls-tris.git</code> </pre> <br>  рдлрд┐рд░ рд╣рдореЗрдВ GOROOT рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдХреНрд▓реЛрди рдХреА рдЧрдИ рд╢рд╛рдЦрд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдмрджрд▓реЗрдВ рдФрд░ рдЗрд╕реЗ рдореБрдЦреНрдп рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд░реЗрдВред  рдбреЗрд╡рд▓рдкрд░ рдХреЛ рдЗрд╕ рд╕рд┐рд░рджрд░реНрдж рд╕реЗ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, CloudFlare рдХреЗ рд▓реЛрдЧреЛрдВ рдиреЗ рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рддреИрдпрд╛рд░ рдХреА - _dev / go.sh.  рдмрд╕ рдЗрд╕реЗ рдЪрд▓рд╛рдУред  рдореЗрдХрдлрд╛рдЗрд▓ рдХреЗ рд╕рд╛рде рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рдмрдХреБрдЫ рдЦреБрдж рдХрд░реЗрдЧреАред  рдордиреЛрд░рдВрдЬрди рдХреЗ рд▓рд┐рдП - рдЖрдк рд╡рд┐рд╡рд░рдг рдХреЗ рд▓рд┐рдП рдореЗрдХрдлрд╛рдЗрд▓ рдХреЗ рдЕрдВрджрд░ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░рддреЗ рд╕рдордп, рд╣рдореЗрдВ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ рддреИрдпрд╛рд░ рдХреА рдЧрдИ рд╕реНрдерд╛рдиреАрдп рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: <br><br><pre> <code class="plaintext hljs">GOROOT="/opt/tls-tris/_dev/GOROOT/linux_amd64" go build тАж.</code> </pre> <br>  рдЕрдЧрд▓рд╛, рд╣рдореЗрдВ рд╕реБрд░рдВрдЧ рдореЗрдВ рд╡рд╛рдВрдЫрд┐рдд рдбреЛрдореЗрди рдХреЗ рд▓рд┐рдП рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ eSNI рдХреБрдВрдЬреА рдХреЗ рдЕрдиреБрд░реЛрдз рдФрд░ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпреЗ CloudFlare рдлреНрд░рдВрдЯ-рдПрдВрдб рд╕рд░реНрд╡рд░ рд╕реЗ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ eSNI рдХреБрдВрдЬреА рд╣реЛрдВрдЧреЗред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рддреАрди рдХрд╛рд░реНрдп рдмрдирд╛рдПрдВрдЧреЗ: <br><br><pre> <code class="plaintext hljs">func makeDoTQuery(dnsName string) ([]byte, error) func parseTXTResponse(buf []byte, wantName string) (string, error) func QueryESNIKeysForHost(hostname string) ([]byte, error)</code> </pre> <br>  рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдирд╛рдо, рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдЦреБрдж рдХреЗ рд▓рд┐рдП рдмреЛрд▓рддреЗ рд╣реИрдВред  рд╣рдо esni_query.go рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдлрд┐рд▓рд┐рдВрдЧ рд▓реЗрдВрдЧреЗ, рдЬреЛ tls-tris рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИред  рдкрд╣рд▓рд╛ рдлрд╝рдВрдХреНрд╢рди DoH рдкреНрд░реЛрдЯреЛрдХреЙрд▓ (DNS-over-HTTPS) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ CloudFlare DNS рд╕рд░реНрд╡рд░ рдХреЗ рдЕрдиреБрд░реЛрдз рдХреЗ рд╕рд╛рде рдПрдХ рдиреЗрдЯрд╡рд░реНрдХ рдкреИрдХреЗрдЯ рдмрдирд╛рддрд╛ рд╣реИ, рджреВрд╕рд░рд╛ рдХреНрд╡реЗрд░реА рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рддрд╛ рд╣реИ рдФрд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдбреЛрдореЗрди рдХреБрдВрдЬреА рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рддреАрд╕рд░рд╛ рдкрд╣рд▓реЗ рджреЛ рдХреЗ рд▓рд┐рдП рдПрдХ рдХрдВрдЯреЗрдирд░ рд╣реИред <br><br>  рдЕрдЧрд▓рд╛, рд╣рдо рдбреЛрдореЗрди рдХреЗ рд▓рд┐рдП eSNI рдХреБрдВрдЬрд┐рдпреЛрдВ рдХреЗ рдЕрдиреБрд░реЛрдз рдХреЗ рдХрд╛рд░реНрдп рдХреЛ рд╡реЗрдм рд╕реЙрдХреЗрдЯ <i><b>connectForWsSocks рдХреЗ</b></i> рд▓рд┐рдП рд╣рдорд╛рд░реЗ рдирдП рдмрдирд╛рдП рдЧрдП рдХрдиреЗрдХреНрд╢рди рдлрд╝рдВрдХреНрд╢рди рдореЗрдВ <i><b>рдкреНрд░рд╕реНрддреБрдд рдХрд░рддреЗ рд╣реИрдВ</b></i> ред  рдЬрд╣рд╛рдВ рд╕рд░реНрд╡рд░ рдкрд╛рд░реНрдЯ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ, рдЯреАрдПрд▓рдПрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рд╕реЗрдЯ рдХрд░реЗрдВ, рдФрд░ рдирдХрд▓реА "рдХрд╡рд░ рдбреЛрдореЗрди" рдХрд╛ рдирд╛рдо рднреА рд╕реЗрдЯ рдХрд░реЗрдВ: <br><br><img src="https://habrastorage.org/webt/s0/kk/vu/s0kkvu24eh0wc7olaeffffknrck.png"><br><br>  рдпрд╣рд╛рдВ рдпрд╣ рдзреНрдпрд╛рди рджрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рд╢реБрд░реВ рдореЗрдВ, tls-tris рд╢рд╛рдЦрд╛ рдХреЛ рдбреЛрдореЗрди-рдлреНрд░реЛрдиреНрдЯрд┐рдВрдЧ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдЗрд╕рд▓рд┐рдП, рдпрд╣ рд╕рд░реНрд╡рд░ рдХреЗ рдирдХрд▓реА рдирд╛рдо рдкрд░ рдзреНрдпрд╛рди рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ (рдПрдХ рдЦрд╛рд▓реА рд╕рд░реНрд╡рд░рдирд╛рдо рдХреНрд╖реЗрддреНрд░ рдХреНрд▓рд╛рдЗрдВрдЯ-рд╣реЗрд▓рд┐рдХреЙрдкреНрдЯрд░ рдкреИрдХреЗрдЬ рдХреЗ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░реЗрд╖рд┐рдд рд╣реЛрддрд╛ рд╣реИ)ред  рдЗрд╕реЗ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ TlsConfig рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рд╕рдВрдмрдВрдзрд┐рдд FakeServerName рдлрд╝реАрд▓реНрдб рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ред  рд╣рдо рд╕рдВрд░рдЪрдирд╛ рдХреЗ рдорд╛рдирдХ Servername рдХреНрд╖реЗрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ, рдХреНрдпреЛрдВрдХрд┐  рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдВрддрд░рд┐рдХ tls рддрдВрддреНрд░ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдпрджрд┐ рдпрд╣ рдореВрд▓ рд╕реЗ рднрд┐рдиреНрди рд╣реЛрддрд╛ рд╣реИ, рддреЛ tls-handshake рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рдПрдЧрд╛ред  TlsConfig рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рд╡рд░реНрдгрди tls <b>/ common.go рдлрд╝рд╛рдЗрд▓</b> рдореЗрдВ рд╕рдорд╛рд╣рд┐рдд рд╣реИ - рд╣рдореЗрдВ рдЗрд╕реЗ рдареАрдХ рдХрд░рдирд╛ рд╣реЛрдЧрд╛: <br><br><img src="https://habrastorage.org/webt/pu/2l/f4/pu2lf425co5cex8zfa-h2ewdbw8.png"><br><br><img src="https://habrastorage.org/webt/q1/jk/2i/q1jk2iiwpohss6nhr1uanlnkqp8.png"><br><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдореЗрдВ TLS рд╣реИрдВрдбрд╢реЗрдХ рдЬреЗрдирд░реЗрдЯ рдХрд░рддреЗ рд╕рдордп рдЕрдкрдиреЗ FakeServerName рдХреНрд╖реЗрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП tls <b>/ handshake_client.go</b> рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛: <br><br><img src="https://habrastorage.org/webt/fy/nq/ln/fynqlnmskvfz0exd4im58vzpwfi.png"><br><br>  рд╡рд╣ рд╕рдм рд╣реИ!  рдЖрдк рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХрд╛рдо рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рдЖрдк рдкрд░реАрдХреНрд╖рдг рдЪрд▓рд╛рдПрдВ, рдЖрдкрдХреЛ рдЕрдкрдирд╛ CloudFlare рдЦрд╛рддрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдареАрдХ рд╣реИ, рдЖрдк рдХреИрд╕реЗ рд╕реЗрдЯ рдЕрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рддреЗ рд╣реИрдВ - рдмрд╕ рдПрдХ рдХреНрд▓рд╛рдЙрдбрдлреЗрдпрд░ рдЦрд╛рддрд╛ рдмрдирд╛рдПрдВ рдФрд░ рдЕрдкрдиреЗ рдбреЛрдореЗрди рдХреЛ рдЙрд╕рдореЗрдВ рдмрд╛рдВрдз рджреЗрдВред  DoH, WebSocket рдФрд░ ESNI рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╕рднреА рдЪрд┐рдкреНрд╕ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ CloudFlare рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред  DNS рд░рд┐рдХреЙрд░реНрдб рдЕрдкрдбреЗрдЯ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж - рдЖрдк eSNI рдХреБрдВрдЬреА рдЕрдиреБрд░реЛрдз рдЪрд▓рд╛рдХрд░ рдбреЛрдореЗрди рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="plaintext hljs">dig +short txt _esni.df13tester.info</code> </pre> <br><img src="https://habrastorage.org/webt/xh/9a/6g/xh9a6gmmlc1jg-deqesdliip09a.png"><br><br>  рдпрджрд┐ рдЖрдк рдЕрдкрдиреЗ рдбреЛрдореЗрди рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╕рдорд╛рди рджреЗрдЦрддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЗ рд▓рд┐рдП рд╕рдм рдХреБрдЫ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЖрдк рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, DigitalOcean рдкрд░ Ubuntu VPS рд▓реЙрдиреНрдЪ рдХрд░реЗрдВред  PS рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкреНрд░рджрд╛рддрд╛ рджреНрд╡рд╛рд░рд╛ рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЧрдпрд╛ VPS IP рдкрддрд╛ ILV рдмреНрд▓реИрдХ рд▓рд┐рд╕реНрдЯ рдореЗрдВ рдерд╛ред  рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЖрдкрдХреЗ рд╕рд╛рде рднреА рдХреБрдЫ рдРрд╕рд╛ рд╣реА рд╣реЛ рддреЛ рд╣реИрд░рд╛рди рдордд рд╣реЛрдЗрдПред  рдореБрдЭреЗ рдЕрдкрдиреЗ рд╡реАрдкреАрдПрд╕ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡реАрдкреАрдПрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдкрдбрд╝рд╛ред <br><br>  рд╣рдо VPS рдХреЛ рд╕рдВрдХрд▓рд┐рдд rsockstun рдХреА рдирдХрд▓ рдХрд░рддреЗ рд╣реИрдВ (рдпрд╣, рд╡реИрд╕реЗ, рдЧреЛрд▓рдВрдЧ рдХрд╛ рдПрдХ рдФрд░ рдЖрдХрд░реНрд╖рдг рд╣реИ - рдЖрдк рдЕрдкрдиреЗ рджрдо рдкрд░ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдХрд┐рд╕реА рднреА рд▓рд┐рдирдХреНрд╕ рдкрд░ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рд╕рд┐рд╕реНрдЯрдо рдХреА рдХреЗрд╡рд▓ рдереЛрдбрд╝реА рдХреНрд╖рдорддрд╛ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП) рдФрд░ рд╕рд░реНрд╡рд░ рднрд╛рдЧ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><img src="https://habrastorage.org/webt/kx/-w/th/kx-wth7rif35is4bd5_flfmkjzq.png"><br><br>  рдФрд░ рдлрд┐рд░ рдЧреНрд░рд╛рд╣рдХ рд╣рд┐рд╕реНрд╕рд╛: <br><br><img src="https://habrastorage.org/webt/sf/er/7d/sfer7dpqq1lumfaxmzzxn1n_pfs.png"><br><br>  рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд╡реЗрдм рд╕реЙрдХреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ CloudFlare рдлреНрд░рдВрдЯ-рдПрдВрдб рд╕рд░реНрд╡рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд░реНрд╡рд░ рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реИред  рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╕реБрд░рдВрдЧ рд╕реБрд░рдВрдЧ рдХреА рддрд░рд╣ рдХрд╛рдо рдХрд░рддреА рд╣реИ, рдЖрдк рд╕рд░реНрд╡рд░ рдкрд░ рд╕реНрдерд╛рдиреАрдп рдореЛрдЬреЗ 5 рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдХрд░реНрд▓ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><img src="https://habrastorage.org/webt/qg/na/ti/qgnati8zvd8jc9okh4bei0kbihm.png"><br><br>  рдЕрдм рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд╕рдВрдЪрд╛рд░ рдЪреИрдирд▓ рдореЗрдВ рдбреАрдкреАрдЖрдИ рдХреНрдпрд╛ рджреЗрдЦрддрд╛ рд╣реИ: <br><br><img src="https://habrastorage.org/webt/0p/ph/av/0pphavhdhhnrtfxfkzxsf7vjcxs.png"><br><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╕реБрд░рдВрдЧ рддрдВрддреНрд░, DoH рддрдВрддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдЧрдВрддрд╡реНрдп рдбреЛрдореЗрди (рд╕рдВрдХреБрд▓ рд╕рдВрдЦреНрдпрд╛ 1-19) рдХреЗ рд▓рд┐рдП eSNI рдХреБрдВрдЬреА рдХреЗ рд▓рд┐рдП Cloudflare DNS рд╕рд░реНрд╡рд░ рддрдХ рдкрд╣реБрдБрдЪрддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рд╕рд╛рдордиреЗ рдХреЗ рдЕрдВрдд рд╕рд░реНрд╡рд░ рддрдХ рдкрд╣реБрдБрдЪрддрд╛ рд╣реИ рдФрд░ TLS рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдбреЛрдореЗрди <a href="http://www.google.com/">www.google.com</a> (рдЗрд╕ рдорд╛рди) рдХреЗ рдиреАрдЪреЗ рдЫрд┐рдкрд╛ рд╣реЛрддрд╛ рд╣реИ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдЬрдм рдПрдХ рдирдХрд▓реА рдбреЛрдореЗрди рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдкрд░ рд╕реЗрдЯ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ)ред  рдЕрдкрдиреЗ рдирдХрд▓реА рдбреЛрдореЗрди рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ -fronfDomain рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛: <br><br><img src="https://habrastorage.org/webt/zp/8l/0_/zp8l0_a_cktaz6rrrgao4qo8c2g.png"><br><br><img src="https://habrastorage.org/webt/cq/gn/wn/cqgnwnp9bzo7hzjpb8gcgvqfd6i.png"><br><br>  рдЕрдм рдПрдХ рдмрд╛рдд рдФрд░ред  рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, CloudFalre рдХреА рдЦрд╛рддрд╛ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ Flexible SSL рдкрд░ рд╕реЗрдЯ рдХреА рдЬрд╛рддреА рд╣реИрдВред  рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕реЗ рдХреНрд▓рд╛рдЙрдбрдлрд╝реЗрдпрд░ рдлреНрд░рдВрдЯ-рдПрдВрдб рд╕рд░реНрд╡рд░ рдХреЗ рд▓рд┐рдП https рдЕрдиреБрд░реЛрдз рд╣рдорд╛рд░реЗ рд╕рд░реНрд╡рд░ рдкрд░ рдЕрдирдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб (http) рдлреЙрд░реНрдо рдореЗрдВ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдпрд╣реА рдХрд╛рд░рдг рд╣реИ рдХрд┐ рд╣рдордиреЗ рдЧреИрд░-рдПрд╕рдПрд╕рдПрд▓ рдореЛрдб (-LENEN ws: 0.0.0.0) рдореЗрдВ рд╕реБрд░рдВрдЧ рдХрд╛ рд╕рд░реНрд╡рд░ рд╣рд┐рд╕реНрд╕рд╛ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛, рдФрд░ (-LSEN wss: 0.0.0.0) рдирд╣реАрдВред <br><br><img src="https://habrastorage.org/webt/4j/fy/5n/4jfy5nl5csmeqc6bxd7vbgdhm7a.png"><br><br>  рдкреВрд░реНрдг рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдореЛрдб рдкрд░ рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рд╕рд░реНрд╡рд░ рдкрд░ рдЗрд╕ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ <b>рдкреВрд░реНрдг</b> , рдпрд╛ <b>рдкреВрд░реНрдг (рд╕рдЦреНрдд)</b> рдХрд╛ рдЪрдпрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдореЛрдб рд╕реНрд╡рд┐рдЪ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо https рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ CloudFlare рд╕реЗ рдХрдиреЗрдХреНрд╢рди рд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рдкрд╛рдПрдВрдЧреЗред  рд╕реБрд░рдВрдЧ рдХреЗ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрд╡-рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдкреНрд░рдорд╛рдг рдкрддреНрд░ рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рдпрд╛рдж рд░рдЦреЗрдВред <br><br><img src="https://habrastorage.org/webt/ou/9x/9i/ou9x9ihogwotva8y-xwda5v12ps.png"><br><br>  рдПрдХ рдХрд╖реНрдЯрдкреНрд░рдж рдкрд╛рдардХ рдкреВрдЫреЗрдЧрд╛: тАЬрд╡рд┐рдВрдбреЛрдЬ рдХреЗ рддрд╣рдд рдЧреНрд░рд╛рд╣рдХ рдЦрд╛рддреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛?  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рд╕реБрд░рдВрдЧ рдХрд╛ рдореБрдЦреНрдп рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЙрд░реНрдкреЛрд░реЗрдЯ рдорд╢реАрдиреЛрдВ рдФрд░ рд╕рд░реНрд╡рд░реЛрдВ рд╕реЗ рдмреИрдХ-рдХрдиреЗрдХреНрдЯ рдХреЛ рдЬреЛрдбрд╝рдирд╛ рд╣реИ, рдФрд░ рд╡рд╣рд╛рдБ, рдПрдХ рдирд┐рдпрдо рдХреЗ рд░реВрдк рдореЗрдВ, рдпрд╣ рд╣рдореЗрд╢рд╛ рд╡рд┐рдВрдбреЛрдЬ рд╣реИред  рдореИрдВ рд╡рд┐рдВрдбреЛрдЬ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реБрд░рдВрдЧ рдХреИрд╕реЗ рд╕рдВрдХрд▓рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ, рдФрд░ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЯреАрдПрд▓рдПрд╕ рд╕реНрдЯреИрдХ рдХреЗ рд╕рд╛рде рднреА? тАЭрдФрд░ рдЕрдм рд╣рдо рдПрдХ рдФрд░ рдЪрд┐рдк рдкреЗрд╢ рдХрд░реЗрдВрдЧреЗ, рдЬреЛ рдмрддрд╛рддреА рд╣реИ рдХрд┐ рдЧреЛрд▓рдВрдЧ рдХрд┐рддрдирд╛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИред  рд╣рдо рд╕реАрдзреЗ рдХрд╛рд▓реА рд╕реЗ рдЦрд┐рдбрд╝рдХрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдВрдХрд▓рди рдХрд░рддреЗ рд╣реИрдВ, рдмрд╕ GOOS = windows рдкреИрд░рд╛рдореАрдЯрд░ рдЬреЛрдбрд╝рдХрд░: <br><br><pre> <code class="plaintext hljs">GOARCH=amd64 GOROOT="/opt/tls-tris/_dev/GOROOT/linux_amd64" GOOS=windows go build -ldflags="-s -w"</code> </pre> <br>  рдпрд╛ 32-рдмрд┐рдЯ рд╡рд┐рдХрд▓реНрдк: <br><br><pre> <code class="plaintext hljs">GOARCH=386 GOROOT="/opt/tls-tris/_dev/GOROOT/linux_amd64" GOOS=windows go build -ldflags="-s -w"</code> </pre> <br>  рд╡рд╣ рд╕рдм рд╣реИ!  рдФрд░ рдЕрдзрд┐рдХ рдкрд░реЗрд╢рд╛рдирд┐рдпреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред  рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ! <br><br><img src="https://habrastorage.org/webt/hq/cc/qf/hqccqf4y2sim1yutlrdduo3kmom.png"><br><br>  рд╕рдВрдХрд▓рдХ рдлрд╝рд╛рдЗрд▓ рд╕реЗ рдЕрддрд┐рд░рд┐рдХреНрдд рдХрдЪрд░рд╛ рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдВрдкрд╛рдЗрд▓рд░ рдлреНрд▓реИрдЧ -w рдФрд░ тАУs рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдпрд╣ рдПрдХ рдпреБрдЧрд▓ рд╣рдмрд▓рд┐рдЯреНрд╕ рд╕реЗ рдХрдо рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдЖрдХрд╛рд░ рдХреЛ рдФрд░ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ UPX рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреИрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br><h3>  рдПрдХ рдирд┐рд╖реНрдХрд░реНрд╖ рдХреЗ рдмрдЬрд╛рдп </h3><br>  рд╣рдо рд▓реЗрдЦ рдореЗрдВ, рдПрдХ рдЧреЛрд▓рдВрдЧ рдкрд░ рд▓рд┐рдЦреЗ рдПрдХ рдЯреНрдпреВрдирд░ рдХреЗ рдЙрджрд╛рд╣рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЯреАрдПрд▓рдПрд╕ 1.3 рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреА рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рд╡рд┐рд╢реЗрд╖рддрд╛ рдкрд░ рд▓рд╛рдЧреВ рдбреЛрдореЗрди-рдлреНрд░реЛрдиреНрдЯрд┐рдВрдЧ рдХреА рдирдИ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕реА рддрд░рд╣, рдЖрдк рдХреНрд▓рд╛рдЙрдбрдлрд╝реЗрдпрд░ рд╕рд░реНрд╡рд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреЛрд▓рдВрдЧ рдкрд░ рд▓рд┐рдЦреЗ рдЧрдП рдореМрдЬреВрджрд╛ рдЯреВрд▓рдХрд┐рдЯ рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <a href="https://github.com/Ne0nd0g/merlin">рдорд░реНрд▓рд┐рди</a> , рдЬрд╛рдиреЗ-рдорд╛рдиреЗ C2, рдпрд╛ рдХреЛрдмрд╛рд▓реНрдЯрд╕реНрдЯреНрд░рд╛рдЗрдХ рдмреАрдХрди рдХреЛ ESNI рдбреЛрдореЗрди-рдлрд╝реНрд░реЛрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░рддреЗ рд╣реИрдВ, рдЬрдм <a href="https://github.com/ryhanson/ExternalC2">рдмрд╛рд╣рд░реА C2 рдЪреИрдирд▓ рдХреЗ</a> рдорд╛рдзреНрдпрдо рд╕реЗ Teamserver рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реБрдП, Golang рдкрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╛ рдорд╛рдирдХ C ++ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред рдУрдкрдирдПрд╕рдПрд╕рдПрд▓ рдХреЗ рдкреИрдЪ рдХрд┐рдП рдЧрдП рд╕рдВрд╕реНрдХрд░рдг, рдЬрд┐рд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣рдордиреЗ рд▓реЗрдЦ рдХреЗ рдЕрдВрддрд┐рдо рднрд╛рдЧ рдореЗрдВ рдмрд╛рдд рдХреА рдереАред  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдХрд▓реНрдкрдирд╛ рдХреА рдХреЛрдИ рд╕реАрдорд╛ рдирд╣реАрдВ рд╣реИред <br><br>  рд╕реБрд░рдВрдЧ рдФрд░ CloudFlare рдХрд╛ рдЙрджрд╛рд╣рд░рдг рдПрдХ рдЕрд╡рдзрд╛рд░рдгрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдбреЛрдореЗрди-рдлреНрд░рдВрдЯ-рдлреЗрд╕рд┐рдВрдЧ рдХреА рджреВрд░ рдХреА рд╕рдВрднрд╛рд╡рдирд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХрд╣рдирд╛ рдЕрднреА рднреА рдореБрд╢реНрдХрд┐рд▓ рд╣реИред  рдлрд┐рд▓рд╣рд╛рд▓, eSNI рд╕рдорд░реНрдерди рдХреЗрд╡рд▓ CloudFlare рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИ рдФрд░, рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдХреБрдЫ рднреА рдЙрдиреНрд╣реЗрдВ рдЗрд╕ рддрд░рд╣ рдХреЗ рдлреНрд░рдВрдЯ-рдПрдВрдб рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддрд╛ рд╣реИ рдФрд░, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, SNI рдФрд░ eSNI рдореИрдЪ рдирд╣реАрдВ рд╣реЛрдиреЗ рдкрд░ tls рдХрдиреЗрдХреНрд╢рди рддреЛрдбрд╝рдирд╛ред  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рднрд╡рд┐рд╖реНрдп рджрд┐рдЦрд╛рдПрдЧрд╛ред  рд▓реЗрдХрд┐рди рдЕрднреА рдХреЗ рд▓рд┐рдП, kremlin.ru рдХреА рдЖрдбрд╝ рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХрд╛рдлреА рдЖрдХрд░реНрд╖рдХ рд▓рдЧрддреА рд╣реИред  рд╣реИ рдирд╛? <br><br>  рдЕрджреНрдпрддрд┐рдд рд╕реБрд░рдВрдЧ рдХреЛрдб, рд╕рд╛рде рд╣реА рд╕рдВрдХрд▓рд┐рдд рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп exe рдлрд╛рдЗрд▓реЗрдВ, <a href="https://github.com/mis-team/rsockstun">github</a> рдкрд░ рдПрдХ рдЕрд▓рдЧ рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╢рд╛рдЦрд╛ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИрдВред  GitHub рдкрд░ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдкреГрд╖реНрда рдкрд░ рд╕рднреА рд╕рдВрднрд╛рд╡рд┐рдд рд╕реБрд░рдВрдЧ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рдорд╕реНрдпрд╛ рд▓рд┐рдЦрдирд╛ рдмреЗрд╣рддрд░ рд╣реИред </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi477696/">https://habr.com/ru/post/hi477696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi477684/index.html">рдХреЛрдгреАрдп: рдЗрдВрдЯрд░рдПрдХреНрдЯрд┐рд╡ рдРрдкреНрд╕ рдХреЗ рд▓рд┐рдП рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рдмрд┐рд▓реНрдбрд┐рдВрдЧ рдХрдореНрдкреЗрдирд┐рдпрди</a></li>
<li><a href="../hi477686/index.html">рд╣рдорд╛рд░реА рдПрдЖрдИ рдпрд╛рддреНрд░рд╛ рд╕рдореНрдореЗрд▓рди рдореЗрдВ</a></li>
<li><a href="../hi477688/index.html">рджрд┐рд╕рдВрдмрд░ рдЖрдИрдЯреА рдЗрд╡реЗрдВрдЯреНрд╕ рдбрд╛рдЗрдЬреЗрд╕реНрдЯ</a></li>
<li><a href="../hi477692/index.html">рдЙрддреНрдкрд╛рджрди рдореЗрдВ рдЬреЗрдбрдЬреАрд╕реА рдФрд░ рд╢реЗрдирд╛рдиреНрджреЛрдЖ рдЬреАрд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдЕрдиреБрднрд╡</a></li>
<li><a href="../hi477694/index.html">рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдХреБрдЫ рднреА рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ - рдЕрдиреНрдп рднрд╛рд╖рд╛рдУрдВ рдХреЛ рднреА рд╕рдорд╛рди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ рдкрдбрд╝реЗрдЧрд╛</a></li>
<li><a href="../hi477700/index.html">рд╣реЙрд▓реАрд╡реБрдб рд╕рд┐рджреНрдзрд╛рдВрдд (IoC)</a></li>
<li><a href="../hi477704/index.html">CodeSideред рдкреНрд░рд╕рд┐рджреНрдз рд░реВрд╕реА рдПрдЖрдИ рдХрдк рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛ рдХреЗ рд▓рд┐рдП рдирдпрд╛ рдЦреЗрд▓</a></li>
<li><a href="../hi477706/index.html">HTTPS рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рддреЗ рд╕рдордп рдорд┐рд╢реНрд░рд┐рдд рд╕рд╛рдордЧреНрд░реА: рдХреИрд╕реЗ рдкрддрд╛ рдХрд░реЗрдВ рдФрд░ рдХреИрд╕реЗ рдкрд╛рд░ рдХрд░реЗрдВ</a></li>
<li><a href="../hi477710/index.html">рд╡реЗ рд╕реНрдХреВрд▓ рдореЗрдВ рдХреНрдпрд╛ рдирд╣реАрдВ рд╕рд┐рдЦрд╛рддреЗ рд╣реИрдВ: рд╣рдо рддрдХрдиреАрдХреА рд╕рд╣рд╛рдпрддрд╛ рдЗрдВрдЬреАрдирд┐рдпрд░реЛрдВ рдХреЛ рдХреИрд╕реЗ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд░рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi477712/index.html">рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛рдо рдбреЗрдЯрд╛ рд╕реНрдЯреНрд░рдХреНрдЪрд░реНрд╕</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>