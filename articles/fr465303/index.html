<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😀 🌯 🏉 Trains de Moscou (et pas seulement): ce qui a changé et merci à ceux qui ont aidé 🗝️ 🔨 🕺🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="600 000 personnes consultent l'horaire de notre journée, chaque petit changement a donc un effet à grande échelle. Je veux parler un peu du fait que n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Trains de Moscou (et pas seulement): ce qui a changé et merci à ceux qui ont aidé</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tuturu/blog/465303/"><img src="https://habrastorage.org/webt/qd/bu/_m/qdbu_m6dbbi_jetuirp_v3tjnug.jpeg"><br><br>  600 000 personnes consultent l'horaire de notre journée, chaque petit changement a donc un effet à grande échelle.  Je veux parler un peu du fait que nous avons ajouté des trains électriques à l'application à la demande de la communauté.  Et pour remercier tous ceux qui nous ont fait part de leurs commentaires, et pour montrer ce que nous avons changé. <br><br>  La première fonctionnalité importante est le mode hors ligne.  Nous ne l'avons pas introduit depuis longtemps, car le sens du planning est précisément en constante évolution.  Et si vous avez déjà dépassé la couverture cellulaire, il est préférable de surclasser pour ne pas arriver au train annulé. <br><br>  En fin de compte, ne pas le faire est une idée, car: <br><br><ol><li>  Beaucoup de gens veulent voir le calendrier dans son ensemble, et non en fonction de la situation actuelle. </li><li>  Une façon complètement inhabituelle d'utiliser l'application s'est ouverte: à partir d'un escalator.  Et sur les escaliers mécaniques, généralement une sorte d'interconnexion 3G-LTE ou tout simplement un changement de station de base.  Aux heures de pointe, il est également «étiré» entre les abonnés des cellules.  En général, dans le métro, il arrive souvent qu'Internet soit comme tel, mais il n'y a pas de connexion en fait. </li></ol><br><img src="https://habrastorage.org/webt/8v/5w/bu/8v5wbu4-psyzni-cv-pruq1ypjq.jpeg" width="360"><br><br>  Merci <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">OVAV</a> : nous avons commencé à détecter de telles situations.  Maintenant, le modèle d'action est le suivant: s'il y a une connexion rapide, le programme actuel est toujours chargé.  S'il n'y a pas de connexion, la version hors ligne est affichée (il s'agit en fait du cache local), c'est l'horodatage quand il était pertinent.  Au fur et à mesure que nous naviguons, nous pouvons arriver à obtenir une mise à jour (les packages sont très légers) et l'afficher immédiatement directement dans l'interface à la volée.  Ensuite, la marque sur le mode hors ligne sera supprimée. <br><br><img src="https://habrastorage.org/webt/fp/ib/53/fpib53vxjl7mxevx82ejj0sddqy.jpeg" width="360"><br><br>  Le mode hors ligne ajoute automatiquement les itinéraires sélectionnés et les horaires consultés (historique).  De plus, ce n'est pas un téléchargement manuel et pas seulement un cache - nous parcourons tous vos itinéraires après avoir accédé à nos serveurs et tout mettre à jour pour le mode hors ligne.  Vous ne pouvez pas ouvrir vos itinéraires préférés pendant des années, mais il y aura toujours une nouvelle version à partir du moment où vous avez eu Internet pour la dernière fois avec l'application ouverte.  L'historique est mis en cache pour les jours où vous avez déjà consulté le calendrier. <br><br>  Étant donné que les packages sont très légers (il existe des données XML pour quelques kilo-octets par route), tout cela est très rapide. <br><br><h3>  Prédiction tardive </h3><br>  Les trains électriques utilisant l'API du système de transport donnent un statut avec un retard d'un pas de graphe (10 minutes), et le statut sera dans les 10 dernières minutes.  Autrement dit, à 14h22, vous pouvez obtenir une image réelle du mouvement des trains à 14h12.  Et à 14h12, il sera assemblé avec un cadre de 10 minutes, c'est-à-dire, dans le pire des cas, le décalage sera de 19-20 minutes, au mieux - 10. Nous avons joué un peu avec les modèles de modèle et les données historiques et appris à réduire cette fenêtre à deux minutes pour prédire le mouvement du reste trains.  Autrement dit, si le train est en retard non pas en raison d'un accident soudain, mais en raison d'un changement tactique dans le calendrier, nous le saurons de manière très fiable 8 à 18 minutes plus tôt que les données réelles. <br><br><h3>  Convivialité </h3><br>  Surtout, nous avions des questions sur la convivialité.  Oui, il y a un an, nous n'avons pas ouvert immédiatement l'écran dont vous aviez besoin: un clic supplémentaire sur le planning à gauche.  Merci à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Airy</a> pour le billet surélevé. <br><br>  <b>Maintenant, la dernière recherche s'ouvre immédiatement sur l'écran de démarrage.</b>  De plus, nous surveillons la moitié de la journée: si vous ouvrez l'application après le déjeuner, nous réorganisons les gares de départ et de destination par endroits. <br><br>  <b>Ils ont trouvé un très beau bug,</b> qu'ils ont eux-mêmes posé il y a plusieurs années.  Et il s'est avéré que la même personne qui l'avait apportée le cherchait.  En général, il était une fois, nous avions besoin d'un moment où demain arrive sur le chemin de fer.  Minuit ne convient pas.  Le fait est que le jour de la planète se termine à minuit, et les gens - à un autre moment.  Et lorsque vous regardez des trains électriques pour aujourd'hui, vous vous attendez à ce qu'après celui de 23h50, il soit affiché à 00h20 sans changer de date. <br><br>  La question était de savoir où définir la frontière: se présenter jusqu'à une heure du matin, jusqu'à deux, jusqu'à trois, avant cinq heures du matin? <br><br>  Étant mathématiciens, nous avons modélisé les flux et pris en compte la répartition des vols.  Puisqu'il n'y avait pas de données volumineuses à l'époque, elles étaient limitées aux constantes.  Le temps magique a été mis en évidence pour Moscou - 2h52, c'est à ce moment qu'il était plus pratique de changer de jour. <br><br>  Pendant environ cinq ans, il est allé de plus en plus profondément dans le code.  Ensuite, il y avait quelques billets sur le fait que les trains disparaissent pour aujourd'hui: ce sont certaines requêtes de recherche entre 00h00 et 2h52 (nous pensions que c'est aujourd'hui hier).  Et hier, tous les trains sont partis. <br><br>  En conséquence, nous nous sommes divisés en catégories plus compréhensibles, comme nous aurions dû le faire initialement si nous n'avions pas poursuivi l'optimisation au cours de ces années (et que nous poursuivions). <br><br>  <b>Des plaintes ont plu sur un sujet brillant:</b> ils disent qu'il est impossible de regarder le programme la nuit.  Ils l'ont rendu sombre, maintenant c'est à la mode.  Ce qui est caractéristique: jusqu'à ce qu'il devienne à la mode, personne n'a écrit de tels billets. <br><br>  <b>Parfois, des billets étaient versés à l'effet que «vous avez perdu des trains électriques».</b>  Ils ne disparaissent pas ici, mais au CPPK et autres transporteurs (dans le calendrier).  Le modèle de comportement standard est que lorsqu'un train quitte l'horaire, il se dissout simplement dans l'air.  Les utilisateurs qui se souviennent de lui, pensent qu'ils cherchent quelque chose de mal et sont nerveux.  Ressentez la perte de contrôle.  Maintenant, nous avons fait le fantôme du train: une ligne de l'horaire intitulée «Annulée».  Les gens sont devenus plus calmes, mais nous ne sommes pas considérés comme de mauvais développeurs qui volent des trains à des citoyens honnêtes. <br><br>  <b>Mlle la station.</b>  Il y a plusieurs endroits où les trains électriques dans une gare sont à deux endroits différents.  Par exemple, dans le backend du calendrier de Moscou Kursk, il y a deux pièces: une - Kursky, la seconde - Gorky directions.  Ce sont deux stations indépendantes avec des coordonnées communes.  Le problème s'est avéré être que vous pouvez construire un itinéraire directement depuis l'un d'eux vers un point familier, ou vous pouvez manquer l'interface et sélectionner un autre point de départ, construire un itinéraire avec quatre transferts pendant deux heures de plus, mais au même point.  Les gens se sont plaints.  Nous avons connecté ces endroits en un point et corrigé automatiquement les entrées dans un certain nombre de cas. <br><br>  <b>La deuxième caractéristique similaire</b> - il y a beaucoup de stations avec des noms similaires.  Nous demandons explicitement à l'utilisateur ce qu'il voulait dire exactement lorsque la probabilité de collision est élevée. <br><br><img src="https://habrastorage.org/webt/tu/od/w8/tuodw8fxp8myk4guy_xdgzf4k6s.jpeg" width="360"><br><br>  <b>Beaucoup d'améliorations mineures avec la géolocalisation:</b> maintenant l'invite pour entrer dans la station dépend de votre position approximative, nous affichons celles les plus proches de vous. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Karpion a</a> écrit de nombreux souhaits sur la façon dont l'application devrait ressembler avec d'autres modes de transport.  Nous pensions que nous l'avions terminé, puis nous avons été confrontés à des difficultés de calcul, puis à nouveau nous avons pensé que nous l'avions terminé ... En général, cela s'est avéré quelque part complètement différent, quelque part mieux, mais quelque part il y a des impasses.  Après une version stable, mes collègues vous en diront plus en détail. <br><br>  En attendant, je peux dire que nous avons mené une étude sur combien il est nécessaire de traverser les bus avec des trains électriques.  Il s'est avéré que le bon.  Mais, comme nous aimons les données, une autre chose importante est apparue dans le processus de recherche.  Nous avons comparé les directions à Moscou, où c'est plus pratique en bus et où - en train. <br><br>  Regardez, nous avons identifié les directions où cela compte (ou où vous pouvez aller directement en bus là où les trains de banlieue sont nécessaires).  Trier par popularité de destination.  Donc, si vous avez des parents vivant dans ces villes, cette comparaison leur sera peut-être intéressante. <br><p><br></p><div class="scrollable-table"><table><tbody><tr><td><br><p>  <b>Direction</b> </p><br></td><td><br><p>  <b>Prix, bus</b> </p><br></td><td><br><p>  <b>Prix, train</b> </p><br></td><td><br><p>  <b>Transfert en train</b> </p><br></td></tr><tr><td><br><p>  Moscou - Mozhaysk </p><br></td><td><br><p>  257 </p><br></td><td><br><p>  276 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Obninsk </p><br></td><td><br><p>  269 </p><br></td><td><br><p>  284 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Stupino </p><br></td><td><br><p>  264 </p><br></td><td><br><p>  279 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Volokolamsk </p><br></td><td><br><p>  273 </p><br></td><td><br><p>  322 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Egorievsk </p><br></td><td><br><p>  275 </p><br></td><td><br><p>  276 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Pereslavl-Zalessky </p><br></td><td><br><p>  285 </p><br></td><td><br><p>  - </p><br></td><td><br><p>  - </p><br></td></tr><tr><td><br><p>  Moscou - Kubinka </p><br></td><td><br><p>  94 </p><br></td><td><br><p>  161 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Petushki </p><br></td><td><br><p>  253 </p><br></td><td><br><p>  337 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Voskresensk </p><br></td><td><br><p>  213 </p><br></td><td><br><p>  230 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Souzdal </p><br></td><td><br><p>  605 </p><br></td><td><br><p>  - </p><br></td><td><br><p>  - </p><br></td></tr><tr><td><br><p>  Moscou - Ryazan </p><br></td><td><br><p>  379 </p><br></td><td><br><p>  462 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Zaraysk </p><br></td><td><br><p>  336 </p><br></td><td><br><p>  - </p><br></td><td><br><p>  - </p><br></td></tr><tr><td><br><p>  Nizhny Novgorod - Mourom </p><br></td><td><br><p>  591 </p><br></td><td><br><p>  - </p><br></td><td><br><p>  - </p><br></td></tr><tr><td><br><p>  Moscou - Aleksin </p><br></td><td><br><p>  484 </p><br></td><td><br><p>  658 </p><br></td><td><br><p>  oui </p><br></td></tr><tr><td><br><p>  Moscou - Ozyory </p><br></td><td><br><p>  286 </p><br></td><td><br><p>  368 </p><br></td><td><br><p>  oui </p><br></td></tr><tr><td><br><p>  Moscou - Gus-Khrustalny </p><br></td><td><br><p>  517 </p><br></td><td><br><p>  701 </p><br></td><td><br><p>  oui </p><br></td></tr><tr><td><br><p>  Moscou - Yasnogorsk </p><br></td><td><br><p>  385 </p><br></td><td><br><p>  388 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Zubtsov </p><br></td><td><br><p>  436 </p><br></td><td><br><p>  - </p><br></td><td><br><p>  - </p><br></td></tr><tr><td><br><p>  Moscou - Lakinsk </p><br></td><td><br><p>  275 </p><br></td><td><br><p>  421 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Veliky Novgorod - Soltsy </p><br></td><td><br><p>  200 </p><br></td><td><br><p>  - </p><br></td><td><br><p>  - </p><br></td></tr></tbody></table></div><br><br>  En général, environ 50% des directions des trains (dans lesquels les deux gares sont reliées à la ville) ont une alternative à l'horaire des bus.  Dans le même temps, l'intersection avec les trains longue distance est petite, environ 7%. <br><br>  <b>Ils ont fait une chose très cool (pour nous): la fonctionnalité «plate-forme et chemin».</b>  C'est dans les 50 gares les plus fréquentées que nous avons commencé à prévoir où le train électrique sera desservi en fonction de l'historique de son approvisionnement et de ses déplacements.  Dans le même temps, les passagers de l'application peuvent voter pour la plate-forme de départ.  C'est-à-dire que vous êtes venu, êtes monté dans votre train et avez cliqué comme ceci: <br><br><img src="https://habrastorage.org/webt/pt/pd/69/ptpd69bodyu-iab6j7x0rip_ygs.png" width="360"><br><br>  S'il y a suffisamment de votes, le chemin et la plate-forme sont montrés à tous les passagers.  Si nous vous faisons confiance (et nous faisons confiance après quelques votes corrects), alors vous aurez une voix plus puissante.  Il y a quinze ans, des inconnus nous ont appelés pour nous dire que quelque part il y avait une annulation, et nous l'avons inscrite à l'horaire (car il n'y avait que du papier).  Même alors, nous nous souvenions que les passagers étaient heureux de s'entraider.  Je pense que maintenant nous comprendrons comment mieux faire et nous continuerons à regarder dans cette direction. <br><br>  Eh bien, et bien que nous ayons scié différentes fonctionnalités pour plus de commodité, nous avons également fait un modèle de la population de trains.  Cela aide à prévoir si vous monterez dans différents trains en position debout ou assise.  Pendant que nous l'exécutons, je vais probablement vous en dire plus sur la façon dont cela s'est terminé. <br><br>  Nous continuons de voir le calendrier le plus précis de Runet, restons en contact et sommes prêts à vous dire ce qui peut et doit être fait d'autre.  Nous ne faisons pas toujours rapidement les choses nécessaires, mais nous écoutons toujours.  Par conséquent, grondez-nous ou félicitez-nous, s'il vous plaît: c'est utile. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr465303/">https://habr.com/ru/post/fr465303/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr465293/index.html">Comment nous avons abandonné le grand hackathon et commencé à faire des voyages pour des équipes individuelles</a></li>
<li><a href="../fr465295/index.html">Comment j'ai travaillé en Turquie et fait connaissance avec le marché local</a></li>
<li><a href="../fr465297/index.html">"La meilleure chose que j'ai faite dans ma carrière est d'envoyer le travail en enfer." Chris Dancy sur la transformation de la vie en données</a></li>
<li><a href="../fr465299/index.html">Apache NIFI - Un bref aperçu des fonctionnalités dans la pratique</a></li>
<li><a href="../fr465301/index.html">Comment créer un processus de mise en page de commerce électronique pour obtenir toutes les données dont vous avez besoin</a></li>
<li><a href="../fr465309/index.html">Je suis le plus gros méchant du développement de jeux indépendants</a></li>
<li><a href="../fr465311/index.html">Système de surveillance de véhicules bricolage</a></li>
<li><a href="../fr465315/index.html">Kafka et microservices: un aperçu</a></li>
<li><a href="../fr465319/index.html">Malentendus du passé</a></li>
<li><a href="../fr465321/index.html">À l'avenir, les scientifiques pourront apprendre à prédire exactement ce dont vous vous souviendrez.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>