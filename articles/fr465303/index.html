<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòÄ üåØ üèâ Trains de Moscou (et pas seulement): ce qui a chang√© et merci √† ceux qui ont aid√© üóùÔ∏è üî® üï∫üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="600 000 personnes consultent l'horaire de notre journ√©e, chaque petit changement a donc un effet √† grande √©chelle. Je veux parler un peu du fait que n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Trains de Moscou (et pas seulement): ce qui a chang√© et merci √† ceux qui ont aid√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tuturu/blog/465303/"><img src="https://habrastorage.org/webt/qd/bu/_m/qdbu_m6dbbi_jetuirp_v3tjnug.jpeg"><br><br>  600 000 personnes consultent l'horaire de notre journ√©e, chaque petit changement a donc un effet √† grande √©chelle.  Je veux parler un peu du fait que nous avons ajout√© des trains √©lectriques √† l'application √† la demande de la communaut√©.  Et pour remercier tous ceux qui nous ont fait part de leurs commentaires, et pour montrer ce que nous avons chang√©. <br><br>  La premi√®re fonctionnalit√© importante est le mode hors ligne.  Nous ne l'avons pas introduit depuis longtemps, car le sens du planning est pr√©cis√©ment en constante √©volution.  Et si vous avez d√©j√† d√©pass√© la couverture cellulaire, il est pr√©f√©rable de surclasser pour ne pas arriver au train annul√©. <br><br>  En fin de compte, ne pas le faire est une id√©e, car: <br><br><ol><li>  Beaucoup de gens veulent voir le calendrier dans son ensemble, et non en fonction de la situation actuelle. </li><li>  Une fa√ßon compl√®tement inhabituelle d'utiliser l'application s'est ouverte: √† partir d'un escalator.  Et sur les escaliers m√©caniques, g√©n√©ralement une sorte d'interconnexion 3G-LTE ou tout simplement un changement de station de base.  Aux heures de pointe, il est √©galement ¬´√©tir√©¬ª entre les abonn√©s des cellules.  En g√©n√©ral, dans le m√©tro, il arrive souvent qu'Internet soit comme tel, mais il n'y a pas de connexion en fait. </li></ol><br><img src="https://habrastorage.org/webt/8v/5w/bu/8v5wbu4-psyzni-cv-pruq1ypjq.jpeg" width="360"><br><br>  Merci <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">OVAV</a> : nous avons commenc√© √† d√©tecter de telles situations.  Maintenant, le mod√®le d'action est le suivant: s'il y a une connexion rapide, le programme actuel est toujours charg√©.  S'il n'y a pas de connexion, la version hors ligne est affich√©e (il s'agit en fait du cache local), c'est l'horodatage quand il √©tait pertinent.  Au fur et √† mesure que nous naviguons, nous pouvons arriver √† obtenir une mise √† jour (les packages sont tr√®s l√©gers) et l'afficher imm√©diatement directement dans l'interface √† la vol√©e.  Ensuite, la marque sur le mode hors ligne sera supprim√©e. <br><br><img src="https://habrastorage.org/webt/fp/ib/53/fpib53vxjl7mxevx82ejj0sddqy.jpeg" width="360"><br><br>  Le mode hors ligne ajoute automatiquement les itin√©raires s√©lectionn√©s et les horaires consult√©s (historique).  De plus, ce n'est pas un t√©l√©chargement manuel et pas seulement un cache - nous parcourons tous vos itin√©raires apr√®s avoir acc√©d√© √† nos serveurs et tout mettre √† jour pour le mode hors ligne.  Vous ne pouvez pas ouvrir vos itin√©raires pr√©f√©r√©s pendant des ann√©es, mais il y aura toujours une nouvelle version √† partir du moment o√π vous avez eu Internet pour la derni√®re fois avec l'application ouverte.  L'historique est mis en cache pour les jours o√π vous avez d√©j√† consult√© le calendrier. <br><br>  √âtant donn√© que les packages sont tr√®s l√©gers (il existe des donn√©es XML pour quelques kilo-octets par route), tout cela est tr√®s rapide. <br><br><h3>  Pr√©diction tardive </h3><br>  Les trains √©lectriques utilisant l'API du syst√®me de transport donnent un statut avec un retard d'un pas de graphe (10 minutes), et le statut sera dans les 10 derni√®res minutes.  Autrement dit, √† 14h22, vous pouvez obtenir une image r√©elle du mouvement des trains √† 14h12.  Et √† 14h12, il sera assembl√© avec un cadre de 10 minutes, c'est-√†-dire, dans le pire des cas, le d√©calage sera de 19-20 minutes, au mieux - 10. Nous avons jou√© un peu avec les mod√®les de mod√®le et les donn√©es historiques et appris √† r√©duire cette fen√™tre √† deux minutes pour pr√©dire le mouvement du reste trains.  Autrement dit, si le train est en retard non pas en raison d'un accident soudain, mais en raison d'un changement tactique dans le calendrier, nous le saurons de mani√®re tr√®s fiable 8 √† 18 minutes plus t√¥t que les donn√©es r√©elles. <br><br><h3>  Convivialit√© </h3><br>  Surtout, nous avions des questions sur la convivialit√©.  Oui, il y a un an, nous n'avons pas ouvert imm√©diatement l'√©cran dont vous aviez besoin: un clic suppl√©mentaire sur le planning √† gauche.  Merci √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Airy</a> pour le billet sur√©lev√©. <br><br>  <b>Maintenant, la derni√®re recherche s'ouvre imm√©diatement sur l'√©cran de d√©marrage.</b>  De plus, nous surveillons la moiti√© de la journ√©e: si vous ouvrez l'application apr√®s le d√©jeuner, nous r√©organisons les gares de d√©part et de destination par endroits. <br><br>  <b>Ils ont trouv√© un tr√®s beau bug,</b> qu'ils ont eux-m√™mes pos√© il y a plusieurs ann√©es.  Et il s'est av√©r√© que la m√™me personne qui l'avait apport√©e le cherchait.  En g√©n√©ral, il √©tait une fois, nous avions besoin d'un moment o√π demain arrive sur le chemin de fer.  Minuit ne convient pas.  Le fait est que le jour de la plan√®te se termine √† minuit, et les gens - √† un autre moment.  Et lorsque vous regardez des trains √©lectriques pour aujourd'hui, vous vous attendez √† ce qu'apr√®s celui de 23h50, il soit affich√© √† 00h20 sans changer de date. <br><br>  La question √©tait de savoir o√π d√©finir la fronti√®re: se pr√©senter jusqu'√† une heure du matin, jusqu'√† deux, jusqu'√† trois, avant cinq heures du matin? <br><br>  √âtant math√©maticiens, nous avons mod√©lis√© les flux et pris en compte la r√©partition des vols.  Puisqu'il n'y avait pas de donn√©es volumineuses √† l'√©poque, elles √©taient limit√©es aux constantes.  Le temps magique a √©t√© mis en √©vidence pour Moscou - 2h52, c'est √† ce moment qu'il √©tait plus pratique de changer de jour. <br><br>  Pendant environ cinq ans, il est all√© de plus en plus profond√©ment dans le code.  Ensuite, il y avait quelques billets sur le fait que les trains disparaissent pour aujourd'hui: ce sont certaines requ√™tes de recherche entre 00h00 et 2h52 (nous pensions que c'est aujourd'hui hier).  Et hier, tous les trains sont partis. <br><br>  En cons√©quence, nous nous sommes divis√©s en cat√©gories plus compr√©hensibles, comme nous aurions d√ª le faire initialement si nous n'avions pas poursuivi l'optimisation au cours de ces ann√©es (et que nous poursuivions). <br><br>  <b>Des plaintes ont plu sur un sujet brillant:</b> ils disent qu'il est impossible de regarder le programme la nuit.  Ils l'ont rendu sombre, maintenant c'est √† la mode.  Ce qui est caract√©ristique: jusqu'√† ce qu'il devienne √† la mode, personne n'a √©crit de tels billets. <br><br>  <b>Parfois, des billets √©taient vers√©s √† l'effet que ¬´vous avez perdu des trains √©lectriques¬ª.</b>  Ils ne disparaissent pas ici, mais au CPPK et autres transporteurs (dans le calendrier).  Le mod√®le de comportement standard est que lorsqu'un train quitte l'horaire, il se dissout simplement dans l'air.  Les utilisateurs qui se souviennent de lui, pensent qu'ils cherchent quelque chose de mal et sont nerveux.  Ressentez la perte de contr√¥le.  Maintenant, nous avons fait le fant√¥me du train: une ligne de l'horaire intitul√©e ¬´Annul√©e¬ª.  Les gens sont devenus plus calmes, mais nous ne sommes pas consid√©r√©s comme de mauvais d√©veloppeurs qui volent des trains √† des citoyens honn√™tes. <br><br>  <b>Mlle la station.</b>  Il y a plusieurs endroits o√π les trains √©lectriques dans une gare sont √† deux endroits diff√©rents.  Par exemple, dans le backend du calendrier de Moscou Kursk, il y a deux pi√®ces: une - Kursky, la seconde - Gorky directions.  Ce sont deux stations ind√©pendantes avec des coordonn√©es communes.  Le probl√®me s'est av√©r√© √™tre que vous pouvez construire un itin√©raire directement depuis l'un d'eux vers un point familier, ou vous pouvez manquer l'interface et s√©lectionner un autre point de d√©part, construire un itin√©raire avec quatre transferts pendant deux heures de plus, mais au m√™me point.  Les gens se sont plaints.  Nous avons connect√© ces endroits en un point et corrig√© automatiquement les entr√©es dans un certain nombre de cas. <br><br>  <b>La deuxi√®me caract√©ristique similaire</b> - il y a beaucoup de stations avec des noms similaires.  Nous demandons explicitement √† l'utilisateur ce qu'il voulait dire exactement lorsque la probabilit√© de collision est √©lev√©e. <br><br><img src="https://habrastorage.org/webt/tu/od/w8/tuodw8fxp8myk4guy_xdgzf4k6s.jpeg" width="360"><br><br>  <b>Beaucoup d'am√©liorations mineures avec la g√©olocalisation:</b> maintenant l'invite pour entrer dans la station d√©pend de votre position approximative, nous affichons celles les plus proches de vous. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Karpion a</a> √©crit de nombreux souhaits sur la fa√ßon dont l'application devrait ressembler avec d'autres modes de transport.  Nous pensions que nous l'avions termin√©, puis nous avons √©t√© confront√©s √† des difficult√©s de calcul, puis √† nouveau nous avons pens√© que nous l'avions termin√© ... En g√©n√©ral, cela s'est av√©r√© quelque part compl√®tement diff√©rent, quelque part mieux, mais quelque part il y a des impasses.  Apr√®s une version stable, mes coll√®gues vous en diront plus en d√©tail. <br><br>  En attendant, je peux dire que nous avons men√© une √©tude sur combien il est n√©cessaire de traverser les bus avec des trains √©lectriques.  Il s'est av√©r√© que le bon.  Mais, comme nous aimons les donn√©es, une autre chose importante est apparue dans le processus de recherche.  Nous avons compar√© les directions √† Moscou, o√π c'est plus pratique en bus et o√π - en train. <br><br>  Regardez, nous avons identifi√© les directions o√π cela compte (ou o√π vous pouvez aller directement en bus l√† o√π les trains de banlieue sont n√©cessaires).  Trier par popularit√© de destination.  Donc, si vous avez des parents vivant dans ces villes, cette comparaison leur sera peut-√™tre int√©ressante. <br><p><br></p><div class="scrollable-table"><table><tbody><tr><td><br><p>  <b>Direction</b> </p><br></td><td><br><p>  <b>Prix, bus</b> </p><br></td><td><br><p>  <b>Prix, train</b> </p><br></td><td><br><p>  <b>Transfert en train</b> </p><br></td></tr><tr><td><br><p>  Moscou - Mozhaysk </p><br></td><td><br><p>  257 </p><br></td><td><br><p>  276 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Obninsk </p><br></td><td><br><p>  269 </p><br></td><td><br><p>  284 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Stupino </p><br></td><td><br><p>  264 </p><br></td><td><br><p>  279 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Volokolamsk </p><br></td><td><br><p>  273 </p><br></td><td><br><p>  322 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Egorievsk </p><br></td><td><br><p>  275 </p><br></td><td><br><p>  276 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Pereslavl-Zalessky </p><br></td><td><br><p>  285 </p><br></td><td><br><p>  - </p><br></td><td><br><p>  - </p><br></td></tr><tr><td><br><p>  Moscou - Kubinka </p><br></td><td><br><p>  94 </p><br></td><td><br><p>  161 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Petushki </p><br></td><td><br><p>  253 </p><br></td><td><br><p>  337 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Voskresensk </p><br></td><td><br><p>  213 </p><br></td><td><br><p>  230 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Souzdal </p><br></td><td><br><p>  605 </p><br></td><td><br><p>  - </p><br></td><td><br><p>  - </p><br></td></tr><tr><td><br><p>  Moscou - Ryazan </p><br></td><td><br><p>  379 </p><br></td><td><br><p>  462 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Zaraysk </p><br></td><td><br><p>  336 </p><br></td><td><br><p>  - </p><br></td><td><br><p>  - </p><br></td></tr><tr><td><br><p>  Nizhny Novgorod - Mourom </p><br></td><td><br><p>  591 </p><br></td><td><br><p>  - </p><br></td><td><br><p>  - </p><br></td></tr><tr><td><br><p>  Moscou - Aleksin </p><br></td><td><br><p>  484 </p><br></td><td><br><p>  658 </p><br></td><td><br><p>  oui </p><br></td></tr><tr><td><br><p>  Moscou - Ozyory </p><br></td><td><br><p>  286 </p><br></td><td><br><p>  368 </p><br></td><td><br><p>  oui </p><br></td></tr><tr><td><br><p>  Moscou - Gus-Khrustalny </p><br></td><td><br><p>  517 </p><br></td><td><br><p>  701 </p><br></td><td><br><p>  oui </p><br></td></tr><tr><td><br><p>  Moscou - Yasnogorsk </p><br></td><td><br><p>  385 </p><br></td><td><br><p>  388 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Moscou - Zubtsov </p><br></td><td><br><p>  436 </p><br></td><td><br><p>  - </p><br></td><td><br><p>  - </p><br></td></tr><tr><td><br><p>  Moscou - Lakinsk </p><br></td><td><br><p>  275 </p><br></td><td><br><p>  421 </p><br></td><td><br><p>  non </p><br></td></tr><tr><td><br><p>  Veliky Novgorod - Soltsy </p><br></td><td><br><p>  200 </p><br></td><td><br><p>  - </p><br></td><td><br><p>  - </p><br></td></tr></tbody></table></div><br><br>  En g√©n√©ral, environ 50% des directions des trains (dans lesquels les deux gares sont reli√©es √† la ville) ont une alternative √† l'horaire des bus.  Dans le m√™me temps, l'intersection avec les trains longue distance est petite, environ 7%. <br><br>  <b>Ils ont fait une chose tr√®s cool (pour nous): la fonctionnalit√© ¬´plate-forme et chemin¬ª.</b>  C'est dans les 50 gares les plus fr√©quent√©es que nous avons commenc√© √† pr√©voir o√π le train √©lectrique sera desservi en fonction de l'historique de son approvisionnement et de ses d√©placements.  Dans le m√™me temps, les passagers de l'application peuvent voter pour la plate-forme de d√©part.  C'est-√†-dire que vous √™tes venu, √™tes mont√© dans votre train et avez cliqu√© comme ceci: <br><br><img src="https://habrastorage.org/webt/pt/pd/69/ptpd69bodyu-iab6j7x0rip_ygs.png" width="360"><br><br>  S'il y a suffisamment de votes, le chemin et la plate-forme sont montr√©s √† tous les passagers.  Si nous vous faisons confiance (et nous faisons confiance apr√®s quelques votes corrects), alors vous aurez une voix plus puissante.  Il y a quinze ans, des inconnus nous ont appel√©s pour nous dire que quelque part il y avait une annulation, et nous l'avons inscrite √† l'horaire (car il n'y avait que du papier).  M√™me alors, nous nous souvenions que les passagers √©taient heureux de s'entraider.  Je pense que maintenant nous comprendrons comment mieux faire et nous continuerons √† regarder dans cette direction. <br><br>  Eh bien, et bien que nous ayons sci√© diff√©rentes fonctionnalit√©s pour plus de commodit√©, nous avons √©galement fait un mod√®le de la population de trains.  Cela aide √† pr√©voir si vous monterez dans diff√©rents trains en position debout ou assise.  Pendant que nous l'ex√©cutons, je vais probablement vous en dire plus sur la fa√ßon dont cela s'est termin√©. <br><br>  Nous continuons de voir le calendrier le plus pr√©cis de Runet, restons en contact et sommes pr√™ts √† vous dire ce qui peut et doit √™tre fait d'autre.  Nous ne faisons pas toujours rapidement les choses n√©cessaires, mais nous √©coutons toujours.  Par cons√©quent, grondez-nous ou f√©licitez-nous, s'il vous pla√Æt: c'est utile. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr465303/">https://habr.com/ru/post/fr465303/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr465293/index.html">Comment nous avons abandonn√© le grand hackathon et commenc√© √† faire des voyages pour des √©quipes individuelles</a></li>
<li><a href="../fr465295/index.html">Comment j'ai travaill√© en Turquie et fait connaissance avec le march√© local</a></li>
<li><a href="../fr465297/index.html">"La meilleure chose que j'ai faite dans ma carri√®re est d'envoyer le travail en enfer." Chris Dancy sur la transformation de la vie en donn√©es</a></li>
<li><a href="../fr465299/index.html">Apache NIFI - Un bref aper√ßu des fonctionnalit√©s dans la pratique</a></li>
<li><a href="../fr465301/index.html">Comment cr√©er un processus de mise en page de commerce √©lectronique pour obtenir toutes les donn√©es dont vous avez besoin</a></li>
<li><a href="../fr465309/index.html">Je suis le plus gros m√©chant du d√©veloppement de jeux ind√©pendants</a></li>
<li><a href="../fr465311/index.html">Syst√®me de surveillance de v√©hicules bricolage</a></li>
<li><a href="../fr465315/index.html">Kafka et microservices: un aper√ßu</a></li>
<li><a href="../fr465319/index.html">Malentendus du pass√©</a></li>
<li><a href="../fr465321/index.html">√Ä l'avenir, les scientifiques pourront apprendre √† pr√©dire exactement ce dont vous vous souviendrez.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>