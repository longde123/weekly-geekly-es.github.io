<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò≠ üëåüèΩ ü¶í Debilidades HTTPS. Parte 2 üö± üë©üèº‚Äçüåæ üññüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cualquier sistema tiene sus propias fortalezas y debilidades. La primera parte sobre las debilidades de HTTPS provoc√≥ una reacci√≥n ambigua de que "no ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Debilidades HTTPS. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413163/">  Cualquier sistema tiene sus propias fortalezas y debilidades.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La primera parte sobre las debilidades de HTTPS</a> provoc√≥ una reacci√≥n ambigua de que "no se trata de debilidades, se pretend√≠a que as√≠ fuera".  La primera parte dec√≠a: <br><br><ol><li>  Sobre la imposibilidad de proporcionar total confidencialidad y privacidad a los usuarios (a√∫n puede rastrear y prohibir los recursos que visita una persona) </li><li>  El hecho de que los certificados se transmiten a trav√©s de un canal abierto y a menudo contienen m√°s informaci√≥n que el recurso actual (por ejemplo, el certificado bing.com contiene informaci√≥n sobre 72 recursos adicionales, incluidos virgo, prueba, entorno beta) </li></ol><br>  Seguir√© llam√°ndolo "debilidades" del dise√±o.  En este art√≠culo, hablaremos sobre otra debilidad: la <b>centralizaci√≥n</b> . <br><br>  HTTPS se basa en protocolos SSL y TLS (por simplicidad simplemente llamaremos SSL, aunque SSL y TLS funcionan en diferentes niveles de la pila OSI).  Por lo tanto, hablando de debilidades, tendremos en cuenta la centralizaci√≥n del protocolo SSL. <br><br><h2>  Teor√≠a </h2><br>  Comience con la teor√≠a de los protocolos de cifrado.  El problema con la criptograf√≠a moderna no es el cifrado en s√≠, sino qu√© hacer con las claves: c√≥mo almacenarlas, transferirlas, crearlas y destruirlas de forma segura. <br><br>  La base de SSL es el <i>cifrado asim√©trico</i> , que est√° determinado por la presencia de dos claves: si una se cifra, solo la segunda puede descifrar, y viceversa. <br><br>  La funci√≥n principal del cifrado asim√©trico es la <b>autenticaci√≥n</b> , no el cifrado en absoluto: es una operaci√≥n bastante costosa y que requiere muchos recursos para este algoritmo.  El cifrado r√°pido y eficiente es prerrogativa de los algoritmos sim√©tricos que usan la misma clave para el cifrado y el descifrado. <a name="habracut"></a><br><br>  Una de las claves siempre permanece en un lado para confirmar su identificaci√≥n, se llama <b>privada</b> .  La clave p√∫blica est√° disponible para todos. <br><br>  Imagina que hay un pueblo del futuro en el que viven Boris y Anya.  En el futuro, las teclas de un tama√±o diferente ya son m√°s estrictas, y las habilidades del cerebro son desproporcionadas con respecto a las modernas, pero supongamos que el enfoque sigue siendo el mismo. <br><br>  Boris y Anya quieren la privacidad de su correspondencia amorosa, por lo que lo principal para ellos es un intercambio seguro de informaci√≥n. <br><br>  En el caso m√°s simple, Boris le env√≠a a Anna un mensaje: "hablemos".  Anya genera dos pares de claves de cifrado asim√©tricas: Pr1 privado y P1 p√∫blico.  "Vamos", dice Anya, "Soy Anya, aqu√≠ est√° mi clave p√∫blica, aqu√≠ est√° el algoritmo de cifrado sim√©trico que conozco".  Boris genera una clave sim√©trica S1, la cifra con la clave p√∫blica Ani P1 (S1).  Ahora, incluso el propio Boris no podr√° descifrar S1, porque solo Anya puede descifrar el mensaje con su clave privada.  Al final, Boris y Ani tienen una clave de sesi√≥n sim√©trica para "garantizar" la transmisi√≥n confiable de cartas entre ellos y evitar que los padres lean su correspondencia. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b9/e67/314/6b9e67314d1d8ff276cdac79d259c73b.png" alt="imagen"><br><br>  Espec√≠ficamente, no reduje fuertemente este mensaje, de hecho, describimos SSL Handshake con autenticaci√≥n unidireccional [1].  Sobre una base de dos v√≠as, Boris genera su propio par de claves y transfiere la clave p√∫blica a Anya. <br><br>  Una conclusi√≥n importante que ya podemos hacer.  De las tres funciones principales del protocolo SSL (autenticaci√≥n, cifrado, integridad), la m√°s importante es la autenticaci√≥n. <br><br>  Todo est√° bien hasta que aparece un cartero, ofendido por la vida, que es codicioso por leer las cartas de otras personas, y adem√°s es inteligente.  Entre Boris y Anya, surge la pregunta de c√≥mo garantizar ahora que el cartero no podr√° leer sus mensajes.  La respuesta es de ninguna manera.  El cartero puede generar su propio par de claves, exponer a Boris su clave "supuestamente" de Ani, organizar dos canales cifrados y leer cartas con calma. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/12b/158/036/12b158036042161746d368ea8f61d5db.png" alt="imagen"><br><br>  El dilema solo se puede resolver con la presencia de un tercero que pueda garantizar que la clave P1 le pertenece a Ana.  Imagine que aparece un consejo de la aldea en la aldea, que mantiene un registro de claves p√∫blicas para los residentes.  Anya puede tomar su pasaporte, su clave p√∫blica P1, ir all√≠ y solicitar registrarse.  Boris, cuando recibe P1 de Ani, puede ir al mismo consejo de la aldea y verificar el registro.  Si la clave no coincide, puede comenzar a pecar en el cartero y culparlo por todo lo serio, aunque puede negarlo.  Pero el problema a√∫n se est√° resolviendo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/981/d56/043/981d560437ecc4670992bd5f367069d1.png" alt="imagen"><br><br>  No era un camilpho, por supuesto, Boris se arrastraba al consejo del pueblo cada vez.  Por lo tanto, la misma autenticaci√≥n se puede hacer con el propio consejo de la aldea.  El Village Council ahora se llama a s√≠ mismo Autoridad de Certificaci√≥n (CA) y tiene su propio par de claves, P10 y Pr10.  Cuando Anya llega con un pasaporte y su clave p√∫blica, CA emite algo como una tarjeta que dice que se trata de Anya, posee la clave p√∫blica P1, alguna otra informaci√≥n, hasta el n√∫mero de pasaporte, y agrega otro campo para ella. firmas: toma toda la informaci√≥n de la tarjeta, le quita el hash, la cifra con su clave privada y la llama firma digital.  Ser√≠a posible prescindir de un hash, pero la firma era demasiado grande.  Y la CA ahora llama a esta tarjeta un certificado. <br><br>  Ahora, por intercambiar mensajes de amor con Anya, Anya le da no solo su nombre y clave p√∫blica, sino tambi√©n su certificado.  Boris solo tendr√° que ir al consejo de la aldea una vez y pedirles su clave p√∫blica.  Cualquier informaci√≥n que esta clave pueda descifrar ser√° considerada a priori informaci√≥n cifrada por el consejo de la aldea.  El cartero no sabe qu√© hacer en absoluto, est√° cubierto por un vac√≠o existencial, solo le queda una cosa: tratar de recoger la clave privada del consejo del pueblo para que la vida vuelva al punto de partida. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/822/a8b/93d/822a8b93d97f8521ea56a51348686d39.png" alt="imagen"><br><br>  Pero la vida no se detiene.  Boris tiene otra novia en un pueblo vecino, luego otro.  Tiene que agregar las claves de otros consejos de la aldea a los de su confianza, comienza a mantener su registro con las claves p√∫blicas de las autoridades de certificaci√≥n.  Luego gana una escala nacional y supranacional.  Hay tantas organizaciones que firman certificados que comienzan a fusionarse en una jerarqu√≠a.  Aparece la Autoridad de certificaci√≥n ra√≠z, que no firma los certificados de simples mortales, sino que firma los certificados de los centros intermedios (Autoridad de certificaci√≥n intermedia) despu√©s de verificarlos.  Ahora es suficiente que Boris almacene solo las claves p√∫blicas de los certificados ra√≠z.  Y de Ani recibe no solo uno de sus certificados, sino tambi√©n certificados de centros intermedios, con el fin de verificarlos hasta el centro ra√≠z. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/99f/55f/30d/99f55f30dcb8fffcafb5f23a5c318596.png" alt="imagen"><br><br><h2>  Campo problema </h2><br>  El sistema se vuelve m√°s complejo y <i>centralizado</i> , y desde ese momento el cartero nuevamente tiene una oportunidad. <br><br>  Por un lado, Boris inicialmente tiene una peque√±a lista de autoridades de certificaci√≥n ra√≠z (Windows prescribe unas 50 autoridades de certificaci√≥n ra√≠z durante la instalaci√≥n).  Por otro lado, es dif√≠cil para √©l seguir cada vez que toda la cadena de centros de certificaci√≥n.  Lo m√°s probable es que ya no verifique que el certificado de Ani de su propia aldea, por alguna raz√≥n, indique el centro de certificaci√≥n de otro pa√≠s.  Conf√≠a en su lista de centros de ra√≠z en 99.9 por ciento.  Un cartero puede tomar el camino m√°s brutal, y de alguna manera (ingenier√≠a social, pirater√≠a de penetraci√≥n) registrar su autoridad de certificaci√≥n de ra√≠z falsa en el registro de Boris. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/649/a3f/357/649a3f3579c7f587bd7bf5990be4608c.png" alt="imagen"><br><br>  <b>PS.</b>  Este m√©todo de agregar un certificado de centro ra√≠z falso es utilizado activamente por los pentesters (como yo) y los atacantes.  Para realizar pruebas de penetraci√≥n y utilizar este enfoque, mi herramienta favorita es ZapProxy (de c√≥digo abierto y gratuito), que generar√° un certificado de centro ra√≠z (deber√° instalarse manualmente) y luego sobre la marcha reemplazar este certificado por uno "similar".  Esto le permite no solo ver el tr√°fico, sino tambi√©n detenerlo, cambiarlo y enviarlo m√°s.  Por lo tanto, si la validaci√≥n en su sistema no est√° duplicada en el servidor, entonces definitivamente tiene problemas. <br><br>  <b>PPS</b>  El segundo problema que se plante√≥ en este caso se refiere a Ani y la indicaci√≥n de un centro incomprensible en su certificado.  Anya pag√≥ el dinero y le gustar√≠a que Boris la reconociera de todos modos.  Este problema se resuelve mediante el anclaje SSL [3], cuando la aplicaci√≥n solo se puede confiar en un determinado certificado y ciertas autoridades de certificaci√≥n.  Esto es especialmente √∫til para aplicaciones de alto riesgo.  Con los navegadores, esto es m√°s complicado, para aplicaciones m√≥viles que funcionan con uno o dos servicios, m√°s f√°cil.  En aras de la experimentaci√≥n, puse un certificado falso en mi Android, indiqu√© que el tr√°fico deber√≠a pasar por ZapProxy, que sobresale en la red de mi m√°quina, y analic√© cu√°ntas aplicaciones usan este mecanismo.  Casi nadie, pude ver y jugar con la sustituci√≥n del tr√°fico con casi todas las aplicaciones populares. <br><br>  Entonces, de vuelta a nuestro cartero.  El gobierno no pudo sino apreciar su celo y le otorg√≥ el estatus de agente secreto con poderes superiores.  Aunque las claves privadas de las autoridades de certificaci√≥n ra√≠z se almacenan bajo siete cerraduras, discos autograbantes, protecci√≥n multinivel, incluso la autoridad del cartero puede no ser suficiente para negociar con ellos para proporcionarle su clave privada para generar certificados v√°lidos falsos sobre la marcha (aunque todo es posible).  Encontr√≥ una manera m√°s f√°cil.  Acude a su propio consejo de la aldea, que se encuentra en la jerarqu√≠a de los centros de certificaci√≥n en el nivel m√°s bajo, y presiona o soborna al consejo de la aldea para firmar su certificado como certificado de un centro de certificaci√≥n intermedio.  Ahora puede escuchar el tr√°fico no solo de Boris, sino en principio de cualquier tema.  Lo m√°s probable es que la persona ni siquiera note nada, el navegador no emitir√° ninguna advertencia. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/958/fb1/abd/958fb1abd619e6f93d8ee7ad12162f0b.png" alt="imagen"><br><br>  Este es un problema conocido, y la humanidad tambi√©n est√° tratando de combatirlo.  Si encuentra dichos certificados falsos, centros intermedios y ra√≠z comprometidos, estos certificados deben marcarse como revocados y comprometidos (Certificados revocados).  Esto significa que, adem√°s de almacenar certificados ra√≠z, Boris a√∫n necesita sincronizarlos con la lista en l√≠nea de certificados revocados; este mecanismo se implementa a trav√©s de CRL (lista de revocaci√≥n de certificados) y protocolos de Protocolo de estado de certificado en l√≠nea (OCSP) [4], que, por cierto, funcionan de acuerdo con canal desprotegido.  Cuando comenzamos a trabajar activamente en el control del tr√°fico de SALIDA utilizando Dhound [5], notamos solicitudes peri√≥dicas en el puerto 80.  Si proh√≠be tales solicitudes en el nivel de firewall, algunas funciones dejan de funcionar, por ejemplo, el env√≠o de correo.  El problema con los certificados revocados es que ya hay una gran cantidad de ellos: en 2013, hubo alrededor de 3 millones de certificados revocados [6], 23,000 certificados Symantec revocados solo en 2018 [7].  Chrome desactiv√≥ la funci√≥n predeterminada de verificaci√≥n completa de certificados revocados hace unos a√±os [8] para aumentar la velocidad de carga de la p√°gina.  Resulta que si se descubre nuestro cartero, el proceso de prevenci√≥n adicional de sus acciones ser√° largo y no siempre ser√° exitoso. <br><br><h2>  Conclusiones </h2><br>  El sistema SSL moderno est√° parcialmente <i>cerrado y centralizado</i> , lo que definitivamente es una de sus debilidades.  Mientras sea as√≠, siempre habr√° una tentaci√≥n para que las "personas poderosas de este mundo" obtengan sus beneficios, sin dar prioridad a la privacidad personal.  A√∫n as√≠, sus propios algoritmos de cifrado se crear√°n a nivel nacional, en un intento de aislar a otros pa√≠ses de sus propios ciudadanos y hacerlo nosotros mismos.  El compromiso de los nodos clave puede derribar todo el sistema en su conjunto.  La creciente entrop√≠a y complejidad del sistema conducir√° cada vez m√°s a su estado inestable y, en √∫ltima instancia, a la muerte del sistema. <br><br>  ¬øQu√© salida?  La transici√≥n de un sistema SSL cerrado y centralizado a uno m√°s transparente y distribuido, que por su naturaleza no podr√° dar ventajas a ninguna de las partes.  Quiz√°s esta sea una soluci√≥n algo similar a la que implementa una cadena de bloques abierta. <br><br>  PS.  El protocolo SSL tiene matices m√°s complejos que no se mencionaron en el art√≠culo.  Pero el nivel de informaci√≥n fue suficiente para revelar una de sus debilidades.  ¬øHay alguna otra debilidad?  En los siguientes art√≠culos lo veremos. <br><br><div class="spoiler">  <b class="spoiler_title">Referencias</b> <div class="spoiler_text"><ol><li>  [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Protocolo de enlace SSL</a> ] </li><li>  [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ZapProxy</a> ] </li><li>  [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SSL Pining</a> ] </li><li>  [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Revocaci√≥n de certificado (CRL vs OCSP)</a> ] </li><li>  [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dhound</a> ] </li><li>  [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Una evaluaci√≥n de la efectividad de los CRLSets de Chrome</a> ] </li><li>  [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">23,000 certificados de Symantec revocados despu√©s de la fuga de claves privadas</a> ] </li><li>  [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Habilitaci√≥n de las verificaciones de revocaci√≥n de certificados en Google Chrome</a> ] </li></ol></div></div><br>  Publicado por Denis Koloshko, CISSP </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es413163/">https://habr.com/ru/post/es413163/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es413151/index.html">La NSA propuso el est√°ndar de cifrado para dispositivos IoT, pero ISO lo rechaz√≥</a></li>
<li><a href="../es413155/index.html">Gu√≠a de estilo de Shell de Google (en ruso)</a></li>
<li><a href="../es413157/index.html">Acerca del almacenamiento de contrase√±as en la base de datos</a></li>
<li><a href="../es413159/index.html">IU oscuro o claro? Consejos para elegir un esquema de color para su interfaz</a></li>
<li><a href="../es413161/index.html">Poema git</a></li>
<li><a href="../es413165/index.html">Explicaci√≥n SRTP</a></li>
<li><a href="../es413167/index.html">¬øC√≥mo integrar Zimbra con un sistema DLP?</a></li>
<li><a href="../es413169/index.html">Matriz √∫til y m√©todos de objetos en JavaScript</a></li>
<li><a href="../es413171/index.html">Tokamak JET lanza nueva campa√±a de tritio de deuterio</a></li>
<li><a href="../es413173/index.html">Monitoreo de errores de JavaScript con window.onerror</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>