<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐰 ⛷️ 🎉 Medición de la calidad del código de la aplicación de Android con Sonarqube y Jacoco en 2019 ☢️ 😴 🤣</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! 


 Mi nombre es Artyom Dobrovinsky, trabajo como desarrollador de Android en FINCH . 


 Una vez, después de un par de pintas con un coleg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Medición de la calidad del código de la aplicación de Android con Sonarqube y Jacoco en 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475784/"><p><img src="https://habrastorage.org/webt/hy/hs/hf/hyhshf-j1xpd1xyijiaxido1e-q.png"></p><br><p>  Hola Habr! </p><br><p>  Mi nombre es Artyom Dobrovinsky, trabajo como desarrollador de Android en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FINCH</a> . </p><br><p>  Una vez, después de un par de pintas con un colega de una compañía que está colocando anuncios para vender MIG y mosquitos llamados Igor, comenzamos a discutir analizadores de código estático en CI (y qué más discutir).  Se expresó la idea de que eran geniales de usar, pero solo después de que hubo confianza en la confiabilidad lógica del código.  En otras palabras, puede pensar en el estilo de código solo después de escribir todas las pruebas. </p><br><p>  Decidí escuchar a mi colega y pensé en cómo calcular la escala del desastre para aplicaciones improvisadas.  La vista cayó sobre Sonarqube y Jacoco.  El proceso de conectarlos para proyectos de hello-world es elemental.  Conectarlos a un proyecto de Android, dividido en módulos, ya es más difícil.  Para ayudar a los interesados, este artículo fue escrito. </p><a name="habracut"></a><br><p> Habré ya tiene una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">muy buena traducción del</a> tutorial sobre el uso de Sonarqube, pero es de 2016, algo está desactualizado allí, no hay kotlin y solo encuentro que la generación de informes para todos los buildType es redundante. </p><br><p>  Un poco sobre bibliotecas, para aquellos que no están familiarizados con ellas. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sonarqube</a> es una plataforma de código abierto para la inspección continua y la medición de la calidad del código.  Le permite seguir la lucha contra la deuda técnica a lo largo del tiempo (es genial ver que la deuda técnica está ganando, y no puede hacer nada al respecto).  Sonar también supervisa el código duplicado, las vulnerabilidades potenciales y la excesiva complejidad de las funciones. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jacoco</a> es una biblioteca gratuita para calcular la cobertura de prueba de un proyecto en Java.  Pero con Kotlin haremos sus amigos. </p><br><h3 id="kak-podklyuchit-sonarqube-i-jacoco">  Cómo conectar Sonarqube y Jacoco </h3><br><p>  En build.gradle del módulo raíz, agregue el siguiente código: </p><br><pre><code class="plaintext hljs">apply plugin: 'android.application' apply plugin: 'org.sonarqube' sonarqube { properties { property "sonar.host.url", "%url   sonarqube%" property "sonar.login", "%%" property "sonar.projectName", "% %" property "sonar.projectKey", "%  %" property "sonar.reportPath", "${project.buildDir}/sonarqube/test.exec" property "sonar.projectBaseDir", "$rootDir" property "sonar.sources", "." property "sonar.tests", "" property "sonar.coverage.exclusions", "**/src/androidTest/**, **/src/test/**" property "sonar.coverage.jacoco.xmlReportPaths", fileTree(include: ['*/*/jacoco*.xml'], dir: "$rootDir/app/build/reports/jacoco").collect() } }</code> </pre> <br><p>  <code>sonar.reportPath</code> : indica dónde debe colocar Sonar el informe para un análisis más detallado. <br>  <code>sonar.projectBaseDir</code> especifica la carpeta en la que se iniciará el análisis inicialmente;  en nuestro caso, este es $ rootDir, la carpeta raíz del proyecto. <br>  <code>sonar.coverage.exclusions</code> enumerando excepciones para contar la cobertura, donde ** es cualquier carpeta, a * es cualquier nombre de archivo o resolución. <br>  <code>sonar.sources</code> es la carpeta de origen. <br>  <code>sonar.tests</code> es una línea vacía aquí para que Sonarqube también pueda analizar las pruebas. <br>  <code>sonar.coverage.exclusions</code> : excluimos las pruebas del análisis de cobertura de pruebas. <br>  <code>sonar.coverage.jacoco.xmlReportPaths</code> : mediante el método <code>collect()</code> recopilamos informes de Jacoco para calcular la cobertura de la prueba. </p><br><p>  Para activar Jacoco, es mejor crear un archivo <code>jacoco.gradle</code> y escribir toda la lógica necesaria allí.  Esto ayudará a evitar abarrotar el otro build.gradle. </p><br><p>  Para no registrar a Jacoco en el build.gradle de cada subproyecto, prescribimos su inicialización en el cierre de los subproyectos.  En <code>reportsDirPath</code> para submódulos, especifique la carpeta raíz.  A partir de ahí, Sonar tomará todos los informes de Jacoco. </p><br><pre> <code class="plaintext hljs">subprojects { apply plugin: 'jacoco' jacoco { toolVersion = '0.8.5' def reportsDirPath = "${project.rootDir}/app/build/reports/jacoco/${project.name}" reportsDir = file(reportsDirPath) } }</code> </pre> <br><p>  En el mismo archivo, escribimos una función para configurar Jacoco. <br>  Esta función es excelente, así que primero la traeré y luego explicaré lo que está sucediendo en ella. </p><br><pre> <code class="plaintext hljs">def configureJacoco = { project -&gt; def variantName = project.name project.tasks.create(name: "getJacocoReports", type: JacocoReport) { group = "Reporting" description = "Generate Jacoco coverage reports for the $variantName build." reports { html.enabled = true xml.enabled = true } def excludes = [ '**/R.class', '**/R$*.class', '**/BuildConfig.*', '**/Manifest*.*', '**/AndroidManifest.xml', '**/*Test*.*', 'android/**/*.*', 'androidx/**/*.*', '**/*Fragment.*', '**/*Activity.*', '**/*Api.*', '**/injection/**/*.class', '**/ui/**/*.class', %  build- % ] def javaClasses = fileTree(dir: "${project.buildDir}/intermediates/javac", excludes: excludes) def kotlinClasses = fileTree(dir: "${project.buildDir}/tmp/kotlin-classes", excludes: excludes) classDirectories = files([javaClasses, kotlinClasses]) sourceDirectories = files([ "${project.projectDir}/src/main/java", "${project.projectDir}/src/main/kotlin", ]) executionData = files(fileTree(include: ['*.exec'], dir: "${project.buildDir}/jacoco").files) } }</code> </pre> <br><p>  Creamos la tarea <code>getJacocoReports</code> , el grupo "Informes".  Los informes se proporcionarán en formatos html y xml.  Se analizarán todos los archivos, excepto los incluidos en la matriz exclude.  Además de los archivos Androyd generados, decidí excluir del análisis todos los fragmentos y actividades, las interfaces de actualización, el paquete con DI, las vistas personalizadas y el código de la biblioteca. <br>  Quizás esta lista cambie con el tiempo. </p><br><p>  <code>classDirectories</code> : una indicación de dónde buscar el código para el análisis.  Incluimos archivos java y kotlin aquí. <br>  <code>sourceDirectories</code> : especifique dónde buscará Jacoco los archivos fuente. <br>  <code>executionData</code> : como en el caso de Sonar, una indicación de dónde se generará el informe para calcular la cobertura. </p><br><p>  También en jacoco.gradle necesita agregar su configuración para todos los módulos usando la función anterior: </p><br><pre> <code class="plaintext hljs">allprojects { project -&gt; configureJacoco(project) project.tasks.withType(Test) { enabled = true jacoco.includeNoLocationClasses = true } }</code> </pre> <br><p>  Y una tarea para recopilar los informes generados: </p><br><pre> <code class="plaintext hljs">task getJacocoReports() { group = "Reporting" subprojects.forEach { subproject -&gt; subproject.tasks.withType(JacocoReport).forEach { task -&gt; dependsOn task } } }</code> </pre> <br><h3 id="zapusk-sonarqube-cherez-komandnuyu-stroku">  Ejecutando Sonarqube a través de la línea de comando </h3><br><p>  <code>./gradlew %    % &amp;&amp; ./gradlew jacocoAggregateReports &amp;&amp; ./gradlew sonarqube</code> simplemente: <code>./gradlew %    % &amp;&amp; ./gradlew jacocoAggregateReports &amp;&amp; ./gradlew sonarqube</code> .  Los comandos se ejecutan a través de <code>&amp;&amp;</code> , porque la ejecución debe interrumpirse si el paso anterior no tuvo éxito. </p><br><p>  Lo que sucede en el comando anterior: </p><br><ol><li>  Primero, ejecute las pruebas (al mismo tiempo generamos todos los archivos necesarios en la carpeta de compilación). </li><li>  Generar un informe Jacoco. </li><li>  Lanzamiento Sonarqube. </li></ol><br><p>  Luego debe ir al sitio, fallar en el proyecto y observar la escala del desastre.  La página del proyecto muestra el resultado de la última verificación. </p><br><p>  Con Sonarqube, la idea del estado del proyecto se está volviendo mucho más completa.  Es más fácil ajustar la acumulación de deuda técnica que asumir desarrolladores novatos (en cada objeción, Sonarqube da un argumento por el cual no se acepta escribir de esa manera; leer estas explicaciones puede ser muy útil), y simplemente: el <strong>conocimiento es poder</strong> . </p><br><h3 id="thats-all-folks">  ¡Eso es todo, amigos! </h3><br><p>  Pregunta a los lectores: ¿qué utilizan para analizar el código y medir la cobertura de la prueba?  ¿Ves el punto en absoluto? </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/475784/">https://habr.com/ru/post/475784/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../475772/index.html">6 puntos de aplicación para el internet industrial de las cosas</a></li>
<li><a href="../475774/index.html">"Estas son reglas estúpidas que molestan a todos": discusión sobre prácticas de campo de contraseña</a></li>
<li><a href="../475776/index.html">Hágalo usted mismo para tres guitarras</a></li>
<li><a href="../475780/index.html">Decodificador cirílico de imprimible citado</a></li>
<li><a href="../475782/index.html">Pruebas tautológicas, buenas y malas.</a></li>
<li><a href="../475788/index.html">"Aparentemente, hay una gran batalla por delante". Lo que le espera a la industria de TI en el futuro cercano</a></li>
<li><a href="../475790/index.html">Startups que pueden sorprender</a></li>
<li><a href="../475792/index.html">¿A qué investigación médica vale la pena prestarle atención este año?</a></li>
<li><a href="../475796/index.html">Políticas de reputación de cambios de desbordamiento de pila para problemas</a></li>
<li><a href="../475802/index.html">¿Cómo hacer que Daily / Stand-up no parezca una reunión de estado?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>