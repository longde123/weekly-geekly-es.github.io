<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title> 凤  Medici贸n de la calidad del c贸digo de la aplicaci贸n de Android con Sonarqube y Jacoco en 2019 锔  ぃ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! 


 Mi nombre es Artyom Dobrovinsky, trabajo como desarrollador de Android en FINCH . 


 Una vez, despu茅s de un par de pintas con un coleg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Medici贸n de la calidad del c贸digo de la aplicaci贸n de Android con Sonarqube y Jacoco en 2019</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475784/"><p><img src="https://habrastorage.org/webt/hy/hs/hf/hyhshf-j1xpd1xyijiaxido1e-q.png"></p><br><p>  Hola Habr! </p><br><p>  Mi nombre es Artyom Dobrovinsky, trabajo como desarrollador de Android en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FINCH</a> . </p><br><p>  Una vez, despu茅s de un par de pintas con un colega de una compa帽铆a que est谩 colocando anuncios para vender MIG y mosquitos llamados Igor, comenzamos a discutir analizadores de c贸digo est谩tico en CI (y qu茅 m谩s discutir).  Se expres贸 la idea de que eran geniales de usar, pero solo despu茅s de que hubo confianza en la confiabilidad l贸gica del c贸digo.  En otras palabras, puede pensar en el estilo de c贸digo solo despu茅s de escribir todas las pruebas. </p><br><p>  Decid铆 escuchar a mi colega y pens茅 en c贸mo calcular la escala del desastre para aplicaciones improvisadas.  La vista cay贸 sobre Sonarqube y Jacoco.  El proceso de conectarlos para proyectos de hello-world es elemental.  Conectarlos a un proyecto de Android, dividido en m贸dulos, ya es m谩s dif铆cil.  Para ayudar a los interesados, este art铆culo fue escrito. </p><a name="habracut"></a><br><p> Habr茅 ya tiene una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">muy buena traducci贸n del</a> tutorial sobre el uso de Sonarqube, pero es de 2016, algo est谩 desactualizado all铆, no hay kotlin y solo encuentro que la generaci贸n de informes para todos los buildType es redundante. </p><br><p>  Un poco sobre bibliotecas, para aquellos que no est谩n familiarizados con ellas. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sonarqube</a> es una plataforma de c贸digo abierto para la inspecci贸n continua y la medici贸n de la calidad del c贸digo.  Le permite seguir la lucha contra la deuda t茅cnica a lo largo del tiempo (es genial ver que la deuda t茅cnica est谩 ganando, y no puede hacer nada al respecto).  Sonar tambi茅n supervisa el c贸digo duplicado, las vulnerabilidades potenciales y la excesiva complejidad de las funciones. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jacoco</a> es una biblioteca gratuita para calcular la cobertura de prueba de un proyecto en Java.  Pero con Kotlin haremos sus amigos. </p><br><h3 id="kak-podklyuchit-sonarqube-i-jacoco">  C贸mo conectar Sonarqube y Jacoco </h3><br><p>  En build.gradle del m贸dulo ra铆z, agregue el siguiente c贸digo: </p><br><pre><code class="plaintext hljs">apply plugin: 'android.application' apply plugin: 'org.sonarqube' sonarqube { properties { property "sonar.host.url", "%url   sonarqube%" property "sonar.login", "%%" property "sonar.projectName", "% %" property "sonar.projectKey", "%  %" property "sonar.reportPath", "${project.buildDir}/sonarqube/test.exec" property "sonar.projectBaseDir", "$rootDir" property "sonar.sources", "." property "sonar.tests", "" property "sonar.coverage.exclusions", "**/src/androidTest/**, **/src/test/**" property "sonar.coverage.jacoco.xmlReportPaths", fileTree(include: ['*/*/jacoco*.xml'], dir: "$rootDir/app/build/reports/jacoco").collect() } }</code> </pre> <br><p>  <code>sonar.reportPath</code> : indica d贸nde debe colocar Sonar el informe para un an谩lisis m谩s detallado. <br>  <code>sonar.projectBaseDir</code> especifica la carpeta en la que se iniciar谩 el an谩lisis inicialmente;  en nuestro caso, este es $ rootDir, la carpeta ra铆z del proyecto. <br>  <code>sonar.coverage.exclusions</code> enumerando excepciones para contar la cobertura, donde ** es cualquier carpeta, a * es cualquier nombre de archivo o resoluci贸n. <br>  <code>sonar.sources</code> es la carpeta de origen. <br>  <code>sonar.tests</code> es una l铆nea vac铆a aqu铆 para que Sonarqube tambi茅n pueda analizar las pruebas. <br>  <code>sonar.coverage.exclusions</code> : excluimos las pruebas del an谩lisis de cobertura de pruebas. <br>  <code>sonar.coverage.jacoco.xmlReportPaths</code> : mediante el m茅todo <code>collect()</code> recopilamos informes de Jacoco para calcular la cobertura de la prueba. </p><br><p>  Para activar Jacoco, es mejor crear un archivo <code>jacoco.gradle</code> y escribir toda la l贸gica necesaria all铆.  Esto ayudar谩 a evitar abarrotar el otro build.gradle. </p><br><p>  Para no registrar a Jacoco en el build.gradle de cada subproyecto, prescribimos su inicializaci贸n en el cierre de los subproyectos.  En <code>reportsDirPath</code> para subm贸dulos, especifique la carpeta ra铆z.  A partir de ah铆, Sonar tomar谩 todos los informes de Jacoco. </p><br><pre> <code class="plaintext hljs">subprojects { apply plugin: 'jacoco' jacoco { toolVersion = '0.8.5' def reportsDirPath = "${project.rootDir}/app/build/reports/jacoco/${project.name}" reportsDir = file(reportsDirPath) } }</code> </pre> <br><p>  En el mismo archivo, escribimos una funci贸n para configurar Jacoco. <br>  Esta funci贸n es excelente, as铆 que primero la traer茅 y luego explicar茅 lo que est谩 sucediendo en ella. </p><br><pre> <code class="plaintext hljs">def configureJacoco = { project -&gt; def variantName = project.name project.tasks.create(name: "getJacocoReports", type: JacocoReport) { group = "Reporting" description = "Generate Jacoco coverage reports for the $variantName build." reports { html.enabled = true xml.enabled = true } def excludes = [ '**/R.class', '**/R$*.class', '**/BuildConfig.*', '**/Manifest*.*', '**/AndroidManifest.xml', '**/*Test*.*', 'android/**/*.*', 'androidx/**/*.*', '**/*Fragment.*', '**/*Activity.*', '**/*Api.*', '**/injection/**/*.class', '**/ui/**/*.class', %  build- % ] def javaClasses = fileTree(dir: "${project.buildDir}/intermediates/javac", excludes: excludes) def kotlinClasses = fileTree(dir: "${project.buildDir}/tmp/kotlin-classes", excludes: excludes) classDirectories = files([javaClasses, kotlinClasses]) sourceDirectories = files([ "${project.projectDir}/src/main/java", "${project.projectDir}/src/main/kotlin", ]) executionData = files(fileTree(include: ['*.exec'], dir: "${project.buildDir}/jacoco").files) } }</code> </pre> <br><p>  Creamos la tarea <code>getJacocoReports</code> , el grupo "Informes".  Los informes se proporcionar谩n en formatos html y xml.  Se analizar谩n todos los archivos, excepto los incluidos en la matriz exclude.  Adem谩s de los archivos Androyd generados, decid铆 excluir del an谩lisis todos los fragmentos y actividades, las interfaces de actualizaci贸n, el paquete con DI, las vistas personalizadas y el c贸digo de la biblioteca. <br>  Quiz谩s esta lista cambie con el tiempo. </p><br><p>  <code>classDirectories</code> : una indicaci贸n de d贸nde buscar el c贸digo para el an谩lisis.  Incluimos archivos java y kotlin aqu铆. <br>  <code>sourceDirectories</code> : especifique d贸nde buscar谩 Jacoco los archivos fuente. <br>  <code>executionData</code> : como en el caso de Sonar, una indicaci贸n de d贸nde se generar谩 el informe para calcular la cobertura. </p><br><p>  Tambi茅n en jacoco.gradle necesita agregar su configuraci贸n para todos los m贸dulos usando la funci贸n anterior: </p><br><pre> <code class="plaintext hljs">allprojects { project -&gt; configureJacoco(project) project.tasks.withType(Test) { enabled = true jacoco.includeNoLocationClasses = true } }</code> </pre> <br><p>  Y una tarea para recopilar los informes generados: </p><br><pre> <code class="plaintext hljs">task getJacocoReports() { group = "Reporting" subprojects.forEach { subproject -&gt; subproject.tasks.withType(JacocoReport).forEach { task -&gt; dependsOn task } } }</code> </pre> <br><h3 id="zapusk-sonarqube-cherez-komandnuyu-stroku">  Ejecutando Sonarqube a trav茅s de la l铆nea de comando </h3><br><p>  <code>./gradlew %    % &amp;&amp; ./gradlew jacocoAggregateReports &amp;&amp; ./gradlew sonarqube</code> simplemente: <code>./gradlew %    % &amp;&amp; ./gradlew jacocoAggregateReports &amp;&amp; ./gradlew sonarqube</code> .  Los comandos se ejecutan a trav茅s de <code>&amp;&amp;</code> , porque la ejecuci贸n debe interrumpirse si el paso anterior no tuvo 茅xito. </p><br><p>  Lo que sucede en el comando anterior: </p><br><ol><li>  Primero, ejecute las pruebas (al mismo tiempo generamos todos los archivos necesarios en la carpeta de compilaci贸n). </li><li>  Generar un informe Jacoco. </li><li>  Lanzamiento Sonarqube. </li></ol><br><p>  Luego debe ir al sitio, fallar en el proyecto y observar la escala del desastre.  La p谩gina del proyecto muestra el resultado de la 煤ltima verificaci贸n. </p><br><p>  Con Sonarqube, la idea del estado del proyecto se est谩 volviendo mucho m谩s completa.  Es m谩s f谩cil ajustar la acumulaci贸n de deuda t茅cnica que asumir desarrolladores novatos (en cada objeci贸n, Sonarqube da un argumento por el cual no se acepta escribir de esa manera; leer estas explicaciones puede ser muy 煤til), y simplemente: el <strong>conocimiento es poder</strong> . </p><br><h3 id="thats-all-folks">  隆Eso es todo, amigos! </h3><br><p>  Pregunta a los lectores: 驴qu茅 utilizan para analizar el c贸digo y medir la cobertura de la prueba?  驴Ves el punto en absoluto? </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/475784/">https://habr.com/ru/post/475784/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../475772/index.html">6 puntos de aplicaci贸n para el internet industrial de las cosas</a></li>
<li><a href="../475774/index.html">"Estas son reglas est煤pidas que molestan a todos": discusi贸n sobre pr谩cticas de campo de contrase帽a</a></li>
<li><a href="../475776/index.html">H谩galo usted mismo para tres guitarras</a></li>
<li><a href="../475780/index.html">Decodificador cir铆lico de imprimible citado</a></li>
<li><a href="../475782/index.html">Pruebas tautol贸gicas, buenas y malas.</a></li>
<li><a href="../475788/index.html">"Aparentemente, hay una gran batalla por delante". Lo que le espera a la industria de TI en el futuro cercano</a></li>
<li><a href="../475790/index.html">Startups que pueden sorprender</a></li>
<li><a href="../475792/index.html">驴A qu茅 investigaci贸n m茅dica vale la pena prestarle atenci贸n este a帽o?</a></li>
<li><a href="../475796/index.html">Pol铆ticas de reputaci贸n de cambios de desbordamiento de pila para problemas</a></li>
<li><a href="../475802/index.html">驴C贸mo hacer que Daily / Stand-up no parezca una reuni贸n de estado?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>