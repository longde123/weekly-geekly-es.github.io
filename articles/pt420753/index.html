<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÉüèª ü§± ‚úåüèº Front-end de microsservi√ßo - uma abordagem moderna para a separa√ß√£o da frente üêö üö¥üèæ üç®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A arquitetura de microsservi√ßo tem sido o padr√£o de fato no desenvolvimento de sistemas grandes e complexos. Ele tem v√°rias vantagens: √© uma divis√£o e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Front-end de microsservi√ßo - uma abordagem moderna para a separa√ß√£o da frente</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/netcracker/blog/420753/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ff/bs/ky/ffbskynryldvlmxczvxjwrsxa-a.png" alt="spa muito gordo"></div><br><br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A arquitetura de microsservi√ßo</a></b> tem sido o padr√£o de fato no desenvolvimento de sistemas grandes e complexos.  Ele tem v√°rias vantagens: √© uma divis√£o estrita em m√≥dulos, conectividade fraca e resist√™ncia a falhas, e a sa√≠da gradual para a produ√ß√£o e vers√µes independentes de componentes. <br><br>  √â verdade que, muitas vezes, falando da arquitetura de microsservi√ßo, apenas a arquitetura de back-end √© mencionada e o front-end permanece monol√≠tico.  Acontece que fizemos um grande apoio e a frente nos puxa para tr√°s. <br><br>  Hoje vou contar como fizemos a frente do microsservi√ßo em nossa solu√ß√£o SaaS e quais problemas encontramos. <br><a name="habracut"></a><br><h2>  <font color="#173146">Edi√ß√£o</font> </h2><br>  Inicialmente, o desenvolvimento em nossa empresa era assim: existem muitas equipes envolvidas no desenvolvimento de microsservi√ßos, cada qual publica sua pr√≥pria API.  E h√° uma equipe separada que desenvolve o SPA para o usu√°rio final, usando a API de diferentes microsservi√ßos.  Com essa abordagem, tudo funciona: os desenvolvedores de microsservi√ßos sabem tudo sobre sua implementa√ß√£o e os desenvolvedores de SPA conhecem todos os meandros das intera√ß√µes do usu√°rio.  Mas havia um problema: agora cada front-end deve conhecer todos os meandros de todos os microsservi√ßos.  Existem cada vez mais microsservi√ßos, mais e mais fornecedores front-end - e o Agile est√° come√ßando a desmoronar, √† medida que a especializa√ß√£o dentro da equipe aparece, ou seja, a intercambiabilidade e a universalidade desaparecem. <br><br>  Ent√£o chegamos ao pr√≥ximo est√°gio - desenvolvimento modular.  A equipe de front-end foi dividida em subcomandos.  Cada um era respons√°vel por sua parte do aplicativo.  Tornou-se muito melhor, mas com o tempo, essa abordagem se esgotou por v√°rios motivos. <br><br><ul><li>  Todos os m√≥dulos s√£o heterog√™neos, com suas pr√≥prias especificidades.  Cada m√≥dulo √© mais adequado √† sua pr√≥pria tecnologia.  Ao mesmo tempo, a escolha da tecnologia √© uma tarefa dif√≠cil nas condi√ß√µes do SPA. </li><li>  Como o aplicativo SPA (e no mundo moderno, isso significa compilar em um √∫nico pacote ou pelo menos um conjunto), apenas o aplicativo inteiro pode ser emitido ao mesmo tempo.  O risco de cada extradi√ß√£o est√° aumentando. </li><li>  Est√° ficando mais dif√≠cil o gerenciamento de depend√™ncias.  M√≥dulos diferentes precisam de vers√µes de depend√™ncia diferentes (possivelmente espec√≠ficas).  Algu√©m n√£o est√° pronto para mudar para a API de depend√™ncia atualizada e algu√©m n√£o pode criar um recurso devido a um bug na ramifica√ß√£o de depend√™ncia antiga. </li><li>  Devido ao segundo ponto, o ciclo de libera√ß√£o para todos os m√≥dulos deve ser sincronizado.  Todo mundo est√° esperando pelos retardat√°rios. </li></ul><br><h2>  <font color="#173146">Frontend de corte</font> </h2><br>  Houve um momento de acumula√ß√£o de massa cr√≠tica, e eles decidiram dividir o front-end em ... microsservi√ßos do front-end.  Vamos definir o que √© um microsservi√ßo front-end: <br><br><ul><li>  uma parte completamente isolada da interface do usu√°rio, de forma alguma dependente de outras pessoas;  isolamento radical;  literalmente desenvolvido como um aplicativo independente; </li><li>  cada microsservi√ßo front-end √© respons√°vel por um determinado conjunto de fun√ß√µes de neg√≥cios do in√≠cio ao fim, ou seja, √© totalmente funcional por si s√≥; </li><li>  pode ser escrito em qualquer tecnologia. </li></ul><br>  Mas fomos mais longe e introduzimos outro n√≠vel de divis√£o. <br><br>
<h3>  <font color="#173146">Conceito de fragmento</font> </h3><br>  Chamamos um fragmento de pacote configur√°vel que consiste em <code>js + css +  </code> .  De fato, essa √© uma parte independente da interface do usu√°rio, que deve obedecer a um conjunto de regras de desenvolvimento para que possa ser usada em um SPA geral.  Por exemplo, todos os estilos devem ser t√£o espec√≠ficos quanto poss√≠vel para o fragmento.  Nenhuma tentativa deve ser feita para interagir diretamente com outros fragmentos.  Voc√™ deve ter um m√©todo especial para o qual possa passar o elemento DOM para o qual o fragmento deve ser desenhado. <br><br>  Gra√ßas ao descritor, podemos salvar informa√ß√µes sobre todos os fragmentos registrados do ambiente e ter acesso a eles por ID. <br><br>  Essa abordagem permite colocar dois aplicativos escritos em estruturas diferentes em uma p√°gina.  Tamb√©m permite escrever c√≥digo universal que permitir√° carregar dinamicamente os fragmentos necess√°rios na p√°gina, inicializ√°-los e gerenciar o ciclo de vida.  Para estruturas mais modernas, basta seguir as "regras de higiene" para tornar isso poss√≠vel. <br><br>  Nos casos em que o fragmento n√£o tem a oportunidade de "coabitar" com outras pessoas na mesma p√°gina, existe um script de fallback no qual desenhamos o fragmento em um iframe (a solu√ß√£o para os problemas relacionados est√° al√©m do escopo deste artigo). <br><br>  Tudo o que um desenvolvedor que deseja usar um snippet existente em uma p√°gina precisa fazer √©: <br><br><ol><li>  Conecte o script da plataforma de microsservi√ßo √† p√°gina. <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"//{URL to static cache service}/api/v1/mui-platform/muiPlatform.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></li><li>  Chame o m√©todo de adicionar um fragmento √† p√°gina. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.MUI.createFragment( <span class="hljs-comment"><span class="hljs-comment">// fragment name "hello-label", // fragment model { text: "HelloLabelFragment text from run time" }, // fragment position { selector: ".hello-label-placeholder", position: "afterend" }) .then(callback);</span></span></code> </pre><br></li></ol><br>  Al√©m disso, para comunica√ß√£o entre fragmentos, h√° um barramento constru√≠do no <code>Observable</code> e no <code>rxjs</code> .  Est√° escrito em NativeJS.  Al√©m disso, o SDK vem com inv√≥lucros para v√°rias estruturas que ajudam a usar esse barramento nativamente.  Um exemplo para o Angular 6 √© um m√©todo utilit√°rio que retorna <code>rxjs/Observable</code> : <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {fromEvent} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> "@netcracker/mui-platform/angular2-factory/modules/shared/utils/event-utils" fromEvent("&lt;event-name&gt;"); fromEvent(EventClassType);</code> </pre><br>  Al√©m disso, a plataforma fornece um conjunto de servi√ßos que geralmente s√£o usados ‚Äã‚Äãpor diferentes fragmentos e s√£o b√°sicos em nossa infraestrutura.  S√£o servi√ßos como localiza√ß√£o / internacionaliza√ß√£o, servi√ßo de autoriza√ß√£o, trabalho com cookies entre dom√≠nios, armazenamento local e muito mais.  Para seu uso, o SDK tamb√©m fornece wrappers para v√°rias estruturas. <br><br><h2>  <font color="#173146">Combinando o frontend</font> </h2><br>  Por exemplo, podemos considerar essa abordagem na √°rea de administra√ß√£o do SPA (ela combina diferentes configura√ß√µes poss√≠veis de diferentes microsservi√ßos).  Podemos fazer o conte√∫do de cada marcador como um fragmento separado, que ser√° entregue e desenvolvido separadamente por cada microsservi√ßo.  Gra√ßas a isso, podemos criar um "cabe√ßalho" simples que mostrar√° o microsservi√ßo correspondente ao clicar em um marcador. <br><br><img src="https://habrastorage.org/webt/uw/su/7x/uwsu7xp8fbiscef1hmkkmyw8bxw.png" alt="imagem"><br><br><h2>  <font color="#173146">Desenvolvemos a ideia de um fragmento</font> </h2><br>  O desenvolvimento de um marcador com um fragmento nem sempre nos permite resolver todos os problemas poss√≠veis.  Geralmente, √© necess√°rio desenvolver uma certa parte da interface do usu√°rio em um microsservi√ßo, que ser√° reutilizado em outro microsservi√ßo. <br><br>  E aqui os fragmentos tamb√©m nos ajudam!  Como todas as necessidades de fragmento s√£o um elemento DOM para renderiza√ß√£o, fornecemos a qualquer microsservi√ßo uma API global atrav√©s da qual ele pode colocar qualquer fragmento dentro de sua √°rvore DOM.  Para fazer isso, basta passar o ID do fragmento e o cont√™iner no qual ele precisa ser desenhado.  O resto ser√° feito por si s√≥! <br>  Agora podemos construir uma "boneca de aninhamento" de qualquer n√≠vel de aninhamento e reutilizar partes inteiras da interface do usu√°rio sem a necessidade de suporte em v√°rios lugares. <br><br>  Muitas vezes acontece que em uma p√°gina existem v√°rios fragmentos que devem mudar de estado ao alterar alguns dados comuns na p√°gina.  Para fazer isso, eles t√™m um barramento de eventos global (NativeJS) atrav√©s do qual eles podem se comunicar e responder a mudan√ßas. <br><br><img src="https://habrastorage.org/webt/yn/q7/g-/ynq7g-cvebke-ppttzyrawkfwsw.png" alt="imagem"><br><br><h3>  <font color="#173146">Servi√ßos Compartilhados</font> </h3><br>  Em uma arquitetura de microsservi√ßo, os servi√ßos centrais aparecem inevitavelmente, dados dos quais todos os outros precisam.  Por exemplo, um servi√ßo de localiza√ß√£o que armazena tradu√ß√µes.  Se cada microsservi√ßo individualmente come√ßar a escalar esses dados para o servidor, receberemos apenas um eixo de solicita√ß√µes durante a inicializa√ß√£o. <br><br>  Para resolver esse problema, desenvolvemos implementa√ß√µes de servi√ßos NativeJS que fornecem acesso a esses dados.  Isso tornou poss√≠vel n√£o fazer solicita√ß√µes e dados em cache desnecess√°rios.  Em alguns casos, at√© imprima esses dados para uma p√°gina em HTML antecipadamente, para se livrar completamente das solicita√ß√µes. <br><br>  Al√©m disso, os wrappers foram desenvolvidos sobre nossos servi√ßos para diferentes estruturas, a fim de tornar seu uso muito natural (DI, interface fixa). <br><br><h2>  <font color="#173146">Profissionais de microsservi√ßos front-end</font> </h2><br>  A coisa mais importante que temos ao dividir um mon√≥lito em fragmentos √© a capacidade de selecionar tecnologias para cada equipe individualmente e o gerenciamento de depend√™ncias transparente.  Mas tamb√©m fornece o seguinte: <br><br><ul><li>  √°reas de responsabilidade muito claramente divididas; </li><li>  emiss√£o independente: cada fragmento pode ter seu pr√≥prio ciclo de libera√ß√£o; </li><li>  aumentar a estabilidade da solu√ß√£o como um todo, uma vez que a emiss√£o de fragmentos individuais n√£o afeta outros; </li><li>  a capacidade de reverter facilmente os recursos, distribu√≠-los parcialmente para o p√∫blico; </li><li>  o fragmento √© facilmente colocado na cabe√ßa de cada desenvolvedor, o que leva a </li></ul>  intercambiabilidade dos membros da equipe;  al√©m disso, cada front-end pode entender melhor todos os meandros da intera√ß√£o com o back-end correspondente. <br><br>  Uma solu√ß√£o com um front-end microseris parece boa.  De fato, agora cada fragmento (microsservi√ßo) pode decidir por si pr√≥prio como implantar: se voc√™ precisa do nginx para distribuir est√°tica, um middleware completo para agregar solicita√ß√µes de apoio ou suporte a websockets ou outras especificidades na forma de um protocolo de transfer√™ncia de dados bin√°rios dentro de http.  Al√©m disso, os fragmentos podem escolher seus pr√≥prios m√©todos de montagem, m√©todos de otimiza√ß√£o e muito mais. <br><br><h2>  <font color="#173146">Contras de microsservi√ßos front-end</font> </h2><br>  Voc√™ nunca pode ficar sem uma mosca na pomada. <br><br><ul><li>  A intera√ß√£o entre fragmentos n√£o pode ser garantida por m√©todos de tubo padr√£o (DI, por exemplo). </li><li>  O que fazer com depend√™ncias compartilhadas?  Afinal, o tamanho do aplicativo aumentar√° aos trancos e barrancos, se n√£o forem retirados dos fragmentos. </li><li>  De qualquer forma, apenas um deve ser respons√°vel pelo roteamento na aplica√ß√£o final. </li><li>  O que fazer se um dos fragmentos estiver inacess√≠vel / n√£o puder ser desenhado. </li><li>  N√£o est√° claro o que fazer com o fato de que diferentes microsservi√ßos podem estar em dom√≠nios diferentes. </li></ul><br><h2>  <font color="#173146">Conclus√£o</font> </h2><br>  Nossa experi√™ncia com essa abordagem comprovou sua viabilidade.  A velocidade de sa√≠da dos recursos em produ√ß√£o aumentou significativamente.  O n√∫mero de depend√™ncias impl√≠citas entre partes da interface foi reduzido para quase zero.  Temos uma interface do usu√°rio consistente.  Voc√™ pode testar os recursos com seguran√ßa sem envolver um grande n√∫mero de pessoas. <br><br>  Infelizmente, em um artigo, √© muito dif√≠cil cobrir toda a gama de problemas e solu√ß√µes que podem ser encontrados no caminho de repetir essa arquitetura.  Mas para n√≥s, os profissionais claramente superam os contras.  Se Habr mostrar interesse em revelar detalhes da implementa√ß√£o dessa abordagem, escreveremos uma sequ√™ncia! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt420753/">https://habr.com/ru/post/pt420753/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt420735/index.html">Convidamos voc√™ para o final da maratona Encontre-se na Digital no escrit√≥rio do Mail.Ru Group</a></li>
<li><a href="../pt420737/index.html">Mini ta√ßa ai 2 ou quase AgarIO - o que poderia ser feito para vencer</a></li>
<li><a href="../pt420739/index.html">A caixa ainda est√° dispon√≠vel: por que em 2018 voc√™ ainda precisa aprender idiomas</a></li>
<li><a href="../pt420741/index.html">Folha de dicas para programadores ou "procuraremos no Google por voc√™"</a></li>
<li><a href="../pt420749/index.html">GitLab para projeto de entrega cont√≠nua em tecnologias InterSystems: Containers</a></li>
<li><a href="../pt420757/index.html">Concurso de Programa√ß√£o: Com√©rcio (Resultados)</a></li>
<li><a href="../pt420761/index.html">TypeScript 3.0</a></li>
<li><a href="../pt420763/index.html">KDD 2018, segundo dia, workshops</a></li>
<li><a href="../pt420765/index.html">Impress√µes do PDA Gemini. Colheitadeira de bolso com bota dupla ou brinquedo in√∫til?</a></li>
<li><a href="../pt420767/index.html">Rostelecom exige que o Sputnik seja declarado falido</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>