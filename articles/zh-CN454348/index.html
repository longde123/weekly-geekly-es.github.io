<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’¢ ğŸ‘©ğŸ¾â€ğŸ’» â›„ï¸ ä½¿ç”¨React Hooksç®¡ç†çŠ¶æ€-æ— éœ€Reduxå’ŒContext API ğŸ¤¶ğŸ¾ ğŸ• ğŸš–</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ï¼ æˆ‘çš„åå­—å«äºšç‘Ÿï¼ˆArthurï¼‰ï¼Œæˆ‘ä½œä¸ºç§»åŠ¨Webå›¢é˜Ÿåœ¨VKontakteå·¥ä½œï¼Œæˆ‘å‚ä¸äº†VKUIé¡¹ç›®-ä¸€ä¸ªReact-componentsåº“ï¼Œå¹¶ä»¥æ­¤ä¸ºåŸºç¡€ç¼–å†™äº†ç§»åŠ¨åº”ç”¨ç¨‹åºä¸­çš„ä¸€äº›æ¥å£ã€‚ ä¸å…¨çƒå›½å®¶åˆä½œçš„é—®é¢˜ä»ç„¶å¯¹æˆ‘ä»¬å¼€æ”¾ã€‚ æœ‰å‡ ç§ä¼—æ‰€å‘¨çŸ¥çš„æ–¹æ³•ï¼šReduxï¼ŒMobXï¼ŒContext API...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨React Hooksç®¡ç†çŠ¶æ€-æ— éœ€Reduxå’ŒContext API</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vk/blog/454348/"> å¤§å®¶å¥½ï¼ æˆ‘çš„åå­—å«äºšç‘Ÿï¼ˆArthurï¼‰ï¼Œæˆ‘ä½œä¸ºç§»åŠ¨Webå›¢é˜Ÿåœ¨VKontakteå·¥ä½œï¼Œæˆ‘å‚ä¸äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">VKUI</a>é¡¹ç›®-ä¸€ä¸ªReact-componentsåº“ï¼Œå¹¶ä»¥æ­¤ä¸ºåŸºç¡€ç¼–å†™äº†ç§»åŠ¨åº”ç”¨ç¨‹åºä¸­çš„ä¸€äº›æ¥å£ã€‚ ä¸å…¨çƒå›½å®¶åˆä½œçš„é—®é¢˜ä»ç„¶å¯¹æˆ‘ä»¬å¼€æ”¾ã€‚ æœ‰å‡ ç§ä¼—æ‰€å‘¨çŸ¥çš„æ–¹æ³•ï¼šReduxï¼ŒMobXï¼ŒContext APIã€‚ æˆ‘æœ€è¿‘é‡åˆ°äº†AndrÃ©Gardi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çŠ¶æ€ç®¡ç†éƒ¨é—¨ä½¿ç”¨React Hooks</a>çš„æ–‡ç« -No <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Reduxæˆ–Context API</a> ï¼Œä½œè€…åœ¨å…¶ä¸­å»ºè®®ä½¿ç”¨React Hooksæ¥æ§åˆ¶åº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚ <br><br> é’©å­æ­£åœ¨è¿…é€Ÿè¿›å…¥å¼€å‘äººå‘˜çš„ç”Ÿæ´»ï¼Œæä¾›äº†è§£å†³æˆ–é‡æ–°è€ƒè™‘ä¸åŒä»»åŠ¡å’Œæ–¹æ³•çš„æ–°æ–¹æ³•ã€‚ å®ƒä»¬ä¸ä»…æ”¹å˜äº†æˆ‘ä»¬å¯¹å¦‚ä½•æè¿°ç»„ä»¶çš„ç†è§£ï¼Œä¹Ÿæ”¹å˜äº†æˆ‘ä»¬å¯¹å¦‚ä½•ä½¿ç”¨æ•°æ®çš„ç†è§£ã€‚ é˜…è¯»æ–‡ç« çš„ç¿»è¯‘å’ŒçŒ«å’ªä¸‹ç¿»è¯‘çš„è¯„è®ºã€‚ <br><br><img src="https://habrastorage.org/webt/_t/kp/9x/_tkp9x7oiiowebtqtcvbhlblydo.jpeg" alt="å›¾ç‰‡"><br><a name="habracut"></a><br><h2>  ReactæŒ‚é’©æ¯”æ‚¨æƒ³è±¡çš„æ›´å¼ºå¤§ </h2><br> ä»Šå¤©ï¼Œæˆ‘ä»¬å°†ç ”ç©¶React Hooksï¼Œå¹¶å¼€å‘ä¸€ä¸ªç”¨äºç®¡ç†åº”ç”¨ç¨‹åºå…¨å±€çŠ¶æ€çš„è‡ªå®šä¹‰é’©å­ï¼Œè¯¥é’©å­æ¯”Reduxå®ç°æ›´ç®€å•ï¼Œå¹¶ä¸”æ¯”Context APIæ›´é«˜æ•ˆã€‚ <br><br><h3>  React HooksåŸºç¡€çŸ¥è¯† </h3><br> å¦‚æœæ‚¨å·²ç»ç†Ÿæ‚‰é’©å­ï¼Œåˆ™å¯ä»¥è·³è¿‡æ­¤éƒ¨åˆ†ã€‚ <br><br><h4>  useStateï¼ˆï¼‰ </h4><br> åœ¨å‡ºç°é’©å­ä¹‹å‰ï¼ŒåŠŸèƒ½ç»„ä»¶æ— æ³•è®¾ç½®å±€éƒ¨çŠ¶æ€ã€‚ éšç€<code>useState()</code>çš„å‡ºç°ï¼Œæƒ…å†µå·²ç»å‘ç”Ÿäº†å˜åŒ–ã€‚ <br><br><img src="https://habrastorage.org/webt/eh/uc/_k/ehuc_krferg3j4eccjos_rkf_fq.jpeg"><br><br> è¯¥è°ƒç”¨è¿”å›ä¸€ä¸ªæ•°ç»„ã€‚ å®ƒçš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æä¾›å¯¹çŠ¶æ€å€¼çš„è®¿é—®çš„å˜é‡ã€‚ ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªæ›´æ–°çŠ¶æ€å¹¶é‡ç»˜ç»„ä»¶ä»¥åæ˜ æ›´æ”¹çš„å‡½æ•°ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { useState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, setState] = useState({<span class="hljs-attr"><span class="hljs-attr">counter</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add1ToCounter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newCounterValue = state.counter + <span class="hljs-number"><span class="hljs-number">1</span></span>; setState({ <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: newCounterValue}); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">You clicked {state.counter} times</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{add1ToCounter}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Click me </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre><br><h4>  useEffectï¼ˆï¼‰ </h4><br> ç±»ç»„ä»¶ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆä¾‹å¦‚<code>componentDidMount()</code>æ¥å“åº”å‰¯ä½œç”¨ã€‚  <code>useEffect()</code>æŒ‚é’©å…è®¸æ‚¨åœ¨åŠŸèƒ½ç»„ä»¶ä¸­æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚ <br><br> é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯æ¬¡é‡ç”»åéƒ½ä¼šè§¦å‘æ•ˆæœã€‚ ä½†æ˜¯æ‚¨å¯ä»¥ç¡®ä¿ä»…åœ¨æ›´æ”¹ç‰¹å®šå˜é‡çš„å€¼å¹¶å°†å®ƒä»¬ä»¥æ•°ç»„å½¢å¼ä¼ é€’ç»™ç¬¬äºŒä¸ªå¯é€‰å‚æ•°åæ‰æ‰§è¡Œå®ƒä»¬ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     useEffect(() =&gt; { console.log('     '); }); //    useEffect(() =&gt; { console.log('     valueA'); }, [valueA]);</span></span></code> </pre><br> ä¸ºäº†è·å¾—ç±»ä¼¼äº<code>componentDidMount()</code>çš„ç»“æœï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªç©ºæ•°ç»„ä¼ é€’ç»™ç¬¬äºŒä¸ªå‚æ•°ã€‚ ç”±äºç©ºæ•°ç»„çš„å†…å®¹å§‹ç»ˆä¿æŒä¸å˜ï¼Œå› æ­¤æ•ˆæœåªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     useEffect(() =&gt; { console.log('    '); }, []);</span></span></code> </pre><br><h3> å›½å®¶åˆ†äº« </h3><br> æˆ‘ä»¬çœ‹åˆ°äº†é’©å­çŠ¶æ€å°±åƒç±»ç»„ä»¶çŠ¶æ€ä¸€æ ·å·¥ä½œã€‚ æ¯ä¸ªç»„ä»¶å®ä¾‹éƒ½æœ‰å…¶è‡ªå·±çš„å†…éƒ¨çŠ¶æ€ã€‚ <br><br> ä¸ºäº†åœ¨ç»„ä»¶ä¹‹é—´å…±äº«çŠ¶æ€ï¼Œæˆ‘ä»¬å°†åˆ›å»ºè‡ªå·±çš„é’©å­ã€‚ <br><br><img src="https://habrastorage.org/webt/hp/lw/ke/hplwkebnp9jtdu7vywj5phhsndi.jpeg"><br><br> è¿™ä¸ªæƒ³æ³•æ˜¯åˆ›å»ºä¸€ä¸ªä¾¦å¬å™¨æ•°ç»„ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªçŠ¶æ€ã€‚ æ¯æ¬¡ç»„ä»¶æ›´æ”¹çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰è®¢é˜…çš„ç»„ä»¶éƒ½ä¼šè°ƒç”¨å…¶<code>getState()</code>å¹¶å› æ­¤è€Œæ›´æ–°ã€‚ <br><br> æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è‡ªå®šä¹‰é’©å­ä¸­è°ƒç”¨<code>useState()</code>æ¥å®ç°æ­¤<code>useState()</code> ã€‚ ä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰è¿”å›<code>setState()</code>å‡½æ•°ï¼Œè€Œæ˜¯å°†å…¶æ·»åŠ åˆ°ä¾¦å¬å™¨æ•°ç»„ä¸­ï¼Œå¹¶è¿”å›äº†ä¸€ä¸ªåœ¨å†…éƒ¨æ›´æ–°çŠ¶æ€å¯¹è±¡å¹¶è°ƒç”¨æ‰€æœ‰ä¾¦å¬å™¨çš„å‡½æ•°ã€‚ <br><br><h4> ç­‰ä¸€ä¸‹ å®ƒå¦‚ä½•ä½¿æˆ‘çš„ç”Ÿæ´»æ›´è½»æ¾ï¼Ÿ </h4><br> æ˜¯çš„ï¼Œä½ æ˜¯å¯¹çš„ã€‚ æˆ‘åˆ›å»ºäº†ä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">NPMåŒ…</a> ï¼Œå…¶ä¸­å°è£…äº†æ‰€æœ‰æè¿°çš„é€»è¾‘ã€‚ <br><br> æ‚¨ä¸å¿…åœ¨æ¯ä¸ªé¡¹ç›®ä¸­éƒ½å®æ–½å®ƒã€‚ å¦‚æœæ‚¨ä¸å†æƒ³èŠ±æ—¶é—´é˜…è¯»å¹¶å¸Œæœ›æŸ¥çœ‹æœ€ç»ˆç»“æœï¼Œåªéœ€å°†æ­¤åŒ…æ·»åŠ åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºå³å¯ã€‚ <br><br><pre> <code class="plaintext hljs">npm install -s use-global-hook</code> </pre> <br> è¦äº†è§£å¦‚ä½•ä½¿ç”¨è½¯ä»¶åŒ…ï¼Œè¯·ç ”ç©¶æ–‡æ¡£ä¸­çš„ç¤ºä¾‹ã€‚ ç°åœ¨ï¼Œæˆ‘å»ºè®®é‡ç‚¹å…³æ³¨åŒ…è£…åœ¨å†…éƒ¨çš„å¸ƒç½®æ–¹å¼ã€‚ <br><br><h3> ç¬¬ä¸€ç‰ˆ </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> listeners = []; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = { <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> setState = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newState</span></span></span><span class="hljs-function">) =&gt;</span></span> { state = { ...state, ...newState }; listeners.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function">) =&gt;</span></span> { listener(state); }); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useCustom = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { listeners.push(newListener); }, []); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [state, setState]; }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> useCustom;</code> </pre><br><h4> åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> useCustom <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./customHook'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Counter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [globalState, setGlobalState] = useCustom(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add1Global = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newCounterValue = globalState.counter + <span class="hljs-number"><span class="hljs-number">1</span></span>; setGlobalState({ <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: newCounterValue }); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> counter: {globalState.counter} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{add1Global}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> +1 to global </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Counter;</code> </pre><br> æ­¤ç‰ˆæœ¬å·²æä¾›å…±äº«çŠ¶æ€ã€‚ æ‚¨å¯ä»¥å‘åº”ç”¨ç¨‹åºæ·»åŠ ä»»æ„æ•°é‡çš„è®¡æ•°å™¨ï¼Œå®ƒä»¬éƒ½å°†å…·æœ‰å…±åŒçš„å…¨å±€çŠ¶æ€ã€‚ <br><br><h3> ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ </h3><br> æ‚¨è¦ä»€ä¹ˆï¼Ÿ <br><br><ul><li> å¸è½½ç»„ä»¶æ—¶ï¼Œä»æ•°ç»„ä¸­åˆ é™¤ä¾¦å¬å™¨ï¼› </li><li> ä½¿é’©å­æ›´åŠ æŠ½è±¡ï¼Œä»¥ä¾¿åœ¨å…¶ä»–é¡¹ç›®ä¸­ä½¿ç”¨ï¼› </li><li> ä½¿ç”¨å‚æ•°ç®¡ç†<code>initialState</code> ï¼› </li><li> ç”¨æ›´å®ç”¨çš„æ ·å¼é‡å†™é’©å­ã€‚ </li></ul><br><h4> åœ¨å¸è½½ç»„ä»¶ä¹‹å‰è°ƒç”¨å‡½æ•° </h4><br> æˆ‘ä»¬å·²ç»å‘ç°ï¼Œä½¿ç”¨ç©ºæ•°ç»„è°ƒç”¨<code>useEffect(function, [])</code>ä¸<code>componentDidMount()</code>æ–¹å¼ç›¸åŒã€‚ ä½†æ˜¯ï¼Œå¦‚æœåœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ä¼ é€’çš„å‡½æ•°è¿”å›äº†å¦ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™å°†åœ¨å¸è½½ç»„ä»¶ä¹‹å‰ç«‹å³è°ƒç”¨ç¬¬äºŒä¸ªå‡½æ•°ã€‚ å°±åƒ<code>componentWillUnmount()</code> ã€‚ <br><br> å› æ­¤ï¼Œåœ¨ç¬¬äºŒä¸ªå‡½æ•°çš„ä»£ç ä¸­ï¼Œæ‚¨å¯ä»¥ç¼–å†™ç”¨äºä»ä¾¦å¬å™¨æ•°ç»„ä¸­åˆ é™¤ç»„ä»¶çš„é€»è¾‘ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useCustom = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     listeners.push(newListener); return () =&gt; { //     listeners = listeners.filter(listener =&gt; listener !== newListener); }; }, []); return [state, setState]; };</span></span></code> </pre><br><h3> ç¬¬äºŒç‰ˆ </h3><br> é™¤äº†æ­¤æ›´æ–°ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è®¡åˆ’ï¼š <br><br><ul><li> ä¼ é€’Reactå‚æ•°å¹¶å–æ¶ˆå¯¼å…¥ï¼› </li><li> å¯¼å‡ºçš„ä¸æ˜¯customHookï¼Œè€Œæ˜¯è¿”å›å…·æœ‰ç»™å®š<code>initalState</code> ï¼› </li><li> åˆ›å»ºä¸€ä¸ª<code>store</code>å¯¹è±¡ï¼Œå…¶ä¸­å°†åŒ…å«<code>state</code>å€¼å’Œ<code>setState()</code>å‡½æ•°ï¼› </li><li> å°†ç®­å¤´åŠŸèƒ½æ›¿æ¢ä¸º<code>setState()</code>å’Œ<code>useCustom()</code>çš„å¸¸ç”¨åŠŸèƒ½ï¼Œä»¥ä¾¿å¯ä»¥å°†<code>store</code>ä¸<code>this</code>å…³è”ã€‚ </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = { ...this.state, ...newState }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function">) =&gt;</span></span> { listener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useCustom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">React</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = React.useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     this.listeners.push(newListener); return () =&gt; { //     this.listeners = this.listeners.filter(listener =&gt; listener !== newListener); }; }, []); return [this.state, this.setState]; } const useGlobalHook = (React, initialState) =&gt; { const store = { state: initialState, listeners: [] }; store.setState = setState.bind(store); return useCustom.bind(store, React); }; export default useGlobalHook;</span></span></code> </pre><br><h3> åŠ¨ä½œä¸ç»„ä»¶åˆ†å¼€ </h3><br> å¦‚æœæ‚¨æ›¾ç»ä½¿ç”¨è¿‡å¤æ‚çš„çŠ¶æ€ç®¡ç†åº“ï¼Œé‚£ä¹ˆæ‚¨å°±ä¼šçŸ¥é“ä»ç»„ä»¶æ“ä½œå…¨å±€çŠ¶æ€å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ <br><br> é€šè¿‡åˆ›å»ºç”¨äºæ›´æ”¹çŠ¶æ€çš„æ“ä½œæ¥åˆ†ç¦»ä¸šåŠ¡é€»è¾‘ä¼šæ›´æ­£ç¡®ã€‚ å› æ­¤ï¼Œæˆ‘å¸Œæœ›è¯¥è½¯ä»¶åŒ…çš„æœ€æ–°ç‰ˆæœ¬ä¸æä¾›å¯¹<code>setState()</code>è®¿é—®ï¼Œè€Œæ˜¯å¯¹ä¸€ç»„æ“ä½œçš„è®¿é—®ã€‚ <br><br> ä¸ºæ­¤ï¼Œæˆ‘ä»¬å‘æˆ‘ä»¬çš„<code>useGlobalHook(React, initialState, actions)</code>ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚ åªæƒ³æ·»åŠ ä¸€äº›è¯„è®ºã€‚ <br><br><ul><li> åŠ¨ä½œå°†æœ‰æƒè®¿é—®<code>store</code> ã€‚ è¿™æ ·ï¼ŒåŠ¨ä½œå¯ä»¥è¯»å–<code>store.state</code>çš„å†…å®¹ï¼Œ <code>store.setState()</code>è°ƒç”¨<code>store.setState()</code>æ›´æ–°<code>store.setState()</code>ç”šè‡³å¯ä»¥é€šè¿‡<code>store.actions</code>è°ƒç”¨å…¶ä»–<code>store.actions</code> ã€‚ </li><li> ä¸ºé¿å…æ··ä¹±ï¼Œæ“ä½œå¯¹è±¡å¯ä»¥åŒ…å«å­å¯¹è±¡ã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥å°†å…·æœ‰æ‰€æœ‰è®¡æ•°å™¨åŠ¨ä½œçš„<code>actions.counter.add(amount)</code>è½¬ç§»åˆ°å­å¯¹è±¡ï¼š <code>actions.counter.add(amount)</code> ã€‚ </li></ul><br><h3> æœ€ç»ˆç‰ˆæœ¬ </h3><br> ä»¥ä¸‹ä»£ç æ®µæ˜¯NPMè½¯ä»¶åŒ…<code>use-global-hook</code>çš„å½“å‰ç‰ˆæœ¬ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = { ...this.state, ...newState }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function">) =&gt;</span></span> { listener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useCustom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">React</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = React.useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.push(newListener); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function"> =&gt;</span></span> listener !== newListener); }; }, []); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.actions]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">associateActions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store, actions</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> associatedActions = {}; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(actions).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> actions[key] === <span class="hljs-string"><span class="hljs-string">'function'</span></span>) { associatedActions[key] = actions[key].bind(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, store); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> actions[key] === <span class="hljs-string"><span class="hljs-string">'object'</span></span>) { associatedActions[key] = associateActions(store, actions[key]); } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> associatedActions; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useGlobalHook = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">React, initialState, actions</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = { <span class="hljs-attr"><span class="hljs-attr">state</span></span>: initialState, <span class="hljs-attr"><span class="hljs-attr">listeners</span></span>: [] }; store.setState = setState.bind(store); store.actions = associateActions(store, actions); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> useCustom.bind(store, React); }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> useGlobalHook;</code> </pre><br><h3> ä½¿ç”¨èŒƒä¾‹ </h3><br> æ‚¨ä¸å†éœ€è¦å¤„ç†<code>useGlobalHook.js</code> ã€‚ ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä¸“æ³¨äºæ‚¨çš„åº”ç”¨ç¨‹åºã€‚ ä»¥ä¸‹æ˜¯ä½¿ç”¨è¯¥è½¯ä»¶åŒ…çš„ä¸¤ä¸ªç¤ºä¾‹ã€‚ <br><br><h4> å¤šä¸ªè®¡æ•°å™¨ï¼Œä¸€ä¸ªä»·å€¼ </h4><br> æ ¹æ®éœ€è¦æ·»åŠ ä»»æ„æ•°é‡çš„è®¡æ•°å™¨ï¼šå®ƒä»¬éƒ½å°†å…·æœ‰å…¨å±€å€¼ã€‚ æ¯å½“è®¡æ•°å™¨ä¹‹ä¸€å¢åŠ å…¨å±€çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰å…¶ä»–è®¡æ•°å™¨å°†è¢«é‡ç»˜ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçˆ¶ç»„ä»¶ä¸éœ€è¦é‡ç»˜ã€‚ <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç”Ÿæ´»çš„ä¾‹å­</a> ã€‚ <br><br><h4> å¼‚æ­¥ajaxè¯·æ±‚ </h4><br> é€šè¿‡ç”¨æˆ·åæœç´¢GitHubå­˜å‚¨åº“ã€‚ æˆ‘ä»¬ä½¿ç”¨async / awaitå¼‚æ­¥å¤„ç†ajaxè¯·æ±‚ã€‚ æˆ‘ä»¬ç”¨æ¯ä¸ªæ–°æœç´¢æ›´æ–°æŸ¥è¯¢è®¡æ•°å™¨ã€‚ <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç”Ÿæ´»çš„ä¾‹å­</a> ã€‚ <br><br><h3> å¥½äº† </h3><br> ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨React Hooksä¸Šæ‹¥æœ‰è‡ªå·±çš„çŠ¶æ€ç®¡ç†åº“ã€‚ <br><br><h3> è¯‘è€…è¯„è®º </h3><br> å¤§å¤šæ•°ç°æœ‰è§£å†³æ–¹æ¡ˆæœ¬è´¨ä¸Šæ˜¯å•ç‹¬çš„åº“ã€‚ ä»è¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼Œä½œè€…æè¿°çš„æ–¹æ³•å¾ˆæœ‰è¶£ï¼Œå› ä¸ºå®ƒä»…ä½¿ç”¨å†…ç½®çš„ReactåŠŸèƒ½ã€‚ æ­¤å¤–ï¼Œä¸ç°æˆçš„åŒä¸€ä¸ªContext APIç›¸æ¯”ï¼Œæ­¤æ–¹æ³•å‡å°‘äº†ä¸å¿…è¦çš„é‡ç”»æ¬¡æ•°ï¼Œå› æ­¤èµ¢å¾—äº†æ€§èƒ½ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN454348/">https://habr.com/ru/post/zh-CN454348/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN454332/index.html">Telegramæœºå™¨äººå¦‚ä½•å…‹æœè®¾è®¡å¸ˆçš„æ‹–å»¶å¹¶å¸®åŠ©å¢åŠ æ•°å­—ä»£ç†å•†çš„æ”¶å…¥</a></li>
<li><a href="../zh-CN454334/index.html">æ‘©æ‰˜ å“­æ³£çš„AWS</a></li>
<li><a href="../zh-CN454336/index.html">å®¢æˆ·ï¼š-ä¸€ä»½Facebookå‰¯æœ¬è¦å¤šå°‘é’±ï¼Ÿ</a></li>
<li><a href="../zh-CN454340/index.html">ï¼…tutnazvanievuï¼…æ˜¯ä¸–ç•Œä¸Šç¬¬ä¸€å®¶æ­£å¼å¼€å‘å–·æ°”èƒŒåŒ…çš„å¤§å­¦</a></li>
<li><a href="../zh-CN454346/index.html">æ•ˆç‡ç®—æ³•ï¼šNobelic 2019ç›‘æ§æ‘„åƒå¤´è¯„è®º</a></li>
<li><a href="../zh-CN454352/index.html">Pythonä¸­çš„æ•°å­¦ä¸ç¡®å®šæ€§</a></li>
<li><a href="../zh-CN454354/index.html">åœ¨JetBrainså®ä¹ ï¼Œä»¥åŠæˆ‘å‡ ä¹å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹</a></li>
<li><a href="../zh-CN454356/index.html">ã€Šå“ˆä¼¯å‘¨åˆŠã€‹ç¬¬3æœŸ/ Runetä¸ç”µè§†ï¼ŒARMä¸è‹±ç‰¹å°”ï¼Œç»Ÿä¸€çŠ¶æ€æ•°æ®ï¼Œ2019å¹´æ²¡æœ‰æ™ºèƒ½æ‰‹æœºï¼Œè‹è”å¯¹æœªæ¥çš„æ¢¦æƒ³</a></li>
<li><a href="../zh-CN454366/index.html">PHDays 9çš„èƒœåˆ©ã€‚æˆ‘ä»¬åˆ†ä¸‰éƒ¨åˆ†åˆ†äº«ç”Ÿæ´»æŠ€å·§ã€‚ ç¬¬äºŒéƒ¨åˆ†</a></li>
<li><a href="../zh-CN454368/index.html">TeamCityæ’ä»¶å¼€å‘è€…ç«èµ›</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>