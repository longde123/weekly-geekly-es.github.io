<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè° üßëüèø‚Äçü§ù‚ÄçüßëüèΩ üî∏ Wie ich versucht habe, eine Kartensuche nach Treibern zu reparieren. Teil 2 üå°Ô∏è ü¶Ç ü§≤üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das erste, was ich sagen m√∂chte, war, dass es schwierig war. Viel schwieriger als ich dachte. Ich hatte vor dieser sehr schwierigen Erfahrung, Produkt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie ich versucht habe, eine Kartensuche nach Treibern zu reparieren. Teil 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440958/">  Das erste, was ich sagen m√∂chte, war, dass es schwierig war.  Viel schwieriger als ich dachte.  Ich hatte vor dieser sehr schwierigen Erfahrung, Produkte bei der Arbeit herauszubringen, aber ich habe nie nach pers√∂nlichen Projekten gegriffen.  Sie alle endeten mit Prototypen von unterschiedlichem Ekel, aber dieser schien zu √ºberleben.  Momentan wurde es f√ºr mehr als 80 L√§nder (ganz Europa, Asien und Nordamerika) auf beiden mobilen Plattformen gestartet. Am Ende des Artikels werden Download-Links angezeigt. Daher lade ich alle Interessierten ein, es zu versuchen, zu brechen und zu schelten. <br><img src="https://habrastorage.org/webt/bf/sb/yn/bfsbyn-oz8mgre0bdzet4a_k33c.png"><br>  Hier ist ein kurzer Gedanke, mit dem alles begann: <i>Meiner Meinung nach wird eine Suche auf vorhandenen mobilen Karten f√ºr Fu√üg√§nger durchgef√ºhrt und funktioniert f√ºr Fahrer √ºberhaupt nicht.</i>  <i>Sie m√ºssen anhalten, in die Karten eintauchen, die mit √ºbersch√ºssigen Informationen und Werbung √ºbers√§t sind, und kleine Symbole anstechen.</i>  <i>Es ist unpraktisch, es hilft dir nicht an einem unbekannten Ort, am Ende ist es nur gef√§hrlich.</i>  <i>Es wird eine intuitive und saubere L√∂sung ben√∂tigt, die nicht ablenkt und Sie nicht verlangsamt.</i> <i><br></i> <br>  Im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ersten Teil habe</a> ich meinen Weg von diesem einfachen Gedanken zu einer funktionierenden L√∂sung beschrieben, und dann werde ich beschreiben, wie ich diese L√∂sung in die Version gezogen habe. <br><a name="habracut"></a><br>  Um Zeit zu sparen, beginne ich mit einer kurzen Nacherz√§hlung des vorherigen Teils: Dort schreibe ich, dass ich mich anstelle der Suche f√ºr das Scannen in Bewegung entschieden habe und die Anwendungsoberfl√§che so weit wie m√∂glich vereinfacht wurde.  Anstelle einer absurden Eingangszeile f√ºr den Fahrer f√ºgte er mehrere gro√üe Tasten f√ºr Dinge hinzu, die auf der Stra√üe n√ºtzlich sein k√∂nnen: Tankstelle, Aufladung, Geldautomat, Parkplatz, Apotheke.  Anstelle einer Karte habe ich eine Liste erstellt. Wenn ich ein Ergebnis ausw√§hle, wird die Navigation durch Apple / Google Maps ge√∂ffnet.  F√ºr die Anwendung habe ich mich f√ºr Flutter entschieden (gleichzeitig habe ich erfahren, um welche Art von Tier es sich handelt) und die Daten von OpenStreetMap √ºbernommen.  Ich beendete meine Geschichte mit der Tatsache, dass ein mehr oder weniger vern√ºnftiger Prototyp fertig war. <br><br>  Dann dauerte alles ungef√§hr 4-5 Monate, dann begannen die Ver√§nderungen im Leben und das Projekt blieb auf der Strecke - und ich wurde es langsam leid.  Einen Monat sp√§ter wischte ich es ab, erfrischte es in meinem Kopf, indem ich einen Artikel √ºber einen Hub schrieb, und entschied: Lass es uns beenden.  Jeder, der den Unterschied zwischen einem Prototyp und einem Produkt kennt, wird an dieser Stelle traurig l√§cheln. <br><br>  Was als n√§chstes geschah, dauerte weitere vier Monate.  Ich besorgte mir einen Task-Tracker, bildete allgemein eine Liste von Problemen, sammelte Ger√§te zum Testen.  Abends und am Wochenende setzte ich mich zur Arbeit und brachte das Projekt voran.  In welchen Momenten schien die Liste nur zu wachsen, und ich ertrank in endlosen Nuancen und letzten Schl√§gen.  Er nahm sich in die Hand, warf etwas weg, fuhr irgendwo im Gegenteil zum Perfektionismus.  Als n√§chstes werde ich versuchen, √ºber die interessantesten Punkte bei der Entwicklung eines scheinbar einfachen Projekts zu sprechen. <br><br><h2>  Technologie </h2><br><h4>  Allgemeine Architektur </h4><br>  Irgendwann mitten in der Arbeit begann sich das Gef√ºhl zu zeigen, dass sich die Architektur au√üer Kontrolle ausbreitete.  Es wurden zu viele Komponenten und Verbindungen abgewickelt und mehrere Engp√§sse behoben.  Gl√ºcklicherweise ist das Projekt klein und ich habe es rechtzeitig gesp√ºrt, so dass es nicht schwierig war, die Dinge in Ordnung zu bringen.  Auf der Ebene der einzelnen Komponenten ging es darum, unn√∂tige Bibliotheken umzugestalten und wegzuwerfen. Auf globaler Ebene verteilte ich die Funktionalit√§t auf drei kleine Server, die ich in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DigitalOcean</a> gestartet hatte. <br><br><ol><li>  <i>API-Server</i> (Python) - das Haupt-Server-Laying, wir wenden uns ihm zu.  Es gibt nicht viel Logik, haupts√§chlich die Bildung von Ergebnissen f√ºr die Ausgabe.  Am sparsamsten in Bezug auf Ressourcen. </li><li>  <i>Elastic Server</i> (Java) - Elasticsearch und Photon (Open Source Geocoder) drehen sich darauf.  Sie verwenden denselben Index, in den der gesamte Planet aus OpenStreetMap importiert wird.  Serverfunktionen: Suche nach Orten per Deponie und Geocoder.  Elastisch ist von Natur aus sehr schnell und leicht, so dass der Server auch nicht sehr fettig ist. <br></li><li>  <i>Ein Geo-Server</i> (Node) ist der schwierigste von allen.  Basierend auf der Open Source Routing Machine habe ich eine kleine API geschrieben. Zu ihren Aufgaben geh√∂ren alle geografischen Berechnungen: Verlegen von Routen, Berechnen von Isochronen und Generieren von Kacheln.  Jede einzelne Operation ist nicht sehr einfallsreich, aber Dutzende von ihnen werden f√ºr jede Suche ben√∂tigt, und dies wird zu einem Engpass.  Momentan funktioniert auf diesem Server mit 16 GB RAM und im Allgemeinen alles in Sekundenbruchteilen - au√üer beim Generieren von Kacheln.  Wenn sich viele davon in der Warteschlange befinden, k√∂nnen Sie in wenigen Sekunden auf Bilder mit Karten warten.  Gl√ºcklicherweise erscheinen sie asynchron auf dem Client, was das Gesamtbild nicht wesentlich beeintr√§chtigt (hoffe ich). <br></li></ol><br>  Au√üerdem habe ich beschlossen, Ausz√ºge aus OpenStreetMap f√ºr Geoberechnungen nach L√§ndern getrennt zu f√ºttern.  Das funktioniert so: Wir stellen die erste Anfrage mit Koordinaten an unseren Geocoder, bestimmen das Land und nehmen dann die heruntergeladenen Dateien dieses Landes nur f√ºr die Manipulationen, die wir ben√∂tigen.  Dies ist notwendig, da selbst mein ziemlich leistungsf√§higer Server den Extrakt, der gr√∂√üer als zwei Gigabyte ist, nicht konvertieren kann - der Prozess verbraucht schnell den gesamten Speicher und die Drosseln.  Gl√ºcklicherweise passen fast alle L√§nder in diese Grenze, mit Ausnahme der Vereinigten Staaten: Dieses Monster musste in Staaten aufgeteilt werden.  Um anderthalbhundert Ausz√ºge zu erhalten, habe ich mich entschlossen, eine Reihe von Skripten zu schreiben, die ihren Zustand √ºberpr√ºfen, reparieren und aktualisieren. <br><br><img src="https://habrastorage.org/webt/a4/p1/q5/a4p1q5quwoshyq34ptpfyoxllia.png"><br><br>  Im Allgemeinen klingt dies alles komplizierter als es in der Praxis funktioniert.  Im Prinzip bin ich mit der resultierenden L√∂sung zufrieden - sie verf√ºgt √ºber eine gute Reserve f√ºr die Skalierung nach Anzahl der unterst√ºtzten Gebiete und Lastniveau. <br><br><h4>  Dynamisches Isochron </h4><br>  Eines der Hauptprobleme f√ºr mich war lange Zeit die heterogene Dichte der Ergebnisse.  Der Grund ist durchaus verst√§ndlich - dies ist die heterogene Dichte des Stra√üennetzes selbst und der darauf befindlichen Geb√§ude.  In einer mittelgro√üen Stadt im Umkreis von 5 Minuten kann es 2-3 Geldautomaten geben, und jetzt bewegen wir uns ins Zentrum der Metropole - und f√ºr die gleichen 5 Minuten k√∂nnen 20 oder 30 Ergebnisse erzielt werden.  Schlie√ülich springen wir ins Gr√ºne und beobachten fast garantierte 0-Ergebnisse, bis wir uns der Stadt n√§hern und der Suchradius etwas erfasst. <br><br>  Dieses Problem f√ºhrt zu einer nichtlinearen und unvorhersehbaren Belastung des Servers und vor allem zu einer ziemlich miesen Erfahrung f√ºr den Benutzer.  Das Hinzuf√ºgen eines Filters zu den Optionen (5 Minuten, 10 Minuten, 30 Minuten) l√∂st im Grunde nichts.  Im Dorf kann sogar ein Radius von 30 Minuten nichts zur√ºckgeben, aber in einer Gro√üstadt werden Sie sogar 5 Minuten mit Ergebnissen √ºberw√§ltigen.  Au√üerdem haben wir zus√§tzliche Funktionen hinzugef√ºgt, in deren Schaltfl√§chen der Fahrer unterwegs sein sollte.  Unsinn, im Allgemeinen brauchen Sie eine grundlegend andere L√∂sung. <br><br>  Als eine L√∂sung gefunden wurde, stellte sich heraus, dass sie sehr einfach war.  Anstatt vom Gegenteil abzuweichen und den Benutzer zur Auswahl eines Suchradius aufzufordern, k√∂nnen wir diesen Radius automatisch einstellen.  Die Logik ist eigentlich elementar: <br><br><ol><li>  Sie setzen den Ergebnissen Grenzen - zum Beispiel mindestens 1 und nicht mehr als 20 - und beginnen mit 10 Minuten <br></li><li>  F√ºhren Sie eine Suche nach Ort durch.  Bisher brauchen wir keine Wegbeschreibung zu ihnen, also m√ºssen wir nur die Isochron berechnen und nach Polygon im Gummiband filtern - beide Operationen sind sehr billig <br></li><li>  Wenn die Anzahl der Ergebnisse von den Grenzwerten in eine Richtung abweicht (in unserem Fall 0 oder 20+), teilen oder multiplizieren Sie die Zeit durch 2 und f√ºhren Sie die Suche erneut durch.  Wenn es im Limit enthalten ist, erstellen wir bereits Routen, sortieren nach Zeit usw. <br></li></ol><br>  Tats√§chlich ist dies etwas komplizierter und es gibt einige Nuancen, zum Beispiel ein ultradichtes Stadtnetz, wenn wir die Zeit bereits auf ein Minimum reduziert haben und es immer noch zu viele Ergebnisse gibt.  Hier ist es bereits notwendig, Routen zu sortieren und damit zu verlegen, was etwas teuer ist.  Dies sind jedoch Extremf√§lle und sie sind nicht sehr auff√§llig. <br><br>  In der Realit√§t ist es unwahrscheinlich, dass eine Person die Liste unter 5-6 Positionen scrollt. In 95% der Szenarien l√∂ste das dynamische Isochron das Problem.  Wir haben den Engpass beseitigt - eine unvorhersehbare Menge an Ergebnissen - und die Belastung des geografischen Servers f√ºr jede Anforderung nahezu flach gemacht.  Das Auschecken ist sehr einfach: <br><br>  <i>Alter Weg: Nehmen Sie einen Radius von 10 Minuten und 30 Ergebnisse</i> <i><br></i>  <i>Ergebnis: 1 Anfrage f√ºr Isochron + 30 Anfragen f√ºr Routen = <b>31</b></i> <i><br><br></i>  <i>Neuer Weg: √úberpr√ºfen Sie, 30 Ergebnisse sind viele, teilen Sie den Radius in zwei H√§lften, jetzt erhalten wir 10 Ergebnisse</i> <i><br></i>  <i>Ergebnis: 2 Anfragen nach Isochron + 10 Anfragen nach Routen = <b>12</b></i> <br><br><img src="https://habrastorage.org/webt/ta/ry/bs/tarybsvzvwhjow7ak13dgmcda60.png"><br><br><h4>  Neue Kartenlogik </h4><br>  Im letzten Teil habe ich den Mechanismus zum Generieren von Karten mit festgelegten Routen beschrieben.  Es stellte sich dann heraus, dass das Rechnen ziemlich kompliziert und teuer war, aber ich mochte sie so sehr, dass ich mich entschied, sie zu verlassen.  Gleichzeitig verstand ich, dass sie in ihrer jetzigen Form wenig praktischen Nutzen hatten - es war ihnen nicht klar, in welche Richtung Sie gingen, und sie wurden alle nach Norden gedreht.  Es war notwendig zu verfeinern. <br><br>  Das erste, was ich beschlossen habe, war, die Karten in Echtzeit mit einem Kompass bereitzustellen.  Beim Flattern wurde dies durch mikroskopische Logik beschrieben und funktionierte sehr schnell. Mit mehr als 10 Ergebnissen, die sich st√§ndig drehten, begann die Leistung zu sinken.  Au√üerdem sah es absolut widerlich aus: Tats√§chlich drehten sich statische Bilder, und dies war w√§hrend der Fahrt verwirrender, als es irgendwie half. <br><br>  Die n√§chste Idee war, auf den Karten die Bewegungsrichtung des Pfeils anzugeben.  Es war sehr einfach - ich hatte bereits einen Vektor berechnet und musste nur eine geometrische Form des Pfeils erzeugen.  Gleichzeitig zeigten die Karten in einer statischen Position weiterhin die Position des Fahrers mit einem runden Marker.  Es gab eine Einschr√§nkung: Es war notwendig, die Gr√∂√üe der Markierungen und Pfeile f√ºr verschiedene Zoomstufen zu normalisieren.  Dies scheint eine einfache Aufgabe zu sein, aber ich habe lange daran festgehalten.  Die Sache war folgende: Ich habe alle Symbole auf der Karte in Metern generiert und den Bruchteil der H√∂he der gesamten Karte in Metern zugrunde gelegt.  Es stellte sich heraus, dass sich beim Erstellen von Karten - Bestimmen von quadratischen Begrenzungsrahmen, Kleben und Trimmen von Kacheln usw. - Fehler ansammelten und diese kleinen Fehler letztendlich zu sehr unterschiedlichen Gr√∂√üen von Markierungen f√ºhrten.  Besonders h√∂llisch war die Situation mit kleinen Karten.  Ich werde nicht auf die Details der L√∂sung eingehen, aber aufgrund dieser Fehler musste die Logik der Kartengenerierung komplett neu gezeichnet werden.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Turf hat</a> dabei sehr geholfen - eine gro√üartige Sammlung von Werkzeugen zur Bearbeitung von Geodaten. <br><br>  Mit dem Pfeil waren Karten schon n√ºtzlicher, aber es fehlte noch etwas.  Nach Live-Tests wurde klar, dass alle Karten nach Norden aufgedeckt waren.  In der Statik war dies nicht auff√§llig, aber es wurde sofort deutlich, wenn Sie sich ans Steuer setzen.  Der Fahrer erwartet unbewusst, dass der Pfeil beim Fahren immer nach oben zeigt.  Nachdem ich das entdeckt hatte, setzte ich mich wieder zur Arbeit.  Dies war wieder eine dieser Aufgaben, die sehr einfach zu sein scheinen, aber Sie werden ein paar Tage danach verbringen.  Es scheint - berechnen Sie den Azimut und drehen Sie den endg√ºltigen GeoJSON vor der Rasterung.  Aber es gab wieder eine Nuance: Dieser endg√ºltige GeoJSON wurde durch einen direkten Begrenzungsrahmen erzeugt und erkennt beim Drehen und Zuschneiden leere Stellen. <br><br><img src="https://habrastorage.org/webt/e8/ru/m-/e8rum-k8gxclkhpgtsk95sdd2sw.png"><br><br>  Im obigen Diagramm habe ich grob meine L√∂sung angegeben.  Infolgedessen stellte sich heraus, dass es in Bezug auf Ressourcen nicht sehr teuer war und 99% der Szenarien abdeckte (ich denke, dass Fehler irgendwo in der N√§he der Pole aufsteigen werden).  Im Allgemeinen ist der Geo-Berechnungsserver immer noch der ressourcenintensivste Teil des Projekts, aber jetzt sind neben der √Ñsthetik auch die Routenkarten sehr praktisch.  Ich habe sogar versucht, ausschlie√ülich mit diesen Karten an den Ort zu gelangen, ohne Navigation.  Und sogar angekommen. <br><br><img src="https://habrastorage.org/webt/43/t1/0b/43t10bq_ahbbeizyykpfd4jwl9a.png" width="600"><br><br><h4>  Datenqualit√§t </h4><br>  Ich habe alle meine Daten auf unterschiedliche Weise aus OpenStreetMap √ºbernommen.  Wie Sie wissen, ist diese Ressource zu 100% gemeinn√ºtzig und wird von einem kollektiven Geist unterst√ºtzt.  Dies ist ein Plus (es ist kostenlos und mit einer klaren Struktur), es ist auch ein Minus - die Daten sind sehr heterogen. <br><br>  Auf hohem Niveau bedeutet dies eine ungleichm√§√üige Abdeckung des gesamten Globus: In L√§ndern und St√§dten mit einer gro√üen Anzahl von Enthusiasten werden jeder Rasen und jeder Pfad beschrieben, und an anderen Stellen gibt es fast leere Zonen mit einfachen skizzenhaften Objekten.  Die Daten werden mit genau der gleichen Ungleichm√§√üigkeit aktualisiert.  Beim Testen meiner Anwendung stie√ü ich einige Male auf neue Tankstellen, Caf√©s und manchmal ganze Stra√üen, die ich noch nicht auf Karten gesetzt hatte.  Sich dar√ºber zu beschweren ist dumm: Das gleiche Google gibt astronomische Budgets aus und enth√§lt eine ganze Reihe von Autos, die f√ºr die Relevanz seiner Daten verantwortlich sind.  Das Beste, was wir hier tun k√∂nnen, ist, h√§ufiger mit OpenStreetMap-Extrakten zu synchronisieren.  Nun, w√ºnsche ihrer Gemeinde viel Gl√ºck. <br><br>  Auf einer niedrigeren Ebene gibt es jedoch aufgrund der chaotischen Bearbeitung von Karten eine Reihe anderer Probleme, die vollst√§ndig gel√∂st werden k√∂nnen.  Dies betrifft haupts√§chlich Junk-Daten und Duplikate.  Die Vielfalt dieses Durcheinanders ist bemerkenswert: Der gleiche Ort kann dreimal auf unterschiedliche Weise beschrieben werden, Institutionen haben keine Namen, Typen und Tags sind falsch geschrieben und so weiter.  All dies hat keine einheitliche L√∂sung, vielmehr ist ein Komplex von Ma√ünahmen erforderlich, um den Inhalt zu systematisieren.  Zum Beispiel habe ich die folgenden Bedingungen: <br><br>  <i>Es gibt mehrere Synonyme und Variationen desselben Tags -&gt; wir beschreiben Alias-W√∂rterb√ºcher (z. B. Parken, Parkplatz, Parkeintritt usw.).</i> <i><br><br></i>  <i>Es gibt mehrere Orte mit demselben Typ und denselben Koordinaten:</i> <i><br><br></i> <ul><li>  Wenn jeder keinen Namen hat -&gt; wird der Ortstyp zum Namen </li><li>  nur einer hat einen Namen -&gt; nimm ihn </li><li>  Jeder hat einen Namen und sie sind anders -&gt; nimm den Nachnamen chronologisch </li></ul><br>  Es gibt mehrere Orte mit demselben Typ und fast denselben Koordinaten: <br><br><ul><li>  Wenn jeder keinen Namen hat -&gt; h√∂chstwahrscheinlich Duplikate, werden wir nicht komplizieren.  Verschmelzen Sie zu einem Punkt mit gemittelten Koordinaten, in dem der Ortstyp zum Namen wird.  Ein Mann wird kommen und verstehen </li><li>  nur einer hat einen Namen -&gt; das gleiche, nur jetzt haben wir schon einen Namen </li><li>  Jeder hat einen Namen und sie sind anders -&gt; aber dies ist ein Cluster </li></ul><br>  Der Cluster ist in unserem Fall eine Karte, in deren Kopf mehrere Stellen beschrieben sind.  Meist handelt es sich dabei um Gruppen von Gesch√§ften oder Tankstellen in der N√§he.  Oder ein Geldautomat befindet sich innerhalb des Bankgeb√§udes und der andere au√üerhalb.  Sie stellen f√ºr uns keine Schwierigkeit dar: Wir berechnen die durchschnittlichen Koordinaten und zeichnen die Route zu ihnen auf.  In der Benutzeroberfl√§che zeigen wir dies sauber und einfach: <br><br><img src="https://habrastorage.org/webt/ix/ru/jk/ixrujkqilkdxu34qjdsgt8e_pwo.png" width="300"><br><br><h2>  Schnittstelle und Design </h2><br>  So kam es mir vor, dass ich mir vor Beginn der Entwicklung normalerweise schon das endg√ºltige Bild vorstelle.  Gleichzeitig zeichne ich nicht gerne Diagramme und Konzepte, sondern ziehe es vor, ein Design parallel zu Funktionen zu erstellen (wenn dies nat√ºrlich mein Projekt ist).  Dieser iterative Ansatz ist einerseits sehr cool, da Sie andererseits zwischen Grafik und Code wechseln k√∂nnen - manchmal m√ºssen Sie alles zu oft wiederholen.  Das gleiche passierte hier: Ich habe anscheinend hundert Mal die einfachste Oberfl√§che geschaufelt.  Ausgehend von Kleinigkeiten wie Symbolen und Einr√ºckungen bis hin zur Zusammenstellung von Karten, Men√ºs usw.  Ich werde nicht alles beschreiben, ich werde schnell auf wichtige Themen eingehen.  Wenn Sie nicht an Design interessiert sind, k√∂nnen Sie es gerne √ºberspringen. <br><br><h4>  Farbpalette </h4><br>  Lange konnte ich nicht verstehen, was ich mit der Palette anfangen sollte.  Ich wollte wirklich die Kategorien von Orten in verschiedenen Farben kennzeichnen, mit Ausnahme von Gr√ºn - ich habe beschlossen, es als Akzent zu speichern.  Ich habe leicht unterscheidbare und satte Farben gew√§hlt, alles scheint in Ordnung zu sein.  Nach einiger Zeit stellte ich fest, dass das Blau f√ºr die Tankstelle das Blau widerspiegelt, das auf der Karte die Position des Fahrers angibt.  Er hat nichts damit gemacht, es so belassen wie es ist - aber der interne Perfektionist ist unzufrieden. <br><br><img src="https://habrastorage.org/webt/ya/dj/l8/yadjl8ri55axqz9pyzumcah0dfc.png" width="200"><br><br><h4>  "Auf dem Weg" und "Du bist in der N√§he" </h4><br>  Nachdem die Logik erschienen war, die die Bewegungsrichtung des Fahrers bestimmt, wurde es m√∂glich, die Routen in ‚Äûentlang des Weges‚Äú und den Rest zu unterteilen.  Wie ich bereits sagte, wird dies durch den ersten Abschnitt der Route bestimmt, der an den Ort verlegt wurde: Stimmt er mit dem letzten Abschnitt der Route des Fahrers √ºberein?  Wenn ja, dann gehen wir schon an diesen Ort.  Dann stellte sich die Frage, wie dies in der Benutzeroberfl√§che angezeigt werden soll.  Zus√§tzlich zu den √Ñnderungen in der Karte, die ich oben beschrieben habe, kam die Idee auf das Schild ‚ÄûUnterwegs‚Äú (oder ‚ÄûUnterwegs‚Äú auf Englisch - es scheint, dass sie dasselbe bedeuten).  Ich verwende denselben W√ºrfel f√ºr ein anderes Szenario: Wenn die Entfernung zum gefundenen Ort weniger als 25 Meter betr√§gt.  Dann macht es keinen Sinn, eine Wegbeschreibung zu erhalten. Ich verstecke die Karte und schreibe, dass Sie bereits in der N√§he sind (‚ÄûSie sind in der N√§he‚Äú / ‚ÄûSchauen Sie sich um‚Äú). <br><br><img src="https://habrastorage.org/webt/g6/1v/u9/g61vu93sak9y6igur-xaeigyc30.png" width="300"><br><br><h4>  Gemeinschaftskarte </h4><br>  Zu Beginn der Debug-Entwicklung habe ich eine statische Karte von Google verwendet, um das Isochron und die Ergebnisse anzuzeigen.  Dann rannte er lange mit ihr herum und wusste nicht, wo er bleiben sollte: Es scheint, dass die Karte eine interessante Sache ist, aber es scheint, dass sie keinen Platz einnehmen sollte.  Dar√ºber hinaus wollte schmerzlich nicht einmal in einer solchen Kleinigkeit auf Google angewiesen sein.  Am Ende entfernte ich dann die Karte, aber nach einiger Zeit begann ich Routenkarten zu generieren und stellte fest, dass ich selbst technologisch auf die gro√üe Karte ‚Äûgewachsen‚Äú war.  Es stellte sich heraus, dass dies nicht so schwierig war, obwohl die gemeinsame Karte bislang das ressourcenintensivste Teil des gesamten Projekts bleibt.  Und damit es keinen Platz in der Benutzeroberfl√§che einnimmt, lege ich die Karte auf eine separate Seite (sie wird seltener gezogen). <br><br><img src="https://habrastorage.org/webt/9k/ks/na/9kksnaanyjsobkxxc1mjmhny25c.png" width="300"><br><br><h4>  Lokalisierung </h4><br>  F√ºr eine normale Produktion ist eine Lokalisierung erforderlich.  Es ist immer einerseits eine sehr direkte und einfache Arbeit, andererseits - wenn Sie damit beginnen, kriechen Scharen von Kakerlaken von √ºberall her.  In meinem Fall war der Hauptinhalt von OSM bereits lokalisiert, sodass nur noch Ortstypen und Schnittstellenelemente √ºbrig blieben.  Mit Ausnahme einiger Stecker (lange Zeit konnte ich keine Matrize ‚ÄûUnterwegs‚Äú formulieren) war alles einfach.  Es ist erw√§hnenswert, dass Ortsnamen sowohl 2 als auch 3 Zeilen belegen k√∂nnen und m√∂glicherweise nicht in Bildschirme mit geringer Breite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">passen.</a> Daher hat das Widget <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auto_size_text</a> hier geholfen. Ich empfehle es in angemessenen Grenzen. <br><br><img src="https://habrastorage.org/webt/7z/yx/k3/7zyxk3gbrw0bamnfjf4fmgmysxe.png"><br><br>  Aber auf der technischen Seite war es nicht so glatt.  Bisher ist die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Intl_translation-</a> Bibliothek fast die einzige L√∂sung f√ºr die Lokalisierung unter Flattern, und es ist seltsam. ,                 .         ,      (!)   -  ,    ‚Ä¶      ,     ,        . <br><br> ,  ,        ‚Äî   -       .        ,   ,      . <br><br><h2>  Erscheinungsdatum </h2><br>   , ,   .   ,      -,     ‚Äî   .       ,      .      ,    .           . <br><br>          -   support  androidx: - ,   ,    .       ,        ‚Äî     .          :          .    ,    ,        . <br><br>  ,  ,   : <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/e1/3u/p8/e13up8j3vvrxjqwlpo2n6sfzauy.png" width="150"></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/k3/oc/vm/k3ocvm5auzce0x4lwl7p57l5qqe.png" width="150"></a> <br><br><h2>  </h2><br>      .  -         ‚Äî        .    ,       ‚Ññ2: <br><br><ul><li>     (,        ) </li><li>  ,    </li><li>  ,       (,    -) </li><li>   (      ‚Äî   - ,     ) </li></ul><br>       Android Auto  Apple CarPlay.       ,    . <br><br> ,    . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de440958/">https://habr.com/ru/post/de440958/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de440946/index.html">Rollup: Sie k√∂nnen bereits Anwendungen erstellen</a></li>
<li><a href="../de440948/index.html">Machen Sie sich mit Anmeldeformularen nicht schlau</a></li>
<li><a href="../de440950/index.html">Chrome Audit 500: Teil 1. Landung</a></li>
<li><a href="../de440954/index.html">Lebenszyklus eines Artikels √ºber Habr√©: Wir schreiben einen Habraparser. Teil zwei</a></li>
<li><a href="../de440956/index.html">Alternativer Nomaden-Orchestrator auf dem Desktop</a></li>
<li><a href="../de440960/index.html">Orange Pi 2G-IOT: Minenfeldkarte</a></li>
<li><a href="../de440962/index.html">Kommunikationsanbieter werden sich verpflichten, Vertr√§ge √ºber den Anschluss von Wohngeb√§uden abzuschlie√üen</a></li>
<li><a href="../de440966/index.html">Anschlie√üen der KELLER-Sensoren an MATLAB</a></li>
<li><a href="../de440972/index.html">Die Innopolis University wird Russlands erste internationale autonome Fahrzeugdesignschule abhalten</a></li>
<li><a href="../de440974/index.html">Kotlin Puzzlers, Vol. 2: eine neue Reihe von R√§tseln</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>