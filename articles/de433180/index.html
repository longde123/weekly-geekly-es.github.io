<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙄 👨🏽‍🚀 🧕🏿 Lösen von Datentypproblemen in Ruby oder Machen Sie Daten wieder zuverlässig 🆚 🆒 👨🏿‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel möchte ich darüber sprechen, welche Probleme mit Datentypen in Ruby auftreten, auf welche Probleme ich gestoßen bin, wie sie gelöst ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lösen von Datentypproblemen in Ruby oder Machen Sie Daten wieder zuverlässig</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433180/">  In diesem Artikel möchte ich darüber sprechen, welche Probleme mit Datentypen in Ruby auftreten, auf welche Probleme ich gestoßen bin, wie sie gelöst werden können und wie sichergestellt werden kann, dass auf die Daten, mit denen wir arbeiten, vertraut werden kann. <br><br><img src="https://habrastorage.org/webt/re/27/5n/re275nqouf3ucrd8gxrmv0cvboq.png" alt="Bild"><br><a name="habracut"></a><br>  Zuerst müssen Sie entscheiden, welche Datentypen es sind.  Ich sehe eine sehr erfolgreiche Definition des Begriffs, die im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HaskellWiki zu finden ist</a> . <br><blockquote>  In diesen Typen beschreiben Sie die Daten, mit denen Ihr Programm arbeiten wird. </blockquote>  Aber was ist falsch an Datentypen in Ruby?  Um das Problem umfassend zu beschreiben, möchte ich einige Gründe hervorheben. <br><br><h4>  Grund 1. Probleme von Ruby selbst </h4><br>  Wie Sie wissen, verwendet Ruby eine <b>strikte dynamische Typisierung mit Unterstützung der sogenannten.</b>  <b>Ente tippen</b> .  Was bedeutet das? <br><br>  Starke Typisierung erfordert explizites Casting und erzeugt dieses Casting nicht alleine, wie dies beispielsweise in JavaScript der Fall ist.  Daher schlägt die folgende Codeliste in Ruby fehl: <br><br><pre><code class="javascript hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> + <span class="hljs-string"><span class="hljs-string">'1'</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span> #=&gt; <span class="hljs-built_in"><span class="hljs-built_in">TypeError</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> can<span class="hljs-string"><span class="hljs-string">'t be coerced into Integer)</span></span></code> </pre> <br>  Bei der dynamischen Typisierung findet die Typprüfung zur Laufzeit statt, sodass wir die Variablentypen nicht angeben und dieselbe Variable zum Speichern von Werten verschiedener Typen verwenden können: <br><br><pre> <code class="javascript hljs">x = <span class="hljs-number"><span class="hljs-number">123</span></span> x = <span class="hljs-string"><span class="hljs-string">"123"</span></span> x = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>]</code> </pre><br>  Die folgende Aussage wird normalerweise als Erklärung für den Begriff „Ententypisierung“ gegeben: Wenn sie wie eine Ente aussieht, wie eine Ente schwimmt und wie eine Ente quakt, dann ist dies höchstwahrscheinlich eine Ente.  Das heißt,  Das Entenschreiben, das sich auf das Verhalten von Objekten stützt, bietet uns zusätzliche Flexibilität beim Schreiben unserer Systeme.  Im folgenden Beispiel ist der Wert für uns beispielsweise nicht der Typ des <code>collection</code> , sondern seine Fähigkeit, auf <code>blank?</code> Nachrichten zu antworten <code>blank?</code>  und <code>map</code> : <br><br><pre> <code class="javascript hljs">def process(collection) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> collection.blank? collection.map { |item| do_something_with(item) } end</code> </pre><br>  Die Fähigkeit, solche „Enten“ zu erschaffen, ist ein sehr mächtiges Werkzeug.  Wie jedes andere leistungsstarke Tool erfordert es jedoch große Sorgfalt bei der Verwendung.  Dies kann <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">durch die Forschung von Rollbar überprüft werden</a> , bei der mehr als 1000 Schienenanwendungen analysiert und die häufigsten Fehler identifiziert wurden.  Und 2 der 10 häufigsten Fehler hängen genau damit zusammen, dass das Objekt nicht auf eine bestimmte Nachricht antworten kann.  Daher reicht es möglicherweise nicht aus, das Verhalten des Objekts zu überprüfen, das uns die Ententypisierung in vielen Fällen gibt. <br><br>  Wir können beobachten, wie die Typprüfung in der einen oder anderen Form zu dynamischen Sprachen hinzugefügt wird: <br><br><ul><li>  TypeScript bietet JavaScript-Entwicklern eine Typprüfung </li><li>  Typhinweise wurden in Python 3 hinzugefügt </li><li>  Dialyzer leistet gute Arbeit bei der Typprüfung für Erlang / Elixir </li><li>  Steep und Sorbet fügen in Ruby 2.x eine Typprüfung hinzu </li></ul><br>  Bevor wir jedoch über ein anderes Tool sprechen, mit dem Sie in Ruby effizienter mit Typen arbeiten können, schauen wir uns zwei weitere Probleme an, für die ich eine Lösung finden möchte. <br><br><h4>  Grund 2. Das allgemeine Problem von Entwicklern in verschiedenen Programmiersprachen </h4><br>  Erinnern wir uns an die Definition der Datentypen, die ich ganz am Anfang des Artikels angegeben habe: <blockquote>  In diesen Typen beschreiben Sie die Daten, mit denen Ihr Programm arbeiten wird. </blockquote>  Das heißt,  Typen sollen uns helfen, Daten aus unserem Themenbereich zu beschreiben, in dem unsere Systeme arbeiten.  Anstatt jedoch mit den Datentypen zu arbeiten, die wir aus unserem Themenbereich erstellt haben, verwenden wir primitive Typen wie Zahlen, Zeichenfolgen, Arrays usw., die nichts über unseren Themenbereich aussagen.  Dieses Problem wird normalerweise als primitive Besessenheit (Besessenheit mit primitiven) klassifiziert. <br><br>  Hier ist ein typisches Beispiel für primitive Besessenheit: <br><br><pre> <code class="javascript hljs">price = <span class="hljs-number"><span class="hljs-number">9.99</span></span> # vs Money = Struct.new(:amount_cents, :currency) price = Money.new(<span class="hljs-number"><span class="hljs-number">9</span></span>_99, <span class="hljs-string"><span class="hljs-string">'USD'</span></span>)</code> </pre><br>  Anstatt den Datentyp für die Arbeit mit Geld zu beschreiben, werden häufig reguläre Zahlen verwendet.  Und diese Zahl sagt, wie alle anderen primitiven Typen auch, nichts über unseren Themenbereich aus.  Meiner Meinung nach ist dies das größte Problem bei der Verwendung von Grundelementen anstelle der Erstellung eines eigenen Typsystems, in dem diese Typen Daten aus unserem Themenbereich beschreiben.  Wir selbst lehnen die Vorteile ab, die wir durch die Verwendung von Typen erzielen können. <br><br>  Ich werde gleich auf diese Vorteile eingehen, nachdem ich ein anderes Thema behandelt habe, das uns unser bevorzugtes Ruby on Rails-Framework beigebracht hat. Dank dessen sind die meisten hier sicher zu Ruby gekommen. <br><br><h4>  Grund 3. Das Problem, an das uns das Ruby on Rails-Framework gewöhnt hat </h4><br>  Ruby on Rails, oder besser gesagt das darin integrierte <code>ActiveRecord</code> ORM-Framework, hat uns gelehrt, dass Objekte, die sich in einem ungültigen Zustand befinden, normal sind.  Meiner Meinung nach ist dies alles andere als die beste Idee.  Und ich werde versuchen, es zu erklären. <br><br>  Nehmen Sie dieses Beispiel: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> &lt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationRecord</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">validates</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">platform</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">presence</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class"> </span></span>= App.new app.valid? # =&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre><br>  Es ist nicht schwer zu verstehen, dass das <code>app</code> Objekt einen ungültigen Status hat: Die Validierung des <code>App</code> Modells erfordert, dass die Objekte dieses Modells ein <code>platform</code> haben und unser Objekt dieses Attribut leer hat. <br><br>  Versuchen wir nun, dieses Objekt in einem ungültigen Zustand an einen Dienst zu übergeben, der das <code>App</code> Objekt als Argument erwartet und abhängig vom <code>platform</code> dieses Objekts einige Aktionen ausführt: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoSomethingWithAppPlatform</span></span></span><span class="hljs-class"> # @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">param</span></span></span><span class="hljs-class"> [</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class"> # # @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> [</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">) # </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">something</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">platform</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DoSomethingWithAppPlatform</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">)</span></span></code> </pre><br>  In diesem Fall würde sogar die Typprüfung bestehen.  Da dieses Attribut für das Objekt jedoch leer ist, ist nicht klar, wie der Dienst diesen Fall behandeln wird.  Da wir Objekte in einem ungültigen Zustand erstellen können, verurteilen wir uns in jedem Fall dazu, Fälle, in denen ein ungültiger Zustand in unser System gelangt ist, ständig zu behandeln. <br><br>  Aber lassen Sie uns über ein tieferes Problem nachdenken.  Warum überprüfen wir im Allgemeinen die Gültigkeit der Daten?  In der Regel, um sicherzustellen, dass kein ungültiger Status in unsere Systeme gelangt.  Wenn es so wichtig ist, sicherzustellen, dass ein ungültiger Status nicht zulässig ist, warum lassen wir dann zu, dass Objekte mit einem ungültigen Status erstellt werden?  Insbesondere, wenn es sich um so wichtige Objekte wie das ActiveRecord-Modell handelt, das häufig auf die Stammgeschäftslogik verweist.  Meiner Meinung nach klingt das nach einer sehr schlechten Idee. <br><br>  Wenn wir also alle oben genannten Punkte zusammenfassen, treten beim Arbeiten mit Daten in Ruby / Rails die folgenden Probleme auf: <br><br><ul><li>  Die Sprache selbst verfügt über einen Mechanismus zur Überprüfung des Verhaltens, jedoch nicht über Daten </li><li>  Wie Entwickler in anderen Sprachen tendieren wir dazu, primitive Datentypen zu verwenden, anstatt ein Typensystem für unseren Themenbereich zu erstellen </li><li>  Rails hat uns daran gewöhnt, dass das Vorhandensein von Objekten in einem ungültigen Zustand normal ist, obwohl eine solche Lösung eine ziemlich schlechte Idee zu sein scheint </li></ul><br><h4>  Wie können diese Probleme gelöst werden? </h4><br>  Ich möchte eine der Lösungen für die oben beschriebenen Probleme anhand eines Beispiels für die Implementierung realer Funktionen in Appodeal betrachten.  Bei der Erfassung von Statistiken zu den Statistiken der täglich aktiven Benutzer (im Folgenden: DAU) für Anwendungen, die Appodeal zur Monetarisierung verwenden, kamen wir zu ungefähr der folgenden Datenstruktur, die wir erfassen müssen: <br><br><pre> <code class="javascript hljs">DailyActiveUsersData = Struct.new( :app_id, :country_id, :user_id, :ad_type, :platform_id, :ad_id, :first_request_date, <span class="hljs-attr"><span class="hljs-attr">keyword_init</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> )</code> </pre><br>  Diese Struktur hat dieselben Probleme, über die ich oben geschrieben habe: <br><br><ul><li>  Eine Typprüfung fehlt vollständig, was unklar macht, welche Werte die Attribute dieser Struktur annehmen können </li><li>  Es gibt keine Beschreibung der in dieser Struktur verwendeten Daten, und anstelle der für unsere Domäne spezifischen Typen werden Grundelemente verwendet </li><li>  Struktur kann in einem ungültigen Zustand existieren </li></ul><br>  Um diese Probleme zu lösen, haben wir uns für die <code>dry-types</code> und <code>dry-struct</code> .  <code>dry-types</code> ist ein einfaches und erweiterbares Typsystem für Ruby, das zum Gießen, Anwenden verschiedener Einschränkungen, Definieren komplexer Strukturen usw. nützlich ist. <code>dry-struct</code> ist eine Bibliothek, die auf <code>dry-types</code> aufbaut und ein praktisches DSL zum Definieren typisierter Strukturen bietet. Klassen. <br><br>  Um die Daten unseres Themenbereichs zu beschreiben, die in der Struktur zum Sammeln von DAUs verwendet werden, wurde das folgende Typsystem erstellt: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span> Types include Dry::Types.module AdTypeId = Types::Strict::Integer.enum(AD_TYPES.invert) EntityId = Types::Strict::Integer.constrained(gt: <span class="hljs-number"><span class="hljs-number">0</span></span>) PlatformId = Types::Strict::Integer.enum(PLATFORMS.invert) Uuid = Types::Strict::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.constrained(format: UUID_REGEX) Zero = Types.Constant(<span class="hljs-number"><span class="hljs-number">0</span></span>) end</code> </pre><br>  Jetzt haben wir eine Beschreibung der Daten erhalten, die in unserem System verwendet werden und die wir in der Struktur verwenden können.  Wie Sie sehen können, haben die Typen <code>EntityId</code> und <code>Uuid</code> einige Einschränkungen, und die aufzählbaren Typen <code>AdTypeId</code> und <code>PlatformId</code> können nur Werte aus einem bestimmten Satz haben.  Wie arbeite ich mit diesen Typen?  Betrachten Sie die <code>PlatformId</code> als Beispiel: <br><br><pre> <code class="javascript hljs">#     enumerable- PLATFORMS = { <span class="hljs-string"><span class="hljs-string">'android'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'fire_os'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'ios'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> }.freeze #       , #     Types::PlatformId[<span class="hljs-number"><span class="hljs-number">1</span></span>] == Types::PlatformId[<span class="hljs-string"><span class="hljs-string">'android'</span></span>] #    ,    #   ,     Types::PlatformId[<span class="hljs-string"><span class="hljs-string">'fire_os'</span></span>] # =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> #     ,   Types::PlatformId[<span class="hljs-string"><span class="hljs-string">'windows'</span></span>] # =&gt; Dry::Types::ConstraintError</code> </pre><br>  Also, mit den Typen selbst herausgefunden.  Wenden wir sie nun auf unsere Struktur an.  Als Ergebnis haben wir Folgendes erhalten: <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DailyActiveUsersData</span></span></span><span class="hljs-class"> &lt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dry</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">country_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ad_type</span></span></span><span class="hljs-class">, (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AdTypeId</span></span></span><span class="hljs-class"> ǀ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Zero</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">platform_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlarformId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ad_id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Uuid</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">first_request_date</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Types</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Strict</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Date</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Was sehen wir jetzt in der Datenstruktur für DAU?  Durch die Verwendung von <code>dry-types</code> und <code>dry-struct</code> wir die Probleme <code>dry-struct</code> die mit der fehlenden Überprüfung des Datentyps und der fehlenden Datenbeschreibung verbunden sind.  Jetzt kann jede Person, die sich diese Struktur und die Beschreibung der darin verwendeten Typen angesehen hat, verstehen, welche Werte jedes Attribut annehmen kann. <br><br>  Was das Problem mit Objekten im ungültigen Zustand <code>dry-struct</code> erspart uns <code>dry-struct</code> Folgendes: Wenn wir versuchen, die Struktur mit ungültigen Werten zu initialisieren, wird eine Fehlermeldung angezeigt.  Und in den Fällen, in denen die Richtigkeit der Daten von entscheidender Bedeutung ist (und im Fall der DAU-Erfassung ist dies bei uns der Fall), ist es meiner Meinung nach viel besser, eine Ausnahme zu erhalten, als später zu versuchen, mit ungültigen Daten umzugehen.  Wenn der Testprozess für Sie gut etabliert ist (und dies ist bei uns genau der Fall), erreicht der Code, der solche Fehler erzeugt, mit hoher Wahrscheinlichkeit einfach nicht die Produktionsumgebung. <br><br>  Neben der Unfähigkeit, Objekte in einem ungültigen Zustand zu initialisieren, erlaubt die <code>dry-struct</code> auch nicht, Objekte nach der Initialisierung zu ändern.  Dank dieser beiden Faktoren erhalten wir die Garantie, dass sich die Objekte solcher Strukturen in einem gültigen Zustand befinden und Sie sich überall in Ihrem System sicher auf diese Daten verlassen können. <br><br><h4>  Zusammenfassung </h4><br>  In diesem Artikel habe ich versucht, die Probleme zu beschreiben, die bei der Arbeit mit Daten in Ruby auftreten können, und über die Tools zu sprechen, mit denen wir diese Probleme lösen.  Und dank der Implementierung dieser Tools habe ich absolut aufgehört, mir Sorgen um die Richtigkeit der Daten zu machen, mit denen wir arbeiten.  Ist das nicht perfekt?  Ist dies nicht der Zweck eines Instruments - unser Leben in einem bestimmten Aspekt zu erleichtern?  Und meiner Meinung nach machen <code>dry-types</code> und <code>dry-struct</code> ihre Arbeit perfekt! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de433180/">https://habr.com/ru/post/de433180/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de433170/index.html">Wie wir die Architektur des Unternehmens nicht wiederholen konnten</a></li>
<li><a href="../de433172/index.html">Wir verbinden den Multiplayer mit dem in C ++ geschriebenen Handyspiel "Machen Sie Wörter aus Wörtern" auf iOS und Android</a></li>
<li><a href="../de433174/index.html">Nicht alle Patches sind gleichermaßen nützlich.</a></li>
<li><a href="../de433176/index.html">Docker Remote-API für Zertifikatauthentifizierung mit Sperrüberprüfung</a></li>
<li><a href="../de433178/index.html">Wie wir eine beschädigte WAV-Datei wiederhergestellt haben</a></li>
<li><a href="../de433182/index.html">Ist es möglich, einen Agenten für den Handel an der Börse mit Verstärkung auszubilden? Implementierung der R-Sprache</a></li>
<li><a href="../de433184/index.html">ASP.NET Core 2.2 veröffentlicht. Was gibt's Neues? (2 von 3)</a></li>
<li><a href="../de433186/index.html">Es reicht nicht aus, Polygone zu zählen, um 3D-Modelle zu optimieren</a></li>
<li><a href="../de433188/index.html">Die Staatsduma legte einen Gesetzentwurf zur autonomen Arbeit von Runet vor</a></li>
<li><a href="../de433192/index.html">Kubernetes: Eine erstaunlich erschwingliche persönliche Projektlösung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>