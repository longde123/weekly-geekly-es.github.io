<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“¶ ğŸ‰‘ ğŸ„ å€ŸåŠ©WebAssemblyï¼Œæ‚¨å¯ä»¥åœ¨Goä¸Šç¼–å†™Frontend ğŸ›€ ğŸ¤˜ğŸ¾ ğŸ›</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åŸå§‹æ–‡ç« ã€‚ 

 2017å¹´2æœˆï¼Œgo Brad Fitzpatrickå›¢é˜Ÿçš„æˆå‘˜æè®®ä»¥è¯¥è¯­è¨€æä¾›WebAssemblyæ”¯æŒã€‚ å››ä¸ªæœˆåçš„2017å¹´11æœˆï¼Œ GopherJSçš„ä½œè€…Richard Muziolå¼€å§‹å®æ–½è¿™ä¸ªæƒ³æ³•ã€‚ æœ€åï¼Œå®Œæ•´çš„å®ç°åœ¨masterä¸­æ‰¾åˆ°ã€‚ å¼€å‘äººå‘˜å°†åœ¨2018å¹´8æœˆå·¦å³æ”¶...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å€ŸåŠ©WebAssemblyï¼Œæ‚¨å¯ä»¥åœ¨Goä¸Šç¼–å†™Frontend</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417563/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åŸå§‹</a>æ–‡ç« ã€‚ <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ww/az/mf/wwazmfemkd6qhegdxrzeabctnxk.jpeg"></div><br>  2017å¹´2æœˆï¼Œgo Brad Fitzpatrickå›¢é˜Ÿçš„æˆå‘˜<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æè®®</a>ä»¥è¯¥è¯­è¨€æä¾›WebAssemblyæ”¯æŒã€‚ å››ä¸ªæœˆåçš„2017å¹´11æœˆï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GopherJSçš„</a>ä½œè€…Richard Muziolå¼€å§‹å®æ–½è¿™ä¸ªæƒ³æ³•ã€‚ æœ€åï¼Œå®Œæ•´çš„å®ç°åœ¨masterä¸­æ‰¾åˆ°ã€‚ å¼€å‘äººå‘˜å°†åœ¨2018å¹´8æœˆå·¦å³æ”¶åˆ°wasmçš„<a href="">go</a>ç‰ˆæœ¬<a href="">1.11</a> ã€‚ ç»“æœï¼Œå¦‚æœæ‚¨å·²ç»å°è¯•åœ¨wasmä¸­ç¼–è¯‘Cï¼Œåˆ™æ ‡å‡†åº“å‡ ä¹æ‰¿æ‹…äº†æ‚¨ç†Ÿæ‚‰çš„å¯¼å…¥å’Œå¯¼å‡ºå‡½æ•°çš„æ‰€æœ‰æŠ€æœ¯éš¾é¢˜ã€‚ å¬èµ·æ¥å¾ˆæœ‰å¸Œæœ›ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹ç¬¬ä¸€ä¸ªç‰ˆæœ¬å¯ä»¥åšä»€ä¹ˆã€‚ <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/de1/415/41d/de141541d13f83b05f9e3412d1961868.png"></div><br><br> æœ¬æ–‡ä¸­çš„æ‰€æœ‰ç¤ºä¾‹éƒ½å¯ä»¥ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½œè€…å­˜å‚¨åº“ä¸­çš„</a> dockerå®¹å™¨ä¸­å¯åŠ¨ï¼š <br><br><pre><code class="bash hljs">ï»¿docker container run -dP nlepage/golang_wasm:examples <span class="hljs-comment"><span class="hljs-comment"># Find out which host port is used docker container ls</span></span></code> </pre> <br> ç„¶åè½¬åˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">localhost</a> ï¼š32XXX /ï¼Œç„¶åä»ä¸€ä¸ªé“¾æ¥è½¬åˆ°å¦ä¸€ä¸ªé“¾æ¥ã€‚ <br><br><h3> å—¨ï¼Œå¥½ï¼ </h3><br> åŸºæœ¬çš„â€œ hello worldâ€çš„åˆ›å»ºå’Œæ¦‚å¿µå·²ç»æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å……åˆ†çš„æ–‡æ¡£è®°å½•</a> ï¼ˆç”šè‡³<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ˜¯ä¿„è¯­</a> ï¼‰ï¼Œå› æ­¤è®©æˆ‘ä»¬ç»§ç»­è¿›è¡Œæ›´å¾®å¦™çš„äº‹æƒ…ã€‚ <br><br> æœ€é‡è¦çš„æ˜¯æ”¯æŒwasmçš„Goçš„æ–°ç¼–è¯‘ç‰ˆæœ¬ã€‚ æˆ‘ä¸ä¼š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€æ­¥æè¿°å®‰è£…</a> ï¼Œåªæ˜¯çŸ¥é“æ‰€éœ€çš„å·²åœ¨ä¸»æœºä¸­ã€‚ <br><br> å¦‚æœæ‚¨ä¸æƒ³ä¸ºæ­¤æ‹…å¿ƒï¼Œå¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">githubä¸Šçš„golub-wasmå­˜å‚¨åº“ä¸­</a>æ‰¾åˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Dockerfile c go</a> ï¼Œæˆ–è€…ç”šè‡³å¯ä»¥æ›´å¿«åœ°ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">nlepage / golang_wasm</a>æ‹æ‘„å›¾åƒã€‚ <br><br> ç°åœ¨ï¼Œæ‚¨å¯ä»¥ç¼–å†™ä¼ ç»Ÿçš„<code>helloworld.go</code>å¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼š <br><br><pre> <code class="bash hljs">ï»¿GOOS=js GOARCH=wasm go build -o test.wasm helioworld.go</code> </pre><br>  GOOSå’ŒGOARCHç¯å¢ƒå˜é‡å·²ç»åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">nlepage / golang_wasm</a>æ˜ åƒä¸­è®¾ç½®ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„<code>Dockerfile</code>æ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼š <br><br><pre> <code class="hljs go">FROM nlepage/golang_wasm COPY helloworld.<span class="hljs-keyword"><span class="hljs-keyword">go</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">go</span></span>/src/hello/ RUN <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> build -o test.wasm hello</code> </pre><br> æœ€åä¸€æ­¥æ˜¯ä½¿ç”¨ä½äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code> misc/wasm</code></a>ä¸­çš„goå­˜å‚¨åº“ä¸­æˆ–<code>/usr/local/go/misc/wasm/</code>ä¸­çš„<code>test.wasm</code>æ˜ åƒ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">nlepage / golang_wasm</a>ä¸­å¯ç”¨çš„<code>wasm_exec.html</code>å’Œ<code>wasm_exec.js</code>æ–‡ä»¶ï¼Œåœ¨ä»¥ä¸‹ä½ç½®è¿è¡Œ<code>test.wasm</code>æµè§ˆå™¨ï¼ˆwasm_exec.jséœ€è¦äºŒè¿›åˆ¶æ–‡ä»¶<code>test.wasm</code> ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨æ­¤åç§°ï¼‰ã€‚ <br> ä¾‹å¦‚ï¼Œæ‚¨åªéœ€è¦ä½¿ç”¨nginxæä¾›3ä¸ªé™æ€æ–‡ä»¶ï¼Œåˆ™wasm_exec.htmlå°†æ˜¾ç¤ºâ€œè¿è¡Œâ€æŒ‰é’®ï¼ˆä»…åœ¨<code>test.wasm</code>æ­£ç¡®åŠ è½½æ—¶æ‰ä¼š<code>test.wasm</code> ï¼‰ã€‚ <br><br> å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ <code>test.wasm</code>å¿…é¡»ä¸MIMEç±»å‹<code>application/wasm</code> ï¼Œå¦åˆ™æµè§ˆå™¨å°†æ‹’ç»æ‰§è¡Œå®ƒã€‚  ï¼ˆä¾‹å¦‚nginxéœ€è¦<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ›´æ–°çš„mime.typesæ–‡ä»¶</a> ï¼‰ã€‚ <br><br> æ‚¨å¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">nlepage / golang_wasmä¸­</a>çš„nginxå›¾åƒï¼Œè¯¥å›¾åƒå·²ç»åœ¨ä»£ç &gt; / usr / share / nginx / html /ç›®å½•ä¸­åŒ…å«å›ºå®šçš„MIMEç±»å‹<code>wasm_exec.html</code>å’Œ<code>wasm_exec.js</code> ã€‚ <br><br> ç°åœ¨ï¼Œå•å‡»â€œè¿è¡Œâ€æŒ‰é’®ï¼Œç„¶åæ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œæ‚¨å°†çœ‹åˆ°console.logé—®å€™è¯­ï¼ˆâ€œ Hello Wasmï¼â€ï¼‰ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb1/3fe/587/cb13fe587331b2426368ea541f22c61b.png"></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œæœ‰</a>ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ã€‚ <br><br><h3> ä»Goå‘¼å«JS </h3><br> ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸå¯åŠ¨äº†ä»Goç¼–è¯‘çš„ç¬¬ä¸€ä¸ªWebAssemblyäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè®©æˆ‘ä»¬ä»”ç»†çœ‹ä¸€ä¸‹æ‰€æä¾›çš„åŠŸèƒ½ã€‚ <br><br> æ–°çš„syscall / jsè½¯ä»¶åŒ…å·²æ·»åŠ åˆ°æ ‡å‡†åº“ä¸­ï¼Œè¯·è€ƒè™‘ä¸»æ–‡ä»¶<code><a href="">js.go</a></code> <br> æä¾›äº†ä¸€ä¸ªæ–°çš„<code>js.Value</code>ç±»å‹ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªJavaScriptå€¼ã€‚ <br><br> å®ƒæä¾›äº†ä¸€ä¸ªç”¨äºç®¡ç†JavaScriptå˜é‡çš„ç®€å•APIï¼š <br><br><ul><li>  <code>js.Value.Get()</code>å’Œ<code>js.Value.Set()</code>è¿”å›å¹¶è®¾ç½®å¯¹è±¡çš„å­—æ®µå€¼ã€‚ </li><li>  <code>js.Value.Index()</code>å’Œ<code>js.Value.SetIndex()</code>é€šè¿‡è¯»å†™ç´¢å¼•è®¿é—®å¯¹è±¡ã€‚ </li><li>  <code>js.Value.Call()</code>å°†å¯¹è±¡æ–¹æ³•ä½œä¸ºå‡½æ•°è°ƒç”¨ã€‚ </li><li>  <code>js.Value.Invoke()</code>å°†å¯¹è±¡æœ¬èº«ä½œä¸ºå‡½æ•°è°ƒç”¨ã€‚ </li><li>  <code>js.Value.New()</code>è°ƒç”¨newè¿ç®—ç¬¦å¹¶å°†å…¶è‡ªèº«çš„çŸ¥è¯†ç”¨ä½œæ„é€ å‡½æ•°ã€‚ </li><li> è¿˜æœ‰ä¸€äº›è·å–å¯¹åº”Goç±»å‹çš„JavaScriptå€¼çš„æ–¹æ³•ï¼Œä¾‹å¦‚<code>js.Value.Int()</code>æˆ–<code>js.Value.Bool()</code> ã€‚ </li></ul><br> ä»¥åŠå…¶ä»–æœ‰è¶£çš„æ–¹æ³•ï¼š <br><br><ul><li>  <code>js.Undefined()</code>å°†ç»™js.Valueç›¸åº”çš„<code>undefined</code> ã€‚ </li><li>  <code>js.Null()</code>å°†ç»™<code>js.Value</code>ç›¸åº”çš„<code>null</code> ã€‚ </li><li>  <code>js.Global()</code>å°†è¿”å›<code>js.Value</code>ä»è€Œå¯ä»¥è®¿é—®å…¨å±€èŒƒå›´ã€‚ </li><li>  <code>js.ValueOf()</code>æ¥å—åŸå§‹çš„Goç±»å‹å¹¶è¿”å›æ­£ç¡®çš„<code>js.Value</code> </li></ul><br> ä¸å…¶åœ¨os.StdOutä¸­æ˜¾ç¤ºæ¶ˆæ¯ï¼Œä¸å¦‚ä½¿ç”¨<code>window.alert()</code>åœ¨é€šçŸ¥çª—å£ä¸­æ˜¾ç¤ºæ¶ˆæ¯ã€‚ <br><br> ç”±äºæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­ï¼Œå› æ­¤å…¨å±€èŒƒå›´æ˜¯ä¸€ä¸ªçª—å£ï¼Œå› æ­¤é¦–å…ˆéœ€è¦ä»å…¨å±€èŒƒå›´è·å–alertï¼ˆï¼‰ï¼š <br><br><pre> <code class="go hljs">alert := js.Global().Get(<span class="hljs-string"><span class="hljs-string">"alert"</span></span>)</code> </pre><br> ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ª<code>js.Value</code>å½¢å¼çš„<code>alert</code>å˜é‡ï¼Œå®ƒæ˜¯å¯¹<code>window.alert</code> JSçš„å¼•ç”¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°é€šè¿‡<code>js.Value.Invoke()</code>è¿›è¡Œè°ƒç”¨ï¼š <br><br><pre> <code class="go hljs">alert.Invoke(<span class="hljs-string"><span class="hljs-string">"Hello wasm!"</span></span>)</code> </pre><br> å¦‚æ‚¨æ‰€è§ï¼Œåœ¨å°†å‚æ•°ä¼ é€’ç»™Invokeä¹‹å‰ä¸éœ€è¦è°ƒç”¨js.ValueOfï¼ˆï¼‰ï¼Œå®ƒéœ€è¦ä»»æ„æ•°é‡çš„<code>interface{}</code>å¹¶å°†å€¼é€šè¿‡ValueOfæœ¬èº«ä¼ é€’ã€‚ <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬çš„æ–°ç¨‹åºåº”å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"syscall/js"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { alert := js.Global().Get(<span class="hljs-string"><span class="hljs-string">"alert"</span></span>) alert.Invoke(<span class="hljs-string"><span class="hljs-string">"Hello Wasm!"</span></span>) }</code> </pre><br> ä¸ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸€æ ·ï¼Œæ‚¨åªéœ€è¦åˆ›å»ºä¸€ä¸ªåä¸º<code>test.wasm</code>çš„æ–‡ä»¶ï¼Œå¹¶<code>wasm_exec.html</code>å’Œ<code>wasm_exec.js</code> ã€‚ <br> ç°åœ¨ï¼Œå½“æˆ‘ä»¬å•å‡»â€œè¿è¡Œâ€æŒ‰é’®æ—¶ï¼Œå°†å‡ºç°ä¸€ä¸ªè­¦æŠ¥çª—å£ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬çš„æ¶ˆæ¯ã€‚ <br><br> ä¸€ä¸ªæœ‰æ•ˆçš„ç¤ºä¾‹ä½äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>examples/js-call</code></a>æ–‡ä»¶å¤¹ä¸­ã€‚ <br><br><h3> ä»JSè°ƒç”¨Goã€‚ </h3><br> ä»Goè°ƒç”¨JSéå¸¸ç®€å•ï¼Œè®©æˆ‘ä»¬ä»”ç»†çœ‹ä¸€ä¸‹<code>syscall/js</code>åŒ…ï¼Œè¦æŸ¥çœ‹çš„ç¬¬äºŒä¸ªæ–‡ä»¶æ˜¯<a href=""><code>callback.go</code></a> ã€‚ <br><br><ul><li>  Goå‡½æ•°çš„<code>js.Callback</code>åŒ…è£…å™¨ç±»å‹ï¼Œç”¨äºJSã€‚ </li><li>  <code>js.NewCallback()</code>æ¥å—å‡½æ•°ï¼ˆæ¥å—<code>js.Value</code>è¿”å›ä»»ä½•å†…å®¹ï¼‰çš„å‡½æ•°ï¼Œå¹¶è¿”å›<code>js.Callback</code> ã€‚ </li><li> ä¸€äº›ç®¡ç†æ´»åŠ¨å›è°ƒå’Œ<code>js.Callback.Release()</code> ï¼Œå¿…é¡»è°ƒç”¨è¿™äº›æœºåˆ¶æ‰èƒ½é”€æ¯å›è°ƒã€‚ </li><li>  <code>js.NewEventCallback()</code>ä¸<code>js.NewEventCallback()</code>ç±»ä¼¼ï¼Œä½†æ˜¯åŒ…è£…å‡½æ•°ä»…æ¥å—1ä¸ªå‚æ•°-ä¸€ä¸ªäº‹ä»¶ã€‚ </li></ul><br> è®©æˆ‘ä»¬å°è¯•åšä¸€äº›ç®€å•çš„äº‹æƒ…ï¼šä»JSç«¯è¿è¡ŒGo <code>fmt.Println()</code> ã€‚ <br><br> æˆ‘ä»¬å°†å¯¹<code>wasm_exec.html</code>è¿›è¡Œä¸€äº›æ›´æ”¹ï¼Œä»¥ä¾¿èƒ½å¤Ÿä»Goä¸­è·å–å›è°ƒä»¥è¿›è¡Œè°ƒç”¨ã€‚ <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.clear(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> go.run(inst); inst = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> WebAssembly.instantiate(mod, go.ImportObject); <span class="hljs-comment"><span class="hljs-comment">//   }</span></span></code> </pre><br> è¿™å°†å¯åŠ¨wasmäºŒè¿›åˆ¶æ–‡ä»¶å¹¶ç­‰å¾…å…¶å®Œæˆï¼Œç„¶åå°†å…¶é‡æ–°åˆå§‹åŒ–ä»¥è¿›è¡Œä¸‹ä¸€æ¬¡è¿è¡Œã€‚ <br><br> è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ–°å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æ¥æ”¶å¹¶ä¿å­˜Goå›è°ƒå¹¶åœ¨å®Œæˆæ—¶æ›´æ”¹<code>Promise</code>çš„çŠ¶æ€ï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> printMessage <span class="hljs-comment"><span class="hljs-comment">// Our reference to the Go callback let printMessageReceived // Our promise let resolvePrintMessageReceived // Our promise resolver function setPrintMessage(callback) { printMessage = callback resolvePrintMessageReceived() }</span></span></code> </pre><br> ç°åœ¨è®©æˆ‘ä»¬ä¿®æ”¹<code>run()</code>å‡½æ•°ä»¥ä½¿ç”¨å›è°ƒï¼š <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.clear() <span class="hljs-comment"><span class="hljs-comment">// Create the Promise and store its resolve function printMessageReceived = new Promise(resolve =&gt; { resolvePrintMessageReceived = resolve }) const run = go.run(inst) // Start the wasm binary await printMessageReceived // Wait for the callback reception printMessage('Hello Wasm!') // Invoke the callback await run // Wait for the binary to terminate inst = await WebAssembly.instantiate(mod, go.importObject) // reset instance }</span></span></code> </pre><br> è¿™å°±æ˜¯JSçš„ä¸€é¢ï¼ <br><br> ç°åœ¨ï¼Œåœ¨Goéƒ¨åˆ†ä¸­ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªå›è°ƒï¼Œå°†å…¶å‘é€åˆ°JSç«¯å¹¶ç­‰å¾…éœ€è¦è¯¥å‡½æ•°ã€‚ <br><br><pre> <code class="go hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> done = <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{})</code> </pre><br> ç„¶åï¼Œä»–ä»¬åº”è¯¥ç¼–å†™çœŸæ­£çš„å‡½æ•°<code>printMessage()</code> ï¼š <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args []js.Value)</span></span></span></span> { message := args[<span class="hljs-number"><span class="hljs-number">0</span></span>].Strlng() fmt.Println(message) done &lt;- <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{}{} <span class="hljs-comment"><span class="hljs-comment">// Notify printMessage has been called }</span></span></code> </pre><br> å‚æ•°é€šè¿‡slice <code>[]js.Value</code> ï¼Œå› æ­¤æ‚¨éœ€è¦åœ¨ç¬¬ä¸€ä¸ªsliceå…ƒç´ ä¸Šè°ƒç”¨<code>js.Value.String()</code>æ‰èƒ½åœ¨Goè¡Œä¸­è·å–æ¶ˆæ¯ã€‚ <br> ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†æ­¤å‡½æ•°åŒ…è£…åœ¨å›è°ƒä¸­ï¼š <br><br><pre> <code class="go hljs">callback := js.NewCallback(printMessage) <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> callback.Release() <span class="hljs-comment"><span class="hljs-comment">// to defer the callback releasing is a good practice</span></span></code> </pre><br> ç„¶åè°ƒç”¨JSå‡½æ•°<code>setPrintMessage()</code> ï¼Œå°±åƒè°ƒç”¨<code>window.alert()</code> ï¼š <br><br><pre> <code class="go hljs">setPrintMessage := js.Global.Get(<span class="hljs-string"><span class="hljs-string">"setPrintMessage"</span></span>) setPrintMessage.Invoke(callback)</code> </pre><br> æœ€åè¦åšçš„æ˜¯ç­‰å¾…åœ¨mainä¸­è°ƒç”¨å›è°ƒï¼š <br><br><pre> <code class="go hljs">&lt;-done</code> </pre><br> æœ€åä¸€éƒ¨åˆ†å¾ˆé‡è¦ï¼Œå› ä¸ºå›è°ƒæ˜¯åœ¨ä¸“ç”¨goroutineä¸­æ‰§è¡Œçš„ï¼Œå¹¶ä¸”ä¸»goroutineå¿…é¡»ç­‰å¾…è°ƒç”¨å›è°ƒï¼Œå¦åˆ™wasmäºŒè¿›åˆ¶æ–‡ä»¶å°†è¿‡æ—©åœæ­¢ã€‚ <br><br> ç”Ÿæˆçš„Goç¨‹åºåº”å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="go hljs">ï»¿<span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"syscall/js"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> done = <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { callback := js.NewCallback(prtntMessage) <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> callback.Release() setPrintMessage := js.Global().Get(<span class="hljs-string"><span class="hljs-string">"setPrintMessage"</span></span>) setPrIntMessage.Invoke(callback) &lt;-done } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args []js.Value)</span></span></span></span> { message := args[<span class="hljs-number"><span class="hljs-number">0</span></span>].Strlng() fmt.PrintIn(message) done &lt;- <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{}{} }</code> </pre><br> ä¸å‰é¢çš„ç¤ºä¾‹ä¸€æ ·ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code>test.wasm</code>çš„æ–‡ä»¶ã€‚ æˆ‘ä»¬<code>wasm_exec.html</code>è¦ç”¨æˆ‘ä»¬çš„ç‰ˆæœ¬æ›¿æ¢<code>wasm_exec.html</code> ï¼Œå¹¶ä¸”å¯ä»¥é‡ç”¨<code>wasm_exec.js</code> ã€‚ <br><br> ç°åœ¨ï¼Œå½“æ‚¨æŒ‰â€œè¿è¡Œâ€æŒ‰é’®æ—¶ï¼ˆå¦‚æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹ï¼‰ï¼Œè¯¥æ¶ˆæ¯å°†æ‰“å°åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­ï¼Œä½†è¿™ä¸€æ¬¡æ›´å¥½ï¼  ï¼ˆæ›´éš¾ã€‚ï¼‰ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>examples/go-call</code></a>æ–‡ä»¶å¤¹ä¸­æä¾›äº†ä¸€ä¸ªdockeræ–‡ä»¶å‡ºä»·çš„å·¥ä½œç¤ºä¾‹ã€‚ <br><br><h3> æ¼«é•¿çš„å·¥ä½œ </h3><br> ä»JSè°ƒç”¨Goæ¯”ä»Goè°ƒç”¨JSæ›´ä¸ºéº»çƒ¦ï¼Œå°¤å…¶æ˜¯åœ¨JSæ–¹é¢ã€‚ <br><br> è¿™ä¸»è¦æ˜¯ç”±äºæ‚¨éœ€è¦ç­‰å¾…Goå›è°ƒçš„ç»“æœä¼ é€’åˆ°JSç«¯ã€‚ <br><br> è®©æˆ‘ä»¬å°è¯•å…¶ä»–æ–¹æ³•ï¼šä¸ºä»€ä¹ˆä¸ç»„ç»‡wasmäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®ƒä¸ä¼šåœ¨å›è°ƒè°ƒç”¨åç«‹å³ç»“æŸï¼Œè€Œæ˜¯ä¼šç»§ç»­å·¥ä½œå¹¶æ¥å—å…¶ä»–è°ƒç”¨ã€‚ <br> è¿™æ¬¡ï¼Œè®©æˆ‘ä»¬ä»Goç«¯å¼€å§‹ï¼Œå°±åƒåœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå›è°ƒå¹¶å°†å…¶å‘é€åˆ°JSç«¯ã€‚ <br><br> æ·»åŠ ä¸€ä¸ªè°ƒç”¨è®¡æ•°å™¨ä»¥è·Ÿè¸ªè¯¥å‡½æ•°è¢«è°ƒç”¨äº†å¤šå°‘æ¬¡ã€‚ <br><br> æˆ‘ä»¬çš„æ–°å‡½æ•°<code>printMessage()</code>å°†æ‰“å°æ”¶åˆ°çš„æ¶ˆæ¯å’Œè®¡æ•°å™¨å€¼ï¼š <br><br><pre> <code class="go hljs">ï»¿<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> no <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args []js.Value)</span></span></span></span> { message := args[<span class="hljs-number"><span class="hljs-number">0</span></span>].String() no++ fmt.Printf(<span class="hljs-string"><span class="hljs-string">"Message no %d: %s\n"</span></span>, no, message) }</code> </pre><br> åˆ›å»ºä¸€ä¸ªå›è°ƒå¹¶å°†å…¶å‘é€åˆ°JSç«¯ä¸ä¸Šä¸€ä¸ªç¤ºä¾‹ç›¸åŒï¼š <br><br><pre> <code class="go hljs">ï»¿callback := js.NewCallback(printMessage) <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> callback.Release() setPrintMessage := js.Global().Get(<span class="hljs-string"><span class="hljs-string">"setPrintMessage"</span></span>) setPrIntMessage.Invoke(callback)</code> </pre><br> ä½†æ˜¯è¿™ä¸€æ¬¡æˆ‘ä»¬æ²¡æœ‰<code>done</code>é€šé“æ¥é€šçŸ¥æˆ‘ä»¬ä¸»goroutineçš„ç»ˆæ­¢ã€‚ ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ç©ºçš„<code>select{}</code>æ°¸ä¹…é”å®šä¸»goroutinï¼š <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span>{}</code> </pre><br> è¿™å¹¶ä¸ä»¤äººæ»¡æ„ï¼Œæˆ‘ä»¬çš„äºŒè¿›åˆ¶wasmåªä¼šæŒ‚åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°å…³é—­æµè§ˆå™¨é€‰é¡¹å¡ã€‚ <br><br> æ‚¨å¯ä»¥åœ¨é¡µé¢ä¸Šç›‘å¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>beforeunload</code></a>äº‹ä»¶ï¼Œæ‚¨å°†éœ€è¦ç¬¬äºŒä¸ªå›è°ƒæ¥æ¥æ”¶è¯¥äº‹ä»¶å¹¶é€šè¿‡é€šé“é€šçŸ¥ä¸»goroutineï¼š <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> beforeUnloadCh = <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{})</code> </pre><br> è¿™æ¬¡ï¼Œæ–°çš„<code>beforeUnload()</code>å‡½æ•°å°†ä»…æ¥å—äº‹ä»¶ï¼Œä½œä¸ºå•ä¸ª<code>js.Value</code>å‚æ•°ï¼š <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeUnload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event js.Value)</span></span></span></span> { beforeUnloadCh &lt;- <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{}{} }</code> </pre><br> ç„¶åä½¿ç”¨<code>js.NewEventCallback()</code>å°†å…¶åŒ…è£…åœ¨å›è°ƒä¸­ï¼Œå¹¶åœ¨JSç«¯è¿›è¡Œæ³¨å†Œï¼š <br><br><pre> <code class="go hljs">beforeUnloadCb := js.NewEventCallback(<span class="hljs-number"><span class="hljs-number">0</span></span>, beforeUnload) <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> beforeUnloadCb.Release() addEventLtstener := js.Global().Get(<span class="hljs-string"><span class="hljs-string">"addEventListener"</span></span>) addEventListener.Invoke(<span class="hljs-string"><span class="hljs-string">"beforeunload"</span></span>, beforeUnloadCb)</code> </pre><br> æœ€åï¼Œå°†ç©ºé˜»å¡<code>select</code>æ›¿æ¢ä¸ºä»<code>beforeUnloadCh</code>é€šé“è¯»å–ï¼š <br><br><pre> <code class="go hljs">&lt;-beforeUnloadCh fmt.Prtntln(<span class="hljs-string"><span class="hljs-string">"Bye Wasm!"</span></span>)</code> </pre><br> æœ€ç»ˆç¨‹åºå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="go hljs">ï»¿<span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"syscall/js"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ( no <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> beforeUnloadCh = <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{}) ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { callback := js.NewCallback(printMessage) <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> callback.Release() setPrintMessage := js.Global().Get(<span class="hljs-string"><span class="hljs-string">"setPrintMessage"</span></span>) setPrIntMessage.Invoke(callback) beforeUnloadCb := js.NewEventCallback(<span class="hljs-number"><span class="hljs-number">0</span></span>, beforeUnload) <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> beforeUnloadCb.Release() addEventLtstener := js.Global().Get(<span class="hljs-string"><span class="hljs-string">"addEventListener"</span></span>) addEventListener.Invoke(<span class="hljs-string"><span class="hljs-string">"beforeunload"</span></span>, beforeUnloadCb) &lt;-beforeUnloadCh fmt.Prtntln(<span class="hljs-string"><span class="hljs-string">"Bye Wasm!"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args []js.Value)</span></span></span></span> { message := args[<span class="hljs-number"><span class="hljs-number">0</span></span>].String() no++ fmt.Prtntf(<span class="hljs-string"><span class="hljs-string">"Message no %d: %s\n"</span></span>, no, message) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeUnload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event js.Value)</span></span></span></span> { beforeUnloadCh &lt;- <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{}{} }</code> </pre><br> ä»¥å‰ï¼Œåœ¨JSç«¯ï¼ŒwasmäºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸‹è½½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="javascript hljs">ï»¿<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> go = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Go() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mod, inst WebAssembly .instantiateStreaming(fetch(<span class="hljs-string"><span class="hljs-string">"test.wasm"</span></span>), go.importObject) .then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">) =&gt;</span></span> { mod = result.module inst = result.Instance <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"runButton"</span></span>).disabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span> })</code> </pre><br> è®©æˆ‘ä»¬ä¿®æ”¹å®ƒä½¿å…¶åœ¨åŠ è½½åç«‹å³è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼š <br><br><pre> <code class="javascript hljs">ï»¿(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> go = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Go() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { instance } = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> WebAssembly.instantiateStreaming( fetch(<span class="hljs-string"><span class="hljs-string">"test.wasm"</span></span>), go.importObject ) go.run(instance) })()</code> </pre><br> å¹¶ç”¨æ¶ˆæ¯å­—æ®µå’Œè°ƒç”¨<code>printMessage()</code>çš„æŒ‰é’®æ›¿æ¢â€œè¿è¡Œâ€æŒ‰é’®ï¼š <br><br><pre> <code class="xml hljs">ï»¿<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"messageInput"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Hello Wasm!"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"printMessage(document.querySelector('#messagelnput').value);"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"prtntMessageButton"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span><span class="hljs-tag">&gt;</span></span> Print message <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br> æœ€åï¼Œæ¥å—å¹¶å­˜å‚¨å›è°ƒçš„<code>setPrintMessage()</code>å‡½æ•°åº”è¯¥æ›´ç®€å•ï¼š <br><br><pre> <code class="javascript hljs">ï»¿<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> printMessage; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPrintMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">callback</span></span></span><span class="hljs-function">) </span></span>{ printMessage = callback; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'#printMessageButton'</span></span>).disabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br> ç°åœ¨ï¼Œå½“æˆ‘ä»¬å•å‡»â€œæ‰“å°æ¶ˆæ¯â€æŒ‰é’®æ—¶ï¼Œæ‚¨åº”è¯¥ä¼šåœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­çœ‹åˆ°æˆ‘ä»¬é€‰æ‹©çš„æ¶ˆæ¯å’Œå‘¼å«è®¡æ•°å™¨ã€‚ <br> å¦‚æœæˆ‘ä»¬é€‰ä¸­æµè§ˆå™¨æ§åˆ¶å°çš„Preserveæ—¥å¿—æ¡†å¹¶åˆ·æ–°é¡µé¢ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æ¶ˆæ¯â€œ Bye Wasmï¼â€ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6c3/676/63d/6c367663d28d90535ccaafd1c10b5f50.png"></div><br><br> æºç å¯åœ¨githubä¸Šçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><code>examples/long-running</code></a>æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°ã€‚ <br><br><h3> ç„¶åå‘¢ </h3><br> å¦‚æ‚¨æ‰€è§ï¼Œå­¦ä¹ åˆ°çš„<code>syscall/js</code> APIå¯ä»¥å®Œæˆå…¶å·¥ä½œï¼Œå¹¶å…è®¸æ‚¨ä½¿ç”¨ä¸€äº›ä»£ç æ¥ç¼–å†™å¤æ‚çš„ä¸œè¥¿ã€‚ å¦‚æœæ‚¨çŸ¥é“æ›´ç®€å•çš„æ–¹æ³•ï¼Œå¯ä»¥å†™ä¿¡ç»™<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½œè€…</a> ã€‚ <br> å½“å‰æ— æ³•ç›´æ¥ä»Goå›è°ƒä¸­å°†å€¼è¿”å›ç»™JSã€‚ <br> è¯·è®°ä½ï¼Œæ‰€æœ‰å›è°ƒéƒ½åœ¨åŒä¸€ä¸ªgoroutinä¸­æ‰§è¡Œï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨åœ¨å›è°ƒä¸­æ‰§è¡Œäº†ä¸€äº›é˜»æ­¢æ“ä½œï¼Œè¯·ä¸è¦å¿˜è®°åˆ›å»ºä¸€ä¸ªæ–°çš„goroutinï¼Œå¦åˆ™å°†é˜»æ­¢æ‰€æœ‰å…¶ä»–å›è°ƒçš„æ‰§è¡Œã€‚ <br> æ‰€æœ‰åŸºæœ¬è¯­è¨€åŠŸèƒ½å‡å·²å¯ç”¨ï¼ŒåŒ…æ‹¬å¹¶å‘åŠŸèƒ½ã€‚ ç›®å‰ï¼Œæ‰€æœ‰çš„goroutinséƒ½å°†åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼Œä½†æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°†æ¥ä¼šæ”¹å˜</a> ã€‚ <br> åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»…ä½¿ç”¨äº†æ ‡å‡†åº“ä¸­çš„fmtåŒ…ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨çš„æ‰€æœ‰å†…å®¹éƒ½ä¸ä¼šè¯•å›¾ä»æ²™ç›’ä¸­é€ƒè„±ã€‚ <br><br> æ–‡ä»¶ç³»ç»Ÿä¼¼ä¹é€šè¿‡Node.jså¾—åˆ°æ”¯æŒã€‚ <br><br> æœ€åï¼Œæ€§èƒ½å¦‚ä½•ï¼Ÿ è¿›è¡Œä¸€äº›æµ‹è¯•ä»¥æŸ¥çœ‹Go wasmä¸ç­‰æ•ˆçš„çº¯JSä»£ç çš„æ¯”è¾ƒä¼šå¾ˆæœ‰è¶£ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">hajimehoshi</a>æœ‰äººæµ‹é‡äº†ä¸åŒç¯å¢ƒå¦‚ä½•ä½¿ç”¨æ•´æ•°ï¼Œä½†æ˜¯è¿™ç§æŠ€æœ¯ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ae0/e5b/ab5/ae0e5bab565640331a956284e94f4859.jpg"></div><br><br> ä¸è¦å¿˜è®°Go 1.11å°šæœªæ­£å¼å‘å¸ƒã€‚ æˆ‘è®¤ä¸ºè¿™å¯¹å®éªŒæŠ€æœ¯éå¸¸æœ‰åˆ©ã€‚ é‚£äº›å¯¹æ€§èƒ½æµ‹è¯•æ„Ÿå…´è¶£çš„äºº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯ä»¥æŠ˜ç£¨ä»–ä»¬çš„æµè§ˆå™¨</a> ã€‚ <br> æ­£å¦‚ä½œè€…æ‰€æŒ‡å‡ºçš„é‚£æ ·ï¼Œä¸»è¦çš„åˆ©åŸºæ˜¯ç°æœ‰goä»£ç ä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„ä¼ è¾“ã€‚ ä½†æ˜¯ä½¿ç”¨æ–°æ ‡å‡†ï¼Œæ‚¨å¯ä»¥åˆ¶ä½œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®Œå…¨è„±æœºçš„åº”ç”¨ç¨‹åº</a> ï¼Œå¹¶ä¸”wasmä»£ç ä»¥ç¼–è¯‘å½¢å¼ä¿å­˜ã€‚ æ‚¨å¯ä»¥å°†è®¸å¤šå®ç”¨ç¨‹åºè½¬ç§»åˆ°Webä¸Šï¼ŒåŒæ„ï¼Œæ–¹ä¾¿å—ï¼Ÿ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN417563/">https://habr.com/ru/post/zh-CN417563/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN417553/index.html">å…¬å¼€ç½‘ç»œç ”è®¨ä¼šâ€œ CSSé¢„å¤„ç†ç¨‹åºâ€</a></li>
<li><a href="../zh-CN417555/index.html">è«æ–¯ç§‘ä¸¾è¡Œè´§è¿å´‡æ‹œç ”è®¨ä¼šï¼šè¥é”€åå‡»</a></li>
<li><a href="../zh-CN417557/index.html">æ¿€å…‰æ•°æ§æœºåºŠæ¦‚è¿°LaserSolid</a></li>
<li><a href="../zh-CN417559/index.html">ä¸­å›½å¦‚ä½•è®©è‹¹æœå…¬å¸åœ¨ä¸­å›½å®˜æ–¹æœåŠ¡å™¨ä¸Šå­˜å‚¨iCloudç”¨æˆ·åŠ å¯†å¯†é’¥</a></li>
<li><a href="../zh-CN417561/index.html">æ—¥æœŸçš„å‘¼å«ï¼Œæˆ–è€…ç¬¬äºŒæ¬¡Mail.Ru Mailé»‘å®¢é©¬æ‹‰æ¾çš„å‘ç”Ÿæ—¶é—´</a></li>
<li><a href="../zh-CN417565/index.html">Googleå°†åœ¨å¤§è¥¿æ´‹ä¸Šé“ºè®¾ä¸€æ¡ç§äººç”µç¼†</a></li>
<li><a href="../zh-CN417569/index.html">å•å…ƒæµ‹è¯•æ•°æ®åº“è„šæœ¬</a></li>
<li><a href="../zh-CN417571/index.html">å¤šæ­¦è£…åœŸåŒªçš„å»ºè®®</a></li>
<li><a href="../zh-CN417573/index.html">ä¸¾ä¸–é—»åçš„AIå¼€å‘äººå‘˜åŒæ„ä¸åˆ¶é€ æ™ºèƒ½æ­¦å™¨</a></li>
<li><a href="../zh-CN417577/index.html">3Dtoolå€¼å¾—å…³æ³¨çš„æ•°æ§æœºåºŠ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>