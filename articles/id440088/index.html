<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•ê üîÇ üåë bobaflu - aksesoris pemrograman flutter ü§úüèª üñïüèø üê®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini akan fokus pada implementasi klien seluler Flutter. 


 Klien seluler yang mana? 


 Publikasi sebelumnya menjelaskan sistem aksesori pera...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>bobaflu - aksesoris pemrograman flutter</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440088/"><p><img src="https://habrastorage.org/webt/-n/0y/sv/-n0ysvv41yt_uwk8hh-fa1ui79e.png"></p><br><p> Artikel ini akan fokus pada implementasi klien seluler Flutter. </p><br><p>  Klien seluler yang mana? </p><br><p>  Publikasi sebelumnya menjelaskan sistem aksesori perangkat lunak: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bobaoskit - aksesoris, dnssd dan WebSocket</a> . </p><br><p> Analog dari aksesori perangkat lunak adalah objek nyata.  Bola lampu, sakelar, pemutar cd / kaset, pemutar radio, termostat, sensor suhu, sensor gerak, dll ... Seperangkat aksesori ditentukan oleh imajinasi dan kode program.  Anda dapat menerapkan setidaknya papan catur.  Untuk papan seperti itu, Anda perlu memiliki bidang kontrol ( <code>control</code> ) <code>move</code> , yang mengambil objek <code>{ from: "e2", to: "e4" }</code> misalnya, dan bidang layanan untuk mengatur ulang angka, dll. ... Skrip aksesori akan memproses permintaan untuk mengendalikan bidang <code>move</code> , menerima keputusannya adalah apakah mungkin untuk memindahkan gambar, dan akan mengembalikan (atau tidak) status dengan posisi angka di seluruh bidang. </p><br><p>  Jenis aksesori yang didukung saat ini dengan fungsi minimal adalah sebagai berikut: "sakelar", "sensor suhu", "termostat", "pemutar radio". </p><br><p>  Tentang catur, tidak akan ada diskusi lebih lanjut.  Jika itu menarik dan dalam hal ini, selamat datang di kucing. </p><a name="habracut"></a><br><p>  Jadi <code>bobaoskit.worker</code> berjalan.  Objek aksesori ada di memori komputer, Anda dapat membaca informasi tentangnya, Anda dapat secara manual mengirim permintaan <code>JSON</code> ke port <code>WebSocket</code> , dan melihat acara yang masuk. </p><br><p>  Untuk manajemen, saya membuat aplikasi seluler paling sederhana. </p><br><h2 id="pochemu-flutter">  Mengapa bergetar? </h2><br><p>  Selama beberapa tahun terakhir, sebuah ide telah secara aktif hidup di kepala saya untuk mempelajari pemrograman untuk perangkat seluler.  Karena saya menulis dalam <code>JavaScript</code> , saya mempelajari solusi yang memungkinkan Anda untuk tidak belajar bahasa pemrograman baru. </p><br><p>  <code>Appcelerator</code>  Dia mulai belajar dengannya.  Jika memori tidak berubah, SDK terbuka, tetapi IDE dengan berbagai tarif. <br>  <code>NativeScript</code>  Di sini saya telah membuat aplikasi sederhana yang menunjukkan daftar dengan gambar.  Itu tidak melangkah lebih jauh. <br>  <code>ReactNative</code>  Serangan terpanjang dari kerangka kerja yang tercantum sejauh ini.  Tantangan terbesar adalah memulai.  Saya melihat kursus.  Awalnya jelas, menarik, ternyata.  Tetapi <code>redux</code> dan setelah kekuasaan gagal.  Kemudian ia secara teratur mencoba untuk mulai menulis, tetapi <code>redux</code> keras kepala tidak membiarkan dirinya untuk mengalahkan. </p><br><p>  Akibatnya, saya tidak terikat pada keputusan apa pun saat itu (akhir 2016).  Mungkin karena tidak ada tugas khusus, mungkin karena alasan lain. </p><br><p>  Mendekati jatuhnya masa lalu (2018), pekerjaan sudah berlangsung di SDK untuk aksesori perangkat lunak.  Secara alami, Anda memerlukan aplikasi seluler.  Semuanya dimulai dengan mdns.  Setelah waktu luang, saya memperbarui ReactNative, menemukan plugin react-native-zeroconf, menciptakan aplikasi.  Menurut instruksi, diinstal, dibuat <code>link</code> , diluncurkan.  Aplikasi debugging Expo diluncurkan, yang tidak mendukung modul asli, dan, karenanya, plugin mdns tidak berfungsi.  Pada titik ini, tidak ada cukup waktu luang untuk membuat aplikasi asli yang bersih (tanpa expo) dan mengujinya.  Pekerjaan itu ditunda selama beberapa bulan. </p><br><p>  Pada saat yang sama, semakin banyak materi muncul tentang <code>flutter</code> di jaringan.  Saya menginstal sendiri.  Instalasi sederhana: <code>git clone</code> dan tambahkan ke <code>PATH</code> .  Sisanya sudah menyiapkan Android SDK / Xcode (dalam kasus saya, Android SDK telah diatur untuk waktu yang lama. Saya tidak dapat mengembangkan untuk iOS, karena saya bukan pengguna makro) dan Dart SDK (dapat diinstal secara terpisah, tetapi tidak harus, karena merupakan bagian dari flutter). </p><br><h2 id="principshema-raboty">  Prinsip / skema kerja </h2><br><ul><li>  Ketika diluncurkan, aplikasi mencari layanan <code>_bobaoskit._tcp</code> di jaringan lokal menggunakan plugin <a href="">flutter_mdns</a> .  Ada beberapa versi plugin ini, semuanya berakar dari yang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">diterbitkan</a> , tetapi tidak kompatibel dengan versi baru dari SDK Dart, masing-masing, banyak bercabang dan ditambahkan kompatibilitas.  Saya memilih versi ini karena yang lain tidak menyelesaikan host dari beberapa layanan yang ditemukan sekaligus. <br>  Setelah deteksi dan penentuan (onResolve), host ditambahkan ke daftar. <br>  Halaman dengan daftar layanan yang ditemukan adalah <code>StatefulWidget</code> , masing-masing, ketika mendeteksi / kehilangan layanan, <code>setState() {...}</code> disebut </li><li>  Ketika memilih host dari daftar, halaman baru dibuat (juga <code>StatefulWidget</code> ), yang <code>host</code> dan <code>port</code> layanan yang dipilih ditransmisikan. <br>  Objek <code>BobaosKit</code> bertanggung jawab untuk komunikasi dibuat.  Respons diproses melalui callback, sebagai  sementara saya tidak belajar banyak panah asinkron.  Tetapi dilihat dari dokumentasi yang dipindai, <code>Futures</code> adalah analog dari <code>Promise</code> di JS. <br>  Fungsi direkam untuk acara yang masuk (tidak ada tanggapan).  <code>EventEmitter</code> untuk Dart di sini.  Saya menulis yang sangat sederhana. </li></ul><br><pre> <code class="plaintext hljs"> void registerListener(String name, Function cb) { this._events.add(new BobaosKitCallback(name, cb)); } void removeAllListeners() { this._events = []; } void emitEvent(String name, dynamic params) { // call all listeners List&lt;BobaosKitCallback&gt; foundCallbacks = this._events.where((t) =&gt; t.name == name).toList(); foundCallbacks.forEach((f) =&gt; f.cb(params)); } ... ... void listen() { this.ws.listen((text) { var json = jsonDecode(text); if (json.containsKey('response_id')) { .... } else { //   response_id -  this.emitEvent(json['method'], json['payload']); } }); }</code> </pre> <br><p>  Acara masuk - jika aksesori telah dilepas, ditambahkan, status diperbarui.  Atau jika semua aksesori dilepas ( <code>clear accessories</code> ). </p><br><p>  Fungsi terdaftar - untuk memperbarui daftar, widget untuk acara ini. </p><br><ul><li>  Permintaan dikirim untuk informasi tentang semua aksesori. </li></ul><br><p>  Objek AccessoryInfo dibuat untuk setiap aksesori: </p><br><pre> <code class="plaintext hljs">import 'package:scoped_model/scoped_model.dart'; // AccessoryInfo extends Model // so, when accessory value is updated it descends down to // all widgets inside ScopedModelDescendant class AccessoryInfo extends Model { dynamic id; dynamic type; String name; String job_channel; List control; List status; bool selected; Map&lt;dynamic, dynamic&gt; currentState; AccessoryInfo(Map&lt;dynamic, dynamic&gt; obj) { this.id = obj['id']; this.type = obj['type']; this.name = obj['name']; this.job_channel = obj['job_channel']; this.control = obj['control']; this.status = obj['status']; this.currentState = {}; } void updateCurrentState(key, value) { currentState[key] = value; notifyListeners(); } void notify() { notifyListeners(); } }</code> </pre> <br><p>  objek ini sudah menjadi model.  Awalnya, saya menulis <code>StatefulWidget</code> dan <code>setState() {}</code> mana-mana, tetapi <code>setState() {}</code> hanya berfungsi untuk widget di dalamnya pendengar terdaftar.  Tetapi untuk manajemen aksesori terperinci, pada awalnya saya membuat halaman <code>Stateful</code> baru, dan memperhatikan bahwa statusnya tidak diperbarui.  Sebagai solusi - digunakan <code>ScopedModel</code> . </p><br><p>  Setelah daftar aksesori diterima, untuk masing-masing kami mengirimkan permintaan status dan menambahkan ke daftar <code>List &lt;AccessoryInfo&gt;</code> .  Panggil <code>setState() {}</code> , dengan demikian menambahkan aksesori yang didukung ke antarmuka.  Jenis aksesori yang didukung didefinisikan dalam <code>ListView.builder</code> dan di <code>./lib/widgets/*.dart</code> .  <code>switch/temperature sensor/radio player/thermostat</code> ini didukung.  Pekerjaan utama ke depan adalah menambahkan yang baru dan meningkatkan widget yang ada. </p><br><ul><li>  Sekarang tentang cara membuat elemen terpisah untuk setiap aksesori.  Misalnya, pertimbangkan sakelar. </li></ul><br><pre> <code class="plaintext hljs"> @override Widget build(BuildContext context) { return new ScopedModel&lt;AccessoryInfo&gt;( model: info, child: ScopedModelDescendant&lt;AccessoryInfo&gt;( builder: (context, child, model) { var cardColor = Theme.of(context).cardColor; dynamic switchState = model.currentState['state']; if (switchState is bool) { if (switchState) { cardColor = Colors.deepPurple; } else { cardColor = Theme.of(context).cardColor; } } return Card( color: cardColor, child: ListTile( selected: false, leading: new Icon(Icons.lightbulb_outline), title: new Text("${model.name}"), onTap: () { // to control accessory value // get status value at first bobaos.getStatusValue( model.id, "state", (bool err, Object payload) { if (err) { return print('error ocurred $payload'); } if (payload is Map) { dynamic currentValue = payload['status']['value']; bool newValue; if (currentValue is bool) { // invert newValue = !currentValue; } else { newValue = false; } // then send new value bobaos.controlAccessoryValue( model.id, {"state": newValue}, (bool err, Object payload) { if (err) { return print('error ocurred $payload'); } }); } }); }, onLongPress: () { // TODO: dialog with additional funcs }, )); })); }</code> </pre> <br><p>  Untuk aksesori jenis <code>switch</code> , elemen dibuat dalam daftar aksesori umum, ketika berinteraksi dengan yang (onTap) permintaan dikirim untuk mendapatkan nilai saat ini, kemudian untuk beralih nilai ini.  <code>ScopedModel</code> memungkinkan <code>ScopedModel</code> untuk menggambar ulang widget untuk pembaruan status yang masuk. </p><br><p>  Handler klik panjang tidak diterapkan untuk aksesori ini. </p><br><p>  Untuk pemutar radio, tampilannya seperti ini: </p><br><pre> <code class="plaintext hljs"> onLongPress: () { Navigator.of(context).push(MaterialPageRoute( builder: (context) =&gt; AccRadioPlayerControl( info: info, bobaos: bobaos, ))); },</code> </pre> <br><p>  Halaman <code>AccRadioPlayerControl</code> , yang juga menggunakan <code>ScopedModel</code> untuk mengelola keadaan. </p><br><p>  Pada ini, seluruh deskripsi algoritma operasi program habis.  Tidak ada fitur tambahan, seperti mengingat host terakhir, memilah aksesori ke dalam kategori / kamar tidak diimplementasikan.  Saat ini, semuanya sederhana. </p><br><h2 id="problemy">  Masalahnya </h2><br><p>  Saya akan menjelaskan masalah utama yang ada sekarang.  Saya masih tidak mengerti bagaimana cara mendeteksi koneksi <code>WebSocket</code> rusak. </p><br><p>  Saya menggunakan: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kelas WebSocket</a> . </p><br><p>  Ketika aplikasi / perangkat dalam mode tidur untuk waktu yang lama, koneksi terputus.  Anda harus kembali ke halaman pertama dan membuka kembali layanan yang ditemukan. </p><br><h2 id="posleslovie">  Kata penutup </h2><br><p>  Di satu sisi, Flutter cukup cepat dalam belajar dan berkembang.  ScopedModel ternyata lebih bisa dimengerti oleh saya daripada redux. <br>  Dart ternyata mirip dengan JavaScript yang biasa.  Mengetik + tipe dinamis akan memungkinkan semua orang untuk menulis dengan nyaman. </p><br><p>  Kesulitan dalam menulis kode: bersarangnya widget yang besar.  Panggilan balik neraka yang terkenal setelah bergetar terlihat berbeda.  Mode-vim dan <code>%</code> akan berguna. </p><br><p>  Sekarang beberapa pemikiran tentang IOT.  Baru-baru ini, semakin banyak perangkat / layanan pintar yang memerlukan pendaftaran di cloud.  Outlet Cina, untuk penggunaan yang Anda perlukan untuk menginstal aplikasi, membuat akun, dan hanya setelah itu Anda dapat menggunakannya. </p><br><p>  Asisten suara.  Alice dari Yandex membutuhkan cloud-nya ke mana teks yang dikenali dikirim.  Amazon Alexa bekerja dengan cara yang sama. </p><br><p>  Yang paling sukses, menurut saya, dibuat oleh Apple HomeKit bersama dengan Siri.  Cloud digunakan untuk pengenalan teks.  Interaksi dengan perangkat - di jaringan lokal. </p><br><p>  Pendapat saya adalah bahwa cloud harus ada untuk tujuannya: remote control, memperbarui, dll ... Jika perangkat dapat dikontrol pada jaringan lokal, maka Anda perlu melakukan ini. </p><br><h2 id="ssylki">  Referensi </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Repositori aplikasi</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dokumentasi Bobaoskit</a> - menjelaskan cara menginstal bobaoskit.worker dan meluncurkan aksesori <code>radio player</code> . </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id440088/">https://habr.com/ru/post/id440088/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id440074/index.html">Roskomos menganggap itu salah untuk membandingkan mesin Raptor Ilona Mask dan RD-180</a></li>
<li><a href="../id440076/index.html">Terjemahan dan interpretasi iklan dari bahasa Inggris ke bahasa Rusia</a></li>
<li><a href="../id440078/index.html">Perangkat kompiler Swift. Bagian 4</a></li>
<li><a href="../id440084/index.html">10 miliar ekspor perangkat lunak dapat diabaikan</a></li>
<li><a href="../id440086/index.html">Dunia Virus MS-DOS</a></li>
<li><a href="../id440090/index.html">Bagaimana sebenarnya indikator teknis di pasar saham bekerja?</a></li>
<li><a href="../id440092/index.html">Penyelidikan matematis tentang bagaimana pemilihan gubernur yang dipalsukan di Primorye pada 16 September 2018</a></li>
<li><a href="../id440094/index.html">Kebun mekar di Mars tetap menjadi mimpi: proyek Mars One bangkrut</a></li>
<li><a href="../id440096/index.html">Kerentanan RunC mempengaruhi Kubernet, Docker, dan konten</a></li>
<li><a href="../id440098/index.html">Nonsen masih sepenuhnya otomatis. Bagian 2. Pemisah. Kulkas. Kubus Algoritma</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>