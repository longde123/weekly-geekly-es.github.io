<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏠 ⌚️ 👩🏿‍🎓 كيف تتوقف عن الخوف من Proguard وتبدأ الحياة 💟 🎁 👩🏿‍🤝‍👩🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="مرحبًا ، أنا مطور Android ولم أعد أخاف من ProGuard ... 


 عادة ، يتم تذكر هذه الأداة المساعدة عندما تواجه مشكلة dalvik dex-limit أو مع متطلبات لتحسين...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>كيف تتوقف عن الخوف من Proguard وتبدأ الحياة</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415499/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ws/uk/rs/wsukrsowhkx1zzbqyocrumhhsmi.png"></p><br><p style=";text-align:right;direction:rtl">  مرحبًا ، أنا مطور Android ولم أعد أخاف من ProGuard ... </p><br><p style=";text-align:right;direction:rtl"> عادة ، يتم تذكر هذه الأداة المساعدة عندما تواجه مشكلة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">dalvik dex-limit</a> أو مع متطلبات لتحسين أمان التطبيق.  للأسف ، إنها بعيدة عن المرة الأولى لتكوين Proguard بشكل صحيح.  غالبًا ما لاحظت عددًا ، بعد كسر المشروع ، قم بإيقاف تشغيل Proguard وتشغيل دعم Mulditex ، وفي كل مرة كنت حزينًا قليلاً بشأن هذا ، لأن Proguard يساعد على تقليل حجم التطبيق وزيادة أدائه. </p><br><p style=";text-align:right;direction:rtl">  في النهاية ، قررت كتابة مقال يمكنني من خلاله وضع جميع المعلومات المفيدة التي تعلمتها على مدى عدة سنوات من العمل مع Proguard والتي يمكن أن تساعد كل من المبتدئين تمامًا وأولئك الذين يعرفون شيئًا بالفعل. </p><a name="habracut"></a><br><h2 id="o-chem-eto" style=";text-align:right;direction:rtl">  عن ماذا </h2><br><p style=";text-align:right;direction:rtl">  Proguard هو أداة مفتوحة المصدر لتحسين والتشويش على كود Java.  تعالج هذه الأداة شفرة Java المترجمة بالفعل ، لذا يجب أن تعمل مع أي لغة JVM.  بتعبير أدق ، اللغة نفسها لـ Proguard غير مبالية ، فقط الرمز الثانوي مهم.  يمكن تقسيم جميع التلاعبات في precuard bytecode إلى 3 فئات رئيسية: <strong>تقلص الشفرة</strong> ، <strong>والتحسين ،</strong> <strong>والتعتيم</strong> . </p><br><h3 id="code-shrinking" style=";text-align:right;direction:rtl">  تقلص الرمز </h3><br><p style=";text-align:right;direction:rtl">  نعم ، إنه أمر غريب نوعًا ما كتابة التعليمات البرمجية ثم حذفها ، ولكن هذه هي حقيقة تطوير Android.  لا يتعلق هذا بالطبع بالكود المكتوب بخط اليد (على الرغم من حدوث ذلك) ، ولكن حول طن من البضائع الميتة التي تنقلها المكتبات بجميع أنواعها.  <strong>يمكن لـ Guava</strong> و <strong>Apache Commons</strong> و <strong>Google Play Services</strong> وغيرهم من الرجال تضخيم حجم ملف apk من 500 كيلوبايت إلى بضع عشرات ميغابايت.  في بعض الأحيان يذهب الأمر إلى حد أنه لا يمكن للبرنامج الترجمة بسبب تجاوز <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">حد أساليب Dalvik</a> .  سيساعد برنامج Proguard في إزالة جميع التعليمات البرمجية غير المستخدمة وتقليل حجم التطبيق إلى بضعة ميغابايت. </p><br><h3 id="optimisation" style=";text-align:right;direction:rtl">  التحسين </h3><br><p style=";text-align:right;direction:rtl">  بالإضافة إلى إزالة التعليمات البرمجية غير الضرورية ، يمكن لـ Proguard تحسين التعليمات البرمجية المتبقية.  تشمل ترسانتها تحليل تدفق التحكم ، تحليل تدفق البيانات ، التقييم الجزئي ، التخصيص الفردي الثابت ، ترقيم القيمة العالمية ، تحليل الفعالية.  يمكن لبرنامج Proguard إجراء تحسينات ثقب الباب ، وتقليل عدد تخصيصات المتغيرات ، وتبسيط عمليات تكرار الذيل والمزيد ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">wiki</a> ).  بالإضافة إلى مثل هذه العمليات العامة ، يحتوي Proguard على تحسينات مفيدة على وجه التحديد لمنصة Android ، على سبيل المثال ، استبدال فئات التعداد بالأحبار ، وحذف تعليمات التسجيل. </p><br><h3 id="obfuscation" style=";text-align:right;direction:rtl">  التعتيم </h3><br><p style=";text-align:right;direction:rtl">  أخيرًا ، يمكن لـ Proguard تحويل كل التعليمات البرمجية الخاصة بك إلى فوضى غير قابلة للقراءة عن طريق إعادة تسمية جميع الفئات والأساليب والحقول إلى مجموعات من الأحرف العشوائية (في الواقع ليست عشوائية تمامًا).  هذا خيار مفيد للغاية ، حيث يمكن لأي شخص فك ملف apk الخاص بك ، وليس لدى الجميع الصبر لفهم التعليمات البرمجية المشوشة. </p><br><h2 id="princip-raboty" style=";text-align:right;direction:rtl">  مبدأ العمل </h2><br><p style=";text-align:right;direction:rtl">  يعمل Proguard في 3 خطوات في التسلسل الموصوف أعلاه: <strong>تقلص الشفرة</strong> ← <strong>التحسين</strong> ← <strong>التشويش</strong> .  كل خطوة اختيارية. </p><br><p style=";text-align:right;direction:rtl">  <em>يتم إيقاف خطوة التحسين في حالة Android SDK بشكل افتراضي.</em> </p><br><p style=";text-align:right;direction:rtl">  لكي يعمل برنامج Proguard ، يلزمك توفير 3 مكونات: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> الكود البرمجي الخاص بك هو أرشيف يحتوي على ملفات <code>class</code> الخاصة ببرنامجك وجميع المكتبات التي تستخدمها (jar و aar و apk و war و zip وما إلى ذلك).  يقوم برنامج Proguard فقط بتعديل التعليمات البرمجية المترجمة بالفعل ولا علاقة له بالمصدر. </li><li style=";text-align:right;direction:rtl">  ملف (ملفات) التكوين - ملف (ملفات) يحتوي على جميع القواعد والخيارات والإعدادات التي تريد بدء المعالجة بها. </li><li style=";text-align:right;direction:rtl">  أوعية المكتبة (aar ، apks ، ...) - فئات النظام الأساسي الذي يعمل عليه البرنامج.  في حالة Android ، هذا هو <code>android.jar</code> .  هذه المحفوظات مطلوبة فقط من أجل التحليل الصحيح لكودك ، ولن يتم تعديلها (هذا غير منطقي ، نظرًا لأن <code>android.jar</code> "على الهاتف" ، وليس لدينا إمكانية الوصول إليه). </li></ul><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/sf/vb/b8/sfvbb8uuvqdacgnjvzmeka3zpa4.png" alt="صورة من عرض Jeb Ware ، رابط في نهاية المقال"><br>  (صورة من عرض Jeb Ware ، رابط في نهاية المقال) </p><br><p style=";text-align:right;direction:rtl">  باستخدام فئات المكتبة وملفات التكوين الخاصة بك ، يقوم Proguard بتعريف جميع نقاط الدخول إلى برنامجك ( <strong>البذور</strong> ).  بمعنى آخر ، تحدد تلك الفئات والأساليب التي يمكن استدعاؤها من الخارج والتي لا يمكن لمسها.  ثم ، بدءًا من <strong>البذور</strong> المكتشفة ، يعبر Proguard بشكل متكرر كل التعليمات البرمجية الخاصة بك ، ويضع علامة على كل شيء "يمكن" الوصول إليه.  سيتم حذف جميع التعليمات البرمجية الأخرى.  يجب تحديد نقطة إدخال واحدة على الأقل في التكوين.  بالنسبة لبرنامج Java القياسي ، هذه هي الوظيفة <code>main</code> .  في Android ، لا توجد نقطة إدخال واحدة في البرنامج ؛ بدلاً من ذلك ، لدينا مكونات قياسية (نشاط ، خدمة ، إلخ) يتم إنشاؤها واستدعاؤها من قبل النظام.  لحسن الحظ ، لا نحتاج إلى تحديد أي شيء هنا بمفردنا ، فسيقوم Android SDK بإنشاء التهيئة اللازمة لنا. </p><br><h3 id="soputstvuyuschie-fayly" style=";text-align:right;direction:rtl">  الملفات المصاحبة </h3><br><p style=";text-align:right;direction:rtl">  بعد اكتشاف جميع نقاط الإدخال ، سيكتبها برنامج <code>seeds.txt</code> ملف <code>seeds.txt</code> . </p><br><p style=";text-align:right;direction:rtl">  يتم كتابة جميع التعليمات البرمجية التي وجدها Proguard غير ضرورية إلى ملف <code>usage.txt</code> .  هذا اسم غريب نوعًا ما لملف يحتوي على رمز بعيد ، سيكون من الأصح تسميته unusage.txt ، ولكن لدينا ما لدينا ، فقط تذكر ذلك. </p><br><p style=";text-align:right;direction:rtl">  في خطوة التعتيم ، سيتم إنشاء ملف <code>mapping.txt</code> يحتوي على أزواج &lt;اسم الفئة الأصلية | الطريقة | الحقل&gt; -&gt; &lt;اسم الفئة المظلمة | الطريقة | الحقل&gt;.  هذا الملف مفيد عندما تحتاج إلى إلغاء تشفير برنامج ، على سبيل المثال ، قراءة stacktrace.  ليس مطلوبًا إعادة تعيين الملفات يدويًا ؛ تحتوي حزمة Android SDK على أدوات مساعدة <code>proguardui</code> للمساعدة.  علاوة على ذلك ، إذا كنت تستخدم Fabric Crashlytics ، فيمكن للمكون الإضافي التدريجي العثور على هذا الملف وتحميله في وحدة التحكم بشكل مستقل ، لذلك لا داعي للقلق بشأنه. </p><br><p style=";text-align:right;direction:rtl">  في حالة Android ، توجد هذه الملفات عادةً في <code>app/build/output/mapping/&lt;product-flavor-name&gt;/</code> . </p><br><p style=";text-align:right;direction:rtl">  يقوم Proguard أيضًا بإنشاء ملف <code>dump.txt</code> يحتوي على كل شيء وضعه Proguard في الأرشيف النهائي.  لم يكن مفيدًا أبدًا بالنسبة لي ، ولكن ربما سيكون مفيدًا لشخص ما. </p><br><h3 id="kak-dela-obstoyat-v-android" style=";text-align:right;direction:rtl">  كيف تسير الأمور على Android </h3><br><p style=";text-align:right;direction:rtl">  يمكن لـ Android Gradle Plugin تشغيل Proguard بمفرده.  كل ما عليك فعله هو تمكين هذا الخيار وتحديد ملفات التكوين. </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs cs">buildTypes { &lt;...&gt; release { minifyEnabled <span class="hljs-literal"><span class="hljs-literal">true</span></span> proguardFiles <span class="hljs-string"><span class="hljs-string">'proguard-rules.pro'</span></span>, getDefaultProguardFile(<span class="hljs-string"><span class="hljs-string">'proguard-android.txt'</span></span>) } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>minifyEnabled true</code> - تمكين Proguard في وقت البناء </p><br><p style=";text-align:right;direction:rtl">  <code>proguardFiles</code> - قائمة ملفات التكوين.  ستتم إضافة القواعد من جميع ملفات التكوين إلى القائمة العامة بالترتيب الذي تظهر به. </p><br><p style=";text-align:right;direction:rtl">  <code>proguard-rules.pro</code> هو ملف التكوين الخاص بنا مع القواعد الخاصة بالمشروع </p><br><p style=";text-align:right;direction:rtl">  <code>getDefaultProguardFile('proguard-android.txt')</code> - وظيفة تُرجع ملف التكوين القياسي لتطبيقات Android.  يكمن في <code>AndroidSDK/tools/proguard</code> </p><br><p style=";text-align:right;direction:rtl">  في الواقع ، يحتوي Android SDK على ملفين <code>proguard-android.txt</code> : <code>proguard-android.txt</code> و <code>proguard-android-optimize.txt</code> .  يحتوي الخيار الأول على خيار <code>-dontoptimize</code> ، والذي يوقف جميع التحسينات.  إذا كنت ترغب في تمكين التحسين ، استخدم التكوين الثاني. </p><br><p style=";text-align:right;direction:rtl">  بالإضافة إلى عمليات التهيئة القياسية هذه ، تنشئ حزمة Android SDK (aapt) تلقائيًا مجموعة من القواعد للموارد: يتحقق aapt من جميع ملفات xml (بما في ذلك البيان) للعثور على جميع الأنشطة والخدمات والمشاهدات وما إلى ذلك.  ووضع القواعد اللازمة لهم.  يمكن العثور على القواعد التي تم إنشاؤها في <code>app/build/intermediates/proguard-rules/&lt;flavor&gt;/aapt_rules.txt</code> .  لا تحتاج إلى تحديده بنفسك ، سيضيف Android Gradle Plugin هذه القواعد تلقائيًا. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/1r/w4/t6/1rw4t6egtvymigl79hnxc3n8t9a.png" alt="صورة من عرض Jeb Ware ، رابط في نهاية المقال"><br>  (صورة من عرض Jeb Ware ، رابط في نهاية المقال) </p><br><h2 id="konfigi" style=";text-align:right;direction:rtl">  Configs </h2><br><p style=";text-align:right;direction:rtl">  يعد إعداد Proguard الجزء الأساسي للعمل معه وفي نفس الوقت هو الأصعب.  يمكن للتكوين غير الصحيح أن يكسر بسهولة تجميع التطبيق والتطبيق نفسه في وقت التشغيل.  يتم توثيق جميع خيارات التكوين المتاحة بالتفصيل عند الإيقاف.  الموقع. </p><br><p style=";text-align:right;direction:rtl">  من بين جميع الخيارات ، أود أن أخص بالذكر المجموعات الثلاث الأكثر أهمية: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  الاحتفاظ بالقواعد - جميع نقاط الدخول الممكنة للبرنامج.  القواعد التي تخبر Proguard عن الفئات أو الأجزاء من الفئات التي يجب الاحتفاظ بها دون تغيير أو أي التعديلات صالحة لفئات محددة. </li><li style=";text-align:right;direction:rtl">  ضبط التحسين - حدد أي التحسينات مقبولة ، وعدد دورات التحسين التي يجب القيام بها. </li><li style=";text-align:right;direction:rtl">  العمل مع التحذيرات والأخطاء وتصحيح الأخطاء </li></ul><br><h3 id="keep-rules" style=";text-align:right;direction:rtl">  احفظ القواعد </h3><br><p style=";text-align:right;direction:rtl">  هذه مجموعة من الخيارات المصممة لحماية التعليمات البرمجية الخاصة بك من Proguard الذي لا يرحم.  تبدو هذه القاعدة في شكلها العام كما يلي: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell"><span class="hljs-literal"><span class="hljs-literal">-keep</span></span> [,<span class="hljs-type"><span class="hljs-type">modifier</span></span>,<span class="hljs-type"><span class="hljs-type">...</span></span>] class_specification</code> </pre> <br><p style=";text-align:right;direction:rtl">  Keep هو الأكثر شيوعًا بين هذه الخيارات (هناك خيارات أخرى) ، حيث يطلب من Proguard إنقاذ الفصل نفسه وجميع أعضاء الفصل: الحقول والأساليب. </p><br><p style=";text-align:right;direction:rtl">  <code>class_specification</code> - قالب يشير إلى الفئة ( <code>class_specification</code> ) أو أجزائها (أعضاء الفصل).  العرض العام للقالب كبير جدًا ، ويمكن مشاهدته <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">التوثيق</a> .  يمكنك الاتصال به ، ولكن بشكل عام ، يمكنك فقط تذكر أن لدينا الفرصة لتكوين قالب من هذه المكونات: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  حدد جميع الفئات باسم معين ، حزمة </li><li style=";text-align:right;direction:rtl">  حدد جميع الفئات التي ترث / تطبق فئات / واجهات معينة </li><li style=";text-align:right;direction:rtl">  حدد جميع الفصول بمعدلات محددة و / أو تعليقات توضيحية محددة </li><li style=";text-align:right;direction:rtl">  حدد جميع الأساليب ذات الاسم المحدد والمعدلات والحجج وقيمة الإرجاع </li><li style=";text-align:right;direction:rtl">  حدد جميع الحقول التي تحمل اسمًا محددًا ومعدلات من نوع معين. </li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  من الممكن استخدام أحرف البدل </p><br><p style=";text-align:right;direction:rtl">  مرة أخرى ، هذا ليس وصفًا صارمًا للقالب ، بل هو قائمة بالميزات التي لدينا.  إليك بعض الأمثلة: </p><br></li></ul><br><p style=";text-align:right;direction:rtl"> <code>-keep public class com.example.MyActivity</code> <br>  حفظ فئة <code>com.example.MyActivity</code> </p><br><p style=";text-align:right;direction:rtl"> <code>-keep public class * extends android.app.Activity</code> <br>  حفظ جميع الفئات العامة التي ترث <code>android.app.Activity</code> </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs scala">-keep public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">*</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">android</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span></span>{ public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>); public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>, android.util.<span class="hljs-type"><span class="hljs-type">AttributeSet</span></span>); public &lt;init&gt;(android.content.<span class="hljs-type"><span class="hljs-type">Context</span></span>, android.util.<span class="hljs-type"><span class="hljs-type">AttributeSet</span></span>, int); public void set*(...); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ابحث عن جميع الفئات العامة التي ترث <code>android.view.View</code> واحفظ 3 <code>android.view.View</code> مع معلمات معينة فيها + جميع الطرق العامة ، باستخدام مُعدِّل <code>void</code> ، أي وسيطات واسم يبدأ <code>set</code> .  يمكن تعديل جميع الأجزاء الأخرى من الفصل. </p><br><p style=";text-align:right;direction:rtl"> <code>-keep class com.habr.** { *; }</code> <br>  حفظ جميع الفئات وجميع محتوياتها في حزمة <code>com.habr</code> </p><br><p style=";text-align:right;direction:rtl">  <code>modifiers</code> - إضافة إلى قاعدة الاحتفاظ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>includedescriptorclasses</code> - بالإضافة إلى الفئة / الطريقة / الحقل المحدد ، تحتاج إلى حفظ جميع الفئات التي تحدث في الواصفات الخاصة بهم. </li><li style=";text-align:right;direction:rtl">  <code>includecode</code> - لا يمكن لمس محتويات الطريقة المشار إليها بهذه القاعدة بالذات. </li><li style=";text-align:right;direction:rtl">  <code>allowshrinking</code> - الفئات التي تشير إليها هذه القاعدة ليست بذورًا ويمكن حذفها ، ولكن فقط إذا لم يتم استخدامها في البرنامج نفسه.  ومع ذلك ، إذا بقيت هذه الشفرة بعد إعادة التشفير (بسبب حقيقة أن شخصًا ما يستخدمها) ، فمن المستحيل تحسين / تشويش هذا الرمز. </li><li style=";text-align:right;direction:rtl">  <code>allowoptimization</code> - يمكن تحسين الفئات المشار إليها في هذه القاعدة فقط ، ولكن لا يمكن إزالتها أو التعتيم عليها. </li><li style=";text-align:right;direction:rtl">  <code>allowobfuscation</code> - الفئات التي تشير إليها هذه القاعدة يمكن أن تكون غير <code>allowobfuscation</code> فقط ، ولكن لا يمكن إزالتها أو تحسينها. </li></ul><br><p style=";text-align:right;direction:rtl">  بالإضافة إلى <code>keep</code> ، هناك عدد قليل من الخيارات الأخرى: </p><br><p style=";text-align:right;direction:rtl">  - أعضاء <code>-keepclassmembers</code> - يشير إلى أنه يجب حفظ أعضاء الفصل إذا تم الحفاظ على الفصل نفسه بعد تقليص الشفرة. </p><br><p style=";text-align:right;direction:rtl">  <code>-keepclasseswithmembers</code> - يشير إلى أنك تريد حفظ الفئات التي تقع محتوياتها تحت القالب المحدد.  على سبيل المثال ، <code>-keepclasseswithmembers class * { public &lt;init&gt;(android.content.Context); }</code>  <code>-keepclasseswithmembers class * { public &lt;init&gt;(android.content.Context); }</code> - يحفظ جميع الفئات التي تحتوي على مُنشئ عام مع وسيطة واحدة من نوع <code>Context</code> . </p><br><p style=";text-align:right;direction:rtl">  <code>-keepnames</code> - اختصار لـ <code>-keep,allowshrinking</code> . </p><br><p style=";text-align:right;direction:rtl">  <code>-keepclassmembernames</code> - اختزال لأعضاء <code>-keepclassmembers,allowshrinking</code> . </p><br><p style=";text-align:right;direction:rtl">  <code>keepclasseswithmembernames</code> - اختصار <code>-keepclasseswithmembers,allowshrinking</code> . </p><br><h3 id="optimisation-tuning" style=";text-align:right;direction:rtl">  ضبط التحسين </h3><br><p style=";text-align:right;direction:rtl">  الخيار الأكثر أهمية هنا هو <code>-dontoptimize</code> flag.  إذا كان موجودًا ، فلن يتم إجراء التحسين وسيتم تجاهل جميع خيارات التحسين الأخرى. </p><br><p style=";text-align:right;direction:rtl">  هناك العديد من خيارات التحسين ، ولكن ما يلي أكثر فائدة لي: </p><br><p style=";text-align:right;direction:rtl">  <code>-optimizations optimization_filter</code> - سرد جميع الطرق التي تريد استخدامها.  من الأفضل استخدام المجموعة المحددة في <code>proguard-android-optimize.txt</code> أو مجموعة فرعية منها.  يمكن العثور على قائمة بجميع التحسينات <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> . </p><br><p style=";text-align:right;direction:rtl">  <code>-optimizationpasses n</code> - عدد دورات التحسين.  يمكن لعدة دورات تحسين النتيجة.  في الوقت نفسه ، يعد Proguard ذكيًا بما يكفي لإيقاف الدورات إذا رأى أن النتيجة لم تتحسن منذ آخر مرة. </p><br><p style=";text-align:right;direction:rtl">  <code>-assumenosideeffects class_specification</code> - يشير إلى أن هذه الطريقة ليس لها أي آثار جانبية وتعيد فقط بعض القيمة.  سيحذف برنامج Proguard المكالمات إلى هذه الطريقة إذا اكتشف عدم استخدام النتيجة التي تُرجعها.  ربما يكون الاستخدام الأكثر شيوعًا لهذا الخيار هو حذف جميع سجلات التصحيح: <code>-assumenosideeffects class android.util.Log { public static int d(...); }</code> <code>-assumenosideeffects class android.util.Log { public static int d(...); }</code> </p><br><p style=";text-align:right;direction:rtl">  <code>-allowaccessmodification</code> - إظهار كل ما هو مخفي :) خيار رائع يسمح لك بالتخلص من مجموعة من الموصلات الاصطناعية للفئات المتداخلة.  يعمل فقط بالاقتران مع <code>-repackageclasses</code> </p><br><p style=";text-align:right;direction:rtl">  <code>-repackageclasses</code> - <code>-repackageclasses</code> بنقل جميع الفئات إلى حزمة واحدة محددة.  هذا ينطبق أكثر على التعتيم ، ولكن في نفس الوقت ، يعطي نتائج جيدة في التحسين. </p><br><h3 id="prochie-poleznye-opcii" style=";text-align:right;direction:rtl">  خيارات مفيدة أخرى </h3><br><p style=";text-align:right;direction:rtl">  <code>-dontwarn</code> و <code>-dontnote</code> </p><br><p style=";text-align:right;direction:rtl">  برنامج Proguard ذكي جدًا ويبلغ دائمًا عن الأماكن المشبوهة أثناء تحليل الشفرة ، وأحيانًا تكون هذه ملاحظات وأحيانًا تحذيرات.  إذا لم يكن جهازك قيد التشغيل مع تشغيل Proguard ، فتأكد من قراءة جميع السجلات التي ينتجها ، وسوف يكتب ما حدث من الخطأ ، وعلى الأرجح ، حتى يخبرك بكيفية إصلاحه.  بعد قراءة جميع الرسائل ، يمكنك إما إصلاح المشكلة أو تجاهل رسالة أحد هذه الخيارات إذا كنت متأكدًا من عدم وجود مشكلة. </p><br><p style=";text-align:right;direction:rtl">  على سبيل المثال ، يحدث أن بعض مكتبات جافا تستخدم فئات النظام الأساسي غير الموجودة في android.jar وسوف يحذر Proguard من ذلك.  إذا كنت متأكدًا من أن هذه المكتبة تعمل بشكل جيد في بيئة Android ، فيمكنك إيقاف تشغيل هذا التحذير <code>-dontwarn java.lang.management.**</code> </p><br><p style=";text-align:right;direction:rtl">  <code>-whyareyoukeeping class_specification</code> هو خيار مفيد سيطبع سبب قرار Proguard بعدم لمس هذه الفئة / الطريقة. </p><br><p style=";text-align:right;direction:rtl">  <code>-verbose</code> - طباعة سجلات واستثناءات أكثر تفصيلاً </p><br><p style=";text-align:right;direction:rtl">  <code>-printconfiguration</code> - طباعة قائمة كاملة بالخيارات من جميع ملفات التكوين التي تم استخدامها ، بما في ذلك القواعد من المكتبات والتي تم إنشاؤها من خلال aapt. </p><br><p style=";text-align:right;direction:rtl">  <code>-keepattributes SourceFile, LineNumberTable</code> - يحفظ المعلومات الوصفية (أسماء الملفات ، ترقيم الأسطر) لتتمكن من تصحيح التعليمات البرمجية في IDE والحصول على تكديس ذي معنى.  تأكد من إضافة هذا الخيار. </p><br><h3 id="praktika" style=";text-align:right;direction:rtl">  تدرب </h3><br><p style=";text-align:right;direction:rtl">  يحدث هذا عادةً: قم بتشغيل برنامج Proguard ويكسر المشروع بالكامل مع إعطاء الكثير من الأخطاء.  يقوم العديد في هذه الخطوة بإيقاف Proguard ومحاولة عدم العودة إليه.  سأحاول تقديم بعض النصائح لتسهيل عملية الانتقال هذه. </p><br><h4 id="opredelitsya-s-nachalnymi-vhodnymi-tochkami" style=";text-align:right;direction:rtl">  حدد نقاط الدخول المبدئية </h4><br><p style=";text-align:right;direction:rtl">  إذا كنت مطورًا لنظام Android ، فكل شيء أساسي للغاية - ما عليك سوى اختيار أحد <code>proguard-android.txt</code> من Android SDK: <code>proguard-android.txt</code> أو <code>proguard-android-optimize.txt</code> ، <code>proguard-android-optimize.txt</code> بكل شيء يجب أن يظل على حاله. </p><br><h4 id="proverit-vse-biblioteki" style=";text-align:right;direction:rtl">  تحقق من جميع المكتبات </h4><br><p style=";text-align:right;direction:rtl">  في الآونة الأخيرة ، يتم توزيع المزيد والمزيد من المكتبات مع تكوينات proguard الجاهزة.  يمكن أن ينظر Proguard داخل الأرشيف ، والعثور على تكوين المكتبة وإضافته إلى خيارات أخرى.  تحقق من كل مكتبة تستخدمها لمثل هذا التكوين. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/rf/dq/vn/rfdqvnztj-zagmqtzwctc73x3-k.png" alt="(محتويات ملف aar لإحدى المكتبات)"><br>  (محتويات ملف aar لإحدى المكتبات) </p><br><p style=";text-align:right;direction:rtl">  إذا كنت تستخدم خدمات Google Play ، <code>com.google.gms.google-services</code> المكون الإضافي <code>com.google.gms.google-services</code> التكوين الذي تحتاجه بنفسك. </p><br><p style=";text-align:right;direction:rtl">  إذا لم يقم مؤلفو المكتبة بتضمين التكوين في الأرشيف ، فربما اهتموا وكتبوا القواعد على موقعهم على الويب ، أو على صفحة المستودع أو في ملف README.  حاول العثور على التكوين بنفسك لإصدار المكتبة الذي تستخدمه. </p><br><p style=";text-align:right;direction:rtl">  إذا لم تتمكن من العثور على أي قواعد جاهزة في أي مكان ، فسيتعين عليك قراءة السجلات وحل المشكلة بشكل فردي.  على الأرجح ، ستحتاج إلى إضافة قواعد الاحتفاظ لرمز المكتبة المكسور.  أو تجاهل الأخطاء إذا لم تتداخل مع البرنامج. </p><br><h4 id="provesti-inspekciyu-svoego-koda" style=";text-align:right;direction:rtl">  افحص الكود الخاص بك </h4><br><p style=";text-align:right;direction:rtl">  أنت تعرف بشكل أفضل الرمز الذي يمكنك إرساله تحت السكين ، ولكن يجب عليك النظر بعناية في جميع الأماكن التي يتم فيها استخدام الانعكاس على أي حال: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  Class.forName (...) (تعد الوثائق بأن Proguard قادر على تعريف مثل هذا الرمز ، ومع ذلك ، كانت هناك حالات ، يجدر التحقق) </li><li style=";text-align:right;direction:rtl">  النماذج / فئات الكيانات المستخدمة في التسلسل والتخطيط.  جميع الفصول التي تكون أسماء الحقول الخاصة بها (أحيانًا الفصول نفسها) مهمة للاحتفاظ بها (Gson ، RealmIO ، إلخ.) </li><li style=";text-align:right;direction:rtl">  مكالمات المكتبة الأصلية من خلال JNI </li></ul><br><h4 id="testy" style=";text-align:right;direction:rtl">  الاختبارات </h4><br><p style=";text-align:right;direction:rtl">  إذا تم استخدام فئة / طريقة فقط في الاختبارات وليس في أي مكان آخر ، فسيحذف Proguard هذا الرمز.  هذا موقف شائع إذا كان لديك TDD :) في هذه الحالة ، لدي تكوين منفصل ، حيث أقوم بإضافة فئات لم يتم دمجها بعد في المشروع ، ولا يتم استخدامها في أي مكان ، ولكن يجب اختبارها. </p><br><p style=";text-align:right;direction:rtl">  في Android Gradle Plugin ، بالإضافة إلى تعليمات <code>proguardFiles</code> ، لا يزال هناك <code>testProguardFiles</code> .  هذه التعليمات مطلوبة لتحديد التكوينات التي سيتم تطبيقها على تطبيق الاختبار الذي تم إنشاؤه من أجل اختبار التطبيق الخاص بك عند تشغيل اختبارات الأجهزة.  عادة ما يتم استخدام هذا من أجل تحقيق نفس التحسين / التعتيم في كلا ملفي apk بحيث لا يكون هناك عدم التزامن بينهما.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">رابط</a> </p><br><h4 id="apk-analyzer" style=";text-align:right;direction:rtl">  محلل APK </h4><br><p style=";text-align:right;direction:rtl">  يحتوي Android Studio على مثل هذه الأداة الرائعة.  يمكنك فتحه إما من خلال Find Action -&gt; Analyze APK ، أو عن طريق فتح ملف apk نفسه في Android Studio.  يعرض المحلل الكثير من المعلومات المفيدة ، ولكننا الآن مهتمون بالكود.  لمعرفة ما تم وضعه في النهاية في ملف APK ، تحتاج إلى تحديد ملف <code>classes.dex</code> </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/go/zz/o_/gozzo_o83s3e1mknkxhqldrzr3g.png"></p><br><p style=";text-align:right;direction:rtl">  بشكل افتراضي ، سيظهر لك بالضبط الرمز الناتج الذي اجتاز خطوات التقلص والتحسين.  ومع ذلك ، يمكنك النقر فوق الزر <strong>Load Proguard ... تعيينات</strong> ، إضافة <code>seeds.txt</code> و <code>usage.txt</code> لمشاهدة التعليمات البرمجية التي تم حذفها. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/gy/4a/gk/gy4agkxifirpyy95-exhk1xmguc.png"></p><br><p style=";text-align:right;direction:rtl">  إذا قام Proguard بتعديل الرمز الذي تحتاج إليه لسبب ما ، فابحث عنه في Analyzer وحدد <strong>Generate Proguard Keep Rule من</strong> خلال RMB.  سيُنشئ المحلل خيارًا من عدة خيارات للقواعد ، من الأكثر عامة إلى الأكثر تحديدًا ، حدد <strong>أحدها</strong> . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ny/zc/ob/nyzcobecp45cnrrjgq3unu3_zba.png"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/yq/wg/0m/yqwg0mwllbw9wauhemkvffgk_h8.png"></p><br><h4 id="dlya-avtorov-bibliotek" style=";text-align:right;direction:rtl">  لمؤلفي المكتبة </h4><br><p style=";text-align:right;direction:rtl">  إذا كنت تقوم بإنشاء مكتبة Android ، يمكنك إضافة تكوين proguard لعملائك على النحو التالي: </p><br><pre style=";text-align:right;direction:rtl"> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">buildTypes</span></span> { <span class="hljs-section"><span class="hljs-section">release</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">consumerProguardFiles</span></span> <span class="hljs-string"><span class="hljs-string">'proguard-rules.pro'</span></span> } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  في رأيي ، من الأفضل عدم تحسين مكتبتك والتشويش عليها بحماس ، ولكن لتوفير هذه الفرصة لعملائك.  النغمة الجيدة هي أن تضيف إلى التكوين ما سيظل على العملاء إضافته إذا تضمنوا Proguard.  ومع ذلك ، إذا كنت لا تزال ترغب في إضافة الأمان ، فمن الواضح أنك بحاجة إلى حماية واجهة برمجة التطبيقات الأساسية الخاصة بمكتبتك من Proguard ، بما في ذلك الواصفات والتوقيعات. </p><br><h3 id="r8-dexguard-i-redex" style=";text-align:right;direction:rtl">  R8 و DexGuard و Redex </h3><br><p style=";text-align:right;direction:rtl">  R8 هي أداة جديدة من Google لتحل محل Proguard الحالي.  انتظر ، لا تحاول أن تنسى كل ما قرأته للتو في المقالة ، فقط تعامل معه مثل برنامج Proguard الجديد.  تعد Google بالحفاظ على واجهة برمجة التطبيقات العامة بالكامل ، حتى تعمل جميع التكوينات كما كانت من قبل.  لا يزال المشروع في مرحلة تجريبية ، ولكن يمكنك تجربته بنفسك. </p><br><p style=";text-align:right;direction:rtl">  DexGuard هي أداة مدفوعة الأجر من مطوري Proguard.  يمكن استخدامه معًا أو بدلاً من Proguard.  يمكن القول بأن DexGuard يمكنه القيام بكل ما يمكن لـ Proguard القيام به ، ولكن بشكل أفضل.  للأسف ، لم تتح لي الفرصة لتجربتها ، إذا كان لدى أي شخص خبرة ، يرجى مشاركتها. </p><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Redex</a> هو محسن dex آخر من Facebook.  ويذكر أنه من خلاله يمكنك تحقيق زيادة في الإنتاجية تصل إلى 25٪ وتقليل حجم التطبيق من خلال تطبيق الأداة على الرمز الذي تمت معالجته بالفعل بواسطة Proguard. </p><br><h2 id="vmesto-zaklyucheniya" style=";text-align:right;direction:rtl">  بدلا من الاستنتاج </h2><br><p style=";text-align:right;direction:rtl">  لا تخف من استخدام Proguard ، ولا تكن كسولًا وقضاء بعض الوقت في الإعداد.  سيؤدي ذلك إلى تقليل حجمه وزيادة سرعة العمل من إضافة ولاء المستخدمين.  في نفس الوقت ، حاول إنشاء تكوينات Proguard فعالة ، لا تكتب قواعد "السجاد" ، وإلا سيأتي إليك جيك وارتون الغاضب ويوبخك. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ma/tf/kz/matfkzxceoougdvn7pfyx4klnho.png"></p><br><h2 id="resursy" style=";text-align:right;direction:rtl">  الموارد </h2><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">موقع Proguard</a> .  هناك أيضًا معلومات حول DexGuard. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">قواعد أمثلة مختلفة</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">R8</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تسجيل عرض تقديمي لكيفية عمل Proguard مع DroidCon</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تحتفظ ProGuard الفعالة بقواعد لتطبيقات العروض التقديمية الأصغر (Google I / O '18)</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تعليمات لتمكين وتكوين Proguard لنظام Android</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">صفحة ويكي</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Redex</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar415499/">https://habr.com/ru/post/ar415499/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar415487/index.html">صفحات تاريخ إنتل. الشريحة الأولى ، إنتل 3101</a></li>
<li><a href="../ar415489/index.html">الفيسبوك يغلق مشروع توزيع الإنترنت عن طريق الطائرات بدون طيار على الطاقة الشمسية</a></li>
<li><a href="../ar415493/index.html">أظهر حساب جديد بواسطة معادلة دريك: الإنسانية وحيدا في مجرتها مع احتمال 53-99.6٪</a></li>
<li><a href="../ar415495/index.html">نظام CRM: أداة للأعمال 80 lvl</a></li>
<li><a href="../ar415497/index.html">محرك جامع + Digispark = 50 دولارًا دراجة كهربائية</a></li>
<li><a href="../ar415503/index.html">واجهة مستخدم NetScaler SD-WAN</a></li>
<li><a href="../ar415527/index.html">مؤتمر DUMP 2018: فيديو لجميع التقارير والعروض التقديمية</a></li>
<li><a href="../ar415529/index.html">ملخص أحداث تكنولوجيا المعلومات لشهر يوليو</a></li>
<li><a href="../ar415533/index.html">كتاب "برمجة للأطفال. أول برامج سكراتش الخاصة بي »</a></li>
<li><a href="../ar415535/index.html">العلامة النجمية + AMI + Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>