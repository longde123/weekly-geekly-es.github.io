<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úàÔ∏è ü§∏üèª ‚¨õÔ∏è Zusammensetzung der UIViewController und Navigation zwischen ihnen (und nicht nur) üêπ ü§òüèª üë©‚Äçüé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel m√∂chte ich die Erfahrung teilen, die wir seit mehreren Jahren erfolgreich in unseren iOS-Anwendungen nutzen, von denen sich 3 derzei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zusammensetzung der UIViewController und Navigation zwischen ihnen (und nicht nur)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421097/"><p><img src="https://habrastorage.org/webt/x7/yt/ll/x7ytllwqwgvgxy2rvtmdwj3qkia.png"></p><br><p>  In diesem Artikel m√∂chte ich die Erfahrung teilen, die wir seit mehreren Jahren erfolgreich in unseren iOS-Anwendungen nutzen, von denen sich 3 derzeit im Appstore befinden.  Dieser Ansatz hat gut funktioniert, und wir haben ihn k√ºrzlich vom Rest des Codes getrennt und in eine separate <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RouteComposer-</a> Bibliothek umgewandelt, auf die noch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">n√§her</a> eingegangen wird. </p><a name="habracut"></a><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/ekazaev/route-composer</a> </p><br><p>  Lassen Sie uns zun√§chst herausfinden, was unter der Zusammensetzung von View Controllern in iOS zu verstehen ist. </p><br><p> Bevor ich mit der Erkl√§rung selbst <code>UIViewController</code> ich Sie daran erinnern, dass es in iOS am h√§ufigsten als View Controller oder <code>UIViewController</code> .  Dies ist eine Klasse, die vom Standard- <code>UIViewController</code> geerbt wurde. Dies ist der Basis-MVC-Pattern-Controller, den Apple f√ºr die Entwicklung von iOS-Anwendungen empfiehlt. </p><br><p>  Sie k√∂nnen alternative Architekturmuster wie MVVM, VIP, VIPER verwenden, aber in diesen wird der <code>UIViewController</code> auf die eine oder andere Weise einbezogen, was bedeutet, dass diese Bibliothek mit ihnen verwendet werden kann.  Die Essenz des <code>UIViewController</code> verwendet, um das <code>UIView</code> zu steuern, das am h√§ufigsten einen Bildschirm oder einen wesentlichen Teil des Bildschirms darstellt, Ereignisse daraus verarbeitet und einige Daten darin anzeigt. </p><br><p><img src="https://habrastorage.org/webt/5v/ia/-3/5via-37-mfc9leww-hwfvcu20eg.png"></p><br><p>  Alle <code>UIViewController</code> k√∂nnen bedingt in <strong>Normal View Controller unterteilt werden</strong> , die f√ºr einen sichtbaren Bereich auf dem Bildschirm verantwortlich sind, und <strong>Container View Controller</strong> , die neben sich selbst und einigen ihrer Steuerelemente auch auf die eine oder andere Weise in sie integrierte <code>UIViewController</code> <strong>View Controller</strong> anzeigen k√∂nnen . </p><br><p>  Zu den mit Cocoa Touch gelieferten Standard-Controllern f√ºr die Containeransicht geh√∂ren: <code>UINavigationConroller</code> , <code>UITabBarController</code> , <code>UISplitController</code> , <code>UIPageController</code> und einige andere.  Au√üerdem kann der Benutzer gem√§√ü den in der Apple-Dokumentation beschriebenen Cocoa Touch-Regeln eigene benutzerdefinierte Controller f√ºr die Containeransicht erstellen. </p><br><p>  Der Prozess der Einf√ºhrung von Standard-View-Controllern in die Container-View-Controller sowie die Integration von View-Controllern in den Controller-Stack werden in diesem Artikel als Zusammensetzung bezeichnet. </p><br><p>  Warum sich dann herausstellte, dass die Standardl√∂sung f√ºr die Zusammensetzung von Ansichtssteuerungen f√ºr uns nicht optimal war, und wir eine Bibliothek entwickelten, die unsere Arbeit erleichtert. </p><br><p>  Schauen wir uns als Beispiel die Zusammensetzung einiger Standard-Controller f√ºr die Containeransicht an: </p><br><h3 id="primery-kompozicii-v-standartnyh-konteynerah">  Beispiele f√ºr die Zusammensetzung in Standardbeh√§ltern </h3><br><h4 id="uinavigationcontroller"> <code>UINavigationController</code> </h4> <br><p><img src="https://habrastorage.org/webt/zx/fc/su/zxfcsucgp6qusx4kkkfccphmzz0.png"></p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> tableViewController = <span class="hljs-type"><span class="hljs-type">UITableViewController</span></span>(style: .plain) <span class="hljs-comment"><span class="hljs-comment">//        let navigationController = UINavigationController(rootViewController: tableViewController) // ... //        let detailViewController = UIViewController(nibName: "DetailViewController", bundle: nil) navigationController.pushViewController(detailViewController, animated: true) // ... //     navigationController.popToRootViewController(animated: true)</span></span></code> </pre> <br><h4 id="uitabbarcontroller"> <code>UITabBarController</code> </h4> <br><p><img src="https://habrastorage.org/webt/vi/2t/bx/vi2tbxjzyl9xs_rhrcpbx9p9lp8.png"></p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstViewController = <span class="hljs-type"><span class="hljs-type">UITableViewController</span></span>(style: .plain) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> secondViewController = <span class="hljs-type"><span class="hljs-type">UIViewController</span></span>() <span class="hljs-comment"><span class="hljs-comment">//   let tabBarController = UITabBarController() //         tabBarController.viewControllers = [firstViewController, secondViewController] //        tabBarController.selectedViewController = secondViewController</span></span></code> </pre> <br><h4 id="uisplitviewcontroller"> <code>UISplitViewController</code> </h4> <br><p><img src="https://habrastorage.org/webt/gs/jx/ll/gsjxllx4rm_tjpukwtawibmffsg.png"></p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstViewController = <span class="hljs-type"><span class="hljs-type">UITableViewController</span></span>(style: .plain) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> secondViewController = <span class="hljs-type"><span class="hljs-type">UIViewController</span></span>() <span class="hljs-comment"><span class="hljs-comment">//   let splitViewController = UISplitViewController() //        splitViewController.viewControllers = [firstViewController] //        splitViewController.showDetailViewController(secondViewController, sender: nil)</span></span></code> </pre> <br><h3 id="primery-integracii-kompozicii-vyu-kotrollerov-v-stek">  Beispiele f√ºr die Integration (Zusammensetzung) von Ansichtscontrollern auf dem Stapel </h3><br><h4 id="ustanovka-vyu-kontrolera-rutom">  Installieren des View Controller-Stamms </h4><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> window: <span class="hljs-type"><span class="hljs-type">UIWindow</span></span> = <span class="hljs-comment"><span class="hljs-comment">//... window.rootViewController = viewController window.makeKeyAndVisible()</span></span></code> </pre> <br><h4 id="modalnaya-prezentaciya-vyu-kontrolera">  Modale Darstellung des View Controllers </h4><br><pre> <code class="swift hljs">window.rootViewController.present(splitViewController, animated: animated, completion: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)</code> </pre> <br><h3 id="pochemu-my-reshili-sozdat-biblioteku-dlya-kompozicii">  Warum wir beschlossen haben, eine Bibliothek f√ºr Kompositionen zu erstellen </h3><br><p>  Wie Sie den obigen Beispielen entnehmen k√∂nnen, gibt es keine einzige M√∂glichkeit, herk√∂mmliche Ansichtssteuerungen in Container zu integrieren, so wie es keine einzige M√∂glichkeit gibt, einen Stapel von Ansichtssteuerungen zu erstellen.  Wenn Sie das Layout Ihrer Anwendung oder die Art und Weise, wie Sie darin navigieren, geringf√ºgig √§ndern m√∂chten, m√ºssen Sie den Anwendungscode erheblich √§ndern. Au√üerdem ben√∂tigen Sie Links zu Containerobjekten, damit Sie Ihre Ansichtssteuerungen in diese einf√ºgen k√∂nnen.  Das hei√üt, die Standardmethode selbst erfordert einen relativ gro√üen Arbeitsaufwand sowie das Vorhandensein von Links zum Anzeigen von Controllern zum Generieren von Aktionen und Pr√§sentationen anderer Controller. </p><br><p>  All dies bereitet den verschiedenen Methoden zum Verkn√ºpfen mit der Anwendung Kopfschmerzen (z. B. mithilfe von Universal-Links), da Sie die Frage beantworten m√ºssen: <em>Was ist, wenn der Controller dem Benutzer angezeigt werden muss, da er bereits auf den Link in der Safari geklickt hat, oder wenn ich den Controller ansehe? Dies sollte zeigen, dass es noch nicht erstellt wurde</em> , und Sie dazu zwingen, durch den Baum der Ansichts-Controller zu gehen und Code zu schreiben, vor dem manchmal Ihre Augen zu bluten beginnen und den jeder iOS-Entwickler zu verbergen versucht.  Im Gegensatz zur Android-Architektur, bei der jeder Bildschirm separat erstellt wird, muss in iOS m√∂glicherweise ein ziemlich gro√üer Stapel von Controllern erstellt werden, der unter dem von Ihnen auf Anfrage angezeigten Controller ausgeblendet wird, um einen Teil der Anwendung unmittelbar nach dem Start anzuzeigen. </p><br><p>  Es w√§re gro√üartig, nur Methoden wie <code>goToAccount()</code> , <code>goToMenu()</code> oder <code>goToProduct(withId: "012345")</code> wenn ein Benutzer auf eine Schaltfl√§che klickt oder wenn eine Anwendung <code>goToProduct(withId: "012345")</code> universellen Link von einer anderen Anwendung <code>goToProduct(withId: "012345")</code> und nicht daran denkt, diesen Ansichtscontroller in den Stapel zu integrieren dass der Ersteller dieses View Controllers diese Implementierung bereits bereitgestellt hat. </p><br><p>  Dar√ºber hinaus bestehen unsere Anwendungen h√§ufig aus einer gro√üen Anzahl von Bildschirmen, die von verschiedenen Teams entwickelt wurden. Um w√§hrend des Entwicklungsprozesses zu einem der Bildschirme zu gelangen, m√ºssen Sie einen anderen Bildschirm durchlaufen, der m√∂glicherweise noch nicht erstellt wurde.  In unserer Firma haben wir den Ansatz verwendet, den wir Petrischale nennen.  Das hei√üt, im Entwicklungsmodus haben Entwickler und Tester Zugriff auf eine Liste aller Anwendungsbildschirme und k√∂nnen zu jedem von ihnen wechseln (nat√ºrlich erfordern einige von ihnen m√∂glicherweise einige Eingabeparameter). </p><br><p><img src="https://habrastorage.org/webt/5l/wx/cv/5lwxcvup0mtdaedrgjsxokbsdti.png"></p><br><p>  Sie k√∂nnen mit ihnen interagieren und einzeln testen und sie dann zur endg√ºltigen Anwendung f√ºr die Produktion zusammenf√ºgen.  Dieser Ansatz erleichtert die Entwicklung erheblich, aber wie Sie aus den obigen Beispielen gesehen haben, beginnt die Kompositionsh√∂lle, wenn Sie den Code auf verschiedene Arten im Code behalten m√ºssen, um den Ansichts-Controller in den Stapel zu integrieren. </p><br><p>  Es bleibt hinzuzuf√ºgen, dass all dies mit N multipliziert wird, sobald Ihr Marketingteam den Wunsch √§u√üert, A / B-Tests an Live-Benutzern durchzuf√ºhren und zu √ºberpr√ºfen, welche Navigationsmethode besser funktioniert, z. B. eine Registerkartenleiste oder ein Hamburger-Men√º. </p><br><ul><li><del>  Lass uns Susanins Beine schneiden </del>  Lassen Sie uns 50% der Benutzer der Registerkartenleiste und des anderen Hamburger-Men√ºs anzeigen. In einem Monat werden wir Ihnen mitteilen, welche Benutzer mehr von unseren Sonderangeboten sehen. </li></ul><br><p>  Ich werde versuchen, Ihnen zu sagen, wie wir die L√∂sung f√ºr dieses Problem angegangen sind und sie schlie√ülich der RouteComposer-Bibliothek zugewiesen haben. </p><br><h3 id="susanin-route-composer"><del>  Susanin </del>  Routenkomponist </h3><br><p>  Nachdem wir alle Kompositions- und Navigationsszenarien analysiert hatten, versuchten wir, den in den obigen Beispielen angegebenen Code zu abstrahieren, und identifizierten drei Hauptentit√§ten, von denen die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RouteComposer-</a> Bibliothek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">arbeitet</a> - <code>Factory</code> , <code>Finder</code> , <code>Action</code> .  Dar√ºber hinaus enth√§lt die Bibliothek drei zus√§tzliche Entit√§ten, die f√ºr eine kleine <code>RoutingInterceptor</code> verantwortlich sind, die m√∂glicherweise w√§hrend des Navigationsprozesses erforderlich ist - <code>RoutingInterceptor</code> , <code>ContextTask</code> , <code>PostRoutingTask</code> .  Alle diese Entit√§ten m√ºssen in einer Kette von Abh√§ngigkeiten konfiguriert und an <code>Router</code> y √ºbertragen werden, das Objekt, das Ihren Controller-Stapel erstellt. </p><br><p>  Aber √ºber jeden von ihnen in der Reihenfolge: </p><br><h4 id="factory">  Fabrik </h4><br><p>  Wie der Name schon sagt, ist <code>Factory</code> f√ºr die Erstellung des View Controllers verantwortlich. </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ViewController</span></span>: <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">Context</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with context: Context)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ViewController</span></span> }</code> </pre> <br><p>  Hier ist es wichtig, Vorbehalte gegen das Konzept des <strong>Kontextes zu machen</strong> .  Den Kontext innerhalb der Bibliothek nennen wir alles, was der Betrachter ben√∂tigt, um erstellt zu werden.  Um beispielsweise einen Ansichts-Controller anzuzeigen, der Produktdetails anzeigt, m√ºssen Sie eine bestimmte Produkt-ID √ºbergeben, z. B. in Form eines Strings.  Die Essenz des Kontexts kann alles sein: ein Objekt, eine Struktur, ein Block oder ein Tupel.  Wenn Ihr Controller zum Erstellen nichts ben√∂tigt, kann der Kontext als <code>Any?</code> angegeben werden <code>Any?</code>  und in <code>nil</code> installieren. </p><br><p>  Zum Beispiel: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductViewControllerFactory</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with productID: UUID)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ProductViewController</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> productViewController = <span class="hljs-type"><span class="hljs-type">ProductViewController</span></span>(nibName: <span class="hljs-string"><span class="hljs-string">"ProductViewController"</span></span>, bundle: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) productViewController.productID = productID <span class="hljs-comment"><span class="hljs-comment">//  ,      `ContextAction`,     return productViewController } }</span></span></code> </pre> <br><p>  Aus der obigen Implementierung wird deutlich, dass diese Factory das Controller-Image aus der XIB-Datei l√§dt und die √ºbertragene Produkt-ID darin installiert.  Zus√§tzlich zum Standard- <code>Factory</code> Protokoll bietet die Bibliothek mehrere Standardimplementierungen dieses Protokolls, um zu verhindern, dass Sie banalen Code schreiben (insbesondere das obige Beispiel). </p><br><p>  Au√üerdem werde ich keine Beschreibungen von Protokollen und Beispiele f√ºr deren Implementierung bereitstellen, da Sie sich mit ihnen im Detail vertraut machen k√∂nnen, indem Sie das mit der Bibliothek gelieferte Beispiel herunterladen.  Es gibt verschiedene Implementierungen von Fabriken f√ºr herk√∂mmliche Ansichtssteuerungen und Container sowie M√∂glichkeiten zu deren Konfiguration. </p><br><h4 id="action">  Aktion </h4><br><p>  Die <code>Action</code> beschreibt, wie ein Ansichtscontroller, der von der Factory erstellt wird, in den Stapel integriert wird.  Der Ansichtscontroller kann nach der Erstellung nicht einfach in der Luft h√§ngen. Daher sollte jede Fabrik eine <code>Action</code> enthalten, wie aus dem obigen Beispiel ersichtlich. </p><br><p>  Die h√§ufigste Implementierung von <code>Action</code> ist die modale Darstellung des Controllers: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PresentModally</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Action</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">perform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(viewController: UIViewController, on existingController: UIViewController, animated: Bool, completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">: ActionResult)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> existingController.presentedViewController == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { completion(.failure(<span class="hljs-string"><span class="hljs-string">"\(existingController) is already presenting a view controller."</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } existingController.present(viewController, animated: animated, completion: { completion(.continueRouting) }) } }</code> </pre> <br><p>  Die Bibliothek enth√§lt die Implementierung der meisten Standardmethoden zum Integrieren von Ansichtscontrollern in den Stapel, und Sie m√ºssen wahrscheinlich erst dann eigene erstellen, wenn Sie eine Art benutzerdefinierten Containeransichtscontroller oder eine Pr√§sentationsmethode verwenden.  Das Erstellen benutzerdefinierter Aktionen sollte jedoch keine Probleme verursachen, wenn Sie die Beispiele lesen. </p><br><h4 id="finder">  Finder </h4><br><p>  Die Essenz von <code>Finder</code> beantwortet den Router auf die Frage <em>: Ist ein solcher Controller bereits erstellt und befindet er sich bereits auf dem Stapel?</em>  <em>Vielleicht muss nichts erstellt werden und es reicht zu zeigen, was bereits da ist?</em>  . </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Finder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ViewController</span></span>: <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">Context</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findViewController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with context: Context)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ViewController?</span></span> }</code> </pre> <br><p>  Wenn Sie Links zu allen von Ihnen erstellten Ansichtscontrollern speichern, k√∂nnen Sie in Ihrer <code>Finder</code> Implementierung einfach einen Link zum gew√ºnschten Ansichtscontroller zur√ºckgeben.  Meistens ist dies jedoch nicht der Fall, da sich der Anwendungsstapel, insbesondere wenn er gro√ü ist, sehr dynamisch √§ndert.  Dar√ºber hinaus k√∂nnen mehrere identische Ansichtscontroller auf dem Stapel unterschiedliche Entit√§ten anzeigen (z. B. mehrere ProductViewController, die unterschiedliche Produkte mit unterschiedlichen Produkt-IDs anzeigen). Daher erfordert die <code>Finder</code> Implementierung m√∂glicherweise eine benutzerdefinierte Implementierung und die Suche nach dem entsprechenden Ansichtscontroller auf dem Stapel.  Die Bibliothek erleichtert diese Aufgabe, indem sie den <code>StackIteratingFinder</code> als Erweiterung des <code>Finder</code> <code>StackIteratingFinder</code> , ein Protokoll mit den entsprechenden Einstellungen, um diese Aufgabe zu vereinfachen.  Bei der Implementierung von <code>StackIteratingFinder</code> Sie nur die Frage beantworten: <code>StackIteratingFinder</code> dieser Ansichts-Controller derjenige, nach dem der Router auf Ihre Anfrage sucht <code>StackIteratingFinder</code> </p><br><p>  Ein Beispiel f√ºr eine solche Implementierung: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductViewControllerFinder</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StackIteratingFinder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> options: <span class="hljs-type"><span class="hljs-type">SearchOptions</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(options: <span class="hljs-type"><span class="hljs-type">SearchOptions</span></span> = .currentAndUp) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.options = options } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isTarget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> productViewController: ProductViewController, with productID: UUID)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productViewController.productID == productID } }</code> </pre> <br><h3 id="vspomogatelnye-suschnosti">  Helferentit√§ten </h3><br><h4 id="routinginterceptor"> <code>RoutingInterceptor</code> </h4> <br><p>  <code>RoutingInterceptor</code> k√∂nnen Sie einige Aktionen ausf√ºhren, bevor Sie mit der Komposition von Ansichtscontrollern beginnen, und dem Router mitteilen, ob es m√∂glich ist, Ansichtscontroller in den Stapel zu integrieren.  Das h√§ufigste Beispiel f√ºr eine solche Aufgabe ist die Authentifizierung (in der Implementierung jedoch √ºberhaupt nicht √ºblich).  Sie m√∂chten beispielsweise einen Ansichtscontroller mit den Details eines Benutzerkontos anzeigen, daf√ºr muss der Benutzer jedoch am System angemeldet sein.  Sie k√∂nnen einen <code>RoutingInterceptor</code> implementieren und zur Konfiguration der Ansicht des Benutzerdetail-Controllers und der <code>RoutingInterceptor</code> hinzuf√ºgen: Wenn der Benutzer angemeldet ist, lassen Sie den Router die Navigation fortsetzen. Wenn nicht, zeigen Sie den View-Controller an, der den Benutzer zur Anmeldung auffordert. Wenn diese Aktion erfolgreich ist, lassen Sie den Router die Navigation fortsetzen oder abbrechen sie, wenn der Benutzer sich weigert, sich anzumelden. </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginInterceptor</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoutingInterceptor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> destination: AppDestination, completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">: InterceptorResult)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> !<span class="hljs-type"><span class="hljs-type">LoginManager</span></span>.sharedInstance.isUserLoggedIn <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... //  LoginViewController       completion(.success)  completion(.failure("User has not been logged in.")) // ... return } completion(.success) } }</span></span></code> </pre><br><p>  Eine Implementierung eines solchen <code>RoutingInterceptor</code> mit Kommentaren ist in dem mit der Bibliothek gelieferten Beispiel enthalten. </p><br><h4 id="contexttask"> <code>ContextTask</code> </h4> <br><p>  Die <code>ContextTask</code> , sofern Sie sie bereitstellen, separat auf jeden Ansichtscontroller in der Konfiguration angewendet werden, unabh√§ngig davon, ob sie gerade von einem Router erstellt wurde oder auf dem Stapel gefunden wurde. Sie m√∂chten lediglich die darin enthaltenen Daten aktualisieren und / oder einige Standarddaten festlegen Parameter (z. B. Schaltfl√§che zum Schlie√üen anzeigen oder nicht anzeigen). </p><br><h4 id="postroutingtask"> <code>PostRoutingTask</code> </h4> <br><p>  Die Implementierung von <code>PostRoutingTask</code> wird vom Router nach erfolgreichem Abschluss der Integration des angeforderten View Controllers in den Stack aufgerufen.  Bei der Implementierung ist es bequem, verschiedene Analysen hinzuzuf√ºgen oder verschiedene Dienste abzurufen. </p><br><p>  <strong>Ausf√ºhrlichere Informationen zur Implementierung aller beschriebenen Entit√§ten finden Sie in der Dokumentation zur Bibliothek sowie im beigef√ºgten Beispiel.</strong> </p><br><p>  PS: Die Anzahl der Hilfsentit√§ten, die der Konfiguration hinzugef√ºgt werden k√∂nnen, ist nicht begrenzt. </p><br><h3 id="konfiguraciya">  Konfiguration </h3><br><p>  Alle beschriebenen Entit√§ten sind insofern gut, als sie den Kompositionsprozess in kleine, austauschbare und vertrauensw√ºrdige Bl√∂cke aufteilen. </p><br><p>  Kommen wir nun zum Wichtigsten - zur Konfiguration, dh zur Verbindung dieser Bl√∂cke miteinander.  Um diese Bl√∂cke untereinander zu sammeln und zu einer Kette von Schritten zu kombinieren, bietet die Bibliothek eine Builder-Klasse <code>StepAssembly</code> (f√ºr Container - <code>ContainerStepAssembly</code> ).  Mit seiner Implementierung k√∂nnen Sie die Kompositionsbl√∂cke wie Perlen auf einer Zeichenfolge in ein einzelnes Konfigurationsobjekt einf√ºgen und die Abh√§ngigkeiten von den Konfigurationen anderer Ansichtssteuerungen angeben.  Was in Zukunft mit der Konfiguration zu tun ist, liegt bei Ihnen.  Sie k√∂nnen es dem Router mit den erforderlichen Parametern zuf√ºhren und es wird ein Stapel von Controllern f√ºr Sie erstellt. Sie k√∂nnen es im W√∂rterbuch speichern und sp√§ter per Schl√ºssel verwenden - dies h√§ngt von Ihrer spezifischen Aufgabe ab. </p><br><p>  Stellen Sie sich ein triviales Beispiel vor: Angenommen, durch Klicken auf eine Zelle in der Liste oder wenn die Anwendung einen universellen Link von einem Safari- oder E-Mail-Client erh√§lt, m√ºssen wir den Produktcontroller mit einer bestimmten Produkt-ID modal anzeigen.  In diesem Fall muss der Produktcontroller in den <code>UINavigationController</code> damit er seinen Namen und die Schaltfl√§che zum Schlie√üen auf dem Bedienfeld <code>UINavigationController</code> kann.  Dar√ºber hinaus kann dieses Produkt nur angemeldeten Benutzern angezeigt werden. Andernfalls laden Sie sie zur Anmeldung ein. </p><br><p>  Wenn Sie dieses Beispiel analysieren, ohne eine Bibliothek zu verwenden, sieht es ungef√§hr so ‚Äã‚Äãaus: </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductArrayViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> products: [<span class="hljs-type"><span class="hljs-type">UUID</span></span>]? <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> analyticsManager = <span class="hljs-type"><span class="hljs-type">AnalyticsManager</span></span>.sharedInstance <span class="hljs-comment"><span class="hljs-comment">//  UITableViewControllerDelegate override func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) { guard let productID = products[indexPath.row] else { return } //   LoginInterceptor guard !LoginManager.sharedInstance.isUserLoggedIn else { //    LoginViewController         `showProduct(with: productID)` return } showProduct(with: productID) } func showProduct(with productID: String) { //   ProductViewControllerFactory let productViewController = ProductViewController(nibName: "ProductViewController", bundle: nil) //   ProductViewControllerContextTask productViewController.productID = productID //   NavigationControllerStep  PushToNavigationAction let navigationController = UINavigationController(rootViewController: productViewController) //   GenericActions.PresentModally present(alertController, animated: navigationController) { [weak self]   . ProductViewControllerPostTask self?.analyticsManager.trackProductView(productID: productID) } } }</span></span></code> </pre> <br><p>  Dieses Beispiel beinhaltet nicht die Implementierung universeller Links, die das Isolieren des Autorisierungscodes und das Beibehalten des Kontexts erfordern, nach dem der Benutzer geleitet werden soll, sowie das Suchen, wenn der Benutzer pl√∂tzlich auf einen Link klickt, und dieses Produkt wird ihm bereits gezeigt, was den Code letztendlich sehr macht schwer zu lesen. </p><br><p>  <strong>Betrachten Sie die Konfiguration dieses Beispiels mithilfe der Bibliothek:</strong> </p><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> productScreen = <span class="hljs-type"><span class="hljs-type">StepAssembly</span></span>(finder: <span class="hljs-type"><span class="hljs-type">ProductViewControllerFinder</span></span>(), factory: <span class="hljs-type"><span class="hljs-type">ProductViewControllerFactory</span></span>()) <span class="hljs-comment"><span class="hljs-comment">//  : .adding(LoginInterceptor()) .adding(ProductViewControllerContextTask()) .adding(ProductViewControllerPostTask(analyticsManager: AnalyticsManager.sharedInstance)) //  : .using(PushToNavigationAction()) .from(NavigationControllerStep()) // NavigationControllerStep -&gt; StepAssembly(finder: NilFinder(), factory: NavigationControllerFactory()) .using(GeneralAction.presentModally()) .from(GeneralStep.current()) .assemble()</span></span></code> </pre> <br><p>  Wenn Sie dies in die menschliche Sprache √ºbersetzen: </p><br><ul><li>  √úberpr√ºfen Sie, ob der Benutzer angemeldet ist, und bieten Sie ihm gegebenenfalls eine Eingabe an </li><li>  Wenn sich der Benutzer erfolgreich angemeldet hat, fahren Sie fort </li><li>  Suchen Sie nach dem von <code>Finder</code> bereitgestellten Product View Controller </li><li>  Wenn es gefunden wurde - sichtbar machen und fertig </li><li>  Wenn es nicht gefunden wurde - erstellen Sie einen <code>UINavigationController</code> , integrieren Sie den von <code>ProductViewControllerFactory</code> mithilfe von <code>ProductViewControllerFactory</code> erstellten View Controller in ihn </li><li>  <code>GenericActions.PresentModally</code> <code>UINavigationController</code> mit <code>GenericActions.PresentModally</code> aus dem aktuellen Ansichtscontroller ein </li></ul><br><p>  Die Konfiguration erfordert einige Studien, wie viele komplexe L√∂sungen, z. B. das Konzept von <code>AutoLayout</code> und erscheint auf den ersten Blick kompliziert und redundant.  Die Anzahl der Aufgaben, die mit dem angegebenen Codefragment gel√∂st werden m√ºssen, deckt jedoch alle Aspekte von der Autorisierung bis zur Tiefenverkn√ºpfung ab. Durch das Aufteilen in eine Abfolge von Aktionen kann die Konfiguration einfach ge√§ndert werden, ohne dass √Ñnderungen am Code vorgenommen werden m√ºssen.  Dar√ºber hinaus k√∂nnen Sie mit der Implementierung von <code>StepAssembly</code> Probleme mit einer unvollst√§ndigen <code>StepAssembly</code> der <code>StepAssembly</code> vermeiden - Probleme mit der Inkompatibilit√§t von Eingabeparametern f√ºr verschiedene Ansichtssteuerungen. </p><br><p>  Betrachten Sie den Pseudocode einer vollst√§ndigen Anwendung, in der ein <code>ProductArrayViewController</code> eine Liste von Produkten anzeigt. Wenn der Benutzer dieses Produkt ausw√§hlt, wird es angezeigt, je nachdem, ob der Benutzer angemeldet ist oder nicht, oder er bietet an, sich anzumelden, und wird nach erfolgreicher Anmeldung angezeigt: </p><br><p>  <strong>Konfigurationsobjekte</strong> </p><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">// `RoutingDestination`    .          . struct AppDestination: RoutingDestination { let finalStep: RoutingStep let context: Any? } struct Configuration { //     ,             static func productDestination(with productID: UUID) -&gt; AppDestination { let productScreen = StepAssembly(finder: ProductViewControllerFinder(), factory: ProductViewControllerFactory()) .add(LoginInterceptor()) .add(ProductViewControllerContextTask()) .add(ProductViewControllerPostTask(analyticsManager: AnalyticsManager.sharedInstance)) .using(PushToNavigationAction()) .from(NavigationControllerStep()) .using(GenericActions.PresentModally()) .from(CurrentControllerStep()) .assemble() return AppDestination(finalStep: productScreen, context: productID) } }</span></span></code> </pre> <br><p> <strong>  </strong> </p><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductArrayViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> products: [<span class="hljs-type"><span class="hljs-type">UUID</span></span>]? <span class="hljs-comment"><span class="hljs-comment">//... // DefaultRouter -  Router   ,   UIViewController   let router = DefaultRouter() override func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) { guard let productID = products[indexPath.row] else { return } router.navigate(to: Configuration.productDestination(with: productID)) } }</span></span></code> </pre> <br><p> <strong>  </strong> </p><br><pre> <code class="swift hljs"><span class="hljs-meta"><span class="hljs-meta">@UIApplicationMain</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppDelegate</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIResponder</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIApplicationDelegate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... func application(_ application: UIApplication, open url: URL, sourceApplication: String?, annotation: Any) -&gt; Bool { guard let productID = UniversalLinksManager.parse(url: url) else { return false } return DefaultRouter().navigate(to: Configuration.productDestination(with: productID)) == .handled } }</span></span></code> </pre><br><p>              . </p><br><p>             . ,          , ,           ‚Äî       ProductArrayViewController,      UINavigationController   HomeViewController ‚Äî         <code>StepAssembly</code>  <code>from()</code> .     <code>RouteComposer</code> ,      (     ).  ,      <code>Configuration</code>               .     ,      A/B ,         . </p><br><h3 id="vmesto-zaklyucheniya">  Anstelle einer Schlussfolgerung </h3><br><p>   ,      3       .     ,  ,       .   <code>Fabric</code> , <code>Finder</code>  <code>Action</code>            .   ,     ‚Äî              ,    ,       .          ,      . </p><br><p> ,      ,      objective c       Cocoa Touch,             .     iOS  9  12. </p><br><p>            <code>UIViewController</code>  (MVC, MVVM, VIP, RIB, VIPER  ..) </p><br><p>      ,   ,     ,   .         .            . </p><br><p>      . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de421097/">https://habr.com/ru/post/de421097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de421087/index.html">So richten Sie die Bereitstellung von Webanwendungen unter Go for Gitlab auf VDS ein</a></li>
<li><a href="../de421089/index.html">Russische Anbieter haben herausgefunden, wie ein Teil der Kosten des ‚ÄûFr√ºhlingspakets‚Äú an Google √ºbertragen werden kann.</a></li>
<li><a href="../de421091/index.html">Wie wir die Zeit f√ºr die Entwicklung von Bewertungsmodellen f√ºnfmal verk√ºrzt haben, indem wir zu Python gewechselt sind</a></li>
<li><a href="../de421093/index.html">Wie ich Spring Framework studiere - Teil 2 (Hilfe f√ºr Anf√§nger - die Arbeit der Anf√§nger selbst)</a></li>
<li><a href="../de421095/index.html">Unter dem neuen Gesetzentwurf zur Sperrung vor dem Prozess k√∂nnten 19 Millionen Standorte fallen</a></li>
<li><a href="../de421099/index.html">Ist es schwer sich zu konzentrieren? Vielleicht ist es nicht deine Schuld</a></li>
<li><a href="../de421101/index.html">"Testerkalender" f√ºr August. Lies ein Buch</a></li>
<li><a href="../de421103/index.html">Schauen Sie sich zuerst den Mavic 2 an: Fliegen Sie l√§nger, leiser, schneller</a></li>
<li><a href="../de421105/index.html">Situation: Spotify macht direkte Gesch√§fte mit Musikern - Labels sind ungl√ºcklich</a></li>
<li><a href="../de421107/index.html">Wir zerlegen und zeigen qualifizierte Zertifikate mit Python / Tkinter an</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>