<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ»â€ğŸ“ ğŸ£ ğŸ˜‰ Flutteråº”ç”¨ç¨‹åºæ¶æ„åŸºç¡€ï¼šé¦™è‰ï¼ŒèŒƒå›´æ¨¡å‹ï¼ŒBLoC ğŸšµğŸ½ ğŸ‘ƒğŸ¼ ğŸš‹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ï¼ˆåŸå§‹æ–‡ç« ä»¥è‹±æ–‡åœ¨Mediumä¸Šå‘è¡¨ï¼‰ 


 Flutteræä¾›äº†ä¸€ä¸ªç°ä»£çš„å“åº”æ¡†æ¶ï¼Œå¤§é‡çš„å°éƒ¨ä»¶å’Œå·¥å…·ã€‚ ä½†æ˜¯ï¼Œä¸å¹¸çš„æ˜¯ï¼Œæ–‡æ¡£ä¸Androidåº”ç”¨ç¨‹åºçš„æ¨èä½“ç³»ç»“æ„æŒ‡å—å®Œå…¨ä¸åŒ ã€‚ 


 æ²¡æœ‰ç†æƒ³çš„é€šç”¨ä½“ç³»ç»“æ„å¯ä»¥æ»¡è¶³æŠ€æœ¯ä»»åŠ¡çš„ä»»ä½•å¯èƒ½çš„è¦æ±‚ï¼Œä½†è®©æˆ‘ä»¬æ‰¿è®¤ï¼Œæˆ‘ä»¬æ­£åœ¨ç ”ç©¶çš„å¤§å¤šæ•°ç§»åŠ¨åº”ç”¨ç¨‹åºéƒ½å…·...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Flutteråº”ç”¨ç¨‹åºæ¶æ„åŸºç¡€ï¼šé¦™è‰ï¼ŒèŒƒå›´æ¨¡å‹ï¼ŒBLoC</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438574/"><p><img src="https://habrastorage.org/webt/2j/2p/yu/2j2pyudr-kde4fqeczqoic_9lpq.png"></p><br><p>  ï¼ˆåŸå§‹æ–‡ç« ä»¥è‹±æ–‡åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Medium</a>ä¸Šå‘è¡¨ï¼‰ </p><br><p>  Flutteræä¾›äº†ä¸€ä¸ªç°ä»£çš„å“åº”æ¡†æ¶ï¼Œå¤§é‡çš„å°éƒ¨ä»¶å’Œå·¥å…·ã€‚ ä½†æ˜¯ï¼Œä¸å¹¸çš„æ˜¯ï¼Œæ–‡æ¡£<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸Androidåº”ç”¨ç¨‹åºçš„æ¨èä½“ç³»ç»“æ„æŒ‡å—å®Œå…¨ä¸åŒ</a> ã€‚ </p><br><p> æ²¡æœ‰ç†æƒ³çš„é€šç”¨ä½“ç³»ç»“æ„å¯ä»¥æ»¡è¶³æŠ€æœ¯ä»»åŠ¡çš„ä»»ä½•å¯èƒ½çš„è¦æ±‚ï¼Œä½†è®©æˆ‘ä»¬æ‰¿è®¤ï¼Œæˆ‘ä»¬æ­£åœ¨ç ”ç©¶çš„å¤§å¤šæ•°ç§»åŠ¨åº”ç”¨ç¨‹åºéƒ½å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š </p><br><ol><li> è¯·æ±‚å’Œä¸‹è½½æ•°æ®ã€‚ </li><li> ä¸ºç”¨æˆ·è½¬æ¢å’Œå‡†å¤‡æ•°æ®ã€‚ </li><li> ä»æ•°æ®åº“æˆ–æ–‡ä»¶ç³»ç»Ÿå†™å…¥å’Œè¯»å–æ•°æ®ã€‚ </li></ol><br><p>è€ƒè™‘åˆ°æ‰€æœ‰è¿™äº›ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ¼”ç¤ºåº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºä½¿ç”¨ä¸åŒçš„ä½“ç³»ç»“æ„æ–¹æ³•è§£å†³äº†ç›¸åŒçš„é—®é¢˜ã€‚ <a name="habracut"></a></p><br><p> æœ€åˆï¼Œæ˜¾ç¤ºç»™ç”¨æˆ·çš„å±å¹•æ˜¯ä½äºä¸­å¿ƒçš„â€œåŠ è½½ç”¨æˆ·æ•°æ®â€æŒ‰é’®ã€‚ å½“ç”¨æˆ·å•å‡»æŒ‰é’®æ—¶ï¼Œå°†è¿›è¡Œå¼‚æ­¥æ•°æ®åŠ è½½ï¼Œå¹¶ä¸”è¯¥æŒ‰é’®å°†è¢«åŠ è½½æŒ‡ç¤ºå™¨æ›¿æ¢ã€‚ æ•°æ®ä¸‹è½½å®Œæˆåï¼Œä¸‹è½½æŒ‡ç¤ºç¬¦å°†æ›¿æ¢ä¸ºæ•°æ®ã€‚ </p><br><p> å› æ­¤ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚ </p><br><p><img src="https://habrastorage.org/webt/c5/by/8g/c5by8gjmz_oov-ukuy4_dwo4njs.gif"></p><br><h2 id="dannye"> èµ„æ–™ </h2><br><p>ä¸ºäº†ç®€åŒ–ä»»åŠ¡ï¼Œæˆ‘åˆ›å»ºäº†<code>Repository</code>ç±»ï¼Œå…¶ä¸­åŒ…å«<code>getUser()</code>æ–¹æ³•ã€‚ æ­¤æ–¹æ³•æ¨¡æ‹Ÿä»ç½‘ç»œå¼‚æ­¥åŠ è½½æ•°æ®å¹¶è¿”å›<code>Future&lt;User&gt;</code> ã€‚ </p><br><p> å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰Dartä¸­çš„Futureså’Œå¼‚æ­¥ç¼–ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨è¿™é‡Œ</a>é˜…è¯»æ›´å¤šä¿¡æ¯ï¼Œå¹¶é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Futureç±»</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£</a> ã€‚ </p><br><pre> <code class="plaintext hljs">class Repository { Future&lt;User&gt; getUser() async { await Future.delayed(Duration(seconds: 2)); return User(name: 'John', surname: 'Smith'); } }</code> </pre> <br><pre> <code class="plaintext hljs">class User { User({ @required this.name, @required this.surname, }); final String name; final String surname; }</code> </pre> <br><h2 id="vanilla"> é¦™è‰å‘³ </h2><br><p> è®©æˆ‘ä»¬å¼€å‘è¯¥åº”ç”¨ç¨‹åºï¼Œå°±åƒå¼€å‘äººå‘˜é˜…è¯»å®˜æ–¹ç½‘ç«™ä¸Šçš„Flutteræ–‡æ¡£ä¸€æ ·ã€‚ </p><br><p> ä½¿ç”¨<code>Navigator</code>æ‰“å¼€<code>VanillaScreen</code>å±å¹• </p><br><pre> <code class="plaintext hljs">Navigator.push( context, MaterialPageRoute( builder: (context) =&gt; VanillaScreen(_repository), ), );</code> </pre> <br><p> ç”±äºå°éƒ¨ä»¶çš„çŠ¶æ€åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­å¯èƒ½ä¼šæ›´æ”¹å¤šæ¬¡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç»§æ‰¿è‡ª<code>StatefulWidget</code> ã€‚ è¦å®ç°æ‚¨çš„æœ‰çŠ¶æ€çª—å£å°éƒ¨ä»¶ï¼Œæ‚¨è¿˜éœ€è¦<code>State</code>ç±»ã€‚  <code>_VanillaScreenState</code>ç±»ä¸­çš„<code>bool _isLoading</code>å’Œ<code>User _user</code>å­—æ®µè¡¨ç¤ºå°éƒ¨ä»¶çš„çŠ¶æ€ã€‚ åœ¨é¦–æ¬¡è°ƒç”¨<code>build(BuildContext context)</code>æ–¹æ³•ä¹‹å‰ï¼Œå°†åˆå§‹åŒ–è¿™ä¸¤ä¸ªå­—æ®µã€‚ </p><br><pre> <code class="plaintext hljs">class VanillaScreen extends StatefulWidget { VanillaScreen(this._repository); final Repository _repository; @override State&lt;StatefulWidget&gt; createState() =&gt; _VanillaScreenState(); } class _VanillaScreenState extends State&lt;VanillaScreen&gt; { bool _isLoading = false; User _user; @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar( title: const Text('Vanilla'), ), body: SafeArea( child: _isLoading ? _buildLoading() : _buildBody(), ), ); } Widget _buildBody() { if (_user != null) { return _buildContent(); } else { return _buildInit(); } } Widget _buildInit() { return Center( child: RaisedButton( child: const Text('Load user data'), onPressed: () { setState(() { _isLoading = true; }); widget._repository.getUser().then((user) { setState(() { _user = user; _isLoading = false; }); }); }, ), ); } Widget _buildContent() { return Center( child: Text('Hello ${_user.name} ${_user.surname}'), ); } Widget _buildLoading() { return const Center( child: CircularProgressIndicator(), ); } }</code> </pre> <br><p> åˆ›å»ºçª—å£å°éƒ¨ä»¶çš„çŠ¶æ€å¯¹è±¡ä¹‹åï¼Œå°†è°ƒç”¨<code>build(BuildContext context)</code>æ–¹æ³•æ¥æ„é€ UIã€‚ æœ‰å…³åº”åœ¨å±å¹•ä¸Šæ˜¾ç¤ºå“ªä¸ªçª—å£å°éƒ¨ä»¶çš„æ‰€æœ‰å†³å®šå‡åœ¨UIå£°æ˜ä»£ç ä¸­åšå‡ºã€‚ </p><br><pre> <code class="plaintext hljs">body: SafeArea( child: _isLoading ? _buildLoading() : _buildBody(), )</code> </pre> <br><p> ä¸ºäº†æ˜¾ç¤ºè¿›åº¦æŒ‡ç¤ºå™¨ï¼Œå½“ç”¨æˆ·å•å‡»â€œåŠ è½½ç”¨æˆ·è¯¦ç»†ä¿¡æ¯â€æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚ </p><br><pre> <code class="plaintext hljs">setState(() { _isLoading = true; });</code> </pre> <br><p> ä»æ–‡æ¡£ï¼ˆç¿»è¯‘ï¼‰ä¸­ï¼š </p><br><blockquote> è°ƒç”¨setStateï¼ˆï¼‰æ–¹æ³•ä¼šé€šçŸ¥æ¡†æ¶æ­¤å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€å·²æ›´æ”¹ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå½±å“å­æ ‘ä¸­çš„ç”¨æˆ·ç•Œé¢ã€‚ è¿™å°±æ˜¯æ¡†æ¶åœ¨æ­¤çŠ¶æ€å¯¹è±¡ä¸Šè°ƒç”¨buildæ–¹æ³•çš„åŸå› ã€‚ </blockquote><p> è¿™æ„å‘³ç€åœ¨è°ƒç”¨<code>setState()</code>æ–¹æ³•ä¹‹åï¼Œæ¡†æ¶å°†å†æ¬¡è°ƒç”¨<code>build(BuildContext context)</code>æ–¹æ³•ï¼Œè¿™å°†<strong>é‡æ–°åˆ›å»ºæ•´ä¸ªå°éƒ¨ä»¶æ ‘</strong> ã€‚ ç”±äº<code>_isLoading</code>å­—æ®µçš„å€¼<code>_isLoading</code>æ›´æ”¹ä¸º<code>true</code> ï¼Œè€Œä¸æ˜¯<code>_buildBody()</code>æ–¹æ³•ï¼Œå› æ­¤å°†è°ƒç”¨<code>_buildBody()</code>æ–¹æ³•ï¼Œå¹¶ä¸”è¿›åº¦æŒ‡ç¤ºå™¨å°†æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ <br> å½“æˆ‘ä»¬ä»<code>getUser()</code>è·å¾—å›è°ƒå¹¶è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼šå‘ç”Ÿå®Œå…¨ç›¸åŒçš„äº‹æƒ…ã€‚ <br>  <code>setState()</code>å°†æ–°å€¼åˆ†é…ç»™<code>_isLoading</code>å’Œ<code>_user</code>å­—æ®µã€‚ </p><br><pre> <code class="plaintext hljs">widget._repository.getUser().then((user) { setState(() { _user = user; _isLoading = false; }); });</code> </pre> <br><h3 id="plyusy"> ä¼˜ç‚¹ </h3><br><ol><li> ä½è¿›å…¥é—¨æ§›ã€‚ </li><li> æ— éœ€ç¬¬ä¸‰æ–¹åº“ã€‚ </li></ol><br><h3 id="minusy"> ç¼ºç‚¹ </h3><br><ol><li> å½“å°éƒ¨ä»¶çš„çŠ¶æ€æ›´æ”¹æ—¶ï¼Œæ¯æ¬¡éƒ½ä¼šå®Œå…¨é‡æ–°åˆ›å»ºå°éƒ¨ä»¶æ ‘ã€‚ </li><li> è¿åå”¯ä¸€è´£ä»»åŸåˆ™ã€‚ å°éƒ¨ä»¶ä¸ä»…è´Ÿè´£åˆ›å»ºUIï¼Œè¿˜è´Ÿè´£åŠ è½½æ•°æ®ï¼Œä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€ç®¡ç†ã€‚ </li><li> æœ‰å…³å¦‚ä½•æ˜¾ç¤ºå½“å‰çŠ¶æ€çš„å†³å®šç›´æ¥åœ¨UIä»£ç ä¸­åšå‡ºã€‚ å¦‚æœçŠ¶æ€å˜å¾—æ›´åŠ å¤æ‚ï¼Œåˆ™ä»£ç çš„å¯è¯»æ€§å°†å¤§å¤§é™ä½ã€‚ </li></ol><br><h2 id="scoped-model"> èŒƒå›´æ¨¡å‹ </h2><br><p> èŒƒå›´æ¨¡å‹æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸‰æ–¹åº“</a> ã€‚ è¿™æ˜¯å¼€å‘äººå‘˜çš„æè¿°æ–¹å¼ï¼š </p><br><blockquote> ä¸€ç»„å®ç”¨ç¨‹åºï¼Œå¯è®©æ‚¨å°†ç¥–å…ˆçª—å£å°éƒ¨ä»¶çš„æ•°æ®æ¨¡å‹ä¼ è¾“åˆ°å…¶æ‰€æœ‰åä»£ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œå½“æ¨¡å‹æ•°æ®æ›´æ”¹æ—¶ï¼Œå°†é‡æ–°åˆ›å»ºæ‰€æœ‰ä½¿ç”¨è¯¥æ¨¡å‹çš„åä»£ã€‚ è¯¥åº“æœ€åˆå–è‡ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Fuchsia</a>é¡¹ç›®ä»£ç ã€‚ </blockquote><p> è®©æˆ‘ä»¬åˆ›å»ºä¸ä¸Šä¸€ä¸ªç¤ºä¾‹ç›¸åŒçš„å±å¹•ï¼Œä½†æ˜¯ä½¿ç”¨èŒƒå›´æ¨¡å‹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°†èŒƒå›´æ¨¡å‹åº“æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚ åœ¨â€œ <code>dependencies</code>éƒ¨åˆ†ä¸­ï¼Œå°†<code>scoped_model</code>ä¾èµ–é¡¹æ·»åŠ åˆ°<code>scoped_model</code>æ–‡ä»¶ä¸­ã€‚ </p><br><pre> <code class="plaintext hljs">scoped_model: ^1.0.1</code> </pre> <br><p> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>UserModelScreen</code>ä»£ç ï¼Œå¹¶å°†å…¶ä¸å‰é¢çš„ç¤ºä¾‹è¿›è¡Œæ¯”è¾ƒï¼Œåœ¨è¯¥ç¤ºä¾‹ä¸­æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨èŒƒå›´æ¨¡å‹ã€‚ ä¸ºäº†ä½¿æ¨¡å‹å¯¹çª—å£å°éƒ¨ä»¶çš„åä»£å¯è®¿é—®ï¼Œæˆ‘ä»¬éœ€è¦å°†çª—å£å°éƒ¨ä»¶å’Œæ¨¡å‹åŒ…è£…åœ¨<code>ScopedModel</code> ã€‚ </p><br><pre> <code class="plaintext hljs">class UserModelScreen extends StatefulWidget { UserModelScreen(this._repository); final Repository _repository; @override State&lt;StatefulWidget&gt; createState() =&gt; _UserModelScreenState(); } class _UserModelScreenState extends State&lt;UserModelScreen&gt; { UserModel _userModel; @override void initState() { _userModel = UserModel(widget._repository); super.initState(); } @override Widget build(BuildContext context) { return ScopedModel( model: _userModel, child: Scaffold( appBar: AppBar( title: const Text('Scoped model'), ), body: SafeArea( child: ScopedModelDescendant&lt;UserModel&gt;( builder: (context, child, model) { if (model.isLoading) { return _buildLoading(); } else { if (model.user != null) { return _buildContent(model); } else { return _buildInit(model); } } }, ), ), ), ); } Widget _buildInit(UserModel userModel) { return Center( child: RaisedButton( child: const Text('Load user data'), onPressed: () { userModel.loadUserData(); }, ), ); } Widget _buildContent(UserModel userModel) { return Center( child: Text('Hello ${userModel.user.name} ${userModel.user.surname}'), ); } Widget _buildLoading() { return const Center( child: CircularProgressIndicator(), ); } }</code> </pre> <br><p> åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ¯æ¬¡å°éƒ¨ä»¶æ›´æ”¹çŠ¶æ€æ—¶ï¼Œéƒ½ä¼šå®Œå…¨é‡æ–°åˆ›å»ºå°éƒ¨ä»¶æ ‘ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬çœŸçš„éœ€è¦é‡æ–°åˆ›å»ºæ•´ä¸ªçª—å£å°éƒ¨ä»¶æ ‘ï¼ˆå…¨å±æ˜¾ç¤ºï¼‰å—ï¼Ÿ ä¾‹å¦‚ï¼ŒAppBaræ ¹æœ¬ä¸æ›´æ”¹ï¼Œé‡æ–°åˆ›å»ºå®ƒæ²¡æœ‰æ„ä¹‰ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‚¨åº”è¯¥ä»…é‡æ–°åˆ›å»ºåº”æ ¹æ®çŠ¶æ€æ›´æ”¹è€Œæ›´æ”¹çš„é‚£äº›å°éƒ¨ä»¶ã€‚ èŒƒå›´æ¨¡å‹å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³æ­¤é—®é¢˜ã€‚ </p><br><p>  <code>ScopedModelDescendant&lt;UserModel&gt;</code>å°éƒ¨ä»¶ç”¨äºåœ¨å°éƒ¨ä»¶æ ‘ä¸­æŸ¥æ‰¾<code>UserModel</code> ã€‚ æ¯å½“<code>UserModel</code>é€šçŸ¥å·²å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨é‡æ–°åˆ›å»ºã€‚ </p><br><p> å¦ä¸€ä¸ªæ”¹è¿›æ˜¯<code>UserModelScreen</code>ä¸å†è´Ÿè´£çŠ¶æ€ç®¡ç†ï¼Œä¸šåŠ¡é€»è¾‘å’Œæ•°æ®åŠ è½½ã€‚ </p><br><p> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>UserModel</code>ç±»çš„ä»£ç ã€‚ </p><br><pre> <code class="plaintext hljs">class UserModel extends Model { UserModel(this._repository); final Repository _repository; bool _isLoading = false; User _user; User get user =&gt; _user; bool get isLoading =&gt; _isLoading; void loadUserData() { _isLoading = true; notifyListeners(); _repository.getUser().then((user) { _user = user; _isLoading = false; notifyListeners(); }); } static UserModel of(BuildContext context) =&gt; ScopedModel.of&lt;UserModel&gt;(context); }</code> </pre> <br><p>  <code>UserModel</code>ç°åœ¨åŒ…å«å¹¶ç®¡ç†çŠ¶æ€ã€‚ ä¸ºäº†é€šçŸ¥ä¾¦å¬å™¨ï¼ˆå¹¶é‡æ–°åˆ›å»ºåä»£ï¼‰å‘ç”Ÿäº†æ›´æ”¹ï¼Œå¿…é¡»è°ƒç”¨<code>notifyListeners()</code>æ–¹æ³•ã€‚ </p><br><h3 id="plyusy-1"> ä¼˜ç‚¹ </h3><br><ol><li> çŠ¶æ€ç®¡ç†ï¼Œä¸šåŠ¡é€»è¾‘å’Œæ•°æ®åŠ è½½ä¸UIä»£ç åˆ†å¼€ã€‚ </li><li> ä½è¿›å…¥é—¨æ§›ã€‚ </li></ol><br><h3 id="minusy-1"> ç¼ºç‚¹ </h3><br><ol><li> ç¬¬ä¸‰æ–¹åº“ä¾èµ–é¡¹ã€‚ </li><li> å¦‚æœæ¨¡å‹å˜å¾—è¶³å¤Ÿå¤æ‚ï¼Œé‚£ä¹ˆå¾ˆéš¾è·Ÿè¸ªä½•æ—¶ç¡®å®æœ‰å¿…è¦è°ƒç”¨<code>notifyListeners()</code>æ–¹æ³•ä»¥é¿å…ä¸å¿…è¦çš„é‡æ–°åˆ›å»ºã€‚ </li></ol><br><h2 id="bloc"> ä¿¡ç”¨è¯ </h2><br><p>  BLoCï¼ˆå•†åŠ¡é€»è¾‘ç»„ä»¶ï¼‰æ˜¯Googleå¼€å‘äººå‘˜æ¨èçš„ä¸€ç§æ¨¡å¼ã€‚ æµç”¨äºç®¡ç†çŠ¶æ€å¹¶é€šçŸ¥çŠ¶æ€æ›´æ”¹ã€‚ </p><br><p>  <strong>å¯¹äºAndroidå¼€å‘äººå‘˜ï¼š</strong>æ‚¨å¯ä»¥æƒ³è±¡<code>Bloc</code>æ˜¯<code>ViewModel</code> ï¼Œè€Œ<code>StreamController</code>æ˜¯<code>LiveData</code> ã€‚ ç”±äºæ‚¨å·²ç»ç†Ÿæ‚‰åŸºæœ¬åŸç†ï¼Œå› æ­¤è¿™ä½¿ä»¥ä¸‹ä»£ç æ˜“äºç†è§£ã€‚ </p><br><pre> <code class="plaintext hljs">class UserBloc { UserBloc(this._repository); final Repository _repository; final _userStreamController = StreamController&lt;UserState&gt;(); Stream&lt;UserState&gt; get user =&gt; _userStreamController.stream; void loadUserData() { _userStreamController.sink.add(UserState._userLoading()); _repository.getUser().then((user) { _userStreamController.sink.add(UserState._userData(user)); }); } void dispose() { _userStreamController.close(); } } class UserState { UserState(); factory UserState._userData(User user) = UserDataState; factory UserState._userLoading() = UserLoadingState; } class UserInitState extends UserState {} class UserLoadingState extends UserState {} class UserDataState extends UserState { UserDataState(this.user); final User user; }</code> </pre> <br><p> è¯¥ä»£ç è¡¨æ˜ä¸å†éœ€è¦è°ƒç”¨å…¶ä»–æ–¹æ³•æ¥é€šçŸ¥çŠ¶æ€æ›´æ”¹ã€‚ </p><br><p> æˆ‘åˆ›å»ºäº†3ä¸ªç±»æ¥è¡¨ç¤ºå¯èƒ½çš„çŠ¶æ€ï¼š </p><br><p>  <code>UserInitState</code>ç”¨äºç”¨æˆ·æ‰“å¼€å±å¹•ä¸­å¤®å¸¦æœ‰æŒ‰é’®çš„çŠ¶æ€ã€‚ </p><br><p> æ•°æ®åŠ è½½æ—¶æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºç¬¦çš„çŠ¶æ€çš„<code>UserLoadingState</code> ã€‚ </p><br><p>  <code>UserDataState</code>ç”¨äºæ•°æ®å·²ç»åŠ è½½å¹¶æ˜¾ç¤ºåœ¨å±å¹•ä¸Šæ—¶çš„çŠ¶æ€ã€‚ </p><br><p> ä»¥è¿™ç§æ–¹å¼ä¼ é€’çŠ¶æ€å¯ä»¥ä½¿æˆ‘ä»¬å®Œå…¨æ‘†è„±UIä»£ç ä¸­çš„é€»è¾‘ã€‚ åœ¨â€œèŒƒå›´æ¨¡å‹â€ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶æ£€æŸ¥<code>_isLoading</code>å­—æ®µçš„å€¼<code>_isLoading</code> <code>true</code>è¿˜æ˜¯<code>false</code>ä»¥ç¡®å®šè¦åˆ›å»ºå“ªä¸ªçª—å£å°éƒ¨ä»¶ã€‚ å¯¹äºBLoCï¼Œæˆ‘ä»¬å°†æ–°çŠ¶æ€ä¼ é€’ç»™æµï¼Œè€Œ<code>UserBlocScreen</code>å°éƒ¨ä»¶çš„å”¯ä¸€ä»»åŠ¡<code>UserBlocScreen</code>ä¸ºå½“å‰çŠ¶æ€åˆ›å»ºUIã€‚ </p><br><pre> <code class="plaintext hljs">class UserBlocScreen extends StatefulWidget { UserBlocScreen(this._repository); final Repository _repository; @override State&lt;StatefulWidget&gt; createState() =&gt; _UserBlocScreenState(); } class _UserBlocScreenState extends State&lt;UserBlocScreen&gt; { UserBloc _userBloc; @override void initState() { _userBloc = UserBloc(widget._repository); super.initState(); } @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar( title: const Text('Bloc'), ), body: SafeArea( child: StreamBuilder&lt;UserState&gt;( stream: _userBloc.user, initialData: UserInitState(), builder: (context, snapshot) { if (snapshot.data is UserInitState) { return _buildInit(); } if (snapshot.data is UserDataState) { UserDataState state = snapshot.data; return _buildContent(state.user); } if (snapshot.data is UserLoadingState) { return _buildLoading(); } }, ), ), ); } Widget _buildInit() { return Center( child: RaisedButton( child: const Text('Load user data'), onPressed: () { _userBloc.loadUserData(); }, ), ); } Widget _buildContent(User user) { return Center( child: Text('Hello ${user.name} ${user.surname}'), ); } Widget _buildLoading() { return const Center( child: CircularProgressIndicator(), ); } @override void dispose() { _userBloc.dispose(); super.dispose(); } }</code> </pre> <br><p>  <code>UserBlocScreen</code>å°éƒ¨ä»¶çš„ä»£ç æ¯”å‰é¢çš„ç¤ºä¾‹è¿˜è¦ç®€å•ã€‚ ä¸ºäº†ä¾¦å¬çŠ¶æ€æ›´æ”¹ï¼Œä½¿ç”¨äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">StreamBuilder</a> ã€‚  <code>StreamBuilder</code>æ˜¯ä¸€ä¸ª<code>StatefulWidget</code> ï¼Œå®ƒæ ¹æ®æµï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Stream</a> ï¼‰çš„æœ€åä¸€ä¸ªå€¼ï¼ˆSnapshotï¼‰åˆ›å»ºè‡ªå·±ã€‚ </p><br><h3 id="plyusy-2"> ä¼˜ç‚¹ </h3><br><ol><li> æ— éœ€ç¬¬ä¸‰æ–¹åº“ã€‚ </li><li> ä¸šåŠ¡é€»è¾‘ï¼ŒçŠ¶æ€ç®¡ç†å’Œæ•°æ®åŠ è½½ä¸UIä»£ç åˆ†å¼€ã€‚ </li><li> ååº”æ€§ æ— éœ€åƒåœ¨Scoped Model <code>notifyListeners()</code>çš„ç¤ºä¾‹ä¸­é‚£æ ·è°ƒç”¨å…¶ä»–æ–¹æ³•ã€‚ </li></ol><br><h3 id="minusy-2"> ç¼ºç‚¹ </h3><br><ol><li> è¿›å…¥é—¨æ§›ç¨é«˜ã€‚ éœ€è¦ä½¿ç”¨æµæˆ–rxdartçš„ç»éªŒã€‚ </li></ol><br><h2 id="linki"> å‹æƒ…é“¾æ¥ </h2><br><p> æ‚¨å¯ä»¥é€šè¿‡ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æˆ‘çš„githubå­˜å‚¨åº“</a>ä¸‹è½½å®Œæ•´ä»£ç æ¥é˜…è¯»å®Œæ•´ä»£ç ã€‚ </p><br><p> åŸå§‹æ–‡ç« å‘è¡¨åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Medium</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN438574/">https://habr.com/ru/post/zh-CN438574/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN438560/index.html">ä»å¤´å¼€å§‹ç¼–å†™XGBoost-ç¬¬1éƒ¨åˆ†ï¼šå†³ç­–æ ‘</a></li>
<li><a href="../zh-CN438562/index.html">ä»é›¶å¼€å§‹ç¼–å†™XGBoost-ç¬¬2éƒ¨åˆ†ï¼šæ¢¯åº¦æå‡</a></li>
<li><a href="../zh-CN438566/index.html">Apple Strange A12Xå¾®å¤„ç†å™¨å¤–å£³</a></li>
<li><a href="../zh-CN438568/index.html">å…³äºé‡å­è®¡ç®—æœºï¼šä¸åŒå›½å®¶å¦‚ä½•å¼€å‘è¿™é¡¹æŠ€æœ¯</a></li>
<li><a href="../zh-CN438570/index.html">CS Center 2018é™¤å¤•æ¯”èµ›</a></li>
<li><a href="../zh-CN438576/index.html">æµè¡Œçš„å¼€æº-ç¬¬ä¸‰éƒ¨åˆ†ï¼šé¢å‘å¼€å‘äººå‘˜çš„5ç§å·¥å…·</a></li>
<li><a href="../zh-CN438578/index.html">éŸ³é¢‘å·¨å¤´ITå·¨å¤´å¦‚ä½•ç¬¬äºŒæ¬¡è¢«â€œè§„é¿â€</a></li>
<li><a href="../zh-CN438580/index.html">åœ¨iOS 12ä¸­è‡ªåŠ¨ç”Ÿæˆçš„å¯†ç </a></li>
<li><a href="../zh-CN438582/index.html">AntiRating 2018</a></li>
<li><a href="../zh-CN438584/index.html">åç«¯å¼€å‘äººå‘˜çš„å‰ç«¯</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>