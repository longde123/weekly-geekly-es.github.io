<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ผ๐พ ๐ผ๐ผ โ๐ฟ ุงูุฌุฒุก 5/2 1: ููุชุฑู ุทุฑู RocketChip Avenue ููุณุงุฑ ุงูุฃุฌูุฒุฉ ุงูุฒููุฉ ๐ฌ ๐ณ๏ธ ๐ต</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ุงูุฃุฌุฒุงุก ุงูุฃุฑุจุนุฉ ุงูุณุงุจูุฉ ุ ุชู ุฅุฌุฑุงุก ุงูุงุณุชุนุฏุงุฏุงุช ููุชุฌุงุฑุจ ูุน ูุฑูุฒ RISC-V RocketChip ุ ุฃู ููู ูุฐุง ุงููุจ ุฅูู ููุญุฉ "ุบูุฑ ููุงุณูุฉ" ูู ูุน Altera FPGAs (ุงูุขู I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูุฌุฒุก 5/2 1: ููุชุฑู ุทุฑู RocketChip Avenue ููุณุงุฑ ุงูุฃุฌูุฒุฉ ุงูุฒููุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461577/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูู ุงูุฃุฌุฒุงุก ุงูุฃุฑุจุนุฉ ุงูุณุงุจูุฉ ุ ุชู ุฅุฌุฑุงุก ุงูุงุณุชุนุฏุงุฏุงุช ููุชุฌุงุฑุจ ูุน ูุฑูุฒ RISC-V RocketChip ุ ุฃู ููู ูุฐุง ุงููุจ ุฅูู ููุญุฉ "ุบูุฑ ููุงุณูุฉ" ูู ูุน Altera FPGAs (ุงูุขู Intel).  ุฃุฎูุฑูุง ุ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก ุงูุฃุฎูุฑ</a> ุ ุงุชุถุญ ุชุดุบูู Linux ุนูู ูุฐุง ุงูููุชุฏู.  ูู ุชุนุฑู ูุง ูุถุญููู ุนู ูู ูุฐุงุ  ุญูููุฉ ุฃูู ูู ููุณ ุงูููุช ุงุถุทุฑุฑุช ุฅูู ุงูุนูู ูุน ุงููุฌููุน RISC-V ู C ู Scala ุ ููููู ุ ูุงูุช Scala ูู ุฃุฏูู ูุณุชูู ูุบุฉ (ูุฃู ุงููุนุงูุฌ ููุชูุจ ุนูููุง). </p><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูุฌุนู C ูุง ุชููู ูุณูุฆุฉ ูู ูุฐู ุงูููุงูุฉ ุฃูุถูุง.  ุนูุงูุฉ ุนูู ุฐูู ุ ุฅุฐุง ุชู ุงุณุชุฎุฏุงู ุญุฒูุฉ Scala + Chisel ููุบุฉ ุฎุงุตุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจูุฌุงู ูุนูู</a> ููุตู ุตุฑูุญ ููุฃุฌูุฒุฉ ุ ูุณูุชุนูู ุงูููู ููููุฉ "ุณุญุจ" ูุธุงุฆู C ุงูุจุณูุทุฉ ูู ุงููุนุงูุฌ ูู ุดูู ุชุนูููุงุช. </p><br><p style=";text-align:right;direction:rtl"> ุงููุฏู ุงูููุงุฆู ูู ุงูุชุทุจูู ุงูุชุงูู ููุฃุฌูุฒุฉ ุงูุชุงููุฉ ูุซู AFL ุนู ุทุฑูู ุงูููุงุณ ูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">QInst</a> ุ ูุชูููุฐ ุชุนูููุงุช ูููุตูุฉ ููุณุช ุณูู ููุชุฌ ุซุงููู. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  ููู ุงููุงุถุญ ุฃู ููุงู (ูููุณ ูุงุญุฏ) ุงูุชุฌุงุฑู OpenCL ูุชุญููู RTL.  ููุฏ ุตุงุฏูุช ุฃูุถูุง ูุนูููุงุช ุญูู ูุดุฑูุน ูุนูู ูู COPILOT ูู RISC-V ูู ุฃูุฏุงู ููุงุซูุฉ (ุฃูุซุฑ ุชูุฏูุงู) ุ ูููู ููุงู ุดูุฆูุง ูุง ูุตูุจ ุบูุบูููุบ ุจุดูู ุณูุก ุ ุนูุงูุฉ ุนูู ุฐูู ุ ููู ุฃูุถูุง ููุชุฌ ุชุฌุงุฑู ุนูู ุงูุฃุฑุฌุญ.  ุฃูุง ููุชู ูู ุงูููุงู ุงูุฃูู ุจุญููู OpenSource ุ ููู ุญุชู ุฅุฐุง ูุงู ุงูุฃูุฑ ูุฐูู ุ ููุง ูุฒุงู ูู ุงูููุชุน ูุญุงููุฉ ุชูููุฐ ุฐูู ุจููุณู - ุนูู ุงูุฃูู ูุฏุฑุงุณุฉ ุญุงูุฉ ูุจุณุทุฉ ุ ุซู ููู ุชุณูุฑ ุงูุฃููุฑ ... </p><br><p style=";text-align:right;direction:rtl">  <strong>ุฅุฎูุงุก ุงููุณุฆูููุฉ</strong> (ุจุงูุฅุถุงูุฉ ุฅูู ุงูุชุญุฐูุฑ ุงููุนุชุงุฏ ุญูู "ุงูุฑูุต ุจุงุณุชุฎุฏุงู ูุทูุฃุฉ ุญุฑูู"): ุฃูุง ูุง ุฃูุตู ุจุดุฏุฉ ุจุชุทุจูู ุงูููุงุฉ ุงูุฃุณุงุณูุฉ ููุจุฑุงูุฌ ุจุดูู ูุชููุฑ ุ ูุง ุณููุง ูุน ุงูุจูุงูุงุช ุบูุฑ ุงูููุซูู ุจูุง - ุญุชู ุงูุขู ูู ุฃุซู ูุซูุฑูุง ูู ุงูุซูุฉ ุญุชู ุฃููู ูุง ุฃููู ููุงุฐุง ูุง ูููู ุญุชู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ููุฏ ุงููุนุงูุฌุฉ "ุงูุชุฏูู" ูู ุจุนุถ ุงูุญุงูุงุช ุงูุญุฏูุฏูุฉ ุจูู ุงูุนูููุงุช ู / ุฃู ุงูุฃุณุงุณูุฉ.  ุญุณููุง ุ ุญูู ุญูููุฉ ุฃู ุงูุจูุงูุงุช ูููู ุฃู "ุชุบูุจ" ุ ุนูู ูุง ุฃุนุชูุฏ ุ ููุฐุง ูุงุถุญ.  ุจุดูู ุนุงู ุ ูุง ูุฒุงู ููุงู ุงูุชุญูู ูู ุงูุตุญุฉ ูุงูุชุญูู ... </p><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ูููุจุชุฏุฆูู ุ ูุงุฐุง ุฃุณูู "ูุธููุฉ ุจุณูุทุฉ"ุ  ูุฃุบุฑุงุถ ูุฐู ุงูููุงูุฉ ุ ูุนูู ูุฐุง ูุธููุฉ ูุง ุชุคุฏู ูููุง ุฌููุน ุงูุชุญููุงุช (ุงูุดุฑุทูุฉ ูุบูุฑ ุงููุดุฑูุทุฉ) ุฅูุง ุฅูู ุฒูุงุฏุฉ ุนุฏุงุฏ ุงูุชุนูููุงุช ุจูููุฉ ุซุงุจุชุฉ.  ุจูุนูู ุฃู ุงูุฑุณู ุงูุจูุงูู ูุฌููุน ุงูุชุญููุงุช ุงููุญุชููุฉ ูููู (ููุฌููุง) ุดุงุฐูุง ุ ุจุฏูู ุญูุงู "ุฏููุงููููุฉ".  ุงููุฏู ุงูููุงุฆู ูู ุฅุทุงุฑ ูุฐู ุงูููุงูุฉ ูู ุฃู ุชููู ูุงุฏุฑูุง ุนูู ุงูููุงู ุจูุธููุฉ ุจุณูุทุฉ ูู ุงูุจุฑูุงูุฌ ุ ูุงุณุชุจุฏุงููุง ุจูููู ุฅุถุงูู ูููุฌูุน ุ "ุฎูุงุทุชูุง" ุฅูู ุงููุนุงูุฌ ูู ูุฑุญูุฉ ุงูุชูููู ุ ููุง ูุฌุนููุง ุงุฎุชูุงุฑูุง ุชุฃุซูุฑูุง ุฌุงูุจููุง ูุชุนูููุงุช ุฃุฎุฑู.  <em>ุนูู ูุฌู ุงูุชุญุฏูุฏ ุ ูู ูุชู ุนุฑุถ ุงููุชูุฑุนุฉ ูู ูุฐู ุงูููุงูุฉ ุ ูููู ูู ุฃุจุณุท ุงูุญุงูุงุช ูู ูููู ูู ุงูุตุนุจ ุฅุฌุฑุงุคูุง.</em> </p><br><h2 id="uchimsya-ponimat-c-na-samom-dele-net" style=";text-align:right;direction:rtl">  ุชุนูู ููู C (ูู ุงููุงูุน ุ ูุง) </h2><br><p style=";text-align:right;direction:rtl"> ุฃููุง ุชุญุชุงุฌ ุฅูู ููู ููู ุณูููู ุจุชุญููู Cุ  ูุฐุง ุตุญูุญ ุ ุจุฃู ุญุงู ูู ุงูุฃุญูุงู - ูู ููู ุนุจุซูุง ุฃู ุชุนููุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุญููู ูููุงุช ELF</a> : ูู โโูุง ุชุญุชุงุฌู ูู ุชุฌููุน ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฎุงุตุฉ ุจูุง ูู C / Rust / ุดูุก ุขุฎุฑ ุฅูู ุฑูุฒ eBPF ุซุงููู ุ ูุชุญูููู ุจุงููุนู.  ุจุนุถ ุงูุตุนูุจุงุช ูุงุชุฌุฉ ุนู ุญูููุฉ ุฃูู ูู Scala ูุง ููููู ููุท ุงูุงุชุตุงู ุจู <code>elf.h</code> ููุฑุงุกุฉ ุญููู ุงูุจููุฉ.  ููููู ุจุงูุทุจุน ุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">JNAerator</a> - ุฅุฐุง ูุฒู ุงูุฃูุฑ ุ ููููููู ุนูู ุงููุฌูุฏุงุช ุฅูู ุงูููุชุจุฉ - ููุณ ููุท ุงูููุงูู ุ ูููู ุฃูุถูุง ุฅูุดุงุก ุฑูุฒ ููุนูู ูู ุฎูุงู JNA (ูุฌุจ ุนุฏู ุงูุฎูุท ุจููู ูุจูู JNI).  ููุจุฑูุฌ ุญูููู ุ ุณุฃูุชุจ ุฏุฑุงุฌุชู ูุฃูุชุจ ุจุนูุงูุฉ ุซูุงุจุช ุงูุชุนุฏุงุฏ ูุงูุฅุฒุงุญุฉ ูู ููู ุงูุฑุฃุณ.  ูุชู ูุตู ุงููุชุงุฆุฌ ูุงูุจูู ุงููุณูุทุฉ ุจุงููููู ุงูุชุงูู ููุฆุงุช ุงูุญุงูุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SectionKind</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegularSection</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SectionKind</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SymtabSection</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SectionKind</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StrtabSection</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SectionKind</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RelSection</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SectionKind</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Elf64Header</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> sectionHeaders: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Seq</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ByteBuffer</span></span></span></span><span class="hljs-class"><span class="hljs-params">], sectionStringTableIndex: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Elf64Section</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> data: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ByteBuffer</span></span></span></span><span class="hljs-class"><span class="hljs-params">, linkIndex: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, infoIndex: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, kind: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">SectionKind</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Symbol</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> name: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, value: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, size: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, shndx: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, isInstrumenter: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Relocation</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> relocatedSection: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, offset: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, symbol: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Symbol</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BpfInsn</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> opcode: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, dst: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, src: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, offset: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, imm: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Either</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Long</span></span></span></span><span class="hljs-class"><span class="hljs-params">, </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Symbol</span></span></span></span><span class="hljs-class"><span class="hljs-params">] </span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BpfProg</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> name: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, insns: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Seq</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">BpfInsn</span></span></span></span><span class="hljs-class"><span class="hljs-params">] </span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุฃุตู ุจุดูู ุฎุงุต ุนูููุฉ ุงูุชุญููู - ูุฐู ูุฌุฑุฏ ุนูููุฉ ููู ุจุงูุชุฉ ูููุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>java.nio.ByteBuffer</code></a> - ุชู ุจุงููุนู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><code>java.nio.ByteBuffer</code></a> ุฌููุน ุงูุฃุดูุงุก ุงููุซูุฑุฉ ููุงูุชูุงู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงูุฉ ุญูู ุชุญููู ูููุงุช ELF</a> .  ุณุฃููู ููุท ุฃูู ุจุญุงุฌุฉ ุฅูู ุงูุชุนุงูู ูุน <code>opcode == 0x18</code> ุจุนูุงูุฉ <code>opcode == 0x18</code> (ุชุญููู ููู ููุฑูุฉ 64 ุจุช ูู ุงูุณุฌู) ุ ูุฃูู ูุณุชุบุฑู ูููุชูู ูู 8 ุจุงูุช ูู ุขู ูุงุญุฏ (ุฑุจูุง ููุงู ุฑููุฒ ุชุดุบูู ุฃุฎุฑู ูู ูุฐุง ุงููุจูู ุ ููููู ูู ุฃุชุทุฑู ุฅูููุง ุจุนุฏ) ุ ููุฐุง ูุง ูุชู ุฏุงุฆููุง ุชุญููู ุนููุงู ุงูุฐุงูุฑุฉ ุงููุฑุชุจุท ุจุงูููู ุ ููุง ุงุนุชูุฏุช ูู ุงูุจุฏุงูุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุณุชุฎุฏู <code>__builtin_popcountl</code> ุจุตุฏู <strong>ุซุงุจุช</strong> 64 ุจุช <code>0x0101010101010101</code> .  ููุงุฐุง ูุง ุฃููู ุจุนูููุฉ ููู "ุตุงุฏูุฉ" ูุน ุชุตุญูุญ ุงูููู ุงูุฐู ุชู ุชูุฒููู - ูุฃููู ุฃุฑูุฏ ุฃู ุฃุฑู ุงูุฃุญุฑู ูู ุดูู ุฑูุฒู (ุขุณู ููุชูุฑูุฉ) ุ ุจุญูุซ ูููู ุงุณุชุจุฏุงู ุงูุฃุญุฑู ูู ูุณู <code>COMMON</code> ูู ููุช ูุงุญู <code>COMMON</code> ุฏูู ุงุณุชุฎุฏุงู ุนูุงุฒุงุช ูุน ูุนุงูุฌุฉ ุฎุงุตุฉ ูุนูุงููู ูู ููุน ุฎุงุต (ู ููุฐุง ูุนูู ุ ุญุชู ูุน ุงูุฑูุตุงุช ูุน <code>UInt</code> ุซุงุจุช / ุบูุฑ ุซุงุจุช). </p><br><h2 id="stroim-hardware-po-naboru-instrukciy" style=";text-align:right;direction:rtl">  ูุญู ูุจูู ุงูุฃุฌูุฒุฉ ูููุง ููุฌููุนุฉ ูู ุงูุชุนูููุงุช </h2><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ุจุงูุชุฑุงุถ ุฃู ุฌููุน ูุณุงุฑุงุช ุงูุชูููุฐ ุงูููููุฉ ุชูุญุตุฑ ุญุตุฑููุง ูู ูุงุฆูุฉ ุงูุฅุฑุดุงุฏุงุช ุ ููุง ูุนูู ุฃู ุงูุจูุงูุงุช ุชุชุฏูู ุนุจุฑ ุฑุณู ุจูุงูู ููุฌู ููุฌู ุ ููุชู ุชุญุฏูุฏ ุฌููุน ุญูุงููุง ุจุดูู ุซุงุจุช.  ูู ุงูููุช ููุณู ุ ูุฏููุง ููุทู ุฏูุฌู ุจุญุช (ุฃู ุจุฏูู ุณุฌูุงุช ูู ุงูุทุฑูู) ุ ุชู ุงูุญุตูู ุนููู ูู ุงูุนูููุงุช ุนูู ุงูุณุฌูุงุช ุ ููุฐูู ุงูุชุฃุฎูุฑุงุช ุฃุซูุงุก ุนูููุงุช ุงูุชุญููู / ุงูุชุฎุฒูู ูุน ุงูุฐุงูุฑุฉ.  ูุจุงูุชุงูู ุ ูู ุงูุญุงูุฉ ุงูุนุงูุฉ ุ ูุฏ ูุง ุชููู ุงูุนูููุฉ ููููุฉ ูู ุฏูุฑุฉ ุณุงุนุฉ ูุงุญุฏุฉ.  ุณููุนู ุดูุฆูุง ุจุณูุทูุง: <code>UInt</code> ุงููููุฉ ุฅูู ุดูู <code>UInt</code> ุ ูููู ูุซู <code>(UInt, Bool)</code> : ุงูุนูุตุฑ ุงูุฃูู ูู ุงูุฒูุฌ ูู ุงููููุฉ ุ ูุงูุซุงูู ูู ุนูุงูุฉ ุนูู ุตุญุชูุง.  ุจูุนูู ุฃูู ูุง ูุนูู ูููุฑุงุกุฉ ูู ุงูุฐุงูุฑุฉ ุ ุทุงููุง ุฃู ุงูุนููุงู ุบูุฑ ุตุญูุญ ุ ูุงููุชุงุจุฉ ุจุดูู ุนุงู ุฃูุฑ ูุณุชุญูู. </p><br><p style=";text-align:right;direction:rtl">  ููุชุฑุถ ุทุฑุงุฒ ุชูููุฐ eBPF bytecode ููุนูุง ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ูุน ุนูููุฉ 64 ุจุช ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุฌููุนุฉ ูู 16 (ุฃู ุญุชู 10) ุณุฌูุงุช 64 ุจุช.  ุชููุชุฑุญ ุฎูุงุฑุฒููุฉ ูุชูุฑุฑุฉ ุจุฏุงุฆูุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุจุฏุฃ ูุน ุงูุณูุงู ุงูุฐู ุชููู ููู ูุนุงููุงุช ุงูุชุนูููุฉ ูู <code>r1</code> ู <code>r2</code> ุ ูู ุงูุจุงูู - ุงูุฃุตูุงุฑ ุ ูููุง ุตุงูุญุฉ (ุจุชุนุจูุฑ ุฃุฏู ุ ุงูุตูุงุญูุฉ ุชุณุงูู "ุฌุงูุฒูุฉ" ุชุนูููุฉ coprocessor) </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ุฑุฃููุง ุฅุฑุดุงุฏุงุช ุญุณุงุจูุฉ ููุทููุฉ ุ ูุฅููุง ูุณุชุฎูุต ุณุฌูุงุช ูุนุงููุงุชูุง ูู ุงูุณูุงู ุ ูุฏุนู ุฃููุณูุง ุฅูู ุฐูู ุงููุงุฆูุฉ ูุงูุณูุงู ุงูุฐู ูุชู ููู ุงุณุชุจุฏุงู ูุนุงูู ุงูุชุนุงูู ูุน ุฒูุฌ <code>(data1 op data2, valid1 &amp;&amp; valid2)</code> </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงุฌููุง ูุฑุนุง ุ ููุญู ุจุจุณุงุทุฉ ูุจูู ููุง ุงููุฑุนูู ุจุดูู ูุชูุฑุฑ: ุฅุฐุง ุญุฏุซ ุงููุฑุน ุ ูุฅุฐุง ูู ูุญุฏุซ ุฐูู </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงุฌููุง ุงูุชุญููู ุฃู ุงูุญูุธ ูู ุงูุฐุงูุฑุฉ ุ ูุณูุฎุฑุฌ ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู: ูููุฐ ุฑุฏ ุงูุงุชุตุงู ุงูููููู ุ ูุน ุงูุชุฑุงุถ ุฃูู ุจูุฌุฑุฏ ุนุฏู ุฅููุงููุฉ ุงุณุชุฑุฌุงุน ุงูุจูุงู <code>valid</code> ุฃุซูุงุก ุชูููุฐ ูุฐุง ุงูุฅุฑุดุงุฏุงุช.  ุตูุงุญูุฉ ุนูููุฉ ุงูุญูุธ ูู AND <code>globalValid</code> ุนูุงูุฉ <code>globalValid</code> ุ ูุงูุชู ูุฌุจ ุถุจุทูุง ูุจู ุฅุฑุฌุงุน ุงูุณูุทุฑุฉ.  ูู ุงูููุช ููุณู ุ ูุฌุจ ุนูููุง ุงูููุงู ุจุงููุชุงุจุฉ ูุงููุฑุงุกุฉ ุนูู ุทูู ุงูููุฏูุฉ ูู ุฃุฌู ูุนุงูุฌุฉ ุงูุฒูุงุฏุงุช ูุงูุชุนุฏููุงุช ุงูุฃุฎุฑู ุจุดูู ุตุญูุญ. </li></ul><br><p style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ุณูุชู ุชูููุฐ ุงูุนูููุงุช ุจุงูุชูุงุฒู ูุฏุฑ ุงูุฅููุงู ุ ูููุณ ูู ุฎุทูุงุช.  ูู ุงูููุช ููุณู ุ ุฃุทูุจ ููู ุงูุงูุชุจุงู ุฅูู ุฃู ุฌููุน ุงูุนูููุงุช ุนูู ุจุงูุช ูุนูู ูู ุงูุฐุงูุฑุฉ ูุฌุจ ุฃู ูุชู ุชุฑุชูุจูุง ุจุงููุงูู ุจุดูู ุทุจูุนู ุ ูุฅูุง ูุฅู ุงููุชูุฌุฉ ุบูุฑ ูุชููุนุฉ ุ UB.  ุฃู  <code>*addr += 1</code> - ูุฐุง ุทุจูุนู ุ ูู ุชุจุฏุฃ ุงููุชุงุจุฉ ุชูุงููุง ุญุชู ุชูุชูู ุงููุฑุงุกุฉ (ูุจุชุฐู ูุฃููุง ูุง ุฒููุง ูุง ูุนุฑู ูุงุฐุง ููุชุจ) ุ ููู <code>*addr += 1; return *addr;</code> <code>*addr += 1; return *addr;</code>  ุฃูุง ุนูููุง ุฃุนุทูุช <strong>ุงูุตูุฑ</strong> ุฃู ุดูุก ูู ูุฐุง ุงููุจูู ุจุฃูุงู.  ุฑุจูุง ูููู ุงูุฃูุฑ ูุณุชุญู ุงูุชุตุญูุญ (ุฑุจูุง ูุฎูู ุจุนุถ ุงููุดุงูู ุงูุฃูุซุฑ ุตุนูุจุฉ) ุ ููู ุงููุฏุงุก ููุณู ูู ุฃู ุญุงู ููุฑุฉ ุนูู ูุฐุง ุงููุญู ุ ูุฃูู ูุฌุจ ุนููู ุชุชุจุน ุนูุงููู ุงูุฐุงูุฑุฉ ุงูุชู ุชู ุฅูุฌุงุฒ ุงูุนูู ุจูุง ุจุงููุนู ุ ููู ูุฏู ุฑุบุจุฉ ุงูุชุญูู ูู ุตุญุฉ ุงูููู <code>valid</code> ููููุง ุจุดูู ุซุงุจุช.  ูุฐุง ูู ุจุงูุถุจุท ูุง ุณูุชู ุนููู ูููุชุบูุฑุงุช ุงูุนุงูููุฉ ุฐุงุช ุงูุญุฌู ุงูุซุงุจุช. </p><br><p style=";text-align:right;direction:rtl">  ูุงููุชูุฌุฉ ูู ูุฆุฉ ุชุฌุฑูุฏูุฉ <code>BpfCircuitConstructor</code> ุ ูุงูุชู ูุง ููุฌุฏ ุจูุง ุทุฑู <code>doMemLoad</code> ุ <code>doMemStore</code> ุ ู <code>doMemStore</code> ุ ู <code>resolveSymbol</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BpfCircuitConstructor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... sealed abstract class LdStType(val lgsize: Int) { val byteSize = 1 &lt;&lt; lgsize val bitSize = byteSize * 8 val mask: UInt = if (bitSize == 64) mask64 else ((1l &lt;&lt; bitSize) - 1).U } case object u8 extends LdStType(0) case object u16 extends LdStType(1) case object u32 extends LdStType(2) case object u64 extends LdStType(3) def doMemLoad(addr: UInt, tpe: LdStType, valid: Bool): (UInt, Bool) def doMemStore(addr: UInt, tpe: LdStType, data: UInt, valid: Bool): Bool sealed trait Resolved { def asPlainValue: UInt def load(ctx: Context, offset: Int, tpe: LdStType, valid: Bool): LazyData def store(offset: Int, tpe: LdStType, data: UInt, valid: Bool): Bool } def resolveSymbol(sym: BpfLoader.Symbol): Resolved // ... }</span></span></code> </pre> <br><h2 id="integraciya-s-processornym-yadrom" style=";text-align:right;direction:rtl">  ุงูุชูุงูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุงูุฃุณุงุณูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ูููุจุชุฏุฆูู ุ ูุฑุฑุช ุงุชุจุงุน ุงูุทุฑููุฉ ุงูุจุณูุทุฉ: ุงูุงุชุตุงู ุจููุงุฉ ุงููุนุงูุฌ ุจุงุณุชุฎุฏุงู ุจุฑูุชูููู RoCC (Rocket Custom Coprocessor) ุงูููุงุณู.  ุจูุฏุฑ ูุง ุฃููู ุ ูุฐุง ุงูุชุฏุงุฏ ููุชุธู ููุณ ูุฌููุน ุญุจูุจุงุช RISC-V ุงููุชูุงููุฉ ุ ูููู ููุท ูู Rocket ู BOOM (Berkeley Out-of-Order Machine) ุ ูุฐูู ุ ุนูุฏ ุณุญุจ ุงูุนูู ูู ุงููุฑุงุญู ุงูุฃููู ุนูู ุงููุฌูุนูู ุ ุชู <code>custom0</code> ุงูุชุฌููุน <code>custom0</code> ุฎุงุฑุฌูุง. <code>custom3</code> ูุณุคููุฉ ุนู ุฃูุงูุฑ ูุณุฑุน. </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ูููู ุฃู ูุญุชูู ูู ูุนุงูุฌ ูุนุงูุฌ Rocket / BOOM ุนูู ูุง ูุตู ุฅูู ุฃุฑุจุนุฉ ูุนุฌูุงุช RoCC ุชูุช ุฅุถุงูุชูุง ุนุจุฑ ุงูุชูููู ุ ูููุงู ุฃูุถูุง ุฃูุซูุฉ ููุชูููุฐ: </p><br><p style=";text-align:right;direction:rtl">  <strong>Configs.scala:</strong> </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WithRoccExample</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(site, here, up</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">=&gt;</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">BuildRoCC</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>( (p: <span class="hljs-type"><span class="hljs-type">Parameters</span></span>) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> accumulator = <span class="hljs-type"><span class="hljs-type">LazyModule</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">AccumulatorExample</span></span>(<span class="hljs-type"><span class="hljs-type">OpcodeSet</span></span>.custom0, n = <span class="hljs-number"><span class="hljs-number">4</span></span>)(p)) accumulator }, (p: <span class="hljs-type"><span class="hljs-type">Parameters</span></span>) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> translator = <span class="hljs-type"><span class="hljs-type">LazyModule</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">TranslatorExample</span></span>(<span class="hljs-type"><span class="hljs-type">OpcodeSet</span></span>.custom1)(p)) translator }, (p: <span class="hljs-type"><span class="hljs-type">Parameters</span></span>) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> counter = <span class="hljs-type"><span class="hljs-type">LazyModule</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">CharacterCountExample</span></span>(<span class="hljs-type"><span class="hljs-type">OpcodeSet</span></span>.custom2)(p)) counter }) })</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุทุจูู ุงููุทุงุจู ููุฌูุฏ ูู ููู <code>LazyRoCC.scala</code> . </p><br><p style=";text-align:right;direction:rtl">  ููุซู ุชุทุจูู ุงูุชุณุฑูุน ูุฆุชูู <code>LazyRoCC</code> ุจุงููุนู ูู ูุญุฏุฉ ุชุญูู ุงูุฐุงูุฑุฉ: ุฃุญุฏููุง ูู ูุฐู ุงูุญุงูุฉ ููุฑูุซ ูู <code>LazyRoCC</code> ุ ูุงูุขุฎุฑ ูู <code>LazyRoCCModuleImp</code> .  ุชุญุชูู ุงููุฆุฉ ุงูุซุงููุฉ ุนูู ูููุฐ <code>io</code> ูู ุงูููุน <code>RoCCIO</code> ุ ูุงูุฐู ูุญุชูู ุนูู ูููุฐ ุทูุจ <code>cmd</code> ุ ููููุฐ ุงุณุชุฌุงุจุฉ <code>resp</code> ุ ููููุฐ mem ูููุตูู ุฅูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช L1D ุ ููุฎุฑุฌุงุช <code>busy</code> ูููุงุทุนุฉ ุ ููุฏุฎูุงุช <code>exception</code> .  ููุฌุฏ ุฃูุถูุง ูููุฐ ูููุดู ุจุฌุฏูู ุงูุตูุญุงุช ููุญุฏุงุช FPU ูุง ูุจุฏู ุฃููุง ุจุญุงุฌุฉ ุฅูููุง ุจุนุฏ (ุนูู ุฃู ุญุงู ุ ูุง ููุฌุฏ ุญุณุงุจ ุญูููู ูู eBPF).  ุญุชู ุงูุขู ุฃุฑูุฏ ุฃู ุฃุญุงูู ุงูููุงู ุจุดูุก ูุง ุจูุฐุง ุงูููุฌ ุ ูุฐูู ูู ุฃุชุทุฑู ุฅูู <code>interrupt</code> .  ุฃูุถูุง ุ ููุง ุฃููููุง ุ ููุงู ูุงุฌูุฉ TileLink ูููุตูู ุฅูู ุงูุฐุงูุฑุฉ ุบูุฑ ุงููุฎุฒูุฉ ูุคูุชูุง ุ ููู ุงูุขู ูู ุฃุชุทุฑู ุฅูููุง ุฃูุถูุง. </p><br><h2 id="uporyadochivatel-zaprosov" style=";text-align:right;direction:rtl">  ููุธู ุงูุงุณุชุนูุงู </h2><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูุฏููุง ูููุฐ ูููุตูู ุฅูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุ ูููู ูุงุญุฏ ููุท.  ูู ุงูููุช ููุณู ุ ูููู ุฃู ุชุฒูุฏ ุฏุงูุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุชุบูุฑ (ูุงูุฐู ุ ุนูู ุงูุฃูู ุ ูููู ุชุญูููู ุฅูู ุนูููุฉ ุฐุฑูุฉ ูุงุญุฏุฉ) ุฃู ุญุชู ูุญูููุง ุจุทุฑููุฉ ุบูุฑ ุชุงูุฉ ุนู ุทุฑูู ุชุญููููุง ูุชุญุฏูุซูุง ูุญูุธูุง.  ูู ุงูููุงูุฉ ุ ูููู ุฃู ููุฏู ุชุนูููุฉ ูุงุญุฏุฉ ุนุฏุฉ ุทูุจุงุช ุบูุฑ ูุฑุชุจุทุฉ.  ุฑุจูุง ููุณุช ูุฐู ูู ุฃูุถู ููุฑุฉ ูู ุญูุซ ุงูุฃุฏุงุก ุ ูููู ุ ูู ูุงุญูุฉ ุฃุฎุฑู ุ ููุงุฐุง ูุง ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุง ุชููู ุจุชุญููู ุซูุงุซ ูููุงุช (ุฑุจูุง ุ ุจุงููุนู ุ ููุฌูุฏุฉ ุจุงููุนู ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช) ุ ุจูุนุงูุฌุชูุง ุจุทุฑููุฉ ูุง <strong>ุจุงูุชูุงุฒู</strong> ูุน ููุทู ุงูุชูุงูููุฉ (ุซู ูุฏูู ููุฒ ูุงุญุฏ) ูุญูุธ ุงููุชูุฌุฉ.  ูุฐูู ุ ูุญู ุจุญุงุฌุฉ ุฅูู ููุน ูู ุงููุฎุทุทุงุช ุงูุชู "ุชุญู" ุจุดูู ูุนุงู ูุญุงููุงุช ุงููุตูู ุงูููุงุฒู ุฅูู ูููุฐ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูุงุญุฏ. </p><br><p style=";text-align:right;direction:rtl">  ุณูููู ุงูููุทู ูุงูุชุงูู: ูู ุจุฏุงูุฉ ุฅูุดุงุก ุชุทุจูู ุญููุฉ ูุฑุนูุฉ ูุญุฏุฏุฉ (ุญูู <code>funct</code> ุฐู 7 ุจุช ูู ุญูุซ RoCC) ุ ูุชู ุฅูุดุงุก ูุซูู ููุชุณูุณู ุงูุงุณุชุนูุงู (ุฌุนู ุฃุญุฏ ุงูุนูุงุตุฑ ูุจุฏู ุถุงุฑูุง ุฌุฏูุง ุจุงููุณุจุฉ ูู ุ ูุฃูู ููุดุฆ ูุฌููุนุฉ ูู ุงูุชุจุนูุงุช ุงูุฅุถุงููุฉ ุจูู ุงูุทูุจุงุช ุงูุชู ูุง ูููู ุชูููุฐูุง ูู ููุช ูุงุญุฏ ุ ู ุณูู ุงูุฅูุฏุงุฑ Fmax ุนูู ุงูุฃุฑุฌุญ).  ุจุนุฏ ุฐูู ุ ูุชู ุชุณุฌูู ูู "ูููุฑ" / "ูุญูู" ุชู ุฅูุดุงุคู ูู ุจุฑูุงูุฌ ุงูุชุณูุณู.  ูู ุทุงุจูุฑ ูุจุงุดุฑ ุ ุฅุฐุง ุฌุงุฒ ุงูุชุนุจูุฑ.  ูู ูู ุชุฏุจูุฑ ุ ูุชู ุชุญุฏูุฏ ุงูุทูุจ ุงูุฃูู ูู ุฃูุฑ ุงูุชุณุฌูู - ูุชู ุฅุนุทุงุคู ุงูุฅุฐู <strong>ูู ุงูุฅุฌุฑุงุก ุงูุชุงูู</strong> .  ุจุทุจูุนุฉ ุงูุญุงู ุ ูุญุชุงุฌ ูุฐุง ุงูููุทู ุฅูู ุชุฑุงูุจู ุจุดูู ุตุญูุญ ูุน ุงูุงุฎุชุจุงุฑุงุช (ููุณ ูุฏู ุงููุซูุฑ ูููู ุ ูุฐูู ุ ููุณ ูุฐุง ุงูุชุญูู ุ ููููู ุงูุญุฏ ุงูุฃุฏูู ุงูุถุฑูุฑู ูุชุนููู ุดูุก ูุงุถุญ ุนูู ุงูุฃูู).  ููุฏ ุงุณุชุฎุฏูุช <code>PeekPokeTester</code> ุงูููุงุณู ูู ูููู ุฑุณูู ุฃูุซุฑ ุฃู ุฃูู ูุงุฎุชุจุงุฑ ุชุตูููุงุช <code>PeekPokeTester</code> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุตูุชูุง</a> ุจุงููุนู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฑุฉ ูุงุญุฏุฉ</a> . </p><br><p style=";text-align:right;direction:rtl">  ููุงูุช ุงููุชูุฌุฉ ูุซู ูุฐุง ุงูุงูุชูุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializer</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">isComputing: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Bool</span></span></span></span><span class="hljs-class"><span class="hljs-params">, next: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Bool</span></span></span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">monotonic</span></span></span></span>(x: <span class="hljs-type"><span class="hljs-type">Bool</span></span>): <span class="hljs-type"><span class="hljs-type">Bool</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> res = <span class="hljs-type"><span class="hljs-type">WireInit</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> prevRes = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) prevRes := res &amp;&amp; isComputing res := (x || prevRes) &amp;&amp; isComputing res } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">noone</span></span></span></span>(bs: <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Bool</span></span>]): <span class="hljs-type"><span class="hljs-type">Bool</span></span> = !bs.foldLeft(<span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>)(_ || _) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> previousReqs = <span class="hljs-type"><span class="hljs-type">ArrayBuffer</span></span>[<span class="hljs-type"><span class="hljs-type">Bool</span></span>]() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nextReq</span></span></span></span>(x: <span class="hljs-type"><span class="hljs-type">Bool</span></span>): (<span class="hljs-type"><span class="hljs-type">Bool</span></span>, <span class="hljs-type"><span class="hljs-type">Int</span></span>) = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enable = monotonic(x) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> result = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> retired = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> doRetire = result &amp;&amp; next <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> thisReq = enable &amp;&amp; !retired &amp;&amp; !doRetire <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> reqWon = thisReq &amp;&amp; noone(previousReqs) when (isComputing) { when(reqWon) { result := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> } when(doRetire) { result := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> retired := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> } } otherwise { result := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> retired := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> } previousReqs += thisReq (result, previousReqs.length - <span class="hljs-number"><span class="hljs-number">1</span></span>) } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฑุฌู ููุงุญุธุฉ ุฃูู ููุง ูู ุนูููุฉ ุฅูุดุงุก ุฏุงุฆุฑุฉ ุฑูููุฉ ุ ูุชู ุชูููุฐ ุฑูุฒ Scala ุจุฃูุงู.  ุฅุฐุง ุฃูููุช ูุธุฑุฉ ูุงุญุตุฉ ุ ููููู ุญุชู ุฃู ุชูุงุญุธ ูุฌูุฏ <code>ArrayBuffer</code> ููุฏุณุฉ ููู ุฃุฌุฒุงุก ุงูุฏุงุฆุฑุฉ ( <code>Boolean</code> ูู ููุน ูู Scala ุ <code>Bool</code> ูู ููุน ูู ุฃุฒุงููู ููุซู ูุนุฏุงุช ุญูุฉ ุ ูููุณ ุจุนุถ ููุทููุฉ ูุนุฑููุฉ ูู ููุช ุงูุชุดุบูู). </p><br><h2 id="rabota-s-l1d-keshom" style=";text-align:right;direction:rtl">  ุงูุนูู ูุน L1D ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช </h2><br><p style=";text-align:right;direction:rtl">  ูุญุฏุซ ุงูุนูู ูุน ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูู ุงูุบุงูุจ ูู ุฎูุงู <code>io.mem.req</code> ุทูุจ <code>io.mem.resp</code> ุงุณุชุฌุงุจุฉ <code>io.mem.resp</code> .  ูู ุงูููุช ููุณู ุ ุชู ุชุฒููุฏ ูููุฐ ุงูุทูุจ ุจุงูุฅุดุงุฑุงุช ุงูุชูููุฏูุฉ <code>ready</code> ูุงูุณุงุฑูุฉ: ุฃูู ูุง ูุฎุจุฑู ุฃูู ูุณุชุนุฏ ููุจูู ุงูุทูุจ ุ ูุงูุซุงูู ูููู ุฅู ุงูุทูุจ ุฌุงูุฒ ููุฏูู ุจุงููุนู ุงูุจููุฉ ุงูุตุญูุญุฉ ุ ุนูู ุทูู ุงูููุฏูุฉ ุ <code>valid &amp;&amp; resp</code> ุงูุทูุจ ููุจููุงู.  ูู ุจุนุถ ูุฐู ุงููุงุฌูุงุช ุ ููุงู ุดุฑุท "ุนุฏู ุงุณุชุฌุงุจุฉ" ุงูุฅุดุงุฑุงุช ูู ูุญุธุฉ ุงูุถุจุท ุฅูู <code>true</code> ูุฅูู ุงูุญุงูุฉ ุงูุฅูุฌุงุจูุฉ ุงููุงุญูุฉ <code>valid &amp;&amp; resp</code> (ูููู ุฅูุดุงุก ูุฐุง ุงูุชุนุจูุฑ ุจุงุณุชุฎุฏุงู ุทุฑููุฉ <code>fire()</code> ููุฑุงุญุฉ). </p><br><p style=";text-align:right;direction:rtl">  ูุญุชูู ูููุฐ ุงุณุชุฌุงุจุฉ ุงูุงุณุชุฌุงุจุฉ ุ ุจุฏูุฑู ุ ุนูู ุนูุงูุฉ <code>valid</code> ููุท ุ ููุฐู ูู ูุดููุฉ ุงููุนุงูุฌ ูู ุฅุฒุงุญุฉ ุงูุฅุฌุงุจุงุช ูู ุฏูุฑุฉ ูุงุญุฏุฉ ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ: "ุฌุงูุฒ ุฏุงุฆููุง" ุนู ุทุฑูู ุงูุงูุชุฑุงุถ ุ ูุฅุฑุฌุงุน <code>fire()</code> <code>valid</code> ููุท. </p><br><p style=";text-align:right;direction:rtl">  ููุง ููุช ุจุงููุนู ุ ูุง ููููู ุชูุฏูู ุทูุจุงุช ุนูุฏูุง ูููู ุงูุฃูุฑ ูุธูุนูุง: ูุง ููููู ูุชุงุจุฉ ุดูุก ูุง ุ ูุง ุฃุนุฑู ูุงุฐุง ุ ููุฑุงุกุฉ ูุฑุฉ ุฃุฎุฑู ูุง ุณูุชู ุงููุชุงุจุฉ ูููู ูุงุญููุง ุนูู ุฃุณุงุณ ุงููููุฉ ุงููุฎุตููุฉ ุฃูุฑ ุบุฑูุจ ุฅูู ุญุฏ ูุง.  ููู ูุฆุฉ <code>Serializer</code> ุชุชููู ูุฐุง ุจุงููุนู ุ ููููุง ูุนุทููุง ููุท ุฅุดุงุฑุฉ ุฅูู ุฃู ุงูุทูุจ ุงูุญุงูู ูุฏ ุงูุชูู ุจุงููุนู ุฅูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช: <code>next = io.mem.req.fire()</code> .  ูู ูุง ูููู ุงูููุงู ุจู ูู ุงูุชุฃูุฏ ูู ุฃูู ูู "ุงููุงุฑุฆ" ูุชู ุชุญุฏูุซ ุงูุฅุฌุงุจุฉ ููุท ุนูุฏูุง ุชุฃุชู ุจุงููุนู - ููุณ ูุจู ุฐูู ูููุณ ูุงุญููุง.  ููุงู ุทุฑููุฉ ูุฑูุญุฉ <code>holdUnless</code> .  ูุงููุชูุฌุฉ ูู ุงูุชูููุฐ ุงูุชุงูู ุชูุฑูุจุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Constructor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BpfCircuitConstructor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> serializer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Serializer</span></span>(isComputing, io.mem.req.fire()) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doMemLoad</span></span></span></span>(addr: <span class="hljs-type"><span class="hljs-type">UInt</span></span>, tpe: <span class="hljs-type"><span class="hljs-type">LdStType</span></span>, valid: <span class="hljs-type"><span class="hljs-type">Bool</span></span>): (<span class="hljs-type"><span class="hljs-type">UInt</span></span>, <span class="hljs-type"><span class="hljs-type">Bool</span></span>) = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> (doReq, thisTag) = serializer.nextReq(valid) when (doReq) { io.mem.req.bits.addr := addr require((<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; io.mem.req.bits.tag.getWidth) &gt; thisTag) io.mem.req.bits.tag := thisTag.<span class="hljs-type"><span class="hljs-type">U</span></span> io.mem.req.bits.cmd := <span class="hljs-type"><span class="hljs-type">M_XRD</span></span> io.mem.req.bits.typ := (<span class="hljs-number"><span class="hljs-number">4</span></span> | tpe.lgsize).<span class="hljs-type"><span class="hljs-type">U</span></span> io.mem.req.bits.data := <span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span> io.mem.req.valid := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> doResp = isComputing &amp;&amp; serializer.monotonic(doReq &amp;&amp; io.mem.req.fire()) &amp;&amp; io.mem.resp.valid &amp;&amp; io.mem.resp.bits.tag === thisTag.<span class="hljs-type"><span class="hljs-type">U</span></span> &amp;&amp; io.mem.resp.bits.cmd === <span class="hljs-type"><span class="hljs-type">M_XRD</span></span> (io.mem.resp.bits.data holdUnless doResp, serializer.monotonic(doResp)) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doMemStore</span></span></span></span>(addr: <span class="hljs-type"><span class="hljs-type">UInt</span></span>, tpe: <span class="hljs-type"><span class="hljs-type">LdStType</span></span>, data: <span class="hljs-type"><span class="hljs-type">UInt</span></span>, valid: <span class="hljs-type"><span class="hljs-type">Bool</span></span>): <span class="hljs-type"><span class="hljs-type">Bool</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> (doReq, thisTag) = serializer.nextReq(valid) when (doReq) { io.mem.req.bits.addr := addr require((<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; io.mem.req.bits.tag.getWidth) &gt; thisTag) io.mem.req.bits.tag := thisTag.<span class="hljs-type"><span class="hljs-type">U</span></span> io.mem.req.bits.cmd := <span class="hljs-type"><span class="hljs-type">M_XWR</span></span> io.mem.req.bits.typ := (<span class="hljs-number"><span class="hljs-number">4</span></span> | tpe.lgsize).<span class="hljs-type"><span class="hljs-type">U</span></span> io.mem.req.bits.data := data io.mem.req.valid := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> } serializer.monotonic(doReq &amp;&amp; io.mem.req.fire()) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolveSymbol</span></span></span></span>(sym: <span class="hljs-type"><span class="hljs-type">BpfLoader</span></span>.<span class="hljs-type"><span class="hljs-type">Symbol</span></span>): <span class="hljs-type"><span class="hljs-type">Resolved</span></span> = sym <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">BpfLoader</span></span>.<span class="hljs-type"><span class="hljs-type">Symbol</span></span>(symName, _, size, <span class="hljs-type"><span class="hljs-type">ElfConstants</span></span>.<span class="hljs-type"><span class="hljs-type">Elf64_Shdr</span></span>.<span class="hljs-type"><span class="hljs-type">SHN_COMMON</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> size &lt;= <span class="hljs-number"><span class="hljs-number">8</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">RegisterReference</span></span>(regs.getOrElseUpdate(symName, <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span>(<span class="hljs-number"><span class="hljs-number">64.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)))) } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุฅูุดุงุก ูุซูู ูู ูุฐู ุงููุฆุฉ ููู ุฅูุดุงุก ูุฑุนู. </p><br><h2 id="ne-vsyo-to-v-kuche-chto-globalnaya-peremennaya" style=";text-align:right;direction:rtl">  ููุณ ูู ุดูุก ุนูู ุงููููุฉ ูุชุบูุฑ ุนูููู </h2><br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ูุง ูู ูุซุงู ูููุฐุฌูุ  ูุง ูู ุงูุฃุฏุงุก ุงูุฐู ุฃูุฏ ุถูุงููุ  ุจุงูุทุจุน ุ AFL ุงูุฃุฌูุฒุฉ!  ูุจุฏู ูู ุงูุฅุตุฏุงุฑ ุงูููุงุณููู ูุซู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdint.h&gt; extern uint8_t *__afl_area_ptr; extern uint64_t prev; void inst_branch(uint64_t tag) { __afl_area_ptr[((prev &gt;&gt; 1) ^ tag) &amp; 0xFFFF] += 1; prev = tag; }</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ุชุฑูู ุ ูุฅูู ูุญุชูู ุนูู ุชุญููู ูุญูุธ ุฃูุซุฑ ุฃู ุฃูู ููุทููุฉ (ูุจูููุง ุฒูุงุฏุฉ) ูู ุจุงูุช ูุงุญุฏ ูู <code>__afl_area_ptr</code> ุ ููู ููุง ูุทูุจ ุงูุณุฌู ุงูุฏูุฑ <code>prev</code> ! </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุงูุณุจุจ ูู ุฃู ุงููุงุฌูุฉ <code>Resolved</code> ูุทููุจุฉ: ูููููุง ุฅูุง ุงูุชูุงู ุนููุงู ุฐุงูุฑุฉ ุนุงุฏู ุฃู ุฃู ุชููู ูุฑุฌุนูุง ููุชุณุฌูู.  ูู ุงูููุช ููุณู ุ ูุง ุฃุธู ุญุชู ุงูุขู ุณูู ุฃู ุฃุนุชุจุฑ ุงูุณุฌูุงุช ุงูุนุฏุฏูุฉ ุงูุชู ุชุจูุบ ุฃุญุฌุงููุง 1 ุฃู 2 ุฃู 4 ุฃู 8 ุจุงูุช ุ ูุงูุชู ุชุชู ูุฑุงุกุชูุง ุฏุงุฆููุง ุนูุฏ ุตูุฑ ุฅุฒุงุญุฉ ุ ูุฐูู ุจุงููุณุจุฉ ููุณุฌูุงุช ุ ููููู ุชูููุฐ ุทูุจ ุงูููุงููุงุช ุจูุฏูุก ูุณุจููุง.  ูู ูุฐู ุงูุญุงูุฉ ุ ูู ุงููููุฏ ุฌุฏูุง ูุนุฑูุฉ ุฃูู ูุฌุจ ุฃููุงู ุทุฑุญ ุงูุทุฑุญ ูุงุณุชุฎุฏุงูู ูุญุณุงุจ ุงูููุฑุณ ุ ุซู ุฅุนุงุฏุฉ ูุชุงุจุชู ููุท. </p><br><h2 id="a-teper-instrumentaciya" style=";text-align:right;direction:rtl">  ูุงูุขู ุงูุฃุฌูุฒุฉ </h2><br><p style=";text-align:right;direction:rtl">  ูู ูุฑุญูุฉ ูุง ุ ุญุตููุง ุนูู ูุณุฑุน ูููุตู ูุฃูุซุฑ ุฃู ุฃูู ูู ุฎูุงู ูุงุฌูุฉ RoCC.  ูุงุฐุง ุงูุงูุ  ุฅุนุงุฏุฉ ุชูููุฐ ูู ููุณ ุ ูุฏูุน ูู ุฎูุงู ุฎุท ุฃูุงุจูุจ ุงููุนุงูุฌุ  ูุจุฏู ูู ุฃูู ุณุชููู ููุงู ุญุงุฌุฉ ุฅูู ุนุฏุฏ ุฃูู ูู ุงูุนูุงุฒุงุช ุฅุฐุง ุชู ุ ุจุงูุชูุงุฒู ูุน ุงูุชุนูููุงุช <code>funct</code> ุชูุดูุท <code>funct</code> ุงูุซุงููู ูุน <code>funct</code> ูููุฉ ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ ุงูุตุงุฏุฑุฉ ุชููุงุฆููุง.  ูู ุญูุซ ุงููุจุฏุฃ ุ ูุงู ุนูู ุฃูุถูุง ุฃู ุฃุนุฐุจ ููุณู ูุฐูู: ุญุชู ุฃููู ุชุนููุช ุงุณุชุฎุฏุงู SignalTap ุ ูุฃู ุชุตุญูุญ ุงูุฃุฎุทุงุก ููุงุฏ ูููู ุฃุนูู ุ ูุญุชู ูุน ุฅุนุงุฏุฉ ุชุฌููุน ุฎูุณ ุฏูุงุฆู ุจุนุฏ ุฃุฏูู ุชุบููุฑ (ุจุงุณุชุซูุงุก ุชุบููุฑ bootrom - ูู ุดูุก ุณุฑูุน ููุงู) - ูุฐุง ูุซูุฑ ุฌุฏูุง ุจุงููุนู. </p><br><p style=";text-align:right;direction:rtl">  ููุชูุฌุฉ ูุฐูู ุ ุชู ุชุตุญูุญ ูุญุฏุฉ ูู ุชุฑููุฒ ุงูุฃูุงูุฑ ูุชู "ุชุนุฏูู" ุฎุท ุงูุฃูุงุจูุจ ููููุงู ููุฑุงุนุงุฉ ุญูููุฉ ุฃูู ุจุบุถ ุงููุธุฑ ุนู ูุง ููููู ูุญุฏุฉ ูู ุงูุชุฑููุฒ ุนู ุงูุชุนูููุงุช ุงูุฃุตููุฉ ุ ูุฅู RoCC ุงูุฐู ุชู ุชูุดูุทู ูุฌุฃุฉ ูุง ูุนูู ุฃูู ุณูููู ููุงู ูุชุงุจุฉ ุฒูู ุงูุชูุงู ุทููู ุฅูู ุณุฌู ุงูุฅุฎุฑุงุฌ ุ ููุง ูู ุงูุญุงู ุฃุซูุงุก ุนูููุฉ ุงูุชูุณูู ูุงูุชูุฏ ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ููุจูุงูุงุช. </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ูุตู ุงูุชุนูููุงุช ูู ุฒูุฌ ([ููุท ููุชุนุฑู ุนูู ุชุนูููุฉ] ุ [ูุฌููุนุฉ ูู ุงูููู ูุชูููู ูุชู ูุณุงุฑ ุงูุจูุงูุงุช ูู ุงููุนุงูุฌ ุงูุฃุณุงุณู]).  ุนูู ุณุจูู ุงููุซุงู ุ ูุจุฏู ุงููุถุน <code>default</code> (ุชุนูููุฉ ุบูุฑ ูุนุชุฑู ุจูุง) ุจูุฐุง ุงูุดูู (ูุฃุฎูุฐ ูู <code>IDecode.scala</code> ุ ูู ุณุทุญ <code>IDecode.scala</code> ูุจุฏู ุ ุจุตุฑุงุญุฉ ุ ูุจูุญ): </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">default</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">BitPat</span></span>] = <span class="hljs-comment"><span class="hljs-comment">// jal renf1 fence.i // val | jalr | renf2 | // | fp_val| | renx2 | | renf3 | // | | rocc| | | renx1 s_alu1 mem_val | | | wfd | // | | | br| | | | s_alu2 | imm dw alu | mem_cmd mem_type| | | | mul | // | | | | | | | | | | | | | | | | | | | | | div | fence // | | | | | | | | | | | | | | | | | | | | | | wxd | | amo // | | | | | | | | scie | | | | | | | | | | | | | | | | | dp List(N,X,X,X,X,X,X,X,X,A2_X, A1_X, IMM_X, DW_X, FN_X, N,M_X, MT_X, X,X,X,X,X,X,X,CSR.X,X,X,X,X)</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ... ูุตููุง ูููุฐุฌููุง <em>ูุฃุญุฏ ุงูุงูุชุฏุงุฏุงุช</em> ุงูููุฌูุฏุฉ ูู Rocket core ูุชู ุชูููุฐู ูุซู ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IDecode</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">implicit val p: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Parameters</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DecodeConstants</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> table: <span class="hljs-type"><span class="hljs-type">Array</span></span>[(<span class="hljs-type"><span class="hljs-type">BitPat</span></span>, <span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">BitPat</span></span>])] = <span class="hljs-type"><span class="hljs-type">Array</span></span>( <span class="hljs-type"><span class="hljs-type">BNE</span></span>-&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>(<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">A2_RS2</span></span>, <span class="hljs-type"><span class="hljs-type">A1_RS1</span></span>, <span class="hljs-type"><span class="hljs-type">IMM_SB</span></span>,<span class="hljs-type"><span class="hljs-type">DW_X</span></span>, <span class="hljs-type"><span class="hljs-type">FN_SNE</span></span>, <span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">M_X</span></span>, <span class="hljs-type"><span class="hljs-type">MT_X</span></span>, <span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">CSR</span></span>.<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>), <span class="hljs-type"><span class="hljs-type">BEQ</span></span>-&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>(<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">A2_RS2</span></span>, <span class="hljs-type"><span class="hljs-type">A1_RS1</span></span>, <span class="hljs-type"><span class="hljs-type">IMM_SB</span></span>,<span class="hljs-type"><span class="hljs-type">DW_X</span></span>, <span class="hljs-type"><span class="hljs-type">FN_SEQ</span></span>, <span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">M_X</span></span>, <span class="hljs-type"><span class="hljs-type">MT_X</span></span>, <span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">CSR</span></span>.<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>), <span class="hljs-type"><span class="hljs-type">BLT</span></span>-&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>(<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">A2_RS2</span></span>, <span class="hljs-type"><span class="hljs-type">A1_RS1</span></span>, <span class="hljs-type"><span class="hljs-type">IMM_SB</span></span>,<span class="hljs-type"><span class="hljs-type">DW_X</span></span>, <span class="hljs-type"><span class="hljs-type">FN_SLT</span></span>, <span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">M_X</span></span>, <span class="hljs-type"><span class="hljs-type">MT_X</span></span>, <span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">CSR</span></span>.<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>), <span class="hljs-type"><span class="hljs-type">BLTU</span></span>-&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>(<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">A2_RS2</span></span>, <span class="hljs-type"><span class="hljs-type">A1_RS1</span></span>, <span class="hljs-type"><span class="hljs-type">IMM_SB</span></span>,<span class="hljs-type"><span class="hljs-type">DW_X</span></span>, <span class="hljs-type"><span class="hljs-type">FN_SLTU</span></span>, <span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">M_X</span></span>, <span class="hljs-type"><span class="hljs-type">MT_X</span></span>, <span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">CSR</span></span>.<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>), <span class="hljs-type"><span class="hljs-type">BGE</span></span>-&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>(<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">A2_RS2</span></span>, <span class="hljs-type"><span class="hljs-type">A1_RS1</span></span>, <span class="hljs-type"><span class="hljs-type">IMM_SB</span></span>,<span class="hljs-type"><span class="hljs-type">DW_X</span></span>, <span class="hljs-type"><span class="hljs-type">FN_SGE</span></span>, <span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">M_X</span></span>, <span class="hljs-type"><span class="hljs-type">MT_X</span></span>, <span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">CSR</span></span>.<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>), <span class="hljs-type"><span class="hljs-type">BGEU</span></span>-&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>(<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">Y</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">A2_RS2</span></span>, <span class="hljs-type"><span class="hljs-type">A1_RS1</span></span>, <span class="hljs-type"><span class="hljs-type">IMM_SB</span></span>,<span class="hljs-type"><span class="hljs-type">DW_X</span></span>, <span class="hljs-type"><span class="hljs-type">FN_SGEU</span></span>, <span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">M_X</span></span>, <span class="hljs-type"><span class="hljs-type">MT_X</span></span>, <span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">CSR</span></span>.<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>,<span class="hljs-type"><span class="hljs-type">N</span></span>), <span class="hljs-comment"><span class="hljs-comment">// ...</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุญูููุฉ ูู ุฃูู ูู RISC-V (ููุณ ููุท ูู RocketChip ุ ูููู ูู ุจููุฉ ุงูุฃูุงูุฑ ูู ุญูุซ ุงููุจุฏุฃ) ุชูุณูู ISA ุฅูู ูุฌููุนุฉ ูุฑุนูุฉ ุฅูุฒุงููุฉ I (ุนูููุงุช ุนุฏุฏ ุตุญูุญ) ุ ููุฐูู M ุงุฎุชูุงุฑู (ุนุฏุฏ ุตุญูุญ ูุชูุณูู) ุ A (ุฐุฑุงุช) ูุชู ุฏุนููุง ุจุงูุชุธุงู ุฅูุฎ </p><br><p style=";text-align:right;direction:rtl">  ูุชูุฌุฉ ูุฐูู ุ ุงูุทุฑููุฉ ุงูุฃุตููุฉ </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decode</span></span></span></span>(inst: <span class="hljs-type"><span class="hljs-type">UInt</span></span>, table: <span class="hljs-type"><span class="hljs-type">Iterable</span></span>[(<span class="hljs-type"><span class="hljs-type">BitPat</span></span>, <span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">BitPat</span></span>])]) = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> decoder = <span class="hljs-type"><span class="hljs-type">DecodeLogic</span></span>(inst, <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>, table) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> sigs = <span class="hljs-type"><span class="hljs-type">Seq</span></span>(legal, fp, rocc, branch, jal, jalr, rxs2, rxs1, scie, sel_alu2, sel_alu1, sel_imm, alu_dw, alu_fn, mem, mem_cmd, mem_type, rfs1, rfs2, rfs3, wfd, mul, div, wxd, csr, fence_i, fence, amo, dp) sigs zip decoder map {<span class="hljs-keyword"><span class="hljs-keyword">case</span></span>(s,d) =&gt; s := d} <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชู ุงุณุชุจุฏุงูู ุจู </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุณู ุ ูููู ูุน ูุญุฏุฉ ูู ุชุฑููุฒ ููุฃุฌูุฒุฉ ูุชูุถูุญ ุณุจุจ ุชูุนูู rocc</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decode</span></span></span></span>(inst: <span class="hljs-type"><span class="hljs-type">UInt</span></span>, table: <span class="hljs-type"><span class="hljs-type">Iterable</span></span>[(<span class="hljs-type"><span class="hljs-type">BitPat</span></span>, <span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">BitPat</span></span>])], handlers: <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">OpcodeHandler</span></span>]) = { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> decoder = <span class="hljs-type"><span class="hljs-type">DecodeLogic</span></span>(inst, <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>, table) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> sigs=<span class="hljs-type"><span class="hljs-type">Seq</span></span>(legal, fp, rocc_explicit, branch, jal, jalr, rxs2, rxs1, scie, sel_alu2, sel_alu1, sel_imm, alu_dw, alu_fn, mem, mem_cmd, mem_type, rfs1, rfs2, rfs3, wfd, mul, div, wxd, csr, fence_i, fence, amo, dp) sigs zip decoder map {<span class="hljs-keyword"><span class="hljs-keyword">case</span></span>(s,d) =&gt; s := d} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handlers.isEmpty) { handler_rocc := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> handler_rocc_funct := <span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> handlerTable: <span class="hljs-type"><span class="hljs-type">Seq</span></span>[(<span class="hljs-type"><span class="hljs-type">BitPat</span></span>, <span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">BitPat</span></span>])] = handlers.map { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">OpcodeHandler</span></span>(pattern, funct) =&gt; pattern -&gt; <span class="hljs-type"><span class="hljs-type">List</span></span>(<span class="hljs-type"><span class="hljs-type">Y</span></span>, <span class="hljs-type"><span class="hljs-type">BitPat</span></span>(funct.<span class="hljs-type"><span class="hljs-type">U</span></span>)) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> handlerDecoder = <span class="hljs-type"><span class="hljs-type">DecodeLogic</span></span>(inst, <span class="hljs-type"><span class="hljs-type">List</span></span>(<span class="hljs-type"><span class="hljs-type">N</span></span>, <span class="hljs-type"><span class="hljs-type">BitPat</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span><span class="hljs-type"><span class="hljs-type">U</span></span>)), handlerTable) <span class="hljs-type"><span class="hljs-type">Seq</span></span>(handler_rocc, handler_rocc_funct) zip handlerDecoder map { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (s,d) =&gt; s:=d } } rocc := rocc_explicit || handler_rocc <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> }</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูู ุงูุชุบููุฑุงุช ูู ุฎุท ุฃูุงุจูุจ ุงููุนุงูุฌ ุ ุฑุจูุง ูุงู ุงูุฃูุซุฑ ุบูุฑ ูุงุถุญูุง ุ ูุฐุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="diff hljs"> io.rocc.exception := wb_xcpt &amp;&amp; csr.io.status.xs.orR io.rocc.cmd.bits.status := csr.io.status io.rocc.cmd.bits.inst := new RoCCInstruction().fromBits(wb_reg_inst) + when (wb_ctrl.handler_rocc) { + io.rocc.cmd.bits.inst.opcode := 0x0b.U // custom0 + io.rocc.cmd.bits.inst.funct := wb_ctrl.handler_rocc_funct + io.rocc.cmd.bits.inst.xd := false.B + io.rocc.cmd.bits.inst.rd := 0.U + } io.rocc.cmd.bits.rs1 := wb_reg_wdata io.rocc.cmd.bits.rs2 := wb_reg_rs2</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงููุงุถุญ ุฃู ููุงู ุญุงุฌุฉ ุฅูู ุชุตุญูุญ ุจุนุถ ูุนููุงุช ุงูุทูุจ ุฅูู ุงููุนุฌู: ูุง ุชุชู ูุชุงุจุฉ ุฃู ุงุณุชุฌุงุจุฉ ุฅูู ุงูุณุฌู ุ <code>funct</code> ูุณุงููุฉ ููุง ุนุงุฏ ูุญุฏุฉ ูู ุงูุชุฑููุฒ.  ูููู ููุงู ุชุบููุฑ ุฃูู ูุถูุญูุง ููููุงู: ุงูุญูููุฉ ูู ุฃู ูุฐุง ุงูุฃูุฑ ูุง ููุชูู ูุจุงุดุฑุฉู ุฅูู ุงููุนุฌู (ุฃุฑุจุนุฉ ูููู - ุฃู ูุงุญุฏุ) ุ ููู ุฅูู ุงูููุฌู ุ ูุฐูู ุนููู ุงูุชุธุงูุฑ ุจุฃู ุงูุฃูุฑ ูุญุชูู ุนูู <code>opcode == custom0</code> (ูุนู ุ ุงูุนูููุฉ ุ ููุฐุง ูู ุจุงูุถุจุท ูุณุฑุน ุงูุตูุฑ!). </p><br><h2 id="proverka" style=";text-align:right;direction:rtl">  ุชูุชูุด </h2><br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ ุชูุชุฑุถ ูุฐู ุงูููุงูุฉ ุงุณุชูุฑุงุฑูุง ูู ูุญุงููุฉ ูุฑูุน ูุฐุง ุงูููุฌ ุฅูู ูุณุชูู ุฅูุชุงุฌ ุฃูุซุฑ ุฃู ุฃูู.  ูุญุฏ ุฃุฏูู ุ ูุฌุจ ุฃู ุชุชุนูู ุญูุธ ูุงุณุชุนุงุฏุฉ ุงูุณูุงู (ุญุงูุฉ ุณุฌูุงุช ุงููุนุงูุฌ ุงูุซุงููู) ุนูุฏ ุชุจุฏูู ุงูููุงู.  ูู ุบุถูู ุฐูู ุ ุณูู ุฃุชุญูู ูู ุฃูู ูุนูู ุจุทุฑููุฉ ูุง ูู ุธุฑูู ุงูุงุญุชุจุงุณ ุงูุญุฑุงุฑู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdint.h&gt; uint64_t counter; uint64_t funct1(uint64_t x, uint64_t y) { return __builtin_popcountl(x); } uint64_t funct2(uint64_t x, uint64_t y) { return (x + y) * (x - y); } uint64_t instMUL() { counter += 1; *((uint64_t *)0x81005000) = counter; return 0; }</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃุถู ุงูุขู ุฅูู <code>bootrom/sdboot/sd.c</code> ูู ุงูุณุทุฑ <code>main</code> </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/path/to/freedom-u-sdk/riscv-pk/machine/encoding.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// ... ////    -   RoCC #define STR1(x) #x #define STR(x) STR1(x) #define EXTRACT(a, size, offset) (((~(~0 &lt;&lt; size) &lt;&lt; offset) &amp; a) &gt;&gt; offset) #define CUSTOMX_OPCODE(x) CUSTOM_##x #define CUSTOM_0 0b0001011 #define CUSTOM_1 0b0101011 #define CUSTOM_2 0b1011011 #define CUSTOM_3 0b1111011 #define CUSTOMX(X, rd, rs1, rs2, funct) \ CUSTOMX_OPCODE(X) | \ (rd &lt;&lt; (7)) | \ (0x7 &lt;&lt; (7+5)) | \ (rs1 &lt;&lt; (7+5+3)) | \ (rs2 &lt;&lt; (7+5+3+5)) | \ (EXTRACT(funct, 7, 0) &lt;&lt; (7+5+3+5+5)) #define CUSTOMX_R_R_R(X, rd, rs1, rs2, funct) \ asm ("mv a4, %[_rs1]\n\t" \ "mv a5, %[_rs2]\n\t" \ ".word "STR(CUSTOMX(X, 15, 14, 15, funct))"\n\t" \ "mv %[_rd], a5" \ : [_rd] "=r" (rd) \ : [_rs1] "r" (rs1), [_rs2] "r" (rs2) \ : "a4", "a5"); int main(void) { // ... //  RoCC extension write_csr(mstatus, MSTATUS_XS &amp; (MSTATUS_XS &gt;&gt; 1)); //   bootrom       uint64_t res; CUSTOMX_R_R_R(0, res, 0xabcdef, 0x123456, 1); CUSTOMX_R_R_R(0, res, 0xabcdef, 0x123456, 2); // ...     uint64_t x = 1; for (int i = 0; i &lt; 123; ++i) x *= *(volatile uint8_t *)0x80000000; kputc('0' + x % 10); //   !!! // ... }</span></span></span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>write_csr</code> ,     <code>custom0</code> - <code>custom3</code> .      ,   illegal instruction,  ,  , ,   .   <code>define</code> -     - ,   ยซยป binutils  <code>customX</code>      RocketChip,  ,   ,   . </p><br><p style=";text-align:right;direction:rtl">     sdboot  ,       ,      . </p><br><p style=";text-align:right;direction:rtl">  : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$ /hdd/trosinenko/rocket-tools/bin/riscv32-unknown-elf-gdb -q -ex "target remote :3333" -ex "set directories bootrom" builds/zeowaa-e115/sdboot.elf Reading symbols from builds/zeowaa-e115/sdboot.elf...done. Remote debugging using :3333 0x0000000000000000 in ?? () (gdb) x/d 0x81005000 0x81005000: 123 (gdb) set variable $pc=0x10000 (gdb) c Continuing. ^C Program received signal SIGINT, Interrupt. 0x0000000000010488 in crc16_round (data=&lt;optimized out&gt;, crc=&lt;optimized out&gt;) at sd.c:151 151 crc ^= data; (gdb) x/d 0x81005000 0x81005000: 246</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"> funct1</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$ /hdd/trosinenko/rocket-tools/bin/riscv32-unknown-elf-gdb -q -ex "target remote :3333" -ex "set directories bootrom" builds/zeowaa-e115/sdboot.elf Reading symbols from builds/zeowaa-e115/sdboot.elf...done. Remote debugging using :3333 0x0000000000010194 in main () at sd.c:247 247 CUSTOMX_R_R_R(0, res, 0xabcdef, 0x123456, 1); (gdb) set variable $a5=0 (gdb) set variable $pc=0x10194 (gdb) set variable $a4=0xaa (gdb) display/10i $pc-10 1: x/10i $pc-10 0x1018a &lt;main+46&gt;: sw a3,124(a3) 0x1018c &lt;main+48&gt;: addiw a0,a0,1110 0x10190 &lt;main+52&gt;: mv a4,s0 0x10192 &lt;main+54&gt;: mv a5,a0 =&gt; 0x10194 &lt;main+56&gt;: 0x2f7778b 0x10198 &lt;main+60&gt;: mv s0,a5 0x1019a &lt;main+62&gt;: lbu a5,0(a1) 0x1019e &lt;main+66&gt;: addiw a3,a3,-1 0x101a0 &lt;main+68&gt;: mul a2,a2,a5 0x101a4 &lt;main+72&gt;: bnez a3,0x1019a &lt;main+62&gt; (gdb) display/x $a5 2: /x $a5 = 0x0 (gdb) si 0x0000000000010198 247 CUSTOMX_R_R_R(0, res, 0xabcdef, 0x123456, 1); 1: x/10i $pc-10 0x1018e &lt;main+50&gt;: li a0,25 0x10190 &lt;main+52&gt;: mv a4,s0 0x10192 &lt;main+54&gt;: mv a5,a0 0x10194 &lt;main+56&gt;: 0x2f7778b =&gt; 0x10198 &lt;main+60&gt;: mv s0,a5 0x1019a &lt;main+62&gt;: lbu a5,0(a1) 0x1019e &lt;main+66&gt;: addiw a3,a3,-1 0x101a0 &lt;main+68&gt;: mul a2,a2,a5 0x101a4 &lt;main+72&gt;: bnez a3,0x1019a &lt;main+62&gt; 0x101a6 &lt;main+74&gt;: li a5,10 2: /x $a5 = 0x4 (gdb) set variable $a4=0xaabc (gdb) set variable $pc=0x10194 (gdb) si 0x0000000000010198 247 CUSTOMX_R_R_R(0, res, 0xabcdef, 0x123456, 1); 1: x/10i $pc-10 0x1018e &lt;main+50&gt;: li a0,25 0x10190 &lt;main+52&gt;: mv a4,s0 0x10192 &lt;main+54&gt;: mv a5,a0 0x10194 &lt;main+56&gt;: 0x2f7778b =&gt; 0x10198 &lt;main+60&gt;: mv s0,a5 0x1019a &lt;main+62&gt;: lbu a5,0(a1) 0x1019e &lt;main+66&gt;: addiw a3,a3,-1 0x101a0 &lt;main+68&gt;: mul a2,a2,a5 0x101a4 &lt;main+72&gt;: bnez a3,0x1019a &lt;main+62&gt; 0x101a6 &lt;main+74&gt;: li a5,10 2: /x $a5 = 0x9</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุดูุฑุฉ ุงููุตุฏุฑ</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar461577/">https://habr.com/ru/post/ar461577/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar461565/index.html">ุงููุตุงูุง 5 ูู TypeScript ุงููุทูุฑ</a></li>
<li><a href="../ar461567/index.html">SQL. ูุณููุฉ ุงูุฃูุบุงุฒ</a></li>
<li><a href="../ar461569/index.html">ููุงุญุธุฉ ูููุงุฌูุฉ ุงูุฃูุงููุฉ: ูุง ูุฌุจ ุงูุชุญูู ูุจู ุงูุงุฎุชุจุงุฑ</a></li>
<li><a href="../ar461571/index.html">SVG ูู ุงูุญูุงุฉ ุงูุญููููุฉ. ุชูุฑูุฑ ูุงูุฏูุณ</a></li>
<li><a href="../ar461575/index.html">ุฅูุดุงุก PBX ุงููุณุชูุฏุฉ ุฅูู ูุฌููุนุฉ ุงููุธุฑุงุก 3CX ุนูู ุฃู ุงุณุชุถุงูุฉ ูุชูุงููุฉ ูุน Openstack</a></li>
<li><a href="../ar461579/index.html">ููุฏู WebMoney ูุญุงูุธ WMP ุฌุฏูุฏุฉ ููุบูุฑ ููุงุนุฏ ุงููุนุจุฉ</a></li>
<li><a href="../ar461583/index.html">ุจูุซูู ูููุณุงุนุฏุฉ ูู ุงุฎุชุจุงุฑ ุงูููุชุฌุงุช ุงููููููุฉ</a></li>
<li><a href="../ar461587/index.html">ุชูุทูู ุงูุชุทุจูู ูู 10 ุฎุทูุงุช</a></li>
<li><a href="../ar461589/index.html">ุชูู ุชุงู ุชู: ุฏูุฑุฉ ุงููุญุชูู</a></li>
<li><a href="../ar461593/index.html">API ุนูู F #. ุงููุตูู ุฅูู ูุญุฏุงุช ุงูุชุทุจูู ุงููุงุฆู ุนูู ุงูุฏูุฑ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>