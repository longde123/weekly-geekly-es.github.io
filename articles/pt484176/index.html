<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§úüèª üí± üíÜüèø Implementando o modelo de status no Unity üö´ üêõ üë¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No processo de programa√ß√£o de entidades no jogo, surgem situa√ß√µes em que elas devem agir em condi√ß√µes diferentes e de maneiras diferentes, o que suger...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implementando o modelo de status no Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484176/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fa/bf6/c19/4fabf6c19761d028d621903401a84746.png" alt="imagem"></div><br>  No processo de programa√ß√£o de entidades no jogo, surgem situa√ß√µes em que elas devem agir em condi√ß√µes diferentes e de maneiras diferentes, o que sugere o uso de <i>estados</i> . <br><br>  Mas se voc√™ decidir usar for√ßa bruta, o c√≥digo rapidamente se transformar√° em caos emaranhado com muitas instru√ß√µes if-else aninhadas. <br><br>  Para uma solu√ß√£o simples para esse problema, voc√™ pode usar o padr√£o de design do Estado.  Vamos dedicar este tutorial para ele! <br><br>  No tutorial voc√™: <br><br><ul><li>  Aprenda o b√°sico do modelo State no Unity. </li><li>  Voc√™ aprender√° o que √© uma m√°quina de estado e quando us√°-la. </li><li>  Aprenda a usar esses conceitos para controlar o movimento do seu personagem. </li></ul><br><blockquote>  <em>Nota</em> : este tutorial √© para usu√°rios avan√ßados;  presume-se que voc√™ j√° saiba trabalhar no Unity e tenha um n√≠vel m√©dio de conhecimento de C #.  Al√©m disso, este tutorial usa o Unity 2019.2 e C # 7. </blockquote><a name="habracut"></a><br><h2>  Come√ßando a trabalhar </h2><br>  Fa√ßa o download dos <a href="">materiais do projeto</a> .  Descompacte o <em>arquivo zip</em> e abra o projeto <em>inicial</em> no Unity. <br><br>  Existem v√°rias pastas no projeto que ajudar√£o voc√™ a come√ßar.  A pasta <em>Assets / RW</em> cont√©m as pastas <em>Animations</em> , <em>Materials</em> , <em>Models</em> , <em>Prefabs</em> , <em>Resources</em> , <em>Scenes</em> , <em>Scripts</em> e <em>Sounds</em> , nomeadas de acordo com os recursos que cont√™m. <br><br>  Para concluir o tutorial, trabalharemos apenas com <em>cenas</em> e <em>scripts</em> . <br><br>  V√° para <em>RW / Scenes</em> e abra <em>Main</em> .  No modo de jogo, voc√™ ver√° um personagem em uma capa dentro de um castelo medieval. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/478/f1b/4e1/478f1b4e1ec3a2e8702e365e4082a605.png"></div><br>  Clique em <em>Reproduzir</em> e observe como a <em>c√¢mera</em> se move para se ajustar ao quadro do <em>personagem</em> .  No momento, em nosso joguinho, n√£o h√° intera√ß√µes, trabalharemos nelas no tutorial. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ba3/62c/536/ba362c53682371294f90576b5fd5adc6.gif"></div><br><h2>  Explore o personagem </h2><br>  Na <em>hierarquia,</em> selecione <em>Caractere</em> .  Confira o <em>Inspetor</em> .  Voc√™ ver√° um <em>componente</em> com o mesmo nome que cont√©m a l√≥gica de controle de <em>caracteres</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/957/ffd/2ba/957ffd2ba0299d4b509b75bedb094581.png"></div><br>  Abra <em>Character.cs</em> localizado em <em>RW / Scripts</em> . <br><br>  O script executa muitas a√ß√µes, mas a maioria delas n√£o √© importante para n√≥s.  Por enquanto, vamos prestar aten√ß√£o aos seguintes m√©todos. <br><br><ul><li> <code>Move</code> : move o personagem, recebendo valores do tipo <code>speed</code> flutua√ß√£o como velocidade de movimento e <code>rotationSpeed</code> velocidade como velocidade angular. </li><li>  <code>ResetMoveParams</code> : esse m√©todo redefine os par√¢metros usados ‚Äã‚Äãpara <i>animar o movimento</i> e a velocidade angular do caractere.  √â usado apenas para limpeza. </li><li>  <code>SetAnimationBool</code> : Define o <code>param</code> anima√ß√£o <code>param</code> do tipo Bool como valor. </li><li>  <code>CheckCollisionOverlap</code> : recebe um <code></code> tipo <code>Vector3</code> e retorna um <code>bool</code> que determina se existem coletores dentro do raio especificado a partir do <code></code> . </li><li>  <code>TriggerAnimation</code> : <code>TriggerAnimation</code> o <code>param</code> anima√ß√£o do par√¢metro de entrada. </li><li>  <code>ApplyImpulse</code> : <code>ApplyImpulse</code> pulso ao caractere igual √† <code>force</code> par√¢metro de entrada <code>force</code> tipo <code>Vector3</code> . </li></ul><br>  Abaixo voc√™ ver√° esses m√©todos.  Em nosso tutorial, seu conte√∫do e trabalho interno n√£o s√£o importantes. <br><br><h2>  O que s√£o m√°quinas de estado </h2><br>  Uma m√°quina de estado √© um conceito em que um cont√™iner armazena o estado de algo em um determinado momento no tempo.  Com base nos dados de entrada, ele pode fornecer uma conclus√£o dependendo do estado atual, passando esse processo para um novo estado.  M√°quinas de estado podem ser representadas como um <a href="https://www.geeksforgeeks.org/unified-modeling-language-uml-state-diagrams/" rel="noopener">diagrama de estado</a> .  A prepara√ß√£o de um diagrama de estados permite refletir sobre todos os estados poss√≠veis do sistema e as transi√ß√µes entre eles. <br><br><h3>  M√°quinas de estado </h3><br>  <em>M√°quinas de estado finito</em> ou <em>FSM (m√°quina de estado finito)</em> √© uma das quatro principais fam√≠lias de <em>m√°quinas</em> .  Os aut√¥matos s√£o modelos abstratos de m√°quinas simples.  Eles s√£o estudados no √¢mbito da <a href="https://cs.stanford.edu/people/eroberts/courses/soco/projects/2004-05/automata-theory/basics.html" rel="noopener"><em>teoria dos aut√¥matos</em></a> - o ramo te√≥rico da ci√™ncia da computa√ß√£o. <br><br>  Em poucas palavras: <br><br><ul><li>  O FSM consiste em uma quantidade finita de <em>condi√ß√£o</em> .  A qualquer momento <em>,</em> apenas um desses estados est√° <em>ativo</em> . </li><li>  Cada estado determina em qual estado entrar√° como uma <em>sa√≠da com</em> base na sequ√™ncia <em>recebida das informa√ß√µes recebidas</em> . </li><li>  O estado de sa√≠da se torna o novo estado ativo.  Em outras palavras, h√° uma <em>transi√ß√£o entre estados</em> . </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c43/111/f04/c43111f045f3727ab5f3b02c05c6ecc2.png"></div><br>  Para entender melhor isso, considere o car√°ter de um jogo de plataforma que est√° no terreno.  O personagem est√° no estado <i>Permanente</i> .  Este ser√° o seu <em>estado ativo</em> at√© o jogador pressionar o bot√£o para que o personagem salte. <br><br>  O estado <i>Permanente</i> identifica o pressionar de um bot√£o como uma <em>entrada</em> significativa e, como <em>sa√≠da</em> , alterna para o estado <i>Salto</i> . <br><br>  Suponha que exista um certo n√∫mero desses estados de movimento e que um personagem possa estar apenas em um dos estados de cada vez.  Este √© um exemplo de FSM. <br><br><h3>  M√°quinas de estado hier√°rquico </h3><br>  Considere um jogo de plataformas usando FSM, no qual v√°rios estados compartilham uma l√≥gica f√≠sica comum.  Por exemplo, voc√™ pode mover e pular nos estados <em>Agachado</em> e <em>Parado</em> .  Nesse caso, v√°rias vari√°veis ‚Äã‚Äãrecebidas levam ao mesmo comportamento e sa√≠da de informa√ß√µes para dois estados diferentes. <br><br>  Em tal situa√ß√£o, seria l√≥gico delegar o comportamento geral a algum outro estado.  Felizmente, isso pode ser alcan√ßado usando m√°quinas de estado <em>hier√°rquico</em> . <br><br>  Em um FSM hier√°rquico, h√° <em>subestados</em> delegando informa√ß√µes <i>brutas de</i> entrada em seus <em>subestados</em> .  Isso, por sua vez, permite reduzir graciosamente o tamanho e a complexidade do FSM, mantendo sua l√≥gica. <br><br><h2>  Modelo de status </h2><br>  Em seu livro <i>Design Patterns: Elements of Reusable Oriented Object Software,</i> Erich Gamma, Richard Helm, Ralph Johnson e John Vlissidis ( <em>The Gang of Four</em> ) definiram a <i>tarefa</i> do modelo State da seguinte maneira: <br><br>  ‚ÄúEle deve permitir que o objeto mude seu comportamento quando seu estado interno mudar.  Nesse caso, parece que o objeto mudou de classe. ‚Äù <br><br>  Para entender melhor isso, considere o seguinte exemplo: <br><br><ul><li>  Um script que recebe informa√ß√µes de entrada para a l√≥gica do movimento √© anexado a uma entidade no jogo. </li><li>  Essa classe armazena uma vari√°vel de <i>estado atual</i> que simplesmente se refere a uma inst√¢ncia da classe de <i>estado</i> . </li><li>  As informa√ß√µes recebidas s√£o delegadas para esse estado atual, que as processa e cria um comportamento definido dentro de si.  Ele tamb√©m lida com as transi√ß√µes de estado necess√°rias. </li></ul><br>  Portanto, devido ao fato de que, em momentos diferentes, a vari√°vel de <i>estado atual</i> se refere a estados diferentes, parece que a mesma classe de script se comporta de maneira diferente.  Essa √© a ess√™ncia do modelo "Status". <br><br>  Em nosso projeto, a classe <em>Character</em> mencionada se comportar√° de maneira diferente, dependendo dos diferentes estados.  Mas precisamos que ele se comporte! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d8/d20/f59/3d8d20f5921bf342b2ac84b5677e9a3b.png"></div><br>  No caso geral, existem tr√™s pontos principais para cada classe de estado que permitem o comportamento do estado como um todo: <br><br><ul><li>  <em>Entrada</em> : √© o momento em que uma entidade entra em um estado e executa a√ß√µes que precisam ser executadas apenas uma vez ao entrar no estado. </li><li>  <em>Sa√≠da</em> : semelhante √† entrada - todas as opera√ß√µes de redefini√ß√£o s√£o executadas aqui, que devem ser executadas apenas antes que o estado mude. </li><li>  <em>Loop de atualiza√ß√£o</em> : Aqui est√° a <i>l√≥gica</i> b√°sica de <i>atualiza√ß√£o</i> que √© executada em cada quadro.  Pode ser dividido em v√°rias partes, por exemplo, um ciclo para atualizar a f√≠sica e um ciclo para processar a entrada do jogador. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a26/847/8e6/a268478e6da2566cc58d1083fefed27f.png"></div><br><h3>  Definindo um estado e uma m√°quina de estado </h3><br>  V√° para <em>RW / Scripts</em> e abra <em>StateMachine.cs</em> . <br><br>  <em>A M√°quina de Estado</em> , como voc√™ pode imaginar, fornece uma abstra√ß√£o para a m√°quina de estado.  Observe que o <code>CurrentState</code> localizado corretamente dentro desta classe.  Ele armazenar√° um link para o estado atual da m√°quina de estado ativo. <br><br>  Agora, para definir o conceito de <i>estado</i> , vamos para <em>RW / Scripts</em> e abra o script <em>State.cs</em> no IDE. <br><br>  <em>State</em> √© uma classe abstrata que usaremos como <i>modelo a</i> partir do qual todas as <i>classes de estados do</i> projeto s√£o derivadas.  Parte do c√≥digo nos materiais do projeto j√° est√° pronta. <br><br>  <code>DisplayOnUI</code> exibe apenas o nome do estado atual na interface do usu√°rio na tela.  Voc√™ n√£o precisa conhecer seu dispositivo interno, apenas entenda que ele recebe um enumerador do tipo <code>UIManager.Alignment</code> como um par√¢metro de entrada, que pode ser <code>Left</code> ou <code>Right</code> .  A exibi√ß√£o do nome do status na parte inferior esquerda ou direita da tela depende disso. <br><br>  Al√©m disso, existem duas vari√°veis ‚Äã‚Äãprotegidas, <code>character</code> e <code>stateMachine</code> .  A vari√°vel de <code>character</code> refere-se a uma inst√¢ncia da classe <em>Character</em> e <code>stateMachine</code> refere-se a uma inst√¢ncia <em>da m√°quina de estados</em> associada ao estado. <br><br>  Ao criar uma inst√¢ncia de estado, o construtor vincula o <code>character</code> e <code>stateMachine</code> . <br><br>  Cada uma das muitas inst√¢ncias de <code>Character</code> em uma cena pode ter seu pr√≥prio conjunto de estados e m√°quinas de estados. <br><br>  Agora adicione os seguintes m√©todos ao <em>State.cs</em> e salve o arquivo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { DisplayOnUI(UIManager.Alignment.Left); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { }</code> </pre> <br>  Esses m√©todos virtuais definem os principais pontos de status descritos acima.  Quando <em>a m√°quina de estados</em> faz uma transi√ß√£o entre estados, chamamos <code>Exit</code> para o estado anterior e <code>Enter</code> novo <i>estado ativo</i> . <br><br>  <code>HandleInput</code> , <code>LogicUpdate</code> e <code>PhysicsUpdate</code> juntos definem <i>um loop de atualiza√ß√£o</i> .  <code>HandleInput</code> lida com a entrada do player.  <code>LogicUpdate</code> processa a l√≥gica b√°sica, enquanto o <code>PhyiscsUpdate</code> processa os c√°lculos da l√≥gica e da f√≠sica. <br><br>  Agora abra <em>StateMachine.cs</em> novamente, adicione os seguintes m√©todos e salve o arquivo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">State startingState</span></span></span><span class="hljs-function">)</span></span> { CurrentState = startingState; startingState.Enter(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChangeState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">State newState</span></span></span><span class="hljs-function">)</span></span> { CurrentState.Exit(); CurrentState = newState; newState.Enter(); }</code> </pre> <br>  <code>Initialize</code> configura a m√°quina de estado, definindo <code>CurrentState</code> como <code>CurrentState</code> e chamando <code>Enter</code> para ela.  Isso inicializa a m√°quina de estado, definindo pela primeira vez o estado ativo. <br><br>  <code>ChangeState</code> lida com transi√ß√µes de <em>estado</em> .  Ele chama <code>Exit</code> para o antigo <code>CurrentState</code> antes de substituir sua refer√™ncia por <code>newState</code> .  No final, chama <code>Enter</code> para <code>newState</code> . <br><br>  Assim, definimos o <em>estado</em> e a <em>m√°quina de estado</em> . <br><br><h3>  Criando estados de movimento </h3><br>  Veja o diagrama de estados a seguir, que mostra os diferentes <i>estados de movimento da</i> ess√™ncia <i>do</i> jogador no jogo.  Nesta se√ß√£o, implementamos o modelo "Status" para o <i>movimento</i> mostrado na figura <i>FSM</i> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fa/bf6/c19/4fabf6c19761d028d621903401a84746.png"></div><br>  Preste aten√ß√£o aos estados de movimento, como <em>Permanente</em> , <em>Ducking</em> e <em>Jumping</em> , bem como como os dados recebidos causam transi√ß√µes entre os estados.  Este √© um FSM hier√°rquico no qual <em>Grounded</em> √© um <em>subestado</em> dos <em>subestados Ducking</em> e <em>Standing</em> . <br><br>  Retorne ao Unity e v√° para <em>RW / Scripts / States</em> .  L√° voc√™ encontrar√° v√°rios arquivos C # com nomes que terminam em <i>State</i> . <br><br>  Cada um desses arquivos define uma classe, cada uma das quais √© herdada do <code>State</code> .  Portanto, essas classes definem os estados que usaremos no projeto. <br><br>  Agora abra <em>Character.cs</em> na pasta <em>RW / Scripts</em> . <br><br>  Role acima do arquivo <code>#region Variables</code> e adicione o seguinte c√≥digo: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StateMachine movementSM; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StandingState standing; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DuckingState ducking; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> JumpingState jumping;</code> </pre> <br>  Este <code>movementSM</code> refere-se a uma m√°quina de estado que processa a l√≥gica de movimento da inst√¢ncia <code>Character</code> .  Tamb√©m adicionamos links para tr√™s estados que implementamos para cada tipo de movimento. <br><br>  V√° para <code>#region MonoBehaviour Callbacks</code> no mesmo arquivo.  Adicione os seguintes m√©todos <a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.html" rel="noopener">MonoBehaviour</a> e salve <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { movementSM = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StateMachine(); standing = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StandingState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, movementSM); ducking = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DuckingState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, movementSM); jumping = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JumpingState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, movementSM); movementSM.Initialize(standing); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { movementSM.CurrentState.HandleInput(); movementSM.CurrentState.LogicUpdate(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { movementSM.CurrentState.PhysicsUpdate(); }</code> </pre> <br><ul><li>  Em <code>Start</code> c√≥digo cria uma inst√¢ncia da <em>M√°quina de Estado</em> e a atribui a <code>movementSM</code> , al√©m de instanciar v√°rios estados de movimento.  Ao criar cada um dos estados de movimento, passamos refer√™ncias √† inst√¢ncia <code>Character</code> usando a <code>this</code> , bem como a inst√¢ncia MovementSM.  No final, chamamos <code>Initialize</code> para o <code>movementSM</code> e passamos <code>Standing</code> como o estado inicial. </li><li>  No m√©todo <code>Update</code> , chamamos <code>HandleInput</code> e <code>LogicUpdate</code> para o <code>CurrentState</code> da m√°quina <code>LogicUpdate</code> .  Da mesma forma, em <code>FixedUpdate</code> chamamos <code>PhysicsUpdate</code> para o <code>CurrentState</code> da m√°quina <code>PhysicsUpdate</code> .  Em ess√™ncia, isso delega tarefas para um estado ativo;  esse √© o significado do modelo "Status". </li></ul><br>  Agora precisamos definir o comportamento dentro de cada um dos estados de movimento.  Prepare-se, haver√° muito c√≥digo! <br><br><h3>  Empresa Permanente </h3><br>  Retorne para <em>RW / Scripts / States</em> na janela Projeto. <br><br>  Abra <em>Grounded.cs</em> e observe que esta classe possui um construtor que corresponde ao construtor <code>State</code> .  Isso √© l√≥gico porque essa classe √© herdada dela.  Voc√™ ver√° a mesma coisa em todas as outras classes de <i>estado</i> . <br><br>  Adicione o seguinte c√≥digo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); horizontalInput = verticalInput = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Exit(); character.ResetMoveParams(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.HandleInput(); verticalInput = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>); horizontalInput = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.PhysicsUpdate(); character.Move(verticalInput * speed, horizontalInput * rotationSpeed); }</code> </pre> <br>  Aqui est√° o que acontece aqui: <br><br><ul><li>  Redefinimos um dos m√©todos virtuais definidos na classe pai.  Para preservar toda a funcionalidade que possa existir no pai, chamamos o m√©todo <code>base</code> com o mesmo nome de cada m√©todo substitu√≠do.  Este √© um modelo importante que continuaremos a usar. </li><li>  A pr√≥xima linha, <code>Enter</code> define <code>horizontalInput</code> e <code>verticalInput</code> seus valores padr√£o. </li><li>  Dentro da <code>Exit</code> como mencionado acima, chamamos o m√©todo <code>ResetMoveParams</code> <code></code> para redefinir ao mudar para outro estado. </li><li>  No m√©todo <code>HandleInput</code> , as vari√°veis <code>horizontalInput</code> e <code>verticalInput</code> <code>HandleInput</code> valores dos eixos de entrada horizontal e vertical.  Gra√ßas a isso, o jogador pode controlar o personagem usando as teclas <em>W</em> , <em>A</em> , <em>S</em> e <em>D.</em> </li><li>  No <code>PhysicsUpdate</code> fazemos uma chamada <code>Move</code> , passando as vari√°veis <code>horizontalInput</code> e <code>verticalInput</code> multiplicadas pelas velocidades correspondentes.  Na <code>speed</code> vari√°vel <code>speed</code> a velocidade do movimento √© armazenada e, na <code>rotationSpeed</code> , a velocidade angular. </li></ul><br>  Agora abra o <em>Standing.cs</em> e preste aten√ß√£o ao fato de ele herdar do <code>Grounded</code> .  Isso aconteceu porque, como dissemos acima, <em>ficar em p√©</em> √© um subestado da <em>Grounded</em> .  Existem diferentes maneiras de implementar esse relacionamento, mas neste tutorial usamos heran√ßa. <br><br>  Adicione os seguintes m√©todos de <code>override</code> e salve o script: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); speed = character.MovementSpeed; rotationSpeed = character.RotationSpeed; crouch = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; jump = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.HandleInput(); crouch = Input.GetButtonDown(<span class="hljs-string"><span class="hljs-string">"Fire3"</span></span>); jump = Input.GetButtonDown(<span class="hljs-string"><span class="hljs-string">"Jump"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.LogicUpdate(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (crouch) { stateMachine.ChangeState(character.ducking); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (jump) { stateMachine.ChangeState(character.jumping); } }</code> </pre> <br><ul><li>  Em <code>Enter</code> configuramos as vari√°veis ‚Äã‚Äãherdadas do <code>Grounded</code> .  Aplique o <code>MovementSpeed</code> e <code>RotationSpeed</code> personagem para <code>speed</code> e <code>rotationSpeed</code> .  Ent√£o eles se relacionam, respectivamente, com a velocidade <i>normal</i> de movimento e a velocidade angular destinada √† ess√™ncia do personagem. <br><br>  Al√©m disso, as vari√°veis ‚Äã‚Äãpara armazenar entradas de <code>crouch</code> e <code>jump</code> s√£o redefinidas para false. </li><li>  Dentro do <code>HandleInput</code> , as vari√°veis ‚Äã‚Äãde <code>crouch</code> e <code>jump</code> armazenam a entrada do jogador para agachamentos e saltos.  Se na cena principal o jogador pressionar a <em>tecla Shift, o</em> agachamento ser√° definido como verdadeiro.  Da mesma forma, um jogador pode usar a tecla <em>Espa√ßo</em> para <code>jump</code> . </li><li>  No <code>LogicUpdate</code> verificamos as vari√°veis ‚Äã‚Äãde <code>crouch</code> e <code>jump</code> do tipo <code>bool</code> .  Se <code>crouch</code> for true, o <code>movementSM.CurrentState</code> muda para <code>character.ducking</code> .  Se o <code>jump</code> for verdadeiro, o estado mudar√° para <code>character.jumping</code> . </li></ul><br>  Salve e monte o projeto e clique em <em>Play</em> .  Voc√™ pode se mover pela cena usando as teclas <em>W</em> , <em>A</em> , <em>S</em> e <em>D.</em>  Se voc√™ tentar pressionar <em>Shift</em> ou <em>Espa√ßo</em> , ocorrer√° um comportamento inesperado, porque os estados correspondentes ainda n√£o foram implementados. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/450/89a/564/45089a5640a8d492b20ac5948e0fdf69.gif"></div><br>  Tente mover-se sob os objetos da tabela.  Voc√™ ver√° que, devido √† altura do colisor do personagem, isso n√£o √© poss√≠vel.  Para que o personagem fa√ßa isso, voc√™ precisa adicionar um comportamento de agachamento. <br><br><h3>  Subimos debaixo da mesa </h3><br>  Abra o script <em>Ducking.cs</em> .  Observe que <code>Ducking</code> tamb√©m herda da classe <code>Grounded</code> pelos mesmos motivos que <code>Standing</code> .  Adicione os seguintes m√©todos de <code>override</code> e salve o script: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); character.SetAnimationBool(character.crouchParam, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); speed = character.CrouchSpeed; rotationSpeed = character.CrouchRotationSpeed; character.ColliderSize = character.CrouchColliderHeight; belowCeiling = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Exit(); character.SetAnimationBool(character.crouchParam, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); character.ColliderSize = character.NormalColliderHeight; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.HandleInput(); crouchHeld = Input.GetButton(<span class="hljs-string"><span class="hljs-string">"Fire3"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.LogicUpdate(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(crouchHeld || belowCeiling)) { stateMachine.ChangeState(character.standing); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.PhysicsUpdate(); belowCeiling = character.CheckCollisionOverlap(character.transform.position + Vector3.up * character.NormalColliderHeight); }</code> </pre> <br><ul><li>  Dentro de <code>Enter</code> par√¢metro que causa a altern√¢ncia da anima√ß√£o de agachamento √© definido como agachado, o que ativa a anima√ß√£o de agachamento.  As propriedades <code>character.CrouchSpeed</code> e <code>character.CrouchRotationSpeed</code> recebem os valores de <code>speed</code> e <code>rotation</code> , que retornam o movimento e a velocidade angular do personagem ao se <i>mover em um agachamento</i> . <br><br>  Em seguida, <code>character.CrouchColliderHeight</code> define o tamanho do colisor do personagem, que retorna a altura desejada do colisor ao se agachar.  No final, o <code>belowCeiling</code> redefinido para falso. </li><li>  Dentro de <code>Exit</code> o par√¢metro de anima√ß√£o de agachamento √© definido como falso.  Isso desativa a anima√ß√£o de agachamento.  Em seguida, a altura normal do colisor √© definida, retornada por <code>character.NormalColliderHeight</code> . </li><li>  Dentro de <code>HandleInput</code> vari√°vel <code>crouchHeld</code> define o valor de entrada do player.  Na cena <em>principal</em> , segurar <em>Shift</em> define <code>crouchHeld</code> como true. </li><li>  Dentro de <code>PhysicsUpdate</code> vari√°vel <code>belowCeiling</code> recebe um valor passando um ponto no formato <code>Vector3</code> com a cabe√ßa do objeto de jogo do personagem para o m√©todo <code>CheckCollisionOverlap</code> .  Se houver uma colis√£o perto deste ponto, isso significa que o personagem est√° sob algum tipo de teto. </li><li>  Internamente, o <code>LogicUpdate</code> verifica se <code>crouchHeld</code> ou <code>belowCeiling</code> √© verdadeiro.  Se nenhum deles for verdadeiro, o <code>movementSM.CurrentState</code> alterado para <code>character.standing</code> . </li></ul><br>  Crie o projeto e clique em <em>Play</em> .  Agora voc√™ pode se mover pela cena.  Se voc√™ pressionar <em>Shift</em> , o personagem se sentar√° e voc√™ poder√° se mover no agachamento. <br><br>  Voc√™ tamb√©m pode subir sob a plataforma.  Se voc√™ liberar <em>Shift</em> enquanto estiver sob as plataformas, o personagem ainda estar√° agachado at√© que ele deixe seu abrigo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee4/dce/657/ee4dce657ae6be49244106652a168a3a.gif"></div><br><h3>  Suba! </h3><br>  Abra <em>Jumping.cs</em> .  Voc√™ ver√° um m√©todo chamado <code>Jump</code> .  N√£o se preocupe com como isso funciona;  basta entender que √© usado para que o personagem possa pular, levando em considera√ß√£o a f√≠sica e a anima√ß√£o. <br><br>  Agora adicione os m√©todos de <code>override</code> comuns e salve o script <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); SoundManager.Instance.PlaySound(SoundManager.Instance.jumpSounds); grounded = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; Jump(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.LogicUpdate(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (grounded) { character.TriggerAnimation(landParam); SoundManager.Instance.PlaySound(SoundManager.Instance.landing); stateMachine.ChangeState(character.standing); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.PhysicsUpdate(); grounded = character.CheckCollisionOverlap(character.transform.position); }</code> </pre> <br><ul><li>  Dentro de <code>Enter</code> <code>SoundManager</code> reproduz o som do salto.  <code>grounded</code> redefinido para seu valor padr√£o.  No final, <code>Jump</code> √© chamado. </li><li>  Dentro do <code>PhysicsUpdate</code> ponto <code>PhysicsUpdate</code> ao lado das pernas do personagem √© enviado para o <code>CheckCollisionOverlap</code> , o que significa que, quando o personagem estiver no ch√£o, o <code>grounded</code> ser√° definido como verdadeiro. </li><li>  No <code>LogicUpdate</code> , se o <code>grounded</code> for verdadeiro, chamamos <code>TriggerAnimation</code> para ativar a anima√ß√£o de touchdown, o som do touchdown √© reproduzido e o <code>movementSM.CurrentState</code> muda para <code>character.standing</code> . </li></ul><br>  Portanto, conclu√≠mos a implementa√ß√£o completa do deslocamento do FSM usando <em>o modelo "State"</em> .  Crie o projeto e execute-o.  Pressione <em>espa√ßo</em> para fazer o personagem pular. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebd/e16/05d/ebde1605dc739588529c51509e19c0a8.gif"></div><br><h2>  Para onde ir a seguir? </h2><br>  Os <a href="">materiais do projeto</a> t√™m um projeto preliminar e um projeto finalizado. <br><br>  Apesar de sua utilidade, as m√°quinas de estado t√™m limita√ß√µes.  M√°quinas de estado simult√¢neas e m√°quinas de aut√¥mato de empilhamento podem lidar com algumas dessas limita√ß√µes.  Voc√™ pode ler sobre eles no livro de Robert Nystrom <a href="https://gameprogrammingpatterns.com/state.html" rel="noopener"><em>Game Programming Patterns</em></a> . <br><br>  Al√©m disso, o t√≥pico pode ser explorado mais profundamente, explorando as <a href="https://en.wikipedia.org/wiki/Behavior_tree_(artificial_intelligence,_robotics_and_control)" rel="noopener"><em>√°rvores de comportamento</em></a> usadas para criar entidades mais complexas no jogo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484176/">https://habr.com/ru/post/pt484176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484164/index.html">A hist√≥ria dos livros e o futuro das bibliotecas</a></li>
<li><a href="../pt484166/index.html">VVVVVV ??? VVVVVV !!! :)</a></li>
<li><a href="../pt484168/index.html">Escrevemos nossa estrat√©gia de rolagem virtual a partir do Angular CDK</a></li>
<li><a href="../pt484172/index.html">Integra√ß√£o cont√≠nua no Unity: como reduzir o tempo de montagem e economizar recursos + linha de pagamento como presente</a></li>
<li><a href="../pt484174/index.html">Beber em castelo em condi√ß√µes "extremas" ou como participamos do show "DOZOR"</a></li>
<li><a href="../pt484178/index.html">Switch Ethernet inteligente para o planeta Terra</a></li>
<li><a href="../pt484180/index.html">PBX virtual Rostelecom: o que e como pode ser feito atrav√©s da API</a></li>
<li><a href="../pt484182/index.html">Xenobots: nanorob√¥s vivos de c√©lulas de sapo</a></li>
<li><a href="../pt484186/index.html">LDAP - "autentica√ß√£o" √© um antipadr√£o</a></li>
<li><a href="../pt484188/index.html">Padr√µes de Design de Banco de Dados</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>