<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíî ü•• üèçÔ∏è Erstellen einer automatisierten Testpipeline auf Azure DevOps ü¶í ü§µüèª üë®‚Äçüëß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="K√ºrzlich bin ich auf ein nicht so beliebtes Tier in der DevOps-Welt gesto√üen, Azure DevOps-Pipelines. Ich hatte sofort das Gef√ºhl, dass keine klaren A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erstellen einer automatisierten Testpipeline auf Azure DevOps</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460431/">  K√ºrzlich bin ich auf ein nicht so beliebtes Tier in der DevOps-Welt gesto√üen, Azure DevOps-Pipelines.  Ich hatte sofort das Gef√ºhl, dass keine klaren Anweisungen oder Artikel zu diesem Thema vorhanden waren. Ich wei√ü nicht, womit es verbunden ist, aber Microsoft hat eindeutig etwas zu tun, um das Tool bekannt zu machen.  Heute werden wir eine Pipeline f√ºr automatisierte Tests in der Azure-Cloud erstellen. <a name="habracut"></a><br><br>  Also die Aufgabe: <br>  Es gibt Software, die mit denselben Azure DevOps erstellt und aus einem Projekt unter WIX zusammengestellt wird.  Bei Interesse werde ich √ºber dieses Tool schreiben.  Tats√§chlich ist dies eine automatisiertere Methode zum Erstellen von Windows-Installationsprogrammen, die das Standard-InstallShield ersetzt.  Unsere Software erstellt und generiert also erfolgreich ein Artefakt, eine bestimmte setup.exe, mit der die Anwendung auf einem Windows-System installiert wird.  Es ist erforderlich, diese Anwendung in eine virtuelle Maschine zu integrieren, die einem Produkt √§hnelt, die vom dortigen Testteam vorbereiteten automatisierten Tests zu kopieren, auszuf√ºhren und die Ergebnisse zu sammeln, um den Zweig vor dem Zusammenf√ºhren als gut oder schlecht zu betrachten.  Alles ist wie in GitLab, <s>nur durch w ....</s> <br><br>  Als Virtualisierungsumgebung, in der wir unsere Tests ausf√ºhren, verwenden wir offensichtlich Azure DevTest Labs, eine Entit√§t in Azure-Abonnements, die erstellt wurde, um alle Arten von Test-Unsinn f√ºr angemessenes Geld zu verdrehen. <br><br><h1>  1. Cloud-seitige Integration </h1><br>  Zun√§chst m√ºssen wir unsere DevTest Labs in Azure DevOps integrieren, f√ºr die wir einen Service Principal ben√∂tigen, im Wesentlichen ein Servicekonto, mit dem Sie zu den Pipelines in der Cloud gehen und dort Ressourcen f√ºr uns selbst erstellen / l√∂schen k√∂nnen. <br><br>  Wechseln Sie zum Abonnement und suchen Sie den Azure Active Directory-Dienst <br><br><img src="https://habrastorage.org/webt/cf/fn/bq/cffnbqsgvtmscikoypqdftkarpg.jpeg"><br><br>  Wir finden App-Registrierungen und klicken auf Neue Registrierung. Dadurch wird unser Service-Prinzip erstellt.  Ich werde nicht dar√ºber nachdenken, welche Einstellungen ich beim Erstellen ausw√§hlen werde. Dies kann f√ºr verschiedene Abonnements unterschiedlich sein. <br><br><img src="https://habrastorage.org/webt/ns/4a/jq/ns4ajqbtui4oz51gruhl84gejac.jpeg"><br><br>  Jetzt m√ºssen wir unserem Serviceleiter Rechte einr√§umen.  Gehen Sie dazu mit einem Schl√ºssel zum Abonnementsymbol.  W√§hlen Sie unser Abonnement. <br><br><img src="https://habrastorage.org/webt/-p/tj/te/-ptjtehk7ftpdtlf4op0dwlqj9g.jpeg"><br><br>  Klicken Sie anschlie√üend in der Zugriffssteuerung auf Rollenzuweisung und suchen Sie dieses Konto in der Suche anhand des soeben erstellten Namens.  Wir geben die Rolle des Mitwirkenden, das ist genug. <br><br><img src="https://habrastorage.org/webt/pr/nq/s_/prnqs_0culpmj9xrudzptpv4mc0.jpeg"><br><br>  Kehren Sie anschlie√üend zu unserem Dienstprinzipal in Azure AD zur√ºck und √∂ffnen Sie dessen Eigenschaften.  Sp√§ter ben√∂tigen wir alle dort vorhandenen IDs, wir speichern sie. <br><br>  Hier enden unsere Portaleinstellungen und wir wechseln zu Azure DevOps. <br><br><h1>  2. Integration auf der Seite von Azure DevOps </h1><br>  Zun√§chst gehen wir in die Projekteinstellungen und w√§hlen Serviceverbindungen.  Erstellen Sie ein neues Element vom Typ Azure Resource Manager. <br><br><img src="https://habrastorage.org/webt/ct/hc/7c/cthc7c3qagkfuyxa3_6fyod5k90.jpeg"><br><br>  Jetzt brauchen wir alle IDs, die wir aufgezeichnet haben.  Klicken Sie auf Vollversion des Dialogfelds Dienstverbindung verwenden.  Und geben Sie alle Daten ein, die wir vom Service Principal erhalten haben.  Klicken Sie auf √úberpr√ºfen. Wenn alles in Ordnung ist, behalten Sie die Verbindung bei.  Jetzt k√∂nnen unsere Pipelines damit eine Verbindung zur Cloud herstellen. <br><br><img src="https://habrastorage.org/webt/it/7s/as/it7sas1cjqbrwt58uncazzfp4ee.jpeg"><br><br><h1>  3. Erstellen einer Pipeline </h1><br>  Nun kommen wir zum interessantesten, dem Bau der Pipeline selbst.  √ñffnen Sie das Men√º Pipelines-Builds <br><br><img src="https://habrastorage.org/webt/et/wd/h5/etwdh5romudzssphyz-hmliq2bw.jpeg"><br><br>  Wir werden von einem Men√º zum Erstellen eines neuen Builds begr√º√üt, das standardm√§√üig versucht, eine YAML-Datei mit einer geeigneten Konfiguration f√ºr uns zu erstellen.  Wir lehnen dies h√∂flich ab und w√§hlen die klassische Version.  Der Wunsch von Microsoft, alles wie Menschen zu tun und die M√∂glichkeit zu geben, Pipelines √ºber YAML so weit wie m√∂glich anzupassen. Die geringe Dokumentation und die praktische Inoperabilit√§t vieler Module zeigen jedoch, dass es zu fr√ºh ist, diese Funktionalit√§t zu nutzen. <br><br><img src="https://habrastorage.org/webt/it/at/gu/itatgu_alr1efjbtvlr6rin5e9i.jpeg"><br><br>  Aus der Vielzahl der Vorlagen ben√∂tigen wir eine einfache leere Pipeline.  Nach seiner Erstellung werden wir von einem leeren Bearbeitungsfenster begr√º√üt, in dem wir viel Zeit verbringen werden. <br><br><img src="https://habrastorage.org/webt/0t/g0/0h/0tg00hw3ojp3plkvochf9-skdac.jpeg"><br><br>  Klicken Sie also auf + und gelangen Sie in einen bestimmten Modulspeicher, von dem aus wir die folgenden Komponenten aus der Liste ben√∂tigen. <br><br><img src="https://habrastorage.org/webt/9q/2l/ud/9q2ludjenipcm_m8oteqerfseoe.jpeg"><br><br>  Bevor wir mit der Konfiguration der Pipeline-Aufgabe fortfahren, m√ºssen wir mehrere Dateien erstellen und in das Projekt einf√ºgen.  Dies ist die ARM-Vorlage unserer virtuellen Maschine, die wir in Azure DevTest Labs generieren, das Skript zum Abrufen der IP-Maschine nach ihrer Erstellung und, falls gew√ºnscht, die Skripte unserer Tests oder das, was wir auf dem Host ausf√ºhren m√∂chten. <br><br><h1>  4. Generierung von ARM-Vorlagen </h1><br>  Um eine virtuelle Maschine zu erstellen, m√ºssen wir zuerst eine Vorlage daf√ºr generieren, eine JSON-Datei, die wir in den Projektcode einf√ºgen, damit sie von der Pipeline von dort gelesen werden kann. <br><br>  Wir gehen in unser Labor und suchen das Men√º Formeln (wiederverwendbare Basen). Klicken Sie, um ein neues zu erstellen. <br><br><img src="https://habrastorage.org/webt/8w/rc/-l/8wrc-lfvdcettljp5-j7iclsz1u.jpeg"><br><br>  Wir werden von einer langen Liste von Bildern als Basis begr√º√üt, die Auswahl der Gr√∂√üe der Maschine, genau wie beim Erstellen einer virtuellen Maschine.  In diesem Stadium werden wir nicht aufh√∂ren, sondern sofort zum letzten Element der Maschineneigenschaften √ºbergehen, n√§mlich zu Artefakten.  Sie k√∂nnen alle Konfigurationen verwenden, die f√ºr Ihre Umgebung erforderlich sind.  Beispielsweise f√ºge ich der Dom√§ne einen Computer hinzu und f√ºge ihr als Administrator ein Dienstkonto hinzu, damit die Pipeline dann unter diesem Konto auf diesen Computer zugreifen kann.  Dies kann alles variieren, aber f√ºr ein erfolgreiches Testen des Codes ben√∂tigen wir ein Artefakt, auf das wir n√§her eingehen werden.  Um die neueste Version der von uns getesteten Software auf unserem Computer zu installieren, verwenden wir das Artefakt "Azure-Pipelines herunterladen" und "Skript ausf√ºhren".  Erinnern Sie sich an den Anfang, als ich sagte, dass irgendwo ein Build mit dem Anwendungsinstallationsprogramm ausgef√ºhrt wird?  Jetzt m√ºssen wir der virtuellen Maschine oder besser gesagt der Vorlage mitteilen, damit er dieses Artefakt nimmt.  Und ich habe es nicht nur aufgenommen, sondern auch festgelegt, f√ºr die wir spezielle Felder ausf√ºllen, in denen das Projekt, der Name des Builds und der geheime Schl√ºssel angegeben sind.  Der geheime Schl√ºssel wird wie in allen Systemen dieser Art im Konto generiert, in diesem Fall in Azure DevOps, und in Secrets in Ihrem Labor gespeichert.  Es gibt eine kleine Einschr√§nkung: In Secrets werden wir es speichern, aber es ist weder kalt noch hei√ü. Es wird von einem anderen Benutzer als Teil der Pipeline gestartet. Daher m√ºssen wir den geheimen Schl√ºssel erneut manuell in die Vorlage eingeben. <br><br>  Ein weiteres Artefakt, das enthalten sein muss, ist "WinRM konfigurieren". Wir ben√∂tigen es f√ºr den sp√§teren Zugriff auf den Computer.  Es gibt nur einen Parameter, den Hostnamen.  Da wir es nicht im Voraus wissen, werden wir die Variable% COMPUTERNAME% verwenden. <br><br><img src="https://habrastorage.org/webt/ve/46/ps/ve46psila9wlzhoh9hiiwatcvxe.jpeg"><br><br>  Nachdem wir alle erforderlichen Artefakte hinzugef√ºgt haben, werden wir uns damit befassen, warum wir √ºberhaupt hierher gekommen sind.  Wir erhalten die generierte ARM-Vorlage auf der Registerkarte Erweitert des gleichen Formelerstellungsfensters. <br><br><img src="https://habrastorage.org/webt/bj/ly/ae/bjlyaelkb2okdk8cvk3xvtjhrm0.jpeg"><br><br>  Kopieren Sie den Inhalt der Seite in die Datei VMtemplate.json und legen Sie ihn im Stammverzeichnis des Projekts ab.  Wir brauchen die Cloud nicht mehr, wir kehren zur Pipeline zur√ºck. <br><br><h1>  5. Pipeline-Konfiguration </h1><br>  Beginnen wir mit dem Wichtigsten und Interessantesten, dem Erstellen einer virtuellen Maschine. Aus diesem Grund haben wir alle diese Integrationen und Vorlagen erstellt.  Im Azure RM-Abonnement w√§hlen wir unsere Dienstverbindung aus, die wir in Absatz 2 konfiguriert haben. Als N√§chstes wird die verf√ºgbare Laborumgebung angezeigt.  Dann w√§hlen wir json aus, das wir generiert haben, und definieren einige obligatorische Variablen.  Der Benutzername und das Passwort des Autos k√∂nnen entweder direkt oder mit Variablen festgelegt werden, aber ich bin mir nicht sicher, ob es funktioniert. Was auch immer ich dort schreibe, ich konnte unter diesen Credits nicht in das Auto einsteigen. Die Hauptsache ist, den Namen des Autos so einzustellen, dass es immer m√∂glich ist einzigartig.  Daf√ºr verwende ich die Build-Umgebungsvariable. <br><br><img src="https://habrastorage.org/webt/cx/nw/gv/cxnwgvb73r6yougop6htozc6g3c.jpeg"><br><br>  Als n√§chstes legen wir einen weiteren wichtigen Punkt fest.  Nach dem Start des Autos m√ºssen wir auch die Parameter irgendwie kennen, und es ist besser, nicht f√ºr uns, sondern f√ºr die Gewinnlinie.  Dazu erstellen wir ein Skript, zum Beispiel GetLabVMParams.ps1, und f√ºgen es dort in das Projekt ein.  Ich habe den Text des Skripts auf der Microsoft-Website √ºbernommen, ihn jedoch f√ºr meine Umgebung leicht korrigiert, weil  Er nahm PublicIP- und FQDN-Maschinen.  Ich habe keine, aber es gibt PrivateIP, das nicht so einfach zu bekommen ist, also habe ich ein St√ºck hinzugef√ºgt. <br><br><pre><code class="plaintext hljs">Param( [string] $labVmId) $labVmComputeId = (Get-AzureRmResource -Id $labVmId).Properties.ComputeId # Get lab VM resource group name $labVmRgName = (Get-AzureRmResource -Id $labVmComputeId).ResourceGroupName # Get the lab VM Name $labVmName = (Get-AzureRmResource -Id $labVmId).Name # Get lab VM public IP address # $labVMIpAddress = (Get-AzureRmPublicIpAddress -ResourceGroupName $labVmRgName -Name $labVmName).IpAddress # Get lab VM FQDN # $labVMFqdn = (Get-AzureRmPublicIpAddress -ResourceGroupName $labVmRgName -Name $labVmName).DnsSettings.Fqdn # Get lab VM private IP address $VmNetworkdetails= (((Get-AzureRmVM -ResourceGroupName $labVmRgName -Name $labVmName).NetworkProfile).NetworkInterfaces).Id $nicname = $VmNetworkdetails.substring($VmNetworkdetails.LastIndexOf("/")+1) $labVMnetwork = (Get-AzureRmNetworkInterface -Name $nicname -ResourceGroupName $labVmRgName)|Select-Object -ExpandProperty IPConfigurations $labVMIpAddress = $labVMnetwork.PrivateIpAddress # Set a variable labVmRgName to store the lab VM resource group name Write-Host "##vso[task.setvariable variable=labVmRgName;]$labVmRgName" # Set a variable labVMIpAddress to store the lab VM Ip address Write-Host "##vso[task.setvariable variable=labVMIpAddress;]$labVMIpAddress" # Set a variable labVMFqdn to store the lab VM FQDN name Write-Host "##vso[task.setvariable variable=labVMFqdn;]$labVMFqdn" Write-Output $labVMIpAddress Set-Item wsman:\localhost\client\trustedhosts * -Force</code> </pre> <br>  Von allem, was das Skript liest, ben√∂tigen wir nur die Variable labVMIpAddress.  Nun, das ist f√ºr mich, vielleicht brauchst du etwas anderes, daf√ºr habe ich nichts gel√∂scht und nur den √úberschuss auskommentiert. <br><br>  Ich werde auch die letzte Zeile des Skripts erl√§utern. Sie erm√∂glicht unserem Build-Computer den Zugriff auf jeden Host √ºber WinRM. <br><br>  Im n√§chsten Schritt f√ºhren wir unser wunderbares Skript aus.  Er ben√∂tigt dieselbe Verbindung zur Cloud, die Eingabevariable mit der Maschinen-ID, die zu diesem Zeitpunkt bereits aus dem vorherigen Schritt bekannt sein wird.  Wie?  Hier ist es notwendig, so etwas Wunderbares wie Ausgabevariablen zu erw√§hnen.  Jeder Schritt kann eine Liste von Variablen enthalten, die an die n√§chsten Pipeline-Schritte weitergegeben werden.  Dementsprechend ist eine solche Variable f√ºr unser Superskript labVMIpAddress. Vergessen Sie nicht, dies anzugeben. <br><br><img src="https://habrastorage.org/webt/yu/va/m7/yuvam7x2ikxspc7ucohyp5oivq4.jpeg"><br><br>  Au√üerdem mache ich ziemlich einfache Dinge, die au√üerdem von Fall zu Fall variieren k√∂nnen.  Ich f√ºhre ein Remote-Skript mit der Erstellung von B√§llen aus, in das ich dann meine Skripte hochlade. <br><br><pre> <code class="plaintext hljs">New-Item ‚ÄúC:\test" ‚Äìtype directory New-SMBShare ‚ÄìName ‚Äútest‚Äù ‚ÄìPath ‚ÄúC:\test‚Äù ‚ÄìFullAccess everyone</code> </pre> <br>  Aus dem Namen der Kohlk√∂pfe geht hervor, dass wir dann ein Beispielskript auf die Maschine kopieren und es in einem weiteren Schritt ausf√ºhren.  Als Adresse des Remote-Computers ist unsere Variable $ (labVMIpAddress) f√ºr uns n√ºtzlich.  Als N√§chstes verwenden wir die Aufgabe ‚ÄûArtefakt von den Kugeln aufnehmen‚Äú und kopieren die Ergebnisse des Skripts in unsere Build-Umgebung. Anschlie√üend speichern wir diese Dateien im Build-Artefakt mit derselben Standardaufgabe.  Nachdem wir das Auto nicht mehr brauchen, t√∂ten wir es mit dem letzten Schritt.  Die Hauptschwierigkeit, wie aus dem Band des Artikels hervorgeht, besteht darin, sich in die Cloud zu integrieren und Kontakt mit der von Ihnen erstellten virtuellen Maschine aufzunehmen. Dann k√∂nnen Sie bereits so viel Spa√ü haben, wie n√∂tig. <br><br>  Dies ist mein erster Artikel, also urteile nicht streng, Kommentare sind willkommen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de460431/">https://habr.com/ru/post/de460431/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de460415/index.html">Apple Watch 4 (44 mm, 2019) gegen Pebble Steel Classic (2014)</a></li>
<li><a href="../de460419/index.html">Abgasw√§rmer√ºckgewinnung: umweltfreundlich</a></li>
<li><a href="../de460421/index.html">Optischer TP-Link T2600G-28SQ-Switch f√ºr Dienstanbieter: Eine detaillierte √úberpr√ºfung</a></li>
<li><a href="../de460423/index.html">WAL in PostgreSQL: 3. Checkpoint</a></li>
<li><a href="../de460425/index.html">H√∂llenk√§lte, Levitation und Plasma: Vergangenheit, Gegenwart und Zukunft der Supraleitung</a></li>
<li><a href="../de460433/index.html">Risiken und Bedrohungen im Internet der Dinge</a></li>
<li><a href="../de460435/index.html">Kleine Freude # 8: kleine Freuden f√ºr die Arbeit mit der Datenbank</a></li>
<li><a href="../de460437/index.html">Wie wir ein technisches Support-Fahrrad herausbringen</a></li>
<li><a href="../de460439/index.html">Programmiersprache P4</a></li>
<li><a href="../de460441/index.html">Gleb Nitzman: ‚ÄûIch fand das Ende einer √Ñra, in der die Menschen das in Radioelementen enthaltene Gold noch nicht gejagt hatten.‚Äú</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>