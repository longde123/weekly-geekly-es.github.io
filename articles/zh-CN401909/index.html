<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>↘️ 👦🏿 👊 基于产品的家庭安全系统，来自Nootekhnika 🐁 👨🏻 🎅🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="美好的一天，亲爱的社区。 我想与您分享一个基于Nootehnika的智能家居设备为家庭实施安全系统的实验。 我想马上保留一下这是第一个实验之一，我的目标不是“建立坚不可摧的堡垒”，而是证明使用我选择的设备，进行实验和学习课程以及从您那里获得反馈的可能性。 

 简而言之，我正在设计的系统应该为每个在...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>基于产品的家庭安全系统，来自Nootekhnika</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/401909/"> 美好的一天，亲爱的社区。 我想与您分享一个基于Nootehnika的智能家居设备为家庭实施安全系统的实验。 我想马上保留一下这是第一个实验之一，我的目标不是“建立坚不可摧的堡垒”，而是证明使用我选择的设备，进行实验和学习课程以及从您那里获得反馈的可能性。 <br><br> 简而言之，我正在设计的系统应该为每个在布防模式下走近前门的人拍照，然后将照片发送到电子邮件地址，并在走廊进行移动登记时发送电子邮件消息（即公寓内部有移动） 。 <a name="habracut"></a> 因此，对问题的陈述。 <br><br><h2>  <b>1.问题陈述</b> </h2><br> 我设计的系统应： <br><br><ul><li> 在布防模式下，为每个接近前门的人拍照，然后将照片发送到电子邮件地址； </li><li> 在布防模式下，如果在走廊中有移动记录，请发送电子邮件（没有照片，因为我那里没有IP摄像机）； </li><li> 提供用于布防和撤防的各种接口。 </li></ul><br> 通过各种布防界面，我的意思是： <br><br><ul><li> 在无线电开关Nootehnika的帮助下进行撤防； </li><li> 通过Web界面进行布防和撤防，以管理智能家居。 </li></ul><br><h2>  <b>2.解决方案说明</b> </h2><br> 为了解决此问题，我使用了以下硬件： <br><br><ul><li> 两个运动传感器112; </li><li> 接收来自传感器和开关RX2164的信号; </li><li>  PU311-2开关; </li><li>  3VI nettop（基于Atom D525处理器）； </li><li> 中文无名IP摄像机。 </li></ul><br> 在本文的“简介” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">部分中，</a>我已经简要介绍了Nootehnika公司构建智能家居的设备，因此，我将不再关注此问题。 此外，有关设备的所有详细信息都可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">公司</a>的异地找到。 <br><br> 因此，对系统进行描述。 在3VI网上平台上，安装了Debian Linux 7，简单事件关联（SEC）软件和一组用于管理<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Oleg Artamonov的</a> Nootechnics设备的linux实用程序。 <br><br> 运动传感器（PM112）安装在前门前的前厅和走廊（公寓内部）中。  RX2164 USB接收器已连接到上网本。 接收器从传感器和开关接收信号，并且安装在网上的Nootehnics设备管理实用程序（以下称为Noolite实用程序）将接收到的信号发送到syslog。  SEC读取写入系统日志数据的文件，并根据配置的规则对其进行处理。 作为处理的结果，执行诸如从IP摄像机接收照片和发送电子邮件消息之类的动作。 <br><br> 有两种方法可以启用（和禁用）安全模式： <br><br><ol><li> 按下PU311-2开关上的按钮； </li><li> 通过按下智能家居控制系统的Web界面中的按钮。 </li></ol><br> 图1显示了说明系统操作的框图。 <br><br><img src="https://habrastorage.org/files/ac2/e02/b20/ac2e02b2021f408f95d5fe039beb7588.jpg"><br><br>  <b>图1-</b>说明系统操作的框图 <br><br><h2>  <b>3.安装系统硬件</b> </h2><br> 对于该系统，我使用相同的2个运动传感器，其安装方法已在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">本文的</a>第4节中进行了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">介绍</a> 。 <br><br> 简而言之，其中一个传感器安装在前厅（公寓外部）的前门附近。 该传感器的灵敏度被设置为检测门附近的移动的水平。 第二个传感器安装在前门附近，但已经在公寓内部。 灵敏度的调整方式是将移动固定在门的附近。 <br><br> 网络摄像机安装在天花板下方前庭的公寓外部。 前门和她前方约1.5米的空间落入了视野。 <br><br>  PU311-2开关安装在机柜内部，以免引起眼睛的注意和意外按下。 <br><br> 带有RX2164信号接收器的3VI上网本位于夹层附近，以稳定地接收来自传感器和开关的信号。 <br><br> 设备安装图如图2所示。 <br><br><img src="https://habrastorage.org/files/210/f9b/27b/210f9b27bd7349fbaa3ac91752612f73.jpg" height="300" width="180"><br><br>  <b>图2-</b>设备安装图 <br><br><h2>  <b>4.软件设置</b> </h2><br> 软件设置包括： <br><br><ul><li> 设置Noolite实用程序以接收来自传感器和开关的信号； </li><li> 设置SEC规则以响应来自传感器和开关的信号； </li><li> 创建一个脚本，该脚本将从相机接收照片并发送电子邮件； </li><li> 在Web界面中创建一个按钮以打开和关闭系统。 </li></ul><br><h3>  <b>配置Noolite实用程序以接收来自传感器和开关的信号</b> </h3><br> 为了使RX2164接收器开始从传感器或开关接收信号，有必要对其进行“绑定”。 为此，我们按下传感器本身（在背面）上的“绑定”按钮，然后在连接接收器的计算机上执行以下命令：nooliterxcfg –bind &lt;通道号，从1到64&gt;。 同样，开关绑定到接收器。 <br><br> 就我而言，前庭中的传感器连接到通道3，公寓中的传感器连接到通道2，两个开关按钮分别连接到通道1和4。 <br><br> 要实时接收来自传感器的信号，您需要在守护程序模式下运行nooliterx实用程序。 开发人员自己（实用程序文档中的Oleg Artamonov）描述了实用程序及其设置的安装过程，而我在文章（LINK）的第4节中也对此进行了描述。 结果，我们在syslog中获得了来自传感器和开关的信号记录。 仅需配置这些消息在syslog本身的文件中的记录，并在输出中获得以下内容（来自传感器的示例消息）： <br><br><pre><code class="bash hljs">Jan 7 15:47:39 vmon nooliterx[23022]: Received: status 133, channel 3, <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> 25, format 1, data 2 0 0 0 Jan 7 18:43:58 vmon nooliterx[23022]: Received: status 135, channel 2, <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> 25, format 1, data 1 0 0 0</code> </pre> <br> 来自开关的消息示例（当按下按钮时）看起来有些不同： <br><br><pre> <code class="bash hljs">Jan 5 22:29:43 vmon nooliterx[23022]: Received: status 26, channel 1, <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> 4, format 0, data 1 0 0 0 Jan 5 22:27:55 vmon nooliterx[23022]: Received: status 145, channel 4, <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> 4, format 0, data 1 0 0 0</code> </pre> <br><h3>  <b>配置SEC规则以触发来自传感器和开关的信号。</b> </h3><br>  SEC是用于处理事件日志的实用程序。 简而言之，它在输入处接收事件流，每个事件流都检查是否符合配置的规则的模式。 在找到匹配项的情况下，它将启动相应规则中规定的操作。 这东西使用起来非常灵活。 网上有详细的手册页。 <br><br> 在我的系统中，使用SEC来搜索事件流中传感器和开关的实时消息，并运行一个用于拍照和发送电子邮件的脚本，或者简单地打开和关闭整个系统。 <br><br> 在SEC中，我配置了4条规则。  2-处理来自运动传感器的事件，2-处理来自开关的两个按钮的信号。 规则在/etc/sec.conf中 <br><br>  <b>规则1：处理来自前庭中的运动传感器的信号（传感器连接到通道3）</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=SingleWithSuppress ptype=RegExp pattern=\w+\s+\d+\s+\d+\:\d+\:\d+\s+\w+\s+nooliterx\S+\s+Received\:\s+status\s+\d+,\s+channel\s+(3),\s+<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>\s+25.* desc=Motion sensor frontdoor <span class="hljs-variable"><span class="hljs-variable">$1</span></span> triggered action=shellcmd (/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/smarthome/security/send_photo_alert.sh <span class="hljs-variable"><span class="hljs-variable">$1</span></span>); event %s window=60</code> </pre> <br> 此规则的类型“ SingleWithSurpress”旨在仅在“ window”参数指定的时间间隔内以秒为单位响应第一个记录的事件。 即 此设置意味着该规则每分钟最多运行一次，并且在“操作”参数中指定的操作每分钟启动最多不超过1次。 这样做是为了防止有人在门口脚几分钟，而不用大量信件来发送垃圾邮件。 在“ pattern”参数中，写入一个正则表达式，根据该正则表达式搜索与通道3关联的传感器的事件。“ action”参数中指定了两个动作-shellcmd，该脚本运行脚本并向其传递从正则表达式中提取的参数（在本例中在表示数字“ 3”的情况下，第二动作“事件％s”用于将记录在参数“ desc”中的表达式转换为其他规则，这对于该系统的操作不是必需的，并且可以省略。  “ desc”参数指示其他规则使用的其他服务信息。 对于该系统，没有必要，可以在此输入任意数据。 <br><br>  <b>规则2：来自走廊中的运动传感器（连接到通道2的传感器）的信号处理</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=SingleWithSuppress ptype=RegExp pattern=\w+\s+\d+\s+\d+\:\d+\:\d+\s+\w+\s+nooliterx\S+\s+Received\:\s+status\s+\d+,\s+channel\s+(2),\s+<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>\s+25.* desc=Motion sensor lobby <span class="hljs-variable"><span class="hljs-variable">$1</span></span> triggered action=shellcmd (/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/smarthome/security/send_photo_alert.sh <span class="hljs-variable"><span class="hljs-variable">$1</span></span>); event %s window=60</code> </pre> <br> 此处，所有内容均与规则1相似。仅应注意，将从正则表达式获得的数字“ 2”传递给脚本。 <br><br>  <b>规则3：来自与通道1相关的开关按钮的信号处理</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=single ptype=regexp pattern=\w+\s+\d+\s+\d+\:\d+\:\d+\s+\w+\s+nooliterx\S+\s+Received\:\s+status\s+\d+,\s+channel\s+(1),\s+<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>\s+4.* desc=switch guard mode online action=shellcmd (/bin/<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"online"</span></span> &gt; /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/smarthome/security/status)</code> </pre> <br> 该规则甚至更简单-它针对与“ pattern”参数中指定的正则表达式匹配的每个事件触发。 作为操作，它将写入系统状态文件。 该文件由规则1和2启动的脚本分析，如果状态为“在线”，则触发脚本；如果值为“离线”，则脚本不起作用。 关于此的更多内容。 <br><br>  <b>规则4：来自与通道4相关的开关按钮的信号处理</b> <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=single ptype=regexp pattern=\w+\s+\d+\s+\d+\:\d+\:\d+\s+\w+\s+nooliterx\S+\s+Received\:\s+status\s+\d+,\s+channel\s+(4),\s+<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>\s+4.* desc=switch guard mode offline action=shellcmd (/bin/<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"offline"</span></span> &gt; /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/smarthome/security/status)</code> </pre> <br> 一切都类似于规则3，只是状态设置为“离线”。 <br><br><h3>  <b>一个脚本，可以从相机拍摄照片并发送电子邮件</b> </h3><br> 由规则1和2启动的脚本在状态文件中检查系统的状态，并根据其值（“联机”或“脱机”）执行或不执行以下操作： <br><br><ul><li> 从前庭的IP摄像机接收照片，如果前庭有传感器，则发送电子邮件； </li><li> 在走廊中有传感器的情况下发送警报消息。 </li></ul><br> 以下是脚本的主体。 它在其输入端（从SEC）接收传感器所连接的通道号，并根据该编号和系统状态执行某些操作。 <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh dir="/usr/local/smarthome/security" MAIL=$dir/mail.letter stat_file="$dir/status" dt=`date` if [ "$1" -eq 2 ] then if grep "online" $stat_file then cd $dir rm -f $dir/snapshot.cgi wget http://&lt;IP  &gt;/snapshot.cgi --user=&lt;username&gt; --password=&lt;password&gt; mpack -s "Someone at the door at $dt" $dir/snapshot.cgi d.shulinin@gmail.com fi elif [ "$1" -eq 3 ] then if grep "online" $stat_file then printf "Subject: Motion in the lobby spotted at $dt\n" &gt; $MAIL /usr/sbin/ssmtp email@gmail.com &lt; $MAIL fi else echo "no legitimate input detected" fi</span></span></code> </pre> <br> 要从我的IP摄像机获取照片，我使用wget和这样的一行： <br><br><pre> <code class="bash hljs">wget http://&lt;IP  &gt;/snapshot.cgi --user=&lt;username&gt; --password=&lt;password&gt;</code> </pre> <br> 对于其他IP摄像机，您可能需要寻找其他选项，没有单一的解决方案。 正如他们所说，将RTFM传输到相机。 <br><br>  Web界面中打开和关闭系统的按钮。 为了启用和禁用安全模式，我还向自己的Web界面添加了两个按钮，用于控制智能家居的光源。 <br><br> 它们看起来如下： <br><br><pre> <code class="bash hljs">&lt;?php <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isset(<span class="hljs-variable"><span class="hljs-variable">$_POST</span></span>[<span class="hljs-string"><span class="hljs-string">'button9_on'</span></span>])) { <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span>(<span class="hljs-string"><span class="hljs-string">'/bin/echo "online" &gt; /usr/local/smarthome/security/status'</span></span>); } ?&gt; &lt;?php <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isset(<span class="hljs-variable"><span class="hljs-variable">$_POST</span></span>[<span class="hljs-string"><span class="hljs-string">'button9_off'</span></span>])) { <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span>(<span class="hljs-string"><span class="hljs-string">'/bin/echo "offline" &gt; /usr/local/smarthome/security/status'</span></span>); } ?&gt; &lt;p&gt;&lt;h2&gt;Guard mode&lt;/h2&gt;&lt;/p&gt; &lt;form method=<span class="hljs-string"><span class="hljs-string">"post"</span></span>&gt; &lt;p&gt; &lt;button name=<span class="hljs-string"><span class="hljs-string">"button9_on"</span></span>&gt;ON&lt;/button&gt; &lt;button name=<span class="hljs-string"><span class="hljs-string">"button9_off"</span></span>&gt;OFF&lt;/button&gt; &lt;/p&gt;</code> </pre> <br> 一切都很简单-单击“ ON”按钮时，将“ online”写入状态文件，单击“ OFF”-“ offline”。 <br><br><h2>  <b>5.结论</b> </h2><br> 结果，我得到了一个系统，该系统在启动时会为走近门的人拍照并通过电子邮件发送照片。 如果公寓内部有动静，它只是通过电子邮件发送警报。 <br><br> 样本电子邮件看起来像这样（见图3）。 当然，当您用鼠标单击图像时，图像本身会更大并会扩大。 <br><br><img src="https://habrastorage.org/files/fe5/9d4/689/fe59d468920b4e9fbfb5059d3f1d40aa.jpg"><br>  <i><b>图3-</b>带有照片的电子邮件示例</i> <br><br> 可以通过按下开关上的按钮以及通过智能家居控制系统的Web界面中的按钮来激活和停用该系统。 <br><br> 在短期内，我还想在Web界面中显示系统的当前状态（活动/不活动）。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN401909/">https://habr.com/ru/post/zh-CN401909/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN401899/index.html">多功能DIY记录仪。第一部分</a></li>
<li><a href="../zh-CN401901/index.html">通往宇宙的月光窗</a></li>
<li><a href="../zh-CN401903/index.html">声音如何影响我们的睡眠和生产力</a></li>
<li><a href="../zh-CN401905/index.html">Apple Power Mac G4 Cube及其同时代产品的小图片审查</a></li>
<li><a href="../zh-CN401907/index.html">机器人汽车必须学会了解人。</a></li>
<li><a href="../zh-CN401911/index.html">数据中心“ Maria-Ra”中的备用电源</a></li>
<li><a href="../zh-CN401913/index.html">1-Wire总线驱动器，用于低于5V供电的控制器</a></li>
<li><a href="../zh-CN401915/index.html">MWC 2017：智能手机</a></li>
<li><a href="../zh-CN401917/index.html">所有年龄段的玩具都是顺从的</a></li>
<li><a href="../zh-CN401919/index.html">ONO 3D打印机。 光刻术-对大众</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>