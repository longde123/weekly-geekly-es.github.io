<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêÉ üßöüèΩ üåâ Bitcoin im K√§fig? ‚ôäÔ∏è ü¶í üë∂üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zuf√§llig bin ich ein professioneller Administrator von Computersystemen und Netzwerken (kurz: Sysadmin) und habe Prof. die Aktivit√§t einer Vielzahl vo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bitcoin im K√§fig?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477124/"><p> Zuf√§llig bin ich ein professioneller Administrator von Computersystemen und Netzwerken (kurz: Sysadmin) und habe Prof.  die Aktivit√§t einer Vielzahl von Systemen, einschlie√ülich derer, die [wegen] der oben genannten Sicherheitsma√ünahmen erforderlich sind.  Und es stellte sich heraus, dass ich <a href="https://www.lopp.net/bitcoin-information.html">Bitcoin vor</a> einiger Zeit f√ºr mich selbst interessant fand und nicht nur nutzte, sondern auch mehrere Mikrodienste startete, um zu lernen, wie man aus Sicht der Entwicklung unabh√§ngig mit dem Bitcoin-Netzwerk (es ist immerhin P2P) arbeitet (Ich bin nat√ºrlich so ein <code>dev</code> , also bin ich vorbei <code>dev</code> ).  Aber ich spreche nicht von Entwicklung, ich spreche von einer sicheren und effektiven Umgebung f√ºr Anwendungen. </p><a name="habracut"></a><br><p>  Finanztechnologien ( <em>Fintech</em> ) gehen mit Informationssicherheit ( <em>Infosec</em> ) <em>einher</em> und die erste kann ohne die zweite funktionieren, aber nicht lange.  Aus diesem Grund m√∂chte ich meine Erfahrungen und die von mir verwendeten Tools, darunter <em>Fintech</em> und <em>Infosec</em> , weitergeben. Gleichzeitig kann es auch f√ºr einen breiteren oder ganz anderen Zweck verwendet werden.  In diesem Artikel werde ich Ihnen nicht so viel √ºber Bitcoin erz√§hlen, sondern √ºber das Infrastrukturmodell f√ºr die Entwicklung und den Betrieb von Finanzdiensten (und nicht nur) - mit einem Wort, die Dienste, bei denen "B" eine Rolle spielt.  Dies gilt sowohl f√ºr die Bitcoin-B√∂rse als auch f√ºr den typischsten Unternehmenszoo der Dienste eines kleinen Unternehmens, das in keiner Weise Bitcoin verwendet. </p><br><p>  Ich m√∂chte darauf hinweisen, dass ich die Prinzipien <em>"halte es einfach dumm"</em> und <em>"weniger ist mehr" bef√ºrworte</em> , so dass sowohl der Artikel als auch der darin beschriebene die Eigenschaften haben werden, um die es bei diesen Prinzipien geht. </p><br><p>  <em>Imagin√§res Szenario:</em> Schauen wir uns ein Beispiel f√ºr einen Bitcoin-Tauscher an.  Wir haben beschlossen, Rubel, Dollar und Euro gegen Bitcoins und umgekehrt einzutauschen, und wir haben bereits eine funktionierende L√∂sung, aber f√ºr anderes digitales Geld wie Kiwi und Webgeld, d. H.  Nachdem wir alle rechtlichen Fragen gekl√§rt haben, gibt es eine fertige Anwendung, die als Zahlungsportal f√ºr Rubel, Dollar und Euro und andere Zahlungssysteme fungiert.  Es ist an unsere Bankkonten gebunden und verf√ºgt √ºber eine Art API f√ºr unsere endg√ºltigen Anwendungen.  Wir haben auch eine Webanwendung, die als Austausch f√ºr Benutzer fungiert, wie ein typisches Kiwi- oder Webmoney-Konto - er√∂ffnen Sie ein Konto, f√ºgen Sie eine Karte hinzu und so weiter.  Es kommuniziert mit unserer Gateway-Anwendung, obwohl es die REST-API im LAN verwendet.  Deshalb haben wir uns entschlossen, Bitcoins zu verbinden und gleichzeitig die Infrastruktur zu verbessern, weil  anfangs war alles auf virtuellen boxen im b√ºro unter dem tisch verteilt ... sie begannen, die website zu nutzen, und wir machten uns Sorgen um die betriebszeit und die leistung. </p><br><p>  Beginnen wir also mit der Hauptauswahl der Server.  Weil  Da das Gesch√§ft in unserem Beispiel klein ist und wir dem Host (OVH) vertrauen, w√§hlen wir eine <a href="https://www.kimsufi.com/">Budgetoption,</a> bei der es unm√∂glich ist, das System vom urspr√ºnglichen .iso-Image zu installieren, aber es spielt keine Rolle, dass die IT-Sicherheitsabteilung das installierte Image definitiv analysiert.  Und wenn wir erwachsen werden, vermieten wir unseren Schrank im Allgemeinen unter Verschluss und mit beschr√§nktem physischem Zugang, oder wir bauen unseren eigenen DC.  In jedem Fall sollte beachtet werden, dass beim Ausleihen von Eisen und Installieren von vorgefertigten Images die M√∂glichkeit besteht, dass auf Ihrem System ein "Trojaner vom Host" installiert wird, der in den meisten F√§llen nicht dazu gedacht ist, Sie zu verfolgen, sondern bequemere Verwaltungstools bietet Server. </p><br><p>  <strong>Server-Installation</strong> </p><br><p>  Hier ist alles einfach.  Wir w√§hlen Eisen, das unseren Bed√ºrfnissen entspricht.  W√§hlen Sie dann das FreeBSD-Image aus.  Nun, entweder verbinden wir uns (im Falle eines anderen Hosters und unserer eigenen Hardware) √ºber IPMI oder √ºber einen Monitor und speisen das .iso FreeBSD-Image in den Download ein.  F√ºr Orchesterinstallationen verwende ich <a href="https://github.com/ansible/ansible">Ansible</a> und <a href="https://mfsbsd.vx.sk/">mfsbsd</a> .  Das Einzige, in unserem Fall mit kimsufi, war die <em>benutzerdefinierte Installation,</em> sodass auf den beiden Festplatten im Spiegel nur die Partitionen "boot" und / home "open" vorhanden waren. Der Rest des Festplattenspeichers wird verschl√ºsselt, aber dazu sp√§ter mehr. </p><br><p><img src="https://habrastorage.org/webt/-m/ve/av/-mveavdklaybhokh5sznmisf7be.png"></p><br><p>  Das System wird wie <code>bsdinstaller</code> installiert, ich werde hier nicht aufh√∂ren, ich <code>bsdinstaller</code> nur fest, dass es sich lohnt, vor der Inbetriebnahme auf die <em>H√§rtungsoptionen</em> zu <code>bsdinstaller</code> , die <code>bsdinstaller</code> am Ende der Installation anbietet (wenn Sie das System selbst installieren): </p><br><p><img src="https://habrastorage.org/webt/pj/6w/no/pj6wnohhskxkw6vqigcucollot0.png"></p><br><p>  Es gibt <a href="http://bsdadventures.com/harden-freebsd/">gutes Material</a> zu diesem Thema, ich werde es hier kurz wiederholen. </p><br><p>  Auf einem bereits installierten System k√∂nnen die oben genannten Parameter auf die gleiche Weise aktiviert werden.  Bearbeiten Sie dazu die Bootloader-Datei und aktivieren Sie die Kernel-Parameter.  * <em>ee ist ein Editor wie dieser in BSD</em> </p><br><p> <code># ee /etc/rc.conf</code> </p> <br><pre> <code class="plaintext hljs">... #sec hard clear_tmp_enable="YES" syslogd_flags="-ss" sendmail_enable="NONE"</code> </pre><br><p> <code># ee /etc/sysctl.conf</code> </p> <br><pre> <code class="plaintext hljs">... #sec hard security.bsd.see_other_uids=0 security.bsd.see_other_gids=0 security.bsd.unprivileged_read_msgbuf=0 security.bsd.unprivileged_proc_debug=0 kern.randompid=$(jot -r 1 9999) security.bsd.stack_guard_page=1</code> </pre> <br><p>  Stellen Sie au√üerdem sicher, dass Sie die neueste Version des Systems installiert haben, und f√ºhren Sie <a href="https://www.freebsd.org/doc/handbook/updating-upgrading-freebsdupdate.html">alle Aktualisierungen und Upgrades durch</a> .  In unserem Fall ist beispielsweise ein Upgrade auf die neueste Version erforderlich, weil  Vorinstallationsimages liegen sechs Monate bis ein Jahr zur√ºck.  Nun, dort √§ndern wir den SSH-Port standardm√§√üig auf einen anderen, f√ºgen eine Schl√ºsselauthentifizierung hinzu und deaktivieren ihn mit einem Passwort. </p><br><p>  Dann konfigurieren wir <code>aide</code> und √ºberwachen den Status der Systemkonfigurationsdateien.  Mehr Gekautes kann hier nachgelesen <a href="https://www.digitalocean.com/community/tutorials/how-to-install-aide-on-a-digitalocean-vps">werden</a> . </p><br><p> <code>pkg install aide</code> </p> <br><p>  und bearbeite unsere crontab </p><br><p> <code>crontab -e</code> </p> <br><p> <code>06 01 * * 0-6 /root/chkaide.sh</code> </p> <br><pre> <code class="plaintext hljs">#! /bin/sh #chkaide.sh MYDATE=`date +%Y-%m-%d` MYFILENAME="Aide-"$MYDATE.txt /bin/echo "Aide check !! `date`" &gt; /tmp/$MYFILENAME /usr/local/bin/aide --check &gt; /tmp/myAide.txt /bin/cat /tmp/myAide.txt|/usr/bin/grep -v failed &gt;&gt; /tmp/$MYFILENAME /bin/echo "**************************************" &gt;&gt; /tmp/$MYFILENAME /usr/bin/tail -20 /tmp/myAide.txt &gt;&gt; /tmp/$MYFILENAME /bin/echo "****************DONE******************" &gt;&gt; /tmp/$MYFILENAME</code> </pre> <br><p>  Aktivieren Sie die <a href="https://www.freebsd.org/doc/handbook/audit-config.html">System√ºberwachung</a> </p><br><p> <code>sysrc auditd_enable=YES</code> </p> <br><p> <code># service auditd start</code> </p> <br><p>  Die Verwaltung dieses Gesch√§fts ist im <a href="https://www.freebsd.org/doc/handbook/audit-administration.html">Handbuch</a> ausf√ºhrlich beschrieben. </p><br><p>  Jetzt starten wir neu und fahren mit der Software auf dem Server fort.  Jeder Server ist ein Hypervisor f√ºr Container oder vollst√§ndige virtuelle Maschinen.  Daher ist es wichtig, dass der Prozessor VT-x und EPT unterst√ºtzt, wenn die vollst√§ndige Virtualisierung verwendet werden soll. </p><br><p>  Als Management f√ºr Container und virtuelle Maschinen verwende ich <a href="https://bsdstore.ru/">clevd</a> von <a href="https://github.com/olevole">olevole</a> . Ich w√ºnsche ihm mehr Gesundheit und Vorteile f√ºr dieses wundervolle Dienstprogramm! </p><br><p>  <strong>Beh√§lter?</strong>  <strong>Wieder Docker oder was?</strong> </p><br><p>  Aber nein  <a href="https://www.freebsd.org/doc/handbook/jails.html">FreeBSD Jails</a> ist ein gro√üartiges Container-Tool, aber das erw√§hnte <code>cbsd</code> , diese Container zu orchestrieren, deren Name Zellen sind. </p><br><p>  Eine Zelle ist eine √§u√üerst effektive L√∂sung f√ºr den Aufbau einer Infrastruktur f√ºr eine Vielzahl von Zwecken, die letztendlich die vollst√§ndige Isolierung einzelner Dienste oder Prozesse erfordert.  Dies ist im Wesentlichen ein Klon des Hostsystems, erfordert jedoch keine vollst√§ndige Virtualisierung der Hardware.  Und die Ressourcen daf√ºr werden nicht f√ºr ein "Gastbetriebssystem" ausgegeben, sondern nur f√ºr die geleistete Arbeit.  Wenn Zellen f√ºr interne Zwecke verwendet werden, ist dies eine sehr bequeme L√∂sung f√ºr die optimale Nutzung der Ressource. Mehrere Zellen auf einem Eisenserver k√∂nnen bei Bedarf die gesamte Serverressource einzeln nutzen.  Da in der Regel unterschiedliche Subservices extra ben√∂tigt werden.  Ressourcen zu unterschiedlichen Zeiten k√∂nnen Sie die maximale Leistung von einem Server extrahieren, wenn Sie die Zellen zwischen den Servern richtig planen und aus dem Gleichgewicht bringen.  Bei Bedarf k√∂nnen die Zellen auch Grenzen f√ºr die verwendete Ressource festlegen. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/95c/817/901/95c8179015447a58c383f4a4a81a510d.gif" alt="Bild"></p><br><p>  <strong>Was ist mit der vollst√§ndigen Virtualisierung?</strong> </p><br><p>  <code>cbsd</code> unterst√ºtzt <code>cbsd</code> die Arbeit von <code>bhyve</code> und XEN-Hypervisoren.  Ich habe nie den zweiten verwendet, aber der erste ist ein relativ junger <a href="https://www.freebsd.org/doc/handbook/virtualization-host-bhyve.html">Hypervisor von FreeBSD</a> .  Im folgenden Beispiel sehen wir uns ein Beispiel mit <code>bhyve</code> an. </p><br><p>  <strong>Installieren und konfigurieren Sie die Host-Umgebung</strong> </p><br><p>  Wir verwenden FS <a href="https://www.freebsd.org/doc/handbook/zfs.html">ZFS</a> .  Dies ist ein √§u√üerst leistungsf√§higes Tool zum Verwalten des Serverraums.  Dank ZFS k√∂nnen Sie Arrays mit verschiedenen Konfigurationen direkt von Datentr√§gern erstellen, den Speicherplatz dynamisch erweitern, tote Datentr√§ger austauschen, Snapshots verwalten und vieles mehr, was in einer Reihe von Artikeln beschrieben werden kann.  Kehren wir zu unserem Server und seinen Festplatten zur√ºck.  Zu Beginn der Installation auf Datentr√§gern haben wir Speicherplatz f√ºr verschl√ºsselte Partitionen freigelassen.  Warum so?  Dies ist so, dass das System automatisch aufsteigt und SSH abh√∂rt. </p><br><p> <code>gpart add -t freebsd-zfs /dev/ada0</code> </p> <br><p> <code>/dev/ada0p4 added!</code> </p> <br><p>  F√ºgen Sie die Festplattenpartition zum verbleibenden Speicherplatz hinzu </p><br><p> <code>geli init /dev/ada0p4</code> </p> <br><p>  Geben Sie unser Verschl√ºsselungspasswort ein </p><br><p> <code>geli attach /dev/ada0p4</code> </p> <br><p>  Geben Sie das Passwort erneut ein und wir haben das Ger√§t /dev/ada0p4.eli - dies ist unser verschl√ºsselter Speicherplatz.  Dann wiederholen wir dasselbe f√ºr / dev / ada1 und andere Festplatten im Array.  Und erstellen Sie einen neuen <a href="https://www.freebsd.org/doc/handbook/zfs-zpool.html">ZFS-Pool</a> . </p><br><p>  <code>zpool create vms mirror /dev/ada0p4.eli /dev/ada1p4.eli /dev/ada3p4.eli</code> - nun haben wir das minimale <code>zpool create vms mirror /dev/ada0p4.eli /dev/ada1p4.eli /dev/ada3p4.eli</code> fertig.  Ein gespiegeltes Festplattenarray f√ºr den Fall, dass einer der drei ausf√§llt. </p><br><p>  Erstellen Sie einen Datensatz f√ºr den neuen "Pool" </p><br><p> <code>zfs create vms/jails</code> </p> <br><p>  <code>pkg install cbsd</code> - <code>pkg install cbsd</code> den Befehl aus und installiere die Verwaltung f√ºr unsere Zellen. </p><br><p>  Nach der <code>cbsd</code> muss es initialisiert werden: </p><br><p> <code># env workdir="/vms/jails" /usr/local/cbsd/sudoexec/initenv</code> </p> <br><p>  Nun, wir beantworten eine Reihe von Fragen, meistens standardm√§√üig. </p><br><p>  * Wenn Sie die Verschl√ºsselung verwenden, ist es wichtig, dass der <code>cbsdd</code> Daemon erst dann automatisch gestartet wird, wenn Sie die Festplatten manuell oder automatisch entschl√ºsseln (in unserem Beispiel tut dies zabbix). </p><br><p>  ** Au√üerdem verwende ich kein NAT von <code>cbsd</code> , sondern konfiguriere es selbst in <code>pf</code> . </p><br><p> <code># sysrc pf_enable=YES</code> </p> <br><p> <code># ee /etc/pf.conf</code> </p> <br><pre> <code class="plaintext hljs">IF_PUBLIC="em0" IP_PUBLIC="1.23.34.56" JAIL_IP_POOL="192.168.0.0/24" #WHITE_CL="{ 127.0.0.1 }" icmp_types="echoreq" set limit { states 20000, frags 20000, src-nodes 20000 } set skip on lo0 scrub in all #NAT for jails nat pass on $IF_PUBLIC from $JAIL_IP_POOL to any -&gt; $IP_PUBLIC ## Bitcoin network port forward IP_JAIL="192.168.0.1" PORT_JAIL="{8333}" rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL</code> </pre><br><p> <code># service pf start</code> </p> <br><p> <code># pfctl -f /etc/pf.conf</code> </p> <br><p>  Das Konfigurieren von Firewall-Richtlinien ist ebenfalls ein separates Thema, daher werde ich nicht n√§her auf das Konfigurieren von BLOCK ALL-Richtlinien und Whitelist-Einstellungen eingehen. Lesen Sie hierzu die <a href="https://www.freebsd.org/doc/handbook/firewalls-pf.html">offizielle Dokumentation</a> oder einen der zahlreichen Artikel bei Google. </p><br><p>  Nun ... wir haben cbsd installiert, es ist Zeit, unser erstes Arbeitstier zu erstellen - einen Bitcoin-D√§mon in einem K√§fig! </p><br><p> <code>cbsd jconstruct-tui</code> </p> <br><p><img src="https://habrastorage.org/webt/jf/yn/l5/jfynl5o0yozaua314r4e65yxy0y.png"></p><br><p>  Hier sehen wir den Dialog zur Zellenerstellung.  Nachdem alle Werte festgelegt wurden, erstellen Sie! </p><br><p>  Beim Erstellen der ersten Zelle sollten Sie ausw√§hlen, auf welcher Basis die Zellen erstellt werden sollen.  Mit dem Befehl <code>repo</code> w√§hle ich das Distribution Kit aus dem FreeBSD-Repository aus.  Diese Auswahl wird nur beim Erstellen der ersten Zelle einer bestimmten Version getroffen (Sie k√∂nnen Zellen aller Versionen hosten, die √§lter als die Hostversion sind). </p><br><p>  Nachdem alles installiert ist - starte die Zelle! </p><br><p> <code># cbsd jstart bitcoind</code> </p> <br><p>  Wir m√ºssen jedoch Software im K√§fig installieren. </p><br><p> <code># jls</code> </p> <br><pre> <code class="plaintext hljs"> JID IP Address Hostname Path 1 192.168.0.1 bitcoind.space.com /zroot/jails/jails/bitcoind</code> </pre> <br><p>  <code>jexec bitcoind</code> um in die <code>jexec bitcoind</code> zu gelangen </p><br><p>  und bereits in der Zelle installieren wir Software mit ihren Abh√§ngigkeiten (unser Host-System bleibt sauber) </p><br><p> <code>bitcoind:/@[15:25] # pkg install bitcoin-daemon bitcoin-utils</code> </p> <br><p> <code>bitcoind:/@[15:30] # sysrc bitcoind_enable=YES</code> </p> <br><p> <code>bitcoind:/@[15:30] # service bitcoind start</code> </p> <br><p>  Es gibt Bitcoin in der Zelle, aber wir brauchen Anonymit√§t, weil wir √ºber das TOP-Netzwerk eine Verbindung zu einigen Zellen herstellen m√∂chten.  Im Allgemeinen planen wir, die meisten Zellen mit verd√§chtiger Software nur √ºber einen Proxy zu aktivieren.  Dank <code>pf</code> Sie NAT f√ºr einen bestimmten Bereich von IP-Adressen im lokalen Netzwerk deaktivieren und NAT nur f√ºr unseren TOR-Knoten zulassen.  Selbst wenn Malware in die Zelle gelangt, wird sie h√∂chstwahrscheinlich nicht mit der Au√üenwelt in Kontakt treten, und wenn dies der Fall ist, wird die IP unseres Servers nicht preisgegeben.  Aus diesem Grund erstellen wir eine weitere Zelle, um Dienste als ".onion" -Dienst und als Proxy f√ºr den Zugriff auf das Internet auf einzelne Zellen "weiterzuleiten". </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart tor</code> </p> <br><p> <code># jexec tor</code> </p> <br><p> <code>tor:/@[15:38] # pkg install tor</code> </p> <br><p> <code>tor:/@[15:38] # sysrc tor_enable=YES</code> </p> <br><p> <code>tor:/@[15:38] # ee /usr/local/etc/tor/torrc</code> </p> <br><p>  Wir h√∂ren auf die lokale Adresse (verf√ºgbar f√ºr alle Zellen) </p><br><p> <code>SOCKSPort 192.168.0.2:9050</code> </p> <br><p>  Was fehlt uns noch zum v√∂lligen Gl√ºck.  Ja, wir brauchen einen Dienst f√ºr unser Web, vielleicht keinen.  F√ºhren Sie nginx aus, das als Reverse-Proxy fungiert und f√ºr die Erneuerung der Let's Encrypt-Zertifikate sorgt </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart nginx-rev</code> </p> <br><p> <code># jexec nginx-rev</code> </p> <br><p> <code>nginx-rev:/@[15:47] # pkg install nginx py36-certbot</code> </p> <br><p>  <em>Und jetzt setzen wir 150 MB Abh√§ngigkeiten in einen K√§fig.</em>  <em>Und der Gastgeber ist immer noch sauber.</em> </p><br><p>  Kehren wir sp√§ter zur Konfiguration von Nginx zur√ºck. Wir m√ºssen zwei weitere Zellen f√ºr unser Zahlungs-Gateway auf NodeJS und Rust sowie eine Webanwendung, die aus irgendeinem Grund auf Apache und PkhP ausgef√ºhrt wird, und die MySQL-Datenbank f√ºr Letztere erh√∂hen. </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart paygw</code> </p> <br><p> <code># jexec paygw</code> </p> <br><p> <code>paygw:/@[15:55] # pkg install git node npm</code> </p> <br><p> <code>paygw:/@[15:55] # curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh</code> </p> <br><p>  <em>... und weitere 380 MB Pakete f√ºr sich</em> </p><br><p>  Als n√§chstes pumpen wir unsere Anwendung mit git auf und f√ºhren sie aus. </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart webapp</code> </p> <br><p> <code># jexec webapp</code> </p> <br><p> <code>webapp:/@[16:02] # pkg install mariadb104-server apache24 php74 mod_php74 php74-pdo_mysql</code> </p> <br><p>  <em>450 MB Pakete.</em>  <em>im K√§fig.</em> </p><br><p>  Hier geben wir dem Entwickler Zugriff √ºber SSH direkt auf die Zelle, er wird dort alles selbst machen: </p><br><p> <code>webapp:/@[16:02] # ee /etc/ssh/sshd_config</code> </p> <br><p>  <code>Port 2267</code> - √Ñndern Sie den Port der SSH-Zelle in einen beliebigen </p><br><p> <code>webapp:/@[16:02] # sysrc sshd_enable=YES</code> </p> <br><p> <code>webapp:/@[16:02] # service sshd start</code> </p> <br><p>  Nun, der Dienst l√§uft, es bleibt eine Regel in <code>pf</code> Firewall hinzuzuf√ºgen </p><br><p>  Mal sehen, welche IP wir in den Zellen haben und wie unsere "lokalka" aussieht </p><br><p> <code># jls</code> </p> <br><pre> <code class="plaintext hljs"> JID IP Address Hostname Path 1 192.168.0.1 bitcoind.space.com /zroot/jails/jails/bitcoind 2 192.168.0.2 tor.space.com /zroot/jails/jails/tor 3 192.168.0.3 nginx-rev.space.com /zroot/jails/jails/nginx-rev 4 192.168.0.4 paygw.space.com /zroot/jails/jails/paygw 5 192.168.0.5 webapp.my.domain /zroot/jails/jails/webapp</code> </pre> <br><p>  und f√ºgen Sie eine Regel hinzu </p><br><p> <code># ee /etc/pf.conf</code> </p> <br><pre> <code class="plaintext hljs">## SSH for web-Devs IP_JAIL="192.168.0.5" PORT_JAIL="{ 2267 }" rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL</code> </pre><br><p>  Nun, da wir hier sind, werden wir die gleiche Regel f√ºr Reverse-Proxy hinzuf√ºgen: </p><br><pre> <code class="plaintext hljs">## web-ports for nginx-rev IP_JAIL="192.168.0.3" PORT_JAIL="{ 80, 443 }" rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL</code> </pre> <br><p> <code># pfctl -f /etc/pf.conf</code> </p> <br><p>  <strong>Nun ein bisschen √ºber Bitcoins</strong> </p><br><p>  Was wir haben - wir haben eine Webanwendung, auf die von au√üen zugegriffen werden kann und die lokal mit unserem Zahlungsgateway kommuniziert.  Jetzt m√ºssen wir eine Arbeitsumgebung f√ºr die Interaktion mit dem Bitcoin-Netzwerk selbst <code>bitcoind</code> - der <code>bitcoind</code> Knoten ist nur ein Daemon, der eine lokale Kopie der aktuellen Blockchain unterst√ºtzt.  Dieser Daemon verf√ºgt √ºber RPC- und Wallet-Funktionen, es gibt jedoch bequemere "Wrapper" f√ºr die Entwicklung von Anwendungen.  Zun√§chst haben wir beschlossen, <code>electrum</code> - dies ist eine CLI-Brieftasche.  Wir werden <a href="https://electrum.org/">diese Brieftasche</a> als "K√§ltespeicher" f√ºr unsere Bitcoins verwenden - im Allgemeinen die Bitcoins, die "au√üerhalb" des Systems aufbewahrt werden m√ºssen, das f√ºr Benutzer zug√§nglich und im Allgemeinen f√ºr jedermann nicht zug√§nglich ist.  Er hat auch eine GUI, also werden wir die gleiche Brieftasche f√ºr unsere verwenden <br>  Laptops.  W√§hrend wir das electrum mit √∂ffentlichen Servern benutzen, und sp√§ter in einer anderen Zelle, werden wir <a href="https://github.com/kyuupichan/electrumx">ElectrumX</a> erh√∂hen, so dass es √ºberhaupt von niemandem abh√§ngt. </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart electrum</code> </p> <br><p> <code># jexec electrum</code> </p> <br><p> <code>electrum:/@[8:45] # pkg install py36-electrum</code> </p> <br><p>  <em>Weitere 700 MB Software in unserem K√§fig</em> </p><br><p> <code>electrum:/@[8:53] # adduser</code> </p> <br><pre> <code class="plaintext hljs">Username: wallet Full name: Uid (Leave empty for default): Login group [wallet]: Login group is wallet. Invite wallet into other groups? []: Login class [default]: Shell (sh csh tcsh nologin) [sh]: tcsh Home directory [/home/wallet]: Home directory permissions (Leave empty for default): Use password-based authentication? [yes]: no Lock out the account after creation? [no]: Username : wallet Password : &lt;disabled&gt; Full Name : Uid : 1001 Class : Groups : wallet Home : /home/wallet Home Mode : Shell : /bin/tcsh Locked : no OK? (yes/no): yes adduser: INFO: Successfully added (wallet) to the user database. Add another user? (yes/no): no Goodbye! electrum:/@[8:53] # su wallet</code> </pre> <br><p> <code>electrum:/@[8:53] # su wallet</code> </p> <br><p> <code>wallet@electrum:/ % electrum-3.6 create</code> </p> <br><pre> <code class="plaintext hljs">{ "msg": "Please keep your seed in a safe place; if you lose it, you will not be able to restore your wallet.", "path": "/usr/home/wallet/.electrum/wallets/default_wallet", "seed": "jealous win pig material ribbon young punch visual okay cactus random bird" }</code> </pre> <br><p>  Jetzt haben wir eine Brieftasche erstellt. </p><br><p> <code>wallet@electrum:/ % electrum-3.6 listaddresses</code> </p> <br><pre> <code class="plaintext hljs">[ "18WEhbjvMLGRMfwudzUrUd25U5C7uZYkzE", "14XHSejhxsZNDRtk4eFbqAX3L8rftzwQQU", "1KQXaN8RXiCN1ne9iYngUWAr6KJ6d4pPas", ... "1KeVcAwEYhk29qEyAfPwcBgF5mMMoy4qjw", "18VaUuSeBr6T2GwpSHYF3XyNgLyLCt1SWk" ]</code> </pre> <br><p> <code>wallet@electrum:/ % electrum-3.6 help</code> </p> <br><p>  Ab sofort kann sich nur noch ein begrenzter Personenkreis mit unserer <em>On-Chain-</em> Brieftasche verbinden.  Um den Zugriff von au√üen auf diese Zelle nicht zu √∂ffnen, werden SSH-Verbindungen √ºber TOR (eine solche dezentrale Version von VPN) hergestellt.  Wir starten SSH in der Zelle, ber√ºhren aber nicht unsere pf.conf auf dem Host. </p><br><p> <code>electrum:/@[9:00] # sysrc sshd_enable=YES</code> </p> <br><p> <code>electrum:/@[9:00] # service sshd start</code> </p> <br><p>  Schalten Sie jetzt den Internetzugang zur Zelle mit der Brieftasche aus.  Wir geben ihm eine IP-Adresse aus einem anderen Subnetzbereich, der nicht NAT-basiert ist.  √Ñndern Sie zun√§chst <code>/etc/pf.conf</code> auf dem Host </p><br><p> <code># ee /etc/pf.conf</code> </p> <br><p>  <code>JAIL_IP_POOL="192.168.0.0/24"</code> wird in <code>JAIL_IP_POOL="192.168.0.0/25"</code> , sodass alle Adressen 192.168.0.126-255 keinen direkten Zugriff auf das Internet haben.  Eine Art Software "Luftspalt" -Netzwerk.  Und die NAT-Regel bleibt unver√§ndert </p><br><p> <code>nat pass on $IF_PUBLIC from $JAIL_IP_POOL to any -&gt; $IP_PUBLIC</code> </p> <br><p>  √úberlastung der Regeln </p><br><p> <code># pfctl -f /etc/pf.conf</code> </p> <br><p>  Jetzt nimm unseren K√§fig </p><br><p> <code># cbsd jconfig jname=electrum</code> </p> <br><p><img src="https://habrastorage.org/webt/mj/zo/ui/mjzouia2v_lhuzln_o9inimlwca.png"></p><br><p><img src="https://habrastorage.org/webt/_x/7-/c9/_x7-c9zdmlojjeqrpzfmv2j5fpc.png"></p><br><pre> <code class="plaintext hljs">jset mode=quiet jname=electrum ip4_addr="192.168.0.200" Remove old IP: /sbin/ifconfig em0 inet 192.168.0.6 -alias Setup new IP: /sbin/ifconfig em0 inet 192.168.0.200 alias ip4_addr: 192.168.0.200</code> </pre> <br><p>  Hmm, aber jetzt wird das System selbst f√ºr uns nicht mehr funktionieren.  Wir k√∂nnen jedoch einen System-Proxy angeben.  Aber es gibt eine Sache, aber bei TOR handelt es sich um einen SOCKS5-Proxy, und der Einfachheit halber h√§tten wir auch einen HTTP-Proxy. </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart polipo</code> </p> <br><p> <code># jexec polipo</code> </p> <br><p> <code>polipo:/@[9:28] # pkg install polipo</code> </p> <br><p> <code>polipo:/@[9:28] # ee /usr/local/etc/polipo/config</code> </p> <br><pre> <code class="plaintext hljs">socksParentProxy = "192.168.0.2:9050" socksProxyType = socks5</code> </pre> <br><p> <code>polipo:/@[9:42] # sysrc polipo_enable=YES</code> </p> <br><p> <code>polipo:/@[9:43] # service polipo start</code> </p> <br><p>  Nun, jetzt gibt es in unserem System zwei Proxys, die beide √ºber TOR ausgegeben werden: socks5: //192.168.0.2: 9050 und <a href="http://192.168.0.6:8123/">http://192.168.0.6:8123</a> </p><br><p>  Jetzt k√∂nnen Sie die Umgebung unserer Brieftasche anpassen </p><br><p> <code># jexec electrum</code> </p> <br><p> <code>electrum:/@[9:45] # su wallet</code> </p> <br><p> <code>wallet@electrum:/ % ee ~/.cshrc</code> </p> <br><pre> <code class="plaintext hljs">#in the end of file proxy config setenv http_proxy http://192.168.0.6:8123 setenv https_proxy http://192.168.0.6:8123</code> </pre> <br><p>  Nun, jetzt funktioniert die Shell unter einem Proxy.  Wenn Sie Pakete installieren m√∂chten, sollten Sie <code>/usr/local/etc/pkg.conf</code> im Stammverzeichnis der Zelle hinzuf√ºgen </p><br><pre> <code class="plaintext hljs">pkg_env: { http_proxy: "http://my_proxy_ip:8123", }</code> </pre> <br><p>  Nun ist es an der Zeit, den TOR-Hidden-Service als Adresse f√ºr unseren SSH-Service in die Brieftaschenzelle aufzunehmen. </p><br><p> <code># jexec tor</code> </p> <br><p> <code>tor:/@[9:59] # ee /usr/local/etc/tor/torrc</code> </p> <br><pre> <code class="plaintext hljs">HiddenServiceDir /var/db/tor/electrum/ HiddenServicePort 22 192.168.0.200:22</code> </pre> <br><p> <code>tor:/@[10:01] # mkdir /var/db/tor/electrum</code> </p> <br><p> <code>tor:/@[10:01] # chown -R _tor:_tor /var/db/tor/electrum</code> </p> <br><p> <code>tor:/@[10:01] # chmod 700 /var/db/tor/electrum</code> </p> <br><p> <code>tor:/@[10:03] # service tor restart</code> </p> <br><p> <code>tor:/@[10:04] # cat /var/db/tor/electrum/hostname</code> </p> <br><pre> <code class="plaintext hljs">mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion</code> </pre> <br><p>  Hier ist unsere Verbindungsadresse.  Lassen Sie uns von der lokalen Maschine √ºberpr√ºfen.  Aber zuerst m√ºssen Sie unseren SSH-Schl√ºssel hinzuf√ºgen: </p><br><p> <code>wallet@electrum:/ % mkdir ~/.ssh</code> </p> <br><p> <code>wallet@electrum:/ % ee ~/.ssh/authorized_keys</code> </p> <br><pre> <code class="plaintext hljs">ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBAG9Fk2Lqi4GQ8EXZrsH3EgSrVIQPQaAlS38MmJLBabihv9KHIDGXH7r018hxqLNNGbaJWO/wrWk7sG4T0yLHAbdQAFsMYof9kjoyuG56z0XZ8qaD/X/AjrhLMsIoBbUNj0AzxjKNlPJL4NbHsFwbmxGulKS0PdAD5oLcTQi/VnNdU7iFw== user@local</code> </pre> <br><p>  Nun, von der Client-Linux-Maschine </p><br><p> <code>user@local ~$ nano ~/.ssh/config</code> </p> <br><pre> <code class="plaintext hljs">#remote electrum wallet Host remotebtc User wallet Port 22 Hostname mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion ProxyCommand /bin/ncat --proxy localhost:9050 --proxy-type socks5 %h %p</code> </pre><br><p>  Verbinden <em>(Damit dies funktioniert, ben√∂tigen Sie einen lokalen TOR-D√§mon, der auf dem 9050 lauscht.)</em> </p><br><p> <code>user@local ~$ ssh remotebtc</code> </p> <br><pre> <code class="plaintext hljs">The authenticity of host 'mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion (&lt;no hostip for proxy command&gt;)' can't be established. ECDSA key fingerprint is SHA256:iW8FKjhVF4yyOZB1z4sBkzyvCM+evQ9cCL/EuWm0Du4. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added 'mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion' (ECDSA) to the list of known hosts. FreeBSD 12.1-RELEASE-p1 GENERIC To save disk space in your home directory, compress files you rarely use with "gzip filename". -- Dru &lt;genesis@istar.ca&gt; wallet@electrum:~ % logout</code> </pre><br><p>  Erfolg! </p><br><p>  Um mit Sofort- und Mikrozahlungen arbeiten zu k√∂nnen, ben√∂tigen wir auch den <a href="https://www.lopp.net/lightning-information.html">Lightning-Netzwerkknoten.</a> Tats√§chlich wird dies unser Hauptwerkzeug f√ºr Bitcoin sein.  * <a href="https://github.com/ElementsProject/lightning">C-Lightning</a> , das wir als Daemon verwenden werden, verf√ºgt √ºber <a href="https://github.com/fiatjaf/sparko">ein Sparko-Plugin</a> , das eine vollst√§ndige HTTP-Schnittstelle (REST) ‚Äã‚Äãdarstellt und das Arbeiten sowohl mit Transaktionen au√üerhalb der Kette als auch mit Transaktionen <a href="https://github.com/fiatjaf/sparko">innerhalb</a> der Kette erm√∂glicht.  <code>c-lightning</code> ben√∂tigt einen <code>bitcoind</code> Knoten, um zu funktionieren. </p><br><p>  * <em>Es gibt verschiedene Implementierungen auf verschiedenen PLs des Lightning Network-Protokolls.</em>  <em>Von denen, die wir getestet haben, schien c-lightning (geschrieben in C) am stabilsten und ressourceneffizientesten zu sein</em> </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart cln</code> </p> <br><p> <code># jexec cln</code> </p> <br><p> <code>lightning:/@[10:23] # adduser</code> </p> <br><pre> <code class="plaintext hljs">Username: lightning ...</code> </pre> <br><p> <code>lightning:/@[10:24] # pkg install git</code> </p> <br><p> <code>lightning:/@[10:23] # su lightning</code> </p> <br><p> <code>cd ~ &amp;&amp; git clone https://github.com/ElementsProject/lightning</code> </p> <br><p> <code>lightning@lightning:~ % exit</code> </p> <br><p> <code>lightning:/@[10:30] # cd /home/lightning/lightning/</code> </p> <br><p> <code>lightning:/home/lightning/lightning@[10:31] # pkg install autoconf automake gettext git gmp gmake libtool python python3 sqlite3 libsodium py36-mako bash bitcoin-utils</code> </p> <br><p> <code>lightning:/home/lightning/lightning@[10:34] # ./configure &amp;&amp; gmake &amp;&amp; gmake install</code> </p> <br><p>  Erstellen Sie den RPC-Benutzer f√ºr <code>lightningd</code> in <code>bitcoind</code> w√§hrend alles kompiliert und installiert wird, was Sie ben√∂tigen </p><br><p> <code># jexec bitcoind</code> </p> <br><p> <code>bitcoind:/@[10:36] # ee /usr/local/etc/bitcoin.conf</code> </p> <br><pre> <code class="plaintext hljs">rpcbind=192.168.0.1 rpcuser=test rpcpassword=test #allow only c-lightning rpcallowip=192.168.0.7/32</code> </pre> <br><p> <code>bitcoind:/@[10:39] # service bitcoind restart</code> </p> <br><p>  <em>Mein chaotischer Wechsel zwischen Zellen ist nicht so chaotisch, wenn Sie das Dienstprogramm <code>tmux</code> beachten, mit dem Sie viele <code>tmux</code> von Terminals in einer Sitzung erstellen k√∂nnen.</em>  <em>Analog: <code>screen</code></em> </p><br><p><img src="https://habrastorage.org/webt/xu/cz/14/xucz14wosjbbeme4iis8ws4nxq8.png"></p><br><p>  Dackel, wir wollen nicht die reale IP unseres Knotens leuchten lassen, und wir wollen alle Finanztransaktionen √ºber die TOP abwickeln.  Deshalb brauchen Sie noch eine .onion. </p><br><p> <code># jexec tor</code> </p> <br><p> <code>tor:/@[9:59] # ee /usr/local/etc/tor/torrc</code> </p> <br><pre> <code class="plaintext hljs">HiddenServiceDir /var/db/tor/cln/ HiddenServicePort 9735 192.168.0.7:9735</code> </pre> <br><p> <code>tor:/@[10:01] # mkdir /var/db/tor/cln</code> </p> <br><p> <code>tor:/@[10:01] # chown -R _tor:_tor /var/db/tor/cln</code> </p> <br><p> <code>tor:/@[10:01] # chmod 700 /var/db/tor/cln</code> </p> <br><p> <code>tor:/@[10:03] # service tor restart</code> </p> <br><p> <code>tor:/@[10:04] # cat /var/db/tor/cln/hostname</code> </p> <br><pre> <code class="plaintext hljs">en5wbkavnytti334jc5uzaudkansypfs6aguv6kech4hbzpcz2ove3yd.onion</code> </pre> <br><p>  Jetzt erstelle eine Konfiguration f√ºr C-Lightning </p><br><p> <code>lightning:/home/lightning/lightning@[10:31] # su lightning</code> </p> <br><p> <code>lightning@lightning:~ % mkdir .lightning</code> </p> <br><p> <code>lightning@lightning:~ % ee .lightning/config</code> </p> <br><pre> <code class="plaintext hljs">alias=My-LN-Node bind-addr=192.168.0.7:9735 rgb=ff0000 announce-addr=en5wbkavnytti334jc5uzaudkansypfs6aguv6kech4hbzpcz2ove3yd.onion:9735 network=bitcoin log-level=info fee-base=0 fee-per-satoshi=1 proxy=192.168.0.2:9050 log-file=/home/lightning/.lightning/c-lightning.log min-capacity-sat=200000 # sparko plugin # https://github.com/fiatjaf/lightningd-gjson-rpc/tree/master/cmd/sparko sparko-host=192.168.0.7 sparko-port=9737 sparko-tls-path=sparko-tls #sparko-login=mywalletusername:mywalletpassword #sparko-keys=masterkey;secretread:+listchannels,+listnodes;secretwrite:+invoice,+listinvoices,+delinvoice,+decodepay,+waitpay,+waitinvoice sparko-keys=masterkey;secretread:+listchannels,+listnodes;ultrawrite:+invoice,+listinvoices,+delinvoice,+decodepay,+waitpay,+waitinvoice # for the example above the initialization logs (mixed with lightningd logs) should print something like</code> </pre> <br><p> <code>lightning@lightning:~ % mkdir .lightning/plugins</code> </p> <br><p> <code>lightning@lightning:~ % cd .lightning/plugins/</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins:% fetch https://github.com/fiatjaf/sparko/releases/download/v0.2.1/sparko_full_freebsd_amd64</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % mkdir ~/.lightning/sparko-tls</code> </p> <br><p> <code>lightning@lightning:~/.lightning/sparko-tls % cd ~/.lightning/sparko-tls</code> </p> <br><p> <code>lightning@lightning:~/.lightning/sparko-tls % openssl genrsa -out key.pem 2048</code> </p> <br><p> <code>lightning@lightning:~/.lightning/sparko-tls % openssl req -new -x509 -sha256 -key key.pem -out cert.pem -days 3650</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % chmod +x sparko_full_freebsd_amd64</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % mv sparko_full_freebsd_amd64 sparko</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % cd ~</code> </p> <br><p>  Sie m√ºssen auch eine Konfigurationsdatei f√ºr bitcoin-cli erstellen, ein Dienstprogramm, das mit <code>bitcoind</code> kommuniziert </p><br><p> <code>lightning@lightning:~ % mkdir .bitcoin</code> </p> <br><p> <code>lightning@lightning:~ % ee .bitcoin/bitcoin.conf</code> </p> <br><pre> <code class="plaintext hljs">rpcconnect=192.168.0.1 rpcuser=test rpcpassword=test</code> </pre> <br><p>  √ºberpr√ºfen </p><br><p> <code>lightning@lightning:~ % bitcoin-cli echo "test"</code> </p> <br><pre> <code class="plaintext hljs">[ "test" ]</code> </pre> <br><p>  <code>lightningd</code> starten </p><br><p> <code>lightning@lightning:~ % lightningd --daemon</code> </p> <br><p>  <code>lightning-cli</code> selbst kann mit dem <code>lightning-cli</code> gesteuert werden. Beispiel: </p><br><p>  <code>lightning-cli newaddr</code> <em>erh√§lt Adresse f√ºr neuen Zahlungseingang</em> </p><br><pre> <code class="plaintext hljs">{ "address": "bc1q2n2ffq3lplhme8jufcxahfrnfhruwjgx3c78pv", "bech32": "bc1q2n2ffq3lplhme8jufcxahfrnfhruwjgx3c78pv" }</code> </pre> <br><p>  <code>lightning-cli withdraw bc1jufcxahfrnfhruwjgx3cq2n2ffq3lplhme878pv all</code> <em>an die adresse senden</em> <code>lightning-cli withdraw bc1jufcxahfrnfhruwjgx3cq2n2ffq3lplhme878pv all</code> <em>geld (alle an der kette befindlichen</em> <code>lightning-cli withdraw bc1jufcxahfrnfhruwjgx3cq2n2ffq3lplhme878pv all</code> <em>)</em> </p><br><p>  Auch Befehle f√ºr Off-Chain-Operationen von <code>lightning-cli invoice</code> , <code>lightning-cli listinvoices</code> , <code>lightning-cli pay</code> <code>lightning-cli listinvoices</code> <code>lightning-cli pay</code> usw. </p><br><p>  Nun, f√ºr die Kommunikation mit der Anwendung haben wir REST Api </p><br><p> <code>curl -k https://192.168.0.7:9737/rpc -d '{"method": "pay", "params": ["lnbc..."]}' -H 'X-Access masterkey'</code> </p> <br><p>  <strong>Um es zusammenzufassen</strong> </p><br><p> <code># jls</code> </p> <br><pre> <code class="plaintext hljs"> JID IP Address Hostname Path 1 192.168.0.1 bitcoind.space.com /zroot/jails/jails/bitcoind 2 192.168.0.2 tor.space.com /zroot/jails/jails/tor 3 192.168.0.3 nginx-rev.space.com /zroot/jails/jails/nginx-rev 4 192.168.0.4 paygw.space.com /zroot/jails/jails/paygw 5 192.168.0.5 webapp.my.domain /zroot/jails/jails/webapp 7 192.168.0.200 electrum.space.com /zroot/jails/jails/electrum 8 192.168.0.6 polipo.space.com /zroot/jails/jails/polipo 9 192.168.0.7 lightning.space.com /zroot/jails/jails/cln</code> </pre> <br><p><img src="https://habrastorage.org/webt/nt/0k/ew/nt0kewrhuin48nj-lbfk1jpa4rc.png"></p><br><p>     ,            . </p><br><p> <code># zfs list</code> </p> <br><pre> <code class="plaintext hljs">NAME USED AVAIL REFER MOUNTPOINT zroot 279G 1.48T 88K /zroot zroot/ROOT 1.89G 1.48T 88K none zroot/ROOT/default 1.89G 17.6G 1.89G / zroot/home 88K 1.48T 88K /home zroot/jails 277G 1.48T 404M /zroot/jails zroot/jails/bitcoind 190G 1.48T 190G /zroot/jails/jails-data/bitcoind-data zroot/jails/cln 653M 1.48T 653M /zroot/jails/jails-data/cln-data zroot/jails/electrum 703M 1.48T 703M /zroot/jails/jails-data/electrum-data zroot/jails/nginx-rev 190M 1.48T 190M /zroot/jails/jails-data/nginx-rev-data zroot/jails/paygw 82.4G 1.48T 82.4G /zroot/jails/jails-data/paygw-data zroot/jails/polipo 57.6M 1.48T 57.6M /zroot/jails/jails-data/polipo-data zroot/jails/tor 81.5M 1.48T 81.5M /zroot/jails/jails-data/tor-data zroot/jails/webapp 360M 1.48T 360M /zroot/jails/jails-data/webapp-data</code> </pre> <br><p>  , bitcoind   190  .          ?  ZFS   .   <code>cbsd jclone old=bitcoind new=bitcoind-clone host_hostname=clonedbtc.space.com</code>          .        ,               (   190 ) </p><br><p>       ZFS,    . <a href="https://www.freebsd.org/doc/handbook/zfs-zfs.html">ZFS   </a>     ,     SSH.    ,   . </p><br><p>        ,      <a href="https://zabbix.org/wiki/Main_Page">Zabbix</a> . </p><br><p> <strong> ‚Äî </strong> </p><br><p>   ,        : </p><br><p> <em></em> ‚Äî   UNIX-     .           ‚Äî .          .           .                   .       -,             . </p><br><p> <em></em> ‚Äî        . -       , ECC , ZFS  " "        .            .   -     . </p><br><p> <em></em> ‚Äî   .           .           .                (     ).           ,         . </p><br><p> <em> </em> ‚Äî            ,  .          ,               . </p><br><p>            ,     ,    ,         . </p><br><p> <strong>    ?</strong> </p><br><p>     cbsd  <a href="https://www.bsdstore.ru/en/11.2.x/wf_bcreate_ssi.html"> </a> .   ,    <code>bhyve</code>     . </p><br><p> <code># cat /etc/rc.conf</code> </p> <br><pre> <code class="plaintext hljs">... kld_list="vmm if_tap if_bridge nmdm" ...</code> </pre> <br><p> <code># cat /boot/loader.conf</code> </p> <br><pre> <code class="plaintext hljs">... vmm_load="YES" ...</code> </pre> <br><p>        ,   - debian  ! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ffd/cb6/219/ffdcb6219c701e2e114100d9601e9fea.gif"></p><br><p> <strong>  </strong> </p><br><p>       .          ‚Äî <a href="https://sochain.com/address/BTC/bc1qu7lhf45xw83ddll5mnzte6ahju8ktkeu6qhttc">bc1qu7lhf45xw83ddll5mnzte6ahju8ktkeu6qhttc</a> .          ,      <a href="https://bitclouds.sh/">pet-project</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de477124/">https://habr.com/ru/post/de477124/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de477110/index.html">Unterhaltsame Planung</a></li>
<li><a href="../de477114/index.html">Implementierung des MSH-Interpreters</a></li>
<li><a href="../de477118/index.html">MIRO ist eine offene Indoor-Roboterplattform. Teil 5 - Softwarekomponente: ARDUINO (AVR), wir klettern "unter der Haube"</a></li>
<li><a href="../de477120/index.html">Kontinuierliche Blutzuckermesssoftware f√ºr Windows</a></li>
<li><a href="../de477122/index.html">Das Gehirn der Firma. Teil 3</a></li>
<li><a href="../de477126/index.html">Admin in 5 Minuten. Frontend - React-Admin, Backend - Flask-RESTful</a></li>
<li><a href="../de477128/index.html">Habra Detektiv am Wochenende</a></li>
<li><a href="../de477130/index.html">"Eugene Onegin": Inversion (N.-F. Geschichte)</a></li>
<li><a href="../de477132/index.html">Personenbezogene Daten in der Russischen F√∂deration: Wer sind wir alle? Wohin gehen wir?</a></li>
<li><a href="../de477136/index.html">Wie FL.ru Benutzer t√§uscht, indem es einen Dienst zweimal verkauft und dabei gegen seine eigenen Regeln verst√∂√üt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>