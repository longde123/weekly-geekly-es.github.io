<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔭 😏 👨🏽‍🎓 Entwicklung einer Power Bank für einen Laptop. Vom Layout bis zum fertigen Produkt. Zweiter Teil 🤲🏿 👂🏽 🎎</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im letzten Teil des Artikels über die Entwicklung der PowerBank für einen Laptop haben wir uns auf ein hergestelltes Layout, eine gemessene Effizienz ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Entwicklung einer Power Bank für einen Laptop. Vom Layout bis zum fertigen Produkt. Zweiter Teil</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/386899/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im letzten Teil des Artikels über die </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entwicklung der PowerBank für einen Laptop haben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wir uns auf ein hergestelltes Layout, eine gemessene Effizienz und ein Verständnis für die nächsten </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Schritte festgelegt</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Und dann musste das Stück Eisen wiederbelebt werden. </font><font style="vertical-align: inherit;">Deshalb präsentiere ich Ihnen Teil zwei: Software-Layout.</font></font><br>
<img src="https://habrastorage.org/files/368/fcc/f59/368fccf5979c4932a392b911139c892b.png"><br>
<a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Bruch zwischen den Teilen erwies sich als ziemlich groß - alle Kräfte wurden auf das Projekt einer schnell </font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">aufladbaren</font></a></b><font style="vertical-align: inherit;"> externen Batterie </font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">geworfen</font></a></b><font style="vertical-align: inherit;"> , die jetzt beim </font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">Boomstarter</font></a></b><font style="vertical-align: inherit;"> Unterstützung </font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">findet</font></a></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">
Lass uns weitermachen. </font><font style="vertical-align: inherit;">
Um zu verstehen, welche Mikroschaltungen wir programmieren müssen, sehen wir uns das Blockdiagramm des Layouts an. </font><font style="vertical-align: inherit;">
Von hier aus ist klar, dass wir Software für die Steuerung MK (STM32F042) schreiben und das Li-Ionen-Batteriesteuerungssystem + Ladegerät (BQ40Z60) konfigurieren müssen. Ich habe mit dem zweiten angefangen, weil ich diesen Teil für den schwierigsten hielt. </font><font style="vertical-align: inherit;">
Zum Programmieren des BQ40Z60-Controllers benötigen wir: </font><font style="vertical-align: inherit;">
 - den Adapter EV2400 und EV2300 ( </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">fertig</font></a><font style="vertical-align: inherit;"> oder hausgemacht). Ich habe den EV2300 aus früheren Projekten verlassen und ihn verwendet. </font><font style="vertical-align: inherit;">
 - Programm</font></font><b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a></b><font style="vertical-align: inherit;"></font><br>
<br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br>
<img src="https://habrastorage.org/files/87a/3e9/68e/87a3e968e1dc4112a6e96f5375e7b2f8.png"><br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Batteriemanagement-Studio (bqStudio)</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Adapter wird über den SMBus-Bus angeschlossen, für den Anschluss habe ich Lötpunkte auf den SMBD- und SMBC-Leitungen gelassen. (Nicht die praktischste Lösung - dann wurde mir klar, dass ich den Stecker installieren musste). </font></font><br>
<img src="https://habrastorage.org/files/90a/c7d/ddf/90ac7dddfa184d8498d418b786c853fa.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem der BQ40Z60 mit einem Tamburin getanzt hatte, entschied er sich für das Battery Management Studio. Der Grund dafür war der Ruhemodus, in den der Controller wechselt, wenn auf dem SMBus-Bus kein Pull-up und kein Zugriff darauf erfolgt. Er wacht auf, wenn er die Erinnerung verbindet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als nächstes werden wir den BQ40Z60-Chip direkt abstimmen. Zu sagen, dass er viele Register hat, bedeutet nichts zu sagen. Eine Million Einstellungen. Da die Konfiguration ein langer und komplizierter Prozess ist (zur Beschreibung ist ein separater Artikel erforderlich), werde ich ihn kurz beschreiben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem Start wird das Hauptfenster von Battery Management Studio angezeigt.</font></font><br>
<img src="https://habrastorage.org/files/8c5/bb5/610/8c5bb561090943eebcb578c4b6891727.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Registerkarte Datenspeicher enthält eine Vielzahl von Feldern, in die wir die Batterieparameter und die Betriebsarten der Steuerung eingeben müssen. </font></font><br>
<img src="https://habrastorage.org/files/d9a/b9a/c2a/d9ab9ac2ac5140debab0ccb00a154b92.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der Registerkarte Chemie können Sie versuchen, vorgefertigte Kalibrierungen für die verwendeten Zellen zu finden. </font></font><br>
<img src="https://habrastorage.org/files/fad/140/d49/fad140d49cbd4e4d8837098da6af29f1.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Für meinen YOKU LP 5558115 3500mAh gab es keine vorgefertigten Kalibrierungen (die Kalibrierungen werden übrigens ständig </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aktualisiert</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Gefunden ähnliche YOKU LP 656193 4000mAh. Nachdem ich festgestellt habe, dass ich noch nichts über die verfügbaren Pakete weiß, habe ich dieses Profil ausgewählt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dann habe ich auf der Registerkarte Datenspeicher Folgendes konfiguriert: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kalibrierung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kalibrierungswerte für Voltmeter (Zellen, Batterien und ein externer Adapter), Widerstand des Stromsensors, Kalibrierungswerte für den Temperatursensor. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Einstellungen:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inklusive Schutz, Thermistoren, LEDs, Ruhemodus, Batteriekonfiguration. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Schutz:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Einstellen der Schutzschwellen (Spannung, Zeit, Temperatur), Einstellen der Spannungsschwellen des externen Adapters. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permanenter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fehler </font><b><font style="vertical-align: inherit;">:</font></b><font style="vertical-align: inherit;"> Festlegen von Schwellenwerten für irreversible Fehler (sodass ein weiterer Batteriebetrieb nicht möglich ist). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erweiterter Ladealgorithmus:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Einstellen des Ladegeräts (Ströme, Spannungen für verschiedene Temperaturbereiche, Vorzeichen des Ladeendes, Ausgleich). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gasmessung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Einstellung des Geräts zur Bestimmung des Ladezustands (Typenschildkapazität / Zellenspannung, Drahtwiderstand, Statistik). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leistung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Einstellen der Betriebsarten des Controllers. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PF-Status:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permanenter Fehlerstatus Bitstatus </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Systemdaten:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Felder für Herstellerdaten. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SBS-Konfiguration:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Einstellen der Auslöseschwellen für den Alarmauslöser, grundlegende Batterieinformationen (Seriennummer, Produktionsdatum, Hersteller, Name, Chemie). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED-Unterstützung:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Einstellen des Modus der LED-Anzeigelampe. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Black Box:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Black Box (Verlauf der Änderungen der Statusbits des Schutzes). </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lebensdauer:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Batteriestatistik. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ra-Tabelle: Eine</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tabelle der internen Zellwiderstände. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Während des Einrichtungsprozesses habe ich nicht alle Felder geändert, aber dies war genug, um zu beginnen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit diesem Teil der Schaltung war nur ein Hardware-Pfosten an den Ausgang der 21-AFEFUSE-Mikroschaltung angeschlossen. Es passierte so:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe den Stromkreis von der </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug-Platine gerissen, mit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ausnahme des Mikrokreises für den Sekundärschutz und der durchgebrannten Sicherung. Der BQ40Z60 verfügt über 21 AFEFUSE-Stifte zum Durchbrennen einer Sicherung (wie ich dachte). Also schaute ich auf die 5. Seite des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BQ40Z60-Datenblattes.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ich sah die </font></font><br>
<img src="https://habrastorage.org/files/f1c/964/667/f1c964667aa042cdae2a1d63122e9b67.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Art der Ausgabe Ausgabe </font><font style="vertical-align: inherit;">in der Tabelle </font><font style="vertical-align: inherit;">und ließ sie mit gutem Gewissen in der Luft hängen. Die Probleme traten nach dem Löten der Platine auf: Ich habe alle Einstellungen sortiert (und zu diesem Zeitpunkt gab es viele Zweifel), aber es hat nicht funktioniert - die Lade- und Entladungstransistoren ließen sich nicht einschalten. Nach 2 Tagen voller Zweifel / Überlegungen / Versuch und Irrtum bemerkte ich, dass das Bit FUSE_EN nicht gesetzt war und beschloss, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Leute</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zu </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">fragen",</font></a><font style="vertical-align: inherit;"> und als ich eine Frage stellte, kam mir ein Einblick</font></font><br>
<img src="https://habrastorage.org/files/13b/a37/caf/13ba37caf5564b55896121eb247369e0.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mit Blick auf die Platine der Debug-Platine schlug ich vor, dass der AFEFUSE-Pin auch ein Eingang sein kann, was durch Abschnitt 9.3.2.4, S. 24 bestätigt wurde. Wenn der Pin nicht verwendet wird, muss er mit Masse verbunden werden. Ich habe es mit einer Pinzette gemacht und es hat funktioniert. Nach 5 Minuten antworteten sie mir auf e2e.com - die Antwort ist klar und richtig, ich drückte mein "Phi" über den Fehler in der Ausgabetabelle aus - sie versprachen, ihn in zukünftigen Versionen der Dokumentation zu beheben. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Controller-Einstellungen zu beenden, habe ich 2 Trainingszyklen mit vollem Laden / Entladen + Entspannung durchgeführt (insgesamt 30 Stunden). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fahren wir nun mit der Programmierung des STM32F042 fort. In der Scheinphase benötigte dieser Prozessor nicht viel: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Steuern Sie den Spannungswandler, verarbeiten Sie die Tasten.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Gehen Sie so weit wie möglich in den Schlaf, um den Akku nicht zu entladen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Lesen Sie die Hauptparameter der Batterie von der Steuerung ab (Spannung, Strom, Ladezustand, Temperatur, Stromzustand, Anzahl der Zyklen, Zeit bis zum vollständigen Laden / Entladen) und geben Sie sie über USART an den PC aus (da der CP2102-Konverter bereits auf der Platine war). Obwohl der Prozessor USB an Bord enthält, habe ich ihn nicht im Layout verwendet, und es wurde ein Layout für 051 MK erstellt, aber ich konnte es nicht kaufen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Steuerung des Wandlers wurde auf zwei Schlussfolgerungen (Einschalten und Betriebsmodus) reduziert, wobei die PWM (mit anschließender RC-Filterung) an den Ausgang der LTC3780-Chipumwandlungsfrequenzeinstellung (als Ergebnis wurde die Frequenz auf maximal 400 kHz eingestellt) und an den PowerGood-Signalüberwachungseingang geliefert wurde. Aber auch hier habe ich es geschafft, auf den Rechen zu treten. Der Fehler schwebte und trat auf, als sich die Power Bank für eine lange Zeit hinlegte, was sich darin äußerte, dass sie sich einfach nicht einschaltete. Das Problem war, dass ich zuerst den Interrupt für das PowerGood-Signal vom LTC3780 und dann den Chip selbst (EN) einschaltete. Es stellte sich heraus, dass der Interrupt bereits vor dem Start des Konverters ausgelöst und ausgeschaltet wurde. Ereignisse an bestimmten Stellen neu angeordnet und eine Verzögerung hinzugefügt - das Problem verschwand. Ansonsten war diese Funktionalität einfach.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es wurde beschlossen, eine Benutzeroberfläche mit 1 Taste und 5 (6) LEDs zu erstellen (obwohl sich 2 Tasten und 10 LEDs auf der Layoutplatine befanden). Es funktioniert wie folgt: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Gerät ist ausgeschaltet -&gt; kurzes Drücken (&lt;500 ms) - Animation des Ladezustands auf 4 LEDs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Gerät ist ausgeschaltet -&gt; lange drücken (&gt; 500 ms) - Gerät einschalten (die 5. LED leuchtet auf). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Gerät ist ausgeschaltet -&gt; Speicher anschließen -&gt; Animation des Ladezustands auf 4 LEDs bis zum Ende des Ladevorgangs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Gerät ist eingeschaltet -&gt; kurz drücken - Animation des Ladezustands auf 4 LEDs. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gerät ein -&gt; lange drücken - Gerät ausschalten. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gerät aus -&gt; Stromaufnahme unter 50 mA für mehr als 3 min. - Gerät ausschalten.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dadurch konnten 27 Elemente aus dem Gerät entfernt werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich hatte bereits Erfahrung mit der Implementierung von Schlafmodi auf STM32F0xx, daher habe ich hier nicht mit einem großen Rechen gerechnet. Um den Verbrauch zu optimieren, habe ich zuerst das 3,3-V-LDO durch mcp1703 mit einem geringen Strom meines eigenen Verbrauchs ersetzt (es war notwendig, nicht vom Debuggen abzureißen, sondern es sofort zu installieren). Größe, Preis, Verbrauch, Bodykit - alles weniger als beim LP2951. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dank an </font></font></b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hardegor</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> für die Bearbeitung von LDO für Li-Ion 4s. Mcp1703 kann aufgrund der niedrigen Eingangsspannung nicht verwendet werden. Ich habe LiFePo4 für die Chemie verwendet - es gibt kein solches Problem. Seien Sie vorsichtig!!!</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
-Wenn das Gerät ausgeschaltet ist, befindet sich der MK im STANDBY-Modus und reagiert nur auf Knopfdruck oder Anschließen eines Speichergeräts. Der Verbrauch in diesem Modus beträgt 108 μA (100 davon verbrauchen BQ40Z60). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Wenn das Gerät eingeschaltet ist, befindet sich der Prozessor die meiste Zeit (mit Ausnahme der Momente der Anzeige und Abfrage des BQ40Z60) im STOP-Modus mit einem Verbrauch von 1,5 mA (1 mA ist eine LED). Zum Zeitpunkt der Abfrage und Anzeige liegt der Stromverbrauch zwischen 4,5 und 9 mA. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
- Wenn ein USB MK im 48-MHz-RUN-Modus angeschlossen ist, beträgt der Verbrauch 15 mA. In Zukunft werde ich den MK in diesem Modus über USB mit Strom versorgen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das größte potenzielle Problem war die Umfrage BQ40Z60. Ich habe nicht mit SMBus gearbeitet und bis zum letzten Mal gehofft, dass SMBus I2C 1v1 ist (dies liegt teilweise daran, dass die physische Ebene für sie gleich ist), aber es stellte sich heraus, dass die Kanalebene sehr unterschiedlich ist und dies eine Reihe von Schwierigkeiten verursachte. Hier werde ich nicht die Unterschiede zwischen SMBus und I2C beschreiben, sondern einen Link zu einem ziemlich kompetenten </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Artikel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bereitstellen </font><font style="vertical-align: inherit;">. In der Phase des Layouts war ich nicht in den Kampf gegen SMBus involviert (übrigens bin ich als Programmierer viel schwächer als ein Schaltungsentwickler) und da die Sende- und Empfangsbytebefehle in SMBus und I2C völlig identisch waren, habe ich nur sie verwendet. Als Ergebnis las ich SOC, SOH, Current, CellVolt, TimeToFull, TimeToEmpty vom BQ40Z60. Abhängig von den Werten der Register änderte sich die Betriebsart (Warnungen wurden ausgegeben, es kam zu einem Herunterfahren).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Auf der PC-Seite wurde natürlich ein Programm benötigt, das die von der Batterie gelesenen Daten in einer bequemen Form anzeigen konnte. Da ich in Borland C ++ Builder nur GUIs verwenden konnte und dies lange Zeit tat, bat ich den Programmierer, ein einfaches Debugging für mich zu skizzieren. Für eine schnelle Peitsche kam folgendes heraus:</font></font><br>
<img src="https://habrastorage.org/files/62e/18d/c55/62e18dc550c04870a8d51acb5dda6691.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist die gesamte Arbeit, die in der Layoutphase ausgeführt wurde. </font><font style="vertical-align: inherit;">Weiter in den Plänen (und da ich die bereits abgeschlossenen Operationen beschreibe, wurde ein Teil der Arbeit bereits ausgeführt), die Übertragung technischer Spezifikationen an den Konstrukteur für die Entwicklung / Herstellung des PowerBank-Pakets, Fehlerkorrektur / Überarbeitung der Schaltung, Änderung der Platine für den Fall, Softwarerevision. </font><font style="vertical-align: inherit;">Danach ähnelt das Gerät einem Produkt und wird nach Fertigstellung zu einem Produkt im wahrsten Sinne des Wortes. </font><font style="vertical-align: inherit;">In den folgenden Teilen des Artikels werden wir die Phasen und Hauptschwierigkeiten des Übergangs von einem Layout zu einem fertigen Produkt betrachten, an der Verpackung arbeiten, die Kosten für verschiedene Lösungen und Vorgänge berücksichtigen, optimieren und auch das Endergebnis sehen.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de386899/">https://habr.com/ru/post/de386899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de386883/index.html">Wie wir den Rand der Realität auslöschten</a></li>
<li><a href="../de386891/index.html">Die UHK-Tastatur ist noch besser und komfortabler: jetzt mit optionalen Modulen und einer ergonomischen Handballenauflage</a></li>
<li><a href="../de386893/index.html">Neue Prozesstechnologie reduziert die Graphenkosten um das 100-fache</a></li>
<li><a href="../de386895/index.html">Pre-Reality - schön, Sicherheit - profitabel</a></li>
<li><a href="../de386897/index.html">Unkraut jäten? Nichts ist einfacher, laden Sie es Bosch auf</a></li>
<li><a href="../de386901/index.html">Natürliche Energie</a></li>
<li><a href="../de386903/index.html">Stormbuddy Bot Creator für WOW beschuldigt Blizzard, Quellcode gestohlen zu haben</a></li>
<li><a href="../de386905/index.html">Australien verbietet die Speicherung von Dateien für den 3D-Druck von Schusswaffen</a></li>
<li><a href="../de386911/index.html">Sony Xperia Z5 Bewertung</a></li>
<li><a href="../de386915/index.html">Der Unterschied in der Weckzeit zwischen Wochentagen und Wochenenden ist mit gesundheitlichen Problemen verbunden</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>