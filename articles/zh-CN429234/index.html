<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👵🏼 💬 😹 在Godot Engine上创建游戏“ Like coin”。 第一部分 👨‍💼 🤐 🧕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Godot Engine的发展非常迅速，并赢得了世界各地游戏开发商的青睐。 也许这是用于创建游戏的最友好，最易学的工具，为确保这一点，请尝试制作小型2D游戏。 为了更好地理解游戏开发过程，您应该从2D游戏开始-这将降低进入更严格的游戏系统的门槛。 尽管向3D过渡本身并不像看起来那样困难，但是毕竟Go...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>在Godot Engine上创建游戏“ Like coin”。 第一部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429234/"><p>  Godot Engine的发展非常迅速，并赢得了世界各地游戏开发商的青睐。 也许这是用于创建游戏的最友好，最易学的工具，为确保这一点，请尝试制作小型2D游戏。 为了更好地理解游戏开发过程，您应该从2D游戏开始-这将降低进入更严格的游戏系统的门槛。 尽管向3D过渡本身并不像看起来那样困难，但是毕竟Godot Engine中的大多数功能都可以在2D和3D中成功使用。 </p><a name="habracut"></a><br><h3 id="vvedenie"> 引言 </h3><br><p>您能想到的最简单的事情是一款游戏，其中我们的主角会收集硬币。 要使其复杂一点，请添加障碍和时间作为限制因素。 该游戏将包含3个场景： <code>Player</code> ， <code>Coin</code>和<code>HUD</code> （不考虑本文），它们将合并为一个<code>Main</code>场景。 </p><br><p><img src="https://habrastorage.org/webt/vu/vv/ct/vuvvctv4zp9csexcarj4_zitxje.png"></p><br><h3 id="nastroyki-proekta"> 项目设定 </h3><br><p> 在投入编写脚本（脚本）（大约占创建游戏总时间的80-90％）之前，首先要做的是设置我们的未来项目。 在大型项目中，创建用于存储脚本，场景，图像和声音的单独文件夹很有用，我们绝对应该考虑到这一点，因为谁知道最终的结果。 </p><br><blockquote> 我想立即保留一下，因为本文假设您对Godot Engine有点熟悉，并且您具有使用此工具的一些知识和技能，尽管我将重点介绍您是第一次遇到Godot Engine，但我仍然我建议您首先熟悉引擎的基本组件，研究GDScript的语法，并了解所使用的术语（节点，场景，信号等），然后再回到此处继续认识。 </blockquote><p> 在程序菜单中，转到<code>Project -&gt; Project Settings</code> 。 </p><br><blockquote> 另一个小的题外话。 我将始终基于最终用户使用引擎的英语界面这一事实给出示例，尽管事实是“ Godot引擎”支持俄语。 这样做是为了消除与程序接口某些元素的错误/不正确翻译有关的可能的误解或尴尬。 </blockquote><p> 找到“ <code>Display/Window</code>部分，并将宽度设置为<code>800</code> ，将高度设置为<code>600</code> 。 同样在本节中，将“ <code>Stretch/Mode</code>设置为“ <code>2D</code> ，将“ <code>Aspect</code>为“ <code>Keep</code> 。 这将防止更改其大小时窗口内容的拉伸和变形，但是要防止窗口被调整大小，只需取消选中“ <code>Resizable</code>大小”框即可。 我建议您尝试这些选项。 </p><br><p> 现在转到“ <code>Rendering/Quality</code>部分，并在右窗格中启用“ <code>Use Pixel Snap</code> ”。 这是为了什么  Godot引擎中向量的坐标是浮点数。 由于不能仅绘制半个像素就可以绘制对象，因此这种差异会导致使用<code>pixelart</code>游戏出现视觉缺陷。 值得注意的是，在3D中此选项没有用。 请记住这一点。 </p><br><h3 id="scena-igrok"> 玩家场景 </h3><br><p> 让我们开始创建第一个场景<code>Player</code> 。 </p><br><blockquote> 任何场景的优点在于，它们最初与游戏的其他部分无关，这使得可以自由测试它们并获得最初放置在其中的结果。 通常，将游戏对象划分为场景是创建复杂游戏的有用工具-更容易发现错误，对场景本身进行更改，而游戏的其他部分不会受到影响，它们还可以用作其他游戏的模板，并且它们肯定也会发挥作用。因为他们在调动之前工作。 </blockquote><p> 创建场景是一个简单的动作-在“ <code>Scene</code>选项卡上，单击<code>+</code> （添加/创建）并选择<code>Area2D</code>节点，然后立即更改其名称，以免引起混淆。 这是我们的父节点，要扩展功能，您需要添加子节点。 在我们的例子中，它们是<code>AnimatedSprite</code>和<code>CollisionShape2D</code> ，但我们不要着急，而是按顺序开始。 接下来，立即“锁定”根节点： </p><br><p><img src="https://habrastorage.org/webt/5m/wf/ac/5mwfacrfvyjm6wtkmkqlgd_pasu.png"></p><br><p> 如果将身体碰撞形式（CollisionShape2D）或精灵（AnimatedSprite）相对于父节点拉伸，拉伸，则肯定会导致无法预料的错误，以后将很难纠正它们。 启用此选项后，“父母”及其所有“孩子”将始终一起移动。 听起来很有趣，但是使用此功能非常有用。 </p><br><h4 id="animatedsprite"> 动画精灵 </h4><br><p> 如果您需要了解与其他对象的重叠事件或它们之间的碰撞， <code>Area2D</code>非常有用的节点，但是就其本身而言，它是肉眼不可见的，并且要使<code>Player</code>对象可见，可以添加<code>AnimatedSprite</code> 。 节点的名称告诉我们，我们将处理动画和精灵。 在“ <code>Inspector</code>窗口中，转到<code>Frames</code>参数并创建一个新的<code>SpriteFrames</code> 。 使用<code>SpriteFrames</code>面板可创建必要的动画并将相应的精灵加载到其中。 我们不会详细分析创建动画的所有阶段，而是将其留给独立研究，我只能说我们应该拥有三个动画： <code>walk</code> （行走动画）， <code>idle</code> （静止状态）和<code>die</code> （死亡或失败动画）。 不要忘记<code>SPEED (FPS)</code>的值应为<code>8</code> （尽管您可以选择其他值-合适）。 </p><br><p><img src="https://habrastorage.org/webt/0u/9w/tr/0u9wtrugdci7wueb5tihyoza2hq.png"></p><br><h4 id="collisionshape2d">  Collisionshape2d </h4><br><p> 为了使<code>Area2D</code>能够检测到碰撞，您必须为其提供对象的形状。 形状由<code>Shape2D</code>参数确定，包括矩形，圆形，多边形和其他更复杂的形状类型，并且尺寸已经在编辑器本身中进行了编辑，但是您始终可以使用<code>Inspector</code>进行微调。 </p><br><h4 id="scenarii"> 情境 </h4><br><p> 现在，为了“复活”我们的游戏对象，您需要为其设置脚本，根据该脚本将执行本场景中规定的我们设置的动作。 在“ <code>Scene</code>选项卡中，创建一个脚本，保留默认设置，删除所有注释（以“＃”符号开头的行）并继续声明变量： </p><br><pre> <code class="python hljs">export (int) var speed var velocity = Vector2() var window_size = Vector2(<span class="hljs-number"><span class="hljs-number">800</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span>)</code> </pre> <br><p> 使用<code>export</code>关键字允许您在“ <code>Inspector</code>面板窗口中设置<code>speed</code>变量的值。 如果我们要获取方便在“ <code>Inspector</code>窗口中编辑的自定义值，这是一种非常有用的方法。 将<code>Speed</code>设置为<code>350</code> 。  <code>velocity</code>值将确定运动方向，而<code>window_size</code>是限制玩家运动的区域。 </p><br><p> 我们的操作的进一步顺序如下：我们使用<code>get_input()</code>函数检查是否正在进行键盘输入。 然后，我们将根据按下的键移动对象，然后播放动画。 玩家将向四个方向移动。 默认情况下，Godot引擎具有分配给箭头键的事件（“ <code>Project -&gt; Project Settings -&gt; Input Map</code> ），因此我们可以将其应用于我们的项目。 若要确定是否已按下某个键，应使用<code>Input.is_action_pressed()</code>并滑动要跟踪的事件的名称。 </p><br><pre> <code class="python hljs">func get_input(): velocity = Vector2() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Input.is_action_pressed(<span class="hljs-string"><span class="hljs-string">"ui_left"</span></span>): velocity.x -= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Input.is_action_pressed(<span class="hljs-string"><span class="hljs-string">"ui_right"</span></span>): velocity.x += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Input.is_action_pressed(<span class="hljs-string"><span class="hljs-string">"ui_up"</span></span>): velocity.y -= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Input.is_action_pressed(<span class="hljs-string"><span class="hljs-string">"ui_down"</span></span>): velocity.y += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> velocity.length() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: velocity = velocity.normalized() * speed</code> </pre> <br><p> 乍一看，一切看起来都不错，但有一点细微差别。 按下的几个键的组合（例如，向下和向左）将导致添加矢量，在这种情况下，玩家的移动速度比简单地向下移动的速度快。 为了避免这种情况，我们将使用<code>normalized()</code>方法-将向量的长度返回<code>1</code> 。 </p><br><p> 因此，跟踪了击键事件，现在您需要移动<code>Player</code>对象。  <code>_process()</code>函数将为我们提供帮助，每次发生框架更改时都会调用<code>_process()</code>函数，因此建议将其用于那些经常更改的对象。 </p><br><pre> <code class="python hljs">func _process(delta): get_input() position += velocity * delta position.x = clamp(position.x, <span class="hljs-number"><span class="hljs-number">0</span></span>, window_size.x) position.y = clamp(position.y, <span class="hljs-number"><span class="hljs-number">0</span></span>, window_size.y)</code> </pre> <br><p> 希望您注意到<code>delta</code>参数，该参数又乘以速度。 有必要解释它是什么。 游戏引擎最初配置为以每秒60帧的速度运行。 但是，在某些情况下，计算机或Godot引擎本身会变慢。 如果帧速率不一致（更改帧所需的时间），这将影响游戏对象运动的“平滑度”（结果，运动是“生涩的”）。  “ Godot引擎”通过引入<code>delta</code>变量解决了这个问题（就像大多数类似的引擎一样）-它提供了要更改帧的值。 由于这些值，您可以“对齐”运动。 注意另一项非凡的功能- <code>clamp</code> （在两个指定的参数内返回值），由于它我们可以通过简单地设置区域的最小值和最大值来限制<code>Player</code>可以移动的区域。 </p><br><p> 不要忘记为我们的对象设置动画。 请注意，当对象向右移动时，您需要翻转<code>AnimatedSprite</code> （使用<code>flip_h</code> ），我们的英雄将在移动时直接朝他移动的方向看。 确保在<code>AnimatedSprite</code>中启用了“ <code>Playing</code>参数，以便动画开始播放。 </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> velocity.length() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: $AnimatedSprite.animation = <span class="hljs-string"><span class="hljs-string">"walk"</span></span> $AnimatedSprite.flip_h = velocity.x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: $AnimatedSprite.animation = <span class="hljs-string"><span class="hljs-string">"idle"</span></span></code> </pre> <br><h4 id="rozhdenie-i-smert"> 生与死 </h4><br><p> 启动游戏时，必须将主要场景告知其主要场景以准备开始新游戏，在我们的情况下，您应告知<code>Player</code>对象游戏的开始并为其设置初始参数：外观位置，默认动画，运行<code>set_process</code> 。 </p><br><pre> <code class="python hljs">func start(pos): set_process(true) <span class="hljs-comment"><span class="hljs-comment">#     Vector2(x, y) position = pos $AnimatedSprite.animation = "idle"</span></span></code> </pre> <br><p> 当时间用完或玩家遇到障碍物时，我们还会提供玩家的死亡事件，并且设置<code>set_process (false)</code>将导致对该场景不再执行<code>_process ()</code>函数。 </p><br><pre> <code class="python hljs">func die(): $AnimatedSprite.animation = <span class="hljs-string"><span class="hljs-string">"die"</span></span> set_process(false)</code> </pre> <br><h4 id="dobavlenie-kolliziy"> 添加碰撞 </h4><br><p> 轮到此，使玩家能够检测到与硬币和障碍物的碰撞。 使用信号最容易实现。 信号是一种发送消息的好方法，以便其他节点可以检测到它们并做出响应。 大多数节点已经具有内置信号，但是可以为自己的目的定义“用户”信号。 如果在脚本开头声明了信号，则会添加信号： </p><br><pre> <code class="python hljs">signal pickup signal die</code> </pre> <br><p> 在“ <code>Inspector</code>窗口（“ <code>Node</code>选项卡）中浏览信号列表，并注意我们的信号以及已经存在的信号。 现在我们对<code>area_entered ()</code>感兴趣，它假定将发生碰撞的对象也属于<code>Area2D</code>类型。 我们使用“ <code>Connect</code>按钮连接<code>area_entered ()</code>信号，然后在“ <code>Connect Signal</code>窗口中选择突出显示的节点（Player），其余部分默认保留。 </p><br><pre> <code class="python hljs">func _on_Player_area_entered( area ): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> area.is_in_group(<span class="hljs-string"><span class="hljs-string">"coins"</span></span>): <span class="hljs-comment"><span class="hljs-comment">#  emit_signal("pickup") area.pickup()</span></span></code> </pre> <br><p> 为了便于检测和交互对象，需要在适当的组中对其进行标识。 现在省略了组本身的创建，但是我们一定会在以后再次讨论。  <code>pickup()</code>函数确定硬币的行为（例如，它可以播放动画或声音，删除对象等）。 </p><br><h4 id="scena-monetka"> 硬币场景 </h4><br><p> 用一个硬币创建一个场景时，除了在<code>AnimatedSprite</code>只有一个动画（突出显示）外，您需要完成与“ Player”场景相同的操作。  <code>Speed (FPS)</code>可以提高到<code>14</code> 。 我们还将更改<code>AnimatedSprite</code>的比例<code>AnimatedSprite</code> 。 并且<code>CollisionShape2D</code>的尺寸应与硬币的图像相对应，主要是不缩放硬币，即在2D编辑器中使用表格上的适当标记更改大小。 <br> 调整圆的半径。 </p><br><p><img src="https://habrastorage.org/webt/63/uc/jq/63ucjq07ny8i7pjjyakue47ojdg.png"></p><br><p> 组是节点的一种标记，可让您标识相似的节点。 为了使<code>Player</code>对象对接触硬币做出反应，这些硬币必须属于该组，我们称其为<code>coins</code> 。 选择<code>Area2D</code>节点（名称为“ Coin”），然后在“ <code>Node -&gt; Groups</code>选项卡中为其分配标签，以创建相应的组。 </p><br><p><img src="https://habrastorage.org/webt/a5/3q/sk/a53qskzr8be5yfagoubkbe2vbrs.png"></p><br><p> 对于“ <code>Coin</code>节点，创建一个脚本。  <code>pickup()</code>函数将由<code>Player</code>对象的脚本调用，并将告诉硬币工作时该怎么做。  <code>queue_free()</code>方法将安全地从树中删除一个具有其所有子节点的节点，并清除内存，但是删除不会立即生效，它将首先移动到要在当前帧末尾删除的队列。 这比立即删除节点要安全得多，因为游戏中的其他“参与者”（节点或场景）可能仍需要该节点存在。 </p><br><pre> <code class="python hljs">func pickup (): queue_free ()</code> </pre> <br><h4 id="zaklyuchenie"> 结论 </h4><br><p> 现在我们可以创建<code>Main</code>场景， <code>Coin</code>鼠标将两个场景（ <code>Player</code>和<code>Coin</code>拖到2D编辑器中，并通过启动场景（F5）来检查玩家的移动以及他与硬币的接触。 好吧，我急于说“ Like Coins”游戏创建的第一部分已经完成，请允许我离开，并感谢大家的关注。 如果您有话要说，请补充材料或在文章中看到错误，请务必通过在下面写评论来报告。 不要害怕变得坚强和批判。 您的“反馈”将告诉您我是否朝着正确的方向前进，以及可以进行哪些修复以使材料更加有趣和有用。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN429234/">https://habr.com/ru/post/zh-CN429234/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN429224/index.html">黑暗的网络表单模式或转换率最高的表单</a></li>
<li><a href="../zh-CN429226/index.html">动态定价，或Yandex.Taxi如何预测高需求</a></li>
<li><a href="../zh-CN429228/index.html">PMP 通过考试。 考虑什么以及为什么需要它</a></li>
<li><a href="../zh-CN429230/index.html">报告：爱普生投影机在2018俄罗斯综合系统展上</a></li>
<li><a href="../zh-CN429232/index.html">职业类固醇。 狗狗</a></li>
<li><a href="../zh-CN429236/index.html">您需要打开灯泡的数据科学家数量（或哪个团队可以使数据为企业服务）</a></li>
<li><a href="../zh-CN429238/index.html">再次关于层级</a></li>
<li><a href="../zh-CN429240/index.html">我如何尝试修复驾驶员的地图搜索</a></li>
<li><a href="../zh-CN429242/index.html">“不要害羞。 试试吧！” Unity Alexandre Mutel对生命，编译器和编译器中生命的访谈</a></li>
<li><a href="../zh-CN429244/index.html">贪婪的侏儒：当我在《天堂2》中撰写市场分析报告时</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>