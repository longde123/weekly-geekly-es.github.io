<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äç‚öñÔ∏è üßöüèæ üë©üèº‚Äçü§ù‚Äçüë®üèæ Monitoreo ambiental en la sala del servidor (Bolid + Zabbix) üëéüèæ üíë üë®‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probablemente, la forma m√°s f√°cil para que un profesional de TI resuelva el problema de monitoreo ambiental en la sala de servidores es usar controlad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monitoreo ambiental en la sala del servidor (Bolid + Zabbix)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438788/">  Probablemente, la forma m√°s f√°cil para que un profesional de TI resuelva el problema de monitoreo ambiental en la sala de servidores es usar controladores especializados con salida SNMP (por ejemplo, NetBotz o NetPing).  Pero para aquellos que no tienen miedo a las dificultades y desean obtener una soluci√≥n econ√≥mica a nivel industrial (con producci√≥n en serie de equipos), existe una opci√≥n interesante con el protocolo Modbus. <br><br><img src="https://habrastorage.org/webt/wu/uc/mi/wuucmi1fiyi7sglvrsekrvey0pk.png"><br><a name="habracut"></a><br>  A continuaci√≥n, describir√© un sistema de monitoreo basado en componentes de fabricaci√≥n rusa: NVP Bolid, y "fusionaremos" los datos en Zabbix 4.0.  NVP "Bolid" es ampliamente conocido en los c√≠rculos de equipos de automatizaci√≥n contra incendios y la soluci√≥n considerada llevar√° esta "impronta".  Sus dispositivos, por decirlo suavemente, no difieren en el dise√±o y la consideraci√≥n de los casos, pero ... el precio compensa con creces todas estas deficiencias.  Vale la pena se√±alar una muy buena documentaci√≥n y un soporte t√©cnico gratuito m√°s o menos normal. <br><br><h2>  Protocolos e interfaces </h2><br>  Antes de pasar al hardware, veremos brevemente los protocolos e interfaces utilizados: <br><br>  <b>Modbus</b> : un protocolo industrial basado en el principio de "Maestro" - "Esclavo".  Solo puede haber un maestro en una red Modbus que sondee a los esclavos y "diga" qu√© hacer.  Como medio de transmisi√≥n, puede usar la interfaz RS-485 (Modbus RTU) o Ethernet (Modbus TCP).  Te√≥ricamente, el n√∫mero m√°ximo de dispositivos es 247. <br><br>  <b>Orion</b> : protocolo propietario de la empresa NVP "Bolid", construido sobre el principio de "Master" (Master) - "Slave" (Slave).  Aparentemente, la interfaz RS-485 modificada se utiliza como medio de transmisi√≥n de datos, por lo que la longitud m√°xima de la l√≠nea puede alcanzar los 3 km (!).  El n√∫mero m√°ximo de dispositivos es 127. <br><br>  <b>DLS</b> (l√≠nea de comunicaci√≥n de dos hilos): protocolo patentado de la empresa NVP "Bolid", basado en el principio de "Maestro" - "Esclavo" (Maestro).  Utiliza un cable de par de cobre como medio de transmisi√≥n de datos (se recomienda un cable de par trenzado).  El n√∫mero m√°ximo de dispositivos es 127 + 1.  Topolog√≠a: un bus (o anillo) con ramificaciones, la longitud m√°xima de la l√≠nea puede alcanzar 1,5 km (seg√∫n el tipo de cable, la secci√≥n transversal de los conductores de cable y la cantidad de dispositivos conectados). <br><br>  <b>RS-485</b> : interfaz de capa f√≠sica, utiliza "par trenzado" (un par de "2 hilos" o dos "4 hilos" para la transmisi√≥n de datos, el segundo es menos com√∫n).  La longitud m√°xima de l√≠nea declarada es de 1,2 km.  La topolog√≠a es un autob√∫s. <br><br>  Como puede ver, se utilizan l√≠neas de comunicaci√≥n bastante "de largo alcance".  En todos los protocolos, el direccionamiento del dispositivo se establece mediante "manejadores" (preconfiguraci√≥n). <br><br><h2>  Sensores </h2><br>  El sistema implica la conexi√≥n de sensores de direcci√≥n "especiales" (patentados) (para decirlo m√°s estrictamente "detectores", es decir, dispositivos con un sensor incorporado), pero tambi√©n puede conectar no direcciones "ordinarias" utilizando expansores de direcciones (de 1 a 8 entradas).  El uso de detectores direccionables ofrece dos ventajas: casi todos los dispositivos direccionables reciben energ√≠a a trav√©s de la l√≠nea de se√±al (es decir, no es necesario suministrar una l√≠nea de alimentaci√≥n de 12V separada) y no es necesario colocar el expansor de direcciones en ning√∫n lado.  Los sensores est√°n conectados al <abbr title="l√≠nea de comunicaci√≥n de dos hilos">DPS</abbr> . <br>  La gama de equipos "terminales" es bastante amplia, pero dar√© la que se puede necesitar para resolver nuestro problema: <br><br><ul><li>  S2000-VT: sensor combinado de temperatura y humedad para uso en interiores (IP41).  Tiene un certificado de instrumento de medici√≥n, el error es de solo 0.5 ¬∞ C y el precio de venta recomendado de solo 1200 rublos. </li><li>  S2000-SMK (y sus variaciones) - sensor de "puerta abierta" (detector de contacto magn√©tico, interruptor de l√°minas).  Precio de venta recomendado: 300 rublos. </li><li>  S2000-DZ - sensor de punto de inundaci√≥n (hecho en conjunto con Realty, por lo que el caso es "sin formato").  Precio de venta recomendado: 800 rublos. </li><li>  2000-1, 2000-2, 2000-8: los expansores de direcciones para 1, 2 y 8 conexiones se pueden usar como "receptores" de se√±ales de tipo "contacto seco" (activar / desactivar) desde otro equipo (por ejemplo, desde un dispositivo de extinci√≥n de incendios o bombas de aire acondicionado); </li><li>  S2000-SP2 - bloque de rel√© (para 2 salidas), con el que puede controlar dispositivos (por ejemplo, una l√°mpara de alarma - un indicador luminoso).  Precio de venta recomendado: 1200 rublos. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Apariencia de sensores</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/wy/ff/2k/wyff2kk8bfwz0bcq5feyh-kvja4.png"><br><br></div></div><br>  Para obtener una lista completa de equipos, consulte el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio web oficial del fabricante</a> . <br><br><h2>  Controlador </h2><br>  La "l√≠nea" de controladores, si puedo decirlo, consta de tres modelos: <br><br><ul><li>  S2000-KDL - modelo b√°sico (la designaci√≥n significa "Sistema 2000 - Controlador de una l√≠nea de comunicaci√≥n de dos hilos"); </li><li>  S2000-KDL-2I: aislamiento galv√°nico agregado para RS-485 y DPS; </li><li>  S2000-KDL-Modbus: se ha agregado un convertidor de protocolo Modbus S2000-PP al dise√±o S2000-KDL-2I. </li></ul><br><div class="spoiler">  <b class="spoiler_title">La apariencia de los controladores.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gw/wu/nb/gwwunbbgi8jsdrp4lirdesxxoyi.png"><br></div></div><br>  Es m√°s √≥ptimo usar S2000-KDL-Modbus, pero tambi√©n es posible usar S2000-KDL / C2000-KDL-2I con el convertidor de protocolo S2000-PP instalado cerca, que tiene un dise√±o de carcasa montado en panel. <br><br>  El controlador desempe√±a el papel de "L√≠der" en la l√≠nea <abbr title="l√≠nea de comunicaci√≥n de dos hilos">DLS</abbr> (solo se puede conectar una l√≠nea DPS a un controlador), y en la l√≠nea RS-485 Orion ya act√∫a como "Esclavo" y no ser√° posible recopilar datos de √©l "directamente".  Para recopilar datos en la l√≠nea RS-485 Orion, se utiliza la llamada consola 2000 o 2000- (incluida la versi√≥n incorporada), que ya tiene interfaces de transferencia de datos estandarizadas. <br><br>  Los siguientes controladores tambi√©n pueden distinguir las siguientes caracter√≠sticas: <br><br><ul><li>  se refieren a un tipo configurable, no programable (es decir, solo necesita configurar los par√°metros y no desarrollar un programa); </li><li>  soporte en <abbr title="l√≠nea de comunicaci√≥n de dos hilos">DPS de</abbr> hasta 127 dispositivos direccionables (S2000-VT tiene dos direcciones), y muchos comisionados no recomiendan usar m√°s de 100-110; </li><li>  doble entrada para fuente de alimentaci√≥n DC 12-24V; </li><li>  dise√±o de carcasa no muy conveniente (todos los cables conectados no se pueden ocultar en la carcasa del dispositivo y debe quitarlos de la parte posterior del dispositivo). </li></ul><br>  Para la tolerancia a fallas del sistema, puede usar las siguientes medidas (que son opcionales): <br><br><ul><li>  anillo de bucle: una interrupci√≥n de bucle en un lugar no afecta la presencia de se√±ales de sensores direccionables; </li><li>  El uso de bloques aislantes de rama (BRIZ): le permite hacer ramas radiales, as√≠ como aislar el segmento de bucle, en el que hubo un cortocircuito "DPS +" y "DPS-". </li></ul><br>  IMPORTANTE: el nuevo firmware llega constantemente a los controladores que eliminan errores y agregan funcionalidad, y el firmware C2000-KDL y C2000-KDL-2I son incompatibles. <br><br><h2>  Conexi√≥n Modbus </h2><br>  Como se describi√≥ anteriormente, se puede usar un controlador C2000-Modbus o un convertidor C2000-PP.  Ambos esquemas prev√©n la emisi√≥n de se√±ales utilizando el protocolo Modbus RTU de 2 hilos utilizando RS-485 como dispositivo esclavo (nuestro host es Zabbix o alg√∫n sistema SCADA).  Se pueden usar dos m√©todos para conectarse al servidor: <br><br><ul><li>  Preferido: convertidor Modbus RTU / Modbus TCP con conexi√≥n a la misma red local donde se encuentra nuestro servidor con software; </li><li>  Barato: convertidor RS-485 / USB con conexi√≥n directa al servidor.  Noto que hay muchas quejas sobre la confiabilidad de estas memorias USB (puede tomar casi cualquiera, ped√≠ a China por 100 rublos, us√© un mont√≥n de convertidor RS-232 / RS-485 y un adaptador USB / RS-232 y ¬°todo continu√≥ funcionando!). </li></ul><br>  Son posibles dos esquemas para transmitir eventos al protocolo Modbus: <br><br><ul><li>  directamente desde 2000- / C2000--Modbus, cuando estos dispositivos funcionan en el modo "Orion-Master" (seleccionado por un puente en el tablero) y act√∫an como el interrogador del sistema "Orion"; </li><li>  utilizando el control remoto S2000M cuando recopila informaci√≥n de los controladores y solo luego la transfiere a Modbus a trav√©s de S2000-PP / C2000-KDL-Modbus (modo Orion-Slave).  Este esquema es bueno porque el control remoto puede usarse como un "terminal local" (ver eventos en la pantalla LCD incorporada), y tambi√©n continuar registrando eventos en caso de una falla del servidor con el software de monitoreo.  Menos: la configuraci√≥n es un poco m√°s complicada y el control remoto tiene una apariencia muy espec√≠fica. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Ejemplos de circuitos del sistema</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/u6/se/lr/u6selr6hievry0qlrqy77naclpm.png"><br><br><img src="https://habrastorage.org/webt/lr/mr/ny/lrmrnydyc3k7okcrwtfinacdvj8.png"><br><br><img src="https://habrastorage.org/webt/fz/hb/gf/fzhbgfqp5l5crnlkazfbvabmemg.png"><br></div></div><br><h2>  Potencia e instalaci√≥n </h2><br>  Para la fuente de alimentaci√≥n, se requiere una fuente de alimentaci√≥n de 12 V CC, preferiblemente estabilizada y montada en un riel DIN.  Su potencia (generalmente indicada en mA o A) puede seleccionarse aproximadamente del c√°lculo de 1 controlador - 500 mA.  Recomendar√≠a usar una fuente de alimentaci√≥n redundante (con bater√≠a incorporada, RIP) solo si se usa el control remoto S2000M.  Y aseg√∫rese de conectar la fuente de alimentaci√≥n a la misma fuente de alimentaci√≥n ininterrumpida (UPS) que el servidor del sistema de monitoreo. <br><br>  Por supuesto, puede montar todo esto en la pared, pero dejarlo para los instaladores de alarmas contra incendios y de seguridad, y utilizaremos un riel DIN de 3U para la instalaci√≥n en un gabinete de 19 "(por ejemplo, el PSM-3U o Cabeus CMO con el mismo art√≠culo, tendr√° que tirar el panel frontal) En el caso de usar el control remoto S2000-M, puede usar un enchufe de 19 "4U (preferiblemente perforado), que actuar√° como un panel de montaje y al cual un riel DIN para los terminales y el controlador ya est√° fijo.  Menos la decisi√≥n: el equipo representa el montaje del avi√≥n de 19 ". <br><br>  Para ensamblar y montar un sistema de componentes no deber√≠a causar preguntas, pero llamo la atenci√≥n sobre lo siguiente: <br><br><ul><li>  La mayor√≠a de los sensores tienen una peque√±a pieza de cable que sobresale.  Para aumentar el cable, puede usar soldadura con termocontra√≠ble, o una caja oscilante de dos pares KS-2 (compacta, pero la mano de obra es "poco convincente"), o la conexi√≥n RJ11 (RJ45); </li><li>  Antes de montar en los sensores, sus direcciones deben registrarse (como se describe a continuaci√≥n) y marcarse; </li><li>  al conectar sensores, es necesario observar la polaridad de "DLS +" y "DLS-" (consulte la documentaci√≥n, de qu√© color tiene DLS +, generalmente de color), si lo mezcla, el sensor no se detectar√° en el sistema. </li></ul><br>  Para aquellos que no quieren soldar, pero les gusta exprimir los "chips", puede usar la opci√≥n que se describe a continuaci√≥n (probablemente, todav√≠a es mejor que RJ11, para no conectar accidentalmente la l√≠nea DPS al servidor). <br><br>  Ser√° requerido: <br><br><ul><li>  cable de par trenzado 2 pares, sin blindaje; </li><li>  "Bolsa" de conectores RJ11 (6P4C o 6P6C); </li><li>  Divisores RJ11 con entradas tipo z√≥calo (hay una gran variedad de opciones a precios muy razonables). </li></ul><br>  En un par comenzamos DPS, en el otro, por ejemplo, 12V DC.  Conexi√≥n de sensores a trav√©s de divisores. <br><br><div class="spoiler">  <b class="spoiler_title">Cuadro explicativo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xf/v-/93/xfv-93ihmj39n_uhdyhhlqidgjg.png"><br></div></div><br><h2>  Soporte de montaje </h2><br>  Para la parte "pr√°ctica", se mont√≥ un stand compuesto por: <br><br><ul><li>  convertidor de protocolo C2000-PP fabricado por NVP Bolid; </li><li>  controlador S2000-KDL producido por NVP "Bolid"; </li><li>  termohigr√≥metro (sensor combinado de temperatura y humedad) C2000-VT fabricado por NVP Bolid; </li><li>  detector de contacto magn√©tico S2000-SMK fabricado por NVP "Bolid"; </li><li>  sensor de fuga de puntos S2000-DZ fabricado por Rielta; </li><li>  extensor de direcci√≥n S2000-AP1 isp.  02 producci√≥n de NVP "Bolid"; </li><li>  detector volum√©trico Photon-10M fabricado por "Rielta" (tal "colmado"); </li><li>  Unidad de fuente de alimentaci√≥n 12V-AT / 12 / 1.5 DIN fabricada por AccordTec; </li><li>  Adaptador RS-485 / USB comprado en <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aliexpress</a> (en el chip CH340G com√∫n, Linux lo define como "adaptador serie USB HL-340 de QinHeng Electronics").  Se volvi√≥ interesante c√≥mo funcionar√° el sistema en la configuraci√≥n m√°s barata; </li><li>  Cliente ligero TONK 1811 del grupo de empresas TONK (fue comprado en avito por 500 rublos) en un procesador Intel Atom N270 con gr√°ficos integrados GMA950. </li></ul><br><img src="https://habrastorage.org/webt/6b/kr/ed/6bkred606ln2axp3wlcrztumlly.png"><br><br><div class="spoiler">  <b class="spoiler_title">Refinando el Thin Client y la apariencia del stand</b> <div class="spoiler_text">  El Thin Client estaba un poco "terminado": <br><br><ul><li>  Un m√≥dulo DOM de 2GB con Windows XP incorporado instalado ha sido reemplazado por discos duros 2.5 ATA de 60GB de una computadora port√°til vieja (tuve que comprar un cable, por alguna raz√≥n, el SATA-HDD no se recogi√≥; inclu√≠a el puerto SATA en el BIOS); </li><li>  aument√≥ la RAM DDR2 SO-DIMM de 1GB a 2GB; </li><li>  Linux Mint 19.1 ‚ÄúTessa‚Äù Xfce Edition instalado y escritorio remoto configurado con TightVNC; </li><li>  El sistema de enfriamiento fue "refinado": redujo el disipador de calor para que el HDD quedara casi "al ras" con la carcasa, quit√≥ la cubierta superior y en la parte superior "agreg√≥" un ventilador de 120 mm conectado a trav√©s de una resistencia.  Inmediatamente todos los "frenos" desaparecieron, se volvi√≥ bastante razonable trabajar. </li></ul><br><br><img src="https://habrastorage.org/webt/ct/ri/5v/ctri5vgqehkummqppp22cd3k2uw.jpeg"><br></div></div><br><h2>  Configurar equipo Bolid </h2><br>  Todos los ajustes se realizan en el entorno de Windows, por lo que antes de comenzar a trabajar, debe instalar el controlador en el adaptador RS-485 / USB, as√≠ como dos programas "super" del NVP "Bolid", que se entregan de forma gratuita: <strong>Orion-prog</strong> y <strong>Uprog</strong> .  Adem√°s, los dispositivos se conectan por separado al adaptador RS-485 / USB a los puertos Orion AB RS-485 (se usa dise√±o directo, y no como en los puertos COM). <br><br>  IMPORTANTE: con todos los pasos posteriores en el S2000-PP, se debe quitar el puente XP1 de la placa. <br><br>  Paso 1. Inserte el adaptador RS-485 / USB en el conector USB y busque en el administrador de dispositivos qu√© n√∫mero de puerto COM est√° asignado al adaptador.  Los controladores para el adaptador deben instalarse sin signos de exclamaci√≥n en el "Administrador de dispositivos". <br><br>  Paso 2. En nombre del administrador, ejecute Orion-prog, seleccione el puerto COM deseado y realice una b√∫squeda y vea la versi√≥n de firmware del dispositivo.  Vaya al sitio web oficial del fabricante y verifique si hay firmware m√°s reciente y, si es necesario (lo m√°s probable, ser√° necesario), realice una actualizaci√≥n (en el momento de la redacci√≥n: 1.32 para C2000-PP, 2.22 para C2000-KDL). <br><br><div class="spoiler">  <b class="spoiler_title">Firmware del instrumento en im√°genes</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/6i/lm/py/6ilmpyshwlwgygxsep6myrt-yzm.gif"><br></div></div><br>  * Firmware 1.32, de hecho, estaba instalado "torcidamente" - en Uprog, la configuraci√≥n no fue le√≠da desde el dispositivo.  Por lo tanto, "retrocedi√≥" a 1.31. <br><br>  Paso 3. Configuraci√≥n de la direcci√≥n para dispositivos (primero con S2000-PP, por ejemplo, 2 y luego con S2000-KDL - 3).  Para hacer esto, ejecute Uprog: todos los dispositivos tienen una direcci√≥n predeterminada de 127, por lo que debe configurar los dispositivos al principio uno a la vez.  Para un video m√°s detallado del fabricante, vea <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">YouTube</a> . <br><br>  Paso 4. Despu√©s de configurar la direcci√≥n en S2000-KDL, es necesario configurar las direcciones de los sensores en la l√≠nea de comunicaci√≥n de dos hilos (DLS).  Tambi√©n tienen la direcci√≥n predeterminada 127 (y el c√≠rculo con el sensor en Uprog no est√° resaltado).  Leemos la configuraci√≥n del dispositivo (Ctrl + F3) y conectamos secuencialmente los sensores a las salidas del DLS, configurando las direcciones.  Al apuntar al sensor en el men√∫ contextual ‚ÄúSolicitud de tipo AU‚Äù, puede especificar el tipo de sensor o ‚ÄúSolicitud de ADC AU‚Äù: averig√ºe si el sensor funciona (por ejemplo, para un detector de contacto magn√©tico del ADC al cerrar: 100 y al abrir: 50).  De hecho, tengo la siguiente configuraci√≥n de direcci√≥n: 1 - Interruptor de l√°minas C2000-SMK, 2 - Temperatura C2000-VT, 3 - Humedad C2000-VT, 4 - Fuga C2000-DZ, 5 - ISP expansor de direcciones C2000-AP1.  02 (con el detector volum√©trico Photon-10M conectado a √©l). <br><br><div class="spoiler">  <b class="spoiler_title">Direccionamiento de sensores en im√°genes</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j9/vo/dk/j9vodkzjmmydzvrsk377m3zinok.gif"><br></div></div><br>  A continuaci√≥n, vaya a la pesta√±a "Entradas" y haga lo siguiente: <br><br><ul><li>  indique los tipos de sensores: para temperatura - 10, para medir humedad - 15, para todos los dem√°s - 6 (tecnol√≥gico); </li><li>  para las entradas tecnol√≥gicas establecemos "Tiempo de recuperaci√≥n, s": este es el tiempo despu√©s del cual el bucle volver√° al estado "Normal" despu√©s de recibir el estado "Infracci√≥n".  Es necesario indicar el n√∫mero de al menos el intervalo de sondeo en Zabbix (tard√© 10 segundos); </li><li>  apague "Control de la indicaci√≥n AU" (0), "Supervisi√≥n de circuito abierto y cortocircuito" y "Supervisi√≥n del estado de la bater√≠a de respaldo" para simplificar la configuraci√≥n. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Configuraci√≥n de entradas para S2000-KDL en im√°genes</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/90/cn/68/90cn68wqswa16_nt7pqxzy830de.gif"><br></div></div><br>  Despu√©s de todas las "manipulaciones" con S2000-KDL, llevamos a cabo el "Registro de configuraci√≥n en el dispositivo". <br><br>  Paso 5. Configurar S2000-PP. <br>  En la pesta√±a "Dispositivo", la configuraci√≥n se muestra en la imagen (estos son los m√°s "en ejecuci√≥n" y se aplican de forma predeterminada para la mayor√≠a de los dispositivos).  El puerto COM del adaptador RS-485 / USB y cualquier otro dispositivo conectado a la red Modbus debe tener una configuraci√≥n similar.  Seleccion√© la direcci√≥n 11 para el dispositivo S2000-PP en la red Modbus (¬°la direcci√≥n en el sistema Orion es 2!). <br><br><img src="https://habrastorage.org/webt/ej/6y/31/ej6y31hxzfnze6nzx29rjcnsfwk.png"><br><br>  Luego vamos a la pesta√±a "Dispositivos" y comenzamos a completar la "Tabla de zonas": <br><br><ul><li>  la primera columna indiqu√© "3": esta es la direcci√≥n del dispositivo S2000-KDL en el sistema Orion; </li><li>  n√∫mero de bucle de alarma ("bucle de alarma"): estas son las direcciones de los sensores (en realidad, el bucle de alarma = direcci√≥n, podemos omitir varias direcciones si no queremos obtener informaci√≥n de ellas); </li><li>  Secci√≥n Modbus No. - puede agrupar nuestros sensores en grupos.  Para simplificar, no hice esto y atribu√≠ a todos 1 secci√≥n; </li><li>  El tipo de zona es un par√°metro muy importante.  Lo seleccionamos seg√∫n el tipo de sensor. </li></ul><br><img src="https://habrastorage.org/webt/8g/bo/ea/8gboea_ibzpk6nr04myidkbgtru.png"><br><br>  Despu√©s de configurar S2000-PP, llevamos a cabo el "Registro de configuraci√≥n en el instrumento". <br><br>  Paso 6. Combine C2000-PP y C2000-KDL en una red a trav√©s de RS-485 Orion, conecte los sensores a C2000-KDL (puede usar un mont√≥n de dos terminales) y conecte el adaptador RS-485 / USB a la salida Modbus C2000-PP.  Configuramos el puente XP1 en la posici√≥n cerrada (importante: despu√©s de instalar el puente, debe reiniciar el dispositivo restableciendo el voltaje de suministro).  Todo: el sistema est√° "listo para la batalla". <br><br>  Verificamos "operabilidad" en el programa de consola gratuito <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Modpoll Modbus Master Simulator</a> (en adelante denominado "Modpoll"), por ejemplo, en la direcci√≥n de firmware "S2000-PP" o enviando informaci√≥n de S2000-KDL a "40000" - este es el primer sensor: <br><br><img src="https://habrastorage.org/webt/ij/hv/go/ijhvgoynxeyxwua5abdcgvapi3u.png"><br><br>  El firmware "para familiarizaci√≥n" se puede descargar <a href="">aqu√≠</a> . <br><br><h2>  Configuraci√≥n de Zabbix </h2><br>  <font color="red">Advertencia: Zabbix se configur√≥ por primera vez, como Linux Mint (ya que no hay Zabbix en Windows) :)</font> <br><br>  Despu√©s de instalar Zabbix, debe instalar los paquetes <i>autoconf</i> , <i>automake</i> , <i>libtool</i> , <i>pkg-config</i> y luego el m√≥dulo de extensi√≥n - <i>libzbxmodbus</i> .  Hay un art√≠culo separado sobre √©l en <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Habr√©</a> (me referir√© constantemente a √©l) y se ha actualizado recientemente, solo por trabajar con Zabbix 4.0.  El art√≠culo tambi√©n tiene informaci√≥n m√°s detallada sobre el protocolo Modbus.  El m√≥dulo en s√≠ y las instrucciones m√°s o menos detalladas se encuentran en <a rel="noreferrer noopener" href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> . <br><br>  Peque√±as diferencias en la instalaci√≥n de la especificada en GitHub: <br><br><pre><code class="plaintext hljs">... ./configure --prefix=/etc/zabbix --enable-zabbix-3.2 ... sudo make install</code> </pre> <br>  Al estudiar el funcionamiento del m√≥dulo <i>libzbxmodbus</i> , qued√≥ claro que no ser√≠a posible aplicar el esquema con el control remoto S2000M, porque en este caso los datos de los termohigr√≥metros se ven as√≠: escriba el n√∫mero de la zona deseada en el registro 46179 y luego recopile los datos del registro 46328, es decir  muy no trivial (en sistemas SCADA "grandes", esto se puede implementar, por ejemplo, en MasterSCADA). <br><br>  En el archivo de configuraci√≥n, <i>etc / zabbix / zabbix_server.conf, escribimos los</i> enlaces de <i>extensi√≥n</i> y conectamos el hardware al servidor con Zabbix.  No tuve que instalar controladores para el adaptador RS-485 / USB, pero a√∫n no entend√≠ c√≥mo averiguar qu√© n√∫mero de USB usar, es bueno que la conexi√≥n a <i>/ dev / ttyUSB0</i> funcion√≥ (puede ver que el dispositivo se encontr√≥ en el sistema usando el comando <i>lsusb</i> ). <br><br>  Al igual que con Windows, verificamos con la utilidad Modpoll (ejecut√© Linux i386) que el hardware est√° conectado y que la informaci√≥n de ellos est√° disponible: <br><br><img src="https://habrastorage.org/webt/wn/8_/zz/wn8_zz98bldyf7hzc5zdkc90v80.png"><br><br>  Dado que el art√≠culo describe el proceso de configuraci√≥n utilizando el ejemplo de Zabbix 2.2: la interfaz es un poco diferente all√≠, proporcionar√© explicaciones e im√°genes de la configuraci√≥n. <br><br><p>  Paso 1. Creamos un nodo de red y un grupo en el que se incluir√°n nuestros nodos (por ejemplo, un nodo - "Monitoreo ambiental" y un grupo - "Infraestructura de ingenier√≠a"): <br>  Configuraci√≥n&gt; Hosts&gt; Crear host&gt; Ingrese nuestros nombres&gt; Agregar <br><br><img src="https://habrastorage.org/webt/vj/cd/fi/vjcdfibmwzvcm7vudrfubf4nuaa.png"><br><br>  Paso 2. Crear los elementos de datos.  El art√≠culo recomienda crear plantillas, pero como nuestro sistema no contiene elementos duplicados, omitir√© este paso.  Por ejemplo, si tuvi√©ramos varios aires acondicionados conectados a trav√©s de Modbus, podr√≠amos usar la funcionalidad del sistema. <br><br>  Configuraci√≥n&gt; Nodos de red&gt; En la l√≠nea que contiene el nombre de nuestro nodo "Monitoreo ambiental", haga clic en "Elementos de datos"&gt; en la ventana que aparece, haga clic en "Crear elemento de datos". <br><br>  Comenzamos a "martillar" nuestros sensores: <br><br><img src="https://habrastorage.org/webt/j_/ei/9n/j_ei9nphfowd7sgjp6r8u3r9xyk.png"><br><br>  Matices menores: <br><br></p><ul><li>  el art√≠culo usa la sintaxis de la funci√≥n <em>"modbus_read_registers"</em> , y de acuerdo con la descripci√≥n de GitHub <em>"modbus_read"</em> : la segunda opci√≥n es m√°s corta y funciona; </li><li>  en lugar de las macros <em>{$ MODBUS_PORT}</em> y <em>{$ MODBUS_SLAVE},</em> puede especificar el puerto en la forma <em>/ dev / ttyUSB0</em> y " <em>11</em> ", pero esto ser√° inconveniente si luego necesita cambiar el puerto USB o la direcci√≥n del S2000-PP; </li><li>  la documentaci√≥n indica que para solicitar el estado de la zona (columna "Modbus zone No.") en S2000-PP, debe contactar: ‚Äã‚Äã"direcci√≥n de registro 40000 + M, donde M = (zona No. ‚Äì1)" - este es el progreso: "zone No. <strong>menos</strong> 1 " </li><li>  no realice una encuesta de tiempo muy frecuente: S2000-PP comienza a devolver un error de "error de excepci√≥n 15": el dispositivo no tiene tiempo para preparar los datos (esto se expresa en el brillo constante del indicador en el dispositivo); </li><li>  para datos de temperatura y humedad con registros 3000 -... se toma </li><li>  en la ventana "Elementos de datos" tambi√©n est√° la pesta√±a "Preprocesamiento" deseada.  Aqu√≠ puede editar lo que se mostrar√° "al final".  La temperatura y la humedad se obtienen de los valores de lectura, que deben dividirse entre 256: "Factor de usuario" - 0.0039 (es decir, 1/256); </li><li>  Para interruptores de l√°minas discretos, sensores de fugas, etc.  tambi√©n debe usar la "Pantalla de valores", esto se debe a la forma en que se proporciona la informaci√≥n. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Configuraci√≥n de conversi√≥n de datos en im√°genes</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/pj/g1/yr/pjg1yrlg-hfu83bgzuch6rke-xg.png"><br><br><img src="https://habrastorage.org/webt/k4/7o/hu/k47ohudcuf9ycomoxbdebii6kvu.png"><br></div></div><br>  Un poco sobre c√≥mo se proporcionan los datos al sondear zonas. <br>  Suponga que recibi√≥ una respuesta en formato decimal 9148 (D).  Lo traduciremos en formato hexadecimal (HEX): obtenga 23BC; de acuerdo con las instrucciones para el dispositivo S2000-PP, estos son dos eventos con los c√≥digos 23 (HEX) / 35 (D) y BC (HEX) / 188 (D).  A continuaci√≥n, consulte la Tabla 5. ‚ÄúLista de eventos (estados AL) del sistema Orion‚Äù.  En √©l encontramos 35 "Restaurando la entrada tecnol√≥gica" y 188 "Restaurando la comunicaci√≥n con la entrada".  No es necesario traducir D-HEX-D, el primer evento es la parte entera de dividir el valor recibido por 256, y el resto es el segundo evento ( <strong>9148</strong> = <strong>35</strong> * 256 + <strong>188</strong> ).  Al entrevistar aportes tecnol√≥gicos, solo recogeremos el primer evento (prioridad), que "deber√≠a" tomar los estados 35 y 36 ("Restaurar el aporte tecnol√≥gico" y "Violaci√≥n del aporte tecnol√≥gico").  Descartaremos la parte fraccional (segundo evento) utilizando la configuraci√≥n del elemento de datos "Tipo de informaci√≥n: num√©rico (entero positivo)". <br><br>  Paso 3. Complete las macros del puerto y los n√∫meros de dispositivo: <br>  Configuraci√≥n&gt; Nodos de red&gt; "Monitoreo ambiental"&gt; seleccione "Macros" <br><br><img src="https://habrastorage.org/webt/h1/r-/qg/h1r-qgd4rrdym-txvbmnhsqwgre.png"><br><br>  Paso 4. Visualizaci√≥n de lecturas en el panel de control: <br>  Pantalla de inicio&gt; Todos los paneles, seleccione "Crear panel"&gt; en la ventana que aparece, establezca "Nombre del panel" y el usuario para el que estar√° disponible este panel&gt; Haga clic en "Crear un nuevo widget"&gt; Escriba "Informaci√≥n general de datos", Intervalo de actualizaci√≥n "10 segundos", Grupos nodos de la red de Infraestructura de ingenier√≠a&gt; Agregar&gt; Ajustar tama√±o del panel y haga clic en "Guardar cambios": <br><br><img src="https://habrastorage.org/webt/wl/ge/la/wlgelajwrwuuta5phssi2b5rx38.gif"><br><br><h2>  Conclusi√≥n </h2><br>  El sistema resultante, mediante el uso de protocolos de "largo alcance", puede ser una soluci√≥n excelente, tanto para monitorear el servidor como para un par de zonas de oficinas cruzadas (en t√©rminos de monitoreo de las condiciones de temperatura y humedad) o incluso un peque√±o centro de datos.  Alguien puede decir "fu fu fu, el auto todav√≠a es asqueroso, necesitas usar XXX (sustituir algo de la automatizaci√≥n industrial)" tambi√©n es una opci√≥n, pero en mi opini√≥n ser√° muy redundante y tambi√©n m√°s costoso .  Y un peque√±o matiz: como puede ver, el sistema en el Bolid es bastante simple (aunque hay una l√≥gica algo extra√±a), pero "termina" la decisi√≥n sobre el baile de graduaci√≥n.  controladores - a veces sigue siendo un "fan√°tico". <br><br>  PD: Este art√≠culo es una adaptaci√≥n de dos art√≠culos en mi blog: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Monitoreo econ√≥mico para la sala de servidores (parte 1 - introducci√≥n)</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Monitoreo econ√≥mico para la sala de servidores (parte 2: pr√°ctica)</a> <br><br>  UPD  Despu√©s de trabajar durante 3 d√≠as, el adaptador RS485-USB se cay√≥.  Se reconoce como inestable, pero adecuado para la puesta en marcha.  Fue reemplazado por un convertidor de un solo puerto MGate MB3170 hecho por MOXA (tomado de lo que estaba disponible): todo se estabiliz√≥. <br>  Debe comprender que este art√≠culo es solo un ejemplo de c√≥mo "hacer amigos" con Zabbix y Bolid.  Para una implementaci√≥n real, puede agregar m√°s estados DPS monitoreados, as√≠ como, por ejemplo, temperaturas negativas (se procesan de manera algo diferente). </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/438788/">https://habr.com/ru/post/438788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../438774/index.html">Todo lo mejor a la vez. Los art√≠culos m√°s v√≠vidos del blog LANIT sobre Habr√© - 2018</a></li>
<li><a href="../438776/index.html">Consejos y trucos de mi canal de Telegram @pythonetc, enero de 2019</a></li>
<li><a href="../438778/index.html">@Pythonetc Enero 2019</a></li>
<li><a href="../438782/index.html">El FSB ha propuesto el lanzamiento de tarjetas SIM rusas y el uso de criptograf√≠a dom√©stica para 5G</a></li>
<li><a href="../438784/index.html">Problemas al usar el servicio Yandex.Metrica</a></li>
<li><a href="../438790/index.html">El intercambio de criptomonedas QuadrigaCX no regalar√° $ 137 millones. Solo el director conoc√≠a la contrase√±a de la tienda, y muri√≥</a></li>
<li><a href="../438792/index.html">Uso de AccelStor All Flash Arrays en proyectos VDI</a></li>
<li><a href="../438794/index.html">Detalles del objeto JavaScript</a></li>
<li><a href="../438796/index.html">Aprendizaje Docker Parte 1: Los fundamentos</a></li>
<li><a href="../438798/index.html">C√≥mo trabajar con datos de inteligencia cibern√©tica: aprendemos a recopilar e identificar indicadores de compromiso del sistema</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>