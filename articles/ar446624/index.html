<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐จ๐ฝโ๐จ ๐ ๐ค ุงูููุงุฑุณ ูู PostgreSQL - 6 (SP-GiST) ๐ ๐๐ฝ ๐๐พ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุฏ ูุงูุดูุง ุจุงููุนู ูุญุฑู ููุฑุณุฉ PostgreSQL ุ ููุงุฌูุฉ ุทุฑู ุงููุตูู ุ ูุซูุงุซ ุทุฑู: ููุฑุณ ุงูุชุฌุฒุฆุฉ ุ ู B-tree ุ ู GiST . ูู ูุฐู ุงูููุงูุฉ ุ ุณูุตู SP-GiST. 

 SP-GIST ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูููุงุฑุณ ูู PostgreSQL - 6 (SP-GiST)</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/446624/" style=";text-align:right;direction:rtl">  ููุฏ ูุงูุดูุง ุจุงููุนู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุญุฑู ููุฑุณุฉ</a> PostgreSQL ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงุฌูุฉ ุทุฑู ุงููุตูู</a> ุ ูุซูุงุซ ุทุฑู: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุฑุณ ุงูุชุฌุฒุฆุฉ</a> ุ ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">B-tree</a> ุ ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GiST</a> .  ูู ูุฐู ุงูููุงูุฉ ุ ุณูุตู SP-GiST. <br><br><h1 style=";text-align:right;direction:rtl">  SP-GIST </h1><br>  ุฃููุงู ุ ุจุถุน ูููุงุช ุญูู ูุฐุง ุงูุงุณู.  ูููุญ ุงูุฌุฒุก "GiST" ุฅูู ุจุนุถ ุงูุชุดุงุจู ูุน ุทุฑููุฉ ุงููุตูู ุงูุชู ุชุญูู ุงูุงุณู ููุณู.  ุงูุชุดุงุจู ููุฌูุฏ: ููุงููุง ุฃุดุฌุงุฑ ุจุญุซ ูุนููุฉ ุชููุฑ ุฅุทุงุฑูุง ูุฅูุดุงุก ุทุฑู ูุตูู ูุฎุชููุฉ. <br><br>  "SP" ุชุนูู ุชูุณูู ุงููุถุงุก.  ุบุงูุจูุง ูุง ูููู ุงููุถุงุก ููุง ูู ูุง ูุณุชุฎุฏูู ูุงุณุชุฏุนุงุก ูุณุงุญุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุทุงุฆุฑุฉ ุซูุงุฆูุฉ ุงูุฃุจุนุงุฏ.  ููููุง ุณูุฑู ุฃู ุฃู ูุณุงุญุฉ ุจุญุซ ุชุนูู ุฃู ูุฌุงู ูููุฉ ุจุงููุนู. <br><br>  SP-GiST ููุงุณุจ ููููุงูู ุญูุซ ูููู ุชูุณูู ุงููุณุงุญุฉ ุจุดูู ูุชูุฑุฑ ุฅูู ููุงุทู <em>ุบูุฑ ูุชูุงุทุนุฉ</em> .  ุชุชููู ูุฐู ุงููุฆุฉ ูู ุงูุฃุฑุจุงุน ูุงูุฃุดุฌุงุฑ ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ (ุฃุดุฌุงุฑ kD) ูุฃุดุฌุงุฑ ุงูุฌุฐุฑ. <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  ูููู </h2><br>  ูุฐูู ุ ุชุชูุซู ููุฑุฉ ุทุฑููุฉ ุงููุตูู ุฅูู SP-GiST ูู ุชูุณูู ูุฌุงู ุงููููุฉ ุฅูู ูุทุงูุงุช ูุฑุนูุฉ <em>ุบูุฑ ูุชุฏุงุฎูุฉ</em> ูููู ุชูุณูู ูู ูููุง ุจุฏูุฑู.  ุชูุณูู ูุซู ูุฐุง ูุฏูุน ุงูุฃุดุฌุงุฑ <em>ุบูุฑ ูุชูุงุฒูุฉ</em> (ุนูู ุนูุณ ุงูุฃุดุฌุงุฑ B ู GiST ุงูุนุงุฏูุฉ). <br><br>  ุชุนูู ููุฒุฉ ุนุฏู ุงูุชูุงุทุน ุนูู ุชุจุณูุท ุนูููุฉ ุตูุน ุงููุฑุงุฑ ุฃุซูุงุก ุงูุฅุฏุฑุงุฌ ูุงูุจุญุซ.  ูู ูุงุญูุฉ ุฃุฎุฑู ุ ูููุงุนุฏุฉ ุนุงูุฉ ุ ูุฅู ุงูุฃุดุฌุงุฑ ุงููุณุชุญุซุฉ ุชููู ูุชูุฑุนุฉ ุจุดูู ููุฎูุถ.  ุนูู ุณุจูู ุงููุซุงู ุ ุนุงุฏุฉู ูุง ุชุญุชูู ุนูุฏุฉ ุงูุนูุฏุฉ ุงูุฑุจุงุนูุฉ ุนูู ุฃุฑุจุนุฉ ุนูููุฏ ูุฑุนูุฉ (ุนูู ุนูุณ ุงูุฃุดุฌุงุฑ B ุ ุญูุซ ุชุจูุบ ุงูุนููุฏ ุงููุฆุงุช) ูุนูููุง ุฃูุจุฑ.  ุงูุฃุดุฌุงุฑ ูุซู ูุฐู ุชุชูุงุณุจ ุจุดูู ุฌูุฏ ูุน ุงูุนูู ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุ ูููู ุงูููุฑุณ ูุฎุฒูู ุนูู ูุฑุต ูุจุงูุชุงูู ุ ูุชูููู ุนุฏุฏ ุนูููุงุช ุงูุฅุฏุฎุงู / ุงูุฅุฎุฑุงุฌ ุ ูุฌุจ ุฃู ูุชู ุชุฌููุน ุงูุนูุฏ ูู ุตูุญุงุช ุ ูููุณ ูู ุงูุณูู ุงูููุงู ุจุฐูู ุจููุงุกุฉ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุฏ ูุฎุชูู ุงูููุช ุงูุฐู ูุณุชุบุฑูู ุงูุจุญุซ ุนู ููู ูุฎุชููุฉ ูู ุงูููุฑุณ ุจุณุจุจ ุงูุงุฎุชูุงูุงุช ูู ุฃุนูุงู ุงููุฑูุน. <br><br>  ุชูุชู ุทุฑููุฉ ุงููุตูู ูุฐู ุ ุดุฃููุง ูู ุฐูู ุดุฃู GiST ุ ุจุงูููุงู ุฐุงุช ุงููุณุชูู ุงูููุฎูุถ (ุงููุตูู ุงููุชุฒุงูู ูุงูุฃููุงู ูุงูุชุณุฌูู ูุฎูุงุฑุฒููุฉ ุงูุจุญุซ ุงูุฎุงูุตุฉ) ูุชููุฑ ูุงุฌูุฉ ูุจุณุทุฉ ูุชุฎุตุตุฉ ูุชูููู ุฅุถุงูุฉ ุฏุนู ูุฃููุงุน ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ููุฎูุงุฑุฒููุงุช ุงูุชูุณูู ุงูุฌุฏูุฏุฉ. <br><br>  ุนูุฏุฉ ุฏุงุฎููุฉ ูู ุดุฌุฑุฉ SP-GiST ุจุชุฎุฒูู ุงูุฅุดุงุฑุงุช ุฅูู ุงูุนูุฏ ุงูุชุงุจุนุฉุ  ูููู ุชุนุฑูู <em>ุงูุชุณููุฉ</em> ููู ูุฑุฌุน.  ุงูู ุฌุงูุจ ุฐูู ุ ูููู ููุนูุฏุฉ ุงูุฏุงุฎููุฉ ุชุฎุฒูู ูููุฉ ุชุณูู <em>ุงูุจุงุฏุฆุฉ</em> .  ูู ุงููุงูุน ูุฐู ุงููููุฉ ููุณุช ุฅูุฒุงููุฉ ุจุงุฏุฆุฉ.  ูููู ุงุนุชุจุงุฑู ูุณูุฏ ุชุนุณูู ูุชู ุงุณุชููุงุฆู ููู ุงูุนูุฏ ุงููุฑุนูุฉ. <br><br>  ุชุญุชูู ุงูุนูุฏ ุงููุฑููุฉ ูู SP-GiST ุนูู ูููุฉ ูู ุงูููุน ุงููููุฑุณ ููุฑุฌุน ุฅูู ุตู ุฌุฏูู (TID).  ูููู ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงููููุฑุณุฉ ููุณูุง (ููุชุงุญ ุงูุจุญุซ) ููููุฉ ุ ูููููุง ููุณุช ุฅูุฒุงููุฉ: ูููู ุชุฎุฒูู ูููุฉ ูุฎุชุตุฑุฉ. <br><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูููู ุชุฌููุน ุงูุนูุฏ ุงููุฑููุฉ ูู ุงูููุงุฆู.  ูุฐูู ุ ูููู ุฃู ุชุดูุฑ ุงูุนูุฏุฉ ุงูุฏุงุฎููุฉ ููุณ ููุท ุฅูู ูููุฉ ูุงุญุฏุฉ ุ ูููู ุฅูู ูุงุฆูุฉ ูุงููุฉ. <br><br>  ูุงุญุธ ุฃู ุงูุจุงุฏุฆุงุช ูุงูุชุณููุงุช ูุงูููู ูู ุงูุนูุฏ ุงููุฑููุฉ ููุง ุฃููุงุน ุจูุงูุงุช ุฎุงุตุฉ ุจูุง ุ ูุณุชููุฉ ุนู ุจุนุถูุง ุงูุจุนุถ. <br><br>  ุจููุณ ุงูุทุฑููุฉ ุงูููุฌูุฏุฉ ูู GiST ุ ูุฅู ุงููุธููุฉ ุงูุฑุฆูุณูุฉ ูุชุญุฏูุฏ ุงูุจุญุซ ูู <em>ูุธููุฉ ุงูุงุชุณุงู</em> .  ุชุณูู ูุฐู ุงููุธููุฉ ุนูุฏุฉ ุดุฌุฑุฉ ูุชููู ุจุฅุฑุฌุงุน ูุฌููุนุฉ ูู ุงูุนูุฏ ุงููุฑุนูุฉ ุงูุชู ุชููู ููููุง "ูุชุณูุฉ" ูุน ุชููุน ุงูุจุญุซ (ูุงููุนุชุงุฏ ุ ูู ุงููููุฐุฌ " <em>ุชุนุจูุฑ ุนุงูู ุงูุญูู ุงููููุฑุณ</em> ").  ุจุงููุณุจุฉ ูุนูุฏุฉ ุงูุฃูุฑุงู ุ ุชุญุฏุฏ ูุธููุฉ ุงูุชูุงุณู ูุง ุฅุฐุง ูุงูุช ุงููููุฉ ุงููููุฑุณุฉ ูู ูุฐู ุงูุนูุฏุฉ ุชุชูุงูู ูุน ุชููุน ุงูุจุญุซ. <br><br>  ูุจุฏุฃ ุงูุจุญุซ ุจุงูุนูุฏุฉ ุงูุฌุฐุฑูุฉ.  ุชุณูุญ ูุธููุฉ ุงูุงุชุณุงู ุจูุนุฑูุฉ ุงูุนูุฏ ุงููุฑุนูุฉ ุงูุชู ูู ุงูููุทูู ุฒูุงุฑุชูุง.  ุชุชูุฑุฑ ุงูุฎูุงุฑุฒููุฉ ููู ูู ุงูุนูุฏ ุงูุชู ุชู ุงูุนุซูุฑ ุนูููุง.  ุงูุจุญุซ ูู ุงูุนูู ุงูุฃูู. <br><br>  ุนูู ุงููุณุชูู ุงููุนูู ุ ูุชู ุชุฌููุน ุนูุฏ ุงูููุฑุณ ูู ุตูุญุงุช ูุฌุนู ุงูุนูู ูุน ุงูุนูุฏ ูุนุงูุฉ ูู ูุฌูุฉ ูุธุฑ ุนูููุงุช ุงูุฅุฏุฎุงู / ุงูุฅุฎุฑุงุฌ.  ูุงุญุธ ุฃู ุงูุตูุญุฉ ุงููุงุญุฏุฉ ูููู ุฃู ุชุญุชูู ุนูู ุนูุฏ ุฏุงุฎูู ุฃู ูุฑูู ุ ูููู ููุณ ููุงููุง. <br><br><h2 style=";text-align:right;direction:rtl">  ูุซุงู: quadtree </h2><br>  ูุชู ุงุณุชุฎุฏุงู quadtree ูููุฑุณุฉ ุงูููุงุท ูู ุงูุทุงุฆุฑุฉ.  ุชุชูุซู ุงูููุฑุฉ ูู ุชูุณูู ุงูููุงุทู ุจุดูู ูุชูุฑุฑ ุฅูู ุฃุฑุจุนุฉ ุฃุฌุฒุงุก (ุงูุฃุฑุจุงุน) ูููุง ูุชุนูู <em>ุจุงูููุทุฉ ุงููุฑูุฒูุฉ</em> .  ูููู ุฃู ูุฎุชูู ุนูู ุงููุฑูุน ูู ูุฐู ุงูุดุฌุฑุฉ ููุนุชูุฏ ุนูู ูุซุงูุฉ ุงูููุงุท ูู ุงูุฃุฑุจุงุน ุงูููุงุณุจุฉ. <br><br>  ูุฐุง ูุง ูุจุฏู ูู ุงูุฃุดูุงู ุ ุนูู ุณุจูู ุงููุซุงู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ</a> ุงููุนุฒุฒุฉ ุจุงููุทุงุฑุงุช ูู ูููุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">openflights.org</a> .  ุจุงูููุงุณุจุฉ ุ ุฃุตุฏุฑูุง ูุคุฎุฑูุง ุฅุตุฏุงุฑูุง ุฌุฏูุฏูุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ุงุณุชุจุฏููุง ููู ุจูู ุฎุทูุท ุงูุทูู ูุงูุนุฑุถ ุจูุฌุงู ูุงุญุฏ ูู ุงูููุน "point" ุจูู ุงูุจููุฉ. <br><br><img src="https://habrastorage.org/web/8ab/6f6/4e7/8ab6f64e7bb5484bbfc798327798ce69.png"><br>  <em>ุฃููุงู ุ ูุณููุง ุงูุทุงุฆุฑุฉ ุฅูู ุฃุฑุจุนุฉ ุฃุฑุจุงุน ...</em> <br><br><img src="https://habrastorage.org/web/6b5/ce5/3e1/6b5ce53e1b57499cad2a61a86a451835.png"><br>  <em>ุซู ูููุง ุจุชูุณูู ูู ูู ุงูุฃุฑุจุงุน ...</em> <br><br><img src="https://habrastorage.org/web/ba5/e5d/10a/ba5e5d10a47844a2bc95e5505641e798.png"><br>  <em>ูููุฐุง ุญุชู ูุญุตู ุนูู ุงูุชูุณูู ุงูููุงุฆู.</em> <br><br>  ุฏุนูุง ููุฏู ูุฒูุฏูุง ูู ุงูุชูุงุตูู ุญูู ูุซุงู ุจุณูุท <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฏุฑุณูุงู</a> ุจุงููุนู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงูุฉ ุงููุชุนููุฉ ุจู GiST</a> .  ุชุนุฑู ุนูู ุดูู ุงูุชูุณูู ูู ูุฐู ุงูุญุงูุฉ: <br><br><img src="https://habrastorage.org/web/a98/6f1/065/a986f106505b4b0fa0b03005a2c657f3.png"><br><br>  ูุชู ุชุฑููู ุงูุฃุฑุจุงุน ููุง ูู ููุถุญ ูู ุงูุดูู ุงูุฃูู.  ูู ุฃุฌู ุงูุฏูุฉ ุ ููุถุน ุงูุนูุฏ ุงููุฑุนูุฉ ูู ุงููุณุงุฑ ุฅูู ุงููููู ุจููุณ ุงูุชุณูุณู.  ูุธูุฑ ูููู ุงูููุฑุณ ุงููุญุชูู ูู ูุฐู ุงูุญุงูุฉ ูู ุงูุดูู ุฃุฏูุงู.  ุชุดูุฑ ูู ุนูุฏุฉ ุฏุงุฎููุฉ ุฅูู ุฃุฑุจุนุฉ ุนูุฏ ูุฑุนูุฉ ูุญุฏ ุฃูุตู.  ูููู ุชุณููุฉ ูู ูุฑุฌุน ุจุฑูู ุฑุจุงุนู ุ ููุง ูู ุงูุดูู.  ูููู ูุง ููุฌุฏ ุฃู ุชุณููุฉ ูู ุงูุชุทุจูู ูุฃูู ุฃูุซุฑ ููุงุกูุฉ ูุชุฎุฒูู ูุฌููุนุฉ ุซุงุจุชุฉ ูู ุฃุฑุจุนุฉ ูุฑุงุฌุน ูููู ุฃู ูููู ุจุนุถูุง ูุงุฑุบูุง. <br><br><img src="https://habrastorage.org/web/24c/3cf/97f/24c3cf97f59b4f99acb2aa992d1825d6.png"><br><br>  ุงูููุงุท ุงูุชู ุชูุน ุนูู ุงูุญุฏูุฏ ุชุชุนูู ุจุงูุฑุจุงุท ุฐู ุงูุนุฏุฏ ุงูุฃุตุบุฑ. <br><br><pre style=";text-align:right;direction:rtl"><code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> points(p <span class="hljs-type"><span class="hljs-type">point</span></span>); postgres=# <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> points(p) <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-type"><span class="hljs-type">point</span></span> <span class="hljs-string"><span class="hljs-string">'(1,1)'</span></span>), (<span class="hljs-type"><span class="hljs-type">point</span></span> <span class="hljs-string"><span class="hljs-string">'(3,2)'</span></span>), (<span class="hljs-type"><span class="hljs-type">point</span></span> <span class="hljs-string"><span class="hljs-string">'(6,3)'</span></span>), (<span class="hljs-type"><span class="hljs-type">point</span></span> <span class="hljs-string"><span class="hljs-string">'(5,5)'</span></span>), (<span class="hljs-type"><span class="hljs-type">point</span></span> <span class="hljs-string"><span class="hljs-string">'(7,8)'</span></span>), (<span class="hljs-type"><span class="hljs-type">point</span></span> <span class="hljs-string"><span class="hljs-string">'(8,6)'</span></span>); postgres=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> points_quad_idx <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> points <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> spgist(p);</code> </pre> <br>  ูู ูุฐู ุงูุญุงูุฉ ุ ูุชู ุงุณุชุฎุฏุงู ูุฆุฉ ุนุงูู ุงูุชุดุบูู "quad_point_ops" ุงูุชุฑุงุถููุง ุ ูุงูุชู ุชุญุชูู ุนูู ุงูุนูุงูู ุงูุชุงููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> amop.amopopr::<span class="hljs-type"><span class="hljs-type">regoperator</span></span>, amop.amopstrategy <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pg_opclass opc, pg_opfamily opf, pg_am am, pg_amop amop <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> opc.opcname = <span class="hljs-string"><span class="hljs-string">'quad_point_ops'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> opf.oid = opc.opcfamily <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> am.oid = opf.opfmethod <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> amop.amopfamily = opc.opcfamily <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> am.amname = <span class="hljs-string"><span class="hljs-string">'spgist'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> amop.amoplefttype = opc.opcintype;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> amopopr | amopstrategy -----------------+-------------- &lt;&lt;(point,point) | 1 strictly left &gt;&gt;(point,point) | 5 strictly right ~=(point,point) | 6 coincides &lt;^(point,point) | 10 strictly below &gt;^(point,point) | 11 strictly above &lt;@(point,box) | 8 contained in rectangle (6 rows)</code> </pre><br>  ุนูู ุณุจูู ุงููุซุงู ุ ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ููููุฉ <code>select * from points where p &gt;^ point '(2,7)'</code> ุงูุงุณุชุนูุงู <code>select * from points where p &gt;^ point '(2,7)'</code> (ุงุจุญุซ ุนู ุฌููุน ุงูููุงุท ุงูููุฌูุฏุฉ ุฃุนูู ุงูููุทุฉ ุงููุญุฏุฏุฉ). <br><br><img src="https://habrastorage.org/web/5f3/194/855/5f3194855fe74166b56c1703f4bb9b07.png"><br><br>  ูุจุฏุฃ ุจุงูุนูุฏุฉ ุงูุฌุฐุฑูุฉ ููุณุชุฎุฏู ูุธููุฉ ุงูุชูุงุณู ูุชุญุฏูุฏ ุฃู ุงูุนูุฏ ุงููุฑุนูุฉ ุณุชูุฒู.  ุจุงููุณุจุฉ ูููุดุบู <code>&gt;^</code> ุ ุชูุงุฑู ูุฐู ุงููุธููุฉ ุงูููุทุฉ (2ุ7) ุจุงูููุทุฉ ุงููุฑูุฒูุฉ ููุนูุฏุฉ (4ุ4) ูุชุญุฏุฏ ุงูุฃุฑุจุงุน ุงูุชู ูุฏ ุชุญุชูู ุนูู ุงูููุงุท ุงููุทููุจุฉ ุ ูู ูุฐู ุงูุญุงูุฉ ุ ุงูุฑุจุนุงู ุงูุฃูู ูุงูุฑุงุจุน. <br><br>  ูู ุงูุนูุฏุฉ ุงูููุงุจูุฉ ููุฑุจุน ุงูุฃูู ุ ูุญุฏุฏ ูุฑุฉ ุฃุฎุฑู ุงูุนูุฏ ุงููุฑุนูุฉ ุจุงุณุชุฎุฏุงู ุฏุงูุฉ ุงูุชูุงุณู.  ุงูููุทุฉ ุงููุฑูุฒูุฉ ูู (6ุ6) ุ ููุญู ุจุญุงุฌุฉ ูุฑุฉ ุฃุฎุฑู ูููุธุฑ ูู ุฎูุงู ุงูุฑุจุนูู ุงูุฃูู ูุงูุฑุงุจุน. <br><br><img src="https://habrastorage.org/web/8ac/99b/d9e/8ac99bd9e7b94f8d9683307b98ad1875.png"><br><br>  ุชุชูุงูู ูุงุฆูุฉ ุงูุนูุฏ ุงููุฑููุฉ (8.6) ู (7.8) ูุน ุงูุฑุจุน ุงูุฃูู ุ ูููุง ุงูููุทุฉ (7.8) ุงูุชู ุชูู ุจุดุฑุท ุงูุงุณุชุนูุงู.  ุงูุฅุดุงุฑุฉ ุฅูู ุงูุฑุจุน ุงูุฑุงุจุน ูุงุฑุบ. <br><br>  ูู ุงูุนูุฏุฉ ุงูุฏุงุฎููุฉ (4.4) ุ ุชููู ุงูุฅุดุงุฑุฉ ุฅูู ุงูุฑุจุน ุงูุฑุงุจุน ูุงุฑุบุฉ ุฃูุถูุง ุ ููุง ูููู ุนูููุฉ ุงูุจุญุซ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> enable_seqscan = <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>; postgres=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> points <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> p &gt;^ <span class="hljs-type"><span class="hljs-type">point</span></span> <span class="hljs-string"><span class="hljs-string">'(2,7)'</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> QUERY PLAN ------------------------------------------------ Index Only Scan using points_quad_idx on points Index Cond: (p &gt;^ '(2,7)'::point) (2 rows)</code> </pre><br><h3 style=";text-align:right;direction:rtl">  ุงูุฏุงุฎููุฉ </h3><br>  ูููููุง ุงุณุชูุดุงู ุงูุจููุฉ ุงูุฏุงุฎููุฉ ูููุงุฑุณ SP-GiST ุจุงุณุชุฎุฏุงู ุงูุงูุชุฏุงุฏ " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">gevel</a> " ุ ูุงูุฐู ุชู ุฐูุฑู ูุณุจููุง.  ุงูุฃุฎุจุงุฑ ุงูุณูุฆุฉ ูู ุฃูู ุจุณุจุจ ูุฌูุฏ ุฎุทุฃ ุ ูุฐุง ุงูููุญู ูุนูู ุจุดูู ุบูุฑ ุตุญูุญ ูุน ุงูุฅุตุฏุงุฑุงุช ุงูุญุฏูุซุฉ ูู PostgreSQL.  ุงูุฎุจุฑ ุงูุณุงุฑ ูู ุฃููุง ูุฎุทุท ูุฒูุงุฏุฉ "pageinspect" ูุน ูุธููุฉ "gevel" ( <a href="">ููุงูุดุฉ</a> ).  ููุฏ ุชู ุจุงููุนู ุฅุตูุงุญ ุงูุฎูู ูู "pageinspect". <br><blockquote style=";text-align:right;direction:rtl">  ูุฑุฉ ุฃุฎุฑู ุ ุงูุฃุฎุจุงุฑ ุงูุณูุฆุฉ ูู ุฃู ุงูุชุตุญูุญ ูุฏ ุชููู ุฏูู ุฃู ุชูุฏู. <br></blockquote><br>  ุนูู ุณุจูู ุงููุซุงู ุ ุฏุนูุง ูุฃุฎุฐ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุงูููุณุนุฉ ุ ุงูุชู ูุงูุช ุชุณุชุฎุฏู ูุฑุณู ุงูุตูุฑ ูุน ุฎุฑูุทุฉ ุงูุนุงูู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> airports_coordinates_quad_idx <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> airports_ml <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> spgist(coordinates);</code> </pre><br>  ุฃููุงู ุ ูููููุง ุงูุญุตูู ุนูู ุจุนุถ ุงูุฅุญุตุงุกุงุช ูููุคุดุฑ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> spgist_stats(<span class="hljs-string"><span class="hljs-string">'airports_coordinates_quad_idx'</span></span>);</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> spgist_stats ---------------------------------- totalPages: 33 + deletedPages: 0 + innerPages: 3 + leafPages: 30 + emptyPages: 2 + usedSpace: 201.53 kbytes+ usedInnerSpace: 2.17 kbytes + usedLeafSpace: 199.36 kbytes+ freeSpace: 61.44 kbytes + fillRatio: 76.64% + leafTuples: 5993 + innerTuples: 37 + innerAllTheSame: 0 + leafPlaceholders: 725 + innerPlaceholders: 0 + leafRedirects: 0 + innerRedirects: 0 (1 row)</code> </pre><br>  ูุซุงููุง ุ ูููููุง ุฅุฎุฑุงุฌ ุดุฌุฑุฉ ุงูููุฑุณ ููุณูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> tid, n, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>, tid_ptr, prefix, leaf_value <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> spgist_print(<span class="hljs-string"><span class="hljs-string">'airports_coordinates_quad_idx'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t( tid tid, allthesame <span class="hljs-type"><span class="hljs-type">bool</span></span>, n <span class="hljs-type"><span class="hljs-type">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span>, tid_ptr tid, prefix <span class="hljs-type"><span class="hljs-type">point</span></span>, <span class="hljs-comment"><span class="hljs-comment">-- prefix type node_label int, -- label type (unused here) leaf_value point -- list value type ) order by tid, n;</span></span></code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> tid | n | level | tid_ptr | prefix | leaf_value ---------+---+-------+---------+------------------+------------------ (1,1) | 0 | 1 | (5,3) | (-10.220,53.588) | (1,1) | 1 | 1 | (5,2) | (-10.220,53.588) | (1,1) | 2 | 1 | (5,1) | (-10.220,53.588) | (1,1) | 3 | 1 | (5,14) | (-10.220,53.588) | (3,68) | | 3 | | | (86.107,55.270) (3,70) | | 3 | | | (129.771,62.093) (3,85) | | 4 | | | (57.684,-20.430) (3,122) | | 4 | | | (107.438,51.808) (3,154) | | 3 | | | (-51.678,64.191) (5,1) | 0 | 2 | (24,27) | (-88.680,48.638) | (5,1) | 1 | 2 | (5,7) | (-88.680,48.638) | ...</code> </pre><br>  ููู ุถุน ูู ุงุนุชุจุงุฑู ุฃู "spgist_print" ูุง ูููู ุจุฅุฎุฑุงุฌ ุฌููุน ููู ุงูุฃูุฑุงู ุ ูููู ููุท ุงูููู ุงูุฃููู ูู ุงููุงุฆูุฉ ุ ูุจุงูุชุงูู ููุถุญ ุจููุฉ ุงูููุฑุณ ุจุฏูุงู ูู ูุญุชููุงุชู ุงููุงููุฉ. <br><br><h2 style=";text-align:right;direction:rtl">  ูุซุงู: ุฃุดุฌุงุฑ ุงูุฃุจุนุงุฏ ู </h2><br>  ุจุงููุณุจุฉ ููููุงุท ููุณูุง ูู ุงูุทุงุฆุฑุฉ ุ ูููููุง ุฃูุถูุง ุงูุชุฑุงุญ ุทุฑููุฉ ุฃุฎุฑู ูุชูุณูู ุงููุณุงุญุฉ. <br><br>  <em>ููุฑุณู ุฎุทูุง ุฃููููุง ูู</em> ุฎูุงู ุงูููุทุฉ ุงูุฃููู ุงูุชู ูุชู ููุฑุณุชูุง.  ููุณู ุงูุทุงุฆุฑุฉ ุฅูู ูุณููู: ุงูุนููู ูุงูุณููู.  ุงูููุทุฉ ุงูุซุงููุฉ ุงููุฑุงุฏ ููุฑุณุชูุง ุชูุน ูู ุฃุญุฏ ูุฐู ุงูุฃุฌุฒุงุก.  ูู ุฎูุงู ูุฐู ุงูููุทุฉ ุ <em>ููุฑุณู ุฎุทูุง ุฑุฃุณููุง</em> ููุณู ูุฐุง ุงูุฌุฒุก ุฅูู ูุณููู: ุงููููู ูุงููุณุงุฑ.  ูุฑุณู ูุฑุฉ ุฃุฎุฑู ุฎุทูุง ุฃููููุง ูู ุฎูุงู ุงูููุทุฉ ุงูุชุงููุฉ ูุฎุทูุง ุฑุฃุณููุง ูู ุฎูุงู ุงูููุทุฉ ุงูุชุงููุฉ ููุง ุฅูู ุฐูู. <br><br>  ุณูููู ููู ุงูุนูุฏ ุงูุฏุงุฎููุฉ ููุดุฌุฑุฉ ุงููุจููุฉ ุจูุฐู ุงูุทุฑููุฉ ุนูุฏุชุงู ูุฑุนูุชุงู ููุท.  ูููู ุฃู ูุคุฏู ูู ูู ุงููุฑุงุฌุนูู ุฅูุง ุฅูู ุงูุนูุฏุฉ ุงูุฏุงุฎููุฉ ุงูุชุงููุฉ ูู ุงูุชุณูุณู ุงููุฑูู ุฃู ุฅูู ูุงุฆูุฉ ุงูุนูุฏ ุงููุฑููุฉ. <br><br>  ูููู ุชุนููู ูุฐู ุงูุทุฑููุฉ ุจุณูููุฉ ุนูู ุงููุณุงุญุงุช k- ุงูุฃุจุนุงุฏ ุ ูุจุงูุชุงูู ุ ุชุณูู ุงูุฃุดุฌุงุฑ ุฃูุถูุง k-dimensional (ุฃุดุฌุงุฑ kD) ูู ุงูุฃุฏุจ. <br><br>  ุดุฑุญ ุงูุทุฑููุฉ ุนู ุทุฑูู ุงููุทุงุฑุงุช: <br><br><img src="https://habrastorage.org/web/a97/130/4d6/a971304d68c8442b86a10c0e52c3e78c.png"><br>  <em>ุฃููุงู ุ ูููุง ุจุชูุณูู ุงูุทุงุฆุฑุฉ ุฅูู ุงูุฃุฌุฒุงุก ุงูุนูููุฉ ูุงูุณูููุฉ ...</em> <br><br><img src="https://habrastorage.org/web/035/660/8fe/0356608fea41422eb7fab9cbb2b67669.png"><br>  <em>ุซู ููุณู ูู ุฌุฒุก ุฅูู ุงูุฃุฌุฒุงุก ุงููููู ูุงููุณุฑู ...</em> <br><br><img src="https://habrastorage.org/web/bb1/26e/8db/bb126e8db6714d7bb5122f9213e5f658.png"><br>  <em>ูููุฐุง ุญุชู ูุญุตู ุนูู ุงูุชูุณูู ุงูููุงุฆู.</em> <br><br>  ูุงุณุชุฎุฏุงู ูุณู ูุซู ูุฐุง ุ ูุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ูุฆุฉ ุงููุดุบู <strong>"kd_point_ops" ุจุดูู ุตุฑูุญ</strong> ุนูุฏ ุฅูุดุงุก ููุฑุณ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> points_kd_idx <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> points <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> spgist(p kd_point_ops);</code> </pre><br>  ุชุชุถูู ูุฐู ุงููุฆุฉ ููุณ ุงูุนูุงูู ุงูุชู ุชุดุบููุง ุงููุฆุฉ "ุงูุงูุชุฑุงุถูุฉ" "quad_point_ops". <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุฏุงุฎููุฉ </h3><br>  ุนูุฏ ุงููุธุฑ ูู ุจููุฉ ุงูุดุฌุฑุฉ ุ ูุญุชุงุฌ ุฅูู ูุฑุงุนุงุฉ ุฃู ุงูุจุงุฏุฆุฉ ูู ูุฐู ุงูุญุงูุฉ ูู ุฅุญุฏุงุซูุฉ ูุงุญุฏุฉ ููุท ูููุณุช ููุทุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> tid, n, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>, tid_ptr, prefix, leaf_value <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> spgist_print(<span class="hljs-string"><span class="hljs-string">'airports_coordinates_kd_idx'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t( tid tid, allthesame <span class="hljs-type"><span class="hljs-type">bool</span></span>, n <span class="hljs-type"><span class="hljs-type">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span>, tid_ptr tid, prefix <span class="hljs-type"><span class="hljs-type">float</span></span>, <span class="hljs-comment"><span class="hljs-comment">-- prefix type node_label int, -- label type (unused here) leaf_value point -- list node type ) order by tid, n;</span></span></code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> tid | n | level | tid_ptr | prefix | leaf_value ---------+---+-------+---------+------------+------------------ (1,1) | 0 | 1 | (5,1) | 53.740 | (1,1) | 1 | 1 | (5,4) | 53.740 | (3,113) | | 6 | | | (-7.277,62.064) (3,114) | | 6 | | | (-85.033,73.006) (5,1) | 0 | 2 | (5,12) | -65.449 | (5,1) | 1 | 2 | (5,2) | -65.449 | (5,2) | 0 | 3 | (5,6) | 35.624 | (5,2) | 1 | 3 | (5,3) | 35.624 | ...</code> </pre><br><h2 style=";text-align:right;direction:rtl">  ูุซุงู: ุดุฌุฑุฉ ุฌุฐุฑูุฉ </h2><br>  ูููููุง ุฃูุถูุง ุงุณุชุฎุฏุงู SP-GiST ูุชูููุฐ ุดุฌุฑุฉ ุฌุฐุฑูุฉ ููุณูุงุณู.  ุชุชูุซู ููุฑุฉ ุดุฌุฑุฉ ุงูุฃุณุงุณ ูู ุฃู ุงูุณูุณูุฉ ุงููุฑุงุฏ ููุฑุณุชูุง ูุง ูุชู ุชุฎุฒูููุง ุจุงููุงูู ูู ุนูุฏุฉ ูุฑูุฉ ุ ูููู ูุชู ุงูุญุตูู ุนูููุง ุนู ุทุฑูู ูุตู ุงูููู ุงููุฎุฒูุฉ ูู ุงูุนูุฏ ุฃุนูู ูุฐู ุงูุณูุณูุฉ ุญุชู ุงูุฌุฐุฑ. <br><br>  ูููุชุฑุถ ุ ูุญู ุจุญุงุฌุฉ ุฅูู ููุฑุณุฉ ุนูุงููู URL ูููููุน: "postgrespro.ru" ุ "postgrespro.com" ุ "postgresql.org" ุ ู "planet.postgresql.org". <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> sites(url <span class="hljs-type"><span class="hljs-type">text</span></span>); postgres=# <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> sites <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-string"><span class="hljs-string">'postgrespro.ru'</span></span>),(<span class="hljs-string"><span class="hljs-string">'postgrespro.com'</span></span>),(<span class="hljs-string"><span class="hljs-string">'postgresql.org'</span></span>),(<span class="hljs-string"><span class="hljs-string">'planet.postgresql.org'</span></span>); postgres=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> sites <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> spgist(url);</code> </pre><br>  ุณุชุจุฏู ุงูุดุฌุฑุฉ ููุง ููู: <br><br><img src="https://habrastorage.org/web/6dd/626/8d2/6dd6268d2c304e98a78609a6bad997e1.png"><br><br>  ุฅู ุงูุนูุฏ ุงูุฏุงุฎููุฉ ููุชุฌุฑ ุงูุดุฌุฑุฉ ุชููู ุจุงุฏุฆุงุช ูุดุชุฑูุฉ ููู ุงูุนูุฏ ุงููุฑุนูุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูู ุงูุนูุฏ ุงููุฑุนูุฉ ูู "stgres" ุ ุชุจุฏุฃ ุงูููู ุจู "p" + "o" + "stgres". <br><br>  ุนูู ุนูุณ ุงููุฑุจุนุงุช ุงูุฑุจุงุนูุฉ ุ ูุชู ุชูููุฒ ูู ูุคุดุฑ ุฅูู ุนูุฏุฉ ุชุงุจุนุฉ ุจุญุฑู ูุงุญุฏ (ุจุดูู ุฃูุซุฑ ุฏูุฉ ุ ูุน ูุญุฏุชู ุจุงูุช ุ ููู ูุฐุง ููุณ ููููุง ุฌุฏูุง). <br><br>  ุชุฏุนู ูุฆุฉ ูุดุบู "Text_ops" ุนูุงูู ุงูุชุดุบูู ุงูุดุจููุฉ ุจู B: "ูุชุณุงููุฉ" ู "ุฃูุจุฑ" ู "ุฃูู": <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> amop.amopopr::<span class="hljs-type"><span class="hljs-type">regoperator</span></span>, amop.amopstrategy <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pg_opclass opc, pg_opfamily opf, pg_am am, pg_amop amop <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> opc.opcname = <span class="hljs-string"><span class="hljs-string">'text_ops'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> opf.oid = opc.opcfamily <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> am.oid = opf.opfmethod <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> amop.amopfamily = opc.opcfamily <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> am.amname = <span class="hljs-string"><span class="hljs-string">'spgist'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> amop.amoplefttype = opc.opcintype;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> amopopr | amopstrategy -----------------+-------------- ~&lt;~(text,text) | 1 ~&lt;=~(text,text) | 2 =(text,text) | 3 ~&gt;=~(text,text) | 4 ~&gt;~(text,text) | 5 &lt;(text,text) | 11 &lt;=(text,text) | 12 &gt;=(text,text) | 14 &gt;(text,text) | 15 (9 rows)</code> </pre><br>  ุชููุฒ ุงูุนูุงูู ูุน ุงูุชูุฏุฉ ูู ุฃููุง ุชุชุนุงูู ูุน <em>ุงูุจุงูุชุงุช</em> ุจุฏูุงู ูู <em>ุงูุญุฑูู</em> . <br><br>  ูู ุจุนุถ ุงูุฃุญูุงู ุ ูุฏ ูููู ุงูุชูุซูู ูู ุดูู ุดุฌุฑุฉ ุฌุฐุฑูุฉ ุฃูุซุฑ ุฅุญูุงูุง ูู B-tree ูุฃู ุงูููู ููุณุช ูุฎุฒูุฉ ุจุงููุงูู ุ ูููู ูุชู ุฅุนุงุฏุฉ ุจูุงุฆูุง ูููุง ุฏุนุช ุงูุญุงุฌุฉ ุฅูู ุฐูู ุฃุซูุงุก ุชูุงุฒููุง ุนุจุฑ ุงูุดุฌุฑุฉ. <br><br>  ุงููุธุฑ ูู ุงุณุชุนูุงู: <code>select * from sites where url like 'postgresp%ru'</code> .  ูููู ุชูููุฐู ุจุงุณุชุฎุฏุงู ุงูููุฑุณ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sites <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> url <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'postgresp%ru'</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> QUERY PLAN ------------------------------------------------------------------------------ Index Only Scan using sites_url_idx on sites Index Cond: ((url ~&gt;=~ 'postgresp'::text) AND (url ~&lt;~ 'postgresq'::text)) Filter: (url ~~ 'postgresp%ru'::text) (3 rows)</code> </pre><br>  ูู ุงููุงูุน ุ ูุชู ุงุณุชุฎุฏุงู ุงูููุฑุณ ููุนุซูุฑ ุนูู ููู ุฃูุจุฑ ุฃู ูุณุงููุฉ ูู "postgresp" ุ ูููู ุฃูู ูู "postgresq" (Index Cond) ุ ุซู ูุชู ุงุฎุชูุงุฑ ุงูููู ุงููุทุงุจูุฉ ูู ุงููุชูุฌุฉ (Filter). <br><br>  ุฃููุงู ุ ูุฌุจ ุฃู ุชุญุฏุฏ ูุธููุฉ ุงูุชูุงุณู ุงูุนูุฏ ุงููุฑุนูุฉ ููุฌุฐุฑ "p" ุงูุชู ูุญุชุงุฌ ุฅูู ุงููุฒูู ุฅูููุง.  ูุชููุฑ ุฎูุงุฑุงู: "p" + "l" (ูุง ุญุงุฌุฉ ุฅูู ุงููุจูุท ุ ููู ุฃูุฑ ูุงุถุญ ุญุชู ุจุฏูู ุงูุบูุต ุฃุนูู) ู "p" + "o" + "stgres" (ุชุงุจุน ุงููุฒูู). <br><br>  ุจุงููุณุจุฉ ูุนูุฏุฉ "stgres" ุ ููุฒู ุงุณุชุฏุนุงุก ูุธููุฉ ุงูุชูุงุณู ูุฑุฉ ุฃุฎุฑู ููุชุญูู ูู "postgres" + "p" + "ro."  (ุชุงุจุน ุงููุฒูู) ู "postgres" + "q" (ูุง ุฏุงุนู ููุชูุงุฒู). <br><br>  ู "ุฑูุงู ุนูุงูู"  ุงูุนูุฏุฉ ูุฌููุน ุงูุนูุฏ ุงููุฑููุฉ ุงูุชุงุจุนุฉ ููุง ุ ุณูู ุชุณุชุฌูุจ ูุธููุฉ ุงูุชูุงุณู "ูุนู" ุ ูุจุงูุชุงูู ูุฅู ุทุฑููุฉ ุงูููุฑุณ ุณุชูุฑุฌุน ูููุชูู: "postgrespro.com" ู "postgrespro.ru".  ุณูุชู ุงุฎุชูุงุฑ ูููุฉ ูุทุงุจูุฉ ูุงุญุฏุฉ ูููู ูู ูุฑุญูุฉ ุงูุชุตููุฉ. <br><br><img src="https://habrastorage.org/web/cec/aec/23c/cecaec23c932448098cdd360e60d3c5c.png"><br><br><h3 style=";text-align:right;direction:rtl">  ุงูุฏุงุฎููุฉ </h3><br>  ุนูุฏ ุงููุธุฑ ูู ุจููุฉ ุงูุดุฌุฑุฉ ุ ูุญุชุงุฌ ุฅูู ุฃุฎุฐ ุฃููุงุน ุงูุจูุงูุงุช ูู ุงูุงุนุชุจุงุฑ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> spgist_print(<span class="hljs-string"><span class="hljs-string">'sites_url_idx'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> t( tid tid, allthesame <span class="hljs-type"><span class="hljs-type">bool</span></span>, n <span class="hljs-type"><span class="hljs-type">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span>, tid_ptr tid, prefix <span class="hljs-type"><span class="hljs-type">text</span></span>, <span class="hljs-comment"><span class="hljs-comment">-- prefix type node_label smallint, -- label type leaf_value text -- leaf node type ) order by tid, n;</span></span></code> </pre><br><h2 style=";text-align:right;direction:rtl">  ุฎุตุงุฆุต </h2><br>  ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ุฎุตุงุฆุต ุทุฑููุฉ ุงููุตูู ุฅูู SP-GiST ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชู ุชูุฏูู</a> ุงูุงุณุชุนูุงูุงุช ูุณุจููุง): <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> amname | name | pg_indexam_has_property --------+---------------+------------------------- spgist | can_order | f spgist | can_unique | f spgist | can_multi_col | f spgist | can_exclude | t</code> </pre><br>  ูุง ูููู ุงุณุชุฎุฏุงู ููุงุฑุณ SP-GiST ูููุฑุฒ ููุฏุนู ุงูููุฏ ุงููุฑูุฏ.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุง ูููู ุฅูุดุงุก ููุงุฑุณ ูุซู ูุฐู ุนูู ุนุฏุฉ ุฃุนูุฏุฉ (ุนูู ุนูุณ GiST).  ููู ููุณูุญ ุจุงุณุชุฎุฏุงู ูุฐู ุงูููุงุฑุณ ูุฏุนู ูููุฏ ุงูุงุณุชุจุนุงุฏ. <br><br>  ุชุชููุฑ ุฎุตุงุฆุต ุทุจูุฉ ุงูููุฑุณ ุงูุชุงููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> name | pg_index_has_property ---------------+----------------------- clusterable | f index_scan | t bitmap_scan | t backward_scan | f</code> </pre><br>  ุงููุฑู ูู GiST ููุง ูู ุฃู ุงูุชุฌููุน ุฃูุฑ ูุณุชุญูู. <br><br>  ูุฃุฎูุฑูุง ูููุง ููู ุฎุตุงุฆุต ุทุจูุฉ ุงูุนููุฏ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> name | pg_index_column_has_property --------------------+------------------------------ asc | f desc | f nulls_first | f nulls_last | f orderable | f distance_orderable | f returnable | t search_array | f search_nulls | t</code> </pre><br>  ุงููุฑุฒ ุบูุฑ ูุฏุนูู ุ ููู ุฃูุฑ ูููู ุงูุชูุจุค ุจู.  ูุง ุชุชููุฑ ุนูุงูู ุงูุชุดุบูู ุนู ุจุนุฏ ููุจุญุซ ุนู ุฃูุฑุจ ุงูุฌูุฑุงู ูู SP-GiST ุญุชู ุงูุขู.  ุนูู ุงูุฃุฑุฌุญ ุ ุณูุชู ุฏุนู ูุฐู ุงูููุฒุฉ ูู ุงููุณุชูุจู. <br><blockquote style=";text-align:right;direction:rtl">  ูุชู ุฏุนูู ูู ุจุฑูุงูุฌ PostgreSQL 12 ุงููุงุฏู ุ ููู ุงูุชุตุญูุญ ุงูุฐู ูุชุจู ููููุชุง ุฌููุฎูู. <br></blockquote><br>  ูููู ุงุณุชุฎุฏุงู SP-GiST ูููุณุญ ุงูุถูุฆู ููุท ุ ุนูู ุงูุฃูู ููุฆุงุช ุงููุดุบู ุงูุชู ุชูุช ููุงูุดุชูุง.  ููุง ุฑุฃููุง ุ ูู ุจุนุถ ุงูุญุงูุงุช ุ ูุชู ุชุฎุฒูู ุงูููู ุงููููุฑุณุฉ ุจุดูู ุตุฑูุญ ูู ุงูุนูุฏ ุงููุฑููุฉ ุ ุจูููุง ูู ุงูููู ุงูุฃุฎุฑู ุ ูุชู ุฅุนุงุฏุฉ ุจูุงุก ุงูููู ุฌุฒุฆููุง ุฎูุงู ูุฒูู ุงูุฃุดุฌุงุฑ. <br><br><h3 style=";text-align:right;direction:rtl">  ุงูููู ุงูุฎุงููุฉ </h3><br>  ููุณ ูุชุนููุฏ ุงูุตูุฑุฉ ุ ูุญู ูู ูุฐูุฑ ุงูุตูุงุช ุงููุงุฑุบุฉ ุญุชู ุงูุขู.  ูุชุถุญ ูู ุฎุตุงุฆุต ุงูููุฑุณ ุฃูู ูุชู ุฏุนู NULLs.  ุญูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sites <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> url <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> QUERY PLAN ---------------------------------------------- Index Only Scan using sites_url_idx on sites Index Cond: (url IS NULL) (2 rows)</code> </pre><br>  ููุน ุฐูู ุ NULL ุดูุก ุบุฑูุจ ูู SP-GiST.  ูุฌุจ ุฃู ุชููู ุฌููุน ุงููุดุบููู ูู ูุฆุฉ ูุดุบู "spgist" ุตุงุฑูุฉ: ูุฌุจ ุฃู ูุฑุฌุน ุงููุดุบู NULL ูููุง ูุงูุช ุฃู ูู ูุนููุงุชู ุฎุงููุฉ.  ูุถูู ุงูุฃุณููุจ ููุณู ูุฐุง: ููุท ูุง ูุชู ุชูุฑูุฑ NULLs ุฅูู ุนูุงูู ุงูุชุดุบูู. <br><br>  ูููู ูุงุณุชุฎุฏุงู ุทุฑููุฉ ุงููุตูู ูููุญุต ููุท ุ ูุฌุจ ุชุฎุฒูู NULLs ูู ุงูููุฑุณ ุนูู ุฃู ุญุงู.  ููุชู ุชุฎุฒูููุง ุ ูููู ูู ุดุฌุฑุฉ ูููุตูุฉ ูุน ุฌุฐุฑูุง ุงูุฎุงุต. <br><br><h2 style=";text-align:right;direction:rtl">  ุฃููุงุน ุงูุจูุงูุงุช ุงูุฃุฎุฑู </h2><br>  ุจุงูุฅุถุงูุฉ ุฅูู ููุงุท ูุฃุดุฌุงุฑ ุงูุฌุฐุฑ ููุณูุงุณู ุ ูุชู ุฃูุถูุง ุชุทุจูู ุทุฑู ุฃุฎุฑู ุชุนุชูุฏ ุนูู SP-GiST. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชููุฑ ูุฆุฉ ูุดุบู Box_ops ุฑุจุงุนู ุงููุณุชุทููุงุช. <br>  ูุชู ุชูุซูู ูู <em>ูุณุชุทูู</em> <em>ุจููุทุฉ ูู ูุถุงุก ุฑุจุงุนู ุงูุฃุจุนุงุฏ</em> ุ ูุจุงูุชุงูู ูุฅู ุนุฏุฏ ุงูุฃุฑุจุงุน ูุณุงูู 16. ูููู ููุคุดุฑ ูุซู ูุฐุง ุงูุชุบูุจ ุนูู GiST ูู ุงูุฃุฏุงุก ุนูุฏูุง ูููู ููุงู ุงููุซูุฑ ูู ุงูุชูุงุทุนุงุช ูููุณุชุทููุงุช: ูู GiST ุ ูู ุงููุณุชุญูู ุฑุณู ุญุฏูุฏ ูุฐูู ููุตู ุงููุงุฆูุงุช ุงููุชูุงุทุนุฉ ุนู ุจุนุถูุง ุงูุจุนุถ ุ ูู ุญูู ูุง ุชูุฌุฏ ูุซู ูุฐู ุงููุดููุงุช ุจุงูููุงุท (ุญุชู ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ). <br></li><li style=";text-align:right;direction:rtl">  ุชููุฑ ูุฆุฉ ุนุงูู ุงูุชุดุบูู "Range_ops" ุฑุจุงุนููุง ููููุงุตู ุงูุฒูููุฉ. <br>  ูุชู ุชูุซูู <em>ุงููุงุตู ุงูุฒููู</em> <em>ุจููุทุฉ ุซูุงุฆูุฉ ุงูุฃุจุนุงุฏ</em> : ุงูุญุฏ ุงูุฃุฏูู ูุตุจุญ ุงูุญุฏ ุงูุฃูุตู ุ ูุงูุญุฏูุฏ ุงูุนููุง ุชุตุจุญ ุงูุฅุญุฏุงุซู. <br></li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฑุฃ ุนูู</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar446624/">https://habr.com/ru/post/ar446624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar446612/index.html">ูุญุธุฉ ุจุฏุฃูุง ูุนุชูุฏ ูู ุงูุงุจุชูุงุฑ</a></li>
<li><a href="../ar446614/index.html">ุฃูุธูุฉ ุงููููุงุช ุงูุงูุชุฑุงุถูุฉ ููุธุงู Linux: ููุงุฐุง ูู ูุทููุจุฉ ูููู ุชุนููุ ุงูุฌุฒุก 1</a></li>
<li><a href="../ar446616/index.html">ููู ูุนููุง ุณุญุงุจุฉ FaaS ุฏุงุฎู Kubernetes ููุฒูุง ูู Tinkoff Hackathon</a></li>
<li><a href="../ar446620/index.html">DataGrip 2019.1: ุฏุนู ููุงุนุฏ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ููุตูุต ุงูุชููุฆุฉ ูุนูููุงุช ุงูุชูุชูุด ุงูุฌุฏูุฏุฉ ูุงููุฒูุฏ</a></li>
<li><a href="../ar446622/index.html">ุงูุฃุฎุจุงุฑ ูู 11</a></li>
<li><a href="../ar446626/index.html">ูุญุงุฏุซุงุช ูุงุณุจุฑุณูู ููุจุงูู # 1. ูุชุนุฏุฏุฉ ูุญุฏุฉ</a></li>
<li><a href="../ar446628/index.html">ุฅุนุทุงุก ุงููุฒูุฏ HighLoad ++: ูู ุงูุงุซููู ูู ุณุงู ุจุทุฑุณุจุฑุบ</a></li>
<li><a href="../ar446630/index.html">ููููุฉ ุงุฎุชูุงุฑ ุทุงุจุนุฉ ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ ุ ุฃู ููุงุฐุง ุชุญุชุงุฌ ุฅูู ุทุงููุฉ ุชุณุฎูู ููุงููุฑุง ูุบููุฉ</a></li>
<li><a href="../ar446632/index.html">ูู ุงููุงููู ุฅูู ุชุทููุฑ ุงูุจูุงูุงุช ุงููุจูุฑุฉ</a></li>
<li><a href="../ar446634/index.html">SDN Digest - ุณุชุฉ ุจุฑุงูุฌ ูุญุงูุงุฉ ููุชูุญุฉ ุงููุตุฏุฑ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>