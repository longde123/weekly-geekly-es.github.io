<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍🤝‍👨🏼 😾 🤦🏾 Immer leuchten, überall leuchten. Teil 2 👩‍🎨 🍓 🧦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die aktuelle Version der Prozessormodulkarte
 
 Der zweite Teil des Materials über das selbstgemachte Steuerungssystem für die Fahrradbeleuchtung ist ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Immer leuchten, überall leuchten. Teil 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/381907/"><img src="https://habrastorage.org/files/5e2/2b5/dd1/5e22b5dd1e73455c8c72089c9fbcc16c.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die aktuelle Version der Prozessormodulkarte</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Der zweite Teil des Materials über das selbstgemachte Steuerungssystem für die Fahrradbeleuchtung ist eingetroffen. </font><font style="vertical-align: inherit;">Ich möchte Sie daran erinnern, dass ich beschlossen habe, ein RS-485-Netzwerk aufzubauen, in dem sich Steuerungs- und Ausführungsgeräte befinden. Der Master ist ein Computer, auf dem das Programm ausgeführt wird, das die Logik implementiert. </font><font style="vertical-align: inherit;">Bevor ich mit der Beschreibung der Logik des Systems fortfahre, werde ich über Verbesserungen und Paradigmenwechsel in Bezug auf Hardware sprechen, die sich aus der Diskussion und dem Testen von Prototypen aus dem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ersten Teil ergeben haben</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dopilirovanie</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Zunächst wurde beschlossen, die Drüsen in Analogie zu Arduino und einer Reihe anderer Projekte modular zu gestalten. Ich dachte mir, dass mein Hauptmodul (Prozessormodul) mehr Komponenten als Funktionsmodule enthält, also wird es das Motherboard sein. Und "Schilde" werden eingefügt. In Bezug auf die Schaltung wurden die folgenden Änderungen vorgenommen: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Ein Leistungsstabilisator (AMS1117-5.0) wurde hinzugefügt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Die Stromverdrahtung des Mikrocontrollers wird geändert. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Die Platine des Hauptmoduls ist unter Berücksichtigung der industriellen Fertigung geschieden, die zweite Kupferschicht wird jedoch auf ein Minimum reduziert - Sie können zu Hause eine einschichtige Platine herstellen und Jumper setzen. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4) Endpunkt-Jumper hinzugefügt, um die Leitung auf dem letzten Gerät zu beenden.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5) RST Lock-Jumper hinzugefügt, um das Zurücksetzen des Mikrocontrollers zu blockieren. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6) Ähnlich wie in Abschnitt 3 sind die Tochterplatinen des Encoders und des LED-Streifentreibers geschieden. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7) Ich warte auf die erste Probebestellung von Leiterplatten, während nur die Hauptmodule (ITEAD Studio). </font></font><br>
<br>
<img src="https://habrastorage.org/files/8b3/d44/5ba/8b3d445ba6f64dc88013d76349ace4b0.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Tochterplatine des LED-Streifentreibers </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vanity um RS-485</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Nun wende ich mich an den Netzwerkmaster. In Bezug auf Eisen ist dort alles einfach - zumindest dachte ich das. Ich nahm einen USB-UART-Adapter, schloss eine kleine Platine mit MAX485 und mehreren Widerständen an und begann zu arbeiten. Und er trat auf einen ausgezeichneten Rechen, der ziemlich dokumentiert war, aber für einen Anfänger war es völlig nicht offensichtlich.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der MAX485 muss zwischen Empfangen (niedrig an den Pins ~ RE und DE) und Senden (hoch) umgeschaltet werden. Anhand einer einfachen Logik habe ich den DTR-Ausgang des Konverters (auf CP2102) verwendet, um den Modus zu steuern und ihn programmgesteuert zu ziehen. Und bekam eine Schande. Das System funktionierte irgendwie nur mit unannehmbar großen Verzögerungen zwischen Empfang und Übertragung. Und das alles, weil der DTR langsam schaltet. Wie langsam hatte ich nichts zu messen, also </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gebe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ich nur </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">einen Link</font></a><font style="vertical-align: inherit;"> zu einer vernünftigeren Rechenstudie mit einem Oszilloskop.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aus dem gleichen Material habe ich Folgendes verstanden: Die Verwendung von FT232 ist am wenigsten schmerzhaft, da die Schlussfolgerung gezogen wird, dass der Chip, wenn er standardmäßig konfiguriert ist, nur zum Umschalten des RS-485-Modus ausgelegt ist. Einfach ausgedrückt, wird beim Senden über UART ein hoher Pegel angezeigt. Also wurde der chinesische Klon Arduino Nano aus den Behältern extrahiert, ~ RST ist mit Masse kurzgeschlossen, der Draht ist mit dem 13. Bein von FT232 verlötet und das Ganze ist mit dem MAX485 verbunden. Es funktioniert wie eine Uhr. In der "Kampf" -Version des Systems wird ein solches Design natürlich nicht verwendet - die chinesische Industrie freut sich, ähnliche vorgefertigte Boards anbieten zu können. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Systemlogik</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zum Schluss, wie der gesamte Prozess aus Sicht des Masters aussieht. Es funktioniert mit Geräteobjekten, die gesteuert oder ausgeführt werden können. Manager sind in reale ("Eisen"), virtuelle und Timer unterteilt. Executive kann nur real sein. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Virtuelle Steuergeräte werden benötigt, wenn eine komplexere Systemverwaltung implementiert wird, insbesondere wenn eine Webschnittstelle daran angehängt wird. Sie sind auch nützlich für die Integration in etwas, das ich mir noch nicht ausgedacht habe. Ja, hier muss ich wahrscheinlich sagen, dass sich ein solches „Gerät“ im Allgemeinen im System befindet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein Gerät ist ein Objekt der Geräteklasse. Die Mindestmenge an Attributen ist der Name, der Typ und das Verwendungsflag. Abhängig vom Typ können außerdem die Adresse auf dem Bus, der Name des Slave-Geräts, die Priorität der Steuerung, die Anfangswerte der Register und einige andere Attribute hinzugefügt werden. Die Hauptmethoden der Klasse beziehen sich auf die Arbeit mit realen Geräten - das Lesen und Schreiben von Registern. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und jetzt, nachdem wir uns mehr oder weniger für die Programmstruktur des Systems entschieden haben, können wir mit der Implementierung beginnen. Derzeit gibt es Folgendes: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Comm485-Modul mit einer Beschreibung der Conn-Klasse. Klassenmethoden öffnen und schließen eine Verbindung, senden und empfangen ein Paket und überprüfen eine Prüfsumme. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Das Device485-Modul enthält die oben beschriebene Device-Klasse. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) das Hauptsoftwaremodul. </font></font><br>
<br>
<img src="https://habrastorage.org/files/b91/569/3db/b915693dbb1f4dbd833aa59414837274.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encoder Daughter Board</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tatsächlich sind im Hauptmodul zwei Dinge implementiert. Die erste besteht darin, die erforderlichen Objekte der Geräteklasse gemäß der Konfigurationsdatei zu erstellen. Die zweite ist direkt die Logik des Systems. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dabei</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
funktioniert derzeit Folgendes: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Zusammenstellung einer Liste der beteiligten Aktuatoren. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Für jeden Künstler wird eine Liste der beteiligten Steuergeräte erstellt. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Die Werte der Register des Steuergeräts mit der höchsten Priorität werden in den Registern des Stellglieds und der Steuerung aufgezeichnet, die eine niedrigere Priorität haben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nehmen wir an, wir haben einen Encoder (Eisen) mit niedriger Priorität und ein virtuelles Steuergerät mit hoher Priorität. Im Standby-Modus ist das virtuelle Gerät deaktiviert. Wenn Sie das Licht einstellen müssen, ohne den fünften Punkt vom Sofa abzuheben, wird ein virtuelles Gerät (für kurze Zeit) aktiviert, um dem Interpreten und dem Encoder neue Parameter zu geben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach einer kleinen Änderung der Software ist der Hauptmodus jedoch wahrscheinlich der folgende: Es gibt zwei Steuergeräte mit derselben Priorität. Beim Ändern der Register eines von ihnen werden die Werte in die Register des Executors und des anderen Managers geschrieben, der keine Änderungen vorgenommen hat. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eigentlich vorerst. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Projekt ist auf Github verfügbar.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im Host-Ordner können Sie sehen, wie Python-Code gekühlt wird. </font><font style="vertical-align: inherit;">Es gibt zwei Module (Comm485, Device485), das Hauptprogramm (Host) und den Ordner cfg, in dem sich die Konfigurationsdateien befinden: Einrichten einer UART-Verbindung und eine Liste der Geräte. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Die Fortsetzung wird sicherlich folgen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS Als Opfer der Migration aus Habr sind die Möglichkeiten begrenzt.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de381907/">https://habr.com/ru/post/de381907/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de381897/index.html">La furia roja. AMD Radeon Fury X Grafikkarte Bewertung</a></li>
<li><a href="../de381899/index.html">Vorlesungsnotizen mit Gadgets. Der Pfad zu Microsoft. Teil drei</a></li>
<li><a href="../de381901/index.html">Juli ITER Foto Update</a></li>
<li><a href="../de381903/index.html">So ähnlich und so unterschiedlich "Union" und "Apollo"</a></li>
<li><a href="../de381905/index.html">Neues Gerät für Neurochirurgen hilft bei der Navigation im menschlichen Körper mit Augmented Reality</a></li>
<li><a href="../de381909/index.html">Wie man aus einem alten Haus ein intelligentes Zuhause macht</a></li>
<li><a href="../de381911/index.html">Wie funktioniert die größte Schallplattenfabrik?</a></li>
<li><a href="../de381913/index.html">Befürworter von Verschwörungstheorien haben bereits eine gefälschte Expedition nach Pluto angekündigt</a></li>
<li><a href="../de381915/index.html">Wenn du Baidu zu deinem Unglück gerufen hast</a></li>
<li><a href="../de381917/index.html">Бодибилдинг для фрилансера</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>