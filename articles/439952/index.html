<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëãüèæ ü§≥üèæ ü¶ä Hosting Node.js https server con SSL actualizado autom√°ticamente en la nube y c√≥mo configuro el ciclo de desarrollo (+ git, reaccionar) üë¶üèª üåº ü•¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√≥logo 
 Para empezar, un d√≠a quer√≠a crear una aplicaci√≥n. Este deseo surgi√≥ porque me encanta leer, pero simplemente no hay agregadores de libros no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hosting Node.js https server con SSL actualizado autom√°ticamente en la nube y c√≥mo configuro el ciclo de desarrollo (+ git, reaccionar)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439952/"><h2>  Pr√≥logo </h2><br>  Para empezar, un d√≠a quer√≠a crear una aplicaci√≥n.  Este deseo surgi√≥ porque me encanta leer, pero simplemente no hay agregadores de libros normales en la vasta Internet rusa.  En realidad, debido al dolor de buscar algo para leer e intentar recordar el nombre del libro que le√≠ recientemente y en qu√© cap√≠tulo me detuve, naci√≥ el deseo de crear una aplicaci√≥n web en la que todo esto fuera posible y conveniente.  Vale la pena se√±alar que no hay experiencia en desarrollo, programaci√≥n, etc.  No ten√≠a, mi trabajo no est√° relacionado con esto en absoluto.  Sin embargo, el deseo venci√≥ la pereza y se convirti√≥ en acciones concretas, una especie de pasatiempo. <br><br>  No dir√© c√≥mo estudi√© javascript, node.js, react, html, css, etc., pasaremos a lo que he llegado en este momento, lo que me gustar√≠a compartir con ustedes y, por supuesto, escuchar las cr√≠ticas constructivas de los especialistas. <br><br>  Como muchos, me entren√© en mi propia PC en localhost: 3000, cre√© front / back-ends, escrib√≠, trabaj√© con api, etc., pero siempre me preocupaba la idea de c√≥mo transferir todo esto al alojamiento m√°s tarde.  ¬øFuncionar√°?  ¬øSer√° necesario reescribir el c√≥digo debido a esto?  <b>Y lo m√°s importante, ¬øes posible configurar todo para poder trabajar en la aplicaci√≥n desde cualquier PC y transferir f√°cilmente todo al hosting en producci√≥n?</b>  <b>Hablar√© de esto.</b> <br><a name="habracut"></a><br><h2>  Elecci√≥n de alojamiento </h2><br>  Para mi hobby, estaba listo para gastar $ 10 al mes, as√≠ que eleg√≠ el alojamiento con el que planeaba quedarme en el futuro.  Como dije, antes de eso ten√≠a 0 experiencia, incluso con alojamiento de sitios.  Intent√© y rechac√© lo siguiente: <br><br>  <b>Jelastic</b> : interfaz hermosa y f√°cil de usar, todo parece ser intuitivo, escalable y comprensible.  Sin embargo, encontr√© dificultades para configurar (nginx por alguna raz√≥n no quer√≠a trabajar desde vps, solo con su m√≥dulo separado) y conectar SSL (y actualizaci√≥n autom√°tica) al dominio de habla rusa por medios est√°ndar (prometieron corregir el error, pero no quiero esperar) <br><br>  <b>Cloud hosting REG.RU</b> : Tambi√©n tengo un dominio all√≠, as√≠ que la soluci√≥n parec√≠a l√≥gica, pero no ten√≠an PostgreSQL configurado por separado, y como no quer√≠a contactar a la administraci√≥n de la base de datos, comenc√© a buscar m√°s. <br><br>  <b>AWS y Google clouds</b> : lo intent√©, todo parece estar bien, pero record√© nuestras leyes "maravillosas" y el requisito de poner los datos de los usuarios en los servidores de la Federaci√≥n de Rusia.  Desafortunadamente, estos tipos no ten√≠an servidores en la Federaci√≥n Rusa.  No es un abogado, pero por el pecado decidi√≥ buscar nubes con servidores en la Federaci√≥n Rusa.  <b>Si es poco probable que su aplicaci√≥n tenga problemas con la ley, entonces es una buena opci√≥n.</b> <br><br>  Aunque hab√≠a nubes con servidores en la Federaci√≥n Rusa, todav√≠a quer√≠a algo que me salvara de tener que sumergirme en la administraci√≥n de PostgreSQL.  El impulso surgi√≥ hace poco, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Yandex</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Intent√© encontrar nubes</a> que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estaban</a> disponibles, parece que todo es simple y conveniente, as√≠ que me detuve en ellas por ahora.  Vale la pena se√±alar que el alojamiento PostgreSQL viene de inmediato con 1core y 4GB de RAM, lo que cuesta alrededor de 2k rublos al mes, por lo que para el tiempo de desarrollo y baja carga, planeo ejecutar PostgreSQL en VPS durante ~ 300r, y transferir la base de datos con una mayor carga y dejar Yandex se dedica a la administraci√≥n y actualizaci√≥n. <br><br><h2>  Configurando Yandex.Cloud </h2><br><h3>  Nube privada virtual </h3><br>  1) Cree un directorio para su sitio: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/35e/3de/581/35e3de5819d0344d34cc9a03251cbf65.png" alt="imagen"><br><br>  2) Crear una nube privada virtual: <br><br>  Lo principal que me da en la etapa actual es la IP para acceder al recurso creado desde el exterior.  Me familiaric√© con subredes, zonas, aislamiento y tolerancia a fallas superficialmente, si es necesario, me pondr√© al d√≠a. <br><br>  3) Cree una subred y as√≠gnele una IP interna (seg√∫n tengo entendido, se trata como una red local) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f25/42d/f6c/f2542df6c7141d6e96738f6f1d3e6cf1.png" alt="imagen"><br><br>  4) Vaya a la pesta√±a IP y reserve una IP est√°tica. <br><br>  En √©l nos conectaremos desde casa y otros lugares.  Probablemente pueda trabajar con din√°mica, pero no entend√≠ en qu√© casos cambia. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/47c/ef6/265/47cef626515785d83ba86cb6f5f8c185.png" alt="imagen"><br><br><h3>  Computar nube </h3><br>  Aqu√≠ tendremos c√°lculos :) Es decir, crearemos una m√°quina virtual con Linux (eleg√≠ ubuntu 18.04), instalaremos aplicaciones node.js y postgreSQL. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/265/293/e0c/265293e0c462dd9dd2452874799c2157.png" alt="imagen"><br><br>  Hacemos clic para crear una VM, desatornillamos todos los ajustes al m√≠nimo, ya que no habr√° carga durante el desarrollo (cuando se lance nuestra aplicaci√≥n, luego gire un poco m√°s, bueno, monitorearemos los gr√°ficos). <br><br><h4>  Ssh </h4><br>  El punto problem√°tico que encontr√© en esta etapa es SSH: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/687/476/389/68747638934544e751f6a0b21f43e683.png" alt="imagen"><br><br>  Qu√© era y por qu√© no ten√≠a idea, as√≠ que fui a estudiar.  Result√≥: este es solo un m√©todo de acceso, pero no por contrase√±a, sino por la clave SSH generada.  Para generarlo realmente, descargue e instale <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Putty</a> como se nos recomienda. <br><br>  Ejecute C: \ Archivos de programa \ PuTTY \ puttygen.exe <br><br><img src="https://habrastorage.org/getpro/habr/post_images/333/03a/e02/33303ae02d9b14983cf0627087dfd8ee.png" alt="imagen"><br><br>  Presionamos el bot√≥n Generar y movemos el mouse para aleatorizar la clave generada (seg√∫n tengo entendido).  Luego, copie la l√≠nea que aparece comenzando con ssh-rsa en alg√∫n lugar del archivo de texto y haga clic en Guardar clave privada, Guardar clave p√∫blica.  La clave copiada en el archivo de texto se inserta en el campo SSH de la clave de la p√°gina Yandex Yandex.  Especificamos root como root, de lo contrario no tendr√° acceso cuando trabaje con el sistema de archivos gr√°ficos de la aplicaci√≥n mediante el cual se conectar√° a la nube desde su hogar / trabajo (tal vez haya una forma, pero no lo entend√≠). <br>  <b>Como se√±al√≥ andreymal, es mejor no usar root para que los bots chinos no recojan la contrase√±a de su nube, pero como Yandex.cloud solo tiene acceso SSH, puede vivir as√≠.</b> <b><br><br></b>  <b>Una aplicaci√≥n en un hosting debe ser lanzada exclusivamente por un usuario no root, para no permitir que los atacantes ejecuten c√≥digo malicioso a trav√©s de posibles vulnerabilidades en su aplicaci√≥n.</b> <b><br></b> <br><br><h3>  Nos conectamos a la nube desde una PC y seleccionamos un cliente SSH gratuito </h3><br>  La masilla est√°ndar le permite trabajar solo en la l√≠nea de comandos, y como no estoy familiarizado con el usuario de Windows, comenc√© a buscar un cliente con un pseudo-explorador.  Al principio prob√© Mobaxterm, pero despu√©s de un tiempo de inactividad se apaga, el explorador se congela por completo, as√≠ que ahora estoy trabajando con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bitvise ssh</a> y hasta ahora no veo problemas como Mobaxterm. <br><br><h3>  Configurar bitvise ssh </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/8a2/019/f4c/8a2019f4cafa7b44ef72286664175010.png" alt="imagen"><br><br>  Aqu√≠, en el campo Servidor&gt; Host, indique nuestra nube IP externa.  Puerto 22. Haga clic en administrador de claves del cliente&gt; importar y especifique la clave privada generada previamente en √©l.  Es posible que a√∫n necesite una frase clave, elija algo que no olvidar√°.  Cierre esta ventana y especifique el nombre de usuario en el campo de autenticaci√≥n: ra√≠z, clave de m√©todo de publicaci√≥n, clave de cliente: seleccione la previamente importada.  Haga clic en iniciar sesi√≥n y si hicimos todo correctamente, luego con√©ctese a la nube: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b4b/e6a/a9d/b4be6aa9df15651829c0b23749f18b41.png" alt="imagen"><br><br><h2>  Instalar Node.js </h2><br>  Aqu√≠ recomiendo usar las instrucciones de digitalocean.com, son muy detalladas y muchas est√°n en ruso.  Por lo general, busco en Google "digitalocean ubuntu 18.04 node.js" o lo que sea que quiera instalar o configurar all√≠. <br><br>  C√≥mo instalar Node.js se puede leer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  En resumen, vamos a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nodeource</a> (aqu√≠ se pueden instalar las √∫ltimas versiones de node.js), hojee aqu√≠: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ad/aa7/0c9/3adaa70c90a1466c1a55b71eb25f2105.png" alt="imagen"><br><br>  Copie y ejecute los comandos a su vez: <br><br><pre><code class="javascript hljs">curl -sL https:<span class="hljs-comment"><span class="hljs-comment">//deb.nodesource.com/setup_11.x | sudo -E bash - sudo apt-get install -y nodejs</span></span></code> </pre> <br>  Verificamos c√≥mo fue establecido por el equipo <br><br><pre> <code class="javascript hljs">nodejs -v</code> </pre> <br>  Veremos la versi√≥n de node.js <br><br><pre> <code class="javascript hljs">npm -v</code> </pre> <br>  Se nos mostrar√° la versi√≥n del administrador de paquetes para node.js. <br><br>  A continuaci√≥n, vaya a la carpeta / opt / mysuperapp (my_super_app_name; debe crear esta carpeta).  El directorio opt se eligi√≥ como la ubicaci√≥n de la aplicaci√≥n despu√©s de buscar en Google "donde es apropiado poner los archivos node.js de la aplicaci√≥n en ubuntu". <br><br>  Finalmente, cree el archivo server.js, que ser√° el punto de entrada de la aplicaci√≥n, y pegue el c√≥digo simple del servidor en node.js all√≠: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hostname = <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> port = <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = http.createServer(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) =&gt;</span></span> { res.statusCode = <span class="hljs-number"><span class="hljs-number">200</span></span>; res.setHeader(<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>); res.end(<span class="hljs-string"><span class="hljs-string">'Hello World!\n'</span></span>); }); server.listen(port, hostname, () =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`Server running at http://</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${hostname}</span></span></span><span class="hljs-string">:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${port}</span></span></span><span class="hljs-string">/`</span></span>); });</code> </pre> <br>  El puerto 80 es para solicitudes http, 443 es para https.  Si bien tenemos un servidor en http. <br><br>  Guardamos todo y ejecutamos el comando: <br><br><pre> <code class="plaintext hljs">node server.js</code> </pre> <br>  La consola deber√≠a mostrar la l√≠nea 'Servidor que se ejecuta en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">localhost</a> : 80 /' <br><br>  Ahora puede abrir un navegador, ingresar una IP externa (la que est√° en la nube Yandex de su m√°quina virtual ubuntu) y veremos "¬°Hola Mundo!" <br><br><h2>  Hacemos todo convenientemente o el ciclo de desarrollo con git </h2><br>  Todo parece funcionar, pero no trabajaremos todo el tiempo conect√°ndonos a la nube.  Adem√°s, de repente no estaremos trabajando solos en el futuro. <br><br><h2>  Github </h2><br>  Github es el lugar donde se ubicar√° el c√≥digo de nuestra aplicaci√≥n.  En resumen, el principio de trabajo para una persona es el siguiente: <br><br><ul><li>  Estamos desarrollando nuestra aplicaci√≥n en una PC hogare√±a. </li><li>  Guardamos y descargamos el c√≥digo en Github con un solo clic. </li><li>  En el hosting o en otra PC, descargue nuestra aplicaci√≥n desde github, reinicie el servidor (si es el hosting) y la nueva versi√≥n de nuestra aplicaci√≥n web est√° disponible en la World Wide Web. </li></ul><br>  Todo es r√°pido, simple y conveniente. <br><br>  Realmente reg√≠strese en Github y cree un repositorio privado para nuestra aplicaci√≥n (estar√° disponible solo para nosotros): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a10/e93/4b3/a10e934b3516444c1c8aad1b45035494.png" alt="imagen"><br><br>  Copie la l√≠nea <a href="">github.com/ReTWi/mysuperapp.git</a> para descargar la aplicaci√≥n. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/465/959/824/4659598241a27171fbbaa8e61c3a66c2.png" alt="imagen"><br><br><ol><li>  Volvemos a la l√≠nea de comandos de bitvise, paramos la aplicaci√≥n presionando ctrl + c (si a√∫n funciona). </li><li>  Vaya al directorio / opt y elimine la carpeta con la aplicaci√≥n que creamos </li></ol><br>  Git es lo que usaremos para subir nuestra aplicaci√≥n a github, y desde all√≠ a un hosting u otra PC.  Git es un tema de discusi√≥n por separado, as√≠ que hablemos de esto por ahora. <br>  Instala <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">git en el hosting</a> con los siguientes comandos: <br><br><pre> <code class="javascript hljs">sudo apt update sudo apt install git</code> </pre> <br>  Compruebe si todo est√° bien establecido: <br><br><pre> <code class="javascript hljs">git --version</code> </pre> <br>  La versi√≥n de git deber√≠a aparecer. <br><br>  Completamos los datos de git (no entend√≠ por qu√©, pero aparentemente puede haber algunas advertencias aburridas). <br><br><pre> <code class="javascript hljs">git config --global user.name <span class="hljs-string"><span class="hljs-string">"Your Name"</span></span> git config --global user.email <span class="hljs-string"><span class="hljs-string">"youremail@domain.com"</span></span></code> </pre> <br>  Finalmente, cargamos nuestra aplicaci√≥n al hosting con el comando: <br>  (debe haber un enlace a su aplicaci√≥n) <br><br><pre> <code class="javascript hljs">git clone https:<span class="hljs-comment"><span class="hljs-comment">//github.com/ReTWi/mysuperapp.git</span></span></code> </pre> <br>  Aparecer√° un nuevo mysuperapp en el directorio / opt, donde se ubicar√°n nuestros archivos de aplicaci√≥n descargados de github. <br><br>  Ahora es el momento de repetir lo mismo para PC y cerrar la cadena de PC (diferente) -&gt; Github -&gt; Hosting <br><br>  Instale <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">node.js en la PC</a> . <br><br><h2>  C√≥digo de estudio visual </h2><br>  Para comenzar, seleccione el editor de c√≥digo fuente donde trabajaremos.  Eleg√≠ el c√≥digo de Visual Studio, por lo que es simple, conveniente, tiene muchos complementos y puedes configurar la sincronizaci√≥n de configuraciones si trabajas con m√∫ltiples dispositivos.  En realidad, descargamos, instalamos, iniciamos, seleccionamos la carpeta de la aplicaci√≥n compartida, ya que git clone crear√° la suya para nosotros. <br><br>  Los complementos que uso son los siguientes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7e5/5c2/17f/7e55c217f685490573a70f44970e0780.png" alt="imagen"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Instala git para PC</a> . <br>  Abra una consola en VScode usando ctrl + shift + `o terminal&gt; nueva terminal <br><br>  <i>Retiro</i> <i><br><br></i>  <i>En la consola de Windows, es malo con los caracteres rusos, por lo que no hay grietas que necesita para abrir el archivo&gt; preferencias&gt; configuraci√≥n, ingrese terminal.integrated.shellArgs.windows en el campo, haga clic</i> <i><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a70/787/6a5/a707876a56e4c0a2b601358d4aa7caf1.png" alt="imagen"><br><br></i>  <i>Y agregue la l√≠nea "terminal.integrated.shellArgs.windows": ["-NoExit", "/ c", "chcp 65001"],</i> <i><br><br><img src="https://habrastorage.org/getpro/habr/post_images/57d/217/da6/57d217da62d4189b8640eb854f07a8a0.png" alt="imagen"></i> <br><br>  Repita el comando para descargar archivos de github: <br><br><pre> <code class="javascript hljs">git clone https:<span class="hljs-comment"><span class="hljs-comment">//github.com/ReTWi/mysuperapp.git</span></span></code> </pre> <br>  En VScode, haga clic en Archivo&gt; Abrir carpeta y abra la carpeta de nuestra aplicaci√≥n. <br><br>  Cree el archivo server.js con el mismo c√≥digo de servidor simple: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hostname = <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> port = <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = http.createServer(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) =&gt;</span></span> { res.statusCode = <span class="hljs-number"><span class="hljs-number">200</span></span>; res.setHeader(<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>); res.end(<span class="hljs-string"><span class="hljs-string">'Hello World!\n'</span></span>); }); server.listen(port, hostname, () =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`Server running at http://</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${hostname}</span></span></span><span class="hljs-string">:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${port}</span></span></span><span class="hljs-string">/`</span></span>); });</code> </pre> <br>  Instale nodemon para reiniciar autom√°ticamente el servidor cuando se realicen cambios en el c√≥digo: <br><br><pre> <code class="javascript hljs">npm i nodemon -g</code> </pre> <br>  i - abreviatura de instalaci√≥n <br>  g: instalaci√≥n global (que estar√° disponible en la consola), y no solo para nuestra aplicaci√≥n. <br><br>  Ejecute el comando: <br><br><pre> <code class="javascript hljs">nodemon server.js</code> </pre> <br>  Abra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">localhost</a> : 80 / en el navegador o simplemente localhost: 80 y vea Hello World. <br><br>  Ahora es el momento de revisar nuestra cadena de PC&gt; Github&gt; Hosting. <br><br>  Descargue el escritorio de Github para mayor conveniencia, conecte su cuenta de github, luego haga clic en el archivo Agregar repositorio local y especifique el directorio de nuestra aplicaci√≥n. <br><br>  En la aplicaci√≥n, vemos los cambios que hicimos en comparaci√≥n con la versi√≥n descargada de Github (agregamos server.js): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/568/3d0/52b/5683d052b9fbba8fe609035fd8ba253f.png" alt="imagen"><br><br>  Haga clic en "commit to master"&gt; "push origin", descargando as√≠ los archivos de la PC a Github. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eeb/234/bf6/eeb234bf61a0ed5b2708b196e32da7d8.png" alt="imagen"><br><br>  Vamos a nuestra cuenta de github en el navegador y vemos el archivo server.js descargado: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e6/cf8/e1b/1e6cf8e1b08c5a15d596193dd8b0efb3.png" alt="imagen"><br><br>  Practiquemos un poco m√°s, en VScode reemplazamos la l√≠nea "res.end ('Hello World! \ N');"  a "res.end ('OmNomNom');".  Veremos que el servidor se reinicia: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c8/8cc/a53/8c88cca53e4d8d15632cc49e183817e7.png" alt="imagen"><br><br>  Comprobaremos en el navegador y veremos los cambios realizados por nosotros "OmNomNom" all√≠. <br><br>  Desktop github tambi√©n nos mostrar√° que cambiamos la l√≠nea: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/020/39b/7a0/02039b7a00fabe3c07037f6a356c1919.png" alt="imagen"><br><br>  Nuevamente, haga clic en comprometerse con master&gt; push origin para enviar archivos a github. <br><br>  Cambie a la l√≠nea de comando de hosting. <br><br>  Paramos nuestra aplicaci√≥n si a√∫n se est√° ejecutando (ctrl + c). <br><br>  Descargue nuestra aplicaci√≥n actualizada con los siguientes comandos: <br><br><pre> <code class="javascript hljs">git config credential.helper store git pull</code> </pre><br>  El primero guardar√° nuestros datos para que no tenga que ingresar su nombre de usuario y contrase√±a constantemente.  En el futuro, git pull ser√° suficiente para nosotros. <br><br>  Instale pm2, algo similar a nodemon, solo para hosting: <br><br><pre> <code class="javascript hljs">npm i pm2 -g</code> </pre> <br>  Comencemos la aplicaci√≥n usando pm2, que reiniciar√° nuestro servidor en el siguiente git pull en el hosting: <br><br><pre> <code class="javascript hljs">pm2 start server.js --watch</code> </pre> <br>  Abra el navegador en nuestra nube IP externa y vea nuestro "OmNomNom". <br><br>  Por lo tanto, cerramos la cadena de trabajo con la aplicaci√≥n y su r√°pida implementaci√≥n en el alojamiento. <br><br><h2>  Creamos certificados SSL temporales para HTTPS en localhost y hosting </h2><br>  Vamos al sitio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">zerossl.com</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/151/be3/00c/151be300c4226e87b30b7f4735e09c83.png" alt="imagen"><br><br>  En el campo dominios, ip ..., primero ingrese localhost, haga clic en generar y descargue 2 archivos por bot√≥n: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8a1/b4d/24a/8a1b4d24a65f44c3ba5a604a569e1811.png" alt="imagen"><br><br>  Los guardamos en nuestro proyecto en la carpeta ssl / localhost. <br><br>  Repita el procedimiento para la nube IP externa y gu√°rdela en ssl / myapp. <br><br><h2>  Inicie un servidor https m√°s complejo node.js </h2><br>  Estructura de la aplicaci√≥n: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/330/6da/e58/3306dae5836d651136b030b2cc64041e.png" alt="imagen"><br><br><ul><li>  cliente: aqu√≠ estar√° nuestro front-end.  He reaccionado </li><li>  registros: los registros de alojamiento se colocar√°n aqu√≠ </li><li>  node_modules - m√≥dulos node.js </li><li>  privado: sus archivos privados, guardo el acceso SSH a la nube all√≠ </li><li>  el servidor es tu backend </li><li>  ssl - certificados ssl para trabajar https en localhost y hosting </li><li>  .babelrc: configuraci√≥n de compilaci√≥n de reacci√≥n de la aplicaci√≥n webpack'om (le permite utilizar JS m√°s modernos al desarrollar frontend) </li><li>  .gitignore: archivos que no se mover√°n a github (git no parece verlos) </li><li>  client.js: punto de entrada para generar el ensamblaje de reacci√≥n </li><li>  package.json: los node_modeles que est√° utilizando y varios fragmentos de comandos. </li><li>  package-lock.json: cambios en los m√≥dulos (seg√∫n tengo entendido, el archivo verificar√° si los mismos m√≥dulos est√°n instalados en su hosting y en su PC). </li><li>  pm2-watch.json: configuraci√≥n de inicio de pm2 para hosting </li><li>  README.md - cubierta para github </li><li>  server.js: el punto de partida de nuestro servidor backend Node.js </li><li>  webpack.config.js - reaccionar configuraci√≥n de compilaci√≥n </li></ul><br><h3>  .gitignore </h3><br>  Aqu√≠ indicamos aquellos archivos / carpetas que no queremos subir a github.  Solo estar√°n en este dispositivo y git no rastrear√° / mostrar√° sus cambios.  Abrir e insertar: <br><br><pre> <code class="javascript hljs">/node_modules/ <span class="hljs-regexp"><span class="hljs-regexp">/logs/</span></span>* # exception to the rule !logs/.gitkeep /public/react_bundle.js /public/isProd.js</code> </pre> <br>  Como github no descarga carpetas vac√≠as, puede poner algo dentro, por ejemplo, un archivo .gitkeep vac√≠o.  Guarde el archivo y cierre. <br><br><h3>  package.json </h3><br>  Abra y pegue lo siguiente (despu√©s de // comentarios agregados) <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"myapp"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//    "version": "1.0.0", "description": "OmNomNom", "main": "server.js", "scripts": { "server": "pm2 start pm2-watch.json", //  npm run server     "client": "webpack -w --mode development", //  npm client    .        ,   . "client-prod": "webpack --mode production", //     production "client-analyze": "webpack --mode production --analyze true" //     production       .    }, "repository": { "type": "git", "url": "git+https://github.com/myapp/knigam.git" //     github }, "author": "rtw", "license": "UNLICENSED", //     ( ) "bugs": { "url": https://github.com/myapp/knigam.git" }, "homepage": "https://github.com/myapp/knigam.git#readme", "dependencies": { "@babel/core": "^7.2.2", //  js  frontend "@babel/plugin-transform-runtime": "^7.2.0", //  js  frontend "@babel/preset-env": "^7.3.1", //  js  frontend "@babel/preset-react": "^7.0.0", //  js  frontend "ajv": "^6.8.1", //    "babel-loader": "^8.0.5", //  js  frontend "babel-plugin-styled-components": "^1.10.0", //   styled-components "css-loader": "^2.1.0", //   webpack'om css "fastify": "^2.0.0-rc.6", //  express,      "fastify-cookie": "^2.1.6", //    "fastify-static": "^2.2.0", //     "moment": "^2.24.0", //    "pg": "^7.8.0", //    "pino": "^5.11.1", //   postgreSQL  node.js "pino-pretty": "^2.5.0", //     "react": "^16.8.1", // Frontend .      Vue.js,    .      ,     "react-dom": "^16.8.1", // React     "style-loader": "^0.23.1", //   webpack'om ,    "styled-components": "^4.1.3", // CSS in JS,           "webpack": "^4.29.3", //    "webpack-bundle-analyzer": "^3.0.3", //       "webpack-cli": "^3.2.3" //    ,     } }</span></span></code> </pre><br>  Me centrar√© en dos marcos / bibliotecas principales seleccionados para la aplicaci√≥n: <br>  Fastify fue elegido como una alternativa a express.js, ya que el primero ya tiene soporte experimental para htpp2, se est√° desarrollando activamente y me parece que tiene m√°s futuro que express.js, que se ha vuelto muy lento y de alguna manera en desarrollo.  Por otro lado, express.js ha estado trabajando durante mucho tiempo y le ser√° m√°s f√°cil encontrar informaci√≥n sobre √©l. <br><br>  Se eligi√≥ React porque era m√°s f√°cil para m√≠ trabajar con √©l, comprenderlo y probarlo todo con mis propias manos.  Vue: parec√≠a algo con sus propias reglas, direcci√≥n.  Aunque en Vue puede ser necesario escribir algo menos con sus propias manos, pero dado que se da prioridad al entrenamiento y para una persona que no ha programado previamente, la reacci√≥n fue de alguna manera m√°s f√°cil. <br><br>  Guardamos el archivo package.json e instalamos todos los m√≥dulos especificados en dependencias con el comando: <br><br><pre> <code class="javascript hljs">npm i</code> </pre> <br>  Tendremos una carpeta node_modules, en la que habr√° todos los m√≥dulos para nuestra aplicaci√≥n. <br><br>  cliente - mientras que la carpeta vac√≠a <br>  registros: dentro del archivo .gitkeep se encuentra, de modo que la carpeta migra al alojamiento y los registros caen con √©xito all√≠.  Durante el desarrollo, enviaremos todo a la consola. <br><br><h3>  publico </h3><br>  Aqu√≠ estar√°n los archivos est√°ticos de nuestro sitio, im√°genes all√≠, favicons, etc. <br>  Deteng√°monos en dos archivos: <br>  index.html: <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;base href="/" /&gt; &lt;meta charset="UTF-8" /&gt; &lt;title&gt;MyApp&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div id="cookies"&gt;    react_bundle   &lt;/div&gt; &lt;noscript &gt;:       Javscript&lt;/noscript &gt; &lt;script src="react_bundle.js"&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre> <br>  - aqu√≠ tenemos un front-end de reacci√≥n cargado y procesado en una etiqueta por su id. <br><br>  isProd.js contiene una sola l√≠nea "module.exports = false" <br>  Como est√° en excepciones .gitignore, no es port√°til.  En consecuencia, lo configuramos como falso en la PC y verdadero en el alojamiento.  Luego usamos este archivo para comprender en qu√© entorno estamos actualmente (desarrollo / producci√≥n).  Me pareci√≥ lo m√°s conveniente, adem√°s, puede cambiar parcialmente el c√≥digo durante el desarrollo y verificar el funcionamiento de los m√≥dulos en producci√≥n. <br><br>  ssl: hay certificados previamente guardados en las carpetas localhost y myapp <br><br><h3>  .babelrc </h3><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"presets"</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"@babel/preset-env"</span></span>, { <span class="hljs-string"><span class="hljs-string">"targets"</span></span>: { <span class="hljs-string"><span class="hljs-string">"browsers"</span></span>: [<span class="hljs-string"><span class="hljs-string">"&gt;0.25%"</span></span>, <span class="hljs-string"><span class="hljs-string">"not ie 11"</span></span>, <span class="hljs-string"><span class="hljs-string">"not op_mini all"</span></span>] } } ], <span class="hljs-string"><span class="hljs-string">"@babel/preset-react"</span></span> ], <span class="hljs-string"><span class="hljs-string">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"babel-plugin-styled-components"</span></span>, <span class="hljs-string"><span class="hljs-string">"@babel/plugin-transform-runtime"</span></span> ] }</code> </pre><br>  Configuraci√≥n para crear nuestro react_bundle con soporte de navegador utilizado por m√°s del 0.25% de los usuarios. <br><br><h3>  client.js </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { render } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span> render(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">!!</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'cookies'</span></span>))</code> </pre> <br><br>  Representa nuestra interfaz en un div con una etiqueta de cookie. <br><br>  pm2-watch.json: le permite ejecutar el servidor con el comando "npm run server" en el hosting con seguimiento de cambios en el c√≥digo y reinicio autom√°tico. <br><br><h3>  webpack.config.js </h3><br>  Generador de aplicaciones de reactores: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webpack = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack'</span></span>), path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>), BundleAnalyzerPlugin = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack-bundle-analyzer'</span></span>).BundleAnalyzerPlugin <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">env, argv</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> prod = argv.mode == <span class="hljs-string"><span class="hljs-string">'production'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> config = { <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: <span class="hljs-string"><span class="hljs-string">'./client.js'</span></span>, <span class="hljs-attr"><span class="hljs-attr">output</span></span>: { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: path.resolve(<span class="hljs-string"><span class="hljs-string">'./public'</span></span>), <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">'react_bundle.js'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.(js|jsx)$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">exclude</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/node_modules/</span></span>, <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'babel-loader'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [<span class="hljs-string"><span class="hljs-string">'style-loader'</span></span>, <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>] } ] }, <span class="hljs-attr"><span class="hljs-attr">resolve</span></span>: { <span class="hljs-attr"><span class="hljs-attr">alias</span></span>: { <span class="hljs-attr"><span class="hljs-attr">client</span></span>: path.resolve(<span class="hljs-string"><span class="hljs-string">'./client/shared'</span></span>), <span class="hljs-attr"><span class="hljs-attr">public</span></span>: path.resolve(<span class="hljs-string"><span class="hljs-string">'./public'</span></span>) } }, <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ argv.analyze ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BundleAnalyzerPlugin() : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, prod ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> webpack.optimize.AggressiveMergingPlugin() : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> webpack.ContextReplacementPlugin(<span class="hljs-regexp"><span class="hljs-regexp">/moment[\/\\]locale$/</span></span>, /ru/) ].filter(<span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>), <span class="hljs-attr"><span class="hljs-attr">optimization</span></span>: { <span class="hljs-attr"><span class="hljs-attr">minimize</span></span>: prod ? <span class="hljs-literal"><span class="hljs-literal">true</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">performance</span></span>: { <span class="hljs-attr"><span class="hljs-attr">hints</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> config }</code> </pre><br>  En resumen, abre el archivo client.js y todo lo que est√° dentro de √©l, recolecta react_bundle y lo coloca en la carpeta p√∫blica, desde donde se cargar√° a trav√©s del index.html abierto. <br><br><h3>  server.js </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isProd = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./public/isProd'</span></span>), fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), log = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./server/logger'</span></span>), path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   node.js,      process.on('unhandledRejection', (reason, promise) =&gt; { log.error({ reason, promise }, '  unhandledRejection') }) process.on('uncaughtException', err =&gt; { log.error({ err }, '  uncaughtException') }) // Redirect server from http port 80 to https 443 const fastifyHttp = require('fastify')({ logger: log, ignoreTrailingSlash: true }) fastifyHttp.listen(80, '::', (err, address) =&gt; { if (err) { log.error({ err, address }, '   HTTP ') } else { log.warn('Http c ') } }) // Let's Encrypt challenge fastifyHttp.get('/.well-known/acme-challenge/:file', (req, res) =&gt; { let stream = fs.createReadStream( path.join(__dirname + '/ssl/.well-known/acme-challenge/' + req.params.file) ) res.type('text/html').send(stream) }) fastifyHttp.get('/*', (req, res) =&gt; { res.redirect(301, 'https://' + req.headers.host + req.raw.url) }) fastifyHttp.get('/', (req, res) =&gt; { res.redirect(301, 'https://' + req.headers.host + req.raw.url) }) //  let fastifyOptions = { logger: log, ignoreTrailingSlash: true, http2: true } fastifyOptions.https = isProd ? { allowHTTP1: true, key: fs.readFileSync('./ssl/myapp/key.txt'), cert: fs.readFileSync('./ssl/myapp/crt.txt') } : { allowHTTP1: true, key: fs.readFileSync('./ssl/localhost/cert.key'), cert: fs.readFileSync('./ssl/localhost/cert.pem') } const fastify = require('fastify')(fastifyOptions) fastify.listen(443, '::', (err, address) =&gt; { if (err) { log.error({ err, address }, '   ') } else { log.warn( `   ${ isProd ? '' : ' ' }` ) } }) //  fastify.setSchemaCompiler(schema =&gt; { return ajv.compile(schema) }) //  fastify fastify.setErrorHandler((err, req, res) =&gt; { log.error({ err, req }, 'fastify errorHandler') //     if (err.validation) { return res.send({ error: '   ' }) } else { return res.send({ error: ' errorHandler' }) } }) //   fastify.register(require('fastify-static'), { root: path.join(__dirname, './public') }) //  fastify.register(require('fastify-cookie'), err =&gt; { if (err) log.error({ err }, 'fastify-cookie') }) //       /   //       index.html,     //        api,   GET /api/userdata fastify.setNotFoundHandler((req, res) =&gt; { res.sendFile('index.html') }) // Routes fastify.register( async openRoutes =&gt; { //    openRoutes.register(require('./server/api/open')) openRoutes.register(async withSession =&gt; { //         //    , : ///withSession.addHook('preHandler', async (req, res) =&gt; { // if (!(await sessionManagerIsOk(req, res))) return // }) withSession.register(require('./server/api/with_session')) }) }, { prefix: '/api' } //    )</span></span></code> </pre><br><h3>  Carpeta del servidor </h3><br>  Aqu√≠ yace el backend y todos los caminos. <br>  logger.js: seg√∫n el entorno, isProd se registra en la consola o en errors.log <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pino = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'pino'</span></span>), isProd = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../public/isProd'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> logOptions = isProd ? { <span class="hljs-attr"><span class="hljs-attr">level</span></span>: <span class="hljs-string"><span class="hljs-string">'warn'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   timestamp: () =&gt; { return ',"time":"' + new Date() + '"' } } : { level: 'warn', prettifier: require('pino-pretty'), prettyPrint: { levelFirst: true, translateTime: true } } let dest = isProd ? pino.destination('./logs/errors.log') : pino.destination(1) let log = pino(logOptions, dest) module.exports = log</span></span></code> </pre><br>  servidor / api / <br>  open.js: agrega nuestros caminos aqu√≠. <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fastify, options, next</span></span></span><span class="hljs-function">) </span></span>{ fastify.route({ <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">handler</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (req, res) =&gt; { res.send(<span class="hljs-string"><span class="hljs-string">'api / route'</span></span>) } }) fastify.route({ <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/hi'</span></span>, <span class="hljs-attr"><span class="hljs-attr">handler</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (req, res) =&gt; { res.send(<span class="hljs-string"><span class="hljs-string">'api / route hi'</span></span>) } }) next() }</code> </pre> <br>  Despu√©s de configurar y verificar todo en Localhost, simplemente cargamos todo a github, y desde all√≠ git pull al alojamiento.  Todo lo que debe hacerse en el alojamiento es instalar los m√≥dulos node.js con el comando "npm i" y crear el archivo isProd.js <br><br><h2>  SSL actualizado autom√°ticamente </h2><br>  Cuando compra un dominio y lo vincula a la nube de IP, un ejemplo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">instrucciones para REG.RU</a> , puede instalar en el servidor SSL gratuito actualizado autom√°ticamente para que el sitio funcione a trav√©s de https. <br><br>  Nuestro servidor funciona sin nginx.  Es posible que lo necesitemos en el futuro como un equilibrador de carga o un servidor HTTP m√°s r√°pido para distribuir archivos est√°ticos, pero hasta ahora no veo la necesidad de hacerlo.  Todav√≠a no necesitamos equilibrio de carga, pero no he encontrado comparaciones con respecto a la velocidad de distribuci√≥n de las estad√≠sticas. <br><br>  Antes de instalar en la carpeta ssl, cree la carpeta .well-known, y acme-challenge.  Resulta /opt/myapp/ssl/.well-known/acme-challenge <br><br>  Para instalar SSL actualizado autom√°ticamente en un servidor con node.js sin nginx <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">, haga clic en el enlace</a> .  A su vez, ejecute los comandos en la consola de hosting: <br><br><pre> <code class="javascript hljs">sudo apt-get update sudo apt-get install software-properties-common sudo add-apt-repository universe sudo add-apt-repository ppa:certbot/certbot sudo apt-get update sudo apt-get install certbot sudo certbot certonly</code> </pre><br>  Seleccionamos el segundo m√©todo de verificaci√≥n, que colocar√° un archivo espec√≠fico en la carpeta /opt/myapp/ssl/.well-known/acme-challenge, y despu√©s de confirmar el propietario del servidor, se eliminar√°. <br><br>  Indicamos nuestro dominio a pedido, por ejemplo: "example.com" y la ruta a la carpeta ssl de nuestra aplicaci√≥n (el servidor est√° configurado para que proporcione el archivo creado por el bot) "/ opt / myapp / ssl". <br><br>  El bot configurar√° la tarea cron para renovar el certificado antes de su vencimiento dentro de los 90 d√≠as. <br><br>  No pens√© que tomar√≠a tanto tiempo escribirlo todo, a las 4 de la ma√±ana ya pod√≠a perder algo: <br><br>  Interesante es la opini√≥n de los habitantes de Habrach y especialistas que dominaron este lienzo o leyeron algunos puntos individuales.  ¬øC√≥mo se organiza su ciclo de desarrollo?  ¬øHay alg√∫n punto en el que me equivoque o haga algo incorrecto? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/439952/">https://habr.com/ru/post/439952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../439942/index.html">Docker: lo que todo desarrollador de .Net necesita saber</a></li>
<li><a href="../439944/index.html">SAPUI5 para dummies parte 5: un ejercicio completo paso a paso</a></li>
<li><a href="../439946/index.html">¬øPor qu√© elegimos Electron?</a></li>
<li><a href="../439948/index.html">Intel SVT-AV1: Codificador de c√≥digo abierto AV1 para servicio pesado</a></li>
<li><a href="../439950/index.html">Tercera prueba de Turing: condiciones de participaci√≥n y premios para los ganadores.</a></li>
<li><a href="../439958/index.html">CodeFest X del 30 al 31 de marzo. Secci√≥n futura</a></li>
<li><a href="../439962/index.html">Trabajamos con Atlassian Service Desk, aprovechamos al m√°ximo el complemento Riada Insight: un informe de la reuni√≥n del Grupo de usuarios de Atlassian</a></li>
<li><a href="../439964/index.html">Vulnerabilidad de Runc CVE-2019-5736 en un host</a></li>
<li><a href="../439966/index.html">Analizador simple para operaciones aritm√©ticas</a></li>
<li><a href="../439968/index.html">Espacio de Generaci√≥n y Espacio de Oportunidad</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>