<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöò üë∞üèΩ üë©üèø‚Äçüî¨ Nginx-Variablen mit njs: einfach, schmerzlos und √ºber JavaScript üç≠ üîò üï¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="njs ist ein JavaScript-Interpreter in einem kompakten Webserver, mit dem Sie neue Nginx-Variablen erstellen und Stage-Handler anfordern k√∂nnen. Wof√ºr ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nginx-Variablen mit njs: einfach, schmerzlos und √ºber JavaScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/420465/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">njs</a> ist ein JavaScript-Interpreter in einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kompakten</a> Webserver, mit dem Sie neue Nginx-Variablen erstellen und Stage-Handler anfordern k√∂nnen.  Wof√ºr ist njs gut?  Was kann nicht?  Und warum haben sie das √ºberhaupt gemacht?  Diese und andere Fragen werden von Dmitry Volyntsev ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">xeioex</a> ), dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Nginx-</a> Entwickler und Hauptentwickler des njs-Interpreters, beantwortet. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e34/80a/672/e3480a6727d8a79621d2888997cb2d28.jpg"><br><br><h3>  - Dmitry, warum brauchten Sie Skripte in Nginx-Konfigurationen? </h3><br>  - Der erste Grund ist die <code>if</code> Richtlinie.  Leute, die sie zum ersten Mal gesehen haben, denken, dass sie unbedingt verwendet werden k√∂nnen.  Eigentlich ist das nicht so - die Nginx-Konfiguration ist deklarativ.  Im folgenden Beispiel k√∂nnte man denken, dass die Antwort zwei √úberschriften hat: X-First und X-Second.  Aber nur der zweite Header wird in die Antwort aufgenommen, weil nginx so angeordnet ist: Wenn wir zwei if-Direktiven schreiben, wird der letzte ausgew√§hlt. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /only-one-if { <span class="hljs-attribute"><span class="hljs-attribute">set</span></span> <span class="hljs-variable"><span class="hljs-variable">$true</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$true</span></span>) { <span class="hljs-attribute"><span class="hljs-attribute">add_header</span></span> X-First <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-attribute"><span class="hljs-attribute">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$true</span></span>) { <span class="hljs-attribute"><span class="hljs-attribute">add_header</span></span> X-Second <span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <a name="habracut"></a><br>  Der zweite Grund ist, wozu Nginx jetzt gekommen ist.  Zuvor wurde es zum Zwischenspeichern von Statiken und Anforderungen sowie zum Lastenausgleich verwendet - ein klassischer Proxy-Satz.  Die Verbreitung von Mikrodiensten hat den Anwendungsbereich von Nginx untergraben.  Wenn fr√ºhere Konfigurationseinstellungen in einigen Sprachen mit einem Speicherortpaar auf mehreren Backends endeten, haben wir mit der Microservice-Architektur mehr bewegliche Teile.  Das Backend ist zu einer Reihe kleiner Komponenten geworden.  Die Autorisierungslogik muss beispielsweise bei jedem Microservice dupliziert oder beispielsweise im Frontend entfernt werden.  Um eine erweiterte Autorisierung zu implementieren, sind in nginx nicht immer gen√ºgend L√∂sungsmechanismen integriert. <br><br>  Drittens akzeptieren in Nginx viele Direktiven dynamisch berechnete Ausdr√ºcke, zum Beispiel: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">proxy</span></span> cache bypass <span class="hljs-variable"><span class="hljs-variable">$cookie_nocache</span></span> <span class="hljs-variable"><span class="hljs-variable">$arg_nocache</span></span>;</code> </pre> <br>  Sie k√∂nnen Variablen miteinander oder mit Literalzeichenfolgen verketten.  Dies reicht jedoch nicht aus, und ich h√§tte gerne leistungsf√§higere Tools, um beispielsweise den Hash zu berechnen, mit numerischen Daten zu arbeiten und in Gro√ü- und Kleinschreibung umzuwandeln. <br><br>  Um alle Engp√§sse in Nginx zu erweitern, m√ºssen Sie entweder Ihre eigene Syntax entwickeln oder etwas Fertiges verwenden.  Wir sind zu dem Schluss gekommen, dass es am besten ist, eine vorhandene Skript-Programmiersprache zu verwenden.  Entwickler m√ºssen daher keine neue Sprache lernen, was auch Zeit spart und die Einstiegsschwelle senkt.  Wir haben JavaScript gew√§hlt. <br><br><h3>  - Und warum JavaScript? </h3><br>  - Wir haben uns aus mehreren Gr√ºnden f√ºr JavaScript entschieden: <br><br><ul><li>  Ein moderner Dialekt, der sich gut f√ºr Entwickler eignet, die von anderen Sprachen wechseln. <br></li><li>  C-√§hnlicher Stil.  Dies ist wichtig, da die nginx-Konfiguration geschweifte Klammern verwendet. In Zukunft m√∂chten wir die M√∂glichkeit hinzuf√ºgen, JS-Code direkt in die Konfiguration zu schreiben.  Zahnspangen helfen uns dabei.  In Lua zum Beispiel wird die Rolle der geschweiften Klammern von Anfang bis Ende ausgef√ºhrt - dies ist unpraktisch. <br></li><li>  Das JavaScript-Modell passt gut zur Nginx-Architektur. <br></li></ul><br><h3>  "Also wurde Lua auch in Betracht gezogen?"  Liegt es am Anfang und am Ende? </h3><br>  - Es gibt bereits ein fertiges Drittanbieterprojekt OpenResty.  Wenn Sie nicht auf Details eingehen, handelt es sich im Wesentlichen um Nginx + Lua, aber es hat eine Architektur, die Nginx zuwiderl√§uft.  Wir wollten √úberschneidungen mit diesem √ñkosystem vermeiden.  Dar√ºber hinaus gibt es mehrere weitere Gr√ºnde: <br><br><ul><li>  Lua hat eine pascalartige Syntax. <br></li><li>  Arrays werden von 1 indiziert. <br></li><li>  Lua ist immer noch eine Nischenprogrammiersprache. <br></li></ul><br><h3>  - Wie ist njs im Vergleich zu Wettbewerbern? </h3><br>  - Wir haben njs im Vergleich zu den bekannten Motoren V8 und SpiderMonkey bewertet.  Sie sind f√ºr Aufgaben in Nginx unwirksam, da sie von Browsern gesch√§rft werden und sehr schwer sind und Nginx eine hohe Geschwindigkeit erfordert.  Dar√ºber hinaus entwickeln sich beide Engines schnell weiter, ihre API ist instabil.  Schlie√ülich k√∂nnen njs effizienter in nginx integriert werden: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/196/af8/62e/196af862e5247dbd85029b36f2cffb0c.png"><br>  <i>Die Anzahl der pro Sekunde erstellten Kontexte</i> <br><br><h3>  - Welche Standards unterst√ºtzt njs? </h3><br>  - Im Moment sind fast alle Grundelemente der ECMAScript 5.1-Spezifikation implementiert, wobei die Elemente der Spezifikationen 6 und 7 eingestreut sind. Dies sind Standardobjekte wie Object, Array, String, Number, Date, RegExp, JSON.  Schlie√üungen, anonyme Funktionen und Arbeiten mit Ausnahmen werden vollst√§ndig unterst√ºtzt. <br><br>  Wir setzen uns nicht als prim√§res Ziel die vollst√§ndige Einhaltung der Sprachspezifikation.  Daher gibt es derzeit keine Unterst√ºtzung f√ºr <i>eval ()</i> , und wir planen bisher nicht, es hinzuzuf√ºgen.  Wir planen jedoch, die Unterst√ºtzung f√ºr const hinzuzuf√ºgen und Schl√ºsselw√∂rter sowie Pfeilfunktionen zuzulassen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d9/5ec/ff9/6d95ecff9b1f8b55d8eaffd910d8bb9b.png"><br>  <i>Was ist in der Lage und was ist im Moment nicht in der Lage zu njs</i> <br><br>  Es ist wichtig, noch eines zu erw√§hnen: das Fehlen einer M√ºllabfuhr.  Die meisten modernen Sprachen √ºberwachen unabh√§ngig die Lebensdauer von Objekten.  Wenn das Objekt nicht mehr verwendet wird, wird es automatisch gel√∂scht.  Sie k√∂nnen nicht auf diesen Mechanismus verzichten, aber normalerweise m√ºssen Sie etwas daf√ºr opfern - die Arbeit des Programms verlangsamt sich oder stoppt sogar.  In njs wird der Speicher erst freigegeben, wenn das Anforderungsobjekt freigegeben wurde. <br><br>  Dieser Ansatz hat Vor- und Nachteile.  Der Hauptnachteil besteht darin, dass Sie nicht effektiv mit langen Abfragen arbeiten k√∂nnen.  Daher planen wir in Zukunft, die Speicherbereinigung als Option hinzuzuf√ºgen, um sie bei Bedarf zu aktivieren. <br><br><h3>  - Was ist njs nicht? </h3><br>  - Bevor ich diese Frage beantworte, m√∂chte ich noch einmal wiederholen, dass die Hauptaufgabe von njs darin besteht, die Funktionen f√ºr die flexible Konfiguration von nginx und die L√∂sung von Aufgaben auf der Proxy-Seite zu erweitern. <br><br>  Nun die Frage selbst.  Was ist im Voraus zu beachten? <br><ul><li>  njs ist kein Ersatz f√ºr Node.js. <br></li><li>  Das nginx + njs-Bundle ist kein Anwendungsserver. <br></li><li>  njs implementiert ECMAScript-Standards nicht vollst√§ndig, da eval () nicht unterst√ºtzt wird. <br></li></ul><br><hr><br>  Wenn dieses Thema f√ºr Sie √§u√üerst relevant ist und Sie sich nach weiteren Details sehnen, empfehlen wir Ihnen, sich die Videoaufzeichnung des Berichts von Dmitry Volintsev bei HighLoad ++ Siberia 2018 anzusehen, wo er ihn von allen Seiten enth√ºllte. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zq9IDngR5pk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Wir laden au√üerdem alle Profis ein, ihre Berichte an die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HighLoad ++ 2018-</a> Konferenz im November zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">senden</a> , die am 8. und 9. November in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Skolkovo stattfinden</a> wird.  Wenn Sie eine einzigartige und interessante Erfahrung haben und bereit sind, diese zu teilen, registrieren Sie sich vor dem 1. September und f√ºllen Sie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Formular aus</a> . <br><br>  Wenn Sie Angst haben, √∂ffentlich zu sprechen, haben wir eine sogenannte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sprecherschule</a> , in der wir helfen, diese F√§higkeiten kostenlos zu f√∂rdern. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de420465/">https://habr.com/ru/post/de420465/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de420455/index.html">[Javawatch Live] Die Geschichte einer Pull-Anfrage. `os.version` in SubstrateVM</a></li>
<li><a href="../de420457/index.html">√úbersicht √ºber die Simplify3D 3D-Drucksoftware</a></li>
<li><a href="../de420459/index.html">Symbol mit einem Z√§hler in der oberen Symbolleiste: Ein Beispiel f√ºr verschiedene Ans√§tze f√ºr eine Aufgabe</a></li>
<li><a href="../de420461/index.html">10 Zitate von schlechten Designern</a></li>
<li><a href="../de420463/index.html">ICO ist zu Recht im Niedergang, aber sie haben eine Chance, sich zu √§ndern</a></li>
<li><a href="../de420467/index.html">C ++ - Wrapper f√ºr "alle" Echtzeitbetriebssysteme f√ºr CortexM4</a></li>
<li><a href="../de420469/index.html">Merkmale der Verwendung von Druiden am Beispiel von Klassenkameraden</a></li>
<li><a href="../de420471/index.html">Drei technische Berichte zur RIT 2018 von Plesk</a></li>
<li><a href="../de420473/index.html">B√ºcher f√ºr Anf√§nger oder warum es so wichtig ist zu lesen</a></li>
<li><a href="../de420475/index.html">Vergleich von Raylogic 11G- und Raylogic V12-Laserschneidmaschinen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>