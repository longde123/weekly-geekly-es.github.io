<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>➖ 🛀🏽 🥢 Kontrol otomatis menggunakan akses jarak jauh ke registri Windows ✴️ 🐳 🔅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dukungan untuk pengoperasian komputer dan perangkat lunak yang benar dan benar dari pengguna biasa adalah rutinitas karyawan dan / atau administrator ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kontrol otomatis menggunakan akses jarak jauh ke registri Windows</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426873/"><p>  Dukungan untuk pengoperasian komputer dan perangkat lunak yang benar dan benar dari pengguna biasa adalah rutinitas karyawan dan / atau administrator pendukung teknis.  Jika perusahaan kecil, dan semua orang berada dalam satu atau dua kamar, biasanya mudah untuk pergi sendiri dan menyelesaikan masalah atau memeriksa apa yang Anda butuhkan. </p><br><p>  Tetapi bagaimana jika perusahaan itu besar dan pengguna berada di situs / di kota / negara lain? </p><br><p><img src="https://habrastorage.org/webt/wt/ie/d-/wtied-3-4doen9ma6k3gbtzee2u.png" alt="gambar"></p><a name="habracut"></a><br><p>  Salah satu alat klasik untuk pekerjaan tersebut adalah koneksi jarak jauh (menggunakan RDP, perangkat lunak seperti TeamViewer / Skype dengan demo desktop, dan sebagainya).  Namun, ini bukan tanpa kelemahan mendasar: </p><br><ul><li>  dalam hal apa pun, pengguna akhir akan terganggu dari pekerjaannya (dalam beberapa kasus, bahkan tanpa melihat desktopnya) </li><li>  alat ini tidak akan selalu berfungsi jika ada kesalahan pada komputer jarak jauh </li><li>  instalasi perangkat lunak pihak ketiga (termasuk hak milik, dalam hal TeamViewer) jauh dari selalu disambut oleh kebijakan perusahaan </li><li>  metode ini praktis tidak otomatis </li></ul><br><p>  Akhirnya - pendekatan ini digunakan ketika insiden telah terjadi (sulit untuk membayangkan bahwa administrator dari waktu ke waktu "secara preventif" terhubung ke setiap pengguna).  Itulah sebabnya mekanisme kontrol (pemantauan) komputer jarak jauh penting. </p><br><p>  Salah satu solusi yang mungkin adalah dengan menggunakan akses jarak jauh ke registri Windows.  Ini menyimpan data dalam bentuk database hirarkis, yang memungkinkan Anda untuk dengan cepat menerima dan menyimpannya dengan kompak.  Mereka menggunakan registri untuk menyimpan pengaturan dan parameter mereka sendiri, baik OS dan layanan yang disematkan, serta sebagian besar program pihak ketiga.  Oleh karena itu, isi registri sangat mempengaruhi operasi sistem. </p><br><p>  Berdasarkan ini, registri dapat digunakan sebagai “indikator” untuk pemantauan (Anda dapat mendeteksi kesalahan jika dikaitkan dengan parameter yang salah dalam registri atau mensimulasikan situasi yang bermasalah). </p><br><p>  Kemungkinan lain yang diberikan oleh solusi ini adalah kemungkinan kontrol administratif pengguna (misalnya, pembacaan jarak jauh memungkinkan Anda untuk melihat fakta menginstal program yang tidak diinginkan dan membuat perubahan pada pengaturan) - jangan lupa tentang pengaruh "faktor manusia" pada sistem.  Dalam praktiknya, ini berguna dalam kerangka proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SkypeTime</a> , di mana perlu untuk melacak koreksi pengaturan di Skype for Business. </p><br><p><img src="https://habrastorage.org/webt/eb/jt/9l/ebjt9lhsnvxoead9su8n64gzyqq.jpeg" alt="gambar"></p><br><p>  Tetapi registri berisi ribuan entri, sangat sulit untuk mengontrol semuanya.  Oleh karena itu, pertama-tama, perlu untuk membatasi subjek kontrol - untuk menentukan parameter mana yang menarik bagi kami, dan mencari tahu di mana cabang-cabang registri tertentu nilai yang sesuai berada.  Sebagai aturan, yang terakhir tidak sulit ditemukan dalam dokumentasi / Internet, atau menentukan secara independen berdasarkan nama kunci. </p><br><p>  Setelah menentukan subjek kontrol, Anda dapat melanjutkan ke konfigurasi langsung akses jarak jauh.  Untuk melakukan ini, Anda perlu mengaktifkan layanan Panggilan Prosedur Jauh pada komputer jarak jauh dan mengkonfigurasi firewall sebagaimana diperlukan, yang mudah dilakukan menggunakan kebijakan grup.  Mempertimbangkan persyaratan keamanan, akses memerlukan hak administrator domain atau administrator lokal di masing-masing perangkat. </p><br><div class="spoiler">  <b class="spoiler_title">Konfigurasikan Akses Jarak Jauh</b> <div class="spoiler_text"><p>  Untuk mengaktifkan layanan itu sendiri, di bagian Konfigurasi Komputer&gt; Preferensi&gt; Pengaturan Panel Kontrol&gt; Layanan, atur parameter untuk layanan RpcS, seperti dalam cuplikan layar </p><br><p><img src="https://habrastorage.org/webt/oy/j8/k-/oyj8k-xbkjvb6yurtx-_ejk_0gc.jpeg" alt="gambar"></p><br><p>  Tetap menambahkan pengecualian Firewall yang sesuai.  Dalam kebijakan yang sama, di bawah Konfigurasi Komputer&gt; Kebijakan&gt; Pengaturan Windows&gt; Pengaturan Keamanan&gt; Windows Firewall dengan Keamanan Lanjut&gt; Aturan Masuk, buat Aturan Baru: <br>  Jenis Aturan - Kustom </p><br><p><img src="https://habrastorage.org/webt/s1/wo/hk/s1wohkk7ldbibzqrim7qrcki-rs.jpeg" alt="gambar"></p><br><p>  Tentukan jalur program -% SystemRoot% \ system32 \ svchost.exe <br>  Dari pengaturan tambahan di bagian Layanan, atur Terapkan ke layanan dengan nama pendek berikut - Winmgmt </p><br><p><img src="https://habrastorage.org/webt/ef/fg/wv/effgwvovrv1eqr9btfiy-dv9dzo.jpeg" alt="gambar"></p><br><p>  Pada halaman-halaman berikut kami tentukan TCP tanpa menentukan port spesifik dan untuk semua alamat </p><br><p><img src="https://habrastorage.org/webt/0z/-5/ef/0z-5ef-xfzxapqdbl8mln_9hu6u.jpeg" alt="gambar"></p><br><p><img src="https://habrastorage.org/webt/7k/y6/ks/7ky6kso0xwqyamgqb14i3uvkxxi.jpeg" alt="gambar"></p><br><p>  dan izinkan koneksi ( <em>Izinkan Koneksi</em> ) untuk profil domain </p><br><p><img src="https://habrastorage.org/webt/ry/hg/e7/ryhge7d26xy8gjkmlneq6cqjg6w.jpeg" alt="gambar"></p><br><p><img src="https://habrastorage.org/webt/ui/fq/-a/uifq-aqdmohmt-omff0ctcgm1mq.jpeg" alt="gambar"></p></div></div><br><p>  Namun, secara manual mengendalikan registri lusinan dan ratusan komputer "secara manual" (bahkan jika dengan beberapa entri) adalah tugas yang tidak berterima kasih dan tidak masuk akal.  Untungnya, proses ini cukup mudah untuk diotomatisasi menggunakan skrip.  Misalnya, skrip PowerShell berikut ini memungkinkan Anda untuk mengetahui pengguna mana yang telah mengubah parameter AwayThreshold dan IdleThreshold (waktu untuk beralih ke status "Di Tempat" dan "Tidak Aktif") untuk Skype for Business. </p><br><div class="spoiler">  <b class="spoiler_title">Kode skrip</b> <div class="spoiler_text"><pre><code class="hljs mel">Param ( [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"c"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$FromFileComputers, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"r"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$OutputRPCErrorsFile, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"u"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$FromFileUsers, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"o"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$OutputFile=<span class="hljs-string"><span class="hljs-string">"output.csv"</span></span>, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"a"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$MinAway, [<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>(<span class="hljs-string"><span class="hljs-string">"i"</span></span>)] [<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>]$MinIdle ) $RPCErrorsArray = @() $result = @() $HKU = <span class="hljs-number"><span class="hljs-number">2147483651</span></span> $RegistryForCheckArray = <span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Office\13.0\Lync"</span></span>,<span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Office\14.0\Lync"</span></span>,<span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Office\15.0\Lync"</span></span>,<span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Office\16.0\Lync"</span></span>,<span class="hljs-string"><span class="hljs-string">"SOFTWARE\Microsoft\Communicator"</span></span> $CurrentComputerNumber = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(![<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($FromFileUsers)) { $Users = Get-Content $FromFileUsers; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(![<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($FromFileComputers)) { $Comps = Get-Content $FromFileComputers; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $date = (get-<span class="hljs-keyword"><span class="hljs-keyword">date</span></span>).AddMonths(<span class="hljs-number"><span class="hljs-number">-1</span></span>) $Comps = Get-ADComputer -<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span> { lastlogontimestamp -ge $date } | <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> name | ForEach-Object {$_.name} #$Comps = <span class="hljs-string"><span class="hljs-string">"NB_CY"</span></span> } $ServersCount = ($Comps).Count; Foreach ($Comp <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $Comps) { $CurrentComputerNumber++ try { Write-Host <span class="hljs-string"><span class="hljs-string">"Checking: $Comp [$CurrentComputerNumber/$ServersCount]"</span></span>; $profiles = Get-WmiObject Win32_UserProfile -<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span> <span class="hljs-string"><span class="hljs-string">"Loaded=$true and special=$false"</span></span> -ComputerName $Comp -ErrorAction Stop $reg = [wmiclass]<span class="hljs-string"><span class="hljs-string">"\\$Comp\root\default:stdregprov"</span></span> Foreach ($profile <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $profiles) { $username = Split-Path $profile.LocalPath -Leaf <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(![<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($FromFileUsers)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!$Users.Contains($username)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } } Foreach( $registry <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $RegistryForCheckArray) { $hkey = <span class="hljs-string"><span class="hljs-string">"$($profile.sid)\$registry"</span></span> #Write-Host <span class="hljs-string"><span class="hljs-string">"KEY: $hkey"</span></span> $away = $reg.GetDWORDValue($hku,$hkey,<span class="hljs-string"><span class="hljs-string">"AwayThreshold"</span></span>).uValue $idle = $reg.GetDWORDValue($hku,$hkey,<span class="hljs-string"><span class="hljs-string">"IdleThreshold"</span></span>).uValue $sip = $reg.GetStringValue($hku,$hkey,<span class="hljs-string"><span class="hljs-string">"ServerSipUri"</span></span>).sValue <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>([<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($away) -and [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($idle)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(($MinAway -gt <span class="hljs-number"><span class="hljs-number">0</span></span> -and $away -lt $MinAway) -or ($MinIdle -gt <span class="hljs-number"><span class="hljs-number">0</span></span> -and $idle -lt $MinIdle)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } $result += New-Object PsObject -Property @{ <span class="hljs-string"><span class="hljs-string">"PC"</span></span> = $Comp <span class="hljs-string"><span class="hljs-string">"Username"</span></span> = $username <span class="hljs-string"><span class="hljs-string">"SIP"</span></span> = $sip <span class="hljs-string"><span class="hljs-string">"SFB_Away"</span></span> = $away <span class="hljs-string"><span class="hljs-string">"SFB_Idle"</span></span> = $idle } } } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_.Exception.GetType().Name -eq <span class="hljs-string"><span class="hljs-string">"COMException"</span></span>) { $RPCErrorsArray += $Comp; } Write-Host <span class="hljs-string"><span class="hljs-string">"Error: ($_.Exception.GetType().Name)"</span></span>; $_.Exception } } $result | Export-csv -Path $OutputFile $result | Format-Table -Property PC,Username,SIP,SFB_Away,SFB_Idle -AutoSize Write-Host <span class="hljs-string"><span class="hljs-string">"Saved to: $OutputFile"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(![<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]::IsNullOrEmpty($OutputRPCErrorsFile)) { $RPCErrorsArray | out-<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> $OutputRPCErrorsFile Write-Host <span class="hljs-string"><span class="hljs-string">"RPC errors saved to: $OutputRPCErrorsFile"</span></span> }</code> </pre> </div></div><br>  Untuk kenyamanan yang lebih besar, skrip dapat dijalankan dengan parameter: <br><br>  path -c ke file dengan daftar komputer hostname untuk memeriksa, jika tidak ditentukan - dapatkan komputer dari AD dengan aktivitas 30 hari. <br>  -r path ke file di mana nama host komputer yang memiliki kesalahan RPC akan ditulis. <br>  -U path ke file dengan daftar pengguna (login), jika tidak ditentukan, periksa semua. <br>  -o path ke file di mana hasil skrip akan dieksekusi, defaultnya adalah output.csv. <br>  -sebuah nilai minimum untuk parameter AwayThreshold, catatan dengan nilai kurang dari nilai yang ditentukan tidak akan mendapatkan hasil dari eksekusi skrip. <br>  -i nilai minimum untuk parameter IdleThreshold, catatan dengan nilai kurang dari nilai yang ditentukan tidak akan mendapatkan hasil skrip. <br><br>  Selanjutnya, skrip dapat diotomatisasi dengan menambahkan Penjadwal Tugas Windows (Penjadwal Tugas) atau melalui fungsionalitas Pekerjaan Terjadwal di PowerShell. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id426873/">https://habr.com/ru/post/id426873/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id426853/index.html">“S in IoT Stands for Security”: undang-undang pertama di dunia tentang perlindungan gadget pintar telah disahkan - kami memahami apa</a></li>
<li><a href="../id426861/index.html">Perburuan baru untuk materi gelap terjadi di bawah gunung</a></li>
<li><a href="../id426863/index.html">Tersedia tentang angka empat dan manfaatnya</a></li>
<li><a href="../id426865/index.html">Desain dasbor yang jelas untuk sistem manajemen iklan yang canggih</a></li>
<li><a href="../id426869/index.html">Cara efektif melakukan konferensi video dengan pelanggan asing</a></li>
<li><a href="../id426875/index.html">Arsitektur Shooter Meta Server Online Tacticool</a></li>
<li><a href="../id426879/index.html">Menyiapkan sistem pembatasan listrik untuk proyek yang menggunakan antarmuka kecepatan tinggi</a></li>
<li><a href="../id426881/index.html">Meluncurkan Program Pengembang Online</a></li>
<li><a href="../id426889/index.html">Cara berpartisipasi dalam kompetisi pembelajaran mesin. Kuliah di Yandex</a></li>
<li><a href="../id426891/index.html">Penambangan proses SAP atau cara memahami proses bisnis Anda</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>