<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöÑ üë©üèº‚Äçü§ù‚Äçüë®üèø üôÅ Ataque DDoS aos servi√ßos RDP: reconhe√ßa e supere. Experi√™ncia bem sucedida de Tucha ‚òùüèæ ü•ì üôåüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Contaremos uma hist√≥ria interessante sobre como "terceiros" tentaram interferir no trabalho de nossos clientes e como esse problema foi resolvido. 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ataque DDoS aos servi√ßos RDP: reconhe√ßa e supere. Experi√™ncia bem sucedida de Tucha</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474470/">  Contaremos uma hist√≥ria interessante sobre como "terceiros" tentaram interferir no trabalho de nossos clientes e como esse problema foi resolvido. <br><br><h2>  Como tudo come√ßou </h2><br>  Tudo come√ßou na manh√£ de 31 de outubro, no √∫ltimo dia do m√™s, quando muitos precisam desesperadamente resolver quest√µes urgentes e importantes. <br><br>  Um dos parceiros que mant√©m em nossa nuvem v√°rias m√°quinas virtuais dos clientes que atende, relatou que, das 9h10 √†s 21h20, v√°rios servidores Windows em execu√ß√£o no site ucraniano n√£o aceitaram conex√µes com o servi√ßo de acesso remoto , os usu√°rios n√£o conseguiam acessar seus desktops, mas ap√≥s alguns minutos o problema parecia se resolver. <br><br>  Aumentamos as estat√≠sticas dos canais de comunica√ß√£o, mas n√£o encontramos nenhuma explos√£o de tr√°fego ou falhas.  Olhou para as estat√≠sticas sobre a carga em recursos de computa√ß√£o - sem anomalias.  E o que foi aquilo? <br><br>  Em seguida, outro parceiro, que hospeda outras centenas de servidores em nossa nuvem, relatou os mesmos problemas que alguns de seus clientes observaram e, em geral, os servidores est√£o dispon√≠veis (eles respondem corretamente ao teste de ping e a outras solicita√ß√µes), mas o servi√ßo O acesso remoto a esses servidores aceita novas conex√µes e as rejeita, enquanto se tratava de servidores em sites diferentes, cujo tr√°fego √© proveniente de diferentes canais de transmiss√£o de dados. <br><br><a name="habracut"></a>  E vamos olhar para esse tr√°fego.  Um pacote com uma solicita√ß√£o para estabelecer uma conex√£o chega ao servidor: <br><br><pre><code class="plaintext hljs">xx:xx:xx.xxxxxx IP xxx.xxx.xxx.xxx.58355 &gt; 192.168.xxx.xxx.3389: Flags [S], seq 467744439, win 64240, options [mss 1460,nop,wscale 8,nop,nop,sackOK], length 0</code> </pre> <br>  O servidor recebe este pacote, mas a conex√£o rejeita: <br><br><pre> <b><code class="plaintext hljs">xx:xx:xx.xxxxxx IP 192.168.xxx.xxx.3389 &gt; xxx.xxx.xxx.xxx.58355: Flags [R.], seq 0, ack 467744440, win 0, length 0</code></b> </pre> <br>  Isso significa que o problema √© claramente causado n√£o de maneira alguma por alguns problemas na infraestrutura, mas por outra coisa.  Talvez todos os usu√°rios tenham problemas com o licenciamento de √°reas de trabalho remotas?  Talvez algum malware tenha conseguido se infiltrar em seus sistemas, mas hoje ele foi ativado, como aconteceu com o <b>XData</b> e o <b>Petya h√°</b> alguns anos? <br><br>  Enquanto eles estavam resolvendo o problema, eles receberam solicita√ß√µes semelhantes de v√°rios outros clientes e parceiros. <br>  E o que acontece nessas m√°quinas? <br><br>  Os logs de eventos est√£o cheios de mensagens sobre como tentar encontrar uma senha: <br><br><img src="https://habrastorage.org/webt/bs/zs/n_/bszsn_28xboprso40nmivlngmiy.png"><br><br>  Normalmente, essas tentativas s√£o registradas em todos os servidores em que a porta padr√£o (3389) √© usada para o servi√ßo de acesso remoto e o acesso √© permitido de qualquer lugar.  A Internet est√° cheia de bots que examinam constantemente todos os pontos de conex√£o dispon√≠veis e tentam encontrar uma senha (por esse motivo, recomendamos enfaticamente o uso de senhas complexas em vez de "123").  No entanto, a intensidade dessas tentativas naquele dia foi muito alta. <br><br><h3>  O que fazer? </h3><br>  Recomende que os clientes dediquem muito tempo para alterar as configura√ß√µes de um grande n√∫mero de usu√°rios finais para mudar para outra porta?  N√£o √© uma boa ideia, os clientes n√£o ser√£o felizes.  Recomende permitir acesso apenas atrav√©s da VPN?  Com pressa e p√¢nico, para aumentar as conex√µes IPSec, das quais elas n√£o s√£o criadas - talvez essa felicidade tamb√©m n√£o sorria para os clientes.  Embora, devo dizer, isso seja de qualquer forma uma quest√£o de caridade, sempre recomendamos ocultar o servidor em uma rede privada e estamos prontos para ajudar com as configura√ß√µes; para aqueles que gostam de resolver, compartilharemos independentemente instru√ß√µes para configurar o IPSec / L2TP em nossa nuvem no modo site a site ou rodovi√°rio -warrior, e se algu√©m quiser aumentar um servi√ßo VPN em seu pr√≥prio servidor Windows, estar√° sempre pronto para compartilhar dicas sobre como aumentar um RAS ou OpenVPN padr√£o.  Por√©m, por mais legais que f√¥ssemos, n√£o era o melhor momento para realizar um trabalho educacional entre os clientes, pois era necess√°rio eliminar o problema com o m√≠nimo de esfor√ßo dos usu√°rios o mais r√°pido poss√≠vel. <br><br>  A solu√ß√£o que implementamos foi a seguinte.  Configuramos uma an√°lise do tr√°fego de passagem de maneira a monitorar todas as tentativas de estabelecer uma conex√£o TCP com a porta 3389 e selecionar endere√ßos dela que, em 150 segundos, tentam estabelecer conex√µes com mais de 16 servidores diferentes em nossa rede - essas s√£o as fontes do ataque ( Obviamente, se um dos clientes ou parceiros tiver uma necessidade real de estabelecer conex√µes com tantos servidores da mesma fonte, voc√™ sempre poder√° adicionar essas fontes √† "lista branca". Al√©m disso, se em uma rede de classe C para essas 150  segundos, mais de 32 endere√ßos foram detectados, faz sentido bloquear toda a rede. O bloqueio √© definido por 3 dias e, se nenhum ataque foi feito a partir dessa fonte durante esse per√≠odo, essa fonte ser√° removida automaticamente da lista negra. A lista de fontes bloqueadas √© atualizada a cada 300 segundos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/th/l4/m_/thl4m_cpt8fhmpcrpzofbyw4eaa.jpeg"></div><cut></cut><br><br>  Esta lista est√° dispon√≠vel aqui neste endere√ßo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://secure.tucha.ua/global-filter/banned/rdp_ddos</a> , voc√™ pode criar suas pr√≥prias ACLs com base nela. <br><br>  Estamos prontos para compartilhar o c√≥digo-fonte de tal sistema, n√£o h√° nada super complicado (esses s√£o alguns scripts simples escritos literalmente em algumas horas "no joelho") e, ao mesmo tempo, ele pode ser adaptado e usado n√£o apenas para proteger contra um ataque, mas tamb√©m para identificar e bloquear qualquer tentativa de verifica√ß√£o de rede: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">siga este link.</a> <br><br>  Al√©m disso, fizemos algumas altera√ß√µes nas configura√ß√µes do sistema de monitoramento, que agora monitora de perto a rea√ß√£o do grupo de controle de servidores virtuais em nossa nuvem a uma tentativa de estabelecer uma conex√£o RDP: se a rea√ß√£o n√£o se seguiu por um segundo, √© uma ocasi√£o para prestar aten√ß√£o. <br><br>  A solu√ß√£o acabou sendo bastante eficaz: n√£o h√° mais reclama√ß√µes de clientes e parceiros, nem do sistema de monitoramento.  A "lista negra" inclui regularmente novos endere√ßos e redes inteiras, o que indica que o ataque continua, mas n√£o afeta mais o trabalho de nossos clientes. <br><br><h3>  Sozinho no campo n√£o √© um guerreiro </h3><br>  Hoje descobrimos que outros operadores enfrentaram um problema semelhante.  Algu√©m ainda acredita que a Microsoft fez algumas altera√ß√µes no c√≥digo do servi√ßo de acesso remoto (se voc√™ se lembra, suspeitamos a mesma coisa no primeiro dia, mas rejeitamos esta vers√£o muito em breve) e promete fazer todo o poss√≠vel para encontre uma solu√ß√£o em breve.  Algu√©m simplesmente ignora o problema e aconselha os clientes a se protegerem (alterar a porta de conex√£o, ocultar o servidor em uma rede privada e assim por diante).  E no primeiro dia, n√£o apenas resolvemos esse problema, mas tamb√©m criamos algumas bases para um sistema de detec√ß√£o de amea√ßas mais global, que planejamos desenvolver. <br><br><img src="https://habrastorage.org/webt/v6/iy/fz/v6iyfz27ppf36lm7sjwsmf3biym.jpeg"><br><br>  Agradecimentos especiais a clientes e parceiros que n√£o ficaram em sil√™ncio e n√£o sentaram na margem do rio, antecipando que um dia o cad√°ver do inimigo flutuaria sobre ele e imediatamente voltamos nossa aten√ß√£o para o problema, que nos deu a oportunidade de elimin√°-lo no mesmo dia. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt474470/">https://habr.com/ru/post/pt474470/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt474452/index.html">Relat√≥rio de status de outono Haxe</a></li>
<li><a href="../pt474458/index.html">Total acumulado em SQL</a></li>
<li><a href="../pt474460/index.html">Descri√ß√£o das arquiteturas de processador no LLVM usando o TableGen</a></li>
<li><a href="../pt474462/index.html">Enorme conjunto de dados aberto da vers√£o 1.0 do discurso russo</a></li>
<li><a href="../pt474466/index.html">Hist√≥ria do primeiro Diablo</a></li>
<li><a href="../pt474472/index.html">Lista de verifica√ß√£o UX de 30 pontos para aplicativos m√≥veis</a></li>
<li><a href="../pt474474/index.html">Benchmarks abertos para teste de carga de servidores e aplicativos da web</a></li>
<li><a href="../pt474476/index.html">Armazenando fotos em DVDs no 2K19 (em 2190? Em 2238?)</a></li>
<li><a href="../pt474478/index.html">Sinopse sobre Machine Learning. Estat√≠stica matem√°tica. M√©todo de m√°xima verossimilhan√ßa</a></li>
<li><a href="../pt474480/index.html">Como educar as crian√ßas a usar a tecnologia corretamente, se n√£o foi na sua inf√¢ncia?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>