<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöµüèæ üîí ‚úîÔ∏è O que voc√™ precisa saber sobre o JavaScript Engine Switcher 3.0 üîù üç≠ ‚ô¶Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O JavaScript Engine Switcher foi originalmente criado como uma biblioteca auxiliar e seu desenvolvimento foi amplamente determinado pelas necessidades...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O que voc√™ precisa saber sobre o JavaScript Engine Switcher 3.0</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439446/"><p><img src="https://habrastorage.org/webt/qo/zx/ss/qozxssedwxgcrteo4wnodfixdmy.png" alt="Logotipo para terceira vers√£o do JavaScript Engine Switcher"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O JavaScript Engine Switcher</a> foi originalmente criado como uma biblioteca auxiliar e seu desenvolvimento foi amplamente determinado pelas necessidades das bibliotecas que o usavam.  De fato, cada uma de suas principais vers√µes resolveu uma ou v√°rias tarefas principais necess√°rias para o desenvolvimento adicional de outras bibliotecas: </p><br><ol><li> Na primeira vers√£o, essa tarefa foi incluir o m√°ximo de m√≥dulos adaptadores para os populares mecanismos JS que suportam a plataforma .NET poss√≠vel.  E isso deu aos usu√°rios do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bundle Transformer</a> certa flexibilidade: nos computadores do desenvolvedor, eles poderiam usar o m√≥dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MSIE</a> que suporta a depura√ß√£o de c√≥digo JS usando o Visual Studio e em servidores que n√£o tinham uma vers√£o moderna do Internet Explorer ou que n√£o estava instalada, eles poderiam usar M√≥dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">V8</a> .  Alguns at√© conseguiram rodar o Bundle Transformer em Mono no Linux e Mac usando os m√≥dulos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jurassic</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jint</a> . </li><li>  A principal tarefa da segunda vers√£o foi a implementa√ß√£o do suporte ao .NET Core, necess√°rio para a nova vers√£o da biblioteca <a href="">ReactJS.NET</a> .  Outra tarefa importante foi a cria√ß√£o de um m√≥dulo de plataforma cruzada que pode processar rapidamente grandes quantidades de c√≥digo JS (os m√≥dulos Jurassic e Jint n√£o eram adequados para isso) e, ap√≥s v√°rias melhorias, o m√≥dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ChakraCore</a> se tornou um m√≥dulo. </li><li>  Na terceira vers√£o, o foco principal era melhorar a integra√ß√£o com a biblioteca ReactJS.NET e melhorar a produtividade. </li></ol><br><p> Neste artigo, consideraremos algumas inova√ß√µes da terceira vers√£o, que para muitos se revelaram √≥bvias, mesmo ap√≥s a leitura do <a href="">texto</a> do <a href="">release</a> e da se√ß√£o de documenta√ß√£o <a href="">‚ÄúComo atualizar aplicativos para a vers√£o 3.X‚Äù</a> : mudan√ßas na classe <code>JsEngineSwitcher</code> , reorganiza√ß√£o de exce√ß√µes, mensagens de erro mais informativas, interrup√ß√£o e compila√ß√£o preliminar de scripts, a capacidade de alterar o tamanho m√°ximo da pilha nos m√≥dulos ChakraCore e MSIE, bem como um novo m√≥dulo baseado no NiL.JS. </p><a name="habracut"></a><br><h2>  Altera√ß√µes na classe JsEngineSwitcher </h2><br><p>  Na nova vers√£o, a classe <code>JsEngineSwitcher</code> implementa a interface <code>IJsEngineSwitcher</code> e n√£o √© mais um singleton (voc√™ pode instancia-la usando o <code>new</code> operador).  Para obter uma inst√¢ncia global, use a propriedade <code>Current</code> em vez da propriedade <code>Instance</code> .  A propriedade <code>Current</code> , diferentemente da propriedade <code>Instance</code> descontinuada, tem o tipo de retorno <code>IJsEngineSwitcher</code> .  Al√©m disso, a propriedade <code>Current</code> possui um setter, com o qual voc√™ pode substituir a implementa√ß√£o padr√£o pela sua: </p><br><pre> <code class="cs hljs">JsEngineSwitcher.Current = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyJsEngineSwitcher();</code> </pre> <br><p>  Nos aplicativos Web ASP.NET Core que possuem o pacote <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JavaScriptEngineSwitcher.Extensions.MsDependencyInjection</a> instalado, a implementa√ß√£o √© substitu√≠da usando o <code>AddJsEngineSwitcher</code> extens√£o <code>AddJsEngineSwitcher</code> : </p><br><pre> <code class="cs hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Extensions.MsDependencyInjection; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Startup</span></span> { ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureServices</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceCollection services</span></span></span><span class="hljs-function">)</span></span> { ‚Ä¶ services.AddJsEngineSwitcher(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyJsEngineSwitcher(), options =&gt; ‚Ä¶ ) ‚Ä¶ ; ‚Ä¶ } ‚Ä¶ } ‚Ä¶</code> </pre> <br><p>  Essas altera√ß√µes quase sempre "quebram" aplicativos ou bibliotecas que usam a vers√£o anterior do JavaScript Engine Switcher.  Portanto, voc√™ precisa fazer as seguintes altera√ß√µes no seu c√≥digo: </p><br><ol><li>  Altere o tipo de vari√°veis, par√¢metros ou propriedades de <code>JsEngineSwitcher</code> para <code>IJsEngineSwitcher</code> . </li><li>  Em vez da propriedade <code>Instance</code> , use a propriedade <code>Current</code> em qualquer lugar. </li></ol><br><p>  Tamb√©m √© importante notar que, para a maioria dos desenvolvedores, essas altera√ß√µes n√£o ser√£o de grande benef√≠cio, porque seu principal objetivo era simplificar os testes de unidade (por exemplo, anteriormente, nos testes de unidade da biblioteca ReactJS.NET, os bloqueios eram <a href="">usados</a> , mas agora voc√™ pode <a href="">fazer sem eles</a> ). </p><br><h2>  Reorganiza√ß√£o de exce√ß√µes </h2><br><p>  Antes da terceira vers√£o, a maioria dos erros do mecanismo JS se transformava em <code>JsRuntimeException</code> tipo <code>JsRuntimeException</code> e apenas os erros ocorridos durante o processo de inicializa√ß√£o do mecanismo se transformavam em <code>JsEngineLoadException</code> .  Havia tamb√©m uma classe base <code>JsException</code> , da qual dois dos tipos de exce√ß√µes acima foram herdados, o que tornou poss√≠vel interceptar absolutamente todos os erros que ocorreram durante a opera√ß√£o dos mecanismos JS.  Apesar das desvantagens √≥bvias, essa organiza√ß√£o de exce√ß√µes se encaixa bem no conceito de uma interface unificada para acessar os recursos b√°sicos dos mecanismos JS. </p><br><p>  Por√©m, com a implementa√ß√£o da interrup√ß√£o e pr√©-compila√ß√£o de scripts (discutirei sobre eles nas se√ß√µes a seguir), surgiu a necessidade de uma nova abordagem para organizar exce√ß√µes.  A primeira coisa a fazer foi adicionar um novo tipo de exce√ß√£o - <code>JsInterruptedException</code> , necess√°rio para notificar o usu√°rio sobre a interrup√ß√£o da execu√ß√£o do script.  Em seguida, foi necess√°rio dividir explicitamente todos os erros que ocorreram durante o processamento do script em dois grupos: erros de compila√ß√£o (an√°lise) e erros de tempo de execu√ß√£o.  Tamb√©m era necess√°rio separar todos os tipos de erros espec√≠ficos do Chakra e do V8, que n√£o estavam relacionados ao processamento de scripts.  Tamb√©m era necess√°rio levar em considera√ß√£o a presen√ßa de uma exce√ß√£o no mecanismo Jint que ocorre quando o per√≠odo de tempo limite para executar um script (tempo limite) expirou.  Como resultado, foi formada uma nova abordagem para a organiza√ß√£o de exce√ß√µes, que pode ser representada como a seguinte estrutura hier√°rquica: </p><br><ul><li> <code>JsException</code> <br> <ul><li> <code>JsEngineException</code> <br> <ul><li> <code>JsEngineLoadException</code> </li> </ul></li><li> <code>JsFatalException</code> </li> <li> <code>JsScriptException</code> <br> <ul><li> <code>JsCompilationException</code> </li> <li> <code>JsRuntimeException</code> <br> <ul><li> <code>JsInterruptedException</code> </li> <li> <code>JsTimeoutException</code> </li> </ul></li></ul></li><li> <code>JsUsageException</code> </li> </ul></li><li>  <code>JsEngineNotFoundException</code> <sup>*</sup> </li></ul><br><p>  * - essa exce√ß√£o n√£o ocorre no n√≠vel do mecanismo JS, mas no n√≠vel do JavaScript Engine Switcher. </p><br><p>  Eu acho que a hierarquia de exce√ß√µes apresentada acima n√£o precisa de coment√°rios, porque os nomes das exce√ß√µes falam por si.  Com essa abordagem, obtemos n√£o apenas mais informa√ß√µes sobre as causas do erro, mas tamb√©m podemos lidar com mais flexibilidade com certos tipos de exce√ß√µes. </p><br><h2>  Formato de mensagem de erro unificado </h2><br><p>  Outro problema com vers√µes anteriores do JavaScript Engine Switcher foi a dificuldade em localizar erros que ocorreram durante o processamento de scripts.  Na propriedade de exce√ß√£o <code>Message</code> , era dif√≠cil entender exatamente onde ocorreu o erro no c√≥digo; portanto, tive que analisar outras propriedades de exce√ß√£o, o que nem sempre era conveniente.  Al√©m disso, o conjunto de propriedades existentes tamb√©m n√£o foi suficiente. </p><br><p>  Portanto, 2 novas propriedades foram adicionadas √† classe <code>JsScriptException</code> : </p><br><ol><li>  <strong>Tipo</strong> - tipo de erro de JavaScript (por exemplo, <code>SyntaxError</code> ou <code>TypeError</code> ); </li><li>  <strong>DocumentName</strong> - o nome do documento (geralmente extra√≠do dos valores dos seguintes par√¢metros: <code>documentName</code> dos m√©todos <code>Execute</code> e <code>Evaluate</code> , <code>path</code> m√©todo <code>ExecuteFile</code> , <code>resourceName</code> m√©todo <code>ExecuteResource</code> etc.); </li></ol><br><p>  Uma nova propriedade tamb√©m foi inclu√≠da na classe <code>JsRuntimeException</code> - <strong>CallStack</strong> , que cont√©m uma representa√ß√£o em cadeia da pilha de chamadas. </p><br><p>  Anteriormente, um valor de uma propriedade semelhante da exce√ß√£o .NET original ou uma representa√ß√£o de seq√º√™ncia de caracteres de um erro JavaScript era simplesmente copiado na propriedade <code>Message</code> .  Freq√ºentemente, as mensagens de erro em diferentes mecanismos JS diferiam n√£o apenas no formato, mas tamb√©m na quantidade de informa√ß√µes √∫teis apresentadas neles.  Por exemplo, devido √† falta de informa√ß√µes sobre o n√∫mero de linhas e colunas em algumas mensagens de erro, os desenvolvedores da biblioteca ReactJS.NET foram for√ßados a <a href="">lan√ßar novamente as exce√ß√µes</a> recebidas do JavaScript Engine Switcher. </p><br><p>  Portanto, decidi gerar minhas pr√≥prias mensagens de erro no n√≠vel do m√≥dulo adaptador, que teria um formato √∫nico (unificado).  Este formato usa todas as informa√ß√µes de erro dispon√≠veis: tipo, descri√ß√£o, nome do documento, n√∫mero da linha, n√∫mero da coluna, fragmento de c√≥digo e pilha de chamadas.  Como base para o novo formato, peguei o formato de erro da biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Microsoft ClearScript</a> . </p><br><p>  Abaixo est√£o as mensagens sobre o mesmo erro de compila√ß√£o que foram geradas por diferentes m√≥dulos do adaptador: </p><br><pre> <code class="plaintext hljs">ChakraCore ========== SyntaxError: Unexpected identifier after numeric literal at declinationOfSeconds.js:12:23 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; Jint ==== SyntaxError: Unexpected token ILLEGAL at declinationOfSeconds.js:12:25 Jurassic ======== SyntaxError: Expected operator but found 'O' at declinationOfSeconds.js:12 MSIE   Classic ===================== SyntaxError: Expected ';' at declinationOfSeconds.js:12:25 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; MSIE   Chakra ActiveScript ================================= SyntaxError: Expected ';' at declinationOfSeconds.js:12:25 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; MSIE   Chakra IE JsRT ============================ SyntaxError: Expected ';' at 12:25 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; MSIE   Chakra Edge JsRT ============================== SyntaxError: Unexpected identifier after numeric literal at declinationOfSeconds.js:12:23 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; NiL === SyntaxError: Unexpected token 'O' at 12:25 V8 == SyntaxError: Invalid or unexpected token at declinationOfSeconds.js:12:24 -&gt; caseIndex = number % 1O &lt; 5 ? number % 10 : 5; Vroom ===== SyntaxError: Unexpected token ILLEGAL at declinationOfSeconds.js:12:24</code> </pre> <br><p>  Um exemplo semelhante para um erro de tempo de execu√ß√£o: </p><br><pre> <code class="plaintext hljs">ChakraCore ========== TypeError: Unable to get property '' of undefined or null reference at transliterate (russian-translit.js:929:4) -&gt; newCharValue = typeof charMapping[charValue] !== 'undefined' ? at Global code (Script Document:1:1) Jint ==== TypeError: charMapping is undefined at russian-translit.js:929:26 Jurassic ======== TypeError: undefined cannot be converted to an object at transliterate (russian-translit.js:929) at Global code (Script Document:1) MSIE   Classic ===================== TypeError: 'undefined' is null or not an object at russian-translit.js:929:4 MSIE   Chakra ActiveScript ================================= TypeError: Unable to get property '' of undefined or null reference at russian-translit.js:929:4 MSIE   Chakra IE JsRT ============================ TypeError: Unable to get property '' of undefined or null reference at transliterate (russian-translit.js:929:4) at Global code (Script Document:1:1) MSIE   Chakra Edge JsRT ============================== TypeError: Unable to get property '' of undefined or null reference at transliterate (russian-translit.js:929:4) at Global code (Script Document:1:1) NiL === TypeError: Can't get property "" of "undefined" V8 == TypeError: Cannot read property '' of undefined at transliterate (russian-translit.js:929:37) -&gt; newCharValue = typeof charMapping[charValue] !== 'undefined' ? at Script Document:1:1 Vroom ===== TypeError: Cannot read property '' of undefined at russian-translit.js:929:37</code> </pre> <br><p>  Como voc√™ pode ver nos exemplos, alguns mecanismos JS nos fornecem descri√ß√µes de erro e n√∫meros de coluna completamente diferentes, e nem sempre podemos obter um conjunto completo de dados de erro, mas, apesar dessas defici√™ncias, o formato unificado nos fornece mais informa√ß√µes sobre o local do erro do que mensagens de erro originais. </p><br><h2>  Dicas de implanta√ß√£o de assembly nativo </h2><br><p>  A principal causa de erros ao trabalhar com a segunda vers√£o do JavaScript Engine Switcher foi que muitos desenvolvedores esqueceram de instalar pacotes NuGet contendo assemblies nativos para os m√≥dulos ChakraCore e V8.  Ao mesmo tempo, uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">postagem no rastreador de erros ReactJS.NET</a> tamb√©m foi dedicada a esse problema ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a tradu√ß√£o para o russo</a> tamb√©m est√° dispon√≠vel).  Agora, esse erro √© encontrado principalmente apenas por iniciantes que, por algum motivo, n√£o leram a documenta√ß√£o. </p><br><p>  Os autores do ReactJS.NET tentaram minimizar o n√∫mero de erros usando as dicas contidas nas mensagens de erro, mas a <a href="">implementa√ß√£o n√£o muito bem-sucedida</a> dessa abordagem levou a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ainda mais confus√£o</a> .  A id√©ia de dicas era boa, mas exigia uma implementa√ß√£o fundamentalmente diferente, ou seja, implementa√ß√£o no n√≠vel dos m√≥dulos adaptadores dos mecanismos JS.  Na nova vers√£o do JavaScript Engine Switcher, essas dicas s√£o adicionadas √† mensagem de erro ao <code>DllNotFoundException</code> exce√ß√µes <code>DllNotFoundException</code> e <code>TypeLoadException</code> <code>JsEngineLoadException</code> (consulte exemplos de implementa√ß√£o dos <a href="">m√≥dulos ChakraCore</a> , <a href="">V8</a> e <a href="">Vroom</a> ).  Al√©m disso, essas dicas s√£o inteligentes, porque  sua gera√ß√£o leva em considera√ß√£o v√°rios fatores: tipo de sistema operacional, arquitetura do processador e tempo de execu√ß√£o (.NET Framework, .NET Core ou Mono). </p><br><p>  Por exemplo, ao usar o m√≥dulo ChakraCore sem montagem nativa em um processo de 64 bits no sistema operacional Windows, a mensagem de erro ser√° semelhante a esta: </p><br><blockquote>  Falha ao criar a inst√¢ncia do ChakraCoreJsEngine.  Provavelmente aconteceu, porque o assembly 'ChakraCore.dll' ou uma de suas depend√™ncias n√£o foi encontrado.  Tente instalar o pacote JavaScriptEngineSwitcher.ChakraCore.Native.win-x64 via NuGet.  Al√©m disso, voc√™ ainda precisa instalar o Microsoft Visual C ++ Redistributable para Visual Studio 2017 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.visualstudio.com/downloads/#microsoft-visual-c-redistributable-for-visual-studio-2017</a> ). </blockquote><br><p>  A mensagem de erro fornece uma dica de que voc√™ precisa instalar o pacote NuGet JavaScriptEngineSwitcher.ChakraCore.Native.win-x64 e tamb√©m menciona que o ChakraCore for Windows exige que o componente redistribu√≠vel do Microsoft Visual C ++ para o Visual Studio 2017 funcione. ocorrer em um processo de 32 bits, o usu√°rio ser√° solicitado a instalar o pacote JavaScriptEngineSwitcher.ChakraCore.Native.win-x86. </p><br><p>  Uma mensagem de erro semelhante no Linux no .NET Core seria assim: </p><br><blockquote>  Falha ao criar a inst√¢ncia do ChakraCoreJsEngine.  Provavelmente aconteceu, porque o assembly 'libChakraCore.so' ou uma de suas depend√™ncias n√£o foi encontrado.  Tente instalar o pacote JavaScriptEngineSwitcher.ChakraCore.Native.linux-x64 via NuGet. </blockquote><br><p>  Nesse caso, ser√° sugerido instalar o pacote JavaScriptEngineSwitcher.ChakraCore.Native.linux-x64. </p><br><p>  Quando iniciado no Mono, outro prompt ser√° exibido: </p><br><blockquote>  ... Os pacotes JavaScriptEngineSwitcher.ChakraCore.Native.linux- * n√£o oferecem suporte √† instala√ß√£o no Mono, mas voc√™ pode instalar o assembly nativo manualmente ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/Taritsyn/JavaScriptEngineSwitcher/wiki/ChakraCore#linux</a> ). </blockquote><br><p>  Como o pacote JavaScriptEngineSwitcher.ChakraCore.Native.linux-x64 √© compat√≠vel apenas com o .NET Core, a dica de ferramenta fornecer√° um link para instru√ß√µes para implantar manualmente o assembly nativo no Linux. </p><br><p>  Muitos outros exemplos podem ser dados, mas isso n√£o faz sentido. </p><br><h2>  Interrompendo a Execu√ß√£o de Script </h2><br><p>  Quando damos aos usu√°rios a oportunidade de executar c√≥digo JS arbitr√°rio no servidor, somos confrontados com um problema muito s√©rio - n√£o sabemos quanto tempo levar√° para executar esse c√≥digo.  Pode ser uma grande quantidade de c√≥digo n√£o ideal ou c√≥digo que executa um loop infinito.  De qualquer forma, ser√° um c√≥digo n√£o controlado que consumir√° os recursos de nosso servidor indefinidamente.  Para controlar de alguma forma esse processo, precisamos interromper a execu√ß√£o dos scripts.  Ao usar mecanismos escritos em .NET puro (por exemplo, Jint, Jurassic ou NiL.JS), sempre podemos come√ßar a executar o c√≥digo JS como uma tarefa com a capacidade de cancelar, mas essa abordagem n√£o funcionar√° para outros mecanismos.  Felizmente para n√≥s, os mecanismos C ++ possuem mecanismos internos para interromper scripts. </p><br><p>  Para fornecer acesso a esses mecanismos, a propriedade <code>SupportsScriptInterruption</code> e o m√©todo <code>Interrupt</code> foram adicionados √† interface <code>IJsEngine</code> .  Como nem todos os mecanismos oferecem suporte a esse recurso, voc√™ deve sempre verificar o valor da propriedade <code>SupportsScriptInterruption</code> antes de chamar o m√©todo <code>Interrupt</code> (se nas vers√µes anteriores do JavaScript Engine Switcher voc√™ precisou executar manualmente o coletor de lixo, entender√° imediatamente do que estou falando): </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (engine.SupportsScriptInterruption) { engine.Interrupt(); }</code> </pre> <br><p>  E voc√™ precisa chamar esse m√©todo em um thread separado, diferente do segmento no qual os scripts s√£o executados.  Depois de chamar o m√©todo <code>Interrupt</code> , todos os <code>CallFunction</code> <code>Evaluate</code> , <code>Execute*</code> e <code>CallFunction</code> execu√ß√£o anteriormente terminar√£o com uma <code>JsInterruptedException</code> . </p><br><p>  Como essa API √© de baixo n√≠vel, √© recomend√°vel usar m√©todos de extens√£o como os seguintes para as tarefas descritas no in√≠cio da se√ß√£o: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> !NET40 using System.Runtime.ExceptionServices; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> using System.Threading; using System.Threading.Tasks; using JavaScriptEngineSwitcher.Core; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 using JavaScriptEngineSwitcher.Core.Extensions; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> using JavaScriptEngineSwitcher.Core.Resources; ‚Ä¶ /// &lt;summary&gt; /// Extension methods for &lt;see cref="IJsEngine"/&gt; /// &lt;/summary&gt; public static class JsEngineExtensions { /// &lt;summary&gt; /// Evaluates an expression within a specified time interval /// &lt;/summary&gt; /// &lt;typeparam name="T"&gt;Type of result&lt;/typeparam&gt; /// &lt;param name="engine"&gt;JS engine&lt;/param&gt; /// &lt;param name="expression"&gt;JS expression&lt;/param&gt; /// &lt;param name="timeoutInterval"&gt;Interval to wait before the /// script execution times out&lt;/param&gt; /// &lt;param name="documentName"&gt;Document name&lt;/param&gt; /// &lt;returns&gt;Result of the expression&lt;/returns&gt; /// &lt;exception cref="ObjectDisposedException"/&gt; /// &lt;exception cref="ArgumentNullException"/&gt; /// &lt;exception cref="ArgumentException"/&gt; /// &lt;exception cref="JsCompilationException"/&gt; /// &lt;exception cref="JsTimeoutException"/&gt; /// &lt;exception cref="JsRuntimeException"/&gt; /// &lt;exception cref="JsException"/&gt; public static T Evaluate&lt;T&gt;(this IJsEngine engine, string expression, TimeSpan timeoutInterval, string documentName) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (engine == null) { throw new ArgumentNullException(nameof(engine)); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (engine.SupportsScriptInterruption) { using (var timer = new Timer(state =&gt; engine.Interrupt(), null, timeoutInterval, #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 new TimeSpan(0, 0, 0, 0, -1))) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> Timeout.InfiniteTimeSpan)) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> { try { return engine.Evaluate&lt;T&gt;(expression, documentName); } catch (JsInterruptedException e) { throw new JsTimeoutException( Strings.Runtime_ScriptTimeoutExceeded, e.EngineName, e.EngineVersion, e ); } } } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 Task&lt;T&gt; task = Task.Factory.StartNew(() =&gt; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> Task&lt;T&gt; task = Task.Run(() =&gt; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> { return engine.Evaluate&lt;T&gt;(expression, documentName); }); bool isCompletedSuccessfully = false; try { isCompletedSuccessfully = task.Wait(timeoutInterval); } catch (AggregateException e) { Exception innerException = e.InnerException; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (innerException != null) { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> NET40 innerException.PreserveStackTrace(); throw innerException; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> ExceptionDispatchInfo.Capture(innerException).Throw(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { throw; } } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (isCompletedSuccessfully) { return task.Result; } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { throw new JsTimeoutException( Strings.Runtime_ScriptTimeoutExceeded, engine.Name, engine.Version ); } } } ‚Ä¶ } ‚Ä¶</span></span></code> </pre> <br><p>  Este m√©todo √© um complemento no m√©todo de mecanismo <code>Evaluate&lt;T&gt;</code> , que permite usar o par√¢metro <code>timeoutInterval</code> definir o tempo limite para aguardar a execu√ß√£o do script.  O princ√≠pio de opera√ß√£o deste m√©todo de extens√£o √© muito simples.  Primeiro, verificamos se nosso mecanismo suporta o mecanismo de interrup√ß√£o interno.  Se isso <code>timeoutInterval</code> , criamos uma inst√¢ncia da classe <code>Timer</code> , que, ap√≥s o intervalo de <code>timeoutInterval</code> especificado no par√¢metro <code>timeoutInterval</code> , inicia o m√©todo <code>Interrupt</code> , chamamos o m√©todo de mecanismo <code>Evaluate&lt;T&gt;</code> e, em caso de erro, capturamos o <code>JsInterruptedException</code> e o envolvemos em um <code>JsTimeoutException</code> .  Se o mecanismo n√£o suportar interrup√ß√µes, crie uma inst√¢ncia da classe <code>Task</code> que execute o m√©todo <code>Evaluate&lt;T&gt;</code> , defina o intervalo de espera para que a tarefa seja executada igual ao valor do par√¢metro <code>timeoutInterval</code> e, se a tarefa for conclu√≠da por tempo limite, <code>JsTimeoutException</code> uma <code>JsTimeoutException</code> tipo <code>JsTimeoutException</code> .  A seguir, √© apresentado um exemplo do uso desse m√©todo de extens√£o: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core.Helpers; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> expression = <span class="hljs-string"><span class="hljs-string">@"function getRandomInt(minValue, maxValue) { minValue = Math.ceil(minValue); maxValue = Math.floor(maxValue); return Math.floor(Math.random() * (maxValue - minValue + 1)) + minValue; } function sleep(millisecondsTimeout) { var totalMilliseconds = new Date().getTime() + millisecondsTimeout; while (new Date().getTime() &lt; totalMilliseconds) { } } var randomNumber = getRandomInt(1, 10); sleep(randomNumber * 1000); randomNumber;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (IJsEngine engine = JsEngineSwitcher.Current.CreateDefaultEngine()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = engine.Evaluate&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(expression, TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-string"><span class="hljs-string">"randomNumber.js"</span></span>); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">" = {0}"</span></span>, result); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsTimeoutException) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"    JavaScript "</span></span> + <span class="hljs-string"><span class="hljs-string">"   !"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"   JavaScript-  "</span></span> + <span class="hljs-string"><span class="hljs-string">"!"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); } } } ‚Ä¶ } ‚Ä¶</code> </pre> <br><p>  Usando o m√©todo de extens√£o, calculamos o resultado da express√£o JS.  O resultado da express√£o √© um n√∫mero inteiro aleat√≥rio e esse n√∫mero tamb√©m √© o n√∫mero de segundos pelos quais essa express√£o est√° atrasada.  Al√©m disso, ao chamar o m√©todo de extens√£o, especificamos um intervalo de espera de 3 segundos.  Como o tempo para calcular a express√£o varia de 1 a 10 segundos, em um caso, o resultado da express√£o ser√° exibido no console e, em outro, uma mensagem sobre o tempo limite. </p><br><p>  N√£o deve ser dif√≠cil refazer esse m√©todo de extens√£o para chamar outros m√©todos de mecanismo (por exemplo, para <code>Execute*</code> , <code>CallFunction</code> ou outras vers√µes sobrecarregadas do m√©todo <code>Evaluate</code> ).  At√© o momento, ainda n√£o decidi se vou adicionar esses m√©todos de extens√£o √† pr√≥pria biblioteca, porque ainda n√£o est√° claro quanto eles ser√£o solicitados. </p><br><h2>  Pr√©-compila√ß√£o de scripts </h2><br><p>  Me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pediram para</a> adicionar suporte √† compila√ß√£o preliminar de scripts <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em 2015</a> .  Naquele momento, n√£o estava claro como essa fun√ß√£o poderia se encaixar no conceito de uma interface unificada.  Mas com o passar do tempo, o suporte a recursos de acessibilidade, como coleta de lixo e interrup√ß√£o de script, come√ßou a aparecer gradualmente no JavaScript Engine Switcher.  Nos √∫ltimos est√°gios do trabalho da terceira vers√£o, chegou a vez da compila√ß√£o preliminar. </p><br><p>  Usando a pr√©-compila√ß√£o, voc√™ pode compilar um script uma vez e us√°-lo v√°rias vezes para inicializar os mecanismos JS.  Devido ao fato de o script pr√©-compilado n√£o exigir an√°lise, a inicializa√ß√£o dos mecanismos ser√° mais r√°pida. </p><br><p>  Atualmente, a pr√©-compila√ß√£o √© suportada por 5 m√≥dulos adaptadores: ChakraCore, Jint, Jurassic, MSIE (apenas nos modos JsRT) e V8.  Para fornecer acesso aos mecanismos de mecanismo correspondentes, a propriedade <code>SupportsScriptPrecompilation</code> e tr√™s novos m√©todos foram adicionados √† interface <code>IJsEngine</code> : <code>IJsEngine</code> , <code>IJsEngine</code> e <code>PrecompileResource</code> .  <code>Precompile*</code> m√©todos de <code>Precompile*</code> retornam uma inst√¢ncia de um objeto que implementa a interface <code>IPrecompiledScript</code> .  Este objeto √© um script pr√©-compilado que pode ser usado por diferentes inst√¢ncias dos mecanismos (uma vers√£o sobrecarregada do m√©todo <code>Execute</code> serve para esse prop√≥sito).  Considere um exemplo simples de uso desta API: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> JavaScriptEngineSwitcher.Core.Helpers; ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> sourceCode = <span class="hljs-string"><span class="hljs-string">@"function declinationOfSeconds(number) { var result, titles = ['', '', ''], titleIndex, cases = [2, 0, 1, 1, 1, 2], caseIndex ; if (number % 100 &gt; 4 &amp;&amp; number % 100 &lt; 20) { titleIndex = 2; } else { caseIndex = number % 10 &lt; 5 ? number % 10 : 5; titleIndex = cases[caseIndex]; } result = number + ' ' + titles[titleIndex]; return result; }"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> functionName = <span class="hljs-string"><span class="hljs-string">"declinationOfSeconds"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemCount = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] inputSeconds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[itemCount] { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] outputStrings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[itemCount]; IJsEngineSwitcher engineSwitcher = JsEngineSwitcher.Current; IPrecompiledScript precompiledCode = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> engine = engineSwitcher.CreateDefaultEngine()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!engine.SupportsScriptPrecompilation) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"{0}  {1}   "</span></span> + <span class="hljs-string"><span class="hljs-string">"  !"</span></span>, engine.Name, engine.Version); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { precompiledCode = engine.Precompile(sourceCode, <span class="hljs-string"><span class="hljs-string">"declinationOfSeconds.js"</span></span>); engine.Execute(precompiledCode); outputStrings[<span class="hljs-number"><span class="hljs-number">0</span></span>] = engine.CallFunction&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(functionName, inputSeconds[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsCompilationException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"     "</span></span> + <span class="hljs-string"><span class="hljs-string">" !"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"   JavaScript-  "</span></span> + <span class="hljs-string"><span class="hljs-string">"!"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; itemIndex &lt; itemCount; itemIndex++) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> engine = engineSwitcher.CreateDefaultEngine()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { engine.Execute(precompiledCode); outputStrings[itemIndex] = engine.CallFunction&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;( functionName, inputSeconds[itemIndex]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsException e) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"   JavaScript- "</span></span> + <span class="hljs-string"><span class="hljs-string">" !"</span></span>); Console.WriteLine(); Console.WriteLine(JsErrorHelpers.GenerateErrorDetails(e)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; itemIndex &lt; itemCount; itemIndex++) { Console.WriteLine(outputStrings[itemIndex]); } } ‚Ä¶ } ‚Ä¶</code> </pre> <br><p>    ,         .     <code>SupportsScriptPrecompilation</code>  ,       ,  ,     .     <code>Precompile</code>  ,      ,      <code>JsCompilationException</code> . C   <code>Execute</code>      , ..   .     <code>CallFunction</code>   <code>declinationOfSeconds</code>      .     .   ,    ,           .     3        .  ,        ,        .         ,    ,      . </p><br><p>      ,     ,    .   ,  ,           .       ReactJS.NET.        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JSPool</a> ,         ( <code>System.Runtime.Caching.MemoryCache</code>  .NET Framework 4.X, <code>System.Web.Caching.Cache</code>  ASP.NET 4.X  <code>Microsoft.Extensions.Caching.Memory.IMemoryCache</code>  ASP.NET Core).      ,        (       <a href=""> </a> ).    ,       ReactJS.NET. </p><br><p>      ReactJS.NET .              .        <code>AllowJavaScriptPrecompilation</code>   <code>true</code> . </p><br><p>  ASP.NET 4.X       <code>App_Start/ReactConfig.cs</code> : </p><br><pre> <code class="cs hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ReactConfig</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ReactSiteConfiguration.Configuration ‚Ä¶ .SetAllowJavaScriptPrecompilation(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) ‚Ä¶ ; ‚Ä¶ } } ‚Ä¶</code> </pre> <br><p>  ASP.NET Core      <code>Startup.cs</code> : </p><br><pre> <code class="cs hljs">‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Startup</span></span> { ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IApplicationBuilder app, IHostingEnvironment env</span></span></span><span class="hljs-function">)</span></span> { ‚Ä¶ app.UseReact(config =&gt; { config ‚Ä¶ .SetAllowJavaScriptPrecompilation(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) ‚Ä¶ ; }); app.UseStaticFiles(); ‚Ä¶ } } ‚Ä¶</code> </pre> <br><p>       ,      .       <a href="">JsExecutionBenchmark</a> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BenchmarkDotNet</a> .        JS-     .    14,9 ,     ,       .          JavaScript Engine Switcher ( 3.0.4). </p><br><p>   ,      .NET Framework 4.7.2: </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup>. </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td rowspan="2"> <sup>ChakraCore</sup> </td><td> <sup></sup> </td><td align="right"> <sup>41,72 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>74,46 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>35,07 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>91,79 </sup> </td></tr><tr><td rowspan="2"> <sup>Jint</sup> </td><td> <sup></sup> </td><td align="right"> <sup>27,19 </sup> </td><td align="right"> <sup>2 812,50</sup> </td><td align="right"> <sup>1 343,75</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 374,58 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>15,54 </sup> </td><td align="right"> <sup>1 296,88</sup> </td><td align="right"> <sup>640,63</sup> </td><td align="right"> <sup>31,25</sup> </td><td align="right"> <sup>7 521,49 </sup> </td></tr><tr><td rowspan="2"> <sup>Jurassic</sup> </td><td> <sup></sup> </td><td align="right"> <sup>455,70 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 575,28 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>78,70 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>7 892,94 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra IE JsRT</sup> </td><td> <sup></sup> </td><td align="right"> <sup>30,97 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>77,75 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>24,40 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>90,58 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra Edge JsRT</sup> </td><td> <sup></sup> </td><td align="right"> <sup>33,14 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>78,40 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>32,86 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>95,48 </sup> </td></tr><tr><td rowspan="2"> <sup>V8</sup> </td><td> <sup></sup> </td><td align="right"> <sup>41,10 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>79,33 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>39,25 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>96,17 </sup> </td></tr></tbody></table><br><p>         ,    .NET ‚Äî     Jurassic  5,79 ,   Jint  1,75 a.      2     ,      2       .                .      Jurassic,          : Jurassic   JS-  IL-  Reflection.Emit,    .        ,          ,      . Jint           .NET-,    .    Jint      ,             .      ,  Jint    ,    ,            .  Jint  Jurassic        . </p><br><p>      ,   C++,  MSIE   Chakra IE JsRT ‚Äî     26,93%.    ChakraCore (18,96%),  V8 (4,71%)  MSIE   Chakra Edge JsRT    (0,85%).           Internet Explorer    Edge.            .          (   )      .   ,      -         12-17  (       ).         .       .         . </p><br><p>     .NET Core 2.0    ( V8 ,    Microsoft ClearScript,    ,   .NET Core): </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup>. </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td rowspan="2"> <sup>ChakraCore</sup> </td><td> <sup></sup> </td><td align="right"> <sup>43,65 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>18,07 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>36,37 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16,59 </sup> </td></tr><tr><td rowspan="2"> <sup>Jint</sup> </td><td> <sup></sup> </td><td align="right"> <sup>24,87 </sup> </td><td align="right"> <sup>2 750,00</sup> </td><td align="right"> <sup>1 375,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 300,25 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>15,25 </sup> </td><td align="right"> <sup>1 281,25</sup> </td><td align="right"> <sup>593,75</sup> </td><td align="right"> <sup>62,50</sup> </td><td align="right"> <sup>7 447,44 </sup> </td></tr><tr><td rowspan="2"> <sup>Jurassic</sup> </td><td> <sup></sup> </td><td align="right"> <sup>469,97 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 511,70 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>80,72 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>7 845,98 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra IE JsRT</sup> </td><td> <sup></sup> </td><td align="right"> <sup>31,50 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>20,28 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>24,52 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>18,78 </sup> </td></tr><tr><td rowspan="2"> <sup>MSIE   Chakra Edge JsRT</sup> </td><td> <sup></sup> </td><td align="right"> <sup>35,54 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>20,45 </sup> </td></tr><tr><td> <sup></sup> </td><td align="right"> <sup>31,44 </sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>18,99 </sup> </td></tr></tbody></table><br><p>      . ,     ‚Äî  MSIE   Chakra Edge JsRT  (7,69%).           Chakra    . </p><br><h2>        ChakraCore  MSIE </h2><br><p>    ,  Microsoft,    ,    .     IIS    (256   32-   512   64-),     ASP.NET  JS- (,  TypeScript)   .       JavaScript Engine Switcher        .             ,        Node.js (492   32-   984   64-).   ,      ,  -    .        ChakraCore  MSIE    <code>MaxStackSize</code> ,          .         Node.js.       ,             . </p><br><h2>     NiL.JS </h2><br><p>      - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NiL</a> ,      <a href="">NiL.JS</a> . NiL.JS ‚Äî    JS-,    .NET.      2014 ,        Jurassic  Jint.    ‚Äî  .         ,       . </p><br><p>     .NET Framework 4.7.2    : </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td> <sup>Jint</sup> </td><td align="right"> <sup>27,19 </sup> </td><td align="right"> <sup>2 812,50</sup> </td><td align="right"> <sup>1 343,75</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 374,58 </sup> </td></tr><tr><td> <sup>Jurassic</sup> </td><td align="right"> <sup>455,70 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 575,28 </sup> </td></tr><tr><td> <sup>NiL</sup> </td><td align="right"> <sup>17,80 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>4 424,09 </sup> </td></tr></tbody></table><br><p>     .NET Core 2.0  : </p><br><table><thead><tr><th align="left"> <sup> </sup> </th><th align="left"> <sup> . </sup> </th><th align="left"> <sup>Gen 0  . .</sup> </th><th align="left"> <sup>Gen 1  . .</sup> </th><th align="left"> <sup>Gen 2  . .</sup> </th><th align="left"> <sup>    .</sup> </th></tr></thead><tbody><tr><td> <sup>Jint</sup> </td><td align="right"> <sup>24,87 </sup> </td><td align="right"> <sup>2 750,00</sup> </td><td align="right"> <sup>1 375,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>16 300,25 </sup> </td></tr><tr><td> <sup>Jurassic</sup> </td><td align="right"> <sup>469,97 </sup> </td><td align="right"> <sup>2 000,00</sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>15 511,70 </sup> </td></tr><tr><td> <sup>NiL</sup> </td><td align="right"> <sup>19,67 </sup> </td><td align="right"> <sup>1 000,00</sup> </td><td align="center"> <sup>-</sup> </td><td align="center"> <sup>-</sup> </td><td align="right"> <sup>4 419,95 </sup> </td></tr></tbody></table><br><p>       .        ,     (     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   </a> ).   ,   Jint        2016       ,       .   <a href="">   3.0.0 Beta 1353</a> ,    Jint    2,4  ,  NiL.JS  2.5.1200,        . </p><br><p>   NiL.JS  .         -  ,      -  ,    .    Bundle Transformer,  JavaScript Engine Switcher,     Hogan  Handlebars,      ReactJS.NET.              NiL.JS. </p><br><h2>  Refer√™ncias </h2><br><ol><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JavaScript Engine Switcher</a>  GitHub </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> JavaScript Engine Switcher</a> </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">¬´  JavaScript Engine Switcher 2.X¬ª</a> </li><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JSPool</a>  GitHub </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  ReactJS.NET</a> </li><li>   <a href="">ReactJS.NET</a>  GitHub </li></ol><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt439446/">https://habr.com/ru/post/pt439446/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt439432/index.html">Como se tornar um desenvolvedor Java em 1,5 anos</a></li>
<li><a href="../pt439434/index.html">NestJS - o mesmo back-end real no nodejs</a></li>
<li><a href="../pt439436/index.html">Redu√ß√£o de custos de pequenas s√©ries de eletr√¥nicos na R√∫ssia. WOLNA Internet Radio Case</a></li>
<li><a href="../pt439440/index.html">Implemente o c√≥digo aberto do Zimbra Collaboration, autorize via AD e crie caixas de correio automaticamente</a></li>
<li><a href="../pt439442/index.html">Julia. Geradores de relat√≥rios e documentos</a></li>
<li><a href="../pt439448/index.html">Que perguntas sobre virtualiza√ß√£o voc√™ espera uma resposta de um graduado?</a></li>
<li><a href="../pt439450/index.html">RS-485 em microcontroladores dom√©sticos da empresa Milander</a></li>
<li><a href="../pt439454/index.html">Programa como Arte - Um Novo Paradigma de Gerenciamento de Software</a></li>
<li><a href="../pt439456/index.html">Hipster Podcasts # 2</a></li>
<li><a href="../pt439458/index.html">Como traduzimos o site da Rep√∫blica em Kubernetes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>