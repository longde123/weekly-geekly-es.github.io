<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🔧 ✏️ 🍯 学习OpenGL。 第6.3课-基于图像的照明。 漫射 🚴🏼 🌇 👩🏾‍🤝‍👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="基于图像或IBL （ 基于图像的照明 ）的照明是一类照明方法，它不基于分析光源（在上一课中进行了讨论），而是将照明对象的整个环境视为一个连续光源。 在一般情况下，此类方法的技术基础在于处理环境的立方图（在现实世界中准备或在三维场景的基础上创建），以便存储在地图中的数据可直接用于照明计算：实际上，立方...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>学习OpenGL。 第6.3课-基于图像的照明。 漫射</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426987/"><img src="https://habrastorage.org/web/c9e/9b2/a3b/c9e9b2a3baf749ab8e2b385c6d93d966.png" alt="OGL3" align="left" width="300"> 基于图像或<i>IBL</i> （ <i>基于图像的照明</i> ）的照明是一类照明方法，它不基于分析光源（在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">上一课</a>中进行了讨论），而是将照明对象的整个环境视为一个连续光源。 在一般情况下，此类方法的技术基础在于处理环境的立方图（在现实世界中准备或在三维场景的基础上创建），以便存储在地图中的数据可直接用于照明计算：实际上，立方图的每个纹理像素都被视为光源。 通常，这使您可以捕获场景中全局照明的效果，这是传达当前场景的整体“色调”并帮助更好地“嵌入”照明对象的重要组件。 <br><br> 由于IBL算法考虑了某个“全局”环境中的照明，因此其结果被认为是对背景照明的更精确模拟，甚至是对全局照明的非常粗略的近似。 从结合到PBR模型的角度来看，这方面使IBL方法变得有趣，因为在照明模型中使用环境光可以使对象看起来在物理上更加正确。 <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">目录内容</b> <div class="spoiler_text"> 第1部分。入门 <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Opengl</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">窗口创建</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">你好窗口</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">你好三角形</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">着色器</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">贴图</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">转变</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">坐标系</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">摄影机</a> </li></ol><br> 第2部分。基本照明 <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">色彩</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">照明基础</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">用料</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">纹理贴图</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">光源</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">多种光源</a> </li></ol><br> 第3部分。下载3D模型 <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">阿辛普图书馆</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">网格多边形类</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3D模型类</a> </li></ol><br> 第4部分。高级OpenGL功能 <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">深度测试</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">模板测试</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">混色</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">裁剪面</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">帧缓冲</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">立方卡</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">先进的数据处理</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">高级GLSL</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">几何着色器</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">实例化</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">平滑处理</a> </li></ol><br> 第5部分。高级照明 <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">先进的照明。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Blinn-Fong模型。</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">伽玛校正</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">影子卡</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">全向阴影贴图</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">法线贴图</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">视差映射</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">高动态范围</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">布卢姆</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">延迟渲染</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SSAO</a> </li></ol><br> 第6部分。PBR <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">理论</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">分析光源</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">国际劳工联盟</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">漫反射。</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">国际劳工联盟</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">镜面曝光。</a> </li></ol><br></div></div><br> 为了将IBL的影响纳入已经描述的PBR系统中，我们返回熟悉的反射率方程： <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="MJXp-msubsup" id="MJXp-Span-2"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mrow" id="MJXp-Span-5"><span class="MJXp-mo" id="MJXp-Span-6" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7">p</span><span class="MJXp-mrow" id="MJXp-Span-8"><span class="MJXp-mo" id="MJXp-Span-9" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-10">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14">g</span><span class="MJXp-msubsup" id="MJXp-Span-15"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-17" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-mo" id="MJXp-Span-19" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-20" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-21">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-23">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24">t</span><span class="MJXp-mtext" id="MJXp-Span-25" style="color: red;">\极</span><span class="MJXp-msubsup" id="MJXp-Span-26"><span class="MJXp-mrow" id="MJXp-Span-27" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-28" style="margin-left: 0.278em; margin-right: 0.278em;">限</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-29" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-30">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-33">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-35">a</span></span></span><span class="MJXp-mrow" id="MJXp-Span-36"><span class="MJXp-mo" id="MJXp-Span-37" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-msubsup" id="MJXp-Span-38"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-40" style="vertical-align: -0.4em;">d</span></span><span class="MJXp-mtext" id="MJXp-Span-41">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-42">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45">c</span><span class="MJXp-mrow" id="MJXp-Span-46"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-47">c</span></span><span class="MJXp-mrow" id="MJXp-Span-48"><span class="MJXp-mtext" id="MJXp-Span-49">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51">i</span></span><span class="MJXp-mo" id="MJXp-Span-52" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-53"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-55" style="vertical-align: -0.4em;">s</span></span><span class="MJXp-mtext" id="MJXp-Span-56">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">c</span><span class="MJXp-mrow" id="MJXp-Span-61"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-63">F</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64">G</span></span><span class="MJXp-mrow" id="MJXp-Span-65"><span class="MJXp-mn" id="MJXp-Span-66">4</span><span class="MJXp-mrow" id="MJXp-Span-67"><span class="MJXp-mo" id="MJXp-Span-68" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-69">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-72">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-73">g</span><span class="MJXp-msubsup" id="MJXp-Span-74"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-75" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-76" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mtext" id="MJXp-Span-77">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-79">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-80">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82">n</span><span class="MJXp-mrow" id="MJXp-Span-83"><span class="MJXp-mo" id="MJXp-Span-84" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mrow" id="MJXp-Span-85"><span class="MJXp-mo" id="MJXp-Span-86" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-87">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-88">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-89">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91">g</span><span class="MJXp-msubsup" id="MJXp-Span-92"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-93" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-94" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mtext" id="MJXp-Span-95">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-99">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-100">n</span><span class="MJXp-mrow" id="MJXp-Span-101"><span class="MJXp-mo" id="MJXp-Span-102" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span><span class="MJXp-mrow" id="MJXp-Span-103"><span class="MJXp-mo" id="MJXp-Span-104" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-msubsup" id="MJXp-Span-105"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-107" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-108"><span class="MJXp-mo" id="MJXp-Span-109" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-110">p</span><span class="MJXp-mrow" id="MJXp-Span-111"><span class="MJXp-mo" id="MJXp-Span-112" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-113">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">g</span><span class="MJXp-msubsup" id="MJXp-Span-118"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-120" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-121"><span class="MJXp-mo" id="MJXp-Span-122" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">n</span><span class="MJXp-mtext" id="MJXp-Span-124">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128">t</span><span class="MJXp-mtext" id="MJXp-Span-129">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-133">g</span><span class="MJXp-msubsup" id="MJXp-Span-134"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-136" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">d</span><span class="MJXp-mtext" id="MJXp-Span-138">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-142">g</span><span class="MJXp-msubsup" id="MJXp-Span-143"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-144" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-145" style="vertical-align: -0.4em;">i</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="144.033ex" height="2.901ex" viewBox="0 -832 62014 1249" role="img" focusable="false" style="vertical-align: -0.969ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6F" x="963" y="-213"></use><g transform="translate(1124,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-70" x="1954" y="0"></use><g transform="translate(2458,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6F" x="3538" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6D" x="4023" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-65" x="4902" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-67" x="5368" y="0"></use><g transform="translate(5849,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6F" x="748" y="-213"></use></g><g transform="translate(6822,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMAIN-3D" x="7929" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-69" x="9236" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6E" x="9581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-74" x="10182" y="0"></use><g fill="red" stroke="red" transform="translate(10543,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">极</text></g></g><g transform="translate(11874,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">限</text><g transform="translate(829,-191)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-4F" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6D" x="1117" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-65" x="1995" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-67" x="2462" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-61" x="2942" y="0"></use></g></g><g transform="translate(15259,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><g transform="translate(16089,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-64" x="737" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-66" x="17330" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-72" x="17881" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-61" x="18332" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-63" x="18862" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-63" x="19295" y="0"></use><g transform="translate(19729,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-69" x="753" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMAIN-2B" x="21050" y="0"></use><g transform="translate(22051,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-73" x="737" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-66" x="23254" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-72" x="23805" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-61" x="24256" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-63" x="24786" y="0"></use><g transform="translate(25219,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-46" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-47" x="1578" y="0"></use></g><g transform="translate(27584,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMAIN-34" x="0" y="0"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6F" x="1580" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6D" x="2065" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-65" x="2944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-67" x="3410" y="0"></use><g transform="translate(3891,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-63" x="5114" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-64" x="5547" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6F" x="6071" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-74" x="6556" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6E" x="6918" y="0"></use><g transform="translate(7518,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><g transform="translate(8348,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6F" x="9428" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6D" x="9914" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-65" x="10792" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-67" x="11259" y="0"></use><g transform="translate(11739,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-63" x="12863" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-64" x="13297" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6F" x="13820" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-74" x="14306" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6E" x="14667" y="0"></use><g transform="translate(15268,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g><g transform="translate(43682,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><g transform="translate(44512,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-69" x="963" y="-213"></use></g><g transform="translate(45538,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-70" x="46368" y="0"></use><g transform="translate(46871,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6F" x="47951" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6D" x="48437" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-65" x="49315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-67" x="49782" y="0"></use><g transform="translate(50262,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-69" x="748" y="-213"></use></g><g transform="translate(51136,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6E" x="51966" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-63" x="52816" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-64" x="53250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6F" x="53773" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-74" x="54259" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6F" x="54870" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6D" x="55356" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-65" x="56234" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-67" x="56701" y="0"></use><g transform="translate(57181,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-64" x="58055" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6F" x="58829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-6D" x="59314" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-65" x="60193" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-67" x="60659" y="0"></use><g transform="translate(61140,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-69" x="748" y="-213"></use></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> L_o（p，\ omega_o）= \ int \极限_ {\ Omega}（k_d \ frac {c} {\ pi} + k_s \ frac {DFG} {4（\ omega_o \ cdot n）（\ omega_i \ cdot n ）}）L_i（p，\ omega_i）n \ cdot \ omega_i d \ omega_i </script></p><br> 如前所述，主要目标是计算所有入射辐射方向的积分 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-146"><span class="MJXp-msubsup" id="MJXp-Span-147"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-148" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-149" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-69" x="1013" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> w_i </script> 半球 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-150"><span class="MJXp-mtext" id="MJXp-Span-151" style="color: red;">\欧</span><span class="MJXp-mrow" id="MJXp-Span-152"><span class="MJXp-mo" id="MJXp-Span-153" style="margin-left: 0.278em; margin-right: 0.278em;">米</span></span><span class="MJXp-mrow" id="MJXp-Span-154"><span class="MJXp-mo" id="MJXp-Span-155" style="margin-left: 0.278em; margin-right: 0.278em;">茄</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.946ex" height="2.66ex" viewBox="0 -832 2990.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g fill="red" stroke="red"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMAIN-5C"></use><g transform="translate(500,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">欧</text></g></g><g transform="translate(1330,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">米</text></g><g transform="translate(2160,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">茄</text></g></g></svg></span><script type="math/tex" id="MathJax-Element-3"> \欧米茄</script>  。 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">上一课中，</a>积分<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的</a>计算并不繁琐，因为我们预先知道了光源的数量，因此，我们知道了与它们对应的所有几个光入射方向。 同时，积分不能迅速解决： <u>任何</u>下降向量 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-156"><span class="MJXp-msubsup" id="MJXp-Span-157"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-159" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-69" x="1013" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> w_i </script> 从环境中可以携带非零能量的亮度。 因此，对于该方法的实际适用性，需要满足以下要求： <br><ul><li> 您需要想出一种方法来获取任意方向向量的场景能量亮度 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-160"><span class="MJXp-msubsup" id="MJXp-Span-161"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-163" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-69" x="1013" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> w_i </script>  ; </li><li> 积分的求解必须实时发生。 </li></ul><br> 好吧，第一点是自己解决的。 一种解决方案的提示已经在这里溜走了：表示场景或环境辐射的一种方法是经过特殊处理的立方图。 这样的映射中的每个纹理像素可以被视为单独的发射源。 通过根据任意向量从此类映射中采样 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-164"><span class="MJXp-msubsup" id="MJXp-Span-165"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-166" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-167" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-69" x="1013" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> w_i </script> 我们很容易获得该方向上场景的能量亮度。 <br><br> 因此，我们获得了任意矢量的场景能量亮度 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-168"><span class="MJXp-msubsup" id="MJXp-Span-169"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-170" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-171" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/426987/&amp;usg=ALkJrhh0rnc4sNPMlPQROqFJrL5BDabm1A#MJMATHI-69" x="1013" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-7"> w_i </script>  ： <br><br><pre><code class="plaintext hljs">vec3 radiance = texture(_cubemapEnvironment, w_i).rgb;</code> </pre> <br> 然而，值得注意的是，求解积分需要我们从环境地图中提取样本，而不是从一个方向，而是从半球中的所有可能样本中提取样本。 如此-对于每个阴影片段。 显然，对于实时任务，这实际上是不可行的。 一种更有效的方法是即使在我们的应用程序之外，也要预先计算部分被积运算。 但是为此，您将不得不袖手旁观，并深入探究反射率表达的本质： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-172"><span class="MJXp-msubsup" id="MJXp-Span-173"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-175" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mrow" id="MJXp-Span-176"><span class="MJXp-mo" id="MJXp-Span-177" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-178">p</span><span class="MJXp-mrow" id="MJXp-Span-179"><span class="MJXp-mo" id="MJXp-Span-180" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-181">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-183">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-184">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185">g</span><span class="MJXp-msubsup" id="MJXp-Span-186"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-187" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-188" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mrow" id="MJXp-Span-189"><span class="MJXp-mo" id="MJXp-Span-190" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-191" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-192">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-193">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-194">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195">t</span><span class="MJXp-mtext" id="MJXp-Span-196" style="color: red;">\极</span><span class="MJXp-msubsup" id="MJXp-Span-197"><span class="MJXp-mrow" id="MJXp-Span-198" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-199" style="margin-left: 0.278em; margin-right: 0.278em;">限</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-200" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-201">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-202">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-203">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-204">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-206">a</span></span></span><span class="MJXp-mrow" id="MJXp-Span-207"><span class="MJXp-mo" id="MJXp-Span-208" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-msubsup" id="MJXp-Span-209"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-210" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-211" style="vertical-align: -0.4em;">d</span></span><span class="MJXp-mtext" id="MJXp-Span-212">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-213">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-215">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-216">c</span><span class="MJXp-mrow" id="MJXp-Span-217"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-218">c</span></span><span class="MJXp-mrow" id="MJXp-Span-219"><span class="MJXp-mtext" id="MJXp-Span-220">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-222">i</span></span><span class="MJXp-mo" id="MJXp-Span-223" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-224"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-225" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-226" style="vertical-align: -0.4em;">s</span></span><span class="MJXp-mtext" id="MJXp-Span-227">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-229">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-230">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231">c</span><span class="MJXp-mrow" id="MJXp-Span-232"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-234">F</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235">G</span></span><span class="MJXp-mrow" id="MJXp-Span-236"><span class="MJXp-mn" id="MJXp-Span-237">4</span><span class="MJXp-mrow" id="MJXp-Span-238"><span class="MJXp-mo" id="MJXp-Span-239" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-240">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-243">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-244">g</span><span class="MJXp-msubsup" id="MJXp-Span-245"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-246" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-247" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mtext" id="MJXp-Span-248">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-249">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-250">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-251">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-252">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-253">n</span><span class="MJXp-mrow" id="MJXp-Span-254"><span class="MJXp-mo" id="MJXp-Span-255" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mrow" id="MJXp-Span-256"><span class="MJXp-mo" id="MJXp-Span-257" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-258">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-259">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-261">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-262">g</span><span class="MJXp-msubsup" id="MJXp-Span-263"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-264" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-265" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mtext" id="MJXp-Span-266">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-268">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-269">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-271">n</span><span class="MJXp-mrow" id="MJXp-Span-272"><span class="MJXp-mo" id="MJXp-Span-273" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span><span class="MJXp-mrow" id="MJXp-Span-274"><span class="MJXp-mo" id="MJXp-Span-275" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-msubsup" id="MJXp-Span-276"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-277" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-278" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-279"><span class="MJXp-mo" id="MJXp-Span-280" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-281">p</span><span class="MJXp-mrow" id="MJXp-Span-282"><span class="MJXp-mo" id="MJXp-Span-283" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-284">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-285">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-286">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-287">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-288">g</span><span class="MJXp-msubsup" id="MJXp-Span-289"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-290" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-291" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-292"><span class="MJXp-mo" id="MJXp-Span-293" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-294">n</span><span class="MJXp-mtext" id="MJXp-Span-295">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-296">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-297">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-298">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-299">t</span><span class="MJXp-mtext" id="MJXp-Span-300">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-301">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-302">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-303">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304">g</span><span class="MJXp-msubsup" id="MJXp-Span-305"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-306" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-307" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-308">d</span><span class="MJXp-mtext" id="MJXp-Span-309">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-310">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-311">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-312">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-313">g</span><span class="MJXp-msubsup" id="MJXp-Span-314"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-315" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-316" style="vertical-align: -0.4em;">i</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-8"> L_o（p，\ omega_o）= \ int \极限_ {\ Omega}（k_d \ frac {c} {\ pi} + k_s \ frac {DFG} {4（\ omega_o \ cdot n）（\ omega_i \ cdot n ）}）L_i（p，\ omega_i）n \ cdot \ omega_i d \ omega_i </script></p><br><br> 可以看出，与扩散相关的部分 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-317"><span class="MJXp-msubsup" id="MJXp-Span-318"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-319" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-320" style="vertical-align: -0.4em;">d</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-9"> k_d </script> 和镜子 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-321"><span class="MJXp-msubsup" id="MJXp-Span-322"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-323" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-324" style="vertical-align: -0.4em;">s</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-10"> k_s </script>  BRDF组件是独立的。 您可以将积分分为两部分： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-325"><span class="MJXp-msubsup" id="MJXp-Span-326"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-327" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-328" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mrow" id="MJXp-Span-329"><span class="MJXp-mo" id="MJXp-Span-330" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331">p</span><span class="MJXp-mrow" id="MJXp-Span-332"><span class="MJXp-mo" id="MJXp-Span-333" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-334">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-335">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-336">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-337">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-338">g</span><span class="MJXp-msubsup" id="MJXp-Span-339"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-340" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-341" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mrow" id="MJXp-Span-342"><span class="MJXp-mo" id="MJXp-Span-343" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-344" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-345">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-346">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-347">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-348">t</span><span class="MJXp-mtext" id="MJXp-Span-349" style="color: red;">\极</span><span class="MJXp-msubsup" id="MJXp-Span-350"><span class="MJXp-mrow" id="MJXp-Span-351" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-352" style="margin-left: 0.278em; margin-right: 0.278em;">限</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-353" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-354">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-355">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-356">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-357">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-358">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-359">a</span></span></span><span class="MJXp-mrow" id="MJXp-Span-360"><span class="MJXp-mo" id="MJXp-Span-361" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-msubsup" id="MJXp-Span-362"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-363" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-364" style="vertical-align: -0.4em;">d</span></span><span class="MJXp-mtext" id="MJXp-Span-365">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-366">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-367">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-368">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-369">c</span><span class="MJXp-mrow" id="MJXp-Span-370"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-371">c</span></span><span class="MJXp-mrow" id="MJXp-Span-372"><span class="MJXp-mtext" id="MJXp-Span-373">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-374">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-375">i</span></span><span class="MJXp-mrow" id="MJXp-Span-376"><span class="MJXp-mo" id="MJXp-Span-377" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-msubsup" id="MJXp-Span-378"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-379" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-380" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-381"><span class="MJXp-mo" id="MJXp-Span-382" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-383">p</span><span class="MJXp-mrow" id="MJXp-Span-384"><span class="MJXp-mo" id="MJXp-Span-385" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-386">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-387">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-388">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-389">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-390">g</span><span class="MJXp-msubsup" id="MJXp-Span-391"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-392" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-393" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-394"><span class="MJXp-mo" id="MJXp-Span-395" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-396">n</span><span class="MJXp-mtext" id="MJXp-Span-397">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-398">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-399">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-400">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-401">t</span><span class="MJXp-mtext" id="MJXp-Span-402">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-403">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-404">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-405">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-406">g</span><span class="MJXp-msubsup" id="MJXp-Span-407"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-408" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-409" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-410">d</span><span class="MJXp-mtext" id="MJXp-Span-411">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-412">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-413">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-414">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-415">g</span><span class="MJXp-msubsup" id="MJXp-Span-416"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-417" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-418" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-419" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mtext" id="MJXp-Span-420">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-421">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-422">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-423">t</span><span class="MJXp-mtext" id="MJXp-Span-424" style="color: red;">\极</span><span class="MJXp-msubsup" id="MJXp-Span-425"><span class="MJXp-mrow" id="MJXp-Span-426" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-427" style="margin-left: 0.278em; margin-right: 0.278em;">限</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-428" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-429">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-430">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-431">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-432">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-433">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-434">a</span></span></span><span class="MJXp-mrow" id="MJXp-Span-435"><span class="MJXp-mo" id="MJXp-Span-436" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-msubsup" id="MJXp-Span-437"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-438" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-439" style="vertical-align: -0.4em;">s</span></span><span class="MJXp-mtext" id="MJXp-Span-440">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-441">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-442">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-443">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-444">c</span><span class="MJXp-mrow" id="MJXp-Span-445"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-446">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-447">F</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-448">G</span></span><span class="MJXp-mrow" id="MJXp-Span-449"><span class="MJXp-mn" id="MJXp-Span-450">4</span><span class="MJXp-mrow" id="MJXp-Span-451"><span class="MJXp-mo" id="MJXp-Span-452" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-453">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-454">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-455">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-456">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-457">g</span><span class="MJXp-msubsup" id="MJXp-Span-458"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-459" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-460" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mtext" id="MJXp-Span-461">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-462">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-463">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-464">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-465">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-466">n</span><span class="MJXp-mrow" id="MJXp-Span-467"><span class="MJXp-mo" id="MJXp-Span-468" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mrow" id="MJXp-Span-469"><span class="MJXp-mo" id="MJXp-Span-470" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mtext" id="MJXp-Span-471">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-472">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-473">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-474">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-475">g</span><span class="MJXp-msubsup" id="MJXp-Span-476"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-477" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-478" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mtext" id="MJXp-Span-479">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-480">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-481">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-482">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-483">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-484">n</span><span class="MJXp-mrow" id="MJXp-Span-485"><span class="MJXp-mo" id="MJXp-Span-486" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span><span class="MJXp-mrow" id="MJXp-Span-487"><span class="MJXp-mo" id="MJXp-Span-488" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-msubsup" id="MJXp-Span-489"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-490" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-491" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-492"><span class="MJXp-mo" id="MJXp-Span-493" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-494">p</span><span class="MJXp-mrow" id="MJXp-Span-495"><span class="MJXp-mo" id="MJXp-Span-496" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-497">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-498">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-499">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-500">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-501">g</span><span class="MJXp-msubsup" id="MJXp-Span-502"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-503" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-504" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-505"><span class="MJXp-mo" id="MJXp-Span-506" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-507">n</span><span class="MJXp-mtext" id="MJXp-Span-508">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-509">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-510">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-511">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-512">t</span><span class="MJXp-mtext" id="MJXp-Span-513">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-514">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-515">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-516">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-517">g</span><span class="MJXp-msubsup" id="MJXp-Span-518"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-519" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-520" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-521">d</span><span class="MJXp-mtext" id="MJXp-Span-522">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-523">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-524">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-525">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-526">g</span><span class="MJXp-msubsup" id="MJXp-Span-527"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-528" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-529" style="vertical-align: -0.4em;">i</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-11"> L_o（p，\ omega_o）= \ int \极限_ {\ Omega}（k_d \ frac {c} {\ pi}）L_i（p，\ omega_i）n \ cdot \ omega_i d \ omega_i + \ int \极限_ { \ Omega}（k_s \ frac {DFG} {4（\ omega_o \ cdot n）（\ omega_i \ cdot n）}）L_i（p，\ omega_i）n \ cdot \ omega_i d \ omega_i </script></p><br><br> 这样划分的部分将使我们能够分别处理每个部分，在本课程中，我们将处理负责漫射照明的部分。 <br><br> 分析了扩散分量上的积分形式后，我们可以得出结论，朗伯扩散分量本质上是常数（颜色 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-530"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-531">s</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-12"> s </script> 折光率 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-532"><span class="MJXp-msubsup" id="MJXp-Span-533"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-534" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-535" style="vertical-align: -0.4em;">d</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-13"> k_d </script> 和 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-536"><span class="MJXp-mtext" id="MJXp-Span-537">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-538">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-539">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> \ pi </script> 在被积数条件下是常数），并且不依赖于其他变量。 鉴于这一事实，我们可以将常量放在积分的符号之外： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-540"><span class="MJXp-msubsup" id="MJXp-Span-541"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-542" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-543" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mrow" id="MJXp-Span-544"><span class="MJXp-mo" id="MJXp-Span-545" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-546">p</span><span class="MJXp-mrow" id="MJXp-Span-547"><span class="MJXp-mo" id="MJXp-Span-548" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-549">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-550">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-551">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-552">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-553">g</span><span class="MJXp-msubsup" id="MJXp-Span-554"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-555" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-556" style="vertical-align: -0.4em;">o</span></span><span class="MJXp-mrow" id="MJXp-Span-557"><span class="MJXp-mo" id="MJXp-Span-558" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mo" id="MJXp-Span-559" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-560"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-561" style="margin-right: 0.05em;">k</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-562" style="vertical-align: -0.4em;">d</span></span><span class="MJXp-mtext" id="MJXp-Span-563">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-564">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-565">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-566">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-567">c</span><span class="MJXp-mrow" id="MJXp-Span-568"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-569">c</span></span><span class="MJXp-mrow" id="MJXp-Span-570"><span class="MJXp-mtext" id="MJXp-Span-571">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-572">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-573">i</span></span><span class="MJXp-mtext" id="MJXp-Span-574">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-575">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-576">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-577">t</span><span class="MJXp-mtext" id="MJXp-Span-578" style="color: red;">\极</span><span class="MJXp-msubsup" id="MJXp-Span-579"><span class="MJXp-mrow" id="MJXp-Span-580" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-581" style="margin-left: 0.278em; margin-right: 0.278em;">限</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-582" style="vertical-align: -0.4em;"><span class="MJXp-mtext" id="MJXp-Span-583">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-584">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-585">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-586">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-587">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-588">a</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-589"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-590" style="margin-right: 0.05em;">L</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-591" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-592"><span class="MJXp-mo" id="MJXp-Span-593" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-594">p</span><span class="MJXp-mrow" id="MJXp-Span-595"><span class="MJXp-mo" id="MJXp-Span-596" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-mtext" id="MJXp-Span-597">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-598">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-599">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-600">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-601">g</span><span class="MJXp-msubsup" id="MJXp-Span-602"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-603" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-604" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-605"><span class="MJXp-mo" id="MJXp-Span-606" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-607">n</span><span class="MJXp-mtext" id="MJXp-Span-608">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-609">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-610">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-611">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-612">t</span><span class="MJXp-mtext" id="MJXp-Span-613">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-614">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-615">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-616">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-617">g</span><span class="MJXp-msubsup" id="MJXp-Span-618"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-619" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-620" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-621">d</span><span class="MJXp-mtext" id="MJXp-Span-622">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-623">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-624">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-625">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-626">g</span><span class="MJXp-msubsup" id="MJXp-Span-627"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-628" style="margin-right: 0.05em;">a</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-629" style="vertical-align: -0.4em;">i</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-15"> L_o（p，\ omega_o）= k_d \ frac {c} {\ pi} \ int \极限_ {\ Omega} L_i（p，\ omega_i）n \ cdot \ omega_i d \ omega_i </script></p><br><br> 所以我们得到一个积分，仅取决于 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-630"><span class="MJXp-msubsup" id="MJXp-Span-631"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-632" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-633" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-16"> w_i </script>  （假设 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-634"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-635">p</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> p </script> 对应于环境立方图的中心）。 根据此公式，您可以计算甚至更好地预先计​​算一个新的三次方图，该图存储了针对样本每个方向的漫射分量积分（或纹理图）的计算结果。 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-636"><span class="MJXp-msubsup" id="MJXp-Span-637"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-638" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-639" style="vertical-align: -0.4em;">o</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-18"> w_o </script> 使用卷积运算。 <br><br> 卷积是对数据集中的每个元素进行某种计算，同时考虑到数据集中所有其他元素的数据的操作。 在这种情况下，此类数据是场景或环境图的能量亮度。 因此，要计算三次方图中每个样本方向的值，我们必须考虑取自样本点周围半球中样本所有其他可能方向的值。 <br><br> 要对环境图进行卷积，您需要为每个样本得出的方向求解积分 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-640"><span class="MJXp-msubsup" id="MJXp-Span-641"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-642" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-643" style="vertical-align: -0.4em;">o</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-19"> w_o </script> 通过沿方向执行多个离散样本 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-644"><span class="MJXp-msubsup" id="MJXp-Span-645"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-646" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-647" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-20"> w_i </script> 属于半球 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-648"><span class="MJXp-mtext" id="MJXp-Span-649" style="color: red;">\欧</span><span class="MJXp-mrow" id="MJXp-Span-650"><span class="MJXp-mo" id="MJXp-Span-651" style="margin-left: 0.278em; margin-right: 0.278em;">米</span></span><span class="MJXp-mrow" id="MJXp-Span-652"><span class="MJXp-mo" id="MJXp-Span-653" style="margin-left: 0.278em; margin-right: 0.278em;">茄</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-21"> \欧米茄</script>  ，然后平均总能量亮度。 半球，在此基础上获取采样方向 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-654"><span class="MJXp-msubsup" id="MJXp-Span-655"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-656" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-657" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-22"> w_i </script> 沿矢量取向 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-658"><span class="MJXp-msubsup" id="MJXp-Span-659"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-660" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-661" style="vertical-align: -0.4em;">o</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-23"> w_o </script> 表示要为其计算当前卷积的目标方向。 看一下图片以获得更好的理解： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pr/yl/ql/prylqltlmqjlvfhpaswbes8bmg8.png"></div><br><br> 这种预先计算的三次方图，用于存储样本每个方向的积分结果 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-662"><span class="MJXp-msubsup" id="MJXp-Span-663"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-664" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-665" style="vertical-align: -0.4em;">o</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-24"> w_o </script> 也可以视为存储将入射在沿方向定向的某个表面上的场景中所有间接漫射照明求和的结果求和 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-666"><span class="MJXp-msubsup" id="MJXp-Span-667"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-668" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-669" style="vertical-align: -0.4em;">o</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-25"> w_o </script>  。 换句话说，此类立方贴图称为辐照度贴图，因为卷积前的立方环境贴图使您可以直接从任意方向采样场景照射的幅度 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-670"><span class="MJXp-msubsup" id="MJXp-Span-671"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-672" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-673" style="vertical-align: -0.4em;">o</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-26"> w_o </script>  ，无需进行其他计算。 <br><blockquote> 确定能量亮度的表达式还取决于采样点的位置 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-674"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-675">p</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-27"> p </script> 我们正好躺在辐射图的中心。 在所有间接漫射照明的源也将是单个环境图的意义上，此假设施加了限制。 在灯光异质的场景中，这可能会破坏现实的幻觉（尤其是在室内场景中）。 现代渲染引擎通过在场景<i>反射探测器中</i>放置特殊的辅助对象来解决此问题。 每个这样的对象都从事一项任务：它针对其周围环境形成自己的辐照图。 使用这种技术，可以在任意点照射（和能量亮度） <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-676"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-677">p</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-28"> p </script> 将由最近的反射样本之间的简单插值确定。 但是对于当前的任务，我们同意环境地图是从其中心采样的，我们将在进一步的课程中分析反射样本。 </blockquote> 下面是环境的三次方图和从中得出的辐照图（基于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">波引擎</a> ）的示例，该图对每个输出方向的环境能量亮度进行平均 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-678"><span class="MJXp-msubsup" id="MJXp-Span-679"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-680" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-681" style="vertical-align: -0.4em;">o</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-29"> w_o </script>  。 <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8c/qz/yg/8cqzygcmwfdkdcadui_iqrtj4rw.png"></div><br> 因此，此卡将卷积结果存储在每个纹理像素中（对应于方向 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-682"><span class="MJXp-msubsup" id="MJXp-Span-683"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-684" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-685" style="vertical-align: -0.4em;">o</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-30"> w_o </script>  ），从外观上看，这样的地图看起来就像存储环境地图的平均颜色。 从该图向任何方向的样本将返回从该方向发出的辐射值。 <br><br><h2>  PBR和HDR </h2><br> 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">上一课中</a> ，已经简要地指出，对于PBR照明模型的正确操作，考虑到存在的光源的HDR亮度范围非常重要。 由于输入端的PBR模型基于非常具体的物理量和特性以一种或另一种方式接受参数，因此逻辑上要求光源的能量亮度与其实际原型相匹配。 无论如何证明每种光源的辐射通量的值都没有关系：进行粗略的工程估算或转换为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">物理量</a> -在任何情况下，室内灯和太阳之间的特性差异都将是巨大的。 如果不使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">HDR</a>范围，将无法准确确定各种光源的相对亮度。 <br><br> 因此，PBR和HDR永远是朋友，这是可以理解的，但是这个事实与基于图像的照明方法有什么关系？ 在上一课中，我们证明了将PBR转换为HDR渲染范围很容易。 还有一个“但是”：由于来自环境的间接照明是基于环境的三次方图，因此需要一种在环境图中保留此背景照明的HDR特性的方法。 <br><br> 到目前为止，我们一直使用以LDR格式创建的环境地图（例如<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">skyboxes</a> ）。 我们使用它们中的颜色样本照原样进行渲染，这对于直接阴影对象是完全可以接受的。 当使用环境图作为物理可靠的测量源时，这是完全不合适的。 <br><br><h4>  RGBE-HDR图像格式 </h4><br> 熟悉RGBE图像文件格式。 扩展名为“ <i>.hdr</i> ”的文件用于存储动态范围很宽的图像，为三色一组的每个元素分配一个字节，为公共指数分配一个字节。 该格式还允许您存储颜色强度范围超出LDR范围[0.，1.]的立方环境贴图。 这意味着光源可以保持其真实强度，由这种环境图表示。 <br><br> 该网络有很多RGBE格式的免费环境地图，可以在各种实际条件下拍摄。 这是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">sIBL存档</a>站点中的示例： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fa/ua/aq/fauaaqkw63r9dnghjofu83o-h2i.png"></div><br> 您可能会对看到的结果感到惊讶：毕竟，此扭曲的图像根本看起来不像是一张具有明显分解成6个面的规则立方图。 解释很简单：环境图是从球体投影到平面上的-应用了<i>等距矩形扫描</i> 。 这样做是为了能够以不支持立方卡的存储模式的格式原样存储。 当然，这种投影方法有其缺点：水平分辨率远高于垂直分辨率。 在大多数渲染应用中，这是可以接受的比率，因为通常有趣的环境和照明细节完全位于水平面，而不位于垂直平面。 好吧，加上所有内容，我们需要将转换代码返回到立方图。 <br><br><h4> 在stb_image.h中支持RGBE格式 </h4><br> 自行下载此图像格式需要了解<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">格式规范</a> ，这并不困难，但仍然很费力。 对<a href="">我们来说</a>幸运的是，在单个头文件中实现的<a href="">stb_image.h</a>图像加载库支持加载RGBE文件，返回浮点数数组-我们需要达到目的！ 在您的项目中添加一个库，加载图像数据非常简单： <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stb_image.h"</span></span></span><span class="hljs-meta"> [...] stbi_set_flip_vertically_on_load(true); int width, height, nrComponents; float *data = stbi_loadf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"newport_loft.hdr"</span></span></span><span class="hljs-meta">, &amp;width, &amp;height, &amp;nrComponents, 0); unsigned int hdrTexture; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (data) { glGenTextures(1, &amp;hdrTexture); glBindTexture(GL_TEXTURE_2D, hdrTexture); glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB16F, width, height, 0, GL_RGB, GL_FLOAT, data); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR); stbi_image_free(data); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { std::cout &lt;&lt; </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Failed to load HDR image."</span></span></span><span class="hljs-meta"> &lt;&lt; std::endl; }</span></span></code> </pre> <br> 该库自动将值从内部HDR格式转换为常规的真实32位数字，默认情况下具有三个颜色通道。 将原始HDR图像的数据保存为普通的2D浮点纹理就足够了。 <br><br><h4> 将等角度扫描转换为立方图 </h4><br> 可以使用相等的矩形扫描从环境图直接选择样本，但是，这将需要昂贵的数学运算，而从法线立方图进行获取实际上将没有性能。 正是基于这些考虑，在本课程中，我们将处理将相等的矩形图像转换为立方图的过程，稍后再使用。 但是，此处还将显示使用三维矢量从等角矩形图中直接采样的方法，以便您可以选择适合自己的工作方法。 <br><br> 要进行转换，您需要绘制一个单位大小的立方体，从内部对其进行观察，在其面上投影等距矩形图，然后从这些面中提取六张图像作为立方体图的面。 此阶段的顶点着色器非常简单：它仅按原样处理多维数据集的顶点，并将它们的未变形位置传递给片段着色器以用作三维样本矢量： <br><br><pre> <code class="plaintext hljs">#version 330 core layout (location = 0) in vec3 aPos; out vec3 localPos; uniform mat4 projection; uniform mat4 view; void main() { localPos = aPos; gl_Position = projection * view * vec4(localPos, 1.0); }</code> </pre> <br> 在片段着色器中，我们对立方体的每个面都进行着色，就好像我们试图用一张具有相等矩形贴图的图纸轻轻地包裹立方体一样。 为此，采用转移到片段着色器的样本方向，并通过特殊的三角魔术方法进行处理，最后，从等矩形贴图进行选择，就好像它实际上是三次贴图一样。 选择结果将直接保存为立方体面片段的颜色： <br><br><pre> <code class="plaintext hljs">#version 330 core out vec4 FragColor; in vec3 localPos; uniform sampler2D equirectangularMap; const vec2 invAtan = vec2(0.1591, 0.3183); vec2 SampleSphericalMap(vec3 v) { vec2 uv = vec2(atan(vz, vx), asin(vy)); uv *= invAtan; uv += 0.5; return uv; } void main() { // localPos   vec2 uv = SampleSphericalMap(normalize(localPos)); vec3 color = texture(equirectangularMap, uv).rgb; FragColor = vec4(color, 1.0); }</code> </pre> <br> 如果实际上使用此着色器和关联的HDR环境贴图绘制一个多维数据集，则会得到以下内容： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wi/xl/u2/wixlu2m9jwpr9d6oakhw7_nqcqa.png"></div><br> 即 可以看出，实际上我们将矩形纹理投影到了立方体上。 太好了，但这如何帮助我们创建真实的立方图？ 要结束此任务，有必要使用摄像机看着每个面将同一个立方体渲染6次，同时将输出写入单独的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">帧缓冲区</a>对象： <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> captureFBO, captureRBO; glGenFramebuffers(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;captureFBO); glGenRenderbuffers(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;captureRBO); glBindFramebuffer(GL_FRAMEBUFFER, captureFBO); glBindRenderbuffer(GL_RENDERBUFFER, captureRBO); glRenderbufferStorage(GL_RENDERBUFFER, GL_DEPTH_COMPONENT24, <span class="hljs-number"><span class="hljs-number">512</span></span>, <span class="hljs-number"><span class="hljs-number">512</span></span>); glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_DEPTH_ATTACHMENT, GL_RENDERBUFFER, captureRBO);</code> </pre> <br> 当然，我们不会忘记组织用于存储未来立方图的六个面中每个面的内存： <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> envCubemap; glGenTextures(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;envCubemap); glBindTexture(GL_TEXTURE_CUBE_MAP, envCubemap); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">6</span></span>; ++i) { <span class="hljs-comment"><span class="hljs-comment">//  ,     // 16     glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, GL_RGB16F, 512, 512, 0, GL_RGB, GL_FLOAT, nullptr); } glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER, GL_LINEAR); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MAG_FILTER, GL_LINEAR);</span></span></code> </pre><br> 进行此准备后，仅需直接在立方贴图的边缘进行等矩形贴图的各个部分的转移。 <br><br> 我们不会赘述过多，尤其是因为代码重复了在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">帧缓冲区</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">全向阴影</a>中的课程中看到的内容。 原则上，这一切都归结为准备六个单独的视图矩阵，将相机严格地定向到立方体的每个面，以及一个特殊的投影矩阵，其视角为90°以捕获立方体的整个面。 然后，仅执行六次渲染，并将结果保存在浮点帧缓冲区中： <br><br><pre> <code class="cpp hljs">glm::mat4 captureProjection = glm::perspective(glm::radians(<span class="hljs-number"><span class="hljs-number">90.0f</span></span>), <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.1f</span></span>, <span class="hljs-number"><span class="hljs-number">10.0f</span></span>); glm::mat4 captureViews[] = { glm::lookAt(glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3( <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>)), glm::lookAt(glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3(<span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>)), glm::lookAt(glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3( <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>)), glm::lookAt(glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3( <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>)), glm::lookAt(glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3( <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>), glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>)), glm::lookAt(glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3( <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>), glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>)) }; <span class="hljs-comment"><span class="hljs-comment">//  HDR        equirectangularToCubemapShader.use(); equirectangularToCubemapShader.setInt("equirectangularMap", 0); equirectangularToCubemapShader.setMat4("projection", captureProjection); glActiveTexture(GL_TEXTURE0); glBindTexture(GL_TEXTURE_2D, hdrTexture); //         glViewport(0, 0, 512, 512); glBindFramebuffer(GL_FRAMEBUFFER, captureFBO); for (unsigned int i = 0; i &lt; 6; ++i) { equirectangularToCubemapShader.setMat4("view", captureViews[i]); glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, envCubemap, 0); glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); renderCube(); //    } glBindFramebuffer(GL_FRAMEBUFFER, 0);</span></span></code> </pre><br> 此处，附加了帧缓冲区的颜色，并交替更改三次贴图的连接面，这导致将渲染直接输出到环境贴图的一个面。 该代码只需执行一次，之后，我们将<i>获得</i>完整的<i>envCubemap</i>环境图，其中包含转换HDR环境图的原始等矩形版本的结果。 <br><br> 我们将通过绘制最简单的skybox着色器来测试生成的立方贴图： <br><br><pre> <code class="plaintext hljs">#version 330 core layout (location = 0) in vec3 aPos; uniform mat4 projection; uniform mat4 view; out vec3 localPos; void main() { localPos = aPos; //         mat4 rotView = mat4(mat3(view)); vec4 clipPos = projection * rotView * vec4(localPos, 1.0); gl_Position = clipPos.xyww; }</code> </pre><br> 请注意<i>clipPos</i>向量的组成部分的<i>技巧</i> ：在记录顶点的变换坐标时，我们使用<i>xyww</i>四元组来确保天空盒的所有片段的最大深度为1.0（该方法已在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">相应的课程中使用</a> ）。 不要忘记将比较函数更改为<i>GL_LEQUAL</i> ： <br><br><pre> <code class="cpp hljs">glDepthFunc(GL_LEQUAL);</code> </pre> <br> 片段着色器仅从三次贴图选择： <br><br><pre> <code class="plaintext hljs">#version 330 core out vec4 FragColor; in vec3 localPos; uniform samplerCube environmentMap; void main() { vec3 envColor = texture(environmentMap, localPos).rgb; envColor = envColor / (envColor + vec3(1.0)); envColor = pow(envColor, vec3(1.0/2.2)); FragColor = vec4(envColor, 1.0); }</code> </pre> <br> 从地图上进行的选择基于立方体顶点的内插局部坐标，在这种情况下，这是选择的正确方向（同样，在天空盒的课程中对此进行了讨论， <i>大约为Per。</i> ）。 由于忽略了视图矩阵中的传输分量，因此天空盒的渲染将不依赖于观察者的位置，从而产生了无限远的背景的幻觉。 由于这里我们直接将数据从HDR卡输出到默认的帧缓冲区（即LDR接收器），因此有必要调出音调压缩。 最后，几乎所有HDR卡都存储在线性空间中，这意味着必须将<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">伽玛校正</a>用作最终处理和弦。 <br><br> 因此，当输出获得的天空盒以及已经熟悉的球体数组时，将获得类似的结果： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/s8/-3/vx/s8-3vxu5dhzhrwm1adtb5uwffga.png"></div><br> 好吧，我们花了很多精力，但是最后我们成功地习惯了读取HDR环境图，将其从等边线转换为立方图，然后将HDR立方图输出为场景中的天空盒。 此外，用于通过渲染立方图的六个面来转换为立方图的代码对于我们在<i>环境图卷积</i>的任务中进一步有用。 整个转换过程的代码在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a> 。 <br><br><h2> 三次卡的卷积 </h2><br> 正如本课开始时所说的，我们的主要目标是要解决间接漫射照明所有可能方向的积分问题，同时要考虑到给定的环境辐射（以立方环境图的形式）。 众所周知，我们可以获得场景能量亮度的值 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-686"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-687">L</span><span class="MJXp-mrow" id="MJXp-Span-688"><span class="MJXp-mo" id="MJXp-Span-689" style="margin-left: 0.278em; margin-right: 0.278em;">（</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-690">p</span><span class="MJXp-mrow" id="MJXp-Span-691"><span class="MJXp-mo" id="MJXp-Span-692" style="margin-left: 0.278em; margin-right: 0.278em;">，</span></span><span class="MJXp-msubsup" id="MJXp-Span-693"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-694" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-695" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mrow" id="MJXp-Span-696"><span class="MJXp-mo" id="MJXp-Span-697" style="margin-left: 0.278em; margin-right: 0.278em;">）</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-31"> L（p，w_i）</script> 对于任意方向 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-698"><span class="MJXp-msubsup" id="MJXp-Span-699"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-700" style="margin-right: 0.05em;">w</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-701" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-32"> w_i </script> 通过从HDR采样该方向的环境立方图。 为了解决积分问题，有必要从半球所有可能的方向采样场景的能量亮度 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-702"><span class="MJXp-mtext" id="MJXp-Span-703" style="color: red;">\欧</span><span class="MJXp-mrow" id="MJXp-Span-704"><span class="MJXp-mo" id="MJXp-Span-705" style="margin-left: 0.278em; margin-right: 0.278em;">米</span></span><span class="MJXp-mrow" id="MJXp-Span-706"><span class="MJXp-mo" id="MJXp-Span-707" style="margin-left: 0.278em; margin-right: 0.278em;">茄</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-33"> \欧米茄</script> 每个审查的片段。 <br> 显然，从半球的所有可能方向采样来自环境的照明的任务 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-708"><span class="MJXp-mtext" id="MJXp-Span-709" style="color: red;">\欧</span><span class="MJXp-mrow" id="MJXp-Span-710"><span class="MJXp-mo" id="MJXp-Span-711" style="margin-left: 0.278em; margin-right: 0.278em;">米</span></span><span class="MJXp-mrow" id="MJXp-Span-712"><span class="MJXp-mo" id="MJXp-Span-713" style="margin-left: 0.278em; margin-right: 0.278em;">茄</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-34"> \欧米茄</script> 在计算上是不可行的-这样的方向是无限的。 但是，有可能通过采取有限数量的随机或均匀分布在半球内部的方向来应用近似值。<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将使我们能够获得与真实辐照相当好的近似值，本质上以有限和的形式解决了我们感兴趣的积分。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是对于实时任务，甚至仍然难以置信地采用这种方法，因为每个片段都需要采样，并且采样数必须足够高才能获得可接受的结果。</font><font style="vertical-align: inherit;">因此，最好</font><font style="vertical-align: inherit;">在渲染过程之外为该步骤</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提前准备</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据。</font><font style="vertical-align: inherit;">由于半球的方向决定了我们从哪个空间区域捕获辐射，因此可以根据所有可能的出射方向预先计算半球每个可能方向的辐射</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-714"><span class="MJXp-msubsup" id="MJXp-Span-715"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-716" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W的</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-717" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ø</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-35">w_o</script>  ： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-718"><span class="MJXp-msubsup" id="MJXp-Span-719"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-720" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大号</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-721" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ó</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-722" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-723"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mo" id="MJXp-Span-724" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-725"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-726" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ω </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-727" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ö</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-728" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></span><span class="MJXp-mo" id="MJXp-Span-729" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-730"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-731" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ķ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-732" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d </font></font></span></span><span class="MJXp-mfrac" id="MJXp-Span-733" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-734"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ç</font></font></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-735"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">π</font></font></span></span></span></span></span></span><span class="MJXp-munderover" id="MJXp-Span-736"><span class=""><span class="MJXp-mo" id="MJXp-Span-737" style="margin-left: 0em; margin-right: 0.111em;"><span class="MJXp-largeop MJXp-int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＆Integral;</font></font></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-738" style="margin-left: 0px;"><span class="MJXp-mi" id="MJXp-Span-739"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ω</font></font></span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-740"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-741" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大号</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-742" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-743" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-744"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p</font></font></span><span class="MJXp-mo" id="MJXp-Span-745" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-746"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-747" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ω</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-748" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-749" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-750"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ñ</font></font></span><span class="MJXp-mo" id="MJXp-Span-751" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＆CenterDot;＆</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-752"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-753" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ω</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-754" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-755"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ð</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-756"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-757" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ω</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-758" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-36">L_o(p,\omega_o) = k_d\frac{c}{\pi} \int\limits_{\Omega} L_i(p,\omega_i) n \cdot \omega_i d\omega_i</script></p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 结果，对于给定的任意向量 </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-759"><span class="MJXp-msubsup" id="MJXp-Span-760"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-761" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">瓦特</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-762" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们可以进行采样predrasschitannoy辐照卡的，以便获得对这个方向上的漫辐照度的值。</font><font style="vertical-align: inherit;">为了确定当前碎片点处的间接漫射辐射的大小，我们从沿碎片表面法线方向定向的半球获取总辐射。</font><font style="vertical-align: inherit;">换句话说，获得场景的辐照归结为一个简单的选择：</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-37">w_i</script><font style="vertical-align: inherit;"></font><br><br><pre> <code class="plaintext hljs"> vec3 irradiance = texture(irradianceMap, N);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，为了创建辐照图，有必要对环境图进行卷积，将其转换为立方图。</font><font style="vertical-align: inherit;">我们知道，对于每个碎片，其半球都被认为沿表面法线定向</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-763"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-764"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ñ</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-38-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-38"> N </script>  。<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 在这种情况下，三次方图的卷积被减少以计算所有方向的平均能量亮度 </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-765"><span class="MJXp-msubsup" id="MJXp-Span-766"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-767" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w ^ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-768" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">半球内</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-39">w_i</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-769"><span class="MJXp-mi" id="MJXp-Span-770"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ω</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">沿着法线方向</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-40-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-40">\Omega</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-771"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-772"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ñ</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-41-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-41"> N </script>  ： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yc/ip/a2/ycipa25cnkcvhxdqcvrfbqqozvg.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">幸运的是，我们在课程开始时所做的耗时的初步工作现在可以非常轻松地在特殊的片段着色器中将环境图转换为立方图，其输出将用于形成新的立方图。</font><font style="vertical-align: inherit;">为此，用于将等矩形环境图转换为立方图的那段代码非常有用。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仍然仅需采用另一个处理着色器：</font></font><br><br><pre> <code class="plaintext hljs">#version 330 core out vec4 FragColor; in vec3 localPos; uniform samplerCube environmentMap; const float PI = 3.14159265359; void main() { //       vec3 normal = normalize(localPos); vec3 irradiance = vec3(0.0); [...] //   FragColor = vec4(irradiance, 1.0); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此处，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">environmentMap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">采样器</font><font style="vertical-align: inherit;">是先前从等边关系派生的环境的HDR立方图。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卷积环境图的方法有很多，在这种情况下，对于立方图的每个纹理元素，我们将生成几个半球样本矢量</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-773"><span class="MJXp-mi" id="MJXp-Span-774"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ω</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">沿样品方向定向，并对结果求平均值。</font><font style="vertical-align: inherit;">样本向量的数量将是固定的，向量本身将在半球内均匀分布。</font><font style="vertical-align: inherit;">我注意到被积数是一个连续函数，对此函数的离散估计仅是一个近似值。</font><font style="vertical-align: inherit;">而且，我们采用的采样向量越多，我们将越接近积分的解析解。</font><font style="vertical-align: inherit;">反射率表达式的积分取决于立体角</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-42-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-42">\Omega</script><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-775"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-776"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-777"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w-</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用起来不太方便的值。</font><font style="vertical-align: inherit;">而不是整合立体角</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-43-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-43">dw</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-778"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-779"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-780"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">w</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改变表达式，导致球坐标上的积分</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-44-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-44">dw</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-781"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-782"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">θ</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-45-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-45">\theta</script> 和 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-783"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-784"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ϕ</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-46-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-46">\phi</script>  ： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vx/8c/_r/vx8c_rphv4hhjo4xwhbduqhoslu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 角度Phi将代表半球底部平面中的方位角，范围从0到 </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-785"><span class="MJXp-mn" id="MJXp-Span-786"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2个</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-787"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">π</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-47-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-47">2\pi</script>  。<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 角度角度 </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-788"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-789"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">θ</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代表仰角，从0到</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-48-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-48">\theta</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-790"><span class="MJXp-mfrac" id="MJXp-Span-791" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-792"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1个</font></font></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-793"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2个</font></font></span></span></span></span></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-794"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">π</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-49-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-49">\frac{1}{2}\pi</script>  。<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 反射率的修改表达式如下： </font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-795"><span class="MJXp-msubsup" id="MJXp-Span-796"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-797" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大号</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-798" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ó</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-799" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-800"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mo" id="MJXp-Span-801" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-802"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-803" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">φ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-804" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ö</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-805" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-806"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-807" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">θ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-808" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ö</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-809" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></span><span class="MJXp-mo" id="MJXp-Span-810" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-811"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-812" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ķ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-813" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d </font></font></span></span><span class="MJXp-mfrac" id="MJXp-Span-814" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-815"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ç</font></font></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-816"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">π</font></font></span></span></span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-817"><span class="MJXp-mo" id="MJXp-Span-818" style="margin-left: 0em; margin-right: 0.05em;"><span class="MJXp-largeop MJXp-int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ∫</font></font></span></span><span class="MJXp-script-box" style="height: 2.1em; vertical-align: -0.7em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-823"><span class="MJXp-mn" id="MJXp-Span-824"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2 </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-825"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">π </font></font></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-819"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-820"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">φ </font></font></span><span class="MJXp-mo" id="MJXp-Span-821"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mn" id="MJXp-Span-822"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span></span></span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-826"><span class="MJXp-mo" id="MJXp-Span-827" style="margin-left: 0em; margin-right: 0.05em;"><span class="MJXp-largeop MJXp-int"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ∫</font></font></span></span><span class="MJXp-script-box" style="height: 2.66em; vertical-align: -0.7em;"><span class=" MJXp-script"><span><span style="margin-bottom: -1.05em;"><span class="MJXp-mrow" id="MJXp-Span-832"><span class="MJXp-mfrac" id="MJXp-Span-833" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-834"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1</font></font></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-835"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></span></span></span></span></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-836"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> π</font></font></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -1.55em;"><span class="MJXp-mrow" id="MJXp-Span-828"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-829"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">θ</font></font></span><span class="MJXp-mo" id="MJXp-Span-830"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><span class="MJXp-mn" id="MJXp-Span-831"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span></span></span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-837"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-838" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大号</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-839" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-840" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-841"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p</font></font></span><span class="MJXp-mo" id="MJXp-Span-842" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-843"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-844" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">φ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-845" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-846" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-847"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-848" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">θ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-849" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-850" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></span><span class="MJXp-mi" id="MJXp-Span-851"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COS</font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mo" id="MJXp-Span-853" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;">（</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-854"><font style="vertical-align: inherit;">θ</font></span><span class="MJXp-mo" id="MJXp-Span-855" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;">）</font></span><span class="MJXp-mi" id="MJXp-Span-856"><font style="vertical-align: inherit;">罪</font></span><span class="MJXp-mo" id="MJXp-Span-858" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;">（</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-859"><font style="vertical-align: inherit;">θ</font></span><span class="MJXp-mo" id="MJXp-Span-860" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;">）</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-861"><font style="vertical-align: inherit;">d</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-862"><font style="vertical-align: inherit;">φ</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-863"><font style="vertical-align: inherit;">d</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-864"><font style="vertical-align: inherit;">θ</font></span></font><span class="MJXp-mo" id="MJXp-Span-852" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-853" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-854"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-855" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi" id="MJXp-Span-856"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-857" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-858" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-859"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-860" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-861"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-862"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-863"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-864"><font style="vertical-align: inherit;"></font></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-50-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-50">L_o(p,\phi_o, \theta_o) = k_d\frac{c}{\pi} \int_{\phi = 0}^{2\pi} \int_{\theta = 0}^{\frac{1}{2}\pi} L_i(p,\phi_i, \theta_i) \cos(\theta) \sin(\theta) d\phi d\theta</script></p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 这种积分的解决方案将需要在半球中抽取有限数量的样本 </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-865"><span class="MJXp-mi" id="MJXp-Span-866"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ω</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和平均的结果。</font><font style="vertical-align: inherit;">知道样本数</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-51-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-51">\Omega</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-867"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-868"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mn" id="MJXp-Span-869"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-52-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-52">n1</script> 和 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-870"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-871"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mn" id="MJXp-Span-872"><font style="vertical-align: inherit;"></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于每个球坐标</font><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-870"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-871"><font style="vertical-align: inherit;"> n </font></span></span></span><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-870"><span class="MJXp-mn" id="MJXp-Span-872"><font style="vertical-align: inherit;">2</font></span></span></span><font style="vertical-align: inherit;">，我们可以将积分转换为</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">黎曼和</font></a><font style="vertical-align: inherit;">：</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-53-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-53">n2</script><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-873"><span class="MJXp-msubsup" id="MJXp-Span-874"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-875" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大号</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-876" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ó</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-877" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-878"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mo" id="MJXp-Span-879" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-880"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-881" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">φ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-882" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ö</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-883" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-884"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-885" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">θ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-886" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ö</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-887" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></span><span class="MJXp-mo" id="MJXp-Span-888" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-889"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-890" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ķ </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-891" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d </font></font></span></span><span class="MJXp-mfrac" id="MJXp-Span-892" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-893"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ç</font></font></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-894"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">π</font></font></span></span></span></span></span></span><span class="MJXp-mfrac" id="MJXp-Span-895" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mn" id="MJXp-Span-896"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1</font></font></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-897"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ñ </font></font></span><span class="MJXp-mn" id="MJXp-Span-898"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-899"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ñ </font></font></span><span class="MJXp-mn" id="MJXp-Span-900"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></span></span></span></span></span></span><span class="MJXp-munderover" id="MJXp-Span-901"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-907" style="margin-right: 0px; margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-908"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ñ </font></font></span><span class="MJXp-mn" id="MJXp-Span-909"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span></span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-902" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＆Sigma;</font></font></span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-903" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-904"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> φ</font></font></span><span class="MJXp-mo" id="MJXp-Span-905"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><span class="MJXp-mn" id="MJXp-Span-906"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span></span></span><span class="MJXp-munderover" id="MJXp-Span-910"><span><span class="MJXp-over"><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-916" style="margin-right: 0px; margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-917"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ñ </font></font></span><span class="MJXp-mn" id="MJXp-Span-918"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></span></span></span><span class=""><span class="MJXp-mo" id="MJXp-Span-911" style="margin-left: 0.111em; margin-right: 0.167em;"><span class="MJXp-largeop"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＆Sigma;</font></font></span></span></span></span></span><span class=" MJXp-script"><span class="MJXp-mrow" id="MJXp-Span-912" style="margin-left: 0px;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-913"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> θ</font></font></span><span class="MJXp-mo" id="MJXp-Span-914"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=</font></font></span><span class="MJXp-mn" id="MJXp-Span-915"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-919"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-920" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大号</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-921" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-922" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-923"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p</font></font></span><span class="MJXp-mo" id="MJXp-Span-924" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-925"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-926" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">φ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-927" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-928" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></span><span class="MJXp-msubsup" id="MJXp-Span-929"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-930" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">θ</font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-931" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-932" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></span><span class="MJXp-mi" id="MJXp-Span-933"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COS</font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mo" id="MJXp-Span-935" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;">（</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-936"><font style="vertical-align: inherit;">θ</font></span><span class="MJXp-mo" id="MJXp-Span-937" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;">）</font></span><span class="MJXp-mi" id="MJXp-Span-938"><font style="vertical-align: inherit;">罪</font></span><span class="MJXp-mo" id="MJXp-Span-940" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;">（</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-941"><font style="vertical-align: inherit;">θ</font></span><span class="MJXp-mo" id="MJXp-Span-942" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;">）</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-943"><font style="vertical-align: inherit;">d</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-944"><font style="vertical-align: inherit;">φ</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-945"><font style="vertical-align: inherit;">d</font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-946"><font style="vertical-align: inherit;">θ</font></span></font><span class="MJXp-mo" id="MJXp-Span-934" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-935" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-936"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-937" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi" id="MJXp-Span-938"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-939" style="margin-left: 0em; margin-right: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-940" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-941"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-942" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-943"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-944"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-945"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-946"><font style="vertical-align: inherit;"></font></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-54-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-54">L_o(p,\phi_o, \theta_o) = k_d\frac{c}{\pi} \frac{1}{n1 n2} \sum_{\phi = 0}^{n1} \sum_{\theta = 0}^{n2} L_i(p,\phi_i, \theta_i) \cos(\theta) \sin(\theta) d\phi d\theta</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于两个球面坐标都离散地变化，因此，如上图所示，在每个时刻，都在半球中以一定的平均面积进行采样。</font><font style="vertical-align: inherit;">由于球面的性质，离散采样区域的大小不可避免地会随着仰角的增加而减小</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-947"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-948"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">θ</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并接近天顶。</font><font style="vertical-align: inherit;">为了补偿这种减小面积的效果，我们在表达式中增加了权重系数</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-55-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-55">\theta</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-949"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-950"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">š </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-951"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我</font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-952"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ñ </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-953"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">θ</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-56-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-56">sin\theta</script>  。 <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 结果，基于每个片段的球面坐标以代码形式在半球中执行离散采样的方法如下： </font></font><br><br><pre> <code class="plaintext hljs">vec3 irradiance = vec3(0.0); vec3 up = vec3(0.0, 1.0, 0.0); vec3 right = cross(up, normal); up = cross(normal, right); float sampleDelta = 0.025; float nrSamples = 0.0; for(float phi = 0.0; phi &lt; 2.0 * PI; phi += sampleDelta) { for(float theta = 0.0; theta &lt; 0.5 * PI; theta += sampleDelta) { //   .   (  -) vec3 tangentSample = vec3(sin(theta) * cos(phi), sin(theta) * sin(phi), cos(theta)); //      vec3 sampleVec = tangentSample.x * right + tangentSample.y * up + tangentSample.z * N; irradiance += texture(environmentMap, sampleVec).rgb * cos(theta) * sin(theta); nrSamples++; } } irradiance = PI * irradiance * (1.0 / float(nrSamples));</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sampleDelta</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">决定沿半球表面的离散台阶的大小。通过更改此值，可以增加或减少结果的准确性。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在两个周期内，规则的3维样本矢量由球坐标形成，从切线转移到世界空间，然后用于从HDR采样立方环境图。样品的结果存储在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">辐照度</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量中</font><font style="vertical-align: inherit;">，在处理结束时将其除以所获得的样品数，以获得辐照度的平均值。请注意，从纹理采样的结果由两个量调制：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cos（theta）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -考虑到大角度光的衰减，以及</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sin（theta）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-补偿接近天顶时样品面积的减少。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">剩下的只是处理渲染和捕获</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">envCubemap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境</font><i><font style="vertical-align: inherit;">图</font></i><font style="vertical-align: inherit;">卷积结果的代码</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">首先，创建一个立方体贴图来存储辐射（在进入主渲染周期之前，您需要做一次）：</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> irradianceMap; glGenTextures(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;irradianceMap); glBindTexture(GL_TEXTURE_CUBE_MAP, irradianceMap); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">6</span></span>; ++i) { glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, <span class="hljs-number"><span class="hljs-number">0</span></span>, GL_RGB16F, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, GL_RGB, GL_FLOAT, <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>); } glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER, GL_LINEAR); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MAG_FILTER, GL_LINEAR);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于辐照图是通过对环境图的能量亮度的均匀分布样本求平均而获得的，因此它实际上不包含高频部分和元素-相当小的分辨率纹理（此处为32x32）和启用的线性滤波就足以存储它。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，将捕获帧缓冲区设置为此分辨率：</font></font><br><br><pre> <code class="cpp hljs">glBindFramebuffer(GL_FRAMEBUFFER, captureFBO); glBindRenderbuffer(GL_RENDERBUFFER, captureRBO); glRenderbufferStorage(GL_RENDERBUFFER, GL_DEPTH_COMPONENT24, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 捕获卷积结果的代码类似于将环境图从等边转移到三次的代码，仅使用了卷积着色器： </font></font><br><br><pre> <code class="cpp hljs">irradianceShader.use(); irradianceShader.setInt(<span class="hljs-string"><span class="hljs-string">"environmentMap"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); irradianceShader.setMat4(<span class="hljs-string"><span class="hljs-string">"projection"</span></span>, captureProjection); glActiveTexture(GL_TEXTURE0); glBindTexture(GL_TEXTURE_CUBE_MAP, envCubemap); <span class="hljs-comment"><span class="hljs-comment">//        glViewport(0, 0, 32, 32); glBindFramebuffer(GL_FRAMEBUFFER, captureFBO); for (unsigned int i = 0; i &lt; 6; ++i) { irradianceShader.setMat4("view", captureViews[i]); glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, irradianceMap, 0); glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); renderCube(); } glBindFramebuffer(GL_FRAMEBUFFER, 0);</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成此阶段后，我们将在手上获得预先计算的辐照图，可直接用于计算间接漫射照明。</font><font style="vertical-align: inherit;">要检查卷积如何进行，我们将尝试使用辐射图替换环境图中的天空盒纹理：</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mt/gc/cs/mtgccsxl0h80cdo1gg8wgl3tp9m.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 结果，如果您看到的东西看起来像一张非常模糊的环境图，那么很可能卷积就成功了。 </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PBR和间接照明 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所得的辐照图在反射率的除法表达式的扩散部分中使用，代表间接照明所有可能方向的累加贡献。</font><font style="vertical-align: inherit;">由于在这种情况下，光线不是来自特定光源，而是来自整个环境，因此我们将漫反射和镜面间接照明视为背景（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），代替了以前使用的恒定值。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，请不要忘记添加带有辐射图的新采样器：</font></font><br><br><pre> <code class="plaintext hljs">uniform samplerCube irradianceMap;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 拥有一个辐照图来存储有关场景和垂直于表面的间接漫射辐射的所有信息，获取有关特定片段辐照的数据就像从纹理中制作一个样本一样简单： </font></font><br><br><pre> <code class="plaintext hljs">// vec3 ambient = vec3(0.03); vec3 ambient = texture(irradianceMap, N).rgb;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，由于间接辐射同时包含漫反射和反射镜分量的数据（如我们在反射率表达式的分量版本中所见），因此我们需要以特殊方式调制漫射分量。</font><font style="vertical-align: inherit;">与上一课一样，我们使用菲涅耳表达式确定给定表面的光反射程度，从而获得光的折射程度或扩散系数：</font></font><br><br><pre> <code class="plaintext hljs">vec3 kS = fresnelSchlick(max(dot(N, V), 0.0), F0); vec3 kD = 1.0 - kS; vec3 irradiance = texture(irradianceMap, N).rgb; vec3 diffuse = irradiance * albedo; vec3 ambient = (kD * diffuse) * ao;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 由于背景照明从半球的所有方向落在表面法线的基础上 </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-954"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-955"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，无法确定唯一的中位数（</font><i><font style="vertical-align: inherit;">中途</font></i></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-57-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-57"> N </script><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）向量来计算菲涅耳系数。为了在这种条件下模拟菲涅耳效应，必须基于法线和观测矢量之间的角度来计算系数。但是，较早之前，作为计算菲涅耳系数的参数，我们使用了基于微表面模型并取决于表面粗糙度而获得的中值矢量。由于在这种情况下，粗糙度不包括在计算参数中，因此，总是会高估表面对光的反射程度。整体而言，间接照明应与直接照明具有相同的行为，即从粗糙的表面，我们期望边缘处的反射率较低。但是由于不考虑粗糙度，然后根据菲涅耳进行间接照明的镜面反射程度在粗糙的非金属表面上看起来是不现实的（在下图中，为了更清楚起见，夸大了所描述的效果）：</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q2/oc/ly/q2oclypt9x6lcg5yyaqr4d8hu9i.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过在Fremlin-Schlick表达式中引入粗糙度来避免这种麻烦，该表达式由</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SébastienLagarde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font><font style="vertical-align: inherit;">：</font></font><br><br><pre> <code class="plaintext hljs">vec3 fresnelSchlickRoughness(float cosTheta, vec3 F0, float roughness) { return F0 + (max(vec3(1.0 - roughness), F0) - F0) * pow(1.0 - cosTheta, 5.0); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 给定计算菲涅尔集时的表面粗糙度，用于计算背景分量的代码采用以下形式： </font></font><br><br><pre> <code class="plaintext hljs">vec3 kS = fresnelSchlickRoughness(max(dot(N, V), 0.0), F0, roughness); vec3 kD = 1.0 - kS; vec3 irradiance = texture(irradianceMap, N).rgb; vec3 diffuse = irradiance * albedo; vec3 ambient = (kD * diffuse) * ao;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事实证明，基于图像的照明的使用本质上可以归结为立方图中的一个样本。</font><font style="vertical-align: inherit;">所有困难主要与环境图的初步准备和转移到辐射图有关。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从一堂关于</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">光源</font><font style="vertical-align: inherit;">的熟悉场景中学习，该</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">光源</font></a><font style="vertical-align: inherit;">包含一系列具有不同金属度和粗糙度的球体，并添加来自环境的漫射背景光，您将获得以下内容：</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vd/b1/y1/vdb1y1xddczspcyl-7exei76lxw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看起来仍然很奇怪，因为具有高金属度的材料仍然</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反射才能真正看起来像金属（毕竟金属不会反射漫射照明）。</font><font style="vertical-align: inherit;">并且在这种情况下，唯一的反射是从点分析光源获得的。</font><font style="vertical-align: inherit;">但是，我们已经可以说球体看起来更加沉浸在环境中（在切换环境贴图时尤其明显），因为这些表面现在可以正确地响应场景环境的背景照明。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本课程的完整源代码在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里。</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在下一课中，我们将最终处理反射率表示的后半部分，该部分用于间接镜面照明。</font><font style="vertical-align: inherit;">完成此步骤后，您将真正感受到PBR方法在照明中的强大功能。</font></font><br><br><h2> 附加材料 </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编码实验室：基于物理的渲染</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：PBR模型的介绍以及辐照度图的构造方式及其原因的解释。</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阴影的数学</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：ScratchAPixel对本课中使用的一些数学技术的简要概述，尤其是关于极坐标和积分。</font></font></li></ul><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：我们有一个</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电报会议，</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以协调转账。</font><font style="vertical-align: inherit;">如果您有强烈的帮助翻译的愿望，欢迎您！</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN426987/">https://habr.com/ru/post/zh-CN426987/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN426977/index.html">LibreOffice：会计的噩梦</a></li>
<li><a href="../zh-CN426979/index.html">如何免费学习英语：3种常用工具和每种工具的详细说明</a></li>
<li><a href="../zh-CN426981/index.html">Splunk中高级仪表板的10个技巧。 第一部分</a></li>
<li><a href="../zh-CN426983/index.html">SObjectizer-5.5.23的新功能：实现愿望还是Pandora的盒子？</a></li>
<li><a href="../zh-CN426985/index.html">Kubernetes的kubebox和其他控制台外壳</a></li>
<li><a href="../zh-CN426991/index.html">创业文摘：莫斯科即将举行的10个IT事件</a></li>
<li><a href="../zh-CN426993/index.html">我需要学习C才能理解计算机的工作原理吗？</a></li>
<li><a href="../zh-CN426995/index.html">回收会危害产品和员工</a></li>
<li><a href="../zh-CN426997/index.html">如何使用MaterialShapeDrawable创建自定义形状</a></li>
<li><a href="../zh-CN426999/index.html">顺应趋势，或转向RxJava和LiveData</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>