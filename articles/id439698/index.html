<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ’¿ ğŸ™ğŸ¿ ğŸš’ Pengantar pemrograman: penembak 3D sederhana dari awal selama akhir pekan, bagian 1 ğŸ¥™ ğŸ‘· âœ‹ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Teks ini ditujukan bagi mereka yang baru menguasai pemrograman. Gagasan utamanya adalah untuk menunjukkan langkah demi langkah bagaimana Anda dapat se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengantar pemrograman: penembak 3D sederhana dari awal selama akhir pekan, bagian 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439698/">  Teks ini ditujukan bagi mereka yang baru menguasai pemrograman.  Gagasan utamanya adalah untuk menunjukkan langkah demi langkah bagaimana Anda dapat secara mandiri membuat game Ã  la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Wolfenstein 3D</a> .  Perhatian, saya tidak akan bersaing dengan Carmack sama sekali, dia jenius dan kodenya indah.  Saya bertujuan di tempat yang sama sekali berbeda: saya menggunakan kekuatan komputasi yang besar dari komputer modern sehingga siswa dapat membuat proyek lucu dalam beberapa hari tanpa terjebak dalam optimisasi.  Saya secara khusus menulis kode lambat, karena jauh lebih pendek dan lebih mudah dipahami.  Carmack <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menulis 0x5f3759df</a> , saya menulis 1 / sqrt (x).  Kami memiliki tujuan yang berbeda. <br><br>  Saya yakin bahwa seorang programmer yang baik hanya diperoleh dari seseorang yang kode di rumah untuk kesenangan, dan tidak hanya duduk berpasangan di universitas.  Di universitas kami, programmer diajarkan pada serangkaian tak berujung dari semua jenis katalog perpustakaan dan kebosanan lainnya.  Sdr  Tujuan saya adalah untuk menunjukkan contoh proyek yang menarik untuk diprogram.  Ini adalah lingkaran setan: jika itu menarik untuk membuat proyek, maka seseorang menghabiskan banyak waktu di sana, mendapatkan pengalaman, dan melihat hal-hal yang lebih menarik di sekitarnya (itu telah menjadi lebih mudah diakses!), Dan sekali lagi tenggelam dalam proyek baru.  Ini disebut pelatihan proyek, sekitar untung besar. <br><br>  Lembar itu ternyata panjang, jadi saya memecah teks menjadi dua bagian: <br><br><ul><li>  <b>Bagian Satu: Menggambar Dinding</b> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagian dua: huni antarmuka dunia + jendela kami</a> </li></ul><br>  Eksekusi kode dari repositori saya terlihat seperti ini: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zPIVTqVilCM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Ini bukan permainan yang sudah selesai, tetapi hanya kosong untuk siswa.  Contoh permainan selesai yang ditulis oleh dua mahasiswa baru, lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bagian kedua</a> . <br><a name="habracut"></a><br>  Ternyata saya sedikit menipu Anda, saya tidak akan memberi tahu Anda cara membuat permainan penuh dalam satu minggu.  Saya hanya membuat mesin 3D.  Monster tidak berlari ke arahku, dan karakter utama tidak menembak.  Tapi setidaknya saya menulis mesin ini dalam satu hari Sabtu, Anda dapat memeriksa riwayat komit.  Pada prinsipnya, hari Minggu sudah cukup untuk membuat sesuatu dapat dimainkan, yaitu, satu akhir pekan yang dapat Anda temui. <br><br>  Pada saat penulisan ini, repositori berisi 486 baris kode: <br><br><pre><code class="bash hljs">haqreu@daffodil:~/tinyraycaster$ cat *.cpp *.h | wc -l 486</code> </pre> <br>  Proyek ini tergantung pada SDL2, tetapi secara umum antarmuka jendela dan pemrosesan acara dari keyboard muncul sangat terlambat, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pada tengah malam pada hari Sabtu</a> :), ketika semua kode render telah dilakukan. <br><br>  Jadi, saya memecah semua kode menjadi langkah-langkah, dimulai dengan kompiler C ++ kosong.  Seperti dalam artikel saya sebelumnya pada jadwal ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tyts</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tyts</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tyts</a> ), saya mematuhi aturan "satu langkah = satu komit", karena github membuatnya sangat nyaman untuk melihat sejarah perubahan kode. <br><br><h1>  Tahap 1: menyimpan gambar ke disk </h1><br>  Jadi ayo pergi.  Kami masih sangat jauh dari antarmuka jendela, sebagai permulaan kami hanya akan menyimpan gambar ke disk.  Total, kita harus dapat menyimpan gambar di memori komputer dan menyimpannya ke disk dalam format yang dimengerti oleh beberapa program pihak ketiga.  Saya ingin mendapatkan file ini: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8bc/757/fd3/8bc757fd3da42088dbf24380970e109d.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ini adalah</a> kode C ++ lengkap yang menggambarkan apa yang kita butuhkan: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; #include &lt;fstream&gt; #include &lt;vector&gt; #include &lt;cstdint&gt; #include &lt;cassert&gt; uint32_t pack_color(const uint8_t r, const uint8_t g, const uint8_t b, const uint8_t a=255) { return (a&lt;&lt;24) + (b&lt;&lt;16) + (g&lt;&lt;8) + r; } void unpack_color(const uint32_t &amp;color, uint8_t &amp;r, uint8_t &amp;g, uint8_t &amp;b, uint8_t &amp;a) { r = (color &gt;&gt; 0) &amp; 255; g = (color &gt;&gt; 8) &amp; 255; b = (color &gt;&gt; 16) &amp; 255; a = (color &gt;&gt; 24) &amp; 255; } void drop_ppm_image(const std::string filename, const std::vector&lt;uint32_t&gt; &amp;image, const size_t w, const size_t h) { assert(image.size() == w*h); std::ofstream ofs(filename); ofs &lt;&lt; "P6\n" &lt;&lt; w &lt;&lt; " " &lt;&lt; h &lt;&lt; "\n255\n"; for (size_t i = 0; i &lt; h*w; ++i) { uint8_t r, g, b, a; unpack_color(image[i], r, g, b, a); ofs &lt;&lt; static_cast&lt;char&gt;(r) &lt;&lt; static_cast&lt;char&gt;(g) &lt;&lt; static_cast&lt;char&gt;(b); } ofs.close(); } int main() { const size_t win_w = 512; // image width const size_t win_h = 512; // image height std::vector&lt;uint32_t&gt; framebuffer(win_w*win_h, 255); // the image itself, initialized to red for (size_t j = 0; j&lt;win_h; j++) { // fill the screen with color gradients for (size_t i = 0; i&lt;win_w; i++) { uint8_t r = 255*j/float(win_h); // varies between 0 and 255 as j sweeps the vertical uint8_t g = 255*i/float(win_w); // varies between 0 and 255 as i sweeps the horizontal uint8_t b = 0; framebuffer[i+j*win_w] = pack_color(r, g, b); } } drop_ppm_image("./out.ppm", framebuffer, win_w, win_h); return 0; }</span></span></span></span></code> </pre><br>  Jika Anda tidak memiliki kompiler, maka ini tidak masalah, jika Anda memiliki akun di github, Anda dapat melihat kode ini, mengeditnya dan menjalankan (sic!) Dalam satu klik langsung dari browser. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://gitpod.io/&amp;usg=ALkJrhif1B1_feGKZE466PDa36dmA8WHmQ#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Buka di gitpod"></a> <br><br>  Mengikuti tautan ini, gitpod akan membuat mesin virtual untuk Anda, meluncurkan VS Code, dan membuka terminal pada mesin jarak jauh.  Dalam sejarah perintah terminal (klik pada konsol dan tekan panah ke atas), sudah ada seperangkat perintah lengkap yang memungkinkan Anda untuk mengkompilasi kode, menjalankannya, dan membuka gambar yang dihasilkan. <br><br>  Jadi apa yang perlu Anda pahami dari kode ini.  Pertama, warna yang saya simpan dalam tipe integer empat byte uint32_t.  Setiap byte adalah komponen R, G, B atau A. Fungsi pack_color () dan unpack_color () memungkinkan Anda untuk mendapatkan masing-masing komponen masing-masing warna. <br><br>  Gambar kedua, dua dimensi, saya simpan dalam array satu dimensi yang biasa.  Untuk sampai ke pixel dengan koordinat (x, y) saya tidak menulis gambar [x] [y], tetapi saya menulis gambar [x + y * lebar].  Jika metode pengemasan informasi dua dimensi ke dalam array satu dimensi ini baru bagi Anda, maka sekarang ambil pena dan tangani.  Bagi saya pribadi, tahap ini bahkan tidak mencapai otak, itu diproses langsung di sumsum tulang belakang.  Array tiga dan lebih dimensi dapat dikemas dengan cara yang persis sama, tetapi kita tidak akan naik di atas dua komponen. <br><br>  Kemudian saya menjalankan gambar saya dalam siklus ganda sederhana, mengisinya dengan gradien, dan menyimpannya ke disk dalam format .ppm. <br><br><hr><br><h1>  Tahap 2: menggambar peta level </h1><br>  Kita membutuhkan peta dunia kita.  Pada titik ini, saya hanya ingin menentukan struktur data dan menggambar peta di layar.  Seharusnya terlihat seperti ini: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7b8/c96/1c7/7b8c961c7be837c6c9777770b0eed987.png"><br><br>  Perubahannya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bisa Anda lihat di sini</a> .  Semuanya sederhana di sana: Saya mengubah kode peta menjadi array karakter satu dimensi, mendefinisikan fungsi menggambar persegi panjang, dan berjalan di sekitar peta, menggambar setiap sel. <br><br>  Saya mengingatkan Anda bahwa tombol ini akan meluncurkan kode tepat pada tahap ini: <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://gitpod.io/&amp;usg=ALkJrhif1B1_feGKZE466PDa36dmA8WHmQ#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Buka di gitpod"></a> <br><br><hr><br><h1>  Tahap 3: tambahkan pemain </h1><br>  Apa yang kita butuhkan untuk bisa menggambar pemain di peta?  Koordinat GPS sudah cukup :) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf0/dfa/e21/cf0dfae212fd0372d368f53334218301.png"><br><br>  Tambahkan dua variabel x dan y, dan gambar pemain di tempat yang sesuai: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b8/519/2e6/8b85192e6a40e7b146ecc98d219f895b.png"><br><br>  Perubahannya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bisa Anda lihat di sini</a> .  Tentang gitpod saya tidak akan mengingatkan lagi :) <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://gitpod.io/&amp;usg=ALkJrhif1B1_feGKZE466PDa36dmA8WHmQ#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Buka di gitpod"></a> <br><br><hr><br><h1>  Tahap 4: alias pengintai ray jejak pertama virtual </h1><br>  Selain koordinat pemain, alangkah baiknya untuk mengetahui ke arah mana dia mencari.  Oleh karena itu, kami menambahkan variabel lain player_a, yang memberikan arah pandangan pemain (sudut antara arah pandangan dan sumbu absis): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/08d/f9a/af5/08df9aaf5713ca862e718a5fb0095d03.png"><br><br>  Dan sekarang saya ingin bisa meluncur di sepanjang sinar oranye.  Bagaimana cara melakukannya?  Sangat sederhana.  Mari kita lihat segitiga kanan hijau.  Kita tahu bahwa cos (player_a) = a / c, dan bahwa dosa (player_a) = b / c. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/99c/338/bcf/99c338bcf91ba076c1bd2bfdb15e129d.png"><br><br>  Apa yang terjadi jika saya secara sewenang-wenang mengambil nilai c (positif) dan menghitung x = player_x + c * cos (player_a) dan y = player_y + c * sin (player_a)?  Kita akan menemukan diri kita pada titik ungu;  dengan memvariasikan parameter c dari nol hingga tak terbatas, kita dapat membuat slide titik ungu ini di sepanjang sinar oranye kita, dan c adalah jarak dari (x, y) ke (player_x, player_y)! <br><br>  Inti dari mesin grafis kami adalah siklus ini: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> c = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; c&lt;<span class="hljs-number"><span class="hljs-number">20</span></span>; c+=<span class="hljs-number"><span class="hljs-number">.05</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = player_x + c*<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(player_a); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = player_y + c*<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(player_a); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(x)+<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(y)*map_w]!=<span class="hljs-string"><span class="hljs-string">' '</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre><br>  Kita memindahkan titik (x, y) di sepanjang sinar, jika ia menemukan rintangan pada peta, maka kita mengakhiri siklus, dan variabel c memberikan jarak ke rintangan!  Apa itu bukan pengintai laser? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c9f/52d/3ce/c9f52d3ceaaffc1b4396fd13c9ab24df.png"><br><br>  Perubahannya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bisa Anda lihat di sini</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://gitpod.io/&amp;usg=ALkJrhif1B1_feGKZE466PDa36dmA8WHmQ#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Buka di gitpod"></a> <br><br><hr><br><h1>  Tahap 5: Tinjauan Sektor </h1><br>  Satu balok baik-baik saja, tetapi mata kita masih melihat seluruh sektor.  Mari kita sebut sudut pandang fov (bidang tampilan): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1d4/83a/e06/1d483ae06cf65809eea61660c1a58db5.png"><br><br>  Dan mari kita lepaskan 512 sinar (omong-omong, mengapa 512?), Dengan lancar menyapu seluruh sektor tampilan: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fab/271/d5d/fab271d5dfe3dd4e8b87df6fc4c52676.png"><br>  Perubahannya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bisa Anda lihat di sini</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://gitpod.io/&amp;usg=ALkJrhif1B1_feGKZE466PDa36dmA8WHmQ#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Buka di gitpod"></a> <br><br><hr><br><h1>  Tahap 6: 3D! </h1><br>  Dan sekarang titik kuncinya.  Untuk masing-masing dari 512 sinar, kami mendapat jarak ke rintangan terdekat, kan?  Dan sekarang mari kita membuat gambar kedua dengan lebar 512 piksel (spoiler);  di mana untuk setiap ray kita akan menggambar satu segmen vertikal, dan ketinggian segmen berbanding terbalik dengan jarak ke rintangan: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f4/bf6/c7c/4f4bf6c7caa9931a087d04d6f33b4dbc.png"><br><br>  Sekali lagi, ini adalah kunci untuk menciptakan ilusi 3D, pastikan Anda memahami apa yang dipertaruhkan.  Menggambar segmen vertikal, sebenarnya, kita menggambar pagar piket, di mana ketinggian masing-masing pasak lebih kecil, semakin jauh dari kita: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed6/fc6/030/ed6fc60305a6da0d29d07850ba49e92a.jpg"><br><br>  Perubahannya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bisa Anda lihat di sini</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://gitpod.io/&amp;usg=ALkJrhif1B1_feGKZE466PDa36dmA8WHmQ#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Buka di gitpod"></a> <br><br><hr><br><h1>  Tahap 7: Animasi Pertama </h1><br>  Pada tahap ini, untuk pertama kalinya, kami menggambar sesuatu yang dinamis (saya hanya memasukkan 360 gambar ke disk).  Semuanya sepele: Saya mengubah player_a, menggambar, menyimpan, mengubah player_a, menggambar, menyimpan.  Untuk membuatnya sedikit lebih menyenangkan, saya menetapkan nilai warna acak untuk setiap jenis sel di peta kami. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/29d/38f/f7a/29d38ff7a03c91429cd5cbd7476fb8ed.gif"><br>  Perubahannya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bisa Anda lihat di sini</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://gitpod.io/&amp;usg=ALkJrhif1B1_feGKZE466PDa36dmA8WHmQ#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Buka di gitpod"></a> <br><br><hr><br><h1>  Tahap 8: koreksi mata ikan </h1><br>  Apakah Anda memperhatikan betapa besar efek mata ikan yang kita dapatkan ketika kita melihat dinding dari dekat?  Ini terlihat seperti ini: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/362/fe7/f78/362fe7f78fc2d314e09b36f39d0bab6d.png"><br><br>  Mengapa  Ya, sangat sederhana.  Di sini kita melihat tembok: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e67/632/227/e6763222768e380912c1c47d51a95871.png"><br><br>  Untuk menggambar dinding kita, kita menyoroti sektor tampilan biru kita dengan sinar ungu.  Ambil nilai spesifik dari arah balok, seperti pada gambar ini.  Panjang segmen oranye jelas kurang dari panjang ungu.  Karena untuk menentukan ketinggian setiap segmen vertikal yang kita gambar di layar, kita membagi dengan jarak ke penghalang, mata ikan itu cukup alami. <br><br>  Untuk memperbaiki distorsi ini tidak sulit sama sekali, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">lihat bagaimana ini dilakukan</a> .  Pastikan Anda mengerti dari mana asal cosinus.  Menggambar diagram pada selembar kertas sangat membantu. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/df8/a7d/df4/df8a7ddf414fdc2018bd1649be3682f9.gif"><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://gitpod.io/&amp;usg=ALkJrhif1B1_feGKZE466PDa36dmA8WHmQ#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Buka di gitpod"></a> <br><br><hr><br><h1>  Langkah 9: memuat file tekstur </h1><br>  Saatnya berurusan dengan tekstur.  Saya malas menulis pengunduh gambar sendiri, jadi saya mengambil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pustaka stb yang</a> bagus.  Saya menyiapkan file dengan tekstur untuk dinding, semua tekstur persegi dan dikemas secara horizontal dalam gambar: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5c6/48e/8fd/5c648e8fd4cca05610b977b3f5b31cfe.png"><br><br>  Pada titik ini, saya hanya memuat tekstur ke dalam memori.  Untuk menguji kode tertulis, saya cukup menggambar karena tekstur dengan indeks 5 di sudut kiri atas layar: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e4/a78/a9a/8e4a78a9a98ccfe4acd81ceb8f2faafa.png"><br>  Perubahannya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bisa Anda lihat di sini</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://gitpod.io/&amp;usg=ALkJrhif1B1_feGKZE466PDa36dmA8WHmQ#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Buka di gitpod"></a> <br><br><hr><br><h1>  Tahap 10: penggunaan tekstur yang belum sempurna </h1><br>  Sekarang saya membuang warna yang dihasilkan secara acak dan mewarnai dinding saya dengan mengambil piksel kiri atas dari tekstur yang sesuai: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/87d/21d/0b1/87d21d0b13110a2b05194033b8f609aa.png"><br>  Perubahannya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bisa Anda lihat di sini</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://gitpod.io/&amp;usg=ALkJrhif1B1_feGKZE466PDa36dmA8WHmQ#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Buka di gitpod"></a> <br><br><hr><br><h1>  Tahap 11: membuat tekstur dinding menjadi nyata </h1><br>  Dan sekarang saat yang ditunggu-tunggu telah tiba ketika kita akhirnya melihat dinding bata: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/175/e25/e71/175e25e71fccf3ad167a120b878f1b60.png"><br><br>  Gagasan dasarnya sangat sederhana: di sini kita meluncur di sepanjang sinar saat ini dan berhenti pada titik x, y.  Mari kita asumsikan bahwa kita menetap di dinding "horizontal", maka y hampir bilangan bulat (tidak juga, karena cara kita bergerak di sepanjang sinar memperkenalkan kesalahan kecil).  Mari kita ambil bagian pecahan dari x dan menyebutnya hitx.  Bagian fraksinya kurang dari satu, oleh karena itu, jika kita mengalikan hitx dengan ukuran tekstur (saya punya 64), maka ini akan memberi kita kolom tekstur yang perlu digambar di tempat ini.  Tetap meregangkannya ke ukuran yang tepat dan benda itu ada di topi: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f9/444/f1c/1f9444f1cb378b082588479885799b80.png"><br><br>  Secara umum, idenya sangat primitif, tetapi membutuhkan eksekusi yang hati-hati, karena kami juga memiliki dinding "vertikal" (yang dengan hitx mendekati nol [x integer]).  Bagi mereka, kolom tekstur ditentukan oleh hity, bagian fraksional dari y.  Perubahannya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bisa Anda lihat di sini</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://gitpod.io/&amp;usg=ALkJrhif1B1_feGKZE466PDa36dmA8WHmQ#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Buka di gitpod"></a> <br><br><hr><br><h1>  Tahap 12: waktu untuk refactor! </h1><br>  Pada tahap ini, saya tidak melakukan sesuatu yang baru, saya baru saja mulai membersihkan secara umum.  Sampai sekarang, saya punya satu file raksasa (185 baris!), Dan menjadi sulit untuk bekerja di dalamnya.  Oleh karena itu, saya memecahnya menjadi awan yang kecil, sayangnya, secara sepintas, hampir menggandakan ukuran kode (319 baris), tanpa menambahkan fungsionalitas apa pun.  Tapi kemudian menjadi lebih nyaman untuk digunakan, misalnya, untuk menghasilkan animasi, cukup membuat loop seperti itu: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> frame=<span class="hljs-number"><span class="hljs-number">0</span></span>; frame&lt;<span class="hljs-number"><span class="hljs-number">360</span></span>; frame++) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">stringstream</span></span> ss; ss &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::setfill(<span class="hljs-string"><span class="hljs-string">'0'</span></span>) &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::setw(<span class="hljs-number"><span class="hljs-number">5</span></span>) &lt;&lt; frame &lt;&lt; <span class="hljs-string"><span class="hljs-string">".ppm"</span></span>; player.a += <span class="hljs-number"><span class="hljs-number">2</span></span>*M_PI/<span class="hljs-number"><span class="hljs-number">360</span></span>; render(fb, <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>, player, tex_walls); drop_ppm_image(ss.str(), fb.img, fb.w, fb.h); }</code> </pre><br>  Nah, inilah hasilnya: <br><br><img src="https://raw.githubusercontent.com/ssloy/tinyraycaster/master/doc/012.gif"><br>  Perubahannya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bisa Anda lihat di sini</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://gitpod.io/&amp;usg=ALkJrhif1B1_feGKZE466PDa36dmA8WHmQ#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Buka di gitpod"></a> <br><br><h1>  Untuk dilanjutkan ... segera </h1><br>  Pada catatan optimis ini, saya menyelesaikan separuh lembar saya saat ini, separuh kedua <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tersedia di sini</a> .  Di dalamnya kami akan menambahkan monster dan tautan ke SDL2 sehingga Anda dapat berjalan-jalan di dunia virtual kami. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id439698/">https://habr.com/ru/post/id439698/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id439688/index.html">Ikhtisar solusi AI & ML pada 2018 dan perkiraan untuk 2019: Bagian 1 - NLP, Computer Vision</a></li>
<li><a href="../id439690/index.html">Perbandingan kinerja mesin virtual dari 6 platform cloud: Selectel, MCS, I. Cloud, Google Cloud, AWS dan Azure</a></li>
<li><a href="../id439692/index.html">AT&T dituntut karena mengubah ikon jaringan dari 4G ke 5G E</a></li>
<li><a href="../id439694/index.html">Jaringan pintar responsif terhadap perubahan suhu tubuh</a></li>
<li><a href="../id439696/index.html">Di puncak gelombang, atau "Saya ingin arus utama" - tetapi apakah itu layak?</a></li>
<li><a href="../id439700/index.html">Mematenkan board game di Rusia</a></li>
<li><a href="../id439704/index.html">Dari permintaan kolam renang untuk melepaskan. Laporkan Yandex.Taxi</a></li>
<li><a href="../id439706/index.html">Konferensi BLACK HAT. Pelajaran dari selamat dari serangan DDOS 300 Gb / s. Bagian 1</a></li>
<li><a href="../id439708/index.html">Konferensi BLACK HAT. Pelajaran dari selamat dari serangan DDOS 300 Gb / s. Bagian 2</a></li>
<li><a href="../id439710/index.html">Fitur menciptakan produk untuk pasar AS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>