<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤘🏾 💃🏿 🙋🏾 使用Apple Combine进行远程异步获取的API 🍃 🤶🏾 👩🏻‍🤝‍👨🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Combine是一个功能性的响应式Swift框架，最近已在所有Apple平台（包括Xcode 11 。 使用合并，很容易处理随时间推移异步出现的值序列。 通过放弃委托和复杂的嵌套回调 ，它还简化了异步代码。 

 但是，一开始学习Combine似乎并不那么简单。 事实是， 合并的主要“参与者”是诸如...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用Apple Combine进行远程异步获取的API</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476678/"><img src="https://habrastorage.org/webt/t6/lj/xl/t6ljxl5w2xxh7v0inoq5oebgbro.png"><br><br>  <font color="#0000FF">Combine</font>是一个功能性的响应式<code>Swift</code>框架，最近已在所有<code>Apple</code>平台（包括<code>Xcode 11</code> 。 使用<font color="#0000FF">合并，</font>很容易处理随时间推移异步出现的值序列。 通过放弃委托和复杂的嵌套<font color="#0000FF">回调</font> ，它还简化了异步代码。 <br><br> 但是，一开始学习<font color="#0000FF">Combine</font>似乎并不那么简单。 事实是， <font color="#0000FF">合并</font>的主要“参与者”是诸如“ <font color="#0000FF">发布</font>者”，“ <font color="#0000FF">发布</font>者”，“订阅者”， <font color="#0000FF">订阅者</font>和操作<font color="#0000FF">员</font> “操作<font color="#0000FF">员</font> ”之类的抽象概念，没有它们，就不可能进一步理解<font color="#0000FF">合并</font>功能的逻辑。 但是，由于<code>Apple</code>为开发人员提供了现成的“发布者”，“订阅者”和操作员，因此使用<font color="#0000FF">Combine</font>编写的代码非常紧凑且易于阅读。 <br><br> 您将在一个与<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">现在</a>从非常流行的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TMDb</a>数据库中异步<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">检索电影</a>信息有关的应用程序示例中看到这一点。 我们将创建两个不同的应用程序： <font color="#0000FF">UIKit</font>和<font color="#0000FF">SwiftUI</font> ，并展示<font color="#0000FF">Combine</font>如何与它们一起工作。 <br><br><img src="https://habrastorage.org/webt/sd/jn/py/sdjnpyhqecxf8q7wvtxlkm7qbr0.png"><br><a name="habracut"></a><br> 希望本文使您能够更轻松地学习<font color="#0000FF">Combine</font> 。 在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Github</a>上可以找到本文开发的所有应用程序的代码。 <br><br>  <font color="#0000FF">合并</font>有几个主要组成部分： <br><br><h3> 发布者<b><font color="#0000FF">Publisher</font></b> 。 </h3><br><img src="https://habrastorage.org/webt/cu/6q/93/cu6q93meoo0iyfmkyqa4si1y68c.png"><br><br> 出版商<font color="#0000FF">出版商</font>是<font color="#0000FF">为</font>所有人提供<font color="#0000FF">价值的</font> TYPES。  <font color="#0000FF">Publisher的</font> “ publisher”概念是在<font color="#0000FF">Combine中</font>作为<font color="#0000FF">协议</font>而非特定的TYPE实现的。  <font color="#0000FF">Publisher</font>协议已为输出值和<font color="#0000FF">失败</font>错误关联了通用类型。 <br> 永不发布错误的“发布者”将“永不类型<font color="#0000FF">”</font>用于<font color="#0000FF">失败</font>错误。 <br><br><img src="https://habrastorage.org/webt/04/mt/gt/04mtgtm8ucbh38ywukqa-jv0qb0.png"><br><br><img src="https://habrastorage.org/webt/c9/py/wg/c9pywgmfyp5aa8t9mb0extzy764.png"><br><br>  <code>Apple</code>为开发人员提供了现成的“发布者”的特定实现： <font color="#0000FF">Just</font> ， <font color="#0000FF">Future</font> ， <font color="#0000FF">Empty</font> ， <font color="#0000FF">Deferred</font> ， <font color="#0000FF">Sequence</font> ， <font color="#0000FF">@Published</font>等。  “发布者”也被添加到<font color="#0000FF">Foundation</font>类中： <font color="#0000FF">URLSession</font> ，&lt; <font color="#0000FF">NotificationCenter</font> ， <font color="#0000FF">Timer</font> 。 <br><br><h3>  “订户” <font color="#0000FF">订户</font> 。 </h3><br><img src="https://habrastorage.org/webt/1t/h5/aj/1th5aj2egefg5fkjsikc-jurleq.png"><br><br> 它也是一个协议<font color="#0000FF">协议</font> ，为“预订”来自“发布者”的<font color="#0000FF">值</font>提供了接口。 它具有与<font color="#0000FF">输入</font>和<font color="#0000FF">故障</font>错误相关的通用类型。 显然，发布者<font color="#0000FF">发布者</font>和<font color="#0000FF">订阅者订阅者</font>的类型必须匹配。 <br><br><img src="https://habrastorage.org/webt/2g/de/2n/2gde2nlg6zae1fezvtewfziyh0w.png"><br><br> 对于任何发布者发布者，都有两个内置的<font color="#0000FF">订阅者</font> ：接收<font color="#0000FF">器</font>和<font color="#0000FF">分配</font> ： <br><br><img src="https://habrastorage.org/webt/vq/ua/q-/vquaq-t465oyg5ku4plfd-jvyks.png"><br><br>  “ Subscriber”接收<font color="#0000FF">器</font>基于两个闭包：一个闭包<font color="#0000FF">ReceiveValue</font>在获取<font color="#0000FF">值</font>时执行，第二闭包<font color="#0000FF">receiveCompletion</font>在“发布”完成时（通常或有错误）执行。 <br><br><img src="https://habrastorage.org/webt/im/fj/56/imfj56ymla1daatwof2b1qxkja8.png"><br><br>  “订户” <font color="#0000FF">分配将</font>接收到的每个值前进到指定的<code>key Path</code> 。 <br><br><h3>  “订阅” <font color="#0000FF">订阅</font> 。 </h3><br><img src="https://habrastorage.org/webt/ha/rn/bv/harnbvbg6gigvyslb2aex_ujy4m.png"><br><br> 首先，“发布者” <font color="#0000FF">发布</font> <font color="#0000FF">者</font>通过其“ <font color="#0000FF">接收”（订阅：）</font>方法创建“订阅” <font color="#0000FF">订阅</font>并将其交付给“订阅者” <font color="#0000FF">订阅者</font> ： <br><br><img src="https://habrastorage.org/webt/rk/tk/s8/rktks8zchgxyblozzz96otrxiee.png"><br><br> 之后， <font color="#0000FF">订阅</font>可以使用以下两种方法将其<font color="#0000FF">值</font>发送<font color="#0000FF">到</font>订阅者的“ <font color="#0000FF">订阅</font>者”： <br><br><img src="https://habrastorage.org/webt/hl/4x/ev/hl4xev6fakwtgs-wpv3afwuaywa.png"><br><br> 如果您已完成<font color="#0000FF">Subscription Subscription的使用</font> ，则可以调用其<font color="#0000FF">cancel（）</font>方法： <br><br><img src="https://habrastorage.org/webt/lz/ap/bt/lzapbts_gq9by1lw8qicdg3v2hc.png"><br><br><h3>  “主题” <font color="#0000FF">主题</font> 。 </h3><br><img src="https://habrastorage.org/webt/hy/cq/5p/hycq5pytsfa_gkzmqrwtmtal7tw.png"><br><br> 这是一个协议<font color="#0000FF">协议</font> ，为“发布者”和“订户”这两个客户端都提供了接口。 本质上，“主题” <font color="#0000FF">主题</font>是“发布者” <font color="#0000FF">Publisher</font> ，它可以接受输入值<font color="#0000FF">Input</font> ，您可以通过调用<font color="#0000FF">send（）</font>方法将其用于将<font color="#0000FF">值</font> “注入”到流中。 在<font color="#0000FF">组合</font>模型中调整现有命令式代码时，此功能很有用。 <br><br><h3> 操作<font color="#0000FF">员</font> 。 </h3><br><img src="https://habrastorage.org/webt/h-/d-/r1/h-d-r1jmm2yxa5kefxpf5opmuw4.png"><br><br> 使用运算符，您可以通过转换，过滤甚至合并许多以前的<code>upstream</code> <b><font color="#0000FF">发布者</font></b>的<font color="#0000FF">值</font> ，从另一个<font color="#0000FF">发布者</font> “发布者”创建一个新的发布者“发布者”。 <br><br><img src="https://habrastorage.org/webt/ol/he/rz/olherzm4jvlkfwer3x0gdbc0guk.png"><br><br> 您会在此处看到许多熟悉的运算符名称： <font color="#0000FF">compactMap</font> ， <font color="#0000FF">map</font> ， <font color="#0000FF">filter</font> ， <font color="#0000FF">dropFirst</font> ， <font color="#0000FF">append</font> 。 <br><br><h3>  <font color="#0000FF">基金会</font>发行人<font color="#0000FF">基金会中</font>内置了发行人。 </h3><br>  <code>Apple</code>还为开发人员提供了<font color="#0000FF">Foundation</font> &lt;framework（即发布者的发布者）中一些已经内置的<font color="#0000FF">Combine</font>功能，用于执行以下任务：使用<font color="#0000FF">URLSession</font>提取数据，使用<font color="#0000FF">Notification</font> ， <font color="#0000FF">Timer</font>处理通知以及基于<font color="#0000FF">KVO</font>监视属性。 这种内置的兼容性将真正帮助我们将<font color="#0000FF">Combine</font>框架集成到当前项目中。 <br> 要了解更多信息，请参阅文章<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“ Swift中的Ultimate Combine框架教程”</a> 。 <br><br><h3> 我们将如何学习与<font color="#0000FF">Combine</font>相<font color="#0000FF">结合</font> ？ </h3><br> 在本文中，我们将学习如何使用<font color="#0000FF">Combine</font>框架从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TMDb</a>网站获取电影数据。 这是我们将一起学习的内容： <br><br><ul><li> 使用“发布者” <font color="#0000FF">Future</font>创建一个带有<font color="#0000FF">Promise</font>的闭包，用于一个值： <font color="#0000FF">值</font>或错误。 </li><li> 使用“发布者” <font color="#0000FF">URLSession.datataskPublisher</font>来“订阅”给定<code>UR</code> L发布的数据<font color="#0000FF">数据</font> 。 </li><li> 使用<font color="#0000FF">tryMap</font>运算符通过另一个Publisher发布者转换数据<font color="#0000FF">数据</font> 。 </li><li> 使用<font color="#0000FF">解码</font>运算符将数据<font color="#0000FF">数据</font>转换为可<font color="#0000FF">解码</font>对象，并将其发布以传输到链中的后续元素。 </li><li> 使用接收<font color="#0000FF">器</font>运算符使用闭包“订阅”到发布者“发布者”。 </li><li> 使用<font color="#0000FF">assign</font>语句“订阅”到发布者“ publisher”，并将其提供的值分配给给定的<code>key Path</code> 。 </li></ul><br><h3> 初始项目 </h3><br> 在开始之前，我们必须先注册才能在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TMDb</a>网站上接收<code>API</code>密钥。 您还需要从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub</a>存储库下载初始项目。 <br> 确保将<code>API</code>密钥放在<font color="#0000FF">让apiKey</font>常量的<font color="#0000FF">MovieStore类</font>中。 <br><br><img src="https://habrastorage.org/webt/u0/fp/ev/u0fpevrqivppfng0lyoglbkp-cq.png"><br><br> 以下是我们用来创建项目的主要构建块： <br><br><ul><li>  1. <code>Movie.swift</code>文件中包含我们将在项目中使用的模型。  <font color="#0000FF">struct MoviesResponse</font>的根结构实现了<font color="#0000FF">Decodable</font>协议，我们在将<code>JSON</code>数据解码为Model时将使用该协议。  <font color="#0000FF">MoviesResponse</font>结构具有<font color="#0000FF">results</font>属性，该属性还实现了<font color="#0000FF">Decodable</font>协议，并且是电影<font color="#0000FF">[Movie]</font>的集合。 是她使我们感兴趣： </li></ul><br><img src="https://habrastorage.org/webt/1o/9s/xz/1o9sxzm4t-edp2l2hhauqky2dve.png"><br><br><ul><li>  2.枚举<font color="#0000FF">MovieStoreAPIError</font>实施<font color="#0000FF">Error</font>协议。 我们的<code>API</code>将使用此枚举来表示各种错误： <code>URL</code> <font color="#0000FF">检索</font>错误<font color="#0000FF">urlError</font> ， <font color="#0000FF">encodingError</font> <font color="#0000FF">解码</font>错误和<font color="#0000FF">responseError</font>数据获取错误。 </li></ul><br><img src="https://habrastorage.org/webt/kn/3n/av/kn3nav2xvctmabav1v2zdi_6hrw.png"><br><br><ul><li>  3.我们的<code>API</code>具有一个<font color="#0000FF">MovieService</font>协议，该协议具有单个方法<font color="#0000FF">fetchMovies（来自端点：Endpoint）</font> ，该方法根据<font color="#0000FF">端点</font>参数选择<font color="#0000FF">[Movie]</font>电影。  <font color="#0000FF">端点</font>本身是一个<font color="#0000FF">枚举</font>枚举，代表用于访问<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TMDb</a>数据库以获取诸如<font color="#0000FF">nowPlaying</font> （最新）， <font color="#0000FF">流行</font> （受欢迎）， <font color="#0000FF">topRated</font> （顶部）和<font color="#0000FF">即将上映</font> （即将在屏幕上）之类的电影的<font color="#0000FF">端点</font> 。 </li></ul><br><img src="https://habrastorage.org/webt/4b/a1/ki/4ba1kiw5glfklazq04txpbbs6fy.png"><br><br><ul><li>  4. MovieStore <font color="#0000FF">类</font>是一个特定的类，该类实现<font color="#0000FF">MovieService</font>协议以从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TMDb</a>站点获取数据。 在此类内部，我们使用<font color="#0000FF">Combine来</font>实现<font color="#0000FF">fetchMovies（...）</font>方法。 </li></ul><br><img src="https://habrastorage.org/webt/l2/lr/q1/l2lrq1ff5w76cxbvpmr53eywiy4.png"><br><br><ul><li>  5. <font color="#0000FF">MovieListViewController</font>类是主要的<font color="#0000FF">ViewController</font>类，在该类中，我们使用接收<font color="#0000FF">器</font>方法“订阅” <font color="#0000FF">fetchMovies（...）</font>电影fetch方法，该方法将返回<font color="#0000FF">Future</font> “发布者”，然后使用新的电影数据更新<font color="#0000FF">TableView</font>表使用新的<font color="#0000FF">DiffableDataSourceSnapshot</font> <code>API</code> <font color="#0000FF">电影</font> 。 </li></ul><br> 在开始之前，让我们看一下将用于远程数据检索<code>API</code>一些基本的<font color="#0000FF">Combine</font>组件。 <br><br><h3> 使用接收<font color="#0000FF">器</font>及其闭包“订阅”到“发布者”。 </h3><br>  “订阅”发布者“发布者”的最简单方法是使用接收<font color="#0000FF">器</font>及其闭包，其中之一将在我们获得新<font color="#0000FF">值</font>时执行，另一种将在“发布者”完成传递<font color="#0000FF">值时执行</font> 。 <br><br><img src="https://habrastorage.org/webt/yb/wt/ng/ybwtnglt5iuxpbfpkj3tgud_qpo.png"><br><br> 请记住，在<font color="#0000FF">Combine中，</font>每个“订阅”都返回一个<font color="#0000FF">Cancellable</font> ，一旦我们离开上下文，它将被删除。 为了长时间维护“订阅”，例如，以异步方式获取值，我们需要将“订阅”保存在<font color="#0000FF">subscription1</font>属性中。 这使我们能够始终如一地获取所有<font color="#0000FF">值（7,8,3,4）</font> 。 <br><br><h3>  <font color="#0000FF">Future</font>异步“发布”单个值： <font color="#0000FF">值</font>或<font color="#0000FF">失败</font>错误。 </h3><br> 在<font color="#0000FF">Combine</font>框架中，“发布者” <font color="#0000FF">Future</font>可用于使用闭包异步获取单个TYPE的<font color="#0000FF">Result</font> 。 闭包有一个参数<font color="#0000FF">-Promise</font> ，它是TYPE <font color="#0000FF">（Result &lt;Output，Failure&gt;）-&gt; Void</font>的函数。 <br><br> 让我们看一个简单的示例，以了解<font color="#0000FF">Future</font>发布者的功能： <br><br><img src="https://habrastorage.org/webt/x9/6p/_p/x96p_plt6deyew9_q5yupqa_zsc.png"><br><br> 我们使用TYPE <font color="#0000FF">Int</font>的成功结果和TYPE <font color="#0000FF">Never</font>的错误创建<font color="#0000FF">Future</font> 。 在<font color="#0000FF">Future</font>闭包内部，我们使用<font color="#0000FF">DispatchQueue.main.asyncAfter（...）</font>将代码的执行延迟<font color="#0000FF">2</font>秒，从而模拟异步行为。 在闭包内部，我们以成功的<font color="#0000FF">Promise</font> <font color="#0000FF">（.success（...））</font>返回<font color="#0000FF">Promise</font> ，它是一个介于<font color="#0000FF">0</font>到<font color="#0000FF">100</font>之间的随机整数<font color="#0000FF">Int</font>值。 接下来，我们使用两个<font color="#0000FF">将来的</font>订阅（ <font color="#0000FF">cancellable</font>和<font color="#0000FF">cancellable1）</font> ，尽管内部生成一个随机数，但两者都给出相同的结果。 <br><blockquote>  <u><i><code> 1.</code></i></u>应注意，与其他“发布者”相比，“ <font color="#0000FF">合并中</font>的<font color="#0000FF">未来</font> ”的“发布者”具有某些行为特征： <br><br><ul><li>  “发布者” <font color="#0000FF">Future</font>总是“发布”一个值（ <font color="#0000FF">值</font>或错误），从而完成了其工作。 </li></ul><br><ul><li> 与其他主要是<font color="#0000FF">struct</font> （ <code>value type</code> ）结构的“发布者”不同<font color="#0000FF">，</font> <font color="#0000FF">Future</font> “发布者”是一个<font color="#0000FF">类</font> （ <code>reference type</code> ） <font color="#0000FF">类，</font>它作为<font color="#0000FF">Promise</font>闭包的参数传递，该闭包是在<font color="#0000FF">Future</font> “发布者”实例初始化后立即创建的。 也就是说，在任何订户“ <font color="#0000FF">订户</font> ”完全<font color="#0000FF">订阅</font> <font color="#0000FF">Future</font> “发布者”实例之前发送<font color="#0000FF">Promise</font>闭包。 像所有其他普通<font color="#0000FF">发行商所</font>要求的那样， <font color="#0000FF">Future</font>的“发行人”根本不需要“订户”来运行。 这就是为什么在上面的代码中只打印一次“未来的你好！”文本的原因。 </li></ul><br><ul><li> 与大多数其他<font color="#0000FF">懒惰的</font> “发布者”（仅在有“订阅”的情况下才“发布”）不同， <font color="#0000FF">未来的</font> “发布者”是一个<code>eager</code> （急躁的）“发布者”。 只有<font color="#0000FF">Future</font>发布者关闭其<font color="#0000FF">Promise后</font> ，结果才会被记住，然后传递给当前和将来的“订户”。 从上面的代码中，我们可以看到，当您反复“订阅”到<font color="#0000FF">将来的</font>发布者时，尽管在闭包中使用了相同的“随机”值（在本例中为<font color="#0000FF">6</font> ，但是可以不同，但​​始终相同）。随机的<font color="#0000FF">int</font>值。 </li></ul></blockquote><br>  <font color="#0000FF">Future的</font> “发布者”的这种逻辑使其可以成功地用于存储异步资源消耗的计算结果，并且不会打扰随后的多个“订阅”的“服务器”。 <br><br> 如果<font color="#0000FF">Future</font>的“发布者”的这种逻辑不适合您，并且您希望您的<font color="#0000FF">Future被</font>称为<font color="#0000FF">惰性的，</font>并且每次您获得新的随机<font color="#0000FF">Int</font>值，那么您都应该以“ <font color="#0000FF">延迟</font> ”方式包装“ <font color="#0000FF">Future</font> ”： <br><br><img src="https://habrastorage.org/webt/j3/gf/25/j3gf25golyfoyl0jvkfddej2mk8.png"><br><br> 正如<font color="#0000FF">Combine</font>所建议的那样，我们将以<font color="#0000FF">一种</font>经典的方式使用<font color="#0000FF">Future</font> ，即作为“共享”计算的异步“发布者”。 <br><br><blockquote> 注意2：我们需要使用接收<font color="#0000FF">器</font>到异步“发布者”来对“订阅”进行更多说明。 该接收<font color="#0000FF">器</font>方法返回<font color="#0000FF">AnyCancellable</font> ，我们一直不记得它。 这意味着<code>Swift</code>在离开给定上下文时销毁<font color="#0000FF">AnyCancellable</font> ，这是在<code>main thread</code>上发生的事情。 因此，事实证明，在<font color="#0000FF">Promise</font>闭包可以在<code>main thread</code>上开始之前， <font color="#0000FF">AnyCancellable</font>被销毁了。 销毁<font color="#0000FF">AnyCancellable时</font> ，将调用其<font color="#0000FF">cancel</font>方法，在这种情况下，该方法将取消“预订”。 这就是为什么我们在变量<font color="#0000FF">cancellable</font> &lt;和<font color="#0000FF">cancellable1</font>或<font color="#0000FF">Set &lt;AnyCancellable&gt;（）中</font>记住我们对<font color="#0000FF">未来的</font> <font color="#0000FF">沉没</font> “订阅”。 </blockquote><br><br><h3> 使用“ <font color="#0000FF">合并”</font>从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TMDb</a>网站获取电影。 </h3><br> 首先，打开启动项目，并转到带有空实现的<code>MovieStore.swift</code>文件和<font color="#0000FF">fetchMovies</font>方法： <br><br><img src="https://habrastorage.org/webt/fg/aw/s0/fgaws0kq7u9kz5ojjz3jlij9zl8.png"><br><br> 使用<font color="#0000FF">fetchMovies</font>方法<font color="#0000FF">，</font>可以通过为TYPE <font color="#0000FF">Endpoint</font>的<font color="#0000FF">端点</font>输入参数设置特定的值来选择各种影片。  TYPE <font color="#0000FF">Endpoint</font>是一个<font color="#0000FF">枚举</font>枚举，其值<font color="#0000FF">包含nowPlaying</font> （当前）， <font color="#0000FF">即将到来</font> （即将进入屏幕）， <font color="#0000FF">popular</font> （受欢迎）， <font color="#0000FF">topRated</font> （顶部）： <br><br><img src="https://habrastorage.org/webt/-a/xt/-f/-axt-f0lhtfrt8u_a-ay7q3z8jk.png"><br><br> 让我们从使用<code>callback</code>闭包初始化<font color="#0000FF">Future</font>开始。 收到以后，我们将退款。 <br><br><img src="https://habrastorage.org/webt/hu/v0/pu/huv0pu3w26r2fms4ih4fvhrx8to.png"><br><br> 在<code>callback</code>闭包内部，我们使用<font color="#0000FF">generateURL（带有endpoint：Endpoint）</font>函数为<font color="#0000FF">端点</font>输入参数的相应值生成<code>URL</code> ： <br><br><img src="https://habrastorage.org/webt/q8/ce/9e/q8ce9ez5nokjff1c_oowpfdlncm.png"><br><br> 如果无法生成正确的<code>URL</code> ，则我们使用<font color="#0000FF">promise（.failure（.urlError（...））</font>返回错误，否则，继续执行“发布者” <font color="#0000FF">URLSession.dataTaskPublisher</font> 。 <br><br> 要“订阅”来自某个<code>URL</code>数据<code>URL</code>我们可以使用<font color="#0000FF">URLSession</font>类中内置的<font color="#0000FF">datataskPublisher</font>方法，该方法将<code>URL</code>作为参数，并使用元组的输出数据<font color="#0000FF">（数据：数据，响应：URLResponse）</font>和<font color="#0000FF">URLError</font>错误返回发布者“发布者”。 <br><br><img src="https://habrastorage.org/webt/wb/dv/uy/wbdvuyzbpv6w3qxfzjyfxxwtmx8.png"><br><br> 要将一个Publisher发布者转换为另一Publisher发布者，请使用<font color="#0000FF">tryMap</font>运算符。 与<font color="#0000FF">map</font>相比， <font color="#0000FF">tryMap</font>运算符可以在闭包内<font color="#0000FF">引发throws</font> <font color="#0000FF">Error</font>错误，这<font color="#0000FF">将向</font>我们返回新的Publisher发布者。 <br><br> 在下一步中，我们将使用<font color="#0000FF">tryMap</font>运算符检查响应<font color="#0000FF">响应</font>的<font color="#0000FF">statusCode</font> <code>http</code>代码，以确保其值在<font color="#0000FF">200</font>到<font color="#0000FF">300</font>之间。 如果不是，则抛出<font color="#0000FF">throws</font> <font color="#0000FF">responseError</font> <font color="#0000FF">枚举MovieStoreAPIError</font>枚举错误值。 否则（没有错误时），我们仅将接收到的数据<font color="#0000FF">数据</font>返回到“发布者”链中<font color="#0000FF">的</font>下一个<font color="#0000FF">发布者</font> 。 <br><br><img src="https://habrastorage.org/webt/wy/ln/6c/wyln6c46anluun6s7woysgopsma.png"><br><br> 在下一步中，我们将使用<font color="#0000FF">解码</font>运算符，该运算符使用<font color="#0000FF">JSONDecoder</font>将先前“发布者” <font color="#0000FF">tryMap</font>的输出<code>JSON</code>数据解码为<font color="#0000FF">MovieResponse</font> &lt;Model。 <br><br><img src="https://habrastorage.org/webt/-s/jt/0j/-sjt0j9lf5pbkugsryptozbb0ei.png"><br><br>  ... <font color="#0000FF">jsonDecoder</font>配置为特定的日期格式： <br><br><img src="https://habrastorage.org/webt/ub/ed/pu/ubedpue91eckdhygbfmxbnk4oqk.png"><br><br> 为了在<code>main thread</code>上执行处理，我们将使用<font color="#0000FF">receive（on :)</font>运算符并将<font color="#0000FF">RunLoop.main</font>作为其输入参数传递。 这将允许“订户”在<code>main</code>线程上获取值。 <br><br><img src="https://habrastorage.org/webt/gr/n2/wh/grn2whzqqawxp_1-ffqh6jwhmse.png"><br><br> 最后，我们到了转型链的尽头，在那里我们使用接收<font color="#0000FF">器</font>来获得对发布者“发布者”形成的“链”的“订阅” <font color="#0000FF">订阅</font> 。 要初始化<font color="#0000FF">Sink</font>类的实例，我们需要两件事，尽管其中之一是可选的： <br><br><ul><li> 关闭<font color="#0000FF">receiveValue:。</font> 每当“订阅” <font color="#0000FF">订阅</font>从“发布者” <font color="#0000FF">发布者</font>接收到新<font color="#0000FF">值</font>时，它将被调用。 </li></ul><br><ul><li>  <font color="#0000FF">receiveCompletion</font>关闭<font color="#0000FF">：（</font>可选）。 在<font color="#0000FF">发布者</font> “发布者”完成<font color="#0000FF">值</font>的<font color="#0000FF">发布</font>后将调用该方法，并为其提供<font color="#0000FF">完成</font>枚举，我们可以使用该枚举枚举检查值的“发布”是否确实完成或完成是由于错误引起的。 </li></ul><br> 在<font color="#0000FF">receiveValue</font>闭包内部，我们只需<font color="#0000FF">调用一个</font>带有<font color="#0000FF">.success</font>选项和<font color="#0000FF">$ 0.results</font>值的<font color="#0000FF">promise</font> ，在我们的示例中，该值是<font color="#0000FF">一系列movie</font> <font color="#0000FF">电影</font> 。 在<font color="#0000FF">receiveCompletion</font>闭包内部<font color="#0000FF">，</font>我们检查<font color="#0000FF">完成是否有</font>错误<font color="#0000FF">错误</font> ，然后使用<font color="#0000FF">.failure</font>选项传递相应的<font color="#0000FF">promise</font>错误。 <br><br><img src="https://habrastorage.org/webt/gr/qh/tm/grqhtm3xthdx7snxlmwfawmd3rq.png"><br><br> 请注意，这里我们收集了“发布者链”先前阶段中“抛出”的所有错误。 <br><br> 接下来，我们在<font color="#0000FF">Set &lt;AnyCancellable&gt;（）</font>属性中存储“ subscription” <font color="#0000FF">订阅</font> 。 <br> 事实是，“订阅” <font color="#0000FF">订阅</font>是<font color="#0000FF">可取消的</font> ，它是一种协议，在<font color="#0000FF">fetchMovies</font>函数完成后会破坏并清除所有内容。 为了确保即使完成此功能后仍保留“订阅” <font color="#0000FF">订阅</font> ，我们需要记住<font color="#0000FF">fetchMovies</font>函数外部变量中的“订阅” <font color="#0000FF">订阅</font> 。 在我们的示例中，我们使用<font color="#0000FF">subscriptions</font>属性，该属性具有<font color="#0000FF">Set &lt;AnyCancellable&gt;（）类型，</font>并使用<font color="#0000FF">.store（in：＆self.subscriptions）方法</font> ，该<font color="#0000FF">方法</font>可确保<font color="#0000FF">fetchMovies</font>函数<font color="#0000FF">完成</font>工作后“预订”的<font color="#0000FF">可用性</font> 。 <br><br><img src="https://habrastorage.org/webt/uh/zx/j9/uhzxj91hkb5y5tm-hd1bheoukcu.png"><br><br> 到此，就结束了使用<font color="#0000FF">Combine</font>框架从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">tmdb</a>数据库中选择电影的<font color="#0000FF">fetchMovies</font>方法的形成。 作为输入参数的<font color="#0000FF">fetchMovies</font>方法采用<font color="#0000FF">枚举Endpoint</font>枚举的值，即我们感兴趣的特定影片： <br><br>  <font color="#0000FF">.nowPlaying-</font>当前正在播放的电影， <br>  <font color="#0000FF">.upcoming-</font>即将<font color="#0000FF">上映的</font>电影， <br>  <font color="#0000FF">.popular-</font>热门电影， <br>  <font color="#0000FF">.topRated-</font>顶级电影，即具有很高的评价。 <br> 让我们尝试以<code>Table View Controller</code>的形式使用常见的<font color="#0000FF">UIKit</font>用户界面将此<code>API</code>应用于应用程序设计： <br><br><img src="https://habrastorage.org/webt/lr/6g/gu/lr6gguhjajdke_udcrw1ihyaonu.png"><br><br> 以及使用新的声明性<font color="#0000FF">SwiftUI</font>框架构建用户界面的应用程序： <br><br><img src="https://habrastorage.org/webt/md/_v/kf/md_vkfmsoa--efg4ig5ej-98nue.png"><br><br><h3>  “订阅”来自常规<code>View Controller</code> <font color="#0000FF">电影的电影</font> 。 </h3><br> 我们将移动到<i>MovieListViewController.swift</i>文件，并在<font color="#0000FF">viewDidLoad</font>方法中调用<font color="#0000FF">fetchMovies</font>方法。 <br><br><img src="https://habrastorage.org/webt/k3/pw/p_/k3pwp_hzhixbhhkgnvuughyv5na.png"><br><br> 在我们的<font color="#0000FF">fetchMovies</font>方法中<font color="#0000FF">，</font>我们使用<font color="#0000FF">较早</font>开发的<font color="#0000FF">movieAPI</font>及其<font color="#0000FF">fetchMovies</font>方法，其中<font color="#0000FF">.nowPlaying</font>参数作为<font color="#0000FF">from</font>输入参数的<font color="#0000FF">端点</font> 。 也就是说，我们将选择电影院屏幕上当前正在播放的电影。 <br><br><img src="https://habrastorage.org/webt/k2/x0/xj/k2x0xjbdbgvi-sk9ifo9u5zxj9e.png"><br><br>  <font color="#0000FF">movieAPI.fetchMovies（来自：.nowPlaying）方法</font>返回<font color="#0000FF">Future</font> “发布者”，我们使用接收<font color="#0000FF">器</font>向其“订阅”，并为其提供两个闭包。 在<font color="#0000FF">receiveCompletion</font>闭包中， <font color="#0000FF">我们</font>检查是否存在错误<font color="#0000FF">错误，</font>并通过显示的错误消息向用户<font color="#0000FF">警报</font>显示紧急警告。 <br><br><img src="https://habrastorage.org/webt/i8/3f/po/i83fpotmo-qab-imavpikbmsbxo.png"><br><br> 在<font color="#0000FF">receiveValue</font>闭包中<font color="#0000FF">，</font>我们调用<font color="#0000FF">generateSnapshot</font>方法并将选定的<font color="#0000FF">电影</font>传递<font color="#0000FF">给它</font> 。 <br><br><img src="https://habrastorage.org/webt/iz/hm/qi/izhmqi60prl_u55nf-iypvstnnq.png"><br><br>  <font color="#0000FF">generateSnapshot</font>函数使用我们的<font color="#0000FF">电影</font> <font color="#0000FF">生成</font>一个新的<font color="#0000FF">NSDiffableDataSourceSnapshot</font> ，并将生成的<font color="#0000FF">快照</font>应用于表的<font color="#0000FF">diffableDataSource</font> 。 <br><br> 我们启动该应用程序，并观察<font color="#0000FF">UIKit</font>如何与<font color="#0000FF">Combine</font>框架中的“发布者”和“订阅者”一起工作。 这是一个非常简单的应用程序，不允许您调入各种电影集-现在在屏幕上显示，流行，高评级或在不久的将来将出现在屏幕上的电影。 我们仅看到将要出现在屏幕上的电影（ <font color="#0000FF">.upcoming</font> ）。 当然，您可以通过添加任何<code>UI</code>元素来设置<font color="#0000FF">Endpoint</font>枚举的值来实现此目的，例如使用<code>Stepper</code>或<code>Segmented Control</code> ，然后更新用户界面。 这是众所周知的，但是我们不会在基于<font color="#0000FF">UIKit</font>的<font color="#0000FF">应用程序中</font>执行此操作，而是将其留给新的声明性<font color="#0000FF">SwiftUI</font>框架。 <br> 可在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Github</a>上的<i><code>CombineFetchAPICompleted-UIKit</code></i>找到基于<i><code>CombineFetchAPICompleted-UIKit</code></i>的<font color="#0000FF">应用程序</font>的代码。 <br><br><h3> 使用<font color="#0000FF">SwiftUI</font>显示电影<font color="#0000FF">电影</font> </h3>  。 <br>    <code>CombineFetchAPI-MY</code>  <font color="#0000FF">SwiftUI</font>     <code>File</code> -&gt; <code>New</code> -&gt; <code>Project</code>    <code>Single View App</code>   <code>iOS</code> : <br><br><img src="https://habrastorage.org/webt/pi/bu/xu/pibuxuc4tnqd6roa_puo0-iwdpq.png"><br><br>        <code>UI</code> — <font color="#0000FF">SwiftUI</font> : <br><br><img src="https://habrastorage.org/webt/mm/zy/_o/mmzy_o9znv-qwuodqzaveavzsak.png"><br><br>            <code><i>Movie.swift</i></code>      <code><i>Model</i></code> ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TMDb</a>  <code><i>MovieStore.swift</i></code> , <code><i>MovieStoreAPIError.swift</i></code>  <code><i>MovieService.swift</i></code> ,       <code><i>MovieService</i></code>  <code><i>Protocol</i></code> : <br><br><img src="https://habrastorage.org/webt/21/ni/4f/21ni4fl3gnd-j4jrehzqt7vf218.png"><br><br>  <font color="#0000FF">SwiftUI</font> ,  <code></code>  <font color="#0000FF">Codable</font> ,      <code>JSON</code> ,  <font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可识别</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果我们想使自己更容易将电影列表</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Movie]显示</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为列表</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">List</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SwiftUI中的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模型</font><font style="vertical-align: inherit;">不需要是</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equatable</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hashable的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这是</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIKit</font></font></font> <code>API</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对</font><font style="vertical-align: inherit;">以前的</font><font color="#0000FF"><font style="vertical-align: inherit;">UIKit</font></font><font style="vertical-align: inherit;">应用程序中</font><font style="vertical-align: inherit;">的</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UITableViewDiffableDataSource</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所要求的</font><font style="vertical-align: inherit;">。因此，我们从&lt; </font><font color="#0000FF"><font style="vertical-align: inherit;">struct Movie</font></font><font style="vertical-align: inherit;">结构中删除了</font><font style="vertical-align: inherit;">所有与</font><font color="#0000FF"><font style="vertical-align: inherit;">Equatable</font></font><font style="vertical-align: inherit;">和</font><font color="#0000FF"><font style="vertical-align: inherit;">Hashable协议</font></font><font style="vertical-align: inherit;">相关的方法</font><font style="vertical-align: inherit;">：</font><b><font style="vertical-align: inherit;">............................</font></b><font style="vertical-align: inherit;">有一篇很棒的</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">Identifiable</font></a><font style="vertical-align: inherit;">文章</font><font style="vertical-align: inherit;">，显示了</font><font style="vertical-align: inherit;">协议</font><font style="vertical-align: inherit;">之间的区别和相似之处</font><font style="vertical-align: inherit;">。</font></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/webt/9m/tu/zd/9mtuzdjefl-wbw3jigfpr5op5bw.png"><br> <b><font style="vertical-align: inherit;"></font></b> <br><img src="https://habrastorage.org/webt/_q/uc/b2/_qucb2csrso2vfuac1cvow_ysvm.png"><br><br><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code>Swift</code><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可识别的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平等的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SwiftUI</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建的用户界面</font><font style="vertical-align: inherit;">基于以下事实：</font><font style="vertical-align: inherit;">在获取数据并获取所需的影片收藏时</font><font style="vertical-align: inherit;">，我们会更改</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端点</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并以列表的形式显示：</font></font><br><br><img src="https://habrastorage.org/webt/o4/-k/qa/o4-kqamned7_ee6snel_57zc0ek.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIKit一样</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">movieAPI</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数对数据进行采样</font><font color="#0000FF"><font style="vertical-align: inherit;">.fetchMovies（来自端点：Endpoint）</font></font><font style="vertical-align: inherit;">，它将获取所需的</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端点</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并返回“发布者” </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Future &lt;[Movie，MovieStoreAPIError]&gt;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如果我们看一下</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Endpoint</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font><font style="vertical-align: inherit;">，将会看到我们可以初始化所需的选项</font></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Endpoint</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举的</font><font color="#0000FF"><font style="vertical-align: inherit;">情况</font></font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">并</font><font style="vertical-align: inherit;">因此</font><font style="vertical-align: inherit;">使用索引</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">索引</font></font></font><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/webt/ze/jb/9d/zejb9d_o2gr4m4oymkatehr2uuw.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来获得</font><font style="vertical-align: inherit;">所需的电影集</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">因此，要获取我们需要的</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电影</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的电影集</font><font style="vertical-align: inherit;">，只需设置</font><font color="#0000FF"><font style="vertical-align: inherit;">Endpoint</font></font><font style="vertical-align: inherit;">枚举</font><font style="vertical-align: inherit;">的相应索引</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexEndpoint即可</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。让我们开始吧</font><font style="vertical-align: inherit;">，在我们的例子中，它将是</font><font style="vertical-align: inherit;">实现</font><font color="#0000FF"><font style="vertical-align: inherit;">ObservableObject</font></font><font style="vertical-align: inherit;">协议</font><font style="vertical-align: inherit;">的</font><font color="#0000FF"><font style="vertical-align: inherit;">MoviesViewModel</font></font><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">。在我们的项目中</font><font style="vertical-align: inherit;">为我们</font><font style="vertical-align: inherit;">添加一个新的</font><i><font style="vertical-align: inherit;">MoviesViewModel.swift</font></i><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">在这个非常简单的类中，我们有两个</font><font color="#0000FF"><font style="vertical-align: inherit;">@Published</font></font><font style="vertical-align: inherit;">属性：一个</font><font color="#0000FF"><font style="vertical-align: inherit;">@Published var indexEndpoint：Int</font></font></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><code>View Model</code><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><code>View Model</code><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/webt/w3/tx/bl/w3txblf8e8ectsgykvterljstjk.png"><br><br><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-输入，其他</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Published var电影：[电影]</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -输出。一旦我们把</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Published</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前财产</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexEndpoint</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们就可以开始使用它作为一个简单的属性</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexEndpoint</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，作为发布商，</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ indexEndpoint</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在初始化</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MoviesViewModel</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类的实例时</font><font color="#0000FF"><font style="vertical-align: inherit;">，</font></font><font style="vertical-align: inherit;">我们必须将链从输入“ publisher” </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ indexEndpoint延伸</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到输出“ publisher” TYPE </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AnyPublisher &lt;[Movie]，Never&gt;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用我们已知的</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">movieAPI.fetchMovies（from：Endpoint（index</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）函数）</font><font color="#0000FF"><font style="vertical-align: inherit;">：indexPoint））</font></font><font style="vertical-align: inherit;">和</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flatMap</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运算符</font><font style="vertical-align: inherit;">。</font></font><br><br><img src="https://habrastorage.org/webt/ur/e7/y2/ure7y2ym3mkucrvj-r0ubwezc0i.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们使用非常简单的“订阅者” </font><font style="vertical-align: inherit;">分配</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（到：\。movies，on：self）</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来“订阅”这个新接收的“发布者” </font><font color="#0000FF"><font style="vertical-align: inherit;">，</font></font><font style="vertical-align: inherit;">并将从“发布者”接收的值分配给</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电影</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出数组</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">仅当“发布者”没有引发错误，即错误类型为</font><font color="#0000FF"><font style="vertical-align: inherit;">Never时</font></font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">我们才可以应用“订阅” </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分配（应用于：\ .movi​​es，on：self）</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。如何实现呢？与操作员的帮助</font><font color="#0000FF"><font style="vertical-align: inherit;">replaceError（附：[]）</font></font><font color="#0000FF"><font style="vertical-align: inherit;">，</font></font><font style="vertical-align: inherit;">将取代的膜的空阵列上的任何错误</font><font color="#0000FF"><font style="vertical-align: inherit;">的电影</font></font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">也就是说，我们的</font><font color="#0000FF"><font style="vertical-align: inherit;">SwiftUI</font></font><font style="vertical-align: inherit;">应用程序</font><font style="vertical-align: inherit;">的第一个简单版本</font><font style="vertical-align: inherit;">将不会向用户显示有关可能的错误的信息。</font></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><br><br> ,     <code>View Model</code>   ,    <code>UI</code> .    <i>ContentView.swift</i>  <code>View Model</code>  <font color="#0000FF">@EnvironmentObject</font>  <font color="#0000FF">var moviesViewModel</font>   <font color="#0000FF">Text(«Hello, World!»)</font>  <br> <font color="#0000FF">Text("\(moviesViewModel.indexEndpoint)")</font> ,     <font color="#0000FF">indexEndpoint</font>   . <br><br><img src="https://habrastorage.org/webt/pr/bu/ic/prbuicibqgoshncctnfzxustbby.png"><br><br>     <code>View Model</code>   <font color="#0000FF">indexEndpoint = 2</font> ,         ,        ( <font color="#0000FF">Upcoming</font> ): <br><br><img src="https://habrastorage.org/webt/bz/ll/-g/bzll-g26ytgu4kya4dh0t5m5wjw.png"><br><br>   <code>UI</code>    ,      .  <font color="#0000FF">Stepper</font> : <br><br><img src="https://habrastorage.org/webt/o5/4j/rg/o54jrgkra0vggnuxmzjrgrfrkkc.png"><br><br> …  <font color="#0000FF">Picker</font> : <br><br><img src="https://habrastorage.org/webt/ei/ln/g6/eilng6a6zeizbtswoq5isrsbxje.png"><br><br>   «» <font color="#0000FF">$moviesViewModel.indexEndpoint</font>  <code>View Model</code> ,       (  )       : <br><br><img src="https://habrastorage.org/webt/hb/sz/mi/hbszmixxzg4_njoodr2_p-bz3v8.png"><br><br>        <font color="#0000FF">List</font>  <font color="#0000FF">ForEach</font>      <font color="#0000FF">movie</font> : <br><br><img src="https://habrastorage.org/webt/no/zf/g7/nozfg7kd8ednspilzhe0ibzw9cg.png"><br><br>    <font color="#0000FF">moviesViewModel.movies</font>      <code>View Model</code> : <br><br><img src="https://habrastorage.org/webt/6g/mi/eu/6gmieuzemvr0tjecr_ks_rpq9_w.png"><br><br>    «» <font color="#0000FF">$moviesViewModel.movies</font>   <font color="#0000FF">$</font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为我们不会编辑此电影列表中的任何内容。我们使用通常的</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">movieViewModel.movi​​es</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过在列表的每一行中显示相应电影的电影海报来使电影列表更有趣，该电影海报</font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示在</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Movie</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结构中</font><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/wj/wc/mr/wjwcmrzdsx2g_dxzkj5tt7-cets.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thomas Ricouard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的美丽项目</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MovieSwiftUI中</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">借用了这个机会</font><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与加载</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">影片</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的情况一样</font><font style="vertical-align: inherit;">，对于</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像</font><font style="vertical-align: inherit;">，我们拥有</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageService</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务</font><font style="vertical-align: inherit;">，该</font><font style="vertical-align: inherit;">服务</font><font style="vertical-align: inherit;">通过</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现</font><font style="vertical-align: inherit;">了</font><font color="#0000FF"><font style="vertical-align: inherit;">fetchImage</font></font><font style="vertical-align: inherit;">方法</font></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回“ publisher” </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AnyPublisher &lt;UIImage？，Never&gt;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><br><br><img src="https://habrastorage.org/webt/ta/rq/zi/tarqziqr1neusqhuvy3xusnbb-c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...和</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最终类ImageLoader：ObservableObject</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font color="#0000FF"><font style="vertical-align: inherit;">该类</font></font><font style="vertical-align: inherit;">使用</font><font color="#0000FF"><font style="vertical-align: inherit;">@Published</font></font><font style="vertical-align: inherit;">属性</font><font color="#0000FF"><font style="vertical-align: inherit;">图像</font></font><font style="vertical-align: inherit;">实现了</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ObservableObject</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协议</font><font color="#0000FF"><font style="vertical-align: inherit;">：UIImage？</font></font></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font>  ： <br><br><img src="https://habrastorage.org/webt/nm/mf/xb/nmmfxbdfrw54rbwkeghgbrbbq_i.png"><br><br><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ObservableObject</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协议</font><font style="vertical-align: inherit;">提出</font><font style="vertical-align: inherit;">的唯一要求</font><font style="vertical-align: inherit;">是存在</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objectWillChange</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">。</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SwiftUI</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用此属性来了解此类实例中的某些更改，并且一旦发生这种情况，将更新所有</font><font style="vertical-align: inherit;">依赖于此类实例的</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">View</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。通常，编译器会自动创建一个</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objectWillChange</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">，并且所有</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Published</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性也会自动通知它。在某些特殊情况下，您可以手动创建一个</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objectWillChange</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将更改通知它。我们有这种情况。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font><font color="#0000FF"><font style="vertical-align: inherit;">ImageLoader</font></font><font style="vertical-align: inherit;">类中</font></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font>    <font color="#0000FF">@Published</font>  <font color="#0000FF">var image:UIImage?</font>  。           ,     <font color="#0000FF">ImageLoader</font> ,   «» <font color="#0000FF">$image</font>   «»     <font color="#0000FF">loadImage()</font> ,      <font color="#0000FF">poster</font>   <font color="#0000FF">size</font>    <font color="#0000FF">@Published</font>  <font color="#0000FF">var image:UIImage?</font>  。<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将这些更改通知</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给objectWillChange</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中可能有很多这样的图像，这会导致大量的时间开销，因此我们使用</font><font color="#0000FF"><font style="vertical-align: inherit;">ImageLoader</font></font><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">的</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageLoader</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例</font><font style="vertical-align: inherit;">的</font><font style="vertical-align: inherit;">缓存</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">我们有一个特殊的</font><font color="#0000FF"><font style="vertical-align: inherit;">View</font></font><font style="vertical-align: inherit;">来播放</font><font color="#0000FF"><font style="vertical-align: inherit;">MoviePosterImage电影海报</font></font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">...，并且在主</font><font color="#0000FF"><font style="vertical-align: inherit;">ContentView中</font></font><font style="vertical-align: inherit;">显示电影列表时将使用它</font><font style="vertical-align: inherit;">：</font><font style="vertical-align: inherit;">可以在</font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;">Github</font></a><font style="vertical-align: inherit;">上的文件夹中</font><font style="vertical-align: inherit;">找到</font><font style="vertical-align: inherit;">基于</font><font color="#0000FF"><font style="vertical-align: inherit;">SwiftUI</font></font><font style="vertical-align: inherit;">的</font><font color="#0000FF"><font style="vertical-align: inherit;">应用程序</font></font><font style="vertical-align: inherit;">的代码，</font><font style="vertical-align: inherit;">不显示错误</font><font style="vertical-align: inherit;">。</font></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/webt/bh/3z/yr/bh3zyrhhwbalksaw_78v2iotffk.png"><br><br><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/webt/8o/hs/bj/8ohsbjrvisd-ijjef0nbfrc3p6i.png"><br><br><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/webt/h0/xn/l9/h0xnl9hwptsp8flgpsxwq2zpf-u.png"><br><br><img src="https://habrastorage.org/webt/ew/ft/op/ewftopem4n5r0wwh_zv2xj2r07g.png"><br><br><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><code>CombineFetchAPI-NOError</code><font style="vertical-align: inherit;"></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 远程异步电影获取的显示错误。 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我们还没有使用或显示从</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMDb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网站远程异步选择电影期间发生的错误</font><font style="vertical-align: inherit;">。尽管</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们使用</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的函数</font><font color="#0000FF"><font style="vertical-align: inherit;">movieAPI.fetchMovies（来自端点：Endpoint）</font></font><font style="vertical-align: inherit;">允许我们执行此操作，因为它返回“发布者” </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Future &lt;[Movie，MovieStoreAPIError]&gt;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了考虑错误，我们将</font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一个</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Published</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">movieError</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加到了</font><font color="#0000FF"><font style="vertical-align: inherit;">：MovieStoreAPIError？</font></font><font style="vertical-align: inherit;">代表错误。这是一个</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optional</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性，其初始值为</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它对应于没有错误：</font></font><br><br><img src="https://habrastorage.org/webt/-t/em/_y/-tem_ynqrewyk3bdubok9jcb7pu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了获得此错误，</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moviesError</font></font></font> ,       <font color="#0000FF">MoviesViewModel</font>     «» <font color="#0000FF">sink</font> : <br><br><img src="https://habrastorage.org/webt/7c/ie/m0/7ciem0walfc1pwbjraeqlzpwr5q.png"><br><br>  <font color="#0000FF">moviesError</font>    <code>UI</code> ,     <font color="#0000FF">nil</font> … <br><br><img src="https://habrastorage.org/webt/i1/o5/ve/i1o5ve67nptlwcubxxl7ylvup5i.png"><br><br>   <font color="#0000FF">AlertView</font> : <br><br><img src="https://habrastorage.org/webt/kd/st/u8/kdstu80nyu1jvikbxzunxfigkks.png"><br><br>    ,    <code>API</code> : <br><br><img src="https://habrastorage.org/webt/f_/4i/ha/f_4ihalskxufzgz1xra_pdqxwoy.png"><br><br>      <font color="#0000FF">SwiftUI</font>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Github</a>   <i>CombineFetchAPI-Error</i> . <br><br>       ,     <font color="#0000FF">Future&lt;[Movie],MovieStoreAPIError&gt;</font> ,    <font color="#0000FF">AnyPublisher&lt;[Movie], Never&gt;</font>   <font color="#0000FF">fetchMoviesLight</font> : <br><br><img src="https://habrastorage.org/webt/-v/3m/hx/-v3mhx-uwkxlzzla7iu-qgigyt0.png"><br><br>   ( <font color="#0000FF">Never</font> )      «» <font color="#0000FF">assign(to: \.movies, on: self)</font> : <br><br><img src="https://habrastorage.org/webt/zw/ro/up/zwroupvq_yi7shbzefyhsdj8t6e.png"><br><br>      : <br><br><img src="https://habrastorage.org/webt/ux/sa/-n/uxsa-n17hh_tu7nqp_znak3oa-w.png"><br><br><h3> 结论 </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框架</font><font style="vertical-align: inherit;">处理在时间上异步出现的一系列</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常简单。</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供的操作员</font><font style="vertical-align: inherit;">功能强大且灵活。</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结合</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使我们能够避免通过使用上游链的编写复杂异步代码“出版商» </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出版商</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，利用运营商和内置的“用户» </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">认购</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在比</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foundation</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低的级别上构建</font><font style="vertical-align: inherit;">，在许多情况下不需要</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foundation</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并具有惊人的性能。</font></font><br><br><img src="https://habrastorage.org/webt/eo/la/1q/eola1qc122ogmvluicy5odv9x4g.png"><br><br> <font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SwiftUI</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也与</font><font color="#0000FF"><font style="vertical-align: inherit;">Combine</font></font><font style="vertical-align: inherit;">紧密相关</font></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;由于其</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ObservableObject</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Binding</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@EnvironmentObject</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br> <code>iOS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发人员一直在等待</font></font><code>Apple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种官方框架，终于在今年实现了。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接：</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用Apple Combine Framework获取远程异步API </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试！ Swift NYC 2019-合并入门</font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“ Swift中的终极合并框架教程”。</font></font></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合并：结合Swift进行异步编程</font></font></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-WWDC 2019-视频-Apple Developer。会议722 </font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（会议722的简介，俄语的介绍）</font></font></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实践中结合-WWDC 2019-视频-Apple Developer。会议721</font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（第721节“俄语的实用用法”摘要）</font></font></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SwiftUI＆Combine：在一起更好。为什么SwiftUI和Combine帮助您创建更好的应用程序。</font></font></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MovieSwiftUI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可视化SwiftUI结合魔术（1）</font></font></a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可视化SwiftUI结合魔术-第2部分（在Combine中操作，订阅和取消操作）</font></font></a> <br><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Visualize Combine Magic with SwiftUI Part 3 (See Combine Merge and Append in Action) <br> Visualize Combine Magic with SwiftUI — Part 4</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Visualize Combine Magic with SwiftUI — Part 5</a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Getting Started With the Combine Framework in Swift</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Transforming Operators in Swift Combine Framework: Map vs FlatMap vs SwitchToLatest</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Combine's Future</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Using Combine</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">URLSession and the Combine framework</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN476678/">https://habr.com/ru/post/zh-CN476678/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN476666/index.html">程序员生物学：工程方法如何改变世界</a></li>
<li><a href="../zh-CN476668/index.html">我如何通过电话进行计算机控制</a></li>
<li><a href="../zh-CN476670/index.html">几何核C3D上的CAD概述-2</a></li>
<li><a href="../zh-CN476674/index.html">ReportPortal快速部署以熟悉</a></li>
<li><a href="../zh-CN476676/index.html">48个JavaScript开源资源（2019）</a></li>
<li><a href="../zh-CN476680/index.html">Rodov的连续生产计划系统是1961年的苏联精益生产计划/ MRP。 起飞，日落和新生</a></li>
<li><a href="../zh-CN476682/index.html">如何在Phaser中编写一个Sapper并运行HTML5开发人员测试任务</a></li>
<li><a href="../zh-CN476686/index.html">基于Raspberry CM3 +的物联网网关的开发</a></li>
<li><a href="../zh-CN476688/index.html">OTUS的新课程。 “ IOS开发人员。 高级课程V 2.0»</a></li>
<li><a href="../zh-CN476692/index.html">内容营销原则</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>