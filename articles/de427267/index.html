<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüåæ üòµ üíï SNMP + Java - pers√∂nliche Erfahrung. Schreiben eines Parsers f√ºr MIB-Dateien üöç üíó ‚ôéÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SNMP ist nicht das benutzerfreundlichste Protokoll: MIB-Dateien sind zu lang und verwirrend, und OIDs sind einfach nicht zu merken. Aber was ist, wenn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SNMP + Java - pers√∂nliche Erfahrung. Schreiben eines Parsers f√ºr MIB-Dateien</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427267/">  SNMP ist nicht das benutzerfreundlichste Protokoll: MIB-Dateien sind zu lang und verwirrend, und OIDs sind einfach nicht zu merken.  Aber was ist, wenn Sie mit SNMP in Java arbeiten m√ºssen?  Schreiben Sie beispielsweise Autotests, um die SNMP-Server-API zu √ºberpr√ºfen. <br><br>  Durch Versuch und Irrtum, wenn es eine ziemlich geringe Menge an Informationen zu diesem Thema gibt, haben wir immer noch herausgefunden, wie man Freunde Java und SNMP macht. <br><br>  In dieser Artikelserie werde ich versuchen, die mit dem Protokoll gewonnenen Erfahrungen zu teilen.  Der erste Artikel der Reihe befasst sich mit der Implementierung des Parsers von MIB-Dateien in Java.  Im zweiten Teil werde ich √ºber das Schreiben eines SNMP-Clients sprechen.  Im dritten Teil werden wir √ºber ein reales Beispiel f√ºr die Verwendung einer schriftlichen Bibliothek sprechen: Autotests zur √úberpr√ºfung der Interaktion mit einem Ger√§t √ºber SNMP. <br><br><img src="https://habrastorage.org/webt/tv/lq/ai/tvlqaihbpnaqtlie8wr7hulxyhg.jpeg"><br><a name="habracut"></a><br><h2>  Eintrag </h2><br>  Alles begann mit der Aufgabe, Selbsttests zu schreiben, um den Betrieb des Audio-Video-Rekorders √ºber SNMP zu √ºberpr√ºfen.  Erschwerend kommt hinzu, dass es nicht viele Informationen zur Interaktion mit SNMP in Java gibt, insbesondere wenn es um das russischsprachige Segment des Internets geht.  Nat√ºrlich k√∂nnte man in Richtung C # oder Python schauen.  In C # ist die Protokollsituation jedoch ungef√§hr so ‚Äã‚Äãkompliziert wie in Java.  Es gibt einige gute Bibliotheken in Python, aber wir hatten bereits eine vorgefertigte Infrastruktur f√ºr die REST-API-Autotests dieses Ger√§ts in Java. <br><br>  Wie bei jedem anderen Netzwerkkommunikationsprotokoll ben√∂tigten wir einen SNMP-Client, um mit verschiedenen Arten von Anforderungen arbeiten zu k√∂nnen.  Autotests sollten in der Lage sein, den Erfolg von GET- und SET-Anforderungen f√ºr Skalar- und Tabellenparameter zu √ºberpr√ºfen.  F√ºr Tabellen musste es auch m√∂glich sein, das Hinzuf√ºgen und L√∂schen von Datens√§tzen zu √ºberpr√ºfen, wenn die Tabelle selbst diese Vorg√§nge zul√§sst. <br><br>  Zus√§tzlich zum Client musste die Bibliothek eine Klasse f√ºr die Arbeit mit MIB-Dateien enthalten.  Diese Klasse sollte in der Lage sein, die MIB-Datei zu analysieren, um Datentypen, Grenzen akzeptabler Werte usw. abzurufen, um nicht fest zu codieren, was sich immer √§ndern kann. <br><br>  Bei der Suche nach geeigneten Bibliotheken f√ºr Java haben wir keine einzige Bibliothek gefunden, die die Arbeit mit Anforderungen und MIB-Dateien erm√∂glicht.  Deshalb haben wir uns f√ºr zwei verschiedene Bibliotheken entschieden.  F√ºr den Client schien die Auswahl der weit verbreiteten org.snmp4j.snmp4j (https://www.snmp4j.org) ziemlich logisch, und f√ºr den Parser von MIB-Dateien wurde die Auswahl f√ºr die nicht sehr bekannte net.percederberg.mibble-Bibliothek (https: // www. mibble.org).  Wenn bei snmp4j die Wahl offensichtlich war, wurde mibble ausgew√§hlt, um eine ausreichend detaillierte (wenn auch englischsprachige) Dokumentation mit Beispielen zu erhalten.  Also fangen wir an. <br><br><h2>  Schreiben eines Parsers f√ºr MIB-Dateien </h2><br>  Jeder, der jemals MIB-Dateien gesehen hat, wei√ü, dass dies ein Schmerz ist.  Versuchen wir, dies mithilfe eines einfachen Parsers zu beheben, der die Suche nach Informationen aus einer Datei erheblich erleichtert und sie auf den Aufruf einer bestimmten Methode reduziert. <br><br>  Ein solcher Parser kann als separates Dienstprogramm f√ºr die Arbeit mit MIB-Dateien verwendet oder in einem anderen Projekt unter SNMP enthalten sein, z. B. beim Schreiben eines SNMP-Clients oder beim Testen der Automatisierung. <br><br><h4>  Projektvorbereitung </h4><br>  Zur Erleichterung der Montage verwenden wir Maven.  Abh√§ngig von der Bibliothek net.percederberg.mibble hinzuf√ºgen (https://www.mibble.org), die uns die Arbeit mit MIB-Dateien erleichtert: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>net.percederberg.mibble<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>mibble<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.9.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Da es nicht im zentralen Maven-Repository liegt, f√ºgen wir pom.xml den folgenden Code hinzu: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repositories</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repository</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>opennms<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>OpenNMS<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://repo.opennms.org/maven2/<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repository</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">repositories</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Wenn das Projekt mit dem Maven fehlerfrei zusammengestellt wird, ist alles betriebsbereit.  Es bleibt nur noch eine Parser-Klasse zu erstellen (nennen wir sie MIBParser) und alles zu importieren, was wir brauchen, n√§mlich: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> net.percederberg.mibble.*;</code> </pre> <br><h4>  Laden Sie eine MIB-Datei herunter und validieren Sie sie </h4><br>  Innerhalb der Klasse gibt es nur ein Feld - ein Objekt vom Typ net.percederberg.mibble.Mib zum Speichern der heruntergeladenen MIB-Datei: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Mib mib;</code> </pre><br>  Um eine Datei hochzuladen, schreiben wir diese Methode: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Mib </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadMib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File file)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MibLoaderException, IOException </span></span>{ MibLoader loader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MibLoader(); Mib mib; file = file.getAbsoluteFile(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { loader.addDir(file.getParentFile()); mib = loader.load(file); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (MibLoaderException e) { e.getLog().printTo(System.err); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { e.printStackTrace(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mib; }</code> </pre><br>  Die Klasse net.percederberg.mibble.MIBLoader √ºberpr√ºft die Datei, die wir laden m√∂chten, und l√∂st die Ausnahme net.percederberg.mibble.MibLoaderException aus, wenn darin Fehler gefunden werden, einschlie√ülich Importfehlern aus anderen MIB-Dateien liegen nicht im selben Verzeichnis oder enthalten keine importierten MIB-Zeichen. <br><br>  In der loadMib-Methode fangen wir alle Ausnahmen ab, schreiben dar√ºber in das Protokoll und leiten sie weiter, weil  Zu diesem Zeitpunkt ist die Fortsetzung der Arbeit nicht m√∂glich - die Datei ist ung√ºltig. <br><br>  Wir rufen die geschriebene Methode im Parser-Konstruktor auf: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MIBParser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File file)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MibLoaderException, IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.exists()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileNotFoundException(<span class="hljs-string"><span class="hljs-string">"File not found in location: "</span></span> + file.getAbsolutePath()); mib = loadMib(file.getAbsoluteFile()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mib.isLoaded()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MibLoaderException(file, <span class="hljs-string"><span class="hljs-string">"Not loaded."</span></span>); }</code> </pre><br>  Wenn die Datei erfolgreich heruntergeladen und analysiert wurde, arbeiten Sie weiter. <br><br><h4>  Methoden zum Abrufen von Informationen aus einer MIB-Datei </h4><br>  Mit den Methoden der Klasse net.percederberg.mibble.Mib k√∂nnen Sie nach einzelnen Zeichen einer MIB-Datei nach Namen oder OID suchen, indem Sie die Methoden getSymbol (String name) bzw. getSymbolByOid (String oid) aufrufen.  Diese Methoden geben das Objekt net.percederberg.mibble.MibSymbol zur√ºck, mit dessen Methoden wir die erforderlichen Informationen zu einem bestimmten MIB-Symbol abrufen. <br><br>  Beginnen wir mit den einfachsten und schreiben Sie Methoden, um den Namen eines Symbols anhand seiner OID und umgekehrt anhand seines Namens zu ermitteln: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String oid)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mib.getSymbolByOid(oid).getName(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ String oid = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; MibSymbol s = mib.getSymbol(name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> MibValueSymbol) { oid = ((MibValueSymbol) s).getValue().toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((MibValueSymbol) s).isScalar()) oid = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OID(oid).append(<span class="hljs-number"><span class="hljs-number">0</span></span>).toDottedString(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> oid; }</code> </pre><br>  Vielleicht sind dies die Merkmale einer bestimmten MIB-Datei, mit der ich arbeiten musste, aber aus irgendeinem Grund gaben die skalaren Parameter am Ende OID ohne Null zur√ºck, sodass der Methode zum Abrufen der OID ein Code hinzugef√ºgt wurde, der, wenn die MIB Das Zeichen ist skalar und f√ºgt der empfangenen OID einfach ‚Äû.0‚Äú hinzu, indem die Methode append (int index) aus der Klasse net.percederberg.mibble.OID verwendet wird.  Wenn es f√ºr Sie ohne Kr√ºcke funktioniert, herzlichen Gl√ºckwunsch :) <br><br>  Um den Rest der Daten auf dem Symbol zu erhalten, schreiben wir eine Hilfsmethode, bei der wir das Objekt net.percederberg.mibble.snmp.SnmpObjectType erhalten, das alle erforderlichen Informationen √ºber das MIB-Symbol enth√§lt, von dem es erhalten wurde. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> SnmpObjectType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSnmpObjectType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MibSymbol symbol)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (symbol <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> MibValueSymbol) { MibType type = ((MibValueSymbol) symbol).getType(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> SnmpObjectType) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (SnmpObjectType) type; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Zum Beispiel k√∂nnen wir den Typ des MIB-Symbols erhalten: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getSnmpObjectType(s).getSyntax().getReferenceSymbol() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getSnmpObjectType(s).getSyntax().getName(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getSnmpObjectType(s).getSyntax().getReferenceSymbol().getName(); }</code> </pre><br>  Es gibt zwei M√∂glichkeiten, um Typ zu bekommen, weil  F√ºr primitive Typen funktioniert die erste Option: <br><br><pre> <code class="java hljs">getSnmpObjectType(s).getSyntax().getName();</code> </pre><br>  und f√ºr importierte die zweite: <br><br><pre> <code class="java hljs">getSnmpObjectType(s).getSyntax().getReferenceSymbol().getName();</code> </pre><br>  Sie k√∂nnen die Zugriffsebene eines Charakters erhalten: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAccess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getSnmpObjectType(s).getAccess().toString(); }</code> </pre><br>  Minimaler g√ºltiger Wert f√ºr einen numerischen Parameter: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDigitMinValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); String syntax = getSnmpObjectType(s).getSyntax().toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (syntax.contains(<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; Pattern p = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"(-?\\d+)..(-?\\d+)"</span></span>); Matcher m = p.matcher(syntax); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m.find()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">1</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Maximal zul√§ssiger Wert eines numerischen Parameters: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDigitMaxValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); String syntax = getSnmpObjectType(s).getSyntax().toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (syntax.contains(<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; Pattern p = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"(-?\\d+)..(-?\\d+)"</span></span>); Matcher m = p.matcher(syntax); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m.find()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">2</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Minimal zul√§ssige Zeichenfolgenl√§nge (abh√§ngig vom Zeichenfolgentyp): <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStringMinLength</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mib.getSymbol(name); String syntax = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getSnmpObjectType(s).getSyntax().toString(); Pattern p = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"(-?\\d+)..(-?\\d+)"</span></span>); Matcher m = p.matcher(syntax); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> syntax.contains(<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>) &amp;&amp; m.find()?Integer.valueOf(Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">1</span></span>))):<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Maximal zul√§ssige Zeichenfolgenl√§nge (abh√§ngig vom Zeichenfolgentyp): <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStringMaxLength</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ MibSymbol s = mib.getSymbol(name); String syntax = getSnmpObjectType(s).getSyntax().toString(); Pattern p = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"(-?\\d+)..(-?\\d+)"</span></span>); Matcher m = p.matcher(syntax); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (syntax.contains(<span class="hljs-string"><span class="hljs-string">"STRING"</span></span>) &amp;&amp; m.find()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">2</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Sie k√∂nnen die Namen aller Spalten in der Tabelle auch anhand ihres Namens abrufen: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ArrayList&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTableColumnNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String tableName)</span></span></span><span class="hljs-function"> </span></span>{ ArrayList&lt;String&gt; mibSymbolNamesList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); MibValueSymbol table = (MibValueSymbol) mib.findSymbol(tableName, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (table.isTable() &amp;&amp; table.getChild(<span class="hljs-number"><span class="hljs-number">0</span></span>).isTableRow()) { MibValueSymbol[] symbols = table.getChild(<span class="hljs-number"><span class="hljs-number">0</span></span>).getChildren(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (MibValueSymbol mvs : symbols) { mibSymbolNamesList.add(mvs.getName()); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mibSymbolNamesList; }</code> </pre><br>  Zun√§chst erhalten wir standardm√§√üig ein MIB-Symbol mit Namen: <br><br><pre> <code class="java hljs">MibValueSymbol table = (MibValueSymbol) mib.findSymbol(tableName, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre><br>  Dann pr√ºfen wir, ob es sich um eine Tabelle handelt und ob das untergeordnete MIB-Symbol eine Zeile dieser Tabelle ist. Wenn die Bedingung true zur√ºckgibt, gehen wir in der Schleife die untergeordneten Elemente der Tabellenzeile durch und f√ºgen dem resultierenden Array den Elementnamen hinzu: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (table.isTable() &amp;&amp; table.getChild(<span class="hljs-number"><span class="hljs-number">0</span></span>).isTableRow()) { MibValueSymbol[] symbols = table.getChild(<span class="hljs-number"><span class="hljs-number">0</span></span>).getChildren(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (MibValueSymbol mvs : symbols) { mibSymbolNamesList.add(mvs.getName()); } }</code> </pre><br><h2>  Zusammenfassung </h2><br>  Diese Methoden reichen aus, um Informationen aus der MIB-Datei f√ºr jedes bestimmte Zeichen abzurufen, wobei nur dessen Name bekannt ist.  Wenn Sie beispielsweise einen SNMP-Client schreiben, k√∂nnen Sie einen solchen Parser darin einf√ºgen, sodass Client-Methoden keine OIDs, sondern MIB-Symbolnamen akzeptieren.  Dies erh√∂ht die Zuverl√§ssigkeit des Codes  Ein Tippfehler in OID f√ºhrt m√∂glicherweise nicht zu dem Zeichen, auf das wir verweisen m√∂chten.  Und keine OIDs - keine Probleme. <br><br>  Das Plus ist die Lesbarkeit des Codes, dh seine Wartbarkeit.  Es ist einfacher, die Essenz des Projekts zu verstehen, wenn der Code mit menschlichen Namen arbeitet. <br><br>  Eine weitere Anwendung ist die Testautomatisierung.  In den Testdaten kann man aus einer MIB-Datei dynamisch Grenzwerte numerischer Parameter erhalten.  Wenn sich also die Grenzwerte einiger MIB-Symbole in der neuen Version der getesteten Komponente √§ndern, m√ºssen Sie den Autotest-Code nicht √§ndern. <br><br>  Im Allgemeinen wird die Arbeit mit MIB-Dateien mit einem Parser viel angenehmer, und sie sind nicht mehr so ‚Äã‚Äãschmerzhaft. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de427267/">https://habr.com/ru/post/de427267/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de427255/index.html">Cowon D2: Musikalische Langleber</a></li>
<li><a href="../de427257/index.html">Cameron Craig: Sieben Lektionen aus 10 Jahren PR-Management von Apple</a></li>
<li><a href="../de427259/index.html">Was der Turing-Test wirklich √ºberpr√ºft</a></li>
<li><a href="../de427263/index.html">Seien Sie ein Sicherheits-Ninja: Webinar-Aufzeichnung und Bonuslevel</a></li>
<li><a href="../de427265/index.html">Protobuffer sind falsch</a></li>
<li><a href="../de427269/index.html">Google OKR-Video f√ºnf Jahre sp√§ter - Ein √úberblick √ºber die Erfahrungen von Google Ventures bei der Implementierung von OKR (2012-2017)</a></li>
<li><a href="../de427271/index.html">Geschichte und Erfahrung mit maschineller √úbersetzung. Yandex Vortrag</a></li>
<li><a href="../de427273/index.html">Kann k√ºnstliche Intelligenz Buchmacher ohne Arbeit lassen?</a></li>
<li><a href="../de427275/index.html">Internetinformationsarchitektur Teil 3</a></li>
<li><a href="../de427277/index.html">Ein Beugungsmuster findet sich in der Verteilung von Primzahlen, √§hnlich der von Quasikristallen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>