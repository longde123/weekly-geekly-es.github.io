<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ค๐ฟ ๐ณ ๐ ูุดุฑ ุชุทุจููุงุช Symfony + React ุนูู AWS ูู ุฎูุงู CI ๐ฆ ๐ ๐๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุณุงุก ุงูุฎูุฑ ุ ุณุฃูุถุญ ูู ูุฐุง ุงูููุงู ููููุฉ ูุดุฑ ุชุทุจูู Symfony 4 ุนูู AWS. ููุฌุฏ ูุซุงู ุนูู ูุซู ูุฐู ุงูุนูููุฉ ูู ุงููุซุงุฆู ุงูุฑุณููุฉ ุ ููู ุฑูุงูุชู ููุณุช ุชุงููุฉ ูุซู ุชูุฒูู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุดุฑ ุชุทุจููุงุช Symfony + React ุนูู AWS ูู ุฎูุงู CI</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462415/" style=";text-align:right;direction:rtl"> ูุณุงุก ุงูุฎูุฑ ุ ุณุฃูุถุญ ูู ูุฐุง ุงูููุงู ููููุฉ ูุดุฑ ุชุทุจูู Symfony 4 ุนูู AWS.  ููุฌุฏ ูุซุงู ุนูู ูุซู ูุฐู ุงูุนูููุฉ ูู ุงููุซุงุฆู ุงูุฑุณููุฉ ุ ููู ุฑูุงูุชู ููุณุช ุชุงููุฉ ูุซู ุชูุฒูู ุฃุฑุดูู ูุถุบูุท ุจุชุทุจูู ูุง.  ูู ุณุงุญุฉ ุนุงู 2019 ุ ูู ูุถุน ุนุงูู ุงูุงูุชุญุงู ุ ุจุฏุฃุช ุฃุฎูุฑูุง ูู ุชุถููู ููุฏุณุฉ ุฎุฏูุงุช micros ู CI / CD ูู ุฃุฏูุงุช ูููุฏุณู DevOps ููุณ ููุท ุ ูููู ุฃูุถูุง ูุทูุฑู <s>ุงูุจุดุฑ</s> ุงูุนุงุฏููู.  ูุฌุนู ุงูููุงูุฉ ุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ุ ุฃุถูุช ูุงุฌูุฉ ุฅูู React.JS ุ ูุชุบุทูุฉ ุงุญุชูุงุฌุงุช ุงููุฒูุฏ ูู ุงูุฃุดุฎุงุต ุ ุฅุฐุง ูุงู ุงูุชุทุจูู ุงูุฎุงุต ุจู ูุง ูุณุชุฎุฏู Encore - ูุง ููู ุ ุณุฃุดูุฑ ุฅูู ููููุฉ ุชุบููุฑ ููู Docker ุจุงููุณุจุฉ ูู ุ ูุฏุนู React.JS ูุคุซุฑ ููุท ุนููู .  ูู ุณูููู ููุชููุง ุจูุฐุง ุงูุจุฑูุงูุฌ ุงูุชุนููููุ  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุฅูู ููุฌู ููุทูุฑู PHP ุงูุฐูู ูุฑุบุจูู ูู ุชุบููุฑ ููุงุฑุณุฉ ุงููุดุฑ ุงูุฎุงุตุฉ ุจูู - ููุงุจุชุนุงุฏ ุนู ุงูุดุฑุงุฆุน ุงููุนุชุงุฏุฉ ูุงุณุชุฎุฏุงู ุนุงูู ุงูููู ูุญุฒู ุชุทุจููุงุชูู ููุถุน ุงูุตูุฑุฉ.  ููู ููููู ุฃู ุชุนูู ุฃูุซุฑ ููููุงู ุ ูุณูู ููุฏู ุงูุณุฑุฏ ุงูุฅุถุงูู ุฅูู ูุดุฑ ุงูุชุทุจูู ุชููุงุฆููุง ูู Git ุนุจุฑ ููุตุฉ CI / CD (ุณูุชู ุงุณุชุฎุฏุงู CircleCI ุ ูููู ุฅุฐุง ููุช ููุชููุง ุจุชููุฆุฉ Gitlab ุ ูุงูุชุจ ูู ุงูุชุนูููุงุช ุ ูุณุฃุฑูููุง).  ูู ุงููุงูุน ุ ููุณ ูู ุงูููู ููุบุงูุฉ ุจุงููุณุจุฉ ูู React / PHP ูุง ุฅุฐุง ูุงู ูุฏูู ุชุทุจูู ุฃู ุ ุนูู ุณุจูู ุงููุซุงู ุ .NET Core ุ ุณูููู ูุฐุง ุงูุฌุฒุก ูุซูุฑูุง ูููุทูุฑูู ูุงูุชุณุงุจ ููุงุฑุงุช ุฃุชูุชุฉ ุงููุดุฑ ุจุดูู ุนุงู.  ุดูุฑุฉ ุงููุตุฏุฑ ูุชุงุญุฉ ูู ูุณุชูุฏุน ุฌูุซุจ ุ ุฑุงุจุท ูู ููุงูุฉ ุงูููุงู.  ุญุณูุง ุ ุฏุนูุง ูุฐูุจ! <br><a name="habracut"></a><br>  ุฃูุชุฑุถ ุฃู ูุฏูู ุชุทุจูู Symfony ุงูุฎุงุต ุจู ุ ููู ูุฃุบุฑุงุถ ุงูุนุฑุถ ุงูุชูุถูุญู ุ ุฑุณูุช "helloุ world!" ุชุญุชูู ุนูู ุงูุญุฒู ุงูุชุงููุฉ: <br><br>  <code>`symfony/webpack-encore-bundle symfony/form symfony/orm-pack symfony/profiler-pack symfony/security-bundle symfony/twig-bundle symfony/validator symfony/phpunit-bridge`</code> ูู ูุฌููุนุฉ ุจุณูุทุฉ ูู ุงูุฑุฌู ุงููุญุชุฑู.  ูู ุงูููุช ุงูุญุงูู ุ ูุฌุจ ุฃู ุชููู ุจููุฉ ุงููุฌูุฏ ููุง ููู: <br><br><img width="350" src="https://habrastorage.org/webt/6m/ck/xi/6mckxiczmqlde3nsjhdpzcbforq.png" alt="ุตูุฑุฉ"><br><br>  ุฃูุช ุงูุขู ุจุญุงุฌุฉ ุฅูู ุชูููู ุงูุจููุฉ ุงูุชุญุชูุฉ ุงูุณุญุงุจูุฉ ุงูุฎุงุตุฉ ุจู.  ูู ุฃุฑูุฒ ุนูู ุชุณุฌูู ูุชูุนูู ุงููุชุฑุฉ ุงูุชุฌุฑูุจูุฉ ูู AWS ุ ูู ูุฐู ุงููุฑุญูุฉ ูุญุชุงุฌ ุฅูู ุฅูุดุงุก ูุซููุงุช DB 2 - ุณุฃุณุชุฎุฏู ููุนูู ูู ุงูุจูุฆุฉ: STG (ุงูุชุฏุฑูุฌ) ูุงุฎุชุจุงุฑ ุชูููุฐ "ููุฒุงุช" ุฌุฏูุฏุฉ ู PROD (ุฅูุชุงุฌ) ุนูู ุฃูู "ูุชุงู" ูุจุงุดุฑ ุงูุฎุงุฏู.  ุชูุช ูุชุงุจุฉ ุงููุซูุฑ ูู ุงูููุงูุงุช ุญูู ููุงุฆุฏ ูุงุนุฏุฉ ุจูุงูุงุช ุงูุฎุฏูุฉ ุงููุฏุงุฑุฉ ุ ุนูุงูุฉ ุนูู ุฐูู ุ ูุฅููุง ูุชุงุจุน ุจุดูู ุฃุณุงุณู ุฑุงุญุฉ ุงููุทูุฑ ูู ูุฐุง ุงูุฏููู ุ ูุจุงูุชุงูู ูุณุชุฎุฏู RDS ุ ุจุฏูุงู ูู ุฑูุน ุฎุงุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููููุตู.  ููุฏ ุงุณุชุฎุฏูุช PostgreSQL ุจุงุนุชุจุงุฑู DBMS ููุฐุง ุงููุซุงู ุ ุฃูุช ุญุฑ ูู ุงุฎุชูุงุฑ ุฃู ูุงุญุฏ ููุงุณุจู ุ ูุงูุชูู ุฅูู ุฎุฏูุฉ RDS ูุฅูุดุงุก ูุซูููู ูู ุงูุณุนุฉ ูุงูุญุฌู ุงููุฐูู ุชุญุชุงุฌููุง.  ูุธุฑูุง ูุฃู ููู <code>.env</code> ูุชุงุญ ููุง "ุฎุงุฑุฌ ุงูุตูุฏูู" ูู Symfony ุ ูุณูุณุชุฎุฏูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู PROD ุ ูุณูููู STG ุจุฅูุดุงุก ูุณุฎุฉ ูู <code>.env.stg</code> ูุชุบููุฑ <code>APP_ENV=dev</code> ุฅูู <code>APP_ENV=stg</code> ูู <code>.env.stg</code> ู <code>APP_ENV=dev</code> ุนูู <code>APP_ENV=prod</code> in <code>.env</code> ุ ูุฃุฏุฎู ุฃูุถูุง ูุนููุงุช ุงุชุตุงู <code>.env</code> ููู ูู ุงูุญุงูุงุช ุงูุชู ุชู ุฅูุดุงุคูุง. <br><br>  ุนุธูู ุ ููุฏ ุฃุญุฑุฒ ุจุฏุงูุฉ!  ููุง ุชุนูู ุ ูุชู ุชุซุจูุช ุชุจุนูุงุช symfony ูู ุฎูุงู ุงูููุญู ุ ูุชุซุจูุชู ุ ุงุณุชุฎุฏู ููู composer.sh ุ ุงูุฐู ูุถุนู ูู ุฌุฐุฑ ุงููุดุฑูุน: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">composer.sh</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#!/bin/sh EXPECTED_SIGNATURE="$(wget -q -O - https://composer.github.io/installer.sig)" php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');" ACTUAL_SIGNATURE="$(php -r "echo hash_file('sha384', 'composer-setup.php');")" if [ "$EXPECTED_SIGNATURE" != "$ACTUAL_SIGNATURE" ] then &gt;&amp;2 echo 'ERROR: Invalid installer signature' rm composer-setup.php exit 1 fi php composer-setup.php --quiet RESULT=$? rm composer-setup.php exit $RESULT</code> </pre> <br></div></div><br>  ูุฐุง <a href="">ูู</a> ุฏููู <a href="">ุชุซุจูุช ุงูุจุฑูุงูุฌ ูู ุงูููุญู</a> . <br><br>  ุงูุขู ุ ููู ุจูุฆุฉ ุ ูู ุจุฅูุดุงุก ููู Dockerfile ุงูุฎุงุต ุจู ูู ุฌุฐุฑ ุงููุดุฑูุน: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Dockerfile.stg (ุงูุชุฏุฑูุฌ)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">FROM php:7.2.19-apache EXPOSE 80 RUN mv "$PHP_INI_DIR/php.ini-production" "$PHP_INI_DIR/php.ini" &amp;&amp; a2enmod rewrite RUN sed -ri -e 's!memory_limit = 128M!memory_limit = 256M!g' "$PHP_INI_DIR/php.ini" RUN apt-get update &amp;&amp; apt-get install -y \ wget \ curl \ libfreetype6-dev \ libjpeg62-turbo-dev \ libpng-dev \ libzip-dev \ zip \ libpq-dev \ &amp;&amp; docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \ &amp;&amp; docker-php-ext-configure zip --with-libzip \ &amp;&amp; docker-php-ext-configure pgsql -with-pgsql=/usr/local/pgsql \ &amp;&amp; docker-php-ext-install -j$(nproc) gd \ &amp;&amp; docker-php-ext-install zip \ &amp;&amp; docker-php-ext-install pdo pdo_pgsql pgsql WORKDIR /var/www ENV APACHE_DOCUMENT_ROOT /var/www/public RUN sed -ri -e 's!/var/www/html!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/sites-available/*.conf RUN sed -ri -e 's!/var/www/!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/apache2.conf /etc/apache2/conf-available/*.conf RUN echo "ServerName localhost" &gt;&gt; /etc/apache2/apache2.conf COPY ./composer.sh ./ RUN chmod +x ./composer.sh &amp;&amp; ./composer.sh &amp;&amp; mv composer.phar /usr/local/bin/composer RUN curl -sL https://deb.nodesource.com/setup_10.x | bash - \ &amp;&amp; apt-get install -y nodejs RUN curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \ &amp;&amp; echo "deb https://dl.yarnpkg.com/debian/ stable main" | tee /etc/apt/sources.list.d/yarn.list \ &amp;&amp; apt-get update -qq \ &amp;&amp; apt-get install -y yarn COPY ./ ./ COPY ./.env.stg ./.env RUN composer install &amp;&amp; yarn &amp;&amp; yarn run build</code> </pre> <br></div></div><br>  ู <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Dockerfile (ุงูุฅูุชุงุฌ)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">FROM php:7.2.19-apache EXPOSE 80 RUN mv "$PHP_INI_DIR/php.ini-production" "$PHP_INI_DIR/php.ini" &amp;&amp; a2enmod rewrite RUN sed -ri -e 's!memory_limit = 128M!memory_limit = 256M!g' "$PHP_INI_DIR/php.ini" RUN apt-get update &amp;&amp; apt-get install -y \ wget \ curl \ libfreetype6-dev \ libjpeg62-turbo-dev \ libpng-dev \ libzip-dev \ zip \ libpq-dev \ &amp;&amp; docker-php-ext-configure gd --with-freetype-dir=/usr/include/ --with-jpeg-dir=/usr/include/ \ &amp;&amp; docker-php-ext-configure zip --with-libzip \ &amp;&amp; docker-php-ext-configure pgsql -with-pgsql=/usr/local/pgsql \ &amp;&amp; docker-php-ext-install -j$(nproc) gd \ &amp;&amp; docker-php-ext-install zip \ &amp;&amp; docker-php-ext-install pdo pdo_pgsql pgsql WORKDIR /var/www ENV APACHE_DOCUMENT_ROOT /var/www/public RUN sed -ri -e 's!/var/www/html!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/sites-available/*.conf RUN sed -ri -e 's!/var/www/!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/apache2.conf /etc/apache2/conf-available/*.conf RUN echo "ServerName localhost" &gt;&gt; /etc/apache2/apache2.conf COPY ./composer.sh ./ RUN chmod +x ./composer.sh &amp;&amp; ./composer.sh &amp;&amp; mv composer.phar /usr/local/bin/composer RUN curl -sL https://deb.nodesource.com/setup_10.x | bash - \ &amp;&amp; apt-get install -y nodejs RUN curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \ &amp;&amp; echo "deb https://dl.yarnpkg.com/debian/ stable main" | tee /etc/apt/sources.list.d/yarn.list \ &amp;&amp; apt-get update -qq \ &amp;&amp; apt-get install -y yarn COPY ./ ./ RUN composer install &amp;&amp; yarn &amp;&amp; yarn run build</code> </pre> <br></div></div><br>  ูููู ุงุณุชุฎุฏุงู ุงููููุงุช "ููุง ูู" ุ ูุง ูุชู ุงุณุชุฎุฏุงู ูุญุฏุงุช ูุงูุฑู ููุชุบููุฑุงุช.  ุฏุนูุง ูุณูุฑ ุนุจุฑ ูุญุชููุงุช Dockerfile ูุชุจุฏูุฏ ููุณุฉ "ุงูุณุญุฑ".  ุจุตูุชูุง "ุงูุฃุณุงุณ" ุ ูุฅููุง ูุณุชุฎุฏู ุตูุฑุฉ PHP 7.2.19 ุงูุฑุณููุฉ ูุน ุฎุงุฏู ุงูููุจ Apache ุงููุฏูุฌ (ุฃูุช ุญุฑ ูู ุงุณุชุฎุฏุงู ุฃู ูู ุงุฎุชูุงุฑู ุ ูุชูููู ุญุฒูุฉ ูุน Nginx ุ ูููุฐุง ุ ูู ูุฐุง ุงููุซุงู ุ ุฃุณุชุฎุฏู ูุง ูุฑุฏ ุฃุนูุงู ุจุงุนุชุจุงุฑู ุงูุฃูุซุฑ ุ ูู ุฑุฃูู ุ ูุฑูุญุฉ).  ููุณ ุฎุท ุงูุชุนุฑูุถ ููููุง ูู ุงูููุช ุงูุญุงูู ุ ูู ุญุฏ ุฐุงุชู ูุง ููุนู ุดูุฆูุง ุ ูููู ูู ุงููุณุชูุจู ุณูุชู ุงุณุชุฎุฏุงูู ุจูุงุณุทุฉ ElasticBeanstalk ุ ูุงูุฐู ูุญุชุงุฌ ุฅูู ูุดุฑู ุจุดูู ุตุญูุญ.  ุชุณุชุฎุฏู ุงูุฅูุดุงุกุงุช ุงูุชุงููุฉ ุฅุนุฏุงุฏุงุช ุงูุฅูุชุงุฌ ุงููุญุณููุฉ ูู PHP ุงูุชู ุฃูุตุช ุจูุง ุงูุดุฑูุฉ ุงููุตูุนุฉ ุ ููู ุจุชูุดูุท mod_rewrite ูู Apache ูุฒูุงุฏุฉ ุงูุญุฏ ุงูุฃูุตู ูุญุฌู ุงูุฐุงูุฑุฉ ูุจุฑูุงูุฌ ูุตู PHP ูู 128 ุฅูู 256 ููุบุงุจุงูุช ุ ููู ุฃูุฑ ุถุฑูุฑู ููู ูุนูู ุงูููุญู ุจุดูู ุตุญูุญ.  ุจุนุฏ ุฐูู ุ ูููู ุจุชุซุจูุช ุงูุชุทุจููุงุช ุงูุถุฑูุฑูุฉ ุ ุชุจุนูุงุช ูุฅุถุงูุงุช PHP ุ ููููุฆูุง ุนูู ุงูููุฑ.  ูููู ุจุชุนููู ุงููุฌูุฏ / var / www ุฅูู ุฏููู ุงูุนูู ุงูุฎุงุต ุจุทูุจูุง - ุณูุชู ูุณุฎ ุงูููุฏ ุงููุตุฏุฑู ูุชุทุจูููุง ููุงู.  ูุธุฑูุง ูุฃู apache ุ ุงูุชุฑุงุถููุง ุ ูุณุชุฎุฏู / var / www ูููุทุฉ ุฅุฏุฎุงู ููุถููู ุ ูููู ููุฑุณ symfony ููุฌูุฏ ูู / var / www / public ุ ูุฅููุง ูููู ุจุชุบููุฑ ุฌุฐุฑ ูุณุชูุฏ apache ุจุงูุจูุงุก ุงูุชุงูู.  ุซู ูููู ุจุชุซุจูุช ุงูููุญู ูุงูุนูุฏุฉ ูุงูุบุฒู ุจุงูุชุชุงุจุน (ุฅุฐุง ููุช ูุง ุชุณุชุฎุฏู encore / react.js ูู ุชุทุจููู ุ ูุฃูุช ูุง ุชุญุชุงุฌ ุฅูู ุขุฎุฑ ููุทุชูู).  ุฃุฎูุฑูุง ุ ูููู ุจูุณุฎ ุดูุฑุฉ ุงููุตุฏุฑ ุงูุฎุงุตุฉ ุจูุง ูุจุฏุก ุชุซุจูุช ุงูุชุจุนูุงุช ูู ุฎูุงู ุงูููุญู ูู symfony ูุงูุบุฒู ูู ุฃุฌู react.js.  ูููู ูุนูู Dockerfile ุงูุฎุงุต ุจู STG ูู ุงูุชุนูููุฉ ูุง ูุจู ุงูุฃุฎูุฑุฉ ูุฑุณู ุงูุณูู - ูุณุฎ .env.stg ุฅูู .env ุ ูุฐูู ุณูุญุชูู ููู .env ูู ุตูุฑุฉ STG ุนูู ุงููุนููุงุช ุฐุงุช ุงูุตูุฉ ุจูุฐู ุงูุจูุฆุฉ.  ููููู ูุญูููุง (ุจุงูุทุจุน ูุน ุชุซุจูุช ุนุงูู ูููุงุก) ุฌูุน ุงูุตูุฑุฉ ูุชุดุบูููุง ูุงูุชุฃูุฏ ูู ุฃู ุงูุชุทุจูู ูุนูู ููุง ูุญุชุงุฌ ุฅูู ุฃู ุดูุก ุขุฎุฑ ููุฐุง ุงูุนูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">docker build -t tmp:stg -f Dockerfile.stg . docker run -p 80:80 tmp:stg</code> </pre> <br>  ู STG ู <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">docker build -t tmp:prod . docker run -p 80:80 tmp:prod</code> </pre> <br>  ู PROD. <br>  ูููููุง ุงุณุชุฎุฏุงู EC2 ุ ุฃู ุชูููู ELB / ASG ุ ููุง ุฅูู ุฐูู ุ ุฃู ุงุณุชุฎุฏุงู ElasticBeanstalk ุ ููู ูุฌุฑุฏ ูุฏูุฉ ููุง ูู ุญูุซ ุงูุฑุงุญุฉ.  ุงูุชูู ุฅูู ูุณู ElasticBeanstalk ููู ุจุฅูุดุงุก ุชุทุจูู ุฌุฏูุฏ ุจุงุณูู ููุตูู.  ุซู ูู ุจุฅูุดุงุก ุจูุฆุชูู ุชู ุฐูุฑููุง ูุณุจููุง: STG ู PROD ุ ูุฅูุดุงุก ููุง ุงูุจูุฆุชูู ูุจูุฆุฉ ุฎุงุฏู ููุจ ุ ูุญุฏุฏ "Docker" ููุธุงู ุฃุณุงุณู ุ ูุงุชุฑู ูููุฐุฌ ุงูุชุทุจูู ูุฑูุฒ ุงูุชุทุจูู.  ูุชู ุงููุดุฑ ุนูู ElasticBeanstalk ุนู ุทุฑูู ุชุญููู ูููุงุช ุฃู ุชุนูููุงุช ุงููุดุฑูุน ุ ูุนุงุฏุฉู ูู ุฃุฑุดูู ูุถุบูุท.  ูู ุญุงูุชูุง ุ ุณูููู ุงูุชุฏูู ูุงูุชุงูู: ูููู ุจุชุฌููุน ุตูุฑุฉ ุนุงูู ุงูููู ุงูุฎุงุตุฉ ุจุงูุชุทุจูู ุงูุฎุงุต ุจูุง ุ ุซู ุชุญููููุง ูู ุงููุณุชูุฏุน ูุชุญููู ุงูุชุนูููุงุช ุจุฏูุงู ูู ุฃุฑุดูู ุงููุตุฏุฑ ุฃู ุตูุฑุฉ ุนุงูู ุงูููู ุ ูุงูุชู ุชุฎุจุฑ ุดุฑูุฉ FlexBeanstalk ุจุฃุฎุฐ ุงูุตูุฑุฉ ูู ุงูุฎุงุฏู ุงูุจุนูุฏ ููุดุฑูุง.  ููู ูุฐุง ุชููุงุฆู. <br><br>  ููุจุฏุฃ ุจุฅูุดุงุก ูุณุชูุฏุน ูุชุฎุฒูู ุตูุฑ ุนุงูู ูููุงุก.  ููุงู 2 ุฎูุงุฑุงุช: <br><br>  1 - ูุดุฑูุนู ุฎุงุต ูุฑูุฒู ูุบูู ููุฌุจ ุชุฎุฒูู ุงููุณุชูุฏุน ุนูู ุงูุชูุงูู.  ูู ูุฐู ุงูุญุงูุฉ ุ ููููู ุงูุงุญุชูุงุธ ุจุณุฌู ุงูุตูุฑ ุงูุฎุงุต ุจู ูู ููุงู ูุง ุฃู ุงุณุชุฎุฏุงู ุณุญุงุจุฉ ุฎุงุตุฉ.  AWS ูุฏูู ECR ููุฐู ุงูุฃุบุฑุงุถ ุ ููููู ุฅูุดุงุก ูุณุชูุฏุน ููุงู ุ ูููู ูุง ุฃุญุฏ ููุฑุถ ุนููู ุงูููุงู ุจุฐูู. <br><br>  2 - ูุฏูู ูุดุฑูุน ููุชูุญ ุงููุตุฏุฑ ูููููู ุงุณุชุฎุฏุงู dockerhub. <br><br>  ูู ูุซุงููุง ุ ุงูุดูุฑุฉ ููุชูุญุฉ ุ ููููู ุณุฃูุถุญ ููููุฉ ุงุณุชุฎุฏุงู ุงููุณุชูุฏุนุงุช ุงููุบููุฉ ุ ุจุนุฏ ููู ูุฐู ุงูุนูููุฉ ุ ูู ูููู ุชูุตูู ุตูุฑุฉ ูู dockerhub ุฃูุฑูุง ุตุนุจูุง.  ุฃูู ูุง ูุญุชุงุฌ ุฅููู ูู ุฅูุดุงุก ุงููุณุชูุฏุน ููุณู ุ ูุจุนุฏ ุฐูู ุณุชุญุตู ุนูู URI ุงููุฑูุฏ.  ุณูุชู ุทุฑุญ ุงูุณุฑุฏ ุงูุฅุถุงูู ูุทุฑู ุซุงูุซ (ูููุณ ูุณุชูุฏุนุงุช AWS ECR ูุชูุงูููุง) ุ ุจุงููุณุจุฉ ุฅูู ECR ุณุฃูุชุจ ุจุนุฏ ุฐูู. <br><br>  ุจุนุฏ ุฅูุดุงุก ูุณุชูุฏุน ุงูุชุฎุฒูู ุ ูุญุชุงุฌ ุฅูู ุชุณุฌูู ุงูุฏุฎูู ุฅูู ูุฐู ุงูุฎุฏูุฉ ูููุงู ุฎุฏุนุฉ ุจุณูุทุฉ ... ุงูุชูู ุฅูู ุฅุนุฏุงุฏุงุช ุนุงูู ุงูุชุซุจูุช ุงููุซุจุช ูุญูููุง ูุชุฃูุฏ ูู ุฃู ูุฏูู ุฎูุงุฑ ุญูุธ ูููุงุช ุงููุฑูุฑ ูู ูุญุฏุฉ ุงูุชุฎุฒูู ุงูุฎุงุฑุฌูุฉ (ููุณุชุฎุฏูู ูุธุงู ุงูุชุดุบูู MacOS: "ูู ุจุชุฎุฒูู ุชุณุฌููุงุช ุฏุฎูู ุนุงูู ูููุงุก ุขูู" ูู macOS Keychain ") ุ ูุฅูุง ูุฅู ููู ุงูุชูููู ุงูุฐู ูุญุชุงุฌู ุณูููู ูุงุฑุบูุง.  ูููุฐุง ุ ูุญู ูุณูุญ ูู ุงูุฎุฏูุฉ ุงููุญุฏุฏุฉ ุจุชุฎุฒูู ุณุฌูุงุช ุตูุฑู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">docker login -u LOGIN -p PASSWORD REGISTRY</code> </pre> <br>  ุจุนุฏ ุงููุตุงุฏูุฉ ุงููุงุฌุญุฉ ุ ุณุชุธูุฑ ุงูุจููุฉ ุงูุชุงููุฉ ูู ููู ุงูุชูููู ~ / .docker / config.json: <br><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"REGISTRY"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"auth"</span></span> : <span class="hljs-string"><span class="hljs-string">"BASE64_ENCODED_TOKEN"</span></span> }</code> </pre><br>  ุฅุฐุง ูู ูุธูุฑ ุ ุชุญูู ูู ุชูููู ุนุงูู ุงููููุงุก ุงูููุถุญ ุฃุนูุงู ูุฑุฉ ุฃุฎุฑู. <br><br>  ุงูุขู ุฃุตุจุญ ูู ุดูุก ุฌุงูุฒูุง ูุฅุนุฏุงุฏ ููู ุงูุชุนูููุงุช ูู ElasticBeanstalk - Dockerrun.aws.json ุ ุณูููู ุฑูุฒู ููุง ููู: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Dockerrun.aws.json</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"AWSEBDockerrunVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Authentication"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Bucket"</span></span>: <span class="hljs-string"><span class="hljs-string">"BUCKET_ID"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Key"</span></span>: <span class="hljs-string"><span class="hljs-string">"KEY_PATH"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"Image"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"IMAGE_URL"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Update"</span></span>: <span class="hljs-string"><span class="hljs-string">"true"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"Ports"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"ContainerPort"</span></span>: <span class="hljs-string"><span class="hljs-string">"80"</span></span> } ] }</code> </pre><br></div></div><br>  ุจุดูู ุนุงู ุ ุชุจุฏู ุงูุชุนูููุฉ ููุง ููู: ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู ุจุงุณุชุฎุฏุงู ุงูููุชุงุญ ุงูููุฌูุฏ ุจูุงุณุทุฉ KEY_PATH ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู S3 BUCKET_ID ุ ูู ุจุชุญููู ุงูุตูุฑุฉ ุนู ุทุฑูู ุงููุชุงุจุฉ ููู IMAGE_URL ุจุงููุชุงุจุฉ ููู ุงูููู ุงููุญููุธ ุ ูุงุจุฏุฃ ุชุดุบููู ุจุฅุนุงุฏุฉ ุชูุฌูู ุงููููุฐ 80 ุฅูู ููุณ ุงููููุฐ ุนูู ุงูุญุงููุฉ.  ุงูุขู ุนู ุงูุซูุงุจุช ุงููุณุชุฎุฏูุฉ: <br><br>  BUCKET_ID ูู "ุญููุจุฉ ุงูุธูุฑ" ุงูุชู ุชู ุฅูุดุงุคูุง ุชููุงุฆููุง ูู ุฃุฌูู ูู ุฎุฏูุฉ S3 ุ ูุงูุชู ุชุญุชูู ุนูู ุดูู elasticbeanstalk-REGION-HASH ุ ูุฐุง ูู ุงูููุงู ุงูุฐู ูุญุฏุฏ ููู ุงููุธุงู ูููุน ูููุงุช ุงูุฎุฏูุฉ ูู ElasticBeanstalk ุ ุจูุง ูู ุฐูู ูููุงุช ุงูุชุทุจููุงุช ุงูุชู ุชููู ุจุชูุฒูููุง ุจุงุณุชุฎุฏุงู ุฒุฑ "ุงูุชุญููู ูุงููุดุฑ". <br><br>  KEY_PATH - ุงููุณุงุฑ ุฅูู ููู ุงูุชุฎููู ุฅูู ูุณุชูุฏุน ุงูุตูุฑ ุ ูููููู ุงุณุชุฎุฏุงู ุชูุณูู APP_NAME / cr.json ุ ุฃู ูู ุงููุฌูุฏ ุฏุงุฎู BUCKET_ID ุชุญุช ุงุณู ุทูุจู (ุฃููู ุจุฅูุดุงุฆู ุ ุฅู ูู ููู ุจุนุฏ) ุ ุฃุถุน ููู cr.json ุงูุฐู ูุญุชูู ุนูู ุงูููุฏ ุงูุฐู ุชู ุงุณุชูุงูู ุจุนุฏ ุงูุชุฑุฎูุต ูู ุงูุณุฌู ุงูุตูุฑ ูุญููุง: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">BUCKET_ID / APP_NAME / cr.json</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"REGISTRY"</span></span> : { <span class="hljs-attr"><span class="hljs-attr">"auth"</span></span> : <span class="hljs-string"><span class="hljs-string">"BASE64_ENCODED_TOKEN"</span></span> } }</code> </pre> </div></div><br>  IMAGE_URL ูู URI ุงููุฑูุฏ ูุณุฌู ุตูุฑุชู + ุนูุงูุฉ ุงูุตูุฑุฉ ููุณูุง ุ ูุฌุจ ุฃู ูููู ูู ุดูุก ูุงุถุญูุง ููุง. <br><br>  ูุฐุง ูู ุดูุก ุ ุงูุขู ูููููุง ุชูุฒูู ูุฐุง ุงูููู ูุฅุตุฏุงุฑ ูู ุชุทุจูููุง ูู ElasticBeanstalk ุ ูุณูููู ุจุณุญุจ ุงูุตูุฑุฉ ุงููุญุฏุฏุฉ ููุดุฑูุง. <br><br>  ูุจูู ูุฃุชูุชุฉ ูุฐู ุงูุนูููุฉ.  ูููู ุฃููู ููุชุนูุง ุชูุงููุง ุ ุณุฃููุฐ ุชุณูุณู ุงูุฎุทูุงุช ุงูุฎุงุตุฉ ุจุงูุชุฏูู ุงูุชุงูู: ุจุงููุณุจุฉ ูุฌููุน ุงูุชุนูุฏุงุช ุบูุฑ ุงูููุฌูุฏุฉ ูู ุงููุฑุน ุงูุฑุฆูุณู ุ ุณูุชู ุฌูุน ุงูุตูุฑุฉ ููุดุฑูุง ูู ุจูุฆุฉ STG ุ ูุฅุฐุง ุฏูุนูุง ุฅูู ุงููุนูู ุ ุฃู ุฃูุถู ูู ุฐูู ุ ุฃุบูููุงู ูููุฃูุงู ุจุทูุจ ุฏูุฌ ุ ุซู ุณูุชู ูุดุฑ ุงูุฑูุฒ ุนูู PROD.  ูุจุงูุชุงูู ุ ูุญุตู ุนูู PROD ูุนุงูุฌูุง ูุญุฏุซูุง ุ ูููู ููู ูู ุดูุก ุนูู ูุง ูุฑุงู ุ ููุฑูุนูุง ูุชุทููุฑ ูุงุฎุชุจุงุฑ ุฑูุฒ ุฌุฏูุฏ ูู STG.  ููุฐุง ุงูุชุทุจูู ุ ูุญุชุงุฌ ุฅูู ุชุนูููุงุช ูุชุญููู ุตูุฑ ุบูุฑ ุฃุญุฏุซ ุ ููุณุฎ Dockerrun.aws.json ุฅูู Dockerrun.aws.stg.json ุ ูุฅุนุงุฏุฉ ุชุณููุฉ Dockerrun.aws.json ุฅูู Dockerrun.aws.prod.json (ููุฑุงุญุฉ ููุท). <br><br>  ุงูุดูุก ุงููุญูุฏ ุงูุฐู ูููุฒ Dockerrun.aws.stg.json ุจุตุฑู ุงููุธุฑ ุนู Dockerrun.aws.prod.json ูู IMAGE_URL: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Dockerrun.aws.stg.json</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"AWSEBDockerrunVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Authentication"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Bucket"</span></span>: <span class="hljs-string"><span class="hljs-string">"BUCKET_ID"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Key"</span></span>: <span class="hljs-string"><span class="hljs-string">"KEY_PATH"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"Image"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"IMAGE_URL:dev"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Update"</span></span>: <span class="hljs-string"><span class="hljs-string">"true"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"Ports"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"ContainerPort"</span></span>: <span class="hljs-string"><span class="hljs-string">"80"</span></span> } ] }</code> </pre><br></div></div><br>  ููุง ููุช ูู ุจุฏุงูุฉ ุงูููุงู ุ ุจุตูุชู CI / CD ุ ุณูู ุฃุณุชุฎุฏู CircleCI ุ ูุงูุชู ุ ููููุง ููุดุงุนุฑู ุงูุดุฎุตูุฉ ุ ุฃุณุฑุน ูู GitlabCI ุ ุฅุฐุง ููุช ุฃุณุชุฎุฏู ูุณุฎุฉ SaaS ุงููุฌุงููุฉ.  ุณุชุนูู Free Travis ุ ูููู ูุธุฑูุง ูุฃููุง ูุง ุชุนูู ูุน ูุณุชูุฏุนุงุช git ุงูุฎุงุตุฉ ุ ูู ุฃูู ุจุฅุฌุฑุงุก ูุธุงูุฑุฉ ุนูู ูุฌู ุงูุชุญุฏูุฏ ุญุชู ูุง ุชููู ููุงู ุฎูุจุฉ ุฃูู ุนูุฏูุง ุชููู ููุงู ุญุงุฌุฉ ุฅูู ูุซู ูุฐู ุงููุฑุตุฉ.  ุณุฃุชุฑู ุฅุนุฏุงุฏุงุช ุงููุดุฑูุน ูู CircleCI ูููุฑุงุก ููุฏุฑุงุณุฉ ูุฃููุณูู ุ ูุณุฃูุฏู ุงูุฅุฑุดุงุฏุงุช ุงููุงุฒูุฉ ูููุดุฑ ุจููุณู - ูู ุฌุฐุฑ ูุดุฑูุนูุง ุณูููู ุจุฅูุดุงุก ูุฌูุฏ .circleci ุ ุจู config.yml ุจุงููุญุชููุงุช ุงูุชุงููุฉ: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">.circleci / config.yml</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">version: 2 jobs: build: machine: true steps: - checkout - run: echo "$CI_REGISTRY_PASSWORD" | docker login -u $CI_REGISTRY_USER --password-stdin $CI_REGISTRY - run: docker build -t $CI_REGISTRY/$CI_REGISTRY_ID:dev -f Dockerfile.stg . - run: docker push $CI_REGISTRY/$CI_REGISTRY_ID:dev build-master: machine: true steps: - checkout - run: echo "$CI_REGISTRY_PASSWORD" | docker login -u $CI_REGISTRY_USER --password-stdin $CI_REGISTRY - run: docker build -t $CI_REGISTRY/$CI_REGISTRY_ID:latest . - run: docker push $CI_REGISTRY/$CI_REGISTRY_ID:latest deploy-stg: docker: - image: circleci/python:latest steps: - checkout - run: sudo pip install awsebcli --upgrade - run: | mkdir ~/.aws touch ~/.aws/config chmod 600 ~/.aws/config echo "[profile eb-cli]" &gt; ~/.aws/config echo "aws_access_key_id=$AWS_ACCESS_KEY_ID" &gt;&gt; ~/.aws/config echo "aws_secret_access_key=$AWS_SECRET_ACCESS_KEY" &gt;&gt; ~/.aws/config - run: eb init --region EB_REGION --platform Docker EB_APP - run: cp Dockerrun.aws.stg.json Dockerrun.aws.json - run: eb use EB_ENV_STG --region EB_REGION - run: eb deploy -v --staged --profile eb-cli deploy-prod: docker: - image: circleci/python:latest steps: - checkout - run: sudo pip install awsebcli --upgrade - run: | mkdir ~/.aws touch ~/.aws/config chmod 600 ~/.aws/config echo "[profile eb-cli]" &gt; ~/.aws/config echo "aws_access_key_id=$AWS_ACCESS_KEY_ID" &gt;&gt; ~/.aws/config echo "aws_secret_access_key=$AWS_SECRET_ACCESS_KEY" &gt;&gt; ~/.aws/config - run: eb init --region EB_REGION --platform Docker EB_APP - run: cp Dockerrun.aws.prod.json Dockerrun.aws.json - run: eb use EB_ENV_STG --region EB_REGION - run: eb deploy -v --staged --profile eb-cli workflows: version: 2 build: jobs: - build: filters: branches: ignore: - master - deploy-stg: requires: - build filters: branches: ignore: - master build-deploy: jobs: - build-master: filters: branches: only: - master - deploy-prod: requires: - build-master filters: branches: only: - master</code> </pre></div></div><br>  ููุฏ ุฑุณูุช ุงูุชุฏูู ููุณู ูุจู ุฐูู ุจูููู ุ ุญูุซ ูุชู ุชุฑุฌูุชู ุฅูู ุชุนูููุงุช yaml ูู CircleCI ุ ุฏุนูุง ูุฐูุจ ูู ุฎูุงู ุชูููุฐ ุฎุทูุงุช ูุญุฏุฏุฉ.  ูู ุงูููู ููุงุญุธุฉ ูุฌูุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุงููุนุฑูุฉ ูู CI ูุงูุชู ุณูุชู ุงุณุชุฎุฏุงููุง ุฎูุงู ุงูุนูู: <br><br>  ููุงู ุญุงุฌุฉ ุฅูู CI_REGISTRY ุ CI_REGISTRY_USER ุ CI_REGISTRY_PASSWORD ูููุตูู ุฅูู ุชุฎุฒูู ุตูุฑ ุนุงูู ุงููููุงุก - ููุณ ุงูุดูุก ุงูุฐู ูุถุนูุงู ูู cr.json ุ ููุท ุฏูู base64 <br><br>  ูุดูู CI_REGISTRY / CI_REGISTRY_ID ุนููุงู URL ูุฑูุฏูุง ููุตูุฑุฉ ุ ุจุฏูู ุนูุงูุฉ <br><br>  AWS_ACCESS_KEY_ID ู AWS_SECRET_ACCESS_KEY - ุงูุฃุณูุงุก ุชุชุญุฏุซ ุนู ููุณูุง ุ ููุฐู ุนุจุงุฑุฉ ุนู ุฃุฑุตุฏุฉ AWS ูููุณุชุฎุฏู ุงูุฐู ุณููุดุฑ CircleCI ููุงุจุฉ ุนูู.  ุงูุชูู ุฅูู AWS IAM ููู ุจุฅูุดุงุก ูุณุชุฎุฏู ุ ูุฃุถูู ุฅูู ูุฌููุนุฉ ุงููุณุคูููู ุ ููู ุจุชูููุฑ ุงููุตูู ุงูุจุฑูุฌู ููุท.  ุชุฐูุฑ ุฃู AWS_SECRET_ACCESS_KEY ูุชุงุญ ููุนุฑุถ / ุงููุณุฎ ูุฑุฉ ูุงุญุฏุฉ ููุท ุ ุจุนุฏ ุงูููุฑ ุนูู ุฑุงุจุท ุงูุนุฑุถ ุ ูู ุชุดุงูุฏู ูุฑุฉ ุฃุฎุฑู. <br><br>  ุงูุนูุฏุฉ ุฅูู ุฎุทูุงุช ุชูููู CircleCI.  ูุง ูู ุงูุณุญุฑุ  ูููู Checkout ุจุชุญููู ุงูููุฏ ุงููุตุฏุฑู ูู ูุฑุน git ุฅูู ุฏููู ุงูุนูู ุงูุญุงูู ุ ูุชุชูุฑุฑ ูุฐู ุงูุนูููุฉ ูู ูู ูุธููุฉ.  ูู ุนูููุฉ ุงูุฅูุดุงุก ุ ูููู ุจุชุณุฌูู ุงูุฏุฎูู ุจุงูุชุณูุณู ุฅูู ุงููุณุชูุฏุน ุ ููุฌูุน ุงูููุฏ ุงุณุชูุงุฏูุง ุฅูู Dockerfile.stg ุชุญุช ุงูุนูุงูุฉ XXX: dev ููุฑุณูู ุฅูู ุงููุณุชูุฏุน.  ูููู build-master ุจููุณ ุงูุดูุก ุ ููู ูุณุชุฎุฏู Dockerfile "ุงูุนุงุฏู" ุชุญุช ุงูุนูุงูุฉ XXX: ุงูุฃุญุฏุซ ููุชุฌููุน. <br><br>  ูุดุฑ-stg ุจุชุซุจูุช AWS EB CLI ูุฅูุดุงุก ููู ุชุนุฑูู ุงูุชุฎููู ูู ููู ~ / .aws / config ุ ููู ุฃูุฑ ุถุฑูุฑู ููุนูู CLI ุจุดูู ุตุญูุญ ุ ุซู ุชููุฆุฉ ุงููุชุบูุฑุงุช ูู CLI - ุณุชุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ุงูููุทูุฉ ุงูุชู ุชุฎุชุงุฑูุง ุ ูุงููุธุงู ุงูุฃุณุงุณู - ุฏูููุง Docker ูุงุณู ุงูุชุทุจูู ุงูุฎุงุต ุจู.  ุจุนุฏ ุฐูู ุ ูููู ุจูุณุฎ ูุญุชููุงุช Dockerrun.aws.stg.json ุฅูู ููู Dockerrun.aws.json ุงูุฌุฏูุฏ ุ ูุจุงุณุชุฎุฏุงู ุงูุจูุฆุฉ ูุงูููุทูุฉ ุงููุญุฏุฏุฉ ุ ูุนุทู ุงูุฃูุฑ ููุดุฑ ุชุทุจูููุง ุจุงุณุชุฎุฏุงู ููู ุชุนุฑูู ุงูุชุฑุฎูุต ุงูุฐู ุชู ุฅูุดุงุคู.  ุงูุชุฑุงุถููุง ุ ููุชูุฌุฉ ููุฐุง ุงูุฃูุฑ ุ ุณููุชูู ุจูุงูุฉ ุฑูุฒ ุงููุฑุน ุงูุฐู ูุชู ูุฑุงูุจุชู ูู ุฃุฑุดูู ูุถุบูุท ุ ุณูุชู ุชูุฒููู ุนูู ElasticBeanstalk ูุชูุฑูุบู ููุงู ุ ููู ูุฐู ุงูุนูููุฉ ุจุงูุธุฉ ุงูุซูู ูุณุจููุง ุ ูุฐูู ุฃูุดุฃูุง ููู Dockerrun.aws.json ุฌุฏูุฏูุง ุ ููู ูุง ูููู ููุดุฑ ุงูููู ุงูุฐู ุฃูุดุฃูุงู ุงูุตูุฑุฉ ุนู ุจุนุฏ ุ ููุญู ุจุญุงุฌุฉ ููุท ูุชุญูููู ุ ูู ุงููุงูุน.  ููููุงู ุจุฐูู ุ ูู ุจุฅูุดุงุก ููู .ebignore ูู ุฌุฐุฑ ุงููุดุฑูุน: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">.ebignore</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">* !Dockerrun.aws.json</code> </pre></div></div><br>  ูุณุชุฎุฏู ูุฐุง ุงูููู ุจูุงุก ุฌููุฉ .gitignore ููู .gitignore ุ ูููู ููุณ ูู Git CLI ุ ูููู AWS EB CLI.  ูู ูุฐุง ุงูููู ุ ุฃุฎุจุฑ CLI ุจุชุฎุทู ุฌููุน ุงููููุงุช ุจุงุณุชุซูุงุก Dockerrun.aws.json.  ูุฐุง ูู ุดูุก ุ ุงูุขู ุนูุฏ ุชุดุบูู ูููุฉ publish-stg ูู ElasticBeanstalk ุ ุณูุชู ุฅุฑุณุงู ุงูููู ุงูุฐู ุฃูุดุฃูุงู ููุท.  ูุดุฑ-prod ููุนู ููุณ ุงูุดูุก ุ ููุท ูุณุฎ ูุญุชููุงุช ููู Dockerrun.aws.prod.json ุฅูู Dockerrun.aws.json ุ ูุงูุฃุฎูุฑ ูู ุฅุดุงุฑุฉ ุฅูู ุชุณูุณู ุงูุนูู ูู ุชูุณูู CircleCI (publish-stg ุจุนุฏ ุงูุฅูุดุงุก ููุดุฑ-prod ุจุนุฏ ุงูุฅูุดุงุก ูุงุฌุณุชูุฑ) ุ ูุนูู ุฃู ูุฑูุน ุชุจุญุซ ุงูุจูุงูุงุช ุนูู (ุชุฌุงูู: - ูุงุฌุณุชูุฑ ูููุท: - ูุงุฌุณุชูุฑ). <br><br>  ููุงู ูุณุฃูุฉ ูุฎุชููุฉ ููููุงู ูุน AWS ECR ุ ููุง ูุนุฏุช ุ ุณูุนูุฏ ุฅูููุง.  ูุง ุชุญุชุงุฌ ุฅูู ุชุณุฌูู ุงูุฏุฎูู ุนู ุจุนุฏ ุฅูู ECR ูุฅูุดุงุก ููู cr.json ุ ุญูุซ ุฃู ElasticBeanstalk "ูุนุฑู ุฃุฎูุง ุดุฎุตููุง".  ููููุง ูุฐูู ุ ุณุชุจุฏู Dockerrun.aws.json ูุฎุชููุฉ - ูู ูููู ููุงู ุจุจุณุงุทุฉ ูุชูุฉ ูุตุงุฏูุฉ: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Dockerrun.aws.json (AWS ECR)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"AWSEBDockerrunVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Image"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"IMAGE_URL"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Update"</span></span>: <span class="hljs-string"><span class="hljs-string">"true"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"Ports"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"ContainerPort"</span></span>: <span class="hljs-string"><span class="hljs-string">"80"</span></span> } ] }</code> </pre><br></div></div><br>  ูููู ููู ุฅุฐู ุณุชุญุฏุซ ุงููุตุงุฏูุฉุ  ุงูุญูููุฉ ูู ุฃู ุงูุฎุฏูุฉ ุงูุชู ุชุตู ุฅูู ECR ููุง ูุฌููุนุฉ ูุนููุฉ ูู ุงูุญููู ุ ูุงูุชู ุจุฏูุฑูุง ุชุนุชูุฏ ุนูู ุณูุงุณุงุช ุฃูููุฉ ูุนููุฉ.  ูู ุญุงูุชูุง ุ ุนูุฏ ุจุฏุก ุงููุดุฑ ุนุจุฑ AWS CLI ูู ุฎุงุฏู ุฌูุฉ ุฎุงุฑุฌูุฉ (ูู CI) ุ ูุชู ุงุณุชุฎุฏุงู ุฏูุฑ "aws-elasticbeanstalk-ec2-role" ุ ุงุจุญุซ ุนูู ูู AWS IAM ูู ูุณู ุงูุฃุฏูุงุฑ ูุฅุฑูุงู ุงูุณูุงุณุฉ ุงูุฅุถุงููุฉ "AmazonEC2ContainerRegistryReadOnly" ุจูุง.  ุงูุขู ููุฌุญ ุงูุชูุฒูู ูู ูุณุชูุฏุน ุฎุงุต ุฅูู "ุฌุงุฑู" ุฏูู ุฃุฎุทุงุก. <br><br>  ูููู ูุฐุง ูุชู ุชุญูููู ุจุงูุถุจุท ูู ููุณ VPC ุ ูู ุฎูุงู CLI ุ ูุง ูููู ุฃูุฑ ุชุณุฌูู ุงูุฏุฎูู ุฅูู ุนุงูู ุงูุฅุฑุณุงุก "ุจุฏูู ุญูู": ุชุญุชุงุฌ ุฅูู ุงูุญุตูู ุนูู (ุงูุญุตูู ุนูู) ุฃุฑุตุฏุฉ ูุชุณุฌูู ุฏุฎูู ุนุงูู ูููุงุก ุนุจุฑ AWS CLI ุ ููุฐุง ููุฌุฏ ุฃูุฑ <br><br> <code>aws ecr get-login --region REGION --no-include-email</code> <br> <br>  ุณูุนูุฏู ูุฐุง ุงูุฃูุฑ ุฅูู ุณุทุฑ ูู ุชุณุฌูู ุฏุฎูู ุนุงูู ูููุงุก ุงููููุฐุฌ ... ุ ุจุจุณุงุทุฉ ุ ูู ูุญุฏุฉ ุงูุชุญูู ุงูุชู ุชุญุชุงุฌ ุฅูู ุชูููุฐูุง <br><br> <code>eval $(aws ecr get-login --region EB_REGION --no-include-email)</code> <br> <br>  ุณูุชููู ุงูุฃูุฑ ุฃููุงู ุณูุณูุฉ ูููุตุงุฏูุฉ ุ ุซู ูุจุฏุฃ ุงูุนูููุฉ ุงูููุงุจูุฉ.  ูู ุถูุก ูุฐู ุงูููุงุนุฏ ุงูุฎุงุตุฉ ุจู AWS ECR ุ ุณูุจุฏู ููู ุงูุชุนูููุงุช ูู CircleCI ููุง ููู: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">.circleci / config.yml (ูู AWS ECR)</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">version: 2 jobs: build: docker: - image: circleci/python:latest steps: - checkout - run: sudo pip install awscli --upgrade - run: | mkdir ~/.aws touch ~/.aws/config chmod 600 ~/.aws/config echo "[profile eb-cli]" &gt; ~/.aws/config echo "aws_access_key_id=$AWS_ACCESS_KEY_ID" &gt;&gt; ~/.aws/config echo "aws_secret_access_key=$AWS_SECRET_ACCESS_KEY" &gt;&gt; ~/.aws/config - setup_remote_docker - run: eval $(aws ecr get-login --region EB_REGION --no-include-email) - run: docker build -t $CI_REGISTRY/$CI_REGISTRY_ID:dev -f Dockerfile.stg . - run: docker push $CI_REGISTRY/$CI_REGISTRY_ID:dev build-master: docker: - image: circleci/python:latest steps: - checkout - run: sudo pip install awscli --upgrade - run: | mkdir ~/.aws touch ~/.aws/config chmod 600 ~/.aws/config echo "[profile eb-cli]" &gt; ~/.aws/config echo "aws_access_key_id=$AWS_ACCESS_KEY_ID" &gt;&gt; ~/.aws/config echo "aws_secret_access_key=$AWS_SECRET_ACCESS_KEY" &gt;&gt; ~/.aws/config - setup_remote_docker - run: eval $(aws ecr get-login --region EB_REGION --no-include-email) - run: docker build -t $CI_REGISTRY/$CI_REGISTRY_ID:latest . - run: docker push $CI_REGISTRY/$CI_REGISTRY_ID:latest deploy-stg: docker: - image: circleci/python:latest steps: - checkout - run: sudo pip install awsebcli --upgrade - run: | mkdir ~/.aws touch ~/.aws/config chmod 600 ~/.aws/config echo "[profile eb-cli]" &gt; ~/.aws/config echo "aws_access_key_id=$AWS_ACCESS_KEY_ID" &gt;&gt; ~/.aws/config echo "aws_secret_access_key=$AWS_SECRET_ACCESS_KEY" &gt;&gt; ~/.aws/config - run: eb init --region EB_REGION --platform Docker EB_APP - run: cp Dockerrun.aws.stg.json Dockerrun.aws.json - run: eb use EB_ENV_STG --region EB_REGION - run: eb deploy -v --staged --profile eb-cli deploy-prod: docker: - image: circleci/python:latest steps: - checkout - run: sudo pip install awsebcli --upgrade - run: | mkdir ~/.aws touch ~/.aws/config chmod 600 ~/.aws/config echo "[profile eb-cli]" &gt; ~/.aws/config echo "aws_access_key_id=$AWS_ACCESS_KEY_ID" &gt;&gt; ~/.aws/config echo "aws_secret_access_key=$AWS_SECRET_ACCESS_KEY" &gt;&gt; ~/.aws/config - run: eb init --region EB_REGION --platform Docker EB_APP - run: cp Dockerrun.aws.prod.json Dockerrun.aws.json - run: eb use EB_ENV_STG --region EB_REGION - run: eb deploy -v --staged --profile eb-cli workflows: version: 2 build: jobs: - build: filters: branches: ignore: - master - deploy-stg: requires: - build filters: branches: ignore: - master build-deploy: jobs: - build-master: filters: branches: only: - master - deploy-prod: requires: - build-master filters: branches: only: - master</code> </pre></div></div><br>   docker-in-docker   setup_remote_docker   ,          .   ,       : <br><br><img width="350" src="https://habrastorage.org/webt/7e/cw/sj/7ecwsjkjjmr8myxiuutwkujwnkg.png" alt="ุตูุฑุฉ"><br><br>   ,     ,     ()      .   ยซยป   .  ( - )  ,      ,         ,                . <br><br>    GitHub: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">tutorial-aws-symfony-ci</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar462415/">https://habr.com/ru/post/ar462415/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar462401/index.html">ุงููุทูุฑ ุฎุทุงูุง ูููุชุฉ</a></li>
<li><a href="../ar462403/index.html">ุงุฎุชูุงุฑ ุญุฌู ุงูุดุงุดุฉ: ูุธุฑูุฉ ุงูุญุฌู ุงูุฒุงูู ุ ุงูุฃุณุงุณ ุงูููุทูู ูุงูููุงุฑูุฉ</a></li>
<li><a href="../ar462407/index.html">ููุฎุต ุชุตููู ุงูุทุนุงู ุ ููููู 2019</a></li>
<li><a href="../ar462409/index.html">ููุชุจุฉ ูููุฏ ุฌุงูุน ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูููููุฑููููุชุฑููุฑ AVR. ุงูุฌุฒุก 1</a></li>
<li><a href="../ar462411/index.html">ุญู ุณูุฏููู ูุน ุฎูุงุฑุฒููุฉ X</a></li>
<li><a href="../ar462417/index.html">ุนุฑูุถุฉ ุฃุจู</a></li>
<li><a href="../ar462421/index.html">Apollo Guidance - ุจุฑุงูุฌ ุงูููุจููุชุฑ ูุงูููุฏุณุฉ ุงููุนูุงุฑูุฉ. ุงูุฌุฒุก 2</a></li>
<li><a href="../ar462423/index.html">ุฅุฏุงุฑุฉ ุงููุดุงุฑูุน</a></li>
<li><a href="../ar462429/index.html">VueJs + VueRouter + ูุดุฑูุท. ุฏุฑุงุฌุฉ ุงุฎุฑู</a></li>
<li><a href="../ar462431/index.html">ููุฎุต ุงูููุงุฏ ุงููุซูุฑุฉ ููุงูุชูุงู ููุทูุฑ ุงููุงุชู ุงููุญููู ุฑูู 309 (29 ููููู - 4 ุฃุบุณุทุณ)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>