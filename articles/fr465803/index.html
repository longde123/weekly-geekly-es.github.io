<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📫 🤘🏼 👃 Maven-way pour construire des projets Go ⬜️ 👩🏼‍🔬 🤷</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tout d'abord, un peu d'histoire. Au début des années 2010, j'ai créé un petit utilitaire de conversion pour les fichiers BIN de l'émulateur BK-0010 en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Maven-way pour construire des projets Go</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465803/"><p>  Tout d'abord, un peu d'histoire.  Au début des années 2010, j'ai créé un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">petit utilitaire de conversion</a> pour les fichiers BIN de l'émulateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BK-0010</a> en fichiers WAV.  L'utilitaire a été écrit en Python dans le but d'une portabilité maximale, il a fonctionné sans problème et je l'ai oublié pendant un moment.  Mais en 2016, l'utilisateur est apparu, qui n'avait aucune idée de Python et comment l'installer.  Il voulait un simple monolithe exécutable qui "fonctionnerait tout simplement".  Sa demande m'a semblé logique et j'ai décidé de retravailler l'utilitaire comme un ensemble de fichiers exécutables binaires pour les principales plates-formes. </p><br><p><img src="https://habrastorage.org/webt/dm/hq/kd/dmhqkdcz2pv6rlqs3af4f2_5jv4.png" alt="image"></p><br><p> Python et Java n'ont pas donné une telle opportunité (à moins bien sûr que l'on veuille gonfler l'utilitaire de plusieurs dizaines de mégaoctets).  Potentiellement, la solution pourrait être faite en C / C ++, mais avec une telle couverture ciblée des plates-formes, les difficultés de compilation croisée dépasseraient le temps alloué pour la tâche (et j'ai dû prendre en charge le montage croisé pour Windows, Linux et MacOS en 64 et 32 ​​bits options).  J'ai donc attiré l'attention sur le langage Go, qui gagne en popularité, qui à cette époque était déjà devenu assez mature et le seul qui, <strong>sans toutes les danses avec un tambourin, fournit toute la compilation croisée requise dès la sortie de la boîte (!)</strong> . </p><a name="habracut"></a><br><p>  Un inconvénient qui m'a beaucoup ennuyé à propos de Go (en particulier en tant que développeur Java) était la médiocrité de l'organisation de la structure des projets Go et la nécessité d'ajuster constamment l'environnement.  Peut-être que les développeurs de Go avaient initialement prévu une utilisation spécifique ou l'accent était mis sur les conteneurs, mais je me suis habitué à celui «savoureux» et comme mon principal outil en Java est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Maven</a> , j'ai décidé de faire un plug-in qui appelle les utilitaires et les commandes GoSDK avec la génération automatique des nécessaires. variables d'environnement. </p><br><p> Ce n'était pas intéressant de créer un simple plugin qui appellerait l'utilitaire go, et j'ai décidé de passer à l'étape - installer GoSDK sur la plateforme hôte.  Immédiatement après le démarrage, le GoSDK est vérifié dans son répertoire de configuration (j'ai choisi le chemin par défaut <code>~/.mvnGoLang</code> ) et, en l'absence de la version requise, l'archive GoSDK est automatiquement téléchargée et décompressée depuis le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel</a> .  Cela nous a permis de créer des projets Go portables sans se soucier de savoir si l'outil de la version requise est préinstallé et configuré.  Bien sûr, avec de nombreux paramètres, j'ai prévu la possibilité d'utiliser une version préinstallée et des paramètres ajoutés pour toutes les étapes du processus, car pour de nombreux problèmes de ce type, ils sont critiques, tels que la désactivation de la vérification des certificats SSL ou généralement les requêtes HTTP à l'extérieur (comme pour le projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Keycloak</a> ). </p><br><p>  L'étape suivante, j'ai enveloppé dans les objectifs Maven (objectifs) toutes les commandes de l'utilitaire go fournies à ce moment-là.  Puisqu'il y avait une chance qu'une autre nouvelle commande apparaisse avec la nouvelle version de GoSDK, une tâche <code>custom</code> été ajoutée permettant à l'utilisateur de déterminer la commande souhaitée par lui-même.  Par défaut, dans le cadre de maven-phases (phases), les tâches sont exécutées dans l'ordre suivant: </p><br><ul><li>  <strong>nettoyer</strong> comme <strong>nettoyage</strong> par <code>default-clean</code> en phase <em>propre</em> </li><li>  <strong>correction</strong> comme <strong>correction</strong> par <code>default-fix</code> dans la phase de <em>validation</em> </li><li>  <strong>obtenir</strong> par <code>default-get</code> en phase d' <em>initialisation</em> </li><li>  <strong>générer</strong> comme <strong>génération</strong> par <code>default-generate</code> dans la phase de <em>génération de sources</em> </li><li>  <strong>fmt</strong> comme <code>default-fmt</code> dans la <em>phase des sources de processus</em> </li><li>  <strong>test</strong> comme <strong>test</strong> par <code>default-test</code> dans la phase de <em>test</em> </li><li>  <strong>construire en</strong> tant que <strong>build</strong> par <code>default-build</code> dans la phase de <em>package</em> </li><li>  comme <code>default-install</code> par <code>default-install</code> tâche interne <strong>mvninstall</strong> est <strong>exécutée</strong> dans la phase d' <em>installation</em> </li><li>  <strong>installer en</strong> tant que <code>default-deploy</code> par <code>default-deploy</code> dans la phase de <em>déploiement</em> </li></ul><br><p>  N'importe laquelle des étapes de base peut être désactivée en traduisant la tâche en une phase inexistante: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>default-fix<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>none<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Dans l'implémentation interne, les tâches étaient divisées en «travailler avec les dépendances» et «ne nécessitant pas de résolution de dépendance», après l'apparition de la prise en charge du mode module, la plupart ont migré vers «travailler avec les dépendances». </p><br><p>  La structure du projet Go-maven, j'ai essayé de me rapprocher de la structure de dossier standard acceptée pour Go (c'est <code>/src</code> dire <code>/src</code> et <code>/bin</code> à la racine du projet).  Mais comme Maven est emprisonné pour Java, il n'a pas été directement possible de «casser» son approche de l'organisation de la structure du projet et de rendre cette étape invisible pour l'utilisateur, de sorte que la configuration de base du plugin semble un peu inhabituelle même pour beaucoup familiers avec maven: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> ```${basedir}/src<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDirectory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span>${basedir}/bin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.igormaznitsa<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>mvn-golang-wrapper<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.3.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goVersion</span></span></span><span class="hljs-tag">&gt;</span></span>1.12.9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><blockquote>  <strong>ATTENTION!</strong>  Pour une raison quelconque, le HabR peut afficher de manière incorrecte la section <code>&lt;sourceDirectory&gt;${basedir}/src&lt;/sourceDirectory&gt;</code> lors du formatage XML </blockquote><p>  Comme vous pouvez le voir, vous devez déterminer directement le dossier source <code>/src</code> et le dossier avec le résultat <code>/bin</code> .  D'une part, c'est un inconvénient, d'autre part, la possibilité de changer leur emplacement. </p><br><p>  L'ensemble pom.xml minimaliste pour un projet à module unique, un monde la Hello, est le suivant: </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.igormaznitsa<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>mvn-golang-helloworld<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.0-SNAPSHOT<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>mvn-golang<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> ```${basedir}/src<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDirectory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span>${basedir}/bin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.igormaznitsa<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>mvn-golang-wrapper<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.3.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goVersion</span></span></span><span class="hljs-tag">&gt;</span></span>1.12.9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Veuillez noter que l'emballage du projet est désigné comme <strong>mvn-golang</strong> .  Cette configuration est suffisante pour construire le fichier exécutable et le placer dans le dossier bin résultant sur la base des textes sources dans le dossier src.  Le cache de génération Go sera également créé dans le <code>/bin</code> (comme <code>/bin/.goBuildCache</code> par défaut) et sera effacé avec clean avec ce dossier temporaire. </p><br><p>  Dans la phase d' <em>installation</em> , la tâche <code>mvninstall</code> interne est <code>mvninstall</code> , qui emballe simplement l'ensemble du projet dans une archive zip et le place dans le référentiel maven en tant qu'artefact généré.  Au départ, je venais de stocker ces artefacts, mais à partir de la version 2.3.2 un mécanisme a été ajouté pour les prendre en charge en tant que dépendances maven standard et il est devenu possible de développer des projets avec "partage" de code commun via le référentiel maven.  Il est clair que placer les résultats binaires générés dans le référentiel en tant qu'artefacts est une mauvaise idée en raison des exigences multiplates-formes et donc le contenu du dossier <code>/bin</code> n'est pas empaqueté dans l'artefact. </p><br><p>  Connecter un autre projet avec l' <em>empaquetage</em> <code>mvn-golang</code> tant que dépendance <code>mvn-golang</code> ressemble à ceci: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.igormaznitsa<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>mvn-go-test-mix-terminal<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.0-SNAPSHOT<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span>mvn-golang<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Avec la version 2.3.3, un support a été ajouté pour travailler avec le mécanisme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Go</a> des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modules</a> , mais par défaut, il n'est pas activé (pour la compatibilité descendante) et est activé à l'aide du paramètre de configuration: </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">moduleMode</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">moduleMode</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Lorsque le mécanisme des modules Go était encore au stade expérimental, j'ai ajouté la prise en charge du travail avec les versions de dépendance via des appels directs aux utilitaires CVS, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un exemple de test a</a> été <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">réalisé</a> .  Mais maintenant, je pense qu'un tel mécanisme n'est plus d'un grand intérêt et qu'il est plus rentable d'utiliser des dépendances standard via des modules.  De plus, le plugin est capable de prétraiter les fichiers <code>go.mod</code> au moment de la construction du projet, en remplaçant les chemins vers les dossiers locaux si le travail est en cours dans le cadre d'un projet multi-module. </p><br><p>  Étant donné que Maven prévoit la possibilité de normalisation à l'aide d'archétypes, j'ai créé deux archétypes: </p><br><ul><li>  <em>com.igormaznitsa: mvn-golang-hello: 2.3.3</em> pour un archétype simple à module unique </li><li>  <em>com.igormaznitsa: mvn-golang-hello-multi: 2.3.3</em> pour un projet multi-module avec code source partagé </li></ul><br><p>  Un exemple de travail avec l'archétype d'un projet à module unique peut être vu dans l'animation ci-dessous <br><img src="https://habrastorage.org/webt/xj/l4/as/xjl4ashjm59in1djzr0hvsjqqkg.gif" alt="image">  . </p><br><p>  Vous pouvez également simplement cloner le projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Hello World"</a> et jouer: </p><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/raydac/mvn-golang-example.git</code> </pre> <br><p><img src="https://habrastorage.org/webt/x6/d8/3f/x6d83f1hbq0ul2ewmrzgkdpg0eq.gif" alt="image"></p><br><p>  Souvent, une question raisonnable se pose - pourquoi tout cela est nécessaire et quels bonus l'utilisation de Maven donne-t-elle dans le processus de construction d'un projet Go?  J'essaierai d'y répondre point par point: </p><br><ol><li>  Maven est un environnement de construction de projet multiplateforme très mature, pris en charge par presque toutes les plates-formes CI, par exemple Jenkins, en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilisant Go2XUnit,</a> vous pouvez convertir les résultats des tests au format affiché par les plugins de rapport. </li><li>  Maven est multiplateforme et pris en charge par tous les systèmes d'exploitation, étant inclus dans tous les référentiels.  La présence de profils activés de manière flexible facilite la personnalisation du processus pour différentes plates-formes. </li><li>  Maven a une <strong>énorme quantité de plugins</strong> , ce qui facilite l'obtention d'un effet synergique, par exemple en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">combinant Go et GWT</a> , en connectant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ANTLR</a> au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">projet</a> , en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">générant Go en fonction des descripteurs Protobuf</a> et même en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ajoutant du prétraitement</a> .  Tout cela peut être organisé manuellement via des fichiers batch, mais s'il existe des plugins officiellement pris en charge, il est plus rentable de les utiliser. </li><li>  Le projet devient facilement portable entre les machines et les plates-formes, et la commutation de la version GoSDK se fait en changeant une ligne. </li><li>  Facilité d'organisation des projets multi-modules, avec séparation du code source via le référentiel Maven. </li><li>  L'outil est familier aux développeurs Java, ce qui facilite leur adaptation lors du passage au développement sur Golang ou lors du développement de solutions Java Go + multilingues. </li><li>  Il existe la possibilité de pseudo-développement sur Go dans des environnements qui prennent en charge Maven, même s'ils ne prennent pas en charge cette plate-forme, par exemple, dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IDE NetBeans</a> . </li></ol><br><p>  Le plus gros inconvénient de la solution, à mon avis, en est un ici - un nombre limité de développeurs familiers avec Maven au sein de la communauté Golang.  Pour ceux qui sont passés à Golang avec C / C ++, il est clair qu'il est difficile de trouver quelque chose de plus proche et plus cher à faire, et personne n'a annulé les systèmes de construction Go «natifs».  J'ai remarqué que pour une raison quelconque, de nombreux développeurs n'aiment pas mélanger les plates-formes. </p><br><p>  J'ai donc brièvement montré l'une des façons d'utiliser Maven lors du développement de projets Go à l'aide du plugin mvn-golang-wrapper.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le projet de plugin est conçu comme un projet OSS et publié sur GitHub</a> .  Si quelqu'un est intéressé et utilisera dans ses projets, alors n'hésitez pas à poser des questions et à "signaler des bugs".  J'ai essayé de faire un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ensemble d'exemples pour différentes occasions</a> (sur lesquelles le plugin est testé), mais je ne peux pas tout couvrir. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les cas de test</a> dans le projet de plugin utilisent la version de développement, donc si vous voulez les construire localement après le clonage du projet, vous devez d'abord construire la version de développement du plugin en utilisant la commande dans le répertoire racine du projet: </p><br><pre> <code class="bash hljs">mvn install</code> </pre> <br><p>  après quoi, vous pouvez aller dans n'importe quel <code>mvn-golang-examples</code> et le construire avec </p><br><pre> <code class="bash hljs">mvn clean install</code> </pre> <br><p>  vous pouvez également commencer à construire tous les exemples à partir de la racine du projet, en utilisant </p><br><pre> <code class="bash hljs">mvn clean install -Pexamples</code> </pre> <br><p>  Le plugin prend en charge l'assemblage multi-thread de projets et il peut être accéléré en utilisant l'argument correspondant, se divisant par exemple en 6 threads </p><br><pre> <code class="bash hljs">mvn clean install -Pexamples -T6</code> </pre> <br><p>  Pendant le développement, le projet a accumulé une quantité décente de «cloches et sifflets», que j'ai décidé de ne pas couvrir dans ce court article.  Des informations sur les paramètres avec de petits exemples de configuration peuvent être trouvées dans la carte mentale de ce plugin (le fichier source au format <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SciaReto</a> est <a href="">ici</a> ): </p><br><p> <a href=""><img src="https://habrastorage.org/webt/ro/yo/qr/royoqrdlvvlrwvjyiey5yigtnec.jpeg" alt="image"></a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr465803/">https://habr.com/ru/post/fr465803/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr465791/index.html">Vulnérabilités des détaillants - trois cas où OTP a pu être obtenu dans la demande</a></li>
<li><a href="../fr465793/index.html">Frontend Weekly Digest (26 août - 1er septembre 2019)</a></li>
<li><a href="../fr465795/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 378 (26 août - 1er septembre 2019)</a></li>
<li><a href="../fr465797/index.html">Algorithmes génétiques (ou le client est toujours roi - et souvent un idiot)</a></li>
<li><a href="../fr465801/index.html">Food Design Digest, août 2019</a></li>
<li><a href="../fr465805/index.html">Gigatron - un micro-ordinateur fait maison sans processeur</a></li>
<li><a href="../fr465807/index.html">L'histoire de la façon dont la populaire bibliothèque JavaScript a commencé à afficher des annonces dans le terminal</a></li>
<li><a href="../fr465809/index.html">Ne tombez pas dans le piège de l'optimisation prématurée</a></li>
<li><a href="../fr465811/index.html">14 conseils pour écrire du code React propre. Partie 1</a></li>
<li><a href="../fr465813/index.html">14 conseils pour écrire du code React propre. 2e partie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>