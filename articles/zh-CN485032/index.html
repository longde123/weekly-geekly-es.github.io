<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖇️ 😯 🥞 如何通过状态共托管使React应用程序更快 🖕 ⛱️ 🍹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="这篇文章是关于状态 共置的 ，也就是说，关于状态的共置 ，这个术语也可以翻译成状态共置或状态共置 。 


 降低React应用程序速度的主要原因之一是其全局状态。 我将通过一个非常简单的应用程序示例来说明这一点，之后，我将给出一个更接近真实生活的示例。 


 这是一个简单的应用程序，您可以在其中...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>如何通过状态共托管使React应用程序更快</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485032/"><p>  <em>这篇文章是关于<strong>状态</strong> <strong>共置的</strong> ，也就是说，关于状态的<strong>共置</strong> ，这个术语也可以翻译成<strong>状态共置</strong>或<strong>状态共置</strong> 。</em> </p><br><p> 降低React应用程序速度的主要原因之一是其全局状态。 我将通过一个非常简单的应用程序示例来说明这一点，之后，我将给出一个更接近真实生活的示例。 </p><br><p> 这是一个简单的应用程序，您可以在其中输入狗的名字（如果窗口不起作用， <a href="https://uy9h3.csb.app/">则为链接</a> ）： </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>如果您使用此应用程序，很快就会发现它的运行非常缓慢。 与任何输入字段进行交互时，都会出现明显的性能问题。 在这种情况下，您可以使用<code>React.memo</code>形式的救生圈，并用慢速渲染将其包裹在所有组件中。 但是，让我们尝试以不同的方式解决这个问题。 </p><br><p> 这是此应用程序的代码： </p><a name="habracut"></a><br><pre> <code class="xml hljs">function sleep(time) { const done = Date.now() + time while (done &gt; Date.now()) { // ... } } //      // -       function SlowComponent({time, onChange}) { sleep(time) return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> Wow, that was{' '} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> onChange(Number(e.target.value))} /&gt; ms slow <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) } function DogName({time, dog, onChange}) { return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">htmlFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag">&gt;</span></span>Dog Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> onChange(e.target.value)} /&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {dog ? `${dog}'s favorite number is ${time}.` : 'enter a dog name'} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) } function App() { //   " " (global state) const [dog, setDog] = React.useState('') const [time, setTime] = React.useState(200) return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DogName</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dog</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{setDog}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SlowComponent</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{setTime}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) }</code> </pre> <br><p> 如果您尚未阅读有关<a href="https://kentcdodds.com/blog/colocation">托管</a>的文章（ <a href="https://kentcdodds.com/blog/colocation">托管</a> ），则建议您阅读。 知道共同托管可以使我们的应用程序更容易使用，让我们在处理状态时使用此原理。 </p><br><p> 请注意我们应用程序的代码，即<code>time</code>状态-它由我们应用程序的每个组件使用，因此将其提升（ <a href="https://ru.reactjs.org/docs/lifting-state-up.html">提升-提升状态</a> ）到<code>App</code>组件（包装整个应用程序的组件）。 但是，“ dog”状态（ <code>dog</code>和<code>setDog</code> ）仅由一个组件使用， <code>App</code>组件中不需要它，因此让我们将其移至<code>DogName</code>组件： </p><br><pre> <code class="xml hljs">function DogName({time}) { // <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span><span class="hljs-tag">    </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">const</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dog</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">setDog</span></span></span><span class="hljs-tag">] = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">React.useState(</span></span></span><span class="hljs-tag">'') // &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span><span class="hljs-tag">   </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">return</span></span></span><span class="hljs-tag"> ( &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">htmlFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag">&gt;</span></span>Dog Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> setDog(e.target.value)} /&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {dog ? `${dog}'s favorite number is ${time}.` : 'enter a dog name'} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) } function App() { //   " " (global state) const [time, setTime] = React.useState(200) return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DogName</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> /&gt;</span></span> // <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span><span class="hljs-tag">    &lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SlowComponent</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{setTime}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) }</code> </pre> <br><p> 这是我们的结果（如果窗口不起作用，请<a href="https://9nqld.csb.app/">链接</a> ）： </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p> 哇！ 现在输入名称的速度更快。 此外，由于位于同一位置，因此组件变得更易于维护。 但是为什么它能更快地工作呢？ </p><br><p> 他们说，快速做某事的最好方法是尽可能少地做某事。 这正是这里发生的事情。 当我们管理位于组件树顶部的状态时，此状态的每次更新都会使整个树无效。  React不知道发生了什么变化，因此，他必须检查所有组件以查看它们是否需要DOM更新。 此过程不是免费的，并且会消耗资源（尤其是如果您故意降低组件速度）。 但是，如果您将状态在组件树中移到尽可能低的位置（如我们对<code>dog</code>状态和<code>DogName</code>组件所做的<code>DogName</code> ，那么React将执行较少的检查。  React不会检查<code>SlowComponent</code>组件（我们故意使它变慢），因为React知道该组件仍然不会影响输出。 </p><br><p> 简而言之，在更早的时候，更改狗的名称时，会检查每个组件的更改（重新渲染）。 在对代码进行更改之后，React开始只检查<code>DogName</code>组件。 这大大提高了生产率！ </p><br><h2 id="v-realnoy-zhizni"> 在现实生活中 </h2><br><p> 我看到开发人员将Redux全局存储库或全局上下文中的内容放到了真正不应该是全局的位置。 上面示例中的<code>DogName</code>通常是发生性能问题的地方。 我经常看到与鼠标进行交互时（例如，在图形上方或数据表上方显示工具提示时）会出现此问题。 </p><br><p> 解决此问题的一种方法是“取消”用户交互（也就是说，我们等到用户停止键入，然后再应用状态更新）。 有时候，这是我们所能做到的最好的选择，但它可能导致不良的用户体验（未来的并发模式应将这样做的必要性降至最低。 <a href="https://youtu.be/nLF0n9SACd4%3Ft%3D181">请参见Dan Abramov的演示</a> ）。 </p><br><p> 开发人员经常使用的另一种解决方案是使用React救援渲染之一，例如<code>React.memo</code> 。 这将在我们牵强的示例中很好地工作，因为它允许React跳过<code>SlowComponent</code>的重新渲染，但实际上，应用程序可能会因为“千次切割的死亡”而遭受损失，因为在实际应用程序中，减速通常不是由于一个慢组件，并且由于许多组件的工作速度不够快，因此您必须在各处使用<code>React.memo</code> 。 完成此操作后，您将必须开始使用<code>useMemo</code>和<code>useCallback</code> ，否则您放入<code>React.memo</code>所有工作都是徒劳的。 这些动作可能解决了问题，但是它们明显增加了代码的复杂度，实际上，它们仍然比联合状态放置的效率低，因为React需要遍历每个组件（从顶部开始）以确定是否再次渲染它。 </p><br><p> 如果您想使用一个牵强一些的示例， <a href="https://codesandbox.io/s/colocate-state-ts1x9">请转到此处的codeandbox</a> 。 </p><br><h2 id="chto-takoe-sovmestnoe-razmeschenie-sostoyaniy"> 什么是主机代管？ </h2><br><p>  <a href="https://kentcdodds.com/blog/colocation">联合安置</a>的原则规定： </p><br><blockquote> 该代码应放置在尽可能靠近它所涉及的地方。 </blockquote><p> 因此，为了遵守此原则，我们的<code>dog</code>状态应<em>位于</em> <code>DogName</code>组件<em>内部</em> ： </p><br><pre> <code class="xml hljs">function DogName({time}) { const [dog, setDog] = React.useState('') return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">htmlFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag">&gt;</span></span>Dog Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> setDog(e.target.value)} /&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {dog ? `${dog}'s favorite number is ${time}.` : 'enter a dog name'} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) }</code> </pre> <br><p> 但是，如果我们将此组件分为几个组件怎么办？ 国家应该去哪里？ 答案是相同的：“尽可能靠近它所关联的地方”，这将是<strong>最接近的公共父级组件</strong> 。 作为示例，让我们分解<code>DogName</code>组件， <code>DogName</code>在不同的组件<code>p</code>显示<code>input</code>和<code>p</code> ： </p><br><pre> <code class="xml hljs">function DogName({time}) { const [dog, setDog] = React.useState('') return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DogInput</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dog</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{setDog}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DogFavoriteNumberDisplay</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{time}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dog</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ) } function DogInput({dog, onChange}) { return ( <span class="hljs-tag"><span class="hljs-tag">&lt;&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">htmlFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag">&gt;</span></span>Dog Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dog"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{dog}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{e</span></span></span><span class="hljs-tag"> =&gt;</span></span> onChange(e.target.value)} /&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;/&gt;</span></span> ) } function DogFavoriteNumberDisplay({time, dog}) { return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {dog ? `${dog}'s favorite number is ${time}.` : 'enter a dog name'} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> ) }</code> </pre> <br><p> 我们无法将状态移至<code>DogInput</code>组件，因为<code>DogFavoriteNumberDisplay</code>组件也需要访问该状态，因此我们从组件树的底部移至顶部，直到找到这两个组件的公共父级并在其中组织状态管理。 </p><br><p> 所有这些适用于需要在应用程序的特定屏幕上控制数十个组件的状态的情况。 如果需要，您甚至可以将此内容移到上下文中，以免进行<a href="https://kentcdodds.com/blog/prop-drilling">道具钻探</a> 。 但是，请使该上下文尽可能靠近其所属的位置，然后您将继续保持共享所提供的良好性能（和代码的可用性）。 请记住，您不需要将<em>所有</em>上下文都放在React应用程序的顶层。 将它们放在最有意义的位置。 </p><br><p> 这是我的其他文章<a href="https://kentcdodds.com/blog/application-state-management-with-react">React的应用程序状态管理</a>的主要思想。 使您的状态尽可能地靠近使用它们的地方，这将提高代码的性能和可用性。 使用这种方法，唯一可能使应用程序性能下降的是与接口元素的特别复杂的交互。 </p><br><h2 id="tak-chto-ispolzovat-konteksty-ili-redux"> 那么要使用什么，上下文还是Redux？ </h2><br><p> 如果您阅读了<a href="https://kentcdodds.com/blog/optimize-react-re-renders">“优化React重新渲染的一个简单技巧”</a> ，那么您会知道可以确保仅更新那些使用更改状态的组件。 这样，您可以解决此问题。 但是，使用编辑器时，人们仍然会遇到性能问题。 问题是<a href="https://react-redux.js.org/using-react-redux/connect-mapstate">React-Redux希望您遵循其建议，以避免不必要地渲染连接的组件</a> 。 总是有可能出错；您可能会无意中配置组件，以便在其他全局状态更改时，它们开始变得过于频繁。 而且，应用程序越大，其效果越负面，尤其是在向编辑器添加过多状态的情况下。 </p><br><p> 有一些方法可以帮助您避免这些问题，例如，使用<a href="https://blog.isquaredsoftware.com/2018/11/react-redux-history-implementation/"><code>memoized Reselect     mapState</code></a> ，或者阅读<a href="https://redux.js.org/faq">Editors文档以获取有关提高应用程序性能的更多信息</a> 。 </p><br><p> 值得注意的是，共同放置可以与编辑器一起应用。 仅将编辑器仅用于全局状态，对于其他所有状态，都使用同一位置。 编辑器的常见问题解答中有<a href="https://redux.js.org/faq/organizing-state">一些有用的规则，可帮助您确定状态应在编辑器中起作用还是应保留在组件中</a> 。 </p><br><p> 顺便说一句，如果您将状态划分为多个域（根据域使用多个上下文），那么问题将不那么明显。 </p><br><p> 但是事实仍然存在：状态的并置减少了性能问题并简化了代码维护。 </p><br><h2 id="prinimaem-reshenie-o-tom-kuda-pomestit-sostoyanie"> 决定放置状态 </h2><br><p> 决策树： </p><br><p><img src="https://habrastorage.org/webt/oj/z8/pt/ojz8ptwezz3qmxqicorsrsh1bku.jpeg" alt="陈述状态"></p><br><p> 文本版本，如果无法查看图片： </p><br><ul><li>  1我们开始开发应用程序。 转到2 </li><li>  2组件中的状态。 转到3 </li><li>  3条件是否<strong>仅由</strong>该组件使用？ <br><ul><li>  ?？ 我们去4 </li><li> 不行吗 此状态<strong>是否</strong>仅<strong>需要</strong> <em>一个</em>子组件？ </li><li>  ?？ 将其移动到此子组件（使用同一位置）。 我们去3。 </li><li> 不行吗 此状态是否需要父组件或相邻组件（“兄弟”组件，即同一父组件的子组件）？ <br><ul><li>  ?？ 将上面的状态移动到父组件。 转到3 </li><li> 不行吗 我们去4 </li></ul></li></ul></li><li>  4保持原样。 转到5 </li><li>  5螺旋钻有问题吗？ <br><ul><li>  ?？ 我们将此状态移到上下文提供程序，并在管理状态的组件中呈现此提供程序。 转到6 </li><li> 不行吗 转到6 </li></ul></li><li>  6我们发送申请。 出现新要求时，转到1 </li></ul><br><p> 重要的是，此过程应成为常规应用程序重构/维护过程的一部分。 如果您的病情没有在应引起的地方升高，则此状态将停止正常工作，并且您会注意到它。 但是，如果您不遵循状态共置方法，并且不降低组件层次结构中较低的状态，则您的应用程序将继续运行。 因此，您不会立即注意到将逐渐累积的性能和可管理性问题。 </p><br><h2 id="zaklyuchenie"> 结论 </h2><br><p> 通常，开发人员非常了解何时需要在必要时升高状态（“提升状态”），但是对于何时需要降低状态，我们的理解不是那么清楚。 我建议您看一下应用程序的代码，并考虑通过应用“共置位”原则可以在何处省略状态。 问问自己：“我需要编辑器中模式窗口的<code>isOpen</code>状态吗？”  （答案很可能是否）。 </p><br><p> 使用共置原则，您的代码将变得越来越容易。 </p><br><p> 祝你好运 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN485032/">https://habr.com/ru/post/zh-CN485032/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN485022/index.html">Playme Sigma：功能齐全且价格合理的DVR</a></li>
<li><a href="../zh-CN485024/index.html">什么是GraalVM编译器优化的内幕？</a></li>
<li><a href="../zh-CN485026/index.html">佐治亚州IT专业人员的机会</a></li>
<li><a href="../zh-CN485028/index.html">客户关系管理2020</a></li>
<li><a href="../zh-CN485030/index.html">现在排名前8位的IEO费用及其资本化</a></li>
<li><a href="../zh-CN485034/index.html">在Travis CI中自动在Windows上构建Qt项目</a></li>
<li><a href="../zh-CN485036/index.html">为什么需要关键分页的工具支持</a></li>
<li><a href="../zh-CN485042/index.html">由于强制性5G支持，配备Snapdragon 865的智能手机在2020年将变得更糟</a></li>
<li><a href="../zh-CN485046/index.html">如何规划成功的产品策略</a></li>
<li><a href="../zh-CN485050/index.html">超立方体。 我们如何为开发人员提供测试设备而又不会丢失它们</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>