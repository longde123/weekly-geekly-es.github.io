<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÇüèª ‚úä üï¥üèæ El algoritmo de interacci√≥n de cientos de miles de part√≠culas √∫nicas en la GPU, en GLES3 y WebGL2 ‚ö†Ô∏è üö¥üèª ‚úùÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Descripci√≥n del algoritmo l√≥gico y an√°lisis de un ejemplo de trabajo en forma de juego tecnodemo. 


 Versi√≥n WebGL2 de esta demostraci√≥n https://dani...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>El algoritmo de interacci√≥n de cientos de miles de part√≠culas √∫nicas en la GPU, en GLES3 y WebGL2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474676/"><h1 id="opisanie-algoritma-logiki-i-razbor-rabochego-primera-v-vide-tehno-demki-igry">  Descripci√≥n del algoritmo l√≥gico y an√°lisis de un ejemplo de trabajo en forma de juego tecnodemo. </h1><br><p>  Versi√≥n WebGL2 de esta demostraci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://danilw.itch.io/flat-maze-web para</a> otros enlaces, vea el art√≠culo. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/HawWnuMn1mc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3 id="statya-razbita-na-dve-chasti-snachala-pro-logiku-i-vtoraya-chast-pro-primenenie-v-igre-pervaya-chast">  El art√≠culo est√° dividido en dos partes, la primera sobre l√≥gica y la segunda sobre aplicaci√≥n en el juego, la <em>primera parte</em> : </h3><br><ul><li>  Caracter√≠sticas clave </li><li>  Enlaces y una breve descripci√≥n. </li><li>  El algoritmo de la l√≥gica. </li><li> Las limitaciones de la l√≥gica.  Errores / caracter√≠sticas y errores de √°ngulo. </li><li>  Acceso a los datos del √≠ndice. </li></ul><br><h3 id="dalshe-opisanie-igrovoy-demki-vtoraya-chast">  Descripci√≥n adicional de la demostraci√≥n del juego, la <em>segunda parte</em> : </h3><br><ul><li>  Caracter√≠sticas utilizadas de esta l√≥gica.  Y representaci√≥n r√°pida de un mill√≥n de part√≠culas de p√≠xeles. </li><li>  Implementaci√≥n, algunos comentarios sobre el c√≥digo, descripci√≥n de la colisi√≥n en dos direcciones.  E interacci√≥n con el jugador. </li><li>  Enlaces a gr√°ficos usados ‚Äã‚Äãcon opengameart y un sombreador para sombras.  Y el enlace del art√≠culo a cyberleninka.ru </li></ul><a name="habracut"></a><br><h1 id="chast-1">  Parte 1 </h1><br><h1 id="1-klyuchevye-osobennosti">  1. Caracter√≠sticas clave </h1><br><p> <strong>La idea</strong> es una colisi√≥n / f√≠sica de cientos de miles de part√≠culas entre s√≠, en tiempo real, donde cada part√≠cula tiene un identificador de identificaci√≥n √∫nico. </p><br><p>  Cuando se indexa cada part√≠cula, <strong>es posible controlar cualquier par√°metro de cualquier part√≠cula</strong> , por ejemplo, masa, su salud (hp) o da√±o, aceleraci√≥n, desaceleraci√≥n, qu√© objetos encontrar y reacciones al evento dependiendo del tipo / √≠ndice de la part√≠cula, tambi√©n temporizadores √∫nicos para cada part√≠cula , y as√≠ sucesivamente seg√∫n sea necesario. </p><br><p>  <strong>Toda la l√≥gica en GLSL es totalmente port√°til para cualquier motor de juego</strong> y cualquier sistema operativo que tenga soporte GLES3. </p><br><p>  <em>El n√∫mero m√°ximo de part√≠culas</em> es igual al tama√±o del framebuffer (fbo, todos los p√≠xeles). </p><br><p>  <em>Un n√∫mero c√≥modo de part√≠culas</em> (cuando hay espacio para que las part√≠culas interact√∫en) es <code>(Resolution.x*Resolution.y/2)/2</code> es cada segundo p√≠xel en <code>x</code> cada segundo p√≠xel en <code>y</code> , por eso la descripci√≥n l√≥gica lo dice. </p><br><p>  La primera parte del art√≠culo muestra la l√≥gica m√≠nima; en la segunda, usando el ejemplo de un juego, l√≥gica con una gran cantidad de condiciones de interacci√≥n. </p><br><h1 id="2-ssylki-i-kratkoe-opisanie">  2. Enlaces y breve descripci√≥n </h1><br><p>  Hice tres demos sobre esta l√≥gica: </p><br><p>  <strong>1. En fragment-shader GLSL</strong> , en shadowrtoy <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.shadertoy.com/view/tstSz7</a> , vea el c√≥digo BufferC en √©l toda la l√≥gica.  Este c√≥digo tambi√©n le permite mostrar cientos de miles de part√≠culas con su UV, en una posici√≥n arbitraria, en un sombreador de fragmentos sin usar part√≠culas instantaneas. </p><br><p><img src="https://habrastorage.org/webt/8a/-w/l7/8a-wl7z8v954zwdyxqaph8eusao.png"></p><br><p>  <strong>2. L√≥gica de portabilidad a part√≠culas instanciadas</strong> (utilizada por Godot como motor) </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/fRu9PA4XHPQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Enlaces <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Versi√≥n web</a> , <a href="">exe (win)</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fuentes del</a> proyecto <em>part√≠culas_2D_self_collision</em> . </p><br><p>  Breve descripci√≥n: <strong>esta es una mala demostraci√≥n de</strong> part√≠culas instantaneas, debido al hecho de que realizo el aumento m√°ximo donde se ve todo el mapa, siempre se procesan 640x360 part√≠culas (230k), esto es mucho.  <strong>Ver m√°s abajo en la descripci√≥n del juego, all√≠ lo hice bien, sin part√≠culas adicionales.</strong>  (hay un error de √≠ndice de part√≠culas en el video, esto se corrige en el c√≥digo) </p><br><p>  <strong>3. El juego, sobre esto a continuaci√≥n en la descripci√≥n del juego.</strong>  Enlaces <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Versi√≥n web</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">exe (win)</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fuentes</a> </p><br><h1 id="3-algoritm-raboty-logiki">  3. El algoritmo de la l√≥gica. </h1><br><p>  Brevemente: </p><br><p>  La l√≥gica es similar a la ca√≠da de arena, cada p√≠xel conserva el valor fraccional de la posici√≥n (desplazamiento dentro de su p√≠xel) y la aceleraci√≥n actual. </p><br><p>  La l√≥gica verifica los p√≠xeles en el radio 1, que su pr√≥xima posici√≥n quiere ir a este p√≠xel <em>(debido a esta restricci√≥n, vea las restricciones a continuaci√≥n)</em> , tambi√©n los p√≠xeles en el radio 2 para repulsi√≥n (colisi√≥n). </p><br><p>  El √≠ndice √∫nico se guarda traduciendo la l√≥gica a int-float y reduciendo el tama√±o para la posici√≥n de posici√≥n dada y la velocidad <code>pos</code> . </p><br><p>  Los datos se almacenan de esta manera: <em>(debido a este error, ver restricciones)</em> </p><br><pre> <code class="plaintext hljs">pixel.rgba r=[0xfffff-posx, 0xf-data] g=[0xfffff-posy, 0xf-data] b=[0xffff-velx, 0xff-data] a=[0xffff-vely, 0xff-data]</code> </pre> <br><p><img src="https://habrastorage.org/webt/46/ad/io/46adionlolw3vm5zfry5javhgxk.png"></p><br><p>  <strong>En el c√≥digo</strong> , n√∫meros de l√≠nea para BufC <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.shadertoy.com/view/tstSz7</a> , 115 comprobaci√≥n de transici√≥n, 139 comprobaciones de colisi√≥n. </p><br><p>  Estos son bucles simples para tomar valores adyacentes.  Y la condici√≥n es que, si la posici√≥n se toma igual a la posici√≥n del p√≠xel actual, entonces movemos esos datos a este p√≠xel <em>(debido a esta restricci√≥n)</em> , y el valor de <code>vel</code> cambia dependiendo de los p√≠xeles vecinos, si los hay. </p><br><p>  <em>Todo esto es l√≥gica de part√≠culas.</em> </p><br><p>  <strong>Es mejor colocar las part√≠culas a una distancia de 1 p√≠xel entre s√≠</strong> si est√°n m√°s cerca de 1 p√≠xel, entonces habr√° repulsi√≥n, como un mapa con un laberinto en el juego, las part√≠culas se colocan en sus lugares sin moverse debido a una distancia de 1 p√≠xel entre ellas. </p><br><p>  Luego viene el renderizado (renderizado), <em>en el caso del sombreador de fragmentos, los</em> p√≠xeles se toman en un radio de 1 para mostrar las √°reas que se cruzan.  <em>En el caso de part√≠culas instanciadas,</em> se toma <em>un</em> p√≠xel en la direcci√≥n <code>INSTANCE_ID</code> traducido de una vista lineal a una matriz bidimensional. </p><br><h1 id="4-ogranicheniya-logiki-bagiosobennosti-i-bagi-angle">  4. Limitaciones de la l√≥gica.  Errores / caracter√≠sticas y errores ANGLE </h1><br><ol><li>  <strong>El tama√±o de p√≠xel</strong> , <code>BALL_SIZE</code> en el c√≥digo, debe estar dentro de los l√≠mites para el c√°lculo, mayor que <code>sqrt(2)/2</code> y menor que <code>1</code> .  Cuanto m√°s cerca de 1, menos espacio para caminar dentro del p√≠xel (el p√≠xel mismo), menos espacio hay.  Tal tama√±o es necesario para que los p√≠xeles no caigan entre s√≠, se puede establecer menos de 1 cuando tiene objetos peque√±os, se crea una ilusi√≥n de objetos de menos de 1 p√≠xel (calculado). </li><li>  <strong>La velocidad</strong> no puede ser superior a <code>1</code> p√≠xel; de lo contrario, los p√≠xeles desaparecer√°n.  Pero para tener una velocidad de m√°s de <code>1</code> por cuadro, puede hacerlo, si realiza varios <em>framebuffer (fbo / viewport)</em> y procesa varios pasos l√≥gicos por velocidad de cuadro, aumentar√° la cantidad de veces igual al n√∫mero de fbo adicional.  Esto es lo que hice en la demostraci√≥n de frutas, y usando el enlace a shadowrtoy (bufC copiado a bufD). </li><li>  <strong>Limitaci√≥n de presi√≥n</strong> (como gravedad u otro mapa de fuerza normal).  Si varios p√≠xeles vecinos toman la posici√≥n de esto (vea la imagen de arriba), entonces solo se guarda uno, los p√≠xeles restantes desaparecen.  <em>Esto es f√°cil de notar en la demostraci√≥n en shadowrtoy,</em> configure el mouse en Force, cambie el valor de <code>MOUSE_F</code> en <em>com√∫n</em> a <code>10</code> y dirija las part√≠culas a la esquina de la pantalla, desaparecer√°n una en la otra.  O lo mismo con el valor de gravedad <code>maxG</code> en <em>com√∫n</em> . </li><li>  <strong>Error en √°ngulo.</strong>  Para que esta l√≥gica funcione en las part√≠culas de GPU (instanciadas), es mejor (m√°s barato, m√°s r√°pido) calcular la posici√≥n y todos los dem√°s par√°metros de part√≠culas para mostrar, por <em>ejemplo, sombreador</em> .  Pero Angle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">no permite el</a> uso de m√°s de una textura fbo para un sombreador, por lo que el c√°lculo de parte de la l√≥gica debe transferirse al <em>sombreador de v√©rtices</em> donde transferir el n√∫mero de √≠ndice del sombreador de instancia.  Esto es lo que hice en ambas demostraciones con part√≠culas de GPU. </li><li>  <strong>Un error grave</strong> en ambas demostraciones (excepto en el juego) el valor de posici√≥n se perder√° si no es un m√∫ltiplo de <code>1/0xfffff</code> prueba de error est√° aqu√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.shadertoy.com/view/WdtSWS</a> <br>  M√°s precisamente, esto no es un error, y deber√≠a ser as√≠, por simplicidad, como parte de este algoritmo, lo llam√© un error. </li></ol><br><p>  <strong>Fix bug:</strong> <br>  <em>No convierta el valor de posici√≥n en int-float</em> , debido a esto <code>0xff</code> desaparecer√°, 8 bits disponibles para datos, pero el valor <code>0xffff</code> para datos permanecer√°, lo que puede ser suficiente para muchas cosas. <br>  <em>Hice exactamente eso en la demostraci√≥n del juego</em> , uso solo <code>0xffff</code> para los datos donde se almacenan el tipo de part√≠cula, el temporizador de animaci√≥n, la salud y todav√≠a hay espacio libre. </p><br><h1 id="5-dostup-k-dannym-po-indeksu">  5. Acceso a los datos del √≠ndice. </h1><br><p>  instancia-part√≠cula tiene su propio <code>INSTANCE_ID</code> , toma un p√≠xel de la textura del framebuffer con l√≥gica de part√≠culas (bufC, ejemplo para sombreador), si all√≠ desempaquetamos el <em>ID de</em> la part√≠cula (ver almacenamiento de datos) <em>de esta part√≠cula</em> , en <em>este ID</em> leemos la textura con los datos de las part√≠culas (bufB , un ejemplo en un sombreador). </p><br><p>  En el ejemplo de shadowtyy, bufB almacena solo el color de cada part√≠cula, pero es obvio que puede haber datos, como masa, aceleraci√≥n, desaceleraci√≥n, escritos anteriormente, as√≠ como acciones l√≥gicas (por ejemplo, puede mover cualquier part√≠cula a cualquier posici√≥n (teletransporte) si est√° hecho acci√≥n l√≥gica correspondiente en el c√≥digo), tambi√©n puede controlar el movimiento de cualquier part√≠cula o grupo desde el teclado ... </p><br><p>  <strong>Quiero decir que puedes hacer cualquier cosa con cada una de las part√≠culas como si fueran part√≠culas ordinarias en una matriz en el procesador, el acceso bidireccional desde la part√≠cula de la GPU puede cambiar su estado, pero tambi√©n desde la CPU puedes cambiar el estado de la part√≠cula por √≠ndice (usando acciones l√≥gicas y textura buffer de datos).</strong> </p><br><h1 id="chast-2">  Parte 2 </h1><br><h1 id="1-ispolzuemye-vozmozhnosti-etoy-logiki-i-bystryy-rendering-milliona-chastic-pikseley">  1. Caracter√≠sticas utilizadas de esta l√≥gica.  Y r√°pido renderizado de un mill√≥n de part√≠culas de p√≠xeles </h1><br><p>  El tama√±o del framebuffer (fbo / viewport) para part√≠culas es 1280x720, las partes se encuentran despu√©s de 1, esto es 230 mil part√≠culas activas (elementos activos en el laberinto). <br>  <em>Siempre hay no m√°s de 12 mil part√≠culas instaladas en GPU en la pantalla.</em> </p><br><p>  <strong>Usos l√≥gicos:</strong> </p><br><ul><li>  La l√≥gica del jugador es independiente de la l√≥gica de part√≠culas, y solo lee datos del b√∫fer de part√≠culas. </li><li>  El jugador se ralentiza cuando choca con objetos. </li><li>  Los objetos de tipo monstruo infligen da√±o al jugador. </li><li>  El jugador tiene 2 ataques, uno repele todo, el segundo crea part√≠culas como <em>bola de fuego</em> (la imagen es esta) </li><li>  El tipo de <em>bola de fuego</em> tiene su propia masa, y funciona el seguimiento bilateral de colisiones con otras part√≠culas. </li><li>  otras part√≠culas, como el <em>lanzamiento</em> y los <em>zombis</em> (un tipo de lanzamiento es invulnerable) se destruyen en una colisi√≥n con una <em>bola de fuego</em> </li><li>  <em>bola de fuego</em> se apaga despu√©s de una colisi√≥n </li><li>  Niveles de <em>f√≠sica</em> : el jugador repele √°rboles y cuadrados, otras part√≠culas no interact√∫an, ninguna aceleraci√≥n act√∫a sobre la <em>bola de fuego</em> </li><li>  los temporizadores de animaci√≥n son √∫nicos para cada part√≠cula </li></ul><br><p>  En comparaci√≥n con la demostraci√≥n de frutas, donde hay gastos generales, <strong>en este juego el n√∫mero de part√≠culas instaladas en GPU es de solo 12 mil.</strong> </p><br><p>  Se ve as√≠: </p><br><p><img src="https://habrastorage.org/webt/lk/kt/9-/lkkt9-59aoftj47pqbpy4q5anfk.png"></p><br><p>  Su n√∫mero depende del zoom actual ( <em>zoom</em> ) del mapa, y el aumento se limita a un cierto valor, por lo que solo se consideran aquellos que son visibles en la pantalla. <br>  La pantalla cambia con el jugador, la l√≥gica para calcular los cambios es un poco compleja y muy situacional, dudo que encuentre aplicaci√≥n en otro proyecto. </p><br><h1 id="2-realizaciya-nemnogo-kommentariev-k-kodu">  2. Implementaci√≥n, algunos comentarios sobre el c√≥digo. </h1><br><p>  Todo el c√≥digo del juego est√° en la GPU. </p><br><p>  <strong>La l√≥gica para calcular el desplazamiento de part√≠culas</strong> en una pantalla con un aumento en la funci√≥n de <em>v√©rtice</em> en el archivo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">/shaders/scene2/particle_logic2.shader</a> es un archivo de sombreador de part√≠culas (v√©rtice y fragmento), no un sombreador instanciado, un sombreador instanciado no hace nada, solo pasa su √≠ndice debido a error descrito anteriormente. </p><br><p>  <strong>part√≠culas por tipo</strong> y toda la l√≥gica de la interacci√≥n de part√≠culas en un archivo, este es un archivo de un sombreador de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">marco</a> sombreador de archivos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sombreadores / escena2 / part√≠culas_fbo_logic.shader</a> </p><br><pre> <code class="plaintext hljs">// 1-2 ghost // 3-zombi // 4-18 blocks // +20 is on fire // 40 is bullet(right) 41 left 42 top 43 down</code> </pre> <br><p>  p√≠xel de <strong>almacenamiento de datos</strong> <code>[pos.x, pos.y, [0xffff-vel.x, 0xff-data1],[0xffff-vel.y, 0xff-data2]]</code> <br>  data1 es un tipo, data2 es un HP o temporizador. </p><br><p>  <em>El temporizador va en cuadros en cada part√≠cula</em> , el valor m√°ximo del temporizador es 255, no necesito tanto, uso solo 1-16 m√°ximo ( <code>0xf</code> ), y <code>0xf</code> permanece sin usar donde, por ejemplo, puede almacenar el valor real de HP, no se usa para m√≠.  (es decir, s√≠, <strong>uso <code>0xff</code> para el temporizador</strong> , pero de hecho solo tengo menos de 16 cuadros de animaci√≥n, y <code>0xf</code> suficiente, pero no necesitaba datos adicionales) <br>  En realidad, <code>0xff</code> solo <code>0xff</code> usa en el temporizador de √°rboles en llamas, se convierten en zombies despu√©s de 255 fotogramas.  La l√≥gica del temporizador est√° parcialmente en <code>type_hp_logic</code> en el sombreador de framebuffer de part√≠culas (enlace de arriba). </p><br><h1 id="primer-raboty-kollizii-v-dve-storony-kogda-fireball-gasnet-pri-pervom-udare-i-obekt-s-kotorym-byl-udar-tozhe-vypolnyaet-svoe-deystvie">  <strong>Un ejemplo de una operaci√≥n de colisi√≥n bidireccional</strong> cuando una <em>bola de fuego</em> se apaga en el primer golpe, y el objeto con el que fue golpeado tambi√©n realiza su acci√≥n. </h1><br><p>  File <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">shaders / scene2 / roots_fbo_logic.shader</a> line 438: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((real_index == <span class="hljs-number"><span class="hljs-number">40</span></span>) || (real_index == <span class="hljs-number"><span class="hljs-number">41</span></span>) || (real_index == <span class="hljs-number"><span class="hljs-number">42</span></span>) || (real_index == <span class="hljs-number"><span class="hljs-number">43</span></span>)) &amp;&amp; (type_hp.y &gt; <span class="hljs-number"><span class="hljs-number">22</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h_id = get_id(fragCoord + vec2(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(x), <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(y))); ivec2 htype_hp = unpack_type_hp(h_id); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hreal_index = htype_hp.x; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((hreal_index != <span class="hljs-number"><span class="hljs-number">40</span></span>) &amp;&amp; (hreal_index != <span class="hljs-number"><span class="hljs-number">41</span></span>) &amp;&amp; (hreal_index != <span class="hljs-number"><span class="hljs-number">42</span></span>) &amp;&amp; (hreal_index != <span class="hljs-number"><span class="hljs-number">43</span></span>)) type_hp.y = <span class="hljs-number"><span class="hljs-number">22</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!need_upd) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h_id = get_id(fragCoord + vec2(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(x), <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(y))); ivec2 htype_hp = unpack_type_hp(h_id); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hreal_index = htype_hp.x; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((hreal_index == <span class="hljs-number"><span class="hljs-number">40</span></span>) || (hreal_index == <span class="hljs-number"><span class="hljs-number">41</span></span>) || (hreal_index == <span class="hljs-number"><span class="hljs-number">42</span></span>) || (hreal_index == <span class="hljs-number"><span class="hljs-number">43</span></span>)) &amp;&amp; (htype_hp.y &gt; <span class="hljs-number"><span class="hljs-number">22</span></span>)) { need_upd = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } }</code> </pre> <br><p>  <code>real_index</code> es un tipo, los tipos se enumeran arriba, 40-43 es una <em>bola de fuego</em> . <br>  Adem√°s <code>type_hp.y &gt; 22</code> es el valor del temporizador, si es mayor que 22, entonces la <em>bola de fuego</em> no encontr√≥ nada. <br>  <code>h_id = get_id(...</code> toma el valor del tipo y HP (temporizador) de la part√≠cula encontrada <br>  <code>hreal_index != 40...</code> tipo ignorado (otra <em>bola de fuego</em> ) <br>  <code>type_hp.y = 22</code> un temporizador se establece en 22, este es un indicador de que esta <em>bola de fuego</em> colision√≥ con un objeto. <br>  <code>else { if (!need_upd)</code> variable need_upd comprueba que no hay colisiones repetidas, ya que la funci√≥n est√° en un bucle, nos encontramos con una <em>bola de fuego</em> . <br>  <code>h_id = get_id(...</code> si a√∫n no hubo una colisi√≥n, tomamos un objeto de tipo y temporizador. <br>  <code>hreal_index == 40...htype_hp.y &gt; 22</code> que el objeto de colisi√≥n es <em>bola de fuego</em> y no se apaga. <br>  <code>need_upd = true</code> indicador de que es necesario actualizar el tipo ya que encontr√≥ una <em>bola de fuego</em> . </p><br><p>  m√°s l√≠nea 481 <br>  <code>if((need_upd)&amp;&amp;(real_index&lt;24)){</code> real_index &lt;24 por tipo menos de 24 hay √°rboles de zombis y fantasmas que no se queman, y luego, en esta condici√≥n, actualizamos el tipo dependiendo del tipo actual. </p><br><p>  Por lo tanto, se puede hacer casi cualquier interacci√≥n de objetos. </p><br><h1 id="vzaimodeystvie-s-igrokom">  <strong>Interacci√≥n con el jugador:</strong> </h1><br><p>  File <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">shaders / scene2 / logic.shader</a> line 143 function <code>player_collision</code> </p><br><p>  Esta l√≥gica lee los p√≠xeles que rodean al jugador en un radio de 4x4 p√≠xeles, toma la posici√≥n de cada uno de los p√≠xeles y lo compara con la posici√≥n del jugador, si se encuentra un elemento, entonces la verificaci√≥n de tipo es la siguiente, si este es un monstruo, tomamos HP del jugador. </p><br><p>  <em>Esto funciona un poco impreciso y no quer√≠a solucionarlo</em> , esta funci√≥n se puede hacer m√°s precisa. </p><br><p>  <strong>Las part√≠culas se alejan del jugador y el efecto de repulsi√≥n durante un ataque:</strong> </p><br><p>  Un framebuffer (viewport) se usa para escribir lo normal de las acciones actuales, y las part√≠culas ( <em>cells_fbo_logic.shader</em> ) toman esta textura (de lo normal) en su posici√≥n y aplican el valor a su velocidad y posici√≥n.  El c√≥digo completo de esta l√≥gica es literalmente solo un par de l√≠neas, archivo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">force_collision.shader</a> </p><br><p>  <strong>Al hacer clic con el bot√≥n izquierdo del mouse, vuelan los proyectiles de</strong> <em>bola de fuego</em> <strong>;</strong> su apariencia <em>no</em> es <em>muy natural</em> , no se corrigieron y se fueron de esta forma. </p><br><p>  Puedes hacer una zona normal (forma) para generar part√≠culas con un cambio que aparece en relaci√≥n con el jugador (esto no se hace). <br>  O puede hacer que la <em>bola de fuego sea un</em> objeto separado como jugador y dibujar normal en un b√∫fer para alejar las part√≠culas de la <em>bola de fuego</em> , es decir, por analog√≠a con el jugador ... <br>  ¬øQui√©n necesita pensar que lo resolver√°n por s√≠ mismos? </p><br><h1 id="3-ssylki-na-ispolzuemuyu-grafiku-s-opengameart-i-sheyder-teney">  3. Enlaces a los gr√°ficos utilizados con opengameart y el sombreador de sombras </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Me dieron un enlace a un art√≠culo en cyberleninka.ru</strong></a> <br>  En la descripci√≥n del algoritmo que utilic√©, quiz√°s <em>haya una descripci√≥n m√°s detallada y correcta</em> que en este, mi art√≠culo. </p><br><p>  <strong>El sombreador de sombras</strong> funciona de manera muy simple, basado en este sombreador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.shadertoy.com/view/XsK3RR</a> (tengo un c√≥digo modificado) <br>  Shader construye un <em>mapa de luz radial 1D</em> </p><br><p><img src="https://habrastorage.org/webt/e2/rh/op/e2rhopezigurqa3rkvhrb44vxxw.png"></p><br><p>  y sombreado en el c√≥digo de pintura del piso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">shaders / scene2 / mainImage.shader</a> </p><br><p>  <strong>Enlaces a los gr√°ficos utilizados</strong> , todos los gr√°ficos del juego desde el sitio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://opengameart.org</a> <br>  <em>bola de fuego</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://opengameart.org/content/animated-traps-and-obstacles</a> <br>  personaje <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://opengameart.org/content/legend-of-faune</a> <br>  √°rboles y bloques <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://opengameart.org/content/lolly-set-01</a> <br>  (y un par de fotos m√°s con opengameart) </p><br><p>  <strong>Los gr√°ficos en el men√∫ fueron</strong> obtenidos por el sombreador 2D_GI, una utilidad para crear tales men√∫s: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/HTuG5UOMC74" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Quien ley√≥ hasta el final - bien hecho :) <br>  Si tiene preguntas, pregunte, puedo complementar la descripci√≥n a pedido. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/474676/">https://habr.com/ru/post/474676/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../474664/index.html">Para aumentar la atenci√≥n, nuestro cerebro no aumenta la concentraci√≥n, sino que usa filtros de informaci√≥n</a></li>
<li><a href="../474666/index.html">C√≥mo no reescribir un proyecto en Rust</a></li>
<li><a href="../474668/index.html">Acciones de GitHub como CI / CD para un sitio en un generador est√°tico y p√°ginas de GitHub</a></li>
<li><a href="../474672/index.html">React, JSX, importaci√≥n de m√≥dulos ES (incluido din√°mico) en un navegador sin Webpack</a></li>
<li><a href="../474674/index.html">Visi√≥n artificial y medicina</a></li>
<li><a href="../474678/index.html">Khronos Group ha creado un repositorio unificado con ejemplos de Vulkan</a></li>
<li><a href="../474680/index.html">AI y 2048. Parte 2: recorte de Minimax + alfa beta</a></li>
<li><a href="../474686/index.html">Fant√°stica historia "Salvaci√≥n" (10 min.)</a></li>
<li><a href="../474688/index.html">Tren retro con una locomotora de vapor</a></li>
<li><a href="../474690/index.html">Crear una consola con una altura variable para un trabajo m√°s conveniente en una computadora</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>