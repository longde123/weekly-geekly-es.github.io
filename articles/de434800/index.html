<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚§¥Ô∏è üè¥‚Äç‚ò†Ô∏è üöÉ (5-2) M√∂glichkeiten zum Migrieren einer gro√üen SQL-Tabelle üë®‚Äçüë¶‚Äçüë¶ üé£ ‚ö†Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einf√ºhrung 
 Hallo allerseits! Dies ist mein erster Artikel und ich schreibe ihn im Auftrag eines Junior Development Engineer in C #. Es wird also kei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>(5-2) M√∂glichkeiten zum Migrieren einer gro√üen SQL-Tabelle</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434800/"><h3>  Einf√ºhrung </h3><br>  Hallo allerseits!  Dies ist mein erster Artikel und ich schreibe ihn im Auftrag eines Junior Development Engineer in C #.  Es wird also keine detaillierten Informationen √ºber SQL geben, sondern nur praktische Informationen und Gedanken zur L√∂sung eines eher nicht offensichtlichen Problems, mit dem ich f√ºr dieselben Neulinge wie mich konfrontiert war. <br><br>  Zun√§chst werde ich die Formulierung meines Problems als Beispiel beschreiben, in dem es wirklich notwendig ist, einen gro√üen Tisch zu verschieben. <br><br>  Angenommen, Sie haben einen Webdienst und eine SQL-Datenbank (MS-SQL) mit einer Tabelle mit HTML-Buchstaben, die Ihr Dienst an Benutzer sendet.  Briefe werden mehrere Jahre gespeichert und k√∂nnen nicht gel√∂scht werden, da sie zum Sammeln von Statistiken und Analysen ben√∂tigt werden.  Jedes Jahr w√§chst jedoch die Anzahl der Buchstaben, die Datenbank w√§chst und der Speicherplatz auf dem SQL Server wird kleiner (in unserem Fall war ein weiterer Faktor die Wiederherstellung der Datenbank auf dem Teststandort, da ihre Zeit proportional zunahm), und dies muss getan werden tun.  Gl√ºcklicherweise gibt es in unserem Fall einen freien Server mit viel freiem Speicherplatz (in Wirklichkeit ist dies m√∂glicherweise nicht der Fall, und dies ist nat√ºrlich eine vor√ºbergehende L√∂sung, die jedoch den Rahmen des Artikels sprengt).  Das Problem bestand also darin, einen gro√üen Tisch zu bewegen (und ‚Äûgro√ü‚Äú zu sagen, ich meine einen wirklich gro√üen Tisch. Alles, was ich bei der Suche nach √§hnlichen L√∂sungen sah, lag im Bereich von 60 bis 100 GB, in unserem Fall wog der Tisch mehr als 300 GB). <br><br>  Wir werden verschiedene M√∂glichkeiten zur L√∂sung dieses Problems in Betracht ziehen, aber nicht alle beziehen sich auf die √úbertragung des Server-Server-Typs.  Manchmal kann es erforderlich sein, eine Tabelle zwischen Datenbanken auf demselben Server zu √ºbertragen.  Au√üerdem sind einige Methoden rein theoretisch, ich habe sie nicht alle in der Praxis getestet, aber sie sollten wahrscheinlich funktionieren. <br><a name="habracut"></a><br><h3>  Methode -1.  Daten </h3><br>  Egal wie offensichtlich es klingt, Sie sollten wissen, welche Daten Sie √ºbertragen werden.  In den meisten F√§llen werden Daten nicht optimal gespeichert, und es k√∂nnen auch √ºbersch√ºssige Informationen gespeichert werden.  In Ihrem speziellen Fall k√∂nnen Sie wahrscheinlich auf die √úbertragung aller Daten verzichten. <br><br>  Erstens kann das L√∂schen einer Spalte wahrscheinlich hilfreich sein. Dies ist jedoch ein Blockierungsvorgang, und es ist nicht immer m√∂glich, einen Webdienst zu stoppen.  Und auf Habr√© gibt es einen Artikel, in dem erkl√§rt wird, wie es durchgef√ºhrt werden kann. <br><br>  Zweitens vergessen Sie nicht die Normalisierung.  M√∂glicherweise k√∂nnen einige Daten in das W√∂rterbuch √ºbertragen werden (bei Briefen konnten nicht die Buchstabenk√∂rper, sondern Vorlagen mit den dort eingef√ºgten Daten gespeichert werden), und nur die ID dieser Elemente konnte in einer gro√üen Tabelle gespeichert werden. Dadurch kann viel Platz f√ºr Sie frei werden. <br><br><h3>  Methode 0. SELECT INTO </h3><br>  Witz =) Du kannst dir also nur eine Basis setzen.  Wenn es sich jedoch um die geringe Gr√∂√üe der Tabelle handelt (was machen Sie dann hier), k√∂nnen Sie versuchen, die Datenbank mithilfe dieser Anweisung zu √ºbertragen.  Wenn Sie eine Testbasis haben, k√∂nnen Sie auch ein Experiment durchf√ºhren, um die Gesamt√ºbertragungszeit mit dieser Methode "auf der Stirn" zu bewerten. <br><br><h3>  Methode 1. Sicherung </h3><br>  Der ‚Äûkanonischste‚Äú Weg war dies, der zur L√∂sung meines Problems wurde.  Wir machen eine Sicherung der Datenbank, die unsere Tabelle enth√§lt, und stellen sie auf einem anderen Server wieder her und l√∂schen sie von allem Unn√∂tigen.  Wenn es m√∂glich ist, den Webdienst zu stoppen, k√∂nnen Sie ihn erneut bereitstellen, indem Sie den Datensatz in der √ºbertragenen Tabelle einrichten und das alte <b>* *</b> l√∂schen (hier kann es h√∂chstwahrscheinlich einen Moment dauern, bis Abfragen mit Verkn√ºpfungen an ihn geschrieben werden m√ºssen, damit Google Google SQL verkn√ºpft). Server).  Wenn dies nicht m√∂glich ist, korrigieren wir die ID des letzten Buchstabens (zur Synchronisation), dann m√ºssen wir <b>*</b> alle √ºbertragenen Buchstaben l√∂schen (wir werden weiterhin in die alte Tabelle schreiben). <br><br>  <b>*</b> Wenn Sie ein separates Gespr√§chsthema entfernen, scheint es viel schneller zu sein als das √úbertragen. Dies ist jedoch nicht der Fall. Im Allgemeinen empfehle ich, es in Teilen zu l√∂schen. <br><br><h3>  Methode 2: MS-SQL Management Studio </h3><br>  Wenn Sie √ºber dieses Studio verf√ºgen, k√∂nnen Sie versuchen, das integrierte Tool zum Exportieren und Importieren von Daten zu verwenden.  Pers√∂nlich habe ich beim Stapel√ºberlauf gelesen, dass dieses Ding an einem 60-Gig-Tisch hing und kein Risiko einging. <br><br><h3>  Methode 3. Partition </h3><br>  Verbesserte Stirnmethode.  Die Idee ist, Daten auf √ºbliche Weise mit einem Timer zwischen den Iterationen zu √ºbertragen.  Sie unterteilen alle Zeilen in Portionen (z. B. jeweils 100.000), √ºbertragen die Portion (und k√∂nnen sie sofort l√∂schen, sind sich aber nicht sicher, wie sicher sie ist), schlafen dann ein und so weiter bis zum bitteren Ende.  Es ist besser, vom Ende zu √ºbertragen, damit Sie am Ende keine Daten synchronisieren m√ºssen.  Die Methode ist offensichtlich sehr langsam, aber auf diese Weise √ºbertragen Sie alles, ohne den Webdienst zu stoppen.  H√∂chstwahrscheinlich ist es bequemer, es nicht mit einem SQL-Skript, sondern mit Hilfe eines ORM zu implementieren. <br><br><h3>  Zusammenfassung </h3><br>  Das √úbertragen einer gro√üen Datenmenge dauert immer eine gewisse Zeit, und Sie sollten darauf vorbereitet sein.  Es gibt keine magische M√∂glichkeit, Ihr Problem sofort zu l√∂sen.  In jedem Fall m√ºssen Sie auf Ihren Volumes und Einschr√§nkungen aufbauen.  Wenn keine der Methoden f√ºr Sie funktioniert, pr√ºfen Sie, ob Sie eine Kombination davon verwenden k√∂nnen. <br><br>  Am Ende m√∂chte ich 2 wichtige Punkte hinzuf√ºgen. <br><br>  Jeder Prozess zum √úbertragen / L√∂schen von Zeilen in SQL wird im Transaktionsprotokoll protokolliert, damit im Fehlerfall alles zur√ºckgesetzt werden kann (ich habe zuvor angenommen, dass dies nur im Rahmen einer Transaktion ausgef√ºhrt wird).  Dar√ºber hinaus ist die Gr√∂√üe des Protokolls sogar etwas gr√∂√üer als die Datenmenge.  Stellen Sie sicher, dass Sie √ºber den erforderlichen Speicherplatz verf√ºgen, oder deaktivieren Sie die Protokollierung. Dies ist jedoch nicht sicher. <br><br>  Vor dem √úbertragen m√ºssen Sie sicherstellen, dass die Datendatei und die Protokolldatei die richtige Gr√∂√üe haben, da  Erweiterungsvorg√§nge nehmen viel Zeit in Anspruch und konfigurieren sie entsprechend. Auf diese Weise optimieren Sie die Migration. <br>  Vielen Dank an alle, die gelesen haben!  Ich freue mich √ºber Kritik, Kommentare und Klarstellungen.  Teilen Sie Ihre Methoden und Techniken f√ºr die Arbeit mit Big Data mit  Oft sind dies sehr wichtige und notwendige Informationen, die nicht so leicht zu finden sind. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de434800/">https://habr.com/ru/post/de434800/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de434790/index.html">So viele JDKs ... Welches zu verwenden und was bedroht es?</a></li>
<li><a href="../de434792/index.html">Freelansim 2018: Ergebnisse des Jahres</a></li>
<li><a href="../de434794/index.html">Soft Skills eines erfolgreichen Testers</a></li>
<li><a href="../de434796/index.html">Coding the Art: Wie wir Grafiken und Animationen in Designprojekten generieren</a></li>
<li><a href="../de434798/index.html">Swagger - intelligente Dokumentation f√ºr Ihre RESTful-Web-API - Junior-Back-End-Entwicklerbewertung f√ºr Neulinge</a></li>
<li><a href="../de434802/index.html">"Ich werde keinen Stein geben" oder wie die Ressourcen des Spiels "Cursed Lands" angeordnet sind</a></li>
<li><a href="../de434804/index.html">Das Fintech-Startup Robinhood konnte kein Analogon von Bankkonten starten</a></li>
<li><a href="../de434806/index.html">Neujahrsabbau mit einem Kanu</a></li>
<li><a href="../de434810/index.html">Starter f√ºr die Arbeit mit Spring Cloud</a></li>
<li><a href="../de434812/index.html">Projektzeitmanagement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>