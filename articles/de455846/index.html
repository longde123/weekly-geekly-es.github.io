<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🤝‍👨🏽 😍 👩🏽 Distributed Computing in Julia 👩🏻‍🎨 👨🏽‍🤝‍👨🏼 🤟🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wenn der vorherige Artikel eher geimpft wurde, ist es jetzt an der Zeit, Julias Parallelisierungsfunktionen auf ihrem Computer zu testen. 
 Mehrkern- ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Distributed Computing in Julia</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455846/"><p><img src="https://habrastorage.org/webt/ud/o6/5u/udo65u8kthnpek7hzrcedxgzwtk.jpeg"></p><br><p>  Wenn der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherige Artikel</a> eher geimpft wurde, ist es jetzt an der Zeit, Julias Parallelisierungsfunktionen auf ihrem Computer zu testen. </p><a name="habracut"></a><br><h2 id="mnogoyadernaya-ili-raspredelennaya-obrabotka">  Mehrkern- oder verteilte Verarbeitung </h2><br><p> Die Implementierung von Parallel Computing mit verteiltem Speicher wird vom <code>Distributed</code> Modul als Teil der mit Julia gelieferten Standardbibliothek bereitgestellt.  Die meisten modernen Computer verfügen über mehr als einen Prozessor, und mehrere Computer können geclustert werden.  Mit der Leistung dieser mehreren Prozessoren können Sie viele Berechnungen schneller durchführen.  Die Leistung wird von zwei Hauptfaktoren beeinflusst: der Geschwindigkeit der Prozessoren selbst und der Geschwindigkeit ihres Speicherzugriffs.  Im Cluster ist es offensichtlich, dass diese CPU auf demselben Computer (Knoten) den schnellsten Zugriff auf RAM hat.  Vielleicht noch überraschender ist, dass solche Probleme bei einem typischen Multi-Core-Laptop aufgrund von Unterschieden in der Geschwindigkeit des Hauptspeichers und des Caches relevant sind.  Daher sollte eine gute Multiprozessorumgebung es Ihnen ermöglichen, den "Besitz" eines Teils des Speichers durch einen bestimmten Prozessor zu steuern.  Julia bietet eine Messaging-basierte Multiprozessor-Umgebung, mit der Programme gleichzeitig auf mehreren Prozessen in verschiedenen Speicherdomänen ausgeführt werden können. </p><br><p>  Julias Messaging-Implementierung unterscheidet sich von anderen Umgebungen wie <abbr title="In diesem Zusammenhang bezieht sich MPI auf den MPI-1-Standard. Beginnend mit MPI-2 hat das MPI-Standardkomitee eine Reihe neuer Kommunikationsmechanismen eingeführt, die zusammen als Remote Memory Access (RMA) bezeichnet werden.">MPI</abbr> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[1]</a> .  Die Kommunikation in Julia erfolgt normalerweise in eine Richtung, was bedeutet, dass der Programmierer in einem Zwei-Prozess-Vorgang nur einen Prozess explizit steuern muss.  Darüber hinaus sehen diese Vorgänge normalerweise nicht wie "Senden einer Nachricht" und "Empfangen einer Nachricht" aus, sondern ähneln eher Vorgängen einer höheren Ebene, z. B. Aufrufen von benutzerdefinierten Funktionen. </p><br><p>  Die verteilte Programmierung in Julia basiert auf zwei Grundelementen: <em>Fernverbindungen</em> und <em>Fernaufrufe</em> .  Eine Remoteverbindung ist ein Objekt, das von jedem Prozess aus verwendet werden kann, um auf ein in einem bestimmten Prozess gespeichertes Objekt zu verweisen.  Ein Fernaufruf ist eine Anforderung eines Prozesses, eine bestimmte Funktion gemäß bestimmten Argumenten eines anderen (möglicherweise gleichen) Prozesses aufzurufen. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Remoteverbindungen gibt</a> es in zwei Formen: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Future</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RemoteChannel</a> . </p><br><p>  Ein Fernanruf gibt <code>Future</code> und führt dies sofort aus.  Der Prozess, der den Anruf getätigt hat, fährt mit dem nächsten Vorgang fort, während der Remote-Anruf an einer anderen Stelle stattfindet.  Sie können warten, bis der Remote-Aufruf mit dem Befehl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wait</a> für die zurückgegebene <code>Future</code> , und Sie können den vollständigen Wert des Ergebnisses auch mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fetch abrufen</a> . </p><br><p>  Auf der anderen Seite haben wir RemoteChannels, die neu geschrieben werden.  Beispielsweise können mehrere Prozesse ihre Verarbeitung unter Bezugnahme auf denselben Remote-Kanal koordinieren.  Jedem Prozess ist eine Kennung zugeordnet.  Der Prozess, der die interaktive Julia-Eingabeaufforderung bereitstellt, hat immer die Kennung 1. Die Prozesse, die standardmäßig für gleichzeitige Vorgänge verwendet werden, werden als "Worker" bezeichnet.  Wenn es nur einen Prozess gibt, wird Prozess 1 als funktionierend betrachtet.  Andernfalls werden alle Prozesse außer Prozess 1 als Arbeiter betrachtet. </p><br><p><img src="https://habrastorage.org/webt/vy/ts/gd/vytsgdo3oi1x52r901ibv8s4z1a.jpeg"></p><br><p>  Kommen wir dazu.  <code>julia -pn</code> mit <code>julia -pn</code> postscript bietet n Workflows auf dem lokalen Computer.  In der Regel ist es sinnvoll, dass n der Anzahl der CPU-Threads (logischen Kerne) auf dem Computer entspricht.  Beachten Sie, dass das Argument -p das verteilte Modul implizit lädt. </p><br><div class="spoiler">  <b class="spoiler_title">Wie starte ich ein Postscript?</b> <div class="spoiler_text"><p>  Konsolenoperationen sollten für Linux-Benutzer unkompliziert sein.  Dieses Schulungsprogramm richtet sich an unerfahrene Benutzer von Windows. <br>  Terminal Julia (REPL) bietet die Möglichkeit, Systembefehle zu verwenden: </p><br><pre> <code class="plaintext hljs">julia&gt; pwd() #     "C:\\Users\\User\\AppData\\Local\\Julia-1.1.0" julia&gt; cd("C:/Users/User/Desktop") #   julia&gt; run(`calc`) #     #     Windows. #      Process(`calc`, ProcessExited(0))</code> </pre> <br><p>  Mit diesen Befehlen können Sie Julia von Julia aus starten, aber es ist besser, sich nicht mitreißen zu lassen </p><br><p><img src="https://habrastorage.org/webt/tb/yv/4m/tbyv4me6o0jhsk-5ap3xgdqivsq.png"></p><br><p>  Es wäre korrekter, <strong>cmd</strong> von <em>julia / bin / aus</em> auszuführen und dort den Befehl <code>julia -p 2</code> oder eine Option für Liebhaber des Startens über eine Verknüpfung <code>C:\Users\User\AppData\Local\Julia-1.1.0\bin\julia -p 4</code> Erstellen Sie auf dem Desktop ein Notizblockdokument mit den folgenden Inhalten <code>C:\Users\User\AppData\Local\Julia-1.1.0\bin\julia -p 4</code> ( <em>geben Sie die Adresse und Anzahl der Prozesse an</em> ) und speichern Sie es als Textdokument mit dem Namen <em>run.bat</em> .  Hier, jetzt auf Ihrem Desktop, befindet sich eine Julia-Startsystemdatei für 4 Kerne. </p><br><p>  Sie können eine andere Methode verwenden (besonders relevant für <em>Jupyter</em> ): </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Distributed addprocs(<span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> </div></div><br><pre> <code class="julia hljs">$ ./julia -p <span class="hljs-number"><span class="hljs-number">2</span></span> julia&gt; r = remotecall(rand, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; s = <span class="hljs-meta"><span class="hljs-meta">@spawnat</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> .+ fetch(r) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; fetch(s) <span class="hljs-number"><span class="hljs-number">2</span></span>×<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">1.18526</span></span> <span class="hljs-number"><span class="hljs-number">1.50912</span></span> <span class="hljs-number"><span class="hljs-number">1.16296</span></span> <span class="hljs-number"><span class="hljs-number">1.60607</span></span></code> </pre><br><p>  Das erste Argument für <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Remotecall</a> ist die aufgerufene Funktion. <br>  Die meisten gleichzeitigen Programme in Julia beziehen sich nicht auf bestimmte Prozesse oder die Anzahl der verfügbaren Prozesse, aber ein Fernaufruf wird als Schnittstelle auf niedriger Ebene betrachtet, die eine genauere Steuerung bietet. </p><br><p>  Das zweite Argument für <code>remotecall</code> ist die Kennung des Prozesses, der die Arbeit <code>remotecall</code> , und die verbleibenden Argumente werden an die aufgerufene Funktion übergeben.  Wie Sie sehen können, haben wir in der ersten Zeile Prozess 2 gebeten, eine zufällige 2 x 2-Matrix zu erstellen, und in der zweiten Zeile haben wir darum gebeten, 1 hinzuzufügen.  Das Ergebnis beider Berechnungen ist in zwei Futures verfügbar, r und s.  Das Spawnat-Makro wertet den Ausdruck im zweiten Argument für den im ersten Argument angegebenen Prozess aus.  Manchmal benötigen Sie möglicherweise einen fernberechneten Wert.  Dies geschieht normalerweise, wenn Sie von einem Remote-Objekt lesen, um die für den nächsten lokalen Vorgang erforderlichen Daten abzurufen.  <code>remotecall_fetch</code> gibt es eine <code>remotecall_fetch</code> Funktion.  Dies entspricht dem <code>fetch (remotecall (...))</code> , ist jedoch effizienter. </p><br><p>  Denken Sie daran, dass <code>getindex(r, 1,1)</code> gleich <code>r[1,1]</code> , sodass dieser Aufruf das erste Element des zukünftigen <code>r</code> abruft. </p><br><p>  Die <code>remotecall</code> Remote- <code>remotecall</code> nicht besonders praktisch.  Das <code>@spawn</code> Makro erleichtert die <code>@spawn</code> .  Es arbeitet mit einem Ausdruck, nicht mit einer Funktion, und wählt aus, wo die Operation für Sie ausgeführt werden soll: </p><br><pre> <code class="julia hljs">julia&gt; r = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> rand(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; s = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> .+ fetch(r) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; fetch(s) <span class="hljs-number"><span class="hljs-number">2</span></span>×<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">1.38854</span></span> <span class="hljs-number"><span class="hljs-number">1.9098</span></span> <span class="hljs-number"><span class="hljs-number">1.20939</span></span> <span class="hljs-number"><span class="hljs-number">1.57158</span></span></code> </pre> <br><p>  Beachten Sie, dass wir <code>1 .+ Fetch(r)</code> anstelle von <code>1 .+ r</code>  Dies liegt daran, dass wir nicht wissen, wo der Code ausgeführt wird. Im allgemeinen Fall kann es daher erforderlich sein, <code>r</code> abzurufen, um <code>r</code> in den Additionsprozess zu verschieben.  In diesem Fall ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@spawn</a> intelligent genug, um Berechnungen für den Prozess durchzuführen, dem <code>r</code> , sodass der Abruf nicht betriebsbereit ist (es wird keine Arbeit geleistet).  (Es ist erwähnenswert, dass Spawn nicht eingebaut ist, sondern in Julia als Makro definiert ist. Sie können Ihre eigenen solchen Konstrukte definieren.) </p><br><p>  Es ist wichtig zu beachten, dass <code>Future</code> nach dem Extrahieren seinen Wert lokal zwischenspeichert.  Weitere Aufrufe zum Abrufen bedeuten keinen Netzwerksprung.  Nachdem alle verweisenden Futures ausgewählt wurden, wird der gelöschte gespeicherte Wert gelöscht. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@async</a> ähnelt <code>@spawn</code> , führt jedoch Aufgaben nur im lokalen Prozess aus.  Wir verwenden es, um für jeden Prozess eine „Feed“ -Aufgabe zu erstellen.  Jede Aufgabe wählt den nächsten Index aus, der berechnet werden muss, wartet dann auf den Abschluss des Prozesses und wiederholt sich, bis uns die Indizes ausgehen. </p><br><p>  Bitte beachten Sie, dass die Feeder-Tasks erst ausgeführt werden, wenn die Haupt-Task das Ende des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@ sync-</a> Blocks erreicht hat. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Danach</a> übergibt sie die Kontrolle und wartet auf den Abschluss aller lokalen Tasks, bevor sie von der Funktion zurückkehrt. </p><br><p>  Ab Version 0.7 können Feeder-Tasks den Status über nextidx gemeinsam nutzen, da alle im selben Prozess ausgeführt werden.  Selbst wenn Aufgaben gemeinsam geplant werden, kann in einigen Kontexten eine Blockierung erforderlich sein, z. B. bei asynchronen E / A.  Dies bedeutet, dass die <code>remotecall_fetch</code> nur an genau definierten Punkten erfolgt: in diesem Fall, wenn <code>remotecall_fetch</code> .  Dies ist der aktuelle Implementierungsstatus und kann sich in zukünftigen Versionen von Julia ändern, da es so konzipiert ist, dass bis zu N Aufgaben in M ​​Prozessen oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">M: N Threading ausgeführt werden können</a> .  Dann benötigen wir ein Modell, um Sperren für <code>nextidx</code> zu erhalten / freizugeben, da es nicht sicher ist, mehrere Prozesse gleichzeitig Ressourcen lesen und schreiben zu lassen. </p><br><p>  Ihr Code muss für jeden Prozess verfügbar sein, der ihn ausführt.  Geben Sie beispielsweise an der Julia-Eingabeaufforderung Folgendes ein: </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> rand2(dims...) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>*rand(dims...) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> julia&gt; rand2(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span>×<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">0.153756</span></span> <span class="hljs-number"><span class="hljs-number">0.368514</span></span> <span class="hljs-number"><span class="hljs-number">1.15119</span></span> <span class="hljs-number"><span class="hljs-number">0.918912</span></span> julia&gt; fetch(<span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> rand2(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>)) ERROR: <span class="hljs-built_in"><span class="hljs-built_in">RemoteException</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">CapturedException</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">UndefVarError</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">"#rand2"</span></span>)) Stacktrace: [...]</code> </pre> <br><p>  Prozess 1 kannte die Funktion rand2, Prozess 2 jedoch nicht.  In den meisten Fällen laden Sie Code aus Dateien oder Paketen herunter und können flexibel steuern, welche Prozesse den Code laden.  Betrachten Sie die Datei <code>DummyModule.jl</code> , die den folgenden Code enthält: </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">module</span></span> DummyModule <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> MyType, f <span class="hljs-keyword"><span class="hljs-keyword">mutable struct</span></span> MyType a::<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> f(x) = x^<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span> println(<span class="hljs-string"><span class="hljs-string">"loaded"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Um in allen Prozessen auf <code>DummyModule.jl</code> zu <code>DummyModule.jl</code> muss <code>DummyModule.jl</code> in jedem Prozess geladen werden.  Ein Aufruf zum <code>include ('DummyModule.jl')</code> lädt es nur für einen Prozess.  Verwenden Sie zum <code>@everywhere</code> in jeden Prozess das Makro <code>@everywhere</code> (führen Sie Julia mit julia -p 2 aus): </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> include(<span class="hljs-string"><span class="hljs-string">"DummyModule.jl"</span></span>) loaded From worker <span class="hljs-number"><span class="hljs-number">3</span></span>: loaded From worker <span class="hljs-number"><span class="hljs-number">2</span></span>: loaded</code> </pre> <br><p>  Wie üblich macht dies DummyModule nicht für Prozesse zugänglich, die verwendet oder importiert werden müssen.  Wenn ein DummyModule in den Umfang eines Prozesses einbezogen wird, ist es in keinem anderen enthalten: </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> .DummyModule julia&gt; MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>) MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>) julia&gt; fetch(<span class="hljs-meta"><span class="hljs-meta">@spawnat</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>)) ERROR: On worker <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">UndefVarError</span></span>: MyType not defined ⋮ julia&gt; fetch(<span class="hljs-meta"><span class="hljs-meta">@spawnat</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> DummyModule.MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>)) MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>)</code> </pre> <br><p>  Es ist jedoch weiterhin möglich, MyType an den Prozess zu senden, der das DummyModule geladen hat, auch wenn es nicht im Gültigkeitsbereich liegt: </p><br><pre> <code class="julia hljs">julia&gt; put!(<span class="hljs-built_in"><span class="hljs-built_in">RemoteChannel</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>), MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>)) <span class="hljs-built_in"><span class="hljs-built_in">RemoteChannel</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Channel</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Any</span></span>}}(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>)</code> </pre> <br><p>  Die Datei kann beim Start mit dem Flag -L auch in mehrere Prozesse vorgeladen werden, und das Treiberskript kann zur Steuerung von Berechnungen verwendet werden: </p><br><pre> <code class="julia hljs">julia -p &lt;n&gt; -L file1.jl -L file2.jl driver.jl</code> </pre> <br><p>  Der Julia-Prozess, der das Treiberskript im obigen Beispiel ausführt, hat die Kennung 1, genau wie der Prozess, der die interaktive Eingabeaufforderung bereitstellt.  Wenn DummyModule.jl keine separate Datei, sondern ein Paket ist, lädt die Verwendung von DummyModule DummyModule.jl in allen Prozessen, überträgt es jedoch nur in den Bereich des Prozesses, für den die Verwendung aufgerufen wurde. </p><br><h2 id="zapusk-i-upravlenie-rabochimi-processami">  Starten und Verwalten von Workflows </h2><br><p>  Die grundlegende Julia-Installation unterstützt zwei Arten von Clustern: </p><br><ul><li>  Der mit der Option -p angegebene lokale Cluster, wie oben gezeigt. </li><li>  Cluster-Computer mit der Option --machine-file.  Dies verwendet die SSH-Anmeldung ohne Kennwort, um Julia-Workflows (auf demselben Pfad wie der aktuelle Host) auf den angegebenen Computern zu starten. </li></ul><br><p><img src="https://habrastorage.org/webt/dr/1b/7y/dr1b7y4ly3ashzsh19-7lwmvwni.jpeg"></p><br><p>  Die Funktionen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">addprocs</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">rmprocs</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">worker</a> und andere stehen als Softwaretool zum Hinzufügen, Entfernen und Abfragen von Prozessen in einem Cluster zur Verfügung. </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Distributed julia&gt; addprocs(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span>-element <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  Das <code>Distributed</code> Modul muss explizit in den Hauptprozess geladen werden, bevor <code>addprocs</code> .  Es wird automatisch für Workflows verfügbar.  Beachten Sie, dass Worker weder das <code>~/.julia/config/startup.jl</code> noch ihren globalen Status (z. B. globale Variablen, Definitionen neuer Methoden und geladene Module) mit einem der anderen ausgeführten Prozesse synchronisieren.  Andere Arten von Clustern können unterstützt werden, indem Sie Ihren eigenen <code>ClusterManager</code> schreiben, wie unten im Abschnitt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ClusterManager beschrieben</a> . </p><br><h2 id="deystviya-s-dannymi">  Datenaktionen </h2><br><p>  Das Senden von Nachrichten und das Verschieben von Daten machen den größten Teil des Overheads in einem verteilten Programm aus.  Die Reduzierung der Anzahl der Nachrichten und der gesendeten Datenmenge ist entscheidend für die Erzielung von Leistung und Skalierbarkeit.  Dazu ist es wichtig, die Datenbewegung zu verstehen, die von Julias verschiedenen verteilten Programmierkonstrukten ausgeführt wird. </p><br><p>  <code>fetch</code> kann als explizite Datenverschiebungsoperation betrachtet werden, da es die Bewegung eines Objekts direkt zum lokalen Computer anfordert.  <code>@spawn</code> (und mehrere verwandte Konstrukte) verschieben ebenfalls Daten, dies ist jedoch nicht so offensichtlich, sodass es als implizite Datenverschiebungsoperation bezeichnet werden kann.  Betrachten Sie diese beiden Ansätze zum Erstellen und Quadrieren einer Zufallsmatrix: </p><br><p>  Wegzeiten: </p><br><pre> <code class="julia hljs">julia&gt; A = rand(<span class="hljs-number"><span class="hljs-number">1000</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>); julia&gt; Bref = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> A^<span class="hljs-number"><span class="hljs-number">2</span></span>; [...] julia&gt; fetch(Bref);</code> </pre> <br><p>  Methode zwei: </p><br><pre> <code class="julia hljs">julia&gt; Bref = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> rand(<span class="hljs-number"><span class="hljs-number">1000</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>)^<span class="hljs-number"><span class="hljs-number">2</span></span>; [...] julia&gt; fetch(Bref);</code> </pre> <br><p>  Der Unterschied scheint trivial zu sein, ist aber aufgrund des Verhaltens von <code>@spawn</code> tatsächlich ziemlich bedeutend.  Bei der ersten Methode wird eine Zufallsmatrix lokal erstellt und dann an einen anderen Prozess gesendet, wo sie quadriert wird.  Bei der zweiten Methode wird eine Zufallsmatrix für einen anderen Prozess erstellt und quadriert.  Daher sendet die zweite Methode viel weniger Daten als die erste.  In diesem Spielzeugbeispiel sind die beiden Methoden leicht zu unterscheiden und auszuwählen.  In einem realen Programm kann das Entwerfen von Datenbewegungen jedoch sehr teuer und wahrscheinlich eine Messung sein. </p><br><p>  Wenn der erste Prozess beispielsweise die Matrix A benötigt, ist die erste Methode möglicherweise besser.  Wenn die Berechnung von A teuer ist und nur den aktuellen Prozess verwendet, kann es unvermeidlich sein, ihn auf einen anderen Prozess zu verschieben.  Wenn der aktuelle Prozess zwischen <code>spawn</code> und <code>fetch(Bref)</code> nur sehr wenig gemeinsam hat, ist es möglicherweise besser, die Parallelität vollständig zu beseitigen.  Oder stellen Sie sich vor, dass <code>rand(1000, 1000)</code> durch eine teurere Operation ersetzt wurde.  Dann könnte es sinnvoll sein, nur für diesen Schritt eine weitere <code>spawn</code> Anweisung hinzuzufügen. </p><br><h2 id="globalnye-peremennye">  Globale Variablen </h2><br><p>  Ausdrücke, die remote über Spawn ausgeführt werden, oder Schließungen, die für die Remote-Ausführung mit <code>remotecall</code> , können sich auf globale Variablen beziehen.  Globale Bindungen im Hauptmodul werden etwas anders behandelt als globale Bindungen in anderen Modulen.  Betrachten Sie das folgende Codefragment: </p><br><pre> <code class="julia hljs">A = rand(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>) remotecall_fetch(()-&gt;sum(A), <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br><p>  In diesem Fall MUSS die <code>sum</code> im Remote-Prozess definiert werden.  Beachten Sie, dass <code>A</code> eine globale Variable ist, die im lokalen Arbeitsbereich definiert ist.  Worker 2 hat im Hauptabschnitt keine Variable mit dem Namen <code>A</code>  Durch das Senden der Schließfunktion <code>() -&gt; sum(A)</code> für Worker 2 wird <code>Main.A</code> 2 definiert. <code>Main.A</code> bleibt auf Worker 2 auch nach Rückgabe des Aufrufs <code>remotecall_fetch</code> . </p><br><p><img src="https://habrastorage.org/webt/kp/iv/xi/kpivxixwcfwqqzi4gv1dyqkjhcw.png"></p><br><p>  Remote-Aufrufe mit eingebetteten globalen Referenzen (nur im Hauptmodul) verwalten globale Variablen wie folgt: </p><br><ul><li>  Neue globale Bindungen werden an Zielarbeitsstationen erstellt, wenn sie als Teil eines Remote-Aufrufs referenziert werden. </li><li>  Globale Konstanten werden auch auf Remote-Knoten als Konstanten deklariert. </li><li>  Globals werden nur im Rahmen eines Fernanrufs und nur dann an den Zielmitarbeiter erneut gesendet, wenn sich ihr Wert geändert hat.  Darüber hinaus synchronisiert der Cluster keine globalen Bindungen zwischen Knoten.  Zum Beispiel: </li></ul><br><pre> <code class="julia hljs">A = rand(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>) remotecall_fetch(()-&gt;sum(A), <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-comment"><span class="hljs-comment"># worker 2 A = rand(10,10) remotecall_fetch(()-&gt;sum(A), 3) # worker 3 A = nothing</span></span></code> </pre> <br><p>  Die Ausführung des obigen Fragments führt dazu, dass <code>Main.A</code> auf Mitarbeiter 2 einen anderen Wert als <code>Main.A</code> auf Mitarbeiter 3 hat, während der Wert von <code>Main.A</code> auf Knoten 1 Null ist. </p><br><p>  Wie Sie wahrscheinlich verstanden haben, können solche Aktionen für Worker nicht ausgeführt werden, obwohl der mit globalen Variablen verknüpfte Speicher erfasst werden kann, wenn sie dem Master-Gerät neu zugewiesen werden, da die Bindungen weiterhin funktionieren.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">klar!</a>  kann verwendet werden, um bestimmte globale Variablen manuell <code>nothing</code> zuzuweisen, wenn sie nicht mehr benötigt werden.  Dadurch wird der ihnen im Rahmen des normalen Speicherbereinigungszyklus zugeordnete Speicher freigegeben.  Daher sollten Programme beim Zugriff auf globale Variablen in Remote-Aufrufen vorsichtig sein.  In der Tat ist es, wann immer möglich, besser, sie überhaupt zu vermeiden.  Wenn Sie auf globale Variablen verweisen müssen, sollten Sie <code>let</code> Blöcke verwenden, um globale Variablen zu lokalisieren.  Zum Beispiel: </p><br><pre> <code class="julia hljs">julia&gt; A = rand(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>); julia&gt; remotecall_fetch(()-&gt;A, <span class="hljs-number"><span class="hljs-number">2</span></span>); julia&gt; B = rand(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>); julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> B = B remotecall_fetch(()-&gt;B, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; julia&gt; <span class="hljs-meta"><span class="hljs-meta">@fetchfrom</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> InteractiveUtils.varinfo() name size summary ––––––––– ––––––––– –––––––––––––––––––––– A <span class="hljs-number"><span class="hljs-number">800</span></span> bytes <span class="hljs-number"><span class="hljs-number">10</span></span>×<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>} Base <span class="hljs-built_in"><span class="hljs-built_in">Module</span></span> Core <span class="hljs-built_in"><span class="hljs-built_in">Module</span></span> Main <span class="hljs-built_in"><span class="hljs-built_in">Module</span></span></code> </pre> <br><p>  Es ist leicht zu erkennen, dass die globale Variable <code>A</code> für Worker 2 definiert ist, <code>B</code> als lokale Variable geschrieben ist und daher die Bindung für <code>B</code> für Worker 2 nicht vorhanden ist. </p><br><h2 id="parallelnye-cikly">  Parallele Schleifen </h2><br><p><img src="https://habrastorage.org/webt/zv/m5/q_/zvm5q_scthnveue7fxljwa0dshu.jpeg"></p><br><p>  Glücklicherweise erfordern viele nützliche Parallelitätsberechnungen keine Datenverschiebung.  Ein typisches Beispiel ist eine Monte-Carlo-Simulation, bei der mehrere Prozesse gleichzeitig unabhängige Simulationstests verarbeiten können.  Wir können <code>@spawn</code> , um Münzen in zwei Prozesse zu <code>@spawn</code> .  Schreiben Sie zuerst die folgende Funktion in <code>count_heads.jl</code> : </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> count_heads(n) c::<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:n c += rand(<span class="hljs-built_in"><span class="hljs-built_in">Bool</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Die Funktion count_heads addiert einfach n zufällige Bits.  So können wir einige Tests auf zwei Maschinen durchführen und die Ergebnisse addieren: </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> include_string(Main, $(read(<span class="hljs-string"><span class="hljs-string">"count_heads.jl"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>)), <span class="hljs-string"><span class="hljs-string">"count_heads.jl"</span></span>) julia&gt; a = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> count_heads(<span class="hljs-number"><span class="hljs-number">100000000</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; b = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> count_heads(<span class="hljs-number"><span class="hljs-number">100000000</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; fetch(a)+fetch(b) <span class="hljs-number"><span class="hljs-number">100001564</span></span></code> </pre> <br><p>  Dieses Beispiel zeigt ein leistungsstarkes und häufig verwendetes paralleles Programmiermuster.  Viele Iterationen werden unabhängig voneinander in mehreren Prozessen ausgeführt, und dann werden ihre Ergebnisse unter Verwendung einer Funktion kombiniert.  Der Vereinigungsprozess wird als Reduktion bezeichnet, da er normalerweise den Tensorrang reduziert: Der Vektor von Zahlen wird auf eine Zahl reduziert, oder die Matrix wird auf eine Zeile oder Spalte usw. reduziert.  Im Code sieht dies normalerweise so aus: Muster <code>x = f(x, v [i])</code> , wobei <code>x</code> die Batterie ist, <code>f</code> die Reduktionsfunktion ist und <code>v[i]</code> die zu reduzierenden Elemente sind. </p><br><p>  Es ist wünschenswert, dass <code>f</code> assoziativ ist, damit es keine Rolle spielt, in welcher Reihenfolge die Operationen ausgeführt werden.  Bitte beachten Sie, dass unsere Verwendung dieser Vorlage mit <code>count_heads</code> verallgemeinert sein kann.  Wir haben zwei explizite <code>spawn</code> Anweisungen verwendet, die die Parallelität auf zwei Prozesse beschränken.  Um eine beliebige Anzahl von Prozessen auszuführen, können wir eine parallele <code>for</code> Schleife verwenden, die im verteilten Speicher arbeitet und mit verteiltem Speicher in Julia geschrieben werden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kann</a> , zum Beispiel: </p><br><pre> <code class="julia hljs">nheads = <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> (+) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">200000000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>(rand(<span class="hljs-built_in"><span class="hljs-built_in">Bool</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>                (   <code>(+)</code> ).          .         . </p><br><p>  ,     <code>for</code>    ,    .  ,      ,          ,      .  ,    ,      . ,       : </p><br><pre> <code class="julia hljs">a = zeros(<span class="hljs-number"><span class="hljs-number">100000</span></span>) <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">100000</span></span> a[i] = i <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>      ,          .    ,  .  ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Shared Arrays</a> ,    ,    : </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> SharedArrays a = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>}(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span> a[i] = i <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  «»      ,      : </p><br><pre> <code class="julia hljs">a = randn(<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> (+) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">100000</span></span> f(a[rand(<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>)]) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>     <code>f</code>      ,    .    ,    ,    .      ,               <code>Future</code> ,   .     Future    ,    <code>fetch</code> ,      ,   <code>@sync</code> ,  <code>@sync distributed for</code> . </p><br><p>       ,              (,    ,      ).     ,  <em> </em> ,   Julia   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pmap</a> . ,            : </p><br><pre> <code class="julia hljs">julia&gt; M = <span class="hljs-built_in"><span class="hljs-built_in">Matrix</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>}[rand(<span class="hljs-number"><span class="hljs-number">1000</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>]; julia&gt; pmap(svdvals, M);</code> </pre> <br><p> <code>pmap</code>    ,        . , <code>distributed for</code>   ,    , ,    .      <code>pmap</code> ,   <code>distributed</code>   .   <code>distributed for</code>      . </p><br><h2 id="obschie-massivy-shared-arrays">   (Shared Arrays) </h2><br><p><img src="https://habrastorage.org/webt/gg/46/u5/gg46u5y_8bmejazw_ijxwzrbxie.jpeg"></p><br><p> Shared Arrays              .        <a href="">DArray</a> ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SharedArray</a>  .  <a href="">DArray</a>         ,            ; ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SharedArray</a>        . </p><br><p> <code>SharedArray</code> —  ,   ,              .  Shared Array    <code>SharedArrays</code> ,         .  <code>SharedArray</code>  (    )   ,        ,       .        <code>SharedArray</code> ,     .  ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Array</a> ,      <code>SharedArray</code> ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sdata</a> .    <code>AbstractArray</code> <code>sdata</code>    ,    <code>sdata</code>     <code>Array</code> .      : </p><br><pre> <code class="julia hljs"><span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{T,N}(dims::<span class="hljs-built_in"><span class="hljs-built_in">NTuple</span></span>; init=<span class="hljs-literal"><span class="hljs-literal">false</span></span>, pids=<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>[])</code> </pre> <br><p>   <code>N</code> -     <code>T</code>   <code>dims</code>  ,   <code>pids</code> .     ,        ,      <code>pids</code> (  ,       ). </p><br><p>    <code>init</code>   <code>initfn(S :: SharedArray)</code> ,      .   ,      <code>init</code>    ,  . </p><br><p>   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Distributed julia&gt; addprocs(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">3</span></span>-element <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> SharedArrays julia&gt; S = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}((<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>), init = S -&gt; S[localindices(S)] = myid()) <span class="hljs-number"><span class="hljs-number">3</span></span>×<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> julia&gt; S[<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> julia&gt; S <span class="hljs-number"><span class="hljs-number">3</span></span>×<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre> <br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SharedArrays.localindices</a>             . ,      ,  : </p><br><pre> <code class="julia hljs">julia&gt; S = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}((<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>), init = S -&gt; S[indexpids(S):length(procs(S)):length(S)] = myid()) <span class="hljs-number"><span class="hljs-number">3</span></span>×<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre> <br><p>        ,    ,    .  Zum Beispiel: </p><br><pre> <code class="julia hljs"><span class="hljs-meta"><span class="hljs-meta">@sync</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> procs(S) <span class="hljs-meta"><span class="hljs-meta">@async</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> remotecall_wait(fill!, p, S, p) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>    .     <em></em>    <code>pid</code> ,  ,     (    <code>S</code> ),   <code>pid</code> . </p><br><p>            «»: </p><br><pre> <code class="julia hljs">q[i,j,t+<span class="hljs-number"><span class="hljs-number">1</span></span>] = q[i,j,t] + u[i,j,t]</code> </pre> <br><p>   ,     ,   , ,  ,   :  <code>q [i,j,t]</code>    ,     <code>q[i,j,t+1]</code>     ,  ,  ,  <code>q[i,j,t]</code>      ,      <code>q[i,j,t+1]</code> .         .     .  ,    <code>(irange, jrange)</code> ,   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> myrange(q::<span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>) idx = indexpids(q) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> idx == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment"># This worker is not assigned a piece return 1:0, 1:0 end nchunks = length(procs(q)) splits = [round(Int, s) for s in range(0, stop=size(q,2), length=nchunks+1)] 1:size(q,1), splits[idx]+1:splits[idx+1] end</span></span></code> </pre> <br><p>   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> advection_chunk!(q, u, irange, jrange, trange) <span class="hljs-meta"><span class="hljs-meta">@show</span></span> (irange, jrange, trange) <span class="hljs-comment"><span class="hljs-comment"># display so we can see what's happening for t in trange, j in jrange, i in irange q[i,j,t+1] = q[i,j,t] + u[i,j,t] end q end</span></span></code> </pre> <br><p>        <code>SharedArray</code> </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> advection_shared_chunk!(q, u) = advection_chunk!(q, u, myrange(q)..., <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">3</span></span>)-<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br><p>      ,       : </p><br><pre> <code class="julia hljs">julia&gt; advection_serial!(q, u) = advection_chunk!(q, u, <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">3</span></span>)-<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br><p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@distributed</a> : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> advection_parallel!(q, u) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> t = <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">3</span></span>)-<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-meta"><span class="hljs-meta">@sync</span></span> <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> j = <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">1</span></span>) q[i,j,t+<span class="hljs-number"><span class="hljs-number">1</span></span>]= q[i,j,t] + u[i,j,t] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> q <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><p>  ,   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> advection_shared!(q, u) <span class="hljs-meta"><span class="hljs-meta">@sync</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> procs(q) <span class="hljs-meta"><span class="hljs-meta">@async</span></span> remotecall_wait(advection_shared_chunk!, p, q, u) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> q <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><p>    SharedArray    ,     (  <code>julia -p 4</code> ): </p><br><pre> <code class="julia hljs">julia&gt; q = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>}((<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>)); julia&gt; u = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>}((<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>));</code> </pre> <br><p>      JIT-     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@time</a>   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> advection_serial!(q, u); (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) <span class="hljs-number"><span class="hljs-number">830.220</span></span> milliseconds (<span class="hljs-number"><span class="hljs-number">216</span></span> allocations: <span class="hljs-number"><span class="hljs-number">13820</span></span> bytes) julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> advection_parallel!(q, u); <span class="hljs-number"><span class="hljs-number">2.495</span></span> seconds (<span class="hljs-number"><span class="hljs-number">3999</span></span> k allocations: <span class="hljs-number"><span class="hljs-number">289</span></span> MB, <span class="hljs-number"><span class="hljs-number">2.09</span></span>% gc time) julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> advection_shared!(q,u); From worker <span class="hljs-number"><span class="hljs-number">2</span></span>: (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">125</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) From worker <span class="hljs-number"><span class="hljs-number">4</span></span>: (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">251</span></span>:<span class="hljs-number"><span class="hljs-number">375</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) From worker <span class="hljs-number"><span class="hljs-number">3</span></span>: (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">126</span></span>:<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) From worker <span class="hljs-number"><span class="hljs-number">5</span></span>: (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">376</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) <span class="hljs-number"><span class="hljs-number">238.119</span></span> milliseconds (<span class="hljs-number"><span class="hljs-number">2264</span></span> allocations: <span class="hljs-number"><span class="hljs-number">169</span></span> KB)</code> </pre> <br><p>    <code>advection_shared!</code>  ,      ,         . </p><br><h3 id="obschie-massivy-i-raspredelennaya-sborka-musora">       </h3><br><p>    ,          . ,        ,         . <br>    ,     ,   ,  . </p><br><h1 id="parallelnyy-monte-karlo-v-julia">  -  Julia </h1><br><p>  ,             ,    ,        . </p><br><p>         <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03C0;</mi><mo>=</mo><mn>3.14159265...</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.48ex" height="2.057ex" viewBox="0 -780.1 7526.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-3C0" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-3D" x="851" y="0"></use><g transform="translate(1907,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-31" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-34" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-31" x="1780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-35" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-39" x="2781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-32" x="3281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-36" x="3782" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-35" x="4282" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-2E" x="4783" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-2E" x="5061" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-2E" x="5340" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>π</mi><mo>=</mo><mn>3.14159265...</mn></math></span></span><script type="math/tex" id="MathJax-Element-1">\pi = 3.14159265...</script> ,      ,   -.   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> \ pi </script> ,     <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>S</mi><mo>=</mo><mi>&amp;#x03C0;</mi><msup><mi>r</mi><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.033ex" height="2.419ex" viewBox="0 -935.7 3458.5 1041.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-53" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-3D" x="923" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-3C0" x="1979" y="0"></use><g transform="translate(2553,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-32" x="638" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mo>=</mo><mi>π</mi><msup><mi>r</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-3">S = \pi r^2</script>  wo <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>r</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.049ex" height="1.455ex" viewBox="0 -520.7 451.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-72" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> r </script> —  .     -   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> \ pi </script>    , ..        <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>1</mn><mo>,</mo><mn>1</mn><msup><mo stretchy=&quot;false&quot;>]</mo><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.515ex" height="2.901ex" viewBox="0 -935.7 3235.6 1249" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-2212" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-31" x="1057" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-2C" x="1557" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-31" x="2002" y="0"></use><g transform="translate(2503,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-5D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-32" x="393" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mo>−</mo><mn>1</mn><mo>,</mo><mn>1</mn><msup><mo stretchy="false">]</mo><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-6">[−1,1]^2</script>   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi><mo>&amp;#x2212;</mo><mi>y</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.326ex" height="2.178ex" viewBox="0 -676.4 2292.9 937.7" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-2212" x="794" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-79" x="1795" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>−</mo><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">x-y</script>    ,    . </p><br><p><img src="https://habrastorage.org/webt/4v/ym/mb/4vymmbllbfnu3prcb3wfu0qqkje.png"></p><br><p>     ( <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>S</mi><mo>=</mo><mi>&amp;#x03C0;</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.93ex" height="2.057ex" viewBox="0 -780.1 2553.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-53" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-3D" x="923" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-3C0" x="1979" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mo>=</mo><mi>π</mi></math></span></span><script type="math/tex" id="MathJax-Element-8">S=\pi</script> ,   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>r</mi><mo>=</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.31ex" height="1.937ex" viewBox="0 -728.2 2286.1 834" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-72" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-3D" x="729" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-31" x="1785" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-9">r = 1</script> )    ( <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>A</mi><mo>=</mo><mn>4</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.004ex" height="2.057ex" viewBox="0 -780.1 2585.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-41" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-3D" x="1028" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-34" x="2084" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mo>=</mo><mn>4</mn></math></span></span><script type="math/tex" id="MathJax-Element-10">A = 4</script> )  <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03C0;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mn>4</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.657ex" height="2.66ex" viewBox="0 -832 1574.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-3C0" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-2F" x="573" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMAIN-34" x="1074" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>π</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>4</mn></math></span></span><script type="math/tex" id="MathJax-Element-11">\pi/4</script> ,      ,    ,          .  ,   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-12"> \ pi </script>      ,    .    <code>compute_pi (N)</code> ,    <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-13"> \ pi </script> ,  <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-4E" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-14">N</script> . </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> compute_pi(N::<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) <span class="hljs-comment"><span class="hljs-comment"># counts number of points that have radial coordinate &lt; 1, ie in circle n_landed_in_circle = 0 for i = 1:N x = rand() * 2 - 1 # uniformly distributed number on x-axis y = rand() * 2 - 1 # uniformly distributed number on y-axis r2 = x*x + y*y # radius squared, in radial coordinates if r2 &lt; 1.0 n_landed_in_circle += 1 end end return n_landed_in_circle / N * 4.0 end</span></span></code> </pre> <br><p>  ,     ,    <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhi3SNbhXQHgQ8I2K4ETERBzdFS3yw#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-15"> \ pi </script>  .      :   ,          ,     25  . </p><br><p>  Julia         <code>Pi.jl</code> (    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sublime Text</a> ,          ): </p><br><pre> <code class="julia hljs">C:\Users\User\AppData\Local\Julia-<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>\bin\julia -p <span class="hljs-number"><span class="hljs-number">4</span></span> julia&gt; include(<span class="hljs-string"><span class="hljs-string">"C:/Users/User/Desktop/Pi.jl"</span></span>)</code> </pre> <br><p>       </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Distributed addprocs(<span class="hljs-number"><span class="hljs-number">4</span></span>)</code> </pre> <br><p>       <em>Jupyter</em> </p><br><div class="spoiler"> <b class="spoiler_title">Pi.jl</b> <div class="spoiler_text"><pre> <code class="julia hljs"><span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> compute_pi(N::<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) n_landed_in_circle = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment"># counts number of points that have radial coordinate &lt; 1, ie in circle for i = 1:N x = rand() * 2 - 1 # uniformly distributed number on x-axis y = rand() * 2 - 1 # uniformly distributed number on y-axis r2 = x*x + y*y # radius squared, in radial coordinates if r2 &lt; 1.0 n_landed_in_circle += 1 end end return n_landed_in_circle / N * 4.0 end function parallel_pi_computation(N::Int; ncores::Int=4) #       sum_of_pis = @distributed (+) for i=1:ncores compute_pi(ceil(Int, N / ncores)) end return sum_of_pis / ncores # average value end # ceil (T, x)     #  T,     x.</span></span></code> </pre> </div></div><br><p>       ,    : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> parallel_pi_computation(<span class="hljs-number"><span class="hljs-number">1000000000</span></span>, ncores = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">6.818123</span></span> seconds (<span class="hljs-number"><span class="hljs-number">1.96</span></span> M allocations: <span class="hljs-number"><span class="hljs-number">99.838</span></span> MiB, <span class="hljs-number"><span class="hljs-number">0.42</span></span>% gc time) <span class="hljs-number"><span class="hljs-number">3.141562892</span></span> julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> parallel_pi_computation(<span class="hljs-number"><span class="hljs-number">1000000000</span></span>, ncores = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">5.081638</span></span> seconds (<span class="hljs-number"><span class="hljs-number">1.12</span></span> k allocations: <span class="hljs-number"><span class="hljs-number">62.953</span></span> KiB) <span class="hljs-number"><span class="hljs-number">3.141657252</span></span> julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> parallel_pi_computation(<span class="hljs-number"><span class="hljs-number">1000000000</span></span>, ncores = <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">3.504871</span></span> seconds (<span class="hljs-number"><span class="hljs-number">1.84</span></span> k allocations: <span class="hljs-number"><span class="hljs-number">109.382</span></span> KiB) <span class="hljs-number"><span class="hljs-number">3.1415942599999997</span></span> julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> parallel_pi_computation(<span class="hljs-number"><span class="hljs-number">1000000000</span></span>, ncores = <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-number"><span class="hljs-number">3.093918</span></span> seconds (<span class="hljs-number"><span class="hljs-number">1.12</span></span> k allocations: <span class="hljs-number"><span class="hljs-number">71.938</span></span> KiB) <span class="hljs-number"><span class="hljs-number">3.1416889400000003</span></span> julia&gt; <span class="hljs-literal"><span class="hljs-literal">pi</span></span> ? = <span class="hljs-number"><span class="hljs-number">3.1415926535897</span></span>...</code> </pre> <br><p>  <em>JIT</em> - —     .  ,    Julia  . ,             (       Multi-Threading, Atomic Operations, Channels  Coroutines). </p><br><h3 id="poleznye-ssylki">  Nützliche Links </h3><br><p>   ,    ,   .  <a href="">MPI.jl</a>      <code>MPI</code> ,  <br> <a href="">DistributedArrays.jl</a>     . <br>       GPU,    : </p><br><ol><li>  (  C) <a href="">OpenCL.jl</a>  <a href="">CUDAdrv.jl</a>     OpenCL   CUDA. </li><li>  (  Julia)  <a href="">CUDAnative.jl</a>     CUDA . </li><li>  ,    ,   <a href="">CuArrays.jl</a>  <a href="">CLArrays.jl</a> </li><li>   ,   <a href="">ArrayFire.jl</a>  <a href="">GPUArrays.jl</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> -</a> </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> </li><li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kynseed</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> </li></ol><br><p>  , , .    ! </p><br><p><img src="https://habrastorage.org/webt/f2/4o/pr/f24oprfnnrnguwwb03xcyo__xx4.gif"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de455846/">https://habr.com/ru/post/de455846/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de455832/index.html">Verlauf einer einzelnen SQL-Untersuchung</a></li>
<li><a href="../de455834/index.html">Benchmarks für Linux-Server: 5 offene Tools</a></li>
<li><a href="../de455840/index.html">So arbeiten Sie mit mehreren Abfragen. Zusammensetzung, Reduzierer, FP</a></li>
<li><a href="../de455842/index.html">Verbreiten Sie eine einfach verknüpfte Liste. Schnelle Ausgabe</a></li>
<li><a href="../de455844/index.html">Erstellen eines Roslyn-Analysators am Beispiel eines Kapselungstests</a></li>
<li><a href="../de455848/index.html">Technik zum Vermeiden von undefiniertem Verhalten beim Zugriff auf einen Singleton</a></li>
<li><a href="../de455850/index.html">Toolbox für Forscher - Dritte Ausgabe: Finden und Arbeiten mit Quellen</a></li>
<li><a href="../de455852/index.html">Sinuslifting und gleichzeitige Implantation</a></li>
<li><a href="../de455854/index.html">So implementieren Sie Kontextmenüs in iOS 13</a></li>
<li><a href="../de455856/index.html">Drahtloser Temperatur-, Feuchtigkeits- und Atmosphärendrucksensor am nRF52832</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>