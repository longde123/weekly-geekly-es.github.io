<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😰 🖱️ 🎁 Paralelizando tarefas com dependências - exemplo .NET 👵🏿 🙈 🚱</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Olá colegas! 

 Nesta semana, doamos o livro de Manning Concurrency in .NET, um ambicioso livro de complexidade: 



 O autor publicou gentilmente no ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Paralelizando tarefas com dependências - exemplo .NET</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/422571/"> Olá colegas! <br><br>  Nesta semana, doamos o livro de Manning <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Concurrency in .NET,</a> um ambicioso livro de complexidade: <br><br><img src="https://habrastorage.org/webt/d2/wo/xw/d2woxw94fdzsysmnbw2ippieyas.jpeg"><br><br>  O autor publicou gentilmente no site Medium um trecho do capítulo 13, que propomos avaliar muito antes da estreia. <br>  Boa leitura! <br><a name="habracut"></a><br>  Suponha que você precise escrever uma ferramenta que permita executar várias tarefas assíncronas, cada uma com seu próprio conjunto de dependências que afetam a ordem das operações.  Esses problemas podem ser resolvidos com uma execução consistente e imperativa, mas se você deseja obter o desempenho máximo, as operações seqüenciais não funcionarão para você.  Em vez disso, você precisa organizar tarefas paralelas.  Muitos problemas competitivos podem ser interpretados como coleções estáticas de operações atômicas com dependências entre os dados de entrada e saída.  Após a conclusão da operação, sua saída é usada como entrada para outras operações dependentes.  Para otimizar o desempenho, as tarefas devem ser atribuídas com base em suas dependências e o algoritmo deve ser configurado para que as tarefas dependentes sejam executadas o mais seqüencialmente possível e o mais paralelo possível. <br><br>  Você deseja criar um componente reutilizável que execute uma série de tarefas em paralelo e garantir que todas as dependências que possam afetar a ordem das operações sejam levadas em consideração.  Como construir um modelo de programação que garanta o paralelismo básico de uma coleção de operações executadas com eficiência, paralelamente ou sequencialmente, dependendo de quais dependências surgem entre essa operação e outras? <br><br>  <b>Solução: Implementamos o gráfico de dependência usando a classe MailboxProcessor do F # e fornecemos métodos como tarefas padrão para que possam ser consumidos no C #</b> <br><br>  Essa solução é chamada de Gráfico Acíclico Orientado (DAG) e foi projetada para formar um gráfico dividindo operações em sequências de problemas atômicos com dependências bem definidas.  Nesse caso, a essência acíclica do gráfico é importante, pois elimina a possibilidade de conflitos entre tarefas, desde que as tarefas sejam realmente completamente atômicas.  Ao definir um gráfico, é importante entender todas as dependências entre tarefas, especialmente dependências implícitas que podem levar a conflitos ou condições de corrida.  A seguir, é apresentado um exemplo típico de uma estrutura de dados do tipo gráfico, com a qual você pode imaginar as limitações que surgem ao planejar interações entre operações em um determinado gráfico. <br><br>  Um gráfico é uma estrutura de dados extremamente poderosa e é possível escrever algoritmos poderosos com base em sua base. <br><br><img src="https://habrastorage.org/webt/a7/d3/8o/a7d38oxfbvek6koh8cto3d6lxlc.png"><br><br>  <i>Fig.</i>  <i>1 Um gráfico é uma coleção de vértices conectados por arestas.</i>  <i>Nesta representação do gráfico direcionado, o nó 1 depende dos nós 4 e 5, o nó 2 depende do nó 5, o nó 3 depende dos nós 5 e 6, etc.</i> <br><br>  A estrutura do DAG é aplicável como uma estratégia para execução paralela de tarefas, levando em consideração a ordem das dependências, o que melhora a produtividade.  A estrutura desse gráfico pode ser determinada usando a classe <code>MailboxProcessor</code> de F #;  nessa classe, o estado interno das tarefas registradas para execução na forma de dependências de arestas é preservado. <br><br>  <b>Validação de gráfico acíclico orientado</b> <br><br>  Ao trabalhar com qualquer estrutura de dados gráficos, como o DAG, é necessário cuidar do registro correto das arestas.  Por exemplo, voltando à Figura 1: o que acontece se tivermos registrado o nó 2 com dependências no nó 5, mas o nó 5 não existir?  Também pode acontecer que algumas arestas dependam uma da outra, o que resulta em um ciclo orientado.  Na presença de um ciclo orientado, é fundamental executar algumas tarefas em paralelo;  caso contrário, algumas tarefas poderão esperar para sempre que outras pessoas sejam concluídas e ocorrerá um conflito. <br><br>  O problema é resolvido pela classificação topológica: isso significa que podemos ordenar todos os vértices do gráfico para que qualquer aresta saia do vértice com o número mais baixo para o vértice com o número mais alto.  Portanto, se a tarefa A for concluída antes da tarefa B e a tarefa B - antes da tarefa C, que, por sua vez, deve ser concluída antes da tarefa A, um link circular será exibido e o sistema notificará você sobre esse erro, lançando uma exceção.  Se um ciclo orientado surgir no gerenciamento de pedidos, não haverá solução.  Uma verificação desse tipo é chamada "encontrando um ciclo em um gráfico direcionado".  Se um gráfico direcionado satisfaz as regras descritas, é um gráfico acíclico direcionado que é perfeitamente adequado para executar várias tarefas em paralelo, entre as quais existem dependências. <br><br>  A versão completa da Listagem 2, contendo o código de validação do DAG, está no código-fonte online. <br><br>  Na listagem a seguir, a classe F # <code>MailboxProccessor</code> é usada como candidato ideal para implementar um DAG que permite que operações relacionadas à dependência sejam executadas em paralelo.  Primeiro, vamos definir uma união rotulada com a qual gerenciaremos tarefas e cumpriremos suas dependências. <br><br>  Listagem 1 Tipo de mensagem e estrutura de dados para coordenar tarefas de acordo com suas dependências <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TaskMessage</span></span></span><span class="hljs-class"> = // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddTask</span></span></span><span class="hljs-class"> of int * </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TaskInfo</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QueueTask</span></span></span><span class="hljs-class"> of </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TaskInfo</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ExecuteTasks</span></span></span><span class="hljs-class"> and </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TaskInfo</span></span></span><span class="hljs-class"> = // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">B</span></span></span><span class="hljs-class"> { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Context</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">System</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Threading</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ExecutionContext</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Edges</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">array</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Task</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Func</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Task</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EdgesLeft</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Start</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DateTimeOffset</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">End</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DateTimeOffset</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">option</span></span></span><span class="hljs-class"> }</span></span></code> </pre> <br><br>  #A envia o dagAgent base para o <code>ParallelTasksDAG</code> , responsável pela coordenação das tarefas <br><br>  #B Agrupa os detalhes de cada tarefa para concluir <br><br>  O tipo <code>TaskMessage</code> representa os wrappers de mensagens enviados para o agente base do tipo <code>ParallelTasksDAG</code> .  Essas mensagens são usadas para coordenar tarefas e sincronizar dependências.  O tipo <code>TaskInfo</code> contém e <code>TaskInfo</code> os detalhes de tarefas registradas durante a execução do DAG, incluindo bordas de dependência.  O contexto de execução (https://msdn.microsoft.com/en-us/library/system.threading.executioncontext(v=vs.110).aspx) é capturado com a finalidade de acessar informações em execução atrasada, por exemplo, tais informações: current usuário, qualquer estado associado ao encadeamento lógico de execução, informações sobre acesso seguro ao código etc.  Depois que o evento é disparado, os horários de início e término são publicados. <br><br>  Listagem 2 Agente DAG em F # para paralelizar operações relacionadas à dependência <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ParallelTasksDAG</span></span></span><span class="hljs-class">() = let onTaskCompleted = new </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Event</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TaskInfo</span></span></span><span class="hljs-class">&gt;() // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class"> let dagAgent = new </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MailboxProcessor</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TaskMessage</span></span></span><span class="hljs-class">&gt;(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inbox</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rec</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">loop</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tasks</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dictionary</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TaskInfo</span></span></span><span class="hljs-class">&gt;) // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">B</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">edges</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dictionary</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">&gt;) = async { // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">B</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inbox</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Receive</span></span></span><span class="hljs-class">() // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">C</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">match</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ExecuteTasks</span></span></span><span class="hljs-class"> -&gt; // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">D</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fromTo</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dictionary</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">&gt;() </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ops</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dictionary</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TaskInfo</span></span></span><span class="hljs-class">&gt;() // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">E</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">KeyValue</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">in</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tasks</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operation</span></span></span><span class="hljs-class"> = { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EdgesLeft</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Some</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Edges</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Length</span></span></span><span class="hljs-class">) } for from in operation.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Edges</span></span></span><span class="hljs-class"> do let exists, lstDependencies = fromTo.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TryGetValue</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from</span></span></span><span class="hljs-class">) if not &lt;| exists then fromTo.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Add</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from</span></span></span><span class="hljs-class">, [ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operation</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class"> ]) else fromTo.[from] &lt;- (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operation</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class"> :: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lstDependencies</span></span></span><span class="hljs-class">) ops.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Add</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">key</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">operation</span></span></span><span class="hljs-class">) ops |&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Seq</span></span></span><span class="hljs-class">.iter (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">kv</span></span></span><span class="hljs-class"> -&gt; // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">match</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">kv</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Value</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EdgesLeft</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Some(n)</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">when</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">n</span></span></span><span class="hljs-class"> = 0 -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inbox</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Post</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QueueTask</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">kv</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Value</span></span></span><span class="hljs-class">)) | _ -&gt; ()) return! loop ops fromTo | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QueueTask</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">op</span></span></span><span class="hljs-class">) -&gt; // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">G</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Async</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Start</span></span></span><span class="hljs-class"> &lt;| async { // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">G</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">start</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DateTimeOffset</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Now</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">match</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">op</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Context</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">H</span></span></span><span class="hljs-class"> | </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">op</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Task</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Invoke</span></span></span><span class="hljs-class">() |&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Async</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AwaitATsk</span></span></span><span class="hljs-class"> | </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ctx</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ExecutionContext</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Run</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ctx</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CreateCopy</span></span></span><span class="hljs-class">(), // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">I</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">op</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">opCtx</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">op</span></span></span><span class="hljs-class"> :?&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TaskInfo</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">opCtx</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Task</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Invoke</span></span></span><span class="hljs-class">().</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ConfigureAwait(false)</span></span></span><span class="hljs-class">), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">taskInfo</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end'</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DateTimeOffset</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Now</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">onTaskCompleted</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Trigger</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">op</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Start</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Some(start)</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">End</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Some</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end'</span></span></span><span class="hljs-class">) } // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">L</span></span></span><span class="hljs-class"> let exists, deps = edges.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TryGetValue</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">op</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class">) if exists &amp;&amp; deps.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Length</span></span></span><span class="hljs-class"> &gt; 0 then let depOps = getDependentOperation deps tasks [] edges.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Remove</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">op</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class">) |&gt; ignore depOps |&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Seq</span></span></span><span class="hljs-class">.iter (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nestedOp</span></span></span><span class="hljs-class"> -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inbox</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Post</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">QueueTask(nestedOp)</span></span></span><span class="hljs-class">)) } return! loop tasks edges | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddTask</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">op</span></span></span><span class="hljs-class">) -&gt; tasks.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Add</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">op</span></span></span><span class="hljs-class">) // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">M</span></span></span><span class="hljs-class"> return! loop tasks edges } loop (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dictionary</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TaskInfo</span></span></span><span class="hljs-class">&gt;(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HashIdentity</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Structural</span></span></span><span class="hljs-class">)) (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dictionary</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">list</span></span></span><span class="hljs-class">&gt;(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HashIdentity</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Structural</span></span></span><span class="hljs-class">))) [&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CLIEventAttribute</span></span></span><span class="hljs-class">&gt;] member this.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">OnTaskCompleted</span></span></span><span class="hljs-class"> = onTaskCompleted.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Publish</span></span></span><span class="hljs-class"> // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">L</span></span></span><span class="hljs-class"> member this.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ExecuteTasks</span></span></span><span class="hljs-class">() = dagAgent.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Post</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ExecuteTasks</span></span></span><span class="hljs-class"> // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">N</span></span></span><span class="hljs-class"> member this.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddTask</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class">, [&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ParamArray</span></span></span><span class="hljs-class">&gt;] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">edges</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">array</span></span></span><span class="hljs-class">) = let </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Context</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ExecutionContext</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Capture</span></span></span><span class="hljs-class">() </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Edges</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">edges</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Id</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Task</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NumRemainingEdges</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">None</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Start</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">None</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">End</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">None</span></span></span><span class="hljs-class"> } dagAgent.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Post</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AddTask</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">)) // #</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">O</span></span></span></span></code> </pre> <br><br>  <code>onTaskCompletedEvent</code> instância da classe <code>onTaskCompletedEvent</code> , usada para notificar a conclusão de uma tarefa <br><br>  #B Estado interno do agente para rastrear registros de tarefas e suas dependências.  As coleções são mutáveis ​​porque o estado muda durante a execução do <code>ParallelTasksDAG</code> e porque herdaram a segurança do encadeamento porque estão localizadas no Agent <br><br>  #C Aguardando execução de forma assíncrona <br><br>  #D Shell de uma mensagem que inicia o <code>ParallelTasksDAG</code> <br><br>  Coleção #E mapeada em um índice incrementado monotonicamente com uma tarefa a ser executada <br><br>  #F O processo repete a lista de tarefas, analisando dependências com outras tarefas para criar uma estrutura topológica na qual a ordem das tarefas é apresentada <br><br>  #G Wrapper de mensagem para enfileirar uma tarefa, executá-la e, finalmente, para remover esta tarefa do estado do agente como uma dependência ativa após a conclusão da tarefa <br><br>  #H Se o <code>ExecutionContext</code> escolhido for <code>null</code> , execute a tarefa no contexto atual; caso contrário, vá para #I <br><br>  # Executo a tarefa no <code>ExecutionContext</code> interceptado <br><br>  <code>onTaskCompleted</code> e publique o evento <code>onTaskCompleted</code> para notificá-lo da conclusão da tarefa.  O evento contém informações sobre a tarefa. <br><br>  #M Wrapper de mensagem para adicionar uma tarefa a ser executada de acordo com suas dependências, se houver <br><br>  #N Inicia a execução de tarefas registradas <br><br>  #O Adicionando uma tarefa, suas dependências e o <code>ExecutionContext</code> atual para executar o DAG. <br><br>  O objetivo da função <code>AddTask</code> é registrar uma tarefa com arestas de dependência arbitrárias.  Essa função aceita um ID exclusivo, uma tarefa a ser executada e muitas arestas representando os IDs de todas as outras tarefas registradas que devem ser concluídas antes que esta tarefa possa ser concluída.  Se a matriz estiver vazia, significa que não há dependências.  Uma instância do <code>MailboxProcessor</code> chamada <code>dagAgent</code> armazena tarefas registradas no estado atual de “tarefas”, que é um dicionário ( <code>tasks : Dictionary&lt;int, TaskInfo&gt;</code> ) que correlaciona o ID de cada tarefa e seus detalhes.  Além disso, o Agent também armazena o estado das dependências de borda pelo ID de cada tarefa ( <code>edges : Dictionary&lt;int, int list&gt;</code> ).  Quando um agente recebe uma notificação sobre a necessidade de iniciar a execução, como parte desse processo, é verificado se todas as dependências das arestas estão registradas e se não há ciclos no gráfico.  Esta etapa de verificação está disponível na implementação completa do ParallelTasksDAG fornecida no código online.  A seguir, ofereço um exemplo em C #, onde me refiro à biblioteca que F # executa o <code>ParallelTasksDAG</code> (e o consome).  As tarefas registradas refletem as dependências apresentadas acima na Fig.  1 <br><br><pre> <code class="cs hljs">Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, Func&lt;Task&gt;&gt; action = (id, delay) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { Console.WriteLine($”Starting operation{id} <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id {Thread.CurrentThread.ManagedThreadId}…”); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Task.Delay(delay); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dagAsync = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DAG.ParallelTasksDAG(); dagAsync.OnTaskCompleted.Subscribe(op =&gt; Console.WriteLine($”Operation {op.Id} completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id { Thread.CurrentThread.ManagedThreadId}”)); dagAsync.AddTask(<span class="hljs-number"><span class="hljs-number">1</span></span>, action(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span>), <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); dagAsync.AddTask(<span class="hljs-number"><span class="hljs-number">2</span></span>, action(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>), <span class="hljs-number"><span class="hljs-number">5</span></span>); dagAsync.AddTask(<span class="hljs-number"><span class="hljs-number">3</span></span>, action(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">800</span></span>), <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); dagAsync.AddTask(<span class="hljs-number"><span class="hljs-number">4</span></span>, action(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">500</span></span>), <span class="hljs-number"><span class="hljs-number">6</span></span>); dagAsync.AddTask(<span class="hljs-number"><span class="hljs-number">5</span></span>, action(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">450</span></span>), <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>); dagAsync.AddTask(<span class="hljs-number"><span class="hljs-number">6</span></span>, action(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-number"><span class="hljs-number">7</span></span>); dagAsync.AddTask(<span class="hljs-number"><span class="hljs-number">7</span></span>, action(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">900</span></span>)); dagAsync.AddTask(<span class="hljs-number"><span class="hljs-number">8</span></span>, action(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">700</span></span>)); dagAsync.ExecuteTasks();</code> </pre> <br>  O objetivo da função auxiliar é exibir uma mensagem que a tarefa foi iniciada, referindo-se ao <code>Id</code> encadeamento atual para confirmar o multithreading.  <code>OnTaskCompleted</code> evento <code>OnTaskCompleted</code> , por outro lado, é registrado para fornecer uma notificação sobre a conclusão de cada tarefa com a saída do <code>ID</code> da tarefa e do <code>Id</code> encadeamento atual no console.  Aqui está a saída que obtemos ao chamar o método <code>ExecuteTasks</code> . <br><br><pre> <code class="hljs objectivec">Starting operation <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">23</span></span>… Starting operation <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">24</span></span>… Operation <span class="hljs-number"><span class="hljs-number">8</span></span> Completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">23</span></span> Operation <span class="hljs-number"><span class="hljs-number">7</span></span> Completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">24</span></span> Starting operation <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">23</span></span>… Starting operation <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">25</span></span>… Operation <span class="hljs-number"><span class="hljs-number">6</span></span> Completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">25</span></span> Starting operation <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">24</span></span>… Operation <span class="hljs-number"><span class="hljs-number">5</span></span> Completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">23</span></span> Starting operation <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">27</span></span>… Starting operation <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">30</span></span>… Operation <span class="hljs-number"><span class="hljs-number">4</span></span> Completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">24</span></span> Starting operation <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">28</span></span>… Operation <span class="hljs-number"><span class="hljs-number">2</span></span> Completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">27</span></span> Operation <span class="hljs-number"><span class="hljs-number">1</span></span> Completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">28</span></span> Operation <span class="hljs-number"><span class="hljs-number">3</span></span> Completed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Thread Id <span class="hljs-number"><span class="hljs-number">30</span></span></code> </pre> <br>  Como você pode ver, as tarefas são executadas em paralelo em diferentes segmentos (os <code>ID</code> segmentos são diferentes para eles) e a ordem das dependências é preservada. <br><br>  Em essência, é assim que as tarefas com dependências são paralelizadas.  Leia mais no livro Concurrency in .NET. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt422571/">https://habr.com/ru/post/pt422571/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt422553/index.html">Mega extensão oficial do navegador rouba compartilhamento de arquivos e criptomoeda</a></li>
<li><a href="../pt422555/index.html">Arquitetura multi-módulo Android. A a Z</a></li>
<li><a href="../pt422561/index.html">Como a Yandex aplicou a visão computacional para melhorar a qualidade das transmissões de vídeo. Tecnologia DeepHD</a></li>
<li><a href="../pt422565/index.html">Webinars de sexta-feira da Skillbox: tudo para programadores e designers</a></li>
<li><a href="../pt422569/index.html">De hora em hora, aplicativo de rastreamento de tempo</a></li>
<li><a href="../pt422573/index.html">A engenharia reversa da renderização de The Witcher 3</a></li>
<li><a href="../pt422575/index.html">Intercomunicador raro</a></li>
<li><a href="../pt422577/index.html">Cópias e direitos autorais: como a patente e os direitos autorais afetam o desenvolvimento da impressão 3D</a></li>
<li><a href="../pt422581/index.html">Interruptor quântico no estilo Schrödinger</a></li>
<li><a href="../pt422583/index.html">Tough Middling: Revisão do telefone IP Snom D735</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>