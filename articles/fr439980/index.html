<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üàπ üë®üèΩ‚Äçüç≥ ü§πüèæ Apprendre Docker, Partie 3: Fichiers Dockerfile ü§ûüèæ üî¢ üì°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans la traduction de la troisi√®me partie de la s√©rie Docker, nous continuerons √† nous inspirer des p√¢tisseries, √† savoir les bagels. Notre sujet prin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apprendre Docker, Partie 3: Fichiers Dockerfile</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/439980/">  Dans la traduction de la troisi√®me partie de la s√©rie Docker, nous continuerons √† nous inspirer des p√¢tisseries, √† savoir les bagels.  Notre sujet principal aujourd'hui sera de travailler avec Dockerfiles.  Nous analyserons les instructions utilis√©es dans ces fichiers. <br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1: les bases</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2: termes et concepts</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3: Fichiers Dockerfile</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 4: r√©duire la taille des images et acc√©l√©rer leur assemblage</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 5: √©quipes</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 6: travailler avec des donn√©es</a> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29b/15a/6bf/29b15a6bfff06c617017301b30ed95c2.jpg"></div><br>  <i><font color="#999999">Les bagels sont des instructions dans un Dockerfile.</font></i> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Images Docker</font> </h2><br>  Rappelons qu'un conteneur Docker est une image Docker qui prend vie.  Il s'agit d'un syst√®me d'exploitation autonome dans lequel il n'y a que le code d'application et le plus n√©cessaire. <br><br>  Les images Docker sont le r√©sultat du processus de g√©n√©ration et les conteneurs Docker ex√©cutent des images.  Au c≈ìur m√™me de Docker se trouvent les Dockerfiles.  Des fichiers comme celui-ci indiquent √† Docker comment assembler les images √† partir desquelles les conteneurs sont cr√©√©s. <br><br>  Chaque image Docker poss√®de un fichier appel√© Dockerfile.  Son nom est √©crit de cette fa√ßon - sans extension.  Lorsque vous ex√©cutez la <code>docker build</code> pour cr√©er une nouvelle image, il est suppos√© que le Dockerfile se trouve dans le r√©pertoire de travail actuel.  Si ce fichier se trouve √† un autre endroit, son emplacement peut √™tre sp√©cifi√© √† l'aide de l'indicateur <code>-f</code> . <br><br>  Les conteneurs, comme nous l'avons d√©couvert dans le premier mat√©riau de cette s√©rie, sont constitu√©s de couches.  Chaque couche, √† l'exception de la derni√®re, situ√©e au-dessus de toutes les autres, est en lecture seule.  Dockerfile indique au syst√®me Docker quelles couches et dans quel ordre ajouter √† l'image. <br><br>  Chaque couche, en fait, n'est qu'un fichier qui d√©crit le changement de l'√©tat de l'image par rapport √† l'√©tat dans lequel elle se trouvait apr√®s l'ajout de la couche pr√©c√©dente.  Sur Unix, d'ailleurs, presque tout est un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fichier</a> . <br><br>  Une image de base est le calque (ou les calques) source de l'image en cours de cr√©ation.  L'image de base est √©galement appel√©e image parente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a0/b89/6aa/6a0b896aa35c1f735103ae8924d5371d.jpg"></div><br>  <i><font color="#999999">L'image de base est l'endroit o√π l'image Docker commence.</font></i> <br><br>  Lorsqu'une image est t√©l√©charg√©e d'un r√©f√©rentiel distant vers un ordinateur local, seules les couches qui ne sont pas disponibles sur cet ordinateur sont physiquement t√©l√©charg√©es.  Docker vise √† √©conomiser de l'espace et du temps en r√©utilisant les couches existantes. <br><br><h2>  <font color="#3AC1EF">Fichiers Dockerfile</font> </h2><br>  Les Dockerfiles contiennent des instructions pour cr√©er une image.  En majuscules, les lignes de ce fichier commencent.  Suivre les instructions sont leurs arguments.  Les instructions, lors de la construction de l'image, sont trait√©es de haut en bas.  Voici √† quoi √ßa ressemble: <br><br><pre> <code class="plaintext hljs">FROM ubuntu:18.04 COPY . /app</code> </pre> <br>  Les calques de l'image finale sont cr√©√©s uniquement par les instructions <code>FROM</code> , <code>RUN</code> , <code>COPY</code> et <code>ADD</code> .  D'autres instructions d√©finissent quelque chose, d√©crivent des m√©tadonn√©es ou indiquent √† Docker que vous devez faire quelque chose pendant l'ex√©cution du conteneur, par exemple, ouvrir un port ou ex√©cuter une commande. <br><br>  Ici, nous partons de l'hypoth√®se qu'une image Docker bas√©e sur un syst√®me d'exploitation de type Unix est utilis√©e.  Bien s√ªr, ici, vous pouvez √©galement utiliser une image bas√©e sur Windows, mais l'utilisation de Windows est une pratique moins courante, travailler avec de telles images est plus difficile.  Par cons√©quent, si vous en avez l'occasion, utilisez Unix. <br><br>  Pour commencer, voici une liste d'instructions Dockerfile avec de brefs commentaires. <br><br><h2>  <font color="#3AC1EF">Douzaine d'instructions Dockerfile</font> </h2><br><ol><li>  <code>FROM</code> - d√©finit l'image de base (parent). </li><li>  <code>LABEL</code> - d√©crit les m√©tadonn√©es.  Par exemple, des informations sur qui a cr√©√© et g√®re l'image. </li><li>  <code>ENV</code> - d√©finit les variables d'environnement persistantes. </li><li>  <code>RUN</code> - ex√©cute une commande et cr√©e une couche d'image.  Utilis√© pour installer des packages dans un conteneur. </li><li>  <code>COPY</code> - copie les fichiers et dossiers dans le conteneur. </li><li>  <code>ADD</code> - copie les fichiers et les dossiers dans un conteneur, peut d√©compresser les fichiers .tar locaux. </li><li>  <code>CMD</code> - d√©crit une commande avec des arguments qui doit √™tre ex√©cut√©e au lancement du conteneur.  Les arguments peuvent √™tre remplac√©s au d√©marrage du conteneur.  Un fichier ne peut contenir qu'une seule instruction <code>CMD</code> . </li><li>  <code>WORKDIR</code> - d√©finit le r√©pertoire de travail pour l'instruction suivante. </li><li>  <code>ARG</code> - d√©finit les variables pour passer Docker lors de la construction de l'image. </li><li>  <code>ENTRYPOINT</code> - Fournit une commande avec des arguments √† invoquer pendant l'ex√©cution du conteneur.  Les arguments ne sont pas remplac√©s. </li><li>  <code>EXPOSE</code> - indique la n√©cessit√© d'ouvrir le port. </li><li>  <code>VOLUME</code> - cr√©e un point de montage pour travailler avec un stockage persistant. </li></ol><br>  Parlons maintenant de ces instructions. <br><br><h2>  <font color="#3AC1EF">Instructions et exemples d'utilisation</font> </h2><br><h3>  <font color="#3AC1EF">DockSimple Dockerfile</font> </h3><br>  Dockerfile peut √™tre extr√™mement simple et court.  Par exemple - comme ceci: <br><br><pre> <code class="plaintext hljs">FROM ubuntu:18.04</code> </pre> <br><h3>  <font color="#3AC1EF">‚ñçDe l'instruction</font> </h3><br>  Le Dockerfile doit commencer par une instruction <code>FROM</code> ou par une instruction <code>ARG</code> suivie d'une instruction <code>FROM</code> . <br><br>  Le mot cl√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FROM</a> indique √† Docker d'utiliser une image de base qui correspond au nom et √† la balise fournis lors de la cr√©ation de l'image.  De plus, l'image de base est √©galement appel√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">image parente</a> . <br><br>  Dans cet exemple, l'image de base est stock√©e dans le r√©f√©rentiel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ubuntu</a> .  Ubuntu est le nom du r√©f√©rentiel Docker officiel, qui fournit la version de base de la c√©l√®bre famille de syst√®mes d'exploitation Linux appel√©e Ubuntu. <br><br>  Veuillez noter que le Dockerfile en question comprend une balise <code>18.04</code> qui sp√©cifie l'image de base dont nous avons besoin.  C'est cette image qui sera charg√©e lors de la construction de notre image.  Si la balise n'est pas incluse dans l'instruction, Docker part de l'hypoth√®se que la derni√®re image du r√©f√©rentiel est requise.  Afin d'exprimer plus clairement leurs intentions, il est recommand√© que l'auteur du Dockerfile indique de quelle image il a besoin. <br><br>  Lorsque le Dockerfile ci-dessus est utilis√© sur la machine locale pour cr√©er l'image pour la premi√®re fois, Docker charge les couches d√©finies par l'image <code>ubuntu</code> .  Ils peuvent √™tre imagin√©s superpos√©s les uns aux autres.  Chaque couche suivante est un fichier d√©crivant les diff√©rences de l'image par rapport √† l'√©tat dans lequel elle se trouvait apr√®s y avoir ajout√© la couche pr√©c√©dente. <br><br>  Lorsque vous cr√©ez un conteneur, un calque dans lequel vous pouvez apporter des modifications est ajout√© au-dessus de tous les autres calques.  Les donn√©es des couches restantes peuvent uniquement √™tre lues. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/912/530/d4f/912530d4f3468f0bff2a064d58d62caf.jpg"></div><br>  <i><font color="#999999">Structure du conteneur (extraite de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> )</font></i> <br><br>  Docker, par souci d'efficacit√©, utilise une strat√©gie de copie sur √©criture.  Si le calque de l'image existe au niveau pr√©c√©dent et qu'un calque doit en lire des donn√©es, Docker utilise le fichier existant.  Vous n'avez rien √† t√©l√©charger. <br><br>  Lorsque l'image est ex√©cut√©e, si le calque doit √™tre modifi√© au moyen du conteneur, le fichier correspondant est copi√© dans le calque mutable le plus haut.  Pour en savoir plus sur la strat√©gie de copie sur √©criture, consultez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce</a> mat√©riel dans la documentation Docker. <br><br>  Nous continuons la discussion des instructions utilis√©es dans le Dockerfile, en donnant un exemple d'un tel fichier avec une structure plus complexe. <br><br><h3>  <font color="#3AC1EF">DockFichier docker plus sophistiqu√©</font> </h3><br>  Bien que le Dockerfile que nous venons de passer en revue se soit av√©r√© net et compr√©hensible, il est trop simple, il n'utilise qu'une seule instruction.  De plus, aucune instruction n'est appel√©e lors de l'ex√©cution du conteneur.  Jetez un oeil √† un autre fichier qui recueille une petite image.  Il dispose de m√©canismes qui d√©terminent les commandes qui sont appel√©es lors de l'ex√©cution du conteneur. <br><br><pre> <code class="plaintext hljs">FROM python:3.7.2-alpine3.8 LABEL maintainer="jeffmshale@gmail.com" ENV ADMIN="jeff" RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash COPY . ./app ADD https://raw.githubusercontent.com/discdiver/pachy-vid/master/sample_vids/vid1.mp4 \ /my_app_directory RUN ["mkdir", "/a_directory"] CMD ["python", "./my_script.py"]</code> </pre> <br>  √Ä premi√®re vue, ce fichier peut sembler plut√¥t compliqu√©.  Par cons√©quent, traitons-le avec lui. <br><br>  La base de cette image est l'image Python officielle avec la balise 3.7.2-alpine3.8.  Apr√®s avoir analys√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce</a> code, vous pouvez voir que cette image de base inclut Linux, Python et, dans l'ensemble, cela se limite √† sa composition.  Les images Alpine OS sont tr√®s populaires dans le monde Docker.  Le fait qu'ils sont de petite taille, haute vitesse et s√©curit√©.  Cependant, les images Alpine ne diff√®rent pas par les larges capacit√©s typiques des syst√®mes d'exploitation conventionnels.  Par cons√©quent, afin de collecter quelque chose d'utile sur la base d'une telle image, le cr√©ateur de l'image doit installer les packages dont il a besoin. <br><br><h3>  <font color="#3AC1EF">‚ñçInstruction LABEL</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/839/d5d/720/839d5d7205849f8dee228dcd7a42eaf7.jpg"></div><br>  <i><font color="#999999">Balises</font></i> <br><br>  L' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">instruction LABEL</a> (√©tiquette) vous permet d'ajouter des m√©tadonn√©es √† l'image.  Dans le cas du fichier en cours d'examen, il contient les coordonn√©es du cr√©ateur de l'image.  La d√©claration d'√©tiquettes ne ralentit pas le processus d'assemblage d'image et n'augmente pas sa taille.  Ils ne contiennent que des informations utiles sur l'image Docker, il est donc recommand√© de les inclure dans le fichier.  Des d√©tails sur l'utilisation des m√©tadonn√©es dans le Dockerfile peuvent √™tre trouv√©s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><h3>  <font color="#3AC1EF">‚ñçInv instruction</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d85/1a1/4d7/d851a14d7b7f4db671afe3b375cb4596.jpg"></div><br>  <i><font color="#999999">L'environnement</font></i> <br><br>  L'instruction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ENV</a> vous permet de d√©finir des variables d'environnement constantes qui seront disponibles dans le conteneur lors de son ex√©cution.  Dans l'exemple pr√©c√©dent, apr√®s avoir cr√©√© le conteneur, vous pouvez utiliser la variable <code>ADMIN</code> . <br><br>  L'instruction <code>ENV</code> est bien adapt√©e pour d√©finir des constantes.  Si vous utilisez plusieurs fois une certaine valeur dans le Dockerfile, par exemple, lorsque vous d√©crivez les commandes qui s'ex√©cutent dans le conteneur, et que vous pensez qu'un jour vous devrez peut-√™tre la changer en une autre, il est logique de l'√©crire dans une constante similaire. <br><br>  Il convient de noter que dans les fichiers Dockerfile, il existe souvent diff√©rentes mani√®res de r√©soudre les m√™mes probl√®mes.  Quelle est exactement la question √† utiliser, dont la d√©cision est influenc√©e par la volont√© de se conformer aux m√©thodes de travail adopt√©es dans l'environnement Docker, afin d'assurer la transparence de la solution et ses hautes performances.  Par exemple, les <code>ENTRYPOINT</code> <code>RUN</code> , <code>CMD</code> et <code>ENTRYPOINT</code> des objectifs diff√©rents, mais elles sont toutes utilis√©es pour ex√©cuter des commandes. <br><br><h3>  <font color="#3AC1EF">Instruction UNRUN</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/910/a89/72b/910a8972b92a69418d859a1fbd550ae5.jpg"></div><br>  <i><font color="#999999">Instruction RUN</font></i> <br><br>  L'instruction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RUN</a> vous permet de cr√©er un calque lors de la cr√©ation de l'image.  Apr√®s son ex√©cution, un nouveau calque est ajout√© √† l'image, son √©tat est fixe.  L'instruction <code>RUN</code> est souvent utilis√©e pour installer des packages suppl√©mentaires dans les images.  Dans l'exemple pr√©c√©dent, l'instruction <code>RUN apk update &amp;&amp; apk upgrade</code> indique √† Docker que le syst√®me doit mettre √† jour les packages √† partir de l'image de base.  Apr√®s ces deux commandes se trouve la commande <code>&amp;&amp; apk add bash</code> , indiquant que bash doit √™tre install√© dans l'image. <br><br>  Ce qui ressemble √† <code>apk</code> dans les √©quipes est une abr√©viation pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Alpine Linux package manager</a> .  Si vous utilisez l'image de base d'un autre syst√®me d'exploitation de la famille Linux, alors, par exemple, lorsque vous utilisez Ubuntu, vous pouvez avoir besoin d'une commande de la forme <code>RUN apt-get</code> pour installer les packages.  Plus tard, nous parlerons d'autres fa√ßons d'installer des packages. <br><br>  L'instruction <code>RUN</code> et des instructions similaires, telles que <code>CMD</code> et <code>ENTRYPOINT</code> , peuvent √™tre utilis√©es soit sous la forme <code>ENTRYPOINT</code> , soit sous forme de shell.  Le formulaire exec utilise une syntaxe qui ressemble √† la description d'un tableau JSON.  Par exemple, cela pourrait ressembler √† ceci: <code>RUN ["my_executable", "my_first_param1", "my_second_param2"]</code> . <br><br>  Dans l'exemple pr√©c√©dent, nous avons utilis√© la forme shell de l'instruction RUN comme suit: <code>RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash</code> . <br><br>  Plus tard dans notre Dockerfile, nous avons utilis√© la forme exec de l'instruction <code>RUN</code> , sous la forme <code>RUN ["mkdir", "/a_directory"]</code> pour cr√©er un r√©pertoire.  Dans le m√™me temps, en utilisant les instructions de ce formulaire, vous devez vous rappeler la n√©cessit√© de formater les cha√Ænes avec des guillemets doubles, comme c'est la coutume au format JSON. <br><br><h3>  <font color="#3AC1EF">‚ñç COPIE D'INSTRUCTION</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ba/8b7/b82/5ba8b7b82e09854f7ba3ac1d2ad5b404.jpg"></div><br>  <i><font color="#999999">Instruction COPY</font></i> <br><br>  L'instruction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">COPY</a> est pr√©sent√©e dans notre fichier comme ceci: <code>COPY . ./app</code>  <code>COPY . ./app</code> .  Elle indique √† Docker qu'elle doit extraire des fichiers et des dossiers du contexte local de l'assembly et les ajouter au r√©pertoire de travail actuel de l'image.  Si le r√©pertoire de destination n'existe pas, cette instruction le cr√©era. <br><br><h3>  <font color="#3AC1EF">‚ñçInstruction AJOUTER</font> </h3><br>  L'instruction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ADD</a> vous permet de r√©soudre les m√™mes probl√®mes que <code>COPY</code> , mais quelques <code>COPY</code> utilisation suppl√©mentaires lui sont associ√©s.  Ainsi, en utilisant cette instruction, vous pouvez ajouter des fichiers t√©l√©charg√©s √† partir de sources distantes dans le conteneur, ainsi que d√©compresser les fichiers .tar locaux. <br><br>  Dans cet exemple, l'instruction <code>ADD</code> √©t√© utilis√©e pour copier un fichier accessible par URL dans le <code>my_app_directory</code> conteneur <code>my_app_directory</code> .  Il convient de noter, cependant, que la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation Docker</a> ne recommande pas l'utilisation de tels fichiers obtenus par URL, car ils ne peuvent pas √™tre supprim√©s et qu'ils augmentent la taille de l'image. <br><br>  En outre, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> sugg√®re, dans la mesure du possible, que vous <code>COPY</code> instruction <code>COPY</code> au lieu de l'instruction <code>ADD</code> pour rendre le Dockerfile plus facile √† comprendre.  Je suppose que l'√©quipe de d√©veloppement Docker devrait combiner <code>ADD</code> et <code>COPY</code> en une seule instruction afin que ceux qui cr√©ent les images n'aient pas √† se souvenir de trop d'instructions. <br><br>  Notez que l'instruction <code>ADD</code> contient le caract√®re de saut de ligne - <code>\</code> .  Ces caract√®res sont utilis√©s pour am√©liorer la lisibilit√© des commandes longues en les divisant en plusieurs lignes. <br><br><h3>  <font color="#3AC1EF">‚ñç Instruction CMD</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/505/835/d13/505835d13cd3c9300f0d95681b3dbf93.jpg"></div><br>  <i><font color="#999999">Instruction CMD</font></i> <br><br>  L'instruction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CMD</a> fournit √† Docker une commande √† ex√©cuter au d√©marrage du conteneur.  Les r√©sultats de cette commande ne sont pas ajout√©s √† l'image lors de son assemblage.  Dans notre exemple, cette commande lance le script <code>my_script.py</code> au moment de l'ex√©cution. <br><br>  Voici autre chose que vous devez savoir sur l'instruction <code>CMD</code> : <br><br><ul><li>  Une seule instruction <code>CMD</code> peut √™tre pr√©sente dans un Dockerfile.  S'il y a plusieurs instructions de ce type dans le fichier, le syst√®me ignorera tout sauf la derni√®re. </li><li>  Une instruction <code>CMD</code> peut avoir une forme ex√©cutable.  Si l'instruction n'inclut pas la r√©f√©rence au fichier ex√©cutable, alors l'instruction <code>ENTRYPOINT</code> doit √™tre pr√©sente dans le fichier.  Dans ce cas, ces deux instructions doivent √™tre au <code>JSON</code> . </li><li>  Les arguments de ligne de commande pass√©s √† <code>docker run</code> remplacent les arguments fournis par l'instruction <code>CMD</code> dans le Dockerfile. </li></ul><br><h3>  <font color="#3AC1EF">DockUn Dockerfile encore plus complexe</font> </h3><br>  Prenons un autre Dockerfile, dans lequel de nouvelles commandes seront utilis√©es. <br><br><pre> <code class="plaintext hljs">FROM python:3.7.2-alpine3.8 LABEL maintainer="jeffmshale@gmail.com" #   RUN apk add --update git #     WORKDIR /usr/src/my_app_directory #          COPY . . #       ARG my_var=my_default_value #  ,           ENTRYPOINT ["python", "./app/my_script.py", "my_var"] #   EXPOSE 8000 #      VOLUME /my_volume</code> </pre> <br>  Dans cet exemple, entre autres choses, vous pouvez voir les commentaires commen√ßant par le caract√®re <code>#</code> . <br>  Dockerfile fait notamment l'installation de packages.  Comme d√©j√† mentionn√©, il existe diff√©rentes fa√ßons d'installer des packages √† l'aide de l'instruction <code>RUN</code> . <br><br>  Les packages dans l'image Alpine Docker peuvent √™tre install√©s √† l'aide d' <code>apk</code> .  Pour cela, comme nous l'avons d√©j√† dit, une commande de la forme <code>RUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add bash</code> . <br><br>  De plus, les packages Python dans l'image peuvent √™tre install√©s √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pip</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wheel</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conda</a> .  Si nous ne parlons pas de Python, mais d'autres langages de programmation, alors d'autres gestionnaires de paquets peuvent √™tre utilis√©s pour pr√©parer les images correspondantes. <br><br>  Dans le m√™me temps, pour que l'installation soit possible, la couche sous-jacente doit fournir au gestionnaire de packages un gestionnaire de packages appropri√©.  Par cons√©quent, si vous rencontrez des probl√®mes lors de l'installation de packages, assurez-vous que le gestionnaire de packages est install√© avant d'essayer de l'utiliser. <br><br>  Par exemple, vous pouvez utiliser l'instruction <code>RUN</code> dans un Dockerfile pour installer une liste de packages √† l'aide de <code>pip</code> .  Si vous faites cela, combinez toutes les commandes en une seule instruction et s√©parez-la avec des caract√®res de saut de ligne en utilisant le caract√®re <code>\</code> .  Gr√¢ce √† cette approche, les fichiers seront nets et cela conduira √† ajouter moins de couches √† l'image que ce qui serait ajout√© √† l'aide de plusieurs instructions <code>RUN</code> . <br><br>  De plus, vous pouvez faire diff√©rentes choses pour installer plusieurs packages.  Vous pouvez les r√©pertorier dans un fichier et transf√©rer ce fichier vers le gestionnaire de packages √† l'aide de <code>RUN</code> .  Ces fichiers sont g√©n√©ralement appel√©s <code>requirements.txt</code> . <br><br><h3>  <font color="#3AC1EF">‚ñç Instruction WORKDIR</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/528/9ef/88f/5289ef88f3bc5fc7e4856fdc13d9872e.jpg"></div><br>  <i><font color="#999999">R√©pertoires de travail</font></i> <br><br>  L'instruction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WORKDIR vous</a> permet de modifier le r√©pertoire de travail du conteneur.  Les <code>ENTRYPOINT</code> <code>COPY</code> , <code>ADD</code> , <code>RUN</code> , <code>CMD</code> et <code>ENTRYPOINT</code> qui suivent <code>WORKDIR</code> fonctionnent avec ce r√©pertoire.  Voici quelques fonctionnalit√©s li√©es √† cette instruction: <br><br><ul><li>  Il est pr√©f√©rable de d√©finir des chemins absolus vers des dossiers avec <code>WORKDIR</code> plut√¥t que de naviguer dans le syst√®me de fichiers √† l'aide des commandes <code>cd</code> dans le Dockerfile. </li><li>  L'instruction <code>WORKDIR</code> cr√©e automatiquement un r√©pertoire s'il n'existe pas. </li><li>  Vous pouvez utiliser plusieurs instructions <code>WORKDIR</code> .  Si des instructions relatives sont fournies √† ces instructions, chacune d'elles modifie le r√©pertoire de travail actuel. </li></ul><br><h3>  <font color="#3AC1EF">‚ñçGuide ARG</font> </h3><br>  L'instruction <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ARG</a> vous permet de d√©finir une variable dont la valeur peut √™tre transmise de la ligne de commande √† l'image lors de son assemblage.  La valeur de la variable par d√©faut peut √™tre repr√©sent√©e dans le Dockerfile.  Par exemple: <code>ARG my_var=my_default_value</code> . <br><br>  Contrairement aux variables <code>ENV</code> variables <code>ARG</code> ne sont pas disponibles au moment de l'ex√©cution.  Cependant, les variables <code>ARG</code> peuvent √™tre utilis√©es pour d√©finir les valeurs par d√©faut des variables <code>ENV</code> √† partir de la ligne de commande lors de la cr√©ation de l'image.  Et les variables <code>ENV</code> seront d√©j√† disponibles dans le conteneur lors de son ex√©cution.  Des d√©tails sur cette technique de travail avec des variables peuvent √™tre trouv√©s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><h3>  <font color="#3AC1EF">POINT D'ENTR√âE DE L'INSTRUCTION</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c2f/8b8/e95/c2f8b8e95436c097571b44810ac97a7a.jpg"></div><br>  <i><font color="#999999">Point de transition vers un endroit</font></i> <br><br>  L' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">instruction ENTRYPOINT vous</a> permet de sp√©cifier une commande avec des arguments qui doivent √™tre ex√©cut√©s au d√©marrage du conteneur.  Elle est similaire √† la commande <code>CMD</code> , mais les param√®tres sp√©cifi√©s dans <code>ENTRYPOINT</code> ne sont pas remplac√©s si le conteneur est d√©marr√© avec des param√®tres de ligne de commande. <br><br>  Au lieu de cela, les arguments de ligne de commande pass√©s dans les constructions du formulaire <code>docker run my_image_name</code> sont ajout√©s aux arguments sp√©cifi√©s par l' <code>ENTRYPOINT</code> .  Par exemple, apr√®s avoir ex√©cut√© une commande du formulaire <code>docker run my_image bash</code> argument <code>docker run my_image bash</code> sera ajout√© √† la fin de la liste des arguments sp√©cifi√©s par <code>ENTRYPOINT</code> .  Lors de la pr√©paration de votre Dockerfile, n'oubliez pas les <code>ENTRYPOINT</code> <code>CMD</code> ou <code>ENTRYPOINT</code> . <br><br>  Il existe plusieurs recommandations dans la documentation de Docker concernant l'instruction, <code>CMD</code> ou <code>ENTRYPOINT</code> , √† choisir comme outil pour ex√©cuter des commandes au d√©marrage du conteneur: <br><br><ul><li>  Si vous devez ex√©cuter la m√™me commande √† chaque d√©marrage du conteneur, utilisez <code>ENTRYPOINT</code> . </li><li>  Si le conteneur sera utilis√© comme application, utilisez <code>ENTRYPOINT</code> . </li><li>  Si vous savez que lorsque vous d√©marrez le conteneur, vous devez lui passer des arguments qui peuvent remplacer les arguments sp√©cifi√©s dans le Dockerfile, utilisez <code>CMD</code> . </li></ul><br>  Dans notre exemple, l'utilisation de l'instruction <code>ENTRYPOINT ["python", "my_script.py", "my_var"]</code> oblige le conteneur, lorsqu'il d√©marre, √† ex√©cuter le script Python <code>my_script.py</code> avec l'argument <code>my_var</code> .  La valeur repr√©sent√©e par <code>my_var</code> peut ensuite √™tre utilis√©e dans le script en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">argparse</a> .    ,   Dockerfile  <code>my_var</code> ,   ,       <code>ARG</code> .  ,         ,     . <br><br>  Docker   exec- <code>ENTRYPOINT</code> : <code>ENTRYPOINT ["executable", "param1", "param2"]</code> . <br><br><h3> <font color="#3AC1EF">‚ñç EXPOSE</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee1/cca/45e/ee1cca45e3fd7e9be988556536fb1633.jpg"></div><br> <i><font color="#999999"> EXPOSE</font></i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">EXPOSE</a>   ,      ,          .     . , ,     ,   ,   ,  ,   . <br><br>      ( )    ,    <code>docker run</code>   <code>-p</code> .      <code>-P</code> (   <code>P</code> ),     ,    <code>EXPOSE</code> . <br><br><h3> <font color="#3AC1EF">‚ñç VOLUME</font> </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c1/ff6/a57/7c1ff6a5765f28cbd3d68cbf60d6b4aa.jpg"></div><br> <i><font color="#999999"> VOLUME</font></i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VOLUME</a>   ,              .     . <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>     ,       Dockerfile.      .  ,      ,  <code>USER</code> , <code>ONBUILD</code> , <code>STOPSIGNAL</code> , <code>SHELL</code>  <code>HEALTHCHECK</code> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>     Dockerfile. <br><br> ,  Dockerfile ‚Äî     Docker,      ,        .          ,       . <br><br>  <b>Chers lecteurs!</b>    Docker  ,    ,    Docker-. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr439980/">https://habr.com/ru/post/fr439980/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr439970/index.html">Rapport sur les probl√®mes et l'accessibilit√© d'Internet en 2018-2019</a></li>
<li><a href="../fr439972/index.html">io_submit: une alternative √† epoll dont vous n'avez jamais entendu parler</a></li>
<li><a href="../fr439974/index.html">Transformation agile personnelle: un parcours flexible vers la productivit√©</a></li>
<li><a href="../fr439976/index.html">Node.js sera-t-il toujours plus lent que Golang?</a></li>
<li><a href="../fr439978/index.html">Docker d'apprentissage, Partie 2: Termes et concepts</a></li>
<li><a href="../fr439982/index.html">Tutoriel React, Partie 16: La quatri√®me phase de travail sur une application TODO, Traitement des √©v√©nements</a></li>
<li><a href="../fr439984/index.html">Tutoriel React, Partie 17: Cinqui√®me √©tape du travail sur une application TODO, modification de l'√©tat des composants</a></li>
<li><a href="../fr439986/index.html">Contre les menaces contre la technologie de conteneurisation</a></li>
<li><a href="../fr439988/index.html">Technosph√®re cinq ans</a></li>
<li><a href="../fr439990/index.html">Le livre ¬´AI pragmatique. Apprentissage automatique et technologie cloud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>