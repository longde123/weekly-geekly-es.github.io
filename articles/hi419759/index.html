<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЪ╡ЁЯП╝ ЁЯев ЁЯШЯ рдЖрдВрддрд░рд┐рдХ рдбреАрдПрд╕рдПрд▓ рдФрд░ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреЗрдбрд╝ - рдХреНрд░рдордмрджреНрдз, рдХреЙрдкреА, рдХреНрд▓реЛрди, рд╕рдорд╛рди рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдЧрддрд┐рд╢реАрд▓ рдирд┐рд░реНрдорд╛рдг (рднрд╛рдЧ I) ЁЯзХЁЯП┐ ЁЯПг ЁЯдЩЁЯП╜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдпрд╣ рд▓реЗрдЦ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреЗрдбрд╝ рдПрдкреАрдЖрдИ рдХреЗ рджреЛрд╣рд░реЗ рдЙрдкрдпреЛрдЧ рдкрд░ рдХреЗрдВрджреНрд░рд┐рдд рд╣реИ - рднрд╛рд╡реЛрдВ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдХреЛрдб рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреНрд░рд╕реНрддреБрддрд┐ рд╕рдВрд░рдЪ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЖрдВрддрд░рд┐рдХ рдбреАрдПрд╕рдПрд▓ рдФрд░ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреЗрдбрд╝ - рдХреНрд░рдордмрджреНрдз, рдХреЙрдкреА, рдХреНрд▓реЛрди, рд╕рдорд╛рди рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рдЧрддрд┐рд╢реАрд▓ рдирд┐рд░реНрдорд╛рдг (рднрд╛рдЧ I)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419759/"><p><img src="https://habrastorage.org/webt/_c/m3/gr/_cm3grewmg9yewpcch1nqkl2ho8.png"></p><br><p>  рдпрд╣ рд▓реЗрдЦ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреЗрдбрд╝</a> рдПрдкреАрдЖрдИ рдХреЗ рджреЛрд╣рд░реЗ рдЙрдкрдпреЛрдЧ рдкрд░ рдХреЗрдВрджреНрд░рд┐рдд рд╣реИ - рднрд╛рд╡реЛрдВ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдХреЛрдб рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред  рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреНрд░рд╕реНрддреБрддрд┐ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддреА рд╣реИ (рд╡реЗ рд╕рдорд╕реНрдпрд╛-рдЙрдиреНрдореБрдЦ рднрд╛рд╖рд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрдВрддрд░рд┐рдХ рдбреАрдПрд╕рдПрд▓</a> рдХреА рдкреНрд░рд╕реНрддреБрддрд┐ рд╕рдВрд░рдЪрдирд╛рдПрдВ рднреА рд╣реИрдВ), рдФрд░ рдХреЛрдб рдкреАрдврд╝реА рдЖрдкрдХреЛ рдЧрддрд┐рд╢реАрд▓ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ - рдкреНрд░рд╕реНрддреБрддрд┐ рд╕рдВрд░рдЪрдирд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рд╕реЗрдЯред </p><br><p> рдореИрдВ <strong>рд╕рдВрдкрддреНрддрд┐ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ</strong> рдХреЗ рдЧрддрд┐рд╢реАрд▓ рдирд┐рд░реНрдорд╛рдг рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдХрд░реВрдВрдЧрд╛ <strong>: рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХ, рдкреНрд░рддрд┐рд▓рд┐рдкрд┐, рдХреНрд▓реЛрди, рдмрд░рд╛рдмрд░реА</strong> ред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдХреНрд░рдорд╛рдВрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдореИрдВ рдЖрдкрдХреЛ рджрд┐рдЦрд╛рддрд╛ рд╣реВрдВ рдХрд┐ рдХреНрд▓рд╛рд╕рд┐рдХ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдХреНрд░рдорд╛рдВрдХрди (рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХреЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ) рдХреЛ рдХреИрд╕реЗ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП, рдЬрд╣рд╛рдВ рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдмреЗрд╣рддрд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП "рдкреНрд░рд╛рд░рдВрднрд┐рдХ" рдЬреНрдЮрд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╡рд┐рдЪрд╛рд░ рдпрд╣ рд╣реИ рдХрд┐ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХ рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ "рдиреЙрди-рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ" рдлрд╝рдВрдХреНрд╢рди рд╣рдореЗрд╢рд╛ рдЦреЛ рдЬрд╛рдПрдЧрд╛, рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рдмрд╛рдж рдХрд┐ рдХреМрди рд╕рд╛ рдкреЗрдбрд╝ рдЖрд╕рдкрд╛рд╕ рдкрд╣реБрдВрдЪрддрд╛ рд╣реИред  рдЙрд╕реА рд╕рдордп, рдЗрд╕ рддрд░рд╣ рдХреЗ рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХ рдХреЛ "рд╣рд╛рде рд╕реЗ рдирд╣реАрдВ" рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдкреВрд░реНрд╡рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдмрд╛рдИрдкрд╛рд╕ рдирд┐рдпрдореЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░ред  <strong>рдкреНрд░рд╕реНрддрд╛рд╡рд┐рдд рдЗрдирд░реНрдирд▓ рдбреАрдПрд╕рдПрд▓ рдЕрдкрдиреЗ рдЧреБрдгреЛрдВ / рдЧреБрдгреЛрдВ (рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рд╕реНрдерд┐рддрд┐ рдореЗрдВ: рдиреЛрдбреНрд╕ рдХреЗ рдирд╛рдо рдХреЗ рд╕рд╛рде рд╕рдВрдЧрдгрдирд╛ рдХреЗ рдкреЗрдбрд╝ рдХреЛ рдкреАрдЫреЗ рдЫреЛрдбрд╝рддреЗ рд╣реБрдП) рджреНрд╡рд╛рд░рд╛ рд╡рд╕реНрддреБрдУрдВ рдХреА рдкреЗрдбрд╝ рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХреА рдЯреНрд░реИрд╡рд░реНрд╕рд┐рдВрдЧ рдХреЗ рдирд┐рдпрдореЛрдВ рдХреЗ рдПрдХ рдХреЙрдореНрдкреИрдХреНрдЯ рд╡рд┐рд╡рд░рдг рдХреА рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╣рд▓ рдХрд░рддрд╛ рд╣реИ</strong> ред  рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХ рдмреЗрдВрдЪрдорд╛рд░реНрдХ рдорд╛рдореВрд▓реА рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЖрдВрддрд░рд┐рдХ <strong>рдбреАрдПрд╕рдПрд▓</strong> рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдЖрд╕рдкрд╛рд╕ рдирд┐рд░реНрдорд┐рдд рджреГрд╖реНрдЯрд┐рдХреЛрдг рдореЗрдВ <strong>рд╢рд╛рдорд┐рд▓ рд╣реИ</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдИрдПрдл рдХреЛрд░</a> рд╕реЗ рд╢рд╛рдорд┐рд▓ / рддрдм рдХреА рдПрдХ рдмреЛрд▓реА) рдФрд░ рд╕рдордЧреНрд░ рд░реВрдк рд╕реЗ рдЖрдВрддрд░рд┐рдХ рдбреАрдПрд╕рдПрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ, рдЖрд╡рд╢реНрдпрдХ рджреГрдврд╝рддрд╛ рд╣реИред </p><a name="habracut"></a><br><h2 id="vvedenie">  рдкрд░рд┐рдЪрдп </h2><br><p>  рдХреА рддреБрд▓рдирд╛ рдХрд░реЗрдВ: </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(){X=<span class="hljs-number"><span class="hljs-number">-1</span></span>,Y=<span class="hljs-number"><span class="hljs-number">1</span></span>}; <span class="hljs-comment"><span class="hljs-comment">// which has better performance ? var json1 = JsonConvert.SerializeObject(p); var json2 = $"{{\"X\":{pX}, \"Y\":{pY}}}";</span></span></code> </pre> <br><p>  рджреВрд╕рд░реА рд╡рд┐рдзрд┐ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рддреЗрдЬрд╝ рд╣реИ (рдиреЛрдбреНрд╕ рдЬреНрдЮрд╛рдд рд╣реИрдВ рдФрд░ "рдХреЛрдб рдореЗрдВ crammed" рд╣реИрдВ), рдЬрдмрдХрд┐ рд╡рд┐рдзрд┐ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИред  рд▓реЗрдХрд┐рди рдЬрдм рдЖрдкрдХреЛ рдпрд╣ рдХреЛрдб рдПрдХ рдлрд╝рдВрдХреНрд╢рди (рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рдФрд░ рд╕рдВрдХрд▓рд┐рдд) рдХреЗ рд░реВрдк рдореЗрдВ рдорд┐рд▓рддрд╛ рд╣реИ, рддреЛ рдЬрдЯрд┐рд▓рддрд╛ рдЫрд┐рдкреА рд╣реЛрддреА рд╣реИ (рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЬреЛ рдЕрд╕реНрдкрд╖реНрдЯ рд╣реЛ рдЬрд╛рддреА рд╣реИ рд╡рд╣ рдЫрд┐рдкреА рд╣реЛрддреА рд╣реИ) <br>  рдХрд╣рд╛рдВ рдкреНрд░рддрд┐рдмрд┐рдВрдм рд╣реИ рдФрд░ рдХреЛрдб рдкреАрдврд╝реА рд░рдирдЯрд╛рдЗрдо рдХрд╣рд╛рдВ рд╣реИ)ред </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(){X=<span class="hljs-number"><span class="hljs-number">-1</span></span>,Y=<span class="hljs-number"><span class="hljs-number">1</span></span>}; <span class="hljs-comment"><span class="hljs-comment">// which has better performance ? var json1 = JsonConvert.SerializeObject(p); var formatter = JsonManager.ComposeFormatter&lt;Point&gt;(); var json2 = formatter(p);</span></span></code> </pre> <br><p>  рдпрд╣рд╛рдБ <code>JsonManager.ComposeFormatter</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЕрд╕рд▓реА рдЯреВрд▓ рд╣реИ</a> ред  рд╡рд╣ рдирд┐рдпрдо рдЬрд┐рд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдХреНрд░рдорд╛рдВрдХрди рдХреЗ рджреМрд░рд╛рди рд╕рдВрд░рдЪрдирд╛ рдмрд╛рдИрдкрд╛рд╕ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ, рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ "рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рд╕рд╛рде, рдХрд╕реНрдЯрдо рдореВрд▓реНрдп рдкреНрд░рдХрд╛рд░ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рд╕реНрддрд░ рдХреЗ рд╕рднреА рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЗ рдЖрд╕рдкрд╛рд╕ рдЬрд╛рддреЗ рд╣реИрдВ"ред  рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    var formatter2 = JsonManager.ComposeFormatter&lt;Point&gt;( chain=&gt;chain .Include(e=&gt;eX) .Include(e=&gt;eY) // DSL Includes )</span></span></code> </pre> <br><p>  рдпрд╣ рдбреАрдПрд╕рдПрд▓рдП рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХрд╛ рд╡рд┐рд╡рд░рдг рд╣реИред  рдбреАрдПрд╕рдПрд▓ рдиреЗ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рдкреЗрд╢реЗрд╡рд░реЛрдВ рдФрд░ рд╡рд┐рдкрдХреНрд╖реЛрдВ рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд╛ рдЬреНрдЮрд╛рди рджрд┐рдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдм рд░рд┐рдХреЙрд░реНрдбрд┐рдВрдЧ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рд░реВрдк рдХреА рдЕрдирджреЗрдЦреА рдХрд░рддреЗ рд╣реБрдП, рдореИрдВ рдЗрд╕ рдмрд╛рдд рдкрд░ рдЬреЛрд░ рджреЗрддрд╛ рд╣реВрдВ рдХрд┐ рд╕реА # рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреЗрдбрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ "рдЖрджрд░реНрд╢ рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХ" рдХреЛ рд╕рдВрдХрд▓рд┐рдд рдХрд░рдиреЗ рдФрд░ рд╕рдВрдХрд▓рд┐рдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">рд╡рд╣ рдХреИрд╕реЗ рдХрд░рддрд╛ рд╣реИ - рдХреЛрдб рдФрд░ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреЗрдбрд╝ рдХреЛрдб рдкреАрдврд╝реА рдЧрд╛рдЗрдб рдХрд╛ рдПрдХ рдмрд╣реБрдд ...</b> <div class="spoiler_text"><p>  <code>serilizer</code> рд╕реЗ <code>serilizer</code> (рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреЗрдбрд╝ рдХреЗ рдмрд┐рдирд╛ рдЕрдм рддрдХ) рдореЗрдВ рд╕рдВрдХреНрд░рдордг: </p><br><pre> <code class="cs hljs"> Func&lt;StringBuilder, Point, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; serializer = ... <span class="hljs-comment"><span class="hljs-comment">// later string formatter(Point p) { var stringBuilder = new StringBuilder(); serializer(stringBuilder, p); return stringBuilder.ToString(); }</span></span></code> </pre> <br><p>  рдмрджрд▓реЗ рдореЗрдВ, <code>serializer</code> рдЗрд╕ рддрд░рд╣ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдпрджрд┐ рд╕реНрдерд┐рд░ рдХреЛрдб рдХреЗ рд╕рд╛рде рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ): </p><br><pre> <code class="cs hljs">Expression&lt;Func&lt;StringBuilder, Point, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;&gt; serializerExpression = SerializeAssociativeArray(sb, p, (sb1, t1) =&gt; SerializeValueProperty(sb1, t1, <span class="hljs-string"><span class="hljs-string">"X"</span></span>, o =&gt; oX, SerializeValueToString), (sb4, t4) =&gt; SerializeValueProperty(sb1, t1, <span class="hljs-string"><span class="hljs-string">"Y"</span></span>, o =&gt; oY, SerializeValueToString) ); Func&lt;StringBuilder, Point, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; serializer = serializerExpression.Compile();</code> </pre> <br><p>  рдпрд╣ рдЗрддрдирд╛ "рдХрд╛рд░реНрдпрд╛рддреНрдордХ" рдХреНрдпреЛрдВ рд╣реИ, рдЖрдк рдЕрд░реНрдзрд╡рд┐рд░рд╛рдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рджреЛ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреЛ рдЕрдиреБрдХреНрд░рдорд┐рдд рдХреНрдпреЛрдВ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ?  рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ: рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреЛ <code>Expression&lt;Func&lt;StringBuilder, Box, bool&gt;&gt;</code> рдЖрджрд┐ рдХреЗ рдПрдХ рдЪрд░ рдХреЛ рд╕реМрдВрдкрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рдЕрд░реНрдзрд╡рд┐рд░рд╛рдо рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИред <br>  рдореИрдВ рд╕реАрдзреЗ <code>Func&lt;StringBuilder, Point, bool&gt; serializer = (sb,p)=&gt;SerializeAssociativeArray(sb,p,...</code> рдХреНрдпреЛрдВ рдирд╣реАрдВ рд▓рд┐рдЦ рд╕рдХрддрд╛? рдпрд╣ рд╕рдВрднрд╡ рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВ рдПрдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐ рдмрдирд╛рдиреЗ рдХрд╛ рдкреНрд░рджрд░реНрд╢рди рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реВрдВ, рд▓реЗрдХрд┐рди рдПрдХ рд╡рд┐рдзрд╛рдирд╕рднрд╛ (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕реНрдерд┐рд░ рдХреЛрдб) рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХрд╛ рдкреЗрдбрд╝, рднрд╡рд┐рд╖реНрдп рдореЗрдВ рдкреНрд░рддрд┐рдирд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдВрдХрд▓рди рдХреЗ рд╕рд╛рде, рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдЙрдкрдпреЛрдЧ рдореЗрдВ, <code>serializerExpression</code> рдПрдХ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрд▓рдЧ рддрд░реАрдХреЗ рд╕реЗ - рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ (рдиреАрдЪреЗ) рд╕реЗрдЯ <code>serializerExpression</code> рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рд╕рдорд╛рдзрд╛рди рдореЗрдВ рд╣реА рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ: <code>SerializeAssociativeArray</code> <code>params Func&lt;..&gt; propertySerializers</code> рдХреА рдПрдХ рд╕рд░рдгреА рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ <code>params Func&lt;..&gt; propertySerializers</code> рдЕрдиреБрд╕рд╛рд░ <code>params Func&lt;..&gt; propertySerializers</code> рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдиреЛрдбреНрд╕ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдЕрдиреБрд╕рд╛рд░ред  рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░рдХреЗ рдкрддреНрддрд┐рдпреЛрдВ рдХреЗ SerializeValueProperty рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХреЛрдВ (SerializeValueToString рдлрд╝реЙрд░реНрдореИрдЯрд░ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдирд╛) рдФрд░ рджреВрд╕рд░реЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ <code>SerializeAssociativeArray</code> (рдпрд╛рдиреА, рд╢рд╛рдЦрд╛рдУрдВ) рджреНрд╡рд╛рд░рд╛ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдЯреНрд░реИрд╡рд░реНрд╕рд▓ рдХрд╛ рдПрдХ рдЗрдЯрд░реЗрдЯрд░ (рдЯреНрд░реА) рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдЕрдЧрд░ рдкреЙрдЗрдВрдЯ рдореЗрдВ рдиреЗрдХреНрд╕реНрдЯрдкреЙрдЗрдВрдЯ рдкреНрд░реЙрдкрд░реНрдЯреА рд╣реИ: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">delegate</span></span> = SerializeAssociativeArray(sb, p, (sb1, t1) =&gt; SerializeValueProperty(sb1, t1, <span class="hljs-string"><span class="hljs-string">"X"</span></span>, o =&gt; oX, SerializeValueToString), (sb4, t4) =&gt; SerializeValueProperty(sb1, t1, <span class="hljs-string"><span class="hljs-string">"Y"</span></span>, o =&gt; oY, SerializeValueToString), (sb4, t4) =&gt; SerializeValueProperty(sb1, t1, <span class="hljs-string"><span class="hljs-string">"NextPoint"</span></span>, o =&gt; o.NextPoint, (sb4, t4) =&gt;SerializeAssociativeArray(sb1, p1, (sb1, t1) =&gt; SerializeValueProperty(sb2, t2, <span class="hljs-string"><span class="hljs-string">"X"</span></span>, o =&gt; oX, SerializeValueToString), (sb4, t4) =&gt; SerializeValueProperty(sb2, t2, <span class="hljs-string"><span class="hljs-string">"Y"</span></span>, o =&gt; oY, SerializeValueToString) ) ) );</code> </pre> <br><p>  рддреАрди рдХрд╛рд░реНрдпреЛрдВ <code>SerializeAssociativeArray</code> , <code>SerializeValueProperty</code> , <code>SerializeValueToString</code> рдХреА рдбрд┐рд╡рд╛рдЗрд╕ рдЬрдЯрд┐рд▓ рдирд╣реАрдВ рд╣реИ: </p><br><div class="spoiler">  <b class="spoiler_title">рд╕реАрд░рд┐рдпрд▓ рдХрд░реЗрдВ ...</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> SerializeAssociativeArray&lt;T&gt;(StringBuilder stringBuilder, T t, <span class="hljs-keyword"><span class="hljs-keyword">params</span></span> Func&lt;StringBuilder, T, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;[] propertySerializers) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; stringBuilder.Append(<span class="hljs-string"><span class="hljs-string">'{'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> propertySerializer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> propertySerializers) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> notEmpty = propertySerializer(stringBuilder, t); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (notEmpty) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!@<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) @<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; stringBuilder.Append(<span class="hljs-string"><span class="hljs-string">','</span></span>); } }; stringBuilder.Length--; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (@<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) stringBuilder.Append(<span class="hljs-string"><span class="hljs-string">'}'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> SerializeValueProperty&lt;T, TProp&gt;(StringBuilder stringBuilder, T t, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> propertyName, Func&lt;T, TProp&gt; getter, Func&lt;StringBuilder, TProp, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt; serializer) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TProp : <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { stringBuilder.Append(<span class="hljs-string"><span class="hljs-string">'"'</span></span>).Append(propertyName).Append(<span class="hljs-string"><span class="hljs-string">'"'</span></span>).Append(<span class="hljs-string"><span class="hljs-string">':'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = getter(t); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> notEmpty = serializer(stringBuilder, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!notEmpty) stringBuilder.Length -= (propertyName.Length + <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> notEmpty; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> SerializeValueToString&lt;T&gt;(StringBuilder stringBuilder, T t) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { stringBuilder.Append(t); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> </div></div><br><p>  рдХрдИ рд╡рд┐рд╡рд░рдг рдпрд╣рд╛рдВ рдирд╣реАрдВ рджрд┐рдП рдЧрдП рд╣реИрдВ (рд╕реВрдЪреА рд╕рдорд░реНрдерди, рд╕рдВрджрд░реНрдн рдкреНрд░рдХрд╛рд░ рдФрд░ рдЕрд╢рдХреНрдд)ред  рдФрд░ рдлрд┐рд░ рднреА рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рдореБрдЭреЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ <em>рдЬрд╕рди</em> рдорд┐рд▓рддрд╛ рд╣реИ, рдФрд░ рдмрд╛рдХреА рд╕рдм рдХреБрдЫ рдорд╛рдирдХ рдХрд╛рд░реНрдпреЛрдВ рд╕реЗ рднреА рдЕрдзрд┐рдХ рд╣реИ <code>SerializeArray</code> , <code>SerializeNullable</code> , <code>SerializeRef</code> ред </p><br><p>  рдпрд╣ рдПрдХ рд╕реНрдерд┐рд░ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдЯреНрд░реА рдерд╛, рдЧрддрд┐рд╢реАрд▓ рдирд╣реАрдВ, <em>C # рдореЗрдВ eval</em> рдирд╣реАрдВред </p><br><p>  рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреИрд╕реЗ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдЯреНрд░реА рдХреЛ рджреЛ рдЪрд░рдгреЛрдВ рдореЗрдВ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ: </p><br><h4 id="shag-1---decompilerom-posmotret-na-kod-prisvoennyy-expressiont">  рдЪрд░рдг 1 - <code>Expression&lt;T&gt;</code> рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреЛрдб рдкрд░ рдбрд┐рдХрдореНрдкрд╛рдЗрд▓рд░ рджреЗрдЦреЛ </h4><br><p><img src="https://habrastorage.org/webt/ox/p3/g2/oxp3g2newr9bhr3oba5bajcrkco.png"></p><br><p>  рдпрд╣ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЖрдкрдХреЛ рдкрд╣рд▓реА рдмрд╛рд░ рдЖрд╢реНрдЪрд░реНрдп рд╣реЛрдЧрд╛ред  рдХреБрдЫ рднреА рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдкрд╣рд▓реА рдЪрд╛рд░ рд▓рд╛рдЗрдиреЗрдВ рдХрд┐рд╕ рддрд░рд╣ рдПрдХ рд╕рд╛рде рд░рдЦреА рдЬрд╛рддреА рд╣реИрдВ: </p><br><pre> <code class="cs hljs">(<span class="hljs-string"><span class="hljs-string">"sb"</span></span>,<span class="hljs-string"><span class="hljs-string">"t"</span></span>) .. SerializeAssociativeArray..</code> </pre> <br><p>  рдлрд┐рд░ рд╕реНрд░реЛрдд рдХреЛрдб рдХреЗ рд╕рд╛рде рдХрдиреЗрдХреНрд╢рди рдкрд░ рдХрдмреНрдЬрд╛ рдХрд░ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдФрд░ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реЛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдпрджрд┐ рдЖрдк рдЗрд╕ рддрд░рд╣ рдХреЗ рд░рд┐рдХреЙрд░реНрдб ('рдПрдХреНрд╕рдкреНрд░реЗрд╢рди.рдХреЙрдиреНрд╕реНрдЯ', 'рдПрдХреНрд╕рдкреНрд░реЗрд╢рди.рдкреНрд░реЗрдо,', 'рдПрдХреНрд╕рдкреНрд░реЗрд╢рди.рдХреЙрд▓', 'рдПрдХреНрд╕рдкреНрд░реЗрд╢рди.рд▓рдореНрдмрд╛' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрджрд┐</a> ...) рдореЗрдВ рдорд╣рд╛рд░рдд рд╣рд╛рд╕рд┐рд▓ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рд░рдЪрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - рдиреЛрдбреНрд╕ рдХреЗ рдХрд┐рд╕реА рднреА рдмрд╛рдИрдкрд╛рд╕ (рдЖрдзрд╛рд░рд┐рдд) рдореЗрдЯрд╛рдбрд╛рдЯрд╛)ред  рдпрд╣ <em>C # рдореЗрдВ</em> рд╕реНрдкрд╖реНрдЯ рд╣реИред </p><br><h4 id="shag-2----shodit-po-etoy-ssylkehttpsgithubcomdashboardcoderoutinesblobmastertestsconsoleappsclrmdautomationprogramcsl99-l194">  рдЪрд░рдг 2 - <a href="">рдЗрд╕ рд▓рд┐рдВрдХ</a> рдХрд╛ рдЕрдиреБрд╕рд░рдг <a href="">рдХрд░реЗрдВ</a> , </h4><br><p>  рдПрдХ рд╣реА рдбрд┐рдХрдВрдкрд╛рдЗрд▓рд░ рдХреЛрдб, рд▓реЗрдХрд┐рди рдЖрджрдореА рджреНрд╡рд╛рд░рд╛ рд╕рдВрдХрд▓рд┐рддред </p><br><p>  рдЗрд╕ рдордирдХреЗ рдХрдврд╝рд╛рдИ рдореЗрдВ рд╕рдВрд▓рдЧреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рджреБрднрд╛рд╖рд┐рдпрд╛ рдХреЗ рд▓реЗрдЦрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдпреЗ рд╕рднреА рдХрд▓рд╛рдПрдБ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреНрд░рдордмрджреНрдзрддрд╛ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ</a> рдЕрдВрджрд░ рд░рд╣рддреА рд╣реИрдВред  рдЗрд╕ рд╡рд┐рдЪрд╛рд░ рдХреЛ рд╕реАрдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдЖрдк рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЛ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рд╕рдВрдХрд▓рд┐рдд рдХреБрд╢рд▓ рдХрд╛рд░реНрдп C # ((.NET .NET)) рдореЗрдВ рдЙрдкрд▓рдмреНрдз рдХрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВред </p></div></div><br><p>  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдпрджрд┐ рдЖрдк рд╣рд░ рдмрд╛рд░ рд╕рдВрдХрд▓рди рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕рдВрдХрд▓рди рдХрд╣рддреЗ рд╣реИрдВ, рддреЛ рдПрдХ рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХ рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХ рдПрдХ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рдлрд╝рдВрдХреНрд╢рди рд╕реЗ рдЖрдЧреЗ рдирд┐рдХрд▓ рдЬрд╛рдПрдЧрд╛ ( <code>ComposeFormatter</code> рдЕрдВрджрд░ рд╕рдВрдХрд▓рди рдПрдХ рдорд╣рдВрдЧрд╛ рдСрдкрд░реЗрд╢рди рд╣реИ), рд▓реЗрдХрд┐рди рдЖрдк рд▓рд┐рдВрдХ рдХреЛ рдмрдЪрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Func&lt;Point, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; formatter = JsonManager.ComposeFormatter&lt;Point&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Point p</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// which has better performance ? var json1 = JsonConvert.SerializeObject(p); var json2 = formatter(p); return json2; }</span></span></code> </pre> <br><p>  рдпрджрд┐ рдЖрдкрдХреЛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдЧреБрдордирд╛рдо рдкреНрд░рдХрд╛рд░ рдХреЗ рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХ рдмрдирд╛рдиреЗ рдФрд░ рдмрдЪрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдЕрддрд┐рд░рд┐рдХреНрдд рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> CachedFormatter cachedFormatter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CachedFormatter(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;Point&gt; list</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// there json formatter will be build only for first call // and assigned to cachedFormatter.Formatter // in all next calls cachedFormatter.Formatter will be used. // since building of formatter is determenistic it is lock free var json3 = list.Select(e=&gt; {X:eX, Sum:e.X+EY}) .ToJson(cachedFormatter, e=&gt;e.Sum); return json3; }</span></span></code> </pre> <br><p>  рдЙрд╕рдХреЗ рдмрд╛рдж, рд╣рдо рдЖрддреНрдорд╡рд┐рд╢реНрд╡рд╛рд╕ рд╕реЗ рдЕрдкрдиреЗ рд▓рд┐рдП рдкрд╣рд▓рд╛ рдорд╛рдЗрдХреНрд░реЛрдПрдкреНрдЯрд┐рдорд╛рдЗрдЬреЗрд╢рди рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реИрдВ рдФрд░ рдЬрдорд╛ рдХрд░рддреЗ рд╣реИрдВ, рдЬрдорд╛ рдХрд░рддреЗ рд╣реИрдВ, рдЬрдорд╛ рдХрд░рддреЗ рд╣реИрдВ ... рдХреМрди рдордЬрд╛рдХ рд╣реИ, рдХреМрди рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕ рд╕рд╡рд╛рд▓ рдкрд░ рдЖрдЧреЗ рдмрдврд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рдирдпрд╛ рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХ рдирдпрд╛ рд╣реИ, рдореИрдВ рд╕реНрдкрд╖реНрдЯ рд▓рд╛рдн рдХреЛ рдареАрдХ рдХрд░рддрд╛ рд╣реВрдВ - рдпрд╣ рддреЗрдЬреА рд╕реЗ рд╣реЛрдЧрд╛ред </p><br><h2 id="chto-vzamen">  рдмрджрд▓реЗ рдореЗрдВ рдХреНрдпрд╛? </h2><br><p>  рдбреАрдПрд╕рдПрд▓ рдореЗрдВ рд╕реАрд░рд▓рд╛рдЗрдЬрд╝ рдореЗрдВ рджреБрднрд╛рд╖рд┐рдпрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ (рдФрд░ рдЙрд╕реА рддрд░рд╣ рд╕реЗ рдпрд╣ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ рдореЗрдВ рд╕рдВрднрд╡ рд╣реИ, рдкреНрд░рддрд┐рд▓рд┐рдкрд┐, рдХреНрд▓реЛрди - рдФрд░ рдпрд╣ рднреА рд╣реЛрдЧрд╛) рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд▓рд╛рдЧрддреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><p>  <strong>1</strong> - рд╕рдВрдХрд▓рд┐рдд рдХреЛрдб рдХреЗ рд▓рд┐рдВрдХ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдХреА рд▓рд╛рдЧрддред </p><br><p>  рдпреЗ рд▓рд╛рдЧрдд рдЖрдо рддреМрд░ рдкрд░ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИрдВ, рдЬреИрд╕рд╛ рдХрд┐ рд╕рдВрдХрд▓рди рдХреЗ рд╕рд╛рде рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреЗрдбрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИ - рджреБрднрд╛рд╖рд┐рдпрд╛ рд░рд┐рдлреНрд▓реЗрдХреНрд╕реЗрд╕ рдкрд░ рдПрдХ рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЗрд╕реЗ рдЗрддрдирд╛ рдЪрд╛рдЯ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдзрд╛рд░рд╛ рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХреЛрдВ (рдЬреИрд╕реЗ, рдХреЙрдкреА, рдХреНрд▓реЛрди) рдФрд░ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреЗ рдкреЗрдбрд╝реЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрд░рд╛рдмрд░реА рдПрдХрддреНрд░ рдирд╣реАрдВ рдХреА рдЬрд╛рддреА рд╣реИ, рдФрд░ рди рд╣реА рдЙрдиреНрд╣реЗрдВ рдкрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╕рд░реНрд╡рд┐рд╕рд╕реНрдЯреИрдХ рдФрд░ Json.NET рдХреЛ рдУрд╡рд░рдЯреЗрдХ рдХрд░рдиреЗ рдХреЗ рд╡рд┐рдкрд░реАрдд, рдЗрд╕ рддрд░рд╣ рдХрд╛ рдХреЛрдИ рдХрд╛рд░реНрдп рдирд╣реАрдВ рд╣реИ, рдЬреЛрд╕рди рдореЗрдВ рдХреНрд░рдордмрджреНрдзрддрд╛ рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд╕реБрд╡рд┐рдЪрд╛рд░рд┐рдд рдХрд╛рд░реНрдп рдХреЗ рдврд╛рдВрдЪреЗ рдХреЗ рднреАрддрд░ рд╣реИ - рдПрдХ рдирдпрд╛ рд╕рдорд╛рдзрд╛рди рдкреЗрд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрд╡рд╢реНрдпрдХ рд╢рд░реНрдд)ред </p><br><p>  <strong>2</strong> - рдЖрдкрдХреЛ рдЕрдореВрд░реНрдд рдХреЗ рд▓реАрдХ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдПрдХ рд╕рдорд╛рди рд╕рдорд╕реНрдпрд╛ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: рдореМрдЬреВрджрд╛ рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рд╢рдмреНрджрд╛рд░реНрде рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрдиред </p><br><p>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкреЙрдЗрдВрдЯ рдФрд░ IEnumerable рдХреЛ рдХреНрд░рдордмрджреНрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред <br></p><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> formatter1 = JsonManager.ComposeFormatter&lt;Point&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> formatter2 = JsonManager.ComposeEnumerableFormatter&lt;Point&gt;(); <span class="hljs-comment"><span class="hljs-comment">// but not // var formatter2 = JsonManager.ComposeEnumerableFormatter&lt;List&lt;Point&gt;&gt;();</span></span></code> </pre> <br><p>  рдпрд╛: "рдХреНрд▓реЛрдЬрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ?"ред  рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдХреЗрд╡рд▓ рдиреЛрдб рдХреЛ рдирд╛рдо рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ (рдЕрджреНрд╡рд┐рддреАрдп): </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> DATEFORMAT= <span class="hljs-string"><span class="hljs-string">"YYYY"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> formatter3 = JsonManager.ComposeFormatter&lt;Record&gt;( chain =&gt; chain .Include(i =&gt; i.RecordId) .Include(i =&gt; i.CreatedAt.ToString(DATEFORMAT) , <span class="hljs-string"><span class="hljs-string">"CreatedAt"</span></span>); );</code> </pre> <br><p>  рдпрд╣ рд╡реНрдпрд╡рд╣рд╛рд░ <code>ComposeFormatter</code> рд╕реЗ <code>ComposeFormatter</code> рджреБрднрд╛рд╖рд┐рдпрд╛ рдХреЗ рдЖрдВрддрд░рд┐рдХ рдЙрдкрдХрд░рдг рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреА рд▓рд╛рдЧрдд рдЕрдкрд░рд┐рд╣рд╛рд░реНрдп рдмреБрд░рд╛рдИ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдкрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рдиреЗ рдФрд░ рдЖрдВрддрд░рд┐рдХ рдбреАрдПрд╕рдПрд▓ рдХреЗ рджрд╛рдпрд░реЗ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рдиреЗ рд╕реЗ, рдЕрдореВрд░реНрдд рдХрд╛ рд░рд┐рд╕рд╛рд╡ рднреА рдмрдврд╝рддрд╛ рд╣реИред  рдпрд╣ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЖрдВрддрд░рд┐рдХ рдбреАрдПрд╕рдПрд▓ рдХреЗ рдбреЗрд╡рд▓рдкрд░ рдкрд░ рдЕрддреНрдпрд╛рдЪрд╛рд░ рдХрд░реЗрдЧрд╛, рдпрд╣рд╛рдВ рдЖрдкрдХреЛ рджрд╛рд░реНрд╢рдирд┐рдХ рдордиреЛрджрд╢рд╛ рдкрд░ рд╕реНрдЯреЙрдХ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП, рдЖрдВрддрд░рд┐рдХ рдбреАрдПрд╕рдПрд▓ ( <em>рдХреНрдпрд╛ рдЙрдореНрдореАрдж рдХрд░реЗрдВ?</em> ) рдХреЗ рддрдХрдиреАрдХреА рд╡рд┐рд╡рд░рдг рдФрд░ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдбреАрдПрд╕рдПрд▓ рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреА рд╕рдореГрджреНрдзрд┐ рдФрд░ рдЗрд╕рдХреЗ рджреБрднрд╛рд╖рд┐рдпреЛрдВ ( <em>рдмрджрд▓реЗ рдореЗрдВ рдХреНрдпрд╛?</em> ) рдХреЗ рдЬреНрдЮрд╛рди рд╕реЗ рдЕрдореВрд░реНрдд рд▓реАрдХ рдХреЛ рджреВрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдкреНрд░рд╢реНрди рдХрд╛ рдЙрддреНрддрд░: "рдХреНрдпрд╛ рдпрд╣ рдЖрдВрддрд░рд┐рдХ рдбреАрдПрд╕рдПрд▓ рдмрдирд╛рдиреЗ рдФрд░ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд╛рдпрдХ рд╣реИ?", рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рдбреАрдПрд╕рдПрд▓ рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреЗрд╡рд▓ рдПрдХ рдХрд╣рд╛рдиреА рд╣реЛ рд╕рдХрддреА рд╣реИ - рдЗрд╕рдХреЗ рд╕рднреА рд╡рд┐рд╡рд░рдг рдФрд░ рдЙрдкрдпреБрдХреНрддрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ, рдФрд░ рдЗрд╕рдХреЗ рд╕рдВрднрд╛рд╡рд┐рдд рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ (рджреБрднрд╛рд╖рд┐рдпреЛрдВ), рдЕрд░реНрдерд╛рддреНред  рд▓рд╛рдЧрдд рдкрд░ рдХрд╛рдмреВ рдкрд╛рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдХрд╣рд╛рдиреАред </p><br><p>  рдЗрд╕ рд╕рдм рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП, рдореИрдВ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдбреАрдПрд╕рдПрд▓ рдХреА рдкреНрд░рднрд╛рд╡рд╢реАрд▓рддрд╛ рдореЗрдВ рд╡рд╛рдкрд╕ рдЖрддрд╛ рд╣реВрдВред </p><br><p>  рдорд╣рддреНрд╡рдкреВрд░реНрдг рд░реВрдк рд╕реЗ рдЕрдзрд┐рдХ рджрдХреНрд╖рддрд╛ рд╣рд╛рд╕рд┐рд▓ рдХреА рдЬрд╛рддреА рд╣реИ рдЬрдм рд▓рдХреНрд╖реНрдп рдХреЛ рдПрдХ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╡рд┐рд╕реНрддреГрдд рдФрд░ рдЙрддреНрдкрдиреНрди рдХреНрд░рдорд╛рдВрдХрди рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдЯреНрд░рд┐рдкрд▓ (рдбреАрдЯреАрдУ, рдбреАрдЯреАрдУ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░реЗрдВ, рдбреАрдЯреАрдУ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░реЗрдВ) рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рд╣реИред  рдЕрдВрдд-рдЕрдВрдд рдореЗрдВ, рджреНрд╡реИрдд рдХрд╛рд░реНрдп-рд╡рд╕реНрддреБ рдЖрдкрдХреЛ "рдбреАрдЯреАрдУ рдПрдХ рдРрд╕рд╛ рдХрд╛рд░реНрдп рд╣реИ" рдХрд╣рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рдФрд░ рдПрдХ рд▓рдХреНрд╖реНрдп рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреА рд╣реИ: рдбреАрдЯреАрдУ рдлрд╝рдВрдХреНрд╢рди рд╕реЗрдЯ рдХрд░рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдПред </p><br><p>  рд╕рд░рд▓реАрдХрд░рдг рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП: </p><br><ol><li>  рдмрд╛рдИрдкрд╛рд╕ рдЯреНрд░реА (рдиреЛрдбреНрд╕ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреНрд░рдорд╛рдВрдХрди рд╣реЛрдЧрд╛, рдЬрд┐рд╕ рддрд░рд╣ рд╕реЗ рдпрд╣ рдкрд░рд┐рдкрддреНрд░ рд▓рд┐рдВрдХ рдХреА рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рддрд╛ рд╣реИ), рдкрддреНрддрд┐рдпреЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ - рдПрдХ рдлреЙрд░реНрдореЗрдЯрд░ (рдкреНрд░рдХрд╛рд░ рд╕реЗ) рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВред </li><li>  рдкрддреНрддрд┐рдпреЛрдВ рд╕рд╣рд┐рдд рдирд┐рдпрдо (рдпрджрд┐ рд╡реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рд╣реИрдВ) - рд╕рдВрдкрддреНрддрд┐ рдмрдирд╛рдо рдлрд╝реАрд▓реНрдб?  рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП? </li><li>  рдПрдХ рд╢рд╛рдЦрд╛ (рдиреЗрд╡рд┐рдЧреЗрд╢рди рдХреЗ рд╕рд╛рде рдПрдХ рдиреЛрдб) рдФрд░ рдПрдХ рд╢реАрдЯ рджреЛрдиреЛрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ <code>e=&gt;e.Name</code> ( <code>e=&gt;e.Name</code> ) рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдЖрдо рддреМрд░ рдкрд░ рдХреЛрдИ рднреА рдлрд╝рдВрдХреНрд╢рди (`e =&gt; e.Name.ToUpper) ()," MymemberName ") - рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреЗ рд▓рд┐рдП рдлрд╝реЙрд░реНрдореЗрдЯрд░ рд╕реЗрдЯ рдХрд░реЗрдВ рдиреЛрдбред </li></ol><br><p>  рд▓рдЪреАрд▓рд╛рдкрди рдмрдврд╝рд╛рдиреЗ рдХреЗ рдЕрдиреНрдп рд╡рд┐рдХрд▓реНрдк: </p><br><ol><li>  рдПрдХ рд╢реАрдЯ рдХреЛ рдХреНрд░рдордмрджреНрдз рдХрд░реЗрдВ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдЬрд╕рди рд╣реЛрддрд╛ рд╣реИ "рдЬреИрд╕рд╛ рдХрд┐" рд╕реНрдЯреНрд░рд┐рдВрдЧ (рд╡рд┐рд╢реЗрд╖ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдлреЙрд░реНрдореЗрдЯрд░) рд╣реИ; </li><li>  рд╕рдореВрд╣реЛрдВ рдХреЗ рд▓рд┐рдП рд╕реНрд╡рд░реВрдкрдХ рд╕реЗрдЯ рдХрд░реЗрдВ, рдЕрд░реНрдерд╛рдд  рдкреВрд░реА рд╢рд╛рдЦрд╛рдПрдБ, рдЗрд╕ рд╢рд╛рдЦрд╛ рдореЗрдВ рдЗрд╕ рддрд░рд╣ рд╕реЗ - рдПрдХ рджреВрд╕рд░реЗ рддрд░реАрдХреЗ рд╕реЗ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╕рдордп рдХреЗ рд╕рд╛рде рдпрд╣рд╛рдБ рддрд╛рд░реАрдЦреЗрдВ, рдФрд░ рдЗрд╕ рд╕рдордп рдХреЗ рдмрд┐рдирд╛ рдПрдХ рдореЗрдВ)ред </li></ol><br><p>  рд╣рд░ рдЬрдЧрд╣ рдРрд╕реЗ рдирд┐рд░реНрдорд╛рдг рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: рдмрд╛рдпрдкрд╛рд╕ рдЯреНрд░реА, рд╢рд╛рдЦрд╛, рдкрддреНрддреА, рдФрд░ рдпрд╣ рд╕рдм DSL рд╢рд╛рдорд┐рд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><h2 id="dsl-includes">  рдбреАрдПрд╕рдПрд▓ рд╢рд╛рдорд┐рд▓ рд╣реИ </h2><br><p>  рдЪреВрдВрдХрд┐ рд╣рд░ рдХреЛрдИ рдИрдПрдл рдХреЛрд░ рд╕реЗ рдкрд░рд┐рдЪрд┐рдд рд╣реИ, рдЗрд╕рд▓рд┐рдП рдирд┐рдореНрди рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ рдХреЗ рдЕрд░реНрде рдХреЛ рддреБрд░рдВрдд рдкрдХрдбрд╝ рд▓рд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП (рдпрд╣ xpath рдХрд╛ рд╕рдмрд╕реЗрдЯ рд╣реИ)ред </p><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">// DSL Includes Include&lt;User&gt; include1 = chain=&gt; chain .IncludeAll(e =&gt; e.Groups) .IncludeAll(e =&gt; e.Roles) .ThenIncludeAll(e =&gt; e.Privileges) // EF Core syntax // https://docs.microsoft.com/en-us/ef/core/querying/related-data var users = context.Users .Include(blog =&gt; blog.Groups) .Include(blog =&gt; blog.Roles) .ThenInclude(blog =&gt; blog.Privileges);</span></span></code> </pre> <br><p>  рдпрд╣рд╛рдВ "рдиреЗрд╡рд┐рдЧреЗрд╢рди рдХреЗ рд╕рд╛рде" - "рд╢рд╛рдЦрд╛рдПрдВ" рдиреЛрдб рд╣реИрдВред <br>  рдкреНрд░рд╢реНрди рдХрд╛ рдЙрддреНрддрд░ рдЬреЛ "рдкрддреНрддрд┐рдпреЛрдВ" (рдлрд╝реАрд▓реНрдб / рдЧреБрдг) рдХреЛ рдиреЛрдб рдХрд░рддрд╛ рд╣реИ, рдХреЛ рдкреЗрдбрд╝ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддрд╛рдХрд┐ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ - рдХреЛрдИ рдирд╣реАрдВред  рдкрддреНрддрд┐рдпреЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдпрд╛ рддреЛ рдЙрдиреНрд╣реЗрдВ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдирд╛ рд╣реЛрдЧрд╛: </p><br><pre> <code class="cs hljs">Include&lt;User&gt; include2 = chain=&gt; chain .Include(e =&gt; e.UserName) <span class="hljs-comment"><span class="hljs-comment">// leaf member .IncludeAll(e =&gt; e.Groups) .ThenInclude(e =&gt; e.GroupName) // leaf member .IncludeAll(e =&gt; e.Roles) .ThenInclude(e =&gt; e.RoleName) // leaf member .IncludeAll(e =&gt; e.Roles) .ThenIncludeAll(e =&gt; e.Privileges) .ThenInclude(e =&gt; e.PrivilegeName) // leaf member</span></span></code> </pre><br><p>  рдпрд╛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рджреБрднрд╛рд╖рд┐рдпрд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рдирд┐рдпрдо рд╕реЗ рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдЬреЛрдбрд╝реЗрдВ: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Func&lt;ChainNode, MemberInfo&gt; rule = ... var include2 = IncludeExtensions.AppendLeafs(include1, rule);</span></span></code> </pre> <br><p>  рдпрд╣рд╛рдБ рдирд┐рдпрдо рдПрдХ рдирд┐рдпрдо рд╣реИ рдЬрд┐рд╕реЗ ChainNode.Type рджреНрд╡рд╛рд░рд╛ рдЪреБрдирд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдиреЛрдб рджреНрд╡рд╛рд░рд╛ рд▓реМрдЯрд╛рдИ рдЧрдИ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреЗ рдкреНрд░рдХрд╛рд░ (рдЪреЗрдирдиреЛрдб - рдбреАрдПрд╕рдПрд▓ рдХреЗ рдЖрдВрддрд░рд┐рдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЬрд┐рд╕рдореЗрдВ рдмрд╛рдж рдореЗрдВ рдЪрд░реНрдЪрд╛ рдХреА рдЬрд╛рдПрдЧреА) рдХреНрд░рдорд╛рдВрдХрди рдореЗрдВ рднрд╛рдЧреАрджрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЧреБрдг (рдореЗрдВрдмрд░рдлреЛ), рдЬреИрд╕реЗред  рдХреЗрд╡рд▓ рд╕рдВрдкрддреНрддрд┐, рдпрд╛ рдХреЗрд╡рд▓ рдкрдврд╝рдиреЗ / рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрдкрддреНрддрд┐, рдпрд╛ рдХреЗрд╡рд▓ рдЬрд┐рдирдХреЗ рд▓рд┐рдП рдПрдХ рдлрд╝реЙрд░реНрдореЗрдЯрд░ рд╣реИ, рдЖрдк рдкреНрд░рдХрд╛рд░реЛрдВ рдХреА рдПрдХ рд╕реВрдЪреА рд╕реЗ рдЪрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреЛ рднреА рд╕реНрд╡рдпрдВ рдПрдХ рдирд┐рдпрдо рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдпрджрд┐ рдпрд╣ рдкрддреНрддреА рдХреЗ рдиреЛрдбреНрд╕ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рддрд╛ рд╣реИ - рдЕрд░реНрдерд╛рдд, рдкреЗрдбрд╝ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдиреЗ рдХрд╛ рд░реВрдк) ред </p><br><p>  рдпрд╛ ... рдЗрд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреБрднрд╛рд╖рд┐рдпрд╛ рдХреЗ рд╡рд┐рд╡реЗрдХ рдкрд░ рдЫреЛрдбрд╝ рджреЗрдВ, рдЬреЛ рддрдп рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдиреЛрдбреНрд╕ рдХреЗ рд╕рд╛рде рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИред  DSL рдореЗрдВ рд╕рд┐рд░реНрдл рдПрдХ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд░рд┐рдХреЙрд░реНрдб рд╢рд╛рдорд┐рд▓ рд╣реИ - рдЗрд╕ рд░рд┐рдХреЙрд░реНрдб рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреИрд╕реЗ рдХрд░реЗрдВ рджреБрднрд╛рд╖рд┐рдпрд╛ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред  рд╡рд╣ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреИрд╕рд╛ рд╡рд╣ рдЪрд╛рд╣рддрд╛ рд╣реИ, рдЗрд╕реЗ рдЕрдирджреЗрдЦрд╛ рдХрд░рдирд╛ред  рдХреБрдЫ рджреБрднрд╛рд╖рд┐рдП рд╕реНрд╡рдпрдВ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░реЗрдВрдЧреЗ, рдЬрдмрдХрд┐ рдЕрдиреНрдп рдЙрдирдХреЗ рдкреНрд░рджрд░реНрд╢рди рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдПрдХ рд╕рдорд╛рд░реЛрд╣ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВрдЧреЗ (рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреЗрдбрд╝, рдпрд╛ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдкреНрд░рддрд┐рдмрд┐рдВрдмред рдПрдорд┐рдЯ)ред  рдПрдХ рдЕрдЪреНрдЫрд╛ рдЖрдВрддрд░рд┐рдХ рдбреАрдПрд╕рдПрд▓ рд╕рд╛рд░реНрд╡рднреМрдорд┐рдХ рдЙрдкрдпреЛрдЧ рдФрд░ рдХрдИ рджреБрднрд╛рд╖рд┐рдпреЛрдВ рдХреЗ рдЕрд╕реНрддрд┐рддреНрд╡ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреА рдЕрдкрдиреА рд╡рд┐рд╢рд┐рд╖реНрдЯрддрд╛рдПрдВ рд╣реИрдВ, рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╕рдВрдпреЛрдЬрдХ рд▓реАрдХ рд╣реИрдВред <br>  рдЖрдВрддрд░рд┐рдХ рдбреАрдПрд╕рдПрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдХреЛрдб рдЙрд╕ рд╕реЗ рдмрд╣реБрдд рдЕрд▓рдЧ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдкрд╣рд▓реЗ рдерд╛ред </p><br><h4 id="out-of-the-box">  рдмреЙрдХреНрд╕ рд╕реЗ рдмрд╛рд╣рд░ </h4><br><p>  рдИрдПрдл рдХреЛрд░ рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдгред <br>  рд░рдирд┐рдВрдЧ рдХрд╛рд░реНрдп "рдЪрдХреНрд░реАрдп рд▓рд┐рдВрдХ рдХреЛ рдХрд╛рдЯ рджреЗрдирд╛" рд╣реИ, рдХреЗрд╡рд▓ рд╡рд╣реА рд╢реБрд░реВ рдХрд░рдирд╛ рд╣реИ, рдЬреЛ рдХрд┐ рд╢рд╛рдорд┐рд▓-рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣реИ: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> CachedFormatter cachedFormatter1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CachedFormatter(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dbContext = GetEfCoreContext()) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> json = EfCoreExtensions.ToJsonEf&lt;User&gt;(cachedFormatter1, dbContext, chain=&gt;chain .IncludeAll(e =&gt; e.Roles) .ThenIncludeAll(e =&gt; e.Privileges)); } }</code> </pre> <br><p>  <code>ToJsonEf</code> рдиреЗрд╡рд┐рдЧреЗрд╢рди рдЕрдиреБрдХреНрд░рдо рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ, рдЬрдм рдХреНрд░рдордмрджреНрдз рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ ("EF рдХреЛрд░ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ" рдирд┐рдпрдо рд╕реЗ рдкрддреНрддрд┐рдпреЛрдВ рдХрд╛ рдЪрдпрди рдХрд░рддрд╛ рд╣реИ, рдЕрд░реНрдерд╛рдд рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдкрдарди / рд▓реЗрдЦрди рд╕рдВрдкрддреНрддрд┐), рдореЙрдбрд▓ рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддрд╛ рд╣реИ - рдЬрд╣рд╛рдВ рд╕реНрдЯреНрд░рд┐рдВрдЧ / json рдлрд╝реАрд▓реНрдб рд╕реНрд╡рд░реВрдкрдг рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ (рдмрд╛рдЗрдЯ [] рдкреНрд░рддрд┐ рд╕реНрдЯреНрд░рд┐рдВрдЧ, рдЖрдИрдПрд╕рдУ рдореЗрдВ рдбреЗрдЯрд╛рдЗрдо, рдЖрджрд┐)ред  рдЗрд╕рд▓рд┐рдП, рдЙрд╕реЗ рдЕрдкрдиреЗ рдЕрдзреАрди рд╕реЗ рд╣реА IQugeable рдкреНрд░рджрд░реНрд╢рди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред </p><br><p>  рдорд╛рдорд▓реЗ рдореЗрдВ рдЬрдм рдкрд░рд┐рдгрд╛рдо рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдирд┐рдпрдо рдмрджрд▓ рдЬрд╛рддреЗ рд╣реИрдВ - DSL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрдИ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдЗрд╕рдореЗрдВ рдиреЗрд╡рд┐рдЧреЗрд╢рди рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ (рдпрджрд┐ рдирд┐рдпрдо рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ), рдПрдХ рдФрд░ рджреБрднрд╛рд╖рд┐рдпрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╣реЛрддрд╛ рд╣реИ: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> CachedFormatter cachedFormatter1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CachedFormatter(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetJson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dbContext = GetEfCoreContext()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> json = dbContext.ParentRecords <span class="hljs-comment"><span class="hljs-comment">// back to EF core includes // but .Include(include1) also possible .IncludeAll(e =&gt; e.Roles) .ThenIncludeAll(e =&gt; e.Privileges) .Select(e =&gt; new { FieldA: e.FieldA, FieldJson:"[1,2,3]", Role: e.Roles().First() }) .ToJson(cachedFormatter1, chain =&gt; chain.Include(e =&gt; e.Role), LeafRuleManager.DefaultEfCore, config: rules =&gt; rules .AddRule&lt;string[]&gt;(GetStringArrayFormatter) .SubTree( chain =&gt; chain.Include(e =&gt; e.FieldJson), stringAsJsonLiteral: true) // json as is .SubTree( chain =&gt; chain.Include(e =&gt; e.Role), subRules =&gt; subRules .AddRule&lt;DateTime&gt;( dateTimeFormat: "YYYMMDD", floatingPointFormat: "N2" ) ), ), useToString: false, // no default ToString for unknown leaf type (throw exception) dateTimeFormat: "YYMMDD", floatingPointFormat: "N2" } }</span></span></code> </pre> <br><p>  рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рдпреЗ рд╕рднреА рд╡рд┐рд╡рд░рдг, рдпрд╣ рд╕рдм "рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ" рд╣реИ, рдХреЗрд╡рд▓ рддрднреА рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рдЖрдкрдХреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рдФрд░ / рдпрд╛ рдпрджрд┐ рдпрд╣ рдЖрдкрдХрд╛ рдЕрдкрдирд╛ рджреБрднрд╛рд╖рд┐рдпрд╛ рд╣реЛред  рджреВрд╕рд░реА рдУрд░, рд╣рдо рдлрд┐рд░ рд╕реЗ рдкреНрд▓рд╕рд╕ рдкрд░ рд▓реМрдЯрддреЗ рд╣реИрдВ: рдбреАрдЯреАрдУ рдХреЛ рдХреЛрдб рджреНрд╡рд╛рд░рд╛ рд╕реНрдорд┐рдпрд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рджреБрднрд╛рд╖рд┐рдпреЛрдВ рд╕рд╛рд░реНрд╡рднреМрдорд┐рдХ рд╣реИрдВред  рдХреЛрдб рдЫреЛрдЯрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИ - рдпрд╣ рдЕрдЪреНрдЫрд╛ рд╣реИред </p><br><p>  <strong>рдпрд╣ рдЪреЗрддрд╛рд╡рдиреА рджреЗрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ</strong> : рд╣рд╛рд▓рд╛рдВрдХрд┐ рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЬреНрдЮрд╛рди рд╣рдореЗрд╢рд╛ рдПрдПрд╕рдкреА рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рд╡реЗрдм рдХреА рджреБрдирд┐рдпрд╛ рдореЗрдВ рд╕реНрдЯреНрд░реАрдорд┐рдВрдЧ рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХ рдмрд╣реБрдд рд╣реА рдЖрд╡рд╢реНрдпрдХ рдЪреАрдЬ рдирд╣реАрдВ рд╣реИ, рдЬрд╣рд╛рдВ рдбреЗрдЯрд╛рдмреЗрд╕ рднреА рдбреЗрдЯрд╛ рдХреЛ рдЬрд╕рди рдореЗрдВ рд╕рдВрдЪрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдПрдПрд╕рдкреА рдПрдорд╡реАрд╕реА рдореЗрдВ рдбреАрдПрд╕рдПрд▓ рдХреЛ рд╢рд╛рдорд┐рд▓ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд░рдирд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рдХрд╣рд╛рдиреА рдирд╣реАрдВ рд╣реИ</a> ред  рдПрдПрд╕рдкреА рдПрдорд╡реАрд╕реА рдХреЗ рд╕рд╛рде рдХрд╛рд░реНрдпрд╛рддреНрдордХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдХреЛ рдХреИрд╕реЗ рдорд┐рд▓рд╛рдПрдВ рдпрд╣ рдПрдХ рдЕрд▓рдЧ рдЕрдзреНрдпрдпрди рдХреЗ рдпреЛрдЧреНрдп рд╣реИред </p><br><p>  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдореИрдВ рдЦреБрдж рдХреЛ рдбреАрдПрд╕рдПрд▓ рдХреА рдкреЗрдЪреАрджрдЧрд┐рдпреЛрдВ рддрдХ рд╕реАрдорд┐рдд рдХрд░ рд▓реВрдВрдЧрд╛, рдЬрд┐рд╕рдореЗрдВ рдореИрдВ рдпрд╣ рднреА рдмрддрд╛ рд╕рдХрддрд╛ рд╣реВрдВ рдХрд┐ "рд▓рд╛рдЧрдд рдФрд░ рдЕрдзрд┐рдЧреНрд░рд╣рдг" рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреА рд╕рдорд╕реНрдпрд╛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕рдорд╛рдкреНрдд рд╣реЛ рд░рд╣реА рд╣реИ, рдпрд╣ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдореИрдВ рдирдИ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдФрд░ рдЕрдореВрд░реНрддрддрд╛ рдХреЗ рд░рд┐рд╕рд╛рд╡ рджреЛрдиреЛрдВ рдХреЛ рджрд┐рдЦрд╛рдКрдВрдЧрд╛ред </p><br><h2 id="esche-bolshe-dsl-includes">  рдЕрдзрд┐рдХ рдбреАрдПрд╕рдПрд▓ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ </h2><br><pre> <code class="cs hljs">Include&lt;Point&gt; include = chain =&gt; chain.Include(e=&gt;eX).Include(e=&gt;eY);</code> </pre> <br><p>  рдпрд╣ EF рдХреЛрд░ рд╕реЗ рднрд┐рдиреНрди рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╕реНрдерд┐рд░ рдХрд╛рд░реНрдп рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЪрд░ рдХреЛ рдирд╣реАрдВ рд╕реМрдВрдкрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдбреАрдПрд╕рдПрд▓ рдореЗрдВ рдЦреБрдж рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдЬреЛ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдХреЗ рдореЗрд░реЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ "рд╢рд╛рдорд┐рд▓" рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╕реЗ рдмрд╛рд╣рд░ рдкреИрджрд╛ рд╣реБрдЖ рдерд╛, рдмрд┐рдирд╛ рдЯрд╛рдЗрдк рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рдкреНрд░рдХрдЯ рд╣реЛрдиреЗ рдХреЗ рдмрд┐рдирд╛, рдЬрдм рд╡реЗ рддрд╛рд░ рдореЗрдВ рдорд╛рдирдХреАрдХреГрдд рд╣реЛрддреЗ рдереЗред </p><br><p>  рдирд┐рдпреБрдХреНрддрд┐ рдореЗрдВ рд╕рдмрд╕реЗ рдирд╛рдЯрдХреАрдп рдЕрдВрддрд░ рдЕрднреА рднреА рд╣реИред  рдИрдПрдл рдХреЛрд░ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ - рдиреЗрд╡рд┐рдЧреЗрд╢рди (рд╢рд╛рдЦрд╛рдУрдВ рдХреА рдиреЛрдбреНрд╕) рдХреЗ рдЧреБрдгреЛрдВ рдХрд╛ рд╕рдорд╛рд╡реЗрд╢, рдбреАрдПрд╕рдПрд▓ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ - рдкреНрд░рддреНрдпреЗрдХ рдЧрдгрдирд╛ рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХреЗ рд▓рд┐рдП рдПрдХ рдирд╛рдо (рдкрде) рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реБрдП рдЧрдгрдирд╛ рдХреЗ рдПрдХ рдкреЗрдбрд╝ рдХреЗ рдЯреНрд░реИрд╡рд░реНрд╕рд▓ рдХрд╛ рд░рд┐рдХреЙрд░реНрдбред </p><br><p>  EF Core рдХреЗ рдЖрдВрддрд░рд┐рдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдореЗрдВ <code>e=&gt;User.Name</code> Expression.Member рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╛рдкреНрдд рддрд╛рд░ рдХреА рдПрдХ рд╕реВрдЪреА рд╢рд╛рдорд┐рд▓ рд╣реИ ( <code>e=&gt;User.Name</code> рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐)ред <code>e=&gt;User.Name</code> рдХреЗрд╡рд▓ [ <code>e=&gt;User.Name</code> ] рд╣реЛ рд╕рдХрддрд╛ рд╣реИ ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://msdn.microsoft.com/en-us/usibrary/system.linq.expressions)ред рдореЗрдореНрдмреНрд░реЗрдХреНрд╕рдкреНрд░реЗрд╢рди (v = рдмрдирд╛рдо 110) .aspx</a> рдФрд░ рдЖрдВрддрд░рд┐рдХ рд╡рд┐рдЪрд╛рд░реЛрдВ рдореЗрдВ рдХреЗрд╡рд▓ <code>Name</code> рд░реЗрдЦрд╛ рдмрдЪ рдЬрд╛рддреА рд╣реИ)ред </p><br><p>  DSL рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ, рдЖрдВрддрд░рд┐рдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ <a href="">ChainNode рдФрд░ ChainMemberNode</a> рдХрдХреНрд╖рд╛рдПрдВ рд╣реИрдВ рдЬреЛ <a href="">рд╕рдВрдкреВрд░реНрдг</a> рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ (рдЬреИрд╕реЗ <code>e=&gt;User.Name</code> ) рдХреЛ <code>e=&gt;User.Name</code> , рдЬреЛ рдХрд┐, рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рд╣реИ, рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреЗрдбрд╝ рдореЗрдВ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдпрд╣ рдЗрд╕ рдмрд╛рдд рд╕реЗ рдареАрдХ рд╣реИ рдХрд┐ DSL рдореЗрдВ рдлрд╝реАрд▓реНрдб рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдорд╛рди рджреЛрдиреЛрдВ рдкреНрд░рдХрд╛рд░ рдФрд░ рдлрд╝рдВрдХреНрд╢рди рдХреЙрд▓ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ: </p><br><p>  рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди: </p><br><pre> <code class="cs hljs">Include&lt;User&gt; include = chain =&gt; chain .Include(i =&gt; i.UserName) .Include(i =&gt; i.Email.ToUpper(),<span class="hljs-string"><span class="hljs-string">"EAddress"</span></span>);</code> </pre> <br><p>  рдЗрд╕рдХреЗ рд╕рд╛рде рдХреНрдпрд╛ рдХрд░рдирд╛ рд╣реИ рдпрд╣ рджреБрднрд╛рд╖рд┐рдпрд╛ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред  CreateFormatter- {"UserName": "John", "ERddress": "JOHN@MAIL.COM"} рд╡рд╛рдкрд╕ рдЖрдПрдЧрд╛ </p><br><p>  рдирд┐рд╖реНрдкрд╛рджрди рдЕрд╢рдХреНрдд рд╕рдВрд░рдЪрдирд╛рдУрдВ рдкрд░ рдЯреНрд░реИрд╡рд░реНрд╕рд▓ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред </p><br><pre> <code class="cs hljs">Include&lt;StrangePointF&gt; include = chain =&gt; chain .Include(e =&gt; e.NextPoint) <span class="hljs-comment"><span class="hljs-comment">// NextPoint is nullable struct .ThenIncluding(e =&gt; e.Value.X) .ThenInclude(e =&gt; e.Value.Y); // but not this way (abstraction leak) // Include&lt;StrangePointF&gt; include // = chain =&gt; chain // now this can throw an exception // .Include(e =&gt; e.NextPoint.Value) // .ThenIncluding(e =&gt; eX) // .ThenInclude(e =&gt; eY);</span></span></code> </pre> <br><p>  рдбреАрдПрд╕рдПрд▓ рдореЗрдВ рдорд▓реНрдЯреА-рд▓реЗрд╡рд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдЫреЛрдЯреА рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рднреА рд╢рд╛рдорд┐рд▓ рд╣реИред </p><br><pre> <code class="cs hljs">Include&lt;User&gt; include = chain =&gt; chain .Include(i =&gt; i.UserName) .IncludeAll(i =&gt; i.Groups) <span class="hljs-comment"><span class="hljs-comment">// ING-form - doesn't change current node .ThenIncluding(e =&gt; e.GroupName) // leaf .ThenIncluding(e =&gt; e.GroupDescription) // leaf .ThenInclude(e =&gt; e.AdGroup); // leaf</span></span></code> </pre> <br><p>  рд╕реЗ рддреБрд▓рдирд╛ рдХрд░реЗрдВ </p><br><pre> <code class="cs hljs">Include&lt;User&gt; include = chain =&gt; chain .Include(i =&gt; i.UserName) .IncludeAll(i =&gt; i.Groups) .ThenInclude(e =&gt; e.GroupName) .IncludeAll(i =&gt; i.Groups) .ThenInclude(e =&gt; e.GroupDescription) .IncludeAll(i =&gt; i.Groups) .ThenInclude(e =&gt; e.AdGroup);</code> </pre> <br><p>  рдФрд░ рдпрд╣рд╛рдБ рднреА рдЕрдореВрд░реНрддрддрд╛ рдХрд╛ рд░рд┐рд╕рд╛рд╡ рд╣реИред  рдпрджрд┐ рдореИрдВрдиреЗ рдЗрд╕ рд░реВрдк рдореЗрдВ рдиреЗрд╡рд┐рдЧреЗрд╢рди рдХреЛ рдиреАрдЪреЗ рд▓рд┐рдЦрд╛ рд╣реИ, рддреЛ рдореБрдЭреЗ рдкрддрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдПрдХ рджреБрднрд╛рд╖рд┐рдпрд╛ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдХрд┐ QuaryableExtensions рдХреЛ рдХреЙрд▓ рдХрд░реЗрдЧрд╛ред  рдФрд░ рд╡рд╣ "рд╕реНрдЯреНрд░рд┐рдВрдЧ" рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред  рдХреНрдпрд╛ рдмрд╛рдд рд╣реЛ рд╕рдХрддреА рд╣реИ (рдЖрдкрдХреЛ рдзреНрдпрд╛рди рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП)ред </p><br><p>  <strong>рдмреАрдЬрдЧрдгрд┐рдд рдореЗрдВ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпрд╛рдБ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ</strong> ред </p><br><p>  рд╢рд╛рдорд┐рд▓ рднрд╛рд╡ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><div class="spoiler">  <b class="spoiler_title">Cravnivat</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b1 = InlcudeExtensions.IsEqualTo(include1, include2); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b2 = InlcudeExtensions.IsSubTreeOf(include1, include2); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b3 = InlcudeExtensions.IsSuperTreeOf(include1, include2);</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">рдХреНрд▓реЛрди</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> include2 = InlcudeExtensions.Clone(include1);</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">рдХрдореНрдмрд╛рдЗрди (рдорд░реНрдЬ)</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> include3 = InlcudeExtensions.Merge(include1, include2);</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">XPath рд╕реВрдЪрд┐рдпреЛрдВ рдореЗрдВ рдХрдирд╡рд░реНрдЯ рдХрд░реЗрдВ - рдкрддреНрдерд░реЛрдВ рдХреЗ рд▓рд┐рдП рд╕рднреА рдкрде</b> <div class="spoiler_text"><pre> <code class="cs hljs">IReadOnlyCollection&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; paths1 = InlcudeExtensions.ListLeafXPaths(include); <span class="hljs-comment"><span class="hljs-comment">// as xpaths IReadOnlyCollection&lt;string[]&gt; paths2 = InlcudeExtensions.ListLeafKeyPaths(include); // as string[]</span></span></code> </pre> </div></div><br><p>  рдЖрджрд┐ </p><br><p>  рдЕрдЪреНрдЫреА рдЦрдмрд░ рдпрд╣ рд╣реИ: рдЕрдореВрд░реНрддрддрд╛ рдХреА рдХреЛрдИ рд▓реАрдХ рдирд╣реАрдВ рд╣реИ, рд╢реБрджреНрдз рдЕрдореВрд░реНрдд рдХрд╛ рд╕реНрддрд░ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдкрд╣реБрдВрдЪ рдЧрдпрд╛ рд╣реИред  рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╣реИ рдФрд░ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред </p><br><h2 id="dialektika">  рджреНрд╡рдВрджреНрд╡рд╡рд╛рдж </h2><br><p>  DSL рдореЗрдВ рдЖрдкрдХреЛ рдЕрдореВрд░реНрддрддрд╛ рдХреЗ рдПрдХ рдирдП рд╕реНрддрд░ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЙрдкрд▓рдмреНрдзрд┐ рдХреЗ рд╕рдордп, рдЕрдЧрд▓реЗ рд╕реНрддрд░ рдкрд░ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХрд╛ рдЧрдарди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: рд╕реНрд╡рдпрдВ рднрд╛рд╡ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВред </p><br><p>  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдзрд╛рд░рд╛рдкреНрд░рд╡рд╛рд╣ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдбреАрдПрд╕рдПрд▓ рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИ, рдЖрдкрдХреЛ рдмрд╕ рдЖрдВрддрд░рд┐рдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рд╕рдВрд░рдЪрдирд╛ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> root = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChainNode(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Point)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> child = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChainPropertyNode( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>), expression: <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Point).CreatePropertyLambda(<span class="hljs-string"><span class="hljs-string">"X"</span></span>), memberName:<span class="hljs-string"><span class="hljs-string">"X"</span></span>, isEnumerable:<span class="hljs-literal"><span class="hljs-literal">false</span></span>, parent:root ); root.Children.Add(<span class="hljs-string"><span class="hljs-string">"X"</span></span>, child); <span class="hljs-comment"><span class="hljs-comment">// or there is number of extension methods eg: var child = root.AddChild("X"); Include&lt;Point&gt; include = ChainNodeExtensions.ComposeInclude&lt;Point&gt;(root);</span></span></code> </pre> <br><p>  рдЖрдк рджреБрднрд╛рд╖рд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╕реНрддреБрддрд┐ рд╕рдВрд░рдЪрдирд╛рдПрдВ рднреА рдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдлрд┐рд░, рдзрд╛рд░рд╛рдкреНрд░рд╡рд╛рд╣ рдбреАрдПрд╕рдПрд▓ рд░рд┐рдХреЙрд░реНрдб рдЖрдЦрд┐рд░ рдХреНрдпреЛрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ?  рдпрд╣ рдПрдХ рд╡рд┐рд╢реБрджреНрдз рд░реВрдк рд╕реЗ рд╕рдЯреНрдЯрд╛ рдкреНрд░рд╢реНрди рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрддреНрддрд░ рд╣реИ: рдХреНрдпреЛрдВрдХрд┐ рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдВ - рдПрдХ рдЖрдВрддрд░рд┐рдХ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рд╡рд┐рдХрд╕рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (рдФрд░ рдпрд╣ рднреА рд╡рд┐рдХрд╕рд┐рдд рд╣реЛрддрд╛ рд╣реИ) рдХреЗрд╡рд▓ рдбреАрдПрд╕рдПрд▓ рдХреЗ рд╡рд┐рдХрд╛рд╕ рдХреЗ рд╕рд╛рде рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдпрд╛рдиреА рдПрдХ рдЫреЛрдЯрд╛ рдЕрд░реНрдердкреВрд░реНрдг рд░рд┐рдХреЙрд░реНрдб рд╕реНрдерд┐рд░ рдХреЛрдб рдХреЗ рд▓рд┐рдП рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ)ред  рдПрдХ рдмрд╛рд░ рдлрд┐рд░, рдпрд╣ рдирд┐рд╖реНрдХрд░реНрд╖ рдХреЗ рдХрд░реАрдм рдХрд╣рд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><h2 id="copy-clone-equals">  рдХреЙрдкреА, рдХреНрд▓реЛрди, рдмрд░рд╛рдмрд░ </h2><br><p>  рдЙрдкрд░реЛрдХреНрдд рд╕рднреА рдореЗрдВ рд╕рдореНрдорд┐рд▓рд┐рдд-рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рджреБрднрд╛рд╖рд┐рдпреЛрдВ рдХрд╛ рд╕рдЪ рд╣реИ рдЬреЛ <strong>рдХреЙрдкреА</strong> , <strong>рдХреНрд▓реЛрди рдХреЛ</strong> рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ, <strong>рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐рдпреЛрдВ</strong> рдХреЛ <strong>рдмрд░рд╛рдмрд░ рдХрд░рддреЗ</strong> рд╣реИрдВред </p><br><div class="spoiler">  <b class="spoiler_title">рдмрд░рд╛рдмрд░</b> <div class="spoiler_text"><p>  рд╕рдореНрдорд┐рд▓рд┐рдд-рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рд╕реЗ рдкрддреНрддрд┐рдпреЛрдВ рдкрд░ рдХреЗрд╡рд▓ рддреБрд▓рдирд╛ рдХрд░реЗрдВред <br>  рдЫрд┐рдкреА рд╣реБрдИ рд╢рдмреНрджрд╛рд░реНрде рд╕рдорд╕реНрдпрд╛: рд╕реВрдЪреА рдореЗрдВ рдореВрд▓реНрдпрд╛рдВрдХрди рдпрд╛ рдЖрджреЗрд╢ рдирд╣реАрдВ </p><br><pre> <code class="cs hljs">Include&lt;User&gt; include = chain=&gt;chain.Include(e=&gt;e.UserId).IncludeAll(e=&gt;e.Groups).ThenInclude(e=&gt;e.GroupId) <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> b1 = ObjectExtensions.Equals(user1, user2, include); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> b2 = ObjectExtensions.EqualsAll(userList1, userList2, include);</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">рдХреНрд▓реЛрди</b> <div class="spoiler_text"><p>  рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдиреЛрдбреНрд╕ рд╕реЗ рдЧреБрдЬрд░реЗрдВред  рдирд┐рдпрдо рд╕реЗ рдореЗрд▓ рдЦрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЧреБрдгреЛрдВ рдХреА рдирдХрд▓ рдХреА рдЬрд╛рддреА рд╣реИред </p><br><pre> <code class="cs hljs">Include&lt;User&gt; include = chain=&gt;chain.Include(e=&gt;e.UserId).IncludeAll(e=&gt;e.Groups).ThenInclude(e=&gt;e.GroupId) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newUser = ObjectExtensions.Clone(user1, include, leafRule1); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newUserList = ObjectExtensions.CloneAll(userList1, leafRule1);</code> </pre> <br><p>  рдПрдХ рджреБрднрд╛рд╖рд┐рдпрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЗрд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдкрддреНрддреА рдХрд╛ рдЪрдпрди рдХрд░реЗрдЧрд╛ред  рдРрд╕рд╛ рдХреНрдпреЛрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ - рдПрдХ рдЕрд▓рдЧ рдирд┐рдпрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ?  ObjectExtensions.Copy рдХреЗ рд╢рдмреНрджрд╛рд░реНрде рдХреЗ рд╕рдорд╛рди рдХреНрдпрд╛ рдерд╛ </p></div></div><br><div class="spoiler">  <b class="spoiler_title">рдкреНрд░рддрд┐рд▓рд┐рдкрд┐</b> <div class="spoiler_text"><p>  рдиреЛрдбреНрд╕ рд╕реЗ рдЧреБрдЬрд░реЗрдВ - рдПрдХ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рд╢рд╛рдЦрд╛ рдФрд░ рдкрддреНрддреА рдиреЛрдбреНрд╕ рджреНрд╡рд╛рд░рд╛ рдкрд╣рдЪрд╛рдиред  рдирд┐рдпрдо рд╕реЗ рдореЗрд▓ рдЦрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЧреБрдгреЛрдВ рдХреА рдирдХрд▓ рдХреА рдЬрд╛рддреА рд╣реИ (рдХреНрд▓реЛрди рдХреЗ рд╕рдорд╛рди)ред </p><br><pre> <code class="cs hljs">Include&lt;User&gt; include = chain=&gt;chain.IncludeAll(e=&gt;e.Groups); ObjectExtensions.Copy(user1, user2, include, supportedLeafsRule); ObjectExtensions.CopyAll(userList1, userList2, include, supportedLeafsRule);</code> </pre> <br><p>  рдПрдХ рджреБрднрд╛рд╖рд┐рдпрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдкрддреНрддреА рдХрд╛ рдЪрдпрди рд╣реЛрдЧрд╛ред  рдРрд╕рд╛ рдХреНрдпреЛрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ - рдПрдХ рдЕрд▓рдЧ рдирд┐рдпрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ?      ObjectExtensions.Copy (   тАФ  include   ,  supportedLeafsRule тАФ   ). </p></div></div><br><p>  copy / clone   : </p><br><ol><li>   readonly ,     Tuple&lt;,&gt;  Anonymous Type.    ,     . </li><li>   (. IEnumerable   ) тАФ  public   . </li><li>  expression  include-,       тАФ  . </li><li> "  "    . </li></ol><br><p>  DSL                   , ..               . ,     <code>Tuple&lt;,&gt;</code> , ..  c readonly ,   <code>ValueTuple&lt;,&gt;</code> c writabale      (      ). </p><br><p>  ,         (    Expression Trees) Includes  тАФ  .     Include DSL  . </p><br><p>    Detach, FindDifferences  .. </p><br><h2 id="pochemu-run-time-a-ne-cs-sgenerirovannyy-do-nachala-kompilyacii">  run-time,   .cs    ? </h2><br><p>    .cs  ,   ,   <em>run-time</em>   : </p><br><ol><li>       ( ,  , source control). </li><li>     , ,  ,   тАФ     . </li><li>         . </li><li>   "  ".  dev time   ,     : ""      ""   ,  ""    , ,  ""   . </li></ol><br><p>   Roslyn',          .    Typescript  (  DTO  , ..   ) тАФ   DSL Includes  Roslyn' ( ) тАФ      typescript ( ).  " "    " "  .cs (   Expression Trees). </p><br><p> :   run time тАФ   ,  .             (        Expression Trees). </p><br><h2 id="problemy-s-effektivnostyu-skompilirovannyh-funkciy-expression-trees">      Expression Trees </h2><br><p>   Internal DSL   Expression Tree    : </p><br><ol><li><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><code>LambdaExpression.Compile</code></a>    <em>Lambda</em> .     ,  .    ,   "" expression tree,   CallExpression    тАФ  LambdaExpression,   (.  LambdaExpression)    ConstantExpression.    ,  " /" тАФ      ,    Expression Trees. </p><br></li><li><p>       <em>ssmbly</em> ,     ( 10    )    ( assembly  ,    тАФ  ). , ,  ,      тАФ  . </p><br></li></ol><br><p>     ,        (  ),     ,       .    :       .   тАФ  тАФ   .cs     . </p><br><h2 id="benchmark-serializacii">   </h2><br><p>  тАФ     600   15   .  JSON.NET, ServiceStack    reflection' GetProperties(). </p><br><p> dslComposeFormatter тАФ ComposeFormatter   ,   <a href=""></a> . </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">BenchmarkDotNet</a> =v0.10.14, OS=Windows 10.0.17134 <br> Intel Core i5-2500K CPU 3.30GHz (Sandy Bridge), 1 CPU, 4 logical and 4 physical cores <br> .NET Core SDK=2.1.300 </p><br><table><thead><tr><th> Method </th><th> Mean </th><th> Error </th><th> StdDev </th><th> Min </th><th> Max </th><th> Median </th><th> Allocated </th></tr></thead><tbody><tr><td> dslComposeFormatter </td><td> 2.208 ms </td><td> 0.0093 ms </td><td> 0.0078 ms </td><td> 2.193 ms </td><td> 2.220 ms </td><td> 2.211 ms </td><td> 849.47 KB </td></tr><tr><td> JsonNet_Default </td><td> 2.902 ms </td><td> 0.0160 ms </td><td> 0.0150 ms </td><td> 2.883 ms </td><td> 2.934 ms </td><td> 2.899 ms </td><td> 658.63 KB </td></tr><tr><td> JsonNet_NullIgnore </td><td> 2.944 ms </td><td> 0.0089 ms </td><td> 0.0079 ms </td><td> 2.932 ms </td><td> 2.960 ms </td><td> 2.942 ms </td><td> 564.97 KB </td></tr><tr><td> JsonNet_DateFormatFF </td><td> 3.480 ms </td><td> 0.0121 ms </td><td> 0.0113 ms </td><td> 3.458 ms </td><td> 3.497 ms </td><td> 3.479 ms </td><td> 757.41 KB </td></tr><tr><td> JsonNet_DateFormatSS </td><td> 3.880 ms </td><td> 0.0139 ms </td><td> 0.0130 ms </td><td> 3.854 ms </td><td> 3.899 ms </td><td> 3.877 ms </td><td> 785.53 KB </td></tr><tr><td> ServiceStack_SerializeToString </td><td> 4.225 ms </td><td> 0.0120 ms </td><td> 0.0106 ms </td><td> 4.201 ms </td><td> 4.243 ms </td><td> 4.226 ms </td><td> 805.13 KB </td></tr><tr><td> fake_expressionManuallyConstruted </td><td> 54.396 ms </td><td> 0.1758 ms </td><td> 0.1644 ms </td><td> 54.104 ms </td><td> 54.629 ms </td><td> 54.383 ms </td><td> 7401.58 KB </td></tr></tbody></table><br><p> fake_expressionManuallyConstruted тАФ expression      ( ). </p><br><h2 id="formalizaciya">  </h2><br><p>   DSL   : <strong>   DSL      ;    Internal DSL   run-time</strong> . </p><br><p> Expression Tree         <em></em>   .NET Standard . </p><br><p>     Expression Trees  <em> </em>     Internal DSL    Fluent API.      #      . </p><br><p>         fluent   (   Expression Trees),      Internal DSL  #     fluent,      ""   Expression Trees. </p><br><p> <strong>Expression Trees</strong>  <strong>DSL Includes</strong>      (  ,      ),      /  run-time тАФ  (run-time ). </p><br><p>  <strong>Internal DSL</strong>       :   -  <strong>serialize</strong> , <strong>copy</strong> , <strong>clone</strong> , <strong>equals</strong>        <strong>       ""</strong> .   ,      " ",      .    :  includes    (   ) ,       (       ,  ). </p><br><h2 id="zaklyuchenie">  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br><p>   DSL Includes    DTO           тАФ   ( json).        ,    ,    ,   " ",        .   =   . </p><br><p>       Internal DSL       ,   DSL,      Internal DSL (    Expression)         (     Expression Tree). </p><br><p>  DSL Includes  json  ComposeFormatter    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">DashboardCodes.Routines</a>   nuget  GitHub. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi419759/">https://habr.com/ru/post/hi419759/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi419735/index.html">рдПрдбреЛрдм рдСрдбрд┐рд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрд╕рдбреАрдЖрд░ рдХреЗ рд╕рд╛рде I / Q рд╕рд┐рдЧреНрдирд▓ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдирд╛</a></li>
<li><a href="../hi419743/index.html">рд▓реЛрдХрдкреНрд░рд┐рдп рд▓реЗрдЦреЛрдВ рдореЗрдВ рдпрд╣ рдЧрд▓рдд рдХреНрдпрд╛ рд╣реИ рдХрд┐ рдлреВ рдмрд╛рд░ рд╕реЗ рдЬреНрдпрд╛рджрд╛ рддреЗрдЬ рд╣реИ?</a></li>
<li><a href="../hi419745/index.html">рдХреНрд▓рд╛рд╕рд┐рдХ рдР рд╢реИрд▓реА: рдПрдордПрд▓ рдЦреБрдж рдХрд╡рд┐рддрд╛ рдореЗрдВ рддрд▓рд╛рд╢ рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi419747/index.html">рдбреАрдЬреЗрдЖрдИ рд░реЛрдирд┐рди рдПрд╕ - рдкрд╣рд▓рд╛ рд▓реЙрдиреНрдЪ рдФрд░ рдореБрдЦреНрдп рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ</a></li>
<li><a href="../hi419757/index.html">рдПрдВрдбреНрд░рдпреВ рдЕрди рдХреА рдкреБрд╕реНрддрдХ рдХрд╛ рдЕрдиреБрд╡рд╛рдж, рдкреИрд╢рди рдлреЙрд░ рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ, рдЕрдзреНрдпрд╛рдп 1 - 14</a></li>
<li><a href="../hi419761/index.html">рдЖрд░реНрдХреЗрдб рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рд╕рд╛рде рдкрд╛рдпрдерди рдореЗрдВ 2 рдбреА рдЧреЗрдо рдмрдирд╛рдПрдВ</a></li>
<li><a href="../hi419763/index.html">рдиреЗрдЯрд╡рд░реНрдХ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рд╕реЗрдЯ рдХреЗ рд▓рд┐рдП "рдЙрдкрд▓рдмреНрдзрддрд╛ рдХрд╛рд░рдХ" рдХреА рдЧрдгрдирд╛ рдХреЗ рдЙрджрд╛рд╣рд░рдг</a></li>
<li><a href="../hi419765/index.html">MSTU рд╕реЗ рдкрд╛рдареНрдпрдХреНрд░рдо "рд╡реЗрдм рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛рдУрдВ" (рд░реВрдмреА рдкрд░ рдЖрдзрд╛рд░рд┐рдд)ред рдЯреЗрдХреНрдиреЛрд╕реНрдЯреНрд░реАрдо рдЪреИрдирд▓ рдкрд░ рдПрди.рдИ. рдмреЛрдорди</a></li>
<li><a href="../hi419767/index.html">рд╡рд┐рдХрд┐рдкреАрдбрд┐рдпрд╛ рдирд┐рд░реНрдорд╛рддрд╛ рдкреНрд░рд╢реНрди рдХрд╛ рдЙрддреНрддрд░ рджреЗрддрд╛ рд╣реИ: рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ, рдиреАрдВрдж, рдХрд┐рддрд╛рдмреЗрдВ, рдЬреАрд╡рди рдХреЗ рд▓рд┐рдП рдЯрд┐рдкреНрд╕</a></li>
<li><a href="../hi419769/index.html">рд╡рд╛рдпрд░рдЧрд╛рд░реНрдб рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рдореЗрдВ "рдЖрдПрдЧрд╛" - рдХреНрдпреЛрдВ?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>