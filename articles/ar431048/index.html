<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ข ๐จ ๐ฟ ุขูุฉ ุงูุญุฏุซ ุชุญุฑุณ ุฏูุฑุฉ ุงูุญูุงุฉ ๐จ๐พโ๐ป ๐ง๐พ ๐ฌ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฅุฎูุงุก ุงููุณุคูููุฉ: ุชูุถุญ ูุฐู ุงูููุงูุฉ ุญูุงู ุบูุฑ ูุงุถุญ ููุดููุฉ ุบูุฑ ูุงุถุญุฉ. ูุจู ุงูุชุณุฑุน  ุจูุถ  ูุถุนูุง ููุถุน ุงูุชูููุฐ ุ ุฃูุตู ุจูุฑุงุกุฉ ุงูููุงูุฉ ุญุชู ุงูููุงูุฉ ูุงูุชูููุฑ ูุฑุชูู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุขูุฉ ุงูุญุฏุซ ุชุญุฑุณ ุฏูุฑุฉ ุงูุญูุงุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431048/" style=";text-align:right;direction:rtl"><blockquote style=";text-align:right;direction:rtl">  ุฅุฎูุงุก ุงููุณุคูููุฉ: ุชูุถุญ ูุฐู ุงูููุงูุฉ ุญูุงู ุบูุฑ ูุงุถุญ ููุดููุฉ ุบูุฑ ูุงุถุญุฉ.  ูุจู ุงูุชุณุฑุน <del>  ุจูุถ </del>  ูุถุนูุง ููุถุน ุงูุชูููุฐ ุ ุฃูุตู ุจูุฑุงุกุฉ ุงูููุงูุฉ ุญุชู ุงูููุงูุฉ ูุงูุชูููุฑ ูุฑุชูู. </blockquote><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/sb/cj/hs/sbcjhsnrjjqhgrl0xcpicmvzn40.png" alt="ููู_ููุงุฐุง"></p><br><p style=";text-align:right;direction:rtl">  ูุฑุญุจุง ุจุงูุฌููุน!  ุนูุฏ ุงูุนูู ูุน ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุ ุบุงูุจูุง ูุง ูุชุนูู ุนูููุง ุงูุชุนุงูู ูุน <em>ุงูุญุงูุฉ</em> .  ุฅุญุฏู ูุฐู ุงูุญุงูุงุช ูู ุฏูุฑุฉ ุญูุงุฉ ุงูุฃุดูุงุก.  ูููู ุฃู ุชููู ุฅุฏุงุฑุฉ ูุงุฆู ุจุนุฏุฉ ุญุงูุงุช ูุญุชููุฉ ูููุฉ ุบูุฑ ุชุงููุฉ ููุบุงูุฉ.  ุฃุถู ุชูููุฐูุง ุบูุฑ ูุชุฒุงูู ููุง ูุงููููุฉ ูุนูุฏุฉ ุจุฃูุฑ ูู ุงูุญุฌู.  ููุงู ุญู ูุนุงู ูุทุจูุนู.  ูู ูุฐู ุงูููุงูุฉ ุณุฃุชุญุฏุซ ุนู ุขูุฉ ุงูุญุฏุซ ูููููุฉ ุชูููุฐูุง ูู Go. </p><a name="habracut"></a><br><h2 id="zachem-upravlyat-sostoyaniem" style=";text-align:right;direction:rtl">  ููุงุฐุง ุชุฏูุฑ ุงูุฏููุฉุ </h2><br><p style=";text-align:right;direction:rtl">  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุฏุนูุง ูุญุฏุฏ ุงูููููู ููุณู.  ุฃุจุณุท ูุซุงู ุนูู ุญุงูุฉ: ูููุงุช ูุงุชุตุงูุงุช ูุฎุชููุฉ.  ูุง ููููู ููุท ุฃุฎุฐ ููู ููุฑุงุกุชู.  ูุฌุจ ูุชุญู ุฃููุงู ุ ููู ุงูููุงูุฉ <del>  ููุถู </del>  ุชุฃูุฏ ูู ุฅุบูุงูู.  ุงุชุถุญ ุฃู ุงูุฅุฌุฑุงุก ุงูุญุงูู ูุนุชูุฏ ุนูู ูุชูุฌุฉ ุงูุฅุฌุฑุงุก ุงูุณุงุจู: ุชุนุชูุฏ ุงููุฑุงุกุฉ ุนูู ุงูุงูุชุชุงุญ.  ุงููุชูุฌุฉ ุงููุญููุธุฉ ูู ุงูุฏููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุงููุดููุฉ ุงูุฑุฆูุณูุฉ ูุน ุงูุฏููุฉ ูู ุงูุชุนููุฏ.  ุฃู ุญุงูุฉ ุชุนูุฏ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุชููุงุฆููุง.  ุนููู ุชุฎุฒูู ูุชุงุฆุฌ ุงูุฅุฌุฑุงุกุงุช ูู ุงูุฐุงูุฑุฉ ูุฅุถุงูุฉ ุนูููุงุช ุชุญูู ูุฎุชููุฉ ุฅูู ุงูููุทู.  ูุฐุง ูู ุงูุณุจุจ ูู ุฃู ุงูููุงูู ุนุฏููุฉ ุงูุฌูุณูุฉ ุฌุฐุงุจุฉ ููุบุงูุฉ ูููุจุฑูุฌูู - ูุง ุฃุญุฏ ูุฑูุฏ <del>  ูุดููุฉ </del>  ุงูุตุนูุจุงุช.  ุฅุฐุง ูุงูุช ูุชุงุฆุฌ ุฃูุนุงูู ูุง ุชุคุซุฑ ุนูู ููุทู ุงูุชูููุฐ ุ ูุฃูุช ูุณุช ุจุญุงุฌุฉ ุฅูู ุญุงูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููุน ุฐูู ุ ููุงู ุฎุงุตูุฉ ูุงุญุฏุฉ ุชุฌุนูู ุชุญุณุจ ุงูุตุนูุจุงุช.  ุชุชุทูุจ ููู ุงูุฏููุฉ ุงุชุจุงุน ุชุฑุชูุจ ูุญุฏุฏ ูู ุงูุฅุฌุฑุงุกุงุช.  ุจุดูู ุนุงู ุ ูุฌุจ ุชุฌูุจ ูุซู ูุฐู ุงูุญุงูุงุช ุ ูููู ูุฐุง ููุณ ูููููุง ุฏุงุฆููุง.  ููู ุงูุฃูุซูุฉ ุนูู ุฐูู ุฏูุฑุฉ ุญูุงุฉ ูุงุฆูุงุช ุงูุจุฑูุงูุฌ.  ุจูุถู ุงูุฅุฏุงุฑุฉ ุงูุฌูุฏุฉ ููุญุงูุฉ ุ ูููู ูููุฑุก ุงูุญุตูู ุนูู ุณููู ูููู ุงูุชูุจุค ุจู ูููุงุฆูุงุช ุฐุงุช ุฏูุฑุฉ ุงูุญูุงุฉ ุงููุนูุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุฏุนููุง ูุชุนุฑู ุนูู ููููุฉ ุงูููุงู ุจุฐูู. </p><br><h2 id="avtomat-kak-sposob-resheniya-problem" style=";text-align:right;direction:rtl">  ุขูู ููุณููุฉ ูุญู ุงููุดุงูู </h2><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/eg/qd/1o/egqd1oejaztizauope6waesapm0.jpeg" alt="AK74"></p><br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ูุชุญุฏุซ ุงููุงุณ ุนู ุงูุญุงูุงุช ุ ุชุชุจุงุฏุฑ ุฅูู ุงูุฐูู ุขูุงุช ุงูุญุงูุฉ ุงููุญุฏูุฏุฉ ุนูู ุงูููุฑ.  ูุฐุง ููุทูู ุ ูุฃู ุงูุฃูุชููุงุชููู ูู ุงูุทุฑููุฉ ุงูุฃูุซุฑ ุทุจูุนูุฉ ูุฅุฏุงุฑุฉ ุงูุฏููุฉ. </p><br><blockquote style=";text-align:right;direction:rtl">  ูู ุฃุฎูุถ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุธุฑูุฉ ุงูุฃุชูุชุฉ</a> ุ ูููุงู ุฃูุซุฑ ูู ูุนูููุงุช ูุงููุฉ ุนูู ุงูุฅูุชุฑูุช. </blockquote><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุชุจุญุซ ุนู ุฃูุซูุฉ ุนูู ุขูุงุช ุงูุญุงูุฉ ุงููุญุฏูุฏุฉ ูู Go ุ ูุณูู ุชูุงุจู ุจุงูุชุฃููุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">lexer ูู Rob Pike</a> .  ูุซุงู ุฑุงุฆุน ุนูู ุขูุฉ ุฃูุชููุงุชูููุฉ ุชููู ูููุง ุงูุจูุงูุงุช ุงูุชู ุชุชู ูุนุงูุฌุชูุง ูู ุงูุฃุจุฌุฏูุฉ ุงููุฏุฎูุฉ.  ูุฐุง ูุนูู ุฃู ุงูุชูุงูุงุช ุงูุญุงูุฉ ูุงุชุฌุฉ ุนู ุงููุต ุงูุฐู ูุนุงูุฌ lexer.  ุญู ุฃููู ููุดููุฉ ูุญุฏุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุงูุดูุก ุงูุฑุฆูุณู ุงูุฐู ูุฌุจ ูููู ูู ุฃู ุงูุฃูุชููุงุชููู ูู ุญู ููุดููุฉ ูุญุฏุฏุฉ ุจุฏูุฉ.  ูุฐูู ุ ูุจู ุงุนุชุจุงุฑูุง ูุนูุงุฌ ูุฌููุน ุงููุดุงูู ุ ูุฌุจ ุฃู ุชููู ุงููููุฉ ุชูุงููุง.  ุนูู ูุฌู ุงูุชุญุฏูุฏ ุ ุงูููุงู ุงูุฐู ุชุฑูุฏ ุงูุชุญูู ููู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุฏูู - ุฏูุฑุฉ ุงูุญูุงุฉ ุ </li><li style=";text-align:right;direction:rtl">  ุงูุฃุญุฏุงุซ - ุจุงูุถุจุท ูุง ูุณุจุจ ุงูุงูุชูุงู ุฅูู ูู ุฏููุฉ ุ </li><li style=";text-align:right;direction:rtl">  ูุชูุฌุฉ ุงูุนูู - ุจูุงูุงุช ุงูุฅุฎุฑุงุฌ ุ </li><li style=";text-align:right;direction:rtl">  ูุถุน ุงูุชูููุฐ (ูุชุฒุงูู / ุบูุฑ ูุชุฒุงูู) ุ </li><li style=";text-align:right;direction:rtl">  ุญุงูุงุช ุงูุงุณุชุฎุฏุงู ุงูุฑุฆูุณูุฉ. </li></ul><br><p style=";text-align:right;direction:rtl">  ุฅู ุฌูุงุฒ lexer ุฌููู ุ ูููู ูุบูุฑ ุงูุญุงูุฉ ููุท ุจุณุจุจ ุงูุจูุงูุงุช ุงูุชู ูุนุงูุฌูุง ุจููุณู.  ูููู ูุงุฐุง ุนู ุงููููู ุนูุฏูุง ูุณุชุฏุนู ุงููุณุชุฎุฏู ุงูุชุญููุงุชุ  ูุฐุง ูู ุงูููุงู ุงูุฐู ูููู ุฃู ุชุณุงุนุฏ ููู ุขูุฉ ุงูุญุฏุซ. </p><br><h2 id="realnyy-primer" style=";text-align:right;direction:rtl">  ูุซุงู ุญูููู </h2><br><p style=";text-align:right;direction:rtl"> ูุชูุถูุญ ุงูุฃูุฑ ุ ุณุฃููู ุจุชุญููู ูุซุงู ูู ููุชุจุฉ <code>phono</code> . </p><br><blockquote style=";text-align:right;direction:rtl">  ููุญุตูู ุนูู ุงูุงูุบูุงุณ ุงููุงูู ูู ุงูุณูุงู ุ ููููู ูุฑุงุกุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงูุฉ ุงูุชูููุฏูุฉ</a> .  ูุฐุง ููุณ ุถุฑูุฑููุง ููุฐุง ุงูููุถูุน ุ ููููู ุณูุณุงุนุฏ ุนูู ููู ุฃูุถู ููุง ูุฏูุฑู. </blockquote><br><h3 id="a-chem-upravlyaem" style=";text-align:right;direction:rtl">  ููุงุฐุง ูุฏูุฑุ </h3><br><p style=";text-align:right;direction:rtl">  ูุนุชูุฏ <code>phono</code> ุนูู ุฎุท ุฃูุงุจูุจ DSP.  ูุชุชููู ูู ุซูุงุซ ูุฑุงุญู ูููุนุงูุฌุฉ.  ูุฏ ุชุชุถูู ูู ูุฑุญูุฉ ูููููุง ูุงุญุฏูุง ุฅูู ุนุฏุฉ ููููุงุช: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/go/ym/ep/goymepjg4pds_picireejjsshnq.png" alt="ูุฎุทุท ุงูุฃูุงุจูุจ"></p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <code>pipe.Pump</code> (ุงููุถุฎุฉ ุงูุฅูุฌููุฒูุฉ) ูู ูุฑุญูุฉ ุฅูุฒุงููุฉ <strong>ูุงุณุชูุจุงู</strong> ุงูุตูุช ุ ุฏุงุฆููุง ูููู ูุงุญุฏ ููุท. </li><li style=";text-align:right;direction:rtl">  <code>pipe.Processor</code> (ูุนุงูุฌ ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ) - ูุฑุญูุฉ ุงุฎุชูุงุฑูุฉ <strong>ููุนุงูุฌุฉ</strong> ุงูุตูุช ุ ูู 0 ุฅูู N ูู ุงูููููุงุช. </li><li style=";text-align:right;direction:rtl">  <code>pipe.Sink</code> (ุงูุญูุถ ุงูุฅูุฌููุฒู) - ูุฑุญูุฉ ุฅูุฒุงููุฉ <strong>ูููู</strong> ุงูุตูุช ุ ูู 1 ุฅูู N ูู ุงูููููุงุช. </li></ol><br><p style=";text-align:right;direction:rtl">  ูู ุงููุงูุน ุ ุณูู ูุฏูุฑ ุฏูุฑุฉ ุญูุงุฉ ุงููุงูู. </p><br><h3 id="zhiznennyy-cikl" style=";text-align:right;direction:rtl">  ุฏูุฑุฉ ุงูุญูุงุฉ </h3><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู <code>pipe.Pipe</code> ูุฎุทุท <code>pipe.Pipe</code> . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/le/ni/xq/lenixqpvoh0zaq9j2aftrqprtvg.png" alt="ุฏูุฑุฉ ุญูุงุฉ ุงูุฃูุงุจูุจ"></p><br><p style=";text-align:right;direction:rtl">  ุชุดูุฑ <em>ุงูุฎุทูุท ุงููุงุฆูุฉ</em> ุฅูู ุงูุชุญููุงุช ุงููุงุชุฌุฉ ุนู ููุทู ุงูุชูููุฐ ุงูุฏุงุฎูู.  <strong>ุบุงูู</strong> - ุงูุชุญููุงุช ุงููุงุฌูุฉ ุนู ุงูุฃุญุฏุงุซ.  ููุถุญ ุงูุฑุณู ุงูุจูุงูู ุฃู ุงูุญุงูุงุช ููุณูุฉ ุฅูู ููุนูู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุญุงูุงุช ูุงุฏุฆุฉ</strong> - <code>ready</code> <code>paused</code> ุ ููููู ุงูููุฒ ูููุง ููุท ุญุณุจ ุงูุญุฏุซ </li><li style=";text-align:right;direction:rtl">  <em>ุงูุญุงูุงุช ุงููุดุทุฉ</em> - <code>running</code> <code>pausing</code> ูุคูุช ุ ุงูุชูุงูุงุช ุญุณุจ ุงูุญุฏุซ ูุจุณุจุจ ููุทู ุงูุชูููุฐ </li></ul><br><p style=";text-align:right;direction:rtl">  ูุจู ุงูุชุญููู ุงูุชูุตููู ููููุฏ ุ ูุซุงู ูุงุถุญ ุนูู ุงุณุชุฎุฏุงู ุฌููุน ุงูุญุงูุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// PlayWav  .wav    portaudio  -. func PlayWav(wavFile string) error { bufferSize := phono.BufferSize(512) //      w, err := wav.NewPump(wavFile, bufferSize) //  wav pump if err != nil { return err } pa := portaudio.NewSink( //  portaudio sink bufferSize, w.WavSampleRate(), w.WavNumChannels(), ) p := pipe.New( //  pipe.Pipe    ready w.WavSampleRate(), pipe.WithPump(w), pipe.WithSinks(pa), ) p.Run() //    running   p.Run() errc := p.Pause() //    pausing   p.Pause() err = pipe.Wait(errc) //     paused if err != nil { return err } errc = p.Resume() //    running   p.Resume() err = pipe.Wait(errc) //     ready if err != nil { return err } return pipe.Wait(p.Close()) //      }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุ ุฃูู ุดูุก ุฃููุงู. </p><br><blockquote style=";text-align:right;direction:rtl">  ูู ููุฏ ุงููุตุฏุฑ ูุชุงุญ ูู <a href="">ุงููุณุชูุฏุน</a> . </blockquote><br><h3 id="sostoyaniya-i-sobytiya" style=";text-align:right;direction:rtl">  ุงูุฏูู ูุงูุฃุญุฏุงุซ </h3><br><p style=";text-align:right;direction:rtl">  ููุจุฏุฃ ุจุฃูู ุดูุก. </p><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// state      . type state interface { listen(*Pipe, target) (state, target) //    transition(*Pipe, eventMessage) (state, error) //   } // idleState  .        . type idleState interface { state } // activeState  .         //   . type activeState interface { state sendMessage(*Pipe) state //    } //  . type ( idleReady struct{} activeRunning struct{} activePausing struct{} idlePaused struct{} ) //  . var ( ready idleReady running activeRunning paused idlePaused pausing activePausing )</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจูุถู ุงูุฃููุงุน ุงููููุตูุฉ ุ ูุชู ุฃูุถูุง ุงูุฅุนูุงู ุนู ุงูุชุญููุงุช ุจุดูู ูููุตู ููู ููุงูุฉ.  ูุฐุง ูุชุฌูุจ ุงูุถุฎู <del>  ุงูููุงูู </del>  ูุธุงุฆู ุงูุงูุชูุงู ูุน <code>switch</code> ุงููุชุฏุงุฎูุฉ.  ุงูุฏูู ููุณูุง ูุง ุชุญุชูู ุนูู ุฃู ุจูุงูุงุช ุฃู ููุทู.  ุจุงููุณุจุฉ ููู ุ ููููู ุงูุชุตุฑูุญ ุนู ุงููุชุบูุฑุงุช ุนูู ูุณุชูู ุงูุญุฒูุฉ ุจุญูุซ ูุง ุชูุนู ุฐูู ูู ูู ูุฑุฉ.  ูุทููุจ ูุงุฌูุฉ <code>state</code> ูุชุนุฏุฏ ุงูุฃุดูุงู.  ุณูุชุญุฏุซ ุนู <code>activeState</code> ู <code>idleState</code> ุจุนุฏ ุฐูู ุจูููู. </p><br><p style=";text-align:right;direction:rtl">  ุงูุฌุฒุก ุงูุซุงูู ุงูุฃูุซุฑ ุฃูููุฉ ูู ุขูุฉ ูุฏููุง ูู ุงูุฃุญุฏุงุซ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// event  . type event int //  . const ( run event = iota pause resume push measure cancel ) // target      . type target struct { state idleState //   errc chan error //   ,     } // eventMessage   ,    . type eventMessage struct { event //   params params //   components []string // id  target //      }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุณุจุจ ุงูุญุงุฌุฉ ุฅูู ููุน <code>target</code> ุ ููุฑ ูู ูุซุงู ุจุณูุท.  ููุฏ ูููุง ุจุฅูุดุงุก ูุงูู ุฌุฏูุฏ ุ ููู <code>ready</code> .  ุงูุขู ูู ุจุชุดุบููู ูุน <code>p.Run()</code> .  ูุชู ุฅุฑุณุงู ุญุฏุซ <code>run</code> ุฅูู ุงูุฌูุงุฒ ุ ุญูุซ ููุฑ ุฎุท ุงูุฃูุงุจูุจ ุจุญุงูุฉ <code>running</code> .  ููู ุชุนุฑู ูุชู ููุชูู ุงููุงููุ  ูุฐุง ูู ุงูููุงู ุงูุฐู ุณูุณุงุนุฏูุง ููู ููุน <code>target</code> .  ูุดูุฑ ุฅูู ุญุงูุฉ ุงูุฑุงุญุฉ ุงููุชููุนุฉ ุจุนุฏ ุงูุญุฏุซ.  ูู ูุซุงููุง ุ ุจุนุฏ ุงูุงูุชูุงุก ูู ุงูุนูู ุ ุณูุฏุฎู ุฎุท ุงูุฃูุงุจูุจ ูุฑุฉ ุฃุฎุฑู ูู ุญุงูุฉ <code>ready</code> .  ููุณ ุงูุดูุก ูู ุงูุฑุณู ุงูุจูุงูู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/h8/4i/xv/h84ixvb5dd_2gdbnrcd3kggwyzg.png"></p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุงููุฒูุฏ ุนู ุฃููุงุน ุงูุฏูู.  ุจุชุนุจูุฑ ุฃุฏู ุ ุนู <code>activeState</code> ู <code>activeState</code> .  ูููู ูุธุฑุฉ ุนูู ูุธุงุฆู <code>listen(*Pipe, target) (state, target)</code> ูุฃููุงุน ูุฎุชููุฉ ูู ุงููุฑุงุญู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// listen     ready. func (s idleReady) listen(p *Pipe, t target) (state, target) { return p.idle(s, t) } // listen     running. func (s activeRunning) listen(p *Pipe, t target) (state, target) { return p.active(s, t) }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>pipe.Pipe</code> ูู ูุธุงุฆู ูุฎุชููุฉ ูุงูุชุธุงุฑ ุงูุงูุชูุงู!  ูุงุฐุง ููุฌุฏุ </p><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// idle     .    . func (p *Pipe) idle(s idleState, t target) (state, target) { if s == t.state || s == ready { t = t.dismiss() //  ,  target } for { var newState state var err error select { case e := &lt;-p.events: //   newState, err = s.transition(p, e) //    if err != nil { e.target.handle(err) } else if e.hasTarget() { t.dismiss() t = e.target } } if s != newState { return newState, t // ,    } } } // active     .     , //   . func (p *Pipe) active(s activeState, t target) (state, target) { for { var newState state var err error select { case e := &lt;-p.events: //   newState, err = s.transition(p, e) //    if err != nil { //  ? e.target.handle(err) // ,    } else if e.hasTarget() { // ,  target t.dismiss() //   t = e.target //   } case &lt;-p.provide: //     newState = s.sendMessage(p) //    case err, ok := &lt;-p.errc: //   if ok { //   ,  interrupt(p.cancel) //   t.handle(err) //    } //    ,  return ready, t //    ready } if s != newState { return newState, t // ,    } } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููุฐุง ุ ูููููุง ุงูุงุณุชูุงุน ุฅูู ูููุงุช ูุฎุชููุฉ ูู ููุงูุงุช ูุฎุชููุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุณูุญ ูู ูุฐุง ุจุนุฏู ุฅุฑุณุงู ุฑุณุงุฆู ุฃุซูุงุก ุงูุฅููุงู ุงููุคูุช - ูุญู ููุท ูุง ูุณุชูุน ุฅูู ุงูููุงุฉ ุงูููุงุจูุฉ. </p><br><h3 id="konstruktor-i-start-avtomata" style=";text-align:right;direction:rtl">  ููุดุฆ ูุจุฏุก ุชุดุบูู ุงูุฌูุงุฒ </h3><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/bk/h2/zn/bkh2znujbo_omto9lyhcq-ixp-e.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// New      . //      ready. func New(sampleRate phono.SampleRate, options ...Option) *Pipe { p := &amp;Pipe{ UID: phono.NewUID(), sampleRate: sampleRate, log: log.GetLogger(), processors: make([]*processRunner, 0), sinks: make([]*sinkRunner, 0), metrics: make(map[string]measurable), params: make(map[string][]phono.ParamFunc), feedback: make(map[string][]phono.ParamFunc), events: make(chan eventMessage, 1), //    cancel: make(chan struct{}), //     provide: make(chan struct{}), consume: make(chan message), } for _, option := range options { //   option(p)() } go p.loop() //    return p }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงูุฅุถุงูุฉ ุฅูู ุงูุชููุฆุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงูุฎูุงุฑุงุช ุงููุธูููุฉ</a> ุ ููุงู ุจุฏุงูุฉ ุฌูุฑูุชูู ูููุตู ูุน ุงูุฏูุฑุฉ ุงูุฑุฆูุณูุฉ.  ุญุณููุง ุ ุงูุธุฑ ุฅููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// loop ,     nil . func (p *Pipe) loop() { var s state = ready //   t := target{} for s != nil { s, t = s.listen(p, t) //      p.log.Debug(fmt.Sprintf("%v is %T", p, s)) } t.dismiss() close(p.events) //    } // listen     ready. func (s idleReady) listen(p *Pipe, t target) (state, target) { return p.idle(s, t) } // transition       . func (s idleReady) transition(p *Pipe, e eventMessage) (state, error) { switch e.event { case cancel: interrupt(p.cancel) return nil, nil case push: e.params.applyTo(p.ID()) p.params = p.params.merge(e.params) return s, nil case measure: for _, id := range e.components { e.params.applyTo(id) } return s, nil case run: if err := p.start(); err != nil { return s, err } return running, nil } return s, ErrInvalidState }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุฅูุดุงุก ุงููุงูู ูุชุฌููุฏู ุชุญุณุจูุง ููุฃุญุฏุงุซ. </p><br><h3 id="pora-rabotat" style=";text-align:right;direction:rtl">  ุญุงู ููุช ุงูุนูู </h3><br><p style=";text-align:right;direction:rtl">  ุงุณุชุฏุนุงุก <code>p.Run()</code> ! </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/wv/vi/vs/wvvivsokwwjkjvvcibg-kyvi9m0.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Run   run  . //     pipe.Close  . func (p *Pipe) Run() chan error { runEvent := eventMessage{ event: run, target: target{ state: ready, //    errc: make(chan error, 1), }, } p.events &lt;- runEvent return runEvent.target.errc } // listen     running. func (s activeRunning) listen(p *Pipe, t target) (state, target) { return p.active(s, t) } // transition       . func (s activeRunning) transition(p *Pipe, e eventMessage) (state, error) { switch e.event { case cancel: interrupt(p.cancel) err := Wait(p.errc) return nil, err case measure: e.params.applyTo(p.ID()) p.feedback = p.feedback.merge(e.params) return s, nil case push: e.params.applyTo(p.ID()) p.params = p.params.merge(e.params) return s, nil case pause: return pausing, nil } return s, ErrInvalidState } // sendMessage   . func (s activeRunning) sendMessage(p *Pipe) state { p.consume &lt;- p.newMessage() return s }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>running</code> ูููุฏ ุฑุณุงุฆู ูุชุดุบูู ุญุชู ุงูุชูุงู ุฎุท ุงูุฃูุงุจูุจ. </p><br><h3 id="sdelay-pauzu" style=";text-align:right;direction:rtl">  ูููุฉ </h3><br><p style=";text-align:right;direction:rtl">  ุฃุซูุงุก ุชูููุฐ ุงููุงูู ุ ูููููุง ุฅููุงูู ูุคูุชูุง.  ูู ูุฐู ุงูุญุงูุฉ ุ ูู ููุดุฆ ุฎุท ุงูุฃูุงุจูุจ ุฑุณุงุฆู ุฌุฏูุฏุฉ.  ููููุงู ุจุฐูู ุ ุงุณุชุฏุนุงุก ุงูุฃุณููุจ <code>p.Pause()</code> . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/-2/9k/xz/-29kxztxwy56ftsphj9-blcbkei.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Pause   pause  . //     pipe.Close  . func (p *Pipe) Pause() chan error { pauseEvent := eventMessage{ event: pause, target: target{ state: paused, //    errc: make(chan error, 1), }, } p.events &lt;- pauseEvent return pauseEvent.target.errc } // listen     pausing. func (s activePausing) listen(p *Pipe, t target) (state, target) { return p.active(s, t) } // transition       . func (s activePausing) transition(p *Pipe, e eventMessage) (state, error) { switch e.event { case cancel: interrupt(p.cancel) err := Wait(p.errc) return nil, err case measure: e.params.applyTo(p.ID()) p.feedback = p.feedback.merge(e.params) return s, nil case push: e.params.applyTo(p.ID()) p.params = p.params.merge(e.params) return s, nil } return s, ErrInvalidState } // sendMessage   .   -, //      .    //    ,      .  , // ,   , : // 1.     // 2.      func (s activePausing) sendMessage(p *Pipe) state { m := p.newMessage() if len(m.feedback) == 0 { m.feedback = make(map[string][]phono.ParamFunc) } var wg sync.WaitGroup //     wg.Add(len(p.sinks)) //   Sink for _, sink := range p.sinks { param := phono.ReceivedBy(&amp;wg, sink.ID()) // - m.feedback = m.feedback.add(param) } p.consume &lt;- m //   wg.Wait() // ,     return paused }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจูุฌุฑุฏ ุฃู ูุชููู ุฌููุน ุงููุณุชูููู ุงูุฑุณุงูุฉ ุ ุณูุฏุฎู ุฎุท ุงูุฃูุงุจูุจ ุงูุญุงูุฉ <code>paused</code> .  ุฅุฐุง ูุงูุช ุงูุฑุณุงูุฉ ูู ุงูุฃุฎูุฑุฉ ุ ูุณูุญุฏุซ ุงูุงูุชูุงู ุฅูู ุญุงูุฉ <code>ready</code> . </p><br><h3 id="snova-za-rabotu" style=";text-align:right;direction:rtl">  ุงูุนูุฏุฉ ุฅูู ุงูุนูู! </h3><br><p style=";text-align:right;direction:rtl">  ููุฎุฑูุฌ ูู ุงูุญุงูุฉ <code>paused</code> ุ ุงุชุตู <code>p.Resume()</code> . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/vq/gu/dj/vqgudjnhdlifwyb6acyrkpbmkek.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Resume   resume  . //     pipe.Close  . func (p *Pipe) Resume() chan error { resumeEvent := eventMessage{ event: resume, target: target{ state: ready, errc: make(chan error, 1), }, } p.events &lt;- resumeEvent return resumeEvent.target.errc } // listen     paused. func (s idlePaused) listen(p *Pipe, t target) (state, target) { return p.idle(s, t) } // transition       . func (s idlePaused) transition(p *Pipe, e eventMessage) (state, error) { switch e.event { case cancel: interrupt(p.cancel) err := Wait(p.errc) return nil, err case push: e.params.applyTo(p.ID()) p.params = p.params.merge(e.params) return s, nil case measure: for _, id := range e.components { e.params.applyTo(id) } return s, nil case resume: return running, nil } return s, ErrInvalidState }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุดูุก ุชุงูู ููุง ุ ููุฑ ุฎุท ุงูุฃูุงุจูุจ ูุฑุฉ ุฃุฎุฑู ุฅูู ุญุงูุฉ <code>running</code> . </p><br><h3 id="svorachivaemsya" style=";text-align:right;direction:rtl">  ุงูุญูู </h3><br><p style=";text-align:right;direction:rtl">  ูููู ุฅููุงู ุงููุงูู ูู ุฃู ุฏููุฉ.  ููุฌุฏ <code>p.Close()</code> . </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/va/lt/tz/valttzm_l7cqsibb6mi1ntxh6vy.png"></p><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">// Close   cancel  . //      . //    ,   . func (p *Pipe) Close() chan error { resumeEvent := eventMessage{ event: cancel, target: target{ state: nil, //   errc: make(chan error, 1), }, } p.events &lt;- resumeEvent return resumeEvent.target.errc }</span></span></code> </pre> <br><h2 id="komu-eto-nado" style=";text-align:right;direction:rtl">  ูู ูุญุชุงุฌ ูุฐุงุ </h2><br><p style=";text-align:right;direction:rtl">  ููุณ ููุฌููุน.  ูููู ููููุฉ ุฅุฏุงุฑุฉ ุงูุฏููุฉ ุจุงูุถุจุท ุ ุชุญุชุงุฌ ุฅูู ููู ูููุชู.  ููุงู ุญุงูุชุงู ุจุงูุถุจุท ุญูุซ <em>ููููู</em> ุงุณุชุฎุฏุงู ุขูุฉ ุบูุฑ ูุชุฒุงููุฉ ูุงุฆูุฉ ุนูู ุงูุฃุญุฏุงุซ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฏูุฑุฉ ุงูุญูุงุฉ ุงููุนูุฏุฉ - ููุงู ุซูุงุซ ุญุงูุงุช ุฃู ุฃูุซุฑ ูุน ุงูุชุญููุงุช ุบูุฑ ุงูุฎุทูุฉ. </li><li style=";text-align:right;direction:rtl">  ูุชู ุงุณุชุฎุฏุงู ุงูุชูููุฐ ุบูุฑ ุงููุชุฒุงูู. </li></ol><br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุฑุบู ูู ุฃู ุขูุฉ ุงูุญุฏุซ ุชุญู ุงููุดููุฉ ุ ุฅูุง ุฃููุง ููุท ูุนูุฏ ุฅูู ุญุฏ ูุง.  ูุฐูู ุ ูุฌุจ ุงุณุชุฎุฏุงูู ุจุญุฐุฑ ุดุฏูุฏ ูููุท ุจุนุฏ ุงูููู ุงููุงูู ูุฌููุน ุงูุฅูุฌุงุจูุงุช ูุงูุณูุจูุงุช. </p><br><h2 id="ssylki" style=";text-align:right;direction:rtl">  ุงููุฑุงุฌุน </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููู</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">lexer ุฑูุจ ุจุงูู</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar431048/">https://habr.com/ru/post/ar431048/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar431036/index.html">"ุงูุนุงูู ููู - ุชุญููู" ุฃู "ุชุญูููู"</a></li>
<li><a href="../ar431040/index.html">ููุฎุต ุงูููุงุฏ ุงูุทุงุฒุฌุฉ ูู ุนุงูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ููุฃุณุจูุน ุงููุงุถู ุฑูู 340 (19-25 ููููุจุฑ 2018)</a></li>
<li><a href="../ar431042/index.html">ููุฎุต PHP ุฑูู 144 (12 - 26 ููููุจุฑ 2018)</a></li>
<li><a href="../ar431044/index.html">ุณูุฏูุน ููุชุจ ุงููุฏุนู ุงูุนุงู ููุญุธุฑ ุบูุฑ ุงููุงูููู ูููููุน ูุฃูู ูุฑุฉ</a></li>
<li><a href="../ar431046/index.html">ููู ูุนูู ูุคุดุฑ Z ุจุงููุนู</a></li>
<li><a href="../ar431050/index.html">ููู ุงูููุงุก: ูู ุชูุนุฏู ุงูููุงู ูุคุซุฑ ุนูู ุฌูุฏุชู ุ ูููู ุณูุณุงุนุฏูุง ูููุงุณ TDSุ</a></li>
<li><a href="../ar431052/index.html">ุงููุงุฌูุฉ ุงูุฃูุงููุฉ DevDay: ุงูุฎุฑุงุฆุท ูุงููุฑู ูุงุณุชุนูุงูุงู</a></li>
<li><a href="../ar431056/index.html">USPACE: ุชูููุช ุงูุทุงุฆุฑุงุช ุจุฏูู ุทูุงุฑ</a></li>
<li><a href="../ar431058/index.html">ุงูุฎุทูุงุช ุงูุฃููู ูุน ูุญุฑู ููููููุฑู</a></li>
<li><a href="../ar431060/index.html">ุงูุชุญุงู ุงููููุฉ ุงูุฃููุงููุฉ ูุน ุงููุตุงุฏูุฉ ุนุจุฑ ุงูุฅูุชุฑูุช ูุชูููู ุงููุงุฌุฆูู ูู ุฃููุงููุง</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>