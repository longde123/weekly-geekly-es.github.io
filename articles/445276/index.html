<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>〰️ 📹 🆗 Guía completa de efectos de uso 👔 🎟️ 🏤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Has escrito varios componentes usando ganchos . Quizás, incluso crearon una pequeña aplicación. En general, estás bastante contento con el resultado. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guía completa de efectos de uso</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/445276/"> Has escrito varios componentes usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ganchos</a> .  Quizás, incluso crearon una pequeña aplicación.  En general, estás bastante contento con el resultado.  Está acostumbrado a la API y en el proceso encontró algunos trucos útiles poco evidentes.  Incluso creó algunos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sus propios ganchos</a> y redujo su código a 300 líneas, colocando en ellas lo que anteriormente estaba representado por fragmentos repetidos del programa.  Lo que hiciste, lo mostraste a tus colegas.  "Bien hecho", dijeron sobre su proyecto. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/bd/vj/e1/bdvje1n-vjzezd47wnphch1wq8a.png"></a> <br>  Pero a veces, cuando usa <code>useEffect</code> , los componentes de los mecanismos del software no encajan muy bien.  Te parece que te estás perdiendo algo.  Todo esto es similar a trabajar con eventos de ciclo de vida de componentes basados ​​en clases ... pero ¿es realmente así? <a name="habracut"></a><br>  Al tratar de comprender qué es exactamente lo que no le conviene, se da cuenta de que está haciendo las siguientes preguntas: <br><br><ul><li>  ¿Cómo jugar <code>componentDidMount</code> usando <code>useEffect</code> ? </li><li>  ¿Cómo cargar datos dentro de <code>useEffect</code> ?  ¿Qué es <code>[]</code> ? </li><li>  ¿Deben especificarse las funciones como dependencias de efectos? </li><li>  ¿Por qué un programa a veces termina en un ciclo infinito de recarga de datos? </li><li>  ¿Por qué el antiguo estado a veces es visible dentro de los efectos o se encuentran propiedades antiguas? </li></ul><br>  Cuando comencé a usar ganchos, estas preguntas también me atormentaron.  Incluso cuando estaba preparando la documentación, no podía decir que dominara perfectamente algunas de las sutilezas.  Desde entonces, he tenido varios momentos cuando, de repente, al darme cuenta de algo importante, realmente quería exclamar: "¡Eureka!"  Sobre lo que me di cuenta en estos momentos, quiero contarte.  Lo que aprenda sobre <code>useEffect</code> ahora le permitirá ver claramente las respuestas obvias a las preguntas anteriores. <br><br>  Pero para ver las respuestas a estas preguntas, primero debemos dar un paso atrás.  El propósito de este artículo no es dar a sus lectores algunas instrucciones paso a paso para trabajar con <code>useEffect</code> .  Su objetivo es ayudarlo, por así <code>useEffect</code> " <code>useEffect</code> " <code>useEffect</code> .  Y, francamente, no hay mucho que aprender.  De hecho, pasaremos la mayor parte del tiempo olvidando lo que sabíamos antes. <br><br>  Todo en mi cabeza se unió solo después de que dejé de mirar el gancho <code>useEffect</code> través del prisma de los métodos familiares del ciclo de vida de los componentes basados ​​en componentes. <br><br><h3>  "Debes olvidar lo que te han enseñado" </h3><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">habr.com/ru/company/ruvds/blog/445276/Yoda</a></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c3/9be/fba/8c39befba869c3bae1a6b87c2d2589d1.jpg"></div><br>  Se supone que el lector de este material está algo familiarizado con la API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">useEffect</a> .  Este es un artículo bastante largo, se puede comparar con un libro pequeño.  El hecho es que prefiero expresar mis pensamientos de esta manera.  A continuación, muy brevemente, se dan respuestas a las preguntas que se discutieron anteriormente.  Quizás sean útiles para aquellos que no tienen el tiempo o el deseo de leer todo el material. <br><br>  Si el formato en el que vamos a considerar <code>useEffect</code> , con todas sus explicaciones y ejemplos, no es muy adecuado para usted, puede esperar un poco, hasta el momento en que estas explicaciones aparezcan en muchos otros manuales.  Aquí está la misma historia que con la biblioteca React en sí, que en 2013 fue algo completamente nuevo.  A la comunidad de desarrollo le lleva algún tiempo reconocer el nuevo modelo mental y que aparezcan los materiales educativos basados ​​en este modelo. <br><br><h2>  <font color="#3AC1EF">Respuestas a preguntas</font> </h2><br>  Aquí hay respuestas breves a las preguntas formuladas al comienzo de este material, destinadas a aquellos que no desean leer este texto completo.  Si, mientras lee estas respuestas, siente que realmente no comprende el significado de lo que lee, mire el material.  Encontrará explicaciones detalladas en el texto.  Si va a leer todo, puede omitir esta sección. <br><br><h3>  <font color="#3AC1EF">▍ ¿Cómo jugar componentDidMount usando useEffect?</font> </h3><br>  Aunque puede usar la <code>useEffect(fn, [])</code> para reproducir la funcionalidad <code>componentDidMount</code> , no es el equivalente exacto de <code>componentDidMount</code> .  Es decir, a diferencia de <code>componentDidMount</code> , captura propiedades y estado.  Por lo tanto, incluso dentro de la devolución de llamada, verá las propiedades y el estado iniciales.  Si desea ver la última versión de algo, puede escribirla en el enlace de <code>ref</code> .  Pero generalmente hay una forma más simple de estructurar el código, por lo que hacer esto es opcional.  Recuerde que el modelo de efectos mentales es diferente del aplicable a <code>componentDidMount</code> y otros métodos de ciclo de vida de componentes.  Por lo tanto, tratar de encontrar los equivalentes exactos puede hacer más daño que bien.  Para trabajar productivamente, necesita, por así decirlo, "pensar en los efectos".  La base de su modelo mental está más cerca de la implementación de la sincronización que de responder a eventos en el ciclo de vida de los componentes. <br><br><h3>  <font color="#3AC1EF">▍ ¿Cómo cargar correctamente los datos dentro de useEffect?</font>  <font color="#3AC1EF">¿Qué es []?</font> </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aquí hay una</a> buena guía para cargar datos usando <code>useEffect</code> .  ¡Intenta leerlo en su totalidad!  No es tan grande como eso.  Los corchetes, <code>[]</code> , que representan una matriz vacía, significan que el efecto no usa los valores que participan en el flujo de datos React, y por esta razón su uso único puede considerarse seguro.  Además, el uso de una matriz vacía de dependencias es una fuente común de errores en el caso de que un cierto valor se use realmente en el efecto.  Necesitará dominar varias estrategias (presentadas principalmente en forma de <code>useReducer</code> y <code>useCallback</code> ) que pueden ayudar a eliminar la necesidad de una dependencia en lugar de descartar esta dependencia sin razón. <br><br><h3>  <font color="#3AC1EF">▍ ¿Deben especificarse las funciones como dependencias de efectos?</font> </h3><br>  Se recomienda que las funciones que no necesitan propiedades o un estado se tomen fuera de los componentes, y aquellas funciones que se usan solo por efectos se recomienda colocarlas dentro de los efectos.  Si después de eso su efecto todavía usa funciones que están dentro del alcance del render (incluidas las funciones de las propiedades), envuélvalas en <code>useCallback</code> donde están declaradas e intente usarlas nuevamente.  ¿Por qué es esto importante?  Las funciones pueden "ver" los valores de las propiedades y el estado, por lo que participan en el flujo de datos.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aquí hay</a> información más detallada sobre esto en nuestras preguntas frecuentes. <br><br><h3>  <font color="#3AC1EF">▍ ¿Por qué un programa a veces termina en un ciclo infinito de recarga de datos?</font> </h3><br>  Esto puede suceder cuando la carga de datos se realiza en un efecto que no tiene un segundo argumento que represente las dependencias.  Sin él, los efectos se realizan después de cada operación de renderizado, lo que significa que establecer el estado hará que se recuperen dichos efectos.  Un bucle infinito también puede ocurrir si un valor que siempre cambia se indica en la matriz de dependencias.  Descubra qué tipo de valor es posible eliminando las dependencias de una en una.  Sin embargo, eliminar dependencias (o usar precipitadamente <code>[]</code> ) suele ser el enfoque incorrecto para resolver un problema.  En cambio, debe encontrar la fuente del problema y realmente resolverlo.  Por ejemplo, las funciones pueden causar un problema similar.  Puede ayudar a resolverlo poniéndolos en efecto, moviéndolos fuera de los componentes o envolviéndolos en <code>useCallback</code> .  Para evitar crear múltiples objetos, puede usar <code>useMemo</code> . <br><br><h3>  <font color="#3AC1EF">▍ ¿Por qué a veces el antiguo estado es visible dentro de los efectos o se encuentran propiedades antiguas?</font> </h3><br>  Los efectos siempre "ven" las propiedades y el estado del render en el que se declaran.  Esto ayuda a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">prevenir errores</a> , pero en algunos casos puede interferir con el funcionamiento normal del componente.  En tales casos, puede usar enlaces de <code>ref</code> mutables explícitamente para trabajar con dichos valores (puede leer sobre esto al final del artículo mencionado anteriormente).  Si cree que ve las propiedades o el estado del render anterior, pero no espera esto, es posible que haya perdido algunas dependencias.  Para aprender a verlos, use <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esta</a> regla de linter.  En un par de días, se convertirá en algo así como su segunda naturaleza.  Además, eche un vistazo a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esta</a> respuesta en nuestras Preguntas frecuentes. <br><br>  Espero que estas respuestas a las preguntas hayan sido útiles para quienes las leen.  Ahora hablemos más sobre <code>useEffect</code> . <br><br><h2>  <font color="#3AC1EF">Cada render tiene sus propias propiedades y estado.</font> </h2><br>  Antes de que podamos discutir los efectos, necesitamos hablar sobre el renderizado. <br><br>  Aquí está el componente contador funcional. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   &lt;div&gt;     &lt;p&gt;You clicked {count} times&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/p&gt;     &lt;button onClick={() =&gt; setCount(count + 1)}&gt;       Click me     &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">button&gt;   &lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/div&gt; ); }</span></span></span></span></span></span></code> </pre> <br>  Observe de cerca la línea <code>&lt;p&gt;You clicked {count} times&lt;/p&gt;</code> .  ¿Qué quiere decir ella?  ¿La constante constante de alguna manera "observa" los cambios en el estado y se actualiza automáticamente?  Esta conclusión puede considerarse una especie de valiosa primera idea de alguien que está estudiando React, pero no es un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">modelo mental preciso de</a> lo que está sucediendo. <br><br>  En nuestro ejemplo, <code>count</code> es solo un número.  Este no es un tipo de "enlace de datos" mágico, no es un tipo de "objeto de observación" o "proxy", o cualquier otra cosa.  Ante nosotros hay un viejo número bueno, como este: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> count = <span class="hljs-number"><span class="hljs-number">42</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ... &lt;p&gt;You clicked {count} times&lt;/p&gt; // ...</span></span></code> </pre> <br>  Durante la salida del primer componente, el valor de <code>count</code> obtenido de <code>useState()</code> es 0. Cuando llamamos a <code>setCount(1)</code> , React vuelve a llamar al componente.  Esta <code>count</code> tiempo será 1. Y así sucesivamente: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     function Counter() { const count = 0; //  useState() // ... &lt;p&gt;You clicked {count} times&lt;/p&gt; // ... } //       function Counter() { const count = 1; //  useState() // ... &lt;p&gt;You clicked {count} times&lt;/p&gt; // ... } //        function Counter() { const count = 2; //  useState() // ... &lt;p&gt;You clicked {count} times&lt;/p&gt; // ... }</span></span></code> </pre> <br>  React llama al componente cada vez que actualizamos el estado.  Como resultado, cada operación de representación "ve" su propio valor del estado del <code>counter</code> , que, dentro de la función, es una constante. <br><br>  Como resultado, esta línea no realiza ninguna operación especial de enlace de datos: <br><br><pre> <code class="javascript hljs">&lt;p&gt;You clicked {count} times&lt;<span class="hljs-regexp"><span class="hljs-regexp">/p&gt;</span></span></code> </pre> <br>  Solo incrusta un valor numérico en el código generado durante la representación.  Este número es proporcionado por React.  Cuando llamamos a <code>setCount</code> , React vuelve a llamar al componente con un valor de <code>count</code> diferente.  React luego actualiza el DOM para que el modelo de objeto del documento coincida con la última salida de datos durante la representación del componente. <br><br>  La conclusión más importante que se puede extraer de esto es que el <code>count</code> es una constante dentro de cualquier render particular y no cambia con el tiempo.  El componente que se llama una y otra vez cambia.  Cada render "ve" su propio valor de <code>count</code> , que está aislado para cada una de las operaciones de renderizado. <br><br>  En <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este</a> material puede encontrar detalles sobre este proceso. <br><br><h2>  <font color="#3AC1EF">Cada render tiene sus propios controladores de eventos.</font> </h2><br>  Todo aún está claro.  ¿Qué pasa con los controladores de eventos? <br>  Echa un vistazo a este ejemplo.  Aquí, tres segundos después de hacer clic en el botón, se muestra un cuadro de mensaje con información sobre el valor almacenado en el <code>count</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleAlertClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     alert(<span class="hljs-string"><span class="hljs-string">'You clicked on: '</span></span> + count);   }, <span class="hljs-number"><span class="hljs-number">3000</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   &lt;div&gt;     &lt;p&gt;You clicked {count} times&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/p&gt;     &lt;button onClick={() =&gt; setCount(count + 1)}&gt;       Click me     &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">button&gt;     &lt;button onClick={handleAlertClick}&gt;       Show alert     &lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/button&gt;   &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">div&gt; </span></span></span><span class="hljs-function">); }</span></span></code> </pre> <br>  Supongamos que realizo la siguiente secuencia de acciones: <br><br><ul><li>  Llevaré el valor de <code>count</code> a 3 haciendo clic en el botón <code>Click me</code> . </li><li>  Haga clic en el botón <code>Show alert</code> . </li><li>  Aumente el valor a 5 antes de que expire el tiempo de espera. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/46c/55d/5f1/46c55d5f1f749462b7a173f1e748e41e.gif"></div><br>  <i><font color="#999999">Aumentar el valor de conteo después de hacer clic en el botón Mostrar alerta</font></i> <br><br>  ¿Qué crees que aparece en el cuadro de mensaje?  ¿Se mostrará 5 allí, que corresponde al valor de <code>count</code> en el momento en que se activó el temporizador, o 3, es decir, el valor de <code>count</code> en el momento en que se presiona el botón? <br><br>  Ahora encontrará la respuesta a esta pregunta, pero si desea averiguar todo usted mismo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí hay una</a> versión funcional de este ejemplo. <br><br>  Si lo que viste te parece incomprensible, aquí hay un ejemplo más cercano a la realidad.  Imagine una aplicación de chat en la que, en estado, se almacena la <code>ID</code> destinatario actual del mensaje, y hay un botón <code>Send</code> .  En <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este</a> material, lo que está sucediendo se considera en detalle.  De hecho, la respuesta correcta a la pregunta de qué aparece en el cuadro de mensaje es 3. <br><br>  El mecanismo para mostrar un cuadro de mensaje "capturó" el estado en el momento en que se hizo clic en el botón. <br><br>  Hay formas de implementar otra versión de comportamiento, pero por ahora trataremos con el comportamiento estándar del sistema.  Al construir modelos mentales de tecnologías, es importante distinguir el "camino de menor resistencia" de todo tipo de "salidas de emergencia". <br><br>  ¿Cómo funciona todo esto? <br><br>  Ya hemos dicho que el valor de la <code>count</code> es una constante para cada llamada específica a nuestra función.  Creo que vale la pena detenerse en esto con más detalle.  El punto es que nuestra función se llama muchas veces (una vez para cada operación de renderizado), pero con cada una de estas llamadas, <code>count</code> dentro de ella es una constante.  Esta constante se establece en algún valor específico (que representa el estado de una operación de renderización particular). <br><br>  Este comportamiento de las funciones no es algo especial para React: las funciones ordinarias se comportan de manera similar: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sayHi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">person</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> name = person.name; setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   alert(<span class="hljs-string"><span class="hljs-string">'Hello, '</span></span> + name); }, <span class="hljs-number"><span class="hljs-number">3000</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> someone = {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Dan'</span></span>}; sayHi(someone); someone = {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Yuzhi'</span></span>}; sayHi(someone); someone = {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Dominic'</span></span>}; sayHi(someone);</code> </pre> <br>  En <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este</a> ejemplo, la variable externa <code>someone</code> reasigna varias veces.  Lo mismo puede suceder en algún lugar dentro de React, el estado actual del componente puede cambiar.  Sin embargo, dentro de la función <code>sayHi</code> hay un <code>name</code> constante local que está asociado con la <code>person</code> de una llamada en particular.  Esta constante es local, por lo tanto, sus valores en diferentes llamadas a funciones están aislados entre sí.  Como resultado, después de un tiempo de espera, cada ventana de mensaje visualizada "recuerda" su propio valor de <code>name</code> . <br><br>  Esto explica cómo nuestro controlador de eventos captura el valor de <code>count</code> cuando se hace clic en un botón.  Si, trabajando con componentes, aplicamos el mismo principio, resulta que cada render "ve" su propio valor de <code>count</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     function Counter() { const count = 0; //  useState() // ... function handleAlertClick() {   setTimeout(() =&gt; {     alert('You clicked on: ' + count);   }, 3000); } // ... } //       function Counter() { const count = 1; //  useState() // ... function handleAlertClick() {   setTimeout(() =&gt; {     alert('You clicked on: ' + count);   }, 3000); } // ... } //        function Counter() { const count = 2; //  useState() // ... function handleAlertClick() {   setTimeout(() =&gt; {     alert('You clicked on: ' + count);   }, 3000); } // ... }</span></span></code> </pre> <br>  Como resultado, cada render, de hecho, devuelve su propia "versión" <code>handleAlertClick</code> .  Cada una de estas versiones "recuerda" su propio valor de <code>count</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     function Counter() { // ... function handleAlertClick() {   setTimeout(() =&gt; {     alert('You clicked on: ' + 0);   }, 3000); } // ... &lt;button onClick={handleAlertClick} /&gt; // ,   0 // ... } //       function Counter() { // ... function handleAlertClick() {   setTimeout(() =&gt; {     alert('You clicked on: ' + 1);   }, 3000); } // ... &lt;button onClick={handleAlertClick} /&gt; // ,   1 // ... } //        function Counter() { // ... function handleAlertClick() {   setTimeout(() =&gt; {     alert('You clicked on: ' + 2);   }, 3000); } // ... &lt;button onClick={handleAlertClick} /&gt; // ,   2 // ... }</span></span></code> </pre> <br>  Es por eso que en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este</a> ejemplo, los controladores de eventos "pertenecen" a renders específicos, y cuando hace clic en el botón, el componente usa el estado de <code>count</code> de estos renders. <br><br>  Dentro de cada render particular, las propiedades y el estado siempre permanecen iguales.  Pero si las diferentes operaciones de representación usan sus propias propiedades y estado, lo mismo sucede con cualquier mecanismo que las use (incluidos los controladores de eventos).  También "pertenecen" a renders específicos.  Por lo tanto, incluso las funciones asincrónicas dentro de los controladores de eventos "verán" los mismos valores de <code>count</code> . <br><br>  Cabe señalar que en el ejemplo anterior, <code>handleAlertClick</code> los valores de <code>count</code> específicos directamente en la función <code>handleAlertClick</code> .  Este reemplazo "mental" no nos hará daño, ya que el <code>count</code> constante no se puede cambiar dentro de un render particular.  En primer lugar, es una constante, y en segundo lugar, es un número.  Podemos decir con confianza que también se puede pensar en otros significados, como los objetos, pero solo si aceptamos, por regla general, no realizar cambios (mutaciones) en el estado.  Al mismo tiempo, estamos satisfechos con la llamada a <code>setSomething(newObj)</code> con un nuevo objeto en lugar de cambiar el existente, ya que con este enfoque el estado que pertenece al render anterior no se ve afectado. <br><br><h2>  <font color="#3AC1EF">Cada render tiene sus propios efectos.</font> </h2><br>  Este material, como saben, está dedicado a los efectos, pero aún no hemos hablado de ellos.  Ahora lo arreglaremos.  Como resultado, trabajar con efectos no es particularmente diferente de lo que ya hemos descubierto. <br><br>  Considere <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un ejemplo</a> de la documentación, que es muy similar al que ya hemos analizado: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">`You clicked </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${count}</span></span></span><span class="hljs-string"> times`</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   &lt;div&gt;     &lt;p&gt;You clicked {count} times&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/p&gt;     &lt;button onClick={() =&gt; setCount(count + 1)}&gt;       Click me     &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">button&gt;   &lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/div&gt; ); }</span></span></span></span></span></span></code> </pre> <br>  Ahora tengo una pregunta para ti.  ¿Cómo lee un efecto el valor de <code>count</code> más reciente? <br><br>  ¿Tal vez aquí se utiliza algún "enlace de datos" o un "objeto observador" que actualiza el valor de <code>count</code> dentro de la función de efecto?  ¿Quizás <code>count</code> es una variable mutable cuyo valor React establece dentro de nuestro componente, como resultado de lo cual el efecto siempre ve su última versión? <br><br>  No <br><br>  Ya sabemos que en la representación de un componente en particular, el <code>count</code> es una constante.  Incluso los controladores de eventos "ven" el valor de <code>count</code> del render al que "pertenecen" debido al hecho de que el <code>count</code> es una constante ubicada en un determinado ámbito.  ¡Lo mismo es cierto para los efectos! <br><br>  Y debe tenerse en cuenta que este no es el <code>count</code> variable <code>count</code> que de alguna manera cambia dentro del efecto "sin cambios".  Ante nosotros está la función del efecto en sí, que es diferente en cada operación de renderizado. <br><br>  Cada versión "ve" el valor de <code>count</code> del render al que "pertenece": <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     function Counter() { // ... useEffect(   //        () =&gt; {     document.title = `You clicked ${0} times`;   } ); // ... } //       function Counter() { // ... useEffect(   //        () =&gt; {     document.title = `You clicked ${1} times`;   } ); // ... } //        function Counter() { // ... useEffect(   //        () =&gt; {     document.title = `You clicked ${2} times`;   } ); // .. }</span></span></code> </pre> <br> React     ,       DOM       . <br><br>  ,          (  ), ,   ,   ,     «»      ,   «». <br><br> , ,       . <br><br>  ,    ( ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>            ).    ,     ,        ,   . <br><br>      ,       ,        : <br><br> React: <br><br><ul><li>      ,      0. </li></ul><br> : <br><br><ul><li>   : <code>&lt;p&gt;You clicked 0 times&lt;/p&gt;</code> . </li><li>  ,       ,   : <code>() =&gt; { document.title = 'You clicked 0 times' }</code> . </li></ul><br> React: <br><br><ul><li> .  . , ,   -  DOM. </li></ul><br> : <br><br><ul><li> ,     . </li></ul><br> React: <br><br><ul><li> ,    ,    . </li><li>  <code>() =&gt; { document.title = 'You clicked 0 times' }</code> . </li></ul><br>     ,      .   ,     ,  -   : <br><br> : <br><br><ul><li> , React,     1. </li></ul><br> React: <br><br><ul><li>      ,      1. </li></ul><br> : <br><br><ul><li>   : <code>&lt;p&gt;You clicked 1 times&lt;/p&gt;</code> . </li><li>  ,       ,   : <code>() =&gt; { document.title = 'You clicked 1 times' }</code> . </li></ul><br> React: <br><br><ul><li> .  . , ,   -  DOM. </li></ul><br> : <br><br><ul><li> ,     . </li></ul><br> React: <br><br><ul><li> ,    ,    . </li><li>  <code>() =&gt; { document.title = 'You clicked 1 times' }</code> . </li></ul><br><h2> <font color="#3AC1EF">  … </font> </h2><br>     ,  ,     ,     ,  «»       . <br><br>    .   : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`You clicked </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${count}</span></span></span><span class="hljs-string"> times`</span></span>);   }, <span class="hljs-number"><span class="hljs-number">3000</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   &lt;div&gt;     &lt;p&gt;You clicked {count} times&lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/p&gt;     &lt;button onClick={() =&gt; setCount(count + 1)}&gt;       Click me     &lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">button&gt;   &lt;</span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/div&gt; ); }</span></span></span></span></span></span></code> </pre> <br>        ,       ? <br><br>  ,       . ,    ,    ,       .    !    ,    ,      , ,  ,    <code>count</code> .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a57/27d/333/a5727d333c270e05942f508707265378.gif"></div><br> <i><font color="#999999">       </font></i> <br><br>    : «,     !         ?». <br><br> ,   , <code>this.setState</code>  ,   ,   .    ,  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> ,    ,   ,  : <br><br><pre> <code class="javascript hljs">  componentDidUpdate() {   setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`You clicked </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.state.count}</span></span></span><span class="hljs-string"> times`</span></span>);   }, <span class="hljs-number"><span class="hljs-number">3000</span></span>); }</code> </pre> <br>   ,  <code>this.state.count</code>       <code>count</code> ,    ,   .  ,      , ,     5 ,  5  . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/264/b32/9ed/264b329edc111a1973003bdf2bcacd65.gif"></div><br> <i><font color="#999999">       </font></i> <br><br>     ,       JavaScript-,  ,   ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> ,    ,      <code>setTimeout</code> ,      .   ,          (React   <code>this.state</code>    ,          ),    . <br><br>  —      ,  ,  «»  ,   .        ,  ,  ,    . ,    ,         . , ,   ,    ,   ,  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> . <br><br><h2> <font color="#3AC1EF">  </font> </h2><br>    ,        (  , , -   API  )      ,   . <br><br>      : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(props.counter);   }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); }); <span class="hljs-comment"><span class="hljs-comment">// ... } function Example(props) { const counter = props.counter; useEffect(() =&gt; {   setTimeout(() =&gt; {     console.log(counter);   }, 1000); }); // ... }</span></span></code> </pre> <br>   ,     «»     .   !           .  ,       . <br><br> , ,  - ,   ,     ,   ,   .    ,   <code>ref</code> ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> . <br><br>  ,           ,     ,  ,  ,    .  ,    (    ),   «»         React-.       ,       ,         .       ,    . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>      ,   ,      ,    : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> latestCount = useRef(count); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-comment"><span class="hljs-comment">//        count   latestCount.current = count;   setTimeout(() =&gt; {     //            console.log(`You clicked ${latestCount.current} times`);   }, 3000); }); // ...</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/78f/794/826/78f7948263dd13b023498b23cb99f4fc.gif"></div><br> <i><font color="#999999">       </font></i> <br><br>   -  React    .     React   <code>this.state</code>  .         ,      ,   <code>latestCount.current</code>         .  ,       .        ,   ,   ,    . <br><br><h2> <font color="#3AC1EF">  ?</font> </h2><br>    ,      .  ,      ,  «»         . <br><br>   : <br><br><pre> <code class="javascript hljs">useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   ChatAPI.subscribeToFriendStatus(props.id, handleStatusChange);   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     ChatAPI.unsubscribeFromFriendStatus(props.id, handleStatusChange);   }; });</code> </pre> <br> , <code>props</code> —   <code>{id: 10}</code>    ,  <code>{id: 20}</code> —  .  ,     : <br><br><ul><li> React     <code>{id: 10}</code> . </li><li> React    <code>{id: 20}</code> . </li><li> React    <code>{id: 20}</code> . </li></ul><br> ( ,   ,   .) <br><br>      ,    «»   - ,      ,     «»   - ,      .  —  ,       ,   ,        .     . <br><br> React    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> ,       .   ,         .    .            .        : <br><br><ul><li> React    <code>{id: 20}</code> . </li><li>     .     <code>{id: 20}</code> . </li><li> React     <code>{id: 10}</code> . </li><li> React    <code>{id: 20}</code> . </li></ul><br>       ,          «»  <code>props</code> ,  <code>{id: 10}</code> ,  ,   <code>props</code>  <code>{id: 20}</code> . <br><br>  ,     … <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5fe/238/cf0/5fe238cf03a21dfa32af624124fcdcff.gif"></div><br> <i><font color="#999999">   —    ?</font></i> <br><br>     : «      (  , , -   API  )      ,   ». <br><br>   !         « » ,     .    ,   ,    : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,  props  {id: 10} function Example() { // ... useEffect(   //       () =&gt; {     ChatAPI.subscribeToFriendStatus(10, handleStatusChange);     //           return () =&gt; {       ChatAPI.unsubscribeFromFriendStatus(10, handleStatusChange);     };   } ); // ... } //  ,  props  {id: 20} function Example() { // ... useEffect(   //       () =&gt; {     ChatAPI.subscribeToFriendStatus(20, handleStatusChange);     //           return () =&gt; {       ChatAPI.unsubscribeFromFriendStatus(20, handleStatusChange);     };   } ); // ... }</span></span></code> </pre> <br>       ,        ,   …     ,  «»      ,   -,   <code>{id: 10}</code> . <br><br>    React         . ,      ,    .       <code>props</code> ,    . <br><br><h2> <font color="#3AC1EF">,    </font> </h2><br>      React  ,           .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> . <br><br> ,    : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Greeting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ name }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (   <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Greeting"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">     Hello, {name}   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre> <br>     ,     <code>&lt;Greeting name="Dan" /&gt;</code> ,   — <code>&lt;Greeting name="Yuzhi" /&gt;</code> ,       <code>&lt;Greeting name="Yuzhi" /&gt;</code> .             <code>Hello, Yuzhi</code> . <br><br> ,   ,   .    React,     .   ,   ,     .         <code>$.addClass</code>  <code>$.removeClass</code>  jQuery- ( — ,    «»),   ,    CSS-  React (  — ,    «»). <br><br> React  DOM  ,       .      «»  «». <br><br>       .  <code>useEffect</code>   ,     React,    . <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Greeting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ name }</span></span></span><span class="hljs-function">) </span></span>{ useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, '</span></span> + name; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (   <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Greeting"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">     Hello, {name}   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre> <br>       <code>useEffect</code>    ,     ,    .     ,    -    ,      !      ,      «»,    «». <br><br>      ,         <code>A</code> ,   <code>B</code> ,   —   <code>C</code> ,   ,         <code>C</code> .               (,    - ),         . <br><br>  , , ,             . (         ). <br><br>    ? <br><br><h2> <font color="#3AC1EF"> React  </font> </h2><br>    React     DOM.     DOM      , React     DOM,  - . <br><br> ,     : <br><br><pre> <code class="javascript hljs">&lt;h1 className=<span class="hljs-string"><span class="hljs-string">"Greeting"</span></span>&gt; Hello, Dan &lt;<span class="hljs-regexp"><span class="hljs-regexp">/h1&gt;</span></span></code> </pre> <br>       : <br><br><pre> <code class="javascript hljs">&lt;h1 className=<span class="hljs-string"><span class="hljs-string">"Greeting"</span></span>&gt; Hello, Yuzhi &lt;<span class="hljs-regexp"><span class="hljs-regexp">/h1&gt;</span></span></code> </pre> <br> React   : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> oldProps = {<span class="hljs-attr"><span class="hljs-attr">className</span></span>: <span class="hljs-string"><span class="hljs-string">'Greeting'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: <span class="hljs-string"><span class="hljs-string">'Hello, Dan'</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newProps = {<span class="hljs-attr"><span class="hljs-attr">className</span></span>: <span class="hljs-string"><span class="hljs-string">'Greeting'</span></span>, <span class="hljs-attr"><span class="hljs-attr">children</span></span>: <span class="hljs-string"><span class="hljs-string">'Hello, Yuzhi'</span></span>};</code> </pre> <br> React      ,   <code>children</code> ,        DOM.   ,  <code>className</code>  .     : <br><br><pre> <code class="javascript hljs">domNode.innerText = <span class="hljs-string"><span class="hljs-string">'Hello, Yuzhi'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// domNode.className   </span></span></code> </pre> <br>     -     ?    ,           ,      . <br><br> , ,     -  : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Greeting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ name }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [counter, setCounter] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, '</span></span> + name; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">   &lt;h1 className=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Greeting"</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;     Hello, {name}     &lt;button onClick={(</span></span></span><span class="hljs-function">) =&gt;</span></span> setCounter(counter + <span class="hljs-number"><span class="hljs-number">1</span></span>)}&gt;       Increment     &lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt;   &lt;/</span></span>h1&gt; ); }</code> </pre> <br>      <code>counter</code>  .   <code>document.title</code>   <code>name</code> ,   <code>name</code>   .  <code>document.title</code>    <code>counter</code>  ,   . <br><br>   React …  ? <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> oldEffect = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, Dan'</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> newEffect = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, Dan'</span></span>; }; <span class="hljs-comment"><span class="hljs-comment">//   React  ,        ?</span></span></code> </pre> <br>    — . React     ,    ,   . (     .       <code>name</code> .) <br><br>  ,      ,      (    <code>deps</code> ),    <code>useEffect</code> : <br><br><pre> <code class="javascript hljs">  useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, '</span></span> + name; }, [name]); <span class="hljs-comment"><span class="hljs-comment">//  </span></span></code> </pre> <br>    ,      React: «,  ,        ,   ,      <code>name</code>       ». <br><br>   ,        ,       React     : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> oldEffect = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, Dan'</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> oldDeps = [<span class="hljs-string"><span class="hljs-string">'Dan'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newEffect = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, Dan'</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newDeps = [<span class="hljs-string"><span class="hljs-string">'Dan'</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// React     ,     . //      ,     .</span></span></code> </pre> <br>          ,    ,         !       -  -     . <br><br><h2> <font color="#3AC1EF">  React  </font> </h2><br>    React    —     .  ,   ,      ,    ,    <code>useEffect</code> ,        ,   ,   . (      !) <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   <span class="hljs-comment"><span class="hljs-comment">// ... } useEffect(() =&gt; {   fetchData(); }, []); //   ?  .      . // ... }</span></span></code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FAQ  </a>     ,     .      . <br><br> «       !», —  .  :    ,          ,   .   , , ,   — ,       . <br><br> ,    ,   . ,  ,       ,   ,     .       ,    .    . <br><br> ,      ,      . <br><br><h2> <font color="#3AC1EF">    ,    React</font> </h2><br>      ,  ,  React   ,     . <br><br><pre> <code class="javascript hljs">  useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, '</span></span> + name; }, [name]);</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fae/247/cd0/fae247cd068eedbd4b62ba50592d2b3d.gif"></div><br> <i><font color="#999999">    —  </font></i> <br><br>       ,   ,  , <code>[]</code> , ,   ,   ,    : <br><br><pre> <code class="javascript hljs">  useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">'Hello, '</span></span> + name; }, []); <span class="hljs-comment"><span class="hljs-comment">// :    name</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/25f/75d/b3f/25f75db3f9f57ffe1426912093577445.gif"></div><br> <i><font color="#999999">   —    </font></i> <br><br>          .       ,    «» ,    ,   . <br><br> , ,   ,    .      ,      : «   <code>setInterval</code>        <code>clearInterval</code>   ». <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>    .  ,  ,   ,   <code>useEffect</code> ,  , ,     <code>[]</code> . -      , ? <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     setCount(count + <span class="hljs-number"><span class="hljs-number">1</span></span>);   }, <span class="hljs-number"><span class="hljs-number">1000</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> clearInterval(id); }, []); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{count}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; }</code> </pre> <br> ,  ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> . <br><br>       ,     «     ,      »,         .   ,       ,      ,  <code>setInterval</code> ,  .      ,  ? <br><br>      ,   —     React   ,       ,        .  ,   <code>count</code> ,     React   , ,    ,  .        —   . <br><br>     <code>count</code>  0.   <code>setCount(count + 1)</code>      <code>setCount(0 + 1)</code> .         ,   —    <code>[]</code> ,     <code>setCount(0 + 1)</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,   0 function Counter() { // ... useEffect(   //       () =&gt; {     const id = setInterval(() =&gt; {       setCount(0 + 1); //  setCount(1)     }, 1000);     return () =&gt; clearInterval(id);   },   [] //    ); // ... } //       1 function Counter() { // ... useEffect(   //     - ,    //   React  ,   .   () =&gt; {     const id = setInterval(() =&gt; {       setCount(1 + 1);     }, 1000);     return () =&gt; clearInterval(id);   },   [] ); // ... }</span></span></code> </pre> <br>   React,   ,         ,     — . <br><br>    <code>count</code> — ,    (   ): <br><br><pre> <code class="javascript hljs">  <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> count = <span class="hljs-comment"><span class="hljs-comment">// ... useEffect(() =&gt; {   const id = setInterval(() =&gt; {     setCount(count + 1);   }, 1000);   return () =&gt; clearInterval(id); }, []);</span></span></code> </pre> <br>            . React        . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29e/53b/d0c/29e53bd0c9b7d2ac70d3cd924886b030.gif"></div><br> <i><font color="#999999">  ,     </font></i> <br><br>        .       ,    ,  React       ,   ,     .           —   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">-</a>      . <br><br><h2> <font color="#3AC1EF">       </font> </h2><br>       React   ,      .     ,  ,    ,   . <br><br>       ,      ,   ,    .     <code>count</code> : <br><br><pre> <code class="javascript hljs">useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   setCount(count + <span class="hljs-number"><span class="hljs-number">1</span></span>); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> clearInterval(id); }, [count]);</code> </pre> <br>    . ,    ,   —  ,    .   <code>count</code>    ,         <code>count</code>   ,   <code>setCount(count + 1)</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,   0 function Counter() { // ... useEffect(   //       () =&gt; {     const id = setInterval(() =&gt; {       setCount(0 + 1); // setCount(count + 1)     }, 1000);     return () =&gt; clearInterval(id);   },   [0] // [count] ); // ... } //  ,   1 function Counter() { // ... useEffect(   //       () =&gt; {     const id = setInterval(() =&gt; {       setCount(1 + 1); // setCount(count + 1)     }, 1000);     return () =&gt; clearInterval(id);   },   [1] // [count] ); // ... }</span></span></code> </pre> <br>     ,  <code>setInterval</code> ,    <code>count</code> ,    . ,    . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/573/427/1dd/5734271ddfa94d2d65ac6160515e0069.gif"></div><br> <i><font color="#999999"> ,    </font></i> <br><br>         ,      ,   ,   .       —      ,       . <br><br>       . <br><br><h2> <font color="#3AC1EF">  </font> </h2><br> ,      <code>count</code>  . <br><br><pre> <code class="javascript hljs">useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     setCount(count + <span class="hljs-number"><span class="hljs-number">1</span></span>);   }, <span class="hljs-number"><span class="hljs-number">1000</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> clearInterval(id); }, [count]);</code> </pre> <br>     ,    ,     <code>count</code> .   ,    <code>count</code>    <code>setCount</code> .    ,   ,     <code>count</code>   .     ,    ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a> <code>setState</code> : <br><br><pre> <code class="javascript hljs">  useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     setCount(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function"> =&gt;</span></span> c + <span class="hljs-number"><span class="hljs-number">1</span></span>);   }, <span class="hljs-number"><span class="hljs-number">1000</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> clearInterval(id); }, []);</code> </pre> <br>       « ». ,  <code>count</code>    - ,       <code>setCount(count + 1)</code> .  <code>count</code>  -    ,      <code>count + 1</code>  «»  React.  React      <code>count</code> . ,     React —    ,    ,    ,    . <br><br>       <code>setCount(c =&gt; c + 1)</code> .     « React »,  ,    .  « »      , ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a> . <br><br>    ,  ,   ,   .       React.        <code>count</code>    : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f12/8ad/20c/f128ad20c28317ed27a3cb68197fc906.gif"></div><br> <i><font color="#999999">  ,     </font></i> <br><br>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> . <br><br>        ,  <code>setInterval</code> ,    ,      <code>c =&gt; c + 1</code>    .       <code>count</code> . React    . <br><br><h2> <font color="#3AC1EF">   Google Docs</font> </h2><br> ,     ,   —     ?      ,   ,  «»,   ,       . ,    Google Docs        .      .       ,    . <br><br>       ,      .             .      ,    <code>setCount(c =&gt; c + 1)</code> ,       ,     <code>setCount(count + 1)</code> ,        «»   <code>count</code> .    ,    (  — «»). «   React» —   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   </a> .        . <br><br>     (     )   ,  Google Docs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>    .   —     ,     React  .    ,  ,     ( ,  ,   )         . <br><br>   ,     <code>setCount(c =&gt; c + 1)</code> ,   .    ,       . ,       ,      ,      ,  ,         .    <code>setCount(c =&gt; c + 1)</code>     .   <code>useReducer</code> . <br><br><h2> <font color="#3AC1EF">   </font> </h2><br>     ,       : <code>count</code>  <code>step</code> .  <code>setInterval</code>     ,   <code>step</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [step, setStep] = useState(<span class="hljs-number"><span class="hljs-number">1</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     setCount(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function"> =&gt;</span></span> c + step);   }, <span class="hljs-number"><span class="hljs-number">1000</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> clearInterval(id); }, [step]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (   &lt;&gt;     &lt;h1&gt;{count}&lt;/h1&gt;     &lt;input value={step} onChange={e =&gt; setStep(Number(e.target.value))} /&gt;   &lt;/&gt; ); }</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>    . <br><br>    ,    React  .       <code>step</code> ,     .      . <br><br>     :  <code>step</code>  <code>setInterval</code> —   <code>step</code>     . ,   ,   ,   !     ,   ,         ,  ,       ,    . <br><br>   ,   ,  ,    <code>setInterval</code> ,      <code>step</code> .    <code>step</code>  ? <br><br>            , ,         <code>useReducer</code> . <br><br>   ,     <code>setSomething(something =&gt; ...)</code> ,  ,           .     «»,    ,  ,       . <br><br>     <code>step</code>   <code>dispatch</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, dispatch] = useReducer(reducer, initialState); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { count, step } = state; useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'tick'</span></span> }); <span class="hljs-comment"><span class="hljs-comment">//  setCount(c =&gt; c + step); }, 1000); return () =&gt; clearInterval(id); }, [dispatch]);</span></span></code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>      . <br><br>     : «    ,  ?».    ,  React  ,   <code>dispatch</code>       .           . <br><br>   ! <br><br> (    <code>dispatch</code>  <code>setstate</code>      <code>useRef</code>      ,   React  ,    .     —    .) <br><br>  ,     ,   ,     ,  .          <code>step</code> .    ,     .      ,  .      : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = { <span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">step</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { count, step } = state; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.type === <span class="hljs-string"><span class="hljs-string">'tick'</span></span>) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">count</span></span>: count + step, step }; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.type === <span class="hljs-string"><span class="hljs-string">'step'</span></span>) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { count, <span class="hljs-attr"><span class="hljs-attr">step</span></span>: action.step }; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(); } }</code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> ,   ,      ,    . <br><br><h2> <font color="#3AC1EF"> useReducer —  - </font> </h2><br>    ,       ,       ,          .    ,     ,  ? , ,  API   <code>&lt;Counter step={1} /&gt;</code> . ,       <code>props.step</code>    ? <br><br>   ,        !     ,      : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ step }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, dispatch] = useReducer(reducer, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.type === <span class="hljs-string"><span class="hljs-string">'tick'</span></span>) {     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state + step;   } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {     <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>();   } } useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'tick'</span></span> });   }, <span class="hljs-number"><span class="hljs-number">1000</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> clearInterval(id); }, [dispatch]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{count}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; }</code> </pre> <br>      ,      . ,   ,  ,   ,       . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>  . <br><br>        <code>dispatch</code>    .  ,  ,     .       . <br><br> ,      ,      .   «»  ,    ,    ?    ,     <code>dispatch</code> , React   .        .                . <br><br>       <code>useReducer</code>    «-» .         ,  . ,   ,           ,  ,  . <br><br><h2> <font color="#3AC1EF">   </font> </h2><br>         ,    - ,        . <br><br> ,  ,  ,  : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [data, setData] = useState({ <span class="hljs-attr"><span class="hljs-attr">hits</span></span>: [] }); <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> axios(     <span class="hljs-string"><span class="hljs-string">'https://hn.algolia.com/api/v1/search?query=react'</span></span>,   );   setData(result.data); } useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   fetchData(); }, []); <span class="hljs-comment"><span class="hljs-comment">//   ? // ...</span></span></code> </pre><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>  ,      . <br><br>   ,  ,      .  ,   ,         ,   , ,    ,    ,       ,    . <br><br> ,       ,   ,    ,       : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ,       function getFetchUrl() {   return 'https://hn.algolia.com/api/v1/search?query=react'; } // ,        async function fetchData() {   const result = await axios(getFetchUrl());   setData(result.data); } useEffect(() =&gt; {   fetchData(); }, []); // ... }</span></span></code> </pre> <br>  , ,                : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [query, setQuery] = useState(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ,       function getFetchUrl() {   return 'https://hn.algolia.com/api/v1/search?query=' + query; } // ,        async function fetchData() {   const result = await axios(getFetchUrl());   setData(result.data); } useEffect(() =&gt; {   fetchData(); }, []); // ... }</span></span></code> </pre> <br>       ,    (,     ),         .     . <br><br>  ,      .        ,        : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... useEffect(() =&gt; {   //      !   function getFetchUrl() {     return 'https://hn.algolia.com/api/v1/search?query=react';   }   async function fetchData() {     const result = await axios(getFetchUrl());     setData(result.data);   }   fetchData(); }, []); //    . // ... }</span></span></code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>    . <br><br>          ?   ,           « ».       React,    -          . <br><br>      <code>getFetchUrl</code> ,      <code>query</code> ,  ,  , ,     .   —  ,  <code>query</code>     : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [query, setQuery] = useState(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFetchUrl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'https://hn.algolia.com/api/v1/search?query='</span></span> + query;   }   <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> axios(getFetchUrl());     setData(result.data);   }   fetchData(); }, [query]); <span class="hljs-comment"><span class="hljs-comment">//    . // ... }</span></span></code> </pre> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>    . <br><br>   ,    « React».        <code>query</code> . ,   ,    ,             ,     .   ,         ,     . <br><br>    <code>exhaustive-deps</code>   <code>eslint-plugin-react-hooks</code>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a>       ,   .  ,      ,         . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/04a/90d/cba/04a90dcbacb01105d634964880ebed19.gif"></div><br> <i><font color="#999999">  </font></i> <br><br>   . <br><br><h2> <font color="#3AC1EF"> ,      ?</font> </h2><br>        . ,               ,         . , ,      . <br><br>          ?  ,  . :     React  .       .         ,  «   ». ,    ,    .   , ,   ,     ! <br><br> ,    ,  . ,      <code>getFetchUrl</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFetchUrl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">query</span></span></span><span class="hljs-function">) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'https://hn.algolia.com/api/v1/search?query='</span></span> + query; } useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> url = getFetchUrl(<span class="hljs-string"><span class="hljs-string">'react'</span></span>);   <span class="hljs-comment"><span class="hljs-comment">// ...    -   ... }, []); //  : getFetchUrl useEffect(() =&gt; {   const url = getFetchUrl('redux');   // ...    -   ... }, []); //  : getFetchUrl // ... }</span></span></code> </pre> <br>      <code>getFetchUrl</code>     —   ,           . <br><br>   ,   «»   ,    .        <code>getFetchUrl</code> (,    ,   ),    : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       function getFetchUrl(query) {   return 'https://hn.algolia.com/api/v1/search?query=' + query; } useEffect(() =&gt; {   const url = getFetchUrl('react');   // ...    -    ... }, [getFetchUrl]); //   ,     . useEffect(() =&gt; {   const url = getFetchUrl('redux');   // ...    -   ... }, [getFetchUrl]); //   ,     . // ... }</span></span></code> </pre> <br>      ,    <code>getFetchUrl</code>   .    ,   —  . -      ,       ,     .      ,     ,    ,    . <br><br>   —        . <br><br>  ,         ,           : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//        function getFetchUrl(query) { return 'https://hn.algolia.com/api/v1/search?query=' + query; } function SearchResults() { useEffect(() =&gt; {   const url = getFetchUrl('react');   // ...    -   ... }, []); //     . useEffect(() =&gt; {   const url = getFetchUrl('redux');   // ...    -   ... }, []); //     . // ... }</span></span></code> </pre> <br>        ,                 .    ,  ,      . <br><br>       .    ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">useCallback</a> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    ,   const getFetchUrl = useCallback((query) =&gt; {   return 'https://hn.algolia.com/api/v1/search?query=' + query; }, []);  //      . useEffect(() =&gt; {   const url = getFetchUrl('react');   // ...    -   ... }, [getFetchUrl]); //      . useEffect(() =&gt; {   const url = getFetchUrl('redux');   // ...    -   ... }, [getFetchUrl]); //       // ... }</span></span></code> </pre> <br>  <code>useCallback</code>         .             :  ,   -,   ,      ,   . <br><br>       ,    .          ( <code>'react'</code>  <code>'redux'</code> ).  ,        ,         ,    <code>query</code> .  ,  ,   <code>query</code>    , <code>getFetchUrl</code>       . <br><br>   ,       <code>query</code>  <code>useCallback</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [query, setQuery] = useState(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getFetchUrl = useCallback(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   query   return 'https://hn.algolia.com/api/v1/search?query=' + query; }, []); //  : query // ... }</span></span></code> </pre> <br>    <code>useCallback</code>      <code>query</code> ,   ,     <code>getFetchUrl</code> ,      <code>query</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SearchResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [query, setQuery] = useState(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//      query const getFetchUrl = useCallback(() =&gt; {   return 'https://hn.algolia.com/api/v1/search?query=' + query; }, [query]);  //    . useEffect(() =&gt; {   const url = getFetchUrl();   // ...    -   ... }, [getFetchUrl]); //    . // ... }</span></span></code> </pre> <br>   <code>useCallback</code> ,  <code>query</code>  ,   <code>getFetchUrl</code>  ,  ,     .   <code>query</code> ,    <code>getFetchUrl</code> ,      .      Excel:     - ,     ,     ,   . <br><br>  —    ,              .         ,    : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Parent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [query, setQuery] = useState(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//      query const fetchData = useCallback(() =&gt; {   const url = 'https://hn.algolia.com/api/v1/search?query=' + query;   // ...      ... }, [query]);  //       return &lt;Child fetchData={fetchData} /&gt; } function Child({ fetchData }) { let [data, setData] = useState(null); useEffect(() =&gt; {   fetchData().then(setData); }, [fetchData]); //       // ... }</span></span></code> </pre> <br>   <code>fetchData</code>  <code>Parent</code>       <code>query</code> , <code>Child</code>        ,      . <br><br><h2> <font color="#3AC1EF">     ?</font> </h2><br>  ,          ,   , ,             .   ,    ,   ,        ,     : <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = {   <span class="hljs-attr"><span class="hljs-attr">query</span></span>: <span class="hljs-string"><span class="hljs-string">'react'</span></span> }; fetchData = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> url = <span class="hljs-string"><span class="hljs-string">'https://hn.algolia.com/api/v1/search?query='</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.query;   <span class="hljs-comment"><span class="hljs-comment">// ...    -   ... }; render() {   return &lt;Child fetchData={this.fetchData} /&gt;; } } class Child extends Component { state = {   data: null }; componentDidMount() {   this.props.fetchData(); } render() {   // ... } }</span></span></code> </pre> <br> ,   : « , ,   ,  <code>useEffect</code> —     <code>componentDidMount</code>  <code>componentDidUpdate</code> .     !».         <code>componentDidUpdate</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Child</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = {   <span class="hljs-attr"><span class="hljs-attr">data</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }; componentDidMount() {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.fetchData(); } componentDidUpdate(prevProps) {   <span class="hljs-comment"><span class="hljs-comment">//         if (this.props.fetchData !== prevProps.fetchData) {     this.props.fetchData();   } } render() {   // ... } }</span></span></code> </pre> <br> , <code>fetchData</code> —   ! (, ,  ,     .)      - ,   .  <code>this.props.fetchData</code>    <code>prevProps.fetchData</code>        . ,  ,  ? <br><br><pre> <code class="javascript hljs">  componentDidUpdate(prevProps) {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.fetchData(); }</code> </pre> <br>      .          . (      .)  ,   <code>fetchData</code>   <code>this.state.query</code> ? <br><br><pre> <code class="javascript hljs">  render() {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Child</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">fetchData</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.fetchData.bind(this,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">this.state.query</span></span></span></span><span class="xml"><span class="hljs-tag">)} /&gt;</span></span></span><span class="xml">; }</span></span></code> </pre> <br>    <code>this.props.fetchData !== prevProps.fetchData</code>    <code>true</code> ,    ,  <code>query</code>  !         . <br><br>      ,   ,   ,        <code>query</code>  <code>Child</code> .  ,   ,    <code>query</code> ,          <code>query</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = {   <span class="hljs-attr"><span class="hljs-attr">query</span></span>: <span class="hljs-string"><span class="hljs-string">'react'</span></span> }; fetchData = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> url = <span class="hljs-string"><span class="hljs-string">'https://hn.algolia.com/api/v1/search?query='</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.query;   <span class="hljs-comment"><span class="hljs-comment">// ...    -    ... }; render() {   return &lt;Child fetchData={this.fetchData} query={this.state.query} /&gt;; } } class Child extends Component { state = {   data: null }; componentDidMount() {   this.props.fetchData(); } componentDidUpdate(prevProps) {   if (this.props.query !== prevProps.query) {     this.props.fetchData();   } } render() {   // ... } }</span></span></code> </pre> <br>     ,   ,     -       ,     ,     . <br><br>      ,   ,      .     <code>this</code> ,        .  ,      ,       ,     ,  -  .    ,    <code>this.props.fetchData</code> ,     ,    ,  ,   ,    . <br><br>   -       <code>useCallback</code> .   , ,     ,     .     ,     .   <code>useCallback</code>    <code>props.fetchData</code>   . <br><br> , <code>useMemo</code>        : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ColorPicker</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//         Child, //       . const [color, setColor] = useState('pink'); const style = useMemo(() =&gt; ({ color }), [color]); return &lt;Child style={style} /&gt;; }</span></span></code> </pre> <br>     ,     <code>useCallback</code> ,    - .      « »,     ,      ,     .    ,       .      ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>    . <br><br>     ,   <code>fetchData</code>      (     ),       .    ,     ,       . («   <code>props.onComplete</code>    ,       ?»)    ,       . <br><br><h2> <font color="#3AC1EF"> </font> </h2><br>          ,   : <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Article</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = {   <span class="hljs-attr"><span class="hljs-attr">article</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }; componentDidMount() {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetchData(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.id); } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> fetchData(id) {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> article = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> API.fetchArticle(id);   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({ article }); } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br>  , , ,    .    .   —    ,     : <br><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Article</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = {   <span class="hljs-attr"><span class="hljs-attr">article</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }; componentDidMount() {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetchData(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.id); } componentDidUpdate(prevProps) {   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevProps.id !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.id) {     <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetchData(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.id);   } } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> fetchData(id) {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> article = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> API.fetchArticle(id);   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({ article }); } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br>  , , ,       .     ,       . ,     <code>{id: 10}</code> ,      <code>{id: 20}</code> ,    ,            .   ,   ,      ,  .   . <br><br> ,     ,   .  — ,   ,    <code>async/await</code> (  ,    - )    ,    (        ,      ). <br><br>         ,           <code>async</code> -. (, ,     ,     ,    .) <br><br>        ,   ,   !         . <br><br>  ,             : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Article</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ id }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [article, setArticle] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> didCancel = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;   <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> article = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> API.fetchArticle(id);     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!didCancel) {       setArticle(article);     }   }   fetchData();   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     didCancel = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;   }; }, [id]); <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>      ,      ,    ,       .         ,       . <br><br><h2> <font color="#3AC1EF"> </font> </h2><br>          ,   ,  ,      ,  ,   .       ,  , ,   .         .  —   . <br><br>        <code>useEffect</code> ,  ,  ,  .       React.    ,     <code>useEffect</code>      . <br><br>   ,   ,  «  »,         .     .    ,   ,  ,  ,   «»  ,      . <br><br>       ,  <code>useEffect</code>   ,    .   —    .  —    ,  ,  —   ,      .   ,  ,       ,   ,      API. <br><br>  ,        ,  <code>useFetch</code> ,       ,  <code>useTheme</code> ,    .  ,      ,         <code>useEffect</code> .  ,   ,     ,    . <br><br>   , , <code>useEffect</code>      .    —    ,     .      ,         .       ? <br><br>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Suspense</a>          React  ,       ,  -  ( : , , )     . <br><br>    <code>Suspense</code>       ,  ,  <code>useEffect</code>     ,    ,    ,        -  .    ,       ,        ,          .      ,  ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> ,        ,    . <br><br><h2>  <font color="#3AC1EF">Resumen</font> </h2><br>       ,   .   ,           ,   - , , ,     . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/445276/">https://habr.com/ru/post/445276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445266/index.html">GeekBrains junto con Rostelecom llevarán a cabo IoT Hackathon</a></li>
<li><a href="../445268/index.html">Detalles de GraphQL: qué, cómo y por qué</a></li>
<li><a href="../445270/index.html">[marcador] Bash para principiantes: 21 comandos útiles</a></li>
<li><a href="../445272/index.html">JavaScript es el mejor lenguaje de programación para principiantes. Entonces, ¿es o no?</a></li>
<li><a href="../445274/index.html">Cuando "Zoë"! == "Zoë", o por qué necesita normalizar cadenas Unicode</a></li>
<li><a href="../445278/index.html">Cómo crear un juego si nunca eres un artista</a></li>
<li><a href="../445280/index.html">Rentabilidad de sitios y servicios.</a></li>
<li><a href="../445284/index.html">ClickHouse Product Analytics VKontakte</a></li>
<li><a href="../445286/index.html">Reposapiés para el cerebro: plataforma de registro distribuido Hedera Hashgraph</a></li>
<li><a href="../445288/index.html">Todos sus préstamos de consumo y datos personales "en un solo lugar" ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>