<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“¡ ğŸ¥ â™ ï¸ Tablet black magic blue (kami membuat program Black Magic Probe dari modul berdasarkan STM32F103) ğŸ ğŸ‘©ğŸ»â€ğŸ­ â£ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mengapa 
 Di era Arduino UNO dan Atmega328, saya benar-benar melakukannya tanpa seorang programmer, mem-flash mikrokontroler terlebih dahulu dengan Ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tablet black magic blue (kami membuat program Black Magic Probe dari modul berdasarkan STM32F103)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/406281/"><h2>  Mengapa </h2><br>  Di era Arduino UNO dan Atmega328, saya benar-benar melakukannya tanpa seorang programmer, mem-flash mikrokontroler terlebih dahulu dengan Arduino bootloader melalui Arduino lain (Arduino sebagai ISP), dan kemudian melalui port serial reguler, dan hanya setelah Arduino mendukung modul berdasarkan nrf51822 Nordic dan nrf52832 untuk saya untuk pertama kalinya, kehadiran programmer swd menjadi relevan, karena tidak ada cara lain Anda dapat mengisi firmware dalam modul Cina telanjang. <br><br>  Standar de facto di bidang ini adalah pemrogram Jlink dari perusahaan Jerman Segger Microcontroller System, yang dikenal tidak hanya karena karakteristik kinerjanya yang sangat baik, tetapi juga karena harga yang sangat tinggi (sekitar $ 500-600).  Kita harus membayar upeti kepada Segger, untuk penggunaan non-komersial, versi EDU dirilis yang benar-benar identik dengan Jlink Base, tetapi bahkan biayanya 3.000 rubel di Rusia.  Aliexpress favorit penuh dengan klon Cina, tetapi mereka relatif mahal, belum lagi hal-hal lain. <br><br>  Ada ST-LINK / V2 dari ST Microelectronics, namun kompatibilitasnya dengan mikrokontroler yang diproduksi oleh STMicro sendiri tidak dipertanyakan. <br><br>  Akibatnya, pendapat saya pasti jatuh pada programmer JTAG / SWD Black Magic Probe (BMP), yang mengumpulkan lebih dari $ 47.000 di Kickstarter dengan tujuan yang dinyatakan $ 10.000. <br><a name="habracut"></a><br><h3>  Probe Sihir Hitam (BMP) </h3><br><img src="https://habrastorage.org/getpro/geektimes/post_images/ff9/d28/e6c/ff9d28e6c688fd1c5307dbe261a84890.jpg" alt="gambar"><br><br><ul><li>  Pemrogram sumber terbuka;  bekerja pada antarmuka JTAG atau SWD dan menyediakan debugging penuh </li><li>  Memiliki server GDB bawaan (tidak diperlukan program "perantara" seperti OpenOCD) </li><li>  Mendukung mikrokontroler ARM Cortex-M dan Cortex-A </li><li>  Ini bekerja pada Windows, Linux dan MacOS (dalam dua yang terakhir ini berfungsi tanpa driver) </li></ul><br><img src="https://habrastorage.org/getpro/geektimes/post_images/757/937/363/757937363cca6c6269bdaca8997efd42.png" alt="gambar"><br><h4>  Keuntungan dan kerugian BMP dibandingkan dengan klon Cina Segger Jlink dan ST-LINK / V2: </h4><br>  (+) <br><ul><li>  hati nurani yang baik (tidak ada klon palsu) </li><li>  murahnya (lebih lanjut tentang itu nanti) </li><li>  memiliki antarmuka JTAG dan UART (terutama yang relevan untuk debugging dalam gaya Arduino melalui serial.print () </li><li>  kemampuan dijamin untuk memperbarui dalam hal rilis firmware baru </li></ul><br>  (-) <br><ul><li>  set terbatas "tujuan" yang didukung (dibandingkan dengan Jlink) </li></ul><br>  Faktanya, BMP adalah programmer perangkat lunak yang dapat dijalankan pada perangkat keras yang berbeda.  Banyak perusahaan memproduksi programmer BMP "resmi", tetapi biayanya sekitar $ 60, yang, meskipun lebih murah dari Jlink asli, masih mahal untuk DIY. <br><br><h2>  Aku menginginkannya! </h2><br>  Bisakah saya mendapatkan Probe Sihir Hitam yang keren tanpa membayar $ 60?  Ya <br><br>  Untuk membuat Black Magic Probe, kita memerlukan modul berdasarkan STM32F103 MK, yang, di antara penggemar asing, disebut pil biru (pil biru) untuk warna khas topeng pada papan sirkuit cetak.  Tidak diketahui dari mana tradisi ini berasal, tetapi faktanya tetap: sebagian besar modul tersebut memiliki papan sirkuit cetak biru dan dilengkapi dengan pin dengan plastik kuning (diperoleh modul â€œkuning-hitamâ€).  Masih ada pil merah dan bahkan pil hitam, tetapi mereka pada dasarnya tidak berbeda dengan pil biru. <br><img src="https://habrastorage.org/getpro/geektimes/post_images/0f5/a0d/db7/0f5a0ddb778989c6c058e636d1d8f079.jpg" alt="gambar"><br><h2>  Ilmu hitam dalam 4 langkah </h2><br><h3>  Langkah 1 - Membuat file bootloader dan blackmagic itu sendiri </h3><br><pre><code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com:blacksphere/blackmagic.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> blackmagic make</code> </pre> <br>  (jika pesan kesalahan muncul, buka file make dengan editor apa pun (saya menggunakan nano): <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">nano</span></span> make</code> </pre> <br>  kami menemukan baris ke-13, terlihat seperti ini: " <b><code>CFLAGS += -Wall -Wextra -Werror -Wno-char-subscripts\</code></b> " dan menghapus " <b><code>-Werror</code></b> ", baris tersebut harus berubah menjadi: " <b><code>CFLAGS += -Wall -Wextra -Wno-char-subscripts\</code></b> ", keluar dari <b><code>CFLAGS += -Wall -Wextra -Wno-char-subscripts\</code></b> (ctrl-x, y) dan jalankan lagi <br> <b><code>make</code></b> <br> <br>  Sekarang buka direktori src: <br><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> src</code> </pre> <br>  dan masukkan perintah: <br><br><pre> <code class="hljs go"><span class="hljs-built_in"><span class="hljs-built_in">make</span></span> clean &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">make</span></span> PROBE_HOST=stlink</code> </pre> <br>  sebagai hasilnya, di direktori src, kita akan memiliki 2 file: blackmagic_dfu.bin dan blackmagic.bin <br><br>  Harap dicatat bahwa sejumlah besar semua jenis file dibuat di sana, kami hanya tertarik pada keduanya. <br><br><h3>  Langkah 2 - skrip boot </h3><br><pre> <code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/jsnyder/stm32loader.git</code> </pre> <br>  salin file yang dibuat sebelumnya ke direktori dengan skrip yang baru diunduh: <br><br><pre> <code class="hljs ruby">cp ~<span class="hljs-regexp"><span class="hljs-regexp">/blackmagic/src</span></span><span class="hljs-regexp"><span class="hljs-regexp">/blackmagic_dfu.bin ~/stm</span></span>32loader</code> </pre> <br><pre> <code class="hljs ruby">cp ~<span class="hljs-regexp"><span class="hljs-regexp">/blackmagic/src</span></span><span class="hljs-regexp"><span class="hljs-regexp">/blackmagic.bin ~/stm</span></span>32loader</code> </pre> <br><h3>  Langkah 3 - Firmware Bootloader </h3><br>  Di sisi kiri modul STM32 ada dua jumper kuning, bertuliskan boot0 dan boot1.  Ketika kedua jumper diatur ke posisi default (0), MK dimuat dari bootloader.  Kami tidak memiliki bootloader saat ini, jadi atur jumper atas (Boot0) ke posisi 1 (pindahkan ke kanan), yang memungkinkan kami untuk memuat file bootloader yang dibuat pada langkah 1. <br><br>  Kami menghubungkan STM32 dan adaptor USB-TTL sebagai berikut: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/3f3/2f8/f2d/3f32f8f2d7f5251475338d24247690f3.png" alt="gambar"><br><br>  Kami menghubungkan adaptor USB-TTL (bersama dengan modul STM32) ke komputer, jalankan <br>  <b><code>dmesg</code></b> dan lihat di port mana adaptor terhubung.  Dalam kasus saya, itu adalah <b><code>/dev//ttyUSB0</code></b> <br><br>  Dari direktori stm32loader, jalankan perintah: <br><br><pre> <code class="hljs powershell">python ./stm32loader <span class="hljs-literal"><span class="hljs-literal">-p</span></span> /dev/ttyUSB0 <span class="hljs-literal"><span class="hljs-literal">-e</span></span> <span class="hljs-literal"><span class="hljs-literal">-w</span></span> <span class="hljs-literal"><span class="hljs-literal">-v</span></span> blackmagic_dfu.bin</code> </pre> <br>  Secara alami, alih-alih ttyUSB0, Anda harus meletakkan porta tempat Anda memiliki adaptor USB-TTL. <br><br>  Anda mungkin perlu menekan tombol reset pada tablet biru, semuanya dilakukan untuk saya tanpa reset. <br><br>  Jika semuanya baik-baik saja, lepaskan adaptor USB-TTL, kita tidak akan memerlukannya lagi, atur kembali jumper ke posisi 0 dan bersiap untuk ritual sihir hitam. <br><br><h3>  Langkah 4 - Black Magic (Mengubah STM32 menjadi BMP) </h3><br>  Kami menghubungkan modul stm32 kami melalui kabel micro-usb biasa.  Instal dfuutil: <br><br><pre> <code class="hljs sql">sudo apt <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> dfuutil</code> </pre> <br>  dan jalankan: <br><br><pre> <code class="hljs powershell">sudo dfu<span class="hljs-literal"><span class="hljs-literal">-util</span></span> <span class="hljs-literal"><span class="hljs-literal">-d</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>d50:<span class="hljs-number"><span class="hljs-number">6018</span></span>,:<span class="hljs-number"><span class="hljs-number">6017</span></span> <span class="hljs-literal"><span class="hljs-literal">-s</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>x08002000:leave <span class="hljs-literal"><span class="hljs-literal">-D</span></span> ~/stm32loader/blackmagic.bin</code> </pre> <br>  <b>Selesai!</b> <br><br>  Untuk memeriksa, lepaskan / pasang kabel usb, jalankan <b><code>dmesg</code></b> , 2 perangkat akan terlihat: Blackmagic GDB dan Blackmagic COM. <br><br><h3>  Cara menggunakan (contoh firmware file myfile.hex yang sudah dikompilasi): </h3><br>  Untuk Windows 7 dan di bawah, sistem akan meminta Anda untuk menginstal driver, Anda dapat mengambilnya <br>  <a href="">dari sini.</a>  Di Windows 10, semuanya berfungsi apa adanya. <br><br>  Di Device Manager, lihat nomor port yang terhubung dengan BMP, kemungkinan besar akan seperti COM11 dan COM12: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/12a/8d2/5e4/12a8d25e4727261497255d1131b21f50.png" alt="gambar"></div><br>  Kami terhubung ke mikrokontroler sesuai dengan skema berikut: <br><table><tbody><tr><th>  Mikrokontroler </th><th>  BMP </th></tr><tr><td>  GND </td><td>  GND </td></tr><tr><td>  SWDIO </td><td>  PB14 </td></tr><tr><td>  SWCLK </td><td>  PA5 </td></tr><tr><td>  Vcc </td><td>  3.3V </td></tr></tbody></table><br>  Jika Anda memerlukan port serial, maka kami juga menghubungkan: <br><table><tbody><tr><th>  Mikrokontroler </th><th>  BMP </th></tr><tr><td>  Rxd </td><td>  PA3 </td></tr><tr><td>  Txd </td><td>  PA2 </td></tr></tbody></table><br>  Selanjutnya, dari baris perintah (dipahami bahwa jalur ke debugger gdb ada di jalur): <br>  <code>arm-none-eabi-gdb.exe -ex "target extended-remote \\.\COM11"</code> (awalan \\. \ diperlukan jika nomor port&gt; = 10) <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">mon</span></span> swdp_scan</code> </pre> <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">att</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">mon</span></span> erase_mass</code> </pre> <br><pre> <code class="hljs xml">cd <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"></span></span></span><span class="hljs-tag">  </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hex</span></span></span><span class="hljs-tag"> &gt;</span></span></code> </pre> <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">load</span></span> myfile.hex&lt;/b&gt;</code> </pre> <br><pre> <code class="hljs xml">quit<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Sebenarnya, semua perintah ini bisa "dijahit" menjadi satu, itu akan menjadi seperti ini <br> <code>arm-none-eabi-gdb.exe -ex "target extended-remote \\.\COM11" â€“ex â€œmonitor swdp_scanâ€ -ex Â«att 1â€-ex â€œmon erase_massâ€ â€“ex â€œcd &lt;  hex &gt;â€ â€“ex â€œload myfile.hexâ€ â€“ex â€œquitâ€</code> <br> <br><h2>  Dilanjutkan ... </h2><br>  Lain kali kita akan belajar bagaimana menggunakan BMP untuk pemrograman di lingkungan Arduino modul Bluetooth berbasis nrf51822 dengan inti prosesor Cortex M0 terintegrasi <br><br>  Bahan yang digunakan: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Waktu</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dua</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id406281/">https://habr.com/ru/post/id406281/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id406269/index.html">Terbang dengan sup purba</a></li>
<li><a href="../id406271/index.html">Movidius Myriad X - Pusat Persepsi dan Analisis</a></li>
<li><a href="../id406273/index.html">Elon Musk menentang senjata mematikan yang otonom</a></li>
<li><a href="../id406275/index.html">Surat-surat Alan Turing yang hilang ditemukan di dapur Universitas Manchester</a></li>
<li><a href="../id406279/index.html">Bagaimana cara kerja bidang Higgs: 3) bagaimana partikel Higgs muncul</a></li>
<li><a href="../id406283/index.html">Bagaimana air mata diatur dan cara kerjanya, dan apa yang terjadi ketika mata mengering</a></li>
<li><a href="../id406285/index.html">Sangat mudah untuk memilih pemantauan generator diesel! .. Atau tidak?</a></li>
<li><a href="../id406287/index.html">Buku "Mekanika Kuantum. Minimum teoretis "</a></li>
<li><a href="../id406289/index.html">Metode untuk menyimpan data dalam molekul individu pada suhu yang relatif tinggi âˆ’213 Â° C</a></li>
<li><a href="../id406291/index.html">Kenakan headphone Anda dan menjadi lebih efektif: Bagaimana musik memengaruhi produktivitas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>