<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯФ╕ ЁЯзЪЁЯП╝ ЁЯСитАНЁЯСйтАНЁЯСзтАНЁЯСз Kubernetes рдкрд░ рдЬреЗрдирдХрд┐рдиреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рд╕реАрдЖрдИ / рд╕реАрдбреА ЁЯХЫ ЁЯСиЁЯП╛тАНЁЯОи ЁЯФ▓</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╢реБрдн рджреЛрдкрд╣рд░ 


 рдЬреЗрдирдХреАрдВрд╕, ci / cd рдФрд░ kubernetes рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ Habr├й рдкрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХрдИ рд▓реЗрдЦ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рдореИрдВ рдЗрди рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХрд┐рдпреЛрдВ рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kubernetes рдкрд░ рдЬреЗрдирдХрд┐рдиреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рд╕реАрдЖрдИ / рд╕реАрдбреА</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442614/"><p>  рд╢реБрдн рджреЛрдкрд╣рд░ </p><br><p>  рдЬреЗрдирдХреАрдВрд╕, ci / cd рдФрд░ kubernetes рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ Habr├й рдкрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдХрдИ рд▓реЗрдЦ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рдореИрдВ рдЗрди рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХрд┐рдпреЛрдВ рдХреА рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛, рд▓реЗрдХрд┐рди ci / dd рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рдЙрдирдХреЗ рд╕рд░рд▓рддрдо рд╡рд┐рдиреНрдпрд╛рд╕ рдкрд░ред </p><br><p>  рдореЗрд░рд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдкрд╛рдардХ рдХреЛ рдбреЙрдХрдЯрд░ рдХреА рдмреБрдирд┐рдпрд╛рджреА рд╕рдордЭ рд╣реИ, рдФрд░ рдореИрдВ рдХреБрдмреЗрд░рдиреЗрдЯ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд╡рд┐рд╖рдпреЛрдВ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдирд╣реАрдВ рдХрд░реВрдВрдЧрд╛ред  рд╕рднреА рдЙрджрд╛рд╣рд░рдг рдорд┐рдиреАрдХреНрдпреВрдм рдкрд░ рджрд┐рдЦрд╛рдП рдЬрд╛рдПрдВрдЧреЗ, рд▓реЗрдХрд┐рди рдИрдХреЗрдПрд╕, рдЬреАрдХреЗрдХреЗ, рдпрд╛ рдЬреИрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЗ рдмрд┐рдирд╛ рднреА рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/ge/qo/ub/geqoubunc_7bpd9dwq5bpftps2m.png"></p><a name="habracut"></a><br><h2 id="okruzheniya">  рдкреНрд░рддрд┐рд╡реЗрд╢ </h2><br><p>  рдореИрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд╛рддрд╛рд╡рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рд╕реБрдЭрд╛рд╡ рджреЗрддрд╛ рд╣реВрдВ: </p><br><ul><li>  рдкрд░реАрдХреНрд╖рдг - рдореИрдиреБрдЕрд▓ рддреИрдирд╛рддреА рдФрд░ рд╢рд╛рдЦрд╛ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП </li><li>  рдордВрдЪрди - рдПрдХ рд╡рд╛рддрд╛рд╡рд░рдг рдЬрд╣рд╛рдВ рд╕рднреА рдкрд░рд┐рд╡рд░реНрддрди рдЬреЛ рдорд╛рд╕реНрдЯрд░ рдореЗрдВ рдЖрддреЗ рд╣реИрдВ, рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рддреИрдирд╛рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ </li><li>  рдЙрддреНрдкрд╛рджрди - рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рд╡рд╛рддрд╛рд╡рд░рдг, рдЬрд╣рд╛рдВ рдкрд░рд┐рд╡рд░реНрддрди рдордВрдЪрди рдкрд░ рдЙрдирдХреА рд╕рдВрдЪрд╛рд▓рди рдХреНрд╖рдорддрд╛ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рд╣реА рдЬрд╛рдПрдВрдЧреЗ </li></ul><br><p>  рд╡рд╛рддрд╛рд╡рд░рдг рдХреЛ рдПрдХ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рднреАрддрд░ рдХреБрдмреЗрд░рдиреЗрдЯ рдирд╛рдорд╕реНрдерд╛рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╢реБрд░реБрдЖрдд рдореЗрдВ рдЬрд┐рддрдирд╛ рд╕рдВрднрд╡ рд╣реЛ рдЙрддрдирд╛ рд╕рд░рд▓ рдФрд░ рддреЗрдЬ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХреА рдХрдорд┐рдпрд╛рдВ рднреА рд╣реИрдВ: рдирд╛рдорд╕реНрдерд╛рди рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдПрдХ рджреВрд╕рд░реЗ рд╕реЗ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдореЗрдВ рдкреГрдердХ рдирд╣реАрдВ рд╣реИрдВред </p><br><p>  рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдкреНрд░рддреНрдпреЗрдХ рдиреЗрдорд╕реНрдкреЗрд╕ рдореЗрдВ рдЗрд╕ рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЗ рд╕рд╛рде рдХреЙрдиреНрдлрд╝рд┐рдЧрд░рдореИрдк рдХрд╛ рдПрдХ рд╣реА рд╕реЗрдЯ рд╣реЛрдЧрд╛: </p><br><pre><code class="plaintext hljs">apiVersion: v1 kind: Namespace metadata: name: production --- apiVersion: v1 kind: ConfigMap metadata: name: environment.properties namespace: production data: environment.properties: | env=production</code> </pre> <br><h2 id="helm">  рдкрддрд╡рд╛рд░ </h2><br><p>  рд╣реЗрд▓реНрдо рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣реИ рдЬреЛ рдХреБрдмреЗрд░рдиреЗрдЯ рдкрд░ рд╕реНрдерд╛рдкрд┐рдд рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред <br>  рд╕реНрдерд╛рдкрдирд╛ рдирд┐рд░реНрджреЗрд╢ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рдпрд╣рд╛рдВ</a> рджреЗрдЦреЗ рдЬрд╛ рд╕рдХрддреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рд╣реИрдВ</a> ред <br>  рдЖрд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдХреНрд▓рд╕реНрдЯрд░ рдХреЗ рд╕рд╛рде рдкрддрд╡рд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯрд┐рд▓рд░ рдкреЙрдб рдХреЛ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдирд╛ рд╣реЛрдЧрд╛: </p><br><pre> <code class="plaintext hljs">helm init</code> </pre> <br><h2 id="jenkins">  рдЬреЗрдирдХреАрдВрд╕ </h2><br><p>  рдореИрдВ рдЬреЗрдирдХрд┐рдиреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реВрдВрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рдХрд╛рдлреА рд╕рд░рд▓, рд▓рдЪреАрд▓рд╛ рдФрд░ рд▓реЛрдХрдкреНрд░рд┐рдп рдордВрдЪ рд╣реИред  рдЗрд╕реЗ рдЕрдиреНрдп рд╡рд╛рддрд╛рд╡рд░рдгреЛрдВ рд╕реЗ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдирд╛рдорд╕реНрдерд╛рди рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдЪреВрдВрдХрд┐ рдореИрдВ рднрд╡рд┐рд╖реНрдп рдореЗрдВ рдкрддрд╡рд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдпреЛрдЬрдирд╛ рдмрдирд╛ рд░рд╣рд╛ рд╣реВрдВ, рдореИрдВ рдореМрдЬреВрджрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рдЦреБрд▓реЗ рд╕реНрд░реЛрдд рдЪрд╛рд░реНрдЯ</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬреЗрдирдХреАрдВрд╕ рдХреА рд╕реНрдерд╛рдкрдирд╛ рдХреЛ рд╕рд░рд▓ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реВрдВ: </p><br><pre> <code class="plaintext hljs">helm install --name jenkins --namespace jenkins -f jenkins/demo-values.yaml stable/jenkins</code> </pre> <br><p>  Demo-values.yaml рдореЗрдВ рдЬреЗрдирдХрд┐рдВрд╕ рд╕рдВрд╕реНрдХрд░рдг, рдкреВрд░реНрд╡-рд╕реНрдерд╛рдкрд┐рдд рдкреНрд▓рдЧрдЗрдиреНрд╕ рдХрд╛ рдПрдХ рд╕реЗрдЯ, рдПрдХ рдбреЛрдореЗрди рдирд╛рдо рдФрд░ рдЕрдиреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╢рд╛рдорд┐рд▓ рд╣реИрдВ </p><br><div class="spoiler">  <b class="spoiler_title">рдбреЗрдореЛ values.yaml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Master: Name: jenkins-master Image: "jenkins/jenkins" ImageTag: "2.163-slim" OverwriteConfig: true AdminUser: admin AdminPassword: admin InstallPlugins: - kubernetes:1.14.3 - workflow-aggregator:2.6 - workflow-job:2.31 - credentials-binding:1.17 - git:3.9.3 - greenballs:1.15 - google-login:1.4 - role-strategy:2.9.0 - locale:1.4 ServicePort: 8080 ServiceType: NodePort HostName: jenkins.192.168.99.100.nip.io Ingress: Path: / Agent: Enabled: true Image: "jenkins/jnlp-slave" ImageTag: "3.27-1" #autoadjust agent resources limits resources: requests: cpu: null memory: null limits: cpu: null memory: null #to allow jenkins create slave pods rbac: install: true</code> </pre></div></div><br><p>  рдпрд╣ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд▓реЙрдЧрд┐рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ / рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдмрд╛рдж рдореЗрдВ рдкреБрди: рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд╕рдВрднрд╛рд╡рд┐рдд рд╡рд┐рдХрд▓реНрдкреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ google SSO рд╣реИ (рдЗрд╕рдХреЗ рд▓рд┐рдП google-login plugin рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕рдХреА рд╕реЗрдЯрд┐рдВрдЧ Jenkins&gt; Manage Jenkins&gt; Configure Global Security&gt; Access Control&gt; Security Realm&gt; Login with Google) рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИрдВред </p><br><p>  рдЬреЗрдирдХрд┐рдиреНрд╕ рдХреЛ рддреБрд░рдВрдд рдкреНрд░рддреНрдпреЗрдХ рдмрд┐рд▓реНрдб рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╛рд░ рдХрд╛ рджрд╛рд╕ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рддреБрд░рдВрдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдЗрд╕рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рдЯреАрдо рдЕрдм рдЕрд╕реЗрдВрдмрд▓реА рдХреЗ рд▓рд┐рдП рдПрдХ рдореБрдлреНрдд рдПрдЬреЗрдВрдЯ рдХреА рдЙрдореНрдореАрдж рдирд╣реАрдВ рдХрд░реЗрдЧреА, рдФрд░ рд╡реНрдпрд╡рд╕рд╛рдп рдЖрд╡рд╢реНрдпрдХ рд╕рд░реНрд╡рд░ рдХреА рд╕рдВрдЦреНрдпрд╛ рдкрд░ рдмрдЪрдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛ред </p><br><p><img src="https://habrastorage.org/webt/it/8_/oo/it8_oo1aownty_iuuihofbo0q_4.png"></p><br><p>  рдмреЙрдХреНрд╕ рд╕реЗ рдмрд╛рд╣рд░ рднреА, PersistenceVolume рдХреЛ рдкреБрдирдГ рдЖрд░рдВрдн рдпрд╛ рдЕрджреНрдпрддрди рдХрд░рддреЗ рд╕рдордп рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреЛрдВ рдХреЛ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </p><br><p>  рд╕реНрд╡рдд: рдкрд░рд┐рдирд┐рдпреЛрдЬрди рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдХреБрдмрдиреЗрдЯреЗрдЯ рдореЗрдВ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреА рдПрдХ рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╣реЗрд░рдлреЗрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЗрдирдХрд┐рдВрд╕ рдХреЗ рд▓рд┐рдП рдХреНрд▓рд╕реНрдЯрд░-рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><pre> <code class="plaintext hljs">kubectl create clusterrolebinding jenkins --clusterrole cluster-admin --serviceaccount=jenkins:default</code> </pre> <br><p>  рднрд╡рд┐рд╖реНрдп рдореЗрдВ, рдЖрдк рдкреНрд▓рдЧрдЗрдиреНрд╕ рдпрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЗ рдирдП рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣реЗрд▓реНрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬреЗрдирдХрд┐рдиреНрд╕ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><pre> <code class="plaintext hljs">helm upgrade jenkins stable/jenkins -f jenkins/demo-values.yaml</code> </pre> <br><p>  рдпрд╣ рдЬреЗрдирдХрд┐рдВрд╕ рдХреЗ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реА рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдкрддрд╡рд╛рд░ рдХреЗ рд╕рд╛рде рдЖрдкрдХреЛ рдкрд┐рдЫрд▓реЗ рд╕рдВрд╢реЛрдзрдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд╛рдкрд╕ рд░реЛрд▓ рдХрд░рдиреЗ рдХрд╛ рдЕрд╡рд╕рд░ рдорд┐рд▓реЗрдЧрд╛: </p><br><pre> <code class="plaintext hljs">helm history jenkins helm rollback jenkins ${revision}</code> </pre> <br><h2 id="sborka-prilozhenieya">  рдЖрд╡реЗрджрди рдХрд╛ рдирд┐рд░реНрдорд╛рдг </h2><br><p>  рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, рдореИрдВ рд╕рдмрд╕реЗ рд╕рд░рд▓ рд╕реНрдкреНрд░рд┐рдВрдЧ рдмреВрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рддреИрдирд╛рддреА рдХрд░реВрдВрдЧрд╛ред  рдЗрд╕реА рддрд░рд╣ рдЬреЗрдирдХрд┐рдВрд╕ рдХреЗ рд╕рд╛рде рдореИрдВ рдкрддрд╡рд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реВрдВрдЧрд╛ред </p><br><p>  рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрдХреНрд░рдо рдореЗрдВ рд╣реЛрдЧреА: </p><br><ul><li>  рдЬрд╛рдВрдЪ </li><li>  рд╕рдВрдХрд▓рди </li><li>  рдЗрдХрд╛рдИ рдкрд░реАрдХреНрд╖рдг </li><li>  рдПрдХреАрдХрд░рдг рдкрд░реАрдХреНрд╖рдг </li><li>  рд╡рд┐рд░реВрдкрдг рд╕рд╛рдХреНрд╖реНрдп рд╡рд┐рдзрд╛рдирд╕рднрд╛ </li><li>  рдбреЙрдХрдЯрд░ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рд╡рд┐рд░реВрдкрдг рд╕рд╛рдХреНрд╖реНрдп рддреИрдирд╛рддреА </li><li>  рдордВрдЪрди рдХреЗ рд▓рд┐рдП рдХрд▓рд╛рдХреГрддрд┐рдпреЛрдВ рдХреА рддреИрдирд╛рддреА (рдХреЗрд╡рд▓ рдорд╛рд╕реНрдЯрд░ рд╢рд╛рдЦрд╛ рдХреЗ рд▓рд┐рдП) </li></ul><br><p>  рдЗрд╕рдХреЗ рд▓рд┐рдП рдореИрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рдЬреЗрдирдХрд┐рдиреНрд╕ рдлрд╝рд╛рдЗрд▓ рдХрд╛</a> рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВред  рдореЗрд░реА рд░рд╛рдп рдореЗрдВ, рдпрд╣ рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдмрд╣реБрдд рд╣реА рд▓рдЪреАрд▓рд╛ (рд▓реЗрдХрд┐рди, рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рдирд╣реАрдВ) рддрд░реАрдХрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рдПрдХ рдлрд╛рдпрджрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЕрд╕реЗрдВрдмрд▓реА рдореЗрдВ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдЕрд╕реЗрдВрдмрд▓реА рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рд╕рд╛рде рд╣реА рд░рдЦрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реИред </p><br><h3 id="checkout">  рдЬрд╛рдВрдЪ </h3><br><p><img src="https://habrastorage.org/webt/tl/zi/is/tlziisqfairddgvaayk6atfuhhm.png"></p><br><p>  Bitbucket рдпрд╛ github рд╕рдВрдЧрдарди рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдк Jenkins рдХреЛ рд╕рдордп-рд╕рдордп рдкрд░ Jenkinsfile рдХреЗ рд╕рд╛рде рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЗ рд▓рд┐рдП рдкреВрд░реЗ рдЦрд╛рддреЗ рдХреЛ рд╕реНрдХреИрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЙрдирдХреЗ рд▓рд┐рдП рдЕрд╕реЗрдВрдмрд▓реА рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдЬреЗрдирдХрд┐рдВрд╕ рдорд╛рд╕реНрдЯрд░ рдФрд░ рд╢рд╛рдЦрд╛рдУрдВ рджреЛрдиреЛрдВ рдХреЛ рдЗрдХрдЯреНрдард╛ рдХрд░реЗрдЧрд╛ред  рдЦреАрдВрдЪреЗ рдЧрдП рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдПрдХ рдЕрд▓рдЧ рдЯреИрдм рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдПрдХ рд╕рд░рд▓ рд╡рд┐рдХрд▓реНрдк рд╣реИ - рдПрдХ рдЕрд▓рдЧ рдЧрд┐рдЯ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдЬреЛрдбрд╝реЗрдВ, рдЬрд╣рд╛рдВ рдпрд╣ рд╣реЛрд╕реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЪрд╛рд╣реЗред  рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдореИрдВ рдмрд╕ рдпрд╣реА рдХрд░реВрдБрдЧрд╛ред  рдЬреЗрдирдХрд┐рдВрд╕&gt; рдирдИ рдЖрдЗрдЯрдо&gt; рдорд▓реНрдЯреАрдмреНрд░рд╛рдВрдЪ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдореЗрдиреНрдпреВ рдореЗрдВ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдЕрд╕реЗрдВрдмрд▓реА рдирд╛рдо рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ рдФрд░ рдЧрд┐рдЯ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЛ рдмрд╛рдВрдзреЗрдВред </p><br><h3 id="kompilyaciya">  рд╕рдВрдХрд▓рди </h3><br><p>  рдЪреВрдВрдХрд┐ рдЬреЗрдирдХрд┐рдиреНрд╕ рдкреНрд░рддреНрдпреЗрдХ рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ рдкреЙрдб рдмрдирд╛рддрд╛ рд╣реИ, рдорд╛рд╡реЗрди рдпрд╛ рд╕рдорд╛рди рдХрд▓реЗрдХреНрдЯрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдирд┐рд░реНрднрд░рддрд╛рдПрдВ рд╣рд░ рдмрд╛рд░ рдлрд┐рд░ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЬрд╛рдПрдВрдЧреАред  рдЗрд╕рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк .m2 рдпрд╛ рд╕рдорд╛рди рдХреИрд╢ рдХреЗ рд▓рд┐рдП PersistenceVolume рдЖрд╡рдВрдЯрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдкреЙрдб рдореЗрдВ рдорд╛рдЙрдВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рддрд╛ рд╣реИред </p><br><pre> <code class="plaintext hljs">apiVersion: "v1" kind: "PersistentVolumeClaim" metadata: name: "repository" namespace: "jenkins" spec: accessModes: - ReadWriteMany resources: requests: storage: 10Gi</code> </pre> <br><p>  рдореЗрд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЗрд╕рдиреЗ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЛ рд▓рдЧрднрдЧ 4 рд╕реЗ 1 рдорд┐рдирдЯ рддрдХ рдЧрддрд┐ рджреЗрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреАред </p><br><h3 id="versionirovanie">  рд╡рд░реНрдЬрд╝рдирд┐рдВрдЧ </h3><br><p>  CI / CD рдХреЗ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдкреНрд░рддреНрдпреЗрдХ рдмрд┐рд▓реНрдб рдХреЛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдВрд╕реНрдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </p><br><p>  рдПрдХ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд╡рд┐рдХрд▓реНрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рд╕рд┐рдореЗрдВрдЯрд┐рдХ рд╡рд░реНрдЬрдирд┐рдВрдЧ</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдпрд╣ рдЖрдкрдХреЛ рдкрд┐рдЫрдбрд╝реЗ рд╕рдВрдЧрдд рдФрд░ рдЕрд╕рдВрдЧрдд рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛, рд▓реЗрдХрд┐рди рдЗрд╕ рддрд░рд╣ рдХреЗ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдирд╛ рдЕрдзрд┐рдХ рдХрдард┐рди рд╣реИред </p><br><p>  рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдореИрдВ рдЖрдИрдбреА рдФрд░ рдХрдорд┐рдЯ рдХреА рддрд╛рд░реАрдЦ рд╕реЗ рдПрдХ рд╕рдВрд╕реНрдХрд░рдг рдЙрддреНрдкрдиреНрди рдХрд░реВрдВрдЧрд╛, рд╕рд╛рде рд╣реА рд╢рд╛рдЦрд╛ рдХрд╛ рдирд╛рдо, рдЕрдЧрд░ рдпрд╣ рдорд╛рд╕реНрдЯрд░ рдирд╣реАрдВ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП <em>56e0fbdc-201802231623</em> рдпрд╛ <em>b3d3c143-201802231548-PR-18</em> ред </p><br><p>  рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд▓рд╛рдн: </p><br><ul><li>  рд╕реНрд╡рдЪрд╛рд▓рди рдореЗрдВ рдЖрд╕рд╛рдиреА </li><li>  рд╕реНрд░реЛрдд рдХреЛрдб рдФрд░ рдЗрд╕рдХреЗ рдирд┐рд░реНрдорд╛рдг рдХрд╛ рд╕рдордп рд╕рдВрд╕реНрдХрд░рдг рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИ </li><li>  рдиреЗрддреНрд░рд╣реАрди, рдЖрдк рдЙрдореНрдореАрджрд╡рд╛рд░ рдХреЗ рд░рд┐рд▓реАрдЬрд╝ рд╕рдВрд╕реНрдХрд░рдг (рд╡рд┐рдЬрд╝рд╛рд░реНрдб рд╕реЗ) рдпрд╛ рдкреНрд░рдпреЛрдЧрд╛рддреНрдордХ (рд╢рд╛рдЦрд╛ рд╕реЗ) рдХреЛ рдЕрд▓рдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ <br>  рд▓реЗрдХрд┐рди: </li><li>  рдпрд╣ рд╕рдВрд╕реНрдХрд░рдг рдореМрдЦрд┐рдХ рд╕рдВрдЪрд╛рд░ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдХрдард┐рди рд╣реИ </li><li>  рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЕрд╕рдВрдЧрдд рдкрд░рд┐рд╡рд░реНрддрди рдереЗред </li></ul><br><p>  рдЪреВрдБрдХрд┐ docker рдХреА рдЫрд╡рд┐ рдореЗрдВ рдПрдХ рд╣реА рд╕рдордп рдореЗрдВ рдХрдИ рдЯреИрдЧ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕рдВрдпреБрдХреНрдд рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ: рд╕рднреА рд░рд┐рд▓реАрдЬрд╝ рдЬрдирд░реЗрдЯ рдХрд┐рдП рдЧрдП рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдЬреЛ рдЙрддреНрдкрд╛рджрди рдореЗрдВ рдЖрддреЗ рд╣реИрдВ рд╡реЗ рдЕрддрд┐рд░рд┐рдХреНрдд рд░реВрдк рд╕реЗ (рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ) рд╢рдмреНрджрд╛рд░реНрде рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╕рд╛рде рдЯреИрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред  рдпрд╣, рдмрджрд▓реЗ рдореЗрдВ, рдЕрдзрд┐рдХ рд╕реЗ рдЕрдзрд┐рдХ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЬрдЯрд┐рд▓рддрд╛ рдФрд░ рдЖрд╡реЗрджрди рдХреЛ рджрд┐рдЦрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХрд┐рд╕ рд╕рдВрд╕реНрдХрд░рдг рдХреА рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИред </p><br><h3 id="artefakty">  рдХрд▓рд╛рдХреГрддрд┐рдпреЛрдВ </h3><br><p>  рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реЛрдЧрд╛: </p><br><ul><li>  рдПрдХ рдЖрд╡реЗрджрди рдХреЗ рд╕рд╛рде docker рдХреА рдЫрд╡рд┐ рдЬреЛ рд╕рдВрдЧреНрд░рд╣ рдФрд░ docker рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╕реЗ рд▓реЛрдб рдХреА рдЬрд╛рдПрдЧреАред  рдЙрджрд╛рд╣рд░рдг рдорд┐рдиреАрдХреНрдпреВрдм рд╕реЗ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛, рдЬрд┐рд╕реЗ рдбреЙрдХрдЯрд░ рд╣рдм рдпрд╛ рдЕрдореЗрдЬрд╝реЕрди (рдИрдХреНрд░) рдпрд╛ Google рд╕реЗ рдПрдХ рдирд┐рдЬреА рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╕реЗ рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (withCredentials рдирд┐рд░реНрдорд╛рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрдиреНрд╣реЗрдВ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рди рднреВрд▓реЗрдВ)ред </li><li>  рдкрддрд╡рд╛рд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреА рддреИрдирд╛рддреА (рддреИрдирд╛рддреА, рд╕реЗрд╡рд╛, рдЖрджрд┐) рдХреЗ рд╡рд░реНрдгрди рдХреЗ рд╕рд╛рде рдкрддрд╡рд╛рд░ рдЪрд╛рд░реНрдЯред  рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, рдЙрдиреНрд╣реЗрдВ рдХрд▓рд╛рдХреГрддрд┐рдпреЛрдВ рдХреЗ рдПрдХ рдЕрд▓рдЧ рднрдВрдбрд╛рд░ рдкрд░ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди, рд╕рд░рд▓реАрдХрд░рдг рдХреЗ рд▓рд┐рдП, рдЙрдиреНрд╣реЗрдВ рдЖрд╡рд╢реНрдпрдХ рдкреНрд░рддрд┐рдмрджреНрдз рд╕реЗ рдмрд╛рд╣рд░ рдХреА рдЬрд╛рдБрдЪ рдХрд░рдХреЗ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </li></ul><br><h3 id="jenkinsfile">  Jenkinsfile </h3><br><p>  рдирддреАрдЬрддрди, рдЖрд╡реЗрджрди рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреЗрдирдХрд┐рдВрд╕рдлрд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛: </p><br><div class="spoiler">  <b class="spoiler_title">Jenkinsfile</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">def branch def revision def registryIp pipeline { agent { kubernetes { label 'build-service-pod' defaultContainer 'jnlp' yaml """ apiVersion: v1 kind: Pod metadata: labels: job: build-service spec: containers: - name: maven image: maven:3.6.0-jdk-11-slim command: ["cat"] tty: true volumeMounts: - name: repository mountPath: /root/.m2/repository - name: docker image: docker:18.09.2 command: ["cat"] tty: true volumeMounts: - name: docker-sock mountPath: /var/run/docker.sock volumes: - name: repository persistentVolumeClaim: claimName: repository - name: docker-sock hostPath: path: /var/run/docker.sock """ } } options { skipDefaultCheckout true } stages { stage ('checkout') { steps { script { def repo = checkout scm revision = sh(script: 'git log -1 --format=\'%h.%ad\' --date=format:%Y%m%d-%H%M | cat', returnStdout: true).trim() branch = repo.GIT_BRANCH.take(20).replaceAll('/', '_') if (branch != 'master') { revision += "-${branch}" } sh "echo 'Building revision: ${revision}'" } } } stage ('compile') { steps { container('maven') { sh 'mvn clean compile test-compile' } } } stage ('unit test') { steps { container('maven') { sh 'mvn test' } } } stage ('integration test') { steps { container ('maven') { sh 'mvn verify' } } } stage ('build artifact') { steps { container('maven') { sh "mvn package -Dmaven.test.skip -Drevision=${revision}" } container('docker') { script { registryIp = sh(script: 'getent hosts registry.kube-system | awk \'{ print $1 ; exit }\'', returnStdout: true).trim() sh "docker build . -t ${registryIp}/demo/app:${revision} --build-arg REVISION=${revision}" } } } } stage ('publish artifact') { when { expression { branch == 'master' } } steps { container('docker') { sh "docker push ${registryIp}/demo/app:${revision}" } } } } }</code> </pre> </div></div><br><h2 id="dopolnitelnye-jenkins-pipelines-dlya-upravleniya-zhiznennym-ciklom-prilozheniya">  рдЖрд╡реЗрджрди рдЬреАрд╡рди рдЪрдХреНрд░ рдкреНрд░рдмрдВрдзрди рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рдЬреЗрдирдХреАрдВрд╕ рдкрд╛рдЗрдкрд▓рд╛рдЗрди </h2><br><p>  рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХрд╛ рдЖрдпреЛрдЬрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐: </p><br><ul><li>  рдбреЙрдХрдЯрд░ рдЫрд╡рд┐ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдЕрд▓рдЧ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд░рдЦреЗрдВ </li><li>  рдкрддрд╡рд╛рд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд╕реНрдерд┐рдд рдкрддрд╡рд╛рд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рддреИрдирд╛рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </li><li>  рдПрдХ рд╣реА рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрд╕реНрдХрд░рдгрдмрджреНрдз рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдкрддрд╡рд╛рд░ рдЪрд╛рд░реНрдЯ рдореЗрдВ рд╕рдВрд╢реЛрдзрди рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ helm / setVersion.sh рдлрд╝рд╛рдЗрд▓ рд╣реИ </li></ul><br><p>  рддреЛ рд╣рдо рдЖрд╡реЗрджрди рдЬреАрд╡рди рдЪрдХреНрд░ рдХрд╛ рдкреНрд░рдмрдВрдзрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рдЬреЗрдирдХрд┐рдВрд╕рдлрд╛рдЗрд▓ рдкрд╛рдЗрдкрд▓рд╛рдЗрдиреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрд░реНрдерд╛рддреН: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рдХрд┐рд╕реА рднреА рд╡рд╛рддрд╛рд╡рд░рдг рдореЗрдВ рддреИрдирд╛рддреА</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рдХрд┐рд╕реА рднреА рд╡рд╛рддрд╛рд╡рд░рдг рд╕реЗ рд╣рдЯрд╛рдирд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рдЙрддреНрдкрд╛рджрди рдкрд░ рдордВрдЪрди рдХреЗ рд╕рд╛рде рдмрдврд╝рд╛рд╡рд╛ рджреЗрдирд╛</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рдкрд┐рдЫрд▓реЗ рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рд░реЛрд▓рдмреИрдХ</a> </li></ul><br><p>  рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рдЬреЗрдирдХрд┐рдВрд╕рдлрд╛рдЗрд▓ рдореЗрдВ, рдЖрдк рдПрдХ рддреИрдирд╛рдд рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЙрд▓ рдХреЛ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рд╣рд░ рдмрд╛рд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬрдм рдорд╛рд╕реНрдЯрд░ рд╢рд╛рдЦрд╛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд╕рдВрдХрд▓рд┐рдд рд╣реЛрддреА рд╣реИ рдпрд╛ рдЬрдм рддреИрдирд╛рддреА рд╢рд╛рдЦрд╛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдкрд░реАрдХреНрд╖рдг рд╡рд╛рддрд╛рд╡рд░рдг рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддреА рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">рдЬреЗрдирдХреАрдВрд╕ рдиреЗ рдкрд╛рдЗрдк рд▓рд╛рдЗрди рдХреЙрд▓ рдХреА рддреИрдирд╛рддреА рдХреА</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">... stage ('deploy to env') { when { expression { branch == 'master' || params.DEPLOY_BRANCH_TO_TST } } steps { build job: './../Deploy', parameters: [ [$class: 'StringParameterValue', name: 'GIT_REPO', value: 'habr-demo-app'], [$class: 'StringParameterValue', name: 'VERSION', value: revision], [$class: 'StringParameterValue', name: 'ENV', value: branch == 'master' ? 'staging' : 'test'] ], wait: false } } ...</code> </pre> </div></div><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рдпрд╣рд╛рдВ</a> рдЖрдк рд╕рднреА рдЪрд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рдЬреЗрдирдХрд┐рдВрд╕рдлрд╛рдЗрд▓ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдЪрдпрдирд┐рдд рдкрд░реАрдХреНрд╖рдг рдпрд╛ рд▓рдбрд╝рд╛рдХреВ рд╡рд╛рддрд╛рд╡рд░рдг рдкрд░ рдирд┐рд░рдВрддрд░ рддреИрдирд╛рддреА рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рдЬреЗрдирдХрд┐рдВрд╕ рдпрд╛ рдЗрд╕рдХреЗ рдИрдореЗрд▓ / рд╕реНрд▓реИрдХ / рдЖрджрд┐ рд╕реВрдЪрдирд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдХрд┐рд╕ рдПрдкреНрд▓рд┐рдХреЗрд╢рди, рдХрд┐рд╕ рд╕рдВрд╕реНрдХрд░рдг, рдХрд┐рд╕рдХреЗ рджреНрд╡рд╛рд░рд╛, рдХрдм рдФрд░ рдХрд╣рд╛рдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдХрд╛ рдСрдбрд┐рдЯ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рд╣реИред </p><br><h2 id="zaklyuchenie">  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br><p>  Jenkinsfile рдФрд░ helm рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЖрдк рдмрд╕ рдЕрдкрдиреЗ рдЖрд╡реЗрджрди рдХреЗ рд▓рд┐рдП ci / cd рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рд╡рд┐рдзрд┐ рдЙрди рдЫреЛрдЯреА рдЯреАрдореЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╣реЛ рд╕рдХрддреА рд╣реИ рдЬрд┐рдиреНрд╣реЛрдВрдиреЗ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдХреБрдмреЗрд░рдиреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ рд╣реИ рдФрд░ рдРрд╕реА рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рдЕрд╕рдорд░реНрде (рдХрд╛рд░рдг рдХреА рдкрд░рд╡рд╛рд╣ рдХрд┐рдП рдмрд┐рдирд╛) рд╣реИрдВ рдЬреЛ рдмреЙрдХреНрд╕ рд╕реЗ рдмрд╛рд╣рд░ рдЗрд╕ рддрд░рд╣ рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рдЖрдк <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рдпрд╣рд╛рдВ рдХреЗ</a> рдЬреАрд╡рди рдЪрдХреНрд░ рдХреЗ рдкреНрд░рдмрдВрдзрди рдХреЗ рд▓рд┐рдП рд╡рд╛рддрд╛рд╡рд░рдг, рдЬреЗрдирдХрд┐рдВрд╕ рдФрд░ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдЙрджрд╛рд╣рд░рдг рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рдпрд╣рд╛рдВ</a> рдЬреЗрдирдХрд┐рдВрд╕рдлрд╛рдЗрд▓ рдХреЗ рд╕рд╛рде рдПрдХ рдЙрджрд╛рд╣рд░рдг рдЖрд╡реЗрджрди рдкрд╛ рд╕рдХрддреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рд╣реИрдВ</a> ред </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi442614/">https://habr.com/ru/post/hi442614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi442602/index.html">рдХреНрдпрд╛ рд╕реНрдкреАрдб рдХрдо рд╣реЛрдиреЗ рд╕реЗ рд╕реНрдкреАрдб рдХрдо рд╣реЛ рдЬрд╛рддреА рд╣реИ?</a></li>
<li><a href="../hi442606/index.html">рд▓реЛрдореНрдмреЛрдХ рдХреЗ рд╕рд╛рде рдбреЛрдореЗрди рдСрдмреНрдЬреЗрдХреНрдЯ: рдмреИрдЯрд▓ рдХреНрд▓рд╛рд╕рд┐рдХ</a></li>
<li><a href="../hi442608/index.html">QuadrigaCX рдХреНрд░рд┐рдкреНрдЯреЛрдХрд░реЗрдВрд╕реА рдПрдХреНрд╕рдЪреЗрдВрдЬ рдХреЗ рдХреЛрд▓реНрдб рд╡реЙрд▓реЗрдЯ, рдЬрд┐рд╕рдХреЗ рд╕рдВрд╕реНрдерд╛рдкрдХ рдХреА рдореГрддреНрдпреБ рд╣реЛ рдЧрдИ, рдЦрд╛рд▓реА рд╣реЛ рдЧрдпрд╛</a></li>
<li><a href="../hi442610/index.html">рдЯреЗрд▓реАрдЧреНрд░рд╛рдо-рдмреЙрдЯ + рдЧреВрдЧрд▓ рдПрдирд╛рд▓рд┐рдЯрд┐рдХреНрд╕</a></li>
<li><a href="../hi442612/index.html">рдПрдХ рд╡рд┐рджреНрдпреБрдд рдмреЛрд░реНрдб рдЦреЗрд▓ рдХреЗ рд▓рд┐рдП рдХрд╛рд░реНрдбрдмреЛрд░реНрдб рдЗрдВрдЬрдиред рдХреИрд╕реЗ рд╣рдо рдЗрд╕реЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХрддрд╛ рдХреЗ рдХрд░реАрдм рд▓рд╛рдП</a></li>
<li><a href="../hi442616/index.html">рд╣рдо рдЗрд╡реЗрдВрдЯ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреЛ рдкреНрд░рддрд┐ рд╕реЗрдХрдВрдб 1.6 рдорд┐рд▓рд┐рдпрди рддрдХ рдмрдврд╝рд╛рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi442618/index.html">рд╕реЗрд▓реНрдлреА рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ: рдбрд┐рдЬрд┐рдЯрд▓ рдПрдВрдЬрд╛рдЗрдо-рд▓рд┐рдВрдХреНрдб рдЗрдореНрдпреБрдиреЛрд╕реЙрд░рдмреЗрдВрдЯ рдкрд░рдЦ рдПрдХ рд╕реНрдорд╛рд░реНрдЯрдлреЛрди рдореЗрдВ рдПрдореНрдмреЗрдбреЗрдб рдирдИ рдЪрд┐рдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП</a></li>
<li><a href="../hi442620/index.html">рдЖрдИрдЯреА рдХреА рдирд┐рдЧрд░рд╛рдиреА рдореЗрдВ рдорд╢реАрди рд╕реАрдЦрдирд╛</a></li>
<li><a href="../hi442622/index.html">рдПрдХрддрд╛ рдореЗрдВ рдереЛрдбрд╝рд╛ рдФрд░ рдЕрдзрд┐рдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреИрд╕реЗ рдХрд░реЗрдВ</a></li>
<li><a href="../hi442624/index.html">рдкреБрд╕реНрддрдХ "рдкрд░рдлреЗрдХреНрдЯ рдЕрд▓реНрдЧреЛрд░рд┐рдердоред рдореВрд▓ рдмрд╛рддреЗрдВ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>