<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶ã üö¨ üé° Le livre "The Way of Python. Ceinture noire pour le d√©veloppement, la mise √† l'√©chelle, les tests et le d√©ploiement ¬ª üçØ üï∫üèæ ‚ò†Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut, habrozhiteli! Le chemin Python vous permet de perfectionner vos comp√©tences professionnelles et d'en apprendre autant que possible sur les capa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Le livre "The Way of Python. Ceinture noire pour le d√©veloppement, la mise √† l'√©chelle, les tests et le d√©ploiement ¬ª</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/466027/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/kq/of/aw/kqofawsaidazmnefdopvktmtxei.jpeg" align="left" alt="image"></a>  Salut, habrozhiteli!  Le chemin Python vous permet de perfectionner vos comp√©tences professionnelles et d'en apprendre autant que possible sur les capacit√©s du langage de programmation le plus populaire.  Vous apprendrez √† √©crire du code efficace, √† cr√©er les meilleurs programmes en un minimum de temps et √† √©viter les erreurs courantes.  Il est temps de vous familiariser avec l'informatique et la m√©morisation multithread, d'obtenir des conseils d'experts dans le domaine de la conception d'API et de bases de donn√©es, ainsi que de regarder √† l'int√©rieur de Python pour approfondir votre compr√©hension du langage.  Vous devez d√©marrer un projet, travailler avec des versions, organiser des tests automatiques et choisir un style de programmation pour une t√¢che sp√©cifique.  Ensuite, vous continuerez √† √©tudier les d√©clarations de fonctions efficaces, √† s√©lectionner les structures de donn√©es et les biblioth√®ques appropri√©es, √† cr√©er des programmes et des packages sans probl√®me et √† optimiser les programmes au niveau du bytecode. <br><a name="habracut"></a><br><h3>  Extrait.  Ex√©cution de tests en parall√®le </h3><br>  L'ex√©cution des suites de tests peut prendre du temps.  Il s'agit d'un ph√©nom√®ne courant dans les grands projets lorsqu'une suite de tests prend quelques minutes.  Par d√©faut, pytest ex√©cute les tests de mani√®re s√©quentielle, dans un ordre sp√©cifique. <br><br>  √âtant donn√© que la plupart des ordinateurs ont des processeurs multic≈ìurs, vous pouvez acc√©l√©rer si vous s√©parez les tests pour les ex√©cuter sur plusieurs c≈ìurs. <br><br>  Pour cela, pytest dispose d'un plugin pytest-xdist qui peut √™tre install√© √† l'aide de pip.  Ce plugin √©tend la ligne de commande pytest avec l'argument ‚Äì‚Äìnumprocesses (abr√©g√© ‚Äìn), qui prend le nombre de c≈ìurs utilis√©s comme argument.  Le lancement de pytest ‚Äìn 4 ex√©cutera la suite de tests en quatre processus parall√®les, maintenant un √©quilibre entre la charge des c≈ìurs disponibles. <br><br>  En raison du fait que le nombre de c≈ìurs peut varier, le plugin accepte √©galement le mot cl√© auto comme valeur.  Dans ce cas, le nombre de c≈ìurs disponibles sera retourn√© automatiquement. <br><br><h3>  Cr√©ation d'objets utilis√©s dans les tests √† l'aide d'appareils </h3><br>  Lors des tests unitaires, il est souvent n√©cessaire d'effectuer un ensemble d'op√©rations standard avant et apr√®s l'ex√©cution du test, et ces instructions impliquent certains composants.  Par exemple, vous pouvez avoir besoin d'un objet qui exprimera l'√©tat de configuration de l'application, et il doit √™tre initialis√© avant chaque test, puis r√©initialis√© √† ses valeurs initiales apr√®s ex√©cution.  De m√™me, si le test d√©pend d'un fichier temporaire, ce fichier doit √™tre cr√©√© avant le test et supprim√© apr√®s.  Ces composants sont appel√©s <i>montages</i> .  Ils sont install√©s avant le test et disparaissent apr√®s son ex√©cution. <br><br>  Dans pytest, les appareils sont d√©clar√©s comme des fonctions simples.  La fonction fixture doit renvoyer l'objet souhait√© afin qu'en testant o√π il est utilis√©, cet objet puisse √™tre utilis√©. <br><br>  Voici un exemple de montage simple: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest @pytest.fixture <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">database</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &lt;some database connection&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(database)</span></span></span><span class="hljs-function">:</span></span> database.insert(<span class="hljs-number"><span class="hljs-number">123</span></span>)</code> </pre> <br>  L'appareil de base de donn√©es est automatiquement utilis√© par tout test qui a l'argument de base de donn√©es dans sa liste.  La fonction test_insert () recevra le r√©sultat de la fonction database () comme premier argument et utilisera ce r√©sultat comme bon lui semble.  Avec cette utilisation des appareils, vous n'avez pas besoin de r√©p√©ter le code d'initialisation de la base de donn√©es plusieurs fois. <br><br>  Une autre caract√©ristique commune des tests de code est la possibilit√© de supprimer le superflu apr√®s l'op√©ration du luminaire.  Par exemple, fermez la connexion √† la base de donn√©es.  L'impl√©mentation du luminaire en tant que g√©n√©rateur ajoutera des fonctionnalit√©s pour nettoyer les objets v√©rifi√©s (Listing 6.5). <br><br><blockquote><h4>  Listing 6.5.  Effacement d'un objet v√©rifi√© </h4><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest @pytest.fixture <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">database</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> db = &lt;some database connection&gt; <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> db db.close() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(database)</span></span></span><span class="hljs-function">:</span></span> database.insert(<span class="hljs-number"><span class="hljs-number">123</span></span>)</code> </pre> </blockquote>  Puisque nous avons utilis√© le mot-cl√© yield et cr√©√© un g√©n√©rateur √† partir de la base de donn√©es, le code apr√®s l'instruction yield n'est ex√©cut√© qu'√† la fin du test.  Ce code fermera la connexion √† la base de donn√©es √† la fin du test. <br><br>  La fermeture de la connexion √† la base de donn√©es pour chaque test peut entra√Æner un gaspillage injustifi√© de la puissance de calcul, car d'autres tests peuvent utiliser une connexion d√©j√† ouverte.  Dans ce cas, vous pouvez passer l'argument scope au d√©corateur de luminaire, en sp√©cifiant sa port√©e: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest @pytest.fixture(scope=<span class="hljs-string"><span class="hljs-string">"module"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">database</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> db = &lt;some database connection&gt; <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> db db.close() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(database)</span></span></span><span class="hljs-function">:</span></span> database.insert(<span class="hljs-number"><span class="hljs-number">123</span></span>)</code> </pre> <br>  En sp√©cifiant le param√®tre scope = "module", vous avez initialis√© le luminaire une fois pour l'ensemble du module, et maintenant une connexion de base de donn√©es ouverte sera disponible pour toutes les fonctions de test qui le demandent. <br><br>  Vous pouvez ex√©cuter du code g√©n√©ral avant ou apr√®s le test, en d√©finissant les appareils comme utilis√©s automatiquement avec le mot-cl√© autouse, plut√¥t que de les sp√©cifier comme argument pour chaque fonction de test.  Concr√©tiser la fonction pytest.fixture () √† l'aide de l'argument True, le mot cl√© autouse, garantit que les fixtures sont appel√©es √† chaque fois avant d'ex√©cuter le test dans le module ou la classe o√π il est d√©clar√©. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest @pytest.fixture(autouse=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">change_user_env</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> curuser = os.environ.get(<span class="hljs-string"><span class="hljs-string">"USER"</span></span>) os.environ[<span class="hljs-string"><span class="hljs-string">"USER"</span></span>] = <span class="hljs-string"><span class="hljs-string">"foobar"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> os.environ[<span class="hljs-string"><span class="hljs-string">"USER"</span></span>] = curuser <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_user</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> os.getenv(<span class="hljs-string"><span class="hljs-string">"USER"</span></span>) == <span class="hljs-string"><span class="hljs-string">"foobar"</span></span>&lt;/source     .  ,    :     ,      ,       . &lt;h3&gt;  &lt;/h3&gt;           ,    ,   ,         .          Gnocchi,    . Gnocchi      &lt;i&gt;storage API&lt;/i&gt;.    Python          .       ,      API   .        ,      (    storage API),  ,       .   ,   &lt;i&gt; &lt;/i&gt;,     ,        .  <span class="hljs-number"><span class="hljs-number">6.6</span></span>          ,    :    mysql,   ‚Äî  postgresql. &lt;blockquote&gt;&lt;h4&gt; <span class="hljs-number"><span class="hljs-number">6.6</span></span>.      &lt;/h4&gt; &lt;source lang=<span class="hljs-string"><span class="hljs-string">"python"</span></span>&gt;<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> myapp @pytest.fixture(params=[<span class="hljs-string"><span class="hljs-string">"mysql"</span></span>, <span class="hljs-string"><span class="hljs-string">"postgresql"</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">database</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> d = myapp.driver(request.param) d.start() <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> d d.stop() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(database)</span></span></span><span class="hljs-function">:</span></span> database.insert(<span class="hljs-string"><span class="hljs-string">"somedata"</span></span>)</code> </pre>  Le dispositif de pilote re√ßoit deux valeurs diff√©rentes en tant que param√®tre - les noms des pilotes de base de donn√©es pris en charge par l'application.  test_insert est ex√©cut√© deux fois: une fois pour la base de donn√©es MySQL et la seconde pour la base de donn√©es PostgreSQL.  Cela permet de reprendre facilement le m√™me test, mais avec des sc√©narios diff√©rents, sans ajouter de nouvelles lignes de code. <br><br><h3>  Tests g√©r√©s avec des objets factices </h3><br>  Les objets factices (ou stubs, objets fantaisie) sont des objets qui imitent le comportement des objets d'application r√©els, mais dans un √©tat contr√¥l√© sp√©cial.  Ils sont tr√®s utiles pour cr√©er des environnements qui d√©crivent en d√©tail les conditions du test.  Vous pouvez remplacer tous les objets √† l'exception de celui test√© par des objets factices et les isoler, ainsi que cr√©er un environnement pour les tests de code. <br><br>  Un cas d'utilisation consiste √† cr√©er un client HTTP.  Il est presque impossible (ou plut√¥t incroyablement difficile) de cr√©er un serveur HTTP sur lequel vous pouvez ex√©cuter toutes les situations et sc√©narios pour chaque valeur possible.  Les clients HTTP sont particuli√®rement difficiles √† tester pour les sc√©narios d'erreur. <br><br>  La biblioth√®que standard poss√®de une commande simul√©e pour cr√©er un objet factice.  √Ä partir de Python 3.3, mock a √©t√© int√©gr√© √† la biblioth√®que unittest.mock.  Par cons√©quent, vous pouvez utiliser l'extrait de code ci-dessous pour fournir une compatibilit√© descendante entre Python 3.3 et versions ant√©rieures: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ImportError: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock</code> </pre> <br>  La biblioth√®que fictive est tr√®s facile √† utiliser.  Tout attribut disponible pour l'objet mock.Mock est cr√©√© dynamiquement lors de l'ex√©cution.  N'importe quel attribut peut recevoir n'importe quelle valeur.  Dans le Listing 6.7, mock est utilis√© pour cr√©er un objet factice pour l'attribut factice. <br><blockquote><h4>  Listing 6.7.  Acc√®s √† l'attribut mock.Mock </h4><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock &gt;&gt;&gt; m = mock.Mock() &gt;&gt;&gt; m.some_attribute = <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> &gt;&gt;&gt; m.some_attribute <span class="hljs-string"><span class="hljs-string">"hello world"</span></span></code> </pre> </blockquote>  Vous pouvez √©galement cr√©er dynamiquement une m√©thode pour un objet mutable, comme dans l'extrait 6.8, o√π vous cr√©ez une m√©thode factice qui renvoie toujours 42 et prend tout ce que vous voulez comme argument. <br><blockquote><h4>  Listing 6.8.  Cr√©ation d'une m√©thode pour l'objet factice mock.Mock </h4><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock &gt;&gt;&gt; m = mock.Mock() &gt;&gt;&gt; m.some_method.return_value = <span class="hljs-number"><span class="hljs-number">42</span></span> &gt;&gt;&gt; m.some_method() <span class="hljs-number"><span class="hljs-number">42</span></span> &gt;&gt;&gt; m.some_method(<span class="hljs-string"><span class="hljs-string">"with"</span></span>, <span class="hljs-string"><span class="hljs-string">"arguments"</span></span>) <span class="hljs-number"><span class="hljs-number">42</span></span></code> </pre> </blockquote>  Juste quelques lignes, et l'objet mock.Mock a maintenant une m√©thode some_method (), qui retourne 42. Il prend n'importe quel type d'argument, alors qu'il n'y a aucune v√©rification de ce qu'est l'argument. <br><br>  Les m√©thodes g√©n√©r√©es dynamiquement peuvent √©galement avoir des effets secondaires (intentionnels).  Afin de ne pas √™tre uniquement des m√©thodes passe-partout qui renvoient une valeur, elles peuvent √™tre d√©finies pour ex√©cuter du code utile. <br><br>  Le Listing 6.9 cr√©e une m√©thode factice qui a un effet secondaire - il affiche la cha√Æne ¬´hello world¬ª. <br><blockquote><h4>  Listing 6.9.  Cr√©ation d'une m√©thode pour un objet mock.Mock avec un effet secondaire </h4><br><pre> <code class="python hljs"> &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock &gt;&gt;&gt; m = mock.Mock() &gt;&gt;&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print_hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... print(<span class="hljs-string"><span class="hljs-string">"hello world!"</span></span>) ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">43</span></span> ... ‚ù∂ &gt;&gt;&gt; m.some_method.side_effect = print_hello &gt;&gt;&gt; m.some_method() hello world! <span class="hljs-number"><span class="hljs-number">43</span></span> ‚ù∑ &gt;&gt;&gt; m.some_method.call_count <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> </blockquote>  Nous avons affect√© une fonction enti√®re √† l'attribut some_method ‚ù∂.  Techniquement, cela vous permet d'impl√©menter un sc√©nario plus complexe dans le test, car vous pouvez inclure tout code n√©cessaire au test dans l'objet factice.  Ensuite, vous devez passer cet objet √† la fonction qui l'attend. <br><br>  L'attribut ‚ù∑ call_count est un moyen simple de v√©rifier le nombre de fois qu'une m√©thode a √©t√© appel√©e. <br><br>  La biblioth√®que fictive utilise le mod√®le ¬´action-check¬ª: cela signifie qu'apr√®s le test, vous devez vous assurer que les actions remplac√©es par des mannequins ont √©t√© effectu√©es correctement.  Le listing 6.10 applique la m√©thode assert () aux objets factices pour effectuer ces v√©rifications. <br><blockquote><h4>  Listing 6.10.  M√©thodes de v√©rification des appels </h4><br><pre> <code class="python hljs"> &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock &gt;&gt;&gt; m = mock.Mock() ‚ù∂ &gt;&gt;&gt; m.some_method(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'bar'</span></span>) &lt;Mock name=<span class="hljs-string"><span class="hljs-string">'mock.some_method()'</span></span> id=<span class="hljs-string"><span class="hljs-string">'26144272'</span></span>&gt; ‚ù∑ &gt;&gt;&gt; m.some_method.assert_called_once_with(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'bar'</span></span>) &gt;&gt;&gt; m.some_method.assert_called_once_with(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, ‚ù∏mock.ANY) &gt;&gt;&gt; m.some_method.assert_called_once_with(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'baz'</span></span>) Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; File <span class="hljs-string"><span class="hljs-string">"/usr/lib/python2.7/dist-packages/mock.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">846</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> assert_cal led_once_with <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.assert_called_with(*args, **kwargs) File <span class="hljs-string"><span class="hljs-string">"/usr/lib/python2.7/dist-packages/mock.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">835</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> assert_cal led_with <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> AssertionError(msg) AssertionError: Expected call: some_method(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'baz'</span></span>) Actual call: some_method(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'bar'</span></span>)</code> </pre> </blockquote>  Nous avons cr√©√© des m√©thodes avec des arguments foo et bar comme tests en appelant la m√©thode ‚ù∂.  Un moyen facile de tester les appels aux objets factices consiste √† utiliser les m√©thodes assert_called (), telles que assert_called_once_with () ‚ù∑.  Pour ces m√©thodes, vous devez transmettre les valeurs que vous pr√©voyez d'utiliser lors de l'appel de la m√©thode factice.  Si les valeurs transmises diff√®rent de celles utilis√©es, mock d√©clenche une exception AssertionError.  Si vous ne savez pas quels arguments peuvent √™tre transmis, utilisez mock.ANY comme valeur de ‚ù∏;  il remplacera tout argument pass√© √† la m√©thode factice. <br><br>  La biblioth√®que fictive peut √©galement √™tre utilis√©e pour remplacer une fonction, une m√©thode ou un objet d'un module externe.  Dans l'extrait 6.11, nous avons remplac√© la fonction os.unlink () par notre propre fonction factice. <br><blockquote><h4>  Listing 6.11.  Utilisation de mock.patch </h4><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os &gt;&gt;&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fake_os_unlink</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> IOError(<span class="hljs-string"><span class="hljs-string">"Testing!"</span></span>) ... &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> mock.patch(<span class="hljs-string"><span class="hljs-string">'os.unlink'</span></span>, fake_os_unlink): ... os.unlink(<span class="hljs-string"><span class="hljs-string">'foobar'</span></span>) ... Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fake_os_unlink IOError: Testing!</code> </pre> </blockquote>  Lorsqu'il est utilis√© comme gestionnaire de contexte, mock.patch () remplace la fonction cible par celle que nous s√©lectionnons.  Cela est n√©cessaire pour que le code ex√©cut√© dans le contexte utilise la m√©thode corrig√©e.  En utilisant la m√©thode mock.patch (), vous pouvez modifier n'importe quelle partie du code externe, le for√ßant √† se comporter de mani√®re √† tester toutes les conditions de l'application (Listing 6.12). <br><blockquote><h4>  Listing 6.12.  Utilisation de mock.patch () pour tester de nombreux comportements </h4><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WhereIsPythonError</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Exception)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> ‚ù∂ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_python_still_a_programming_language</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: r = requests.get(<span class="hljs-string"><span class="hljs-string">"http://python.org"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> IOError: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r.status_code == <span class="hljs-number"><span class="hljs-number">200</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Python is a programming language'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> r.content <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> WhereIsPythonError(<span class="hljs-string"><span class="hljs-string">"Something bad happened"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_fake_get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(status_code, content)</span></span></span><span class="hljs-function">:</span></span> m = mock.Mock() m.status_code = status_code m.content = content <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fake_get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fake_get <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">raise_get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> IOError(<span class="hljs-string"><span class="hljs-string">"Unable to fetch url %s"</span></span> % url) ‚ù∑ @mock.patch(<span class="hljs-string"><span class="hljs-string">'requests.get'</span></span>, get_fake_get( <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">'Python is a programming language for sure'</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_python_is</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> is_python_still_a_programming_language() <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> @mock.patch(<span class="hljs-string"><span class="hljs-string">'requests.get'</span></span>, get_fake_get( <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">'Python is no more a programming language'</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_python_is_not</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> is_python_still_a_programming_language() <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> @mock.patch(<span class="hljs-string"><span class="hljs-string">'requests.get'</span></span>, get_fake_get(<span class="hljs-number"><span class="hljs-number">404</span></span>, <span class="hljs-string"><span class="hljs-string">'Whatever'</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_bad_status_code</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(WhereIsPythonError): is_python_still_a_programming_language() @mock.patch(<span class="hljs-string"><span class="hljs-string">'requests.get'</span></span>, raise_get) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_ioerror</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(WhereIsPythonError): is_python_still_a_programming_language()</code> </pre> </blockquote><br><br>  Le listing 6.12 impl√©mente un cas de test qui recherche toutes les instances de <i>Python est une cha√Æne de langage de programmation</i> sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">python.org</a> ‚ù∂.  Il n'y a pas d'option o√π le test ne trouvera aucune ligne donn√©e sur la page Web s√©lectionn√©e.  Pour obtenir un r√©sultat n√©gatif, vous devez modifier la page, mais cela ne peut pas √™tre fait.  Mais √† l'aide de mock, vous pouvez passer √† l'astuce et modifier le comportement de la demande afin qu'elle renvoie une r√©ponse fictive avec une page fictive qui ne contient pas de cha√Æne donn√©e.  Cela vous permettra de tester un sc√©nario n√©gatif dans lequel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">python.org</a> ne contient pas de cha√Æne donn√©e et de vous assurer que le programme g√®re correctement un tel cas. <br><br>  Cet exemple utilise la version d√©coratrice mock.patch () .  Le comportement de l'objet factice ne change pas, et il √©tait plus facile de d√©finir un exemple dans le contexte d'une fonction de test. <br><br>  L'utilisation d'un objet factice permet de simuler tout probl√®me: le serveur renvoie une erreur 404, une erreur d'E / S ou une erreur de retard r√©seau.  Nous pouvons nous assurer que le code renvoie les valeurs correctes ou l√®ve la bonne exception dans chaque cas, ce qui garantit le comportement attendu du code. <br><br><h3>  Identifier le code non test√© avec la couverture </h3><br>  L'outil de couverture est un excellent ajout aux tests unitaires. [La couverture par code est une mesure utilis√©e dans les tests.  Affiche le pourcentage du code source du programme qui a √©t√© ex√©cut√© pendant le processus de test - <i>ed.</i>  ], qui trouve des morceaux de code non test√©s.  Il utilise des outils d'analyse et de suivi de code pour identifier les lignes qui ont √©t√© ex√©cut√©es.  Lors des tests unitaires, il peut r√©v√©ler quelles parties du code ont √©t√© r√©utilis√©es et lesquelles n'ont pas √©t√© utilis√©es du tout.  La cr√©ation de tests est n√©cessaire, et la possibilit√© de d√©couvrir quelle partie du code vous avez oubli√© de couvrir avec des tests rend ce processus plus agr√©able. <br><br>  Installez le module de couverture via pip pour pouvoir l'utiliser √† travers votre shell. <br><br><blockquote><h4>  REMARQUE </h4><br>  La commande peut √©galement √™tre appel√©e couverture python si le module est install√© via le programme d'installation de votre syst√®me d'exploitation.  Un exemple de ceci est le syst√®me d'exploitation Debian. </blockquote><br><br>  L'utilisation de la couverture hors ligne est assez simple.  Il montre les parties du programme qui ne d√©marrent jamais et deviennent un "poids mort" - un code tel que vous ne pouvez pas le supprimer sans modifier la fonctionnalit√© du programme.  Tous les outils de test abord√©s pr√©c√©demment dans le chapitre sont int√©gr√©s √† la couverture. <br><br>  Lorsque vous utilisez pytest, installez le plugin pytest-cov via pip install pytest-pycov et ajoutez quelques commutateurs pour g√©n√©rer une sortie d√©taill√©e du code non test√© (Listing 6.13). <br><blockquote><h4>  Listing 6.13.  Utilisation de pytest et de la couverture </h4><br><pre> <code class="python hljs">$ pytest --cov=gnocchiclient gnocchiclient/tests/unit ---------- coverage: platform darwin, python <span class="hljs-number"><span class="hljs-number">3.6</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>-final<span class="hljs-number"><span class="hljs-number">-0</span></span> ----------- Name Stmts Miss Branch BrPart Cover --------------------------- gnocchiclient/__init__.py <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span>% gnocchiclient/auth.py <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span>% gnocchiclient/benchmark.py <span class="hljs-number"><span class="hljs-number">175</span></span> <span class="hljs-number"><span class="hljs-number">175</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% --snip-- --------------------------- TOTAL <span class="hljs-number"><span class="hljs-number">2040</span></span> <span class="hljs-number"><span class="hljs-number">1868</span></span> <span class="hljs-number"><span class="hljs-number">424</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>% === passed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">5.00</span></span> seconds ===</code> </pre> </blockquote>  L'option --cov permet la sortie du rapport de couverture √† la fin du test.  Vous devez passer le nom du package comme argument pour que le plug-in filtre correctement le rapport.  La sortie contiendra des lignes de code qui n'ont pas √©t√© ex√©cut√©es, ce qui signifie qu'elles n'ont pas √©t√© test√©es.  Il ne vous reste plus qu'√† ouvrir l'√©diteur et √† √©crire un test pour ce code. <br><br>  Le module de couverture est encore meilleur - il vous permet de g√©n√©rer des rapports clairs au format HTML.  Ajoutez simplement -‚Äìcov-report-html et les pages HTML appara√Ætront dans le r√©pertoire <i>htmlcov √†</i> partir duquel vous ex√©cutez la commande.  Chaque page montrera quelles parties du code source √©taient ou n'√©taient pas en cours d'ex√©cution. <br><br>  Si vous voulez aller encore plus loin, utilisez ‚Äì-cover-fail-under-COVER_MIN_PERCENTAGE, ce qui entra√Ænera l'√©chec de la suite de tests si elle ne couvre pas le pourcentage minimum de code.  Bien qu'un grand pourcentage de couverture soit un bon objectif et que les outils de test soient utiles pour obtenir des informations sur l'√©tat de la couverture de test, le pourcentage en soi n'est pas tr√®s informatif.  La figure 6.1 montre un exemple de rapport de couverture montrant le pourcentage de couverture. <br><br>  Par exemple, couvrir le code avec des tests √† 100% est un objectif louable, mais cela ne signifie pas n√©cessairement que le code est enti√®rement test√©.  Cette valeur indique uniquement que toutes les lignes de code du programme sont remplies, mais n'indique pas que toutes les conditions ont √©t√© test√©es. <br><br>  Il est utile d'utiliser les informations de couverture pour √©tendre la suite de tests et les cr√©er pour du code qui ne s'ex√©cute pas.  Cela simplifie la prise en charge du projet et am√©liore la qualit√© globale du code. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/d_/af/vl/d_afvlajlx_9ctds7yfu7ef_2ds.png" alt="image"></div><br><br><h3>  √Ä propos de l'auteur </h3><br>  <i>Julien Danju</i> pirate le freeware depuis une vingtaine d'ann√©es et d√©veloppe des programmes Python depuis pr√®s de douze ans.  Il dirige actuellement l'√©quipe de conception de la plateforme cloud distribu√©e bas√©e sur OpenStack, qui poss√®de la plus grande base de donn√©es open source Python existante, avec environ deux millions et demi de lignes de code.  Avant de d√©velopper des services cloud, Julien a cr√©√© le gestionnaire de fen√™tres et a contribu√© au d√©veloppement de nombreux projets, tels que Debian et GNU Emacs. <br><br><h3>  √Ä propos de Science Editor </h3><br>  <i>Mike Driscoll</i> programme en Python depuis plus d'une d√©cennie.  Pendant longtemps, il a √©crit sur Python on <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The Mouse vs.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le Python</a> .  Auteur de plusieurs livres sur Python: Python 101, Python Interviews et ReportLab: PDF Processingwith Python.  Vous pouvez trouver Mike sur Twitter et sur GitHub: @driscollis. <br><br>  ¬ªPlus d'informations sur le livre sont disponibles sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le site Web de l'√©diteur</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Contenu</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Extrait</a> <br><br>  25% de r√©duction sur les colporteurs - <b>Python</b> <br><br>  Lors du paiement de la version papier du livre, un livre √©lectronique est envoy√© par e-mail. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr466027/">https://habr.com/ru/post/fr466027/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr466001/index.html">"Mobile" Feng Shui, ou on dort correctement (caf√©, cafards et intol√©rances sur Habr√©)</a></li>
<li><a href="../fr466015/index.html">Un peu plus sur la trigonom√©trie en informatique</a></li>
<li><a href="../fr466017/index.html">Livy - le maillon manquant de la cha√Æne Hadoop Spark Airflow Python</a></li>
<li><a href="../fr466019/index.html">ABBYY Mobile Web Capture: des photos de documents de haute qualit√© directement dans le navigateur de votre smartphone</a></li>
<li><a href="../fr466021/index.html">Comment j'ai appris √† Yandex Alice √† parler de jouets sexuels</a></li>
<li><a href="../fr466029/index.html">Comment transformer un ordinateur quantique en un g√©n√©rateur de nombres al√©atoires parfait</a></li>
<li><a href="../fr466031/index.html">La mission √©pique de DeepMind pour r√©soudre le probl√®me scientifique le plus complexe</a></li>
<li><a href="../fr466033/index.html">Comment attirer une √©quipe dans le processus de recherche d'id√©es et obtenir bien plus que des id√©es</a></li>
<li><a href="../fr466039/index.html">Biblioth√®ques PHP pour le commerce √©lectronique: travailler avec ATOL et Payture, analyser les codes GS1 et autres t√¢ches</a></li>
<li><a href="../fr466041/index.html">Le premier √©v√©nement hors ligne du Facebook Developer Circle: la communaut√© de Moscou - Launch Event</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>