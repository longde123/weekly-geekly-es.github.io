<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¦ğŸ¼ ğŸ‘¨â€ğŸŒ¾ ğŸ§™ğŸ¼ Bagilah Laravel menjadi beberapa komponen ğŸ‘ˆğŸ¿ ğŸ‘ğŸ» ğŸ¤¦</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hai, Habr. Baru-baru ini saya mendapatkan proyek yang menarik, yang, meskipun sederhana, menuntut untuk tidak menggunakan kerangka kerja apa pun. Tida...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagilah Laravel menjadi beberapa komponen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475144/"><p> Hai, Habr.  Baru-baru ini saya mendapatkan proyek yang menarik, yang, meskipun sederhana, menuntut untuk tidak menggunakan kerangka kerja apa pun.  Tidak ada pembicaraan tentang paket, jadi diputuskan untuk menggunakan komponen Laravel yang biasa.  Jika Anda perlu menggunakan antrian, Eloquent atau wadah - selamat datang di kucing. </p><a name="habracut"></a><br><h2 id="o-prostote-deleniya-freymvorka-na-komponenty">  Pada kesederhanaan membagi kerangka kerja menjadi komponen </h2><br><p>  Dimulai dengan Laravel 4, semua komponen adalah paket terpisah, yang secara teori dapat dibuat untuk bekerja dalam proyek PHP apa pun.  Namun, beberapa komponen memerlukan penyesuaian tambahan, yang dalam kerangka utama disembunyikan di bawah tenda. </p><br><h2 id="komponenty">  Komponen </h2><br><h3 id="konteyner">  Wadah </h3><br><p> Dari semua komponen yang dipertimbangkan, <code>illuminate/container</code> adalah yang termudah untuk diinstal dan digunakan. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Container</span></span>\<span class="hljs-title"><span class="hljs-title">Container</span></span>; $container = Container::getInstance(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $container-&gt;make(Foo::class);</code> </pre> <br><p>  Namun, memanggil metode statis pada kelas <code>Container</code> setiap kali Anda menggunakan sebuah wadah bukanlah ide yang baik.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code> app()</code></a> tersedia dalam kerangka kerja, yang akan mengembalikan instance kontainer global kepada kami, namun, kami perlu membuat satu secara manual. </p><br><p>  Buat file <code>helpers.php</code> untuk helpers tersebut, dan tambahkan ke startup. </p><br><pre> <code class="plaintext hljs">"autoload": { "files": [ "src/helpers.php" ], "psr-4": { "YourApp\\": "src/" } }</code> </pre> <br><p>  Tambahkan pembantu <code>app()</code> ke file. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Container</span></span>\<span class="hljs-title"><span class="hljs-title">Container</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (! function_exists(<span class="hljs-string"><span class="hljs-string">'app'</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">/** * Get the available container instance. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string|null $abstract * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $parameters * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> mixed|\Illuminate\Container\Container */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">app</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($abstract = null, array $parameters = [])</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_null($abstract)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Container::getInstance(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Container::getInstance()-&gt;make($abstract, $parameters); } }</code> </pre> <br><p>  Selesai  Anda dapat mencoba menggunakan pembantu. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> app(Foo::class);</code> </pre> <br><h3 id="query-builder-i-eloquent">  Pembuat Kueri dan Eloquent </h3><br><p>  Untuk menggunakan komponen <code>illuminate/database</code> , kami akan menggunakan <code>Capsule\Manager</code> , kelas yang dirancang untuk bekerja dengan pembuat kueri di luar Laravel. </p><br><p>  Mari kita mulai dengan mengatur koneksi ke database.  Dianjurkan untuk melakukan konfigurasi ini pada tahap permulaan aplikasi Anda, segera setelah menghubungkan <code>autoload.php</code> . </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.<span class="hljs-string"><span class="hljs-string">'/../vendor/autoload.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Capsule</span></span>\<span class="hljs-title"><span class="hljs-title">Manager</span></span>; $manager = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Manager; $manager-&gt;addConnection([ <span class="hljs-string"><span class="hljs-string">'driver'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'mysql'</span></span>, <span class="hljs-string"><span class="hljs-string">'host'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>, <span class="hljs-string"><span class="hljs-string">'database'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'database'</span></span>, <span class="hljs-string"><span class="hljs-string">'username'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'root'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'password'</span></span>, <span class="hljs-string"><span class="hljs-string">'charset'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'utf8'</span></span>, <span class="hljs-string"><span class="hljs-string">'collation'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'utf8_unicode_ci'</span></span>, <span class="hljs-string"><span class="hljs-string">'prefix'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, ]); <span class="hljs-comment"><span class="hljs-comment">//        Capsule. $manager-&gt;setAsGlobal();</span></span></code> </pre> <br><p>  Anda bisa memulai dengan pembuat kueri. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Capsule</span></span>\<span class="hljs-title"><span class="hljs-title">Manager</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Manager::table(<span class="hljs-string"><span class="hljs-string">'orders'</span></span>)-&gt;get();</code> </pre> <br><p>  Bagaimana dengan Eloquent? </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">YourApp</span></span>\<span class="hljs-title"><span class="hljs-title">Models</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Eloquent</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Order</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $fillable = [ <span class="hljs-string"><span class="hljs-string">'name'</span></span>, ]; }</code> </pre> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">YourApp</span></span>\<span class="hljs-title"><span class="hljs-title">Models</span></span>\<span class="hljs-title"><span class="hljs-title">Order</span></span>; Order::first();</code> </pre> <br><p>  Situasinya lebih rumit dengan migrasi - di satu sisi, ada Pembuat Skema dalam kit.  Di sisi lain, tidak ada mekanisme otomatis untuk memulai migrasi. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Capsule</span></span>\<span class="hljs-title"><span class="hljs-title">Manager</span></span>; Manager::schema()-&gt;create(<span class="hljs-string"><span class="hljs-string">'orders'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($table)</span></span></span><span class="hljs-function"> </span></span>{ $table-&gt;bigIncrements(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">'name'</span></span>); $table-&gt;timestamps(); });</code> </pre> <br><p>  Untuk memulai, cukup jalankan file dengan migrasi: <code>php migration.php</code> </p><br><h3 id="ocheredi">  Antrian </h3><br><p>  Antrian juga memiliki <code>Capsule</code> sendiri, namun analog dari <code>queue:work</code> dan <code>queue:listen</code> harus ditulis secara manual. </p><br><p>  Mari kita mulai dengan kelas <code>Application</code> .  Di Laravel, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kelas ini</a> digunakan sebagai instance kontainer global, yang, selain metode <code>Illuminate\Container\Container</code> , berisi metode bantu untuk bekerja dengan kerangka kerja (versi saat ini, jalur penyimpanan, sumber daya).  Namun, kelas kami hanya akan berisi satu metode - <code>isDownForMaintenance</code> .  Ini diperlukan untuk pekerjaan pekerja, karena menentukan keadaan aplikasi saat ini. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">YourApp</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Container</span></span>\<span class="hljs-title"><span class="hljs-title">Container</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Container</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isDownForMaintenance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }</code> </pre> <br><p>  Selanjutnya, kita perlu mendaftarkan penyedia <code>illuminate/events</code> , dan mengikat <code>Illuminate\Contracts\Events\Dispatcher</code> ke alias <code>events</code> . </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">YourApp</span></span>\<span class="hljs-title"><span class="hljs-title">Application</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Contracts</span></span>\<span class="hljs-title"><span class="hljs-title">Events</span></span>\<span class="hljs-title"><span class="hljs-title">Dispatcher</span></span>; $application = Application::getInstance(); $application-&gt;bind(Dispatcher::class, <span class="hljs-string"><span class="hljs-string">'events'</span></span>);</code> </pre> <br><p>  Sekarang Anda perlu membuat instance <code>Capsule</code> , dan menambahkan konfigurasi koneksi di sana. </p><br><p>  <strong>Contoh konfigurasi untuk database</strong> </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">YourApp</span></span>\<span class="hljs-title"><span class="hljs-title">Application</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Queue</span></span>\<span class="hljs-title"><span class="hljs-title">Capsule</span></span>\<span class="hljs-title"><span class="hljs-title">Manager</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Capsule</span></span>\<span class="hljs-title"><span class="hljs-title">Manager</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">DB</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">ConnectionResolver</span></span>; $container = Application::getInstance(); $queue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Manager($container); $queue-&gt;addConnection([ <span class="hljs-string"><span class="hljs-string">'driver'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'database'</span></span>, <span class="hljs-string"><span class="hljs-string">'table'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'jobs'</span></span>, <span class="hljs-string"><span class="hljs-string">'connection'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, <span class="hljs-string"><span class="hljs-string">'queue'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, ], <span class="hljs-string"><span class="hljs-string">'default'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ,    Illuminate\Database\Capsule\Manager       $queue-&gt;setAsGlobal(); $connection = Capsule::schema()-&gt;getConnection(); $resolver = new ConnectionResolver(['default' =&gt; $connection]); $queue-&gt;getQueueManager()-&gt;addConnector('database', function () use ($resolver) { return new DatabaseConnector($resolver); });</span></span></code> </pre> <br><p>  <strong>Contoh konfigurasi untuk Redis (memerlukan <code>illuminate/redis</code> )</strong> </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Redis</span></span>\<span class="hljs-title"><span class="hljs-title">RedisManager</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Queue</span></span>\<span class="hljs-title"><span class="hljs-title">Capsule</span></span>\<span class="hljs-title"><span class="hljs-title">Manager</span></span>; $container-&gt;bind(<span class="hljs-string"><span class="hljs-string">'redis'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($container)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RedisManager($container, <span class="hljs-string"><span class="hljs-string">'predis'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'default'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'host'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'port'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6379</span></span>, <span class="hljs-string"><span class="hljs-string">'database'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, ] ]); }); $queue = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Manager($container); $queue-&gt;addConnection([ <span class="hljs-string"><span class="hljs-string">'driver'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'redis'</span></span>, <span class="hljs-string"><span class="hljs-string">'connection'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, <span class="hljs-string"><span class="hljs-string">'queue'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'default'</span></span>, ], <span class="hljs-string"><span class="hljs-string">'default'</span></span>); $queue-&gt;setAsGlobal();</code> </pre> <br><p>  Langkah terakhir dalam konfigurasi adalah menambahkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pengecualian</a> Analog. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Contracts</span></span>\<span class="hljs-title"><span class="hljs-title">Debug</span></span>\<span class="hljs-title"><span class="hljs-title">ExceptionHandler</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Handler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExceptionHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">report</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Exception $e)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ,  Exception     . // :   Sentry,    . } public function render($request, Exception $e) { //   } public function renderForConsole($output, Exception $e) { //  ,     -  } public function shouldReport(\Exception $e) { //      } } app()-&gt;bind('exception.handler', function () { return new Handler; });</span></span></code> </pre> <br><p>  Konfigurasi antrian selesai.  Sekarang Anda dapat mulai menulis <code>queue:work</code> . </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.<span class="hljs-string"><span class="hljs-string">'/bootstrap/bootstrap.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Queue</span></span>\<span class="hljs-title"><span class="hljs-title">Worker</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Queue</span></span>\<span class="hljs-title"><span class="hljs-title">Capsule</span></span>\<span class="hljs-title"><span class="hljs-title">Manager</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Queue</span></span>\<span class="hljs-title"><span class="hljs-title">WorkerOptions</span></span>; $queueManager = Manager::getQueueManager(); $worker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Worker($queueManager, app(<span class="hljs-string"><span class="hljs-string">'events'</span></span>), app(<span class="hljs-string"><span class="hljs-string">'exception.handler'</span></span>)); $worker-&gt;daemon(<span class="hljs-string"><span class="hljs-string">'default'</span></span>, <span class="hljs-string"><span class="hljs-string">'default'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WorkerOptions);</code> </pre> <br><p>  Sekarang untuk memulai pekerja antrian, cukup tulis <code>php worker.php</code> . </p><br><p>  Jika perlu menggunakan <code>queue:listen</code> , maka Anda perlu membuat dua file terpisah.  Salah satunya adalah daemon yang mendengarkan antrian dan menjalankan file kedua di setiap pekerjaan baru.  File kedua, pada gilirannya, bertindak sebagai pelaksana tugas. </p><br><p>  <strong>pekerja.php</strong> </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.<span class="hljs-string"><span class="hljs-string">'/bootstrap/bootstrap.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Queue</span></span>\<span class="hljs-title"><span class="hljs-title">Listener</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Queue</span></span>\<span class="hljs-title"><span class="hljs-title">ListenerOptions</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,   " ",  Laravel  artisan,        work.php. // https://github.com/laravel/framework/blob/6.x/src/Illuminate/Queue/Listener.php#L72 define('ARTISAN_BINARY', 'work.php'); $worker = app(Listener::class, ['commandPath' =&gt; __DIR__]); $worker-&gt;setOutputHandler(function ($type, $line) { echo $line; }); $worker-&gt;listen('default', 'default', new ListenerOptions);</span></span></code> </pre> <br><p>  <strong>work.php</strong> </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'bootstrap/bootstrap.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Queue</span></span>\<span class="hljs-title"><span class="hljs-title">Worker</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Queue</span></span>\<span class="hljs-title"><span class="hljs-title">WorkerOptions</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Queue</span></span>\<span class="hljs-title"><span class="hljs-title">Capsule</span></span>\<span class="hljs-title"><span class="hljs-title">Manager</span></span>; $queueManager = Manager::getQueueManager(); $worker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Worker($queueManager, app(<span class="hljs-string"><span class="hljs-string">'events'</span></span>), app(<span class="hljs-string"><span class="hljs-string">'exception.handler'</span></span>)); $worker-&gt;runNextJob(<span class="hljs-string"><span class="hljs-string">'default'</span></span>, <span class="hljs-string"><span class="hljs-string">'default'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WorkerOptions);</code> </pre> <br><p>  Kami lulus untuk digunakan.  Semua metode dapat dilihat di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">API.</a> </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Queue</span></span>\<span class="hljs-title"><span class="hljs-title">Capsule</span></span>\<span class="hljs-title"><span class="hljs-title">Manager</span></span>; Manager::push(SomeJob::class);</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id475144/">https://habr.com/ru/post/id475144/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id475130/index.html">Wawancara besar tentang Big Data: mengapa mereka mengikuti kami di jejaring sosial dan siapa yang menjual data kami?</a></li>
<li><a href="../id475132/index.html">Baling-baling tidak terkunci pada mesin CNC</a></li>
<li><a href="../id475138/index.html">5 Cara Menggunakan Raspberry Pi Menguntungkan Bagian dua</a></li>
<li><a href="../id475140/index.html">Mengapa fisikawan papan atas menganggap pengukuran kuantum yang lemah sebagai pseudosain</a></li>
<li><a href="../id475142/index.html">Tidur, relaksasi, dan musik: bagaimana atlet profesional mengatasi kelelahan, dan apa yang dapat kita lakukan untuk itu</a></li>
<li><a href="../id475146/index.html">Penderitaan atau sejarah panjang dari satu upaya pemulihan data</a></li>
<li><a href="../id475152/index.html">Google munafik. Wawasan PageSpeed</a></li>
<li><a href="../id475154/index.html">Ketepatan waktu in-house dengan layanan cloud surveillance IPEYE</a></li>
<li><a href="../id475158/index.html">Ulasan Playme P570 Mono: Singkat dan to the point</a></li>
<li><a href="../id475162/index.html">Menggunakan X-Makro dalam Kode C ++ Modern</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>