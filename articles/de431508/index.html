<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéé üéüÔ∏è üí∞ Effizientes Transaktionsmanagement im Fr√ºhjahr ü•ù üèóÔ∏è üï¥üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Guten Tag an alle! 

 Nun, das Monatsende ist immer intensiv und es bleibt nur noch ein Tag bis zum Beginn des zweiten Streams des Kurses ‚ÄûDeveloper o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Effizientes Transaktionsmanagement im Fr√ºhjahr</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/431508/">  Guten Tag an alle! <br><br>  Nun, das Monatsende ist immer intensiv und es bleibt nur noch ein Tag bis zum Beginn des zweiten Streams des Kurses <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚ÄûDeveloper on Spring Framework‚Äú</a> , eines wunderbaren und interessanten Kurses, der von dem ebenso sch√∂nen wie w√ºtenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Yuri unterrichtet wird</a> (wie ihn einige Studenten wegen der Anforderungen nennen) in DZ), schauen wir uns also ein anderes Material an, das wir f√ºr Sie vorbereitet haben. <br><br>  Lass uns gehen. <br><br>  <b>Einf√ºhrung</b> <br><br>  In den meisten F√§llen legen Entwickler keinen Wert auf das Transaktionsmanagement.  Infolgedessen muss entweder der gr√∂√üte Teil des Codes sp√§ter neu geschrieben werden, oder der Entwickler implementiert das Transaktionsmanagement, ohne zu wissen, wie es tats√§chlich funktionieren sollte oder welche Aspekte speziell in seinem Fall verwendet werden sollten. <br><br>  Ein wichtiger Aspekt bei der Transaktionsverwaltung ist die Festlegung der korrekten Grenzen einer Transaktion, wann eine Transaktion beginnen und wann sie enden soll, wann Daten zur Datenbank hinzugef√ºgt und wann sie zur√ºckgepumpt werden sollen (im Falle einer Ausnahme). <br><br><img src="https://habrastorage.org/webt/qg/8n/mw/qg8nmwe4wvoqd2iuw3xv3ldpse0.png"><a name="habracut"></a><br><br>  Der wichtigste Aspekt f√ºr Entwickler ist zu verstehen, wie das Transaktionsmanagement am besten in einer Anwendung implementiert werden kann.  Schauen wir uns also die verschiedenen Optionen an. <br><br>  <b>Transaktionsmanagementmethoden</b> <br><br>  Transaktionen k√∂nnen auf folgende Arten verwaltet werden: <br><br>  <i><b>1. Programmieren Sie die Steuerung, indem Sie benutzerdefinierten Code schreiben</b></i> <br><br>  Dies ist eine alte Transaktionsverwaltungsmethode. <br><br><pre><code class="java hljs">EntityManagerFactory factory = Persistence.createEntityManagerFactory(<span class="hljs-string"><span class="hljs-string">"PERSISTENCE_UNIT_NAME"</span></span>); EntityManager entityManager = entityManagerFactory.createEntityManager(); Transaction transaction = entityManager.getTransaction() <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { transaction.begin(); someBusinessCode(); transaction.commit(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(Exception ex) { transaction.rollback(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> ex; }</code> </pre> <br>  <b>Vorteile</b> : <br><br><ul><li>  Transaktionsgrenzen sind im Code offensichtlich. </li></ul><br>  <b>Nachteile</b> : <br><br><ul><li>  Es wiederholt sich und ist fehleranf√§llig. </li><li>  Jeder Fehler kann sehr gro√üe Auswirkungen haben. </li><li>  Sie m√ºssen viele Vorlagen schreiben. Wenn Sie eine andere Methode von dieser Methode aus aufrufen m√∂chten, m√ºssen Sie sie erneut √ºber den Code steuern. </li></ul><br>  <i><b>2. Verwenden von Spring zur Transaktionsverwaltung</b></i> <br><br>  Spring unterst√ºtzt zwei Arten der Transaktionsverwaltung <br><br>  <b>1. Software Transaction Management</b> : Sie m√ºssen Transaktionen durch Programmierung verwalten.  Diese Methode ist flexibel genug, aber schwer zu warten. <br><br>  <b>2. Deklaratives Transaktionsmanagement</b> : Sie trennen das Transaktionsmanagement von der Gesch√§ftslogik.  Sie verwenden Anmerkungen in der XML-basierten Konfiguration nur f√ºr die Transaktionsverwaltung. <br><br>  <u><b>Wir empfehlen dringend die Verwendung deklarativer Transaktionen.</b></u>  <u><b>Wenn Sie die Gr√ºnde kennen m√∂chten, lesen Sie weiter, andernfalls gehen Sie direkt zum Abschnitt Deklaratives Transaktionsmanagement, wenn Sie diese Option implementieren m√∂chten.</b></u> <br><br>  Schauen wir uns nun jeden Ansatz im Detail an. <br><br>  <i><b>2.1.</b></i>  <i><b>Programmatisches Transaktionsmanagement:</b></i> <br><br>  Das Spring-Framework bietet zwei Tools f√ºr das programmatische Transaktionsmanagement. <br><br>  a.  Verwenden von <code>TransactionTemplate</code> (vom Spring-Team empfohlen): <br><br>  Schauen wir uns anhand des folgenden Beispielcodes an, wie dieser Typ implementiert wird (mit einigen √Ñnderungen aus der Spring-Dokumentation). <br><br>  <u>Beachten Sie, dass die Codefragmente aus Spring Docs stammen.</u> <br><br>  Kontext-XML-Datei: <br><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- Initialization for data source --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"driverClassName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.mysql.jdbc.Driver"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"url"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jdbc:mysql://localhost:3306/TEST"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"root"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Initialization for TransactionManager --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transactionManager"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Definition for ServiceImpl bean --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"serviceImpl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.service.ServiceImpl"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transactionManager"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  <code>Service</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TransactionTemplate transactionTemplate; <span class="hljs-comment"><span class="hljs-comment">//       PlatformTransactionManager public ServiceImpl(PlatformTransactionManager transactionManager) { this.transactionTemplate = new TransactionTemplate(transactionManager); } //       ,   ,    //       xml  this.transactionTemplate.setIsolationLevel(TransactionDefinition.ISOLATION_READ_UNCOMMITTED); this.transactionTemplate.setTimeout(30); //30  ///    public Object someServiceMethod() { return transactionTemplate.execute(new TransactionCallback() { //         public Object doInTransaction(TransactionStatus status) { updateOperation1(); return resultOfUpdateOperation2(); } }); }}</span></span></code> </pre><br>  Wenn es keinen R√ºckgabewert gibt, verwenden Sie die praktische <code>TransactionCallbackWithoutResult</code> Klasse mit einer anonymen Klasse, wie unten gezeigt: <br><br><pre> <code class="java hljs">transactionTemplate.execute(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TransactionCallbackWithoutResult() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInTransactionWithoutResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TransactionStatus status)</span></span></span><span class="hljs-function"> </span></span>{ updateOperation1(); updateOperation2(); } });</code> </pre><br><ul><li>  Instanzen der <code>TransactionTemplate</code> Klasse sind threadsicher, sodass nicht alle Dialogstatus unterst√ºtzt werden. </li><li>  <code>TransactionTemplate</code> Instanzen unterst√ºtzen dennoch den Konfigurationsstatus. Wenn eine Klasse also eine TransactionTemplate mit unterschiedlichen Einstellungen (z. B. einer anderen Isolationsstufe) verwenden muss, m√ºssen Sie zwei verschiedene TransactionTemplate-Instanzen erstellen, obwohl einige Klassen m√∂glicherweise dieselbe TransactionTemplate-Instanz verwenden. </li></ul><br>  b.  Direkte Verwendung der <code>PlatformTransactionManager</code> Implementierung: <br><br>  Schauen wir uns diese Option noch einmal im Code an. <br><br><pre> <code class="java hljs">&lt;!-- Initialization <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> data source --&gt; &lt;bean id=<span class="hljs-string"><span class="hljs-string">"dataSource"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span></span>&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"driverClassName"</span></span> value=<span class="hljs-string"><span class="hljs-string">"com.mysql.jdbc.Driver"</span></span>/&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"url"</span></span> value=<span class="hljs-string"><span class="hljs-string">"jdbc:mysql://localhost:3306/TEST"</span></span>/&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"username"</span></span> value=<span class="hljs-string"><span class="hljs-string">"root"</span></span>/&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"password"</span></span> value=<span class="hljs-string"><span class="hljs-string">"password"</span></span>/&gt; &lt;/bean&gt; &lt;!-- Initialization <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> TransactionManager --&gt; &lt;bean id=<span class="hljs-string"><span class="hljs-string">"transactionManager"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span></span>&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"dataSource"</span></span> ref=<span class="hljs-string"><span class="hljs-string">"dataSource"</span></span> /&gt; &lt;/bean&gt; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PlatformTransactionManager transactionManager; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTransactionManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( PlatformTransactionManager transactionManager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transactionManager = transactionManager; } DefaultTransactionDefinition def = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultTransactionDefinition(); <span class="hljs-comment"><span class="hljs-comment">//     -  ,       def.setName("SomeTxName"); def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED); TransactionStatus status = txManager.getTransaction(def); try { //   -  } catch (Exception ex) { txManager.rollback(status); throw ex; } txManager.commit(status); }</span></span></code> </pre> <br>  Bevor wir mit der n√§chsten Methode der Transaktionsverwaltung fortfahren, wollen wir uns ansehen, wie Sie entscheiden, welche Art der Transaktionsverwaltung Sie w√§hlen m√∂chten. <br><br>  Wahl zwischen <b>programmatischem</b> und <b>deklarativem Transaktionsmanagement</b> : <br><br><ul><li>  Programmatisches Transaktionsmanagement ist nur dann eine gute Wahl, wenn Sie nur eine geringe Anzahl von Transaktionsvorg√§ngen haben.  (In den meisten F√§llen handelt es sich nicht um Transaktionen.) </li><li>  Ein Transaktionsname kann nur in Program Transaction Management explizit festgelegt werden. </li><li>  Das programmatische Transaktionsmanagement sollte verwendet werden, wenn Sie das Transaktionsmanagement explizit steuern m√∂chten. </li><li>  Wenn Ihre Anwendung jedoch zahlreiche Transaktionsvorg√§nge enth√§lt, lohnt es sich, die deklarative Verwaltung zu verwenden. </li><li>  Die deklarative Verwaltung erm√∂glicht Ihnen nicht die Verwaltung von Transaktionen in der Gesch√§ftslogik und ist nicht schwer zu konfigurieren. </li></ul><br>  <i><b>2.2.</b></i>  <i><b>Deklarative Transaktionen (werden normalerweise in fast allen Szenarien einer Webanwendung verwendet)</b></i> <br><br>  <b>Schritt 1</b> : Definieren Sie den Transaktionsmanager in der Kontext-XML-Datei Ihrer Spring-Anwendung. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"txManager"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tx:annotation-driven</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">transaction-manager</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"txManager"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  <b>Schritt 2</b> : Aktivieren Sie die Annotationsunterst√ºtzung, indem Sie einen Eintrag in die Kontext-XML-Datei Ihrer Spring-Anwendung einf√ºgen. <br><br>  ODER f√ºgen <code>@EnableTransactionManagement</code> Ihrer Konfigurationsdatei <code>@EnableTransactionManagement</code> hinzu, wie unten gezeigt: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableTransactionManagement</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppConfig</span></span></span><span class="hljs-class"> </span></span>{ ... }</code> </pre> <br>  <i><b>Spring empfiehlt, nur bestimmte Klassen (und Methoden bestimmter Klassen) mit <code>@Transactional</code> Annotation zu <code>@Transactional</code> verglichen mit Annotationsschnittstellen.</b></i> <br><br>  Der Grund daf√ºr ist, dass Sie die Annotation auf Schnittstellenebene platzieren. Wenn Sie Proxy-Klassen ( <code>proxy-target-class = ¬´true¬ª</code> <code>mode = ¬´aspectj¬ª</code> <code>proxy-target-class = ¬´true¬ª</code> ) oder den Verflechtungsaspekt ( <code>mode = ¬´aspectj¬ª</code> ) verwenden, werden die Transaktionsparameter von der Proxy-Infrastruktur nicht erkannt und Plexus, zum Beispiel Transaktionsverhalten wird nicht angewendet. <br><br>  <b>Schritt 3</b> : F√ºgen <b><code>@Transactional</code></b> der Klasse (Klassenmethode) oder der Schnittstelle (Schnittstellenmethode) die Annotation <b><code>@Transactional</code></b> . <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tx:annotation-driven</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">proxy-target-class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Standardkonfiguration: <code>proxy-target-class="false"</code> <br><br><ul><li>  <code>@Transactional</code> kann vor einer Schnittstellendefinition, einer Schnittstellenmethode, einer Klassendefinition oder einer √∂ffentlichen Klassenmethode platziert werden. </li><li>  Wenn einige Klassenmethoden (mit <code>@Transactional</code> Annotation gekennzeichnet) unterschiedliche Attributeinstellungen haben sollen, z. B. Isolationsstufe oder Ausbreitungsstufe, platzieren Sie die Annotation auf Methodenebene, um Attributeinstellungen auf Klassenebene zu √ºberschreiben. </li><li>  Im Proxy-Modus (der standardm√§√üig festgelegt ist) k√∂nnen nur "externe" Methodenaufrufe abgefangen werden, die den Proxy durchlaufen.  Dies bedeutet, dass ein ‚Äûunabh√§ngiger Aufruf‚Äú, beispielsweise eine Methode im Ziel, die eine andere Methode des Ziels aufruft, zur Laufzeit nicht zu einer tats√§chlichen Transaktion f√ºhrt, selbst wenn die aufgerufene Methode mit <code>@Transactional</code> . </li></ul><br>  <code>@Transactional</code> wir nun <code>@Transactional</code> Unterschied zwischen den Annotationsattributen <code>@Transactional</code> <br><br> <b><code>@Transactional (isolation=Isolation.READ_COMMITTED)</code></b> <br> <br><ul><li>  Der Standardwert ist <code>Isolation.DEFAULT</code> </li><li>  In den meisten F√§llen verwenden Sie die Standardeinstellungen, bis Sie spezielle Anforderungen haben. </li><li>  Weist den Transaktionsmanager ( <code>tx</code> ) an, dass die n√§chste Isolationsstufe f√ºr den aktuellen <code>tx</code> .  Es muss an dem Punkt installiert werden, an dem <code>tx</code> startet, da wir die Isolationsstufe nach dem Start von tx nicht √§ndern k√∂nnen. </li></ul><br>  <b>STANDARD</b> : Verwenden Sie die Standardisolationsstufe in der Basisdatenbank. <br><br>  <b>READ_COMMITTED</b> (Lesen fester Daten): Eine Konstante, die angibt, dass ein <b>fehlerhaftes</b> Lesen verhindert wurde.  Nicht wiederholtes Lesen und Phantomlesen k√∂nnen auftreten. <br><br>  <b>READ_UNCOMMITTED</b> (nicht <b>festgeschriebene</b> Daten lesen): Diese Isolationsstufe gibt an, dass eine Transaktion Daten lesen kann, die noch nicht von anderen Transaktionen gel√∂scht wurden. <br><br>  <b>REPEATABLE_READ</b> ( <b>Lesewiederholbarkeit</b> ): Eine Konstante, die angibt, dass schmutziges Lesen und nicht wiederholbares Lesen verhindert werden.  M√∂glicherweise wird eine Phantomablesung angezeigt. <br><br>  <b>SERIALISIERBAR</b> : Permanent, was darauf hinweist, dass schmutziges Lesen, nicht wiederholbares Lesen und Phantomlesen verhindert werden. <br><br>  Was bedeutet dieser Jargon: "schmutziges" Lesen, Phantomlesen oder wiederholtes Lesen? <br><br><ul><li>  <b>Dirty Read</b> : Transaktion A schreibt.  In der Zwischenzeit liest Transaktion "B" denselben Datensatz, bis Transaktion A abgeschlossen ist. Sp√§ter entscheidet sich Transaktion A f√ºr ein Rollback, und jetzt haben wir √Ñnderungen an Transaktion B, die nicht kompatibel sind.  Dies ist eine schmutzige Lekt√ºre.  Transaktion B arbeitete auf Isolationsebene READ_UNCOMMITTED, sodass die von Transaktion A vorgenommenen √Ñnderungen vor Abschluss der Transaktion gelesen werden konnten. </li><li>  <b>Nicht wiederholbares Lesen</b> : Transaktion "A" liest einige Datens√§tze.  Dann schreibt die Transaktion "B" diesen Datensatz und schreibt ihn fest.  Sp√§ter liest Transaktion A denselben Datensatz erneut und erh√§lt m√∂glicherweise andere Werte, da Transaktion B √Ñnderungen an diesem Datensatz vorgenommen und diese festgeschrieben hat.  Dies ist eine sich nicht wiederholende Lesung. </li><li>  <b>Phantom Read</b> : Transaktion ‚ÄûA‚Äú liest eine Reihe von Datens√§tzen.  W√§hrenddessen f√ºgt die Transaktion "B" einen neuen Datensatz in dieselbe Zeile wie die Transaktion A ein. Sp√§ter liest die Transaktion A denselben Bereich erneut und empf√§ngt auch den Datensatz, den die Transaktion B gerade eingef√ºgt hat. Dies ist ein Phantom-Lesevorgang: Die Transaktion hat eine Reihe von Datens√§tzen mehrmals abgerufen aus der Datenbank und erhielt verschiedene Ergebnismengen (mit Phantomdatens√§tzen). </li></ul><br> <code><b>@Transactional(timeout=60)</b></code> <br> <br>  Der Standardwert ist das Standardzeitlimit f√ºr das zugrunde liegende Transaktionssystem. <br><br>  Informiert den TX-Manager √ºber die Wartezeit, bis TX gesendet wird, bevor entschieden wird, ob nicht antwortende Transaktionen zur√ºckgesetzt werden sollen. <br><br> <code><b>@Transactional(propagation=Propagation.REQUIRED)</b></code> <br> <br>  Wenn nicht angegeben, ist das Standardausbreitungsverhalten <code>REQUIRED</code> . <br><br>  Andere Optionen sind <code>REQUIRES_NEW, MANDATORY, SUPPORTS, NOT_SUPPORTED, NEVER</code> und <code>NESTED</code> . <br><br>  <b>ERFORDERLICH</b> <br><br>  Gibt an, dass die Zielmethode ohne aktiven Empfang nicht funktionieren kann.  Wenn tx bereits ausgef√ºhrt wird, bevor diese Methode aufgerufen wird, wird es im selben tx fortgesetzt, oder der neue tx wird kurz nach dem Aufrufen dieser Methode gestartet. <br><br>  <b>REQUIRES_NEW</b> <br><br><ul><li>  Gibt an, dass bei jedem Aufruf der Zielmethode ein neuer TX ausgef√ºhrt werden soll.  Wenn tx bereits ausgef√ºhrt wird, wird es angehalten, bevor ein neues gestartet wird. </li></ul><br>  <b>Mandat</b> <br><br><ul><li>  Gibt an, dass f√ºr die Zielmethode aktives Senden erforderlich ist.  Wenn tx nicht fortgesetzt wird, schl√§gt es nicht fehl und l√∂st eine Ausnahme aus. </li></ul><br>  <b>UNTERST√úTZT</b> <br><br><ul><li>  Gibt an, dass die Zielmethode unabh√§ngig von tx ausgef√ºhrt werden kann.  Wenn tx funktioniert, wird es am selben tx teilnehmen.  Wenn es ohne tx ausgef√ºhrt wird, wird es weiterhin ausgef√ºhrt, wenn keine Fehler vorliegen. </li></ul><br><ul><li>  Methoden zum Abrufen von Daten sind die besten Kandidaten f√ºr diese Option. </li></ul><br>  <b>NOT_SUPPORTED</b> <br><br><ul><li>  Gibt an, dass f√ºr die Zielmethode keine Weitergabe des Transaktionskontexts erforderlich ist. </li><li>  Grunds√§tzlich sind die Methoden, die in einer Transaktion ausgef√ºhrt werden, aber Operationen mit RAM ausf√ºhren, die besten Kandidaten f√ºr diese Option. </li></ul><br>  <b>Niemals</b> <br><br><ul><li>  Gibt an, dass die Zielmethode eine Ausnahme ausl√∂st, wenn sie in einem Transaktionsprozess ausgef√ºhrt wird. </li><li>  Diese Option wird in den meisten F√§llen nicht in Projekten verwendet. </li></ul><br> <b><code>@Transactional (rollbackFor=Exception.class)</code></b> <br> <br>  Standardwert: <code>rollbackFor=RunTimeException.class</code> <br><br>  Im Fr√ºhjahr l√∂sen alle API-Klassen eine RuntimeException aus. Wenn also eine Methode fehlschl√§gt, setzt der Container die aktuelle Transaktion immer zur√ºck. <br><br>  Das Problem besteht nur mit aktivierten Ausnahmen.  Daher kann dieser Parameter verwendet werden, um eine Transaktion deklarativ zur√ºckzusetzen, wenn eine <code>Checked Exception</code> auftritt. <br><br> <code><b>@Transactional (noRollbackFor=IllegalStateException.class)</b></code> <br> <br>  Gibt an, dass kein Rollback stattfinden soll, wenn die Zielmethode diese Ausnahme ausl√∂st. <br><br>  Der letzte, aber wichtigste Schritt im Transaktionsmanagement ist das Ver√∂ffentlichen der Annotation <code>@Transactiona</code> l.  In den meisten F√§llen kommt es zu Verwirrung, wo sich die Anmerkung befinden sollte: auf Serviceebene oder auf DAO-Ebene? <br><br>  <b><code>@Transactional</code> : Service- oder DAO-Level?</b> <br><br>  Service ist der beste Ort, um <code>@Transactional</code> . Die Serviceebene sollte das Verhalten des Anwendungsfalls auf der Detailebene f√ºr die Benutzerinteraktion enthalten, die logisch in die Transaktion <code>@Transactional</code> . <br><br>  Es gibt viele CRUD-Anwendungen, die keine signifikante Gesch√§ftslogik mit einem Service-Level haben, der einfach Daten zwischen Controllern und Datenzugriffsobjekten √ºbertr√§gt, was nicht n√ºtzlich ist.  In diesen F√§llen k√∂nnen wir die Transaktionsanmerkung auf DAO-Ebene setzen. <br><br>  Daher k√∂nnen Sie sie in der Praxis √ºberall platzieren, es liegt an Ihnen. <br><br>  Wenn Sie <code>@Transactional</code> in die DAO-Schicht <code>@Transactional</code> und Ihre DAO-Schicht von verschiedenen Diensten wiederverwendet wird, ist es au√üerdem schwierig, sie in der DAO-Schicht zu platzieren, da unterschiedliche Dienste unterschiedliche Anforderungen haben k√∂nnen. <br><br>  Wenn Ihr Service Level Objekte mit Hibernate abruft und Sie beispielsweise verz√∂gerte Initialisierungen in der Definition eines Dom√§nenobjekts haben, m√ºssen Sie die Transaktion auf Service Level √∂ffnen, da sonst eine von ORM ausgel√∂ste LazyInitializationException auftritt. <br><br>  Stellen Sie sich ein anderes Beispiel vor, in dem Ihr Service Level zwei verschiedene DAO-Methoden aufrufen kann, um Datenbankoperationen auszuf√ºhren.  Wenn Ihre erste DAO-Operation fehlgeschlagen ist, werden m√∂glicherweise die beiden anderen √ºbertragen, und Sie beenden den inkonsistenten Status der Datenbank.  Service Level Annotation kann Sie vor solchen Situationen bewahren. <br><br>  Ich hoffe dieser Artikel hat dir geholfen. <br><br>  DAS ENDE <br><br>  Es ist immer interessant, Ihre Kommentare oder Fragen zu sehen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de431508/">https://habr.com/ru/post/de431508/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de431498/index.html">WebP wird das Web bald √ºbernehmen, aber es wird nicht lange dauern</a></li>
<li><a href="../de431500/index.html">Datenbanken und Kubernetes (R√ºckblick und Videobericht)</a></li>
<li><a href="../de431502/index.html">Konferenz f√ºr iOS-Entwickler Kolesa Mobile 3.0. Videobericht</a></li>
<li><a href="../de431504/index.html">Phishing - funktioniert. Chronik des Diebstahls des iPhone XS, gefolgt von iCloud-Datendiebstahl</a></li>
<li><a href="../de431506/index.html">Xcode und erweitertes Debugging in LLDB: Teil 1</a></li>
<li><a href="../de431510/index.html">So sammeln Sie Informationen aus der Kontur. Einkauf mit Selen</a></li>
<li><a href="../de431512/index.html">Eine kleine Studie √ºber die Eigenschaften eines einfachen U-Netzes, eines klassischen Faltungsnetzwerks zur Segmentierung</a></li>
<li><a href="../de431514/index.html">Interview f√ºr Interviewer</a></li>
<li><a href="../de431516/index.html">Ein Tag im Leben eines Finanzberaters</a></li>
<li><a href="../de431518/index.html">Microsoft Connect (); Treffen in Moskau</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>