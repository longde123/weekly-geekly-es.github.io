<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÄÑÔ∏è ‚úèÔ∏è üë®üèø‚ÄçüöÄ Interfaces en tant que types de donn√©es abstraits dans Go ü§∞üèº üçû üë©üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il n'y a pas si longtemps, un coll√®gue a retweet√© un excellent article Comment utiliser les interfaces Go . Il discute de quelques bogues lors de l'ut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interfaces en tant que types de donn√©es abstraits dans Go</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450386/"> Il n'y a pas si longtemps, un coll√®gue a retweet√© un excellent article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment utiliser les interfaces Go</a> .  Il discute de quelques bogues lors de l'utilisation des interfaces dans Go, et donne √©galement quelques recommandations sur la fa√ßon dont ils doivent √™tre utilis√©s. <br><br>  Dans l'article mentionn√© ci-dessus, l'auteur cite l'interface du package de <b>tri</b> de la biblioth√®que standard comme exemple d'un type de donn√©es abstrait.  Cependant, il me semble qu'un tel exemple ne r√©v√®le pas tr√®s bien l'id√©e quand il s'agit de vraies applications.  En particulier sur les applications qui impl√©mentent la logique d'un domaine d'activit√© ou r√©solvent des probl√®mes du monde r√©el. <br><br>  De plus, lorsque vous utilisez des interfaces dans Go, il y a souvent un d√©bat sur la suring√©nierie.  Et il arrive √©galement qu'apr√®s avoir lu ce genre de recommandations, les gens non seulement cessent d'abuser des interfaces, ils essaient de les abandonner presque compl√®tement, se privant ainsi d'utiliser l'un des concepts de programmation les plus solides en principe (et l'une des forces de Go in particulier).  Au sujet des erreurs typiques de Go, au fait, il y a un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bon rapport</a> de Stive Francia de Docker.  L√†, en particulier, les interfaces sont mentionn√©es plusieurs fois. <br><br>  En g√©n√©ral, je suis d'accord avec l'auteur de l'article.  N√©anmoins, il m'a sembl√© que le sujet de l'utilisation des interfaces en tant que types de donn√©es abstraits s'y r√©v√©lait plut√¥t superficiellement, donc je voudrais le d√©velopper un peu et r√©fl√©chir √† ce sujet avec vous. <br><a name="habracut"></a><br><h3>  Se r√©f√©rer √† l'original </h3><br>  Au d√©but de l'article, l'auteur donne un petit exemple de code, √† l'aide duquel il signale des erreurs lors de l'utilisation des interfaces que les d√©veloppeurs font souvent.  Voici le code. <br><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> animal <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Animal <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaks() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-comment"><span class="hljs-comment">// implementation of Animal type Dog struct{} func (a Dog) Speaks() string { return "woof" }</span></span></code> </pre> <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"animal"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a animal.Animal)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() }</code> </pre><br>  L'auteur appelle cette approche <i>¬´utilisation d'interface de style Java¬ª</i> .  Lorsque nous d√©clarons une interface, nous impl√©mentons le seul type et les seules m√©thodes qui satisferont cette interface.  Je suis d'accord avec l'auteur, l'approche est telle quelle. Le code le plus idiomatique de l'article original est le suivant: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> animal <span class="hljs-comment"><span class="hljs-comment">// implementation of Animal type Dog struct{} func (a Dog) Speaks() string { return "woof" }</span></span></code> </pre><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Speaker <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaks() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a Speaker)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() }</code> </pre><br>  Ici, en g√©n√©ral, tout est clair et compr√©hensible.  L'id√©e de base: <i>"D√©clarez d'abord les types, et ensuite seulement d√©clarez les interfaces au point d'utilisation</i> . <i>"</i>  C'est correct.  Mais d√©veloppons maintenant une petite id√©e de la fa√ßon dont vous pouvez utiliser les interfaces comme types de donn√©es abstraits.  L'auteur souligne d'ailleurs que dans une telle situation, il n'y a rien de mal √† d√©clarer l'interface <i>¬´en amont¬ª</i> .  Nous travaillerons avec le m√™me code. <br><br><h3>  Jouons avec les abstractions </h3><br>  Nous avons donc un cirque et il y a des animaux.  √Ä l'int√©rieur du cirque, il existe une m√©thode plut√¥t abstraite <i>appel√©e ¬´Perform¬ª</i> , qui prend l'interface ¬´ <i>Speaker¬ª</i> et fait √©mettre des sons √† l'animal.  Par exemple, il fera aboyer le chien √† partir de l'exemple ci-dessus.  Cr√©ez un dompteur d'animaux.  Puisqu'il n'est pas idiot ici, on peut aussi g√©n√©ralement le faire √©mettre des sons.  Notre interface est assez abstraite.  :) <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Tamer <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Speaks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"WAT?"</span></span> }</code> </pre><br>  Jusqu'√† pr√©sent, tout va bien.  Nous allons plus loin.  Apprenons √† notre dompteur √† donner des ordres aux animaux de compagnie?  Jusqu'√† pr√©sent, nous aurons une commande <i>vocale</i> .  :) <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ( ActVoice = <span class="hljs-literal"><span class="hljs-literal">iota</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, a Speaker)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> action { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ActVoice: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"animal"</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { d := &amp;animal.Dog{} t := &amp;circus.Tamer{} t2 := &amp;circus.Tamer{} t.Command(circus.ActVoice, d) <span class="hljs-comment"><span class="hljs-comment">// woof t.Command(circus.ActVoice, t2) // WAT? }</span></span></code> </pre><br>  Mmmm, int√©ressant n'est-ce pas?  Il semble que notre coll√®gue n'est pas content qu'il soit devenu un animal de compagnie dans ce contexte?  : D Que faire?  <i>Le haut-parleur</i> semble qu'une abstraction n'est pas tr√®s appropri√©e ici.  Nous en cr√©erons une plus appropri√©e (ou plut√¥t, nous retournerons en quelque sorte la premi√®re version du <i>¬´mauvais exemple¬ª</i> ), apr√®s quoi nous changerons la notation de la m√©thode. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Animal <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaker } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, a Animal)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre><br>  Cela ne change rien, dites-vous, le code sera toujours ex√©cut√©, car  les deux interfaces impl√©mentent une m√©thode, et vous aurez raison en g√©n√©ral. <br><br>  Cependant, cet exemple capture une id√©e importante.  Lorsque nous parlons de types de donn√©es abstraits, le contexte est crucial.  L'introduction d'une nouvelle interface, au moins, a rendu le code d'un ordre de grandeur plus √©vident et plus lisible. <br><br>  Soit dit en passant, l'une des fa√ßons de forcer le dompteur √† ne pas ex√©cuter la commande <i>¬´vocale¬ª</i> consiste simplement √† ajouter une m√©thode qu'il ne devrait pas avoir.  Ajoutons une telle m√©thode, elle donnera des informations sur la capacit√© de l'animal √† s'entra√Æner. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Animal <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaker IsTrained() <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> }</code> </pre><br>  D√©sormais, le dompteur ne peut pas √™tre gliss√© √† la place d'un animal de compagnie. <br><br><h3>  D√©velopper le comportement </h3><br>  Nous obligerons nos animaux de compagnie, pour un changement, √† ex√©cuter d'autres commandes, en plus, ajoutons un chat. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> animal <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Dog <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d Dog)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsTrained</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d Dog)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Speaks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"woof"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d Dog)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Jump</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"jumps"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d Dog)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"sit"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Cat <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c Cat)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsTrained</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c Cat)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Speaks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"meow!"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c Cat)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Jump</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"meow!!"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(c Cat)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"meow!!!"</span></span> }</code> </pre><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ( ActVoice = <span class="hljs-literal"><span class="hljs-literal">iota</span></span> ActSit ActJump ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Animal <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Speaker IsTrained() <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Jump() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Sit() <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, a Animal)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> action { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ActVoice: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ActSit: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Sit() <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ActJump: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Jump() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre><br>  G√©nial, maintenant nous pouvons donner diff√©rentes commandes √† nos animaux, et ils les ex√©cuteront.  √Ä un degr√© ou un autre ...: D <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"animal"</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { t := &amp;circus.Tamer{} d := &amp;animal.Dog{} t.Command(circus.ActVoice, d) <span class="hljs-comment"><span class="hljs-comment">// "woof" t.Command(circus.ActJump, d) // "jumps" t.Command(circus.ActSit, d) // "sit" t2 := &amp;circus.Tamer{} c := &amp;animal.Cat{} t2.Command(circus.ActVoice, c) // "meow" t2.Command(circus.ActJump, c) // "meow!!" t2.Command(circus.ActSit, c) // "meow!!!" }</span></span></code> </pre><br>  Nos chats domestiques ne se pr√™tent pas particuli√®rement √† l'entra√Ænement.  Par cons√©quent, nous allons aider le dompteur et nous assurer qu'il ne souffre pas avec eux. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, a Animal)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !a.IsTrained() { <span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>(<span class="hljs-string"><span class="hljs-string">"Sorry but this animal doesn't understand your commands"</span></span>) } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre><br>  C'est mieux.  Contrairement √† l'interface <i>animale</i> initiale, qui duplique le <i>locuteur</i> , nous avons maintenant l'interface <i>`Animal`</i> (qui est essentiellement un type de donn√©es abstrait) qui impl√©mente un comportement assez significatif. <br><br><h3>  Discutons des tailles d'interface </h3><br>  R√©fl√©chissons maintenant √† un probl√®me comme l'utilisation d'interfaces larges. <br><br>  Il s'agit d'une situation dans laquelle nous utilisons des interfaces avec un grand nombre de m√©thodes.  Dans ce cas, la recommandation ressemble √† ceci: <i>¬´Les fonctions doivent accepter les interfaces contenant les m√©thodes dont elles ont besoin</i> . <i>¬ª</i> <br><br>  En g√©n√©ral, je conviens que les interfaces doivent √™tre petites, mais dans ce cas, le contexte importe √† nouveau.  Revenons √† notre code et apprenons √† notre dompteur √† <i>¬´louer¬ª</i> son animal de compagnie. <br><br>  En r√©ponse aux louanges, l'animal familier √©mettra une voix. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t *Tamer)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Praise</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a Speaker)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a.Speaks() }</code> </pre><br>  Il semblerait que tout va bien, nous utilisons l'interface minimale n√©cessaire.  Il n'y a rien de superflu.  Mais l√† encore le probl√®me.  Bon sang, maintenant nous pouvons <i>¬´louer¬ª l'</i> autre entra√Æneur et il <i>va ¬´donner une voix¬ª</i> .  : D Saisissez-le? .. Le contexte compte toujours. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"animal"</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { t := &amp;circus.Tamer{} t2 := &amp;circus.Tamer{} d := &amp;animal.Dog{} c := &amp;animal.Cat{} t.Praise(d) <span class="hljs-comment"><span class="hljs-comment">// woof t.Praise(c) // meow! t.Praise(t2) // WAT? }</span></span></code> </pre><br>  Pourquoi suis-je?  Dans ce cas, la meilleure solution serait encore d'utiliser une interface plus large (repr√©sentant le type de donn√©es abstrait <i>¬´animal¬ª</i> ).  Puisque nous voulons apprendre √† louer un animal de compagnie, pas une cr√©ature capable de faire des sons. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> circus <span class="hljs-comment"><span class="hljs-comment">// Now we are using Animal interface here. func (t *Tamer) Praise(a Animal) string { return a.Speaks() }</span></span></code> </pre><br>  Tellement mieux.  Nous pouvons faire l'√©loge de l'animal, mais nous ne pouvons pas louer le dompteur.  Le code est redevenu plus simple et plus √©vident. <br><br><h3>  Maintenant un peu sur la loi du lit </h3><br>  Le dernier point que je voudrais aborder est la recommandation selon laquelle nous devrions accepter un type abstrait et renvoyer une structure sp√©cifique.  Dans l'article d'origine, cette mention est donn√©e dans la section d√©crivant la loi dite de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Postel</a> . <br><br>  L'auteur cite la loi elle-m√™me:. <br><blockquote>  "Soyez conservateur avec ce que vous faites, soyez lib√©ral avec vous acceptez" </blockquote><br>  Et l'interpr√®te par rapport √† la langue Go <br><blockquote>  "Go": "Accepter les interfaces, retourner les structures" </blockquote> <code>func funcName(a INTERFACETYPE) CONCRETETYPE</code> <br> <br>  Vous savez, en g√©n√©ral, je suis d'accord, c'est une bonne pratique.  Cependant, je tiens √† souligner √† nouveau.  Ne le prenez pas au pied de la lettre.  Le diable est dans les d√©tails.  Comme toujours, le contexte est important. <br>  Une fonction ne doit pas toujours renvoyer un type sp√©cifique.  C'est-√†-dire  si vous avez besoin d'un type abstrait, renvoyez-le.  Pas besoin d'essayer de r√©√©crire le code tout en √©vitant l'abstraction. <br><br>  Voici un petit exemple.  Un √©l√©phant est apparu dans un cirque <i>¬´africain¬ª</i> voisin, et vous avez demand√© aux propri√©taires du cirque de pr√™ter un √©l√©phant √† un nouveau spectacle.  Pour vous, dans ce cas, il est important que l'√©l√©phant puisse ex√©cuter toutes les m√™mes commandes que les autres animaux.  La taille d'un √©l√©phant ou la pr√©sence d'un tronc dans ce contexte n'a pas d'importance. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> african <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Elephant <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e Elephant)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Speaks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"pawoo!"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e Elephant)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Jump</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"o_O"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e Elephant)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"sit"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e Elephant)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsTrained</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetElephant</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">circus</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Animal</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;Elephant{} }</code> </pre><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"african"</span></span> <span class="hljs-string"><span class="hljs-string">"circus"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { t := &amp;circus.Tamer{} e := african.GetElephant() t.Command(circus.ActVoice, e) <span class="hljs-comment"><span class="hljs-comment">// "pawoo!" t.Command(circus.ActJump, e) // "o_O" t.Command(circus.ActSit, e) // "sit" }</span></span></code> </pre><br>  Comme vous pouvez le voir, puisque les param√®tres sp√©cifiques de l'√©l√©phant qui le distinguent des autres animaux de compagnie ne sont pas importants pour nous, nous pouvons tr√®s bien utiliser l'abstraction, et le retour de l'interface dans ce cas sera tout √† fait appropri√©. <br><br><h3>  Pour r√©sumer </h3><br>  Le contexte est crucial lorsqu'il s'agit d'abstractions.  Ne n√©gligez pas les abstractions et ayez peur d'eux, tout comme vous ne devriez pas en abuser.  Vous ne devez pas consid√©rer les recommandations comme des r√®gles.  Il y a des approches qui ont √©t√© test√©es par le temps, il y a des approches qui doivent encore √™tre test√©es.  J'esp√®re avoir pu ouvrir un peu plus en profondeur le sujet de l'utilisation des interfaces comme types de donn√©es abstraits et m'√©loigner des exemples habituels de la biblioth√®que standard. <br><br>  Bien s√ªr, pour certaines personnes, ce message peut sembler trop √©vident, et des exemples sont aspir√©s du doigt.  Pour d'autres, mes pens√©es peuvent √™tre controvers√©es et les arguments peu convaincants.  N√©anmoins, quelqu'un peut √™tre inspir√© et commencer √† r√©fl√©chir un peu plus profond√©ment non seulement au code, mais aussi √† l'essence des choses, ainsi qu'aux abstractions en g√©n√©ral. <br><br>  L'essentiel, mes amis, c'est que vous d√©veloppez et recevez constamment un vrai plaisir de travailler.  Bon √† tous! <br><br>  PS.  Un exemple de code et la version finale peuvent √™tre trouv√©s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450386/">https://habr.com/ru/post/fr450386/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450372/index.html">Comment les algorithmes d'Amazon d√©terminent qui il est temps de rejeter</a></li>
<li><a href="../fr450374/index.html">Carte d'extension de RAM pour Apple IIgs</a></li>
<li><a href="../fr450376/index.html">Comment Yandex.Taxi recherche des voitures quand elles ne le sont pas</a></li>
<li><a href="../fr450378/index.html">GitLab 11.10</a></li>
<li><a href="../fr450384/index.html">L'histoire d'une petite √©tude de code h√©rit√©e</a></li>
<li><a href="../fr450394/index.html">Enqu√™te sur une archive inconnue</a></li>
<li><a href="../fr450396/index.html">Comment am√©liorer votre anglais √©crit: conseils pratiques et outils utiles</a></li>
<li><a href="../fr450398/index.html">Les poisons les plus intr√©pides</a></li>
<li><a href="../fr450410/index.html">Terraformer - Infrastructure √† coder</a></li>
<li><a href="../fr450416/index.html">Comment les fournisseurs VPN de shareware vendent vos donn√©es</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>