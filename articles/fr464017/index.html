<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶ó üë®üèª‚Äçüåæ üë©üèº‚Äç‚öïÔ∏è Station de travail cryptographique bas√©e sur les jetons PKCS # 11. Obtention des certificats pour EGAIS. Partie 4 üè§ üì≥ üòî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Et maintenant, quand j'ai presque ajout√© la g√©n√©ration de certificats auto-sign√©s au poste de travail cryptographique bas√© sur les jetons cryptoarmpkc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Station de travail cryptographique bas√©e sur les jetons PKCS # 11. Obtention des certificats pour EGAIS. Partie 4</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464017/"><img src="https://habrastorage.org/webt/wp/sl/w1/wpslw1m_c55qfxj1sifpmgmge20.png" align="left">  Et maintenant, quand j'ai presque ajout√© la g√©n√©ration de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">certificats auto-sign√©s</a> au poste de travail cryptographique bas√© sur les jetons cryptoarmpkcs PKCS # 11 et que j'√©tais pr√™t √† commencer √† √©crire l'article, j'ai re√ßu une lettre comme celle-ci: <blockquote> Nous sommes l'UZNIREK CA, nous avons eu des difficult√©s √† √©mettre des ES au format pkcs # 11 pour EGAIS, le portail ne comprend pas les ES au format CSP Znamerek, nous vous demandons d'aider dans ce probl√®me. </blockquote>  Je ne connaissais pas toutes les subtilit√©s de travailler avec EGAIS, mais comme c'√©tait PKCS # 11, j'ai sugg√©r√© d'utiliser l'utilitaire cryptoarmpkcs pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">g√©n√©rer une demande</a> et installer un certificat pour un jeton apr√®s sa r√©ception par l'autorit√© de certification.  La r√©ponse que j'ai re√ßue √©tait quelque peu distrayante: <a name="habracut"></a><br><blockquote>  H√©las, le fait est que nous avons enregistr√© ES sur RuToken 2.0 via CryptoPro CSP, mais avec tous les param√®tres appropri√©s, le portail EGAIS n'a pas vu l'ES sur le support cl√©, le client nous a contact√© en support et nous avons constat√© que le probl√®me n'√©tait pas le certificat de cl√© est √©crit dans ce format, voici le manuel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dev.rutoken.ru/display/KB/RU1051</a> </blockquote>  . <br>  J'ai (et pas seulement moi) d√©j√† √©crit √† plusieurs reprises que beaucoup utilisent des jetons cryptographiques avec le support de la cryptographie russe comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lecteurs flash ordinaires</a> .  Et c'√©tait juste le cas lorsque la cl√© et le certificat n'√©taient pas arriv√©s au jeton en tant qu'objets PKCS # 11.  C'est dommage qu'ils n'aient pas suivi les conseils et n'aient m√™me pas essay√© de cr√©er une demande.  Mais j'ai alors d√©cid√© de tout mettre de c√¥t√© et de d√©terminer comment et sur quels certificats EGAIS Rosalkogolregulirovanie sont d√©livr√©s.  Et nous ne consid√©rerons que les jetons cryptographiques PKCS # 11.  La plus grande d√©ception est l'acc√®s √† EGAIS uniquement via Windows et le navigateur IE.  D'autre part, la g√©n√©ration d'une demande de certificat et l'installation d'un certificat peuvent √©galement √™tre effectu√©es sous n'importe quel syst√®me d'exploitation, s'il dispose de pilotes / biblioth√®ques pour le jeton correspondant. <br><br>  Au moins les jetons PKCS # 11 JaCarta, RutokenECP-2.0, le jeton logiciel LS11SW2016 et m√™me le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jeton cloud</a> sont pris en charge sur MS Windows, Linux et OS X. Et pas seulement sur ces syst√®mes d'exploitation. <br><br>  En fait, nous devons rendre hommage aux d√©veloppeurs d'EGAIS.  Ils ont propos√© une technologie int√©ressante qui permet d'acc√©der √† des certificats personnels (certificat plus paire de cl√©s) stock√©s sur des jetons cryptographiques avec prise en charge de la cryptographie russe et de prot√©ger le canal sur les certificats RSA.  Bien que s'ils disaient A, alors on pourrait dire B, c'est-√†-dire  prot√©ger le canal sur les algorithmes GOST-ov.  La seule chose triste est que tout cela est con√ßu uniquement pour MS Windows (ou je me trompe?), Ou plut√¥t pour Internet Explorer.  Et les utilitaires de g√©n√©ration de demandes de certificats pour EGAIS sont li√©s √† un jeton particulier. <br><br>  Mais l'utilitaire cryptoarmpkcs est multi-plateforme.  De plus, il est capable de fonctionner avec n'importe quel jeton cryptographique PKCS # 11 qui prend en charge la cryptographie russe. <br><br>  Alors, quelle est la particularit√© de la demande de certificat pour EGAIS?  La principale caract√©ristique est la pr√©sence obligatoire dans le nom distinctif du titulaire du certificat (sujet DN) d'un champ suppl√©mentaire unstucturedName (UN) (oid - 1.2.840.113549.1.9.2).  Si le propri√©taire du certificat est un entrepreneur individuel, la ligne ¬´KPP =¬ª est √©crite dans ce champ, et si le propri√©taire est une personne morale, alors cette ligne est √©crite dans ce champ: <br>  PPC = reason_code_of_tax_account_account: <br><br><img src="https://habrastorage.org/webt/p5/ta/ik/p5taik-xzifzowoorpxbgrko-tu.png"><br><br>  √Ä cet √©gard, l'exigence sur la premi√®re page de l'onglet de demande de certificat a √©t√© ajout√©e au bouton EGAIS: <br><br><img src="https://habrastorage.org/webt/lu/3y/pe/lu3ypehfo1drl5bffwfzu7bkngc.png"><br><br>  Une autre caract√©ristique est que les titulaires de certificats pour EGAIS peuvent √™tre titulaires de licence du syst√®me de d√©claration FSRAP (oid - 1.2.643.3.6.78.4.4).  Cela doit √©galement √™tre pris en compte lors de la cr√©ation d'une demande: <br><br><img src="https://habrastorage.org/webt/vs/zr/so/vszrso3twrpryl_cudxmggdw2ke.png"><br><br>  Une fois que tous les champs de la demande de certificat sont remplis et que vous avez confirm√© l'exactitude des donn√©es, une paire de cl√©s sera g√©n√©r√©e et la demande sera cr√©√©e: <br><br><img src="https://habrastorage.org/webt/rk/o3/to/rko3to_iuk4iaeq6aqjoxp-uf1o.png"><br><br>  Si vous regardez la demande, vous pouvez y voir les oid-s (Extetnded Key Usage), qui sont n√©cessaires pour EGAIS Rosalkogolregulirovanie: <br><br><img src="https://habrastorage.org/webt/g4/m-/mh/g4m-mh0xck7omdvymsuyalu_wfi.png"><br><br>  Ici, vous devez faire attention (dans la capture d'√©cran pr√©c√©dente) √† l'√©tiquette de la paire de cl√©s.  Dans la terminologie PKCS # 11, il s'agit de l'attribut CKA_LABEL pour la cl√© publique et priv√©e.  C'est par un tel sch√©ma qu'une √©tiquette (nom de cl√©) est cr√©√©e par le g√©n√©rateur de requ√™tes EGAIS pour JaCarta √† partir de CenterInform FSUE: <br><br><img src="https://habrastorage.org/webt/zv/bl/dg/zvbldgbgw9kmcphcz-nzq68pzqa.png"><br><br>  Traditionnellement triple <b>certificat x cl√©_ publique x cl√© priv√©e</b> <b><br></b>  sur le jeton est connect√© via l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">attribut CKA_ID</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a>  : <br><blockquote>  La fa√ßon la plus courante de sp√©cifier CKA_ID consiste √† utiliser la valeur de la fonction de hachage √† partir de la valeur de la cl√© publique.  C'est cette m√©thode de liaison d'un triple d'objets qui est utilis√©e dans le projet NSS (Network Security Services).  En m√™me temps, l'algorithme SHA1 est utilis√© comme fonction de hachage. </blockquote>  Malheureusement, CKA_LABEL et CKA_ID peuvent √™tre d√©finis / modifi√©s √† tout moment avec n'importe quelle valeur.  Ainsi, il est toujours possible que le certificat soit associ√© √† la cl√© priv√©e d'une autre personne.  Pas besoin d'expliquer quelles en seront les cons√©quences. <br><br>  En g√©n√©ral, existe-t-il un algorithme math√©matique strict qui vous permet de connecter le triple CKO_CERTIFICATE x CKO_PRIVATE_KEY x CKO_PUBLIC_KEY en un seul ensemble? <br>  Oui, un tel algorithme bas√© sur les m√©canismes cryptographiques (CKM_) du token <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">existe</a> . <br><br>  Malheureusement (bien que cela puisse √™tre objectivement compris), il consid√®re un tas dans un triple via CKA_LABEL, form√© par la m√©thode susmentionn√©e.  De plus, pour les cl√©s priv√©es et publiques, SKA_ID est form√© de mani√®re similaire.  Pour les cl√©s, c'est juste un d√©sastre, car  cependant ni CKA_ID ni CKA_LABEL ne sont li√©s de quelque fa√ßon √† la cl√© elle-m√™me.  Cela s'applique √©galement au certificat apr√®s son installation sur le jeton.  Si dans la formation traditionnelle de CKA_ID en tant que hachage √† partir de la cl√© publique, vous pouvez toujours v√©rifier si l'un correspond √† l'autre, puis lors de la configuration de CKA_ID et CKA_LABEL de la mani√®re d√©crite ci-dessus, cela ne peut pas √™tre fait. <br><br>  Une question peut se poser, mais comment v√©rifier la conformit√© d'une cl√© priv√©e?  La r√©ponse est simple - en calculant la valeur de la cl√© publique par rapport √† la cl√© priv√©e.  Quant au certificat, la valeur de sa cl√© publique y est, naturellement.  De plus, le certificat lui-m√™me contient la valeur CKA_ID √† la fois pour le titulaire du certificat (identifiant de cl√© de sujet de certificat) et l'√©diteur de certificat (identifiant de cl√© d'autorit√© de certification): <br><br><img src="https://habrastorage.org/webt/og/vx/9e/ogvx9esfdvq1vlfcy436vkwvqkm.png"><br><br>  Le plus d√©sagr√©able est que lors de l'installation du certificat, ce n'est pas la pr√©sence de la cl√© priv√©e qui est v√©rifi√©e, mais seule la cl√© publique est suffisante.  Dans ce cas, le certificat sera install√©, mais il n'y aura pas de cl√© priv√©e dessus.  Un autre probl√®me.  Il s'agit d'une recherche de cl√© publique par TIN.  Imaginez qu'une personne poss√®de un NIF et plusieurs cl√©s pour divers certificats.  Lequel appartient?  Apr√®s cela, il devient clair que JaCarta ne doit avoir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">qu'un seul certificat</a> et une seule paire de cl√©s: <br><blockquote>  Cette erreur peut √™tre li√©e √† la duplication de certificats.  Dans le client unique JaCarta en mode administrateur, sur l'onglet GOST Apr√®s avoir entr√© le code PIN, une cl√© publique, une cl√© priv√©e et un certificat doivent √™tre visibles.  Dans ce cas, la duplication des cl√©s est visible.  Vous devez supprimer les suppl√©mentaires.  R√©ins√©rez le support dans le connecteur USB et essayez de r√©installer l'UTM.  Si l'erreur persiste, initialisez Jacarta selon le lien 1 et recommencez le processus de g√©n√©ration. </blockquote>  Esp√©rons que cette lacune sera √©limin√©e.  Vous pouvez demander comment l'utilitaire cryptoarmpkcs pour EGAIS installe le certificat.  Pour une compatibilit√© totale avec JaCarta, nous avons maintenu l'id√©ologie selon laquelle CKA_ID et CKA_LABEL pour les cl√©s sont identiques.  Mais seulement apr√®s avoir install√© le certificat sur le jeton et l'avoir li√© √† la paire de cl√©s.  Jusque-l√†, la paire de cl√©s CKA_ID est maintenue √©gale √† la valeur de hachage de la cl√© publique. <br>  Apr√®s avoir install√© le certificat, vous pouvez l'utiliser pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">signer des documents</a> . <br><br>  Vous pouvez lire sur les certificats auto-sign√©s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> : <br><br><img src="https://habrastorage.org/webt/df/ir/yw/dfirywymvzgoqq5u46qa4th6tcw.png" alt="image"><br><br><div class="spoiler">  <b class="spoiler_title">Les distributions sont au m√™me endroit.</b> <div class="spoiler_text"><ul><li>  <a href="">Linux32</a> </li><li>  <a href="">Linux64</a> </li><li>  <a href="">OS X</a> </li><li>  <a href="">WIN32</a> </li><li>  <a href="">WIN64</a> </li></ul><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464017/">https://habr.com/ru/post/fr464017/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464003/index.html">Routeur 4G comme serveur universel pour l'IoT</a></li>
<li><a href="../fr464007/index.html">Comment j'ai construit un mod√®le pr√©dictif d'un centre d'appels pour que leurs appels ne f√¢chent pas les utilisateurs</a></li>
<li><a href="../fr464011/index.html">Comment j'ai quitt√© l'informatique en psychologie</a></li>
<li><a href="../fr464013/index.html">FAQ sur l'API HeadHunter (Offre d'emploi)</a></li>
<li><a href="../fr464015/index.html">Installer OpenCV + CUDA sur Windows</a></li>
<li><a href="../fr464019/index.html">Open source: le d√©veloppeur de la carte graphique a r√©v√©l√© la documentation du pilote pour Linux</a></li>
<li><a href="../fr464021/index.html">Qu'est-ce que la bascule de fonction ou comment se d√©barrasser des morses atroces et des branches √† longue dur√©e de vie?</a></li>
<li><a href="../fr464023/index.html">"Bases de la programmation" d√©fini pour un cours gratuit avec des exemples en JavaScript</a></li>
<li><a href="../fr464027/index.html">Comment survivre au contenu √† l'√®re de l'explosion de l'information</a></li>
<li><a href="../fr464031/index.html">¬´Finds of an Audiomaniac¬ª: les cartes son comme moyen de se plonger dans l'atmosph√®re d'une ville inconnue</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>