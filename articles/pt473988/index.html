<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëçüèª üë©üèª‚Äçüè≠ üõ°Ô∏è Otimizando a Distribui√ß√£o do Servidor nos Racks üåø üîî üôÅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recentemente, um colega me perguntou em um bate-papo: 

 - Existe um artigo sobre como empacotar servidores corretamente nos racks? 

 Percebi que n√£o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Otimizando a Distribui√ß√£o do Servidor nos Racks</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473988/"> Recentemente, um colega me perguntou em um bate-papo: <br><br>  - Existe um artigo sobre como empacotar servidores corretamente nos racks? <br><br>  Percebi que n√£o sabia disso.  Ent√£o, eu decidi escrever meu texto. <br><br>  Primeiro, este √© um artigo sobre servidores bare metal nas instala√ß√µes de data center (DC).  Em segundo lugar, estimamos que existem muitos servidores (centenas ou milhares);  o artigo n√£o faz sentido para menos quantidades.  Em terceiro lugar, consideramos que h√° tr√™s restri√ß√µes nos racks: espa√ßo f√≠sico, energia el√©trica por cada um e arm√°rios permanecem nas fileiras adjacentes um ao outro, para que possamos usar um √∫nico switch ToR para conectar servidores neles. <br><a name="habracut"></a><br>  A resposta √† pergunta original depende significativamente do par√¢metro que estamos otimizando e do que podemos mudar para obter um resultado melhor.  Por exemplo, precisamos usar menos espa√ßo para deixar mais para crescimento futuro.  Ou talvez tenhamos liberdade na sele√ß√£o de altura do gabinete, pot√™ncia por rack, n√∫mero de soquetes por PDU, n√∫mero de gabinetes por grupo de switches (um switch por 1, 2 ou 3 racks), comprimentos de cabos e trabalhos de cabeamento.  O √∫ltimo componente √© essencial para as filas de fim de rack, nas quais precisamos puxar cabos para a outra linha ou deixar portas subutilizadas no comutador.  Hist√≥rias completamente diferentes s√£o a sele√ß√£o de servidores e a central de dados.  Devemos considerar que j√° os escolhemos. <br><br>  √â bom entender algumas nuances e detalhes, em particular, o consumo m√©dio / m√°ximo de energia do servidor e como nosso fornecedor fornece eletricidade.  Portanto, se tivermos uma fonte de alimenta√ß√£o de 230V 1phase, um disjuntor de 32Amps pode suportar at√© 7kW.  Digamos que pagamos formalmente por 6kW por rack.  Se um fornecedor mede nosso consumo de energia por fileira de 10 gabinetes, n√£o por um √∫nico, e se os disjuntores limitam a pot√™ncia em 7kW, podemos usar 6,9kW em um rack e 5,1kW em outro.  Ser√° ok e impune. <br><br>  Geralmente, nosso principal objetivo √© minimizar os gastos.  O melhor crit√©rio de medi√ß√£o √© a redu√ß√£o do custo total de propriedade (TCO).  Consiste nas seguintes partes: <br><br><ul><li>  CAPEX: compra de infraestrutura de data center, servidores, dispositivos de rede, cabeamento </li><li>  OPEX: aluguel de DC, consumo de eletricidade, manuten√ß√£o.  OPEX depende da vida √∫til.  √â razo√°vel supor que uma vida √∫til seja igual a 3 anos. </li></ul><br><img src="https://habrastorage.org/webt/ub/ur/zi/uburzia_hkzpiosfd3k6i2agrwq.jpeg" alt="Gr√°fico TCO"><br><br>  Devemos otimizar as partes mais caras da torta.  Todo o resto deve usar os recursos restantes da maneira mais eficaz poss√≠vel. <br><br>  Supostamente, temos um CC existente, altura do rack de unidades H (por exemplo, H = 47), energia por rack P de <sub>rack</sub> ( <sub>rack</sub> P = 6kW) e decidimos usar h = 2U servidores de duas unidades.  Vamos remover de 2 a 4 unidades do rack para switches, patch panels, gerenciadores de cabos.  Em seguida, podemos instalar servidores S <sub>h</sub> = arredondamento ((H-2..4) / h) em um rack (ou seja, S <sub>h</sub> = arredondamento ((47-4) / 2) = 21 servidores por rack)).  Vamos memorizar S <sub>h</sub> . <br><br>  Em um caso simples, todos os servidores s√£o iguais.  Portanto, se enchermos um rack por servidores, podemos gastar por servidor uma pot√™ncia m√©dia de P <sub>serv</sub> = P <sub>rack</sub> / S <sub>h</sub> (P <sub>serv</sub> = 6000W / 21 = 287W).  Ignoramos o consumo de energia da chave aqui. <br><br>  Vamos nos afastar e definir qual √© o consumo m√°ximo de energia do servidor P <sub>max</sub> .  A maneira direta, completamente segura e altamente ineficiente √© ler o que uma etiqueta na fonte de alimenta√ß√£o do servidor diz.  Aqui est√° P <sub>m√°x</sub> . <br><br>  Uma abordagem mais complicada e eficiente √© pegar o TDP de todos os componentes e resumir.  N√£o √© preciso, mas podemos fazer dessa maneira. <br><br>  Normalmente, n√£o conhecemos o TDP dos componentes al√©m da CPU.  Portanto, a abordagem mais correta e mais complicada √© pegar um servidor experimental adequadamente configurado, carreg√°-lo, por exemplo, por / Linpack / (CPU e mem√≥ria) e / fio / (discos) e medir o consumo de energia.  Precisamos de um laborat√≥rio neste caso.  Se levarmos as coisas a s√©rio, devemos criar um ambiente quente no corredor frio, porque uma temperatura mais alta afeta os ventiladores e o consumo de energia da CPU.  Portanto, obtemos o consumo m√°ximo de energia do servidor de amostra com essa configura√ß√£o espec√≠fica no ambiente atual sob a carga espec√≠fica.  Lembre-se de que um novo firmware, vers√£o de software e outras condi√ß√µes podem afetar o resultado. <br><br>  Agora, voltemos ao P <sub>serv</sub> e como devemos compar√°-lo com P <sub>max</sub> .  √â uma quest√£o de entender como os servi√ßos funcionam e qu√£o fortes s√£o os nervos do nosso CTO. <br><br>  Se n√£o aceitarmos nenhum risco, devemos assumir que todos os servidores podem come√ßar a consumir seu potencial m√°ximo simultaneamente.  Ao mesmo tempo, um dos feeds DC tamb√©m pode falhar.  A infraestrutura ainda deve fornecer o servi√ßo.  Ent√£o, P <sub>serv</sub> ‚â° P <sub>max</sub> .  √â a abordagem em que a confiabilidade √© altamente importante. <br><br>  Se o CIO levar em conta n√£o apenas a seguran√ßa ideal, mas tamb√©m o dinheiro da empresa, se for corajoso o suficiente, poder√° decidir que <br><br><ul><li>  come√ßamos a gerenciar nossos fornecedores, em particular, proibimos qualquer manuten√ß√£o planejada nos per√≠odos de alta carga esperada para minimizar a falta de energia </li><li>  e / ou nossa arquitetura nos permite perder um rack / linha / DC enquanto os servi√ßos continuam opera√ß√µes </li><li>  e ou distribu√≠mos a carga pelos racks horizontalmente t√£o bem que nossos servidores em um √∫nico gabinete nunca consumir√£o seu m√°ximo te√≥rico juntos. </li></ul><br>  √â vantajoso n√£o apenas adivinhar aqui, mas monitorar o consumo de energia e entender como os servidores consomem energia durante cargas normais e de pico.  Assim e assim, ap√≥s algumas an√°lises, o CIO trabalha e diz: <br>  "Eu ordeno que a m√©dia m√°xima alcan√ß√°vel de todo o consumo m√°ximo de energia do servidor seja <b>muito</b> menor que o consumo m√°ximo do servidor √∫nico".  Seja P <sub>serv</sub> = 0.8 * P <sub>max</sub> <br><br>  E ent√£o um rack de 6kW pode acomodar n√£o 16 servidores de P <sub>max</sub> = 375W, mas 20 servidores de P <sub>serv</sub> = 375W * 0,8 = 300W.  Ou seja, 25% mais servidores.  √â uma economia real, porque precisamos de 25% menos racks.  E podemos economizar em PDUs, interruptores e cabos de rack.  Uma s√©ria desvantagem da solu√ß√£o √© a necessidade de verificar continuamente se nossas suposi√ß√µes ainda s√£o v√°lidas.  Devemos garantir que um novo firmware n√£o altere significativamente a opera√ß√£o do ventilador e o consumo de energia, para que a equipe de desenvolvimento n√£o comece a usar os servidores com muito mais efici√™ncia (significa que eles conseguiram aumentar a utiliza√ß√£o e o consumo de energia).  Ent√£o, ambas as suposi√ß√µes e conclus√µes iniciais se tornam erradas.  Portanto, √© o risco de ser aceito com responsabilidade.  Ou o risco pode ser evitado e a empresa paga pelos racks obviamente sobrecarregados. <br><br>  Uma observa√ß√£o importante: vale a pena tentar distribuir diferentes servidores de servi√ßos pelos racks horizontalmente, se poss√≠vel.  √â necess√°rio evitar casos em que v√°rios servidores para servi√ßo chegam e s√£o instalados nos gabinetes verticalmente para melhorar a "densidade" (apenas porque √© mais f√°cil fazer isso).  De fato, isso leva √† situa√ß√£o em que um rack √© preenchido com os mesmos servidores de baixa carga, enquanto todos os altamente carregados residem em outro.  Quando o perfil de carga √© o mesmo e todos os servidores come√ßam a consumir igualmente muito simultaneamente devido √† alta carga, a probabilidade de perder o segundo rack se torna muito maior. <br><br>  Vamos voltar √† distribui√ß√£o do servidor nos racks.  Consideramos restri√ß√µes f√≠sicas nos arm√°rios e limita√ß√µes de energia.  Agora vamos considerar a rede.  Pode-se usar N = switches de 24/32/48 portas (assumindo switches ToR de 48 portas).  Felizmente, n√£o existem tantas op√ß√µes se ignorarmos os cabos quebrados.  Consideramos as op√ß√µes de um switch em cada rack, um switch para dois ou tr√™s arm√°rios por grupo (R <sub>net</sub> ).  Eu acredito que o grupo n√£o deve ter tr√™s anos.  Caso contr√°rio, isso leva a problemas de cabeamento. <br><br>  Portanto, distribu√≠mos servidores pelos racks para cada cen√°rio de rede (1, 2 ou 3 racks por grupo): <br><br>  <sub>Rack</sub> S = min (S <sub>h</sub> , arredondamento ( <sub>rack</sub> P / <sub>servi√ßo</sub> P), arredondamento ( <sub>rede</sub> N / R)) <br><br>  Assim, um cen√°rio de grupo de dois racks √© <br><br>  S <sub>rack</sub> <sup>2</sup> = min (21, arredondamento (6000/300), arredondamento (48/2)) = min (21, 20, 24) = 20 servidores por rack <br><br>  Da mesma forma, contamos os outros cen√°rios: <br><br>  S <sub>rack</sub> <sup>1</sup> = 20 <br><br>  S <sub>rack</sub> <sup>3</sup> = 16 <br><br>  Estamos quase terminando.  Devemos contar a quantidade total de racks para distribuir todos os servidores S (que sejam 1000 servidores): <br><br>  R = arredondamento (S / ( <sub>rack</sub> S * R <sub>l√≠quido</sub> )) * R <sub>l√≠quido</sub> <br><br>  R <sub>1</sub> = arredondamento (1000 / (20 * 1)) * 1 = 50 * 1 = 50 racks <br><br>  R <sub>2</sub> = arredondamento (1000 / (20 * 2)) * 2 = 25 * 2 = 50 racks <br><br>  R <sub>2</sub> = arredondamento (1000 / (16 * 3)) * 3 = 21 * 3 = 63 racks <br><br>  Em seguida, devemos contar o custo total de propriedade para cada op√ß√£o com base no n√∫mero de racks, interruptores necess√°rios, cabeamento etc.  Escolhemos o cen√°rio com o menor custo total de propriedade.  Lucro! <br><br>  Observe que, embora o n√∫mero de racks para os cen√°rios 1 e 2 seja o mesmo, o TCO √© diferente devido √† quantidade duas vezes menor de comutadores e cabos mais longos para o segundo cen√°rio. <br><br>  PS Se a pot√™ncia por rack ou a altura do rack puder variar, a variabilidade aumentar√°.  Mas a sele√ß√£o pode ser reduzida ao m√©todo acima por for√ßa bruta das op√ß√µes.  Haver√° mais cen√°rios, mas sua quantidade ser√° limitada.  Podemos aumentar a energia por rack em etapas de 1kW, e h√° um n√∫mero limitado de tipos de rack padr√£o: de 42U, 45U, 47U, 48U.  Pode ser √∫til usar a an√°lise de varia√ß√µes hipot√©ticas do Excel no modo Tabela de dados.  Devemos olhar para a tabela resultante e selecionar a melhor op√ß√£o. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt473988/">https://habr.com/ru/post/pt473988/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt473978/index.html">Tanta dor, tanta dor, caixa registradora como 2: 0</a></li>
<li><a href="../pt473980/index.html">Tecnologia e o mundo real: 4 startups que est√£o mudando o futuro do design de interiores</a></li>
<li><a href="../pt473982/index.html">NB-IoT: como funciona? Parte 3: SCEF - uma √∫nica janela de acesso aos servi√ßos do operador</a></li>
<li><a href="../pt473984/index.html">Data Science Digest (outubro de 2019)</a></li>
<li><a href="../pt473986/index.html">‚ÄúMeu sonho √© ver uma pessoa atrav√©s das √°rvores‚Äù - fundadora da Lisa Alert sobre as modernas tecnologias de pesquisa</a></li>
<li><a href="../pt473990/index.html">Aprenda o OpenGL. Li√ß√£o 7.2 - Texto de desenho</a></li>
<li><a href="../pt473992/index.html">Vis√£o geral de protocolos modernos em sistemas de automa√ß√£o industrial</a></li>
<li><a href="../pt473994/index.html">Carregamento de script moderno</a></li>
<li><a href="../pt473998/index.html">Holanda, ou l√° e volta</a></li>
<li><a href="../pt474000/index.html">IQBX - projetista eletromec√¢nico para clubes e entusiastas de bricolage [ideia conceitual]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>