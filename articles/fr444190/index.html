<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ üìï üèß Cr√©er les bordures d'une carte g√©n√©r√©e de mani√®re proc√©durale üëãüèø üå´Ô∏è üë®‚Äçüë®‚Äçüëß‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Scott Turner continue de travailler sur son jeu g√©n√©r√© de mani√®re proc√©durale et a maintenant d√©cid√© de s'attaquer au probl√®me de la conception des fr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cr√©er les bordures d'une carte g√©n√©r√©e de mani√®re proc√©durale</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444190/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ce/ea0/3df/0ceea03df1f07131e0ad27e6bbd45731.png" alt="image"></div><br>  <i>Scott Turner continue de travailler sur son jeu g√©n√©r√© de mani√®re proc√©durale et a maintenant d√©cid√© de s'attaquer au probl√®me de la conception des fronti√®res des cartes.</i>  <i>Pour ce faire, il doit r√©soudre plusieurs probl√®mes difficiles et m√™me cr√©er son propre langage pour d√©crire les fronti√®res.</i> <br><br>  Les bordures sont rest√©es un √©l√©ment important des cartes fantaisie, qui figuraient sur ma liste depuis un certain temps.  Les cartes fonctionnelles ont g√©n√©ralement une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fronti√®re</a> simple, mais les cartes fantastiques et les cartes m√©di√©vales, dont les premi√®res empruntent souvent des id√©es, ont des limites assez r√©fl√©chies et artistiques.  Ces limites indiquent clairement que la carte est intentionnellement rendue fantastique et donnent au spectateur un sentiment d'√©merveillement. <br><br>  Il existe actuellement quelques fa√ßons simples de tracer des fronti√®res dans mon jeu <b>Dragons Abound</b> .  Elle peut tracer une ligne simple ou double autour du p√©rim√®tre de la carte et ajouter des √©l√©ments simples dans les coins, comme dans ces figures: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aed/9f8/477/aed9f8477ef53b5550b742ea1fde36b2.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cac/37e/bac/cac37ebac81815955dfc940bacdc2eff.png"></div><br>  Le jeu peut √©galement ajouter un champ au bas de la bordure pour le nom de la carte.  Il existe plusieurs variantes de ce domaine dans <b>Dragons Abound</b> , y compris des √©l√©ments complexes tels que les fausses t√™tes de vis: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/42f/f6f/c3a/42ff6fc3adae5b40293bb82d5a1be325.png"></div><br>  Il existe une variabilit√© dans ces champs de nom, mais ils sont tous cr√©√©s manuellement. <br><br>  Un aspect int√©ressant des limites des cartes fantaisie est qu'elles sont √† la fois cr√©atives et mod√®les.  Souvent, ils se composent d'un petit nombre d'√©l√©ments simples qui se combinent de diff√©rentes mani√®res pour cr√©er un r√©sultat unique.  Comme toujours, la premi√®re √©tape lorsque je travaille avec un nouveau sujet est d'√©tudier une collection d'exemples de carte, de cr√©er un catalogue de types d'√©l√©ments de bordure et d'√©tudier leur apparence. <br><a name="habracut"></a><br>  La bordure la plus simple est une ligne longeant les bords de la carte et indiquant ses limites.  Comme je l'ai dit plus haut, on l'appelle aussi la "ligne de trame": <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/99f/c81/c98/99fc81c98e1092077272081464d28752.png"></div><br>  Il existe √©galement une variation avec l'emplacement des bordures sur la carte.  Dans cette version, la carte atteint les bords de l'image, mais la bordure cr√©e une bordure virtuelle √† l'int√©rieur de l'image: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43f/aef/1db/43faef1db7bf3af195c857d7ed673710.png"></div><br>  Cela peut √™tre fait avec n'importe quel type de bordure, mais il n'est g√©n√©ralement utilis√© qu'avec des bordures simples comme la bordure d'un cadre. <br><br>  Un concept de conception de cartes fantaisie populaire consiste √† simuler comme si elles √©taient dessin√©es sur un vieux parchemin d√©chir√©.  Parfois, cela est r√©alis√© en dessinant la bordure comme le bord rugueux du papier: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/907/cb2/ff1/907cb2ff125bbd178f9a16717e5e724f.png"></div><br>  Voici un exemple plus sophistiqu√©: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/751/860/d6e/751860d6e43ed2e857cf6f3ba7f766e0.png"></div><br>  D'apr√®s mon exp√©rience, cette m√©thode est devenue moins populaire parce que des outils num√©riques sont entr√©s en service.  Si vous voulez que la carte ressemble √† un vieux parchemin d√©chir√©, il est plus facile de lui appliquer la texture du parchemin que de la dessiner √† la main. <br><br>  L'outil le plus puissant pour cr√©er des bordures de carte est la r√©p√©tabilit√©.  Dans le cas le plus simple, il suffit de r√©p√©ter une seule ligne pour cr√©er deux lignes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31d/139/e12/31d139e129fe513e07937c5a2bd88979.png"></div><br>  Vous pouvez ajouter de l'int√©r√™t √† la carte en variant le style de l'√©l√©ment r√©p√©t√©, dans ce cas en combinant une seule ligne √©paisse avec une seule ligne mince: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/530/ccd/118/530ccd11872f4aa6a32d4b3271cf94f3.png"></div><br>  Selon l'√©l√©ment, diff√©rentes variantes de style sont possibles.  Dans cet exemple, la ligne se r√©p√®te, mais la couleur change: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fc7/89e/96c/fc789e96ccfba58ac4cb595e5ec33fb7.png"></div><br>  Pour cr√©er des motifs plus complexes, vous pouvez utiliser la ¬´r√©p√©tabilit√© r√©p√©table¬ª.  Cette bordure se compose d'environ cinq lignes simples avec des largeurs et des distances diff√©rentes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/796/488/ef4/796488ef402e59ed7e092e0e14ff2469.png"></div><br>  Cette bordure r√©p√®te les lignes, mais les s√©pare de sorte qu'elles ressemblent √† deux fines bordures distinctes.  Dans cette partie de l'article, je ne parlerai pas du traitement des angles, mais des angles diff√©rents pour les deux lignes contribuent √©galement √† cr√©er cette diff√©rence. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97b/fd8/336/97bfd833697b9278660772c1bd04ee46.png"></div><br>  S'agit-il de deux lignes, quatre ou six?  Je pense que tout d√©pend de la fa√ßon dont vous les dessinez! <br><br>  Un autre √©l√©ment de stylisation consiste √† remplir l'espace entre les √©l√©ments de couleur, de motif ou de texture.  Dans cet exemple, la bordure est devenue plus int√©ressante en raison du remplissage de couleur d'accentuation entre les deux lignes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d8/ccf/158/1d8ccf158b9ae0378ddaef1031ba15c9.png"></div><br>  Voici un exemple de la fa√ßon dont la bordure est remplie d'un motif: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f87/37d/bb2/f8737dbb215166947e42f0da1b45cfc7.png"></div><br>  De plus, les √©l√©ments peuvent √™tre stylis√©s de mani√®re √† avoir une apparence tridimensionnelle.  Voici une carte dans laquelle la bordure est ombr√©e de sorte qu'elle semble volumineuse: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a80/25b/695/a8025b69549773f8935d2b37680401a3.png"></div><br>  Dans cette carte, la bordure est ombr√©e pour avoir l'air en trois dimensions, et cela est combin√© avec l'emplacement des bordures √† l'int√©rieur des bords de la carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/36c/899/9e7/36c8999e74172c962aef40a4a9e3addc.png"></div><br>  Un autre √©l√©ment de bordure commun est l'√©chelle sous la forme de rayures multicolores: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ee/f62/0b8/4eef620b830eb0249d019229140e34e6.png"></div><br>  Ces rayures forment une grille ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">grille cartographique</a> ).  Sur les cartes r√©elles, l'√©chelle aide √† d√©terminer les distances, mais sur les cartes fantastiques, c'est principalement un √©l√©ment d√©coratif. <br><br>  Ces rayures sont g√©n√©ralement dessin√©es en noir et blanc, mais parfois du rouge ou une autre couleur est ajout√©e: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/450/f0f/f67/450f0ff67ac1fdf5c5e2ffaf8fbe80c0.png"></div><br>  Cet √©l√©ment peut √©galement √™tre combin√© avec d'autres, comme dans cet exemple avec des lignes et une √©chelle: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/313/d56/29d/313d5629d6ec8b8d7c7c4c1ead322a09.png"></div><br>  Cet exemple est un peu inhabituel.  G√©n√©ralement, l'√©chelle (le cas √©ch√©ant) est l'√©l√©ment le plus interne de la bordure. <br><br>  Sur cette carte, il existe diff√©rentes √©chelles avec diff√©rentes r√©solutions (ainsi que d'√©tranges notes runiques!): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74b/cd6/217/74bcd62173160e440a4ee6cfad2128c1.png"></div><br>  (Sur Reddit, l'utilisateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AbouBenAdhem</a> m'a inform√© que les marques runiques sont des nombres 48 et 47 √©crits en cun√©iforme babylonien. De plus, les ¬´√©chelles avec diff√©rentes r√©solutions¬ª ont six divisions divis√©es en dix divisions plus petites, ce qui correspond au syst√®me de nombres hexad√©cimal babylonien. Habituellement J'indique les sources des cartes, mais il y a trop de petites pi√®ces dans ce post, donc je n'ai pas pris la peine. Cependant, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette carte a √©t√©</a> cr√©√©e par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Thomas Ray</a> pour l'auteur S.E.Boleyn, donc, peut-√™tre, l'action dans ses livres se d√©roule dans l'entourage de Babylone.) <br><br>  En plus des lignes et de l'√©chelle, l'√©l√©ment le plus courant est un motif g√©om√©trique r√©p√©titif.  Il se compose souvent de parties telles que des cercles, des losanges et des rectangles: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31c/6ba/f61/31c6baf612bf2fa11a13905e4482d82e.png"></div><br>  Les √©l√©ments g√©om√©triques, comme les lignes, peuvent √™tre ombr√©s pour leur donner un aspect tridimensionnel: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43e/cc8/c33/43ecc8c33bbf3143ba32c18b878d16e2.png"></div><br>  Des fronti√®res complexes peuvent √™tre cr√©√©es en combinant ces √©l√©ments de diff√©rentes mani√®res.  Voici la bordure qui combine les lignes, les motifs g√©om√©triques et l'√©chelle: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b7/70e/c95/7b770ec95296ce07e0d18ede205c8798.png"></div><br>  Les exemples ci-dessus √©taient des cartes num√©riques, mais, bien s√ªr, la m√™me chose peut √™tre faite avec des cartes manuscrites.  Voici un exemple d'un motif g√©om√©trique simple cr√©√© √† la main: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6f7/c2d/e3d/6f7c2de3d5db82a9c7e9884d726be98e.png"></div><br>  Ces √©l√©ments peuvent √©galement √™tre combin√©s de mani√®re flexible de nombreuses mani√®res.  Voici un motif g√©om√©trique combin√© avec un ¬´bord d√©chiquet√©¬ª: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0fa/f1a/150/0faf1a15052e90a479428c4c495ad44c.png"></div><br>  Dans les exemples ci-dessus, le motif g√©om√©trique est assez simple.  Mais vous pouvez cr√©er des motifs tr√®s complexes en combinant de mani√®re diff√©rente les √©l√©ments g√©om√©triques de base: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/38e/13f/fc2/38e13ffc2a2aac266aabb291a7d7f0e6.png"></div><br>  Un autre √©l√©ment populaire du motif est le tissage ou le n≈ìud celtique: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07e/00e/8d8/07e00e8d868b6ca48be746fbe07e61ca.png"></div><br>  Voici une bordure en osier plus complexe contenant la couleur, l'√©chelle et d'autres √©l√©ments: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e1/580/140/5e158014012fffcbc51e2e3fe71772d6.png"></div><br>  Sur cette carte, le tissage est combin√© avec un √©l√©ment de bord d√©chiquet√©: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e95/4df/588/e954df58825bc42d408b61804a1287a9.png"></div><br>  En plus des motifs g√©om√©triques et du tissage, tout motif r√©p√©titif peut faire partie de la bordure de la carte.  Voici un exemple utilisant des formes ressemblant √† des pointes de fl√®ches: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7be/5ce/64e/7be5ce64eb09de2eeefdb18992978d03.png"></div><br>  Et voici un exemple avec un motif d'onde r√©p√©titif: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/841/c13/3c2/841c133c2f1c0f724b5d076e5ea415fb.png"></div><br>  Et enfin, des runes ou d'autres √©l√©ments de l'alphabet fantastique sont parfois ajout√©s aux bords des cartes fantaisie: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15f/6dd/3a3/15f6dd3a3e6191da02dc884193b72c82.png"></div><br>  Les exemples ci-dessus sont tir√©s de cartes fantastiques modernes, mais voici un exemple de carte historique (XVIIIe si√®cle) avec des lignes et un motif dessin√© √† la main: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d7/b9f/3b8/1d7b9f3b8f0c7eb296079c5f6f6b23aa.png"></div><br>  Bien s√ªr, vous pouvez trouver des exemples de cartes avec de nombreux autres √©l√©ments sur les bordures.  Certaines des plus belles sont enti√®rement dessin√©es √† la main et ont des d√©corations si soigneusement con√ßues qu'elles peuvent surpasser la carte elle-m√™me ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">World of Alma</a> , Francesca Baerald): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c7/004/e18/1c7004e186e0d2be63b98539375316ff.png"></div><br>  Cela vaut √©galement la peine de parler de <i>sym√©trie</i> .  Comme la r√©p√©tabilit√©, la sym√©trie est un outil puissant et les bordures de carte sont g√©n√©ralement sym√©triques ou comportent des √©l√©ments sym√©triques. <br><br>  De nombreuses bordures de carte sont sym√©triques de l'int√©rieur vers l'ext√©rieur, comme dans cet exemple: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/796/488/ef4/796488ef402e59ed7e092e0e14ff2469.png"></div><br>  Ici, la bordure est compos√©e de plusieurs lignes avec et sans remplissage, mais de l'ext√©rieur vers l'int√©rieur, elle se r√©p√®te id√©alement par rapport au centre de la bordure. <br><br>  Dans cet exemple plus complexe, la bordure est sym√©trique, √† l'exception de l'alignement des bandes noires et blanches d'√©chelle: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e1/580/140/5e158014012fffcbc51e2e3fe71772d6.png"></div><br>  √âtant donn√© que la duplication de l'√©chelle n'a pas de sens, elle est souvent consid√©r√©e comme un √©l√©ment distinct, m√™me si le reste de la bordure est sym√©trique. <br><br>  En plus de la sym√©trie interne-externe, les bordures sont souvent resym√©triques sur toute leur longueur.  Certaines bordures illustr√©es peuvent avoir un design simple qui s'√©tend sur toute la longueur du bord de la carte, mais dans la plupart des cas, le motif est assez court et se r√©p√®te, remplissant la bordure d'un coin √† l'autre: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b7/70e/c95/7b770ec95296ce07e0d18ede205c8798.png"></div><br>  Notez que dans cet exemple, le motif contient un √©l√©ment qui n'est pas sym√©trique (de gauche √† droite), mais le motif g√©n√©ral est sym√©trique et se r√©p√®te: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7be/5ce/64e/7be5ce64eb09de2eeefdb18992978d03.png"></div><br>  Une exception notable √† cette r√®gle est les bordures remplies de runes ou de caract√®res alphab√©tiques.  Souvent, ils se r√©v√®lent uniques, comme si un long message √©tait √©crit le long de la fronti√®re: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15f/6dd/3a3/15f6dd3a3e6191da02dc884193b72c82.png"></div><br>  Bien s√ªr, il existe de nombreux autres exemples d'√©l√©ments de bordure de carte que je n'ai pas examin√©s ici, mais nous avons d√©j√† un bon point de r√©f√©rence.  Dans les prochaines parties, je d√©velopperai plusieurs fonctions dans <b>Dragons Abound</b> pour d√©crire, afficher et g√©n√©rer des bordures de carte de mani√®re similaire √† ces exemples.  Dans la deuxi√®me partie, nous commencerons par d√©finir le langage de description des bordures des cartes. <br><br><h2>  2e partie </h2><br>  Dans cette partie, je vais cr√©er la version initiale du Map Border Description Language (MBDL). <br><br>  Pourquoi passer du temps √† cr√©er un langage de description de limites de carte?  Premi√®rement, ce sera l'objectif de ma g√©n√©ration proc√©durale.  Plus tard, j'√©crirai un algorithme pour cr√©er de nouvelles bordures de carte, et la sortie de cet algorithme sera une description de la nouvelle bordure sur MBDL.  Deuxi√®mement, MBDL servira de repr√©sentation textuelle des limites de la carte.  En particulier, je dois pouvoir sauvegarder et r√©utiliser mes limites.  Pour ce faire, j'ai besoin d'une notation de texte qui peut √™tre √©crite et utilis√©e pour recr√©er la bordure de la carte. <br><br>  Je vais commencer √† cr√©er MBDL en d√©finissant l'√©l√©ment le plus simple: la ligne.  La ligne a une couleur et une largeur.  Par cons√©quent, dans MBDL, je pr√©senterai la ligne sous cette forme: <br><br><blockquote><code>L(width, color)</code> </blockquote> <br>  Voici quelques exemples (d√©sol√© pour mes comp√©tences Photoshop): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/db2/db8/68e/db2db868ede7282a34c695f8062a691b.png"></div><br>  La s√©quence d'√©l√©ments est rendue de l'ext√©rieur vers l'int√©rieur (*), nous supposons donc que c'est la bordure en haut de la carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b7c/75e/b3a/b7c75eb3aefb8f77d1915166c0bdd979.png"></div><br>  Regardez le deuxi√®me exemple - une ligne avec des bordures est repr√©sent√©e comme trois √©l√©ments de ligne distincts. <br><br>  <i>(* Dessiner de l'ext√©rieur vers l'int√©rieur √©tait un choix arbitraire - il me semblait juste que c'√©tait plus naturel que de rendre de l'int√©rieur vers l'ext√©rieur. Malheureusement, comme cela s'est av√©r√© beaucoup plus tard, il y avait une bonne raison de travailler dans la direction oppos√©e. Bient√¥t je vais vous en parler, mais tout est laiss√© dans le post - ancien, car il faudrait beaucoup de temps pour refaire toutes les illustrations)</i> <br><br>  De mani√®re pratique, les espaces peuvent √™tre repr√©sent√©s sous forme de lignes sans couleur: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ba/1a4/171/0ba1a41719610641d7b5a5e26da0692e.png"></div><br>  Mais il serait plus visuel d'avoir un √©l√©ment d'espace vertical sp√©cifique: <br><br><blockquote>  VS (largeur) </blockquote><br>  Les √©l√©ments simples suivants sont des formes g√©om√©triques: rayures, losanges et ellipses.  Il est suppos√© que les lignes sont √©tir√©es sur toute la longueur de la bordure, de sorte qu'elles n'ont pas de longueur explicitement sp√©cifi√©e.  Mais les figures g√©om√©triques ne peuvent pas remplir toute la ligne.Par cons√©quent, en plus de la largeur (*), chacune doit avoir une longueur, une couleur de contour, une largeur de contour et une couleur de remplissage: <br><br><blockquote> <code>B(width, length, outline, outline width, fill) <br> D(width, length, outline, outline width, fill) <br> E(width, length, outline, outline width, fill)</code> </blockquote> <br>  (* J'ai accept√© de consid√©rer la largeur dans la direction de l'ext√©rieur vers l'int√©rieur, et la longueur est mesur√©e le long de la bordure.) <br><br>  Voici des exemples de formes g√©om√©triques simples: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a3d/fad/cf6/a3dfadcf6a5a98a9785b0b487a6e17fc.png"></div><br>  Pour que ces √©l√©ments remplissent toute la longueur de la bordure, ils doivent √™tre r√©p√©t√©s.  Pour indiquer le groupe d'√©l√©ments qui seront r√©p√©t√©s pour remplir la longueur de la bordure, j'utilise des crochets: <br><br><blockquote> <code>[ element element element ... ]</code> </blockquote> <br>  Voici un exemple d'un motif r√©p√©titif de rectangles et de losanges: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/420/d88/64e/420d8864e72e178252766172dc0320ab.png"></div><br>  Parfois, j'ai besoin d'un espace (horizontal) entre les √©l√©ments d'un motif r√©p√©titif.  Bien que vous puissiez utiliser un √©l√©ment sans couleurs pour cr√©er un espace, il sera plus intelligent et plus pratique d'avoir un √©l√©ment d'espace horizontal: <br><br><blockquote> <code>HS(length)</code> </blockquote> <br>  La derni√®re fonction requise pour cette premi√®re it√©ration de MBDL est la possibilit√© d'empiler des √©l√©ments les uns sur les autres.  Voici un exemple de bordure: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ea/7e9/3f3/8ea7e93f3040563ef7ec2715ca39a14d.png"></div><br>  La fa√ßon la plus simple de le d√©crire est une large ligne jaune sous le motif sup√©rieur.  Vous pouvez impl√©menter cela de diff√©rentes mani√®res (par exemple, un espace vertical n√©gatif), mais j'ai d√©cid√© d'utiliser des accolades pour indiquer l'ordre des √©l√©ments vers l'int√©rieur: <br><br><blockquote> <code>{element element element ...}</code> </blockquote> <br>  En fait, cette entr√©e vous indique de vous rappeler o√π se trouvait le motif de l'ext√©rieur vers l'int√©rieur lorsque vous entrez les crochets, puis de revenir √† ce point lorsque vous quittez les crochets.  Les parenth√®ses peuvent √©galement √™tre consid√©r√©es comme une description des √©l√©ments occupant un espace vertical.  Par cons√©quent, la bordure illustr√©e ci-dessus peut √™tre d√©crite comme suit: <br><br><blockquote> <code><b>L(1, black) <br> {L(20, yellow)} <br> VS(3) <br> [B(5, 10, black, 3, none) <br> D(5, 10, black,3,red)] <br> VS(3) <br> L(1, black)</b></code> </blockquote> <br>  Nous dessinons une ligne noire, fixons o√π nous sommes, dessinons une ligne jaune, puis revenons √† la position pr√©c√©demment fix√©e, descendons un peu, dessinons un motif de rectangles et de losanges, descendons un peu, puis dessinons une autre ligne noire. <br><br>  Il y a beaucoup plus √† faire dans MBDL, mais cela suffit pour d√©crire les nombreuses limites des cartes.  L'√©tape suivante consiste √† convertir la description des limites du MBDL en bordure elle-m√™me.  Cela revient √† convertir une repr√©sentation √©crite d'un programme informatique (tel que Javascript) en ex√©cution de ce programme.  La premi√®re √©tape est l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">analyse lexicale (analyse) de la</a> langue - la transformation du texte source en une v√©ritable bordure de la carte ou en une sorte de forme interm√©diaire, qui est plus facile √† convertir en bordure. <br><br>  L'analyse est un domaine assez bien √©tudi√© de l'informatique.  L'analyse d'un langage n'est pas tr√®s simple, mais dans notre cas, il est bon (*) que MBDL soit une grammaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sans</a> contexte.  Les grammaires sans contexte sont analys√©es assez facilement, et il existe de nombreux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">outils d'analyse Javascript</a> pour elles.  Je me suis install√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nearley.js</a> , qui semble √™tre assez mature et (plus important encore) un outil bien document√©. <br><br>  <i>(* Ce n'est pas seulement de la chance, je me suis assur√© que la langue √©tait hors contexte.)</i> <br><br>  Je ne vais pas vous pr√©senter les grammaires sans contexte, mais la syntaxe Nearley est assez simple et vous devez comprendre le sens sans aucun probl√®me.  La grammaire Nearley consiste en un ensemble de r√®gles.  Chaque r√®gle a un caract√®re √† gauche, une fl√®che et la partie droite de la r√®gle, qui peut √™tre une s√©quence de caract√®res et de non-caract√®res, ainsi que diverses options s√©par√©es par le "|"  (ou): <br><br><blockquote> <code><b>border -&gt; element | element border <br> element -&gt;</b> ‚Äú <b>L"</b></code> </blockquote> <br>  Chacune des r√®gles stipule que le c√¥t√© gauche peut √™tre remplac√© par l'une des options du c√¥t√© droit.  Autrement dit, la premi√®re r√®gle dit qu'une bordure est un √©l√©ment, ou un √©l√©ment, suivie d'une autre bordure.  Qui lui-m√™me peut √™tre un √©l√©ment, ou un √©l√©ment suivi d'une bordure, etc.  La deuxi√®me r√®gle dit qu'un √©l√©ment ne peut √™tre qu'une cha√Æne "L".  Autrement dit, ensemble, ces r√®gles correspondent √† ces limites: <br><br><blockquote> <code><b>L <br> LLL</b></code> </blockquote> <br>  et ne correspondent pas √† de telles limites: <br><br><blockquote> <code><b>X <br> L3L</b></code> </blockquote> <br>  Soit dit en passant, si vous souhaitez exp√©rimenter cette grammaire (ou toute autre) dans Nearley, il existe un bac √† sable en ligne <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Vous pouvez entrer des cas de grammaire et de test pour voir ce qui correspond et ne correspond pas. <br><br>  Voici une d√©finition plus compl√®te d'une primitive de ligne: <br><br><blockquote> <code><b>@builtin ‚Äúnumber.ne" <br> @builtin ‚Äústring.ne" <br> border -&gt; element | element border <br> element -&gt; ‚ÄúL(" decimal ‚Äú," dqstring ‚Äú)"</b></code> </blockquote> <br>  Nearley a plusieurs √©l√©ments int√©gr√©s communs, et le nombre est l'un d'entre eux.  Par cons√©quent, je peux l'utiliser pour reconna√Ætre la largeur num√©rique d'une primitive de ligne.  Pour la reconnaissance des couleurs, j'utilise un autre √©l√©ment int√©gr√© et autorise l'utilisation de n'importe quelle cha√Æne entre guillemets. <br><br>  Ce serait bien d'ajouter des espaces entre diff√©rents personnages, alors faisons-le.  Nearley prend en charge les classes de caract√®res et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RBNF</a> pour ¬´z√©ro ou plus¬ª de quelque chose avec ¬´: *¬ª, donc je peux l'utiliser pour sp√©cifier ¬´z√©ro ou plusieurs espaces¬ª et le coller n'importe o√π pour autoriser les espaces dans les descriptions: <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element border <br> WS -&gt; [\s]:* <br> number -&gt; WS decimal WS <br> color -&gt; WS dqstring WS <br> element -&gt; "L(" number "," color ")"</b></code> </blockquote> <br>  Cependant, l'utilisation de WS partout rend la lecture de la grammaire difficile, donc je vais les abandonner, mais imaginez qu'ils le sont. <br><br>  Un √©l√©ment peut √©galement √™tre un espace vertical: <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")"</b></code> </blockquote> <br>  Cela correspond √† ces limites <br><br><blockquote> <code><b>L(3.5,"black") VS(3.5)</b></code> </blockquote> <br>  Viennent ensuite les primitives de bande, losange et ellipse. <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")"</b></code> </blockquote> <br>  Il correspondra √† ces √©l√©ments <br><br><blockquote> <code><b>B(34, 17, "white", 3, "black")</b></code> </blockquote> <br>  (Notez que les primitives g√©om√©triques ne sont pas des ¬´√©l√©ments¬ª car elles ne peuvent pas √™tre seules au niveau sup√©rieur. Elles doivent √™tre entour√©es d'un motif.) <br><br>  J'ai aussi besoin d'une primitive d'espace horizontal: <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "HS(" number ")"</b></code> </blockquote> <br>  Maintenant, je vais ajouter une op√©ration de r√©p√©tition de motif.  Il s'agit d'une s√©quence d'un ou plusieurs √©l√©ments entre crochets.  J'utiliserai l'op√©rateur RBNF ": +", qui signifie ici "un ou plusieurs". <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "HS(" number ")" <br> element -&gt; "[" (geometric):+ "]"</b></code> </blockquote> <br>  Notez que le motif ne peut √™tre rempli qu'avec des primitives g√©om√©triques.  Nous ne pouvons pas, par exemple, placer une ligne √† l'int√©rieur d'un motif.  L'√©l√©ment pattern va maintenant correspondre √† quelque chose comme √ßa. <br><br><blockquote> <code><b>[B(34,17,"white",3,"black")E(13,21,"white",3,"rgb(27,0,0)")]</b></code> </blockquote> <br>  La derni√®re partie du langage est l'op√©rateur de superposition.  Il s'agit d'un nombre quelconque d'√©l√©ments entre accolades. <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; element | element " " border <br> number -&gt; decimal <br> color -&gt; dqstring <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "HS(" number ")" <br> element -&gt; "[" (geometric ):+ "]" <br> element -&gt; "{" (element ):+ "}"</b></code> </blockquote> <br>  ce qui nous permet de faire ce qui suit: <br><br><blockquote> <code><b>{L(3.5,"rgb(98,76,15)")VS(3.5)}</b></code> </blockquote> <br>  (Notez que contrairement √† l'op√©rateur de r√©p√©tition, l'op√©rateur de superposition peut √™tre utilis√© en interne.) <br><br>  Apr√®s avoir nettoy√© la description et ajout√© des espaces aux endroits n√©cessaires, nous obtenons la grammaire MBDL suivante: <br><br><blockquote> <code><b>@builtin "number.ne" <br> @builtin "string.ne" <br> border -&gt; (element WS):+ <br> WS -&gt; [\s]:* <br> number -&gt; WS decimal WS <br> color -&gt; WS dqstring WS <br> element -&gt; "L(" number "," color ")" <br> element -&gt; "VS(" number ")" <br> element -&gt; "(" WS (element WS):+ ")" <br> element -&gt; "[" WS (geometric WS):+ "]" <br> geometric -&gt; "B(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "E(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "D(" number "," number "," color "," number "," color ")" <br> geometric -&gt; "HS(" number ")"</b></code> </blockquote> <br>  Ainsi, MBDL est maintenant d√©fini et nous avons cr√©√© une grammaire du langage.  Il peut √™tre utilis√© avec Nearley pour reconna√Ætre les cha√Ænes de langue.  Avant de plonger dans MBDL / Nearley, je voudrais impl√©menter les primitives utilis√©es dans MBDL afin que la fronti√®re d√©crite sur MBDL puisse √™tre affich√©e.  C'est ce que nous ferons dans la partie suivante. <br><br><h2>  3e partie </h2><br>  Nous allons maintenant commencer √† impl√©menter les primitives de rendu elles-m√™mes.  (√Ä ce stade, je n'ai pas encore besoin de lier l'analyseur aux primitives de rendu. Pour les tests, je vais simplement les appeler manuellement.) <br><br>  Commen√ßons par la ligne primitive.  Rappelez-vous √† quoi √ßa ressemble: <br><br><blockquote> <code><b>L(width, color)</b></code> </blockquote> <br>  En plus de la largeur et de la couleur, il existe un param√®tre implicite ici - la distance par rapport au bord ext√©rieur de la carte.  (Je dessine les bordures du bord de la carte vers l'ext√©rieur. Notez que nous sommes partis d'une autre!) Il ne doit pas pointer vers le MBDL, car cela peut √™tre suivi par l'interpr√©teur qui ex√©cute le MBDL pour dessiner la fronti√®re.  Cependant, cela doit √™tre entr√© pour toutes les primitives de rendu afin qu'elles sachent o√π les dessiner.  J'appellerai ce param√®tre offset. <br><br>  Si je n'avais besoin que de tracer une bordure en haut de la carte, la primitive de ligne serait tr√®s simple √† mettre en ≈ìuvre.  Cependant, en fait, je devrai tirer d'en haut.  en bas, √† gauche et √† droite.  (Peut-√™tre qu'un jour je r√©aliserai des bordures obliques ou courbes, mais pour l'instant nous respecterons les bordures rectangulaires standard.) De plus, la longueur et l'emplacement de l'√©l√©ment de ligne d√©pendent de la taille de la carte (ainsi que du d√©calage).  Par cons√©quent, en tant que param√®tres, j'ai besoin de toutes ces donn√©es. <br><br>  Apr√®s avoir d√©fini tous ces param√®tres, il suffit de cr√©er simplement une primitive de ligne et de l'utiliser pour tracer une ligne autour de la carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a56/74f/785/a5674f78512bef22e569656701203401.png"></div><br>  (Notez que j'utilise diverses fonctions de <b>Dragons Abound</b> pour tracer la ligne ¬´manuscrite¬ª.) Essayons de cr√©er une bordure plus complexe: <br><br><blockquote> <code><b>L(3, black) L(10, gold) L(3, black)</b></code> </blockquote> <br>  Cela ressemble √† ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/86a/ad8/849/86aad88494c1c17f993524ef09ef9b2f.png"></div><br>  Assez bien.  Notez qu'il existe des endroits o√π les lignes noires et la ligne dor√©e ne sont pas tout √† fait align√©es en raison des fluctuations.  Si je veux me d√©barrasser de ces taches, vous pouvez simplement r√©duire la quantit√© d'oscillation. <br><br>  L'impl√©mentation d'une primitive d'espace vertical est assez simple;  il effectue juste un incr√©ment de d√©calage.  Ajoutons un peu d'espace: <br><br><blockquote> <code><b>L(3, black) L(10, gold) L(3, black) <br> VS(5) <br> L(3, black) L(10, red) L(3, black)</b></code> </blockquote> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eab/471/b90/eab471b902eb44e703f460d700936937.png"></div><br>  Lorsque vous dessinez des lignes, des angles peuvent √™tre obtenus en dessinant entre le d√©calage et le dessin le long de la carte dans le sens horaire.  Mais en g√©n√©ral, je dois impl√©menter la troncature de chaque c√¥t√© de la bordure de la carte pour cr√©er une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">connexion angulaire avec un biseau</a> .  Cela sera n√©cessaire pour cr√©er des bordures avec des motifs correctement joints aux coins et, dans le cas g√©n√©ral, √©liminera la n√©cessit√© de dessiner des √©l√©ments avec des bords √† un angle qui serait autrement requis.  (*) <br><br>  <i>(Remarque: comme cela sera dit dans les parties suivantes, au fil du temps, j'ai refus√© d'utiliser des r√©gions de troncature lors de la mise en ≈ìuvre des angles. La principale raison est que pour cr√©er des angles complexes, par exemple, des d√©calages carr√©s:</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97b/fd8/336/97bfd833697b9278660772c1bd04ee46.png"></div><br>  <i>des zones de troncature de plus en plus complexes sont n√©cessaires.</i>  <i>De plus, au fil du temps, j'ai trouv√© une meilleure fa√ßon de travailler avec des motifs dans les coins.</i>  <i>Au lieu de retourner et de r√©√©crire cette partie de l'article, j'ai d√©cid√© de la laisser pour illustrer le processus de ¬´cr√©ativit√©¬ª.)</i> <br><br>  L'id√©e principale est de tronquer chaque bordure en diagonale et de cr√©er quatre zones tronqu√©es dans lesquelles chaque c√¥t√© de la bordure sera trac√©: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9fb/31a/cf9/9fb31acf993cde46b6a7fdc408be6afd.png"></div><br>  Lors de la troncature, tout ce qui est dessin√© dans la zone correspondante sera coup√© √† l'angle souhait√©. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52b/f00/f02/52bf00f026f6979f6425345389fa646a.png"></div><br>  Malheureusement, cela cr√©e de petits espaces le long des lignes diagonales, probablement parce que le navigateur effectue imparfaitement le lissage le long du bord tronqu√©.  Le test a montr√© qu'un arri√®re-plan brille √† travers l'espace entre les deux bords.  Il √©tait possible de r√©soudre ce probl√®me en d√©veloppant un peu un des masques (la moiti√© du pixel semble √™tre suffisant), mais cela ne r√©sout pas toujours le probl√®me. <br><br>  Ensuite, vous devez impl√©menter des formes g√©om√©triques.  Contrairement aux lignes, elles sont r√©p√©t√©es dans le motif, remplissant le c√¥t√© de la bordure de la carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/420/d88/64e/420d8864e72e178252766172dc0320ab.png"></div><br>  Une personne dessine ce motif de gauche √† droite, dessine un rectangle, un losange, puis r√©p√®te la m√™me chose jusqu'√† ce que toute la bordure soit remplie.  Par cons√©quent, cela peut √©galement √™tre impl√©ment√© dans le programme en dessinant un motif le long de la bordure.  Cependant, il sera plus facile de dessiner d'abord tous les rectangles, puis tous les losanges.  Il suffira de dessiner le long de la bordure la m√™me figure g√©om√©trique √† intervalles.  Et il est tr√®s pratique que chaque √©l√©ment ait le m√™me intervalle.  Bien s√ªr, une personne ne le ferait pas, car il est trop difficile de ranger les √©l√©ments aux bons endroits, mais ce n'est pas un probl√®me pour le programme. <br><br>  En d'autres termes, la proc√©dure de dessin de formes g√©om√©triques simples n√©cessite des param√®tres dans lesquels toutes les tailles et couleurs de la figure sont transmises (c'est-√†-dire largeur, longueur, √©paisseur de ligne, couleur de ligne et remplissage), ainsi que la position de d√©part (qui, pour des raisons qui deviendront claires bient√¥t, Je consid√©rerai le centre de la figure), l'intervalle d'espace horizontal pour la transition entre les r√©p√©titions et le nombre de r√©p√©titions.  Il sera √©galement pratique d'indiquer la direction de r√©p√©tition sous la forme du vecteur [dx, dy], afin que nous puissions effectuer des r√©p√©titions de gauche √† droite, de droite √† gauche, de haut en bas, en changeant simplement le vecteur et le point de d√©part.  Assemblez le tout et obtenez une bande de formes r√©p√©titives: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/409/bcd/c33/409bcdc33756610ac6ace2d0fde0a3a4.png"></div><br>  En utilisant ce code plusieurs fois et en effectuant le rendu avec le m√™me d√©calage, je peux combiner les bandes noires et blanches pour cr√©er l'√©chelle de la carte: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b88/8f5/0d9/b888f50d9f164b9319cc8b3cf8d38588.png"></div><br>  Avant de commencer √† comprendre comment appliquer tout cela √† la bordure r√©elle de la carte, impl√©mentons d'abord la m√™me fonctionnalit√© pour les ellipses et les losanges. <br><br>  Les losanges ne sont que des rectangles avec des sommets pivot√©s, vous n'avez donc qu'√† apporter une petite modification au code.  Il s'est av√©r√© que je n'ai toujours pas de code pr√™t √† l'emploi pour le rendu de l'ellipse, mais il est tr√®s facile de prendre la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vue param√©trique de l'ellipse</a> et de cr√©er une fonction me donnant les points de l'ellipse: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3fa/74e/079/3fa74e079dd2c29afa5acb0135d4092f.png"></div><br>  Voici un exemple (cr√©√© manuellement) qui utilise les fonctionnalit√©s impl√©ment√©es ci-dessus: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bf8/bf2/d39/bf8bf2d3992b34bc173622dc86c0d8b5.png"></div><br>  Pour une si petite quantit√© de code, √ßa a l'air plut√¥t bien! <br><br>  R√©solvons maintenant le cas complexe des bordures avec des √©l√©ments r√©p√©titifs: les coins. <br><br>  S'il existe une bordure avec des √©l√©ments r√©p√©titifs, il existe plusieurs fa√ßons de r√©soudre le probl√®me des coins.  La premi√®re consiste √† ajuster les r√©p√©titions afin qu'elles soient ex√©cut√©es dans les coins sans mariage notable: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b7/70e/c95/7b770ec95296ce07e0d18ede205c8798.png"></div><br>  Une autre option consiste √† arr√™ter la r√©p√©tition quelque part pr√®s du coin des deux c√¥t√©s.  Cela est souvent fait si le motif ne peut pas √™tre facilement ¬´tourn√©¬ª dans le coin: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15f/6dd/3a3/15f6dd3a3e6191da02dc884193b72c82.png"></div><br>  La derni√®re option consiste √† fermer le motif avec une d√©coration d'angle: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7be/5ce/64e/7be5ce64eb09de2eeefdb18992978d03.png"></div><br>  Un jour, j'arriverai aux d√©corations d'angle, mais pour l'instant, nous utiliserons la premi√®re option.  Comment faire tourner un motif de rayures ou de cercles dans les coins de la carte sans espaces? <br><br>  L'id√©e principale est de placer l'√©l√©ment de motif exactement dans le coin de sorte que la moiti√© de celui-ci se trouve sur un bord de la carte et l'autre sur celui adjacent.  Dans cet exemple, le cercle est exactement dans le coin et peut √™tre trac√© dans n'importe quelle direction: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7b7/70e/c95/7b770ec95296ce07e0d18ede205c8798.png"></div><br>  Dans d'autres cas, l'√©l√©ment est √† moiti√© dessin√© dans une direction et √† moiti√© dans l'autre, mais les bords co√Øncident: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ee/f62/0b8/4eef620b830eb0249d019229140e34e6.png"></div><br>  Dans ce cas, une bande blanche est dessin√©e des deux c√¥t√©s, mais est connect√©e dans le coin sans espaces. <br><br>  Il y a deux aspects √† consid√©rer lors du placement d'un √©l√©ment dans un coin. <br><br>  Tout d'abord, l'√©l√©ment d'angle sera divis√© et mis en miroir par rapport √† la diagonale passant par le centre de l'√©l√©ment.  Les √©l√©ments √† sym√©trie radiale, par exemple les carr√©s, les cercles et les √©toiles, ne changeront pas de forme.  Les √©l√©ments sans sym√©trie radiale, par exemple les rectangles et les losanges, changeront de forme lors de la sym√©trie par rapport √† la diagonale. <br><br>  Deuxi√®mement, pour que les √©l√©ments d'angle des deux c√¥t√©s se connectent correctement, il doit y avoir un nombre entier d'√©l√©ments (*) le long des deux c√¥t√©s de la carte.  Ils ne doivent pas n√©cessairement √™tre le m√™me nombre, mais il doit y avoir un nombre entier d'√©l√©ments des deux c√¥t√©s.  Si un nombre fractionnaire de motifs est contenu sur un c√¥t√©, alors d'un c√¥t√© le motif ne co√Øncidera pas avec le c√¥t√© adjacent. <br><br>  <i>(* Dans certains cas, par exemple, avec de longues rayures, une r√©p√©tition partielle peut se produire avec une r√©p√©tition compl√®te et les √©l√©ments seront toujours align√©s. Cependant, l'√©l√©ment d'angle r√©sultant sera asym√©trique et diff√©rera en longueur du m√™me √©l√©ment sur les c√¥t√©s de la carte. Un exemple de cela peut √™tre vu ici:</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/263/418/110/263418110aafe94ef8c62d57e8540371.png"></div><br>  <i>Une barre d'√©chelle blanche appara√Æt avec diff√©rentes r√©p√©titions partielles et, par cons√©quent, un √©l√©ment d√©cal√© par rapport au centre est obtenu.</i>  <i>Pour l'√©chelle de la carte, ce n'est pas toujours le cas, car elle montre la distance absolue et n'a pas besoin d'√™tre sym√©trique.</i>  <i>Mais pour un motif d√©coratif, cela semble g√©n√©ralement mauvais.)</i> <br><br>  Voici un exemple montrant comment un nombre entier de r√©p√©titions est coup√© exactement dans le coin: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ab/8de/0a3/8ab8de0a3452332e2813b3771091b165.png"></div><br>  Si vous faites la m√™me chose des quatre c√¥t√©s, les coins co√Øncideront et le motif sera parfaitement situ√© sur toute la longueur de la bordure: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dfc/c9a/e46/dfcc9ae46a68807e983705e553aa2ba3.png"></div><br>  Apr√®s un examen attentif, vous remarquerez que le motif ne se produit pas exactement dans les coins.  La moiti√© du cercle dans chaque coin est prise de chaque c√¥t√©, et ces deux moiti√©s sont dessin√©es ind√©pendamment √† la main, elles ne sont donc pas parfaites.  Mais maintenant, ils sont assez proches de cela. <br><br>  Ainsi, nous pouvons r√©aliser une connexion parfaite du motif dans les coins, en choisissant un nombre entier de r√©p√©titions pour chaque bord.  Cependant, la solution √† ce probl√®me n'est pas anodine. <br><br>  Supposons d'abord que nous savons que le c√¥t√© mesure 866 pixels et que nous voulons r√©p√©ter l'√©l√©ment 43 fois.  Ensuite, l'√©l√©ment doit √™tre r√©p√©t√© tous les 20,14 pixels.  Comment d√©finir la longueur sp√©cifique d'un √©l√©ment (et dans le cas g√©n√©ral, un mod√®le d'√©l√©ments)?  Dans l'exemple ci-dessus, j'ai ajout√© un espace suppl√©mentaire entre les cercles.  Mais si les cercles se touchaient initialement, cela changera le sch√©ma.  Peut-√™tre vaut-il la peine d'√©tirer les cercles pour qu'ils continuent √† se toucher? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e36/2b0/ebd/e362b0ebd3fd04e5d8b00de5d3aba151.png"></div><br>  Maintenant, les √©l√©ments se touchent, mais les cercles se sont transform√©s en ellipses et les coins ont une forme √©trange.  (Rappelez-vous, j'ai dit que les √©l√©ments sans sym√©trie radiale changent de forme lorsqu'ils sont r√©fl√©chis par rapport √† un angle? Pour les rayures, ce ne sera pas un gros probl√®me.) Ou, peut-√™tre, cela vaut la peine de compresser tous les √©l√©ments afin qu'ils se touchent et s'adaptent dans une longueur appropri√©e: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d7c/ba8/0af/d7cba80afb431dc6c9afc52d7ad94b5c.png"></div><br>  Mais pour r√©aliser cela, nous devons rendre les √©l√©ments beaucoup plus petits qu'ils ne l'√©taient √† l'origine.  Aucune de ces options ne semble parfaite. <br><br>  Le deuxi√®me probl√®me se produit lorsque les c√¥t√©s de la carte sont de tailles diff√©rentes.  Maintenant, nous devons r√©soudre le probl√®me de trouver un nombre entier de r√©p√©titions adapt√© aux deux c√¥t√©s.  Il serait id√©al de trouver une solution adapt√©e aux deux c√¥t√©s.  Mais je ne veux pas faire cela au prix d'un changement de mod√®le trop important.  Il peut √™tre pr√©f√©rable de cr√©er des motifs l√©g√®rement diff√©rents des deux c√¥t√©s s'ils sont tous les deux suffisamment proches du motif d'origine. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Et enfin, le troisi√®me probl√®me se pose lorsque j'utilise la fonction de superposition de plusieurs √©l√©ments les uns sur les autres: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d9/4ed/6ac/4d94ed6acf107193f2109bd2b2f07a67.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je ne veux pas apporter de modifications au mod√®le qui d√©truirait la relation entre les √©l√©ments. </font><font style="vertical-align: inherit;">Je pense qu'avec une mise √† l'√©chelle correcte, les ratios dans leur ensemble resteront, mais je dois tester cela. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√¢che int√©ressante, non? </font><font style="vertical-align: inherit;">Jusqu'√† pr√©sent, je n'ai pas de solutions de haute qualit√© pour elle. </font><font style="vertical-align: inherit;">Peut-√™tre qu'ils appara√Ætront plus tard!</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Partie 4 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons donc impl√©ment√© des primitives pour dessiner des lignes et des formes g√©om√©triques. J'ai commenc√© √† travailler sur l'utilisation de formes r√©p√©titives pour remplir les bordures et j'ai parl√© des difficult√©s √† placer des motifs arbitraires sur la bordure de la carte afin qu'ils s'adaptent parfaitement dans les coins. Le probl√®me principal est que dans le cas g√©n√©ral, vous devez allonger (ou raccourcir) le motif pour qu'il s'adapte lat√©ralement. Les options pour changer la longueur du motif - ajouter ou supprimer des espaces, changer la longueur des √©l√©ments des motifs - entra√Ænent divers changements dans le motif lui-m√™me. Il semble que la t√¢che de s√©lectionner un motif √† partir de plusieurs √©l√©ments soit tr√®s difficile!</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque je rencontre des t√¢ches apparemment sans compromis, j'aime commencer par impl√©menter une version simple. Les t√¢ches infructueuses peuvent souvent √™tre r√©solues en r√©solvant √† plusieurs reprises des probl√®mes ¬´simples¬ª jusqu'√† ce que le r√©sultat soit suffisamment bon. Et parfois, la mise en ≈ìuvre d'une version simple donne une certaine compr√©hension qui simplifie la solution d'un probl√®me plus complexe. Si cela ne s'am√©liore pas et que le probl√®me reste inconfortable, alors nous aurons au moins une version simplifi√©e qui peut toujours √™tre utile, bien que pas tout √† fait comme il se doit.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le moyen le plus simple consiste √† modifier la longueur du motif en ajoutant des longueurs sans rien changer au motif. </font><font style="vertical-align: inherit;">Essentiellement, cela ajoute un espace vide √† la fin du motif. </font><font style="vertical-align: inherit;">(Remarque: il est pr√©f√©rable de r√©partir l'espace vide entre tous les √©l√©ments du motif.) Il convient de consid√©rer qu'une telle solution ne peut que rallonger le motif. </font><font style="vertical-align: inherit;">Nous pouvons toujours ajouter de l'espace vide au motif, mais ne pouvons pas le prendre si n√©cessaire - peut-√™tre qu'il n'y aura plus d'espace vide dans le motif! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Avec cette approche, l'algorithme de localisation des motifs sur le c√¥t√© de la carte sera tr√®s simple:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Divisez la longueur du c√¥t√© de la carte par la longueur du motif et arrondissez-la pour d√©terminer le nombre de r√©p√©titions du motif qui correspondent √† ce c√¥t√©. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La distance entre les √©l√©ments dans ce cas sera √©gale √† la longueur du c√¥t√© divis√©e par le nombre de r√©p√©titions. </font><font style="vertical-align: inherit;">(C'est le plus proche de l'emplacement d'origine, √©tant donn√© que nous ne pouvons ajouter que de l'espace.)</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tracez un motif sur le c√¥t√©, en tenant compte de la distance calcul√©e. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il √©tait difficile de mettre en ≈ìuvre ce syst√®me. </font><font style="vertical-align: inherit;">Les virages tenaces ne voulaient pas co√Øncider. </font><font style="vertical-align: inherit;">Il m'a fallu trop de temps pour r√©aliser que lorsque la carte n'est pas carr√©e, je ne peux pas dessiner des zones de troncature sur quatre c√¥t√©s √† partir du centre de la carte, car cela cr√©e des angles de troncature qui ne sont pas √©gaux √† 45 degr√©s. </font><font style="vertical-align: inherit;">En fait, les zones de troncature devraient ressembler √† l'arri√®re d'une enveloppe:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b20/29a/beb/b2029abeb54302b5f7d3335a15c95f86.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quand j'ai compris cela, l'algorithme a commenc√© √† fonctionner sans probl√®me. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Mais n'oubliez pas la note pr√©c√©dente qu'au fil du temps j'ai abandonn√© les zones de troncature!)</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Voici un exemple avec un ratio d'environ 2: 1:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bff/739/d19/bff739d19d76fdb4db63033b970eb241.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sur cette √©chelle, c'est assez difficile √† remarquer, mais les coins se connectent correctement et il n'y a qu'une l√©g√®re diff√©rence visuelle entre les c√¥t√©s. </font><font style="vertical-align: inherit;">Dans ce cas, l'algorithme d'alignement des motifs n'a besoin que d'ins√©rer des pixels fractionnaires, il est donc invisible √† l'≈ìil, notamment parce que les contours des cercles se chevauchent d'un pixel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voici un autre exemple avec des rayures:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa8/852/625/aa8852625e15121ce822cc6ca5fe8742.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ceci est le haut de la bordure carr√©e. </font><font style="vertical-align: inherit;">Voici la m√™me bordure sur une carte plus rectangulaire:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90d/207/9b1/90d2079b1e869c59ee204f1a75f5dbc7.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, vous pouvez voir que sur le c√¥t√© de la carte il y a un √©cart visuellement plus grand entre les bandes. </font><font style="vertical-align: inherit;">L'algorithme ne doit pas ins√©rer plus d'espace que la longueur d'un √©l√©ment complet; </font><font style="vertical-align: inherit;">par cons√©quent, le pire des cas se produit lorsque nous avons des √©l√©ments longs et un c√¥t√© court l√©g√®rement diff√©rent d'une taille appropri√©e. </font><font style="vertical-align: inherit;">Mais dans la plupart des cas pratiques, l'alignement n'est pas tr√®s nocif. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voici un exemple avec un motif de plusieurs √©l√©ments:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d18/602/4f8/d186024f8ee1e4fbcd5918c63537a024.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ici, les rayures chevauchent les rayures: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c60/af7/ad6/c60af7ad6c71ee4ef1850f0bf194af62.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez voir que puisque le m√™me alignement est effectu√© pour chaque √©l√©ment, les bandes restent centr√©es les unes par rapport aux autres. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai sugg√©r√© qu'une bonne solution pour placer le motif sur le c√¥t√© de la carte serait difficile, mais une approche tr√®s simple avec une distribution uniforme de l'√©l√©ment de motif pour remplir l'espace souhait√© fonctionne assez bien pour de nombreux motifs. C'est un rappel pour nous tous: il n'est pas n√©cessaire de supposer que la d√©cision doit √™tre compliqu√©e; cela peut √™tre plus facile que vous ne le pensez! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, cette solution ne fonctionne pas pour les motifs avec des √©l√©ments en contact, par exemple, pour l'√©chelle de la carte. Dans ce cas, l'ajout d'espace d√©cale les √©l√©ments:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3cd/d7e/27f/3cdd7e27f8c2d92be26d36e7b4807f5a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre option pour allonger un motif, que j'ai mentionn√© ci-dessus, consiste √† √©tirer les √©l√©ments individuels du motif. </font><font style="vertical-align: inherit;">Il convient √† quelque chose comme un motif d'√©chelle, mais il aura l'air mauvais dans un motif avec des √©l√©ments sym√©triques, car l'√©tirement les rendra asym√©triques. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La mise en ≈ìuvre de l'option avec √©tirement s'est av√©r√©e plus difficile que pr√©vu, principalement parce que j'ai d√ª √©tirer les √©l√©ments √† diff√©rents bords de la carte de diff√©rentes tailles (car la carte n'est peut-√™tre pas carr√©e mais rectangulaire), et √©galement changer dynamiquement la disposition des √©l√©ments en fonction des nouveaux √©tir√©s. tailles. </font><font style="vertical-align: inherit;">Mais apr√®s quelques heures, j'ai r√©ussi √† y parvenir:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d1c/552/3c4/d1c5523c43a9828cd9c1c1bee6f4bbde.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> J'ai maintenant toutes les fonctionnalit√©s n√©cessaires pour dessiner la bordure de la carte (bien que les √©l√©ments de bordure eux-m√™mes soient cr√©√©s manuellement): </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d2b/ccc/326/d2bccc326a0500f92267378e137e2f6e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> J'ai converti l'image en niveaux de gris, car je ne voulais pas me soucier de la s√©lection des couleurs, et la carte elle-m√™me est plut√¥t ennuyeuse, mais comme preuve de concept, les bordures sont plut√¥t jolies. </font></font><br><br><h2>  Partie 5 </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la partie 2, j'ai d√©velopp√© la grammaire MBDL (Map Border Description Language) et dans les parties 3 et 4, j'ai impl√©ment√© des proc√©dures pour ex√©cuter toutes les primitives de langage. </font><font style="vertical-align: inherit;">Je vais maintenant travailler sur la connexion de ces parties afin de pouvoir d√©crire la bordure sur MBDL et la dessiner sur la carte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la partie 3, j'ai √©crit la grammaire MBDL pour qu'elle fonctionne avec l' </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">outil d'analyse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Javascript </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;">Nearley</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">La grammaire termin√©e ressemble √† ceci:</font></font><br><br><blockquote> <code><b>@builtin</b> <b>"</b> <b>number.ne"</b> <br> <b>@builtin</b> <b>"</b> <b>string.ne"</b> <br> <b>border -&gt; (element WS):+ <br> WS -&gt; [\s]:* <br> number -&gt; WS decimal WS <br> color -&gt; WS dqstring WS <br> element -&gt;</b> <b>"</b> <b>L(" number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)"</b> <br> <b>element -&gt;</b> <b>"</b> <b>VS(" number</b> <b>"</b> <b>)"</b> <br> <b>element -&gt;</b> <b>"</b> <b>(" WS (element WS):+</b> <b>"</b> <b>)"</b> <br> <b>element -&gt;</b> <b>"</b> <b>[" WS (geometric WS):+</b> <b>"</b> <b>]"</b> <br> <b>geometric -&gt;</b> <b>"</b> <b>B(" number</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)"</b> <br> <b>geometric -&gt;</b> <b>"</b> <b>E(" number</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)"</b> <br> <b>geometric -&gt;</b> <b>"</b> <b>D(" number</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>," number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)"</b> <br> <b>geometric -&gt;</b> <b>"</b> <b>HS(" number</b> <b>"</b> <b>)"</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Par d√©faut, lors de l'analyse r√©ussie d'une r√®gle √† l'aide de Nearley, la r√®gle renvoie un tableau contenant tous les √©l√©ments qui correspondent au c√¥t√© droit de la r√®gle. </font><font style="vertical-align: inherit;">Par exemple, si la r√®gle</font></font><br><br><blockquote> <code><b>test -&gt;</b> <b>"</b> <b>A" |</b> <b>"</b> <b>B" |</b> <b>"</b> <b>C"</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> assorti avec de la ficelle </font></font><br><br><blockquote> <code><b>A</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alors Nearley reviendra </font></font><br><br><blockquote> <code><b>[</b> <b>"</b> <b>A" ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un tableau avec une seule valeur est la cha√Æne ¬´A¬ª correspondant au c√¥t√© droit de la r√®gle. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que retourne Nearley lorsqu'un √©l√©ment est analys√© √† l'aide de cette r√®gle?</font></font><br><br><blockquote> <code><b>number -&gt; WS decimal WS</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a trois parties √† droite de la r√®gle, elle renverra donc un tableau avec trois valeurs. </font><font style="vertical-align: inherit;">La premi√®re valeur sera celle qui renvoie la r√®gle pour WS, la deuxi√®me valeur sera celle qui renverra la r√®gle pour la d√©cimale et la troisi√®me valeur sera celle qui renverra la r√®gle pour WS. </font><font style="vertical-align: inherit;">Si, en utilisant la r√®gle ci-dessus, je pars "57", alors le r√©sultat sera le suivant:</font></font><br><br><blockquote> <code><b>[ <br> [ " " ], <br> [ "5", "7" ], <br> [ ] <br> ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le r√©sultat final de l'analyse de Nearley sera un tableau imbriqu√© de tableaux, qui est un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arbre de syntaxe</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dans certains cas, l'arbre de syntaxe est une repr√©sentation tr√®s utile; dans d'autres cas, pas tout √† fait. Dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dragons Abound</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , par exemple, un tel arbre n'est pas particuli√®rement utile. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heureusement, les r√®gles Nearley peuvent remplacer le comportement standard et retourner tout ce qu'elles veulent. En fait, la r√®gle (int√©gr√©e) pour la </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©cimale</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne renvoie pas une liste de nombres, elle renvoie le nombre Javascript √©quivalent, ce qui dans la plupart des cas est beaucoup plus utile, c'est-√†-dire que la valeur de retour de la r√®gle </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">num√©rique</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a la forme:</font></font><br><br><blockquote> <code><b>[ <br> [ " " ], <br> 57, <br> [ ] <br> ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les r√®gles Nearley red√©finissent le comportement standard en ajoutant un post-processeur √† la r√®gle, en prenant un tableau standard et en le rempla√ßant par ce dont vous avez besoin. Un postprocesseur est juste du code Javascript entre crochets sp√©ciaux √† la fin d'une r√®gle. Par exemple, dans la r√®gle des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nombres</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">je ne suis jamais int√©ress√© par les espaces possibles de chaque c√¥t√© du nombre. Par cons√©quent, il serait pratique que la r√®gle renvoie simplement un nombre et non un tableau de trois √©l√©ments. Voici un post-processeur qui effectue cette t√¢che:</font></font><br><br><blockquote> <code><b>number -&gt; WS decimal WS {% default =&gt; default[1] %}</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce post-processeur prend le r√©sultat standard (le tableau √† trois √©l√©ments illustr√© ci-dessus) et le remplace par le deuxi√®me √©l√©ment du tableau, qui est le num√©ro Javascript de la r√®gle </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©cimale</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Alors maintenant, la r√®gle </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">num√©rique</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> renvoie le nombre r√©el. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette fonctionnalit√© peut √™tre utilis√©e pour traiter une langue entrante dans une langue interm√©diaire, ce qui est plus facile √† utiliser. </font><font style="vertical-align: inherit;">Par exemple, je peux utiliser la grammaire Nearley pour transformer une cha√Æne MBDL en un tableau de structures Javascript, chacune repr√©sentant une primitive identifi√©e par un champ ¬´op¬ª. </font><font style="vertical-align: inherit;">La r√®gle pour la primitive de ligne ressemblera √† ceci:</font></font><br><br><blockquote> <code><b>element -&gt;</b> <b>"</b> <b>L(" number</b> <b>"</b> <b>," color</b> <b>"</b> <b>)" {% data=&gt; {op:</b> <b>"</b> <b>L", width: data[1], color: data[3]} %}</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Autrement dit, le r√©sultat de l'analyse de ¬´L (13, noir)¬ª sera la structure Javascript: </font></font><br><br><blockquote> <code><b>{op:</b> <b>"</b> <b>L", width: 13, color:</b> <b>"</b> <b>black"}</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s avoir ajout√© le post-traitement appropri√©, le r√©sultat renvoy√© par la grammaire peut √™tre une s√©quence (tableau) de structures d'op√©ration pour la ligne entrante. </font><font style="vertical-align: inherit;">Autrement dit, le r√©sultat de l'analyse de la cha√Æne</font></font><br><br><blockquote> <code><b>L( 415, ‚Äúblack") <br> VS(5) <br> [B(1, 2, ‚Äúblack", 3, ‚Äúwhite") HS(5) E(1, 2, ‚Äúblack", 3, ‚Äúwhite")]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera </font></font><br><br><blockquote> <code><b>[ <br> {op: "L", width: 415, color: "black"}, <br> {op: "VS", width: 5}, <br> {op: "P", <br> elements: [{op: "B", width: 1, length: 2, <br> olColor: "black", olWidth: 3, <br> fill: "white"}, <br> {op: "HS", width: 5}, <br> {op: "E", width: 1, length: 2, <br> olColor: "black", olWidth: 3, <br> fill: "white"}]} <br> ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui est beaucoup plus facile √† traiter pour cr√©er une bordure de carte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä ce stade, vous pouvez avoir une question - si la phase de post-traitement de la r√®gle Nearley peut contenir du Javascript, alors pourquoi ne pas ignorer la vue interm√©diaire et simplement dessiner la bordure de la carte √† droite pendant le post-traitement? </font><font style="vertical-align: inherit;">Pour de nombreuses t√¢ches, cette approche serait id√©ale. </font><font style="vertical-align: inherit;">J'ai d√©cid√© de ne pas l'utiliser pour plusieurs raisons.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Premi√®rement, dans MBDL, il y a quelques (*) composants qui ne peuvent pas √™tre ex√©cut√©s pendant le processus d'analyse. Par exemple, nous ne pouvons pas dessiner des √©l√©ments g√©om√©triques r√©p√©titifs (bande ou losange) pendant le processus d'analyse, car nous devons conna√Ætre les informations d'autres √©l√©ments dans le m√™me mod√®le. En particulier, nous devons conna√Ætre la longueur totale du motif afin de comprendre jusqu'o√π nous devons organiser les r√©p√©titions de chaque √©l√©ment individuel. Autrement dit, l'√©l√©ment du motif doit toujours cr√©er une repr√©sentation interm√©diaire de tous les √©l√©ments g√©om√©triques. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(* Il y a d'autres composants avec des limitations similaires dont je n'ai pas encore parl√©.)</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deuxi√®mement, Javascript dans Nearley est int√©gr√© dans les r√®gles, nous ne pourrons donc pas transmettre d'informations suppl√©mentaires √† Javascript, √† l'exception des variables globales. Par exemple, pour dessiner la fronti√®re, j'ai besoin de conna√Ætre la taille de la carte, les quatre zones de troncature utilis√©es, etc. Bien que je puisse ajouter du code qui rend ces informations disponibles pour les post-processeurs Nearley, ce sera un peu compliqu√© et il pourrait √™tre difficile de maintenir un tel code. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour ces raisons, j'analyse une repr√©sentation interm√©diaire, qui est ensuite ex√©cut√©e pour cr√©er la bordure de la carte elle-m√™me.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La prochaine √©tape consistera √† d√©velopper un interpr√©teur qui re√ßoit une repr√©sentation interm√©diaire de MBDL et l'ex√©cute pour g√©n√©rer des limites de carte. Ce n'est pas tr√®s difficile √† faire. Fondamentalement, le travail consiste √† d√©finir les conditions initiales (par exemple, g√©n√©rer des r√©gions de troncature pour les quatre c√¥t√©s de la carte) et it√©rer sur la s√©quence de structures de la repr√©sentation interm√©diaire √† chaque ex√©cution. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il y a quelques moments glissants.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout d'abord, je dois passer du rendu de l'int√©rieur au dessin de l'int√©rieur vers l'ext√©rieur. La raison en est que je veux que la plupart des bordures ne chevauchent pas la carte, j'ai donc besoin de dessiner les bordures de sorte que les lignes du bord int√©rieur co√Øncident avec les bords de la carte. Si je dessine de l'ext√©rieur vers l'int√©rieur, j'ai besoin de conna√Ætre la largeur de la bordure avant de commencer √† dessiner afin que la bordure ne chevauche pas la carte. Si je dessine de l'int√©rieur vers l'ext√©rieur, je commence simplement par le bord de la carte et je dessine. Il vous permet √©galement d'imposer √©ventuellement une bordure sur la carte; il suffit de commencer la bordure avec un espace vertical n√©gatif (VS).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un autre point difficile est la r√©p√©tition des sch√©mas. </font><font style="vertical-align: inherit;">Pour dessiner des motifs r√©p√©titifs, je dois regarder tous les √©l√©ments du motif et d√©terminer le plus large, car cela d√©finira la largeur de l'ensemble du motif. </font><font style="vertical-align: inherit;">Je dois √©galement regarder et suivre la longueur du motif afin de savoir quelle distance il me reste avant chaque r√©p√©tition. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voici un exemple de bordure assez complexe que j'ai utilis√© pour tester l'interpr√©teur:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3c8/88a/2a9/3c888a2a96352845f6165f5eca7f6ab3.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Je pense qu'il √©tait possible (n√©cessaire?) De le joindre pour le tester √† l'analyseur, mais pour cette bordure, je viens de cr√©er une vue interm√©diaire manuellement: </font></font><br><br><blockquote> <code><b>[ <br> {op:'P', elements: [ <br> {op:'B', width: 10, length: 37, lineWidth: 2, color: 'black', fill: 'white'}, <br> {op:'B', width: 10, length: 37, lineWidth: 2, color: 'black', fill: 'black'}, <br> ]}, <br> {op:'VS', width: 2}, <br> {op:'L', width:3, color: 'black'}, <br> {op:'PUSH'}, <br> {op:'L', width:10, color: 'rgb(222,183,64)'}, <br> {op:'POP'}, <br> {op:'PUSH'}, <br> {op:'P', elements: [ <br> {op:'E', width: 5, length: 5, lineWidth: 1, color: 'black', fill: 'red'}, <br> {op:'HS', length: 10}, <br> ]}, <br> {op:'L', width:3, color: 'black'}, <br> {op:'POP'}, <br> {op:'VS', width: 2}, <br> {op:'P', elements: [ <br> {op:'E', width: 2, length: 2, lineWidth: 0, color: 'black', fill: 'white'}, <br> {op:'HS', length: 13}, <br> ]}, <br> ]</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai cr√©√© cette vue par essais et erreurs. Quoi qu'il en soit, l'interpr√®te fonctionne! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme derni√®re √©tape, permettez-moi d'utiliser l'analyseur pour cr√©er une vue interm√©diaire √† partir de la version MBDL. Il n'y a rien de sp√©cial √† me montrer ici: j'ai d√ª corriger plusieurs noms de champs, mais sinon le code fonctionnait bien. Pour la fronti√®re, j'ai utilis√© une version l√©g√®rement diff√©rente de MBDL:</font></font><br><br><blockquote> <code><b>[B(5,37,"black",2,"white") B(5,37,"black",2,"black")] <br> VS(3) <br> L(3,"black") <br> {L(10,"rgb(222,183,64)")} <br> [E(5,5,"black",1,"red") HS(-5) E(2,2,"none",0,"white") HS(10)] <br> L(3,"black")</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elle dessine la m√™me bordure, mais d'une mani√®re l√©g√®rement diff√©rente. </font><font style="vertical-align: inherit;">J'ai √©galement chang√© la syntaxe de la superposition, en rempla√ßant les parenth√®ses par des accolades pour qu'elle soit plus diff√©rente de l'autre syntaxe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour montrer pourquoi je voulais dessiner de l'int√©rieur vers l'ext√©rieur, et pas seulement placer automatiquement la bordure √† l'ext√©rieur de la carte, je peux ajouter un espace vertical n√©gatif au d√©but de cette bordure pour d√©placer l'√©chelle de la carte √† l'int√©rieur du bord de la carte:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ce/ea0/3df/0ceea03df1f07131e0ad27e6bbd45731.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai maintenant la plupart des infrastructures n√©cessaires √† la g√©n√©ration proc√©durale des bordures de carte: un langage de description des limites, un analyseur de langage et des proc√©dures pour effectuer une repr√©sentation interm√©diaire. </font><font style="vertical-align: inherit;">Il ne reste plus qu'√† g√©rer la partie difficile - la g√©n√©ration proc√©durale!</font></font><br><br><h2>  Partie 6 </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant que l'int√©gralit√© du MBDL a √©t√© impl√©ment√©e, j'avais l'intention de proc√©der √† la g√©n√©ration proc√©durale des bordures de carte, mais je ne sais pas encore comment je veux le faire, car je vais m'attarder un peu et impl√©menter quelques autres fonctionnalit√©s de MBDL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la premi√®re discussion sur le traitement des coins avec des motifs, j'ai parl√© de deux approches diff√©rentes. √Ä la fin, j'ai r√©alis√© les coins biseaut√©s, mais il y avait une deuxi√®me option: arr√™ter le motif pr√®s du coin, comme dans ces exemples:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b7/94d/01b/3b794d01b552c42ed9b8362f5405ff9d.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee2/3a8/159/ee23a8159d81afd1f7c95c16a90bcdf7.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une telle solution est souvent utilis√©e lorsque le motif de bordure est une sorte de figure asym√©trique, de runes ou autre chose qui ne peut pas √™tre tourn√© de 90 degr√©s, tout en maintenant l'alignement. Mais il est √©vident que cela fonctionnera avec des formes g√©om√©triques. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est peut-√™tre l'option que vous choisissez avant de g√©n√©rer la bordure, mais vous pouvez ajouter un peu de flexibilit√© si vous l'activez √† partir d'une partie de la bordure et utilisez le coin biseaut√© de l'autre. Pour ce faire, je dois ajouter une nouvelle commande √† MBDL. Je soup√ßonne que d'autres options peuvent survenir pour diff√©rentes parties de la fronti√®re, donc j'ajouterai une commande d'options g√©n√©rales:</font></font><br><br><blockquote> <code><b>element -&gt; "O(MITER)"</b> <br> <b>element -&gt; "O(STOPPED)"</b> <br> <b>element -&gt; "O(STOPPED," number ")"</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Ici encore, pour plus de clart√©, nous omettons les espaces et certains autres d√©tails.) Jusqu'√† pr√©sent, les seules options sont ¬´MITRE¬ª pour les coins biseaut√©s et ¬´ARR√äT√â¬ª pour l'arr√™t pr√®s des coins. </font><font style="vertical-align: inherit;">Si aucune valeur n'est transmise STOPPED, le programme arr√™te le motif √† une distance raisonnable du coin. </font><font style="vertical-align: inherit;">Si la valeur est transmise, le motif s'arr√™te √† cette distance du coin. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si des coins ARR√äT√âS sont utilis√©s, alors j'arr√™te de dessiner le motif de coin loin des coins.</font></font> Voici √† quoi √ßa ressemble: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a8e/5df/49e/a8e5df49eecf2ebc5e94e571cb7d0ff8.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ici, j'ai utilis√© l'option MITRE pour le mod√®le d'√©chelle noir et blanc, de sorte qu'il refl√®te en fonction de l'angle. </font><font style="vertical-align: inherit;">Pour un motif de cercles rouges et de carr√©s noirs √† l'int√©rieur d'une ligne dor√©e (et pour un motif de cercles √† l'ext√©rieur de la bordure), j'ai utilis√© STOPPED. </font><font style="vertical-align: inherit;">Vous pouvez voir que ces deux motifs se terminent pr√®s du coin.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, il y a quelques probl√®mes. Tout d'abord, nous voyons qu'√† gauche, l'√©l√©ment le plus proche du coin est un carr√© noir et en haut un cercle rouge. Cela s'est produit parce que le coin est pr√®s du d√©but de la r√©p√©tition d'un c√¥t√© et pr√®s de la fin de la r√©p√©tition de l'autre. Mais √ßa a l'air bizarre. Il serait pr√©f√©rable que les coins soient sym√©triques, m√™me si pour cela nous devions ajouter un autre √©l√©ment √† la fin du motif. Deuxi√®mement, vous pouvez voir que le motif √† l'ext√©rieur de la bordure (demi-cercles et points noirs) se termine √©galement par une r√©p√©tition dans le coin. Mais comme la longueur de cette r√©p√©tition est bien inf√©rieure √† la longueur des cercles rouges / carr√©s noirs, ils se retrouvent √† des endroits diff√©rents. Il serait probablement pr√©f√©rable que tous les motifs s'arr√™tent √† la m√™me distance du coin.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour r√©soudre le premier probl√®me, vous devez ajouter une autre r√©p√©tition du premier √©l√©ment du motif √† la fin de chaque c√¥t√© de la bordure. </font><font style="vertical-align: inherit;">Mais en fait, c'est un peu plus compliqu√©, car je pourrais utiliser un d√©calage horizontal n√©gatif √† l'int√©rieur du motif pour chevaucher plusieurs √©l√©ments (comme ici). </font><font style="vertical-align: inherit;">Vous devez √©galement ajouter une autre r√©p√©tition √† tout √©l√©ment du motif qui a le m√™me point de d√©part que le premier √©l√©ment.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c4/331/6fc/9c43316fcd44d79a0b2374401a46240a.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, le motif est sym√©trique par rapport √† l'angle et semble beaucoup mieux. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuite, je dois suivre le motif ARR√äT le plus long et arr√™ter chaque motif ARR√äT √† cette distance:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a33/920/c6c/a33920c6cda9072bbda915544f1f4926.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Maintenant, le motif des cercles blancs est plus mis de c√¥t√©, mais il n'est toujours pas align√© avec le motif des cercles rouges. </font></font> Pourquoi?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cela est d√ª au fait que le motif de cercle blanc est plus √©loign√© du bord de la carte et que la bordure est plus longue que celle o√π le motif de cercle rouge est trac√©. </font><font style="vertical-align: inherit;">Pour r√©soudre ce probl√®me, vous devez d√©placer les motifs de mani√®re uniforme et en tenant compte de leur d√©calage par rapport au bord de la carte.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70b/574/2c1/70b5742c1d4f404335b97128f09d6baf.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Maintenant, tout est magnifiquement align√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La deuxi√®me option pour les angles est les d√©calages carr√©s dans les coins, par exemple ceux-ci:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cac/37e/bac/cac37ebac81815955dfc940bacdc2eff.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce sera beaucoup plus difficile √† mettre en ≈ìuvre! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, la grammaire de cette option est simple et utilise l'opcode Option:</font></font><br><br><blockquote> <code><b>element -&gt; "O(SQOFFSET)"</b> <br> <b>element -&gt; "O(SQOFFSET," number ")"</b></code> </blockquote> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le nombre indique la taille du d√©placement carr√© pour l'√©l√©ment sur le bord de la carte; </font><font style="vertical-align: inherit;">Les √©l√©ments avec diff√©rents d√©calages doivent √™tre align√©s en cons√©quence. </font><font style="vertical-align: inherit;">S'il n'y a pas de nombre, le programme s√©lectionne la taille de d√©calage appropri√©e. </font><font style="vertical-align: inherit;">La mise √† z√©ro du nombre d√©sactive le d√©calage carr√©. </font><font style="vertical-align: inherit;">Cela vous permet de cr√©er des bordures dans lesquelles certains √©l√©ments utilisent des d√©calages carr√©s, tandis que d'autres ne le font pas, comme dans cette bordure:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97b/fd8/336/97bfd833697b9278660772c1bd04ee46.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La premi√®re chose que j'ai r√©alis√©e est que j'aurais besoin de zones de troncature suppl√©mentaires car j'utilise la troncature pour traiter les endroits o√π la bordure change de direction. </font><font style="vertical-align: inherit;">SQOFFSET n√©cessitera des zones de troncature plus complexes; </font><font style="vertical-align: inherit;">Vous aurez √©galement besoin de zones distinctes pour diff√©rents √©l√©ments lorsque vous activez et d√©sactivez SQOFFSET. </font><font style="vertical-align: inherit;">√âtant donn√© que les zones de troncature ajoutent de toute fa√ßon des artefacts ind√©sirables, cela semble √™tre trop de travail.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lorsque j'ai travaill√© sur les mod√®les pouvant √™tre arr√™t√©s ci-dessus, j'ai impl√©ment√© le remplissage d'un mod√®le asym√©trique pour ajouter une autre r√©p√©tition √† une extr√©mit√© du mod√®le. J'ai √©galement r√©alis√© que cela √©liminerait le besoin de coins biseaut√©s. Je vais simplement dessiner tous les motifs le long de la bordure dans le sens horaire, en commen√ßant le motif dans un coin et en terminant pr√®s du coin suivant. Cela me permettra de me d√©barrasser des zones de troncature. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le plus important dans cette nouvelle fa√ßon de travailler avec les coins est que le premier √©l√©ment du motif n'est plus ¬´divis√©¬ª en deux c√¥t√©s. Si vous regardez les motifs d'√©chelle en noir et blanc sur les cartes ci-dessus, vous pouvez voir qu'il y a un rectangle blanc passant dans le coin. Maintenant, le rectangle blanc jouxte le coin:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ead/909/c83/ead909c83fa91ff80af290ab92ca9fae.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les cartes sont dessin√©es dans les deux sens, mais ce n'est pas un tr√®s gros probl√®me. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour commencer, j'ai impl√©ment√© des d√©calages pour les lignes. </font><font style="vertical-align: inherit;">Pour ce faire, il suffisait de tourner la ligne par rapport aux angles correspondants:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c2/bf6/2fd/9c2bf62fdfec732f56361f4aa17fc19e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Comme vous pouvez le comprendre, je peux combiner des angles avec des d√©calages et des angles r√©guliers, comme dans la carte ci-dessus: </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e0b/f5b/e02/e0bf5be02606044dd5fba4f82d3dad67.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien s√ªr, il est plus difficile de tourner les motifs au coin de la rue. </font><font style="vertical-align: inherit;">L'id√©e g√©n√©rale est de dessiner d'un coin √† presque l'autre, et ainsi de suite le long de la fronti√®re, jusqu'√† revenir au d√©but. </font><font style="vertical-align: inherit;">Il suffit th√©oriquement de dessiner uniquement des motifs horizontaux et verticaux, et tout doit √™tre magnifiquement align√©; </font><font style="vertical-align: inherit;">en fait, suivre tout cela est assez morne. </font><font style="vertical-align: inherit;">En fait, j'ai d√ª r√©√©crire compl√®tement le code deux fois et √©crire un tas de papier, mais je n'en parlerai pas en d√©tail. </font><font style="vertical-align: inherit;">Montrez simplement le r√©sultat:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/912/35b/889/91235b889603c973fcfe094a1614a993.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une illusion d'optique g√™nante appara√Æt dans les coins - l'√©l√©ment d'angle semble non centr√© plus pr√®s de l'ext√©rieur du coin. </font><font style="vertical-align: inherit;">En fait, ce n'est pas vrai, mais il semble que oui, car plus pr√®s de l'int√©rieur du coin, il y a visuellement plus d'espace vide. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtant donn√© que les segments des angles de d√©calage sont assez courts, il est tr√®s facile de cr√©er un motif de non-√©quilibre dans le coin:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b1b/601/dff/b1b601dffc11782fb8cbe738a906b0e5.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parfois, √ßa a l'air assez moche. </font><font style="vertical-align: inherit;">Cela m'a rappel√© une vieille blague:</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Patient: "Docteur, quand je fais √ßa, √ßa me fait mal." </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Docteur: "Alors ne fais pas √ßa!"</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je vais donc essayer de ne pas le faire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habituellement, je ne dessinerai pas l'√©chelle de la carte le long de l'angle de d√©calage, mais si j'en ai besoin, je devrai utiliser l'option qui √©tire le motif afin que l'√©chelle de la carte s'ins√®re dans le coin sans espaces entre les rectangles:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/26f/a88/0da/26fa880da6d00d380afdae60c489dd9c.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez voir qu'en cons√©quence, la taille des rectangles d'√©chelle varie consid√©rablement. </font><font style="vertical-align: inherit;">Autrement dit, ce n'est pas une tr√®s bonne option. </font><font style="vertical-align: inherit;">(Soit dit en passant, les angles de d√©calage ont √©galement un bug dans le motif des cercles. Plus tard, je l'ai corrig√©, mais comme je l'ai dit, il est tr√®s difficile de le faire.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le motif est trop grand pour tenir sur le segment de l'angle de d√©calage, l'algorithme se rend simplement:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/044/b2d/b4d044b2dc2bf23cd670113476b9803d.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ce qui est loin d'√™tre id√©al, mais, comme je l'ai dit plus haut, "alors ne le faites pas". </font><font style="vertical-align: inherit;">(Il n'est en fait pas tr√®s difficile d'ajouter une fonction de compression ou d'√©tirement si j'en ai besoin.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Que se passe-t-il si j'utilise les deux coins d√©cal√©s et l'option qui arr√™te les motifs devant les coins? </font><font style="vertical-align: inherit;">Dans ce cas, je m'arr√™te juste non loin des coins d√©cal√©s:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/170/d60/9c1/170d609c1b789359490e35741215ba04.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il me semble que c'est une d√©cision logique. </font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr444190/">https://habr.com/ru/post/fr444190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr444178/index.html">9 conseils pour cr√©er des jeux ind√©pendants √† partir d'un seul d√©veloppeur</a></li>
<li><a href="../fr444182/index.html">Go conditions et leurs bizarreries</a></li>
<li><a href="../fr444184/index.html">√Ä propos des perspectives des centres de donn√©es pr√©-assembl√©s</a></li>
<li><a href="../fr444186/index.html">Flutter 1.2. Quoi de neuf</a></li>
<li><a href="../fr444188/index.html">CG Pods - Casque TWS qui pourrait</a></li>
<li><a href="../fr444192/index.html">Gestion des API Mitap - IBM, Google, Yandex et Leroy Merlin Experience - Record Available</a></li>
<li><a href="../fr444198/index.html">Dropbox limite la synchronisation: maintenant seulement 3 appareils</a></li>
<li><a href="../fr444200/index.html">Session de r√©solution de probl√®mes</a></li>
<li><a href="../fr444204/index.html">Pr√©sentation des tests en Python. 3e partie</a></li>
<li><a href="../fr444206/index.html">27 mars, Moscou - JavaScript MeetUP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>