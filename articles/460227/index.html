<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìé üëÜ üöâ Herramienta de refactorizaci√≥n personalizada: Swift ü§Ø üõê üë®üèæ‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cualquier ingeniero se esfuerza por hacer que su proceso de trabajo sea lo m√°s optimizado posible. Como desarrolladores m√≥viles de iOS, a menudo tenem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Herramienta de refactorizaci√≥n personalizada: Swift</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/460227/"> Cualquier ingeniero se esfuerza por hacer que su proceso de trabajo sea lo m√°s optimizado posible.  Como desarrolladores m√≥viles de iOS, a menudo tenemos que trabajar con estructuras de lenguaje uniformes.  Apple est√° mejorando las herramientas para desarrolladores haciendo un gran esfuerzo para que sea conveniente para nosotros programar: resaltado del lenguaje, m√©todos de autocompletado y muchas otras funciones IDE que permiten que nuestros dedos se mantengan al d√≠a con las ideas en nuestras cabezas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4b6/69d/e24/4b669de249e57f8f8d7ad2da21df22a3.png"><br><br>  ¬øQu√© hace un ingeniero cuando falta la herramienta requerida?  Es cierto, √©l har√° todo por s√≠ mismo!  Anteriormente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hablamos</a> sobre la creaci√≥n de nuestras herramientas personalizadas, ahora hablemos sobre c√≥mo modificar Xcode y hacer que funcione de acuerdo con sus reglas. <br><a name="habracut"></a><br>  Tomamos la tarea de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JIRA Swift</a> e hicimos una herramienta que convierte <b>si se deja</b> en un <b>guardia</b> equivalente <b>, deja</b> construir. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d68/6b7/ad5/d686b7ad5d24b87b61df2bb6d87299eb.gif"><br><br>  Desde la novena versi√≥n, Xcode proporciona un nuevo mecanismo de refactorizaci√≥n que puede convertir el c√≥digo localmente, dentro del mismo archivo fuente de Swift o globalmente cuando cambia el nombre de un m√©todo o propiedad que ocurre en varios archivos, incluso si est√°n en diferentes idiomas. <br><br>  La refactorizaci√≥n local se implementa completamente en el compilador y el marco de SourceKit, la caracter√≠stica se encuentra en el repositorio Swift de c√≥digo abierto y est√° escrita en C ++.  La modificaci√≥n de la refactorizaci√≥n global es actualmente inaccesible para la gente com√∫n, porque la base del c√≥digo Xcode est√° cerrada.  Por lo tanto, nos detendremos en la historia local y hablaremos sobre c√≥mo repetir nuestra experiencia. <br><br>  Lo que necesita para crear su propia herramienta para la refactorizaci√≥n local: <br><br><ol><li>  Entendiendo C ++ <br></li><li>  Conocimientos b√°sicos del compilador. <br></li><li>  Comprender qu√© es AST y c√≥mo trabajar con √©l <br></li><li>  C√≥digo fuente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">r√°pido</a> <br></li><li>  Gu√≠a <a href="">swift / docs / refactoring / SwiftLocalRefactoring.md</a> <br></li><li>  Mucha paciencia <br></li></ol><br><h2>  Un poco sobre AST </h2><br>  Un poco de conceptos b√°sicos te√≥ricos antes de sumergirse en la pr√°ctica.  Echemos un vistazo a c√≥mo funciona la arquitectura del compilador Swift.  En primer lugar, el compilador es responsable de transformar el c√≥digo en c√≥digo m√°quina ejecutable. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/00b/9e7/f23/00b9e7f23d9d1c1b3e02d14905179ef2.png"><br><br>  De las etapas de transformaci√≥n presentadas, la m√°s interesante para nosotros es la generaci√≥n de un √°rbol de sintaxis abstracta (AST), un gr√°fico en el que los v√©rtices son operadores y las hojas son sus operandos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/350/269/29f/35026929fee03914b2689ee5b20fa6f8.png"><br><br>  Los √°rboles de sintaxis se usan en el analizador sint√°ctico.  AST se usa como una representaci√≥n interna en el compilador / int√©rprete de un programa de computadora para optimizar y generar c√≥digo. <br><br>  Despu√©s de que se genera el AST, se realiza el an√°lisis para crear el AST con una verificaci√≥n de tipo que se ha traducido al lenguaje intermedio r√°pido.  SIL se convierte, optimiza, degrada a LLVM IR, que finalmente se compila en c√≥digo de m√°quina. <br><br>  Para crear una herramienta de refactorizaci√≥n, necesitamos comprender AST y poder trabajar con ella.  Por lo tanto, la herramienta podr√° funcionar correctamente con partes del c√≥digo que queremos procesar. <br><br>  Para generar el AST de un archivo, ejecute el comando: swiftc -dump-ast <i>MyFile.swift</i> <i><br><br></i>  <i>A continuaci√≥n se muestra la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">salida a la consola</a> AST <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de</a> la funci√≥n <b>if let</b> , que se mencion√≥ anteriormente.</i> <i><br><br><img src="https://habrastorage.org/getpro/habr/post_images/901/276/7b6/9012767b6955ddd58dfc221181e8a70b.png"></i> <br><br>  Hay tres tipos principales de nodos en Swift AST: <br><br><ul><li>  declaraciones (subclases de tipo Decl), <br></li><li>  expresiones (subclases de tipo Expr), <br></li><li>  operadores (subclases de tipo Stmt). <br></li></ul><br>  Corresponden a las tres entidades que se utilizan en el lenguaje Swift.  Los nombres de funciones, estructuras, par√°metros son declaraciones.  Las expresiones son entidades que devuelven un valor;  por ejemplo, llamando a funciones.  Los operadores son partes del lenguaje que definen el flujo de control de la ejecuci√≥n del c√≥digo, pero no devuelven un valor (por ejemplo, if o do-catch). <br><br>  Este es un m√≠nimo suficiente que necesita saber sobre AST para su pr√≥ximo trabajo. <br><br><h2>  C√≥mo funciona la herramienta de refactorizaci√≥n en teor√≠a </h2><br>  Para implementar herramientas de refactorizaci√≥n, necesita informaci√≥n espec√≠fica sobre el √°rea del c√≥digo que va a cambiar.  Los desarrolladores cuentan con entidades auxiliares que acumulan datos.  El primero, ResolvedCursorInfo (refactorizaci√≥n basada en el cursor), le dice si estamos al comienzo de una expresi√≥n.  Si es as√≠, se devuelve el objeto compilador correspondiente de esta expresi√≥n.  La segunda entidad, RangeInfo (refactorizaci√≥n basada en rango), encapsula datos sobre el rango original (por ejemplo, cu√°ntos puntos de entrada y salida tiene). <br><br>  La refactorizaci√≥n basada en el cursor se inicia mediante la ubicaci√≥n del cursor en el archivo fuente.  Las acciones de refactorizaci√≥n implementan los m√©todos que utiliza el mecanismo de refactorizaci√≥n para mostrar las acciones disponibles en el IDE y realizar transformaciones.  Ejemplos de acciones basadas en el cursor: Saltar a definici√≥n, ayuda r√°pida, etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fce/30f/c9d/fce30fc9de1ab5b473ff9ac14795c462.png"><br><br>  Considere las acciones habituales desde el lado t√©cnico: <br><br><ol><li>  Cuando selecciona una ubicaci√≥n del editor Xcode, se realiza una solicitud a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sourcekitd</a> (el marco responsable de resaltar, completar el c√≥digo, etc.) para mostrar las acciones de refactorizaci√≥n disponibles. <br></li><li>  El objeto ResolvedCursorInfo solicita cada acci√≥n disponible para verificar si esta acci√≥n se aplica al c√≥digo seleccionado. <br></li><li>  La lista de acciones aplicables se devuelve como una respuesta de sourcekitd y se muestra en Xcode. <br></li><li>  Xcode aplica los cambios a la herramienta de refactorizaci√≥n. <br></li></ol><br>  La refactorizaci√≥n basada en rango se inicia seleccionando un rango continuo de c√≥digo en el archivo fuente. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/670/987/f65/670987f65cedaec71b072c3d2c721315.png"><br><br>  En este caso, la herramienta de refactorizaci√≥n pasar√° por una cadena de llamada similar a la descrita.  La diferencia es que cuando se implementa, la entrada es RangeInfo en lugar de ResolvedCursorInfo.  Los lectores interesados ‚Äã‚Äãpueden consultar <a href="">Refactoring.cpp</a> para obtener m√°s informaci√≥n sobre ejemplos de kits de herramientas de Apple. <br><br>  Y ahora a la pr√°ctica de crear una herramienta. <br><br><h2>  Preparaci√≥n </h2><br>  En primer lugar, debe descargar y compilar el compilador Swift.  Las instrucciones detalladas se encuentran en el repositorio oficial ( <a href="">readme.md</a> ).  Estos son los comandos clave para la clonaci√≥n de c√≥digo: <br><br><pre><code class="swift hljs">mkdir swift-source cd swift-source git clone https:<span class="hljs-comment"><span class="hljs-comment">//github.com/apple/swift.git ./swift/utils/update-checkout --clone</span></span></code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cmake se</a> usa para describir la estructura y las dependencias del proyecto.  Al usarlo, puede generar un proyecto para Xcode (m√°s conveniente) o para ninja (m√°s r√°pido) debido a uno de los comandos: <br><br><pre> <code class="swift hljs">./utils/build-script --debug --xcode</code> </pre> <br>  o <br><pre> <code class="swift hljs">swift/utils/build-script --debug-debuginfo</code> </pre> <br>  La compilaci√≥n exitosa requiere la √∫ltima versi√≥n de Xcode beta (10.2.1 en el momento de la redacci√≥n), disponible en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio web oficial de Apple</a> .  Para usar el nuevo Xcode para construir el proyecto, debe registrar la ruta utilizando la utilidad xcode-select: <br><br><pre> <code class="bash hljs">sudo xcode-select -s /Users/username/Xcode.app</code> </pre> <br>  Si usamos el indicador --xcode para compilar el proyecto para Xcode, respectivamente, luego de varias horas de compilaci√≥n (obtuvimos un poco m√°s de dos) en la carpeta de compilaci√≥n, encontraremos el archivo Swift.xcodeproj.  Al abrir el proyecto, veremos el Xcode familiar con indexaci√≥n, puntos de interrupci√≥n. <br><br>  Para crear un nuevo instrumento, necesitamos agregar el c√≥digo con la l√≥gica del instrumento al archivo: lib / IDE / Refactoring.cpp y definir dos m√©todos, isApplicable y performChange.  En el primer m√©todo, decidimos si generar la opci√≥n de refactorizaci√≥n para el c√≥digo seleccionado.  Y en el segundo, c√≥mo convertir el c√≥digo seleccionado para aplicar la refactorizaci√≥n. <br><br>  Una vez realizada la preparaci√≥n, queda por implementar los siguientes pasos: <br><br><ol><li>  Desarrolle la l√≥gica de la herramienta (el desarrollo se puede hacer de varias maneras: a trav√©s de la cadena de herramientas, a trav√©s de Ninja, a trav√©s de Xcode; todas las opciones se describir√°n a continuaci√≥n) <br></li><li>  Implemente dos m√©todos: isApplicable y performChange (son responsables del acceso a la herramienta y su funcionamiento) <br></li><li>  Diagnostique y pruebe la herramienta terminada antes de enviar el RP al repositorio oficial de Swift. <br></li></ol><br><h2>  Pruebe el funcionamiento de la herramienta a trav√©s de la cadena de herramientas </h2><br>  Este m√©todo de desarrollo le llevar√° mucho tiempo debido al largo ensamblaje de componentes, pero el resultado es visible de inmediato en Xcode, la forma de verificarlo manualmente. <br><br>  Para comenzar, construyamos la cadena de herramientas Swift usando el comando: <br><br><pre> <code class="plaintext hljs">./utils/build-toolchain some_bundle_id</code> </pre> <br>  Compilar la cadena de herramientas llevar√° incluso m√°s tiempo que compilar el compilador y las dependencias.  La salida es el archivo swift-LOCAL-aaaa-mm-dd.xctoolchain en la carpeta swift-nightly-install, que debe transferir a Xcode: / Library / Developer / Toolchains /.  A continuaci√≥n, en la configuraci√≥n de IDE, seleccione la nueva cadena de herramientas, reinicie Xcode. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b67/402/ead/b67402ead1fd1e4470886c8a8ad2f3c2.png"><br><br>  Seleccione un fragmento de c√≥digo que la herramienta debe procesar y b√∫squelo en el men√∫ contextual. <br><br><h2>  Desarrollo a trav√©s de pruebas con Ninja </h2><br>  Si el proyecto fue creado para Ninja y usted eligi√≥ el camino TDD, entonces el desarrollo a trav√©s de pruebas con Ninja es una de las opciones que m√°s le convengan.  Contras: no puede establecer puntos de interrupci√≥n, como en el desarrollo a trav√©s de Xcode. <br><br>  Por lo tanto, debemos verificar que la nueva herramienta se muestre en Xcode cuando el usuario selecciona la construcci√≥n de protecci√≥n en el c√≥digo fuente.  Escribimos la prueba en el archivo existente test / refactoring / RefactoringKind / basic.swift: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testConvertToGuardExpr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idxOpt: Int?)</span></span></span></span> {    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> idx = idxOpt {        <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(idx)    } } <span class="hljs-comment"><span class="hljs-comment">//     . // RUN: %refactor -source-filename %s -pos=266:3 -end-pos=268:4 | %FileCheck %s -check-prefix=CHECK-CONVERT-TO-GUARD-EXPRESSION // CHECK-CONVERT-TO-GUARD-EXPRESSION: Convert To Guard Expression</span></span></code> </pre> <br><br>  Indicamos que al resaltar c√≥digo entre 266 columnas de la fila 3 y 268 columnas de la fila 4, esperamos la aparici√≥n de un elemento de men√∫ con una nueva herramienta. <br><br>  El uso del script <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lit.py</a> puede proporcionar comentarios m√°s r√°pidos a su ciclo de desarrollo.  Puede especificar el traje de prueba de inter√©s.  En nuestro caso, esta suite ser√° RefactoringKind: <br><br> <code>./llvm/utils/lit/lit.py -sv ./build/Ninja-RelWithDebInfoAssert/swift-macosx-x86_64/test-macosx-x86_64/refactoring/RefactoringKind/</code> <br>  Como resultado, solo se iniciar√°n las pruebas de este archivo.  Su implementaci√≥n tomar√° un par de decenas de segundos.  M√°s adelante se discutir√° m√°s informaci√≥n sobre lit.py en la secci√≥n Diagn√≥stico y prueba. <br>  La prueba falla, lo cual es normal para el paradigma TDD.  Despu√©s de todo, hasta ahora no hemos escrito una sola l√≠nea de c√≥digo con la l√≥gica de la herramienta. <br><br><h2>  Desarrollo a trav√©s de depuraci√≥n y Xcode </h2><br>  Y finalmente, el √∫ltimo m√©todo de desarrollo cuando el proyecto fue construido bajo Xcode.  La ventaja principal es la capacidad de establecer puntos de interrupci√≥n y controlar la depuraci√≥n. <br><br>  Al compilar un proyecto en Xcode, el archivo Swift.xcodeproj se crea en la carpeta build / Xcode-DebugAssert / swift-macosx-x86_64 /.  Cuando abre este archivo por primera vez, es mejor elegir crear esquemas manualmente para generar ALL_BUILD y refactorizar r√°pidamente: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f7d/7cb/458/f7d7cb4587c345d03bc77fc62cd615a9.png"><br><br>  Luego, construimos el proyecto con ALL_BUILD una vez, luego de eso usamos el esquema de refactorizaci√≥n r√°pida. <br><br>  La herramienta de refactorizaci√≥n se compila en un archivo ejecutable separado: swift-refactor.  La ayuda para este archivo se puede mostrar con el indicador ‚Äìhelp.  Los par√°metros m√°s interesantes para nosotros son: <br><br><pre> <code class="swift hljs">-source-filename=&lt;string&gt; <span class="hljs-comment"><span class="hljs-comment">//   -pos=&lt;string&gt; //   -end-pos=&lt;string&gt; //   -kind //  </span></span></code> </pre> <br>  Se pueden especificar en el esquema como argumentos.  Ahora puede establecer puntos de interrupci√≥n para detenerse en lugares de inter√©s al iniciar la herramienta.  De la manera habitual, usando los comandos <i>p</i> y <i>po</i> en la consola Xcode, muestra los valores de las variables correspondientes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/329/254/23c/32925423cba91d5951178b9be63a70d5.png"><br><br><h2>  Implementaci√≥n IsApplicable </h2><br>  El m√©todo isApplicable acepta un ResolvedRangeInfo con informaci√≥n sobre los nodos AST del fragmento de c√≥digo seleccionado en la entrada.  En la salida del m√©todo, se decide si mostrar la herramienta o no en el men√∫ contextual de Xcode.  La interfaz completa de ResolvedRangeInfo se puede encontrar en el <a href="">archivo include / swift / IDE / Utils.h</a> . <br><br>  Considere los campos de la clase ResolvedRangeInfo que son m√°s √∫tiles en nuestro caso: <br><br><ul><li>  RangeKind: lo primero que debe hacer es verificar el tipo de √°rea seleccionada.  Si el √°rea no es v√°lida (no es v√°lida), puede devolver falso.  Si el tipo nos conviene, por ejemplo, SingleStatement o MultiStatement, contin√∫e; <br></li></ul><br><ul><li>  ContainedNodes: una matriz de elementos AST que se incluyen en el rango seleccionado.  Queremos asegurarnos de que el usuario seleccione el rango en el que entra la construcci√≥n if let.  Para hacer esto, tomamos el primer elemento de la matriz y verificamos que este elemento corresponde a IfStmt (la clase que define el nodo AST del nodo de declaraci√≥n del subtipo if).  A continuaci√≥n, ver condici√≥n.  Para simplificar la implementaci√≥n, mostraremos la herramienta solo para expresiones con una condici√≥n.  Por el tipo de condici√≥n (CK_PatternBinding) determinamos que esto se deja. <br></li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/e7f/ba1/e70/e7fba1e70c05ada9602ba90164c67db8.png"><br><br>  Para probar es aplicable, agregue el c√≥digo de muestra al archivo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">test / refactoring / RefactoringKind / basic.swift</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0a1/663/046/0a1663046435877088f58d14329123f5.png"><br><br>  Para que la prueba simule una llamada a nuestra herramienta, debe agregar una l√≠nea en el archivo <a href="">tools / swift-refactor / swift-refactor.cpp</a> . <a href="">&nbsp;</a><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a38/3a9/b3d/a383a9b3d80613dda377d5cd7f43411c.png"><br><br><h2>  Implementamos performChange </h2><br>  Se llama a este m√©todo cuando se selecciona una herramienta de refactorizaci√≥n en el men√∫ contextual.  El m√©todo tiene acceso a ResolvedRangeInfo, as√≠ como en isApplicable.  Usamos ResolvedRangeInfo y escribimos la l√≥gica de la herramienta de conversi√≥n de c√≥digo. <br><br>  Al generar c√≥digo para tokens est√°ticos (regulados por la sintaxis del lenguaje), puede usar entidades del espacio de nombres tok.  Por ejemplo, para la palabra clave guard, use tok :: kw_guard.  Para los tokens din√°micos (modificados por el desarrollador, por ejemplo, el nombre de la funci√≥n), debe seleccionarlos de la matriz de elementos AST. <br><br>  Para determinar d√≥nde se inserta el c√≥digo convertido, usamos el rango completo seleccionado usando la construcci√≥n RangeInfo.ContentRange. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/893/d2b/c31/893d2bc311ceba6313fad5d474f6ea2e.png"><br><br><h2>  Diagn√≥sticos y pruebas </h2><br>  Antes de terminar de trabajar en una herramienta, debe verificar la correcci√≥n de su trabajo nuevamente.  Las pruebas nos ayudar√°n nuevamente.  Las pruebas se pueden ejecutar de una en una o con todos los √°mbitos disponibles.  La forma m√°s f√°cil de ejecutar todo el conjunto de pruebas de Swift es con el comando --test en utils / build-script, que ejecutar√° el conjunto de pruebas principal.  El uso de utils / build-script reconstruir√° todos los objetivos, lo que puede aumentar significativamente el tiempo del ciclo de depuraci√≥n. <br><br>  Aseg√∫rese de ejecutar utils / build-script --validation-test validation tests antes de realizar cambios importantes en el compilador o API. <br><br>  Hay otra forma de ejecutar todas las pruebas unitarias del compilador: ninja, ninja check-swift desde build / preset / swift-macosx-x86_64.  Tardar√° unos 15 minutos. <br><br>  Y finalmente, la opci√≥n cuando necesita ejecutar pruebas por separado.  Para invocar directamente el script lit.py desde LLVM, debe configurarlo para usar el directorio de compilaci√≥n local.  Por ejemplo: <br><br><pre> <code class="swift hljs">% $ {<span class="hljs-type"><span class="hljs-type">LLVM_SOURCE_ROOT</span></span>} /utils/lit/lit.py -sv $ {<span class="hljs-type"><span class="hljs-type">SWIFT_BUILD_DIR</span></span>} / test-macosx-x86_64 / <span class="hljs-type"><span class="hljs-type">Parse</span></span> /</code> </pre> <br>  Esto ejecutar√° las pruebas en el directorio 'test / Parse /' para macOS de 64 bits.  La opci√≥n -sv proporciona un indicador de ejecuci√≥n de prueba y muestra los resultados de solo pruebas fallidas. <br><br>  Lit.py tiene algunas otras caracter√≠sticas √∫tiles, como pruebas de tiempo y pruebas de latencia.  Puede ver estas y otras funciones con lit.py -h.  Lo m√°s √∫til se puede encontrar <a href="">aqu√≠</a> . <br><br>  Para ejecutar una prueba, escriba: <br><br><pre> <code class="swift hljs"> ./llvm/utils/lit/lit.py -sv ./build/<span class="hljs-type"><span class="hljs-type">Ninja</span></span>-<span class="hljs-type"><span class="hljs-type">RelWithDebInfoAssert</span></span>/swift-macosx-x86_64/test-macosx-x86_64/refactoring/<span class="hljs-type"><span class="hljs-type">RefactoringKind</span></span>/basic.swift</code> </pre> <br>  Si necesitamos extraer los √∫ltimos cambios del compilador, entonces debemos actualizar todas las dependencias y hacer una nueva versi√≥n.  Para actualizar, ejecute ./utils/update-checkout. <br><br><h2>  Conclusiones </h2><br>  Logramos nuestro objetivo: crear una herramienta que no estaba previamente en el IDE para optimizar el trabajo.  Si tambi√©n tiene ideas sobre c√≥mo mejorar los productos de Apple y hacer la vida m√°s f√°cil para toda la comunidad de iOS, si√©ntase libre de tomar la marca contraria, ¬°porque es m√°s f√°cil de lo que parece a primera vista! <br><br>  En 2015, Apple subi√≥ el c√≥digo fuente de Swift al dominio p√∫blico, lo que permiti√≥ sumergirse en los detalles de implementaci√≥n de su compilador.  Adem√°s, con Xcode 9, puede agregar herramientas de refactorizaci√≥n locales.  Un conocimiento b√°sico de C ++ y un dispositivo compilador es suficiente para que su IDE favorito sea un poco m√°s conveniente. <br><br>  La experiencia descrita fue √∫til para nosotros: adem√°s de crear una herramienta que simplifica el proceso de desarrollo, obtuvimos un conocimiento realmente completo del lenguaje.  Una caja de Pandora ligeramente abierta con procesos de bajo nivel le permite ver las tareas diarias desde un nuevo √°ngulo. <br><br>  ¬°Esperamos que el conocimiento adquirido tambi√©n enriquezca su comprensi√≥n del desarrollo! <br><br>  El material fue coescrito con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@victoriaqb</a> : Victoria Kashlina, desarrolladora de iOS. <br><br><h2>  Fuentes </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dispositivo compilador r√°pido.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬øC√≥mo construir una herramienta basada en compilador Swift?</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La gu√≠a paso a paso.</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Volcar el Swift AST para un proyecto iOS</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Presentamos el probador de estr√©s sourcekitd</a> <br></li><li>  <a href="">Prueba r√°pida</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">[SR-5744] Acci√≥n de refactorizaci√≥n para convertir if-let en guard-let y viceversa # 24566</a> <br></li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/460227/">https://habr.com/ru/post/460227/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460213/index.html">C√≥mo comprar un boleto de la manera m√°s barata posible o mediante el monitoreo de precios din√°micos</a></li>
<li><a href="../460215/index.html">Los inform√°ticos ampl√≠an el alcance del conocimiento de la prueba</a></li>
<li><a href="../460221/index.html">C√≥mo hacer preguntas si es un principiante especialista en TI</a></li>
<li><a href="../460223/index.html">Desde la web y los bancos hasta el desarrollo de iOS: la experiencia personal del programador Apiqa</a></li>
<li><a href="../460225/index.html">Sobre el escritorio para el trabajo de pie, la salud de la columna y la efectividad personal</a></li>
<li><a href="../460231/index.html">OpenGear: reduzca el tiempo de inactividad comercial con un servidor de consola con administraci√≥n fuera de banda</a></li>
<li><a href="../460233/index.html">El juego Cities: Skylines result√≥ ser Turing completo: creamos un sumador de 4 bits</a></li>
<li><a href="../460237/index.html">Estafadores de eBay (una historia de trampa)</a></li>
<li><a href="../460239/index.html">C√≥mo obtener NextGen Firewall usted mismo en casa absolutamente gratis</a></li>
<li><a href="../460241/index.html">Infierno o agua alta: historia de la literatura de ciencia popular rusa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>