<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéæ üö≠ üêö 5 M√∂glichkeiten, einen Python-Server auf einem Raspberry Pi zu erstellen Teil 2 üçõ üë©üèæ‚Äç‚úàÔ∏è üê§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr. 

 Heute werden wir weiterhin die Netzwerkf√§higkeiten des Raspberry Pi bzw. deren Implementierung in Python untersuchen. Im ersten Teil ha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>5 M√∂glichkeiten, einen Python-Server auf einem Raspberry Pi zu erstellen Teil 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472464/">  Hallo Habr. <br><br>  Heute werden wir weiterhin die Netzwerkf√§higkeiten des Raspberry Pi bzw. deren Implementierung in Python untersuchen.  Im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ersten Teil haben</a> wir die Grundfunktionen des einfachsten Webservers untersucht, der auf dem Raspberry Pi ausgef√ºhrt wird.  Jetzt werden wir noch weiter gehen und verschiedene M√∂glichkeiten in Betracht ziehen, um unseren Server interaktiv zu gestalten. <br><br><img src="https://habrastorage.org/webt/el/mj/q2/elmjq2v_pe9vuinjagdxacuz2u0.png"><br><br>  Der Artikel ist f√ºr Anf√§nger gedacht. <a name="habracut"></a><br><br>  Bevor Sie ein paar Notizen beginnen. <br><br>  Zun√§chst bezweifelte ich selbst, ob es sich lohnt, eine Fortsetzung zu machen, und erwartete <i>einen</i> gr√∂√üeren Fluss an Kritik und niedrigen Bewertungen, aber wie die Umfrage im ersten Teil ergab, fanden 85% der Leser die dort bereitgestellten Informationen n√ºtzlich.  Ich verstehe, dass einige Pro-Artikel f√ºr Dummies nervig sind, aber alle haben einmal angefangen, also muss man warten. <br><br>  Zweitens werde ich √ºber Programmierung schreiben, nicht √ºber Administration.  Daher werden die Probleme bei der Konfiguration von Raspbian, Konfigurationen, VPN, Sicherheit und anderen Dingen hier nicht ber√ºcksichtigt.  Obwohl dies auch wichtig ist, kann man das Unermessliche nicht annehmen.  Es geht nur um Python und darum, wie man einen Server darauf erstellt. <br><br>  Wer nicht interessiert ist, kann jetzt im Browser auf den Zur√ºck-Button klicken und seine wertvolle Zeit nicht verschwenden;) <br><br>  Und wir werden anfangen. <br><br>  Ich m√∂chte Sie daran erinnern, dass wir im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherigen Teil</a> einen einfachen Webserver auf einem Raspberry Pi gestartet haben, der eine statische Seite zeigt: <br><br><img src="https://habrastorage.org/webt/9y/ur/j9/9yurj9o1c452hvs930r3kdlpyng.png" alt="Bild"><br><br>  Jetzt werden wir weiter gehen und unseren Server interaktiv machen und der Webseite eine LED-Steuerung hinzuf√ºgen.  Nat√ºrlich kann es anstelle der LED jedes andere Ger√§t geben, das von GPIO gesteuert werden kann, aber mit der LED ist es am einfachsten, ein Experiment durchzuf√ºhren. <br><br><h2>  Vorbereitung </h2><br>  Ich werde nicht beschreiben, wie man die LED an den Raspberry Pi anschlie√üt, jeder kann sie in 5 Minuten bei Google finden.  Wir werden mehrere Funktionen f√ºr die gleichzeitige Verwendung von GPIO schreiben, die wir dann in unseren Server einf√ºgen. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RPi.GPIO <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> GPIO <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ModuleNotFoundError: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> led_pin = <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">raspberrypi_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: GPIO.setmode(GPIO.BCM) GPIO.setup(led_pin, GPIO.OUT) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rasperrypi_pinout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pin: int, value: bool)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"LED ON"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">"LED OFF"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: GPIO.output(pin, value) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rasperrypi_cleanup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: GPIO.cleanup() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br>  Wie Sie sehen k√∂nnen, ist jede GPIO-Aufruffunktion in einen Try-Catch-Block "eingeschlossen".  Warum wird das gemacht?  Auf diese Weise k√∂nnen Sie den Server auf jedem PC, einschlie√ülich Windows, debuggen, was sehr praktisch ist.  Jetzt k√∂nnen wir diese Funktionen in den Webserver-Code einf√ºgen. <br><br>  Unsere Aufgabe ist es, der Webseite Schaltfl√§chen hinzuzuf√ºgen, mit denen wir die LED √ºber den Browser steuern k√∂nnen.  Es werden 3 Arten der Implementierung betrachtet. <br><br><h2>  Methode 1: Falsch </h2><br>  Diese Methode kann nicht als sch√∂n bezeichnet werden, ist aber kurz und am einfachsten zu verstehen. <br><br>  Erstellen Sie eine Zeile mit einer HTML-Seite. <br><br><pre> <code class="python hljs">html = <span class="hljs-string"><span class="hljs-string">'''&lt;html&gt; &lt;style&gt;html{font-family: Helvetica; display:inline-block; margin: 0px auto; text-align: center;} .button_led {display: inline-block; background-color: #e7bd3b; border: none; border-radius: 4px; color: white; padding: 16px 40px; text-decoration: none; font-size: 30px; margin: 2px; cursor: pointer;} &lt;/style&gt; &lt;body&gt; &lt;h2&gt;Hello from the Raspberry Pi!&lt;/h2&gt; &lt;p&gt;&lt;a href="/led/on"&gt;&lt;button class="button button_led"&gt;Led ON&lt;/button&gt;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href="/led/off"&gt;&lt;button class="button button_led"&gt;Led OFF&lt;/button&gt;&lt;/a&gt;&lt;/p&gt; &lt;/body&gt; &lt;/html&gt;'''</span></span></code> </pre> <br>  Hier sind 3 Punkte zu beachten: <br><br><ul><li>  Wir verwenden CSS, um den Stil der Schaltfl√§chen festzulegen.  Sie k√∂nnten dies nicht tun und mit nur 4 Zeilen HTML-Code auskommen, aber dann w√ºrde unsere Seite wie "Gr√º√üe aus den 90ern" aussehen: <br><br><img src="https://habrastorage.org/webt/cc/fc/qu/ccfcquo-kundjijwwobgpqpea_c.png"></li><li>  F√ºr jede Schaltfl√§che erstellen wir einen lokalen Link wie / led / on und / led / off </li><li>  Das Mischen von Ressourcen und Code ist ein schlechter Programmierstil, und im Idealfall wird HTML am besten vom Python-Code getrennt.  Mein Ziel ist es jedoch, minimal funktionierenden Code anzuzeigen, in dem ein Minimum an √úberfl√ºssigkeit vorhanden ist, sodass einige Dinge der Einfachheit halber weggelassen werden.  Dar√ºber hinaus ist es praktisch, wenn der Code einfach aus einem Artikel kopiert werden kann, ohne dass zus√§tzliche Dateien erforderlich sind. </li></ul><br>  Wir haben den Server bereits im vorherigen Teil untersucht. Es bleibt noch die Verarbeitung der Zeilen '/ led / on' und '/ led / off' hinzuzuf√ºgen.  Der gesamte Code wurde aktualisiert: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> http.server <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BaseHTTPRequestHandler, HTTPServer <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServerHandler</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BaseHTTPRequestHandler)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_GET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"GET request, Path:"</span></span>, self.path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> self.path.endswith(<span class="hljs-string"><span class="hljs-string">"/led/on"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> self.path.endswith(<span class="hljs-string"><span class="hljs-string">"/led/off"</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path.endswith(<span class="hljs-string"><span class="hljs-string">"/led/on"</span></span>): rasperrypi_pinout(led_pin, <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path.endswith(<span class="hljs-string"><span class="hljs-string">"/led/off"</span></span>): rasperrypi_pinout(led_pin, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>) self.end_headers() self.wfile.write(html.encode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.send_error(<span class="hljs-number"><span class="hljs-number">404</span></span>, <span class="hljs-string"><span class="hljs-string">"Page Not Found {}"</span></span>.format(self.path)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">server_thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(port)</span></span></span><span class="hljs-function">:</span></span> server_address = (<span class="hljs-string"><span class="hljs-string">''</span></span>, port) httpd = HTTPServer(server_address, ServerHandler) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: httpd.serve_forever() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> KeyboardInterrupt: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> httpd.server_close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: port = <span class="hljs-number"><span class="hljs-number">8000</span></span> print(<span class="hljs-string"><span class="hljs-string">"Starting server at port %d"</span></span> % port) raspberrypi_init() server_thread(port) rasperrypi_cleanup()</code> </pre><br>  Wir starten es und wenn alles richtig gemacht wurde, k√∂nnen wir die LED √ºber unseren Webserver steuern: <br><br><img src="https://habrastorage.org/webt/np/f3/ip/npf3ipmqfd-movc084uxpgibhxa.png"><br><br>  Sie k√∂nnen den Server nicht nur unter Raspberry Pi, sondern auch unter Windows oder OSX testen. In der Konsole werden LED-EIN- und LED-AUS-Meldungen angezeigt, wenn Sie auf die entsprechende Schaltfl√§che klicken: <br><br><img src="https://habrastorage.org/webt/bf/a1/hn/bfa1hne52ewrqpimi76d4bqyzxq.png"><br><br>  Jetzt finden wir heraus, warum diese Methode schlecht ist und warum sie "falsch" ist.  Dieses Beispiel funktioniert sehr gut und wird h√§ufig in verschiedenen Tutorials kopiert.  Es gibt jedoch zwei Probleme: Erstens ist es falsch, die gesamte Seite neu zu laden, wenn nur die LED aufleuchten soll.  Das ist aber immer noch das halbe Problem.  Das zweite und schwerwiegendere Problem ist, dass beim Dr√ºcken der Taste zum Einschalten der LED die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Seitenadresse http://192.168.1.106:8000/led/on lautet</a> .  Browser erinnern sich normalerweise an die zuletzt ge√∂ffnete Seite, und wenn Sie das n√§chste Mal den Browser √∂ffnen, funktioniert der Befehl zum Einschalten der LED wieder, auch wenn wir dies nicht wollten.  Daher werden wir zum n√§chsten, korrekteren Weg √ºbergehen. <br><br><h2>  Methode 2: Richtig </h2><br>  Um alles richtig zu machen, setzen wir die Ein- und Ausschaltfunktionen der LED in separaten Anforderungen aus und rufen sie mit Javascript asynchron auf.  Der HTML-Code f√ºr die Seite sieht nun folgenderma√üen aus: <br><br><pre> <code class="python hljs">html = <span class="hljs-string"><span class="hljs-string">'''&lt;html&gt; &lt;style&gt;html{font-family: Helvetica; display:inline-block; margin: 0px auto; text-align: center;} .button_led {display: inline-block; background-color: #e7bd3b; border: none; border-radius: 4px; color: white; padding: 16px 40px; text-decoration: none; font-size: 30px; margin: 2px; cursor: pointer;} &lt;/style&gt; &lt;script type="text/javascript" charset="utf-8"&gt; function httpGetAsync(method, callback) { var xmlHttp = new XMLHttpRequest(); xmlHttp.onreadystatechange = function() { if (xmlHttp.readyState == 4 &amp;&amp; xmlHttp.status == 200) callback(xmlHttp.responseText); } xmlHttp.open("GET", window.location.href + method, true); xmlHttp.send(null); } function ledOn() { console.log("Led ON..."); httpGetAsync("led/on", function(){ console.log("Done"); }); } function ledOff() { console.log("Led OFF..."); httpGetAsync("led/off", function(){ console.log("Done"); }); } &lt;/script&gt; &lt;body&gt; &lt;h2&gt;Hello from the Raspberry Pi!&lt;/h2&gt; &lt;p&gt;&lt;button class="button button_led" onclick="ledOn();"&gt;Led ON&lt;/button&gt;&lt;/p&gt; &lt;p&gt;&lt;button class="button button_led" onclick="ledOff();"&gt;Led OFF&lt;/button&gt;&lt;/p&gt; &lt;/body&gt; &lt;/html&gt;'''</span></span></code> </pre> <br>  Wie Sie sehen, haben wir href aufgegeben und die Funktionen ledOn und ledOff aufgerufen, die wiederum die entsprechenden Servermethoden asynchron aufrufen (asynchrone Methoden sind erforderlich, damit die Seite nicht blockiert wird, bis die Antwort vom Server eintrifft). <br><br>  Jetzt muss noch die Verarbeitung von Get-Anfragen zum Server hinzugef√ºgt werden: <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_GET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"GET request, path:"</span></span>, self.path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/"</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>) self.end_headers() self.wfile.write(html.encode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/led/on"</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>) self.end_headers() rasperrypi_pinout(led_pin, <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) self.wfile.write(<span class="hljs-string"><span class="hljs-string">b"OK"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/led/off"</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>) self.end_headers() rasperrypi_pinout(led_pin, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) self.wfile.write(<span class="hljs-string"><span class="hljs-string">b"OK"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.send_error(<span class="hljs-number"><span class="hljs-number">404</span></span>, <span class="hljs-string"><span class="hljs-string">"Page Not Found {}"</span></span>.format(self.path))</code> </pre> <br>  Wie Sie sehen, wird die Seite jetzt nicht mehr neu geladen, wenn Sie versuchen, die LED zu beleuchten. Jede Methode macht nur das, was sie tun sollte. <br><br><h2>  Methode 3: Richtiger </h2><br>  Alles scheint schon zu funktionieren.  Aber nat√ºrlich kann (und sollte) der obige Code verbessert werden.  Tatsache ist, dass wir GET-Anfragen verwenden, um die LED zu steuern.  Dies spart uns Platz im Code, ist jedoch methodisch nicht ganz korrekt. GET-Anforderungen dienen zum <i>Lesen von Daten</i> vom Server, k√∂nnen vom Browser zwischengespeichert werden und sollten im Allgemeinen nicht zum <i>√Ñndern von</i> Daten verwendet werden.  Der richtige Weg ist die Verwendung von POST (f√ºr diejenigen, die an Details interessiert sind, weitere Details <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://www.w3schools.com/tags/ref_">hier</a> ). <br><br>  Wir werden die Aufrufe in HTML von get to post √§ndern. Da unser Code jedoch asynchron ist, wird der Status des Wartens auf die Antwort des Servers und der Arbeitsergebnisse angezeigt.  F√ºr ein lokales Netzwerk wird dies nicht bemerkt, aber f√ºr eine langsame Verbindung ist es sehr praktisch.  Um es interessanter zu machen, werden wir JSON verwenden, um Parameter zu √ºbergeben. <br><br>  Die endg√ºltige Version sieht folgenderma√üen aus: <br><br><pre> <code class="python hljs">html = <span class="hljs-string"><span class="hljs-string">'''&lt;html&gt; &lt;style&gt;html{font-family: Helvetica; display:inline-block; margin: 0px auto; text-align: center;} .button_led {display: inline-block; background-color: #e7bd3b; border: none; border-radius: 4px; color: white; padding: 16px 40px; text-decoration: none; font-size: 30px; margin: 2px; cursor: pointer;} &lt;/style&gt; &lt;script type="text/javascript" charset="utf-8"&gt; function httpPostAsync(method, params, callback) { var xmlHttp = new XMLHttpRequest(); xmlHttp.onreadystatechange = function() { if (xmlHttp.readyState == 4 &amp;&amp; xmlHttp.status == 200) callback(xmlHttp.responseText); else callback(`Error ${xmlHttp.status}`) } xmlHttp.open("POST", window.location.href + method, true); xmlHttp.setRequestHeader("Content-Type", "application/json"); xmlHttp.send(params); } function ledOn() { document.getElementById("textstatus").textContent = "Making LED on..."; httpPostAsync("led", JSON.stringify({ "on": true }), function(resp) { document.getElementById("textstatus").textContent = `Led ON: ${resp}`; }); } function ledOff() { document.getElementById("textstatus").textContent = "Making LED off..."; httpPostAsync("led", JSON.stringify({ "on": false }), function(resp) { document.getElementById("textstatus").textContent = `Led OFF: ${resp}`; }); } &lt;/script&gt; &lt;body&gt; &lt;h2&gt;Hello from the Raspberry Pi!&lt;/h2&gt; &lt;p&gt;&lt;button class="button button_led" onclick="ledOn();"&gt;Led ON&lt;/button&gt;&lt;/p&gt; &lt;p&gt;&lt;button class="button button_led" onclick="ledOff();"&gt;Led OFF&lt;/button&gt;&lt;/p&gt; &lt;span id="textstatus"&gt;Status: Ready&lt;/span&gt; &lt;/body&gt; &lt;/html&gt;'''</span></span></code> </pre> <br>  Unterst√ºtzung f√ºr GET- und POST-Anforderungen zum Server hinzuf√ºgen: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServerHandler</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BaseHTTPRequestHandler)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_GET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">"GET request, path:"</span></span>, self.path) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/"</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/html'</span></span>) self.end_headers() self.wfile.write(html.encode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.send_error(<span class="hljs-number"><span class="hljs-number">404</span></span>, <span class="hljs-string"><span class="hljs-string">"Page Not Found {}"</span></span>.format(self.path)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_POST</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> content_length = int(self.headers[<span class="hljs-string"><span class="hljs-string">'Content-Length'</span></span>]) body = self.rfile.read(content_length) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: print(<span class="hljs-string"><span class="hljs-string">"POST request, path:"</span></span>, self.path, <span class="hljs-string"><span class="hljs-string">"body:"</span></span>, body.decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.path == <span class="hljs-string"><span class="hljs-string">"/led"</span></span>: data_dict = json.loads(body.decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">'on'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data_dict: rasperrypi_pinout(led_pin, data_dict[<span class="hljs-string"><span class="hljs-string">'on'</span></span>]) self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>) self.end_headers() self.wfile.write(<span class="hljs-string"><span class="hljs-string">b"OK"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.send_response(<span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-string"><span class="hljs-string">'Bad Request: Method does not exist'</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>, <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>) self.end_headers() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> err: print(<span class="hljs-string"><span class="hljs-string">"do_POST exception: %s"</span></span> % str(err))</code> </pre> <br>  Wie Sie sehen k√∂nnen, verwenden wir jetzt eine LED-Funktion, an die der Parameter on mit json √ºbergeben wird, das True oder False akzeptiert (beim Aufruf in HTML wird jeweils eine json-Zeichenfolge der Form {"on": true} √ºbertragen).  Es lohnt sich auch, auf try-catch zu achten - dies verhindert, dass der Server herunterf√§llt, beispielsweise wenn jemand eine Zeichenfolge mit ung√ºltigem json an den Server sendet. <br><br>  Wenn alles richtig gemacht wurde, bekommen wir einen Server mit Feedback, der ungef√§hr so ‚Äã‚Äãaussehen sollte: <br><br><img src="https://habrastorage.org/webt/2b/tz/nv/2btznv4uxbfp8hhu4yxljcbfztc.png"><br><br>  Feedback, in unserem Fall die Meldung "OK", erm√∂glicht es Ihnen, die Best√§tigung vom Server zu sehen, dass der Code tats√§chlich verarbeitet wurde. <br><br>  Kann dieser Server noch verbessert werden?  Sie k√∂nnen beispielsweise sinnvoll sein, die Verwendung der Druckfunktion durch die Verwendung der Protokollierung zu ersetzen. Dies ist korrekter und erm√∂glicht es Ihnen, Serverprotokolle nicht nur auf dem Bildschirm anzuzeigen, sondern auch, wenn Sie sie in eine Datei mit automatischer Rotation schreiben m√∂chten.  Wer m√∂chte, kann dies selbst tun. <br><br><h2>  Fazit </h2><br>  Wenn alles richtig gemacht wurde, erhalten wir einen Mini-Server, mit dem Sie die LED oder ein anderes Ger√§t √ºber einen Browser von jedem Netzwerkger√§t aus steuern k√∂nnen. <br><br>  <b>Wichtig: Sicherheitsvorkehrungen</b> <br><br>  Ich stelle noch einmal fest, dass es hier keinen Schutz oder keine Authentifizierung gibt, daher sollten Sie eine solche Seite nicht im Internet "posten", wenn Sie vorhaben, eine mehr oder weniger verantwortungsvolle Last zu verwalten.  Obwohl mir die F√§lle von Angriffen auf solche Server unbekannt sind, lohnt es sich immer noch nicht, jemandem etwas zu geben, der das Garagentor aus der Ferne √∂ffnen oder die Kilowattheizung einschalten m√∂chte.  Wenn Sie eine Fernsteuerung √ºber eine solche Seite w√ºnschen, lohnt es sich, ein VPN oder √§hnliches einzurichten. <br><br>  Abschlie√üend wiederhole ich, dass das Material f√ºr Anf√§nger gedacht ist, und ich hoffe, dass dies mehr oder weniger n√ºtzlich war.  Es ist klar, dass nicht jeder auf Khabr mit der Verf√ºgbarkeit von Artikeln "f√ºr Dummies" zufrieden ist. Ob der n√§chste Teil also von den Abschlussnoten abh√§ngt oder nicht.  Wenn dies der Fall ist, werden die Flask- und WSGI-Frameworks sowie die grundlegenden Authentifizierungsmethoden ber√ºcksichtigt. <br><br>  Alle erfolgreichen Experimente. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de472464/">https://habr.com/ru/post/de472464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de472446/index.html">Wie man den Code auf "Habr√©" richtig f√§rbt und warum es so schwierig ist</a></li>
<li><a href="../de472448/index.html">Themen der Frontend-Sektion bei DUMP Kazan: ML f√ºr einen Front-End-Entwickler, Pixel Magic, SvelteJS, Lachen, Schwei√ü und Tr√§nen</a></li>
<li><a href="../de472452/index.html">Wie f√ºge ich Unterst√ºtzung f√ºr die Nachfrist (Billing Grace Period) in der iOS-Anwendung hinzu?</a></li>
<li><a href="../de472454/index.html">√úbersicht √ºber g√ºnstige VPS-Server</a></li>
<li><a href="../de472462/index.html">iFest in Nischni Nowgorod: IT ist beeindruckend</a></li>
<li><a href="../de472466/index.html">Nach Verteilung sortieren</a></li>
<li><a href="../de472468/index.html">ClusterJ - Arbeiten mit MySQL NDB Cluster von Java</a></li>
<li><a href="../de472470/index.html">Transgene M√§use und Anti-Aging</a></li>
<li><a href="../de472472/index.html">Ferienhaus im Winter: sein oder nicht sein?</a></li>
<li><a href="../de472474/index.html">Lustiger kosmetischer Fehler in Google Chrome</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>