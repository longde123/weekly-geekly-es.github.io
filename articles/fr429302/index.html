<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙍🏾 🏣 🥚 Utiliser UTF-8 dans les en-têtes HTTP 🧓🏿 😉 👨🏽‍🏫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comme vous le savez, HTTP 1.1 est un protocole de transfert de données basé sur du texte. Les messages HTTP sont codés à l'aide d'ISO-8859-1 (qui peut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Utiliser UTF-8 dans les en-têtes HTTP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/429302/"><img src="https://habrastorage.org/webt/hp/z_/bf/hpz_bf9tjnhftjoxvpacahso_ng.jpeg"><br><br>  Comme vous le savez, HTTP 1.1 est un protocole de transfert de données basé sur du texte.  Les messages HTTP sont codés à l'aide d'ISO-8859-1 (qui peut être conditionnellement considérée comme une version étendue d'ASCII contenant des trémas, des signes diacritiques et d'autres caractères utilisés dans les langues d'Europe occidentale).  Dans le même temps, un autre codage peut être utilisé dans le corps du message, qui doit être indiqué dans l'en-tête "Content-Type".  Mais que se passe-t-il si nous devons spécifier des caractères non ASCII non pas dans le corps du message, mais dans les en-têtes eux-mêmes?  Le cas le plus courant est probablement de mettre un nom de fichier dans l'en-tête «Content-Disposition».  Cela semble être une tâche assez courante, mais sa mise en œuvre n'est pas si évidente. <br><br>  TL; DR: utilisez l'encodage décrit dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFC 6266</a> pour «Content-Disposition» et convertissez le texte en latin (translittération) dans les autres cas. <br><a name="habracut"></a><br><h3>  Une petite introduction aux encodages </h3><br>  L'article mentionne et utilise des encodages US-ASCII (souvent appelés simplement ASCII), ISO-8859-1 et UTF-8.  Ceci est une petite introduction à ces encodages.  La section est destinée aux développeurs qui ne travaillent que rarement ou complètement avec des encodages et ont réussi à les oublier.  Si vous ne leur appartenez pas, n'hésitez pas à sauter la section. <br><br>  <b>ASCII</b> est un encodage simple contenant 128 caractères et comprenant l'alphabet anglais entier, les chiffres, les signes de ponctuation et les caractères de service. <br><br><img src="https://habrastorage.org/webt/as/0s/ao/as0saoyn9xha8zn_tbnc-xfr0mo.png"><br><br>  7 bits suffisent pour représenter n'importe quel caractère ASCII.  Le mot "test" sera représenté dans la représentation HEX comme 0x74 0x65 0x73 0x74.  Le premier bit pour tous les caractères est toujours 0, car les caractères sont codés 128 et l'octet fournit 2 ^ 8 = 256 options. <br><br>  <b>ISO-8859-1</b> est un codage destiné aux langues d'Europe occidentale.  Contient des signes diacritiques français, des trémas allemands, etc. <br><br><img src="https://habrastorage.org/webt/rj/0d/0n/rj0d0n42-tdyjhhuu5zsr4mith0.png"><br><br>  Le codage contient 256 caractères et peut donc être représenté par un octet.  La première moitié (128 caractères) est exactement la même que ASCII.  Ainsi, si le premier bit = 0, il s'agit d'un caractère ASCII normal.  Si 1, il s'agit d'un caractère spécifique à ISO-8859-1. <br><br>  <b>UTF-8</b> est l'un des encodages les plus connus avec ASCII.  Capable de coder 1.112.064 caractères.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La taille de chaque caractère varie</a> de 1 à 4 octets ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">auparavant,</a> jusqu'à 6 octets étaient autorisés). <br><br><img src="https://habrastorage.org/webt/3u/h_/cu/3uh_cut1zl6vfutk2lg0db2imio.png"><br><br>  Le programme travaillant avec ce codage détermine par les premiers bits combien d'octets sont inclus dans le caractère.  Si l'octet commence à 0, le caractère est représenté par un octet.  110 - deux octets, 1110 - trois octets, 11110 - 4 octets. <br><br>  Comme avec ISO-8859-1, les 128 premiers caractères sont entièrement compatibles ASCII.  Par conséquent, les textes utilisant uniquement des caractères ASCII seront absolument identiques dans la représentation binaire, que US-ASCII, ISO-8859-1 ou UTF-8 ait été utilisé pour l'encodage. <br><br><h3>  Utiliser UTF-8 dans le corps d'un message </h3><br>  Avant de passer aux en-têtes, examinons rapidement comment utiliser UTF-8 dans le corps des messages.  Pour ce faire, utilisez l'en-tête <b>"Content-Type"</b> . <br><br><img src="https://habrastorage.org/webt/ji/h_/be/jih_beowiy02xqbvmrjlgiit-8g.png"><br><br>  Si le "Content-Type" n'est pas spécifié, le navigateur doit alors traiter les messages comme s'ils étaient écrits en ISO-8859-1.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le navigateur ne doit pas</a> essayer de deviner l'encodage et, de plus, ignorer le "Content-Type".  Mais ce qui apparaît réellement dans une situation où le "Content-Type" n'est pas transmis dépend de l'implémentation du navigateur.  Par exemple, Firefox fera selon la spécification et lira le message comme s'il était codé en ISO-8859-1.  Google Chrome, en revanche, utilisera l'encodage du système d'exploitation, qui pour de nombreux utilisateurs russes est égal à Windows-1251.  Dans tous les cas, si le message était en UTF-8, il ne s'affichera pas correctement. <br><br><img src="https://habrastorage.org/webt/wt/t6/yd/wtt6yd6vgnvu3b8akanox7yj3ic.png"><br><br><h3>  Nous mettons le message UTF-8 dans la valeur d'en-tête </h3><br>  Avec le corps du message, tout est assez simple.  Le corps du message suit toujours les en-têtes, il n'y a donc aucun problème technique.  Mais qu'en est-il des titres?  La spécification <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">indique explicitement</a> que l'ordre des en-têtes dans le message n'a pas d'importance.  C'est-à-dire  il n'est pas possible de spécifier l'encodage dans un en-tête via un autre en-tête. <br><br>  Que se passe-t-il si vous prenez et écrivez simplement la valeur UTF-8 dans la valeur d'en-tête?  Nous avons vu qu'une telle astuce avec le corps du message entraînera une simple lecture de la valeur dans ISO-8859-1.  Il serait logique de supposer que la même chose se produira avec le titre.  Mais ce n'est pas le cas.  En fait, dans de nombreux cas, sinon dans la plupart des cas, cette solution fonctionnera.  Cela inclut les anciens iPhones, IE11, Firefox, Google Chrome.  Le seul navigateur à portée de main lorsque j'ai écrit cet article qui ne voulait pas travailler avec ce titre était Edge. <br><br><img src="https://habrastorage.org/webt/-w/jt/h7/-wjth7oxa2u3zdbb7g_cjk_zcva.png"><br><br>  Ce comportement n'est pas enregistré dans les spécifications.  Peut-être que les développeurs de navigateurs ont décidé de leur faciliter la vie et de détecter automatiquement que les en-têtes des messages étaient encodés en UTF-8.  En général, ce n'est pas une tâche si difficile.  Nous regardons le premier bit: si 0, puis ASCII, si 1 - alors, éventuellement, UTF-8. <br><br>  Y a-t-il une intersection avec ISO-8859-1 dans ce cas?  En fait, presque aucun.  Prenez par exemple UTF-8 un caractère de 2 octets (les lettres russes sont représentées par deux octets).  Le symbole dans le binaire présenté ressemblera à: <i>110xxxxx 10xxxxxx</i> .  Dans la représentation HEX: <i>[0xC0-0x6F] [0x80-0xBF]</i> .  Dans ISO-8859-1, ces caractères peuvent difficilement encoder quelque chose qui porte une charge sémantique.  Par conséquent, le risque que le navigateur déchiffre le message de manière incorrecte est très faible. <br><br>  Cependant, lorsque vous essayez d'utiliser cette méthode, vous pouvez rencontrer des problèmes techniques: votre serveur Web ou votre infrastructure peut tout simplement ne pas autoriser l'écriture de caractères UTF-8 dans la valeur d'en-tête.  Par exemple, Apache Tomcat met 0x3F (point d'interrogation) au lieu de tous les caractères UTF-8.  Bien sûr, cette restriction peut être contournée, mais si l'application elle-même se serre la main et ne vous permet pas de faire quelque chose, vous n'avez peut-être pas besoin de le faire. <br><br>  Mais, que votre framework ou votre serveur vous autorise ou non à écrire des messages UTF-8 dans l'en-tête, je ne recommande pas de le faire.  Ce n'est pas une solution documentée qui peut cesser de fonctionner dans les navigateurs à un moment donné. <br><br><h3>  Translit </h3><br>  Je pense que translit est utilisé - eto bolee horoshee reshenie.  Beaucoup de grandes ressources russes populaires ne dédaignent pas d'utiliser la translittération dans les noms de fichiers.  Il s'agit d'une solution garantie qui ne cassera pas avec la sortie de nouveaux navigateurs et qui n'a pas besoin d'être testée séparément sur chaque plateforme.  Bien sûr, vous devez réfléchir à la façon de convertir tout le spectre des caractères possibles, ce qui peut ne pas être complètement trivial.  Par exemple, si l'application est conçue pour un public russe, les lettres tatares ә et ң peuvent apparaître dans le nom du fichier, qui doit être traité d'une manière ou d'une autre, et pas seulement remplacé par "?". <br><br><h3>  RFC 2047 </h3><br>  Comme je l'ai déjà mentionné, le tomkat ne m'a pas permis de mettre UTF-8 dans l'en-tête du message.  Cette fonctionnalité de comportement est-elle reflétée dans les documents Java pour les servlets?  Oui, réfléchi: <br><br><img src="https://habrastorage.org/webt/oj/yi/2e/ojyi2e2b9fvcjatf9zrpda_njha.png"><br><br>  Mentionné <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFC 2047</a> .  J'ai essayé d'encoder des messages en utilisant ce format - le navigateur ne m'a pas compris.  Cette méthode de codage ne fonctionne pas dans HTTP.  Bien qu'il ait travaillé auparavant.  Par exemple, un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ticket pour supprimer la</a> prise en charge de cet encodage dans Firefox. <br><br><h3>  RFC 6266 </h3><br>  Dans le ticket, dont le lien se trouve dans la section précédente, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">il y a des références selon</a> lesquelles même après la fin de la prise en charge de la RFC 2047, il existe toujours un moyen de transférer les valeurs UTF-8 au nom des fichiers téléchargés: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFC 6266</a> .  À mon avis, c'est la décision la plus correcte à ce jour.  De nombreuses ressources en ligne populaires l'utilisent.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chez CUBA Platform, nous</a> utilisons également ce RFC particulier pour générer le «Content-Disposition». <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La RFC 6266</a> est une spécification décrivant l'utilisation de l'en-tête «Content-Disposition».  La méthode de codage elle-même est décrite en détail dans une autre spécification, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFC 8187</a> . <br><br><img src="https://habrastorage.org/webt/ex/rr/j6/exrrj6nvpp-fi5wpdkfm0f4dkzk.png"><br><br>  Le paramètre «filename» contient le nom de fichier en ASCII, «filename *» - dans tout encodage nécessaire.  Avec les deux attributs, «nom de fichier» est ignoré dans tous les navigateurs modernes (y compris IE11 et les anciennes versions de Safari).  En revanche, la plupart des anciens navigateurs ignorent «nom de fichier *». <br><br>  Lorsque vous utilisez cette méthode de codage, le paramètre indique d'abord le codage, suivi de la valeur codée.  Les caractères visibles de l'encodage ASCII ne nécessitent pas.  Les caractères restants sont simplement écrits en représentation hexadécimale, avec un "%" avant chaque octet. <br><br><h3>  Que faire des autres en-têtes? </h3><br>  Le codage décrit dans RFC 8187 n'est pas universel.  Oui, vous pouvez mettre un paramètre avec un préfixe * dans l'en-tête, et cela peut même fonctionner pour certains navigateurs, mais la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">spécification prescrit de</a> ne pas le faire. <br><br>  Dans chaque cas où UTF-8 est pris en charge dans les en-têtes, il y a actuellement une mention explicite de cela dans le RFC correspondant.  En plus de Content-Disposition, cet encodage est utilisé, par exemple, dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la liaison Web</a> et l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">authentification d'accès Digest</a> . <br><br>  Il convient de noter que les normes dans ce domaine sont en constante évolution.  L'utilisation du codage décrit ci-dessus dans HTTP n'a été <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">proposée qu'en 2010</a> .  L'utilisation de cet encodage dans «Content-Disposition» a été <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fixée dans la norme en 2011</a> .  Bien que ces normes ne soient qu'au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">stade de «proposition de norme»</a> , elles sont prises en charge partout.  L'option selon laquelle nous attendons à l'avenir de nouvelles normes qui permettront un travail plus uniforme avec différents encodages dans les en-têtes n'est pas exclue.  Il ne reste donc qu'à suivre l'actualité dans le monde des standards HTTP et leur niveau de support du côté des navigateurs. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429302/">https://habr.com/ru/post/fr429302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429288/index.html">Développeur! Ne vous considérez pas comme un assez bon spécialiste, ce n'est pas vrai</a></li>
<li><a href="../fr429290/index.html">Tesla va construire une autre batterie géante en Australie</a></li>
<li><a href="../fr429292/index.html">Réponses du support technique 3CX: mise à niveau rapide et gratuite vers la dernière version 3CX</a></li>
<li><a href="../fr429296/index.html">Vélo électrique Shit and Stick</a></li>
<li><a href="../fr429298/index.html">Mises à jour sur VPS.today</a></li>
<li><a href="../fr429306/index.html">Vendredi. Bullshit 4.3</a></li>
<li><a href="../fr429308/index.html">Comment j'ai quitté une startup dans une grande entreprise</a></li>
<li><a href="../fr429310/index.html">Location, chasse, formation et développement de rubistes. Coin RH à la conférence RubyRussia-2018</a></li>
<li><a href="../fr429312/index.html">Logique de jeu commune sur le client et le serveur</a></li>
<li><a href="../fr429314/index.html">Aperçu des plates-formes de largage crypto populaires</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>