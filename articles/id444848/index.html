<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¢ ğŸ„ ğŸ¤´ğŸ½ Betapa mudahnya mengirimkan pesanan, mengetahui alamat pelanggan (tidak terlalu) ğŸ‘¨ğŸ¿â€ğŸš’ ğŸ‘¿ ğŸ•ºğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya! Nama saya Denis Girko, saya adalah arsitek sistem platform e-commerce di Lamoda. Tahun lalu saya berbicara di konferensi DevConf dengan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Betapa mudahnya mengirimkan pesanan, mengetahui alamat pelanggan (tidak terlalu)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lamoda/blog/444848/"><p>  Halo semuanya!  Nama saya Denis Girko, saya adalah arsitek sistem platform e-commerce di Lamoda.  Tahun lalu saya berbicara di konferensi DevConf dengan sebuah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">laporan</a> yang ingin saya bagikan dengan Anda. </p><br><p> Ini adalah laporan ulasan tentang kesulitan yang dihadapi sebuah toko online besar dalam proses pengiriman pesanan dan solusi teknis apa yang dapat membantu mengatasinya (menggunakan solusi yang kami uji di Lamoda sebagai contoh). </p><br><p><img src="https://habrastorage.org/webt/vc/1p/24/vc1p24p8id79oozynnspkyikg0k.jpeg" alt="gambar"></p><br><p>  Tentang apa ini?  Saya akan memberi tahu Anda: </p><br><ul><li>  Tentang proses pengiriman dan mengidentifikasi masalah; </li><li>  cara menyimpan wilayah pengiriman secara efektif dalam basis data; </li><li>  cara meningkatkan kualitas data yang kami terima dari klien; </li><li>  cara mencari penerima di basis data alamat untuk menemukan hasil yang lebih akurat. </li></ul><a name="habracut"></a><br><h3 id="obschaya-shema-dostavki-zakaza-lamoda">  Skema Pengiriman Pesanan Lamoda Umum </h3><br><p>  Lamoda adalah toko online dengan empat negara pengiriman: Rusia, Ukraina, Kazakhstan, Belarus.  Kami mengirimkan barang keesokan harinya karena fakta bahwa kami memiliki layanan pengiriman sendiri dan selusin mitra pihak ketiga yang layanannya kami gunakan.  Pengiriman adalah bagian besar dari bisnis kami. </p><br><p>  Lamoda menerima pesanan, meminta klien untuk alamat pada saat pendaftaran dan meneruskannya ke layanan kurir. </p><br><p><img src="https://habrastorage.org/webt/ng/2d/i1/ng2di1movib3pmlisotbmwq-ffq.png" alt="gambar"></p><cut></cut><br><p>  Bagaimana jika kita tidak memiliki satu layanan kurir, tetapi beberapa?  Kemudian langkah selanjutnya ditambahkan - untuk menentukan layanan pengiriman mana kami akan mengambil pesanan. </p><br><p><img src="https://habrastorage.org/webt/1v/6z/7c/1v6z7ceacbfmk5kctkqh1ss1jeg.png" alt="gambar"></p><br><p>  Mungkin ada beberapa kriteria pemilihan bisnis.  Tetapi hal pertama yang harus dipikirkan adalah apakah layanan kurir ini memiliki pengiriman ke kota yang dipilih oleh klien atau tidak.  Oleh karena itu, langkah pertama dalam mengintegrasikan perusahaan kurir ke dalam sistem kami adalah menemukan area jangkauannya. <br><img src="https://habrastorage.org/webt/_n/xx/wv/_nxxwvl8qncwmm8vhqhgd2g_qo4.png" alt="gambar"><br>  Selanjutnya, Anda perlu mempelajari cara memeriksa apakah alamat klien termasuk dalam wilayah ini atau tidak. </p><br><p>  Skema umum akan ditingkatkan dan akan terlihat seperti ini: </p><br><ul><li>  minta alamat; </li><li>  mencari tahu layanan kurir mana yang dapat memberikannya; </li><li>  pilih yang Anda inginkan dari yang tersedia. </li></ul><br><p><img src="https://habrastorage.org/webt/7r/av/xo/7ravxognqcj0njydxoauolhxsbk.png" alt="gambar"></p><br><p>  Sekarang sedikit lebih banyak tentang langkah-langkah ini. </p><br><h3 id="sprashivaem-u-klienta-adres">  Kami meminta alamat klien </h3><br><p>  Bagaimana saya bisa bertanya padanya? </p><br><ol><li>  Mintalah untuk mengisi satu bidang besar.  Klien palu di alamatnya, yang selanjutnya tidak perlu manipulasi rumit.  Alamat tersebut dapat dicetak pada selembar kertas, diberikan kepada kurir dengan berjalan kaki, yang kemudian akan mencari tahu sendiri. </li><li>  Opsi kedua lebih rumit.  Kami meminta klien untuk mengisi setiap komponen alamat di bidangnya.  Di sini Anda sudah dapat melakukan sesuatu.  Misalnya, bandingkan kota Moskow dengan daftar kota yang diberikan.  Tetapi itu akan bekerja dengan buruk, karena kota Moskow dapat ditulis dengan banyak cara: â€œg.  Moskow "," kota Moskow "," kota Moskow "tanpa spasi, dan seterusnya. </li><li>  Oleh karena itu, ada opsi yang lebih maju.  Karena daftar kota yang kita miliki terbatas, Anda dapat melakukan pra-kompilasi daftar kota dan menyarankan agar klien memilih yang dia butuhkan.  Bonusnya adalah bahwa untuk setiap elemen daftar seperti itu kita sudah dapat mengaitkan beberapa pengidentifikasi di sini.  Kami pengembang senang bekerja bukan dengan string, tetapi dengan pengidentifikasi yang dapat digunakan di semua sistem kami sebagai setara dengan kota yang dipilih.  Saya memiliki indeks kantor pos pusat di slide sebagai pengenal. <br><img src="https://habrastorage.org/webt/cz/q9/sy/czq9syl4hieoqj8h88c7trupbim.png" alt="gambar"></li></ol><br><h3 id="kakoy-sluzhboy-dostavki-vezem">  Layanan pengiriman apa yang kamiangkut? </h3><br><p>  Karena kami memiliki pengidentifikasi (indeks), maka biarkan wilayah yang disimpan dalam database kami diwakili oleh daftar indeks.  Dalam hal ini, algoritma untuk memeriksa masuknya kota ke wilayah tersebut sangat sederhana.  Jadi mari kita lakukan: kita akan menempatkan wilayah pengiriman yang diterima dari layanan kurir dalam database dalam bentuk indeks. </p><br><p>  Indeks memiliki pro dan kontra mereka.  Saya akan mengatakan sebelumnya bahwa pada awalnya Lamoda melakukan hal itu: hasil memilih klien kota adalah indeks, dan indeks kami disimpan dalam database.  Mengapa ditambah?  Seperti yang saya katakan, indeks adalah hal yang dipahami semua orang.  Setiap manajer yang baru saja datang bekerja tahu apa itu indeks.  Dia dapat menerima dari perusahaan kurir kota, entah bagaimana mengubahnya menjadi indeks dan digunakan.  Kelemahannya adalah bahwa indeks tersebut adalah pengidentifikasi Kantor Pos dari Pos Rusia.  Dan permukiman terdekat dapat berbagi indeks yang sama. </p><br><h3 id="pochemu-perestalo-hvatat-indeksov">  Mengapa indeks hilang? </h3><br><p>  Contoh sederhana: Lyubertsy.  Terdekat adalah desa Marusino.  Marusino tidak memiliki kantor pos, korespondensi mereka datang ke salah satu kantor pos Lyubertsy.  Jika kami ingin menambahkan pengiriman ke Lyubertsy, tetapi tidak mengirimkannya ke Marusino, karena mungkin tidak menguntungkan secara finansial bagi kami, kami tidak akan dapat melakukan ini hanya dengan indeks. <br><img src="https://habrastorage.org/webt/xy/5d/am/xy5damiwrmj4accagb5uckr8bma.png" alt="gambar"></p><br><p>  Contoh lain adalah ketika Lamoda memperluas dan membuka gudang transit kedua di Moskow.  Itu perlu untuk membagi Moskow menjadi bagian utara dan selatan.  Dan sudah pada saat melakukan pemesanan, pahami dari gudang transit mana pengiriman akan dilakukan.  Dalam hal ini, satu indeks per kota tidak akan cukup. </p><br><p>  Kami memutuskan untuk menggunakan koordinat geografis bersama dengan indeks.  Kami mengambil alamat klien, menjalankannya melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">geocoder Yandex</a> .  Pada output, kami mendapatkan tidak hanya indeks, tetapi juga koordinat.  Kami menggunakan indeks jika detail tidak penting.  Dan koordinat menentukan kasus-kasus ketika Anda perlu membuat pembagian wilayah yang tipis. </p><br><p>  Mereka menyediakan antarmuka dalam program pengaturan mereka untuk ahli logistik, yang memungkinkan Anda untuk menggambar poligon di atas peta.  Sederhana: intinya jatuh ke TPA - ada pengiriman, tidak jatuh - tidak. <br><img src="https://habrastorage.org/webt/_2/t3/pk/_2t3pkebkcck78k3imgkk6w8cdi.png" alt="gambar"><br>  <em>Antarmuka Pembuatan Zona Polygon</em> </p><br><p>  Bonus yang kami miliki memiliki koordinat geografis untuk setiap pesanan adalah kesempatan untuk meningkatkan antarmuka yang digunakan para ahli logistik untuk membuat rute bagi perwakilan penjualan.  Antarmuka menampilkan peta di mana pesanan pelanggan ditandai.  Logistician menggunakan alat laso, yang menggabungkan pesanan yang berdekatan menjadi satu rute.  Lebih jauh lagi, rute ini menuju ke salah satu perwakilan penjualan, yaitu, seseorang tidak perlu pergi dari satu ujung kota ke ujung lainnya pada siang hari untuk mengambil semua pesanannya - mereka semua secara geografis dekat. <br><img src="https://habrastorage.org/webt/4d/aq/ar/4daqar6z4vmutjh3mdumdwn-6ma.png" alt="gambar"><br>  <em>Antarmuka perutean</em> </p><br><p>  Alamat yang dimasukkan oleh klien dikonversi ke koordinat.  Kemungkinan kita akan mendapatkan koordinat untuk alamat yang diberikan secara langsung tergantung pada kualitas alamat yang dimasukkan oleh klien.  Karena itu, hal pertama yang kami pikirkan adalah bagaimana meningkatkan jumlah alamat yang dikenal baik.  Karena itu, Anda perlu membantu pelanggan memasukkan alamat yang benar. </p><br><p>  Faktanya adalah bahwa pelanggan sering tidak mengikuti skenario yang kami sediakan untuk mereka, jadi kami memperoleh basis data alamat untuk masing-masing dari 4 negara tempat kami mengirimkan pesanan.  Dan mereka membuat sajest tidak hanya untuk kota, tetapi juga untuk jalan, dan bahkan untuk nomor rumah.  Untuk membuat daftar rumah, kami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mem-</a> parsing data terbuka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">openstreetmap.org</a> . <br><img src="https://habrastorage.org/webt/bb/4n/bd/bb4nbdspyc75buacqdxmmi3jibk.png" alt="gambar"><br>  <em>Formulir checkout menawarkan tip untuk memformalkan data alamat</em> </p><br><h3 id="adresnaya-baza">  Alamat dasar </h3><br><p>  Untuk melakukan sujest di basis alamat, Anda harus menyimpannya di rumah.  Dari mana kami mendapatkan semua basis alamat untuk empat negara kami?  Di Rusia, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">FIAS</a> , basis alamat yang dikompilasi dan dikelola oleh layanan pajak kami.  Ini cukup lengkap, meski bukan tanpa cacat.  Mitra pengiriman kami telah membantu kami dengan negara lain. <br><img src="https://habrastorage.org/webt/tp/bi/_m/tpbi_m-s0oxwiiddhd_i5rrw-l8.png" alt="gambar"></p><br><p>  Kami juga memiliki satu set skrip PHP yang mengambil format yang menjadi basis alamat kami, dan dengan cara yang sama menambahkannya ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PostgreSQL</a> .  Kenapa dalam bentuk yang sama?  Karena salah satu tugas adalah memperbarui basis data ini secara berkala dari sumber yang sama.  Ini berarti bahwa jika kami menyediakan untuk konversi, itu harus diulang dengan setiap pembaruan. Dengan demikian, data masuk ke PostgreSQL, dan dari sana itu dikonversi dan disimpan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Apache Solr</a> ;  Solr memungkinkan Anda untuk mencari mereka dengan cepat dan melakukan sajest.  Sebuah server web PHP kecil dapat membuat permintaan di Solr, menurut hasil mereka, sebuah daftar dibuat untuk klien di situs untuk yang paling besar. </p><br><div class="spoiler">  <b class="spoiler_title">Contoh hidup</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ko/s4/cz/kos4czfszfi2egrtx2mnwxcaqwo.png" alt="gambar"></p></div></div><br><p><img src="https://habrastorage.org/webt/py/z_/pw/pyz_pw_qs26ypndty6qpowgilsi.png" alt="gambar"></p><br><p>  Kami mengunduh data dari sumber dalam bentuk yang kira-kira sama dengan saat mereka datang kepada kami.  Yaitu, dengan kumpulan bidang yang sama, dengan jenis kolom yang sama, dan seterusnya.  Tambahkan mereka apa adanya.  Kami mencoba menggunakan data dalam bentuk ini sejak awal, dan untuk mengubahnya menjadi struktur yang dapat kami gunakan, kami menulis beberapa tampilan.  Karena kita memiliki 4 negara, semua ini dikalikan dengan 4, dan itu sangat sulit dan mahal untuk didukung.  Karena itu, perlu untuk melakukan sesuatu tentang itu. </p><br><p>  Hal pertama yang kami singkirkan adalah tidak terstruktur, atau lebih tepatnya, <em>terstruktur khusus</em> , pada tahap awal.  Yaitu, segera setelah data mentah telah diunggah, dengan bantuan tampilan kami mengubahnya menjadi format yang disatukan, yang dengannya semua transformasi kami yang lain dikonfigurasi lebih lanjut.  Ini menyelamatkan kita dari perkalian dengan 4. Dan pada saat inilah kita lupa tentang struktur di mana data datang kepada kita, dan kita bekerja hanya dengan apa yang telah kita ciptakan untuk diri kita sendiri. <br><img src="https://habrastorage.org/webt/1s/zp/rn/1szprnn0rmejrvuop8uawdzwvaa.png" alt="gambar"></p><br><p>  Jika Anda memerlukan dua sumber - silakan unduh.  Yang utama adalah bahwa format output data ini setelah konversi ke tampilan adalah sama. <br><img src="https://habrastorage.org/webt/we/ru/dm/werudmivgvezc6ytbrgpmdr0ojm.png" alt="gambar"></p><br><p>  Persyaratan lain untuk basis data alamat yang dimuat adalah bahwa perlu untuk melakukan koreksi poin.  Contoh sederhana: di FIAS, Republik Chuvash disebut â€œChuvash Rep.  "Chuvashia."  Yah, kami hanya menginginkan Republik Chuvash.  Mengapa kita membutuhkan tanda hubung ini?  Dan pada saat yang sama, kami masih tidak dapat menghindari pembaruan berkala dari sumber. </p><br><p>  Berikut adalah lapisan-lapisan berikut yang kami miliki di PostgreSQL. <br><img src="https://habrastorage.org/webt/gf/is/a2/gfisa2hm2svx2gkehzy5raekpim.png" alt="gambar"></p><br><p>  Tabel di sebelah kiri adalah data mentah yang diunduh dari sumbernya. </p><br><p>  Di belakangnya terdapat tampilan yang mengubah data ke format standar. </p><br><p>  <em>Overridings lokal</em> - kami memiliki satu set tabel yang menentukan ulang beberapa atribut dari data alamat yang dimuat.  Kami telah memasukkan di sini, misalnya, bahwa catatan dengan pengidentifikasi seperti itu harus menerima alih-alih â€œrep Chuvash.  - Chuvashia â€adalah nama pilihan kami. </p><br><p> <em>Tabel pemetaan</em> adalah repositori pengidentifikasi kami, yang kami tetapkan sendiri untuk objek alamat yang kami unduh - ini memungkinkan kami untuk mengabstraksi sistem kami dari sumber, dari pengidentifikasi yang digunakan dalam sumber, dan juga untuk menyembunyikan tidak satu sumber, tetapi bahkan beberapa - di bawah satu ID Saya akan memberi tahu nanti.  Semua ini digabungkan dan diperbaiki dalam tampilan terwujud.  Jadi, kita mendapatkan hampir setara dengan tabel final, yang dapat diperbarui dengan menjalankan satu perintah SQL <code>REFRESH MATERIALIZED VIEW</code> . </p><br><p>  <em>Objek</em> alamat - basis alamat yang dibentuk dengan semua koreksi dan penambahan. </p><br><p>  Jadi, pada output kita sudah mengoreksi objek alamat, sudah dengan nama baru dan pengidentifikasi kami.  Semua ini diubah dan didenormalisasi, mudah digunakan untuk pencarian, dan ditambahkan dalam Solr. </p><br><p>  Karena sekarang kami memiliki basis data alamat, akan lebih baik untuk menggunakannya tidak hanya untuk membuat sujest untuk formulir pemesanan, tetapi juga untuk melakukan pencarian.  Di mana pencarian bisa berguna?  Ternyata banyak kemana.  Area pengiriman yang sama yang kami terima dari layanan kurir sangat sering diwakili hanya dengan daftar kota.  Dan daftar kota dipenuhi dengan masalah yang sama dengan input pengguna: kota dapat memiliki interpretasi yang berbeda, nama yang berbeda, dan banyak lagi. </p><br><p>  Saya punya slide khusus di sini, seperti kisah horor - apa yang harus kita lakukan jika kita mengambil semuanya secara manual untuk mengubahnya menjadi PHP: yaitu, Chechnya, Republik Chechen, dan untuk setiap sumber data - neraka adalah neraka. </p><br><p><img src="https://habrastorage.org/webt/7t/p4/eo/7tp4eoy0jtxnevev1-0pgdk_axi.png" alt="gambar"></p><br><blockquote>  Tambahan: Di layar - sepotong kode nyata dari layanan, yang menjadi tidak perlu hanya karena solusi yang dijelaskan. </blockquote><p>  Kami telah mengklasifikasikan masalah ini. </p><br><p>  1) Nama yang setara dari objek yang sama.  Misalnya, sinonim umum seperti Chuvashia dan Republik Chuvash. </p><br><p>  2) Berganti nama kota.  Ukraina sekarang berada dalam fase aktif untuk menyingkirkan masa lalu komunis, itulah sebabnya mereka setiap hari benar-benar melakukan perubahan nama-nama pemukiman mereka.  Untuk alasan ini, mungkin ternyata dalam satu database kami memiliki nama lama, dan yang lain - yang baru. </p><br><p>  3) Banyak kesalahan.  Sering keliru dalam status pemukiman.  Ada sebuah desa, di sini ada sebuah desa atau di sini ada sebuah desa, ada sebuah peternakan. </p><br><p>  4) Kata-kata asing yang ditransliterasikan ke dalam bahasa Rusia, seringkali nama yang sama ditransliterasikan dengan berbagai cara. </p><br><p>  5) Ada banyak kesalahan dalam hierarki: Zelenograd, berdasarkan kebiasaan, adalah milik wilayah Moskow, meskipun secara resmi juga terdaftar di Moskow sebagai FIAS.  Tulis dengan benar "Kota Moskow, Zelenograd." </p><br><p>  Bagaimana kita menemukan ini? </p><br><p>  Hal pertama yang kami lakukan adalah memisahkan semua komponen alamat yang tidak penting dari namanya.  Kami tidak membuangnya, mereka berpartisipasi dalam pencarian, tetapi terpisah dari bagian-bagian penting. <br><img src="https://habrastorage.org/webt/pj/l-/hm/pjl-hmgtn30iryqakbsqjrll6qy.png" alt="gambar"></p><br><p>  Selanjutnya, kami membuat daftar pendek sinonim dan singkatan umum yang digunakan dalam nama.  Di mana sumber diizinkan, kami memuat dan memasukkan semua nama ke Solr.  Bukan hanya yang paling relevan, tetapi juga kemungkinan sinonim dan nama historis. </p><br><p>  Untuk pencarian yang lebih baik, kami membuang semua surat yang dapat menyebabkan perbedaan.  Ini berlaku untuk bahasa Rusia dan bahasa-bahasa yang masih harus kita tangani. </p><br><p>  Kami memperbaiki kesalahan ketik dan memperbaiki tata letak. </p><br><p>  Akhirnya, kami datang dengan orang tua hantu - ini adalah orang tua yang ditugaskan untuk objek.  Mereka relevan dalam pencarian, tetapi tidak berpartisipasi dalam hasil pencarian.  Misalnya, untuk Zelenograd, kami menambahkan wilayah Moskow.  Sekarang Anda dapat mencari "Wilayah Moskow, Zelenograd" dan menemukan objek yang kami butuhkan, tetapi dalam hasil pencarian itu masih akan menjadi "Moskow, Zelenograd" yang benar. </p><br><p><img src="https://habrastorage.org/webt/rw/kh/qm/rwkhqme_rixhx9dz1du34m0hrqy.png" alt="gambar"></p><br><p>  Bergantung pada persyaratan bisnis, diperlukan gradasi akurasi pencarian yang berbeda.  Oleh karena itu, kami memiliki 4 derajat, masing-masing memberikan hasil dengan probabilitas yang lebih tinggi, tetapi dengan probabilitas yang lebih rendah itu akan persis hasil yang dicari. <br><img src="https://habrastorage.org/webt/hn/hw/lh/hnhwlh7kyr55fbn5b-eqqqlsxtc.png" alt="gambar"></p><br><p>  Dan di mana kami menemukan aplikasi pencarian seperti itu? </p><br><ul><li>  Sekali lagi, kami menjalankan alamat yang dimasukkan oleh klien melalui pencarian seperti itu.  Jika dia tidak menggunakan tips kami di halaman checkout, maka kita memiliki satu kesempatan lagi untuk mengubah garis yang dia masukkan menjadi pengidentifikasi.  Kami mendapatkan alamat yang diformalkan. </li><li>  Kami menjalankan semua pencarian yang dikirim oleh jasa kurir kami - kami mengenali kota-kota yang mereka kirimkan kepada kami.  Ini memungkinkan kami untuk meluncurkan hanya 10 buah sehari, ini relevan untuk B2B - Lamoda menyediakan pengirimannya ke perusahaan pihak ketiga, jadi ada banyak layanan kurir baru yang terhubung per unit waktu. </li><li>  Ini memungkinkan kami untuk "merangkai" berbagai informasi yang berguna ke dalam pengidentifikasi kami di basis data alamat.  Misalnya, kami mengunduh zona waktu, alamat IP, untuk mencari kota berdasarkan alamat IP klien. </li><li>  Kami sekarang memiliki kesempatan untuk menyembunyikan basis alamat yang digabungkan dari dua sumber dengan salah satu pengidentifikasi kami.  Artinya, itu memungkinkan menghindari duplikat dan mencocokkan objek alamat yang sama di kedua pangkalan. </li></ul><br><p>  Kami tidak berhenti.  Ini adalah proses yang masih bisa kita tingkatkan. </p><br><p>  Pertama, Lamoda bekerja pada indeks.  Artinya, pengidentifikasi kami adalah indeks, yang kami ketahui kekurangannya.  Hampir semua sistem kami telah beralih ke API baru, mereka beroperasi bukan dengan indeks, tetapi dengan pengidentifikasi yang kami sendiri ditugaskan untuk objek alamat kami.  Nilai tambahnya adalah memeriksa kota di wilayah itu sesederhana dengan indeks.  Namun, tidak ada minus dalam kenyataan bahwa beberapa pemukiman dapat bersembunyi di balik satu ID. </p><br><blockquote>  Tambahan: Waktu telah berlalu sejak saat pidato saya, dan sekarang saya senang untuk memperbaiki diri: indeks kami sekarang hanya tersisa dalam kasus ini, ketika kurir memberi kami wilayahnya dalam bentuk daftar mereka, misalnya, Russian Post.  Dalam kasus lain, indeks digantikan oleh pengidentifikasi alamat internal kami. </blockquote><p>  Pada slide adalah bagian dari antarmuka yang memungkinkan Anda untuk mengkonfigurasi wilayah secara manual, tetapi pada kenyataannya semuanya dikonfigurasi dari daftar objek alamat yang dimuat dalam bentuk string. <br><img src="https://habrastorage.org/webt/n9/-1/rn/n9-1rnlutwkmd8-tpnyfaxiwuxg.png" alt="gambar"></p><br><p>  Kami mengunduh koordinat geografis dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">openstreetmap.org</a> untuk rumah.  Sekarang, dalam persentase besar kasus, kita tidak perlu pergi ke layanan eksternal untuk mengetahui lokasi.  Ini mengurangi kami 10 kali perjalanan ke Yandex, yang tentu saja menghemat uang. </p><br><p>  Kami menyingkirkan PHP di rantai pencarian untuk data alamat.  Kami menulis ulang kode yang mengakses Solr pada Lua.  Digantikan nginx dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Openresty</a> , sekarang semuanya sangat cepat dan dapat menahan beban berat.  95% dari tanggapan layanan pencarian kami cocok dalam 10 milidetik, yang lebih dari cukup bagi kami. </p><br><p><img src="https://habrastorage.org/webt/6b/th/wm/6bthwmdw9aq79khamwrwrqfgbqc.png" alt="gambar"></p><br><blockquote>  Tambahan: Menggunakan Openresty dan Lua, yang menarik dengan kinerja mereka, adalah semacam eksperimen yang terbayar: layanan bekerja dengan cepat, stabil di bawah beban, dan mudah dipelihara.  Namun sejak itu, Lamoda telah mengadopsi Golang, yang memiliki kualitas yang sama, sebagai salah satu bahasa pemrograman untuk backend yang dimuat.  Jika keputusan untuk mengembangkan layanan dibuat sekarang, kami lebih suka itu. </blockquote><br><h3 id="vyvod">  Kesimpulan </h3><br><p>  Moralitas pribadi saya dari semua pekerjaan yang dilakukan adalah bahwa data alamat adalah area di mana Anda tidak dapat mengharapkan kualitas data yang ideal.  Ini tidak akan pernah terjadi.  Kami tidak akan pernah menerima data sempurna dari pelanggan atau dari sumber eksternal.  Karena itu, Anda harus memeras maksimal dari apa yang ada. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id444848/">https://habr.com/ru/post/id444848/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id444838/index.html">Pertemuan OWASP Rusia</a></li>
<li><a href="../id444840/index.html">3. Periksa Titik Memulai R80.20. Persiapan tata letak</a></li>
<li><a href="../id444842/index.html">Komputer diprogram DNA pertama</a></li>
<li><a href="../id444844/index.html">Apakah ada merek dagang untuk didaftarkan? atau Bagaimana kami terpaksa mengubah nama aplikasi</a></li>
<li><a href="../id444846/index.html">ML.NET 0,11 - Pembelajaran Mesin untuk .Net</a></li>
<li><a href="../id444850/index.html">Mekanika Kuantum: Akhir Perang Interpretasi</a></li>
<li><a href="../id444852/index.html">Smart Home - Memikirkan Kembali</a></li>
<li><a href="../id444854/index.html">Membuat Elemen Antarmuka Secara Programatis Menggunakan PureLayout (Bagian 1)</a></li>
<li><a href="../id444858/index.html">Mencari obat terbaik</a></li>
<li><a href="../id444860/index.html">OFFZONE 2.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>