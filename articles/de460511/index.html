<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôæ ‚ùé ‚èπÔ∏è PHP-FPM-Optimierung: Verwenden von pm static f√ºr maximale Leistung ‚õ™Ô∏è üà≥ üëäüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine unbearbeitete Version des Artikels wurde urspr√ºnglich auf haydenjames.io ver√∂ffentlicht und wird hier mit Genehmigung des Autors ver√∂ffentlicht ....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PHP-FPM-Optimierung: Verwenden von pm static f√ºr maximale Leistung</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/460511/"><p><img src="https://habrastorage.org/webt/-2/iz/ag/-2izagcq0hhqolvsxmnbt63lwb8.png"></p><br><p>  <em>Eine unbearbeitete Version des Artikels wurde urspr√ºnglich auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">haydenjames.io ver√∂ffentlicht</a> und wird hier mit Genehmigung des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Autors ver√∂ffentlicht</a> .</em> </p><br><p>  Kurz gesagt, ich werde dar√ºber sprechen, wie PHP-FPM am besten konfiguriert werden kann, um den Durchsatz zu erh√∂hen, die Latenz zu verringern und die Prozessorressourcen und den Arbeitsspeicher stabiler zu nutzen.  Standardm√§√üig ist die Zeichenfolge PM (Prozessmanager) in PHP-FPM <em>dynamisch</em> . Wenn Sie nicht √ºber gen√ºgend Speicher verf√ºgen, ist es besser, <em>ondemand</em> zu installieren.  Vergleichen wir zwei Steuerungsoptionen basierend auf der php.net-Dokumentation und sehen, wie sich meine bevorzugte <em>statische</em> PM f√ºr eine gro√üe Menge an Verkehr von ihnen unterscheidet: </p><br><p>  <strong>pm = dynamic</strong> - Die Anzahl der <em>untergeordneten</em> Prozesse wird basierend auf den folgenden Anweisungen dynamisch konfiguriert: <em>pm.max_children, pm.start_servers, pm.min_spare_servers, pm.max_spare_servers</em> . <br>  <strong>pm = ondemand</strong> - Prozesse werden bei Bedarf erstellt (im Gegensatz zur dynamischen Erstellung, wenn pm.start_servers beim Start des Dienstes gestartet werden). <br>  <strong>pm = static</strong> - Die Anzahl der <em>untergeordneten</em> Prozesse wird festgelegt und durch den Parameter <em>pm.max_children angegeben</em> . </p><a name="habracut"></a><br><p>  Weitere <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Informationen finden</a> Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vollst√§ndigen Liste der globalen Anweisungen php-fpm.conf</a> . </p><br><h3 id="shodstva-menedzhera-processa-php-fpm-s-regulyatorom-chastoty-processora">  Die √Ñhnlichkeiten des PHP-FPM-Prozessmanagers mit dem Prozessorfrequenzregler </h3><br><p> Es mag offtopisch erscheinen, aber ich werde dies mit dem PHP-FPM-Konfigurationsthema in Verbindung bringen.  Wer mindestens einmal den Prozessor nicht verlangsamt hat - auf einem Laptop, einer virtuellen Maschine oder einem dedizierten Server.  Erinnern Sie sich an die Skalierung der Prozessorfrequenz?  Diese f√ºr <em>nix und Windows</em> verf√ºgbaren Optionen <em>k√∂nnen die Systemleistung und Reaktionsf√§higkeit verbessern, indem die Einstellung des Prozessorcontrollers von</em> On-Demand <em>auf</em> Leistung * ge√§ndert wird.  Vergleichen wir diesmal die Beschreibungen und sehen uns die √Ñhnlichkeiten an: </p><br><p>  <strong>Governor = ondemand</strong> - dynamische Skalierung der Prozessorfrequenz in Abh√§ngigkeit von der aktuellen Last.  Schaltet scharf auf die maximale Frequenz um und reduziert sie dann, wenn die Leerlaufzeiten zunehmen. <br>  <strong>Regler = konservativ =</strong> dynamische Frequenzskalierung in Abh√§ngigkeit von der aktuellen Last.  Erh√∂ht und verringert die Frequenz gleichm√§√üiger als bei Bedarf. <br>  <strong>Regler = Leistung</strong> - die Frequenz ist immer maximal. </p><br><p>  Weitere Informationen finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vollst√§ndigen Liste der Parameter des Prozessorfrequenzreglers</a> . </p><br><p>  Sehen Sie die √Ñhnlichkeit?  Ich wollte diesen Vergleich zeigen, um Sie davon zu √ºberzeugen, dass es am besten ist, <em>pm static</em> f√ºr PHP-FPM zu verwenden. </p><br><p>  Bei einem Prozessor-Controller hilft der <em>Leistungsparameter dabei</em> , die <em>Leistung</em> sicher zu steigern, da er fast ausschlie√ülich vom Server-Prozessor-Limit abh√§ngt.  Dar√ºber hinaus gibt es nat√ºrlich auch Faktoren wie Temperatur, Akkuladung (in einem Laptop) und andere Nebenwirkungen eines konstanten Prozessorbetriebs bei 100%.  Die Leistungsoptimierung bietet die schnellste Prozessorleistung.  Lesen Sie zum Beispiel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Parameter force_turbo im Raspberry Pi</a> , mit dem das RPi-Panel die <em>Leistungssteuerung</em> verwendet, wobei die <em>Leistungsverbesserung</em> aufgrund der niedrigen Taktrate der CPU deutlicher wird. </p><br><h3 id="ispolzovanie-pm-static-dlya-dostizheniya-maksimalnoy-proizvoditelnosti-servera">  Verwenden von pm static zur Maximierung der Serverleistung </h3><br><p>  Der <em>statische</em> Parameter PHP-FPM <em>pm</em> h√§ngt weitgehend vom freien Speicher auf dem Server ab.  Wenn der Arbeitsspeicher niedrig ist, ist es besser, <em>On-Demand</em> oder <em>Dynamic</em> zu w√§hlen.  Wenn Sie jedoch √ºber Speicher verf√ºgen, k√∂nnen Sie den Overhead des PHP-Prozessmanagers vermeiden, indem Sie pm <em>static</em> auf die maximale Serverkapazit√§t einstellen.  Mit anderen Worten, wenn alles gut berechnet ist, m√ºssen Sie <em>pm.static</em> auf die maximale Anzahl von PHP-FPM-Prozessen <em>einstellen</em> , die ausgef√ºhrt <em>werden</em> k√∂nnen, <em>ohne Probleme mit unzureichendem Speicher oder Cache zu verursachen.</em>  <em>Aber nicht so hoch, dass die Prozessoren √ºberlastet werden und eine Reihe von PHP-FPM-Operationen angesammelt werden, die auf ihre Ausf√ºhrung warten</em> . </p><br><p> <a href=""><img src="https://habrastorage.org/webt/ku/aw/nx/kuawnxjy5mun0bzouv2kh-virsu.png"></a> </p><br><p>  Im obigen Screenshot sind auf dem Server <em>pm = static und pm.max_children = 100</em> installiert. Dies <em>erfordert</em> etwa 10 GB der 32 verf√ºgbaren. <em>Beachten Sie</em> die hervorgehobenen Spalten. Hier ist alles klar.  In diesem Screenshot waren ungef√§hr 200 aktive Nutzer (√ºber 60 Sekunden) in Google Analytics.  Auf dieser Ebene sind ungef√§hr 70% der untergeordneten PHP-FPM-Prozesse noch inaktiv.  Dies bedeutet, dass PHP-FPM unabh√§ngig vom aktuellen Datenverkehr immer auf die maximale Menge an Serverressourcen eingestellt ist.  Ein Leerlaufprozess wartet auf Verkehrsspitzen und reagiert sofort.  Sie m√ºssen nicht auf <em>pm</em> warten <em>,</em> um <em>untergeordnete</em> Prozesse <em>zu</em> erstellen, und diese dann beenden, wenn der Zeitraum <em>pm.process_idle_timeout abl√§uft</em> .  Ich habe einen sehr hohen Wert f√ºr <em>pm.max_requests festgelegt</em> , da es sich um einen funktionierenden Server ohne Speicherlecks in PHP handelt.  Sie k√∂nnen <em>pm.max_requests = 0</em> mit static <em>festlegen,</em> wenn Sie mit vorhandenen und zuk√ºnftigen PHP-Skripten vertraut sind.  Es ist jedoch besser, die Skripte im Laufe der Zeit neu zu starten.  Installieren Sie eine gro√üe Anzahl von Abfragen, da wir den unn√∂tigen Overhead von pm vermeiden m√∂chten.  Zum Beispiel mindestens <em>pm.max_requests = 1000</em> - abh√§ngig von der Anzahl der <em>pm.max_children</em> und der Anzahl der Anforderungen pro Sekunde. </p><br><p>  Der Screenshot zeigt den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Linux-</a> Befehl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">top</a> , gefiltert nach u (Benutzer) und PHP-FPM-Benutzername.  Es werden nur die ersten 50 Prozesse angezeigt (ich habe nicht genau gez√§hlt), aber oben werden die Top-Statistiken angezeigt, die im Terminalfenster platziert sind.  In diesem Fall sortiert nach% CPU (% CPU).  F√ºhren Sie den folgenden Befehl aus, um alle 100 PHP-FPM-Prozesse anzuzeigen: </p><br><pre><code class="plaintext hljs">top -bn1 | grep php-fpm</code> </pre> <br><h3 id="kogda-ispolzovat-pm-ondemand-i-dynamic">  Wann ist pm ondemand und dynamisch zu verwenden? </h3><br><p>  Wenn Sie pm <em>dynamic verwenden</em> , werden √§hnliche Fehler angezeigt: </p><br><pre> <code class="plaintext hljs">WARNING: [pool xxxx] seems busy (you may need to increase pm.start_servers, or pm.min/max_spare_servers), spawning 32 children, there are 4 idle, and 59 total children</code> </pre> <br><p>  Versuchen Sie, den Parameter zu √§ndern. Der Fehler tritt nirgendwo auf, wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in diesem Beitrag zu Serverfault beschrieben</a> .  In diesem Fall war der Wert von pm.min zu klein, und da sich der Webverkehr stark √§ndert und hohe Spitzen und tiefe Abf√§lle aufweist, ist es schwierig, die pm- <em>Dynamik</em> angemessen zu konfigurieren.  Dies verwendet normalerweise pm <em>ondemand</em> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wie im selben Beitrag empfohlen</a> .  Dies ist jedoch noch schlimmer, da bei <em>Bedarf</em> Leerlaufprozesse auf Null beendet werden, wenn wenig oder gar kein Datenverkehr vorhanden ist. Infolgedessen leiden Sie immer noch unter Kosten, wenn sich der Datenverkehr √§ndert.  Es sei denn, Sie haben eine gro√üe Wartezeit festgelegt.  Und dann ist es besser, <em>pm.static</em> + eine hohe Anzahl von <em>pm.max_requests zu verwenden</em> . </p><br><p>  PM- <em>Dynamik</em> und insbesondere <em>On-Demand</em> k√∂nnen n√ºtzlich sein, wenn Sie √ºber mehrere PHP-FPM-Pools verf√ºgen.  Sie hosten beispielsweise mehrere cPanel-Konten oder mehrere Websites in verschiedenen Pools.  Ich habe einen Server, auf dem zum Beispiel mehr als 100 Cpanel-Konten und etwa 200 Domains und pm.static oder sogar Dynamic mich nicht retten w√ºrden.  <em>Hier wird</em> nur <em>On-Demand</em> ben√∂tigt, da mehr als zwei Drittel der Websites nur wenig oder gar keinen Datenverkehr erhalten und bei <em>On-Demand</em> alle <em>untergeordneten</em> Prozesse abfallen, was uns viel Speicherplatz spart!  Gl√ºcklicherweise haben cPanel-Entwickler dies bemerkt und den Standardwert auf <em>ondemand gesetzt</em> .  Bisher war PHP-FPM, wenn der Standardwert <em>dynamisch</em> war, √ºberhaupt nicht f√ºr ausgelastete gemeinsam genutzte Server geeignet.  Viele verwendeten <em>suPHP,</em> weil pm <em>dynamic</em> selbst bei <em>inaktiven</em> Pools und cPanel PHP-FPM-Konten Speicher verbrauchte.  Bei gutem Datenverkehr werden Sie h√∂chstwahrscheinlich nicht auf einem Server mit einer gro√üen Anzahl von PHP-FPM-Pools (Shared Hosting) gehostet. </p><br><h3 id="zaklyuchenie">  Fazit </h3><br><p>  Wenn Sie PHP-FPM verwenden und <em>viel</em> Verkehr haben, <em>begrenzen</em> die <em>On-Demand-</em> und <em>dynamischen</em> Prozessmanager f√ºr PHP-FPM die Bandbreite aufgrund ihrer inh√§renten Kosten.  Untersuchen Sie Ihr System und konfigurieren Sie Ihre PHP-FPM-Prozesse so, dass sie Ihrer maximalen Serverkapazit√§t entsprechen.  <em>Stellen Sie</em> zuerst <em>pm.max_children ein,</em> abh√§ngig von der maximalen Verwendung von pm <em>dynamic</em> oder <em>ondemand</em> , und erh√∂hen Sie diesen Wert dann auf das Niveau, auf dem Speicher und Prozessor ohne √ºberm√§√üige √úberlastung arbeiten.  Sie werden feststellen, dass bei <em>pm static</em> , da alles im Speicher gespeichert ist, Verkehrsspitzen im Laufe der Zeit weniger Spitzen f√ºr den Prozessor verursachen und die durchschnittlichen Server- und Prozessorlastwerte ausgeglichen werden.  Die durchschnittliche PHP-FPM-Prozessgr√∂√üe h√§ngt vom Webserver ab und erfordert eine manuelle Konfiguration. <em>Daher</em> sind die st√§rker automatisierten Prozessmanager - <em>dynamisch</em> und <em>bedarfsgesteuert</em> - beliebter.  Hoffe der Artikel war hilfreich. </p><br><p>  <strong>UPD</strong> Benchmark-Diagramm hinzugef√ºgt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://">ab</a> .  Wenn sich die PHP-FPM-Prozesse im Speicher befinden, wird die Leistung verbessert, indem der Speicher dort belegt wird, wo sie sitzen und warten.  Finden Sie die beste Option f√ºr sich. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/uw/6w/h4/uw6wh4vkhvsokb13szxoonv98jw.png"></a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de460511/">https://habr.com/ru/post/de460511/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de460501/index.html">Beispiel f√ºr die Implementierung einer kontinuierlichen Integration mit BuildBot</a></li>
<li><a href="../de460503/index.html">Drahtlose Konfiguration des Raspberry PI 3 B +</a></li>
<li><a href="../de460505/index.html">Verf√ºhren Sie drei Kreuze oder warum Projekte so schwer p√ºnktlich zu beenden sind</a></li>
<li><a href="../de460507/index.html">XEN und die Zukunft der Automobilindustrie: Wie ein Open-Source-Hypervisor zu einem Konkurrenten f√ºr kommerzielle Automobill√∂sungen wird</a></li>
<li><a href="../de460509/index.html">Wie gebietsans√§ssige Proxys im Gesch√§ftsleben helfen: Ein realer Fall der Verwendung von Infatica in Data Mining</a></li>
<li><a href="../de460513/index.html">Flutter 1.7 - Was ist neu in der Version vom 10. Juli 2019?</a></li>
<li><a href="../de460515/index.html">Wie nah sind wir wirklich am Aufkommen von Robomobilen?</a></li>
<li><a href="../de460517/index.html">So erkennen Sie Angriffe auf die Windows-Infrastruktur: Erkunden von Hacker-Tools</a></li>
<li><a href="../de460521/index.html">Die Abenteuer der schwer fassbaren Malvari, Teil IV: DDE- und Word-Dokumentfelder</a></li>
<li><a href="../de460523/index.html">Ank√ºndigung eines Mitaps, der sich nahtlos in eine BeerPHP-Getr√§nkekappe verwandelt (in Moskau und online)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>