<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游녽游 游 游븸游낖 An치lisis de flujo: inicio r치pido con SAS ESP 鮫멆잺 久뾆잺 游똁游낖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El uso de algoritmos anal칤ticos en el flujo de datos es ahora una de las tareas m치s urgentes en el campo de la construcci칩n de sistemas anal칤ticos. Mu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>An치lisis de flujo: inicio r치pido con SAS ESP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sas/blog/429176/">  El uso de algoritmos anal칤ticos en el flujo de datos es ahora una de las tareas m치s urgentes en el campo de la construcci칩n de sistemas anal칤ticos.  Muchos modelos predictivos de alta precisi칩n, por ejemplo, desarrollados en base a lecturas de sensores de plantas industriales, est치n listos para prevenir accidentes industriales graves, pero para esto deben realizarse en dispositivos finales ("dispositivos de borde"), donde las lecturas de los sensores vienen en tiempo real.  Se llama al producto SAS Event Stream Processing para resolver este problema y transferir los an치lisis a "en l칤nea".  En esta publicaci칩n, me gustar칤a compartir la experiencia de su configuraci칩n utilizando un ejemplo de un problema aplicado: el an치lisis de im치genes de c치maras de video. <br><br><img src="https://habrastorage.org/webt/q3/v9/2k/q3v92kdx036qyngrxp-ndx7w7km.png"><br><a name="habracut"></a><br><h3>  Tecnolog칤a </h3><br>  SAS ha estado presente en la l칤nea de productos SAS durante muchos a침os y est치 desarrollando su propia soluci칩n de procesamiento de flujo, SAS Event Stream Processing (en adelante ESP).  La tarea principal para los desarrolladores era lograr un alto rendimiento, 칩rdenes de magnitud superiores a las soluciones existentes en el mercado.  Para hacer esto, durante el desarrollo de ESP, abandonaron por completo el almacenamiento de c치lculos e 칤ndices intermedios en el disco.  Todas las conversiones de flujo se realizan en RAM y se conserva el recuento espec칤fico de eventos. <br><br><img src="https://habrastorage.org/webt/_f/ry/6r/_fry6rq07g-c2mwytu_n0thqpp0.png"><br>  <i>Trabajar con memoria en SAS ESP.</i>  <i>El repositorio de eventos en RAM almacena resultados intermedios y no est치 bloqueado en caso de accesos paralelos de procesos internos o externos debido a 칤ndices adicionales.</i> <br><br>  El motor puede manejar grandes flujos de datos, a varios millones de eventos por segundo.  Al mismo tiempo, manteniendo una baja latencia, por lo que r치pidamente ocup칩 su lugar en soluciones para el marketing en l칤nea y la lucha contra el fraude bancario.  All칤, es un filtro inteligente de las operaciones del cliente y detecta instant치neamente la actividad no est치ndar en las cuentas, aislando las operaciones fraudulentas del flujo de datos. <br><br>  Pero a칰n as칤 esta es una caracter칤stica secundaria de ESP.  El motor est치 dise침ado como un mecanismo para el uso continuo de modelos anal칤ticos (SAS, C, Python y otros) en el flujo de datos. <br><br><img src="https://habrastorage.org/webt/2m/qg/st/2mqgstvtjf69ku-dd-9elmuooii.png"><br>  <i>El principio del procesamiento de eventos de transmisi칩n.</i> <br><br>  Como ejemplo ilustrativo, para el foro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SAS Viya Business Breakfast</a> , en SAS decidimos establecer un stand de demostraci칩n, tomando como base la tarea del an치lisis de im치genes.  Y as칤 es como lo configuramos y lo que encontramos en el proceso. <br><br><h3>  An치lisis de video en streaming </h3><br>  Ten칤amos a nuestra disposici칩n un modelo anal칤tico construido por colegas del departamento de an치lisis en profundidad en la plataforma SAS Viya.  Su esencia era que, al recibir una imagen de entrada de un conductor en el interior del autom칩vil, un algoritmo (en este caso, una red neuronal convolucional entrenada) clasific칩 el comportamiento del conductor seg칰n las clases: "conducci칩n normal", "distra칤do por una conversaci칩n con un pasajero", "hablando por tel칠fono "," escribe SMS ", etc. <br><img src="https://habrastorage.org/webt/q3/v9/2k/q3v92kdx036qyngrxp-ndx7w7km.png" align="left">  <i>Un ejemplo del modelo: la imagen de entrada se clasifica como "escribe SMS", seg칰n la parte de la imagen donde golpe칩 la mano con el tel칠fono.</i> <br><br>  Surgi칩 la pregunta de c칩mo ejecutar este algoritmo en tiempo real para poder responder a un comportamiento no deseado.  Seg칰n el escenario, las im치genes de la c치mara en modo en l칤nea ya cayeron en forma de archivos en el directorio de red en el disco. <br><br>  Todo lo que quedaba era conectarse a los datos, convertir las im치genes al formato deseado, aplicar el modelo y, con toda probabilidad de pertenecer a una clase de comportamiento, mostrar advertencias en tiempo real en paneles en l칤nea.  Y result칩 que todo esto se puede configurar en la GUI SAS ESP, sin una sola l칤nea de c칩digo de programa (!). <br><br><h3>  Procesamiento de flujo de eventos SAS </h3><br><img src="https://habrastorage.org/webt/t4/3w/ca/t43wcat2jtk84v43qaztpzw6yfg.png" width="300" align="left">  <i>Proyecto de detecci칩n de riesgos en la interfaz gr치fica de SAS ESP Studio.</i> <br clear="left">  En el editor gr치fico ESP, hemos agregado las siguientes transformaciones de flujo de datos: <br><br><ol><li> Como entrada, tenemos dos nodos de tipo fuente: model_source y input_image.  En model_source publicamos nuestro modelo de clasificaci칩n.  Para hacer esto, configure el conector de archivo, que lee un comando de un archivo de texto que contiene tres par치metros: el nombre de la operaci칩n, el tipo de formato del modelo y la ruta f칤sica al archivo binario.  ESP no permite que cada fuente de datos sea tanto est치tica como de transmisi칩n, por lo tanto, en cualquier momento, podemos publicar nuevos comandos para descargar modelos a este nodo, lo cual es conveniente en la operaci칩n industrial; no es necesario detener el proyecto para actualizar la versi칩n de los algoritmos. <br><br><img src="https://habrastorage.org/webt/hk/lj/ys/hkljystucnei9_ctlsegjhp9o5o.png"><br>  <i>Configurar comandos de publicaci칩n para model_source</i> <br><br>  El contenido del archivo de modelo de entrada: <br><br> <code>I,N,1,action,load <br> I,N,2,type,astore <br> I,N,3,reference,/opt/sas/demo/image_processing/d.astore</code> </li> <li>  La segunda fuente, input_image, son im치genes de la c치mara.  Para publicar datos, utilizamos un adaptador est치ndar, un programa que publica datos de una fuente en ESP.  En este caso, utilizamos un adaptador de archivo, pero tambi칠n puede conectarse a la c치mara directamente, por ejemplo, a trav칠s del adaptador UVC que viene con la soluci칩n. <br><br><img src="https://habrastorage.org/webt/ay/ql/hp/ayqlhpbfglnxdttpuv1ckoqdo9k.png"><br>  <i>Configuraci칩n de un conector UVC para tipos comunes de videoc치maras.</i> </li><li>  Las im치genes pueden venir en un formato diferente al que se entren칩 el modelo, y esto puede afectar la calidad de la clasificaci칩n.  Por lo tanto, despu칠s de input_image, agregamos inmediatamente el nodo resize_image y prescribimos el formato deseado en su configuraci칩n.  En este caso, apriete a un cuadrado de 100/100 p칤xeles. <br><br><img src="https://habrastorage.org/webt/jl/bp/th/jlbpthn46z31lehm1ulcb5oe6fy.png" align="left" width="250">  <i>Configuraci칩n de procesamiento de imagen</i> <br clear="left"></li><li>  La ejecuci칩n del modelo se configura en CNN_score_code.  La interfaz extraer치 autom치ticamente los atributos de salida de la metadescripci칩n del modelo: P__label_c0, P__label_c1, P__label_c2 y P__label_c9, las probabilidades de cada clase de comportamiento.  A continuaci칩n, en el nodo max_class, definiremos un nuevo campo calculado que seleccionar치 la clase con la m치xima probabilidad. </li><li>  Ahora, al lanzar el proyecto, podremos obtener una clasificaci칩n en tiempo real para cada imagen de entrada.  En nuestra historia, un conductor sin escr칰pulos se distrae peri칩dicamente de la carretera.  Pero es importante separar esos casos cuando estuvo distra칤do por un segundo de los casos de conducci칩n peligrosa prolongada.  Para hacer esto, agregue 3 nodos: almacenamiento de eventos en el 칰ltimo minuto (copy_1_min), agregaci칩n por clases de comportamiento (aggr_for_alert) y el filtro de hechos de "conducci칩n peligrosa" (filter_alert). <br><br><img src="https://habrastorage.org/webt/zi/kk/tn/zikktnzlze0q_w1zvir7awy5gum.png" width="300" align="left">  <i>Configuraci칩n de ajustes de almacenamiento de eventos: en 1 칰ltimo minuto.</i> <br clear="left"><img src="https://habrastorage.org/webt/65/bx/n7/65bxn7cssoq6r2g8tmv20uu-wbs.png" width="300" align="left"><br>  <i>Configurar el conteo de eventos para cada clase de comportamiento.</i> <br clear="left"><img src="https://habrastorage.org/webt/8t/bt/sc/8tbtscxuouv-v3ab5xpykssttvk.png"><br>  <i>Establecer reglas de filtrado.</i> <br></li></ol><br><h3>  칈ndices </h3><br>  Es importante tener en cuenta que cada transformaci칩n en el ESP tiene una configuraci칩n: "Estado".  Caracteriza si la transformaci칩n de datos se est치 transmitiendo, es decir  Cuando se procesa un evento de entrada, el resultado se transmite de inmediato a lo largo del diagrama y se elimina de la memoria de este nodo.  O podemos almacenar el resultado del procesamiento de cada evento y crear un 칤ndice para permitir el acceso a 칠l en cualquier momento.  Por ejemplo, la ventana de agregaci칩n siempre almacena el estado y se recalcula de manera continua en funci칩n de la secuencia de entrada. <br><br><h3>  Lanzamiento </h3><br>  De vuelta al proyecto.  Solo tenemos que ejecutarlo <img src="https://habrastorage.org/webt/uv/dy/le/uvdyleayvtubt4nmqhcd2jlcqjo.png" width="50">  . <br>  Para facilitar la visualizaci칩n de los flujos de datos, se suministra un ESP en l칤nea, un dise침ador de informes, SAS ESP Stream Viewer.  En el modo de configuraci칩n, vemos todos los proyectos en ejecuci칩n en los servidores, y podemos conectarnos a ellos y elegir una visualizaci칩n conveniente. <br><br><img src="https://habrastorage.org/webt/hc/jm/7f/hcjm7fhuisbkt_unw2m3poekrhc.gif"><br>  <i>Paneles en l칤nea en SAS ESP Stream Viewer</i> <br><br>  Eso es todo  Tuvimos la oportunidad de automatizar la reacci칩n en tiempo real a una se침al de video.  En este caso, configuramos el monitoreo en l칤nea, pero usando los mismos adaptadores / conectores, podemos enviar un mensaje para cada caso de violaciones detectadas, o formar una acci칩n de control a un sistema externo. <br><br><h3>  O Python? </h3><br>  T칠cnicamente, el caso se complet칩, pero con el prop칩sito de demostrar en el foro, no parec칤a lo suficientemente interactivo.  Fue inconveniente y bastante inseguro (!) Mostrar en tiempo real, por lo que las fotos se tomaron con anticipaci칩n y el autom칩vil estaba en el estacionamiento. <br><br>  SAS ESP admite la ejecuci칩n de transmisi칩n de modelos realizados en Python.  Para confirmaci칩n, configuramos el an치lisis de im치genes, es decir, la b칰squeda de objetos en la imagen, utilizando las bibliotecas OpenCV. <br><br><img src="https://habrastorage.org/webt/62/nr/gh/62nrghkxa8unlmf2m3fjy82knz0.png" width="300" align="left">  <i>Modelo ESP para encontrar un casco en una secuencia de entrada de imagen</i> <br clear="left">  En el diagrama ESP, tenemos 2 fuentes de datos: fotogramas de la c치mara en l칤nea de la computadora port치til y una fotograf칤a del objeto que estamos buscando.  En este caso, determinamos si el trabajador potencial en el sitio de construcci칩n se ha olvidado de las reglas de seguridad: 쯦iene un casco?  En el nodo proc_detection, ejecutamos el siguiente c칩digo de Python: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compute_total</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Image,image_template)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"Output: score_point"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> base64 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> imageio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> imread MIN_MATCH_COUNT = <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-comment"><span class="hljs-comment">#       DIST_COEFF = 0.55 img_big = imread(io.BytesIO(base64.b64decode(image_template))) sift = cv2.xfeatures2d.SIFT_create() # Initiate SIFT detector matcher = cv2.BFMatcher() # BFMatcher with default params kp_big, des_big = sift.detectAndCompute(img_big,None) img_tpl = imread(io.BytesIO(base64.b64decode(Image))) kp_tpl, des_tpl = sift.detectAndCompute(img_tpl,None) matches = matcher.knnMatch(des_tpl,des_big,k=2) good = [] for m,n in matches: if m.distance &lt; n.distance * DIST_COEFF: good.append(m) score_point = len(good) return score_point</span></span></code> </pre><br><img src="https://habrastorage.org/webt/xb/ql/56/xbql56g_rpt7jzmxp6bdzjwab-a.gif" width="500"><br>  <i>Identificaci칩n de la presencia de un casco en la imagen de la c치mara web en el foro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SAS Viya Business Breakfast</a> (colega, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">maxxts est치</a> probando el stand)</i> <br><br><h3>  Aprendizaje autom치tico </h3><br>  Si hablamos sobre el desarrollo posterior del procesamiento de flujo, entonces el 칠nfasis probablemente se trasladar치 a la capacitaci칩n de modelos anal칤ticos en el flujo.  Es decir  A diferencia de los ejemplos anteriores, los modelos no solo se ejecutar치n, sino que tambi칠n se entrenar치n dentro de SAS ESP.  Esto requerir치 un flujo de datos adicional en el que realizar la operaci칩n del tren del algoritmo seleccionado por el evento (por ejemplo, para empezar, agrupaci칩n simple de k-medias).  Luego, el autom칩vil con el ESP a bordo tendr치 la oportunidad de analizar la situaci칩n utilizando nuevos sensores que se acaban de conectar.  Esto permitir치 encender y automatizar r치pidamente nuevos dispositivos en el concepto de Industria 4.0. <br><br>  Escriba en los comentarios qu칠 tareas enfrenta en el an치lisis de transmisi칩n y, por supuesto, me complacer치 responder preguntas sobre el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">procesamiento de flujo de eventos SAS</a> . <br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es429176/">https://habr.com/ru/post/es429176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es429162/index.html">"Para hacer cambios, comprender por qu칠 la gente se resiste": Jim Holmes sobre Testing Culture</a></li>
<li><a href="../es429166/index.html">Multicristal: de la historia a la especulaci칩n sobre el futuro</a></li>
<li><a href="../es429168/index.html">A trav칠s del fuego y el agua: la historia de la literatura de ciencia popular rusa</a></li>
<li><a href="../es429172/index.html">1C en Proxmox. Notas generales</a></li>
<li><a href="../es429174/index.html">BlueStacks 4: pruebas en hardware d칠bil + comentarios del desarrollador</a></li>
<li><a href="../es429178/index.html">Microsoft orden칩 un modelo de un nuevo campus en Minecraft</a></li>
<li><a href="../es429180/index.html">Ir a goto</a></li>
<li><a href="../es429182/index.html">La inteligencia artificial se top칩 con una barrera de comprensi칩n.</a></li>
<li><a href="../es429184/index.html">Los medios en l칤nea previsiblemente rompen la cadena sobre los estudiosos de Oumuamua y Harvard</a></li>
<li><a href="../es429186/index.html">@Pythonetc Octubre 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>