<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåΩ üìâ üòé Comment faire parler Omega 2 ou la l√©gende d'I2S üëµüèø üë®‚Äçüë©‚Äçüëß üë∂üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quel est le gros probl√®me avec I2S, dites-vous? Connectez le c√¢blage aux broches souhait√©es et tout fonctionne. 

 Je le pensais aussi, mais avec le m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment faire parler Omega 2 ou la l√©gende d'I2S</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413623/"> Quel est le gros probl√®me avec I2S, dites-vous?  Connectez le c√¢blage aux broches souhait√©es et tout fonctionne. <br><br><img align="left" width="250" src="https://habrastorage.org/webt/io/ka/bd/iokabddcyoi7quzs2gfgy8imhgi.png" alt="Mini-ordinateur Omega2">  Je le pensais aussi, mais avec le mini-ordinateur Omega2, il s'est av√©r√© que ce n'√©tait pas si simple.  J'ai donc d√©cid√© d'√©crire cet article. <br><br>  Commen√ßons par ce que j'ai r√©alis√© √† la fin.  J'ai connect√© la puce TDA1543 (DAC st√©r√©o I2S avec une r√©solution de 16 bits en amplitude) au micro-ordinateur Omega 2. Le son est bon, j'aime √©couter les stations de radio Internet (il devrait y avoir une blague sur l'audiophile et le son des tubes chauds).  Cependant, je ne comprenais toujours pas la raison de la surcharge audio, mais j'ai seulement appris √† la contourner avec la m√©thode de b√©quille.  Et j'aimerais beaucoup entendre vos id√©es sur cette question. <br><a name="habracut"></a><br>  Peut-√™tre que quelqu'un ne sait pas ce qu'est l'Omega2.  Il s'agit du mini-ordinateur sur lequel Linux est bas√© sur LEDE, qui est essentiellement une branche d'OpenWRT.  Processeur MT7688, 64 Mo de RAM et 16 Mo de m√©moire Flash.  En g√©n√©ral, vous pouvez en savoir plus sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wikipedia</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  <b>Il est √©galement important de noter que toutes les actions sont effectu√©es sur la version d'origine du firmware 0.2.0</b> <br><br>  Et maintenant, parlons un peu de la <s>douleur</s> quand j'y suis arriv√©e. <br>  Pour commencer, tout est transparent, nous connectons toutes les lignes de I2S TDA'shki et Omega.  Il s'agit respectivement de la ligne d'horloge CLK, de la ligne de synchronisation de canal WS, de la ligne de donn√©es DATA et de la masse GND.  De plus, nous ajoutons quelques r√©sistances et condensateurs, mais l'essentiel est la r√©sistance de r√©glage sur la 7e √©tape du TDA1543.  Un d√©calage nul doit √™tre appliqu√© √† cette jambe, sur ce je me suis d'abord endormi.  Le fait est que la puce TDA1543, unique en son temps, fonctionne sur unipolaire.  Eh bien, le signal sonore est des oscillations par rapport √† 0 de haut en bas, vous devez donc d√©placer ce z√©ro au milieu de la plage de tension d'alimentation et obtenir les oscillations par rapport √† ce point.  Tout est √©crit dans la fiche technique, mais au d√©part j'ai assembl√© un circuit avec une r√©sistance conventionnelle (de celles de votre Internet) et re√ßu des distorsions que je ne comprenais pas depuis longtemps.  Mettez une r√©sistance variable et obtenez une polarisation nulle en l'absence de signal √† l'entr√©e (mode veille) 1,3-1,5 V (avec alimentation 3,3 V).  Il s'av√®re que le sch√©ma suivant. <br><br><img src="https://habrastorage.org/webt/nv/wr/wd/nvwrwdpyw7fjsnbhslbvqw7nq5i.png" alt="Sch√©ma de connexion TDA1543 √† Omega2"><br><br>  De plus, en suivant les √©tapes du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'oignon, nous sommes</a> mis √† jour pour d√©velopper la version du firmware, qui a ajout√© le support pour I2S (je voulais √©crire moins d'un an, mais non ... pass√©).  Nous mettons √† jour et installons les packages n√©cessaires pour le son: <br><br><pre><code class="hljs sql">opkg <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> opkg <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> alsa-utils mpg123</code> </pre> <br>  Basculez GPIO en mode I2S avec la commande: <br><br><pre> <code class="hljs swift">omega2-ctrl gpiomux <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> i2s i2s</code> </pre> <br>  Nous copions le fichier wav de test, j'ai utilis√© le classique Suzanne Vega - Tom's Diner.  Et essayez de jouer en utilisant aplay: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">aplay</span></span> za_sebya_i_za_sashky.wav</code> </pre> <br>  Et nous entendons de la distorsion.  Juste beaucoup de surcharge.  Tellement que cela pourrait vous sembler √™tre de retour en 2007. Mais le motif de choc de la chanson peut √™tre retrac√©, donc quelque chose fonctionne l√†-bas, non? <br><br>  J'ai essay√© de baisser le volume dans le m√©langeur alsa - en vain, car le pilote est affin√© par la puce MAX98090, qui est contr√¥l√©e par I2C et, par cons√©quent, tous les param√®tres sont simplement envoy√©s √† I2C, et les donn√©es I2S elles-m√™mes ne changent pas. <br><br>  Ok, ouvrez la fiche technique du MAX98090.  Et nous commen√ßons √† nous allumer.  Le microcircuit prend en charge de nombreux formats de donn√©es d'entr√©e: I2S / LJ / RJ / TDM et il peut dig√©rer un peu.  Et le processeur MT7688 lui-m√™me peut √©galement √™tre plus grand et plus rapide que le TDDA.  Peut-√™tre des probl√®mes de donn√©es dans I2S? <br><br>  Je suis progressivement all√© bricoler l'oscilloscope. <br><br>  <i>Bit 16 bits?</i>  Oui  J'ai accroch√© la ligne WS sur un canal de l'autre canal, la ligne CLK.  Et j'√©tais convaincu de la longueur d'impulsion WS-16 mesures. <br><br>  <i>Mauvaises fr√©quences de fonctionnement?</i>  Non.  Les fr√©quences correspondent toutes aux travailleurs.  WS - 44100 Hz, CLK - 1411200 Hz. <br><br>  <i>Formater les num√©ros de type dans les donn√©es?</i>  Le format de caract√®re correct est utilis√© (oui, je pensais que non sign√© √©tait n√©cessaire).  Il a v√©rifi√© en cr√©ant des sinus artificiels et en les d√©pla√ßant de haut en bas par rapport √† 0 en audace et a chang√© l'amplitude.  Il n'y a aucun changement qualitatif. <br>  <i>Y a-t-il quand m√™me I2S?</i>  tr√®s probablement oui.  Premi√®rement, parce que tout a fonctionn√© pour moi (enfin, ou il me semble comme √ßa), et deuxi√®mement, j'ai essay√© de v√©rifier avec un oscilloscope, bien que sans analyseur logique, cela soit bien s√ªr difficile.  Il peut √™tre utile d'effectuer un test plus pr√©cis et d'apporter votre Beaglebone ici. <br><br>  Il semble que tout soit vrai, et pour les gars du forum oignon tout fonctionne, mais la v√©rit√© est sur d'autres puces: MAX98357A et PCM5102.  En g√©n√©ral, j'abandonne l'id√©e de jouer √† wav'ki et de faire en sorte que mpg123 joue des mp3.  Je le coupe avec le drapeau -C et commence √† baisser le volume.  Et ici je me suis assis.  Lorsque je r√®gle le volume dans le programme mpg123 √† environ 1%, j'obtiens un son exceptionnel.  La puce oscille √† pleine amplitude.  Je d√©marre la radio avec le drapeau -f 128: <br><br><pre> <code class="hljs powershell">mpg123 <span class="hljs-operator"><span class="hljs-operator">-f</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span> http://us2.internet<span class="hljs-literal"><span class="hljs-literal">-radio</span></span>.com:<span class="hljs-number"><span class="hljs-number">8443</span></span>/</code> </pre> <br>  Et les sons d'un blues am√©ricain relaxant me rencontrent.  Par ailleurs, le lien vers la radio peut ne pas fonctionner, a pris <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'ici</a> . <br><br><img align="left" width="250" src="https://habrastorage.org/webt/5q/rr/2i/5qrr2ix-zdxzylgae0zhc1-jmr0.png" alt="image">  Je lance un signal en dents de scie et augmente progressivement l'amplitude.  En cons√©quence, j'ai vu que les distorsions sont des sauts chaotiques de 0 √† la tension d'alimentation et plus le niveau est √©lev√©, plus ces sauts sont importants.  Il m'a fallu plusieurs semaines pour faire parler Omega.  J'√©tais tr√®s fatigu√© et donc, en ce moment j'ai d√©cid√© d'arr√™ter - √ßa marche! <br><br>  Cependant, je comprends que cela est impossible, donc je serai heureux d'entendre vos id√©es et suggestions.  Eh bien, pour ceux qui essaient de faire parler les om√©ga √† l'agonie, j'esp√®re que je vous ai aid√©! <br><br>  Merci √† tous! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413623/">https://habr.com/ru/post/fr413623/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413613/index.html">Ce vaisseau spatial sera plus proche du Soleil que tout ce qui l'a pr√©c√©d√© et ne fondra pas</a></li>
<li><a href="../fr413615/index.html">Le virus VPNFilter, qui a infect√© 500 000 routeurs, s'est av√©r√© encore plus dangereux qu'on ne le pensait</a></li>
<li><a href="../fr413617/index.html">Modification de 30% du mandat et d√©passement √† deux reprises du plan: comment VTB a automatis√© les rapports</a></li>
<li><a href="../fr413619/index.html">De nouvelles informations sur VPNFilter: mener une attaque sur les appareils des utilisateurs, √©largi la liste des √©quipements r√©seau</a></li>
<li><a href="../fr413621/index.html">Vivez-le. Meurs. Ressusciter. R√©p√©ter</a></li>
<li><a href="../fr413627/index.html">G√©n√©ration de cl√©s hi√©rarchiques</a></li>
<li><a href="../fr413631/index.html">Cryptage de jeton de certificat sur un jeton sous Linux en utilisant l'exemple de JaCarta, Debian et le client de messagerie Evolution</a></li>
<li><a href="../fr413633/index.html">Comment je ma√Ætrise l'anglais</a></li>
<li><a href="../fr413635/index.html">Nous concevons une ferme d'√©levage. Et utiliser nanoCAD VK?</a></li>
<li><a href="../fr413637/index.html">Google a publi√© 7 principes d'√©thique de l'IA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>