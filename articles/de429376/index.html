<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ö∞Ô∏è ‚òïÔ∏è üëú Sparsamkeit als REST-API üë©üèº‚Äçü§ù‚Äçüë®üèª üç® üò•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ein kurzer Artikel dar√ºber, wie wir auf Probleme bei der Synchronisierung der Arbeit zwischen Client- und Server-Entwicklungsteams gesto√üen sind. Wie ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sparsamkeit als REST-API</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429376/"> Ein kurzer Artikel dar√ºber, wie wir auf Probleme bei der Synchronisierung der Arbeit zwischen Client- und Server-Entwicklungsteams gesto√üen sind.  Wie wir Thrift verbunden haben, um die Interaktion zwischen unseren Teams zu vereinfachen. <br><br>  Wen interessiert es, wie wir das gemacht haben und welche ‚ÄûNebenwirkungen‚Äú wir haben, schauen Sie bitte unter die Katze. <br><a name="habracut"></a><br><h4>  Hintergrund </h4><br>  Anfang 2017, als wir ein neues Projekt starteten, haben wir EmberJS als Frontend ausgew√§hlt.  Dies f√ºhrte fast automatisch dazu, dass wir beim Organisieren der Interaktion der Client- und Serverteile der Anwendung am REST-Schema arbeiteten.  Weil  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">EmberData</a> bietet ein praktisches Tool zum Trennen der Arbeit der Backend- und Frontend-Befehle. Mit dem Adapter k√∂nnen Sie das ‚ÄûProtokoll‚Äú der Interaktion ausw√§hlen. <br><br>  Anfangs war alles in Ordnung - Ember bot uns die M√∂glichkeit, die Emulation von Serveranforderungen zu implementieren.  Daten zum Emulieren von Servermodellen wurden in separate fuxtures-Dateien abgelegt.  Wenn wir irgendwo angefangen haben zu arbeiten, verwende ich keine Ember-Daten. Mit Ember k√∂nnen wir einen Endpoint-Handler-Emulator in der N√§he schreiben und diese Daten zur√ºckgeben.  Wir hatten eine Vereinbarung getroffen, dass Backend-Entwickler √Ñnderungen an diesen Dateien vornehmen sollten, um die Daten auf dem neuesten Stand zu halten, damit die Frontend-Entwickler ordnungsgem√§√ü arbeiten k√∂nnen.  Aber wie immer, wenn alles auf ‚ÄûVereinbarungen‚Äú basiert (und es kein Werkzeug gibt, um sie zu √ºberpr√ºfen), kommt der Moment, in dem ‚Äûetwas schief geht‚Äú. <br>  Neue Anforderungen f√ºhrten nicht nur zum Erscheinen neuer Daten auf dem Client, sondern auch zur Aktualisierung des alten Datenmodells.  Was letztendlich dazu f√ºhrte, dass die Aufrechterhaltung der Synchronisation von Modellen auf dem Server und ihrer Emulation in den Client-Quelldateien einfach teuer wurde.  Jetzt beginnt die Entwicklung des Client-Teils in der Regel, nachdem der Server-Stub fertig ist.  Die Entwicklung erfolgt auf dem Produktionsserver. Dies erschwert die Teamarbeit und verl√§ngert die Release-Zeit f√ºr neue Funktionen. <br><br><h4>  Projektentwicklung </h4><br>  Jetzt geben wir EmberJS zugunsten von VueJS auf.  Im Rahmen der Migrationsentscheidung suchten wir nach L√∂sungen f√ºr dieses Problem.  Folgende Kriterien wurden entwickelt: <br><br><ul><li>  Kompatibilit√§t mit √§lteren und neueren Versionen des Protokolls </li><li>  Maximaler Komfort f√ºr Frontend-Entwickler bei der Arbeit ‚Äûohne Server‚Äú </li><li>  Trennung der API-Beschreibung von den Testdaten </li><li>  Einfache Synchronisierung der Anrufsignatur <ul><li>  klare Unterschriftenbeschreibung </li><li>  Einfache √Ñnderung durch Frontend- und Backend-Entwickler </li><li>  maximale Autonomie </li></ul></li><li>  Stark typisierte APIs sind w√ºnschenswert.  Das hei√üt,  die schnellste Erkennung einer Tatsache einer Protokoll√§nderung </li><li>  Einfaches Testen der Serverlogik </li><li>  Integration mit Spring auf der Serverseite, ohne mit Tamburinen zu tanzen. </li></ul><br><h4>  Implementierung </h4><br>  Nach dem Nachdenken wurde beschlossen, bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Thrift</a> anzuhalten.  Dies gab uns eine einfache und klare API-Beschreibungssprache. <br><br><pre><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> java ru.company.api <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> php ru.company.api <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> javascrip ru.company.api <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> DIRECTORY_SERVICE= <span class="hljs-string"><span class="hljs-string">"directoryService"</span></span> exception ObjectNotFoundException{ } struct AdvBreed { <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> id, <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> name, <span class="hljs-number"><span class="hljs-number">3</span></span>: optional <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> title } service DirectoryService { <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;AdvBreed&gt; loadBreeds() AdsBreed getAdvBreedById(<span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> id) }</code> </pre> <br>  F√ºr die Interaktion verwenden wir TMultiplexedProcessor, auf den √ºber TServlet mit TJSONProtocol zugegriffen werden kann.  Ich musste ein bisschen tanzen, um diesen Thrift nahtlos in Spring zu integrieren.  Dazu musste ich programmgesteuert ein Servlet in ServletContainer erstellen und registrieren. <br><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThriftRegister</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ContextRefreshedEvent</span></span></span><span class="hljs-class">&gt;, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ApplicationContextAware</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ServletContextAware { companion object { private const val unsecureAreaUrlPattern = "/api/v2/thrift-ns" private const val secureAreaUrlPattern = "/api/v2/thrift" } private var inited = false private lateinit var appContext:ApplicationContext private lateinit var servletContext:ServletContext override fun onApplicationEvent</span></span></span></span>(event: ContextRefreshedEvent) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!inited) { initServletsAndFilters() inited = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initServletsAndFilters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { registerOpenAreaServletAndFilter() registerSecureAreaServletAndFilter() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerSecureAreaServletAndFilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { registerServletAndFilter(SecureAreaServlet::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SecureAreaThriftFilter::class.java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">secureAreaUrlPattern) } private fun registerOpenAreaServletAndFilter</span></span></span></span>() { registerServletAndFilter(UnsecureAreaServlet::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UnsecureAreaThriftFilter::class.java</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">unsecureAreaUrlPattern) } private fun registerServletAndFilter</span></span></span></span>(servletClass:Class&lt;<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Servlet&gt;, filterClass:Class&lt;<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Filter&gt;, pattern:String) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> servletBean = appContext.getBean(servletClass) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> addServlet = servletContext.addServlet(servletClass.simpleName, servletBean) addServlet.setLoadOnStartup(<span class="hljs-number"><span class="hljs-number">1</span></span>) addServlet.addMapping(pattern) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> filterBean = appContext.getBean(filterClass) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> addFilter = servletContext.addFilter(filterClass.simpleName, filterBean) addFilter.addMappingForUrlPatterns(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, pattern) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setApplicationContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(applicationContext: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ApplicationContext</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { appContext = applicationContext } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setServletContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ServletContext</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.servletContext = context } }</code> </pre> <br>  Was ist hier zu beachten.  In diesem Code werden zwei Servicebereiche gebildet.  Gesch√ºtzt, verf√ºgbar unter der Adresse "/ api / v2 / thrift".  Und offen, verf√ºgbar unter "/ api / v2 / thrift-ns".  F√ºr diese Bereiche werden unterschiedliche Filter verwendet.  Im ersten Fall wird beim Zugriff auf den Dienst √ºber Cookies ein Objekt gebildet, das den Benutzer definiert, der den Anruf t√§tigt.  Wenn es nicht m√∂glich ist, ein solches Objekt zu bilden, wird ein 401-Fehler ausgegeben, der auf der Clientseite korrekt verarbeitet wird.  Im zweiten Fall √ºberspringt der Filter alle Anforderungen f√ºr den Dienst. Wenn er feststellt, dass eine Autorisierung erfolgt ist, f√ºllt er die Cookies nach Abschluss des Vorgangs mit den erforderlichen Informationen, damit Anforderungen an den gesch√ºtzten Bereich gestellt werden k√∂nnen. <br><br>  Um einen neuen Dienst zu verbinden, m√ºssen Sie einen zus√§tzlichen Code schreiben. <br><br><pre> <code class="hljs delphi">@Component <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> DirectoryServiceProcessor @Autowired <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(handler: DirectoryService.Iface)</span></span></span><span class="hljs-function">:</span></span> DirectoryService.Processor&lt;DirectoryService.Iface&gt;(handler)</code> </pre> <br>  Und registrieren Sie den Prozessor <br><br><pre> <code class="hljs delphi">@Component <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> SecureMultiplexingProcessor @Autowired <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constructor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dsProcessor: DirectoryServiceProcessor)</span></span></span><span class="hljs-function"> :</span></span> TMultiplexedProcessor() <span class="hljs-comment"><span class="hljs-comment">{ init { this.registerProcessor(DIRECTORY_SERVICE, dsProcessor) ... }</span></span> }</code> </pre> <br>  Der letzte Teil des Codes kann vereinfacht werden, indem an allen Prozessoren eine zus√§tzliche Schnittstelle aufgeh√§ngt wird, mit der Sie sofort eine Liste der Prozessoren mit einem Designerparameter abrufen und dem Prozessor selbst die Verantwortung f√ºr den Wert des Zugriffsschl√ºssels f√ºr den Prozessor √ºbertragen k√∂nnen. <br><br>  Die Arbeit im Modus "Kein Server" hat sich geringf√ºgig ge√§ndert.  Die Entwickler des Frontend-Teils machten einen Vorschlag, dass sie auf einem PHP-Stub-Server arbeiten w√ºrden.  Sie selbst generieren Klassen f√ºr ihren Server, die die Signatur f√ºr die gew√ºnschte Protokollversion implementieren.  Und sie implementieren einen Server mit dem notwendigen Datensatz.  All dies erm√∂glicht es ihnen zu arbeiten, bevor die Entwickler der Serverseite ihre Arbeit beenden. <br><br>  Der Hauptverarbeitungspunkt auf der Client-Seite ist das von uns geschriebene Thrift-Plugin. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> store <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../store'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { UNAUTHORIZED } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../store/actions/auth'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> thrift = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'thrift'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { install (Vue, options) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DirectoryService = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./gen-nodejs/DirectoryService'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> _options = { <span class="hljs-attr"><span class="hljs-attr">transport</span></span>: thrift.TBufferedTransport, <span class="hljs-attr"><span class="hljs-attr">protocol</span></span>: thrift.TJSONProtocol, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/api/v2/thrift'</span></span>, <span class="hljs-attr"><span class="hljs-attr">https</span></span>: location.protocol === <span class="hljs-string"><span class="hljs-string">'https:'</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> _optionsOpen = { ... } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> XHRConnectionError = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_status</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_status === <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_status &gt;= <span class="hljs-number"><span class="hljs-number">400</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_status === <span class="hljs-number"><span class="hljs-number">401</span></span>) { store.dispatch(UNAUTHORIZED) } ... } } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bufers = {} thrift.XHRConnection.prototype.flush = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> self = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url === <span class="hljs-string"><span class="hljs-string">''</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.send_buf } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xreq = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getXmlHttpRequestObject() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xreq.overrideMimeType) { xreq.overrideMimeType(<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>) } xreq.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.readyState === <span class="hljs-number"><span class="hljs-number">4</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.status === <span class="hljs-number"><span class="hljs-number">200</span></span>) { self.setRecvBuffer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.status === <span class="hljs-number"><span class="hljs-number">404</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.status &gt;= <span class="hljs-number"><span class="hljs-number">500</span></span>) {... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {... } } } } xreq.open(<span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.headers).forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">headerKey</span></span></span><span class="hljs-function">) </span></span>{ xreq.setRequestHeader(headerKey, self.headers[headerKey]) }) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">'development'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sendBuf = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.send_buf) bufers[sendBuf[<span class="hljs-number"><span class="hljs-number">3</span></span>]] = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.send_buf xreq.seqid = sendBuf[<span class="hljs-number"><span class="hljs-number">3</span></span>] } xreq.send(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.send_buf) } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> thrift.Multiplexer() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> connectionHostName = process.env.THRIFT_HOST ? process.env.THRIFT_HOST : location.hostname <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> connectionPort = process.env.THRIFT_PORT ? process.env.THRIFT_PORT : location.port <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> connection = thrift.createXHRConnection(connectionHostName, connectionPort, _options) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> connectionOpen = thrift.createXHRConnection(connectionHostName, connectionPort, _optionsOpen) Vue.prototype.$ThriftPlugin = { <span class="hljs-attr"><span class="hljs-attr">DirectoryService</span></span>: mp.createClient(<span class="hljs-string"><span class="hljs-string">'directoryService'</span></span>, DirectoryService, connectionOpen), } } }</code> </pre> <br>  Damit dieses Plugin ordnungsgem√§√ü funktioniert, m√ºssen Sie die generierten Klassen verbinden. <br><br>  Das Aufrufen von Servermethoden auf dem Client lautet wie folgt: <br><br><pre> <code class="javascript hljs">thriftPlugin.DirectoryService.loadBreeds() .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_response</span></span></span><span class="hljs-function"> =&gt;</span></span> { ... }) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { ... }) })</code> </pre><br>  Hier gehe ich nicht auf die Funktionen von VueJS selbst ein, bei denen es richtig ist, den Code beizubehalten, der den Server aufruft.  Dieser Code kann sowohl innerhalb der Komponente als auch innerhalb der Route und innerhalb der Vuex-Aktion verwendet werden. <br>  Bei der Arbeit mit der Client-Seite gibt es einige Einschr√§nkungen, die nach der mentalen Migration von der internen Sparsamkeitsintegration ber√ºcksichtigt werden m√ºssen. <br><br><ul><li>  Der Javascript-Client erkennt keine Nullwerte.  Daher m√ºssen Sie f√ºr Felder, die null sein k√∂nnen, das optionale Flag angeben.  In diesem Fall akzeptiert der Client diesen Wert korrekt. </li><li>  Javascript kann nicht mit langen Werten arbeiten, daher m√ºssen alle Ganzzahlbezeichner auf der Serverseite in Zeichenfolgen umgewandelt werden </li></ul><br><h4>  Schlussfolgerungen </h4><br>  Durch den √úbergang zu Thrift konnten wir die Probleme l√∂sen, die bei der Interaktion zwischen Server- und Cliententwicklung bei der Arbeit an einer alten Version der Schnittstelle auftreten.  Erlaubt die Verarbeitung globaler Fehler an einem Ort. <br><br>  Gleichzeitig erhielten wir mit einem zus√§tzlichen Bonus aufgrund der strengen Typisierung der API und damit der strengen Regeln f√ºr die Serialisierung / Deserialisierung von Daten f√ºr die meisten Anfragen eine Erh√∂hung der Interaktionszeit auf Client und Server um ~ 30% (beim Vergleich derselben Anfragen durch REST- und THRIFT-Interaktion). ab dem Zeitpunkt, an dem die Anforderung an den Server gesendet wurde, bis die Antwort empfangen wurde) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de429376/">https://habr.com/ru/post/de429376/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de429362/index.html">B√∂sartiges maschinelles Lernen als Diagnosemethode</a></li>
<li><a href="../de429364/index.html">Silicon Valley beginnt einen d√ºsteren Konsens √ºber Kinder und Bildschirme zu bilden</a></li>
<li><a href="../de429366/index.html">Wie man eine Zeitmaschine f√ºr Radio macht</a></li>
<li><a href="../de429368/index.html">Sie erwarten zu viel von Boston Dynamics Robots</a></li>
<li><a href="../de429370/index.html">Wie das Nachtsichtger√§t von Google auf Telefonen funktioniert und warum es so gut funktioniert</a></li>
<li><a href="../de429380/index.html">So ersetzen Sie TCP: QUIC ist bereit f√ºr die Implementierung [aber nicht bereit, RFC zu werden]</a></li>
<li><a href="../de429382/index.html">Von Alibaba bis Pyaterochka: Wer und wie nutzt das Gesichtserkennungssystem im Gesch√§ftsleben?</a></li>
<li><a href="../de429384/index.html">Elektrische Fahrradkomponenten: Motor</a></li>
<li><a href="../de429386/index.html">Der AT & T-Anbieter wird zum gr√∂√üten Urheberrechtsinhaber und beginnt, Benutzer zu trennen, denen Piraterie vorgeworfen wird</a></li>
<li><a href="../de429388/index.html">So gestalten Sie eine Website neu und machen keine Probleme: 4 wichtige Schritte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>