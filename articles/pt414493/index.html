<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ú® üë©üèª‚Äçüåæ üéöÔ∏è Como escrever um contrato inteligente para a ICO em 5 minutos ‚òùüèº üì± üéÖüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal! Neste artigo, mostrarei como iniciar um contrato inteligente de coleta de dinheiro para sua ICO no Ethereum em 5 minutos e v√°rios comando...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como escrever um contrato inteligente para a ICO em 5 minutos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414493/"><img src="https://habrastorage.org/webt/rv/6d/_c/rv6d_cyxk3ix-su6le9q4lyqntc.png"><br><br>  Ol√° pessoal!  Neste artigo, mostrarei como iniciar um contrato inteligente de coleta de dinheiro para sua ICO no Ethereum em 5 minutos e v√°rios comandos no terminal.  Este ensaio potencialmente economizar√° dezenas de milhares de d√≥lares, j√° que qualquer programador - e tamb√©m n√£o um programador - poder√° lan√ßar um contrato inteligente auditado e seguro (em vez de pagar US $ 15.000 a US $ 75.000 pelo desenvolvimento).  Em resumo, voc√™ pode enviar dinheiro para este contrato inteligente e receber tokens ERC20 por ele.  Pode-se dizer que este artigo √© uma cole√ß√£o de toda a experi√™ncia adquirida ao lan√ßar uma OIC para o meu projeto. <br><br>  Na Internet, esses j√° est√£o cheios de artigos sobre contratos inteligentes, mas assim que voc√™ come√ßa a escrever um, voc√™ se depara com o fato de que as informa√ß√µes s√£o repetidas em todos os lugares e simplesmente n√£o h√° tutoriais sobre como enganar seu ERC20, ou eles j√° est√£o desatualizados.  A prop√≥sito, para que este artigo permane√ßa relevante, tentarei indicar poss√≠veis locais onde ele pode se tornar obsoleto (e como corrigi-lo).  Vamos l√°! <br><a name="habracut"></a><br><h2>  Solidez </h2><br>  Esse √© o nome do idioma principal que a equipe de kefir desenvolveu para lan√ßar contratos inteligentes.  Se voc√™ √© um programador, basta examinar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o da linguagem</a> - √© indecentemente simples.  A prop√≥sito, eles simplificaram o processo, tornando mais dif√≠cil cometer um erro ao escrever um contrato inteligente.  Portanto, <b>absolutamente qualquer</b> programador, pelo menos no n√≠vel j√∫nior, ser√° capaz de descobrir isso.  <b>N√£o h√° absolutamente nenhum</b> sentido em pagar grandes quantias de dinheiro a desenvolvedores que conhecem solidez - ser√° uma ordem de magnitude mais barata treinar um desenvolvedor existente. <br><br><h2>  Contratos inteligentes </h2><br>  ... e tudo que voc√™ precisa saber sobre eles.  Pule esta se√ß√£o se voc√™ n√£o for um programador.  Um contrato inteligente √© um peda√ßo de c√≥digo.  Em princ√≠pio, esta √© uma classe de solidez (OOP, sim), que possui dois tipos de fun√ß√µes: mudan√ßa de estado e n√£o mudan√ßa de estado.  Bem, para executar fun√ß√µes em um contrato inteligente apenas enviando kefir, √© necess√°rio marcar esta fun√ß√£o como <code>payable</code> . <br><br>  State √© um data warehouse, blockchain, EPT.  Os contratos podem alterar a blockchain (estado, armazenamento) - mas para alterar a blockchain voc√™ precisa pagar kefir aos mineradores.  Como eles compartilhar√£o o kefir n√£o ser√° analisado na estrutura deste artigo.  O pagamento aos mineradores pela execu√ß√£o do c√≥digo de altera√ß√£o de estado √© chamado G√°s.  Se algu√©m de fora jogar kefir para o endere√ßo de um contrato inteligente com uma chamada para uma fun√ß√£o marcada como <code>payable</code> mas n√£o marcada <code>Constant</code> , <code>View</code> ou <code>Pure</code> , a quantidade necess√°ria de kefir para pagamento aos mineiros ser√° deduzida do valor enviado.  Normalmente, nos tokens do ERC20, essas s√£o fun√ß√µes que fornecem o remetente de token para kefir ou transferem tokens de um detentor de token para outro. <br><br>  E se voc√™ marcar uma fun√ß√£o no contrato com as palavras <code>Constant</code> ou <code>View</code> (elas significam a mesma coisa, elas permitem apenas a leitura do estado) ou <code>Pure</code> (a mesma coisa, voc√™ nem l√™ o estado), n√£o precisar√° gastar kefir na execu√ß√£o dessa fun√ß√£o!  Vou dizer ainda mais que essas fun√ß√µes n√£o precisam ser chamadas pelas transa√ß√µes - afinal, qualquer cliente de iogurte pode teoricamente execut√°-lo em casa - e ningu√©m precisa mais saber sobre isso (afinal, nada est√° escrito no blockchain). <br><br>  E h√° duas coisas importantes na solidez: heran√ßa m√∫ltipla e modificadores de fun√ß√£o.  Voc√™ tamb√©m precisa saber sobre eles. <br><br>  O primeiro - contratos justos podem ser herdados simultaneamente de v√°rias classes, como <code>TimedCrowdsale</code> , <code>CappedCrowdsale</code> , <code>MintedCrowdsale</code> , <code>Ownable</code> - enquanto as fun√ß√µes dos construtores tamb√©m s√£o lan√ßadas uma ap√≥s a outra - mas vou explicar isso mais tarde, como exemplo. <br><br>  A segunda √© a capacidade de criar fun√ß√µes que ser√£o inseridas em outras fun√ß√µes.  √â como um encapsulamento simples, apenas um pouco mais flex√≠vel - √© literalmente <b>um modelo de</b> fun√ß√£o.  Ao criar um modificador, voc√™ escreve o caractere especial <code>_</code> onde quer dizer o c√≥digo de uma fun√ß√£o usando esse modificador.  Ou seja, modificadores n√£o s√£o apenas funcionalidades encapsuladas que retornam um valor;  esse √© um modelo de fun√ß√£o quando o c√≥digo de um modificador √© literalmente inserido em uma fun√ß√£o usando esse modificador. <br><br>  Vamos seguir praticando. <br><br><h2>  Ambiente de cozinha </h2><br>  Se voc√™ n√£o souber o que √© o Terminal, leia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">este artigo aqui</a> .  Se voc√™ estiver no Windows, configure um terminal via WLS.  Se voc√™ j√° est√° familiarizado com o Terminal, vamos continuar.  Al√©m disso, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">coloque-se</a> imediatamente Node.js - ser√° necess√°rio para as pr√≥ximas etapas.  √â melhor instalar o LTS, mas, de fato, n√£o faz diferen√ßa qual das vers√µes modernas do n√≥ instalar. <br><br>  A primeira coisa que instalamos e iniciamos imediatamente o processo de sincroniza√ß√£o do bloco √© <code>geth</code> .  Em resumo, este √© um utilit√°rio escrito em Go que nos permitir√° executar o n√≥ ether no computador local e conectar-se √†s redes reais e de teste.  Voc√™ pode instalar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">via instaladores</a> , mas eu recomendo que voc√™ <code>geth</code> imediatamente no Terminal, conforme descrito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Voc√™ pode verificar se seus padr√µes <code>geth</code> est√£o <code>geth</code> executando o comando no Terminal: <br><br><pre> <code class="bash hljs">geth version</code> </pre> <br>  Se voc√™ cuspir a vers√£o geth - tudo est√° em aberto, continue o tutorial.  Se n√£o - ruim, correto;  parece que voc√™ precisar√° fazer amor com o Terminal e o sistema operacional - mas n√£o √© a primeira vez que voc√™ descobre isso.  Como instalar o geth, execute o comando no Terminal: <br><br><pre> <code class="bash hljs">geth --testnet console</code> </pre> <br>  Isso iniciar√° o processo de sincroniza√ß√£o do seu n√≥ com o servidor de teste, cujos blocos podem ser visualizados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Voc√™ pode verificar se sincronizou com a rede no console <code>geth</code> : <br><br><pre> <code class="bash hljs">eth.blockNumber <span class="hljs-comment"><span class="hljs-comment">#  0 ‚Äî     eth.syncing #     false,    </span></span></code> </pre> <br>  O processo de sincroniza√ß√£o levou de 1 a 4 horas - quando como.  Al√©m disso, al√©m da sincroniza√ß√£o de blocos, voc√™ tamb√©m precisar√° aguardar a sincroniza√ß√£o de estado - geralmente √© mais longa que a sincroniza√ß√£o de blocos.  Voc√™ tamb√©m pode usar <code>geth</code> com o sinalizador <code>--light</code> -, a sincroniza√ß√£o dura de alguns segundos a um minuto e ainda √© poss√≠vel implantar contratos. <br><br>  Ok, instalamos o primeiro utilit√°rio - coloque o pr√≥ximo.  Precisamos colocar um an√°logo de <code>geth</code> , apenas uma simula√ß√£o de blockchain muito local - <code>testrpc</code> .  Sim, temos <b>3 blockchains</b> : <br><br><ul><li>  <code>testrpc</code> - simula√ß√£o local de blockchain;  r√°pido, mas falso e armazenado apenas em sua m√°quina </li><li>  <code>geth --testnet</code> j√° √© um blockchain real, mas voc√™ n√£o perde dinheiro onde pode obter kefir e testar todos os <code>geth --testnet</code> gratuitamente </li><li>  <code>geth</code> - mainnet, principal, blockchain real, kefir real;  tudo de uma maneira adulta, os erros aqui s√£o as perdas de kefir real </li></ul><br>  Dessa forma, iniciaremos o contrato de teste com o <code>testrpc</code> , em seguida instal√°-lo no <code>geth --testnet</code> e, em seguida, fazer o download diretamente no <code>geth</code> . <br><br>  <code>testrpc</code> executando o seguinte comando: <br><br><pre> <code class="bash hljs">npm install -g ethereumjs-testrpc</code> </pre> <br>  Bem, ou sobe imediatamente com uma trufa, j√° que agora o <code>testrpc</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sob a asa da trufa</a> e √© chamado <code>ganache-cli</code> .  Embora o diabo saiba, tudo funcionou <code>testrpc</code> com o <code>testrpc</code> baunilha.  E se funcionar, n√£o toque, como fui ensinado na academia intergal√°ctica.  Voc√™ tamb√©m pode execut√°-lo para verificar a instala√ß√£o registrando <code>truffle</code> no console, mas o blockchain de teste j√° est√° sincronizado conosco - n√£o vamos incomodar. <br><br>  Bem, descobri as cadeias?  Agora existem n√≥s e o teste est√° sincronizado?  Colocamos um utilit√°rio conveniente para trabalhar com contratos inteligentes no kefir - <code>truffle</code> , com o seguinte comando: <br><br><pre> <code class="bash hljs">npm install -g truffle truffle version <span class="hljs-comment"><span class="hljs-comment">#  ,  ,  </span></span></code> </pre> <br>  O Truffle √© uma ferramenta que permite manter contratos inteligentes em arquivos diferentes, importar outros arquivos e tamb√©m compilar seu c√≥digo de contrato inteligente em um bytecode grande (ileg√≠vel por uma pessoa); ele encontra automaticamente o <code>geth</code> execu√ß√£o local (teste e teste real). ) ou <code>testrpc</code> , implante seu contrato inteligente nessa rede.  Al√©m disso, verifica se h√° erros no c√≥digo do contrato inteligente e as transa√ß√µes conclu√≠das recentemente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tamb√©m ajudam a depurar</a> .  Masthead, em suma. <br><br>  Nesse est√°gio, voc√™ deve ter instalado: <code>testrpc</code> , <code>geth</code> , <code>truffle</code> - se algo estiver faltando ou a vers√£o n√£o for enviada ao console mediante solicita√ß√£o, corrija-o;  caso contr√°rio, voc√™ n√£o ter√° sucesso. <br><br><blockquote>  Al√©m disso, joguei um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">script</a> simples do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bash</a> que instalar√° tudo para voc√™.  Chamado assim: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">source</span></span> &lt;(curl -s https://raw.githubusercontent.com/backmeupplz/eth-installer/master/install.sh)</code> </pre> <br>  - mas eu nunca testei ainda, ent√£o n√£o tenho certeza do seu desempenho.  No entanto, ficarei feliz em receber solicita√ß√µes. </blockquote><br><h2>  Contrato Figash </h2><br>  Tudo j√° foi inventado e escrito para voc√™ - isso √© bom.  Um pouco de estamenha ser√° o mesmo - mas tentarei minimiz√°-lo para voc√™.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Usaremos contratos ERC20 j√° prontos do OpenZeppelin</a> - esse √© agora o padr√£o do setor, eles passaram na auditoria e, de fato, todos usam seu c√≥digo.  Muito obrigado por sua contribui√ß√£o ao c√≥digo aberto. <br><br>  Fa√ßa do <code>cd</code> uma pasta segura e depois escreva: <br><br><pre> <code class="bash hljs">mkdir contract &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> contract</code> </pre> <br>  Nesta pasta, vamos trabalhar.  Crie um esbo√ßo aqui para o nosso contrato inteligente: <br><br><pre> <code class="bash hljs">truffle init</code> </pre> <br>  Trope√ßar, claramente.  Agora temos duas pastas muito importantes nas quais escalaremos: <code>contracts</code> e <code>migrations</code> .  O primeiro √© o c√≥digo para nossos contratos, o segundo √© o c√≥digo para as trufas saberem o que fazer ao implantar contratos na blockchain. <br><br>  Em seguida, precisamos pegar o c√≥digo atual do contrato inteligente a partir da NPM e, de fato, iniciar o pr√≥prio projeto: <br><br><pre> <code class="bash hljs">npm init -y <span class="hljs-comment"><span class="hljs-comment">#     ( -y) npm install -E openzeppelin-solidity #       ( -E)</span></span></code> </pre> <br>  Bem, o c√≥digo de contratos inteligentes do OpenZeppelin est√° no nosso bolso na pasta <code>node_modules/openzeppelin-solidity/contracts</code> .  Agora vamos para a pasta principal dos <code>contracts</code> , <code>MyToken.sol</code> todos os arquivos e adicionamos os arquivos <code>MyToken.sol</code> e <code>MyCrowdsale.sol</code> - naturalmente, voc√™ <code>MyCrowdsale.sol</code> seus contratos de maneira diferente.  O primeiro ser√° um contrato para o nosso Token ERC20 e o segundo ser√° um contrato da nossa OIC, que aceitar√° o kefir e distribuir√° o <code>MyToken</code> pessoas.  Este artigo pode estar desatualizado, mas voc√™ sempre pode ver como o OpenZeppelin sugere que voc√™ crie contratos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em seu reposit√≥rio</a> .  √â assim que o <code>MyToken.sol</code> se parecer√° <code>MyToken.sol</code> : <br><br><pre> <code class="javascript hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.23</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Imports import "../node_modules/openzeppelin-solidity/contracts/token/ERC20/MintableToken.sol"; // Main token smart contract contract MyToken is MintableToken { string public constant name = "My Token"; string public constant symbol = "MTKN"; uint8 public constant decimals = 18; }</span></span></code> </pre> <br>  Bom - voc√™ tem um contrato inteligente com seu pr√≥prio token (basta alterar os nomes nas constantes)!  Voc√™ pode ver que <code>MintableToken</code> heran√ßa existe no <code>MintableToken</code> - mas tudo √© o mais simples poss√≠vel.  √â um token que pode ser emitido (do ingl√™s ‚ÄúMint‚Äù - para mint), e somente o propriet√°rio tem o direito de emiti-lo, pois o <code>MintableToken</code> tamb√©m herda do <code>Ownable</code> .  Al√©m disso, o <code>MintableToken</code> tamb√©m herda das classes de tokens do ERC20 escritas pelo OpenZeppelin, nas quais a interface do ERC20 √© implementada: <br><br><pre> <code class="javascript hljs">contract ERC20Basic { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalSupply</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint256</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">balanceOf</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">address who</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint256</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transfer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">address to, uint256 value</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bool</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Transfer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">address indexed from, address indexed to, uint256 value</span></span></span><span class="hljs-function">); }</span></span></code> </pre> <br>  Sim, aqui voc√™ tem toda a interface do ERC20.  Isso √© dif√≠cil?  Eu acho que n√£o.  Ele oferece a oportunidade de verificar quantos tokens foram emitidos, verificar o saldo do endere√ßo e transferir tokens para outro endere√ßo, divulgando um evento de transfer√™ncia para clientes de kefir leve na rede.  E tudo isso voc√™ ganha de gra√ßa no <code>MyToken.sol</code> gra√ßas ao trabalho do OpenZeppelin - eles s√£o √≥timos. <br><br>  E agora vamos para a parte principal da nossa OIC - precisamos aceitar o kefir e distribuir o <code>MyToken</code> !  √â assim que o seu <code>MyCrowdsale.sol</code> ser√°: <br><br><pre> <code class="javascript hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.23</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Imports import "../node_modules/openzeppelin-solidity/contracts/crowdsale/emission/MintedCrowdsale.sol"; import "../node_modules/openzeppelin-solidity/contracts/crowdsale/distribution/RefundableCrowdsale.sol"; import "../node_modules/openzeppelin-solidity/contracts/crowdsale/validation/CappedCrowdsale.sol"; import "../node_modules/openzeppelin-solidity/contracts/token/ERC20/MintableToken.sol"; contract MyCrowdsale is CappedCrowdsale, RefundableCrowdsale, MintedCrowdsale { constructor( uint256 _openingTime, uint256 _closingTime, uint256 _rate, address _wallet, uint256 _cap, MintableToken _token, uint256 _goal ) public Crowdsale(_rate, _wallet, _token) CappedCrowdsale(_cap) TimedCrowdsale(_openingTime, _closingTime) RefundableCrowdsale(_goal) { //   ,  ,    // ,     require(_goal &lt;= _cap); } }</span></span></code> </pre><br>  So-so-so-so, o que h√° conosco?  Meninos, contratos inteligentes?  Nossa venda p√∫blica de tokens herda tr√™s das propriedades mais populares: possui um limite m√°ximo, que n√£o pode mais ser coletado;  tampa macia, n√£o coletando quais √©steres s√£o devolvidos;  hor√°rio de in√≠cio e t√©rmino da venda do token.  De fato, o que mais √© necess√°rio para a felicidade? <br><br>  Programadores, observe como os construtores de v√°rias classes de heran√ßa s√£o organizados em uma linha e obt√©m argumentos do construtor principal de <code>MyCrowdsale</code> .  Al√©m disso, verificamos que a hardkey √© maior que a softkey - Ales Gut!  Al√©m disso, n√£o se <code>MyCrowdsale</code> par√¢metros <code>MyCrowdsale</code> no construtor <code>MyCrowdsale</code> - n√≥s os transmitiremos no est√°gio de implanta√ß√£o do contrato na trufa. <br><br>  Isso √© tudo - voc√™ tem contratos prontos de seu pr√≥prio token ERC20 e at√© mesmo um contrato inteligente da OIC, configurado de acordo com o seu desejo e distribuindo seus tokens para kefir.  Al√©m disso, √© suportado por todas as carteiras ERC20 - um erro!  Vamos passar para testes manuais e implanta√ß√£o. <br><br><h2>  Migra√ß√µes </h2><br>  Como eu disse anteriormente, testaremos sequencialmente em tr√™s redes blockchain, mas o processo de teste com canetas ser√° sempre o mesmo.  Vamos come√ßar com <code>testrpc</code> , depois seguir para <code>geth --testnet</code> e continuar com <code>geth</code> .  Sou far√≥is, acabamos de escrever o c√≥digo, vamos tentar compil√°-lo.  Na pasta do projeto, escreva: <br><br><pre> <code class="bash hljs">truffle compile</code> </pre> <br>  Se tudo for compilado sem problemas, voc√™ ver√° a <code>build</code> , que conter√° o krakozyab da trufa para que possa incorporar o bytecode de seus contratos inteligentes na blockchain.  Antes de implantar contratos inteligentes, precisamos dizer √† trufa o que fazer.  A implanta√ß√£o de trufas de contratos inteligentes √© chamada migra√ß√£o - bem, vamos nos ater a essa terminologia.  V√° para <code>migrations/1_initial_migration.js</code> e altere-o da seguinte maneira: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> token = artifacts.require(<span class="hljs-string"><span class="hljs-string">"../contracts/MyToken.sol"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> crowdsale = artifacts.require(<span class="hljs-string"><span class="hljs-string">"../contracts/MyCrowdsale.sol"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">deployer, network, accounts</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> openingTime = <span class="hljs-number"><span class="hljs-number">1514764800</span></span>; <span class="hljs-comment"><span class="hljs-comment">// 15  2018 const closingTime = 1561939200; // 1  2019 const rate = new web3.BigNumber(1); // 1   1  const wallet = '0x281055afc982d96fab65b3a49cac8b878184cb16'; // - const cap = 200 * 1000000; //  const goal = 100 * 1000000; //  return deployer .then(() =&gt; { return deployer.deploy(token); }) .then(() =&gt; { return deployer.deploy( crowdsale, openingTime, closingTime, rate, wallet, cap, token.address, goal ); }) .then(() =&gt; { // Crowdsale    var tokenContract = web3.eth.contract(token.abi).at(token.address); web3.eth.defaultAccount = web3.eth.accounts[0]; tokenContract.transferOwnership(crowdsale.address); }); };</span></span></code> </pre> <br>  Este √© o mesmo arquivo que ser√° usado pela trufa para implantar contratos.  Ent√£o, o que estamos fazendo aqui?  Primeiro, solicitamos o <code>MyToken</code> e o <code>MyToken</code> compilados.  Depois, definimos as constantes com todos os argumentos da nossa OIC - definimos os hor√°rios de in√≠cio e t√©rmino;  quantos tokens as pessoas receber√£o por 1 vey de kefir (0,000000000000000001 eth = 1 wei; definir <code>decimals</code> indica quantos pedidos wei s√£o necess√°rios para obter 1 de seus tokens rec√©m-criados);  carteira, de onde vir√° o kefir obtido com a venda;  tampa dura e tampa macia.  Observe que o <code>openingTime</code> sempre deve ser posterior ao hor√°rio do bloco atual na blockchain - caso contr√°rio, seu contrato inteligente n√£o ser√° bloqueado devido √† verifica√ß√£o da condi√ß√£o no <code>TimedCrowdsale</code> .  Eu entrei nesse rake e transa√ß√µes com falha n√£o podem ser debitadas.  Mude essas constantes como desejar. <br><br>  O pr√≥ximo passo √© precisamente a implanta√ß√£o de contratos inteligentes.  Nada de interessante aqui: temos um objeto <code>deployer</code> que implementa artefatos de contrato inteligentes e passa argumentos para l√°.  Observe que o MyToken √© <code>MyToken</code> primeiro e somente depois o <code>MyCrowdsale</code> - e o endere√ßo do primeiro √© passado no segundo como argumento. <br><br>  Ent√£o, o mais interessante √© sobre o que eles n√£o escrevem na documenta√ß√£o ou nos livros.  Quando voc√™ cria um <code>MyToken</code> partir de uma carteira, essa carteira se torna o propriet√°rio do <code>MyToken</code> na superclasse <code>Ownable</code> - o mesmo acontece com o <code>MyCrowdsale</code> .  Se voc√™ se aprofundar no <code>MintableToken</code> , poder√° ver que apenas o <code>Owner</code> pode cunhar moedas!  E quem √© o propriet√°rio do <code>MyToken</code> ?  √â isso mesmo: o endere√ßo que o aborreceu.  E quem enviar√° pedidos de cunhagem de moedas?  Correto: contrato inteligente <code>MyCrowdsale</code> .  Deixe-me lembr√°-lo de que o endere√ßo que criou o <code>MyToken</code> e o <code>MyCrowdsale</code> s√£o dois endere√ßos diferentes. <br><br>  Portanto, estamos adicionando a terceira etapa de implanta√ß√£o n√£o-ortodoxa, em que o endere√ßo que desafiou os contratos ( <code>web3.eth.accounts[0]</code> ) chama a fun√ß√£o <code>transferOwnership</code> no contrato <code>MyToken</code> , <code>MyToken</code> que o <code>MyCrowdsale</code> dono do <code>MyToken</code> e possa cunhar moedas.  E o <code>MyCrowdsale</code> ainda est√° sob propriedade de <code>web3.eth.accounts[0]</code> - ent√£o tudo est√° inclu√≠do. <br><br><blockquote>  Observa√ß√£o sobre <code>web3.eth.accounts[0]</code> : ao implantar um contrato inteligente, verifique se geth ou testrpc possui a carteira correta em <code>web3.eth.accounts[0]</code> - n√£o perca a chave privada, embora isso n√£o o prejudique, mas de repente o propriet√°rio precisar√° fazer algo mais tarde, mas a chave n√£o est√° mais l√°? </blockquote><blockquote>  No <code>testrpc</code> , como regra, as contas s√£o criadas imediatamente na inicializa√ß√£o e s√£o desbloqueadas imediatamente;  no entanto, em um blockchain de teste e de ar real, vale a pena criar uma conta por meio do <code>personal.newAccount()</code> - reabaste√ßa esse endere√ßo via <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Faucet</a> no blockchain de teste ou kefir real no blockchain real.  N√£o perca sua senha e chaves privadas. </blockquote><blockquote>  Al√©m disso, voc√™ pode adicionar uma carteira existente √†s suas contas chamando <code>web3.personal.importRawKey('pvt_key', 'password')</code> , mas para isso √© necess√°rio chamar <code>geth</code> com o par√¢metro adicional <code>--rpcapi="db,eth,net,web3,personal,web3"</code> .  Eu acho que voc√™ vai descobrir. </blockquote><br><h2>  Teste e implanta√ß√£o </h2><br>  Sim, os contratos est√£o prontos, as migra√ß√µes s√£o escritas, resta apenas implantar e verificar.  Ambos, <code>geth</code> (test e real) e <code>testrpc</code> gerenciados da mesma maneira no <code>truffle console</code> - portanto, descreverei o m√©todo de verifica√ß√£o do <code>testrpc</code> e <code>testrpc</code> como habilitar o <code>geth</code> after.  E assim, lan√ßamos o blockchain de kefir local de teste: <br><br><pre> <code class="bash hljs">testrpc</code> </pre> <br>  Hum ... isso √© tudo.  Voc√™ simula o blockchain de kefir localmente. <br><br><blockquote>  E para implantar no blockchain ether de teste, em vez deste comando, voc√™ obter√° <code>geth --testnet --rpc</code> .  E para implantar no verdadeiro blockchain do √©ter, voc√™ simplesmente <code>geth --rpc</code> .  O sinalizador <code>--rpc</code> necess√°rio para que a trufa possa se conectar.  As etapas de implanta√ß√£o e teste a seguir s√£o mais ou menos as mesmas para todos os tr√™s tipos de blockchain.  A √∫nica coisa √© que depois de executar o teste ou o blockchain real via <code>geth</code> , ele come√ßar√° a sincronizar os blocos - e isso pode levar de quatro a cinco horas em uma boa conex√£o com a Internet.  Uma observa√ß√£o sobre isso estava no come√ßo do artigo.  Antes de implantar contratos inteligentes, recomendo aguardar a sincroniza√ß√£o completa.  Al√©m disso, o blockchain pesa na regi√£o de 60 a 100 gigabytes, portanto, prepare o espa√ßo em disco para isso. </blockquote><blockquote>  Al√©m disso, verifique tamb√©m se <code>web3.eth.accounts[0]</code> desbloqueado.  Geralmente, voc√™ pode registrar o <code>testrpc</code> no console, que √© aberto imediatamente, ou em uma janela Terminal separada no console, que √© aberta via <code>geth console</code> : <code>eth.unlockAccount(eth.accounts[0], ",    ", 24*3600)</code> - isso desbloquear√° sua conta, o que deve criar um contrato inteligente </blockquote><br>  Agora abra uma nova janela do Terminal (n√£o fechamos o <code>testrpc</code> - deve funcionar) e escreva-o na pasta do projeto: <br><br><pre> <code class="bash hljs">truffle migrate --reset</code> </pre> <br>  Esse comando m√°gico compila um contrato inteligente (ou seja, voc√™ n√£o precisa escrever uma <code>truffle compile</code> todas as vezes) e o implementa no micro servidor blockchain encontrado localmente aberto.  Vale ressaltar que, se <code>testrpc</code> fizer isso instantaneamente, o teste e as cadeias reais incluir√£o a transa√ß√£o nos pr√≥ximos blocos por muito mais tempo.  Depois disso, voc√™ deve cuspir algo assim no console: <br><br><pre> <code class="bash hljs">Using network <span class="hljs-string"><span class="hljs-string">'development'</span></span>. Running migration: 1_initial_migration.js Running step... Replacing MyToken... ... 0x86a7090b0a279f8befc95b38fa8bee6918df30928dda0a3c48416454e2082b65 MyToken: 0x2dc35f255e56f06bd2935f5a49a0033548d85477 Replacing MyCrowdsale... ... 0xf0aab5d550f363478ac426dc2aff570302a576282c6c2c4e91205a7a3dea5d72 MyCrowdsale: 0xaac611907f12d5ebe89648d6459c1c81eca78151 ... 0x459303aa0b79be2dc2c8041dd48493f2d0e109fac19588f50c0ac664f34c7e30 Saving artifacts...</code> </pre> <br>  Acho que voc√™ j√° percebeu que o console forneceu os endere√ßos dos contratos inteligentes <code>MyToken</code> e <code>MyCrowdsale</code> .  Isso √© tudo!  O contrato inteligente est√° incorporado na blockchain cujo microsservidor voc√™ abriu.  Resta apenas verificar se os tokens s√£o realmente distribu√≠dos aos usu√°rios que enviam kefir ao contrato inteligente <code>MyCrowdsale</code> .  Escrevemos o seguinte no Terminal para entrar no console de trufas: <br><br><pre> <code class="bash hljs">truffle console</code> </pre> <br>  Escrevemos o seguinte na trufa agora (sem coment√°rios): <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   - t="0x2dc35f255e56f06bd2935f5a49a0033548d85477" //     MyToken ="0xaac611907f12d5ebe89648d6459c1c81eca78151" //     MyCrowdsale //   - token=MyToken.at(t) crowdsale=MyCrowdsale.at(c) //       account=web3.eth.accounts[0] // ,      token.balanceOf(account) //   0 //    - web3.eth.sendTransaction({from: account, to:c, value: web3.toWei(0.1, 'ether'), gas: 900000})</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No caso de, </font></font><code>testrpc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voc√™ pode verificar imediatamente o saldo de nossa carteira novamente, mas no caso de teste e blockchain real, √© necess√°rio aguardar at√© que nossa transa√ß√£o seja inclu√≠da no bloco - geralmente quando isso acontece, a trufa fornece o n√∫mero da transa√ß√£o. Voc√™ j√° esperou? Verifique novamente nosso saldo em </font></font><code>MyToken</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ,      token.balanceOf(account) //    </span></span></code> </pre> <br>  Isso √© tudo!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro a massa sobre o seu contrato </font></font><code>testrpc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, ent√£o </font></font><code>geth --testnet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, em seguida, deployte on </font></font><code>geth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Ent√£o voc√™ lan√ßou seu pr√≥prio ICO! E voc√™ n√£o precisou gastar dezenas de kilobaks para auditoria e lan√ßamento. Estragar tudo o que os caras do OpenZeppelin nos forneceram √© realmente muito dif√≠cil. E quando voc√™ o usa </font></font><code>truffle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- √© assim que o desenvolvimento solid√°rio geralmente se transforma em um conto de fadas. Bem, exceto nos casos em que as transa√ß√µes s√£o revertidas durante a execu√ß√£o de um contrato inteligente - estr√©ia no inferno. Mas a depura√ß√£o de contratos inteligentes √© realmente digna de um artigo separado.</font></font><br><br><h2>  Conclus√£o </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muito obrigado pela leitura at√© o final deste artigo! Se eu consegui economizar tempo ou dinheiro, ou se voc√™ aprendeu algo novo com este artigo, ficarei muito feliz com isso. Tamb√©m ficaria muito grato se voc√™ compartilhar este artigo com seus amigos ou conhecidos que desejam realizar uma ICO - economize US $ 75.000 para sub-programadores que sugam dinheiro do mercado de criptografia como parasitas, copiando e colando as mesmas 25 linhas de c√≥digo . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Boa sorte no desenvolvimento de contratos inteligentes! Ainda tem d√∫vidas? Pe√ßo-lhe nos coment√°rios. Ficarei feliz em responder a tudo e tentar ajudar com problemas.</font></font><br><br><h2>  B√¥nus </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas e se voc√™ quiser alterar a l√≥gica pela qual o pre√ßo de compra dos tokens √© considerado? </font><font style="vertical-align: inherit;">Claro, voc√™ pode alter√°-lo corretamente </font></font><code>rate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou usar uma das classes de contratos do OpenZeppelin, mas e se voc√™ quiser algo ainda mais pervertido? </font><font style="vertical-align: inherit;">Em um contrato inteligente, voc√™ pode substituir a fun√ß√£o da </font></font><code>getTokenAmount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seguinte maneira:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_getTokenAmount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint256 _weiAmount</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint256</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (block.timestamp &lt; <span class="hljs-number"><span class="hljs-number">1533081600</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// August 1st, 2018 rate = rate * 4; } else if (block.timestamp &lt; 1546300800) { // January 1st, 2019 rate = rate * 2; } return _weiAmount.mul(rate); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em geral, isso pode tornar o pre√ßo do token dependente do momento da compra - quanto mais longe na floresta, mais caros os tokens. </font><font style="vertical-align: inherit;">N√£o tenha medo de experimentar e reescrever alguns dos recursos de contratos inteligentes - √© divertido!</font></font><br><br><img src="https://habrastorage.org/webt/3a/mp/lk/3amplkx2fhpeplqauietmgshkc8.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt414493/">https://habr.com/ru/post/pt414493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt414481/index.html">Quiz do PHP de sexta-feira: algumas aventuras do programador Brad, uma sequ√™ncia estranha e pr√™mios</a></li>
<li><a href="../pt414483/index.html">Digite SQL Seguro no Kotlin</a></li>
<li><a href="../pt414485/index.html">GNMT, falha √©pica ou sutilezas da tradu√ß√£o autom√°tica</a></li>
<li><a href="../pt414487/index.html">Um raro representante do tipo de for√ßa bruta: a hist√≥ria de um ataque</a></li>
<li><a href="../pt414489/index.html">EUA planejam tratar seriamente da quest√£o de detritos espaciais</a></li>
<li><a href="../pt414495/index.html">toString: √ìtimo e terr√≠vel</a></li>
<li><a href="../pt414497/index.html">API da interface do usu√°rio do Consulo da ideia ao prot√≥tipo</a></li>
<li><a href="../pt414499/index.html">Relat√≥rio do Clube de Roma de 2018, cap√≠tulo 1.1.3: ‚ÄúUm mundo vazio versus uma paz total‚Äù</a></li>
<li><a href="../pt414501/index.html">Relat√≥rio do Clube de Roma de 2018, cap√≠tulo 3.11: ‚ÄúReformas do setor financeiro‚Äù</a></li>
<li><a href="../pt414503/index.html">Intel NUC Hades Canyon com gr√°ficos AMD Vega - VR ou n√£o VR?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>