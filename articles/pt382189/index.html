<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙅 😗 🚴🏼 Smart.js - (mais de) novo firmware para ESP8266 🤰🏾 👩🏿‍🌾 🦋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No habr, frequentemente são publicados artigos sobre vários projetos baseados no popular chip ESP8266, então não vou falar sobre isso sozinho. 
 
 Dir...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Smart.js - (mais de) novo firmware para ESP8266</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/382189/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No habr, frequentemente são publicados artigos sobre vários projetos baseados no popular chip ESP8266, então não vou falar sobre isso sozinho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diretamente ao fundo: desenvolvemos um novo firmware para este dispositivo, oferecendo o uso de Javascript para desenvolvimento. </font><font style="vertical-align: inherit;">Mas o Smart.js não é apenas um firmware para interpretadores JS, é também um "kit" diferente para trabalhar com equipamentos e uma infraestrutura em nuvem. </font></font><br>
<br>
<img src="https://habrastorage.org/files/d0c/4c1/ca4/d0c4c1ca4a2b453faf77decff24d5b13.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para detalhes - por favor, abaixo do gato.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Devo dizer imediatamente que este artigo é um artigo de revisão; tentarei falar sobre o que o Smart.js pode fazer, e tocarei muito pouco em como tudo isso está organizado. Se você estiver interessado em saber como funciona, este pode ser o tópico do próximo artigo (e você também pode ver a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonte</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então, o que temos sob o capô? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Primeiro de tudo, é um mecanismo JS chamado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V7</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desenvolvido pela Cesanta. Sem me debruçar muito em detalhes, apenas observo que esse mecanismo foi originalmente desenvolvido para plataformas embarcadas, portanto, ele se distingue por seu tamanho pequeno, baixo consumo de memória, excelente portabilidade e alto grau de configurabilidade. No entanto, apenas um intérprete JS no ESP8266 seria algo em si, para que o Smart.js possa se comunicar com o mundo exterior.</font></font><br>
<ul>
<li>I2C.  API    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>,      «»  (<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">EEPROM</a>). I2C   bit-bang,      ; </li>
<li>SPI. ESP   SPI ,       SPI  HSPI,  HSPI,  ,  Hardware SPI. «» SPI       ,     .     bit-bang',      ,   HSPI (,     ESP,      SPI, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>).   API  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>;</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wi-fi. </font><font style="vertical-align: inherit;">Seria estranho não suportar WiFi. </font><font style="vertical-align: inherit;">Portanto, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apoiamos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sistema de arquivo. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">É</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> baseado em SPIFFS;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Há também uma API para trabalhar com o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPIO</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://github.com/cesanta/smart.js/blob/master/README.md&amp;usg=ALkJrhgmGHllwkP6J_RfQrHgI251kpL9nA#"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cliente HTTP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> simples </font><font style="vertical-align: inherit;">;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... e um conjunto de várias </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funções auxiliares</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, se for interessante - leia o leia- </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">me</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tentamos descrever tudo o que é. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora um pouco sobre um início rápido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faça o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">download do</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arquivo </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">Flash'n'Chips</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O Flash'n'chips é um driver flash "proprietário". </font><font style="vertical-align: inherit;">Você pode usar qualquer um, mas o Flash'n'chips gera imediatamente o ID do dispositivo e a senha necessários para conectar-se à nuvem. </font><font style="vertical-align: inherit;">Existe uma versão para OS X e Windows.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E Linux.</font></font></b><div class="spoiler_text"> Linux    ,   ,    .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além do pisca-pisca em si, o arquivo também contém o firmware "release" (ou seja, Alpha). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conectamos o ESP8266 ao USB, lançamos o Flash'n'chips e vemos algo assim: </font></font><br>
<br>
<img src="https://habrastorage.org/files/ad9/a25/fd9/ad9a25fd9fcf452f9e3066080d20a87a.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Clique em “Carregar firmware” - e o firmware irá inundar o dispositivo. </font><font style="vertical-align: inherit;">Dependendo do ESP que você possui, movimentos corporais adicionais podem ser necessários. </font><font style="vertical-align: inherit;">Por exemplo, eu uso o ESP01 mais simples, portanto, antes de piscar, preciso conectar o GPIO0 ao GND. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos conectados pelo terminal. </font><font style="vertical-align: inherit;">(Também há um Flash'N'Chips embutido, estou mais familiarizado com o picocom, mas isso não importa). </font><font style="vertical-align: inherit;">Velocidade - 115200.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nós vemos o console.</font></font></b><div class="spoiler_text">    ,     .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nesse console, você pode digitar imediatamente o código JS. (“Smartjs NNN / MM $” é um prompt de linha de comando, NNN é a quantidade de memória livre, MM é a quantidade de memória atualmente consumida diretamente pelo intérprete). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece um console comum. </font></font><br>
<br>
<img src="https://habrastorage.org/files/afa/c9c/7d3/afac9c7d37e24b7f8b007648dcb37783.png" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando você pressiona Enter, o comando é executado e o resultado é exibido no console, ou seja, você pode fazer sem muita "impressão". Outra maneira de escrever e executar o código JS é digitá-lo no seu editor favorito, salvá-lo em um arquivo e baixá-lo no seu dispositivo. A maneira mais fácil de fazer isso é com os mesmos chips Flash'n'Chips - na caixa de combinação Selecionar ação, selecione “Upload file”. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora o arquivo pode ser executado usando o comando File.load (“nome do arquivo”) digitando este comando no console ou adicionando-o ao arquivo init.js (o arquivo será executado automaticamente quando o dispositivo for iniciado).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O firmware do ESP8266 Smart.js não é limitado. Como escrevi acima, ainda há uma nuvem na qual você pode enviar dados do dispositivo, armazená-los e retirá-los de lá, ou apenas ver os gráficos. Uma API para enviar dados para a nuvem está </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anexada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para um início rápido, gravamos um pequeno vídeo:</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://www.youtube.com/embed/6DYfGsqQzCg%3Ffeature%3Doembed&amp;usg=ALkJrhilGUSv6BuWVj8TdaYkc2CXBZOkFw" frameborder="0" allowfullscreen=""></iframe><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa. se você precisar, por exemplo, monitorar a temperatura no apartamento, precisará fazer quase nada. Basta conectar um sensor de temperatura ao ESP, escrever um "driver" (ou preparar um) no JS, registrar-se na nuvem, escrever um pequeno script que leia a temperatura e o envie para a nuvem. E então vá ao site e veja o gráfico. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Obviamente, o firmware funcionará sem uma nuvem. Mas é mais conveniente com a nuvem, parte do trabalho de rotina é cortada. Há um link para a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nuvem</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no github </font><font style="vertical-align: inherit;">e, se você tiver uma conta no github ou no G +, o registro nela caberá em alguns cliques.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, se você não tiver algumas funções, poderá sempre usar C. Você pode simplesmente escrever novas funcionalidades em C sem precisar associá-las ao JS. Ao mesmo tempo, continuará sendo possível usar quase todas as APIs que são (na maioria dos casos, a API JS é um invólucro fino sobre as funções syshny); além disso, você pode usar as funções ESP SDK. Não é </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">difícil</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> montar o firmware a partir da fonte </font><font style="vertical-align: inherit;">, graças à presença de imagens do docker. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você pode expandir JS. Para fazer isso, escrevemos a funcionalidade necessária em C e a disponibilizamos em JS. Isso também </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">não é difícil</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para quem lida com o ESP8266, o Smart.js será semelhante ao NodeMCU. Não vou discutir - enquanto parece. Mas temos grandes planos para o desenvolvimento do Smart.js e para a portabilidade para outros dispositivos, portanto, com o tempo, acho, haverá menos semelhanças. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Falando em nossos planos. Agora, o status do Smart.js é ALPHA 1. A próxima versão está agendada para o outono (o que, é claro, não interfere com aqueles que desejam montar o firmware a partir das fontes com qualquer frequência). No outono, aumentaremos a quantidade de memória disponível para o usuário, atualizaremos os scripts da nuvem (ou seja, teoricamente seria possível nunca conectar o ESP8266 ao computador), tornaremos a porta para outras plataformas etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E agora é importante receber um feedback. Você gosta disso? O que está faltando? O que é supérfluo? Tudo é interessante!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então - faça o download do firmware - experimente, seremos felizes. </font><font style="vertical-align: inherit;">Licença dupla, GPLv2 para todos os interessados ​​e comercial para aqueles que não possuem a GPL e / ou precisam de suporte.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt382189/">https://habr.com/ru/post/pt382189/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt382179/index.html">Abrigo Fallout para Android OS aparecerá em 13 de agosto</a></li>
<li><a href="../pt382181/index.html">JiT-JiS SCM ou "Como os carros fazem isso"</a></li>
<li><a href="../pt382183/index.html">Apple получила патент на биометрический пульт для умного дома</a></li>
<li><a href="../pt382185/index.html">4 tecnologias para ajudar a salvar os oceanos</a></li>
<li><a href="../pt382187/index.html">Revisão do monitor sem moldura EIZO Foris FS2434</a></li>
<li><a href="../pt382191/index.html">Kepler-452b. Outro "duplo" da Terra na constelação de Cygnus. O primeiro exoplaneta cuja existência é considerada comprovada</a></li>
<li><a href="../pt382193/index.html">China colocou em órbita mais dois satélites de navegação para o sistema BeiDou</a></li>
<li><a href="../pt382195/index.html">Jornalistas-robôs: Algoritmos são mais uma ferramenta do que uma ameaça</a></li>
<li><a href="../pt382199/index.html">Por que o exoplaneta encontrado da NASA não é um evento tão bom</a></li>
<li><a href="../pt382201/index.html">Os 7 melhores fóruns de quadrotor, blogs e canais do YouTube</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>