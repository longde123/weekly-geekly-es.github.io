<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßñ üåº üëÜüèª Monitoramento de temperatura certificado ü¶î üë©üèª‚Äçüé® ü§öüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nossa empresa utiliza um sistema de gerenciamento da qualidade (SGQ). Como parte de uma certifica√ß√£o ISO: 9001, foi solicitada a coleta de leituras de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monitoramento de temperatura certificado</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470267/">  Nossa empresa utiliza um sistema de gerenciamento da qualidade (SGQ).  Como parte de uma certifica√ß√£o ISO: 9001, foi solicitada a coleta de leituras de temperatura e umidade em algumas salas, por exemplo, na sala do servidor ou em armaz√©ns. <br><br>  Porque  Como todos os procedimentos burocr√°ticos exigem peda√ßos de papel, a coleta de dados deve ser realizada por um dispositivo verificado. <br><br>  Nesse sentido, o higr√¥metro mais comum foi enforcado e, durante v√°rios anos, as pessoas escreveram evid√™ncias di√°rias em um di√°rio.  Concordo, desconfort√°vel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jj/9j/ct/jj9jctuhgtvzcrraj130gdtlvw8.jpeg"></div><a name="habracut"></a><br>  Para automatizar esse procedimento, foi iniciada a busca por um dispositivo para coletar temperatura e umidade. <br><br>  O objetivo era, de alguma forma, coletar dados e transferir tudo para o Zabbix.  (Zabbix, nenhum local de armazenamento n√£o √© necess√°rio para o QMS, mas eu n√£o queria criar outro sistema separado para monitoramento de temperatura). <br><br>  Em princ√≠pio, havia muitos kits prontos para isso, por exemplo, Equicom PING3 ou rede, e ainda existem muitos exemplos. Voc√™ tamb√©m pode criar seu sistema em arduino ou framboesa, <br>  mas todas essas op√ß√µes n√£o se encaixam porque  todos eles n√£o possuem certifica√ß√£o ou verifica√ß√£o metrol√≥gica e, portanto, n√£o podem ser considerados instrumentos oficiais de medi√ß√£o e n√£o s√£o adequados para a aprova√ß√£o da ISO: 9001. <br><br>  Como resultado, foi encontrado um dispositivo capaz de transmitir dados via Ethernet e inclu√≠do no registro de instrumentos de medi√ß√£o.  Acabou sendo "Ivit-M.E".  desenvolvido em Novosibirsk, tamb√©m produzido l√°.  Pedido (a prop√≥sito, o pedido leva muito tempo. O tempo de produ√ß√£o √© de cerca de um m√™s, mais a verifica√ß√£o e a entrega a Moscou). <br><br>  Tudo isso vem nesta forma.  Ao busc√°-lo, voc√™ imediatamente percebe que esta √© uma produ√ß√£o russa :-) <br><br><img src="https://habrastorage.org/webt/9u/jk/mm/9ujkmmy75n9dcyue1iooepwvjy0.jpeg"><br><br><img src="https://habrastorage.org/webt/i3/vz/qw/i3vzqwl5ma_-zf8drk3wqcfgwdk.jpeg"><br><br>  A fonte de alimenta√ß√£o (solicitada separadamente) n√£o est√° conectada ao sensor. <br><br>  Portanto, desmontamos e come√ßamos a conectar. <br><br><img src="https://habrastorage.org/webt/rv/qj/my/rvqjmyg8w6aa-xh0_ikm2lyjcao.jpeg"><br><br><img src="https://habrastorage.org/webt/if/hj/f_/ifhjf_9isaqmdaxdb67aa7qwxaw.jpeg"><br><br>  N√≥s conectamos a entrada de qualquer maneira.  Corrente alternada.  Eu usei um cabo de alimenta√ß√£o regular de um computador. <br><br>  A sa√≠da √© de corrente cont√≠nua.  Mais e menos s√£o assinados diretamente no quadro. <br><br>  Em seguida, conectamos os fios diretamente ao pr√≥prio sensor.  De acordo com as instru√ß√µes <br><br><img src="https://habrastorage.org/webt/xb/qx/us/xbqxusu7jvesq9svw960mq-pd5k.jpeg"><br><br>  Os pr√≥prios terminais s√£o assim: <br><br><img src="https://habrastorage.org/webt/s8/tk/r6/s8tkr6huza-zgrm1eabxt5y5n5y.jpeg"><br><br><img src="https://habrastorage.org/webt/ur/xr/3d/urxr3disznpftdmba3jsqxrwigc.jpeg"><br><br>  Desligue, remova e retire o revestimento da metade em forma de L. <br>  Conectamos energia e rede. <br><br><img src="https://habrastorage.org/webt/bs/xn/ca/bsxncadqz9e4jtpmjazgquvdup4.jpeg"><br><br>  O resultado √© algo como isto: <br><br><img src="https://habrastorage.org/webt/et/pc/4z/etpc4zrfp4w8dmow-d5xczmdzoi.jpeg"><br><br>  Das desvantagens deste dispositivo - ele n√£o sabe como enviar dados via SNMP, ele funciona usando o protocolo Modbus. <br><br>  Em princ√≠pio, existem muitos sistemas SCADA e servidores OPC que podem ler via Modbus, mas a maioria deles √© paga ou coletada em algum banco de dados pr√≥prio, do qual tamb√©m n√£o est√° claro como extrair dados para transmiss√£o aos futuros zabbiks. <br><br>  Portanto, um pequeno script python foi gravado para acessar diretamente o sensor. <br>  Os dados nos registros s√£o armazenados na forma de um flutuador e v√™m ao acess√°-los neste formul√°rio <br><br><pre><code class="plaintext hljs">READ_INPUT_REGISTERS (16855, 57976)</code> </pre> <br>  Para configurar o sensor, h√° um aplicativo config-ivit.exe <br><br>  N√£o h√° muitas configura√ß√µes l√°.  Voc√™ pode configurar a rede, correio. <br><br><img src="https://habrastorage.org/webt/mi/ru/43/miru43odnhhe8akvavumircfave.jpeg"><br><br>  no configurador, os registradores s√£o especificados no sistema hexadecimal, mas no script Python, voc√™ precisa especificar os registradores no sistema de 10 casas decimais. <br><br>  Trazemos os dados para um formato leg√≠vel normal, de acordo com o padr√£o ieee-754. <br><br>  Existem duas maneiras de implementar a transfer√™ncia de dados recebidos do script para o zabbix. <br><br>  A primeira maneira: usando userparametr, em algum n√≥ em que o agente python e zabbiks est√° instalado.  Por exemplo, eu tinha no pr√≥prio servidor zabbix. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk.defines <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cst <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk.modbus_tcp <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> modbus_tcp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_reg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reg,ip)</span></span></span><span class="hljs-function">:</span></span> reg = int(reg) master = modbus_tcp.TcpMaster(host=ip, port=int(<span class="hljs-number"><span class="hljs-number">502</span></span>)) master.set_timeout(<span class="hljs-number"><span class="hljs-number">1.0</span></span>) getDI = master.execute(<span class="hljs-number"><span class="hljs-number">1</span></span>,cst.READ_INPUT_REGISTERS, reg, <span class="hljs-number"><span class="hljs-number">2</span></span>) Num1 = str(bin(getDI[<span class="hljs-number"><span class="hljs-number">0</span></span>]))[<span class="hljs-number"><span class="hljs-number">2</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(Num1) &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>: Num1 = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + Num1 Num2 = str(bin(getDI[<span class="hljs-number"><span class="hljs-number">1</span></span>]))[<span class="hljs-number"><span class="hljs-number">2</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(Num2) &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>: Num2 = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + Num2 res = Num1 + Num2 znak = int(res[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) znak2 = (<span class="hljs-number"><span class="hljs-number">0</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) ** znak e = int(res[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">9</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) - <span class="hljs-number"><span class="hljs-number">127</span></span> exp = <span class="hljs-number"><span class="hljs-number">2</span></span> ** e m = <span class="hljs-number"><span class="hljs-number">1</span></span> + (int(res[<span class="hljs-number"><span class="hljs-number">9</span></span>:], <span class="hljs-number"><span class="hljs-number">2</span></span>) / float(<span class="hljs-number"><span class="hljs-number">2</span></span> ** <span class="hljs-number"><span class="hljs-number">23</span></span>)) F = znak2 * exp * m print(round(F, <span class="hljs-number"><span class="hljs-number">1</span></span>)) check_reg(sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>],sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>])</code> </pre><br>  No lado do zabbix em zabbix_agentd.conf, especifique: <br><br><pre> <code class="plaintext hljs">UserParameter=check_reg[*], /usr/bin/python /home/appliance/scada.py $1 $2</code> </pre> <br>  No pr√≥prio zabbix, precisaremos transferir apenas o n√∫mero de registro e o endere√ßo IP do dispositivo para o qual queremos entrar em contato: <br><br>  por exemplo: <code>check_reg[22,192.168.100.100]</code> <br><br>  N√∫meros de registro: <br><br>  22 - Umidade <br>  34 - Temperatura <br>  36 - ponto de orvalho <br><br>  A segunda maneira: passar valores pelo zabbix_sender.  Esse m√©todo √© conveniente, pois voc√™ pode criar um n√≥ de rede separado que n√£o possui um agente e, portanto, ser√° poss√≠vel criar um modelo para muitos dispositivos. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk.defines <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cst <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk.modbus_tcp <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> modbus_tcp <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys, os <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_reg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reg,ip)</span></span></span><span class="hljs-function">:</span></span> reg = int(reg) master = modbus_tcp.TcpMaster(host=ip, port=int(<span class="hljs-number"><span class="hljs-number">502</span></span>)) master.set_timeout(<span class="hljs-number"><span class="hljs-number">1.0</span></span>) getDI = master.execute(<span class="hljs-number"><span class="hljs-number">1</span></span>,cst.READ_INPUT_REGISTERS, reg, <span class="hljs-number"><span class="hljs-number">2</span></span>) Num1 = str(bin(getDI[<span class="hljs-number"><span class="hljs-number">0</span></span>]))[<span class="hljs-number"><span class="hljs-number">2</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(Num1) &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>: Num1 = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + Num1 Num2 = str(bin(getDI[<span class="hljs-number"><span class="hljs-number">1</span></span>]))[<span class="hljs-number"><span class="hljs-number">2</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(Num2) &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>: Num2 = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + Num2 res = Num1 + Num2 znak = int(res[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) znak2 = (<span class="hljs-number"><span class="hljs-number">0</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) ** znak e = int(res[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">9</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) - <span class="hljs-number"><span class="hljs-number">127</span></span> exp = <span class="hljs-number"><span class="hljs-number">2</span></span> ** e m = <span class="hljs-number"><span class="hljs-number">1</span></span> + (int(res[<span class="hljs-number"><span class="hljs-number">9</span></span>:], <span class="hljs-number"><span class="hljs-number">2</span></span>) / float(<span class="hljs-number"><span class="hljs-number">2</span></span> ** <span class="hljs-number"><span class="hljs-number">23</span></span>)) F = znak2 * exp * m <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> round(F, <span class="hljs-number"><span class="hljs-number">1</span></span>) os.system(<span class="hljs-string"><span class="hljs-string">'zabbix_sender -z 127.0.0.1 -s '</span></span>+ sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>]+<span class="hljs-string"><span class="hljs-string">' -k Humidity -o '</span></span>+ str(check_reg(<span class="hljs-number"><span class="hljs-number">22</span></span>,sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>]))) os.system(<span class="hljs-string"><span class="hljs-string">'zabbix_sender -z 127.0.0.1 -s '</span></span>+sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>]+<span class="hljs-string"><span class="hljs-string">' -k Temper -o '</span></span>+ str(check_reg(<span class="hljs-number"><span class="hljs-number">34</span></span>,sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>]))) os.system(<span class="hljs-string"><span class="hljs-string">'zabbix_sender -z 127.0.0.1 -s '</span></span>+sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>]+<span class="hljs-string"><span class="hljs-string">' -k Rosa -o '</span></span>+ str(check_reg(<span class="hljs-number"><span class="hljs-number">36</span></span>,sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>])))</code> </pre><br>  Tudo o que resta √© executar esse script para executar na coroa, especificando apenas o endere√ßo IP dos dispositivos e o nome do host <br><br><pre> <code class="plaintext hljs">*/1 * * * * /home/ivitsender.py 192.168.100.100 Ivit1</code> </pre> <br><pre> <code class="plaintext hljs">*/1 * * * * /home/ivitsender.py 192.168.100.200 Ivit2</code> </pre> <br><br>  Em seguida, configure os gatilhos, que s√£o considerados cr√≠ticos para n√≥s.  Por exemplo, temperatura m√≠nima ou m√°xima, umidade. <br><br>  Isso √© tudo.  Assim, obtivemos monitoramento de temperatura certificado, adequado para a passagem pelo SGQ e pela ISO: 9001 <br><br>  <b>UPD:</b> Atualizado o script a ser enviado via remetente para conectar-se a v√°rios sensores </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt470267/">https://habr.com/ru/post/pt470267/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt470251/index.html">Como fiz um aplicativo de desktop no Flutter (+ b√¥nus)</a></li>
<li><a href="../pt470255/index.html">Otimiza√ß√£o do portf√≥lio de t√≠tulos usando ALGLIB</a></li>
<li><a href="../pt470257/index.html">Manto em torno do ImmutableList em Java</a></li>
<li><a href="../pt470259/index.html">Aimybox na pesquisa: a estrutura para criar assistentes de voz precisa de um assistente para iOS</a></li>
<li><a href="../pt470265/index.html">Folha de dicas da abrevia√ß√£o de C ++ e muito mais. Parte 1: C ++</a></li>
<li><a href="../pt470269/index.html">ReactOS 0.4.12: Âçé‰∏∫ Ôºå ‰Ω† ËÆ§‰∏∫ Ëøô‰∏™ ÊÄé‰πà Ê†∑Ôºü</a></li>
<li><a href="../pt470271/index.html">F # 6: Tuplas</a></li>
<li><a href="../pt470273/index.html">F # 7: Registros</a></li>
<li><a href="../pt470275/index.html">F # 8: Uni√µes Discriminadas</a></li>
<li><a href="../pt470277/index.html">Como √© organizada e organizada a rede global na Federa√ß√£o Russa?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>