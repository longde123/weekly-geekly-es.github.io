<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è∏Ô∏è „äôÔ∏è üçù Node.js Protokollierungshandbuch üêÄ üôÉ üè£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die erste Aufgabe, mit der Entwickler am h√§ufigsten konfrontiert sind, wenn sie mit der Programmierung in JavaScript beginnen, ist das Protokollieren ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Node.js Protokollierungshandbuch</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/461881/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/o7/dd/qs/o7ddqsvqk7dz2uljo7mz4e-ox2o.png"></div><br>  Die erste Aufgabe, mit der Entwickler am h√§ufigsten konfrontiert sind, wenn sie mit der Programmierung in JavaScript beginnen, ist das Protokollieren von Ereignissen im Konsolenprotokoll mithilfe der Methode <code>console.log</code> .  Auf der Suche nach Informationen zum Debuggen von JavaScript-Code finden Sie Hunderte von Blog-Artikeln sowie Anweisungen zu StackOverflow, in denen Sie aufgefordert werden, Daten √ºber die <code>console.log</code> Methode ‚Äûeinfach‚Äú an die Konsole <code>console.log</code> .  Dies ist eine so √ºbliche Praxis, dass ich Regeln f√ºr die Codequalit√§tskontrolle einf√ºhren musste, z. B. <code>no-console</code> , um keine zuf√§lligen Protokolleintr√§ge im Produktionscode zu hinterlassen.  Was aber, wenn Sie eine Veranstaltung speziell registrieren m√ºssen, um zus√§tzliche Informationen bereitzustellen? <br><br>  Dieser Artikel beschreibt verschiedene Situationen, in denen Sie Protokolle verwalten m√ºssen.  Es zeigt den Unterschied zwischen den Methoden <code>console.log</code> und <code>console.error</code> in Node.js und zeigt, wie die Protokollierungsfunktion an Bibliotheken √ºbergeben wird, ohne die Benutzerkonsole zu √ºberlasten. <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/fl/st/fl/flstflpirz79u4y-4nc0ot6yroe.png"><br><br><h3>  Theoretische Grundlagen der Arbeit mit Node.js. </h3><br>  Die Methoden <code>console.log</code> und <code>console.error</code> k√∂nnen sowohl im Browser als auch in Node.js verwendet werden.  Bei der Verwendung von Node.js ist jedoch eines zu beachten.  Wenn Sie den folgenden Code in Node.js mit einer Datei namens <code>index.js</code> , <br><br><img src="https://habrastorage.org/webt/9d/f8/fr/9df8fr10y-luiwbcqp6kizl8-ce.png"><br><br>  und f√ºhren Sie es dann im Terminal mit dem <code>node index.js</code> . Die Ergebnisse der Befehlsausf√ºhrung befinden sich √ºbereinander: <br><br><img src="https://habrastorage.org/webt/rf/n_/wi/rfn_wioub6pircw7tcrgvmt8g4w.png"><br><br>  Trotz der Tatsache, dass sie √§hnlich erscheinen, verarbeitet das System sie unterschiedlich.  Wenn Sie sich den Abschnitt √ºber den <code>console</code> in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Node.js-Dokumentation</a> <code>console.log</code> , stellt sich heraus, dass <code>console.log</code> das Ergebnis √ºber <code>stdout</code> und <code>console.error</code> √ºber <code>stderr</code> druckt. <br><br>  Jeder Prozess kann standardm√§√üig mit drei Streams ( <code>stream</code> ) arbeiten: <code>stdin</code> , <code>stdout</code> und <code>stderr</code> .  Der <code>stdin</code> Stream verarbeitet Eingaben f√ºr einen Prozess, z. B. Tastenklicks oder umgeleitete Ausgaben (mehr dazu weiter unten).  Der Standard-Standardausgabestream dient zur Ausgabe von Anwendungsdaten.  Schlie√ülich ist der Standard- <code>stderr</code> Fehlerstrom so ausgelegt, dass Fehlermeldungen angezeigt werden.  Wenn Sie herausfinden <code>stderr</code> , wof√ºr <code>stderr</code> und wann Sie es verwenden sollen, lesen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesen Artikel</a> . <br><br>  Kurz gesagt, es kann verwendet werden, um die Operatoren Umleitung ( <code>&gt;</code> ) und Pipeline ( <code>|</code> ) zu verwenden, um mit Fehlern und Diagnoseinformationen getrennt von den tats√§chlichen Ergebnissen der Anwendung zu arbeiten.  Wenn Sie mit dem Operator <code>&gt;</code> die Ausgabe des Befehlsergebnisses in eine Datei umleiten k√∂nnen, k√∂nnen Sie mit dem Operator <code>2&gt;</code> die Ausgabe des <code>stderr</code> Fehlerstroms in eine Datei umleiten.  Dieser Befehl sendet beispielsweise <i>Hello</i> an die Datei <code>hello.log</code> und <i>Bye bye</i> an die Datei <code>error.log</code> . <br><br><img src="https://habrastorage.org/webt/cf/xm/se/cfxmsetuf_6ohz4zqoeg_oqsojw.png"><br><br><img src="https://habrastorage.org/webt/ve/ji/i0/vejii0f6_q4zhetko-f9bg1pozy.png"><br><br><h3>  Wann muss ich Ereignisse in das Protokoll schreiben? </h3><br>  Nachdem wir die technischen Aspekte der Protokollierung √ºberpr√ºft haben, gehen wir zu verschiedenen Szenarien √ºber, in denen Sie Ereignisse registrieren m√ºssen.  In der Regel fallen diese Szenarien in eine von mehreren Kategorien: <br><br><ul><li>  schnelles Debuggen bei unerwartetem Verhalten w√§hrend der Entwicklung; </li><li>  browserbasierte Protokollierung zur Analyse und Diagnose; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Protokollierung f√ºr Serveranwendungen</a> zur Registrierung eingehender Anforderungen und m√∂glicher Fehler; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verwalten zus√§tzlicher Debug-Protokolle f√ºr Bibliotheken</a> , um Benutzern bei der L√∂sung von Problemen zu helfen; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Protokollierung f√ºr die Ausgabe der Befehlszeilenschnittstelle</a> und Anzeige von Meldungen in der Konsole √ºber den Fortschritt des Vorgangs, Best√§tigungen und Fehler. </li></ul><br>  Dieser Artikel beschreibt nur die letzten drei Szenarien, die auf Node.js basieren. <br><br><h3>  Protokollierung f√ºr Serveranwendungen </h3><br>  Es gibt mehrere Gr√ºnde f√ºr die Protokollierung von Ereignissen, die auf dem Server auftreten.  Wenn Sie beispielsweise eingehende Anforderungen protokollieren, k√∂nnen Sie Statistiken dar√ºber abrufen, wie oft Benutzer auf 404-Fehler sto√üen, was der Grund daf√ºr sein k√∂nnte oder welche <code>User-Agent</code> Clientanwendung verwendet wird.  Sie k√∂nnen auch den Zeitpunkt und die Ursache des Fehlers ermitteln. <br><br>  Um mit dem in diesem Teil des Artikels angegebenen Material zu experimentieren, m√ºssen Sie einen neuen Katalog f√ºr das Projekt erstellen.  Erstellen <code>index.js</code> im Projektverzeichnis <code>index.js</code> f√ºr den zu verwendenden Code und f√ºhren Sie die folgenden Befehle aus, um das Projekt zu starten und <code>express</code> installieren: <br><br><img src="https://habrastorage.org/webt/ma/sw/qo/maswqo4k3lr9my_vnkcmrksqxme.png"><br><br>  Wir haben einen Server mit Middleware eingerichtet, der jede Anforderung in der Konsole mithilfe der <code>console.log</code> Methode <code>console.log</code> .  Wir <code>index.js</code> die folgenden Zeilen in die Datei <code>index.js</code> : <br><br><img src="https://habrastorage.org/webt/pr/y5/js/pry5js_udhlcqeurmmwyld57zky.png"><br><br>  Dies verwendet <code>console.log('%O', req)</code> , um das gesamte Objekt im Protokoll zu protokollieren.  Aus Sicht der internen Struktur verwendet die Methode <code>util.forma</code> t, das neben <code>%O</code> auch andere Platzhalter unterst√ºtzt.  Informationen dazu finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation zu Node.js.</a> <br><br>  Wenn Sie den <code>node index.js</code> ausf√ºhren, um den Server zu starten und zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">localhost</a> : 3000 zu wechseln, zeigt die Konsole viele unn√∂tige Informationen an: <br><br><img src="https://habrastorage.org/webt/qy/c1/ta/qyc1ta1h1em_xkl0f9683zvesfe.png"><br><br>  Wenn Sie stattdessen <code>console.log('%s', req)</code> , um das Objekt nicht vollst√§ndig anzuzeigen, erhalten Sie nicht viele Informationen: <br><br><img src="https://habrastorage.org/webt/ru/ew/kz/ruewkz1ihxicigymk_oqta9s9gc.png"><br><br>  Sie k√∂nnen Ihre eigene Protokollierungsfunktion schreiben, die nur die erforderlichen Daten ausgibt. Zun√§chst m√ºssen Sie jedoch entscheiden, welche Informationen ben√∂tigt werden.  Trotz der Tatsache, dass der Fokus normalerweise auf dem Inhalt der Nachricht liegt, ist es in der Realit√§t h√§ufig erforderlich, zus√§tzliche Informationen zu erhalten, darunter: <br><br><ul><li>  Zeitstempel - um zu wissen, wann Ereignisse aufgetreten sind; </li><li>  Computer- / Servername - wenn ein verteiltes System ausgef√ºhrt wird; </li><li>  Prozesskennung - wenn mehrere <code>pm2</code> ausgef√ºhrt werden, z. B. <code>pm2</code> ; </li><li>  Nachricht - eine tats√§chliche Nachricht mit einigen Inhalten; </li><li>  Stack-Trace - wenn ein Fehler protokolliert wird; </li><li>  zus√§tzliche Variablen / Informationen. </li></ul><br>  Da in jedem Fall alles in die Streams <code>stdout</code> und <code>stderr</code> ausgegeben wird, muss ein Journal auf verschiedenen Ebenen gef√ºhrt und Journaleintr√§ge je nach Ebene konfiguriert und gefiltert werden. <br><br>  Dies kann erreicht werden, indem Sie Zugriff auf verschiedene Teile des <code>process</code> und mehrere Codezeilen in JavaScript schreiben.  Node.js ist jedoch insofern bemerkenswert, als es bereits √ºber ein <code>npm</code> √ñkosystem und mehrere Bibliotheken verf√ºgt, die f√ºr diese Zwecke verwendet werden k√∂nnen.  Dazu geh√∂ren: <br><br><ul><li>  <code>pino</code> ; </li><li>  <code>winston</code> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">br√ºllen</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bunyan</a> (diese Bibliothek wurde seit zwei Jahren nicht mehr aktualisiert). </li></ul><br>  Pino wird oft bevorzugt, weil es schnell ist und ein eigenes √ñkosystem hat.  Mal sehen, wie <code>pino</code> bei der Protokollierung helfen kann.  Ein weiterer Vorteil dieser Bibliothek ist das <code>express-pino-logger</code> Paket, mit dem Sie Anforderungen registrieren k√∂nnen. <br><br>  Installieren Sie <code>pino</code> und <code>express-pino-logger</code> : <br><br><img src="https://habrastorage.org/webt/nq/j_/jq/nqj_jqvxgyqqdmfgydf9740la-y.png"><br><br>  Danach aktualisieren wir die Datei <code>index.js</code> , um den Ereignisprotokollierer und die Middleware zu verwenden: <br><br><img src="https://habrastorage.org/webt/qw/ge/sq/qwgesqqth2bnxd447led_m35ud8.png"><br><br>  In diesem Fragment haben wir eine Instanz des Ereignisprotokollierers f√ºr <code>pino</code> und an <code>express-pino-logger</code> , um eine neue plattform√ºbergreifende Ereignisprotokollierungssoftware zu erstellen, mit der Sie <code>app.use</code> aufrufen <code>app.use</code> .  Au√üerdem wurde <code>console.log</code> bei <code>logger.info</code> durch <code>logger.info</code> und <code>logger.debug</code> zur Route hinzugef√ºgt, um verschiedene Ebenen des Protokolls anzuzeigen. <br><br>  Wenn Sie den Server durch wiederholtes Ausf√ºhren von <code>node index.js</code> , erhalten Sie an der Ausgabe ein anderes Ergebnis, bei dem jede Zeile / Zeile im JSON-Format ausgegeben wird.  Gehen Sie erneut zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">localhost</a> : 3000, um eine weitere neue Zeile im JSON-Format anzuzeigen. <br><br><img src="https://habrastorage.org/webt/tr/mh/0v/trmh0vi7-h9khu3355byqn5s-pg.png"><br><br>  Unter den Daten im JSON-Format finden Sie die zuvor genannten Informationen, z. B. einen Zeitstempel.  Beachten Sie auch, dass die Meldung <code>logger.debug</code> nicht angezeigt wurde.  Um es sichtbar zu machen, m√ºssen Sie die Standardprotokollstufe √§ndern.  Nach dem Erstellen einer Instanz der Logger-Ereignisregistrierung wurde der Wert <code>process.env.LOG_LEVEL</code> festgelegt.  Dies bedeutet, dass Sie den Wert √§ndern oder den Standardinfowert akzeptieren k√∂nnen.  <code>LOG_LEVEL=debug node index.js</code> Ausf√ºhren von <code>LOG_LEVEL=debug node index.js</code> √§ndern wir die Protokollstufe. <br><br>  Zuvor muss das Problem des Ausgabeformats gel√∂st werden, das derzeit f√ºr die Wahrnehmung nicht sehr praktisch ist.  Dieser Schritt ist beabsichtigt.  Gem√§√ü der <code>pino</code> Philosophie ist es aus Leistungsgr√ºnden erforderlich, die Verarbeitung von Journaleintr√§gen in einen separaten Prozess zu √ºbertragen und die Ausgabe (unter Verwendung des Operators <code>|</code> ) zu √ºbergeben.  Der Prozess umfasst das √úbersetzen der Ausgabe in ein f√ºr die menschliche Wahrnehmung geeigneteres Format oder das Hochladen in die Cloud.  Diese Aufgabe wird von Transferwerkzeugen ausgef√ºhrt, die als <code>transports</code> .  Lesen Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> zum <code>transports</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Toolkit nach,</a> warum <code>pino</code> Fehler nicht √ºber <code>stderr</code> ausgegeben werden. <br><br>  Verwenden Sie das <code>pino-pretty</code> Tool, um eine besser lesbare Version des Magazins anzuzeigen.  Im Terminal ausf√ºhren: <br><br><img src="https://habrastorage.org/webt/yi/-b/v6/yi-bv6ct4r1zozscacob9xp5urc.png"><br><br>  Alle Protokolleintr√§ge werden mit dem <code>|</code>  zur Verf√ºgung von <code>pino-pretty</code> , wodurch die Ausgabe "gel√∂scht" wird, die nur wichtige Informationen enth√§lt, die in verschiedenen Farben angezeigt werden.  Wenn Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">localhost</a> : 3000 erneut abfragen, sollte eine <code>debug</code> Debugging-Meldung angezeigt werden. <br><br><img src="https://habrastorage.org/webt/_p/lb/w1/_plbw1wcxgonrmw4lsyt5ls7cka.png"><br><br>  Um Journaleintr√§ge besser lesbar zu machen oder zu konvertieren, gibt es viele √úbertragungswerkzeuge.  Sie k√∂nnen sogar mit Emojis mit <code>pino-colada</code> angezeigt werden.  Diese Tools sind n√ºtzlich f√ºr die lokale Entwicklung.  Wenn der Server in Produktion ist, m√ºssen Sie m√∂glicherweise Protokolldaten mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einem anderen Tool √ºbertragen</a> , zur weiteren Verarbeitung mit <code>&gt;</code> auf die Festplatte schreiben oder zwei Vorg√§nge gleichzeitig mit einem bestimmten Befehl ausf√ºhren, z. B. <code>tee</code> . <br><br>  Das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokument behandelt</a> auch das Drehen von Protokolldateien, das Filtern und Schreiben von Protokolldaten in andere Dateien. <br><br><h3>  Bibliotheksjournal </h3><br>  Indem Sie nach M√∂glichkeiten suchen, die Protokollierung f√ºr Serveranwendungen effizient zu organisieren, k√∂nnen Sie dieselbe Technologie f√ºr Ihre eigenen Bibliotheken verwenden. <br><br>  Das Problem ist, dass Sie im Fall der Bibliothek m√∂glicherweise ein Protokoll f√ºr Debugging-Zwecke f√ºhren m√ºssen, ohne die Client-Anwendung zu laden.  Im Gegenteil, der Client sollte in der Lage sein, das Protokoll zu aktivieren, wenn ein Debugging erforderlich ist.  Standardm√§√üig sollte die Bibliothek keine Ausgabe aufzeichnen, wodurch der Benutzer dieses Recht erh√§lt. <br><br>  Ein gutes Beispiel hierf√ºr ist das <code>express</code> Framework.  Viele Prozesse finden in der internen Struktur des <code>express</code> Frameworks statt, was das Interesse wecken kann, es w√§hrend des Debuggens von Anwendungen eingehender zu untersuchen.  In der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation zum</a> <code>express</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Framework</a> hei√üt es, dass Sie <code>DEBUG=express:*</code> am Anfang des Befehls wie folgt hinzuf√ºgen k√∂nnen: <br><br><img src="https://habrastorage.org/webt/ts/ht/a9/tshta9wjl_atyr3wrm11i11fuzu.png"><br><br>  Wenn Sie diesen Befehl auf eine vorhandene Anwendung anwenden, werden viele zus√§tzliche Ausgaben angezeigt, die beim Debuggen hilfreich sind: <br><br><img src="https://habrastorage.org/webt/tn/ea/pl/tneaplymuzok_eenshb-zv50oiq.png"><br><br>  Diese Informationen k√∂nnen nur angezeigt werden, wenn das Debug-Protokoll aktiviert ist.  <code>debug</code> gibt es ein <code>debug</code> Paket.  Es kann verwendet werden, um Nachrichten in den "Namespace" zu schreiben. Wenn der Bibliotheksbenutzer diesen Namespace oder einen Platzhalter, der mit ihm √ºbereinstimmt, in seine <code>DEBUG</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Umgebungsvariable einf√ºgt</a> , werden die Nachrichten angezeigt.  Zuerst m√ºssen Sie die <code>debug</code> Bibliothek installieren: <br><br><img src="https://habrastorage.org/webt/gi/4h/mp/gi4hmppeawcqdpwsncu3g5rqlzs.png"><br><br>  Erstellen Sie eine neue Datei mit dem Namen <code>random-id.j</code> s, die die Bibliothek simuliert, und <code>random-id.j</code> den folgenden Code ein: <br><br><img src="https://habrastorage.org/webt/le/fq/cn/lefqcnt7-3nft1klqsjuugnkupa.png"><br><br>  Als Ergebnis wird ein neuer <code>debug</code> Ereignisprotokollierer mit dem <code>mylib:randomid</code> , in dem dann zwei Nachrichten registriert werden.  Wir verwenden es in <code>index.js</code> aus dem vorherigen Abschnitt: <br><br><img src="https://habrastorage.org/webt/bb/cj/ja/bbcjjan7ygf-9z26w8etpccfx8o.png"><br><br>  Wenn Sie den Server erneut starten und diesmal <code>DEBUG=mylib:randomid node index.js</code> , werden die Debug-Protokolleintr√§ge f√ºr unsere "Bibliothek" angezeigt: <br><br><img src="https://habrastorage.org/webt/fg/3c/8t/fg3c8tejhceciqntzcb-a1n2xd4.png"><br><br>  Wenn Bibliotheksbenutzer Debug-Informationen in <code>pino</code> Protokolleintr√§ge <code>pino</code> m√∂chten, k√∂nnen sie eine vom Befehl <code>pino-debug</code> erstellte Bibliothek namens <code>pino-debug</code> , um diese Eintr√§ge korrekt zu formatieren. <br><br>  Installieren Sie die Bibliothek: <br><br><img src="https://habrastorage.org/webt/wg/dh/y1/wgdhy11xkqt-e8csfhcrjcctkl8.png"><br><br>  Vor der ersten Verwendung von <code>debug</code> muss <code>pino-debug</code> initialisiert werden.  Der einfachste Weg, dies zu tun, besteht darin, die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Flags</a> <code>-r</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">oder</a> <code>--require</code> zu verwenden, um ein Modul anzufordern, bevor das Skript ausgef√ºhrt wird.  Wir starten den Server mit dem Befehl neu (vorausgesetzt, <code>pino-colada</code> installiert): <br><br><img src="https://habrastorage.org/webt/l-/ug/yn/l-ugyn16-kzn1hhye_zus2adfkk.png"><br><br>  Infolgedessen werden die Debug-Protokolleintr√§ge der Bibliothek auf dieselbe Weise wie im Anwendungsprotokoll angezeigt: <br><br><img src="https://habrastorage.org/webt/-y/n8/7e/-yn87ertfjgensbyew95aaz8f7y.png"><br><br><h3>  Ausgabe der Befehlszeilenschnittstelle (CLI) </h3><br>  Der letzte Fall, den dieser Artikel behandelt, ist die Protokollierung f√ºr die Befehlszeilenschnittstelle.  Vorzugsweise wird das Protokoll, das Ereignisse im Zusammenhang mit der Programmlogik aufzeichnet, vom Protokoll zum Registrieren von Befehlszeilenschnittstellendaten getrennt gehalten.  Um Ereignisse im Zusammenhang mit der Programmlogik aufzuzeichnen, m√ºssen Sie eine bestimmte Bibliothek verwenden, z. B. <code>debug</code> .  In diesem Fall k√∂nnen Sie die Programmlogik √ºber die Befehlszeilenschnittstelle wiederverwenden, ohne auf ein Szenario beschr√§nkt zu sein. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Durch Erstellen einer Befehlszeilenschnittstelle mit Node.js</a> k√∂nnen Sie verschiedene Farben, Bl√∂cke mit variablen Werten oder Formatierungswerkzeuge hinzuf√ºgen, um der Benutzeroberfl√§che ein optisch ansprechendes Aussehen zu verleihen.  Sie m√ºssen jedoch mehrere Szenarien ber√ºcksichtigen. <br><br>  Einer von ihnen zufolge kann die Schnittstelle im Kontext eines kontinuierlichen Integrationssystems (CI) verwendet werden. In diesem Fall ist es besser, auf die Farbformatierung und die visuell √ºberlastete Darstellung der Ergebnisse zu verzichten.  Bei einigen kontinuierlichen Integrationssystemen ist das <code>CI</code> Flag gesetzt.  Mit dem <code>is-ci</code> Paket, das mehrere solcher Systeme unterst√ºtzt, k√∂nnen Sie √ºberpr√ºfen, ob Sie sich in einem kontinuierlichen Integrationssystem befinden. <br><br>  Einige Bibliotheken, wie z. B. <code>chalk</code> , definieren kontinuierliche Integrationssysteme und √ºberschreiben die Ausgabe von farbigem Text an die Konsole.  Mal sehen, wie es funktioniert. <br><br>  Installieren Sie <code>chalk</code> mit dem <code>install chalk</code> npm <code>install chalk</code> <code>cli.js</code> und erstellen Sie eine Datei mit dem Namen <code>cli.js</code>  F√ºgen Sie die folgenden Zeilen in die Datei ein: <br><br><img src="https://habrastorage.org/webt/6c/oa/u-/6coau-msy3lievszm36fvfaeffi.png"><br><br>  Wenn Sie dieses Skript jetzt mit dem <code>node cli.js</code> , werden die Ergebnisse in verschiedenen Farben dargestellt: <br><br><img src="https://habrastorage.org/webt/nn/zf/rl/nnzfrlbh5jqiyoqfn-m2b3j2ff8.png"><br><br>  Wenn Sie das Skript jedoch mit <code>CI=true node cli.js</code> , wird die Farbformatierung der Texte abgebrochen: <br><br><img src="https://habrastorage.org/webt/iz/fg/cs/izfgcsne498gjwybmd_3f7p9ap0.png"><br><br>  In einem anderen denkw√ºrdigen Szenario wird <code>stdout</code> im Terminalmodus ausgef√ºhrt, d. H.  Daten werden an das Terminal ausgegeben.  In diesem Fall k√∂nnen die Ergebnisse mit <code>boxen</code> gut angezeigt werden.  Andernfalls wird die Ausgabe h√∂chstwahrscheinlich in eine Datei oder an eine andere Stelle umgeleitet. <br><br>  Sie k√∂nnen den Betrieb von <code>stdin</code> , <code>stdout</code> oder <code>stderr</code> Streams im Terminalmodus √ºberpr√ºfen, indem Sie sich das <code>isTTY</code> Attribut des entsprechenden Streams <code>isTTY</code> .  Zum Beispiel <code>process.stdout.isTTY</code> .  <code>TTY</code> bedeutet "Teletypewriter" und ist in diesem Fall speziell f√ºr das Terminal konzipiert. <br><br>  Die Werte k√∂nnen f√ºr jeden der drei Threads variieren, je nachdem, wie die Node.js-Prozesse gestartet wurden.  Detaillierte Informationen hierzu finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Node.js-Dokumentation im Abschnitt ‚ÄûEingabe / Ausgabe von Prozessen‚Äú</a> . <br><br>  Mal sehen, wie sich der Wert von <code>process.stdout.isTTY</code> in verschiedenen Situationen <code>process.stdout.isTTY</code> .  <code>cli.js</code> Datei <code>cli.js</code> , um sie zu √ºberpr√ºfen: <br><br><img src="https://habrastorage.org/webt/ha/qh/gl/haqhglnf6rs38hn6gxl2_ihnntw.png"><br><br>  F√ºhren Sie nun den <code>node cli.js</code> im Terminal aus und sehen Sie das Wort <code>true</code> <code>node cli.js</code> die Nachricht in farbiger Schrift angezeigt: <br><br><img src="https://habrastorage.org/webt/i8/z2/gx/i8z2gxbba0zk1cm5cnk4gxzkqbq.png"><br><br>  Danach f√ºhren wir den Befehl erneut aus, leiten die Ausgabe jedoch in eine Datei um und zeigen dann den Inhalt an: <br><br><img src="https://habrastorage.org/webt/sb/8b/sf/sb8bsftkufhbufqrmj_a2fkg4jk.png"><br><br>  Dieses Mal wurde das <code>undefined</code> Wort im Terminal angezeigt, gefolgt von einer Meldung in farbloser Schrift, da der <code>stdout</code> Stream es aus dem Terminalmodus umgeleitet hat.  Hier verwendet <code>chalk</code> das <code>isTTY</code> <code>supports-color</code> Tool, das aus Sicht der internen Struktur die <code>isTTY</code> entsprechenden Streams √ºberpr√ºft. <br><br><img src="https://habrastorage.org/webt/2n/8j/bs/2n8jbshyf2a9qdqpt7ihez8hcsy.png"><br><br>  Werkzeuge wie <code>chalk</code> erledigen diese Dinge selbstst√§ndig.  Wenn Sie jedoch eine Befehlszeilenschnittstelle entwickeln, sollten Sie immer Situationen ber√ºcksichtigen, in denen die Schnittstelle in einem kontinuierlichen Integrationssystem funktioniert oder die Ausgabe umgeleitet wird.  Mit diesen Tools k√∂nnen Sie die Befehlszeilenschnittstelle auf einer h√∂heren Ebene verwenden.  Beispielsweise k√∂nnen die Daten im Terminal strukturierter organisiert werden. Wenn <code>isTTY</code> <code>undefined</code> , wechseln Sie zu einer einfacheren Analysemethode. <br><br><h3>  Fazit </h3><br>  Die Verwendung von JavaScript und die Eingabe der ersten Zeile in das Konsolenprotokoll mit <code>console.log</code> recht einfach.  Bevor Sie den Code in der Produktion bereitstellen, sollten Sie jedoch verschiedene Aspekte der Verwendung des Protokolls ber√ºcksichtigen.  Dieser Artikel ist nur eine Einf√ºhrung in die verschiedenen Methoden und L√∂sungen, die beim Organisieren des Ereignisprotokolls verwendet werden.  Es enth√§lt nicht alles, was Sie wissen m√ºssen.  Daher wird empfohlen, auf erfolgreiche Open Source-Projekte zu achten und zu √ºberwachen, wie sie das Protokollierungsproblem gel√∂st haben und welche Tools verwendet werden.  Und jetzt versuchen Sie, sich zu protokollieren, ohne Daten an die Konsole auszugeben. <br><br><div style="text-align:center;"><img src="https://s3.amazonaws.com/com.twilio.prod.twilio-docs/original_images/mDf8ceyn8JviZCtuUmtELF8nB0-JFgfvtuRqE6kGRq_9OBdN54bcmQNMKDJ_YdFPOuqO5T_pSHHKV4"></div><br><br>  Wenn Sie andere erw√§hnenswerte Tools kennen, schreiben Sie in den Kommentaren dar√ºber. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de461881/">https://habr.com/ru/post/de461881/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de461871/index.html">101 Tipps, um ein guter Programmierer (und Mensch) zu werden</a></li>
<li><a href="../de461873/index.html">ViewPager 2 - neue Funktionalit√§t im alten Wrapper</a></li>
<li><a href="../de461875/index.html">5 nm vs 3 nm</a></li>
<li><a href="../de461877/index.html">Java vs Kotlin f√ºr Android: Meinungen von Entwicklern</a></li>
<li><a href="../de461879/index.html">Das Buch "Linux in Aktion"</a></li>
<li><a href="../de461885/index.html">EDS ist eine andere Art von Betrug</a></li>
<li><a href="../de461887/index.html">Eingabe von Aeronet Episode 2: Homing Drone</a></li>
<li><a href="../de461891/index.html">Wie wir mit ManageIQ Freunde in der Bankinfrastruktur gefunden haben</a></li>
<li><a href="../de461895/index.html">Lernen Sie w√§hrend der Reise - wie wir am 1. European Business Analysis Day gefahren sind</a></li>
<li><a href="../de461897/index.html">Wie wir die Stabilit√§t der Lamoda-Anwendung aufrechterhalten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>