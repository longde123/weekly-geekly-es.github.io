<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüíº üèÄ üë®üèø‚ÄçüöÄ O cibergrupo do PowerPool dominou a vulnerabilidade de dia zero na chamada de procedimento local avan√ßado üë©üèø‚Äçüî¨ üìí ü§òüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em 27 de agosto de 2018, informa√ß√µes sobre vulnerabilidade de dia zero foram publicadas no Twitter por um especialista em seguran√ßa da informa√ß√£o com ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O cibergrupo do PowerPool dominou a vulnerabilidade de dia zero na chamada de procedimento local avan√ßado</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/422613/"> Em 27 de agosto de 2018, informa√ß√µes sobre vulnerabilidade de dia zero foram publicadas no Twitter por um especialista em seguran√ßa da informa√ß√£o com o apelido SandboxEscaper.  A vulnerabilidade afeta as vers√µes do Microsoft Windows de 7 a 10, mais precisamente, a interface ALPC (Advanced Local Procedure Call) no Agendador de tarefas do Windows.  Ele fornece o Escalonamento de Privil√©gios Locais, que permite que um invasor aumente os direitos de c√≥digos maliciosos do n√≠vel de Usu√°rio para SYSTEM.  N√£o estamos falando de divulga√ß√£o coordenada da vulnerabilidade - a conta SandboxEscaper foi exclu√≠da em breve, n√£o houve patches de fechamento. <br><br>  O link do tweet levou ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reposit√≥rio do GitHub</a> com o c√≥digo de explora√ß√£o Proof-of-Concept - n√£o apenas a vers√£o compilada, mas tamb√©m o c√≥digo-fonte.  Portanto, qualquer pessoa pode modificar e recompilar a explora√ß√£o para melhor√°-la, evitar a detec√ß√£o ou inclu√≠-la em seu pr√≥prio c√≥digo. <br><br>  Em geral, n√£o √© de surpreender que, apenas dois dias depois, a explora√ß√£o tenha surgido na natureza na campanha do grupo cibern√©tico do PowerPool.  De acordo com a telemetria da ESET, os pa√≠ses-alvo dos atacantes s√£o R√∫ssia, Ucr√¢nia, Pol√¥nia, Alemanha, Reino Unido, EUA, √çndia, Filipinas e Chile.  H√° relativamente poucas v√≠timas, o que pode indicar uma campanha altamente segmentada. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mv/j9/jp/mvj9jpgpgqtisu48y3jazkb72ms.jpeg"></div><br><a name="habracut"></a><br><h3>  PowerPool Toolkit </h3><br>  A ESET registrou um novo grupo relativamente recentemente, no entanto, √† disposi√ß√£o dos hackers do PowerPool, uma gama bastante ampla de ferramentas.  A seguir, consideramos brevemente alguns deles. <br><br><h4>  Explora√ß√£o de escalonamento de privil√©gios locais no ALPC </h4> <br>  Os desenvolvedores do PowerPool n√£o usaram o arquivo bin√°rio publicado pela SandboxEscaper - eles modificaram levemente o c√≥digo-fonte e o recompilaram.  A explora√ß√£o tamb√©m foi observada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">por pesquisadores de seguran√ßa</a> e equipes do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CERT</a> . <br><br><img src="https://habrastorage.org/webt/0q/a5/8a/0qa58aieslsijwatki-cc9wbvae.png"><br>  <i>Figura 1. Descri√ß√£o da explora√ß√£o de direitos autorais</i> <br><br>  A viola√ß√£o est√° na <code>SchRpcSetSecurity</code> API <code>SchRpcSetSecurity</code> , que n√£o valida os direitos do usu√°rio corretamente.  Assim, o usu√°rio pode gravar qualquer arquivo em <code>C:\Windows\Task</code> , independentemente das permiss√µes reais - se houver uma permiss√£o de leitura, √© poss√≠vel substituir o conte√∫do de um arquivo protegido contra grava√ß√£o. <br><br>  Qualquer usu√°rio pode gravar arquivos em <code>C:\Windows\Task</code> ; portanto, nesta pasta, voc√™ pode criar um arquivo que seja um link f√≠sico para qualquer arquivo de <i>destino</i> .  Em seguida, chamando a fun√ß√£o <code>SchRpcSetSecurity</code> , voc√™ pode acessar o acesso de grava√ß√£o a este arquivo de destino.  Para fornecer escalonamento de privil√©gios locais, o invasor precisa selecionar o arquivo de destino a ser substitu√≠do - √© importante que esse arquivo seja executado automaticamente com direitos de administrador.  Como alternativa, pode ser um arquivo do sistema ou um utilit√°rio para a atualiza√ß√£o de software instalado anteriormente, que √© executado regularmente.  A etapa final √© substituir o conte√∫do do arquivo de destino por c√≥digo malicioso.  Assim, na pr√≥xima execu√ß√£o autom√°tica, o malware ter√° direitos de administrador, independentemente dos direitos originais. <br><br>  Os desenvolvedores do PowerPool decidiram alterar o conte√∫do do arquivo <code>C:\Program Files (x86)\Google\Update\GoogleUpdate.exe</code> .  Este √© um atualizador leg√≠timo para aplicativos do Google; √© executado regularmente com direitos de administrador atrav√©s da tarefa do Microsoft Windows. <br><br><img src="https://habrastorage.org/webt/qe/ef/as/qeefastmi_y_som113u2cmyutwa.png"><br>  <i>Figura 2. Criando um link f√≠sico para o Google Updater</i> <br><br><img src="https://habrastorage.org/webt/7d/th/ua/7dthua4tv-1sglb8uq6udcwb6na.png"><br>  <i>Figura 3. Usando o SchRpcCreateFolder para alterar as permiss√µes do execut√°vel do Google Updater</i> <br><br>  A sequ√™ncia de opera√ß√µes na figura acima permite que os operadores do PowerPool obtenham permiss√µes de grava√ß√£o para o arquivo execut√°vel do <code>GoogleUpdate.exe</code> .  Em seguida, eles o substituem, substituindo-os por uma c√≥pia do malware de segundo est√°gio (descreveremos a seguir) para obter direitos de administrador na pr√≥xima vez que o atualizador for chamado. <br><br><h3>  Compromisso inicial </h3><br>  A equipe do PowerPool usa m√©todos diferentes para primeiro comprometer a v√≠tima.  Um deles √© o envio de spam com malware do primeiro est√°gio do anexo.  Ainda √© cedo para tirar conclus√µes, mas at√© agora observamos muito poucas amostras nos dados de telemetria, por isso assumimos que os destinat√°rios s√£o cuidadosamente selecionados e n√£o estamos falando de mala direta. <br><br>  Por outro lado, sabemos que no passado o PowerPool j√° praticava envios de spam.  De acordo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">com uma</a> publica√ß√£o no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">blog da SANS</a> publicada em maio de 2018, eles usaram um esquema com arquivos Symbolic Link (.slk) para espalhar malware.  O Microsoft Excel pode carregar esses arquivos que atualizam a c√©lula e fazem com que o Excel execute o c√≥digo do PowerShell.  Parece que esses arquivos .slk tamb√©m s√£o distribu√≠dos em mensagens de spam.  Com base no primeiro arquivo mencionado na publica√ß√£o do SANS (SHA-1: b2dc703d3af1d015f4d53b6dbbeb624f5ade5553), voc√™ pode encontrar a amostra de spam correspondente no VirusTotal (SHA-1: e0882e234cba94b5cf3df2c05949e2e228beddb) <br><br><img src="https://habrastorage.org/webt/vb/go/yc/vbgoycqhjfhtfptqv-24ob43i-8.png"><br>  <i>Figura 4. Spam do PowerPool</i> <br><br><h3>  Backdoors do Windows </h3><br>  O grupo PowerPool geralmente trabalha com duas backdoors: a backdoor do primeiro est√°gio √© usada ap√≥s o comprometimento inicial, a backdoor do segundo est√°gio √© implementada apenas nas m√°quinas de seu interesse. <br><br><h4>  Backdoor do primeiro est√°gio </h4><br>  Este √© o malware b√°sico usado para intelig√™ncia.  Consiste em dois execut√°veis ‚Äã‚Äãdo Windows. <br><br>  O primeiro deles √© o backdoor principal, que fornece persist√™ncia atrav√©s do servi√ßo.  Ele tamb√©m cria um mutex chamado <code>MyDemonMutex%d</code> , em que <code>%d</code> est√° no intervalo de 0 a 10. O backdoor coleta informa√ß√µes de proxy, o endere√ßo do servidor C&amp;C √© codificado em um arquivo bin√°rio.  O malware pode executar comandos e executar intelig√™ncia b√°sica no sistema, transferindo dados para o servidor C&amp;C. <br><br><img src="https://habrastorage.org/webt/ps/km/ca/pskmcackoqhfcx_19gge_ryfvoa.png"><br>  <i>Figura 5. Coletando informa√ß√µes de proxy</i> <br><br>  O segundo dos arquivos execut√°veis ‚Äã‚Äãtem um prop√≥sito.  Ele tira uma captura de tela e a grava no arquivo <code>MyScreen.jpg</code> , que pode ser filtrado pelo backdoor principal. <br><br><h4>  Porta traseira do segundo est√°gio </h4><br>  Malvar √© carregado durante o primeiro est√°gio, presumivelmente se a m√°quina parecer interessante para os operadores.  No entanto, o programa n√£o √© como um backdoor moderno de ART. <br><br>  O endere√ßo do servidor C&amp;C √© codificado em formato bin√°rio, n√£o h√° mecanismo para atualizar esse importante item de configura√ß√£o.  O backdoor procura por comandos de <code>http://[C&amp;C domain]/cmdpool</code> e baixa arquivos adicionais de <code>http://[C&amp;C domain]/upload</code> .  Arquivos adicionais s√£o principalmente ferramentas para movimento horizontal, mencionados abaixo. <br><br>  Comandos suportados: <br>  - execute o comando <br>  - complete o processo <br>  - enviar arquivo <br>  - baixar arquivo <br>  - visualizar o conte√∫do da pasta <br><br>  Os comandos s√£o enviados no formato JSON.  Exemplos abaixo s√£o pedidos para executar comandos e listar pastas: <br><br><img src="https://habrastorage.org/webt/au/r1/nc/aur1ncfuer-g6aqayj0n7cjmkhy.png"><br>  <i>Figura 6. Exemplos de comandos de backdoor</i> <br><br><h3>  Ferramentas para movimento horizontal </h3><br>  Ao fornecer acesso constante ao sistema usando o backdoor de segundo est√°gio, os operadores do PowerPool usam v√°rias ferramentas de c√≥digo aberto, escritas principalmente no PowerShell, para movimento horizontal na rede. <br><br>  - <a href="">PowerDump</a> : m√≥dulo Metasploit que pode recuperar nomes de usu√°rio e hashes do Security Account Manager. <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PowerSploit</a> : uma cole√ß√£o de m√≥dulos do PowerShell, no Metasploit. <br>  - <a href="">SMBExec</a> : uma ferramenta do PowerShell para executar ataques de passagem usando o protocolo SMB. <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Quarks PwDump</a> : um execut√°vel do Windows que pode extrair credenciais. <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">FireMaster</a> : execut√°vel do Windows que pode extrair senhas salvas do Outlook, navegadores da web etc. <br><br><h3>  Conclus√£o </h3><br>  A divulga√ß√£o de vulnerabilidades antes do lan√ßamento das atualiza√ß√µes coloca os usu√°rios em risco.  Nesse caso, at√© a vers√£o mais recente do Windows pode estar comprometida.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O CERT-CC oferece uma</a> solu√ß√£o alternativa para o problema, que, no entanto, n√£o foi oficialmente acordado pela Microsoft. <br><br>  Um ataque do PowerPool tem como alvo um n√∫mero limitado de usu√°rios.  No entanto, o incidente mostra que os invasores est√£o sempre atualizados e implementam rapidamente novas explora√ß√µes. <br><br>  Os especialistas da ESET continuam a monitorar a explora√ß√£o da nova vulnerabilidade.  Indicadores de compromisso tamb√©m est√£o dispon√≠veis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no GitHub</a> . <br><br><h3>  Indicadores de compromisso </h3><br><h4>  Hashes </h4><br>  Backdoor do Est√°gio Um (Win32 / Agent.SZS) 038f75dcf1e5277565c68d57fa1f4f7b3005f3f3 <br>  Backdoor do Est√°gio Um (Win32 / Agent.TCH) 247b542af23ad9c63697428c7b77348681aadc9a <br>  Backdoor do segundo est√°gio (Win32 / Agent.TIA) 0423672fe9201c325e33f296595fb70dcd81bcd9 <br>  Backdoor do segundo est√°gio (Win32 / Agent.TIA) b4ec4837d07ff64e34947296e73732171d1c1586 <br>  Explora√ß√£o de LPPC ALPC (Win64 / Exploit.Agent.H) 9dc173d4d4f74765b5fc1e1c9a2d188d5387beea <br><br><h4>  Detec√ß√£o ESET </h4><br>  - Win32 / Agent.SZS <br>  - Win32 / Agent.TCH <br>  - Win32 / Agent.TEL <br>  - Win32 / Agent.THT <br>  - Win32 / Agent.TDK <br>  - Win32 / Agent.TIA <br>  - Win32 / Agent.TID <br><br><h4>  Servidores C&amp;C </h4><br>  - newsrental [.] Net <br>  - rosbusiness [.] Eu <br>  - afishaonline [.] <br>  - colecionadores de esportes [.] Com <br>  - 27.102.106 [.] 149 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt422613/">https://habr.com/ru/post/pt422613/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt422601/index.html">Chrome 69 sai com um gerador de senha aleat√≥rio</a></li>
<li><a href="../pt422603/index.html">Um pouco mais perto da perfei√ß√£o</a></li>
<li><a href="../pt422605/index.html">Crescendo em seguran√ßa desde tenra idade - programa educacional da Rostelecom e MIPT</a></li>
<li><a href="../pt422609/index.html">Barreira lingu√≠stica e PNL. Por que os chatbots n√£o nos entendem?</a></li>
<li><a href="../pt422611/index.html">Manipulador de erro padr√£o no RxJava2 ou por que o RxJava causa falhas no aplicativo, mesmo que o onError seja implementado</a></li>
<li><a href="../pt422615/index.html">Toda a verdade sobre o RTOS. Artigo 9. Agendador: implementa√ß√£o</a></li>
<li><a href="../pt422617/index.html">Toda a verdade sobre o RTOS. Artigo 8. N√∫cleo SE: Projeto Interno e Implanta√ß√£o</a></li>
<li><a href="../pt422623/index.html">Como proteger C</a></li>
<li><a href="../pt422625/index.html">Conversamos com Troy Miles - o programador do "Neuromancer"</a></li>
<li><a href="../pt422627/index.html">Pesquisa de mercado de trabalho MongoDB e TI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>