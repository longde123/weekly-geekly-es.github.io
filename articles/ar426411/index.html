<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ง๐ผ ๐ด ุชุทููุฑ ูุฆุงุช ูุงุตูุงุช C ++ / CLI ๐จ๐ผโ๐จ ๐งฃ ๐ฉ๐ผโ๐ป</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู C ++ / CLI ุ ุบุงูุจูุง ูุง ูุชู ุงุณุชุฎุฏุงู ูุง ูุณูู ุจูุฆุงุช ุงููุงุตู - ุงููุฆุงุช ุงููุฏุงุฑุฉ ุงูุชู ุชุญุชูู ุนูู ูุคุดุฑ ูููุฆุฉ ุงูุฃุตููุฉ ูุนุถู. ุชุชูุงูู ุงูููุงูุฉ ูุฎุทุทูุง ููุงุฆููุง ููุถุบ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชุทููุฑ ูุฆุงุช ูุงุตูุงุช C ++ / CLI</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426411/" style=";text-align:right;direction:rtl"><hr><p style=";text-align:right;direction:rtl">  <i>ูู C ++ / CLI ุ ุบุงูุจูุง ูุง ูุชู ุงุณุชุฎุฏุงู ูุง ูุณูู ุจูุฆุงุช ุงููุงุตู - ุงููุฆุงุช ุงููุฏุงุฑุฉ ุงูุชู ุชุญุชูู ุนูู ูุคุดุฑ ูููุฆุฉ ุงูุฃุตููุฉ ูุนุถู.</i>  <i>ุชุชูุงูู ุงูููุงูุฉ ูุฎุทุทูุง ููุงุฆููุง ููุถุบูุทูุง ูุฅุฏุงุฑุฉ ุนูุฑ ุงููุงุฆู ุงูุฃุตูู ุงูููุงุจู ุ ุจูุงุกู ุนูู ุงุณุชุฎุฏุงู ุงูููุงูุจ ุงูููุฏุงุฑุฉ.</i>  <i>ูุชู ุงููุธุฑ ูู ุงูุญุงูุงุช ุงููุนูุฏุฉ ููุงูุชูุงุก.</i> <i><br></i> </p><hr><br><a name="habracut"></a><br><h1 style=";text-align:right;direction:rtl">  ุฌุฏูู ุงููุญุชููุงุช </h1><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุฏูุฉ</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">1. ููุท ุงูุชุฎูุต ุงูุฃุณุงุณู ูู C ++ / CLI</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">1.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุนุฑูู ุงููุฏูุฑ ูุงูููููู</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">1.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจุงุณุชุฎุฏุงู ุฏูุงูุงุช ุงูููุฏุณ</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">2. ุงูููุงูุจ ุงููุฏุงุฑุฉ</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">2.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุคุดุฑุงุช ุฐููุฉ</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">2.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงู ููุงุณุชุฎุฏุงู</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">2.3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฎูุงุฑุงุช ุฅููุงุก ุฃูุซุฑ ุชุนููุฏูุง</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">2.3.1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููู Finalizer</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">2.3.2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจุงุณุชุฎุฏุงู SafeHandle</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุฑุงุฌุน</a> <br></p><br><a name="id-introdaction"></a><br><h1 style=";text-align:right;direction:rtl">  ููุฏูุฉ </h1><br><p style=";text-align:right;direction:rtl"> ูุงุฏุฑูุง ูุง ูุชู ุงุณุชุฎุฏุงู C ++ / CLI - ุฅุญุฏู ูุบุงุช .NET Framework - ูุชุทููุฑ ูุดุงุฑูุน ูุณุชููุฉ ูุจูุฑุฉ.  ุงูุบุฑุถ ุงูุฑุฆูุณู ููู ูู ุฅูุดุงุก ุชุฌููุนุงุช ููุชูุงุนู .NET ูุน ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฃุตููุฉ (ุบูุฑ ุงูููุฏุงุฑุฉ).  ููููุง ูุฐูู ุ ูุชู ุงุณุชุฎุฏุงู ุงููุฆุงุช ุงูุชู ุชุณูู ูุฆุงุช ุงููุงุตู ุนูู ูุทุงู ูุงุณุน ุ ูุงููุฆุงุช ุงููุฏุงุฑุฉ ุงูุชู ุชุญุชูู ุนูู ูุคุดุฑ ูููุฆุฉ ุงูุฃุตููุฉ ูุนุถู.  ุนุงุฏุฉู ูุง ุชูุชูู ูุฆุฉ ุงููุงุตู ุงููุงุฆู ุงูุฃุตูู ุงูููุงุจู ุ ุฃู ูุฌุจ ุญุฐูู ูู ุงูููุช ุงูููุงุณุจ.  ูู ุงูุทุจูุนู ุฌุฏูุง ุฌุนู ูุซู ูุฐุง ุงููุตู ูุนูููุง ุ ุฃู ุชูููุฐ <code>System::IDisposable</code> .  ูุฌุจ ุฃู ูุชุจุน ุชุทุจูู ูุฐู ุงููุงุฌูุฉ ูู .NET ููุทูุง ุฎุงุตูุง ูุณูู Basic Dispose [Cwalina].  ููุฒุฉ ููุญูุธุฉ ูู C ++ / CLI ูู ุฃู ุงููุชุฑุฌู ูุฃุฎุฐ ูู ุงูุฃุนูุงู ุงูุฑูุชูููุฉ ูุชุทุจูู ูุฐุง ุงููุงูุจ ุชูุฑูุจูุง ุ ุจูููุง ูู C # ูุฌุจ ุฃู ูุชู ูู ุดูุก ุชูุฑูุจูุง ูุฏูููุง. </p><br><a name="id-1"></a><br><h1 style=";text-align:right;direction:rtl">  1. ููุท ุงูุชุฎูุต ุงูุฃุณุงุณู ูู C ++ / CLI </h1><br><p style=";text-align:right;direction:rtl">  ููุงู ุทุฑููุชุงู ุฑุฆูุณูุชุงู ูุชูููุฐ ูุฐุง ุงููููุฐุฌ. </p><br><a name="id-1-1"></a><br><h2 style=";text-align:right;direction:rtl">  1.1.  ุชุนุฑูู ุงููุฏูุฑ ูุงูููููู </h2><br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูุญุงูุฉ ุ ูุฌุจ ุชุนุฑูู ุงููุฏูุฑ ูุงูููููู ูู ุงููุฆุฉ ุงูููุฏุงุฑุฉ ุ ูุณูู ูููู ุงููุชุฑุฌู ุจุงูุจุงูู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ref <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">X</span></span></span><span class="hljs-class"> {</span></span>    ~X() {<span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span>} <span class="hljs-comment"><span class="hljs-comment">//     !X() {/* ... */} //  // ... };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูู ูุฌู ุงูุฎุตูุต ุ ูููู ุงููุชุฑุฌู ุจูุง ููู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ูููุฆุฉ <code>X</code> ุชุทุจู <code>System::IDisposable</code> . </li><li style=";text-align:right;direction:rtl">  ูู <code>X::Dispose()</code> ูููุฑ ุงุณุชุฏุนุงุก ุงููุฏูุฑ ุ ูุงุณุชุฏุนุงุก ุงููุฏูุฑ ูููุฆุฉ ุงูุฃุณุงุณูุฉ (ุฅู ูุฌุฏ) ุ ูุงุณุชุฏุนุงุก <code>GC::SupressFinalize()</code> . </li><li style=";text-align:right;direction:rtl">  Overrides <code>System::Object::Finalize()</code> ุ ุญูุซ ูููุฑ ุงุณุชุฏุนุงุก ููููููู ู ุงูููุงุฆูุฉ ูู ุงููุฆุงุช ุงูุฃุณุงุณูุฉ (ุฅู ูุฌุฏุช). </li></ol><br><p style=";text-align:right;direction:rtl">  ููููู ุชุญุฏูุฏ ุงููุฑุงุซุฉ ูู <code>System::IDisposable</code> ุจุดูู ุตุฑูุญ ุ ูููู ูุง ููููู ุชุนุฑูู <code>X::Dispose()</code> ุจููุณู. </p><br><a name="id-1-2"></a><br><h2 style=";text-align:right;direction:rtl">  1.2.  ุจุงุณุชุฎุฏุงู ุฏูุงูุงุช ุงูููุฏุณ </h2><br><p style=";text-align:right;direction:rtl">  ูุชู ุชูููุฐ ููุท ุงูุชุฎูุต ุงูุฃุณุงุณู ุฃูุถูุง ุจูุงุณุทุฉ ุงููุญูู ุงูุจุฑูุฌู ุฅุฐุง ูุงู ูููุฆุฉ ุนุถู ูู ุงูููุน ุงููุญุฑุฑ ูุชู ุงูุชุตุฑูุญ ุจุงุณุชุฎุฏุงู ุฏูุงูุงุช ุงูููุฏุณ.  ูุฐุง ูุนูู ุฃู ุงุณู ุงูููุน ุจุฏูู <code>gcnew</code> (' <code>^</code> ') ูุณุชุฎุฏู ููุฅุนูุงู ุ <code>gcnew</code> ุงูุชููุฆุฉ ูู ูุงุฆูุฉ ุชููุฆุฉ ุงูููุดุฆ ุ ูููุณ ุจุงุณุชุฎุฏุงู <code>gcnew</code> .  ูุชู ูุตู ุฏูุงูุงุช ุงูููุฏุณ ูู [Hogenson]. </p><br><p style=";text-align:right;direction:rtl">  ููุง ูุซุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ref <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">R</span></span></span><span class="hljs-class"> :</span></span> System::IDisposable { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:    R(<span class="hljs-comment"><span class="hljs-comment">/*  */</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  // ... }; public ref class X {    R m_R; //   R^ m_R public:    X(/*  */) //         : m_R(/*  */) //   m_R = gcnew R(/*  */)    {/* ... */} // ... };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุงููุชุฑุฌู ูู ูุฐู ุงูุญุงูุฉ ุจูุง ููู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ูููุฆุฉ <code>X</code> ุชุทุจู <code>System::IDisposable</code> . </li><li style=";text-align:right;direction:rtl">  ูู <code>X::Dispose()</code> ูููุฑ ุงุณุชุฏุนุงุก ูู <code>R::Dispose()</code> ูู <code>m_R</code> . </li></ol><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุญุฏูุฏ ุงูุฅููุงุก ูู ุฎูุงู ูุธููุฉ ุงููุฆุฉ ุงูููุงุจูุฉ <code>R</code>  ููุง ูู ุงูุญุงูุฉ ุงูุณุงุจูุฉ ุ ูููู ุชุญุฏูุฏ ุงููุฑุงุซุฉ ูู <code>System::IDisposable</code> ุจุดูู ุตุฑูุญ ุ ูููู ูุง ููููู ุชุญุฏูุฏ <code>X::Dispose()</code> ุจููุณู.  ุจุทุจูุนุฉ ุงูุญุงู ุ ูุฏ ูููู ูุฏู ุงูุตู ุฃุนุถุงุก ุขุฎุฑูู ุฃุนูููุง ุจุงุณุชุฎุฏุงู ุฏูุงูุงุช ุงูููุฏุณ ุ ููุชู ุฃูุถูุง ุชูููุฑ ุงุณุชุฏุนุงุก <code>Dispose()</code> ููู. </p><br><a name="id-2"></a><br><h1 style=";text-align:right;direction:rtl">  2. ุงูููุงูุจ ุงููุฏุงุฑุฉ </h1><br><p style=";text-align:right;direction:rtl">  ูุฃุฎูุฑูุง ุ ููุงู ููุฒุฉ ุฑุงุฆุนุฉ ุฃุฎุฑู ูู C ++ / CLI ุชุฌุนู ูู ุงููููู ุชุจุณูุท ุฅูุดุงุก ูุฆุงุช ุงููุงุตู ูุฏุฑ ุงูุฅููุงู.  ูุญู ูุชุญุฏุซ ุนู ุงูููุงูุจ ุงููุฏุงุฑุฉ.  ูุฐู ููุณุช ุฃุฏููุฉ ุนุงูุฉ ุ ูููููุง ููุงูุจ ุญููููุฉ ุ ููุง ูู ุงูุญุงู ูู C ++ ุงูููุงุณููู ุ ููู ุงูููุงุฐุฌ ููุณุช ุฃุตูููุง ุ ูููููุง ูุฆุงุช ููุฏุงุฑุฉ.  ูุคุฏู ุฅูุดุงุก ูุซู ูุฐู ุงูุฃููุงุท ุฅูู ุฅูุดุงุก ูุฆุงุช ููุฏุงุฑุฉ ูููู ุงุณุชุฎุฏุงููุง ููุฆุงุช ุฃุณุงุณูุฉ ุฃู ูุฃุนุถุงุก ูู ูุฆุงุช ุฃุฎุฑู ุฏุงุฎู ุงูุชุฌููุน.  ุงูููุงูุจ ุงูููุฏุงุฑุฉ ููุตููุฉ ูู [Hogenson]. </p><br><a name="id-2-1"></a><br><h2 style=";text-align:right;direction:rtl">  2.1.  ูุคุดุฑุงุช ุฐููุฉ </h2><br><p style=";text-align:right;direction:rtl">  ุชุณูุญ ูู ุงูููุงูุจ ุงูููุฏุงุฑุฉ ุจุฅูุดุงุก ูุฆุงุช ูุซู ุงููุคุดุฑุงุช ุงูุฐููุฉ ุงูุชู ุชุญุชูู ุนูู ูุคุดุฑ ูููุงุฆู ุงูุฃุตูู ูุนุถู ูุชููุฑ ุฅุฒุงูุชู ูู ุฃุฏุงุฉ ุงูุชุฏููุฑ ู ูุญุฏุฉ ุงูุฅููุงุก.  ูููู ุงุณุชุฎุฏุงู ูุฐู ุงููุคุดุฑุงุช ุงูุฐููุฉ ููุฆุงุช ุฃุณุงุณูุฉ ุฃู ุฃุนุถุงุก (ุจุดูู ุทุจูุนู ุ ุจุงุณุชุฎุฏุงู ุฏูุงูุงุช ุงูููุฏุณ) ุนูุฏ ุชุทููุฑ ูุฆุงุช ูุงุตู ูุชู ุชุญุฑูุฑูุง ุชููุงุฆููุง. </p><br><p style=";text-align:right;direction:rtl">  ููุง ูุซุงู ุนูู ูุฐู ุงูุฃููุงุท.  ุงููุงูุจ ุงูุฃูู ูู ูุงูุจ ุฃุณุงุณู ุ ูุงูุซุงูู ูุฎุตุต ููุงุณุชุฎุฏุงู ููุฆุฉ ุฃุณุงุณูุฉ ุ ูุงูุซุงูุซ ูุนุถู ูู ุงููุฆุฉ.  ุชุญุชูู ูุฐู ุงูููุงูุจ ุนูู ูุนููุฉ ูุงูุจ (ุฃุตููุฉ) ูุตููุฉ ูุญุฐู ูุงุฆู.  ุชุญุฐู ูุฆุฉ ุงูุญุฐู ุงููุงุฆู ุจุงุณุชุฎุฏุงู ุนุงูู ุงูุญุฐู ุจุดูู ุงูุชุฑุงุถู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  , -  , T โ   template &lt;typename T&gt; struct DefDeleter {    void operator()(T* p) const { delete p; } }; //  , //      //  , T โ  , D โ - template &lt;typename T, typename D&gt; public ref class ImplPtrBase : System::IDisposable {    T* m_Ptr;    void Delete()    {        if (m_Ptr != nullptr)        {            D del;            del(m_Ptr);            m_Ptr = nullptr;        }    }    ~ImplPtrBase() { Delete(); }    !ImplPtrBase() { Delete(); } protected:    ImplPtrBase(T* p) : m_Ptr(p) {}    T* Ptr() { return m_Ptr; } }; //        template &lt;typename T, typename D = DefDeleter&lt;T&gt;&gt; public ref class ImplPtr : ImplPtrBase&lt;T, D&gt; { protected:    ImplPtr(T* p) : ImplPtrBase(p) {} public:    property bool IsValid    {        bool get() { return (ImplPtrBase::Ptr() != nullptr); }    } }; //        template &lt;typename T, typename D = DefDeleter&lt;T&gt;&gt; public ref class ImplPtrM sealed : ImplPtrBase&lt;T, D&gt; { public:    ImplPtrM(T* p) : ImplPtrBase(p) {}    operator bool() { return ( ImplPtrBase::Ptr() != nullptr); }    T* operator-&gt;() { return ImplPtrBase::Ptr(); }    T* Get() { return ImplPtrBase::Ptr(); } };</span></span></code> </pre> <br><a name="id-2-2"></a><br><h2 style=";text-align:right;direction:rtl">  2.2.  ูุซุงู ููุงุณุชุฎุฏุงู </h2><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">N</span></span></span><span class="hljs-class"> //   {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:    N();    ~N();    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// ... }; using NPtr = ImplPtr&lt;N&gt;; //   public ref class U : NPtr //  - { public:    U() : NPtr(new N()) {}    void DoSomething() { if (IsValid) Ptr()-&gt;DoSomething(); } // ... }; public ref class V //  -,   {    ImplPtrM&lt;N&gt; m_NPtr; //   public:    V() : m_NPtr(new N()) {}    void DoSomething() { if (m_NPtr) m_NPtr-&gt;DoSomething(); } // ... };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงูุฃูุซูุฉ ุ ูุชู ุชุญุฑูุฑ ุงููุฆุชูู <code>U</code> ู <code>V</code> ุจุฏูู ุฃู ุฌูุฏ ุฅุถุงูู ุ ุชููุฑ <code>Dispose()</code> ุงุณุชุฏุนุงุก ุนุงูู ุงูุชุดุบูู <code>delete</code> ููุคุดุฑ ุฅูู <code>N</code>  ูุชูุญ ูู ุงูุฎูุงุฑ ุงูุซุงูู ุ ุจุงุณุชุฎุฏุงู <code>ImplPtrM&lt;&gt;</code> ุ ุฅุฏุงุฑุฉ ูุฆุงุช ุฃุตููุฉ ูุชุนุฏุฏุฉ ูู ูุฆุฉ ูุงุตู ูุงุญุฏ. </p><br><a name="id-2-3"></a><br><h2 style=";text-align:right;direction:rtl">  2.3.  ุฎูุงุฑุงุช ุฅููุงุก ุฃูุซุฑ ุชุนููุฏูุง </h2><br><p style=";text-align:right;direction:rtl">  ุงูุฅููุงุก ูู ุฌุงูุจ ุฅุดูุงูู ุฅูู ุญุฏ ูุง ูู .NET.  ูู ุณููุงุฑูููุงุช ุงูุชุทุจูู ุงูุนุงุฏูุฉ ุ ูุง ููุจุบู ุงุณุชุฏุนุงุก ุฃุฏูุงุช ุงูุฅููุงุก ุ ูุฌุจ ุชุญุฑูุฑ ุงูููุงุฑุฏ ูู <code>Dispose()</code> .  ูููู ูู ุณููุงุฑูููุงุช ุงูุทูุงุฑุฆ ุ ูููู ุฃู ูุญุฏุซ ูุฐุง ููุฌุจ ุฃู ูุนูู ุงููุตูููู ุจุดูู ุตุญูุญ. </p><br><a name="id-2-3-1"></a><br><h3 style=";text-align:right;direction:rtl">  2.3.1.  ููู Finalizer </h3><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงูุช ุงููุฆุฉ ุงูุฃุตููุฉ ููุฌูุฏุฉ ูู ููุชุจุฉ ุงูุงุฑุชุจุงุท ุงูุญููู (DLL) ุงูุชู ูุชู ุชุญููููุง ูุฅูุบุงุก ุชุญููููุง ุฏููุงูููููุง - ุจุงุณุชุฎุฏุงู <code>LoadLibrary()/FreeLibrary()</code> ุ ููุฏ ุชูุดุฃ ุญุงูุฉ ุนูุฏูุง ุชููู ููุงู ุจุนุฏ ุชูุฑูุบ ููุชุจุฉ ุงูุงุฑุชุจุงุท ุงูุฏููุงูููู ูุงุฆูุงุช ุบูุฑ ููุดูุฑุฉ ุชุญุชูู ุนูู ูุฑุงุฌุน ููุซููุงุช ูุฐู ุงููุฆุฉ.  ูู ูุฐู ุงูุญุงูุฉ ุ ุจุนุฏ ูุชุฑุฉ ุณูุญุงูู ุฌุงูุน ุงูููุงูุฉ ุงูุงูุชูุงุก ูููุง ุ ูุจูุง ุฃู DLL ุบูุฑ ูุญูู ุ ููู ุงููุฑุฌุญ ุฃู ูุชุนุทู ุงูุจุฑูุงูุฌ.  (ุงูููุฒุฉ ุงููููุฒุฉ ูู ุญุฏูุซ ุนุทู ุจุนุฏ ุนุฏุฉ ุซูุงูู ูู ุฅุบูุงู ุงูุชุทุจูู ุนูู ูุง ูุจุฏู.) ูุฐูู ุ ุจุนุฏ ุฅูุบุงุก ุชุญููู ููู DLL ุ ูุฌุจ ุญุธุฑ ุฃุฏูุงุช ุงูุฅููุงุก.  ูููู ุชุญููู ุฐูู ูู ุฎูุงู ุชุนุฏูู ุตุบูุฑ ูู ูุงูุจ <code>ImplPtrBase</code> ุงูุฃุณุงุณู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ref <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DllFlag</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>:    <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> s_Loaded = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetLoaded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> loaded)</span></span></span><span class="hljs-function"> </span></span>{ s_Loaded = loaded; } }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> D&gt; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ref <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImplPtrBase</span></span></span><span class="hljs-class"> :</span></span> DllFlag, System::IDisposable { <span class="hljs-comment"><span class="hljs-comment">// ...    !ImplPtrBase() { if (s_Loaded) Delete(); } // ... };</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุชุญููู ููุชุจุฉ ุงูุงุฑุชุจุงุท ุงูุญููู (DLL) ุ ุชุญุชุงุฌ ุฅูู ุงุณุชุฏุนุงุก <code>DllFlag::SetLoaded(true)</code> ุ ููุจู ุฅูุบุงุก ุชุญููู <code>DllFlag::SetLoaded(false)</code> . </p><br><a name="id-2-3-2"></a><br><h3 style=";text-align:right;direction:rtl">  2.3.2.  ุจุงุณุชุฎุฏุงู <code>SafeHandle</code> </h3><br><p style=";text-align:right;direction:rtl">  <code>SafeHandle</code> ูุฆุฉ <code>SafeHandle</code> ูุนูุฏุฉ ูุฃูุซุฑ ููุซูููุฉ ุฅูู ุญุฏ ูุง ุ ุงูุธุฑ [Richter].  ูููู ุฅุนุงุฏุฉ ุชุตููู ุงููุงูุจ <code>ImplPtrBase&lt;&gt;</code> ูุงุณุชุฎุฏุงู <code>SafeHandle</code> .  ูุง ููุฒู ุชุบููุฑ ุงูููุงูุจ ุงููุชุจููุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> SH = System::Runtime::InteropServices::SafeHandle; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> PtrType = System::IntPtr; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> D&gt; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ref <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImplPtrBase</span></span></span><span class="hljs-class"> :</span></span> SH { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>:    ImplPtrBase(T* p) : SH(PtrType::Zero, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)    {        handle = PtrType(p);    }    <span class="hljs-function"><span class="hljs-function">T* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ptr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;T*&gt;(handle.ToPointer()); }    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReleaseHandle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> override    </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsInvalid)        {            D del;            del(Ptr());            handle = PtrType::Zero;        }        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>;    } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:    property <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsInvalid    {        <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> override        </span></span>{            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (handle == PtrType::Zero);        }    } };</code> </pre> <br><a name="id-refs"></a><br><h1 style=";text-align:right;direction:rtl">  ุงููุฑุงุฌุน </h1><br><p style=";text-align:right;direction:rtl">  [ุฑูุฎุชุฑ] <br>  ุฑูุฎุชุฑ ุ ุฌููุฑู.  ุงูุจุฑูุฌุฉ ุนูู ููุตุฉ Microsoft .NET Framework 4.5 ูู C #.  ุงูุทุจุนุฉ ุงูุฑุงุจุนุฉ: Per.  ูู ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ  - ุณุงูุช ุจุทุฑุณุจุฑุบ: ุจูุชุฑ ุ 2016. </p><br><p style=";text-align:right;direction:rtl">  [Cwalina] <br>  Tsvalina ุ Krzhishtov.  ุฃุจุฑุงูุฒ ุ ุจุฑุงุฏ.  ุงูุจููุฉ ุงูุชุญุชูุฉ ููุดุงุฑูุน ุงูุจุฑูุฌูุงุช: ุงูุงุตุทูุงุญุงุช ูุงููุตุทูุญุงุช ูุงูููุงูุจ ูููุชุจุงุช .NET ุงููุงุจูุฉ ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู: ุงูุชุฑุฌูุฉ.  ูู ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ  - ู: LLC "I.D.  ููููุงูุฒ ุ 2011. </p><br><p style=";text-align:right;direction:rtl">  [ููุฌูุณูู] <br>  ููุฌูุณูู ุ ุฌูุฑุฏูู.  C ++ / CLI: ูุบุฉ Visual C ++ ูุจูุฆุฉ .NET.: Per.  ูู ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ  - ู: LLC "I.D.  ูููุงูุฒ ุ 2007. </p><br><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar426411/">https://habr.com/ru/post/ar426411/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar426399/index.html">ูุฑูููุณ: ูุง ููุช ููุณูุฑ ุญุชู ูู ุงูุฃูุธูุฉ ุงูููุฒุนุฉ</a></li>
<li><a href="../ar426401/index.html">ุณุชููู ุฃูุงุฒูู ุจุชุนููู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงูุฎุงุต ุจูุง ูุชุนุฑูู ุงูุนูุงุทู ุงูุจุดุฑูุฉ</a></li>
<li><a href="../ar426405/index.html">ูุฑุงุตูุฉ ูู ุฅุทุงุฑ ููุงููู ุงูุงุชุญุงุฏ ุงูุฑูุณู</a></li>
<li><a href="../ar426407/index.html">ููููุฉ ุฌุนู ุงูุฑุญูุฉ ุฅูู ุงููุคุชูุฑ ุนุฏููุฉ ุงููุงุฆุฏุฉ ูุฏุฑ ุงูุฅููุงู</a></li>
<li><a href="../ar426409/index.html">ุฃุตุจุญ ุงููุฑุงุตูุฉ ุฃูููุณู ุ ุงูุฐู ูุญูู ุฃุฌูุฒุฉ ุงูุชูุฌูู MikroTik ุฏูู ุฅุฐู ูู ุงููุงูููู ุ ูุดููุฑูุง</a></li>
<li><a href="../ar426413/index.html">ูุจุงุฏุฆ ุตูุจุฉ ูุฌุจ ุนูู ูู ูุทูุฑ ูุนุฑูุชูุง</a></li>
<li><a href="../ar426415/index.html">Fintech-digest: ุงูุชุญูู ูู ุฑูููุฉ ุงูุจูู ุงููุฑูุฒู ุ ุฑุงุชุจ ุงูุนููุฉ ุงููุดูุฑุฉ ุ ุจุทุงูุฉ Mir ุนูู ุดูู ุฃุณุงูุฑ ูุญููุงุช ููุงุชูุญ</a></li>
<li><a href="../ar426417/index.html">Pavel 2.0: ุงุณุชุดุงุฑู ุฒุงุฆู ุนูู JS ุ node.js ูุน ูุขุฎุฐ ููุงุชู</a></li>
<li><a href="../ar426419/index.html">ููููุน ุทุฑู ุงูุชุญููู ุงูุฒุงุฆุฏ ุฃู ุงูุฌุณุฑ ูู ุฌุงูุง</a></li>
<li><a href="../ar426421/index.html">EHCI ุฅูุณุงููุง ุจุงููุบุฉ ุงูุฑูุณูุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>