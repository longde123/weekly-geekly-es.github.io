<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☁️ 🙅🏼 🧡 Perpustakaan generator kode assembler untuk mikrokontroler AVR. Bagian 3 👩‍👧‍👧 🧞 👨🏼‍💻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="← Bagian 2. Memulai 
 Bagian 4. Memprogram perangkat periferal dan menangani interupsi → 
 Perpustakaan Generator Kode Assembler untuk Mikrokontroler ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Perpustakaan generator kode assembler untuk mikrokontroler AVR. Bagian 3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463123/"><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">← Bagian 2. Memulai</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagian 4. Memprogram perangkat periferal dan menangani interupsi →</a> </p><br><h2 id="biblioteka-generatora-assemblernogo-koda-dlya-mikrokontrollerov-avr">  Perpustakaan Generator Kode Assembler untuk Mikrokontroler AVR </h2><br><h3 id="chast-3-kosvennaya-adresaciya-i-upravlenie-potokom-ispolneniya">  Bagian 3. Pengalamatan tidak langsung dan kontrol aliran </h3><br><p>  Pada bagian sebelumnya, kami membahas secara rinci tentang bekerja dengan variabel register 8-bit.  Jika Anda melewatkan posting sebelumnya, saya sarankan Anda untuk membacanya.  Di sana, Anda dapat menemukan tautan ke perpustakaan untuk mencoba sendiri contoh-contoh dalam artikel tersebut.  Bagi mereka yang mengunduh perpustakaan sebelumnya, saya sarankan mengunduh versi terbaru, karena perpustakaan terus diperbarui dan beberapa contoh mungkin tidak berfungsi di versi lama perpustakaan. </p><a name="habracut"></a><br><p>  Sayangnya, kedalaman bit dari variabel register yang sebelumnya dianggap jelas tidak cukup untuk digunakan sebagai pointer memori.  Oleh karena itu, sebelum melanjutkan langsung ke diskusi tentang pointer, kami mempertimbangkan kelas lain dari deskripsi data.  Sebagian besar perintah dalam arsitektur AVR Mega dirancang untuk bekerja hanya dengan register operan, mis., Kedua operan dan hasilnya berukuran 8 bit.  Namun, ada sejumlah operasi di mana dua register RON yang ditempatkan secara berurutan dianggap sebagai register 16-bit tunggal.  Ada beberapa operasi seperti itu, dan mereka terutama berfokus pada bekerja dengan pointer. </p><br><p>  Dari sudut pandang sintaks perpustakaan, bekerja dengan pasangan register hampir sama dengan bekerja dengan variabel register.  Pertimbangkan contoh kecil di mana kami mencoba bekerja dengan pasangan register.  Untuk menghemat ruang di sini dan di bawah, kami akan memberikan hasil eksekusi hanya jika diperlukan untuk menjelaskan fitur-fitur tertentu dari pembuatan kode. </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dr1 = m.DREG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dr2 = m.DREG(); dr1.Load(<span class="hljs-number"><span class="hljs-number">0xAA55</span></span>); dr2.Load(<span class="hljs-number"><span class="hljs-number">0x55AA</span></span>); dr1++; dr1--; dr1 += <span class="hljs-number"><span class="hljs-number">0x100</span></span>; dr1 += dr2; dr2 *= dr1; dr2 /= dr1; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  Dalam contoh ini, kami mendeklarasikan dua variabel 2-byte yang terletak di pasangan register menggunakan perintah DREG ().  Dengan perintah berikut, kami menetapkan nilai awal dan melakukan serangkaian operasi aritmatika.  Seperti yang Anda lihat dari contoh, sintaks untuk bekerja dengan pasangan register sebagian besar sama dengan bekerja dengan register biasa.  Pasangan register juga dapat dianggap sebagai variabel yang terdiri dari dua register independen.  Register diakses sebagai kumpulan dua register 8-bit melalui properti <em>Tinggi</em> untuk mengakses 8 bit atas sebagai register 8-bit, dan properti <em>Rendah</em> untuk mengakses 8 bit yang lebih rendah.  Kode akan terlihat seperti ini </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dr1 = m.DREG(); dr1.Load(<span class="hljs-number"><span class="hljs-number">0xAA55</span></span>); dr1.Low--; dr1.High += dr1.Low; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  Seperti yang Anda lihat dari contoh, kita dapat bekerja dengan <em>Tinggi</em> dan <em>Rendah</em> sebagai variabel register independen, termasuk melakukan berbagai operasi aritmatika dan logis di antara mereka. </p><br><p>  Sekarang setelah kami menemukan variabel panjang-ganda, kami dapat mulai menjelaskan cara bekerja dengan variabel dalam memori.  Perpustakaan memungkinkan Anda untuk bekerja dengan 8, 16-bit variabel dan array byte yang panjangnya sewenang-wenang.  Pertimbangkan contoh alokasi ruang untuk variabel dalam RAM. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bt = m.BYTE(); <span class="hljs-comment"><span class="hljs-comment">//8-    var wd = m.WORD(); //16-    var arr = m.ARRAY(16); //  16  var t = AVRASM.Text(m);</span></span></code> </pre> <br><p>  Mari kita lihat apa yang terjadi. </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0002</span></span></span><span class="hljs-function">: .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BYTE</span></span></span><span class="hljs-function"> 16 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0001</span></span></span><span class="hljs-function">: .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BYTE</span></span></span><span class="hljs-function"> 2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0000</span></span></span><span class="hljs-function">: .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BYTE</span></span></span><span class="hljs-function"> 1</span></span></code> </pre> <br><p>  Di bagian definisi data, kami memiliki alokasi memori.  Perhatikan bahwa urutan alokasi berbeda dari deklarasi variabel.  Ini bukan kebetulan.  Alokasi memori untuk variabel terjadi setelah pengurutan dalam urutan menurun sesuai dengan kriteria berikut (dalam urutan menurunnya kepentingan) Kelipatan pembagi maksimum derajat 2 → Ukuran memori yang dialokasikan.  Ini berarti bahwa jika kita ingin mengalokasikan 4 array berukuran 64, 48,40, dan 16 byte, maka urutan alokasi, terlepas dari urutan deklarasi, akan terlihat seperti ini: </p><br><p>  Panjang 64 - Kelipatan Pembagi Maksimum Gelar 2 = 64 <br>  Panjang 48 - Kelipatan Pembagi Maksimum Derajat 2 = 16 <br>  Panjang 16 - Pembagi maksimum kelipatan derajat 2 = 16 <br>  Panjang 40 - Kelipatan Pembagi Maksimum Derajat 2 = 8 <br>  Ini dilakukan untuk menyederhanakan kontrol batas array. <br>  dan mengurangi ukuran kode dalam operasi dengan pointer.  Kami tidak dapat secara langsung melakukan operasi dengan variabel dalam memori, oleh karena itu semua yang tersedia bagi kami adalah membaca / menulis untuk mendaftarkan variabel.  Cara paling sederhana untuk bekerja dengan variabel dalam memori adalah pengalamatan langsung. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bt = m.BYTE(); <span class="hljs-comment"><span class="hljs-comment">// 8-    var rr = m.REG(); //    rr.Load(0xAA); //  rr   0xAA rr.Mstore(bt); //     rr.Clear(); //  rr.Mload(bt); //    var t = AVRASM.Text(m);</span></span></code> </pre> <br><p>  Dalam contoh ini, kami mendeklarasikan variabel dalam memori dan variabel register.  Setelah itu, kami menetapkan variabel nilai 0x55 dan menulisnya ke dalam variabel dalam memori.  Kemudian dihapus dan dikembalikan lagi. </p><br><p>  Untuk bekerja dengan elemen array, kami menggunakan sintaks berikut </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr = m.REG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arr = m.ARRAY(<span class="hljs-number"><span class="hljs-number">10</span></span>); rr.MLoad(arr[<span class="hljs-number"><span class="hljs-number">5</span></span>]);</code> </pre> <br><p>  Penomoran elemen dalam array dimulai dengan 0. Dengan demikian, dalam contoh di atas, nilai 6 elemen array ditulis ke sel rr. </p><br><p>  Sekarang Anda bisa pergi ke pengalamatan tidak langsung.  Perpustakaan memiliki tipe data sendiri untuk pointer ke ruang memori RAM - <em>MEMPtr</em> .  Mari kita lihat bagaimana kita bisa menggunakannya.  Kami memodifikasi contoh kami sebelumnya sehingga pekerjaan dengan variabel dalam memori dilakukan melalui pointer. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bt1 = m.BYTE(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bt2 = m.BYTE(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr = m.REG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ptr = m.MEMPTR(); <span class="hljs-comment"><span class="hljs-comment">//  ptr ptr.Load(bt1); //ptr   bt1 rr.Load(0xAA); // rr - 0xAA ptr.MStore(rr); //  bt1 0xAA rr.Load(0x55); // rr - 0x55 ptr.Load(bt2); //ptr   bt2 ptr.MStore(rr); //  bt2 0x55 ptr.Load(bt1); //ptr   bt1 ptr.MLoad(rr); //  rr  0xAA var t = AVRASM.Text(m);</span></span></code> </pre> <br><p>  Itu bisa dilihat dari teks yang pertama kita nyatakan <em>pointer ptr</em> , dan kemudian dilakukan operasi tulis dan baca dengannya.  Selain kemampuan untuk mengubah alamat baca / tulis dalam perintah selama eksekusi, penggunaan pointer menyederhanakan bekerja dengan array, menggabungkan operasi baca / tulis dengan kenaikan / penurunan pointer.  Mari kita lihat sebuah program yang dapat mengisi array dengan nilai tertentu. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bt1 = m.ARRAY(<span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   4  var rr = m.REG(); var ptr = m.MEMPTR(); ptr.Load(bt1.Label); //ptr   bt1 rr.Load(0xAA); // rr - 0xAA ptr.MStoreInc(rr); //  bt1 0xAA ptr.MStoreInc(rr); //  bt1+1 0xAA ptr.MStoreInc(rr); //  bt1+2 0xAA ptr.MStoreInc(rr); //  bt1+3 0xAA rr.Clear(); rr.MLoad(bt1[2]); //  rr 3-   var t = AVRASM.Text(m);</span></span></code> </pre> <br><p>  Dalam contoh ini, kami mengambil keuntungan dari kemampuan untuk menambah pointer saat menulis ke memori. <br>  Selanjutnya, kita beralih ke kemampuan perpustakaan untuk mengontrol aliran perintah.  Jika lebih mudah, cara memprogram lompatan bersyarat dan lompatan bersyarat menggunakan perpustakaan.  Cara termudah untuk mengelola ini adalah dengan menggunakan perintah navigasi label.  Label dalam suatu program dinyatakan dengan dua cara berbeda.  Yang pertama adalah bahwa dengan tim <em>AVRASM.Label</em> kami membuat label untuk digunakan di masa depan, tetapi jangan memasukkannya ke dalam kode program.  Metode ini digunakan untuk membuat lompatan maju, yaitu, dalam kasus di mana perintah lompat harus mendahului label.  Untuk mengatur label di tempat yang diperlukan dari kode assembler, Anda harus menjalankan perintah <em>AVRASM.newLabel ([variabel dari label yang dibuat sebelumnya])</em> .  Untuk kembali, Anda dapat menggunakan sintaksis yang lebih sederhana dengan mengatur label dan menetapkan nilainya ke variabel dengan satu perintah <em>AVRASM.newLabel ()</em> tanpa parameter. </p><br><p>  Jenis transisi yang paling sederhana adalah transisi tanpa syarat.  Untuk menyebutnya, kami menggunakan perintah <em>GO ([jump_mark]]</em> .  Mari kita lihat tampilannya dengan sebuah contoh. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = m.REG(); <span class="hljs-comment"><span class="hljs-comment">//  var lbl1 = AVRASM.Label;//        m.GO(lbl1); r++; //    r++; AVRASM.NewLabel(lbl1);//  //  var lbl2 = AVRASM.NewLabel();//    r--; //    r--; m.GO(lbl2); var t = AVRASM.Text(m);</span></span></code> </pre> <br><p>  Transisi bersyarat memiliki kontrol lebih besar atas aliran eksekusi.  Perilaku mereka tergantung pada keadaan bendera operasi dan ini memungkinkan untuk mengontrol aliran operasi tergantung pada hasil eksekusi mereka.  Pustaka menggunakan fungsi <em>IF</em> untuk menggambarkan blok perintah yang harus dijalankan hanya dalam kondisi tertentu.  Mari kita lihat sebuah contoh. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr1 = m.REG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr2 = m.REG(); rr1.Load(<span class="hljs-number"><span class="hljs-number">0x22</span></span>); rr2.Load(<span class="hljs-number"><span class="hljs-number">0x33</span></span>); m.IF(rr1 == rr2, () =&gt; { AVRASM.Comment(<span class="hljs-string"><span class="hljs-string">" - ,  "</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  Karena sintaks dari perintah <em>IF</em> tidak cukup familiar, pertimbangkan lebih detail.  Argumen pertama di sini adalah kondisi transisi.  Berikut ini adalah metode di mana blok kode ditempatkan, yang harus dieksekusi jika kondisi terpenuhi.  Varian fungsi adalah kemampuan untuk menggambarkan cabang alternatif, mis., Blok kode yang harus dijalankan jika kondisi tidak terpenuhi.  Selain itu, Anda dapat memperhatikan fungsi <em>AVRASM.Comment ()</em> , yang dengannya kami dapat menambahkan komentar ke assembler output. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr1 = m.REG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr2 = m.REG(); rr1.Load(<span class="hljs-number"><span class="hljs-number">0x22</span></span>); rr2.Load(<span class="hljs-number"><span class="hljs-number">0x33</span></span>); m.IF(rr1 == rr2, () =&gt; { AVRASM.Comment(<span class="hljs-string"><span class="hljs-string">" - ,  "</span></span>); },()=&gt; { AVRASM.Comment(<span class="hljs-string"><span class="hljs-string">" - ,   "</span></span>); }); AVRASM.Comment(<span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  Hasilnya dalam hal ini akan terlihat sebagai berikut </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r20</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r21</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,34 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function">,51 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cp</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brne</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0002</span></span></span><span class="hljs-function"> ;---  - ,   --- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xjmp</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0004</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0002</span></span></span><span class="hljs-function">: ;---  - ,    --- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0004</span></span></span><span class="hljs-function">: ;---   --- .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span></span></code> </pre> <br><p>  Contoh sebelumnya menunjukkan opsi percabangan bersyarat di mana perintah perbandingan digunakan untuk menentukan kondisi percabangan.  Dalam beberapa kasus, ini tidak diperlukan, karena kondisi transisi harus ditentukan oleh keadaan bendera setelah operasi terakhir dilakukan.  Sintaks berikut disediakan untuk kasus-kasus seperti itu. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr1 = m.REG(); rr1.Load(<span class="hljs-number"><span class="hljs-number">0x22</span></span>); rr1--; m.IFEMPTY(() =&gt;AVRASM.Comment(<span class="hljs-string"><span class="hljs-string">",    0"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  Dalam contoh ini, fungsi <em>IFEMPTY</em> memeriksa status bendera Z setelah kenaikan dan mengeksekusi kode dari blok bersyarat saat mencapai 0. <br>  Yang paling fleksibel dalam hal penggunaan dapat dianggap sebagai fungsi <em>LOOP</em> .  Ini dimaksudkan untuk deskripsi siklus program yang nyaman.  Pertimbangkan tanda tangannya </p><br><pre> <code class="cs hljs">LOOP(Register iter, Action&lt;Register, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; Condition, Action&lt;Register, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; body)</code> </pre> <br><p>  Parameter <em>iter</em> memberikan variabel register yang dapat digunakan sebagai iterator dalam satu loop.  Parameter kedua berisi blok kode yang menggambarkan kondisi untuk keluar dari loop.  Iterator yang ditetapkan dan label awal dari loop untuk kembali dilewatkan ke blok kode ini.  Parameter terakhir digunakan untuk menggambarkan blok kode dari badan utama loop.  Contoh paling sederhana menggunakan fungsi <em>LOOP</em> adalah loop rintisan, yaitu loop tak terbatas untuk melompat ke baris yang sama.  Sintaks dalam hal ini adalah sebagai berikut </p><br><pre> <code class="cs hljs">m.LOOP(m.TempL, (r, l) =&gt; m.GO(l), (r,l) =&gt; { });</code> </pre> <br><p>  Hasil kompilasi diberikan di bawah ini. </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">L0002: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xjmp</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0002</span></span></span></span></code> </pre> <br><p>  Mari kita kembali ke contoh pengisian array dengan nilai tertentu dan mengubahnya sehingga pengisian dilakukan dalam satu lingkaran </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr1 = m.REG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr2 = m.REG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arr = m.ARRAY(<span class="hljs-number"><span class="hljs-number">16</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ptr = m.MEMPTR(); ptr.Load(arr[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-comment"><span class="hljs-comment">//     rr2.Load(16); //    rr1.Load(0xAA); //   m.LOOP(rr2, (r, l) =&gt; //rr2     . { r--; //   m.IFNOTEMPTY(l); // ,   }, (r,l) =&gt; ptr.MStoreInc(rr1)); //   var t = AVRASM.Text(m);</span></span></code> </pre> <br><p>  Kode keluaran dalam hal ini akan terlihat sebagai berikut </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r20</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r21</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YL</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LOW</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0002</span></span></span><span class="hljs-function">+0) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YH</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HIGH</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0002</span></span></span><span class="hljs-function">+0) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function">,16 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,170 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0003</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">st</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-function">+,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dec</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brne</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0003</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0004</span></span></span><span class="hljs-function">: .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0002</span></span></span><span class="hljs-function">: .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BYTE</span></span></span><span class="hljs-function"> 16</span></span></code> </pre> <br><p>  Cara lain untuk mengatur transisi adalah melalui transisi yang ditangani secara tidak langsung.  Analog terdekat dalam bahasa tingkat tinggi bagi mereka adalah penunjuk ke fungsi.  Pointer dalam hal ini tidak akan menunjuk ke ruang RAM, tetapi ke kode program.  Karena AVR memiliki arsitektur Harvard dan menggunakan serangkaian instruksi spesifik untuk mengakses memori program, ROMPtr digunakan sebagai penunjuk daripada MEMPtr yang dijelaskan di atas.  Kasus penggunaan untuk transisi yang ditangani secara tidak langsung dapat diilustrasikan dengan contoh berikut. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block1 = AVRASM.Label; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block2 = AVRASM.Label; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block3 = AVRASM.Label; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ptr = m.ROMPTR(); ptr.Load(block1); <span class="hljs-comment"><span class="hljs-comment">//     var loop = AVRASM.NewLabel(); AVRASM.Comment("   "); m.GOIndirect(ptr); //   ,     AVRASM.NewLabel(block1); AVRASM.Comment("  1"); ptr.Load(block2); m.GO(loop); AVRASM.NewLabel(block2); AVRASM.Comment("  2"); ptr.Load(block3); m.GO(loop); AVRASM.NewLabel(block3); AVRASM.Comment("  3"); ptr.Load(block1); m.GO(loop); var t = AVRASM.Text(m);</span></span></code> </pre> <br><p>  Dalam contoh ini, kami memiliki 3 blok perintah.  Setelah menyelesaikan setiap blok, kontrol ditransfer kembali ke perintah cabang yang ditangani secara tidak langsung.  Karena pada akhir blok perintah kita mengatur vektor transisi ke blok baru setiap kali, eksekusi akan terlihat seperti Block1 → Block2 → Block3 → Block1 ... dan seterusnya dalam lingkaran.  Perintah ini, bersama-sama dengan perintah cabang kondisional, memungkinkan cara bahasa yang sederhana dan nyaman untuk menggambarkan algoritma yang cukup rumit seperti mesin negara. </p><br><p>  Versi yang lebih canggih dari cabang yang ditangani secara tidak langsung adalah perintah <em>SWITCH</em> .  Itu tidak menggunakan pointer ke label transisi untuk transisi, tetapi pointer ke variabel di memori di mana alamat label transisi disimpan. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block1 = AVRASM.Label; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block2 = AVRASM.Label; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block3 = AVRASM.Label; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arr = m.ARRAY(<span class="hljs-number"><span class="hljs-number">6</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ptr = m.MEMPTR(); <span class="hljs-comment"><span class="hljs-comment">//    m.Temp.Load(block1); m.Temp.Store(arr[0]); m.Temp.Load(block2); m.Temp.Store(arr[2]); m.Temp.Load(block3); m.Temp.Store(arr[4]); ptr.Load(arr[0]); //     var loop = AVRASM.NewLabel(); m.SWITCH(ptr); //   ,     AVRASM.NewLabel(block1); AVRASM.Comment("  1"); ptr.Load(arr[2]); //       m.GO(loop); AVRASM.NewLabel(block2); AVRASM.Comment("  2"); m.Temp.Load(block3); ptr.MStore(m.Temp); //       m.GO(loop); AVRASM.NewLabel(block3); AVRASM.Comment("  3"); ptr.Load(arr[0]); //       m.GO(loop);</span></span></code> </pre> <br><p>  Dalam contoh ini, urutan transisi adalah sebagai berikut: Block1 → Block2 → Block3 → Block1 → Block3 → Block1 → Block3 → Block1 ... Kami dapat menerapkan algoritma di mana perintah Block2 dieksekusi hanya pada siklus pertama. </p><br><p>  Di bagian posting selanjutnya, kami akan mempertimbangkan untuk bekerja dengan perangkat periferal, menerapkan interupsi, rutinitas, dan banyak lagi. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id463123/">https://habr.com/ru/post/id463123/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id463107/index.html">ShIoTiny: otomatisasi kecil, Internet, atau "enam bulan sebelum liburan"</a></li>
<li><a href="../id463113/index.html">Kontrol Data dan Model Versi dalam pertemuan Visi Komputer</a></li>
<li><a href="../id463115/index.html">Masalah pintu dalam desain penembak</a></li>
<li><a href="../id463117/index.html">Preloading dalam PHP 7.4</a></li>
<li><a href="../id463121/index.html">Kami makan gajah di beberapa bagian. Contoh Aplikasi Strategi Pemantauan Kesehatan</a></li>
<li><a href="../id463125/index.html">OOP dalam gambar</a></li>
<li><a href="../id463127/index.html">Pemantauan UPS. Bagian Dua - Analisis Otomatis</a></li>
<li><a href="../id463135/index.html">Di negara mana yang menguntungkan untuk mendaftarkan perusahaan IT pada 2019?</a></li>
<li><a href="../id463137/index.html">Bahkan jika Anda ingin menjadi perancang permainan, tidak ada yang akan mengajari Anda caranya</a></li>
<li><a href="../id463141/index.html">Habr Weekly # 13 / Di bawah ancaman 1,5 juta pengguna layanan kencan, investigasi Medusa, deanon Rusia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>