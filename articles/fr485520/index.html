<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💦 👨🏻‍✈️ 🧑🏽‍🤝‍🧑🏽 QueryFilter: le concept de modèles de filtrage 🐺 👩🏻‍🏭 😨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je souhaite attirer votre attention sur le concept d'organisation du filtrage par demande d'URL. Par exemple, j'utiliserai le langage PHP et le framew...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>QueryFilter: le concept de modèles de filtrage</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485520/">  Je souhaite attirer votre attention sur le concept d'organisation du filtrage par demande d'URL.  Par exemple, j'utiliserai le langage PHP et le framework Laravel. <br><br><h4>  Concept </h4><br>  L'idée est de créer une classe <i>QueryFilter</i> universelle pour travailler avec des filtres. <br><br><pre><code class="php hljs">GET /posts?title=source&amp;status=active</code> </pre> <br>  En utilisant cet exemple, nous filtrerons les <i>publications</i> (modèle de publication) selon les critères suivants: <br><br><ul><li>  La présence du mot "source" dans le champ <i>titre</i> ; </li><li>  La valeur "publier" dans le champ d' <i>état</i> ; </li></ul><a name="habracut"></a><br><h4>  Exemple d'application </h4><br>  Modèle de <i>poste</i> <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Eloquent</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * The attributes that are mass assignable. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $fillable = [ <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'slug'</span></span>, <span class="hljs-string"><span class="hljs-string">'status'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span>, <span class="hljs-string"><span class="hljs-string">'published_at'</span></span>, <span class="hljs-string"><span class="hljs-string">'updated_at'</span></span>, ]; }</code> </pre><br>  Ajouter un itinéraire: <br><br><pre> <code class="php hljs">Route::get(<span class="hljs-string"><span class="hljs-string">'/posts'</span></span>, <span class="hljs-string"><span class="hljs-string">'PostController@index'</span></span>);</code> </pre> <br>  Créez un fichier <i>Resource \ Post</i> pour la sortie au <i>format JSON</i> : <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Resources</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Resources</span></span>\<span class="hljs-title"><span class="hljs-title">Json</span></span>\<span class="hljs-title"><span class="hljs-title">JsonResource</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonResource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Transform the resource into an array. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Http\Request $request * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($request)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ID, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post_title, <span class="hljs-string"><span class="hljs-string">'slug'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post_name, <span class="hljs-string"><span class="hljs-string">'status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post_status, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post_type, <span class="hljs-string"><span class="hljs-string">'published_at'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post_date, <span class="hljs-string"><span class="hljs-string">'updated_at'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post_modified, ]; } }</code> </pre><br>  Et le contrôleur lui-même avec une seule action: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Controllers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Resources</span></span>\<span class="hljs-title"><span class="hljs-title">Post</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">PostResource</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Post</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \Illuminate\Http\Resources\Json\AnonymousResourceCollection */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $posts = Post::limit(<span class="hljs-number"><span class="hljs-number">10</span></span>)-&gt;get(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PostResource::collection($posts); } }</code> </pre><br>  Le filtrage standard est organisé par le code suivant: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \Illuminate\Http\Resources\Json\AnonymousResourceCollection */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function"> </span></span>{ $query = Post::limit(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($request-&gt;filled(<span class="hljs-string"><span class="hljs-string">'status'</span></span>)) { $query-&gt;where(<span class="hljs-string"><span class="hljs-string">'post_status'</span></span>, $request-&gt;get(<span class="hljs-string"><span class="hljs-string">'status'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($request-&gt;filled(<span class="hljs-string"><span class="hljs-string">'title'</span></span>)) { $title = $request-&gt;get(<span class="hljs-string"><span class="hljs-string">'title'</span></span>); $query-&gt;where(<span class="hljs-string"><span class="hljs-string">'post_title'</span></span>, <span class="hljs-string"><span class="hljs-string">'like'</span></span>, <span class="hljs-string"><span class="hljs-string">"%$title%"</span></span>); } $posts = $query-&gt;get(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PostResource::collection($posts); }</code> </pre><br>  Avec cette approche, nous sommes confrontés à la croissance du contrôleur, ce qui n'est pas souhaitable. <br><br><h4>  Implémentation de QueryFilter </h4><br>  La signification d'un tel concept est d'utiliser une classe distincte pour chaque entité qui mappe les méthodes à chaque champ pour le filtrage. <br><br>  Filtrer par demande: <br><br><pre> <code class="php hljs">GET /posts?title=source&amp;status=publish</code> </pre> <br>  Pour le filtrage, nous aurons la classe <i>PostFilter</i> et les méthodes <i>title ()</i> et <i>status ()</i> .  <i>PostFilter</i> étendra la classe abstraite <i>QueryFiler</i> qui est responsable de la correspondance des méthodes de classe avec les paramètres passés. <br><br>  <b>Méthode <i>applicable ()</i></b> <br><br>  La classe <i>QueryFIlter</i> possède une méthode <i>apply ()</i> , qui est chargée d' <i>appeler les</i> filtres qui se trouvent dans la classe enfant <i>PostFilter</i> . <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Filters</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Eloquent</span></span>\<span class="hljs-title"><span class="hljs-title">Builder</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Request</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QueryFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Request */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $request; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Builder */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $builder; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request = $request; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Builder $builder */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Builder $builder)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;builder = $builder; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;fields() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $field =&gt; $value) { $method = camel_case($field); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method_exists(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, $method)) { call_user_func_array([<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, $method], (<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>)$value); } } } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> array_filter( array_map(<span class="hljs-string"><span class="hljs-string">'trim'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;all()) ); } }</code> </pre><br>  L'essentiel est que pour chaque champ passé par <i>Request,</i> nous avons une méthode distincte dans la classe de filtre enfant (classe PostFilter).  Cela nous permet de personnaliser la logique de chaque champ de filtre. <br><br>  <b>Classe <i>PostFilter</i></b> <br><br>  Passons maintenant à la création d'une classe <i>PostFilter qui</i> étend <i>QueryFilter</i> .  Comme mentionné précédemment, cette classe doit contenir des méthodes pour chaque champ par lequel nous devons filtrer.  Dans notre cas, les méthodes <i>title ($ value)</i> et <i>status ($ value)</i> <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Filters</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Eloquent</span></span>\<span class="hljs-title"><span class="hljs-title">Builder</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostFilter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QueryFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $status */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">status</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $status)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;builder-&gt;where(<span class="hljs-string"><span class="hljs-string">'post_status'</span></span>, strtolower($status)); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $title */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">title</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $title)</span></span></span><span class="hljs-function"> </span></span>{ $words = array_filter(explode(<span class="hljs-string"><span class="hljs-string">' '</span></span>, $title)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;builder-&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Builder $query)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($words)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($words <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $word) { $query-&gt;where(<span class="hljs-string"><span class="hljs-string">'post_title'</span></span>, <span class="hljs-string"><span class="hljs-string">'like'</span></span>, <span class="hljs-string"><span class="hljs-string">"%$word%"</span></span>); } }); } }</code> </pre><br>  Ici, je ne vois aucune raison pour une analyse détaillée de chacune des méthodes, des requêtes assez standard.  Le fait est que nous avons maintenant une méthode distincte pour chaque champ et que nous pouvons utiliser toute logique dont nous avons besoin pour former la demande. <br><br>  <b>Créer <i>scopeFilter ()</i></b> <br><br>  Maintenant, nous devons lier le concepteur de modèle et de requête <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Builder $builder * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> QueryFilter $filter */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scopeFilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Builder $builder, QueryFilter $filter)</span></span></span><span class="hljs-function"> </span></span>{ $filter-&gt;apply($builder); }</code> </pre><br>  Pour effectuer une recherche, nous devons appeler la méthode <i>filter ()</i> et passer une instance de <i>QueryFilter</i> , dans notre cas <i>PostFilter</i> . <br><br><pre> <code class="php hljs">$filteredPosts = Post::filter($postFilter)-&gt;get();</code> </pre> <br>  Ainsi, toute la logique de filtrage est traitée en appelant la méthode de <i>filtrage ($ postFilter)</i> , sauvant le contrôleur d'une logique inutile. <br><br>  Pour faciliter la réutilisation, vous pouvez mettre la méthode <i>scopeFilter</i> dans le trait et l'utiliser pour chaque modèle qui doit être filtré. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Filters</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Eloquent</span></span>\<span class="hljs-title"><span class="hljs-title">Builder</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> Filterable { <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Builder $builder * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> QueryFilter $filter */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scopeFilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Builder $builder, QueryFilter $filter)</span></span></span><span class="hljs-function"> </span></span>{ $filter-&gt;apply($builder); } }</code> </pre><br>  Dans la <i>publication,</i> ajoutez: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CorcelPost</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Filterable</span></span>;</code> </pre><br>  Il reste à ajouter <i>index ()</i> à la méthode du contrôleur en tant <i>que</i> paramètre <i>PostFilter</i> et appeler la méthode du modèle <i>filter ()</i> . <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> PostFilter $filter * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \Illuminate\Http\Resources\Json\ResourceCollection */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PostFilter $filter)</span></span></span><span class="hljs-function"> </span></span>{ $posts = Post::filter($filter)-&gt;limit(<span class="hljs-number"><span class="hljs-number">10</span></span>)-&gt;get(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PostResource::collection($posts); } }</code> </pre><br>  C’est tout.  Nous avons déplacé toute la logique de filtrage vers la classe appropriée, en respectant le principe de responsabilité unique (S dans le système de principes SOLID) <br><br><h2>  Conclusion </h2><br>  Cette approche de la mise en œuvre des filtres vous permet de vous en tenir au contrôleur fin de remorque, et facilite également la rédaction des tests. <br><br>  Voici un exemple utilisant PHP et Laravel.  Mais comme je l'ai dit, c'est un concept qui peut fonctionner avec n'importe quel langage ou framework. <br><br><h4>  Les références </h4><br><ul><li>  <a href="https://blog.jgrossi.com/">Blog</a> Junior Grossi </li><li>  <a href="https://packagist.org/packages/kblais/query-filter">Paquet prêt à l'emploi</a> de Killian Blais </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr485520/">https://habr.com/ru/post/fr485520/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr485504/index.html">En interdisant la reconnaissance faciale, nous manquons le point</a></li>
<li><a href="../fr485508/index.html">En route vers un SGBD fonctionnel et un ERP NoSQL: stockage des soldes et chiffrage</a></li>
<li><a href="../fr485510/index.html">Comment lancer un produit seul si vous êtes développeur: conseils du créateur de Laravel, Taylor Otvel. Partie 3: N'abandonnez pas</a></li>
<li><a href="../fr485514/index.html">EBlink - Serveur GDB pour microcontrôleurs ARM Cortex-M</a></li>
<li><a href="../fr485518/index.html">Essayer de composer le non-composable: soulever tout</a></li>
<li><a href="../fr485522/index.html">Hack The Box - Walkthrough AI. SQLi dans le texte API à atteindre, le transfert SSH et RCE dans JDWP</a></li>
<li><a href="../fr485524/index.html">Le condensé de matériaux intéressants pour le développeur mobile # 330 (du 20 au 26 janvier)</a></li>
<li><a href="../fr485526/index.html">Qui et pourquoi veut rendre Internet «partagé»</a></li>
<li><a href="../fr485528/index.html">Comment conclure un projet de développement logiciel de la bonne façon</a></li>
<li><a href="../fr485530/index.html">Apprentissage guidé</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>