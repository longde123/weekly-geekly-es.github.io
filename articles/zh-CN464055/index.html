<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧛🏿 ⏺️ 🔛 我们研究了小米乐队今年收集的数据 🤘🏻 📋 🚣🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="引言 


 人们出于各种原因佩戴健身手镯，我可以假设其中一些： 


1. 为了保持健康并实现活动目标； 
2. 因为这是一件时髦的小事； 
3. 尝试自己或更好地了解自己。 


 我佩戴健身手镯的原因是3。在本文中，我想谈一谈如何从手镯中提取数据并尝试获取一些依赖关系。 


 提取此数据的方...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>我们研究了小米乐队今年收集的数据</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464055/"><h2 id="vvedenie"> 引言 </h2><br><p> 人们出于各种原因佩戴健身手镯，我可以假设其中一些： </p><br><ol><li> 为了保持健康并实现活动目标； </li><li> 因为这是一件时髦的小事； </li><li> 尝试自己或更好地了解自己。 </li></ol><br><p> 我佩戴健身手镯的原因是3。在本文中，我想谈一谈如何从手镯中提取数据并尝试获取一些依赖关系。 </p><br><p> 提取此数据的方法适用于<strong>Mi Band</strong> <strong>1、1S</strong>以及可能的<strong>2</strong> （ <strong>2</strong>的应用程序似乎相同）。 <a name="habracut"></a></p><br><h2 id="izvlechenie-dannyh"> 数据提取 </h2><br><p> 要从手镯中提取数据，首先，您需要从存储所收集指标的SQLite手机中获取数据库。 对于Android，这非常简单， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">请参阅xda-developers论坛上的主题</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">当前数据库的脚本</a> ： </p><br><ol><li> 我们将启用USB调试的Android手机连接到计算机； </li><li>我们对应用程序进行备份： <code>adb backup -f mi.ab -noapk -noshared com.xiaomi.hm.health</code> ; </li><li> 创建<code>dd if=mi.ab bs=1 skip=24 | python -c "import zlib,sys;sys.stdout.write(zlib.decompress(sys.stdin.read()))" &gt; mi.tar</code>  <code>dd if=mi.ab bs=1 skip=24 | python -c "import zlib,sys;sys.stdout.write(zlib.decompress(sys.stdin.read()))" &gt; mi.tar</code> ; </li><li> 从数据库解压缩存档文件： <code>tar xvf mi.tar apps/com.xiaomi.hm.health/db/ 2&gt;&amp;1 | tee -a log</code>  <code>tar xvf mi.tar apps/com.xiaomi.hm.health/db/ 2&gt;&amp;1 | tee -a log</code> ; </li><li> 复制数据库： <code>cp -f apps/com.xiaomi.hm.health/db/origin_db* ./db/</code> 。 </li></ol><br><p> 结果，我们得到了一个SQLite数据库，其文件名为<code>db/origin_db_[0-9]+$</code> ，用于存储Mi Band指标。 </p><br><h2 id="zagruzka-i-analiz-dannyh"> 数据加载与分析 </h2><br><p> 我认为，要研究数据，可以使用IPython笔记本方便： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Xiaomi_Mifit_miband_data.ipynb</a> </p><br><p> 指标存储在DATE_DATA表中： </p><br><pre> <code class="python hljs">df = pd.read_sql_query(<span class="hljs-string"><span class="hljs-string">"SELECT * from DATE_DATA"</span></span>, con)</code> </pre> <br><p> 表中感兴趣的列： </p><br><div class="scrollable-table"><table><thead><tr><th> 专栏 </th><th> 说明 </th></tr></thead><tbody><tr><td>  DATE </td><td> 日期 </td></tr><tr><td> 总结 </td><td> 当天处理过的数据的JSON </td></tr><tr><td> 数据 </td><td> 每次睡眠的每分钟原始数据[活动1]，活动2，活动3 </td></tr><tr><td>  DATA_HR </td><td> 原始分钟心率数据 </td></tr></tbody></table></div><br><h3 id="agregirovannye-za-den-dannye"> 每日汇总数据 </h3><br><p> 汇总数据存储为JSON： </p><br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"slp"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"usrEd"</span></span>:<span class="hljs-number"><span class="hljs-number">-1440</span></span>,<span class="hljs-attr"><span class="hljs-attr">"lt"</span></span>:<span class="hljs-number"><span class="hljs-number">457</span></span>,<span class="hljs-attr"><span class="hljs-attr">"st"</span></span>:<span class="hljs-number"><span class="hljs-number">1464376080</span></span>,<span class="hljs-attr"><span class="hljs-attr">"wk"</span></span>:<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-attr"><span class="hljs-attr">"dp"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-attr"><span class="hljs-attr">"usrSt"</span></span>:<span class="hljs-number"><span class="hljs-number">-1440</span></span>,<span class="hljs-attr"><span class="hljs-attr">"ed"</span></span>:<span class="hljs-number"><span class="hljs-number">1464406200</span></span>},<span class="hljs-attr"><span class="hljs-attr">"v"</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-attr"><span class="hljs-attr">"goal"</span></span>:<span class="hljs-number"><span class="hljs-number">8000</span></span>,<span class="hljs-attr"><span class="hljs-attr">"stp"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"rn"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-attr"><span class="hljs-attr">"cal"</span></span>:<span class="hljs-number"><span class="hljs-number">257</span></span>,<span class="hljs-attr"><span class="hljs-attr">"runDist"</span></span>:<span class="hljs-number"><span class="hljs-number">256</span></span>,<span class="hljs-attr"><span class="hljs-attr">"wk"</span></span>:<span class="hljs-number"><span class="hljs-number">69</span></span>,<span class="hljs-attr"><span class="hljs-attr">"ttl"</span></span>:<span class="hljs-number"><span class="hljs-number">5244</span></span>,<span class="hljs-attr"><span class="hljs-attr">"runCal"</span></span>:<span class="hljs-number"><span class="hljs-number">13</span></span>,<span class="hljs-attr"><span class="hljs-attr">"dis"</span></span>:<span class="hljs-number"><span class="hljs-number">3817</span></span>}}</code> </pre> <br><p> 数据分为两部分：睡眠（ <strong>slp</strong> ）和活动（ <strong>stp</strong> ）。 对于睡眠，将存储开始和结束时间<strong>-st，ed</strong> ，以及深度睡眠和浅睡眠时间（以分钟为单位） <strong>-lt，dp</strong> 。 睡眠开始和结束之间的唤醒时间也被存储<strong>-wk</strong> 。 对于活动，存储“步数” <strong>ttl</strong>的总数-当天的主要传感器读数和其他导出的量<code>func(ttl, , )</code>的总和。 </p><br><h3 id="syrye-dannye-aktivnosti-i-pulsa"> 原始活动和心率数据 </h3><br><p> 原始活动数据每分钟（每天1440）存储一次，代表每分钟3个值。 第一个值是一个梦，值是0到127（但在我的情况下，最大值是126），第二个和第三个值是活动，值是0到255（我的活动最大值是2-189，activity3-240）。 </p><br><p> 脉冲每分钟存储一次，范围从0到255。 </p><br><h2 id="kak-syrye-dannye-prevraschayutsya-v-agregirovannye-za-den"> 每天如何汇总原始数据 </h2><br><p> 最简单的汇总是每天的步骤数-每天的activity3值的总和。 睡眠更困难：我从未学习过如何将原始睡眠数据转换为聚合数据。 在论坛上表达了这个想法，即activity1 == 4的值表示深度睡眠，而5表示轻度，但它不像在聚合数据和原始数据之间建立关系的步骤那样简单。 </p><br><h2 id="analiz-dannyh"> 资料分析 </h2><br><p> 首先，我一年中睡了多少。 原来，该值为〜（7 +1）小时。 一切似乎都可以。 </p><br><p><img src="https://raw.githubusercontent.com/vologab/miband_jupyter_notebook/master/plots/sleep_time_distribution.png" alt="睡觉时间"></p><br><p> 另一个明显的事情-周末我有足够的睡眠： </p><br><p><img src="https://raw.githubusercontent.com/vologab/miband_jupyter_notebook/master/plots/sleep2_time_vs_wd.png" alt="睡眠与工作日"></p><br><p> 如果您将深度睡眠与光线质量的关系称为“最佳睡眠质量”，那么在同一时间，深度睡眠占总睡眠时间的23％。 而在星期五-最糟糕的睡眠质量，我什至都不敢猜出为什么。 </p><br><p><img src="https://raw.githubusercontent.com/vologab/miband_jupyter_notebook/master/plots/sleep_ratio_vs_wd.png" alt="活动与工作日"></p><br><p> 我在星期五和星期六执行的“步骤”的最大数量： </p><br><p><img src="https://raw.githubusercontent.com/vologab/miband_jupyter_notebook/master/plots/activity_steps_vs_wd.png" alt="活动与工作日"></p><br><p> 同时，我的环境是我很少睡觉和很少走路的日子，“我在家工作”类别中没有明显的解释，所以这对我来说是新事物。 </p><br><p> 我希望来自流行的Mi乐队手镯的拥有者也想研究一下自己并讲述其功能。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN464055/">https://habr.com/ru/post/zh-CN464055/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN464039/index.html">神经网络和深度学习：在线教程，第6章，第2部分：图像识别的最新进展</a></li>
<li><a href="../zh-CN464041/index.html">为什么最好的战斗机飞行员经常遇到大麻烦</a></li>
<li><a href="../zh-CN464043/index.html">以太网-CAN转换器的历史</a></li>
<li><a href="../zh-CN464045/index.html">我如何在1997年进行实时比赛</a></li>
<li><a href="../zh-CN464053/index.html">注意：音轨选择和旋转算法</a></li>
<li><a href="../zh-CN464057/index.html">希尔伯特，勒贝格...和虚空</a></li>
<li><a href="../zh-CN464063/index.html">在2019年切断电缆</a></li>
<li><a href="../zh-CN464071/index.html">革命还是痛苦？ Yandex React Hooks报告</a></li>
<li><a href="../zh-CN464075/index.html">C简介 上个世纪的讯息</a></li>
<li><a href="../zh-CN464077/index.html">不，您不需要50 km / s的增量。 您需要附加技术（第1部分）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>