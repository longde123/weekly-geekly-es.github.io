<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîò ü§ú üõ¢Ô∏è Indexeurs en C # sous le capot: mieux indexer que Dow Jones üë©‚Äçüé§ üç∞ üë©üèø‚Äçü§ù‚Äçüë©üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour. Dans cet article, je propose de me familiariser avec les indexeurs de diff√©rents types. Voyons le code du langage assembleur pour ces indexeu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Indexeurs en C # sous le capot: mieux indexer que Dow Jones</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450428/">  Bonjour.  Dans cet article, je propose de me familiariser avec les indexeurs de diff√©rents types.  Voyons le code du langage assembleur pour ces indexeurs et les caract√©ristiques de chaque instruction dans sa vitesse.  Je proposerai √©galement quelques conclusions √©videntes.  Mais ce que vous devez utiliser exactement dans votre situation particuli√®re d√©pend de vous, que ce soit pour sacrifier la commodit√© √† la vitesse ou vice versa. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/22/aw/ng/22awng79cibgcbel1r2v0ahwzc8.png" alt="image" width="100%"></div><a name="habracut"></a><br><h3>  Mesures </h3><br>  Le code du langage d'assemblage est donn√© pour les syst√®mes 64 bits.  Les m√©triques suivantes ont √©t√© choisies comme m√©triques pour chaque instruction: le nombre de micro-op√©rations fusionn√©es, le nombre total de micro-op√©rations, le retard, le d√©bit et, bien s√ªr, le nombre d'instructions.  Je n'ai donn√© aucun chiffre dans son ensemble pour l'indexeur, car  la situation peut varier selon la fa√ßon dont vous travaillez avec le type index√© et affecter le cache diff√©remment. <br><br>  Vous trouverez ci-dessous un bref r√©sum√© de la terminologie, sans approfondir, juste des concepts conceptuels.  Mon objectif √©tait de d√©crire tout aussi simple que possible, pour une compr√©hension commune. <br><br>  <b>La micro-op√©ration (uop)</b> est une certaine op√©ration qui consiste en chaque instruction.  Le concept de micro-op√©rations est utilis√© pour des optimisations telles que la fusion, la mise en cache et la r√©organisation.  Ainsi, par exemple, l'instruction MOV se compose de 1 micro-op√©ration, tandis que l'instruction XCHG sur deux registres se compose de 3 micro-op√©rations (l'approche se fait par le biais d'une ¬´variable temporaire¬ª, c'est-√†-dire un registre interne, merci <i>leotsarev</i> pour la mise √† jour), l'instruction XCHG sur le registre et la m√©moire se compose de 8 micro-op√©rations. <br><br>  <b>Micro-op√©rations fusionn√©es (fusion uops)</b> - comme mentionn√© ci-dessus, la fusion des micro-op√©rations est l'une des optimisations.  Il consiste √† remplacer deux micro-op√©rations par une plus complexe. <br><br>  <b>La latence</b> est le nombre de mesures apr√®s lesquelles les donn√©es utilis√©es dans cette instruction deviendront disponibles pour √™tre utilis√©es par une autre instruction. <br><br>  <b>D√©bit (d√©bit r√©ciproque)</b> - le nombre de cycles d'horloge requis pour ex√©cuter une instruction, √† condition qu'une s√©quence d'instructions identiques soit ex√©cut√©e et qu'elles fonctionnent avec des donn√©es ind√©pendantes. <br><br>  Sur la base de ces indicateurs, vous pouvez √©valuer les performances d'un ensemble d'instructions particulier.  Veuillez noter que nous ne pouvons que "√©valuer", les performances r√©elles d√©pendent de nombreux facteurs, tels que le cache hit ou miss, la d√©pendance aux donn√©es, etc. <br><br>  Ces chiffres concernent l'architecture du processeur Intel Skylake-X.  Cela correspond √† mon processeur Intel Core i7-6700. <br><br>  Il convient √©galement de rappeler que Fastcall pour les syst√®mes 64 bits fournit la transmission non pas de 2, mais de 4 param√®tres dans les registres (rcx, rdx, r8, r9). <br><br><h3>  Indexeurs en chiffres </h3><br><h4>  1. Indexeur de tableau </h4><br>  Nous consid√©rerons les m√©thodes suivantes √† titre d'exemple: <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IndexerArray</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] array</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> array[index]; }</code> </pre> <br>  Consid√©rez le code du langage assembleur pour cet extrait. <br><br><pre> <code class="plaintext hljs">1. cmp edx,dword ptr [r8+8] 2. jae 00007ff9`07288c78 3. movsxd rax,edx 4. mov eax,dword ptr [r8+rax*4+10h]</code> </pre><br>  La premi√®re ligne v√©rifie si l'index d√©passe les limites du tableau.  La deuxi√®me ligne l√®ve une exception si elle se termine.  Ensuite, nous calculons la position de l'√©l√©ment dans le tableau.  Les premiers champs du tableau sont des informations de service, nous devons donc les ignorer (10h suppl√©mentaires = 16 octets). <br><br><div class="spoiler">  <b class="spoiler_title">Informations sur les instructions:</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><th>  Non. </th><th>  Uops fondus </th><th>  Total uops </th><th>  Latence </th><th>  D√©bit r√©ciproque </th></tr><tr><td>  1 </td><td>  1 </td><td>  2 </td><td>  1 </td><td>  0,5 </td></tr><tr><td>  2 </td><td>  1 </td><td>  1 </td><td></td><td>  1-2 </td></tr><tr><td>  3 </td><td>  1 </td><td>  1 </td><td>  1 </td><td>  0,25 </td></tr><tr><td>  4 </td><td>  1 </td><td>  1 </td><td>  2 </td><td>  0,5 </td></tr></tbody></table></div><br></div></div><br><br><h4>  2. Liste des favoris &lt;&gt; </h4><br>  Code d'encre: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IndexerList</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, List&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; list</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list[index]; }</code> </pre><br><br>  Code de langue d'assemblage: <br><br><pre> <code class="plaintext hljs">1. cmp edx,dword ptr [r8+10h] 2. jae M00_L00 3. mov rax,qword ptr [r8+8] 4. cmp edx,dword ptr [rax+8] 5. jae 00007ff9`07268f56 6. movsxd rdx,edx 7. mov eax,dword ptr [rax+rdx*4+10h] ret M00_L00 call System.ThrowHelper.ThrowArgumentOutOfRange_IndexException()</code> </pre><br>  Il y a clairement plus d'instructions ici.  On voit clairement que l'indexeur de feuilles enveloppe l'indexeur de tableau.  Un point int√©ressant est que la v√©rification pour aller au-del√† des limites du tableau est effectu√©e deux fois.  Ainsi, la premi√®re instruction v√©rifie si l'index d√©passe les bordures de la feuille.  Si c'est le cas, alors nous sautons (instruction 2) √† un appel tr√®s √©vident, lan√ßant une exception s'il d√©passe les limites du tableau.  Ce contr√¥le de bordure utilise le champ int√©rieur de la feuille, qui est le deuxi√®me dans l'ordre (d√©calage de 10h (16) octets depuis le d√©but du type, 8 vers le pointeur vers la table de m√©thodes et 8 vers le lien vers le tableau interne - le premier champ).  Dans la troisi√®me ligne, nous mettons dans le registre rax l'adresse du tableau interne - le premier champ (par analogie, un d√©calage de 8 octets est un pointeur vers la table des m√©thodes).  Ceci est suivi par la section d√©j√† famili√®re - la r√©f√©rence d'index pour le tableau (lignes 4 - 7).  Ici, pour v√©rifier les limites, le champ interne du tableau est utilis√©. <br>  J'ai essay√© de supprimer des choses qui ne sont pas directement li√©es √† l'indexation, mais ici, il vaut la peine de laisser ret afin qu'il ne semble pas qu'il y ait une exception √† la fin de chaque appel √† l'√©l√©ment de feuille: D <br><br>  Soit dit en passant, afin de ne pas vous tourmenter avec la sp√©culation, veuillez vous familiariser avec la mise en ≈ìuvre de la fiche <a href="">par r√©f√©rence</a> .  La conversion de type en entiers non sign√©s est utilis√©e pour r√©duire le nombre de comparaisons. <br><br>  En cons√©quence, nous obtenons 7 instructions pour acc√©der avec succ√®s √† l'index, soit 3 de plus que dans le tableau. <br><br><div class="spoiler">  <b class="spoiler_title">Informations sur les instructions:</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><th>  Non. </th><th>  Uops fondus </th><th>  Total uops </th><th>  Latence </th><th>  D√©bit r√©ciproque </th></tr><tr><td>  1 </td><td>  1 </td><td>  2 </td><td>  1 </td><td>  0,5 </td></tr><tr><td>  2 </td><td>  1 </td><td>  1 </td><td></td><td>  1-2 </td></tr><tr><td>  3 </td><td>  1 </td><td>  1 </td><td>  2 </td><td>  0,5 </td></tr><tr><td>  4 </td><td>  1 </td><td>  2 </td><td>  1 </td><td>  0,5 </td></tr><tr><td>  5 </td><td>  1 </td><td>  1 </td><td></td><td>  1-2 </td></tr><tr><td>  6 </td><td>  1 </td><td>  1 </td><td>  1 </td><td>  0,25 </td></tr><tr><td>  7 </td><td>  1 </td><td>  1 </td><td>  2 </td><td>  0,5 </td></tr></tbody></table></div><br></div></div><br><h4>  Nouveau - Span &lt;&gt; </h4><br>  Disque: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IndexerSpan</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, Span&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; span</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> span[index]; }</code> </pre><br>  Et en langage assembleur: <br><br><pre> <code class="plaintext hljs">1. cmp edx,dword ptr [r8+8] 2. jae 00007ff9`07278f69 3. mov rax,qword ptr [r8] 4. movsxd rdx,edx 5. mov eax,dword ptr [rax+rdx*4]</code> </pre><br>  Lorsque les port√©es ont √©t√© annonc√©es, elles nous ont promis qu'elles √©taient faites √† bon escient, avec le soutien de l'ex√©cution.  Et ils ne mentaient pas quoi dire.  En fait, il diff√®re du tableau classique en une seule instruction, une √©tape suppl√©mentaire d'acc√®s √† l'adresse.  √Ä en juger par ce code, l'adresse de l'emplacement de la m√©moire est cach√©e √† l'int√©rieur de la plage, o√π se trouvent les √©l√©ments, que nous obtenons √† la ligne 3. Il peut s'agir d'une adresse √† un endroit sp√©cifique dans un tableau, une ligne ou un morceau de m√©moire sur la pile. <br>  Cliquez ici pour une introduction √† l'indexeur Span pour le plaisir.  Vous pouvez remarquer qu'il existe 2 impl√©mentations diff√©rentes, selon la variable d'environnement.  PROJECTN est le nom de code de la premi√®re version de .NET Native pour UWP.  Par cons√©quent, nous sommes plus int√©ress√©s par la deuxi√®me version de l'indexeur.  Elle est √©tiquet√©e <a href=""><i>[intrins√®que]</i></a> .  De plus, si vous regardez la classe <a href="">Unsafe</a> statique utilis√©e dans l'impl√©mentation de cet indexeur, vous pouvez trouver des informations indiquant que les impl√©mentations de la plupart des m√©thodes de ce fichier sont repr√©sent√©es comme <i>intrins√®ques</i> . <br><br>  Les appels de m√©thode ou les r√©f√©rences aux champs marqu√©s de l'attribut <i>[Intrinsic]</i> sont pris en charge par le runtime. <br><br>  Dans <b>CoreCLR</b> , les corps de ces m√©thodes sont remplac√©s par EE (moteur d'ex√©cution) avec un code dangereux (dangereux).  Si vous avez besoin de plus de d√©tails, vous pouvez commencer √† creuser avec la m√©thode <a href="">getILIntrinsicImplementationForUnsafe</a> . <br><br>  Des informations sur le fonctionnement de <b>CoreRT</b> (ce qui m'int√©resse un peu), <br>  vous pouvez commencer √† regarder <a href="">Internal.IL.Stubs.UnsafeIntrinsics</a> . <br><br>  Avec un tel soutien depuis la nuit des temps, afin de comprendre ce qui se passera exactement dans les coulisses, il est logique de regarder les instructions du langage d'assemblage, ce que nous avons fait. <br><br><div class="spoiler">  <b class="spoiler_title">Informations sur les instructions:</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><th>  Non. </th><th>  Uops fondus </th><th>  Total uops </th><th>  Latence </th><th>  D√©bit r√©ciproque </th></tr><tr><td>  1 </td><td>  1 </td><td>  2 </td><td>  1 </td><td>  0,5 </td></tr><tr><td>  2 </td><td>  1 </td><td>  1 </td><td></td><td>  1-2 </td></tr><tr><td>  3 </td><td>  1 </td><td>  1 </td><td>  2 </td><td>  0,5 </td></tr><tr><td>  4 </td><td>  1 </td><td>  1 </td><td>  1 </td><td>  0,25 </td></tr><tr><td>  5 </td><td>  1 </td><td>  1 </td><td>  2 </td><td>  0,5 </td></tr></tbody></table></div><br></div></div><br>  Tous les indexeurs d√©pendent fortement des donn√©es: les instructions utilisent les r√©sultats des pr√©c√©dentes.  Il n'y a aucun r√©sultat inhabituel ici, et il ne devrait pas y en avoir.  Mais maintenant, les frais g√©n√©raux qui apparaissent dans tel ou tel cas sont clairs.  Quelques r√©sultats √©vidents.  Si l'algorithme implique des acc√®s tr√®s fr√©quents par index, alors il est judicieux de penser √† remplacer la feuille par un tableau.  Si l'appel n'est pas tr√®s fr√©quent, alors il peut √™tre plus pratique d'utiliser une feuille qui fournit une API tr√®s pratique et qui n'a pas une telle surcharge (je vous rappelle de surveiller les extensions de la matrice interne). <br><br>  Essayons maintenant d'examiner les diff√©rentes fa√ßons de sp√©cifier un tableau √† deux dimensions: un tableau de tableaux (tableau dentel√©) et un tableau multidimensionnel (tableau multidimensionnel). <br><br><h4>  4. Tableau multidimensionnel </h4><br>  Code tranchant: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IndexerDimensionalArray</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[,] demensionalArray</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> demensionalArray[index1, index2]; }</code> </pre><br>  Langue d'assemblage: <br><br><pre> <code class="plaintext hljs">1. mov eax,edx 2. sub eax,dword ptr [r9+18h] 3. cmp eax,dword ptr [r9+10h] 4. jae 00007ff9`00098fe6 5. mov edx,r8d 6. sub edx,dword ptr [r9+1Ch] 7. cmp edx,dword ptr [r9+14h] 8. jae 00007ff9`00098fe6 9. mov ecx,dword ptr [r9+14h] 10. imul rcx,rax 11. mov rax,rdx 12. add rax,rcx 13. mov eax,dword ptr [r9+rax*4+20h]</code> </pre><br>  Tout est compr√©hensible en principe - 2 contr√¥les sur les limites du tableau, puis calcul de l'indice et inversion.  Ce tableau est stock√© en m√©moire dans un fragment. <br><br><div class="spoiler">  <b class="spoiler_title">Informations sur les instructions:</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><th>  Non. </th><th>  Uops fondus </th><th>  Total uops </th><th>  Latence </th><th>  D√©bit r√©ciproque </th></tr><tr><td>  1 </td><td>  1 </td><td>  1 </td><td>  0-1 </td><td>  0,25 </td></tr><tr><td>  2 </td><td>  1 </td><td>  2 </td><td></td><td>  0,5 </td></tr><tr><td>  3 </td><td>  1 </td><td>  2 </td><td>  1 </td><td>  0,5 </td></tr><tr><td>  4 </td><td>  1 </td><td>  1 </td><td></td><td>  1-2 </td></tr><tr><td>  5 </td><td>  1 </td><td>  1 </td><td>  0-1 </td><td>  0,25 </td></tr><tr><td>  6 </td><td>  1 </td><td>  2 </td><td></td><td>  0,5 </td></tr><tr><td>  7 </td><td>  1 </td><td>  2 </td><td>  1 </td><td>  0,5 </td></tr><tr><td>  8 </td><td>  1 </td><td>  1 </td><td></td><td>  1-2 </td></tr><tr><td>  9 </td><td>  1 </td><td>  1 </td><td>  2 </td><td>  0,5 </td></tr><tr><td>  10 </td><td>  1 </td><td>  1 </td><td>  3 </td><td>  1 </td></tr><tr><td>  11 </td><td>  1 </td><td>  1 </td><td>  0-1 </td><td>  0,25 </td></tr><tr><td>  12 </td><td>  1 </td><td>  1 </td><td>  1 </td><td>  0,25 </td></tr><tr><td>  13 </td><td>  1 </td><td>  1 </td><td>  2 </td><td>  0,5 </td></tr></tbody></table></div><br></div></div><br><br><h4>  5. Tableau de tableaux (tableau dentel√©) </h4><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IndexerJaggedArray</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] jaggedArray</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> jaggedArray[index][index2]; }</code> </pre><br>  Assembleur: <br><br><pre> <code class="plaintext hljs">1. cmp edx,dword ptr [r9+8] 2. jae 00007ff9`00098f95 3. movsxd rax,edx 4. mov rax,qword ptr [r9+rax*8+10h] 5. cmp r8d,dword ptr [rax+8] 6. jae 00007ff9`00098f95 7. movsxd rdx,r8d 8. mov eax,dword ptr [rax+rdx*4+10h]</code> </pre><br>  Et le plus int√©ressant - nous avons moins d'instructions qu'avec un type sp√©cialement con√ßu pour la multidimensionnalit√©. <br><br><div class="spoiler">  <b class="spoiler_title">Informations sur les instructions:</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><th>  Non. </th><th>  Uops fondus </th><th>  Total uops </th><th>  Latence </th><th>  D√©bit r√©ciproque </th></tr><tr><td>  1 </td><td>  1 </td><td>  2 </td><td>  1 </td><td>  0,5 </td></tr><tr><td>  2 </td><td>  1 </td><td>  1 </td><td></td><td>  1-2 </td></tr><tr><td>  3 </td><td>  1 </td><td>  1 </td><td>  1 </td><td>  0,25 </td></tr><tr><td>  4 </td><td>  1 </td><td>  1 </td><td>  2 </td><td>  0,5 </td></tr><tr><td>  5 </td><td>  1 </td><td>  2 </td><td>  1 </td><td>  0,5 </td></tr><tr><td>  6 </td><td>  1 </td><td>  1 </td><td></td><td>  1-2 </td></tr><tr><td>  7 </td><td>  1 </td><td>  1 </td><td>  1 </td><td>  0,25 </td></tr><tr><td>  8 </td><td>  1 </td><td>  1 </td><td>  2 </td><td>  0,5 </td></tr></tbody></table></div><br></div></div><br>  Mais sur les 2 derniers exemples, je vous conseille de ne pas vous pr√©cipiter vers des conclusions.  En raison du fait qu'un tableau √† deux dimensions est un type unique, qui est initialis√© 1 fois, la m√©moire pour le tableau entier est allou√©e dans un grand fragment.  Cela fournira un meilleur cache, ce qui peut fondamentalement changer la situation.  Dans un tableau de tableaux, la m√©moire de chaque tableau sera allou√©e s√©par√©ment, il est donc probable que les tableaux seront allou√©s en m√©moire et entr√©s aux endroits les plus appropri√©s pour eux. <br><br>  Cependant, peut-√™tre pour certains, ce comportement sera plus acceptable.  Dans certaines situations, on sait peut-√™tre que la dur√©e de vie de ce sp√©cimen sera de courte dur√©e.  Et pour ne pas tomber dans un tas de gros objets (qui est une sorte de deuxi√®me g√©n√©ration pour le ramasse-miettes), o√π il y a une chance de rester longtemps, bien plus que nous ne le souhaiterions.  Ou apr√®s un certain temps, nous voulons travailler uniquement avec certaines lignes, et tout le reste peut √™tre effac√©.  De plus, il est pr√©vu de travailler avec le type en se r√©f√©rant √† des √©l√©ments al√©atoires incoh√©rents, lorsque le cache ne peut pas fonctionner normalement. <br><br>  De plus, lorsque vous utilisez un tableau de tableaux, il est plus probable de ne pas provoquer le ramasse-miettes au compactage, mais de le faire avec un balayage.  Rappel: lors de la fragmentation de la m√©moire, la quantit√© totale d'espace libre peut √™tre suffisante pour un nouvel objet, mais il n'y a pas de zone libre continue de la quantit√© requise.  Dans ce cas, le compactage est effectu√© - d√©placement d'objets dans le but de d√©fragmentation.  Si nous sommes capables de r√©cup√©rer une portion continue de m√©moire libre pour un nouvel objet, nous pouvons simplement entrer l'objet dans cet espace libre.  C'est ce qu'on appelle un balayage. <br><br>  J'esp√®re que ces informations vous aideront √† tirer les bonnes conclusions et √† √©tayer votre opinion dans la discussion sur ce qu'il faut utiliser. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450428/">https://habr.com/ru/post/fr450428/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450416/index.html">Comment les fournisseurs VPN de shareware vendent vos donn√©es</a></li>
<li><a href="../fr450418/index.html">L'art de cr√©er des mod√®les 3D organiques: les ombrages sous-cutan√©s</a></li>
<li><a href="../fr450420/index.html">Pourquoi les √©quipes de science des donn√©es ont besoin d'universel, pas de sp√©cialistes</a></li>
<li><a href="../fr450422/index.html">Les limites des algorithmes de reconnaissance d'image</a></li>
<li><a href="../fr450426/index.html">2011 vs AM4. Dinosaures vs mammif√®res</a></li>
<li><a href="../fr450430/index.html">Qu'est-ce qu'une attaque √† la poussi√®re?</a></li>
<li><a href="../fr450432/index.html">Eh bien, o√π est-elle?</a></li>
<li><a href="../fr450436/index.html">Qu'est-ce qu'un bootcamp de codage?</a></li>
<li><a href="../fr450438/index.html">Pourquoi l'automatisation du centre de contact serait-elle une obscurit√© terrible sans CRM?</a></li>
<li><a href="../fr450440/index.html">√Ä propos des pierres du ciel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>