<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìä üôéüèΩ üßîüèº Des classiques intemporels ou un aper√ßu des nouveaux vecteurs d'attaque via Microsoft Office üêò üëáüèΩ ü§ß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les pirates exploitent la cr√©dulit√© humaine et la n√©gligence humaine depuis des d√©cennies. La plupart des utilisateurs ouvrent sans h√©sitation une pi√®...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Des classiques intemporels ou un aper√ßu des nouveaux vecteurs d'attaque via Microsoft Office</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/433142/"><p><img src="https://habrastorage.org/webt/kw/nd/ax/kwndax-gdv9ffqc1p4xjlvt98ig.png" alt="image"><br>  Les pirates exploitent la cr√©dulit√© humaine et la n√©gligence humaine depuis des d√©cennies.  La plupart des utilisateurs ouvrent sans h√©sitation une pi√®ce jointe inoffensive, √† premi√®re vue, et, sans le savoir, lancent des logiciels malveillants.  Pour vous prot√©ger de telles attaques, vous devez conna√Ætre l'ennemi en personne.  Aujourd'hui, nous allons essayer de comprendre comment les trois nouvelles techniques d'ex√©cution de code dans les applications bureautiques d√©couvertes cette ann√©e sont organis√©es et quelles m√©thodes de protection contre elles existent. </p><a name="habracut"></a><br><h4 id="xlm-makrosy">  Macros XLM </h4><br><p> Les experts d'Outflank ont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">introduit une</a> nouvelle fa√ßon d'ex√©cuter du code dans MS Office Excel via des macros dites XLM (√† ne pas confondre avec XML).  Bien que la technologie de macro XLM soit utilis√©e depuis plus de 26 ans (apparue pour la premi√®re fois dans Excel 4.0 pour Windows 3.0 / 3.1), elle est toujours prise en charge par toutes les versions de Microsoft Office Excel jusqu'√† Office 2016. </p><br><p>  Pour cr√©er une macro XLM dans Excel, vous devez suivre ces √©tapes: <br>  Dans le menu contextuel de la feuille Excel, s√©lectionnez ¬´Ins√©rer¬ª. </p><br><p><img src="https://habrastorage.org/webt/67/xk/4z/67xk4zajwn9lfivlx22sepe8mfo.png" alt="image"></p><br><p>  Ensuite, s√©lectionnez "MS Excel 4.0". </p><br><p><img src="https://habrastorage.org/webt/hn/jm/px/hnjmpxngzz89cnn55udbpqrvwvi.png" alt="image"></p><br><p>  En cons√©quence, la feuille ¬´Macro1¬ª appara√Ætra, dans n'importe quelle cellule dont, en utilisant la fonction ¬´EXEC¬ª, le processus souhait√© peut √™tre d√©marr√©.  Pour ex√©cuter automatiquement une macro, la premi√®re cellule doit √™tre renomm√©e en ¬´Auto_open¬ª (similaire √† la proc√©dure AutoOpen () dans les macros VBA). </p><br><p>  Apr√®s avoir ouvert un document enregistr√©, une notification standard appara√Æt avec une demande d'ex√©cution d'une macro. </p><br><p><img src="https://habrastorage.org/webt/am/yg/v_/amygv_5ssyott6a0rovv6tmztdw.png" alt="image"></p><br><p>  La feuille macro peut √™tre masqu√©e en s√©lectionnant ¬´Masquer¬ª dans le menu contextuel. </p><br><p>  Outre la possibilit√© de d√©marrer des processus, les macros XLM peuvent acc√©der √† l'API Win32 √† l'aide des fonctions REGISTER et CALL.  Voici le code PoC pour une macro qui impl√©mente une technique d'injection shellcode. </p><br><p><img src="https://habrastorage.org/webt/xf/2i/zw/xf2izwfzcskz31cimua40hxayb4.png" alt="image"></p><br><p>  Dans le m√™me temps, la fonction de codage CHAR est utilis√©e pour stocker les caract√®res du code shell √† l'int√©rieur de la macro-cellule.  Pour supprimer des octets nuls, vous pouvez utiliser l'utilitaire msfvenom, qui fait partie de Metasploit Framework. </p><br><p>  Par la m√©thode de stockage √† l'int√©rieur d'un fichier Excel, les macros XLM sont significativement diff√©rentes des macros VBA classiques qui sont apparues un an plus tard dans Excel 5.0.  Dans le nouveau format Excel .xlsm, qui est une archive ZIP, les macros XLM sont stock√©es dans un fichier XML dans le r√©pertoire des macrosheets.  Au format .xsl (Excel 97-2003), la macro est stock√©e dans un flux OLE. </p><br><p>  De plus, on voit que la macro VBA est stock√©e dans un conteneur s√©par√© (sur la figure de gauche), tandis que les macros XLM sont situ√©es dans le m√™me conteneur de donn√©es. </p><br><p><img src="https://habrastorage.org/webt/vk/b4/ah/vkb4ahksxymoxkgyrtfcjo0igci.png" alt="image"></p><br><p>  Ces diff√©rences dans les m√©thodes de stockage des macros affectent de mani√®re significative la qualit√© de leur d√©tection par les antivirus, en particulier, la technologie AMSI (Antimalware Scanning Interface) ne prend pas en charge XLM, malgr√© la prise en charge <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">revendiqu√©e</a> d'Office 365. </p><br><p>  Par exemple, le code Metasploit powershell web_delivery a √©t√© impl√©ment√© dans Excel √† l'aide de macros VBA et XLM (dans les figures ci-dessous). </p><br><p><img src="https://habrastorage.org/webt/mp/pg/30/mppg30vb0ssgy9znbnmomcayq9e.png" alt="image"></p><br><p><img src="https://habrastorage.org/webt/2j/n3/z4/2jn3z4x3budl5irzemobw6li3vm.png" alt="image"></p><br><p>  Sur Virustotal, un document Excel avec une macro VBA a d√©clench√© 21 des 59 antivirus. </p><br><p><img src="https://habrastorage.org/webt/xk/7x/tn/xk7xtnip5rsocfra6wmqk3ydobu.png" alt="image"></p><br><p>  Dans le m√™me temps, un document similaire avec une macro XLM n'a suscit√© aucun soup√ßon d'antivirus. </p><br><p><img src="https://habrastorage.org/webt/6w/5z/pn/6w5zpnmshm7pmwhuxgon_ootlcg.png" alt="image"></p><br><p>  <strong>D√©monstration</strong> <br>  Ex√©cution de code via des macros XLM dans Office </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/G-2uir9TeFQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h4 id="microsoft-office-online-video">  Vid√©o Microsoft Office Online </h4><br><p>  L'√©quipe de recherche Cumulate a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©couvert une</a> nouvelle fa√ßon d'ex√©cuter du code dans Word en ins√©rant de la vid√©o √† l'aide de la vid√©o en ligne.  √Ä l'aide de cet √©l√©ment, vous pouvez ajouter une vid√©o YouTube au document, puis remplacer le lien vers celui-ci par du code JavaScript qui sera ex√©cut√© dans Internet Explorer lorsque vous ouvrirez le document et cliquez sur la vid√©o.  Les vecteurs suivants semblent les plus adapt√©s √† l'ing√©nierie sociale: </p><br><ul><li>  Ajout d'un code d'exploitation pour IE / Flash dans un iframe avec une vid√©o YouTube. </li><li>  Ajout de code JavaScript dans l'iframe avec la vid√©o YouTube en utilisant la m√©thode msSaveOrOpenBlob, par laquelle il sera sugg√©r√© de t√©l√©charger et d'ex√©cuter le fichier malveillant.  Le corps du fichier est contenu dans javascript base64. </li></ul><br><p>  Pour cr√©er un fichier avec l'extension docx.  avec la charge d√©crite, vous devez effectuer les √©tapes suivantes: </p><br><p>  1.Ajoutez une vid√©o YouTube via ¬´Ins√©rer - Vid√©o en ligne¬ª. </p><br><p><img src="https://habrastorage.org/webt/ty/kg/ea/tykgeapsiwbx7kq1gp7egsv3zma.png" alt="image"></p><br><p>  2. Enregistrez le fichier docx cr√©√©. </p><br><p>  3. D√©compressez le docx enregistr√©.  Format docx  est une archive zip du contenu suivant: <br><img src="https://habrastorage.org/webt/wm/pp/fb/wmppfb5hpuuv7g-tvhtqjbom7ye.png" alt="image"></p><br><p>  4.Dans le r√©pertoire Word du fichier document.xml de l'√©l√©ment embeddedHtml, ajoutez votre code JavaScript en l'ins√©rant dans le corps iframe ou en rempla√ßant le lien correspondant (src) dans l'iframe. </p><br><p>  5. Cr√©ez une archive zip (avec l'extension docx) avec les modifications apport√©es. </p><br><p>  De plus, lors de l'ouverture du fichier docx g√©n√©r√©, l'utilisateur doit cliquer sur le lien vid√©o et lancer le fichier t√©l√©charg√©.  Vous pouvez √©galement afficher une capture d'√©cran avec une proposition de mise √† jour de Flash Player, invitant l'utilisateur √† t√©l√©charger et √† ex√©cuter le fichier.  Aucun avertissement de s√©curit√© ne s'affiche. </p><br><p><img src="https://habrastorage.org/webt/hx/0z/fx/hx0zfxdxfl5dhfkckbt_g2mo50s.png" alt="image"></p><br><p>  Comme dans le cas des macros XLM, cette technique d'ex√©cution de code n'est d√©tect√©e par aucun antivirus sur Virustotal et semble tr√®s attrayante pour les auteurs de virus, et est √©galement courante dans l'ing√©nierie sociale dans le cadre des tests de p√©n√©tration. </p><br><p>  <strong>D√©monstration</strong> <br>  Ex√©cution de code via la vid√©o en ligne dans Office </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/E4lqdRNyA9Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h4 id="vba-stomping">  Vba pi√©tinant </h4><br><p>  Lors de la conf√©rence de Derbycon 2018, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une</a> technique de lancement des macros VBA dans les documents Office a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">introduite</a> , appel√©e VBA Stomping.  L'essence de la technique est de supprimer / modifier (en option pour remplir avec des z√©ros) le code source VBA dans le corps du document de bureau, en laissant le code macro compil√© appel√© code p intact.  Le code VBA, ainsi que sa version compil√©e, se trouvent dans le fichier vbaProject.bin situ√© dans l'archive zip (fichier avec l'extension .docm, .xslm). </p><br><p><img src="https://habrastorage.org/webt/2h/o0/62/2ho062u42yrxr81jebhqf1zegyu.png" alt="image"></p><br><p>  Ainsi, la technique se r√©sume √† supprimer / remplir avec des z√©ros une partie du fichier vbaProject.bin. </p><br><p><img src="https://habrastorage.org/webt/me/jq/iq/mejqiqu1zpf6w2nethawrkz7ao4.png" alt="image"></p><br><p>  Par cons√©quent, le document ne provoque pas de suspicion parmi les antivirus qui analysent une macro uniquement par son code source.  Par exemple, gr√¢ce √† cette technique, les chercheurs ont pu r√©duire le nombre de r√©ponses antivirus au cheval de Troie bancaire Emotet, distribu√©es via les fichiers Office, de 36/59 √† 7/58 sur Virustotal. </p><br><p><img src="https://habrastorage.org/webt/wo/bi/2c/wobi2cimjqfwlp_mxurz8v8ruoa.png" alt="image"></p><br><p><img src="https://habrastorage.org/webt/d8/bk/ni/d8bknikd5av_ae0e1yk1szf0bqm.png" alt="image"></p><br><p>  De plus, cette technique rend difficile l'analyse du fichier, car aucun outil, sans recourir √† la d√©compilation, ne pourra extraire le code source VBA, qui ne sera √©galement pas affich√© dans l'√©diteur de macros Office jusqu'√† ce qu'il soit r√©solu. </p><br><h4 id="zaschita">  La protection </h4><br><p>  Les recommandations pour contrer les techniques d√©crites sont traditionnelles pour la protection contre les m√©thodes d'ing√©nierie sociale: </p><br><ol><li>  Sensibilisation des employ√©s aux probl√®mes de s√©curit√© de l'information. </li><li>  Interdisez l'utilisation de macros dans Microsoft Office. </li><li>  Une approche int√©gr√©e pour assurer la s√©curit√© de l'information, y compris l'utilisation de solutions Endpoint, ainsi que des outils de s√©curit√© de p√©rim√®tre (pare-feu nouvelle g√©n√©ration, solutions UTM, passerelles de messagerie). </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433142/">https://habr.com/ru/post/fr433142/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433130/index.html">Que la force soit avec nous: notre propre immunit√© contre le cancer</a></li>
<li><a href="../fr433132/index.html">"Calendrier des testeurs" pour d√©cembre. Essayez une approche diff√©rente</a></li>
<li><a href="../fr433136/index.html">Infrastructure System.Transactions dans le monde .NET</a></li>
<li><a href="../fr433138/index.html">Cinq principes de conception de produits lors de la r√©servation</a></li>
<li><a href="../fr433140/index.html">Module client Google Pay pr√™t</a></li>
<li><a href="../fr433144/index.html">Sortie de .NET Core 2.2. Quoi de neuf (1 sur 3)</a></li>
<li><a href="../fr433146/index.html">[comp√©tition] Top 25 des consoles de jeux (secouez les temps anciens)</a></li>
<li><a href="../fr433152/index.html">Nous transf√©rons Zimbra d'une infrastructure √† serveur unique vers une infrastructure √† serveurs multiples</a></li>
<li><a href="../fr433154/index.html">Exp√©rience utilisateur 5G NR attendue dans le monde r√©el</a></li>
<li><a href="../fr433156/index.html">Dell devient public et se dirige vers le cloud hybride</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>