<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëâüèΩ üé¶ ‚õ∫Ô∏è LoJax: Das erste bekannte UEFI-Rootkit, das in einer b√∂swilligen Kampagne verwendet wird üö≥ üôç üõµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sednit Cybergroup, auch bekannt als ART28, Strontium und Fancy Bear, ist seit mindestens 2004 in Betrieb. Es wird angenommen, dass die Gruppe hinter e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>LoJax: Das erste bekannte UEFI-Rootkit, das in einer b√∂swilligen Kampagne verwendet wird</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/425251/">  Sednit Cybergroup, auch bekannt als ART28, Strontium und Fancy Bear, ist seit mindestens 2004 in Betrieb.  Es wird angenommen, dass die Gruppe hinter einer Reihe von resonanten Cyberangriffen steckt.  Einige <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">IB-Unternehmen</a> und das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">US-Justizministerium haben</a> Sednit f√ºr den Hacking des Democratic National Committee vor den US-Wahlen 2016 verantwortlich gemacht.  Der Gruppe wird das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hacken des</a> globalen Fernsehsenders TV5Monde, das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Durchsickern von</a> E-Mails der Welt-Anti-Doping-Agentur (WADA) und andere Vorf√§lle zugeschrieben.  Sednit hat viele Ziele und eine breite Palette von Tools, von denen einige bereits zuvor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dokumentiert</a> wurden. Zum ersten Mal in dieser Arbeit werden wir jedoch die Verwendung des UEFI-Rootkits ausf√ºhrlich beschreiben. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ai/yf/nq/aiyfnqxa7dzic4myqh6eircpapo.jpeg"></div><br><a name="habracut"></a><h2>  Kurzer R√ºckblick </h2><br>  Wir haben festgestellt, dass Sednit mindestens seit Anfang 2017 eine trojanisierte Version des alten Benutzeragenten des Programms verwendet, um Ger√§te vor Diebstahl durch den Entwickler von Absolute Software - LoJack zu sch√ºtzen.  Das Tool erregte die Aufmerksamkeit von Fachleuten f√ºr Informationssicherheit aufgrund der Verwendung des UEFI / BIOS-Moduls als Mechanismus zur Sicherstellung der Persistenz.  Wir haben die trojanisierte Version dieses Programms <b>LoJax genannt</b> . <br><br>  Das Vorhandensein bekannter Sednit-Tools in infizierten Systemen zusammen mit LoJax-Beispielen sowie die Tatsache, dass einige von trojanisierten Agenten verwendete Befehlsserver zuvor Teil der Sednit-Infrastruktur waren, erm√∂glichen es uns, ein UEFI-Rootkit zuverl√§ssig dieser Gruppe zuzuordnen. <br><br>  Zusammen mit LoJax-Agenten wurden Tools zum Lesen der UEFI-Systemfirmware entdeckt, und in einem der F√§lle konnte dieses Tool einen Teil des System-SPI-Flash-Speichers sichern, patchen und neu schreiben.  Das ultimative Ziel des Tools ist die Installation eines sch√§dlichen UEFI-Moduls in einem System, dessen Flash-SPI-Schutz anf√§llig oder nicht ordnungsgem√§√ü konfiguriert ist. <br><br>  Das UEFI-Modul ist f√ºr die Implementierung des LoJax-Agenten im System verantwortlich. Dies ist das erste von UEFI identifizierte Rootkit der Sednit-Gruppe.  Da es sich in der Systemfirmware befindet, kann es die Neuinstallation von Windows und den Austausch der Festplatte √ºberleben. <br><br>  Es gab mindestens einen Fall, in dem dieses Rootkit erfolgreich im System-SPI-Flash-Speicher installiert wurde.  Nach unseren Informationen ist dies das erste UEFI-Rootkit, das in freier Wildbahn entdeckt wurde. <br><br><h2>  Einf√ºhrung </h2><br>  Sednit verwendet eine Reihe von Malware-Familien.  Eine detaillierte Beschreibung der h√§ufig verwendeten Gruppenwerkzeuge, die wir im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bericht</a> bereitgestellt haben. <br><br>  Wir verfolgen die Aktivit√§ten von Sednit seit mehreren Jahren und haben zahlreiche Berichte √ºber die Arbeit der Gruppe ver√∂ffentlicht, von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beschreibungen von</a> Zero-Day-Schwachstellen bis hin zu benutzerdefinierten Programmen wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zebrocy</a> .  Die in diesem Bericht beschriebenen Komponenten bilden eine separate Gruppe. <br><br>  UEFI-Rootkits wurden bereits in Berichten von Informationssicherheitsunternehmen beschrieben.  Beispielsweise sind rkloader, der in einer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pr√§sentation</a> √ºber Datenlecks im Hacking-Team vorgestellt wurde, und DerStarke, ein Implantat f√ºr den Download von macOS EFI / UEFI aus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vault7-</a> Dokumenten, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bekannt</a> .  Wir sind uns der Existenz dieser Tools bewusst, es wurden jedoch keine UEFI-Kompromissberichte von Rootkits ver√∂ffentlicht. <br><br>  Jetzt haben wir nicht nur die Verwendung von In-the-Wild-Firmware mit dem b√∂swilligen LoJax UEFI-Modul bewiesen, sondern auch die gesamte Palette von Tools gefunden, die h√∂chstwahrscheinlich f√ºr die Installation verwendet wurden.  Es ist interessant festzustellen, dass Sednit das DownDelph-Bootkit verwendet, das 2013 und 2014 verwendet wurde, um Downdelph, eine der ersten Hintert√ºren von Sednit, zu warten.  Die Idee ist √§hnlich, aber in der neuen Version von UEFI ist die Verwendung von Bootkits nicht mehr m√∂glich.  Somit unterscheiden sich diese beiden Komponenten erheblich im Verhalten. <br><br>  Diese Arbeit ist in drei Abschnitte unterteilt.  Im ersten Teil werden wir die fr√ºhen Studien zur Sicherheit von LoJack / Computrace und das Potenzial f√ºr eine b√∂swillige Verwendung des Programms analysieren.  Der zweite Abschnitt ist dem Forschungsprozess gewidmet, der uns schlie√ülich zum UEFI-Rootkit f√ºhrte.  Schlie√ülich beschreiben wir im dritten Abschnitt ausf√ºhrlich die verschiedenen LoJax-Komponenten und wie sie auch nach der Neuinstallation von Windows und dem Austausch der Festplatte f√ºr Persistenz im System sorgen. <br><br><h4>  Namensnennung </h4><br>  W√§hrend viele Anbieter bereits in der Vergangenheit Aussagen zur Sednit-Gruppe gemacht haben, bestimmt ESET in keiner Weise ihre geopolitische Zugeh√∂rigkeit.  Seit der Ver√∂ffentlichung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">der Studie</a> 2016 hat sich unsere Position nicht ge√§ndert.  Die Ermittlung der Quelle eines Cyberangriffs anhand eines wissenschaftlichen Ansatzes ist eine komplexe Aufgabe, die au√üerhalb des Kompetenzbereichs von ESET-Spezialisten liegt.  Was wir als "Sednit-Gruppe" bezeichnen, ist nur eine Reihe von Software und eine zugeh√∂rige Netzwerkinfrastruktur, die wir keiner bestimmten Organisation autorisierend zuordnen k√∂nnen. <br><br><h4>  Ziele </h4><br>  W√§hrend der Studie fanden wir eine kleine Anzahl verschiedener LoJax-Bilder.  Basierend auf unseren Telemetriedaten und einer Studie anderer in freier Wildbahn entdeckter Sednit-Programme sind wir zuversichtlich, dass dieses spezielle Modul im Vergleich zu anderen Tools selten verwendet wurde.  Die Ziele waren haupts√§chlich staatliche Organisationen auf dem Balkan in Mittel- und Osteuropa. <br><br><h2>  Fr√ºhe Computertrace / LoJack-Forschung </h2><br>  LoJack - Software zum Schutz von Computern vor Diebstahl und Verlust, entwickelt von Absolute Software Corporation.  Fr√ºhere Versionen des Agenten sind als Computrace bekannt.  Wie der vorherige Name schon sagt, kann der Computer nach Aktivierung des Dienstes auf seinen Befehlsserver zugreifen. Der Besitzer wird im Falle eines Verlusts oder Diebstahls √ºber den Standort des Ger√§ts informiert. <br><br>  Der folgende Abschnitt beschreibt die vorherige LoJack-Architektur.  Nur die alte Version der Software wurde von Cyberkriminellen trojanisiert, daher werden wir uns darauf konzentrieren.  Dar√ºber hinaus ver√∂ffentlichte Absolute Software im Mai 2018 eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erkl√§rung</a> , dass die unten beschriebenen Sicherheitsl√ºcken den Betrieb der neuesten Versionen ihrer Agenten nicht beeintr√§chtigen. <br><br>  Das Computrace-Programm zog die Aufmerksamkeit von Fachleuten f√ºr Informationssicherheit auf sich, da es eine ungew√∂hnliche Methode zur Sicherstellung der Persistenz verwendete.  Der Zweck ist der Schutz vor Diebstahl. Daher ist es wichtig, dass das Betriebssystem nicht neu installiert und die Festplatte ausgetauscht werden kann. All dies ist im UEFI / BIOS-Modul implementiert, das nach diesen Aktionen √ºberleben kann.  Die L√∂sung ist in der Firmware eines wesentlichen Teils der Laptops verschiedener Hersteller vorinstalliert. Der Benutzer muss diese Funktion nur aktivieren.  Die Aktivierung kann im BIOS erfolgen, wie in der folgenden Abbildung dargestellt. <br><br><img src="https://habrastorage.org/webt/rf/vx/i_/rfvxi_hexr1f29e0hqddhak97ag.png"><br>  <i>Abbildung 1. Computrace im BIOS aktivieren</i> <br><br>  Einer der ersten LoJack / Computrace-Implementierungsberichte wurde 2009 ver√∂ffentlicht.  Die globale Architektur des Produkts, das Leeren des UEFI / BIOS-Moduls des Benutzeragenten auf die Festplatte und die Art und Weise, wie der Agent mit einem von Absolute Software gesteuerten Webserver kommuniziert, wurden offengelegt.  Das Diagramm ist aus der folgenden Abbildung ersichtlich. <br><br><img src="https://habrastorage.org/webt/mh/5a/u2/mh5au2bhmrriy8sn8dtsd1g1avw.png"><br>  <i>Abbildung 2. LoJack-Persistenzmechanismus (ungef√§hr 2008)</i> <br><br>  Das Folgende ist eine Beschreibung der oben aufgef√ºhrten Schritte: <br><br>  1. Wenn aktiviert, wird das UEFI / BIOS-Modul beim Booten ausgef√ºhrt.  Er versucht, die FAT / FAT32 / NTFS-Partition zu finden.  Anschlie√üend erstellt er mithilfe des NTFS-Treibers eine Sicherungskopie der Datei <code>autochk.exe</code> und √ºberschreibt deren Inhalt mit dem Dropper, der f√ºr die Installation der Benutzeragentenkomponente verantwortlich ist.  Die Datei <code>autochk.exe</code> ist eine ausf√ºhrbare Windows-Datei, die zu einem fr√ºhen Zeitpunkt des Systemstarts gestartet wird, um m√∂gliche Sch√§den an der Festplatte festzustellen. <br><br>  2. Wenn die ge√§nderte <code>autochk.exe</code> , besteht ihr Hauptziel darin, den Mini-Agenten <code>rpcnetp.exe</code> zu implementieren und als Dienst hinzuzuf√ºgen, damit er bei jedem Neustart gestartet wird.  Der letzte Schritt in dieser Komponente besteht darin, die urspr√ºngliche Version von <code>autochk.exe</code> . <br><br>  3. Mini-Agent <code>rpcnetp.exe</code> - eine kleine ausf√ºhrbare Datei, deren Zweck darin besteht, den Betrieb des Hauptagenten sicherzustellen.  Wenn der prim√§re Agent nicht funktioniert, versucht <code>rpcnetp.exe</code> , eine Verbindung zum Absolute Software C &amp; C-Befehlsserver <code>rpcnetp.exe</code> , um ihn herunterzuladen und auszuf√ºhren.  Zuerst erstellt der Mini-Agent eine Kopie von sich selbst und nimmt dann √Ñnderungen am PE-Header vor, um sie in eine DLL zu konvertieren.  Diese Bibliothek wird dann in den Speicher geladen, ruft den Prozess <code>svchost.exe</code> auf und <code>svchost.exe</code> dort die DLL ein.  Als n√§chstes wird der Internet Explorer-Prozess <code>iexplore.exe</code> und die DLL wird in ihn <code>iexplore.exe</code> .  Der letztere Prozess wird dann f√ºr die Kommunikation √ºber das Internet verwendet.  Die Injektion von Computrace-Mini-Agenten in Prozesse von Drittanbietern ist h√§ufig in Malware enthalten und wird selten mit legitimer Software in Verbindung gebracht. <br><br>  4. Jetzt l√§uft ein voll funktionsf√§higer Agent auf dem System und kann die Computrace-Funktionen zum Verfolgen und Wiederherstellen verwenden. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Eine Beschreibung</a> dieses Prozesses und des Netzwerkprotokolls zwischen dem Mini-Agenten und dem C &amp; C-Server wurde 2014 ver√∂ffentlicht.  Aufgrund des Fehlens eines Authentifizierungsmechanismus k√∂nnen Angreifer, wenn sie den Server steuern, mit dem der Mini-Agent kommuniziert, ihn zwingen, beliebigen Code herunterzuladen.  Es gibt verschiedene Mechanismen, mit denen Angreifer den Mini-Agenten direkt kontaktieren k√∂nnen.  Das f√ºr uns wichtigste ist die Methode, mit der die Adresse des C &amp; C-Servers vom Mini-Agenten abgerufen wird.  Tats√§chlich werden diese Informationen in der Konfigurationsdatei in der ausf√ºhrbaren Datei selbst gespeichert. <br><br><img src="https://habrastorage.org/webt/qc/ww/es/qcwwesoicwoyw1aghae1smpgnao.png"><br>  <i>Abbildung 3. Konfigurationsdatei f√ºr die verschl√ºsselte LoJack-Teilentschl√ºsselung auf der rechten Seite</i> <br><br>  Die Abbildung zeigt die LoJack Mini-Agent-Konfigurationsdatei.  Die verwendete Verschl√ºsselungsmethode ist ein einfaches XOR mit einem Einzelbyte-Schl√ºssel.  Der 0xB5-Schl√ºssel ist f√ºr alle untersuchten Mini-Agenten gleich.  Wie aus der Abbildung ersichtlich, ist die C &amp; C-Dom√§ne in der Datei angegeben.  Die vier vorhergehenden Bytes enthalten die IP-Adresse des C &amp; C-Servers.  <code>%WINDIR%</code> der Inhalt der Konfigurationsdatei nicht <code>%WINDIR%</code> k√∂nnen Angreifer mit Schreibberechtigungen in <code>%WINDIR%</code> den Inhalt so √§ndern, dass der Mini-Agent nicht legitim, sondern mit seinem Befehlsserver kommuniziert.  Wenn Sie das Netzwerkprotokoll kennen, k√∂nnen Sie den Mini-Agenten dazu bringen, beliebigen Code herunterzuladen und auszuf√ºhren.  Diese Risiken sind seit langem bekannt, aber bis vor kurzem wurde der Mechanismus in der Praxis nicht angewendet. <br><br><h4>  LoJack wird zu LoJax </h4><br>  Im Mai 2018 wurden die Trobor-Beispiele des LoJack-Mini-Agenten rpcnetp.exe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im</a> Arbor Network- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Blog beschrieben</a> .  Ihre fest codierten Netzwerkeinstellungen wurden ge√§ndert, sodass b√∂swillige Beispiele eine Verbindung zum C &amp; C-Server des Angreifers anstelle des legitimen Absolute Software-Servers herstellten.  Einige der in den Trojaner-Beispielen gefundenen Dom√§nen wurden fr√ºher erf√ºllt - sie wurden Ende 2017 als C &amp; C-Serverdom√§nen f√ºr SedUploader, die Hintert√ºr der ersten Stufe der Sednit-Cybergruppe, verwendet.  Die folgende Abbildung zeigt ein Beispiel f√ºr eine ge√§nderte Konfiguration in einem der LoJax-Miniagenten. <br><br><img src="https://habrastorage.org/webt/om/ts/md/omtsmdgqzbkn-fbqrpjd59abp7a.png"><br>  <i>Abbildung 4. Links befindet sich eine legitime Konfigurationsdatei, rechts eine ge√§nderte</i> <br><br>  Die Unterschiede zwischen legitimen und trojanisierten Agenten sind √§u√üerst gering, fast alle sind oben angegeben.  Die LoJax-Mini-Agent-Beispiele, die wir finden konnten, sind trojanisierte Versionen desselben Computrace-Mini-Agent-Beispiels, <code>rpcnetp.exe</code> .  Sie haben alle identische Kompilierungszeitstempel und nur wenige Dutzend Bytes unterscheiden sich vom Original.  Zus√§tzlich zu den √Ñnderungen an der Konfigurationsdatei gibt es Unterschiede bei den Timer-Variablen, die die Intervalle zwischen den Verbindungen zum C &amp; C-Server bestimmen. <br><br>  Zum Zeitpunkt der Ver√∂ffentlichung entdeckten wir verschiedene LoJax-Mini-Agenten, die bei Angriffen auf verschiedene Organisationen auf dem Balkan in Mittel- und Osteuropa eingesetzt wurden, hatten jedoch keine Ahnung, wie sie installiert werden sollten.  Eine naheliegende Erkl√§rung w√§re die Installation mit einer der ber√ºhmten Sednit-Hintert√ºren.  Vergessen Sie nicht, dass LoJack als etabliertes Tool von vielen Antiviren-Anbietern auf die Whitelist gesetzt wurde.  Selbst wenn in dieser Kampagne nur ein Mini-Agent verwendet wurde, der nach der Neuinstallation von Windows nicht √ºberlebte, hatte er dennoch einen Vorteil: Es war weniger wahrscheinlich, dass er als Malware erkannt wurde.  Was aber, wenn der Kompromiss noch tiefer ging und die Angreifer versuchten, LoJack zu kopieren, um zur Systemfirmware zu gelangen? <br><br><h2>  Suchen Sie nach der Komponente der unteren Ebene </h2><br>  Wir haben LoJax-Angriffe gegen mehrere Organisationen auf dem Balkan in Mittel- und Osteuropa aufgezeichnet.  In allen von ihnen konnten wir Spuren von Sednit-Malware finden, darunter: <br><br><ul><li>  SedUploader, Hintert√ºr der ersten Stufe </li><li>  XAgent, Sednits Flaggschiff-Hintert√ºr </li><li>  Xtunnel, ein Netzwerk-Proxy-Tool, das jeglichen Netzwerkverkehr zwischen einem C &amp; C-Server im Internet und einem Zielcomputer in einem lokalen Netzwerk √ºbertragen kann </li></ul><br>  Wir fanden Spuren von Sednit-Werkzeugen in den meisten untersuchten Systemen, die zu LoJax-Zielen wurden, sowie in einigen Systemen, in denen nur LoJax vorhanden war.  Es ist davon auszugehen, dass LoJax in einigen F√§llen als separates Tool verwendet wurde, wahrscheinlich als zus√§tzliche Hintert√ºr zur Wiederherstellung des Zugriffs von Sednit-Betreibern auf das Netzwerk. <br><br>  Die XAgent-Hintert√ºr f√ºgt normalerweise zus√§tzliche Module in ein kompromittiertes System ein, sodass sofort in den Sinn kommt, dass LoJax-Muster auf die gleiche Weise ohne andere Mechanismen geliefert wurden.  Es war davon auszugehen, dass Sednit nur einen Mini-Agenten aus der LoJack-L√∂sung ausgeliehen hatte.  Kurz nach Beginn der Analyse fanden wir jedoch mehrere Hinweise darauf, dass die Inspirationsquelle etwas umfangreicher war. <br><br><h4>  RWEverything (RwDrv) Treiber und info_efi.exe </h4><br>  Der erste Beweis wurde dank eines benutzerdefinierten Tools von Cyberkriminellen gefunden, die bei der Ausf√ºhrung Informationen √ºber die Einstellungen des untergeordneten Systems in eine Textdatei entladen.  Das Tool wurde zusammen mit einigen LoJax-Beispielen entdeckt.  Die folgende Abbildung zeigt ein Fragment der <code>info_efi.exe</code> dieses Tools unter dem logischen Namen <code>info_efi.exe</code> . <br><br><img src="https://habrastorage.org/webt/8j/9x/kc/8j9xkcnbmste_xynugnkenaar6g.png"><br>  <i>Abbildung 5. Auszug aus den von info_efi .exe generierten Dateiprotokollen</i> <br><br>  Um diese Art von Informationen zu lesen, enth√§lt das Tool einen Treiber namens <code>RwDrv.sys</code> .  Der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kerneltreiber</a> wird mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RWEverything geliefert</a> , einem kostenlosen Dienstprogramm, das im Netzwerk verf√ºgbar ist und zum Lesen von Informationen zu fast allen Einstellungen auf niedrigerer Ebene verwendet werden kann, einschlie√ülich der PCI Express-Schnittstelle, des Speichers, der PCI Option-ROMs usw.  Der Kerneltreiber ist eine legitime Software und mit einem g√ºltigen Zertifikat signiert. <br><br><img src="https://habrastorage.org/webt/2u/o-/mb/2uo-mbk6so15sdz9iusnxzl15qq.png"><br>  <i>Abbildung 6. Codesignaturzertifikat f√ºr RwDrv.sys</i> <br><br>  RWEverything verf√ºgt √ºber eine grafische Benutzeroberfl√§che, √ºber die Sie auf alle diese Informationen zugreifen k√∂nnen. <br><br><img src="https://habrastorage.org/webt/if/yp/dp/ifypdpu-hnounvupxelxhcp5el4.png"><br>  <i>Abbildung 7. Screenshot der RWEverything-Benutzeroberfl√§che</i> <br><br>  Die Entdeckung des Tools <code>info_efi</code> war das erste Anzeichen daf√ºr, dass ein UEFI LoJax-Modul existieren k√∂nnte.  Wenn Sie versuchen, die Systemfirmware zu aktualisieren, ist es wichtig, Informationen √ºber den Hersteller, die Version usw. zu haben.  Angesichts der Sicherheitsl√ºcken, die es Benutzerprozessen erm√∂glichen, auf den Inhalt des SPI-Flash-Speichers zuzugreifen und diesen zu √§ndern, in dem UEFI-Module gespeichert sind, ist das Abrufen von Systemfirmware-Daten der erste Schritt zu einem erfolgreichen Angriff. <br><br>  Der letzte Hinweis, der es uns erm√∂glichte, das erste UEFI-Rootkit der Sednit-Gruppe zu finden, waren zwei Tools - zum Speichern des SPI-Flash-Speichers und zum Schreiben darauf. <br><br><h4>  Dump SPI Flash </h4><br>  Das erste Puzzleteil war eine Datei namens <code>ReWriter_read.exe</code> .  Es enthielt den gesamten Code, der zum Speichern des System-SPI-Flashs mithilfe des RWEverything-Treibers <code>RwDrv.sys</code> .  Damit der Ger√§tetreiber die erforderlichen Vorg√§nge ausf√ºhren kann, muss das Dump-Tool die richtigen E / A-Steuercodes (IOCTL) senden.  W√§hrend <code>RwDrv.sys</code> viele verschiedene IOCTL-Codes unterst√ºtzt, verwenden das in diesem und im n√§chsten Abschnitt beschriebene Dumper- und Writer-Tool nur vier davon. <br><br>  RwDrv.sys: unterst√ºtzte IOCTL-Codes: <br><br>  <i>0x22280c</i> - Schreibt in den f√ºr E / A zugewiesenen Speicherbereich <br>  <i>0x222808</i> - Liest den f√ºr die Eingabe / Ausgabe zugewiesenen Speicherbereich <br>  <i>0x222840</i> - Liest das Dword aus dem angegebenen PCI-Konfigurationsregister <br>  <i>0x222834</i> - schreibt ein Byte in das angegebene PCI-Konfigurationsregister <br><br>  <code>ReWriter_read</code> erstellt zun√§chst einen Dienst mit dem integrierten <code>RwDrv.sys</code> und schreibt die UEFI / BIOS-Konfigurationsinformationen sowie die entsprechenden Werte der drei im BIOS-Verwaltungsregister (BIOS_CNTL) enthaltenen Felder: BIOS Lock Enable (BLE), BIOS Write Enable (BIOSWE) und SMM BIOS Schreibschutz deaktivieren (SMM_BWP).  Obwohl <code>ReWrite_read</code> diese Werte nicht verwendet, werden wir in den folgenden Abschnitten erkl√§ren, warum diese Felder f√ºr dieses Tool von Interesse sind. <br><br>  Die n√§chste Aufgabe des Tools besteht darin, die Basisadresse des BIOS-Speicherbereichs in SPI und seine Gr√∂√üe zu ermitteln.  Diese Informationen sind im Register der SPI-Hauptschnittstelle als BIOS-Flash-Prim√§rregion enthalten.  Alle Register werden im Speicher im Root Complex Register Block (RCRB) angezeigt, dessen Basisadresse durch Lesen des gew√ºnschten PCI-Konfigurationsregisters erhalten werden kann.  <code>ReWriter_read</code> erh√§lt diese Adresse, indem es RwDrv IOCTL 0x22840 verwendet und den richtigen Einzug liest (in unserem Fall 0xF0).  Sobald die Basisadresse des BIOS-Bereichs und seine Gr√∂√üe bekannt sind, liest das Dump-Tool den entsprechenden Inhalt des SPI-Flash-Speichers und schreibt ihn in eine Datei auf der Festplatte.  Der Vorgang des Lesens des SPI-Flash-Speichers ist in der folgenden Abbildung dargestellt.  Definitionen der Abk√ºrzungen finden Sie im folgenden Glossar. <br><br><img src="https://habrastorage.org/webt/mw/wm/tb/mwwmtbzbrwmm18l1w7-2iugvpxc.png"><br>  <i>Abbildung 8. Die Lesesequenz aus dem SPI-Flash-Speicher</i> <br><br>  Zus√§tzlich zu den ersten beiden Schritten, die nur einmal ausgef√ºhrt werden, werden die Vorg√§nge in einem Zyklus wiederholt, bis alle Daten aus dem SPI-Flash-Speicher gelesen wurden.  Der Prozess ist auch hier gut beschrieben.  Anschlie√üend <code>ReWriter_read</code> die Gr√∂√üe des zusammengef√ºhrten Bildes.  Es analysiert den Bildspeicher-Deskriptor, um eine Reihe von BIOS-, Gigabit-Ethernet- (GbE) und Management Engine- (ME) Bereichen zu erhalten.  Durch Hinzuf√ºgen der Abmessungen dieser drei Bereiche kann das Dumper-Tool den gesamten Inhalt des Flash-SPI berechnen.  Wenn die Gr√∂√üe mit der Gr√∂√üe √ºbereinstimmt, die beim Lesen des Registrierungsbereichs des prim√§ren Flash-BIOS erhalten wurde, wird das Bild als korrekt angesehen. <br><br><h4>  UEFI-Firmware-Patch </h4><br>  Das zweite Puzzleteil war eine Datei namens <code>ReWriter_binary.exe</code> .  Diese Datei enth√§lt Hinweise darauf, dass Sednit zur Firmware gelangt ist.  Die Datei enth√§lt Code zum Anwenden des Patches des heruntergeladenen UEFI-Images und zum Zur√ºckschreiben der trojanisierten Version in den SPI-Flash-Speicher.  In diesem Abschnitt beschreiben wir, wie diese Bin√§rdatei aufgebaut ist. <br><br>  Nachdem der Inhalt des Flash-Speichers mit dem obigen Tool entladen und √ºberpr√ºft wurde, wird dem Image ein sch√§dliches UEFI-Modul hinzugef√ºgt.  Dazu muss das UEFI-Bild analysiert werden, um die erforderlichen Informationen hervorzuheben. <br><br>  Die im UEFI-Image gespeicherten Daten werden √ºber das Dateisystem (FFS) in Volumes zerlegt.  Wie der Name schon sagt, handelt es sich um ein spezielles Dateisystem zum Speichern von Firmware-Images.  Volumes enthalten Dateien mit GUIDs.  Jede Datei besteht normalerweise aus vielen Abschnitten, von denen einer die tats√§chlich ausf√ºhrbare Datei PE / COFF enth√§lt, bei der es sich um ein UEFI-Image handelt.  Unten finden Sie einen Screenshot von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">UEFITool</a> , einem Open-Source-Projekt f√ºr die Arbeit mit UEFI-Firmware-Images, um das Verst√§ndnis der Schaltung zu vereinfachen. <br><br><img src="https://habrastorage.org/webt/s6/th/mp/s6thmpgjnornwankifoul8d9zlk.png"><br>  <i>Abbildung 9. Beispiel eines in UEFITool geladenen UEFI-Firmware-Images</i> <br><br>  ReWriter_binary analysiert alle Firmware-Volumes im BIOS SPI-Bereich des Flash-Speichers und sucht nach bestimmten Dateien: <br><br><ul><li>  IP4Dxe (8f92960f-2880-4659-b857-915a8901bdc8) </li><li>  NtfsDxe (768bedfd-7b4b-4c9f-b2ff-6377e3387243) </li><li>  SmiFlash (bc327dbd-b982-4f55-9f79-056ad7e987c5) </li><li>  Dxe Kern </li></ul><br><img src="https://habrastorage.org/webt/zt/ou/kc/ztoukch8w0mdyv-whzpkaibpc9u.png"><br>  <i>Abbildung 10. Das Ergebnis der Verwendung des Hex-Rays-Dekompilierers in den Firmware-Volumes</i> <br><br>  Ip4Dxe und NtfsDxe sind DXE-Treiber.  In der UEFI-Firmware sind DXE-Treiber PE / COFF-Images, die entweder zur Hardware-Abstraktion oder zum Organisieren von Diensten zur Verwendung durch andere DXE-Treiber oder UEFI-Anwendungen erstellt wurden.  Solche Treiber werden von der DXE Foundation zu einem fr√ºhen Zeitpunkt des Startvorgangs √ºber den DXE Manager (DXE-Kernel) erkannt und heruntergeladen.  Nach Abschluss dieser Phase stehen alle Dienste, z. B. OS Loader, f√ºr die Arbeit mit UEFI-Anwendungen zur Verf√ºgung.  In der Regel werden DXE-Treiber auf demselben Volume gespeichert.  Der DXE-Dispatcher kann jedoch separat sein. <br><br>  <code>ReWriter_binary</code> sucht nur nach Ip4Dxe, um herauszufinden, ob ein bestimmtes Volume DXE-Treiber enth√§lt.  Wie wir sp√§ter beschreiben, wird dieses Volume zu einem Kandidaten f√ºr die Installation des sch√§dlichen DXE-Treibers.  Er sucht auch nach dem DXE-Kernel und f√ºgt das Volume hinzu, in dem er sich als weiterer Kandidat f√ºr einen Ort zum Aufzeichnen eines Rootkits befindet.  Der freie verf√ºgbare Speicherplatz in jedem dieser Volumes wird gespeichert und sp√§ter verwendet, um zu √ºberpr√ºfen, ob ein b√∂sartiger Treiber hinzugef√ºgt werden kann. <br><br>  NtfsDxe - AMI NTFS DXE-Treiber.  Wenn es auf dem Firmware-Volume vorhanden ist, wird sein Speicherort gespeichert und sp√§ter zum Entfernen dieser Datei vom Volume verwendet.  Im Abschnitt UEFI-Rootkit werden wir sehen, warum diese Datei gel√∂scht wird. <br><br>  Was das SmiFlash-Bild betrifft, werden die damit verbundenen Informationen gespeichert, aber nirgendwo in Malvari verwendet.  Interessanterweise ist das Bild <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">anf√§llig</a> .  Wir glauben daher, dass Sednit-Betreiber daran arbeiten k√∂nnen, diese Sicherheitsanf√§lligkeiten auszunutzen.  Dadurch k√∂nnen sie m√∂glicherweise auch korrekt konfigurierte Systeme in den SPI-Flash-Speicher schreiben.  Wie wir sp√§ter erfahren werden, kann das Tool in seiner aktuellen Form nur in den BIOS-Bereich von falsch konfigurierten oder ziemlich alten Systemen schreiben (auf Motherboards mit Chips√§tzen, die √§lter sind als der um 2008 eingef√ºhrte Platform Controller Hub). <br><br>  Nachdem die erforderlichen Metadaten zugewiesen wurden, <code>ReWriter_binary</code> den <code>ReWriter_binary</code> des UEFI-Images und f√ºgt den sch√§dlichen DXE-Treiber hinzu.  Zun√§chst wird der Dateikopf (EFI_FFS_FILE_HEADER) erstellt.  Anschlie√üend w√§hlt er das Zieldatentr√§ger basierend auf dem Speicherort von Ip4Dxe und dem DXE-Kernel sowie dem auf diesen Datentr√§gern verf√ºgbaren freien Speicherplatz aus.  <code>ReWriter_binary</code> bettet einen komprimierten Abschnitt ein, der ein PE-Image und einen Abschnitt der Benutzeroberfl√§che enth√§lt, der einen f√ºr Menschen lesbaren Dateinamen definiert: SecDxe.  Der komprimierte Abschnitt wird dem Dateikopf hinzugef√ºgt und am Ende des Volumes in freien Speicherplatz geschrieben.  Die folgende Abbildung zeigt die Struktur - ihre Anzeige in UEFITool. <br><br><img src="https://habrastorage.org/webt/g6/9-/-a/g69--aub7xrb5b1iinzwrtpxyo8.png"><br>  <i>Abbildung 11. Ansicht der SecDxe-Datei in UEFITool</i> <br><br>  Wenn der NtfsDxe-Treiber im Image vorhanden ist, wird er entfernt.  Das Firmware-Dateisystem speichert Dateien und deren Inhalt nacheinander, sodass der Vorgang recht einfach ist: <br><br><ul><li>  Einzug in einen freien Speicherplatz am Ende des Bandes </li><li>  0xFF-Bytes, die √ºber das NtfsDxe-Image geschrieben wurden </li><li>  Der n√§chste Teil des Firmware-Volumes wird kopiert, beginnend mit dem Einzug, in dem sich NtfsDxe befand </li><li>  Der Rest des Dateisystems ist mit 0xFF-Bytes gef√ºllt, d. h. freiem Speicherplatz </li></ul><br><h4>  Gepatchte Firmware zur√ºck in den SPI-Flash-Speicher schreiben </h4><br>  Nachdem Sie erfolgreich √Ñnderungen am Firmware-Image vorgenommen haben, m√ºssen Sie es im n√§chsten Schritt in den SPI-Flash-Speicher zur√ºckschreiben.  Bevor wir uns mit diesem Prozess befassen, m√ºssen wir einige der in diesem Fall wichtigen BIOS-Schreibschutzfunktionen charakterisieren.  Andere vorhandene Mechanismen, wie das Range Write Protection BIOS, bleiben fern, da ReWriter_binary sie nicht √ºberpr√ºft. <br><br>  Die Plattform verwendet mehrere Sicherheitsmechanismen, um nicht autorisierte Schreibversuche in den BIOS-Bereich zu blockieren.  Ich muss sagen, dass diese Mechanismen nicht standardm√§√üig aktiviert sind.  Die Firmware ist f√ºr die korrekte Konfiguration verantwortlich.  Diese Konfigurationen werden im BIOS-Steuerregister (BIOS_CNTL) dargestellt.  Es enth√§lt das BIOSWE-Bit (BIOS Write Enable), das auf ‚Äû1‚Äú geschaltet werden muss, um in den BIOS-Bereich des SPI-Flash-Speichers schreiben zu k√∂nnen.  Da die Plattform keinen Versuch zulassen sollte, in den BIOS-Bereich zu schreiben, enth√§lt BIOS_CNTL noch ein Bit zum Schutz von BIOSWE - dies ist BIOS Lock Enable (BLE).  Wenn es gesetzt ist, sollte der Mechanismus das BIOSWE-Bit blockieren und den Wert gleich "0" lassen.  Die L√∂sung weist jedoch eine Sicherheitsanf√§lligkeit auf.  Wenn eine Anforderung zum √Ñndern des BIOSWE-Bits auf "1" und des BIOSWE-Bits auf "1" eingeht und die Plattform die Aufgabe erst dann mithilfe von System Management Interrupt (SMI) unterbricht, √§ndert der Code f√ºr dieses SMI das BIOSWE-Bit zur√ºck auf "0". <br><br>  In dieser Version der L√∂sung gibt es viele Probleme. -,  SMI    .        ,  BLE  ,     ¬´0¬ª  BIOSWE   . -,      ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a> ¬ª,      ,    SMI  .        ,   BIOSWE  ¬´1¬ª,           SPI -.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>   ,                  Hyper-Threading. <br><br>           ,   BIOS_CNTL.       Intel Platform Controller Hub (PCH).    , SMM BIOS Write Protect Disable (SMM_BWP)      BIOS    ,       System Management Mode (SMM)  BIOSWE    ¬´1¬ª.      ¬´  ¬ª,  . ,      BLE, SMM_BWP     .  ,      ,           BIOS. <br><br> <code>ReWriter_binary</code>     BIOS,    . <br><br>   ,   BIOSWE.   ,     .  BIOSWE ,     BLE.    ,     BIOSWE     .   BLE ,     SMM_BWP   ¬´  ¬ª,  .   SMM_BWP ,   .    . <br><br><img src="https://habrastorage.org/webt/db/3t/n5/db3tn5tpff0bgjciq9ciiy3a6p4.png"><br> <i> 12.       </i> <br><br> ,     <code>ReWriter_binary</code>    UEFI ,    ,         BIOS,     ,  Platform Controller Hub. <br><br> <code>ReWriter_binary</code>      UEFI     .      SmiFlash UEFI    UEFI ,          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   BIOS</a> . <br><br>          SPI -: <br><br><img src="https://habrastorage.org/webt/ct/wi/v3/ctwiv38relsl9rpveltd8imrpjy.png"><br> <i> 13.    SPI -</i> <br><br>    ,   ,     ,        SPI -. <br><br>    ,  SPI -      <code>image.bin</code> .     ,   <code>ReWriter_read</code> ,     .  ,   SPI -,      . <br><br>  -  ,     .           .      ,   ,  . <br><br>        : <br><br> <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\BootExecute = ‚Äúautocheck autochk *‚Äù</code> <br> <br>   RwDrv   . ,     Windows    ,    UEFI               Windows.      ,     UEFI   . <br><br><h2>   LoJax </h2><br>   ,     SPI -            .     UEFI  . ,        ‚Äì   ,  ,    .         UEFI,     .  ,   UEFI  Sednit        ,   ,      in-the-wild. <br><br>   ,        .  ,      ‚Äì , XAgent.            ,     ‚Äì ,     .       , ,          ,            .          ,   ,         ,    . <br><br>       UEFI     .   SecDxe DXE   DXE.         <code>EFI_EVENT_GROUP_READY_TO_BOOT</code> .          ,   .    : <br><br><ul><li>    NTFS DXE         NTFS </li><li>      NTFS Windows: rpcnetp.exe  autoche.exe </li><li>    'HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\ Session Manager\BootExecute': : 'autocheck autochk *'; : 'autocheck autoche *' . </li></ul><br><img src="https://habrastorage.org/webt/at/qy/ec/atqyecti3adwerrfljy0ccirxgy.png"><br> <i> 14.   ,   UEFI</i> <br><br><h4> SecDxe:   DXE </h4><br>       ,    .    ,          ,     . <br><br> UEFI   Sednit ‚Äì   DXE  GUID  <code>682894B5-6B70-4EBA-9E90-A607E5676297</code> . <br><br>   ,           Secure Boot.        DXE Foundation      . <br><br> SecDxe ‚Äì   DXE, ,  ,   .   ,   GUID <code>832d9b4d-d8d5-425f-bd52-5c5afb2c85dc</code> ,    .        .     ,     <code>EFI_EVENT_GROUP_READY_TO_BOOT</code> .         ,        . <br><br><img src="https://habrastorage.org/webt/sj/ff/6o/sjff6ohskqe2ewtsv8xnyis3oss.png"><br> <i> 15.    Hex-Rays    </i> <br><br>      UEFI  Sednit.       NTFS Windows.  ,  UEFI      EFI,   NTFS   .     FAT     .  UEFI         NTFS.    SecDxe    NTFS .         .    <code>EFI_SIMPLE_FILE_SYSTEM_PROTOCOL</code>     NTFS ,       . <br><br> ,         Windows, SecDxe  <code>rpcnetp.exe</code>  <code>autoche.exe</code> .  <code>rpcnetp.exe</code>   <code>%WINDIR%\SysWOW64</code>  64-  Windows  <code>%WINDIR%\System32</code>  32- .  <code>autoche.exe</code>   <code>%WINDIR%\SysWOW64</code> .     ,       . <br><br><img src="https://habrastorage.org/webt/si/jo/pn/sijopnar5xrablwh02xdrv5e37a.png"><br> <i> 16.    Hex-Rays      </i> <br><br>  SecDxe  <code>%WINDIR%\System32\config\SYSTEM</code> ,       <code>HKLM\SYSTEM</code> .   ,    <code>'autocheck autochk *'</code>    <code>'k'</code>  <code>'autochk'</code>  <code>'e'</code> .   <code>'HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\ BootExecute'</code>   <code>'autocheck autoche *'</code> .    Windows autoche.exe    <code>autochk.exe</code> . <br><br><h4>  NTFS  Hacking Team </h4><br>    ,   SecDxe   NTFS.    ,   Sednit     ,      NTFS DXE  Hacking Team. <br>   NTFS       ntfs-3g.   ,       UEFI DXE.     INF      Hacking Team     ntfs-3g.    SecDxe NTFS        : <br><br> <code>- c:\edk2\NtfsPkg\NtfsDxe\ntfs\inode.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\volume.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\bootsect.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\unistr.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\attrib.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\mft.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\index.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\cache.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\misc.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\dir.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\runlist.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\logfile.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\uefi_io.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\ntfsinternal.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\mst.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\lcnalloc.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\compress.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\bitmap.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\collate.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\security.c</code> <br> <br>  ,       ,     vector-edk,  Hacking Team   EFI.  vector-edk   <code>NtfsPkg</code>     .     ntfs-3g      .         ,  ,     . <br><br>        ,       Hex-Rays,  ,       .        <code>NtfsDriverBindingStart</code> ,   <code>vector-edk/NtfsPkg/NtfsDxe/Ntfs.c</code> .     HT    .      .       (LockedByMe)    . <br><br><img src="https://habrastorage.org/webt/qn/-k/ut/qn-kutvxgtnyuqkcvvo8zwfglya.png"><br> <i> 17.      Hex-Rays NTFS  Sednit ()  NTFS  HT ()</i> <br><br>      Hacking Team,     ntfs-3g.     <code>ReWriter_binary</code> ,             AMI NTFS.   ,     ,  . <br><br>     ,       .       ,        .  ,   Sednit   ,   ,        NTFS,      .        ,  Hacking Team      .  ,       ,   - . <br><br>           ,   UEFI.    ,   ,   Sednit    vector-edk  Hacking Team     NTFS     NTFS  Windows.       ,  SecDxe. <br><br><h4> autoche.exe vs. autochk.exe </h4><br>  <code>autoche.exe</code>     - <code>rpcnetp.exe</code> .     ,      Windows API   . <br><br><img src="https://habrastorage.org/webt/wc/dk/fv/wcdkfvfmcoog14t1orjmryouwd4.png"><br> <i> 18.  autoche .exe   rpcnetp.exe</i> <br><br>  ,      ,     Computrace.          <code>BootExecute</code> . <br><br><img src="https://habrastorage.org/webt/yz/wc/lj/yzwclj1loxeconb728wvsxqvyse.png"><br> <i> 19.  autoche.exe      BootExecute</i> <br><br>        Windows,        <code>BootExecute</code> .  ,   autoche .exe      autochk.exe  Computrace, ,   API   ,     .  Computrace ,       <code>autochk.exe</code>    .      -  ,      LoJax   UEFI . <br><br><h4> rpcnetp.exe </h4><br>     - <code>rpcnetp.exe</code>    UEFI ,  ,    ,      LoJack, -    . ,         UEFI ,     ,       . <br><br>        - LoJax.          /IP-.    ,             Computrace,   2008 . <br><br>     ,   LoJax     ,  ,    .     LoJax ‚Äì   ,          . <br><br><h2>      </h2><br>      ,     . <s>  ,       ‚Äì  Secure Boot.  Secure Boot ,            ,     .</s>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a> Secure Boot,        UEFI. <br><br>       ,  UEFI    .     ,  ,      . <br><br>    ,          Platform Controller Hub (   Intel Series 5  ).       ¬´  ¬ª, ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> ,   . <br><br>        UEFI/BIOS.  ,  ,      ,     .          .  ,         ,   .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CHIPSEC</a> ,     ,    ,   ,    . <br><br>     UEFI    .         ,       ,     .          SPI -.   ,      .   UEFI   ,      SPI -.   UEFI ,   ‚Äì     . <br><br><h2>  Schlussfolgerungen </h2><br> UEFI  ‚Äì                     ,       .  UEFI    ,       UEFI     .  ,  UEFI    ,    ,      .   ,  ,    ,    UEFI . <br><br>          threatintel@eset.com <br><br>     ,     opensecuritytraining.info.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Introduction to BIOS &amp; SMM</a>   ,      - SPI. <br><br><h2>  </h2><br>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Intel</a>     . <br> ‚Äî BIOS_CNTL: BIOS Control Register <br> ‚Äî BIOSWE: BIOS Write Enabled <br> ‚Äî BLE: BIOS Lock Enabled <br> ‚Äî FADDR: Flash Address <br> ‚Äî FDATAX: Flash Data from FDATA0 to FDATAN <br> ‚Äî FDBC: Flash Data Byte Count <br> ‚Äî FGO: Flash Cycle Go <br> ‚Äî HSFC: Hardware Sequencing Flash Control <br> ‚Äî HSFS: Hardware Sequencing Flash Status <br> ‚Äî IOCTL: Input/Output Control <br> ‚Äî PCH: Platform Controller Hub <br> ‚Äî RCBA: Root Complex Base Address Register <br> ‚Äî RCRB: Root Complex Register Block <br> ‚Äî SCIP: SPI Cycle in Progress <br> ‚Äî SMI: System Management Interrupt <br> ‚Äî SMM: System Management Mode <br> ‚Äî SMM_BWP: SMM BIOS Write Protect Disable <br> ‚Äî SPI: Serial Peripheral Interface <br><br><h2>   </h2><br><h4> ReWriter_read.exe </h4><br>  ESET <br> <code>Win32/SPIFlash.A</code> <br> SHA-1 <br> <code>ea728abe26bac161e110970051e1561fd51db93b</code> <br> <br><h4> ReWriter_binary.exe </h4><br>  ESET <br> <code>Win32/SPIFlash.A</code> <br> SHA-1 <br> <code>cc217342373967d1916cb20eca5ccb29caaf7c1b</code> <br> <br><h4> SecDxe </h4><br>  ESET <br> <code>EFI/LoJax.A</code> <br> SHA-1 <br> <code>f2be778971ad9df2082a266bd04ab657bd287413</code> <br> <br><h4> info_efi.exe </h4><br>  ESET <br> <code>Win32/Agent.ZXZ</code> <br> SHA-1 <br> <code>4b9e71615b37aea1eaeb5b1cfa0eee048118ff72</code> <br> <br><h4> autoche.exe </h4><br>  ESET <br> <code>Win32/LoJax.A</code> <br> SHA-1 <br> <code>700d7e763f59e706b4f05c69911319690f85432e</code> <br> <br><h4> - EXE </h4><br>  ESET <br> <code>Win32/Agent.ZQE <br> Win32/Agent.ZTU</code> <br> SHA-1 <br> <code>1771e435ba25f9cdfa77168899490d87681f2029 <br> ddaa06a4021baf980a08caea899f2904609410b9 <br> 10d571d66d3ab7b9ddf6a850cb9b8e38b07623c0 <br> 2529f6eda28d54490119d2123d22da56783c704f <br> e923ac79046ffa06f67d3f4c567e84a82dd7ff1b <br> 8e138eecea8e9937a83bffe100d842d6381b6bb1 <br> ef860dca7d7c928b68c4218007fb9069c6e654e9 <br> e8f07caafb23eff83020406c21645d8ed0005ca6 <br> 09d2e2c26247a4a908952fee36b56b360561984f <br> f90ccf57e75923812c2c1da9f56166b36d1482be</code> <br> <br><h4>     </h4><br> <code>secao[.]org <br> ikmtrust[.]com <br> sysanalyticweb[.]com <br> lxwo[.]org <br> jflynci[.]com <br> remotepx[.]net <br> rdsnets[.]com <br> rpcnetconnect[.]com <br> webstp[.]com <br> elaxo[.]org</code> <br> <br><h4> IP-   </h4><br> <code>185.77.129[.]106 <br> 185.144.82[.]239 <br> 93.113.131[.]103 <br> 185.86.149[.]54 <br> 185.86.151[.]104 <br> 103.41.177[.]43 <br> 185.86.148[.]184 <br> 185.94.191[.]65 <br> 86.106.131[.]54</code> <br> <br><h4> - DLL </h4><br>  ESET <br> <code>Win32/Agent.ZQE</code> <br> SHA-1 <br> <code>397d97e278110a48bd2cb11bb5632b99a9100dbd</code> <br>     <br> <code>elaxo.org</code> <br> IP-   <br> <code>86.106.131[.]54</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de425251/">https://habr.com/ru/post/de425251/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de425241/index.html">Entwickler 20 Jahre sp√§ter: Vasily Lebedev √ºber ICRE, Bildung, sein Buch und Programmierung</a></li>
<li><a href="../de425243/index.html">Das John Willis Handbuch</a></li>
<li><a href="../de425245/index.html">Ank√ºndigung von RamblerFront & # 6</a></li>
<li><a href="../de425247/index.html">Crowdsourcing beim Testen</a></li>
<li><a href="../de425249/index.html">Wie ist die Bekanntschaft mit LLP an der ITMO University: der Kurs "Low-Level Programming"</a></li>
<li><a href="../de425253/index.html">Wir machen ein maschinelles Lernprojekt in Python. Teil 1</a></li>
<li><a href="../de425255/index.html">Broo verlustfreier Komprimierungsalgorithmus und Delta-Codierung, Vergleich mit Xdelta3. Home Projektentwicklung</a></li>
<li><a href="../de425259/index.html">Sichern Sie Ihre Site mit git und Makefile</a></li>
<li><a href="../de425261/index.html">EV-Zertifikate sind tot</a></li>
<li><a href="../de425263/index.html">Das Festival iFEST findet in Nischni Nowgorod statt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>