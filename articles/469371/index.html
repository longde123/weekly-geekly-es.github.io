<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üâë üîÆ üîÆ Descripci√≥n del enfoque para organizar y probar c√≥digo usando Redux Thunk üë∑üèº üë®üèª‚Äçüè´ üê∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! 


 En esta publicaci√≥n, me gustar√≠a compartir mi enfoque para organizar y probar el c√≥digo usando Redux Thunk en un proyecto React . 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Descripci√≥n del enfoque para organizar y probar c√≥digo usando Redux Thunk</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/epam_systems/blog/469371/"><p>  Hola a todos! </p><br><p>  En esta publicaci√≥n, me gustar√≠a compartir mi enfoque para organizar y probar el c√≥digo usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Redux Thunk</a> en un proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">React</a> . </p><br><p>  El camino fue largo y espinoso, as√≠ que intentar√© demostrar el tren de pensamiento y motivaci√≥n que condujo a la decisi√≥n final. </p><a name="habracut"></a><br><h2 id="opisanie-prilozheniya-i-postanovka-problemy">  Descripci√≥n de la solicitud y enunciado del problema. </h2><br><p>  Primero, un peque√±o contexto. </p><br><p>  La siguiente figura muestra el dise√±o de una p√°gina t√≠pica en nuestro proyecto. </p><br><p><img src="https://habrastorage.org/webt/rk/je/ac/rkjeacwa1f4shulpc5ge5y4oi6q.jpeg"></p><br><p>  En orden: </p><br><ul><li>  La tabla (No. 1) contiene datos que pueden ser muy diferentes (texto plano, enlaces, im√°genes, etc.). </li><li>  El panel de clasificaci√≥n (No. 2) establece la configuraci√≥n de clasificaci√≥n de datos en la tabla por columnas. </li><li>  El panel de filtrado (No. 3) establece varios filtros para las columnas de la tabla. </li><li>  El panel de columnas (No. 4) le permite configurar la visualizaci√≥n de las columnas de la tabla (mostrar / ocultar). </li><li>  El panel de plantillas (No. 5) le permite seleccionar plantillas de configuraci√≥n creadas previamente.  Las plantillas incluyen datos de los paneles No. 2, No. 3, No. 4, as√≠ como algunos otros datos, por ejemplo, la posici√≥n de las columnas, su tama√±o, etc. </li></ul><br><p>  Los paneles se abren haciendo clic en los botones correspondientes. </p><br><p>  Los datos sobre qu√© columnas en la tabla pueden ser, qu√© datos pueden estar en ellas, c√≥mo deben mostrarse, qu√© valores pueden contener los filtros y otra informaci√≥n est√° contenida en los metadatos de la tabla, que se solicitan por separado de los datos al comienzo de la carga de la p√°gina. </p><br><p>  Resulta que el estado actual de la tabla y los datos que contiene dependen de tres factores: </p><br><ul><li>  Datos de los metadatos de la tabla. </li><li>  Configuraciones para la plantilla seleccionada actualmente. </li><li>  Configuraciones personalizadas (cualquier cambio relacionado con la plantilla seleccionada se guarda en una especie de "borrador", que se puede convertir en una nueva plantilla, actualizar la actual con la nueva configuraci√≥n, o eliminarla y devolver la plantilla a su estado original). </li></ul><br><p>  Como se mencion√≥ anteriormente, tal p√°gina es t√≠pica.  Para cada una de esas p√°ginas (o, m√°s precisamente, para la tabla que contiene), se crea una entidad separada en el repositorio de Redux para la conveniencia de operar con sus datos y par√°metros. </p><br><p>  Para poder establecer conjuntos homog√©neos de creadores de acciones y thunk y actualizar datos en una entidad espec√≠fica, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se utiliza</a> el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">siguiente enfoque</a> (una especie de f√°brica): </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionsCreator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prefix, getCurrentStore, entityModel</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* --- ACTIONS BLOCK --- */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounterStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span> }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounterSuccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">payload</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_SUCCESS`</span></span>, payload }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounterError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_ERROR`</span></span>, error }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyFilterSuccess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">payload</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_SUCCESS`</span></span>, payload }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyFilterError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_ERROR`</span></span>, error }; } <span class="hljs-comment"><span class="hljs-comment">/* --- THUNKS BLOCK --- */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchTotalCounter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> dispatch =&gt; { dispatch(fetchTotalCounterStart()); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } } = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> entityModel.fetchTotalCounter(filter); dispatch(fetchTotalCounterSuccess(payload)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) { dispatch(fetchTotalCounterError(error)); } }; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">filter, dispatch</span></span></span><span class="hljs-function">) </span></span>{ dispatch(fetchTotalCounter(filter)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> entityModel.fetchData(filter); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applyFilter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newFilter</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (dispatch, getStore) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = getStore(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentStore = getCurrentStore(store); <span class="hljs-comment"><span class="hljs-comment">// 'getFilter' comes from selectors. const filter = newFilter || getFilter(currentStore); const { data: { payload } } = await fetchData(filter, dispatch); dispatch(applyFilterSuccess(payload)); } catch (error) { dispatch(applyFilterError(error)); } }; } return { fetchTotalCounterStart, fetchTotalCounterSuccess, fetchTotalCounterError, applyFilterSuccess, applyFilterError, fetchTotalCounter, fetchData, applyFilter, }; };</span></span></code> </pre> <br><p>  Donde: </p><br><ul><li>  <code>prefix</code> : <code>prefix</code> entidad en el repositorio de Redux.  Es una cadena de la forma "CATS_", "MICE_", etc. </li><li>  <code>getCurrentStore</code> : un selector que devuelve los datos actuales de la entidad desde el repositorio de Redux. </li><li>  <code>entityModel</code> : una instancia de la clase de modelo de entidad.  Por un lado, se accede a una API a trav√©s del modelo para crear una solicitud al servidor, por otro lado, se describe una l√≥gica de procesamiento de datos compleja (o no). </li></ul><br><p>  Por lo tanto, esta f√°brica le permite describir de manera flexible la administraci√≥n de datos y par√°metros de una entidad en particular en el repositorio de Redux y asociar esto con la tabla correspondiente a esta entidad. </p><br><p>  Dado que hay muchos matices en la administraci√≥n de este sistema, el thunk puede ser complejo, voluminoso, confuso y tener partes repetidas.  Para simplificarlos, as√≠ como para reutilizar el c√≥digo, los thunks complejos se dividen en otros m√°s simples y se combinan en una composici√≥n.  Como resultado de esto, ahora puede <code>fetchTotalCounter</code> que un thunk llama a otro, que ya puede enviar <code>applyFilter</code> ordinarias (como el paquete <code>fetchTotalCounter</code> - <code>fetchTotalCounter</code> del ejemplo anterior).  Y cuando se tuvieron en cuenta todos los puntos principales, y se describieron todos los creadores de acciones y thunk necesarios, el archivo que conten√≠a la funci√≥n <code>actionsCreator</code> ten√≠a ~ 1200 l√≠neas de c√≥digo y se prob√≥ con gran chirrido.  El archivo de prueba tambi√©n ten√≠a alrededor de 1200 l√≠neas, pero la cobertura era en el mejor de 40-50%. </p><br><p>  Aqu√≠, el ejemplo, por supuesto, se simplifica enormemente, tanto en t√©rminos del n√∫mero de thunk como de su l√≥gica interna, pero esto ser√° suficiente para demostrar el problema. </p><br><p>  Presta atenci√≥n a 2 tipos de thunk en el ejemplo anterior: </p><br><ul><li>  <code>fetchTotalCounter</code> : <code>fetchTotalCounter</code> despacho solo. </li><li>  <code>applyFilter</code> : adem√°s del env√≠o de sus <code>applyFilterSuccess</code> ( <code>applyFilterSuccess</code> , <code>applyFilterError</code> ), tambi√©n es otro thunk ( <code>fetchTotalCounter</code> ). <br>  Volveremos a ellos un poco m√°s tarde. </li></ul><br><p>  Todo esto se prob√≥ de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">siguiente manera</a> (el marco se us√≥ para probar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jest</a> ): </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> configureMockStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-mock-store'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> thunk <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-thunk'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { actionsCreator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'actionsCreator'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> defaultState = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> middlewares = [thunk]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mockStore = configureMockStore(middlewares); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prefix = <span class="hljs-string"><span class="hljs-string">'TEST_'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getCurrentStore = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> defaultState; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> entityModel = { <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounter</span></span>: jest.fn(), <span class="hljs-attr"><span class="hljs-attr">fetchData</span></span>: jest.fn(), }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> actions; beforeEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { actions = actionsCreator(prefix, getCurrentStore, entityModel); }); describe(<span class="hljs-string"><span class="hljs-string">'fetchTotalCounter'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on success'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> payload = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = mockStore(defaultState); entityModel.fetchTotalCounter.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload }, }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> expectedActions = [ { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_SUCCESS`</span></span>, payload, } ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> store.dispatch(actions.fetchTotalCounter(filter)).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { expect(store.getActions()).toEqual(expectedActions); }); }); it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on error'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> error = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = mockStore(defaultState); entityModel.fetchTotalCounter.mockRejectedValueOnce(error); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> expectedActions = [ { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_ERROR`</span></span>, error, } ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> store.dispatch(actions.fetchTotalCounter(filter)).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { expect(store.getActions()).toEqual(expectedActions); }); }); }); describe(<span class="hljs-string"><span class="hljs-string">'applyFilter'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on success'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> payload = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newFilter = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = mockStore(defaultState); entityModel.fetchData.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } }); entityModel.fetchTotalCounter.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: counter }, }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> expectedActions = [ <span class="hljs-comment"><span class="hljs-comment">// fetchTotalCounter actions { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, { type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, payload: counter, }, // applyFilter actions { type: `${prefix}APPLY_FILTER_SUCCESS`, payload, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); }); }); it('should dispatch correct actions on error', () =&gt; { const error = {}; const counter = 0; const newFilter = {}; const store = mockStore(defaultState); entityModel.fetchData.mockRejectedValueOnce(error); entityModel.fetchTotalCounter.mockResolvedValueOnce({ data: { payload: counter }, }); const expectedActions = [ // fetchTotalCounter actions { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, { type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, payload: counter, }, // applyFilter actions { type: `${prefix}APPLY_FILTER_ERROR`, error, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); }); }); }); });</span></span></code> </pre> <br><p>  Como puede ver, no hay problemas al probar el primer tipo de thunk: solo necesita conectar el <code>entityModel</code> modelo entityModel, pero el segundo tipo es m√°s complicado: debe borrar los datos de toda la cadena de thunk llamado y los m√©todos de modelo correspondientes.  De lo contrario, la prueba recaer√° en la desestructuraci√≥n de los datos ( <strong>{data: {payload}}</strong> ), y esto puede suceder expl√≠cita o impl√≠citamente (fue tal que la prueba pas√≥ con √©xito, pero con una cuidadosa investigaci√≥n se not√≥ que en el segundo / tercero enlace de esta cadena hubo una ca√≠da en la prueba debido a la falta de datos bloqueados).  Tambi√©n es malo que las pruebas unitarias de funciones individuales se conviertan en una especie de integraci√≥n y se relacionen estrechamente. </p><br><p>  Surge la pregunta: ¬øpor qu√© en la funci√≥n <code>applyFilter</code> verifica c√≥mo se <code>fetchTotalCounter</code> funci√≥n <code>fetchTotalCounter</code> si <strong>ya se han</strong> escrito pruebas detalladas separadas para ella?  ¬øC√≥mo puedo hacer que la prueba del segundo tipo de thunk sea m√°s independiente?  Ser√≠a genial tener la oportunidad de probar que <strong>thunk</strong> (en este caso <code>fetchTotalCounter</code> ) <strong>solo se llama con los par√°metros correctos</strong> , y no habr√≠a necesidad de cuidar a los moks para que funcione correctamente. </p><br><p>  ¬øPero c√≥mo hacerlo?  Me viene a la mente la decisi√≥n obvia: conectar la funci√≥n fetchData, que se llama en <code>applyFilter</code> , o bloquear <code>fetchTotalCounter</code> (ya que a menudo se llama a otro thunk directamente, y no a trav√©s de alguna otra funci√≥n como <code>fetchData</code> ). </p><br><p>  Prob√©moslo.  Por ejemplo, cambiaremos solo un script exitoso. </p><br><ul><li>  Opci√≥n n√∫mero 1.  Funci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>fetchData</code></a> simulada: </li></ul><br><pre> <code class="diff hljs">describe('applyFilter', () =&gt; { it('should dispatch correct actions on success', () =&gt; { const payload = {}; - const counter = 0; const newFilter = {}; const store = mockStore(defaultState); - entityModel.fetchData.mockResolvedValueOnce({ data: { payload } }); - entityModel.fetchTotalCounter.mockResolvedValueOnce({ - data: { payload: counter }, - }); + const fetchData = jest.spyOn(actions, 'fetchData'); + // or fetchData.mockImplementationOnce(Promise.resolve({ data: { payload } })); + fetchData.mockResolvedValueOnce({ data: { payload } }); const expectedActions = [ - // Total counter actions - { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, - { - type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, - payload: counter, - }, - // apply filter actions { type: `${prefix}APPLY_FILTER_SUCCESS`, payload, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); + expect(actions.fetchTotalCounter).toBeCalledWith(newFilter); }); }); });</code> </pre> <br><p>  Aqu√≠, el m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>jest.spyOn</code></a> reemplaza aproximadamente (y tal vez exactamente) la siguiente implementaci√≥n: </p><br><pre> <code class="javascript hljs">actions.fetchData = jest.fn(actions.fetchData);</code> </pre> <br><p>  Esto nos permite "monitorear" la funci√≥n y comprender si se llam√≥ y con qu√© par√°metros. </p><br><p>  Recibimos el siguiente error: </p><br><pre> <code class="diff hljs">Difference: - Expected + Received Array [ Object { - "payload": Object {}, - "type": "TEST_APPLY_FILTER_SUCCESS", + "type": "TEST_FETCH_TOTAL_COUNTER_START", }, + Object { + "error": [TypeError: Cannot read property 'data' of undefined], + "type": "TEST_FETCH_TOTAL_COUNTER_ERROR", + }, + Object { + "error": [TypeError: Cannot read property 'data' of undefined], + "type": "TEST_APPLY_FILTER_ERROR", + }, ]</code> </pre> <br><p>  Extra√±o, ocultamos la funci√≥n fetchData, <code>fetchData</code> nuestra implementaci√≥n </p><br><pre> <code class="javascript hljs">fetchData.mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } })</code> </pre> <br><p>  pero la funci√≥n funciona exactamente igual que antes, es decir, ¬°el simulacro no funcion√≥!  Prob√©moslo de manera diferente. </p><br><ul><li>  Opci√≥n n√∫mero 2.  Mock <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>fetchTotalCounter</code></a> Funci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>fetchTotalCounter</code></a> : </li></ul><br><pre> <code class="diff hljs">describe('applyFilter', () =&gt; { it('should dispatch correct actions on success', () =&gt; { const payload = {}; - const counter = 0; const newFilter = {}; const store = mockStore(defaultState); entityModel.fetchData.mockResolvedValueOnce({ data: { payload } }); - entityModel.fetchTotalCounter.mockResolvedValueOnce({ - data: { payload: counter }, - }); + const fetchTotalCounter = jest.spyOn(actions, 'fetchTotalCounter'; + fetchTotalCounter.mockImplementation(() =&gt; {}); const expectedActions = [ - // Total counter actions - { type: `${prefix}FETCH_TOTAL_COUNTER_START` }, - { - type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, - payload: counter, - }, - // apply filter actions { type: `${prefix}APPLY_FILTER_SUCCESS`, payload, } ]; return store.dispatch(actions.applyFilter(newFilter)).then(() =&gt; { expect(store.getActions()).toEqual(expectedActions); + expect(actions.fetchTotalCounter).toBeCalledWith(newFilter); }); }); });</code> </pre> <br><p>  Obtenemos exactamente el mismo error.  Por alguna raz√≥n, nuestros mokas no reemplazan la implementaci√≥n original de funciones. </p><br><p>  Habiendo explorado este problema por mi cuenta y encontrando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informaci√≥n</a> en Internet, me di cuenta de que este problema existe no solo conmigo, y se resuelve (en mi opini√≥n) de manera crucial.  Adem√°s, los ejemplos descritos en estas fuentes son buenos hasta que se convierten en parte de algo que los conecta en un solo sistema (en nuestro caso, es una f√°brica con par√°metros). </p><br><p>  En nuestro proyecto en la tuber√≠a de Jenkins hay una verificaci√≥n de c√≥digo de SonarQube, que requiere cubrir los archivos modificados (que est√°n en la solicitud de fusi√≥n / extracci√≥n) <code>&gt; 60%</code> .  Como la cobertura de esta f√°brica, como se dijo anteriormente, no era satisfactoria, y la sola necesidad de cubrir dicho archivo solo caus√≥ depresi√≥n, algo tuvo que hacerse con √©l, de lo contrario, la entrega de nueva funcionalidad podr√≠a disminuir con el tiempo.  Solo se guard√≥ la cobertura de prueba de otros archivos (componentes, funciones) en la misma solicitud de fusi√≥n / extracci√≥n, para alcanzar el% de cobertura de la marca deseada, pero, de hecho, fue una soluci√≥n alternativa, no una soluci√≥n al problema.  Y un buen momento, despu√©s de haber asignado un poco de tiempo en la carrera, comenc√© a pensar c√≥mo se puede resolver este problema. </p><br><h2 id="popytka-resheniya-problemy-1-ya-chto-to-slyshal-pro-redux-saga">  Un intento de resolver el problema n√∫mero 1.  Escuch√© algo sobre Redux-Saga ... </h2><br><p>  ... y me dijeron que las pruebas se simplifican enormemente al usar este middleware. </p><br><p>  De hecho, si <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mira la documentaci√≥n</a> , se sorprender√° de lo simple que se prueba el c√≥digo.  El jugo en s√≠ radica en el hecho de que con este enfoque no hay ning√∫n problema con el hecho de que una saga puede llamar a otra saga: podemos mojarnos y "escuchar" las funciones proporcionadas por el middleware ( <code>put</code> , <code>take</code> , etc.), y verifique que fueron llamados (y llamados con los par√°metros correctos).  Es decir, en este caso, la funci√≥n no accede a otra funci√≥n directamente, sino que se refiere a una funci√≥n de la biblioteca, que luego llama a otras funciones / sagas necesarias. </p><br><p>  "¬øPor qu√© no probar este middleware?"  Pens√© y me puse a trabajar.  Comenz√≥ una historia t√©cnica en Jira, cre√≥ varias tareas (desde la investigaci√≥n hasta la implementaci√≥n y la descripci√≥n de la arquitectura de todo este sistema), recibi√≥ el "visto bueno" y comenz√≥ a hacer una copia m√≠nima del sistema actual con un nuevo enfoque. </p><br><p>  Al principio, todo sali√≥ bien.  Siguiendo el consejo de uno de los desarrolladores, incluso fue posible crear una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">saga global para cargar datos y manejar errores</a> con un nuevo enfoque.  Sin embargo, en alg√∫n momento <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hubo problemas con las pruebas</a> (que, por cierto, no se han resuelto hasta ahora).  Pens√© que esto podr√≠a destruir todas las pruebas disponibles actualmente y producir un mont√≥n de errores, as√≠ que decid√≠ posponer el trabajo en esta tarea hasta que hubiera alguna soluci√≥n al problema, y ‚Äã‚Äãme puse manos a la obra. </p><br><p>  Pasaron un mes o dos, no se encontr√≥ ninguna soluci√≥n, y en alg√∫n momento, despu√©s de haber discutido con ellos.  liderando (ausente) el progreso en esta tarea, decidieron abandonar la implementaci√≥n de Redux-Saga en el proyecto, ya que para ese momento se hab√≠a vuelto demasiado costoso en t√©rminos de costos laborales y la posible cantidad de errores.  As√≠ que finalmente decidimos usar Redux Thunk. </p><br><h2 id="popytka-resheniya-problemy-2-thunk-moduli">  Un intento de resolver el problema n√∫mero 2.  M√≥dulos Thunk </h2><br><p>  Puede ordenar todos los thunk en diferentes archivos, y en aquellos archivos donde un thunk llama a otro (importado), puede borrar esta importaci√≥n usando el m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>jest.mock</code></a> o usando el mismo <code>jest.spyOn</code> .  Por lo tanto, lograremos la tarea anterior de verificar que <strong>se llam√≥</strong> a alg√∫n thunk externo con los par√°metros necesarios, sin preocuparse por los moks.  Adem√°s, ser√≠a mejor romper todos los thunk de acuerdo con su prop√≥sito funcional, para no mantenerlos a todos en un mont√≥n.  Entonces se distinguieron tres de esas especies: </p><br><ul><li>  Relacionado con trabajar con plantillas: <code>templates</code> . </li><li>  Relacionado con trabajar con el filtro (ordenar, mostrar columnas) - <code>filter</code> . </li><li>  Relacionado con el trabajo con la tabla (cargando nuevos datos al desplazarse, porque la tabla tiene un desplazamiento virtual, cargando metadatos, cargando datos por el contador de registros en la tabla, etc.) - <code>table</code> . </li></ul><br><p>  Se propuso la siguiente estructura de carpetas y archivos: </p><br><pre> <code class="bash hljs">src/ |-- store/ | |-- filter/ | | |-- actions/ | | | |-- thunks/ | | | | |-- __tests__/ | | | | | |-- applyFilter.test.js | | | | |-- applyFilter.js | | | |-- actionCreators.js | | | |-- index.js | |-- table/ | | |-- actions/ | | | |-- thunks/ | | | | |-- __tests__/ | | | | | |-- fetchData.test.js | | | | | |-- fetchTotalCounter.test.js | | | | |-- fetchData.js | | | | |-- fetchTotalCounter.js | | | |-- actionCreators.js | | | |-- index.js (main file with actionsCreator)</code> </pre> <br><p>  Un ejemplo de esta arquitectura est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </p><br><p>  En el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">archivo de prueba para applyFilter,</a> puede ver que hemos alcanzado el objetivo por el que nos esforzamos: no puede escribir mokas para mantener el funcionamiento correcto de <code>fetchData</code> / <code>fetchTotalCounter</code> .  Pero a qu√© costo ... </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>applyFilter.js</code></a> : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { applyFilterSuccess, applyFilterError } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { fetchData } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../../table/actions'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// selector const getFilter = store =&gt; store.filter; export function applyFilter(prefix, getCurrentStore, entityModel) { return newFilter =&gt; { return async (dispatch, getStore) =&gt; { try { const store = getStore(); const currentStore = getCurrentStore(store); const filter = newFilter || getFilter(currentStore); const { data: { payload } } = await fetchData(prefix, entityModel)(filter, dispatch); dispatch(applyFilterSuccess(prefix)(payload)); } catch (error) { dispatch(applyFilterError(prefix)(error)); } }; }; }</span></span></code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>actionsCreator</code></a> : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> filterActions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./filter/actions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tableActions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./table/actions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionsCreator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prefix, getCurrentStore, entityModel</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounterStart</span></span>: tableActions.fetchTotalCounterStart(prefix), <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounterSuccess</span></span>: tableActions.fetchTotalCounterSuccess(prefix), <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounterError</span></span>: tableActions.fetchTotalCounterError(prefix), <span class="hljs-attr"><span class="hljs-attr">applyFilterSuccess</span></span>: filterActions.applyFilterSuccess(prefix), <span class="hljs-attr"><span class="hljs-attr">applyFilterError</span></span>: filterActions.applyFilterError(prefix), <span class="hljs-attr"><span class="hljs-attr">fetchTotalCounter</span></span>: tableActions.fetchTotalCounter(prefix, entityModel), <span class="hljs-attr"><span class="hljs-attr">fetchData</span></span>: tableActions.fetchData(prefix, entityModel), <span class="hljs-attr"><span class="hljs-attr">applyFilter</span></span>: filterActions.applyFilter(prefix, getCurrentStore, entityModel) }; };</code> </pre> <br><p>  Por la modularidad de las pruebas, tuve que pagar con duplicaci√≥n de c√≥digo y una dependencia muy fuerte de thunk entre s√≠.  El m√°s m√≠nimo cambio en la cadena de llamadas conducir√° a una refactorizaci√≥n considerable. </p><br><p>  En el ejemplo anterior, se demostr√≥ el ejemplo de <code>table</code> y <code>filter</code> para mantener la coherencia de los ejemplos dados.  De hecho, la refactorizaci√≥n se inici√≥ con <code>templates</code> (ya que result√≥ ser m√°s simple), y all√≠, adem√°s de la refactorizaci√≥n anterior, el concepto de trabajar con plantillas cambi√≥ ligeramente.  Como suposici√≥n, se acept√≥ que solo puede haber un panel de plantillas en una p√°gina (como una tabla).  En ese momento era solo eso, y esto <del>  omisi√≥n </del>  la suposici√≥n nos permiti√≥ simplificar un poco el c√≥digo al eliminar el <code>prefix</code> . <br>  Despu√©s de que los cambios se vierten en la rama de desarrollo principal y se prueben, me fui de vacaciones con un alma tranquila para continuar transfiriendo el resto del c√≥digo a un nuevo enfoque despu√©s de regresar. </p><br><p>  Despu√©s de regresar de vacaciones, me sorprendi√≥ descubrir que mis cambios se hab√≠an revertido.  Result√≥ que apareci√≥ una p√°gina en la que puede haber varias tablas independientes, es decir, la suposici√≥n hecha anteriormente rompi√≥ todo.  As√≠ que todo el trabajo se hizo en vano ... </p><br><p>  Pues casi.  De hecho, ser√≠a posible volver a hacer las mismas acciones (el beneficio de la solicitud de fusi√≥n / extracci√≥n no desapareci√≥, pero permaneci√≥ en la historia), dejando el enfoque de la arquitectura de plantilla sin cambios y cambiando solo el enfoque para organizar thunk-s.  Pero este enfoque todav√≠a no inspiraba confianza debido a su coherencia y complejidad.  No hab√≠a ning√∫n deseo de volver a √©l, aunque esto resolvi√≥ el problema indicado con las pruebas.  Era necesario idear algo m√°s, m√°s simple y m√°s confiable. </p><br><h2 id="popytka-resheniya-problemy-3-kto-ischet-tot-naydyot">  Un intento de resolver el problema n√∫mero 3.  El que busca encontrar√° </h2><br><p>  Al observar globalmente c√≥mo se escriben las pruebas para thunk, not√© con qu√© facilidad y sin problemas los m√©todos (de hecho, los campos de objetos) de <code>entityModel</code> . </p><br><p>  Entonces surgi√≥ la idea: ¬øpor qu√© no crear una clase cuyos m√©todos son creadores de acci√≥n y thunk?  Los par√°metros pasados ‚Äã‚Äãa la f√°brica se pasar√°n al constructor de esta clase y ser√°n accesibles a trav√©s de <code>this</code> .  Puede hacer una peque√±a optimizaci√≥n de inmediato haciendo una clase separada para creadores de acci√≥n y una separada para thunk, y luego heredar una de otra.  Por lo tanto, estas clases funcionar√°n como una sola (al crear una instancia de la clase heredera), pero al mismo tiempo cada clase individualmente ser√° m√°s f√°cil de leer, comprender y evaluar. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aqu√≠</a> hay un c√≥digo que demuestra este enfoque. </p><br><p>  Consideremos con m√°s detalle cada uno de los archivos que han aparecido y cambiado. </p><br><ul><li>  En el archivo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>FilterActionCreators.js</code></a> , declaramos una clase en la que los m√©todos son creadores de acciones: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FilterActionCreators</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(config) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.prefix = config.prefix; } applyFilterSuccess = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">payload</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_SUCCESS`</span></span>, payload, }); applyFilterError = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.prefix}</span></span></span><span class="hljs-string">APPLY_FILTER_ERROR`</span></span>, error, }); }</code> </pre> <br><ul><li>  En el archivo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>FilterActions.js</code></a> , heredamos de la clase <code>FilterActionCreators</code> y definimos thunk <code>applyFilter</code> como un m√©todo de esta clase.  En este caso, los <code>applyFilterSuccess</code> acciones <code>applyFilterSuccess</code> y <code>applyFilterError</code> estar√°n disponibles a trav√©s de <code>this</code> : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FilterActionCreators } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'/FilterActionCreators'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// selector const getFilter = store =&gt; store.filter; export class FilterActions extends FilterActionCreators { constructor(config) { super(config); this.getCurrentStore = config.getCurrentStore; this.entityModel = config.entityModel; } applyFilter = ({ fetchData }) =&gt; { return newFilter =&gt; { return async (dispatch, getStore) =&gt; { try { const store = getStore(); const currentStore = this.getCurrentStore(store); const filter = newFilter || getFilter(currentStore); const { data: { payload } } = await fetchData(filter, dispatch); // Comes from FilterActionCreators dispatch(this.applyFilterSuccess(payload)); } catch (error) { // Comes from FilterActionCreators dispatch(this.applyFilterError(error)); } }; }; }; }</span></span></code> </pre> <br><ul><li>  En el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">archivo principal</a> con todos los <code>FilterActions</code> thunk y action, creamos una instancia de la clase <code>FilterActions</code> , pas√°ndole el objeto de configuraci√≥n necesario.  Al exportar funciones (al final de la funci√≥n <code>actionsCreator</code> ), no olvide anular el m√©todo <code>applyFilter</code> para pasarle la dependencia <code>fetchData</code> : </li></ul><br><pre> <code class="diff hljs"><span class="hljs-addition"><span class="hljs-addition">+ import { FilterActions } from './filter/actions/FilterActions'; - // selector - const getFilter = store =&gt; store.filter; export const actionsCreator = (prefix, getCurrentStore, entityModel) =&gt; { + const config = { prefix, getCurrentStore, entityModel }; + const filterActions = new FilterActions(config); /* --- ACTIONS BLOCK --- */ function fetchTotalCounterStart() { return { type: `${prefix}FETCH_TOTAL_COUNTER_START` }; } function fetchTotalCounterSuccess(payload) { return { type: `${prefix}FETCH_TOTAL_COUNTER_SUCCESS`, payload }; } function fetchTotalCounterError(error) { return { type: `${prefix}FETCH_TOTAL_COUNTER_ERROR`, error }; } - function applyFilterSuccess(payload) { - return { type: `${prefix}APPLY_FILTER_SUCCESS`, payload }; - } - - function applyFilterError(error) { - return { type: `${prefix}APPLY_FILTER_ERROR`, error }; - } /* --- THUNKS BLOCK --- */ function fetchTotalCounter(filter) { return async dispatch =&gt; { dispatch(fetchTotalCounterStart()); try { const { data: { payload } } = await entityModel.fetchTotalCounter(filter); dispatch(fetchTotalCounterSuccess(payload)); } catch (error) { dispatch(fetchTotalCounterError(error)); } }; } function fetchData(filter, dispatch) { dispatch(fetchTotalCounter(filter)); return entityModel.fetchData(filter); } - function applyFilter(newFilter) { - return async (dispatch, getStore) =&gt; { - try { - const store = getStore(); - const currentStore = getCurrentStore(store); - // 'getFilter' comes from selectors. - const filter = newFilter || getFilter(currentStore); - const { data: { payload } } = await fetchData(filter, dispatch); - - dispatch(applyFilterSuccess(payload)); - } catch (error) { - dispatch(applyFilterError(error)); - } - }; - } return { fetchTotalCounterStart, fetchTotalCounterSuccess, fetchTotalCounterError, - applyFilterSuccess, - applyFilterError, fetchTotalCounter, fetchData, - applyFilter + ...filterActions, + applyFilter: filterActions.applyFilter({ fetchData }), }; };</span></span></code> </pre> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Las pruebas se</a> han vuelto un poco m√°s f√°ciles tanto en la implementaci√≥n como en la lectura: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FilterActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../FilterActions'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'FilterActions'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> prefix = <span class="hljs-string"><span class="hljs-string">'TEST_'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getCurrentStore = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function"> =&gt;</span></span> store; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> entityModel = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = { prefix, getCurrentStore, entityModel }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FilterActions(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dispatch = jest.fn(); beforeEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch.mockClear(); }); describe(<span class="hljs-string"><span class="hljs-string">'applyFilter'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getStore = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newFilter = {}; it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on success'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> payload = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchData = jest.fn().mockResolvedValueOnce({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> applyFilterSuccess = jest.spyOn(actions, <span class="hljs-string"><span class="hljs-string">'applyFilterSuccess'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); expect(fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterSuccess).toBeCalledWith(payload); }); it(<span class="hljs-string"><span class="hljs-string">'should dispatch correct actions on error'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> error = {}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetchData = jest.fn().mockRejectedValueOnce(error); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> applyFilterError = jest.spyOn(actions, <span class="hljs-string"><span class="hljs-string">'applyFilterError'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); expect(fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterError).toBeCalledWith(error); }); }); });</code> </pre><br><p>  En principio, en las pruebas, podr√≠a reemplazar la √∫ltima verificaci√≥n de esta manera: </p><br><pre> <code class="diff hljs"><span class="hljs-deletion"><span class="hljs-deletion">- expect(applyFilterSuccess).toBeCalledWith(payload); + expect(dispatch).toBeCalledWith(applyFilterSuccess(payload)); - expect(applyFilterError).toBeCalledWith(error); + expect(dispatch).toBeCalledWith(applyFilterError(error));</span></span></code> </pre> <br><p>  Entonces no habr√≠a necesidad de <code>jest.spyOn</code> con <code>jest.spyOn</code> .    ,  ,            .        thunk,       .    ,    ... </p><br><p>    ,  ,    ,     -: ,  thunk-  action creator-      ,    ,   .        ,   .         <code>actionsCreator</code> -   ,   : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { FilterActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./filter/actions/FilterActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { TemplatesActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./templates/actions/TemplatesActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { TableActions } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./table/actions/TableActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actionsCreator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prefix, getCurrentStore, entityModel</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = { prefix, getCurrentStore, entityModel }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filterActions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FilterActions(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> templatesActions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TemplatesActions(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableActions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TableActions(config); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...filterActions, ...templatesActions, ...tableActions, }; };</code> </pre> <br><p>     .     <code>filterActions</code>          <code>templatesActions</code>  <code>tableActions</code> ,   ,   ,     <code>filterActions</code> ?           ,    .           .         - ,      ,    . </p><br><p>   .      ,     back-end  (  Java),      .   ,  Java/Spring      ,   .         - ? </p><br><p>      : </p><br><ul><li>    thunk-   <code>setDependencies</code> ,        ‚Äî <code>dependencies</code> : </li></ul><br><pre> <code class="diff hljs">export class FilterActions extends FilterActionCreators { constructor(config) { super(config); this.getCurrentStore = config.getCurrentStore; this.entityModel = config.entityModel; } + setDependencies = dependencies =&gt; { + this.dependencies = dependencies; + };</code> </pre> <br><ul><li>                     : </li></ul><br><pre> <code class="diff hljs">import { FilterActions } from './filter/actions/FilterActions'; import { TemplatesActions } from './templates/actions/TemplatesActions'; import { TableActions } from './table/actions/TableActions'; export const actionsCreator = (prefix, getCurrentStore, entityModel) =&gt; { const config = { prefix, getCurrentStore, entityModel }; const filterActions = new FilterActions(config); const templatesActions = new TemplatesActions(config); const tableActions = new TableActions(config); + const actions = { + ...filterActions, + ...templatesActions, + ...tableActions, + }; + + filterActions.setDependencies(actions); + templatesActions.setDependencies(actions); + tableActions.setDependencies(actions); + return actions; - return { - ...filterActions, - ...templatesActions, - ...tableActions, - }; };</code> </pre> <br><ul><li>     <code>this.dependencies</code> : </li></ul><br><pre> <code class="javascript hljs">applyFilter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newFilter</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { fetchData } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dependencies; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (dispatch, getStore) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = getStore(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentStore = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getCurrentStore(store); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filter = newFilter || getFilter(currentStore); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { payload } } = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetchData(filter, dispatch); <span class="hljs-comment"><span class="hljs-comment">// Comes from FilterActionCreators dispatch(this.applyFilterSuccess(payload)); } catch (error) { // Comes from FilterActionCreators dispatch(this.applyFilterError(error)); } }; };</span></span></code> </pre> <br><p>    ,        <code>applyFilter</code>   ,   -  <code>this.dependencies</code>    .         ,         . </p><br><ul><li>   : </li></ul><br><pre> <code class="diff hljs">import { FilterActions } from '../FilterActions'; describe('FilterActions', () =&gt; { const prefix = 'TEST_'; const getCurrentStore = store =&gt; store; const entityModel = {}; + const dependencies = { + fetchData: jest.fn(), + }; const config = { prefix, getCurrentStore, entityModel }; const actions = new FilterActions(config); + actions.setDependencies(dependencies); const dispatch = jest.fn(); beforeEach(() =&gt; { dispatch.mockClear(); }); describe('applyFilter', () =&gt; { const getStore = () =&gt; ({}); const newFilter = {}; it('should dispatch correct actions on success', async () =&gt; { const payload = {}; - const fetchData = jest.fn().mockResolvedValueOnce({ data: { payload } }); + dependencies.fetchData.mockResolvedValueOnce({ data: { payload } }); const applyFilterSuccess = jest.spyOn(actions, 'applyFilterSuccess'); - await actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); + await actions.applyFilter(newFilter)(dispatch, getStore); - expect(fetchData).toBeCalledWith(newFilter, dispatch); + expect(dependencies.fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterSuccess).toBeCalledWith(payload); }); it('should dispatch correct actions on error', async () =&gt; { const error = {}; - const fetchData = jest.fn().mockRejectedValueOnce(error); + dependencies.fetchData.mockRejectedValueOnce(error); const applyFilterError = jest.spyOn(actions, 'applyFilterError'); - await actions.applyFilter({ fetchData })(newFilter)(dispatch, getStore); + await actions.applyFilter(newFilter)(dispatch, getStore); - expect(fetchData).toBeCalledWith(newFilter, dispatch); + expect(dependencies.fetchData).toBeCalledWith(newFilter, dispatch); expect(applyFilterError).toBeCalledWith(error); }); }); });</code> </pre> <br><p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> . </p><br><p>       ,   ,            : </p><br><ul><li>   : </li></ul><br><pre> <code class="diff hljs">import { FilterActions } from './filter/actions/FilterActions'; import { TemplatesActions } from './templates/actions/TemplatesActions'; import { TableActions } from './table/actions/TableActions'; - export const actionsCreator = (prefix, getCurrentStore, entityModel) =&gt; { + export const actionsCreator = (prefix, getCurrentStore, entityModel, ExtendedActions) =&gt; { const config = { prefix, getCurrentStore, entityModel }; const filterActions = new FilterActions(config); const templatesActions = new TemplatesActions(config); const tableActions = new TableActions(config); + const extendedActions = ExtendedActions ? new ExtendedActions(config) : undefined; const actions = { ...filterActions, ...templatesActions, ...tableActions, + ...extendedActions, }; filterActions.setDependencies(actions); templatesActions.setDependencies(actions); tableActions.setDependencies(actions); + if (extendedActions) { + extendedActions.setDependencies(actions); + } return actions; };</code> </pre> <br><ul><li>   <code>ExtendedActions</code>    ,     : </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExtendedActions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(config) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getCurrentStore = config.getCurrentStore; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entityModel = config.entityModel; } setDependencies = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dependencies</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dependencies = dependencies; }; <span class="hljs-comment"><span class="hljs-comment">// methods to re-define }</span></span></code> </pre> <br><p>  ,    ,   : </p><br><ul><li>    ,     . </li><li>      . </li><li>     ,   ,     thunk-         . </li><li>   ,      ,   thunk-/action creator-      99-100%. </li></ul><br><h2 id="bonus">  Bono </h2><br><p>   action creator-     ( <code>filter</code> , <code>templates</code> , <code>table</code> ),   reducer-   -  ,        ,    <code>actionsCreator</code> - ,         reducer-  ~400-500  . </p><br><p>      : </p><br><ul><li>   reducer-: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> isNull <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash/isNull'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { getDefaultState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../getDefaultState'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { templatesReducerConfigurator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'src/store/templates/reducers/templatesReducerConfigurator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { filterReducerConfigurator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'src/store/filter/reducers/filterReducerConfigurator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { tableReducerConfigurator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'src/store/table/reducers/tableReducerConfigurator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createTableReducer = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> prefix, initialState = getDefaultState(</span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entityModel</span></span></span><span class="hljs-function">, ) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = { prefix, initialState, entityModel }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> templatesReducer = templatesReducerConfigurator(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filterReducer = filterReducerConfigurator(config); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableReducer = tableReducerConfigurator(config); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = initialState, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> templatesState = templatesReducer(state, action); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isNull(templatesState)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> templatesState; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> filterState = filterReducer(state, action); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isNull(filterState)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filterState; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableState = tableReducer(state, action); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isNull(tableState)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tableState; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; }; };</code> </pre> <br><ul><li> <code>tableReducerConfigurator</code> ( ): </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tableReducerConfigurator = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ prefix, entityModel }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_START`</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isLoading</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, }; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_SUCCESS`</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isLoading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: action.payload, }; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${prefix}</span></span></span><span class="hljs-string">FETCH_TOTAL_COUNTER_ERROR`</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isLoading</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.error, }; } <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }; };</code> </pre> <br><p>  : </p><br><ol><li>   <code>reducerConfigurator</code> -    action type-,   ¬´¬ª.  action type      case,    <em>null</em> (). </li><li>   <code>reducerConfigurator</code> -      ,  <em>null</em> ,     <code>reducerConfigurator</code> -  <em>!null</em> .    ,    <code>reducerConfigurator</code> -   case,      <code>reducerConfigurator</code> -. </li><li>   ,      <code>reducerConfigurator</code> -    case-   action type-,     (  reducer-). </li></ol><br><p>    ,    <code>actionsCreator</code> -,     ,      ,  ,  . </p><br><p>   ,   ! <br> ,             Redux Thunk. </p><br><p>   ,    Redux Thunk      .   ,    . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/469371/">https://habr.com/ru/post/469371/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../469355/index.html">Un aburrido tutorial de NumPy</a></li>
<li><a href="../469357/index.html">¬°Corre, Gopher, corre! - de qu√© hablaremos en GolangConf</a></li>
<li><a href="../469361/index.html">Dolor y l√°grimas en Svelte 3</a></li>
<li><a href="../469367/index.html">Ejecute pruebas unitarias localmente en STM32CubeIDE en Windows</a></li>
<li><a href="../469369/index.html">Eventos digitales en Mosc√∫ del 30 de septiembre al 06 de octubre</a></li>
<li><a href="../469373/index.html">Los resultados del proyecto para crear una interfaz neuronal para pacientes completamente paralizados han cuestionado</a></li>
<li><a href="../469375/index.html">¬øPor qu√© Mozilla, Coil y Creative Commons asignan $ 100 millones para proyectos de c√≥digo abierto?</a></li>
<li><a href="../469379/index.html">Aplicaci√≥n de m√©todos formales de validaci√≥n de modelos para IU</a></li>
<li><a href="../469381/index.html">Agones, crea un servidor de juegos multiusuario. Arquitectura e instalaci√≥n</a></li>
<li><a href="../469383/index.html">Soluci√≥n hiperconvergente AERODISK vAIR. Base: sistema de archivos ARDFS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>