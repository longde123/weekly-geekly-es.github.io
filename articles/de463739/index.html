<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé∞ üéª üññüèª Qrator Filter Netzwerkkonfigurations-Managementsystem üë¥ üö∂üèª üèí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR : Beschreibung der Client-Server-Architektur unseres internen Netzwerkkonfigurationsmanagementsystems QControl. Es basiert auf einem zweistufig...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Qrator Filter Netzwerkkonfigurations-Managementsystem</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/qrator/blog/463739/"><img src="https://habrastorage.org/webt/m2/ak/w7/m2akw7igwdnpnlkl-wtyczkznlc.jpeg"><br><br>  <b>TL; DR</b> : Beschreibung der Client-Server-Architektur unseres internen Netzwerkkonfigurationsmanagementsystems QControl.  Es basiert auf einem zweistufigen Transportprotokoll, das mit gzip-gepackten Nachrichten ohne Dekomprimierung zwischen Endpunkten funktioniert.  Verteilte Router und Endpunkte erhalten Konfigurationsaktualisierungen, und das Protokoll selbst erm√∂glicht die Installation lokalisierter Zwischenrelais.  Das System basiert auf dem Prinzip der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">differenziellen Sicherung</a> (‚Äûk√ºrzlich stabil‚Äú, siehe unten) und verwendet die JMESpath-Abfragesprache zusammen mit der Jinja-Vorlagen-Engine zum Rendern von Konfigurationsdateien. <br><br>  Qrator Labs verwaltet ein global verteiltes Netzwerk zur Abwehr von Angriffen.  Unser Netzwerk arbeitet nach dem Prinzip des Anycasts und Subnetze werden √ºber BGP angek√ºndigt.  Als BGP-Anycast-Netzwerk, das sich physisch in mehreren Regionen der Erde befindet, k√∂nnen wir illegitimen Verkehr verarbeiten und herausfiltern, der n√§her am Kern des Internets liegt - Tier-1-Betreiber. <br><br>  Andererseits ist es nicht einfach, ein geografisch verteiltes Netzwerk zu sein.  Die Kommunikation zwischen Netzwerkpr√§senzpunkten ist f√ºr einen Sicherheitsdienstanbieter von entscheidender Bedeutung, um eine konsistente Konfiguration aller Netzwerkknoten zu erhalten und diese rechtzeitig zu aktualisieren.  Um den Verbrauchern ein H√∂chstma√ü an Basisdiensten bieten zu k√∂nnen, mussten wir daher einen Weg finden, Konfigurationsdaten zwischen Kontinenten zuverl√§ssig zu synchronisieren. <br><blockquote>  Am Anfang war das Wort.  Es wurde schnell zu einem Kommunikationsprotokoll, das aktualisiert werden musste. </blockquote><a name="habracut"></a><br>  Der Eckpfeiler der Existenz von QControl und gleichzeitig der Hauptgrund f√ºr den erheblichen Zeit- und Ressourcenaufwand f√ºr die Erstellung eines solchen Protokolls ist die Notwendigkeit, eine einzige ma√ügebliche Konfigurationsquelle zu erhalten und letztendlich unsere Pr√§senzpunkte damit zu synchronisieren.  Das Repository selbst war nur eine von mehreren Anforderungen w√§hrend der Entwicklung von QControl.  Dar√ºber hinaus ben√∂tigten wir die Integration in vorhandene und geplante Dienste an den Punkten der Pr√§senz (TP), intelligente (und benutzerdefinierte) Methoden zur Datenvalidierung sowie Zugriffskontrolle.  Dar√ºber hinaus wollten wir ein solches System auch mit Befehlen verwalten, anstatt √Ñnderungen an den Dateien vorzunehmen.  Vor QControl wurden Daten im fast manuellen Modus an Pr√§senzpunkte gesendet.  Wenn einer der Pr√§senzpunkte nicht verf√ºgbar war und wir vergessen haben, ihn sp√§ter zu aktualisieren, stellte sich heraus, dass die Konfiguration nicht synchron war. Sie mussten Zeit aufwenden, um sie wieder in Betrieb zu nehmen. <br><br>  Als Ergebnis haben wir das folgende Schema entwickelt: <br><img src="https://habrastorage.org/webt/_5/iy/zf/_5iyzfealoms5eprrxrmg-hhwui.png"><br>  Der Konfigurationsserver ist f√ºr die Daten√ºberpr√ºfung und -speicherung verantwortlich. Der Router verf√ºgt √ºber mehrere Endpunkte, die Konfigurationsaktualisierungen von Clients und Supportteams an den Server und vom Server an Pr√§senzpunkte empfangen und senden. <br><br>  Die Qualit√§t der Internetverbindung ist in verschiedenen Teilen der Welt immer noch sehr unterschiedlich. Um diese These zu veranschaulichen, betrachten wir eine einfache MTR von Prag, der Tschechischen Republik nach Singapur und Hongkong. <br><br> <a href=""><img src="https://habrastorage.org/webt/ob/pl/vc/obplvcdpqlc8as-nra_jnpv4hbc.png" alt="Bild"></a> <br>  MTR von Prag nach Singapur <br><br> <a href=""><img src="https://habrastorage.org/webt/4z/xo/7s/4zxo7sr_qqrg6cdlipwwvujohto.png" alt="Bild"></a> <br>  Das Gleiche gilt f√ºr Hongkong <br><br>  Hohe Verz√∂gerungen bedeuten weniger Geschwindigkeit.  Zus√§tzlich gibt es einen Paketverlust.  Die Breite der Kan√§le gleicht dieses Problem nicht aus, das beim Aufbau dezentraler Systeme immer ber√ºcksichtigt werden sollte. <br><br>  Eine vollst√§ndige Point-of-Presence-Konfiguration ist eine erhebliche Datenmenge, die √ºber nicht vertrauensw√ºrdige Verbindungen an viele Empf√§nger gesendet werden muss.  Obwohl sich die Konfiguration st√§ndig √§ndert, geschieht dies gl√ºcklicherweise in kleinen Portionen. <br><br><h3>  Neuestes stabiles Design </h3><br>  Wir k√∂nnen sagen, dass der Aufbau eines verteilten Netzwerks nach dem Prinzip inkrementeller Aktualisierungen eine ziemlich offensichtliche L√∂sung ist.  Aber es gibt viele Probleme mit Unterschieden.  Wir m√ºssen alle Unterschiede zwischen den Kontrollpunkten beibehalten und sie senden k√∂nnen, falls jemand einige Daten verpasst hat.  Jedes Ziel muss sie in einer genau definierten Reihenfolge anwenden.  In der Regel kann ein solcher Vorgang bei mehreren Zielen lange dauern.  Der Empf√§nger sollte auch in der Lage sein, die fehlenden Teile anzufordern, und nat√ºrlich sollte der zentrale Teil auf eine solche Anfrage korrekt reagieren und nur die fehlenden Daten senden. <br><br>  Als Ergebnis kamen wir zu einer ziemlich interessanten L√∂sung - wir haben nur eine Unterst√ºtzungsschicht, die fixiert ist, nennen wir sie stabil, und nur ein Unterschied daf√ºr ist neu.  Jeder aktuelle Wert basiert auf dem zuletzt gebildeten Stall und reicht aus, um die Konfigurationsdaten neu zu erstellen.  Sobald ein neuer Neuzugang an seinem Ziel ankommt, wird der alte nicht mehr ben√∂tigt. <br><br>  Es bleibt nur von Zeit zu Zeit, eine neue stabile Konfiguration zu senden, zum Beispiel aufgrund der Tatsache, dass die j√ºngste zu gro√ü geworden ist.  Hierbei ist es auch wichtig, dass wir alle diese Updates im Broadcast- / Multicast-Modus versenden, ohne uns um einzelne Empf√§nger und deren F√§higkeit, Daten zusammen zu sammeln, Gedanken zu machen.  Sobald wir davon √ºberzeugt sind, dass jeder den richtigen Stall hat, senden wir nur neue, aktuelle.  Lohnt es sich zu kl√§ren, dass dies funktioniert?  Es funktioniert.  Stable wird auf dem Konfigurationsserver und den Empf√§ngern zwischengespeichert, die letzten werden nach Bedarf erstellt. <br><br><h3>  Zweistufige Transportarchitektur </h3><br>  Warum haben wir unseren Transport auf zwei Ebenen gebaut?  Die Antwort ist ganz einfach: Wir wollten das Routing von der Logik auf hoher Ebene trennen und uns dabei vom OSI-Modell mit seiner Transport- und Anwendungsschicht inspirieren lassen.  Wir haben Thrift als Transportprotokoll und das msgpack-Serialisierungsformat f√ºr das √ºbergeordnete Kontrollnachrichtenformat verwendet.  Aus diesem Grund schaut der Router (der Multicast / Broadcast / Relay ausf√ºhrt) nicht in msgpack, entpackt nicht und packt den Inhalt nicht zur√ºck und f√ºhrt nur die Daten√ºbertragung durch. <br><br>  <i>Thrift (aus dem Englischen - "Thrift", ausgesprochen [Œ∏rift]) ist eine Schnittstellenbeschreibungssprache, mit der Dienste f√ºr verschiedene Programmiersprachen definiert und erstellt werden.</i>  <i>Es ist ein Framework f√ºr Remote Procedure Call (RPC).</i>  <i>Es kombiniert eine Software-Pipeline mit einer Code-Generierungs-Engine zur Entwicklung von Diensten, die bis zu dem einen oder anderen Grad effizient und einfach zwischen Sprachen arbeiten.</i> <br><br>  Wir haben das Thrift-Framework aufgrund von RPC und Unterst√ºtzung f√ºr viele Sprachen verwendet.  Wie √ºblich sind Client und Server die einfachen Teile.  Der Router erwies sich jedoch als harte Nuss, was teilweise auf das Fehlen einer vorgefertigten L√∂sung w√§hrend unserer Entwicklung zur√ºckzuf√ºhren war. <br><br><img src="https://habrastorage.org/webt/l8/so/6v/l8so6vrzh0u_feb60p6ehjbubs0.png" alt="Bild" align="left">  Es gibt andere Optionen, wie z. B. protobuf / gRPC. Als wir unser Projekt starteten, war gRPC jedoch noch recht jung und wir wagten es nicht, es an Bord zu nehmen. <br><br>  Nat√ºrlich konnten (und es hat sich gelohnt) unser eigenes Fahrrad zu bauen.  Es w√§re einfacher, ein Protokoll f√ºr das zu erstellen, was wir ben√∂tigen, da die Client-Server-Architektur im Vergleich zum Aufbau eines Routers auf Thrift relativ einfach zu implementieren ist.  Auf die eine oder andere Weise gibt es eine traditionelle Vorurteilshaltung gegen√ºber selbstgeschriebenen Protokollen und Implementierungen popul√§rer Bibliotheken (nicht umsonst). Au√üerdem wirft die Diskussion immer die Frage auf: "Wie werden wir sie auf andere Sprachen portieren?"  Deshalb haben wir sofort Ideen √ºber das Fahrrad rausgeschmissen. <br><br>  <i>Msgpack ist ein Analogon von JSON, aber schneller und weniger.</i>  <i>Dies ist ein Bin√§rdatenserialisierungsformat, das den Datenaustausch zwischen mehreren Sprachen erm√∂glicht.</i> <br><br>  Auf der ersten Ebene haben wir Thrift mit den minimalen Informationen, die der Router ben√∂tigt, um die Nachricht weiterzuleiten.  Auf der zweiten Ebene befinden sich gepackte msgpack-Strukturen. <br><br>  Wir haben uns f√ºr msgpack entschieden, weil es im Vergleich zu JSON schneller und kompakter ist.  Noch wichtiger ist jedoch, dass es benutzerdefinierte Datentypen unterst√ºtzt, sodass wir coole Funktionen wie das √úbertragen von Roh-Bin√§rdateien oder speziellen Objekten verwenden k√∂nnen, die auf den Mangel an Daten hinweisen, was f√ºr unser k√ºrzlich stabiles Schema wichtig war. <br><br>  <b>Jmespath</b> <br>  <i>JMESPath ist eine JSON-Anforderungssprache.</i> <br>  Genau so sieht die Beschreibung aus, die wir aus der offiziellen JMESPath-Dokumentation erhalten, aber tats√§chlich gibt sie viel mehr.  Mit JMESPath k√∂nnen Sie Teilb√§ume in einer beliebigen Baumstruktur suchen und filtern sowie √Ñnderungen im laufenden Betrieb auf Daten anwenden.  Au√üerdem k√∂nnen Sie spezielle Filter und Datenkonvertierungsverfahren hinzuf√ºgen.  Obwohl es nat√ºrlich Gehirnspannung erfordert, um zu verstehen. <br><br>  <b>Jinja</b> <br>  F√ºr einige Verbraucher m√ºssen wir die Konfiguration in eine Datei umwandeln - daher verwenden wir die Template-Engine und Jinja ist die offensichtliche Wahl.  Mit seiner Hilfe generieren wir eine Konfigurationsdatei aus der Vorlage und den am Ziel empfangenen Daten. <br><br>  Zum Generieren der Konfigurationsdatei ben√∂tigen wir eine JMESPath-Anforderung, eine Vorlage f√ºr den Dateispeicherort im FS, eine Vorlage f√ºr die Konfiguration selbst.  Auch in diesem Stadium ist es hilfreich, die Dateiberechtigungen zu kl√§ren.  All dies wurde erfolgreich in einer Datei kombiniert - vor dem Start der Konfigurationsvorlage haben wir den Header in das YAML-Format gestellt, das den Rest beschreibt. <br><br>  Zum Beispiel: <br><br> <code>--- <br> selector: "[@][?@.fft._meta.version == `42`] | items([0].fft_config || `{}`)" <br> destination_filename: "fft/{{ match[0] }}.json" <br> file_mode: 0644 <br> reload_daemons: [fft] <br> ... <br> {{ dict(match[1]) | json(indent=2, sort_keys=True) }} <br></code> <br><br>  Um eine Konfigurationsdatei f√ºr einen neuen Dienst zu erstellen, f√ºgen wir nur eine neue Vorlagendatei hinzu.  Es sind keine √Ñnderungen am Quellcode oder an der Software an den vorhandenen Stellen erforderlich. <br><br>  Was hat sich seit der Einf√ºhrung von QControl ge√§ndert?  Das erste und wichtigste ist die konsistente und zuverl√§ssige Bereitstellung von Konfigurationsaktualisierungen auf allen Knoten im Netzwerk.  Die zweite M√∂glichkeit besteht darin, ein leistungsstarkes Tool zur √úberpr√ºfung der Konfiguration zu erhalten und √Ñnderungen daran durch unser Support-Team sowie durch die Verbraucher des Dienstes vorzunehmen. <br><br>  All dies ist uns mithilfe des zuletzt stabilen Aktualisierungsschemas gelungen, um die Kommunikation zwischen dem Konfigurationsserver und den Konfigurationsempf√§ngern zu vereinfachen.  Verwenden eines zweischichtigen Protokolls zur Unterst√ºtzung einer inhaltsunabh√§ngigen Datenroutingmethode.  Erfolgreiche Integration der Jinja-basierten Konfigurationsgenerierungs-Engine in ein verteiltes Filternetzwerk.  Dieses System unterst√ºtzt eine Vielzahl von Konfigurationsmethoden f√ºr unsere verteilten und vielf√§ltigen Peripherieger√§te. <br><br>  Vielen Dank f√ºr das Schreiben von Material dank <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">VolanDamrod</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Gelassenheit</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">NoN</a> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Englische Version des</a> Beitrags. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de463739/">https://habr.com/ru/post/de463739/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de463727/index.html">So gelangen Sie in der Entwicklungsnische zu Google in der EU / USA und finden Kunden mit gro√üem Budget</a></li>
<li><a href="../de463729/index.html">Treffen mit dem Gr√ºnder von NSTR Viktor Chernikov</a></li>
<li><a href="../de463733/index.html">Mesh VS WiFi: Was soll man f√ºr Wireless w√§hlen?</a></li>
<li><a href="../de463735/index.html">Qrator Filtering Network Configuration Delivery System</a></li>
<li><a href="../de463737/index.html">Probleml√∂sung mit pwnable.kr 21 - horcuxes. R√ºckgabeorientierte Programmierung und ROP-Ketten</a></li>
<li><a href="../de463741/index.html">Mit Firefox (bereits behoben) und Chrome k√∂nnen Sie den Alt-Svc-Header zum Scannen von Intranet-Ports verwenden</a></li>
<li><a href="../de463745/index.html">C ++ zu komplizieren ist unvermeidlich. Und nicht nur C ++</a></li>
<li><a href="../de463747/index.html">Greifen Sie auf Eigenschaften im Jsonb-Feld f√ºr Npgsql zu</a></li>
<li><a href="../de463749/index.html">Scrum vs Kanban: Bleib ruhig und w√§hle, was besser zu dir passt</a></li>
<li><a href="../de463751/index.html">iOS 13: Was Sie brauchen und was Sie bei der Entwicklung f√ºr ein neues Betriebssystem absolut nicht tun m√ºssen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>