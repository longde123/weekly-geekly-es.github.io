<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§šğŸ¿ ğŸ‘©ğŸ»â€âœˆï¸ ğŸ™†ğŸ¼ Perpustakaan Ethernet atau mengapa di alam tidak ada server di Arduino â˜ğŸ» ğŸ ğŸ§¡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada artikel ini, saya akan menjelaskan situasi yang saya temui selama pengembangan proyek Arduino Mega Server . Intinya adalah bahwa ada Perpustakaan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Perpustakaan Ethernet atau mengapa di alam tidak ada server di Arduino</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/382565/"><img src="https://habrastorage.org/files/013/400/80a/01340080a06e4ff5ba887dabd987b4eb.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel ini, saya akan menjelaskan situasi yang saya temui selama pengembangan proyek </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Intinya adalah bahwa ada Perpustakaan Arduino Ethernet, ditulis untuk mendukung kartu jaringan Ethernet Shield pada chip W5100. Ini adalah papan standar dan perpustakaan standar yang telah digabungkan dengan lingkungan pengembangan Arduino selama bertahun-tahun. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan perpustakaan ini adalah dasar untuk semua proyek yang menggunakan pertukaran informasi melalui jaringan kabel. Jadi, ternyata perpustakaan ini tidak cocok. Di atasnya, pada prinsipnya, tidak mungkin untuk membangun interaksi jaringan yang normal. Anda hanya dapat "menuruti" permintaan tunggal dan tanggapan. Kami tidak dapat berbicara tentang membangun server apa pun berdasarkan perpustakaan ini. Mengapa?</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena pustaka ini memiliki "bug" bawaan yang menangguhkan permintaan tidak unik selama tiga hingga sepuluh detik atau lebih. </font><font style="vertical-align: inherit;">Bug ini bawaan dan penulis perpustakaan tahu tentang ini, sebagaimana dibuktikan oleh catatannya di sumber (tetapi lebih lanjut tentang ini nanti). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini Anda perlu memahami bahwa perpustakaan yang datang dengan lingkungan pengembangan resmi adalah standar tertentu dan jika proyek tidak bekerja untuk Anda, maka Anda akan mencari cacat di mana saja, tetapi tidak di perpustakaan standar, karena telah digunakan selama bertahun-tahun oleh ratusan ribu, jika tidak jutaan orang. </font><font style="vertical-align: inherit;">Tidak bisakah mereka semua salah?</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mengapa di alam tidak ada server di Arduino</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengembangan proyek berjalan sebagaimana mestinya dan, akhirnya, datang untuk mengoptimalkan kode dan meningkatkan kecepatan server, dan di sini saya dihadapkan dengan situasi berikut: permintaan masuk dari browser diterima dan "ditangguhkan" untuk jangka waktu tiga hingga sepuluh detik, rata-rata, hingga dua puluh dan lebih banyak detik dengan pertukaran yang lebih intens. Berikut adalah tangkapan layar yang menunjukkan bahwa penundaan anomali dalam respons server "berjalan" di berbagai permintaan. </font></font><br>
<br>
<img src="https://habrastorage.org/files/9c4/7ef/c67/9c47efc67e8748729d33908b136ea0fd.jpg" alt="keterlambatan abnormal"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika saya mulai mengerti, ternyata tidak ada yang menghentikan server untuk merespons, tetapi, bagaimanapun, permintaan "digantung" selama lebih dari sembilan detik, dan pada pengulangan lain permintaan yang sama telah digantung selama sekitar tiga detik.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pengamatan seperti itu membuat saya sangat perhatian dan saya menggali seluruh kode server (pada saat yang sama merentangkan diri saya) tetapi tidak menemukan cacat dan semua logika mengarah ke "Arca Mahakudus" Arduino Ethernet Library. Tetapi pemikiran yang menghasut bahwa perpustakaan standar yang harus disalahkan dibuang sebagai tidak memadai. Memang, tidak hanya pengguna bekerja dengan perpustakaan, tetapi juga sejumlah besar pengembang profesional. Tidak bisakah mereka semua tidak melihat hal-hal yang begitu jelas?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ke depan, saya akan mengatakan bahwa ketika ternyata itu adalah perpustakaan standar, menjadi jelas mengapa di alam tidak ada server Arduino (normal). </font><font style="vertical-align: inherit;">Karena berdasarkan pustaka standar (yang bekerja dengan sebagian besar pengembang) pada dasarnya tidak mungkin untuk membangun server. </font><font style="vertical-align: inherit;">Penundaan respons sepuluh detik atau lebih akan membuat server keluar dari kategori server itu sendiri dan menjadikannya mainan yang sederhana (kutu buku). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Penarikan menengah. </font><font style="vertical-align: inherit;">Ini bukan Arduino yang tidak cocok untuk membangun server, dan perpustakaan jaringan mengakhiri kelas perangkat yang sangat menarik.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anatomi masalah</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita beralih dari lirik ke deskripsi teknis tentang masalah dan solusi praktisnya. </font><font style="vertical-align: inherit;">Bagi mereka yang tidak mutakhir, lokasi perpustakaan standar (pada Windows): </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
arduino \ libraries \ Ethernet </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan hal pertama yang akan kita lihat adalah fungsi dari file EthernetServer.cpp</font></font><br>
<br>
<pre><code class="java hljs">EthernetClient EthernetServer::available() {<font></font>
  accept();<font></font>
<font></font>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> sock = <span class="hljs-number">0</span>; sock &lt; MAX_SOCK_NUM; sock++) {
    <span class="hljs-function">EthernetClient <span class="hljs-title">client</span><span class="hljs-params">(sock)</span></span>;
    <span class="hljs-keyword">if</span> (EthernetClass::_server_port[sock] == _port &amp;&amp;<font></font>
        (client.status() == SnSR::ESTABLISHED ||<font></font>
         client.status() == SnSR::CLOSE_WAIT)) {<font></font>
      <span class="hljs-keyword">if</span> (client.available()) {
        <span class="hljs-comment">// <span class="hljs-doctag">XXX:</span> don't always pick the lowest numbered socket.</span>
        <span class="hljs-keyword">return</span> client;<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> EthernetClient(MAX_SOCK_NUM);<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ketika saya mengatasi hambatan psikologis (di bawah tekanan logika) dan mulai mencari cacat di Perpustakaan Ethernet, saya mulai dengan fungsi ini. </font><font style="vertical-align: inherit;">Saya memperhatikan komentar aneh oleh penulis, tetapi tidak menganggapnya penting. </font><font style="vertical-align: inherit;">Setelah menyekop seluruh perpustakaan, saya kembali, tetapi setelah beberapa hari dan telah membuat kemajuan besar dalam teknologi jaringan, kembali ke fungsi ini karena logika menyarankan bahwa masalahnya ada di sana dan melihat lebih dekat pada komentar.</font></font><br>
<br>
<pre><code class="java hljs">
        <span class="hljs-comment">// <span class="hljs-doctag">XXX:</span> don't always pick the lowest numbered socket.</span><font></font>
<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Teman-teman, semuanya ditulis dalam teks yang jelas. Dalam terjemahan gratis, itu terdengar seperti ini: "itu berfungsi, tetapi tidak selalu." Tunggu sebentar, apa artinya "tidak selalu"? Kami tidak memiliki klub lotre hari Minggu. Dan ketika itu tidak berhasil, lalu apa? Tetapi ketika "tidak bekerja" dan masalah dimulai dengan penundaan sepuluh detik. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan penulis pasti tahu tentang ini, sebagaimana dibuktikan oleh harga diri ciptaannya - tiga x. Tidak ada komentar. Perpustakaan ini adalah dasar bagi banyak klon dan, perhatikan, ketiga X ini berkeliaran dari satu proyek ke proyek lainnya. Jika Anda seorang pengembang, maka Anda tidak dapat melihat masalah ini hanya sekali tanpa menguji pertukaran jaringan. Juga tidak ada komentar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagi mereka yang kurang berpengalaman dalam kode, saya akan menjelaskan esensi masalah dengan kata-kata sederhana. </font><font style="vertical-align: inherit;">Loop berulang di atas soket dan, segera setelah menemukan yang cocok, mengembalikan klien, dan mengabaikan sisanya. </font><font style="vertical-align: inherit;">Dan mereka menggantung selama sepuluh detik, sampai "kartu-kartu itu berbaring dengan nyaman."</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solusi untuk masalah tersebut</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah memahami penyebab masalah, kami tentu tidak akan berhenti di situ dan mencoba menyelesaikannya. </font><font style="vertical-align: inherit;">Pertama, mari kita menulis ulang fungsinya sehingga menerima atau tidak menerima soket tidak tergantung pada keinginan kasing dan selalu terjadi jika ada. </font><font style="vertical-align: inherit;">Ini akan menyelesaikan dua masalah:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permintaan tidak akan hang</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permintaan "Sequential" akan berubah menjadi "parallel", yang secara signifikan akan mempercepat pekerjaan</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kode untuk fungsi baru:</font></font><br>
<br>
<pre><code class="java hljs">EthernetClient EthernetServer::available_(<span class="hljs-keyword">int</span> sock) {<font></font>
  accept_(sock);<font></font>
  <span class="hljs-function">EthernetClient <span class="hljs-title">client</span><span class="hljs-params">(sock)</span></span>;
  <span class="hljs-keyword">if</span> (EthernetClass::_server_port[sock] == _port &amp;&amp;<font></font>
      (client.status() == SnSR::ESTABLISHED ||<font></font>
       client.status() == SnSR::CLOSE_WAIT)) {<font></font>
    <span class="hljs-keyword">if</span> (client.available()) {
      <span class="hljs-keyword">return</span> client;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-keyword">return</span> EthernetClient(MAX_SOCK_NUM);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami menghapus loop, tentukan soket dengan jelas dan tidak kehilangan apa pun - jika gratis, maka kami dijamin akan menerima klien (jika cocok dengan kami). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kami melakukan "rantai" yang sama dengan kode fungsi terima, lepaskan loop, dan tentukan soket secara eksplisit.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">void</span> EthernetServer::accept_(<span class="hljs-keyword">int</span> sock) {
  <span class="hljs-keyword">int</span> listening = <span class="hljs-number">0</span>;
  <span class="hljs-function">EthernetClient <span class="hljs-title">client</span><span class="hljs-params">(sock)</span></span>;<font></font>
<font></font>
  <span class="hljs-keyword">if</span> (EthernetClass::_server_port[sock] == _port) {
    <span class="hljs-keyword">if</span> (client.status() == SnSR::LISTEN) {<font></font>
      listening = <span class="hljs-number">1</span>;<font></font>
    } <font></font>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (client.status() == SnSR::CLOSE_WAIT &amp;&amp; !client.available()) {<font></font>
      client.stop();<font></font>
    }<font></font>
  } <font></font>
<font></font>
  <span class="hljs-keyword">if</span> (!listening) {
    <span class="hljs-comment">//begin();</span>
    begin_(sock); <span class="hljs-comment">// added</span><font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan jangan lupa untuk memperbaiki file EthernetServer.h</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EthernetServer</span> : 
<span class="hljs-title">public</span> <span class="hljs-title">Server</span> </span>{
<span class="hljs-keyword">private</span>:<font></font>
  uint16_t _port;<font></font>
  <span class="hljs-comment">//void accept();</span>
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">accept_</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sock)</span></span>;
<span class="hljs-keyword">public</span>:<font></font>
  EthernetServer(uint16_t);<font></font>
  <span class="hljs-comment">//EthernetClient available();</span>
  <span class="hljs-function">EthernetClient <span class="hljs-title">available_</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sock)</span></span>;
  <span class="hljs-function">virtual <span class="hljs-keyword">void</span> <span class="hljs-title">begin</span><span class="hljs-params">()</span></span>;
  <span class="hljs-function">virtual <span class="hljs-keyword">void</span> <span class="hljs-title">begin_</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sock)</span></span>;
  <span class="hljs-function">virtual size_t <span class="hljs-title">write</span><span class="hljs-params">(uint8_t)</span></span>;
  <span class="hljs-function">virtual size_t <span class="hljs-title">write</span><span class="hljs-params">(<span class="hljs-keyword">const</span> uint8_t *buf, size_t size)</span></span>;<font></font>
  using Print::write;<font></font>
};<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Itu saja. </font><font style="vertical-align: inherit;">Kami membuat perubahan pada perpustakaan standar dan perilaku server telah berubah secara dramatis. </font><font style="vertical-align: inherit;">Jika sebelumnya semuanya bekerja sangat lambat, di luar gagasan tentang kegunaan, sekarang kecepatan memuat halaman telah meningkat secara signifikan dan menjadi cukup dapat diterima untuk penggunaan normal. </font></font><br>
<br>
<img src="http://habrastorage.org/files/3b3/298/9fa/3b32989fa04a4ec9a34b0c6aaa2e47af.jpg" alt="kecepatan unduhan meningkat"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perhatikan pengurangan penundaan sebanyak 3-5 kali untuk file yang berbeda dan sifat unduhan yang benar-benar berbeda, yang sangat nyata dalam penggunaan praktis.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode lengkap untuk EthernetServer.cpp yang dimodifikasi</font></font></b><div class="spoiler_text">/*<br>
 Mod for Arduino Mega Server project<br>
 fix bug delay answer server<br>
*/<br>
<br>
#include Â«w5100.hÂ»<br>
#include Â«socket.hÂ»<br>
extern Â«CÂ» {<br>
#include Â«string.hÂ»<br>
}<br>
<br>
#include Â«Ethernet.hÂ»<br>
#include Â«EthernetClient.hÂ»<br>
#include Â«EthernetServer.hÂ»<br>
<br>
EthernetServer::EthernetServer(uint16_t port) {<br>
 _port = port;<br>
}<br>
<br>
void EthernetServer::begin() {<br>
 for (int sock = 0; sock &lt; MAX_SOCK_NUM; sock++) {<br>
 EthernetClient client(sock);<br>
 if (client.status() == SnSR::CLOSED) {<br>
 socket(sock, SnMR::TCP, _port, 0);<br>
 listen(sock);<br>
 EthernetClass::_server_port[sock] = _port;<br>
 break;<br>
 }<br>
 } <br>
}<br>
<br>
void EthernetServer::begin_(int sock) {<br>
 EthernetClient client(sock);<br>
 if (client.status() == SnSR::CLOSED) {<br>
 socket(sock, SnMR::TCP, _port, 0);<br>
 listen(sock);<br>
 EthernetClass::_server_port[sock] = _port;<br>
 }<br>
}<br>
<br>
/*<br>
<br>
void EthernetServer::accept() {<br>
 int listening = 0;<br>
<br>
for (int sock = 0; sock &lt; MAX_SOCK_NUM; sock++) {<br>
 EthernetClient client(sock);<br>
<br>
if (EthernetClass::_server_port[sock] == _port) {<br>
 if (client.status() == SnSR::LISTEN) {<br>
 listening = 1;<br>
 } <br>
 else if (client.status() == SnSR::CLOSE_WAIT &amp;&amp; !client.available()) {<br>
 client.stop();<br>
 }<br>
 } <br>
 }<br>
<br>
if (!listening) {<br>
 begin();<br>
 }<br>
}<br>
<br>
*/<br>
<br>
void EthernetServer::accept_(int sock) {<br>
 int listening = 0;<br>
 EthernetClient client(sock);<br>
<br>
if (EthernetClass::_server_port[sock] == _port) {<br>
 if (client.status() == SnSR::LISTEN) {<br>
 listening = 1;<br>
 } <br>
 else if (client.status() == SnSR::CLOSE_WAIT &amp;&amp; !client.available()) {<br>
 client.stop();<br>
 }<br>
 } <br>
<br>
if (!listening) {<br>
 //begin();<br>
 begin_(sock); // added<br>
 }<br>
}<br>
<br>
/*<br>
<br>
EthernetClient EthernetServer::available() {<br>
 accept();<br>
<br>
for (int sock = 0; sock &lt; MAX_SOCK_NUM; sock++) {<br>
 EthernetClient client(sock);<br>
 if (EthernetClass::_server_port[sock] == _port &amp;&amp;<br>
 (client.status() == SnSR::ESTABLISHED ||<br>
 client.status() == SnSR::CLOSE_WAIT)) {<br>
 if (client.available()) {<br>
 // XXX: don't always pick the lowest numbered socket.<br>
 return client;<br>
 }<br>
 }<br>
 }<br>
 return EthernetClient(MAX_SOCK_NUM);<br>
}<br>
<br>
*/<br>
<br>
EthernetClient EthernetServer::available_(int sock) {<br>
 accept_(sock);<br>
 EthernetClient client(sock);<br>
 if (EthernetClass::_server_port[sock] == _port &amp;&amp;<br>
 (client.status() == SnSR::ESTABLISHED ||<br>
 client.status() == SnSR::CLOSE_WAIT)) {<br>
 if (client.available()) {<br>
 return client;<br>
 }<br>
 }<br>
 return EthernetClient(MAX_SOCK_NUM);<br>
}<br>
<br>
size_t EthernetServer::write(uint8_t b) {<br>
 return write(&amp;b, 1);<br>
}<br>
<br>
size_t EthernetServer::write(const uint8_t *buffer, size_t size) {<br>
 size_t n = 0;<br>
 //accept();<br>
<br>
for (int sock = 0; sock &lt; MAX_SOCK_NUM; sock++) {<br>
 accept_(sock); // added<br>
 EthernetClient client(sock);<br>
<br>
if (EthernetClass::_server_port[sock] == _port &amp;&amp;<br>
 client.status() == SnSR::ESTABLISHED) {<br>
 n += client.write(buffer, size);<br>
 }<br>
 }<br>
 return n;<br>
}<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode lengkap untuk EthernetServer.h yang dimodifikasi</font></font></b><div class="spoiler_text">/*<br>
 Mod for Arduino Mega Server project<br>
 fix bug delay answer server<br>
*/<br>
<br>
#ifndef ethernetserver_h<br>
#define ethernetserver_h<br>
<br>
#include Â«Server.hÂ»<br>
<br>
class EthernetClient;<br>
<br>
class EthernetServer: <br>
public Server {<br>
private:<br>
 uint16_t _port;<br>
 //void accept();<br>
 void accept_(int sock);<br>
public:<br>
 EthernetServer(uint16_t);<br>
 //EthernetClient available();<br>
 EthernetClient available_(int sock);<br>
 virtual void begin();<br>
 virtual void begin_(int sock);<br>
 virtual size_t write(uint8_t);<br>
 virtual size_t write(const uint8_t *buf, size_t size);<br>
 using Print::write;<br>
};<br>
<br>
#endif<br>
<br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Masalah yang tersisa</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dalam bentuk ini, server dari demonstrasi ide masuk ke dalam kategori hal-hal yang dapat digunakan dalam kehidupan sehari-hari, tetapi beberapa masalah tetap ada. </font><font style="vertical-align: inherit;">Seperti yang dapat Anda lihat di tangkapan layar, masih tidak ada yang mendasar, tetapi penundaan yang tidak menyenangkan dari tiga detik, yang seharusnya tidak. </font><font style="vertical-align: inherit;">Perpustakaan ditulis sedemikian rupa sehingga ada banyak tempat di mana kode tidak berfungsi sebagaimana mestinya, dan jika Anda adalah pengembang yang memenuhi syarat, maka bantuan Anda dalam menentukan penyebab keterlambatan tiga detik akan sangat berharga. </font><font style="vertical-align: inherit;">Baik untuk proyek Arduino Mega Server dan untuk semua pengguna Arduino.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saat terakhir</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena kami mengubah kode perpustakaan standar, kami perlu memanggil fungsinya dengan cara yang sedikit berbeda. </font><font style="vertical-align: inherit;">Di sini saya memberikan kode yang benar-benar berfungsi dan yang memberikan AMS pada tangkapan layar di atas.</font></font><br>
<br>
<pre><code class="java hljs">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> sock = <span class="hljs-number">0</span>; sock &lt; MAX_SOCK_NUM; sock++) {<font></font>
    EthernetClient sclient = server.available_(sock);<font></font>
    serverWorks2(sclient);<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini, tugas menyortir soket telah dipindahkan ke tingkat sketsa klien, dan, yang paling penting, dan apa arti dari di atas, tidak ada "pembekuan" permintaan. Dan fungsi server itu sendiri:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">serverWorks2</span><span class="hljs-params">(EthernetClient sclient)</span> </span>{<font></font>
...<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda dapat membiasakan diri dengan kode server lengkap dengan mengunduh kit distribusi dari situs resmi proyek </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Dan Anda dapat mengajukan pertanyaan Anda di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forum</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tetap untuk menyelesaikan masalah terakhir dari penundaan tiga detik dan kami akan memiliki server yang nyata dan bekerja cepat di Arduino. </font><font style="vertical-align: inherit;">Omong-omong, segera versi baru AMS akan dirilis dengan semua perbaikan dan perbaikan di mana salah satu masalah yang paling mendesak telah diselesaikan - pekerjaan offline tanpa dukungan untuk server MajorDoMo. </font></font><br>
<br>
<img src="http://habrastorage.org/files/ab0/f1b/223/ab0f1b223d6b49848c358847cf2b7959.png" alt="Arduino Mega Server"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan ini menjadi mungkin sebagian besar karena koreksi dari Perpustakaan Arduino Ethernet standar yang baru saja saya katakan. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selain itu</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Saluran Youtube terbuka dan berikut ini adalah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">video promo dari</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Arduino Mega Server, yang menunjukkan cara bekerja dengan sistem nyata.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id382565/">https://habr.com/ru/post/id382565/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id382555/index.html">[Pengumuman] HyperX memperkenalkan Fury DDR4 RAM untuk platform Intel Skylake-S Socket 1151</a></li>
<li><a href="../id382557/index.html">"Bongkok, kataku bungkuk!" Debugging "servomotors" dan "driver" postur</a></li>
<li><a href="../id382559/index.html">Mobil dapat mengekstraksi energi dari lubang di jalan</a></li>
<li><a href="../id382561/index.html">Tentang pengembangan kepala printer FDM 3D, Bagian 1</a></li>
<li><a href="../id382563/index.html">Bulan, manusia, dan robot</a></li>
<li><a href="../id382567/index.html">Printer 3D VS Axe (Dota2) Bagian 1</a></li>
<li><a href="../id382569/index.html">Ketika Kecantikan Tidak Dibutuhkan: Desain Sistem Otomasi Restoran</a></li>
<li><a href="../id382571/index.html">Birokrasi di ruang angkasa: Buzz Aldrin telah menerbitkan surat perjalanan untuk perjalanan ke bulan</a></li>
<li><a href="../id382573/index.html">Robot Hitchhiker Meninggal di Philadelphia</a></li>
<li><a href="../id382575/index.html">Para ilmuwan di Universitas Cambridge telah mengembangkan permainan untuk membantu merawat pasien skizofrenia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>