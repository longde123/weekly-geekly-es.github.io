<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ¢Ô∏è üë¥üèΩ üë®üèø‚Äçüè≠ Construindo um gr√°fico de linha de m√©dia m√≥vel animado em R. Recuperando dados atrav√©s da API da NBA üëê üíÇ ü§πüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuamos a analisar dados de basquete usando R. 


 Ao contr√°rio do artigo anterior, que era puramente divertido, os gr√°ficos que ser√£o constru√≠dos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Construindo um gr√°fico de linha de m√©dia m√≥vel animado em R. Recuperando dados atrav√©s da API da NBA</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459142/"><p>  Continuamos a analisar dados de basquete usando R. </p><br><p>  Ao contr√°rio do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> anterior, que era puramente divertido, os gr√°ficos que ser√£o constru√≠dos neste artigo podem ser interessantes do ponto de vista da an√°lise do jogo da equipe na campanha da temporada. </p><br><p>  E criaremos gr√°ficos de m√©dia m√≥vel para tr√™s tipos de classifica√ß√£o de equipes da NBA: ataque, defesa e classifica√ß√£o por rede (ou seja, a diferen√ßa entre os dois primeiros).  Em poucas palavras sobre eles.  Classifica√ß√µes de ataque e defesa s√£o o n√∫mero de pontos marcados / perdidos por uma equipe por 100 posses.  NET - essa √© a diferen√ßa para cem posses.  Qualquer pessoa interessada em aprender mais sobre eles pode ler o gloss√°rio sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">refer√™ncias de basquete</a> .  Existe uma f√≥rmula de c√°lculo, que tamb√©m implementei usando R, mas ainda n√£o publiquei um artigo sobre o assunto. </p><a name="habracut"></a><br><p>  Tamb√©m vou explicar por que vou construir o gr√°fico da m√©dia m√≥vel.  Em cada partida individual, a propor√ß√£o de aleatoriedade √© muito alta, os indicadores saltam de 70 para 150, o que torna a an√°lise de dados in√∫til e o pr√≥prio gr√°fico √© mais como um cardiograma.  Se tomarmos a m√©dia cumulativa, teremos outro extremo: o cronograma √© semelhante a flutua√ß√µes atenuadas e os jogos no final da temporada, quando somados a partidas j√° realizadas de 70 a 75, praticamente n√£o afetam o indicador geral.  Grosso modo, eles "n√£o s√£o vis√≠veis".  A m√©dia m√≥vel nesse caso √© a sa√≠da do impasse.  Por um lado, a influ√™ncia do acaso diminui, por outro lado, n√£o h√° ac√∫mulo excessivo de resultados.  Nas estat√≠sticas do basquete, eles costumam fazer uma m√©dia m√≥vel de 10 partidas. </p><br><h2 id="ispolzuemye-biblioteki">  Bibliotecas usadas </h2><br><pre><code class="plaintext hljs">library(httr) library(jsonlite) library(tidyverse) library(lubridate) library(zoo) library(ggthemes) library(gganimate)</code> </pre> <br><h2 id="poluchenie-dannyh-s-pomoschyu-nba-api">  Recuperando dados usando a API da NBA </h2><br><p>  Na √∫ltima vez, recuperei dados usando a extens√£o <strong>NBA Data Retriever</strong> .  Desta vez, usarei a API da NBA para carregar diretamente os dados necess√°rios no R. </p><br><p>  Primeiro, descobrimos de onde obter esses dados.  Para fazer isso, abra a p√°gina que precisamos em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">stats.nba.com</a> e acesse as ferramentas do desenvolvedor.  Em seguida, abra Rede -&gt; XHR e pressione F5.  Na lista que aparece, encontramos um arquivo com um nome semelhante ao nome da p√°gina.  N√≥s precisamos dele.  Ap√≥s certificar-se de que voc√™ selecionou o arquivo correto, copie o endere√ßo em R. Nas figuras, ele se parece com isso. </p><br><p>  <em>abra o arquivo desejado</em> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3ce/6cf/41f/3ce6cf41f2cb07bcd73b757b311c9c80.png"></p><br><p>  <em>o arquivo deve ficar assim</em> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7c8/9c4/aca/7c89c4aca8872754cdb2212bdeba85df.png"></p><br><p>  <em>copiar para o endere√ßo R</em> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a43/06c/c65/a4306cc65e873df80d9501bb329cc3ca.png"></p><br><p>  Agora vamos trabalhar no <strong>R Studio</strong> .  Para obter as informa√ß√µes necess√°rias, usamos a fun√ß√£o <code>GET</code> do pacote <code>http</code> .  No entanto, para que a solicita√ß√£o seja executada corretamente (isso pode ser verificado pela fun√ß√£o <code>status_code</code> , ela deve ser 200), voc√™ precisa adicionar cabe√ßalhos para determinar os par√¢metros de trabalho da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">transa√ß√£o HTTP</a> </p><br><pre> <code class="plaintext hljs">##Adding headers request_headers &lt;- c( "accept-encoding" = "gzip, deflate, sdch", "accept-language" = "en-US,en;q=0.8", "cache-control" = "no-cache", "connection" = "keep-alive", "host" = "stats.nba.com", "pragma" = "no-cache", "upgrade-insecure-requests" = "1", "user-agent" = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/601.3.9 (KHTML, like Gecko) Version/9.0.2 Safari/601.3.9" ) #Getting a response request &lt;- GET(adv_box_team, add_headers(request_headers))</code> </pre> <br><p>  Temos uma resposta como esta: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d08/a37/841/d08a378417726a4e7ae4c535dec57836.png"></p><br><p>  Mas enquanto os dados que precisamos n√£o s√£o vis√≠veis.  Para obt√™-los, primeiro extra√≠mos o <code>content</code> solicita√ß√£o pelo <code>content</code> da fun√ß√£o em um arquivo json e depois o convertemos em uma lista com uma fun√ß√£o do pacote <code>jsonlite</code> com o nome falado de <code>fromJSON</code> </p><br><pre> <code class="plaintext hljs">boxscore_data &lt;- fromJSON(content(request, as = "text"))</code> </pre> <br><p>  Como resultado, obtemos uma lista que j√° cont√©m todas as informa√ß√µes necess√°rias e, em seguida, simplesmente as trazemos para o formul√°rio necess√°rio para o trabalho. </p><br><h2 id="podgotovka-dannyh">  Prepara√ß√£o de dados </h2><br><p>  Para fazer isso, crie uma tabela de dados em vez de uma lista e adicione cabe√ßalhos de coluna. </p><br><pre> <code class="plaintext hljs">#Convert to tibble data and assigning column names table &lt;- tbl_df(data.frame(boxscore_data$resultSets$rowSet[[1]], stringsAsFactors = FALSE)) names(table) &lt;- toupper(boxscore_data$resultSets$headers[[1]])</code> </pre> <br><p>  <code>toupper</code> √© uma fun√ß√£o que substitui todos os caracteres por mai√∫sculas.  Depois disso, devemos obter uma tabela com 2460 linhas e 46 colunas.  Em princ√≠pio, voc√™ pode trabalhar com a tabela neste formul√°rio, mas √© melhor excluir informa√ß√µes desnecess√°rias, para um trabalho mais conveniente e r√°pido. </p><br><pre> <code class="plaintext hljs">##Select the columns you want to analyze rating &lt;- table %&gt;% select(TEAM_ID, TEAM_ABBREVIATION, TEAM_NAME, GAME_ID, GAME_DATE, MATCHUP, WL, E_OFF_RATING, E_DEF_RATING, E_NET_RATING)</code> </pre> <br><p>  Se voc√™ olhar para a tabela de origem, poder√° ver dois tipos da mesma classifica√ß√£o: ‚Äúnormal‚Äù e com o prefixo E. Sem entrar em detalhes, a classifica√ß√£o E leva em considera√ß√£o o ritmo do jogo, portanto, √© mais preciso.  N√≥s aceitamos. </p><br><p>  Em seguida, quero simplificar os nomes das classifica√ß√µes.  Eles precisar√£o ser introduzidos nos argumentos da fun√ß√£o e √© melhor usar a nota√ß√£o mais familiar para uma ampla gama de usu√°rios: ORTG, DRTG, NRTG.  Aqui voc√™ pode "ficar confuso" ao escrever uma express√£o regular e substitu√≠-la por <code>str_replace</code> , mas escrev√™-las ainda √© um prazer e aqui podemos fazer sem elas perfeitamente.  S√≥ precisamos extrair os 3, 7, 9 e 12 caracteres dos nomes atuais, combin√°-los e substituir os nomes das colunas pelo vetor de caracteres resultante.  Tudo isso √© feito usando as fun√ß√µes do pacote <code>str_sub</code> : <code>str_sub</code> e <code>str_c</code> (um an√°logo da <code>paste0</code> ). </p><br><pre> <code class="plaintext hljs">## Renaming columns with E_OFF_RATING on ORTG rating1 &lt;- rating %&gt;% rename_at(vars(starts_with("E_")), list(~str_c(str_sub(., start = 3, end = 3), str_sub(., start = 7, end = 7), str_sub(., start = 9, end = 9), str_sub(., start = 12, end = 12))))</code> </pre> <br><p>  <strong>at</strong> nas fun√ß√µes do pacote, <code>dplyr</code> possui a mesma propriedade que a constru√ß√£o <code>dt[, lapply(.SD, func), .SDols = col1]</code> no pacote <code>data.table</code> : a a√ß√£o √© aplicada a v√°rias colunas ao mesmo tempo.  Aqui, selecionamos todas as colunas cujo nome come√ßa com "E_". </p><br><p>  Como resultado, obtemos uma tabela com a qual continuaremos trabalhando: </p><br><div class="scrollable-table"><table><thead><tr><th>  TEAM_ID </th><th>  TEAM_ABBREVIATION </th><th>  TEAM_NAME </th><th>  GAME_ID </th><th>  GAME_DATE </th><th>  MATCHUP </th><th>  Wl </th><th>  ORTG </th><th>  DRTG </th><th>  NRTG </th></tr></thead><tbody><tr><td>  1610612749 </td><td>  Mil </td><td>  Milwaukee bucks </td><td>  0021801226 </td><td>  2019-04-10T00: 00: 00 </td><td>  MIL vs.  Okc </td><td>  L </td><td>  102,4 </td><td>  116,8 </td><td>  -14,4 </td></tr><tr><td>  1610612766 </td><td>  Cha </td><td>  Charlotte hornets </td><td>  0021801222 </td><td>  2019-04-10T00: 00: 00 </td><td>  CHA vs.  ORL </td><td>  L </td><td>  121,4 </td><td>  130,1 </td><td>  -8,6 </td></tr><tr><td>  1610612758 </td><td>  SAC </td><td>  Reis de Sacramento </td><td>  0021801230 </td><td>  2019-04-10T00: 00: 00 </td><td>  SAC @ POR </td><td>  L </td><td>  129,7 </td><td>  136,4 </td><td>  -6,8 </td></tr><tr><td>  1610612748 </td><td>  MIA </td><td>  Miami heat </td><td>  0021801221 </td><td>  2019-04-10T00: 00: 00 </td><td>  MIA @ BKN </td><td>  L </td><td>  84,2 </td><td>  103,6 </td><td>  -19,4 </td></tr><tr><td>  1610612750 </td><td>  MIN </td><td>  Minnesota timberwolves </td><td>  0021801228 </td><td>  2019-04-10T00: 00: 00 </td><td>  MIN @ DEN </td><td>  L </td><td>  98,3 </td><td>  103,7 </td><td>  -5,4 </td></tr></tbody></table></div><br><h2 id="funkciya-rolling_offnet_rating_nba-dlya-postroeniya-grafika-i-animacii-skolzyaschego-srednego">  A fun√ß√£o <strong><em>rolling_offnet_rating_nba</em></strong> para plotar e animar uma m√©dia m√≥vel. </h2><br><p>  Novamente, como da √∫ltima vez, vamos criar uma fun√ß√£o para fazer altera√ß√µes m√≠nimas nos c√°lculos. </p><br><p>  A fun√ß√£o <code>rolling_offnet_rating_nba</code> com isso: </p><br><pre> <code class="plaintext hljs">rolling_offnet_rating_nba &lt;- function(table, name, variable, col1 = col1, col2 = col2)</code> </pre> <br><p>  <strong>table</strong> √© o nome da tabela de dados, <br>  <strong>nome</strong> - a abrevia√ß√£o da equipe para a qual os gr√°ficos ser√£o criados ("BOS", "LAL" etc.). <br>  <strong>vari√°vel</strong> - a classifica√ß√£o que ser√° calculada (aqui est√£o duas op√ß√µes, ORTG ou NRTG, para a classifica√ß√£o de prote√ß√£o, criei uma fun√ß√£o separada) <br>  <strong>col1</strong> e <strong>col2</strong> - cor da linha com um valor acima / abaixo da m√©dia. </p><br><p>  A maioria <code>dplyr</code> fun√ß√µes <code>dplyr</code> usa <em>avalia√ß√£o n√£o padr√£o (NSE</em> ).  Este √© um termo geral que significa que a avalia√ß√£o deles difere da avalia√ß√£o usual em R. Isso nos permite simplificar a escrita de c√≥digo e trabalhar com bancos de dados SQL, mas o ponto negativo √© que n√£o podemos substituir o valor por um objeto equivalente definido em outro lugar. </p><br><p>  <em>Dplyr</em> usa <strong>avalia√ß√£o Tidy</strong> .  Portanto, √© necess√°rio usar ferramentas especiais (fun√ß√µes de cita√ß√£o, operador !!) para resolver problemas encontrados durante a programa√ß√£o.  Voc√™ pode ler mais sobre isso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> e ver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><p>  O c√≥digo a seguir pega o nome do argumento da fun√ß√£o e grava a express√£o que foi apresentada a ele.  (Para entender como as <code>enquo</code> e similares funcionam, √© √∫til imprimir a sa√≠da dessa fun√ß√£o) </p><br><pre> <code class="plaintext hljs">##Return the entered value in the function argument in the type quosure quo_rating &lt;- enquo(variable) quo_col1 &lt;- enquo(col1) quo_col2 &lt;- enquo(col2)</code> </pre> <br><p>  Em seguida, <strong>alteramos</strong> o formato dos dados de algumas colunas: tornamos <strong>GAME_DATE</strong> do caractere uma coluna no formato Data e tornamos as colunas de classifica√ß√£o num√©ricas.  Porque  aplicamos a fun√ß√£o <code>as.numeric</code> a tr√™s colunas e, em seguida, <code>mutate_at</code> usado em vez de <code>mutate</code> .  E classificamos tudo em ordem crescente de data. </p><br><pre> <code class="plaintext hljs">##Changing the data type of multiple columns test1 &lt;- table %&gt;% mutate(GAME_DATE = as.Date(ymd_hms(GAME_DATE))) %&gt;% mutate_at(vars(ORTG:NRTG), list(~as.numeric)) %&gt;% arrange(GAME_DATE)</code> </pre> <br><p>  E ent√£o calculamos a m√©dia m√≥vel de 10 partidas da equipe de que precisamos.  Para fazer isso, use a fun√ß√£o <code>rollmeanr</code> do pacote <code>zoo</code> .  r no final do nome significa que o resultado deve estar alinhado √† direita.  Nos nove primeiros jogos da temporada, √© imposs√≠vel calcular uma m√©dia m√≥vel de 10 partidas, portanto, deixamos esses campos inalterados preenchendo-os em NA usando o argumento de preenchimento.  <code>na.omit</code> remove da tabela as linhas nas quais esses NA ocorrem. </p><br><pre> <code class="plaintext hljs">##The calculation of the moving average team &lt;- test1 %&gt;% filter(TEAM_ABBREVIATION == "DAL") %&gt;% mutate(RATING = rollmeanr(ORTG, k = 10, fill= NA)) %&gt;% na.omit(test1)</code> </pre> <br><p>  A tabela da equipe fica assim: </p><br><div class="scrollable-table"><table><thead><tr><th>  TEAM_ID </th><th>  TEAM_ABBREVIATION </th><th>  TEAM_NAME </th><th>  GAME_ID </th><th>  GAME_DATE </th><th>  MATCHUP </th><th>  Wl </th><th>  ORTG </th><th>  DRTG </th><th>  NRTG </th><th>  Classifica√ß√£o </th></tr></thead><tbody><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas mavericks </td><td>  0021800150 </td><td>  06/11/2018 </td><td>  DAL vs.  Was </td><td>  W </td><td>  116,8 </td><td>  99,2 </td><td>  17,6 </td><td>  105,51 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas mavericks </td><td>  0021800160 </td><td>  07/11/2018 </td><td>  DAL @ UTA </td><td>  L </td><td>  98,5 </td><td>  112,0 </td><td>  -13,6 </td><td>  104,92 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas mavericks </td><td>  0021800181 </td><td>  10/11/2018 </td><td>  DAL vs.  Okc </td><td>  W </td><td>  115,0 </td><td>  101,1 </td><td>  13,9 </td><td>  104,13 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas mavericks </td><td>  0021800193 </td><td>  12/11/2018 </td><td>  DAL @ CHI </td><td>  W </td><td>  98,3 </td><td>  91,0 </td><td>  7.3 </td><td>  103,03 </td></tr><tr><td>  1610612742 </td><td>  DAL </td><td>  Dallas mavericks </td><td>  0021800210 </td><td>  14/11/2018 </td><td>  DAL vs.  UTA </td><td>  W </td><td>  117,3 </td><td>  65,8 </td><td>  51,6 </td><td>  105,34 </td></tr></tbody></table></div><br><p>  Em princ√≠pio, j√° recebemos as informa√ß√µes de que precisamos.  Usando duas linhas de c√≥digo, voc√™ pode criar um gr√°fico de linhas.  Mas a linha preta em um fundo branco √© de pouco interesse do ponto de vista est√©tico e informativo.  Uma outra parte do "corpo da fun√ß√£o" corrige isso. </p><br><p>  Para come√ßar, adicionamos os dados no valor da classifica√ß√£o m√©dia, 10 e 21 (d√©cimo da parte inferior), bem como a data 10 da partida da equipe (ou seja, a primeira para a qual a m√©dia m√≥vel √© calculada e que permaneceu na tabela da equipe ap√≥s excluir as linhas de NA) . </p><br><pre> <code class="plaintext hljs">##The average, 10 and 21 ratings in the entire League. average &lt;- league %&gt;% mutate(average = mean(!! quo_rating)) %&gt;% select(average) %&gt;% unique() %&gt;% .$average top10 &lt;- league %&gt;% arrange(desc(!! quo_rating)) %&gt;% select(!! quo_rating) %&gt;% slice(10) top10 &lt;- top10[[1]] bottom10 &lt;- league %&gt;% arrange(desc(!! quo_rating)) %&gt;% select(!! quo_rating) %&gt;% slice(21) bottom10 &lt;- bottom10[[1]] ##Getting the date of the first rollaverage data &lt;- team %&gt;% select(GAME_DATE) %&gt;% arrange(GAME_DATE) data &lt;- data[[1,1]]</code> </pre> <br><p>  Das fun√ß√µes n√£o utilizadas anteriormente, a fun√ß√£o de <code>slice</code> aparece aqui, que seleciona as linhas pelo n√∫mero de s√©rie. </p><br><p>  Em seguida, selecionamos duas cores e seu nome.  Os dados, como da √∫ltima vez, s√£o <code>table_color</code> da tabela <code>table_color</code> .  O nome ser√° usado no cabe√ßalho do gr√°fico para explicar qual das cores corresponde aos valores abaixo da m√©dia e qual √© mais alta. </p><br><pre> <code class="plaintext hljs">##Getting color and color_name selected color color1 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(!! quo_col1) color1 &lt;- color1[[1]] color2 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(!! quo_col2) color2 &lt;- color2[[1]] name1 &lt;- paste0("name_", quo_name(quo_col1)) name2 &lt;- paste0("name_", quo_name(quo_col2)) name_color1 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(name1) name_color1 &lt;- name_color1[[1]] name_color2 &lt;- table_color %&gt;% filter(TEAM_ABBREVIATION == name) %&gt;% select(name2) name_color2 &lt;- name_color2[[1]]</code> </pre> <br><p>  Os argumentos da fun√ß√£o s√£o padronizados para col1 e col2, essas s√£o a primeira e a segunda cores dos comandos.  Na maioria dos casos (mais precisamente em 26), esses valores n√£o precisam ser alterados; no entanto, para quatro equipes, a seguinte cor deve ser usada em sua paleta de cores.  Em Dallas e Minnesota, a primeira e a segunda cores s√£o muito semelhantes, enquanto em Milwaukee e Brooklyn n√£o s√£o vis√≠veis em um fundo branco.  Tanto isso como outro complicam a leitura do cronograma, portanto, vale a pena usar o argumento col2 = col3 para eles. </p><br><p>  Em seguida, obtemos a classifica√ß√£o m√°xima para a equipe.  Precisamos desse valor para organizar o texto com o valor da classifica√ß√£o no gr√°fico.  Quero prestar aten√ß√£o na √∫ltima linha do c√≥digo.  Aconteceu que as fun√ß√µes tra√ßaram perfeitamente gr√°ficos em 89 dos 90 casos, mas ao criar uma classifica√ß√£o de prote√ß√£o, Milwaukee cometeu um erro.  Aconteceu que o valor m√°ximo de classifica√ß√£o em Milwaukee √© alcan√ßado duas vezes e o <code>ggplot2</code> naturalmente come√ßa a jurar que a est√©tica deve ser, no nosso caso, 1 ou 73. Portanto, precisamos de um √∫nico valor m√°ximo de classifica√ß√£o. </p><br><pre> <code class="plaintext hljs">##The maximum value of the rating max &lt;- team %&gt;% filter(RATING == max(RATING)) %&gt;% select(RATING) max &lt;- max[[1]]</code> </pre> <br><h2 id="postroenie-statichnogo-grafika-v-ggplot2">  Construindo um gr√°fico est√°tico no <code>ggplot2</code> </h2><br><pre> <code class="plaintext hljs">##Building and save a static chart Sys.setlocale("LC_ALL", "C") gg &lt;- ggplot(team, aes(GAME_DATE, RATING)) + geom_hline(yintercept = c(top10, bottom10), col = c("red", "blue")) + annotate(geom = "text", x = as.Date(data) + 2, y = top10 - 0.2, label = "TOP 10", col = "red") + annotate(geom = "text", x = as.Date(data) + 2, y = bottom10 + 0.2, label = "BOTTOM 10", col = "blue") + geom_line(size = 2, col = if_else(team$RATING &gt; average, color1, color2)) + theme_tufte() + labs(title = paste0(team$TEAM_NAME, " 10-Game Rolling ", quo_name(quo_rating)), subtitle = paste0(paste0(name_color1, " - above average ", quo_name(quo_rating)), "\n", paste0(name_color2, " - below average ", quo_name(quo_rating))), caption = "Source: BBall Index Data &amp; Tools\nTelegram: @NBAatlantic, twitter: @vshufinskiy") theme(plot.title = element_text(size = 12, hjust = 0.5), plot.caption = element_text(size = 10), plot.subtitle = element_text(size = 9)) ggsave(paste0(unique(team$TEAM_NAME), quo_name(quo_rating), ".jpeg"), gg, width = 8, units = "in")</code> </pre> <br><p>  Das novidades aqui, o uso da fun√ß√£o <code>if_else</code> para alterar a cor da linha, dependendo se a classifica√ß√£o m√©dia da Liga √© maior ou menor, bem como a primeira linha que altera o c√≥digo do idioma.  Isso √© feito para que as abrevia√ß√µes dos nomes dos meses ao longo do eixo X sejam escritas em ingl√™s. <br><img src="https://habrastorage.org/webt/3b/yv/la/3byvlasu52uwfin6f8prdwipms0.jpeg"></p><br><h2 id="postroenie-animacii-10-matchevogo-skolzyaschego-srednego">  Anima√ß√£o de uma m√©dia m√≥vel de 10 correspond√™ncias. </h2><br><p>  Na constru√ß√£o da anima√ß√£o, adicionei v√°rias lo√ß√µes que n√£o s√£o poss√≠veis na vers√£o est√°tica.  Primeiro, a data da mudan√ßa (semelhante √† forma como o ano mudou no √∫ltimo artigo), bem como o valor da classifica√ß√£o em um determinado momento.  Tamb√©m muda de cor, dependendo de estar acima ou abaixo da m√©dia. </p><br><pre> <code class="plaintext hljs">##Building animations anim &lt;- gg + theme(plot.title = element_text(hjust = 0.5, size = 25), plot.subtitle = element_text(size = 15), plot.caption = element_text(size = 15), axis.text = element_text(size = 15), axis.title = element_text(size = 18)) + geom_text(aes(x = as.Date(data), y = max + 0.5), label = paste0(quo_name(quo_rating)," ", round(team$RATING, digits = 1)), size = 6, col = if_else(team$RATING &gt; average, color1, color2)) + transition_reveal(GAME_DATE) + labs(title = paste0(team$TEAM_NAME, " 10-Game Rolling ", quo_name(quo_rating)), subtitle = paste0(paste0(name_color1, " - above average ",quo_name(quo_rating)), "\n", paste0(name_color2, " - below average ",quo_name(quo_rating)), "\n", "Date: {frame_along}"), caption = paste0("Source: stats.nba.com\nTelegram: @NBAatlantic, twitter: @vshufinskiy"))</code> </pre> <br><h2 id="rezultat">  Resultado </h2><br><p><img src="https://habrastorage.org/webt/do/b-/hy/dob-hyqopjihkywk9kaq4jsrihg.gif"></p><br><p>  No gr√°fico, √© bastante √≥bvio que Dallas mergulhou na segunda quinzena de fevereiro a mar√ßo.  A explica√ß√£o para isso √© muito simples: foi nesse ponto da temporada que os Mavericks trocaram 4 dos 5 jogadores nos cinco primeiros, e o principal ativo recebido, o let√£o Kristaps Porzingis, n√£o jogou por um minuto devido √† ruptura dos ligamentos cruzados. </p><br><p>  Aqui n√£o vou me aprofundar no componente esportivo; portanto, se algu√©m estiver interessado em ver os 89 gr√°ficos restantes da temporada 2018-19, seja bem-vindo ao meu blog no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sports.ru</a> , onde planejo escrever um artigo com uma vis√£o geral dos mais interessantes deles ou no meu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">telegrama. canal</a> sobre a NBA, onde eu vou postar todos eles. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Reposit√≥rio do GitHub</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt459142/">https://habr.com/ru/post/pt459142/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt459130/index.html">Manipula√ß√£o suave de erros em microsservi√ßos</a></li>
<li><a href="../pt459134/index.html">Experi√™ncia usando BDD</a></li>
<li><a href="../pt459136/index.html">P√≠lula azul falsa</a></li>
<li><a href="../pt459138/index.html">Como a chave secreta da Huawei entrou no firmware dos roteadores Cisco</a></li>
<li><a href="../pt459140/index.html">Coloca√ß√£o do implante: como isso √© feito?</a></li>
<li><a href="../pt459144/index.html">Frontend Weekly Digest (1 a 7 de julho de 2019)</a></li>
<li><a href="../pt459146/index.html">Food Design Digest Junho 2019</a></li>
<li><a href="../pt459150/index.html">O resumo de materiais frescos do mundo do front-end da √∫ltima semana n ¬∞ 372 (1 a 7 de julho de 2019)</a></li>
<li><a href="../pt459152/index.html">Preencha documentos no Microsoft Word usando Python. Parte 2</a></li>
<li><a href="../pt459154/index.html">Rede para pequenas empresas usando equipamentos Cisco. Parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>