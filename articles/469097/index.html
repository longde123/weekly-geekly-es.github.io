<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úñÔ∏è üé≠ üí™ Servidor web CentOS 8 con php7, node.js y redis üèáüèª üë©üèª‚Äçüéì ‚óºÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√≥logo 
 Han pasado 2 d√≠as desde que sali√≥ la nueva versi√≥n del sistema operativo CentOS, a saber, CentOS 8. Y hasta ahora hay bastantes art√≠culos en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Servidor web CentOS 8 con php7, node.js y redis</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469097/"><h2>  Pr√≥logo </h2><br>  Han pasado 2 d√≠as desde que sali√≥ la nueva versi√≥n del sistema operativo CentOS, a saber, CentOS 8. Y hasta ahora hay bastantes art√≠culos en Internet sobre c√≥mo hacer algo en √©l, as√≠ que decid√≠ llenar este vac√≠o.  Adem√°s, le contar√© no solo sobre c√≥mo instalar este par de programas, sino tambi√©n sobre c√≥mo generalmente veo la instalaci√≥n de Linux en un entorno virtual en el mundo moderno para tareas t√≠picas, incluyendo particiones de discos y m√°s. <br><br>  Pero al principio quiero hablar brevemente sobre por qu√© deber√≠a cambiar a esta versi√≥n de todas las anteriores, y hay dos razones para esto: <br><a name="habracut"></a><br><ol><li>  php7!  En la versi√≥n anterior de CentOS, se instal√≥ "ortodoxo" php5.4 ... <br><br>  Bueno, si es un poco m√°s serio, muchos paquetes saltaron sobre varias versiones a granel.  Nosotros (los fan√°ticos del sistema operativo tipo redhat) finalmente hemos entrado, si no en el futuro, al menos en el presente.  Y los partidarios de Ubuntu ya no se reir√°n de nosotros y nos tocar√°n con los dedos, bueno ... al menos por un tiempo;). </li><li>  Transici√≥n de yum a dnf.  La principal diferencia es que ahora funciona con varias versiones de paquetes oficialmente compatibles.  Justo aqu√≠, en la figura ocho, nunca me ha sido √∫til todav√≠a, pero suena prometedor. </li></ol><br><h2>  Crear una m√°quina virtual </h2><br>  Los hipervisores son diferentes y no tengo ning√∫n prop√≥sito para agudizar el lector para uno espec√≠fico, le contar√© sobre los principios generales. <br><br><h3>  El recuerdo </h3><br>  Primero ... Para instalar el sistema CentOS a partir de 7 con seguridad, y en mi opini√≥n a las 6 tambi√©n fue as√≠ ("pero no es preciso"), se <i>requiere</i> un <i>m√≠nimo de</i> 2 GB de RAM.  Por lo tanto, te aconsejo que comiences y des mucho. <br><br>  Pero si eso, despu√©s de la instalaci√≥n, la cantidad de memoria se puede reducir.  Con 1 GB, el sistema b√°sico funciona bastante bien, lo comprob√©. <br><br><h3>  Conducir </h3><br>  Para una instalaci√≥n normal, cree un disco virtual de 20-30 GB.  Esto es suficiente para el sistema.  Y un segundo disco para datos.  Se puede agregar tanto en la etapa de creaci√≥n de una m√°quina virtual como despu√©s.  Usualmente agrego m√°s tarde. <br><br><h3>  CPU </h3><br>  En un n√∫cleo, un sistema simple no se ralentiza.  Y dado que los recursos son libremente escalables, no veo ning√∫n punto en dar m√°s en la etapa de instalaci√≥n (a menos que idealmente conozca los requisitos y sea demasiado vago para volver al configurador) <br><br>  El resto generalmente se puede dejar por defecto. <br><br><h2>  Instalaci√≥n en s√≠ </h2><br>  Entonces ... Lanzamos el instalador ... Personalmente, he estado poniendo estos servicios durante mucho tiempo solo en forma de m√°quinas virtuales, por lo que no describir√© todo tipo de registros de distribuci√≥n en una unidad flash USB: simplemente mont√© el ISO como un CD en mi hipervisor favorito, lo descargu√© y lo manej√©. <br><br>  La instalaci√≥n b√°sica es bastante t√≠pica, me centrar√© solo en algunos puntos. <br><br><h3>  Selecci√≥n de fuente </h3><br>  Desde el lanzamiento de la octava versi√≥n, el espejo de Yandex ha estado mintiendo todo el d√≠a.  Bueno, es decir, se eleva peri√≥dicamente, y luego nuevamente comienza a mostrar un error.  Estoy seguro de que el asunto es una carga excesiva en el servicio.  Por lo tanto, para indicar la fuente, personalmente tuve que, en lugar de ingresar la direcci√≥n habitual, ir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , seleccionar el espejo que me gusta all√≠ e ingresar manualmente la direcci√≥n en la ventana del instalador.  Es importante recordar que debe especificar la ruta a la carpeta donde se encuentra el <b>directorio de repodatos</b> .  Por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mirror.corbina.net/pub/Linux/centos/8/BaseOS/x86_64/os</a> . <br><br><h3>  Desglose de disco </h3><br>  Esta pregunta es bastante religiosa en mi opini√≥n.  Cada administrador tiene su propia posici√≥n sobre este tema.  Pero a√∫n comparto mi punto de vista sobre la cuesti√≥n. <br><br>  S√≠, en principio, puede asignar todo el lugar a la ra√≠z y al trabajo, a menudo incluso es bastante bueno.  ¬øPor qu√© entonces cercar en un jard√≠n con diferentes secciones?  - Las principales razones de esto, en mi opini√≥n 2: cuotas y portabilidad. <br><br>  Por ejemplo, si algo sali√≥ mal y se produjeron errores en la secci√≥n de datos principal, quiero poder cargar el sistema de todos modos y llevar a cabo medidas de reanimaci√≥n.  Por lo tanto, personalmente asigno una partici√≥n separada en / boot.  Ah√≠ est√° el n√∫cleo y el gestor de arranque.  Por lo general, 500 megabytes son suficientes, pero en casos raros puede tomar m√°s, y dado que ya estamos acostumbrados a medir el espacio con terabytes, asigno 2GB para esta secci√≥n.  Y aqu√≠ es importante que no se pueda hacer lvm. <br><br>  Luego viene la ra√≠z del sistema.  Para una instalaci√≥n normal, nunca necesit√© m√°s de 4 GB por sistema, pero durante los eventos programados a menudo uso el directorio / tmp para desempaquetar distribuciones, y no veo el punto de resaltarlo como una secci√≥n separada: se limpia autom√°ticamente en los sistemas modernos, por lo que no se llena .  Entonces, bajo la ra√≠z, asigno 8GB. <br><br>  Intercambio ... En general, hay pocos beneficios pr√°cticos.  Si comenz√≥ a usar el intercambio en el servidor, hoy en d√≠a en el mundo real esto solo significa que el servidor necesita agregar m√°s RAM.  De lo contrario, los problemas de rendimiento est√°n garantizados (o alg√∫n programa tiene p√©rdida de memoria).  Por lo tanto, esta secci√≥n es solo para fines de diagn√≥stico.  Por lo tanto, 2 GB es un gran n√∫mero.  S√≠, no importa cu√°nta memoria tenga el servidor.  S√≠, le√≠ todos los art√≠culos donde est√° escrito sobre la relaci√≥n de memoria a volumen de intercambio ... En mi humilde opini√≥n, est√°n desactualizados.  Durante 10 a√±os de pr√°ctica, esto nunca me ha sido √∫til.  Hace 15 a√±os los us√©, s√≠. <br><br>  Todos pueden decidir si asignar / hogar en una secci√≥n separada en mi humilde opini√≥n.  Si alguien usa activamente este directorio en el servidor, es mejor resaltarlo.  Si nadie, no hay raz√≥n. <br><br>  A continuaci√≥n, / var.  En mi opini√≥n, es necesario destacarlo.  Para empezar, puede limitarse a un n√∫mero de 4 GB y luego c√≥mo va.  Y s√≠, por "c√≥mo va", quiero decir que <br><br><ol><li>  En primer lugar, siempre puede montar otro disco en el subdirectorio / var (que mostrar√© m√°s adelante con un ejemplo) </li><li>  En segundo lugar, tenemos lvm: siempre puedes agregar.  Y, por lo general, debe agregar cuando comienzan a aparecer demasiados registros.  Pero nunca he podido predecir esta cifra de antemano, as√≠ que empiezo con 2 GB y luego miro. </li></ol><br>  El espacio no asignado permanecer√° libre en el grupo de vol√∫menes, siempre se puede usar. <br><br><h4>  LVM </h4><br>  <b>Tiene</b> sentido hacer <b>todas las</b> particiones excepto / boot en LVM.  S√≠, incluido el intercambio.  S√≠, el intercambio de todos los consejos debe estar al principio del disco y, en el caso de LVM, su ubicaci√≥n no puede determinarse en principio.  Pero como escrib√≠ anteriormente, su sistema <i>no deber√≠a</i> usar swap en absoluto.  Por lo tanto, no importa d√≥nde est√©.  Bueno, no en el '95 vivimos, sinceramente! <br><br>  Adem√°s, en LVM hay varias entidades b√°sicas con las que debes poder vivir: <br><br><ul><li>  volumen fisico </li><li>  grupo de volumen </li><li>  volumen l√≥gico </li></ul><br>  Los vol√∫menes f√≠sicos se agrupan, con cada volumen f√≠sico en un solo grupo, y el grupo puede estar en m√∫ltiples vol√∫menes f√≠sicos a la vez. <br>  Y los vol√∫menes l√≥gicos est√°n cada uno en el mismo grupo. <br><br>  Pero ... Maldita sea, estamos de nuevo en el patio del siglo XXI.  Y los servidores son virtuales.  No tiene sentido aplicarles los mismos mecanismos que se aplicaron a los f√≠sicos.  ¬°Y para lo virtual, es importante tener datos separados del sistema!  Esto es muy importante en particular para la capacidad de cambiar r√°pidamente los datos a otra m√°quina virtual (por ejemplo, al cambiar a un nuevo sistema operativo) y, en general, todo tipo de ventajas √∫tiles (copias de seguridad separadas por secciones usando el hipervisor, por ejemplo).  Por lo tanto, se usa un grupo de vol√∫menes para el sistema, ¬°y necesariamente se usa otro para los datos!  ¬°Esta separaci√≥n l√≥gica ayuda mucho en la vida! <br><br>  Si cre√≥ un solo disco duro virtual al crear una m√°quina virtual, este es el final de la configuraci√≥n.  Y si son dos, simplemente no marquen el segundo todav√≠a. <br><br>  <b>Comenzamos la instalaci√≥n.</b> <br><br><h2>  Post instalaci√≥n </h2><br>  Entonces, el sistema reci√©n instalado finalmente se inici√≥.  Lo primero que debe verificar es Internet. <br><br><pre><code class="bash hljs">ping ya.ru</code> </pre> <br>  ¬øHay una respuesta?  - Bien, presione Ctrl-C. <br>  Si no, configura la red, no hay vida sin esto, pero mi art√≠culo no trata sobre eso. <br><br>  Ahora, si a√∫n no estamos debajo de la ra√≠z, vamos debajo de la ra√≠z, porque para escribir tantos comandos con sudo personalmente vlom (y los administradores paranoicos me perdonan): <br><br><pre> <code class="bash hljs">sudo -i</code> </pre> <br>  Ahora lo primero que escribimos <br><br><pre> <code class="bash hljs">dnf -y update</code> </pre> <br>  Y si lees este art√≠culo en 2019, lo m√°s probable es que no pase nada, pero vali√≥ la pena intentarlo. <br><br><h3>  Ahora configure la unidad restante </h3><br>  Supongamos que tenemos una partici√≥n xvda con un sistema, entonces el disco de datos ser√° xvdb.  Ok <br><br>  La mayor√≠a de los consejos comenzar√°n con las palabras "Inicie fdisk y cree una partici√≥n ..." <br><br>  Entonces, esto <i>no es cierto</i> ! <br><br>  Repetir√© el panqueque nuevamente, ¬°porque es importante!  En este caso, trabajar con LVM, que ocupa un todo, incluso si es un disco virtual, ¬°crear particiones en √©l es da√±ino!  Cada palabra es importante en esta frase.  Si trabajamos sin LVM, es necesario.  Si decimos en el sistema de disco y los datos, es necesario.  Si por alguna raz√≥n necesitamos dejar la mitad del disco vac√≠a, tambi√©n es necesario.  Pero generalmente todos estos supuestos son puramente te√≥ricos.  Porque si decidimos agregar lugares a la secci√≥n existente, entonces la forma m√°s f√°cil de hacerlo es con esta configuraci√≥n.  Y la facilidad de administraci√≥n supera tanto que nos estamos moviendo deliberadamente hacia esta configuraci√≥n. <br><br>  ¬°Y la conveniencia es que si desea expandir la secci√≥n de datos, simplemente agrega espacio a la secci√≥n virtual, luego expande el grupo con vgextend y listo!  En casos raros, se puede requerir algo m√°s, pero al menos no tiene que expandir al principio el l√≥gico, lo cual ya es bueno.  Y luego, para expandir este volumen, se recomienda eliminar el existente al principio, y luego crear uno nuevo en la parte superior ... Que no se ve muy bien y no se puede hacer en vivo, y la expansi√≥n de acuerdo con el escenario que especifiqu√© se puede hacer sobre la marcha sin siquiera desmontar la partici√≥n. <br><br>  En total, creamos un volumen f√≠sico, luego un grupo de vol√∫menes, incluy√©ndolo y luego una secci√≥n para nuestro servidor: <br><br><pre> <code class="bash hljs">pvcreate /dev/xvdb vgcreate data /dev/xvdb lvcreate -n www -L40G data mke2fs -t ext4 /dev/mapper/data-www</code> </pre><br>  Aqu√≠, en lugar de la letra may√∫scula ‚ÄúL‚Äù (y el tama√±o en GB), puede especificar una peque√±a y luego indicar el tama√±o relativo en lugar del tama√±o absoluto, por ejemplo, para usar la mitad del espacio disponible actualmente en el grupo de vol√∫menes, debe especificar "-l + 50% GRATIS" <br><br>  Y el √∫ltimo comando formatea la partici√≥n en el sistema de archivos ext4 (que hasta ahora, en mi pr√°ctica, muestra la mayor estabilidad en caso de que todo se rompa, as√≠ que lo prefiero). <br><br>  Ahora monte la partici√≥n en el lugar correcto.  Para hacer esto, agregue la l√≠nea correcta a / etc / fstab: <br><br><pre> <code class="bash hljs">/dev/mapper/data-www /var/www ext4 defaults 1 2</code> </pre> <br>  Y escribimos <br><br><pre> <code class="bash hljs">mount /var/www</code> </pre> <br>  Si aparece un error, ¬°hacemos sonar la alarma!  Porque significa que tenemos un error en / etc / fstab.  Y que en el pr√≥ximo reinicio tendremos problemas muy grandes.  Es posible que el sistema no arranque en absoluto, lo que a menudo es muy triste para los servicios en la nube.  Por lo tanto, debe corregir con urgencia la √∫ltima l√≠nea agregada o eliminarla por completo.  Es por eso que no comenzamos a escribir el comando de montaje manualmente, entonces no hubi√©ramos tenido una oportunidad tan excelente para verificar la configuraci√≥n de los dispositivos directos al hogar. <br><br>  Ahora ponemos todo lo que quer√≠amos y abrimos los puertos en la web: <br><br><pre> <code class="bash hljs">dnf groupinstall <span class="hljs-string"><span class="hljs-string">"Development Tools"</span></span> dnf -y install httpd @nodejs @redis php firewall-cmd --add-service http --permanent firewall-cmd --add-service https --permanent</code> </pre><br>  Opcionalmente, tambi√©n puede poner la base de datos aqu√≠, pero personalmente, trato de mantenerla separada del servidor web.  Aunque mantenerla cerca es m√°s r√°pido, s√≠.  La velocidad de los adaptadores de red virtuales suele estar en la regi√≥n de gigabits, y cuando se trabaja en la misma m√°quina, el acceso se produce casi instant√°neamente.  Pero menos seguro.  Aqu√≠ para qui√©n es m√°s importante. <br><br>  Ahora agregue el par√°metro al archivo de configuraci√≥n (cree una ideolog√≠a CentOS nueva y moderna como esta) <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"vm.overcommit_memory = 1"</span></span>&gt; /etc/sysctl.d/98-sysctl.conf</code> </pre> <br>  Reinicia el servidor. <br>  En los comentarios, me rega√±aron por recomendarle que apague SeLinux, as√≠ que lo arreglar√© y escribir√© sobre el hecho de que despu√©s de eso debe recordar configurar SeLinux. <br>  <b>En realidad, ¬°lucro!</b>  <b>:)</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/469097/">https://habr.com/ru/post/469097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../469079/index.html">Python en Visual Studio Code: actualizaci√≥n de extensi√≥n de septiembre</a></li>
<li><a href="../469085/index.html">Sacamos el software del microcontrolador protegido con contrase√±a Renesas M16C</a></li>
<li><a href="../469087/index.html">MVCC en PostgreSQL-2. Tenedores, archivos, p√°ginas.</a></li>
<li><a href="../469093/index.html">Comparaci√≥n de bibliotecas de CLI menos populares y no muy cliff: cliff, plac, plumbum y otras (parte 2)</a></li>
<li><a href="../469095/index.html">Lanzamiento de las actualizaciones de ML.NET y Model Builder: novedades</a></li>
<li><a href="../469099/index.html">Tareas de prueba en la entrevista del desarrollador: ¬øtiene sentido?</a></li>
<li><a href="../469101/index.html">Aprender ingl√©s: c√≥mo aprender a hablar como hablante nativo</a></li>
<li><a href="../469109/index.html">Juguetes de madera, tercera parte - 1989</a></li>
<li><a href="../469111/index.html">Reemplazar objeto con var: ¬øqu√© podr√≠a salir mal?</a></li>
<li><a href="../469115/index.html">Gu√≠a Discovery.js: Inicio r√°pido</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>