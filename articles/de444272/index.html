<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçüé® üë©üèº‚Äçüé® üë©üèæ‚Äçü§ù‚Äçüë®üèΩ PyDERASN: Als ich die ASN.1-Bibliothek mit Slots und Blobs schrieb ü•´ üòé üî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ASN.1 ist ein Standard (ISO, ITU-T, GOST) einer Sprache, die strukturierte Informationen sowie Codierungsregeln f√ºr diese Informationen beschreibt. F√º...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PyDERASN: Als ich die ASN.1-Bibliothek mit Slots und Blobs schrieb</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444272/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ASN.1</a> ist ein Standard (ISO, ITU-T, GOST) einer Sprache, die strukturierte Informationen sowie Codierungsregeln f√ºr diese Informationen beschreibt.  F√ºr mich als Programmierer ist dies neben JSON, XML, XDR und anderen nur ein weiteres Format zum Serialisieren und Pr√§sentieren von Daten.  Es ist in unserem normalen Leben sehr verbreitet, und viele Menschen sto√üen darauf: in Mobilfunk, Telefon, VoIP-Kommunikation (UMTS, LTE, WiMAX, SS7, H.323), in Netzwerkprotokollen (LDAP, SNMP, Kerberos), in allem In Bezug auf Kryptographie (X.509, CMS, PKCS-Standards), Bankkarten und biometrische P√§sse und vieles mehr. <br><br>  Dieser Artikel beschreibt die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PyDERASN</a> : Python ASN.1-Bibliothek, die aktiv in Projekten im Zusammenhang mit Kryptographie in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Atlas verwendet wird</a> . <br><br><div style="text-align:center;"><img alt="Meine eigene" src="https://habrastorage.org/getpro/habr/post_images/7da/d0f/755/7dad0f755070999a4333d0206e830205.jpg"></div><a name="habracut"></a><br>  Tats√§chlich lohnt es sich nicht, ASN.1 f√ºr kryptografische Aufgaben zu empfehlen: ASN.1 und seine Codecs sind komplex.  Dies bedeutet, dass der Code nicht einfach ist, sondern immer ein zus√§tzlicher Angriffsvektor ist.  Schauen Sie sich einfach <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die Liste der</a> Schwachstellen in ASN.1-Bibliotheken an.  Bruce Schneier empfiehlt in seiner <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kryptografie-Technik</a> die Verwendung dieses Standards aufgrund seiner Komplexit√§t ebenfalls nicht: "Die bekannteste TLV-Codierung ist ASN.1, aber sie ist unglaublich komplex und wir scheuen sie."  Leider verf√ºgen wir heute √ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Public-Key-Infrastrukturen,</a> in denen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">X.509-Zertifikate</a> , CRL-, OCSP-, TSP-, CMP-, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CMC-</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CMS-</a> Nachrichten und viele <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PKCS-</a> Standards aktiv verwendet werden.  Daher m√ºssen Sie in der Lage sein, mit ASN.1 zu arbeiten, wenn Sie etwas im Zusammenhang mit Kryptografie tun. <br><br>  ASN.1 kann auf verschiedene Arten / Codecs codiert werden: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">BER</a> (Grundlegende Codierungsregeln) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CER</a> (Canonical Encoding Rules) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DER</a> (Distinguished Encoding Rules) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GSER</a> (Generic String Encoding Rules) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">JER</a> (JSON-Codierungsregeln) </li><li>  LWER (Light Weight Encoding Rules) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OER</a> (Octet Encoding Rules) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PER</a> (Packed Encoding Rules) </li><li>  SER (Signalisierungsspezifische Codierungsregeln) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">XER</a> (XML-Codierungsregeln) </li></ul><br>  und eine Reihe von anderen.  Bei kryptografischen Aufgaben in der Praxis werden jedoch zwei verwendet: BER und DER.  Selbst in signierten XML-Dokumenten ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">XMLDSig</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">XAdES</a> ) gibt es weiterhin Base64-codierte ASN.1 DER-Objekte, wie im JSON-basierten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ACME-</a> Protokoll von Let's Encrypt.  Sie k√∂nnen alle diese Codecs und BER / CER / DER-Codierungsprinzipien in Artikeln und B√ºchern besser verstehen: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ASN.1 in einfachen Worten</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ASN.1 - Kommunikation zwischen heterogenen Systemen von Olivier Dubuisson</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ASN.1 Vollst√§ndig von Prof. John Larmouth</a> . <br><br>  BER ist ein bin√§res byteorientiertes TLV-Format (z. B. PER, beliebt in der Mobilkommunikation - bitorientiert).  Jedes Element wird in Form von: einem Tag ( <strong>T</strong> ag) codiert, das den Typ des zu codierenden Elements (Ganzzahl, Zeichenfolge, Datum usw.), die L√§nge (L√§nge) des Inhalts und den Inhalt selbst (Wert) identifiziert.  Mit BER k√∂nnen Sie optional keinen L√§ngenwert angeben, indem Sie einen speziellen Wert f√ºr unbestimmte L√§nge festlegen und mit einer End-Of-Octets-Nachricht enden.  Zus√§tzlich zur L√§ngencodierung weist BER eine gro√üe Variabilit√§t bei der Codierungsmethode f√ºr Datentypen auf, wie z. <br><br><ul><li>  INTEGER, OBJECT IDENTIFIER, BIT STRING und die L√§nge des Elements d√ºrfen nicht normalisiert werden (nicht in minimaler Form codiert). </li><li>  BOOLEAN gilt f√ºr alle Inhalte ungleich Null. </li><li>  BIT STRING kann "zus√§tzliche" Nullbits enthalten; </li><li>  BIT STRING, OCTET STRING und alle abgeleiteten String-Typen, einschlie√ülich Datum / Uhrzeit, k√∂nnen in Teile (Chunk) variabler L√§nge unterteilt werden, deren L√§nge w√§hrend der (De-) Codierung nicht im Voraus bekannt ist. </li><li>  UTCTime / GeneralizedTime kann verschiedene Methoden zum Einstellen des Zeitzonenversatzes und ‚Äûzus√§tzlicher‚Äú Null-Sekundenbruchteile haben. </li><li>  DEFAULT SEQUENCE-Werte k√∂nnen codiert sein oder nicht. </li><li>  Benannte Werte der letzten Bits in BIT STRING k√∂nnen optional codiert werden. </li><li>  SEQUENCE (OF) / SET (OF) k√∂nnen eine beliebige Reihenfolge von Elementen haben. </li></ul><br>  In all diesen F√§llen ist es nicht immer m√∂glich, Daten so zu codieren, dass sie mit dem Originalformular identisch sind.  Daher wurde eine Teilmenge der Regeln erfunden: DER ist eine strikte Regelung nur einer g√ºltigen Codierungsmethode, die f√ºr kryptografische Aufgaben von entscheidender Bedeutung ist, bei denen beispielsweise durch √Ñndern eines Bits die Signatur oder Pr√ºfsumme ung√ºltig wird.  DER hat einen erheblichen Nachteil: Die L√§ngen aller Elemente m√ºssen w√§hrend der Codierung im Voraus bekannt sein, da dies keine Stream-Serialisierung von Daten erm√∂glicht.  Der CER-Codec ist frei von diesem Nachteil und garantiert ebenfalls eine eindeutige Darstellung der Daten.  Leider (oder zum Gl√ºck haben wir keine noch komplexeren Decoder?) Wurde es nicht popul√§r.  In der Praxis sto√üen wir daher auf eine ‚Äûgemischte‚Äú Verwendung von BER- und DER-codierten Daten.  Da sowohl CER als auch DER eine Teilmenge von BER sind, kann jeder BER-Decoder sie verarbeiten. <br><br><h2>  Probleme mit pyasn1 </h2><br>  Bei der Arbeit schreiben wir viele Python-Programme, die sich auf Kryptographie beziehen.  Und vor einigen Jahren gab es praktisch keine Auswahl an freien Bibliotheken: Entweder handelt es sich um Bibliotheken auf sehr niedriger Ebene, mit denen Sie beispielsweise eine Ganzzahl und einen Strukturheader einfach codieren / decodieren k√∂nnen, oder es handelt sich um eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pyasn1-</a> Bibliothek.  Wir haben mehrere Jahre darauf gelebt und waren zun√§chst sehr zufrieden, da Sie damit mit ASN.1-Strukturen als √ºbergeordnete Objekte arbeiten k√∂nnen: Mit einem dekodierten X.509-Zertifikatobjekt k√∂nnen Sie beispielsweise √ºber die W√∂rterbuchschnittstelle auf seine Felder zugreifen: cert ["tbsCertificate"] ["SerialNumber"] zeigt uns die Seriennummer dieses Zertifikats.  Ebenso k√∂nnen Sie komplexe Objekte "sammeln", indem Sie mit ihnen wie mit Listen und W√∂rterb√ºchern arbeiten und dann einfach die Funktion pyasn1.codec.der.encoder.encode aufrufen und eine serialisierte Darstellung des Dokuments erhalten. <br><br>  Es wurden jedoch Schw√§chen, Probleme und Einschr√§nkungen aufgedeckt.  Es gab und gibt leider immer noch Fehler in pyasn1: Zum Zeitpunkt des Schreibens ist in pyasn1 einer der Grundtypen, GeneralizedTime, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">falsch</a> decodiert und codiert. <br><br>  Aus Platzgr√ºnden speichern wir in unseren Projekten h√§ufig nur den Pfad zur Datei, den Versatz und die L√§nge des Objekts, auf das wir verweisen m√∂chten, in Byte.  Beispielsweise befindet sich eine beliebig signierte Datei h√∂chstwahrscheinlich in der CMS SignedData ASN.1-Struktur: <br><br><pre><code class="plaintext hljs">0 [1,3,1018] ContentInfo SEQUENCE 4 [1,1, 9] . contentType: ContentType OBJECT IDENTIFIER 1.2.840.113549.1.7.2 (id_signedData) 19-4 [0,0,1003] . content: [0] EXPLICIT [UNIV 16] ANY 19 [1,3, 999] . . DEFINED BY id_signedData: SignedData SEQUENCE 23 [1,1, 1] . . . version: CMSVersion INTEGER v3 (03) 26 [1,1, 19] . . . digestAlgorithms: DigestAlgorithmIdentifiers SET OF [...] 47 [1,3, 769] . . . encapContentInfo: EncapsulatedContentInfo SEQUENCE 51 [1,1, 8] . . . . eContentType: ContentType OBJECT IDENTIFIER 1.3.6.1.5.5.7.12.2 (id_cct_PKIData) 65-4 [1,3, 751] . . . . eContent: [0] EXPLICIT OCTET STRING 751 bytes OPTIONAL      751  820 [1,2, 199] . . . signerInfos: SignerInfos SET OF 823 [1,2, 196] . . . . 0: SignerInfo SEQUENCE 826 [1,1, 1] . . . . . version: CMSVersion INTEGER v3 (03) 829 [0,0, 22] . . . . . sid: SignerIdentifier CHOICE subjectKeyIdentifier [...] 956 [1,1, 64] . . . . . signature: SignatureValue OCTET STRING 64 bytes . . . . . . C1:B3:88:BA:F8:92:1C:E6:3E:41:9B:E0:D3:E9:AF:D8 . . . . . . 47:4A:8A:9D:94:5D:56:6B:F0:C1:20:38:D2:72:22:12 . . . . . . 9F:76:46:F6:51:5F:9A:8D:BF:D7:A6:9B:FD:C5:DA:D2 . . . . . . F3:6B:00:14:A4:9D:D7:B5:E1:A6:86:44:86:A7:E8:C9</code> </pre> <br>  und wir k√∂nnen die urspr√ºngliche signierte Datei mit einem Versatz von 65 Bytes und 751 Bytes L√§nge erhalten.  pyasn1 speichert diese Informationen nicht in seinen dekodierten Objekten.  Der sogenannte TLVSeeker wurde geschrieben - eine kleine Bibliothek, mit der Sie die Tags und L√§ngen von Objekten dekodieren k√∂nnen, in deren Schnittstelle wir befohlen haben: "Gehe zum n√§chsten Tag", "Gehe in das Tag" (Gehe in die SEQUENZ des Objekts), "Gehe zum n√§chsten Tag", "Sag es dir" Versatz und die L√§nge des Objekts, in dem wir uns befinden. "  Es war ein ‚Äûmanueller‚Äú Spaziergang mit ASN.1 DER-serialisierten Daten.  Es war jedoch nicht m√∂glich, auf diese Weise mit BER-serialisierten Daten zu arbeiten, da beispielsweise die Byte-Zeichenfolge OCTET STRING als mehrere Chunk-s codiert werden k√∂nnte. <br><br>  Ein weiterer Nachteil unserer pyasn1-Aufgaben ist die Unf√§higkeit, anhand dekodierter Objekte zu verstehen, ob ein bestimmtes Feld in SEQUENCE vorhanden war oder nicht.  Wenn die Struktur beispielsweise das Feld Feld SEQUENCE OF Smth OPTIONAL enth√§lt, kann es in den empfangenen Daten (OPTIONAL) vollst√§ndig fehlen, aber vorhanden sein, aber gleichzeitig die L√§nge Null haben (leere Liste).  Im allgemeinen Fall konnte dies nicht gekl√§rt werden.  Und dies ist notwendig f√ºr eine strenge √úberpr√ºfung der G√ºltigkeit der empfangenen Daten.  Stellen Sie sich vor, eine Zertifizierungsstelle w√ºrde ein Zertifikat mit "nicht vollst√§ndig" g√ºltigen Daten aus Sicht der ASN.1-Schemata ausstellen!  Beispielsweise hat die Zertifizierungsstelle T√úRKTRUST Elektronik Sertifika Hizmet Saƒülayƒ±cƒ±sƒ± in ihrem Stammzertifikat die zul√§ssigen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 5280-</a> Grenzen f√ºr die L√§nge der betreffenden Komponente √ºberschritten - sie kann gem√§√ü dem Schema nicht ehrlich dekodiert werden.  Der DER-Codec erfordert, dass ein Feld mit dem Wert DEFAULT w√§hrend der √úbertragung nicht codiert wird - solche Dokumente werden im Leben angetroffen, und die erste Version von PyDERASN hat aus Gr√ºnden der Abw√§rtskompatibilit√§t sogar bewusst ein solches ung√ºltiges (aus Sicht von DER) Verhalten zugelassen. <br><br>  Eine weitere Einschr√§nkung ist die Unf√§higkeit, leicht herauszufinden, in welcher Form (BER / DER) das eine oder andere Objekt in der Struktur codiert wurde.  Der CMS-Standard besagt beispielsweise, dass die Nachricht BER-codiert ist, das Feld signiertAttrs, √ºber das die kryptografische Signatur gebildet wird, sollte sich jedoch in DER befinden.  Wenn wir mit dem DER dekodieren, fallen wir auf die Verarbeitung des CMS selbst zur√ºck. Wenn wir mit dem BER dekodieren, wissen wir nicht, in welcher Form signierte Attribute waren.  Infolgedessen muss TLVSeeker (dessen Analogon nicht in pyasn1 enthalten ist) nach der Position jedes der signiertenAttrs-Felder suchen und sollte von DER separat aus der serialisierten Ansicht dekodiert werden. <br><br>  Die M√∂glichkeit der automatischen Verarbeitung von DEFINED BY-Feldern, die sehr h√§ufig sind, war f√ºr uns sehr w√ºnschenswert.  Nach dem Dekodieren der ASN.1-Struktur sind m√∂glicherweise noch viele Felder √ºbrig, die gem√§√ü dem auf der Grundlage des im Strukturfeld angegebenen OBJECT IDENTIFIER ausgew√§hlten Schemas weiterverarbeitet werden sollten.  Im Python-Code bedeutet dies, ein if zu schreiben und dann den Decoder f√ºr das ANY-Feld aufzurufen. <br><br><h2>  Das Aufkommen von PyDERASN </h2><br>  In Atlas senden wir regelm√§√üig Patches nach oben, nachdem wir Probleme festgestellt oder die verwendeten kostenlosen Programme ge√§ndert haben.  In pyasn1 haben wir mehrmals Verbesserungen gesendet, aber der pyasn1-Code ist nicht so einfach zu verstehen, und manchmal traten inkompatible API-√Ñnderungen auf, die uns auf die H√§nde trafen.  Au√üerdem sind wir es gewohnt, Tests mit generativen Tests zu schreiben, was bei pyasn1 nicht der Fall war. <br><br>  Eines sch√∂nen Tages entschied ich, dass ich das ertragen musste und es war Zeit zu versuchen, meine eigene Bibliothek mit __slot __s, Offset s und wundersch√∂n angezeigten Blobs zu schreiben!  Nur einen ASN.1-Codec zu erstellen, w√ºrde nicht ausreichen - Sie m√ºssen alle unsere abh√§ngigen Projekte darauf √ºbertragen, und dies sind Hunderttausende von Codezeilen, in denen viel mit ASN.1-Strukturen gearbeitet wird.  Dies ist eine der Voraussetzungen daf√ºr: einfache √úbersetzung des aktuellen pyasn1-Codes.  Nachdem ich meinen gesamten Urlaub verbracht hatte, schrieb ich diese Bibliothek und √ºbertrug alle Projekte darauf.  Da sie durch Tests zu fast 100% abgedeckt sind, war die Bibliothek auch voll funktionsf√§hig. <br><br>  PyDERASN hat ebenfalls eine Testabdeckung von fast 100%.  Generative Tests werden mit der wunderbaren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hypothesenbibliothek</a> verwendet.  Auch das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fuzzing von Py-Afl</a> auf 32 Nuklearmaschinen wurde durchgef√ºhrt.  Trotz der Tatsache, dass wir fast keinen Python2-Code mehr haben, bleibt PyDERASN weiterhin kompatibel und hat aus diesem Grund eine einzige Abh√§ngigkeit von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sechs</a> .  Dar√ºber hinaus wird es anhand der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ASN.1: 2008-Konformit√§tstestsuite getestet</a> . <br><br>  Das Prinzip der Arbeit damit √§hnelt pyasn1 - Arbeiten mit Python-Objekten auf hoher Ebene.  Die Beschreibung der ASN.1-Schaltkreise ist √§hnlich. <br><br><pre> <code class="plaintext hljs">class TBSCertificate(Sequence): schema = ( ("version", Version(expl=tag_ctxc(0), default="v1")), ("serialNumber", CertificateSerialNumber()), ("signature", AlgorithmIdentifier()), ("issuer", Name()), ("validity", Validity()), ("subject", Name()), ("subjectPublicKeyInfo", SubjectPublicKeyInfo()), ("issuerUniqueID", UniqueIdentifier(impl=tag_ctxp(1), optional=True)), ("subjectUniqueID", UniqueIdentifier(impl=tag_ctxp(2), optional=True)), ("extensions", Extensions(expl=tag_ctxc(3), optional=True)), )</code> </pre><br>  PyDERASN hat jedoch den Anschein einer starken Typisierung.  Wenn das Feld in pyasn1 vom Typ CMSVersion (INTEGER) war, konnte ihm ein int oder INTEGER zugewiesen werden.  PyDERASN setzt unbedingt voraus, dass das zugewiesene Objekt genau CMSVersion ist.  Zus√§tzlich zum Schreiben von Python3-Code verwenden wir Tippanmerkungen, sodass unsere Funktionen keine unverst√§ndlichen Argumente wie def func (seriell, Inhalt), sondern def func (seriell: CertificateSerialNumber, Inhalt: EncapsulatedContentInfo) enthalten und PyDERASN dabei hilft, den √úberblick zu behalten Code. <br><br>  Gleichzeitig hat PyDERASN √§u√üerst bequeme Zugest√§ndnisse f√ºr diese Typisierung.  pyasn1 erlaubte SubjectKeyIdentifier (). subtype (implicitTag = Tag (...)) nicht, ein SubjectKeyIdentifier () -Objekt zuzuweisen (ohne den erforderlichen IMPLICIT-TAG) und musste Objekte h√§ufig nur aufgrund ge√§nderter IMPLICIT / EXPLICIT-Tags kopieren und neu erstellen.  PyDERASN beachtet streng nur den Basistyp - es ersetzt automatisch Tags aus einer vorhandenen ASN.1-Struktur.  Dies vereinfacht den Anwendungscode erheblich. <br><br>  Wenn beim Decodieren ein Fehler auftritt, ist es in pyasn1 nicht einfach, genau zu verstehen, wo er aufgetreten ist.  Im bereits erw√§hnten t√ºrkischen Zertifikat wird beispielsweise der folgende Fehler angezeigt: UTF8String (tbsCertificate: issuer: rdnSequence: 3: 0: value: DEFINED BY 2.5.4.10:utf8String) (bei 138) Unbefriedigte Grenzen: 1 ‚áê 77 ‚áê 64 Beim Schreiben von ASN .1 Strukturen Menschen k√∂nnen Fehler machen, und es hilft, Anwendungen zu debuggen oder Probleme mit verschl√ºsselten Dokumenten der Gegenseite herauszufinden. <br><br>  Die erste Version von PyDERASN unterst√ºtzte keine BER-Codierung.  Es erschien viel sp√§ter und die UTCTime / GeneralizedTime-Verarbeitung mit Zeitzonen wird immer noch nicht unterst√ºtzt.  Dies wird in Zukunft geschehen, da das Projekt haupts√§chlich in der Freizeit geschrieben wird. <br><br>  Auch in der ersten Version gab es keine Arbeit mit DEFINED BY-Feldern.  Einige Monate sp√§ter erschien diese <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gelegenheit</a> und wurde aktiv genutzt, wodurch der Anwendungscode erheblich reduziert wurde. In einem Dekodierungsvorgang konnte die gesamte Struktur bis in die Tiefe zerlegt werden.  Zu diesem Zweck werden im Schema die Felder definiert, die "bestimmen".  Zum Beispiel eine Beschreibung eines CMS-Schemas: <br><br><pre> <code class="plaintext hljs">class ContentInfo(Sequence): schema = ( ("contentType", ContentType(defines=((("content",), { id_authenticatedData: AuthenticatedData(), id_digestedData: DigestedData(), id_encryptedData: EncryptedData(), id_envelopedData: EnvelopedData(), id_signedData: SignedData(), }),))), ("content", Any(expl=tag_ctxc(0))), )</code> </pre><br>  besagt, dass, wenn contentType eine OID mit id_signedData enth√§lt, das Inhaltsfeld (in derselben SEQUENCE) mit dem SignedData-Schema dekodiert werden muss.  Warum gibt es so viele Klammern?  Ein Feld kann mehrere Felder gleichzeitig ‚Äûdefinieren‚Äú, wie dies bei EnvelopedData-Strukturen der Fall ist.  Definierte Felder werden durch den sogenannten Dekodierungspfad identifiziert - er legt die genaue Position eines Elements in allen Strukturen fest. <br><br>  Es ist nicht immer w√ºnschenswert oder nicht immer m√∂glich, diese Definitionen sofort in die Schaltung einzuf√ºhren.  Es kann anwendungsspezifische F√§lle geben, in denen OIDs und Strukturen nur in einem Drittanbieterprojekt bekannt sind.  PyDERASN bietet die M√∂glichkeit, diese Definitionen direkt zum Zeitpunkt der Dekodierung der Struktur anzugeben: <br><br><pre> <code class="plaintext hljs">ContentInfo().decode(data, ctx={"defines_by_path": (( ( "content", DecodePathDefBy(id_signedData), "certificates", any, "certificate", "tbsCertificate", "extensions", any, "extnID", ), ((("extnValue",), { id_ce_authorityKeyIdentifier: AuthorityKeyIdentifier(), id_ce_basicConstraints: BasicConstraints(), [...] id_ru_subjectSignTool: SubjectSignTool(), }),), ),)})</code> </pre><br>  Hier sagen wir, dass Sie in CMS SignedData f√ºr alle angeh√§ngten Zertifikate alle ihre Erweiterungen (AuthorityKeyIdentifier, BasicConstraints, SubjectSignTool usw.) dekodieren.  Wir geben durch den Decodierungspfad an, welches Element "ersetzt" werden soll, als ob es in der Schaltung definiert w√§re. <br><br>  Schlie√ülich hat PyDERASN die M√∂glichkeit, √ºber die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Befehlszeile</a> ASN.1-Dateien zu dekodieren, und verf√ºgt √ºber ein reichhaltiges, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">h√ºbsches Drucken</a> .  Sie k√∂nnen eine beliebige ASN.1 dekodieren oder ein klar definiertes Schema angeben und Folgendes sehen: <br><br><img alt="H√ºbsches Druckbeispiel" src="https://habrastorage.org/getpro/habr/post_images/3dc/981/000/3dc981000f30512bf2ca9488332345d4.png"><br><br>  Angezeigte Informationen: Objektversatz, Tag-L√§nge, L√§ngenl√§nge, Inhaltsl√§nge, Vorhandensein von EOC (Ende der Oktette), BER-Codierungsflag, Codierungsflag mit unbestimmter L√§nge, EXPLICIT-Tag-L√§nge und Versatz (falls vorhanden), Objektverschachtelungstiefe in Strukturen, IMPLICIT / EXPLICIT-Tag-Wert, Objektname gem√§√ü dem Schema, sein grundlegender ASN.1-Typ, Seriennummer innerhalb von SEQUENCE / SET OF, Wert CHOICE (falls vorhanden), lesbarer Name INTEGER / ENUMERATED / BIT STRING gem√§√ü dem Schema, Wert eines beliebigen Basistyps , DEFAULT / OPTIONAL-Flag von der Schaltung, ein Zeichen daf√ºr, dass das Objekt automatisch als DEFINED BY und danach dekodiert wurde  g OID-und es passiert ist, chelovekochitaemy OID. <br><br>  Das h√ºbsche Drucksystem ist speziell so konstruiert, dass es eine Folge von PP-Objekten erzeugt, die bereits auf separate Weise visualisiert werden.  Der Screenshot zeigt den Renderer in einfarbigem Text.  Es gibt Renderer im JSON / HTML-Format, so dass dies durch Hervorheben im ASN.1-Browser wie im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">asn1js-</a> Projekt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sichtbar wird</a> . <br><br><h2>  Andere Bibliotheken </h2><br>  Dies war nicht das Ziel, aber PyDERASN war deutlich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">schneller</a> als pyasn1.  Beispielsweise kann das Dekodieren von CRL-Dateien mit Megabyte-Gr√∂√üe so lange dauern, dass Sie √ºber Zwischenformate zum Speichern von Daten (schnell) nachdenken und die Architektur von Anwendungen √§ndern m√ºssen.  pyasn1 dekodiert CRL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CACert.org</a> f√ºr mehr als 20 Minuten auf meinem Laptop, w√§hrend PyDERASN in nur 28 Sekunden!  Es gibt ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">asn1crypto-</a> Projekt, das darauf abzielt, schnell mit kryptografischen Strukturen zu arbeiten: Es dekodiert (vollst√§ndig, nicht tr√§ge) dieselbe CRL in 29 Sekunden, verbraucht jedoch fast doppelt so viel RAM, wenn es unter Python3 ausgef√ºhrt wird (983 MiB gegen√ºber 498). und 3,5-mal unter Python2 (1677 gegen 488), w√§hrend pyasn1 bis zu 4,3-mal mehr verbraucht (2093 gegen 488). <br><br>  asn1crypto, das ich erw√§hnte, haben wir nicht ber√ºcksichtigt, da das Projekt noch in den Kinderschuhen steckte und wir nichts davon geh√∂rt hatten.  Jetzt w√ºrden sie auch nicht in seine Richtung schauen, da ich sofort herausfand, dass er nicht dieselbe GeneralizedTime akzeptiert, und w√§hrend der Serialisierung entfernt er stillschweigend Sekundenbruchteile.  Dies ist f√ºr die Arbeit mit X.509-Zertifikaten akzeptabel, funktioniert jedoch im Allgemeinen nicht. <br><br>  Im Moment ist PyDERASN der strengste freie Python / Go DER-Decoder, den ich kenne.  In der encoding / asn1-Bibliothek meines Lieblings-Go werden die Zeichenfolgen OBJECT IDENTIFIER und UTCTime / GeneralizedTime <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nicht streng √ºberpr√ºft</a> .  Manchmal kann die Strenge st√∂ren (vor allem aufgrund der Abw√§rtskompatibilit√§t mit alten Anwendungen, die niemand beheben wird), sodass Sie in PyDERASN w√§hrend der Dekodierung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">verschiedene</a> Schw√§chungspr√ºfungen f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einstellungen bestehen</a> k√∂nnen. <br><br>  Der Projektcode versucht so einfach wie m√∂glich zu sein.  Die gesamte Bibliothek ist eine einzelne Datei.  Der Code wurde mit Schwerpunkt auf Verst√§ndlichkeit geschrieben, ohne unn√∂tige Leistung und DRY-Code-Optimierungen.  Wie ich bereits sagte, unterst√ºtzt es nicht die vollst√§ndige BER-Decodierung von UTCTime / GeneralizedTime-Zeichenfolgen sowie die Datentypen REAL, RELATIVE OID, EXTERNAL, INSTANCE OF, EMBEDDED PDV und CHARACTER STRING.  In allen anderen F√§llen sehe ich pers√∂nlich keinen Grund, andere Bibliotheken in Python zu verwenden. <br><br>  Wie alle meine Projekte wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PyGOST</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GoGOST</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NNCP</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GoVPN</a> ist PyDERASN eine v√∂llig <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kostenlose Software,</a> die unter den Bedingungen von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">LGPLv3 + vertrieben</a> wird und zum kostenlosen Download zur Verf√ºgung steht.  Anwendungsbeispiele finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PyGOST-Tests</a> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sergey Matveev</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Chiffrierbank</a> , Mitglied <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">der</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Open Society</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Foundation Foundation</a> , Python / Go-Entwickler, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Chefspezialist</a> des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FSUE ‚ÄûScientific and Technical Center‚Äú Atlas ‚Äú</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de444272/">https://habr.com/ru/post/de444272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de444260/index.html">Wir entwickeln ein System zur Bewertung der Arbeit von Support-Mitarbeitern</a></li>
<li><a href="../de444262/index.html">Markdown2pdf-Quellcode f√ºr Linux</a></li>
<li><a href="../de444264/index.html">Wie man ein Committer wird und braucht man es wirklich?</a></li>
<li><a href="../de444268/index.html">Sicherheitswoche 12: Tastaturangriffe</a></li>
<li><a href="../de444270/index.html">Group-IB-Webinar ‚ÄûGroup-IB-Ansatz zur Cyber-Aufkl√§rung: Ein √úberblick √ºber aktuelle Programme und praktische F√§lle‚Äú</a></li>
<li><a href="../de444274/index.html">Eine ausf√ºhrliche Antwort auf den Kommentar sowie ein wenig √ºber das Leben der Anbieter in der Russischen F√∂deration</a></li>
<li><a href="../de444276/index.html">Einf√ºhrung in die Reaktion auf Faserarchitektur</a></li>
<li><a href="../de444278/index.html">So bringen Sie Zehntausende dazu, Ihren englischsprachigen Artikel f√ºr Habr zu lesen: 3 einfache Tipps</a></li>
<li><a href="../de444282/index.html">7 Chrome-Erweiterungen zum Englischlernen</a></li>
<li><a href="../de444284/index.html">Vervollst√§ndigung von Komponisten und Befehlszeilen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>