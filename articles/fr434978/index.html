<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüîß „äóÔ∏è üì≥ Pr√©sentation de HealthKit üí• üí° üà∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article HealthKit, vous apprendrez comment demander l'autorisation d'acc√©der aux donn√©es HealthKit, ainsi que lire et √©crire des donn√©es dans...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pr√©sentation de HealthKit</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434978/"> Dans cet article HealthKit, vous apprendrez comment demander l'autorisation d'acc√©der aux donn√©es HealthKit, ainsi que lire et √©crire des donn√©es dans le r√©f√©rentiel central HealthKit.  L'article utilise la version Swift 4, iOS 11, Xcode 9. <br><br>  <b>HealthKit</b> est une API qui a √©t√© introduite dans iOS 8. <i>HealthKit</i> sert de r√©f√©rentiel central pour toutes les donn√©es li√©es √† la sant√©, permettant aux utilisateurs de cr√©er un profil biologique et de stocker des donn√©es d'entra√Ænement. <br><br>  En lisant l'article HealthKit, vous allez cr√©er l'application de suivi de formation la plus simple et apprendre: <br><br><ul><li>  Comment demander une autorisation et acc√©der aux donn√©es HealthKit </li><li>  Comment lire les donn√©es HealthKit et les afficher dans un UITableView </li><li>  Comment √©crire des donn√©es dans le r√©f√©rentiel central HealthKit </li></ul><br>  Pr√™t √† d√©marrer avec HealthKit?  Continuez √† lire! <br><a name="habracut"></a><br>  <b>Remarque:</b> <i>Pour travailler sur ce didacticiel, vous aurez besoin d'un compte de d√©veloppeur iOS actif.</i>  <i>Sans cela, vous ne pouvez pas activer la fonctionnalit√© HealthKit et acc√©der au r√©f√©rentiel HealthKit.</i> <br><br><h3>  Commencer </h3><br>  L'application de d√©marrage suit la combustion des calories pendant un programme d'entra√Ænement.  Pour les initi√©s et les mondains d'Hollywood, il devrait √™tre √©vident que je parle de <b>Prancercise</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sp/rk/if/sprkif8aw8ng01gh-y4vrroags8.png" alt="Prancercise" width="764" height="430"></div><br>  <a href="">T√©l√©chargez le projet de d√©marrage et ouvrez-le dans Xcode</a> . <br><br>  Compilez et ex√©cutez l'application.  Vous verrez le ¬´squelette¬ª de l'interface utilisateur.  Au cours des deux prochains articles, vous ajouterez progressivement des fonctionnalit√©s pour cette application. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c8f/68a/4a5/c8f68a4a5bea9dfc34c426606e443458.png" alt="image" width="281" height="500"></div><br><h3>  Attribuer une √©quipe </h3><br>  <b>HealthKit</b> est un cadre sp√©cial.  L'application ne pourra pas l'utiliser si vous n'avez pas de compte d√©veloppeur actif.  Apr√®s avoir un compte d√©veloppeur, vous pouvez affecter votre √©quipe. <br><br>  S√©lectionnez <b>PrancerciseTracker</b> dans le navigateur de projet, puis s√©lectionnez la <b>cible PrancerciseTracker</b> .  Acc√©dez √† l'onglet <b>G√©n√©ral</b> et cliquez sur le champ <b>√âquipe</b> . <br><br>  S√©lectionnez la commande associ√©e √† votre compte d√©veloppeur: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/809/a3e/af2/809a3eaf2aa966919ed95ad1f8a4be38.png" alt="image" width="2020" height="752"></div><br><h3>  Autorisations / droits </h3><br>  HealthKit poss√®de √©galement son propre ensemble de droits, et vous devrez les activer afin de cr√©er des applications qui utilisent le framework. <br><br>  Ouvrez l'onglet <b>Capacit√©s</b> dans l'√©diteur cible et activez <b>HealthKit</b> , comme indiqu√© dans la capture d'√©cran ci-dessous: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dce/374/42e/dce37442eebca83d0e6e480113dcd3fc.png" alt="image"><br><br>  Attendez que Xcode configure pour vous HealthKit.  En r√®gle g√©n√©rale, il n'y a pas de probl√®me ici, mais vous pouvez toujours en rencontrer si vous oubliez de sp√©cifier correctement l'identifiant d'√©quipe et de bundle. <br><br>  Maintenant, tout est pr√™t.  Il vous suffit de demander √† l'utilisateur l'autorisation d'utiliser HealthKit. <br><br><h3>  Autorisations </h3><br>  HealthKit fonctionne avec des donn√©es confidentielles et sensibles.  Tout le monde ne se sent pas √† l'aise pour permettre aux applications install√©es d'acc√©der √† ces informations. <br><br>  C'est pourquoi HealthKit dispose d'un solide syst√®me de confidentialit√©.  HealthKit n'a acc√®s qu'aux donn√©es que les utilisateurs acceptent de partager.  Pour cr√©er un profil pour les utilisateurs de votre Prancercise Tracker, vous devez d'abord obtenir l'autorisation d'acc√©der √† chaque type de donn√©es. <br><br><h3>  Mise √† jour de la description d'utilisation </h3><br>  Tout d'abord, vous devez d√©crire pourquoi vous demandez des indicateurs de sant√© √† vos utilisateurs.  <b>Xcode</b> vous donne la possibilit√© de le sp√©cifier dans le fichier <b>Info.plist de</b> votre application. <br><br>  Ouvrez <b>Info.plist</b> .  Ajoutez ensuite les cl√©s suivantes: <br>  <b>Confidentialit√©</b> - <b>Description d'utilisation de Health Share</b> <br>  <b>Confidentialit√©</b> - <b>Description de l'utilisation de la mise √† jour de la sant√©</b> <br><br>  Ces cl√©s stockent le texte qui sera affich√© lorsque l'√©cran de connexion HeathKit appara√Æt.  <b>La description d'utilisation du partage de sant√©</b> fait r√©f√©rence √† la section de donn√©es qui doit √™tre lue √† partir de HealthKit.  <b>La description d'utilisation de la mise √† jour</b> d'int√©grit√© correspond aux donn√©es √©crites dans HealthKit. <br><br>  Vous pouvez y ¬´ajouter¬ª tout ce que vous voulez.  Il s'agit g√©n√©ralement d'une description: ¬´Nous utiliserons vos informations de sant√© pour mieux suivre vos s√©ances d'entra√Ænement.¬ª <br><br>  N'oubliez pas que si ces cl√©s ne sont pas install√©es, l'application se bloque lorsque vous essayez de vous connecter √† HealthKit. <br><br><h3>  Autorisation HealthKit </h3><br>  Ouvrez le fichier <i>HealthKitSetupAssistant.swift</i> dans lequel se trouve la m√©thode de classe que vous utiliserez pour autoriser dans HealthKit. <br><br><pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">authorizeHealthKit</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">completion</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">escaping</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bool</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Error</span></span></span><span class="hljs-class">?) -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Swift</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">) </span></span>{ }</code> </pre> <br>  La m√©thode authorizeHealthKit (compl√©tement :) ne prend aucun param√®tre et a une <b>complication</b> qui renvoie un bool√©en ( <b>succ√®s</b> ou <b>√©chec</b> ) et une erreur facultative en cas de probl√®me.  Si des erreurs sont renvoy√©es, vous les transmettrez √† complition dans deux cas: <br><br><ol><li>  HealthKit peut ne pas √™tre disponible sur votre appareil.  Par exemple, si l'application s'ex√©cute sur un iPad. </li><li>  Certains types de donn√©es peuvent ne pas √™tre disponibles dans la version actuelle de HealthKit. </li></ol><br>  Brisons ce processus.  Pour autoriser HealthKit, la m√©thode <i>authorizeHealthKit (compl√©tement :)</i> doit effectuer les quatre √©tapes suivantes: <br><br><ol><li>  V√©rifiez si Healthkit est disponible sur cet appareil.  Si ce n'est pas le cas, renvoyez un √©chec et une erreur √† complition. </li><li>  Pr√©parez les types de donn√©es d'int√©grit√©.  Prancercise Tracker va lire et √©crire sur HealthKit. </li><li>  Organisez ces donn√©es dans une liste de types √† lire et de types √† √©crire. </li><li>  Demander une autorisation.  Si cette action r√©ussit, toutes les activit√©s √©taient correctes et termin√©es correctement. </li></ol><br><h3>  V√©rification de la disponibilit√© de HealthKit </h3><br>  Tout d'abord, vous devez v√©rifier la disponibilit√© de HealthKit sur l'appareil. <br>  Collez le code suivant au d√©but de la m√©thode <i>authorizeHealthKit (compl√©tement :)</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//1. ,      HealthKit guard HKHealthStore.isHealthDataAvailable() else { completion(false, HealthkitSetupError.notAvailableOnDevice) return }</span></span></code> </pre><br>  Vous interagirez tr√®s souvent avec <b>HKHealthStore</b> .  Il s'agit d'un r√©f√©rentiel central qui stocke les donn√©es de sant√© des utilisateurs.  La m√©thode <i>isHealthDataAvailable ()</i> vous aidera √† comprendre si la <i>machine</i> utilisateur actuelle prend en charge les donn√©es Heathkit. <br><br>  L'instruction guard emp√™che l'application d'ex√©cuter le reste de la m√©thode <i>authorizeHealthKit (compl√©tement :)</i> si HealthKit n'est pas disponible sur le p√©riph√©rique.  Lorsque cela se produit, le bloc d'ach√®vement est <b>appel√©</b> avec l'erreur <b>notAvailableOnDevice</b> .  Vous pouvez simplement le restituer √† la console ou au contr√¥leur principal pour traiter les √©tapes suppl√©mentaires en cas d'une telle erreur. <br><br><h3>  Pr√©paration des donn√©es </h3><br>  Une fois que vous savez que HealthKit est disponible sur l'appareil de l'utilisateur, il est temps de pr√©parer les types de donn√©es qui seront lues et √©crites dans HealthKit. <br>  HealthKit fonctionne avec le type <b>HKObjectType</b> .  Chaque type qui entre ou revient dans le r√©f√©rentiel central HealthKit est une sorte de <b>HKObjectType</b> .  Vous verrez √©galement HKSampleType et <b>HKWorkoutType</b> .  Les deux h√©ritent de <b>HKObjectType</b> , donc en gros c'est la m√™me chose. <br><br>  Collez l'extrait de code suivant imm√©diatement apr√®s le premier extrait de code: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//2.   ,     HealthKit guard let dateOfBirth = HKObjectType.characteristicType(forIdentifier: .dateOfBirth), let bloodType = HKObjectType.characteristicType(forIdentifier: .bloodType), let biologicalSex = HKObjectType.characteristicType(forIdentifier: .biologicalSex), let bodyMassIndex = HKObjectType.quantityType(forIdentifier: .bodyMassIndex), let height = HKObjectType.quantityType(forIdentifier: .height), let bodyMass = HKObjectType.quantityType(forIdentifier: .bodyMass), let activeEnergy = HKObjectType.quantityType(forIdentifier: .activeEnergyBurned) else { completion(false, HealthkitSetupError.dataTypeNotAvailable) return }</span></span></code> </pre><br>  Wow, c'est un grand <b>garde</b> !  Il s'agit √©galement d'un excellent exemple d'utilisation d'une seule protection pour r√©cup√©rer plusieurs options. <br><br>  Pour cr√©er un <b>HKObjectType</b> pour ces caract√©ristiques, vous devez utiliser <i>HKObjectType.characteristicType (forIdentifier :)</i> ou <i>HKObjectType.quantityType (forIdentifier :)</i> <br>  Les types de caract√©ristiques et les types de quantit√©s sont des √©num√©rations d√©finies par le cadre.  HealthKit d√©marre avec eux. <br><br>  Vous remarquerez √©galement que si une caract√©ristique ou un type de s√©lection n'est pas disponible, la m√©thode √©chouera.  C'est intentionnel.  Votre application doit toujours savoir exactement avec quels types de HealthKit elle peut fonctionner, le cas √©ch√©ant. <br><br><h3>  Pr√©paration d'une liste de types de donn√©es pour la lecture et l'√©criture </h3><br>  Il est maintenant temps de pr√©parer une liste de types de donn√©es pour la lecture et l'√©criture. <br>  Collez ce troisi√®me code dans la m√©thode <i>authorizeHealthKit (compl√©tement :)</i> imm√©diatement apr√®s la deuxi√®me partie: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//3.   ,  HealthKit     let healthKitTypesToWrite: Set&lt;HKSampleType&gt; = [bodyMassIndex, activeEnergy, HKObjectType.workoutType()] let healthKitTypesToRead: Set&lt;HKObjectType&gt; = [dateOfBirth, bloodType, biologicalSex, bodyMassIndex, height, bodyMass, HKObjectType.workoutType()]</span></span></code> </pre><br>  HealthKit attend un ensemble d'objets <b>HKSampleType</b> qui repr√©sentent les types de donn√©es que votre utilisateur peut √©crire, et attend √©galement qu'un ensemble d'objets HKObjectType soit affich√© pour votre application. <br><br>  <b>HKObjectType.workoutType ()</b> est un type sp√©cial de <b>HKObjectType</b> .  C'est n'importe quel entra√Ænement. <br><br><h3>  Autorisation HealthKit </h3><br>  La derni√®re partie est la plus simple.  Il vous suffit de demander l'autorisation √† HealthKit.  Collez ce dernier morceau de code: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//4.    HKHealthStore().requestAuthorization(toShare: healthKitTypesToWrite, read: healthKitTypesToRead) { (success, error) in completion(success, error) }</span></span></code> </pre><br>  Ce code demande l'autorisation √† HealthKit, puis appelle la fin.  Ils utilisent des variables pour les op√©rations r√©ussies et les erreurs transmises par la m√©thode <i>requestAuthorization (toShare: read: compl√©tement :) de HKHealthStore</i> . <br><br>  Vous pouvez le consid√©rer comme une redirection.  Au lieu de g√©rer l'ach√®vement dans HealthKitSetupAssistant, vous passez le paquet au contr√¥leur principal, qui peut afficher un avertissement ou entreprendre une autre action. <br><br>  Le projet poss√®de d√©j√† un bouton Authorize HealthKit et il appelle la m√©thode <i>authorizeHealthKit ()</i> dans MasterViewController.  C'est l'endroit id√©al pour appeler la m√©thode d'autorisation que nous venons d'√©crire. <br><br>  Ouvrez <b>MasterViewController.swift</b> , recherchez la m√©thode <i>authorizeHealthKit (</i> ) et collez ce code: <br><br><pre> <code class="swift hljs"><span class="hljs-type"><span class="hljs-type">HealthKitSetupAssistant</span></span>.authorizeHealthKit { (authorized, error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> authorized <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> baseMessage = <span class="hljs-string"><span class="hljs-string">"HealthKit Authorization Failed"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = error { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\(baseMessage). Reason: \(error.localizedDescription)"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(baseMessage) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"HealthKit Successfully Authorized."</span></span>) }</code> </pre><br>  Ce code utilise la m√©thode <i>authorizeHealthKit (compl√©tement :)</i> que vous venez d'impl√©menter.  Une fois termin√©, il affichera un message dans la console pour indiquer si l'autorisation a r√©ussi dans HealthKit. <br><br>  Lancez l'appli.  Cliquez sur Autoriser HealthKit dans la fen√™tre principale et vous verrez un √©cran d'autorisation contextuel: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ef/2bc/500/4ef2bc50015fda69b7d916b9231a5f1a.png" alt="image" width="281" height="500"></div><br>  Activez tous les commutateurs, faites d√©filer pour les voir tous et appuyez sur <b>Autoriser</b> .  Dans la console, vous devriez voir un message comme celui-ci: <br><br><pre> <code class="swift hljs"><span class="hljs-type"><span class="hljs-type">HealthKit</span></span> <span class="hljs-type"><span class="hljs-type">Successfully</span></span> <span class="hljs-type"><span class="hljs-type">Authorized</span></span>.</code> </pre><br>  <b>Super!</b>  L'application a acc√®s au r√©f√©rentiel central de HealthKit.  Il est maintenant temps de commencer √† suivre les articles. <br><br><h3>  Caract√©ristiques et √©chantillons </h3><br>  Dans cette section, vous apprendrez: <br><br><ul><li>  Comment lire les caract√©ristiques biologiques de votre utilisateur. </li><li>  Comment lire et √©crire diff√©rents types d'√©chantillons (poids, taille, etc.) </li></ul><br>  En r√®gle g√©n√©rale, les caract√©ristiques biologiques sont des types d'√©l√©ments qui ne changent pas, tout comme votre groupe sanguin.  Les √©chantillons sont des √©l√©ments qui changent fr√©quemment, comme le poids. <br><br>  Afin de suivre correctement l'efficacit√© du <b>mode d'</b> entra√Ænement <b>Prancercise</b> , l'application <b>Prancercise Tracker</b> doit recevoir un √©chantillon du poids et de la taille de l'utilisateur.  Ensemble, ces √©chantillons peuvent √™tre utilis√©s pour calculer l'indice de masse corporelle (IMC). <br><br>  <b>Remarque:</b> <i>L'indice de masse corporelle (IMC) est un indicateur largement utilis√© de la graisse corporelle et est calcul√© en fonction du poids et de la taille d'une personne.</i>  <i>D√©couvrez-en plus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .</i> <br><br><h3>  Sp√©cifications de lecture </h3><br>  Prancercise Tracker n'enregistre pas les caract√©ristiques biologiques.  Il les obtient de HealthKit.  Cela signifie que ces caract√©ristiques doivent d'abord √™tre stock√©es dans le r√©f√©rentiel central HeathKit. <br><br>  Si vous ne l'avez pas encore fait, il est temps d'en dire <b>un</b> peu plus sur <b>HeathKit</b> . <br><br>  Ouvrez l'application Sant√© sur votre appareil ou votre simulateur.  S√©lectionnez l'onglet Donn√©es de sant√©.  Cliquez ensuite sur l'ic√¥ne de profil dans le coin sup√©rieur droit pour afficher votre profil de sant√©.  Cliquez sur <b>Modifier</b> et entrez la date de naissance, le sexe et le groupe sanguin: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/324/285/ea4/324285ea449bb8049ff166c1e83ec76f.png" alt="image" width="1732" height="1540"></div><br>  Maintenant que <b>HealthKit</b> conna√Æt votre date de naissance, votre sexe et votre groupe sanguin, il est temps de lire ces fonctionnalit√©s dans <b>Prancercise Tracker</b> . <br><br>  Revenez √† <b>Xcode</b> et ouvrez <i>ProfileDataStore.swift</i> .  La classe <b>ProfileDataStore</b> repr√©sente votre point d'acc√®s √† toutes les donn√©es li√©es √† la sant√© de vos utilisateurs. <br><br>  Collez la m√©thode suivante dans <b>ProfileDataStore</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getAgeSexAndBloodType</span></span></span><span class="hljs-class">() </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">throws</span></span></span><span class="hljs-class"> -&gt; (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">age</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Int</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">biologicalSex</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKBiologicalSex</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bloodType</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKBloodType</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> healthKitStore = <span class="hljs-type"><span class="hljs-type">HKHealthStore</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-comment"><span class="hljs-comment">//1. This method throws an error if these data are not available. let birthdayComponents = try healthKitStore.dateOfBirthComponents() let biologicalSex = try healthKitStore.biologicalSex() let bloodType = try healthKitStore.bloodType() //2. Use Calendar to calculate age. let today = Date() let calendar = Calendar.current let todayDateComponents = calendar.dateComponents([.year], from: today) let thisYear = todayDateComponents.year! let age = thisYear - birthdayComponents.year! //3. Unwrap the wrappers to get the underlying enum values. let unwrappedBiologicalSex = biologicalSex.biologicalSex let unwrappedBloodType = bloodType.bloodType return (age, unwrappedBiologicalSex, unwrappedBloodType) } }</span></span></code> </pre><br>  La m√©thode <i>getAgeSexAndBloodType ()</i> appelle <b>HKHealthStore</b> , demandant la date de naissance, le sexe et le type de sang de l'utilisateur.  Il calcule √©galement l'√¢ge de l'utilisateur en utilisant la date de naissance. <br><br><ol><li>  Vous avez peut-√™tre remarqu√© que cette m√©thode peut provoquer une erreur.  Cela se produit chaque fois qu'une date de naissance, un sexe ou un groupe sanguin n'a pas √©t√© enregistr√© dans le r√©f√©rentiel central HealthKit.  Comme vous venez de saisir ces informations dans votre application, vous ne devez pas provoquer d'erreurs. </li><li>  √Ä l'aide de la classe <b>Calendar</b> , vous pouvez convertir n'importe quelle date en un ensemble de <b>composants</b> de <b>date</b> .  C'est vraiment pratique lorsque vous voulez avoir un an pour un rendez-vous.  Ce code obtient simplement votre ann√©e de naissance, l'ann√©e en cours, puis calcule la diff√©rence. </li><li>  Les variables ¬´d√©velopp√©es¬ª sont nomm√©es de telle mani√®re qu'il est clair que vous devez acc√©der √† l'√©num√©ration de base √† partir de la classe wrapper ( <b>HKBiologicalSexObject</b> et <b>HKBloodTypeObject</b> ). </li></ol><br><h3>  Mise √† jour de l'interface utilisateur </h3><br>  Si vous compilez et ex√©cutez maintenant l'application, vous ne verrez aucune modification dans l'interface utilisateur, car vous n'y avez pas encore connect√© cette logique. <br>  Ouvrez <b>ProfileViewController.swif</b> t et recherchez la m√©thode <i>loadAndDisplayAgeSexAndBloodType (</i> ) <br><br>  Cette m√©thode utilisera votre <b>ProfileDataStore</b> pour charger des caract√©ristiques biologiques dans l'interface utilisateur. <br><br>  Collez le code suivant dans la m√©thode <i>loadAndDisplayAgeSexAndBloodType ()</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> userAgeSexAndBloodType = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.getAgeSexAndBloodType() userHealthProfile.age = userAgeSexAndBloodType.age userHealthProfile.biologicalSex = userAgeSexAndBloodType.biologicalSex userHealthProfile.bloodType = userAgeSexAndBloodType.bloodType updateLabels() } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: error) }</code> </pre><br>  Ce bloc de code charge l'√¢ge, le sexe et le groupe sanguin en tant que tuple.  Il d√©finit ensuite ces champs dans l'instance locale du mod√®le UserHealthProfile.  Enfin, il met √† jour l'interface utilisateur avec les nouveaux champs de <b>UserHealthProfile</b> en appelant la m√©thode <i>updateLabels ()</i> . <br><br>  √âtant donn√© que la <i>m√©thode</i> <b>ProfileDataStore</b> <i>getAgeSexAndBloodType ()</i> peut <b>g√©n√©rer</b> une erreur, <b>ProfileViewController</b> doit la g√©rer.  Dans ce cas, vous prenez simplement l'erreur et la pr√©sentez comme un avertissement. <br><br>  Tout cela est super, mais il y a un hic.  La m√©thode <i>updateLabels () ne</i> fait encore rien.  Ceci est juste une annonce vierge.  Cette fois, passons √† l'interface utilisateur. <br><br>  Recherchez la m√©thode <i>updateLabels ()</i> et collez-y ce code: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> age = userHealthProfile.age { ageLabel.text = <span class="hljs-string"><span class="hljs-string">"\(age)"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> biologicalSex = userHealthProfile.biologicalSex { biologicalSexLabel.text = biologicalSex.stringRepresentation } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bloodType = userHealthProfile.bloodType { bloodTypeLabel.text = bloodType.stringRepresentation }</code> </pre><br>  Le code est assez simple.  Si l'utilisateur a d√©fini l'√¢ge, il sera format√© dans une √©tiquette.  Il en va de m√™me pour le sexe biologique et le groupe sanguin.  La variable stringRepresentation convertit l'√©num√©ration en cha√Æne √† des fins d'affichage. <br><br>  Compilez et ex√©cutez l'application.  Acc√©dez √† l'√©cran Profil et IMC.  Cliquez sur le bouton Lire les donn√©es HealthKit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e13/3a5/ed1/e133a5ed1cd1d13016f28cc1a3452af9.png" alt="image" width="281" height="500"></div><br>  Si vous avez d√©j√† entr√© vos informations dans l'application, elles devraient appara√Ætre dans les raccourcis de cet √©cran.  Si vous ne l'avez pas encore fait, un message d'erreur appara√Ætra. <br><br>  Ouah!  Vous lisez et affichez des donn√©es directement √† partir de <b>HealthKit</b> . <br><br><h3>  √âchantillons de requ√™te </h3><br>  Il est maintenant temps de lire le poids et la taille de l'utilisateur.  Ils seront utilis√©s pour calculer et afficher l'IMC dans la vue de profil. <br><br>  Les caract√©ristiques biologiques sont facilement disponibles car elles ne changent presque jamais.  Les √©chantillons n√©cessitent une approche beaucoup plus complexe.  Ils utilisent <b>HKQuery</b> , plus pr√©cis√©ment <b>HKSampleQuery</b> . <br><br>  Pour demander des √©chantillons √† HealthKit, vous aurez besoin de: <br><br><ol><li>  Pr√©cisez le type d'√©chantillon que vous souhaitez demander (poids, taille, etc.), </li><li>  Quelques options suppl√©mentaires qui aident √† filtrer et √† trier les donn√©es.  Pour ce faire, vous pouvez passer un <b>NSPredicate</b> facultatif ou un tableau de <b>NSSortDescriptors</b> . </li></ol><br>  <b>Remarque:</b> <i>Si vous connaissez CoreData, vous avez probablement remarqu√© quelques similitudes.</i>  <i><b>HKSampleQuery est</b> tr√®s similaire √† <b>NSFetchedRequest</b> pour un type d'objet, o√π vous sp√©cifiez les descripteurs de pr√©dicat et de tri, puis sp√©cifiez le contexte de l'objet pour ex√©cuter la requ√™te pour obtenir les r√©sultats.</i> <br><br>  Une fois votre requ√™te configur√©e, il vous suffit d'appeler la <b>m√©thode</b> <i>HKHealthStore ExecuteQuery ()</i> pour obtenir les r√©sultats. <br><br>  Pour <b>Prancercise Tracker,</b> vous allez cr√©er une fonction unique et universelle qui t√©l√©charge les derniers √©chantillons de tout type.  Ainsi, vous pouvez l'utiliser √† la fois pour le poids et la taille. <br><br>  Ouvrez <b>ProfileDataStore.swift</b> et collez la m√©thode suivante dans la classe, juste en dessous de la m√©thode <i>getAgeSexAndBloodType ()</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getMostRecentSample</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sampleType</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKSampleType</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">completion</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">escaping</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HKQuantitySample</span></span></span><span class="hljs-class">?, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Error</span></span></span><span class="hljs-class">?) -&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Swift</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Void</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1.  HKQuery    . let mostRecentPredicate = HKQuery.predicateForSamples(withStart: Date.distantPast, end: Date(), options: .strictEndDate) let sortDescriptor = NSSortDescriptor(key: HKSampleSortIdentifierStartDate, ascending: false) let limit = 1 let sampleQuery = HKSampleQuery(sampleType: sampleType, predicate: mostRecentPredicate, limit: limit, sortDescriptors: [sortDescriptor]) { (query, samples, error) in //2.       . DispatchQueue.main.async { guard let samples = samples, let mostRecentSample = samples.first as? HKQuantitySample else { completion(nil, error) return } completion(mostRecentSample, nil) } } HKHealthStore().execute(sampleQuery) }</span></span></code> </pre><br>  Cette m√©thode utilise le type d'√©chantillon (taille, poids, IMC, etc.).  Il cr√©e ensuite une requ√™te pour r√©cup√©rer le dernier √©chantillon de ce type.  Si vous passez par le type d'√©chantillon pour la croissance, vous reviendrez √† votre dernier record de croissance. <br><br>  Il se passe beaucoup de choses ici.  Je vais m'arr√™ter pour expliquer quelques choses. <br><br><ol><li>  Il existe plusieurs m√©thodes dans <b>HKQuery</b> qui peuvent vous aider √† filtrer vos exemples de requ√™te HealthKit.  Dans ce cas, nous utilisons le pr√©dicat de date int√©gr√©. </li><li>  La demande d'√©chantillons √† HealthKit est un processus asynchrone.  C'est pourquoi le code du gestionnaire d'ach√®vement se trouve √† l'int√©rieur du bloc Dispatch.  La conformit√© est requise sur le fil principal.  Sinon, l'application √©chouera. </li></ol><br>  Si tout se passe bien, votre demande sera ex√©cut√©e et vous obtiendrez un √©chantillon soign√© retourn√© sur le thread <b>principal</b> , o√π le <b>ProfileViewController</b> peut mettre son contenu dans l'√©tiquette.  Faisons cette partie maintenant. <br><br><h3>  Affichage d'√©chantillons dans l'interface utilisateur </h3><br>  Dans la section pr√©c√©dente, vous avez t√©l√©charg√© des donn√©es depuis <b>HealthKit</b> .  Enregistrez-les en tant que mod√®le dans <b>ProfileViewController</b> , puis mettez √† jour le contenu en lignes √† l'aide de la <b>m√©thode</b> <i>ProfileViewController updateLabels ()</i> <br><br>  Tout ce que vous avez √† faire est d'√©tendre ce processus en ajoutant une fonction qui charge les exemples, les traite pour l'interface utilisateur, puis appelle <i>updateLabels ()</i> pour remplir les √©tiquettes avec du texte. <br><br>  Ouvrez le fichier <b>ProfileViewController.swift</b> , recherchez la m√©thode <i>loadAndDisplayMostRecentHeight (</i> ) et collez le code suivant: <br><br><pre> <code class="swift hljs"><span class="hljs-comment"><span class="hljs-comment">//1.  HealthKit      guard let heightSampleType = HKSampleType.quantityType(forIdentifier: .height) else { print("Height Sample Type is no longer available in HealthKit") return } ProfileDataStore.getMostRecentSample(for: heightSampleType) { (sample, error) in guard let sample = sample else { if let error = error { self.displayAlert(for: error) } return } //2.     ,   , //    . let heightInMeters = sample.quantity.doubleValue(for: HKUnit.meter()) self.userHealthProfile.heightInMeters = heightInMeters self.updateLabels() }</span></span></code> </pre><br><ol><li>  Cette m√©thode commence par cr√©er un type d'√©chantillon de croissance.  Il transmet ensuite ce type d'√©chantillon √† la m√©thode que vous venez d'√©crire, qui renverra l'√©chantillon de croissance d'utilisateurs le plus r√©cent enregistr√© dans HealthKit. </li><li>  D√®s que l'√©chantillon revient, la croissance est convertie en m√®tres et stock√©e dans le mod√®le UserHealthProfile.  L' <b>interface utilisateur</b> sera alors mise √† jour. </li></ol><br>  <b>Remarque:</b> <i>vous souhaitez g√©n√©ralement convertir un √©chantillon de quantit√© en unit√© standard.</i>  <i>Pour ce faire, le code ci-dessus utilise la <i>m√©thode doubleValue (for :)</i> , qui vous permet de <b>transmettre</b> les donn√©es pertinentes dont vous avez besoin (dans ce cas, les compteurs) √† <b>HKUnit</b> .</i> <i><br><br></i>  <i>Vous pouvez cr√©er diff√©rents types de <b>HKUnits en</b> utilisant certaines des m√©thodes de classe courantes disponibles via <b>HealthKit</b> .</i>  <i>Pour obtenir des compteurs, vous pouvez simplement utiliser la m√©thode meter () dans <b>HKUnit</b> , et ce sera ce dont vous avez besoin.</i> <br><br>  Avec une croissance r√©gl√©e.  Et le poids?  Tout est assez similaire, mais vous devrez remplir la m√©thode <i>loadAndDisplayMostRecentWeight ()</i> dans <b>ProfileViewController</b> . <br><br>  Collez le code suivant dans la m√©thode <i>loadAndDisplayMostRecentWeight ()</i> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightSampleType = <span class="hljs-type"><span class="hljs-type">HKSampleType</span></span>.quantityType(forIdentifier: .bodyMass) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Body Mass Sample Type is no longer available in HealthKit"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.getMostRecentSample(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: weightSampleType) { (sample, error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sample = sample <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = error { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: error) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightInKilograms = sample.quantity.doubleValue(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: <span class="hljs-type"><span class="hljs-type">HKUnit</span></span>.gramUnit(with: .kilo)) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.userHealthProfile.weightInKilograms = weightInKilograms <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.updateLabels() }</code> </pre><br>  Vous cr√©ez le type d'√©chantillon que vous souhaitez recevoir, demandez <b>HealthKit</b> pour cela, effectuez quelques conversions d'unit√©s, enregistrez-le dans votre mod√®le et mettez √† jour l'interface utilisateur. <br><br>  Pour le moment, cela peut montrer que le travail est fait, mais il y a autre chose.  La fonction <i>updateLabels ()</i> n'a pas connaissance des nouvelles donn√©es que vous avez mises √† sa disposition. <br><br>  Corrigeons-le. <br><br>  Ajoutez les lignes suivantes √† la fonction <i>updateLabels ()</i> , juste en dessous de la partie o√π vous d√©veloppez le groupe sanguin pour l'afficher sur l'interface utilisateur: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weight = userHealthProfile.weightInKilograms { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightFormatter = <span class="hljs-type"><span class="hljs-type">MassFormatter</span></span>() weightFormatter.isForPersonMassUse = <span class="hljs-literal"><span class="hljs-literal">true</span></span> weightLabel.text = weightFormatter.string(fromKilograms: weight) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> height = userHealthProfile.heightInMeters { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> heightFormatter = <span class="hljs-type"><span class="hljs-type">LengthFormatter</span></span>() heightFormatter.isForPersonHeightUse = <span class="hljs-literal"><span class="hljs-literal">true</span></span> heightLabel.text = heightFormatter.string(fromMeters: height) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bodyMassIndex = userHealthProfile.bodyMassIndex { bodyMassIndexLabel.text = <span class="hljs-type"><span class="hljs-type">String</span></span>(format: <span class="hljs-string"><span class="hljs-string">"%.02f"</span></span>, bodyMassIndex) }</code> </pre><br>  En suivant le mod√®le d'origine dans la fonction <i>updateLabels ()</i> , il √©tend la taille, le poids et l'indice de masse corporelle dans votre mod√®le <b>UserHealthProfile</b> .  S'ils sont disponibles, ils g√©n√®rent les lignes appropri√©es et les affectent √† des √©tiquettes sur l'√©cran de l'utilisateur. <br><br>  <b>MassFormatter</b> et <b>LengthFormatter</b> effectuent le travail de conversion de vos valeurs en cha√Ænes. <br><br>  L'indice de masse corporelle n'est pas r√©ellement stock√© dans le mod√®le <b>UserHealthProfile</b> .  Il s'agit d'une propri√©t√© calcul√©e qui effectue le calcul pour vous. <br><br>  Cliquez sur la propri√©t√© <b>bodyMassIndex</b> et vous verrez ce que je veux dire: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bodyMassIndex: <span class="hljs-type"><span class="hljs-type">Double?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> weightInKilograms = weightInKilograms, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> heightInMeters = heightInMeters, heightInMeters &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (weightInKilograms/(heightInMeters*heightInMeters)) }</code> </pre><br>  L'indice de masse corporelle est une propri√©t√© facultative, c'est-√†-dire qu'il peut retourner nil si vous n'avez sp√©cifi√© ni la taille ni le poids (ou s'ils sont d√©finis sur un nombre qui n'a aucun sens).  Le calcul r√©el est simplement le poids divis√© par la taille au carr√©. <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque: </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous vous </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plongerez bient√¥t</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans tout cela si vous n'avez pas ajout√© de donn√©es √† </font><b><font style="vertical-align: inherit;">HealthKit</font></b><font style="vertical-align: inherit;"> pour les lire par l'application. Si vous ne l'avez pas d√©j√† fait, vous devez au moins cr√©er des √©chantillons de taille et de poids. </font></font></i> <br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez l'application Sant√© et acc√©dez √† l'onglet Donn√©es de sant√©. L√†, s√©lectionnez le param√®tre Body Measurements, puis s√©lectionnez Weight puis Add Data Point pour ajouter un nouvel √©chantillon de poids. R√©p√©tez le processus de croissance.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √Ä ce stade, le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prancercise Tracker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devrait √™tre en mesure de lire un √©chantillon r√©cent du poids et de la taille de votre utilisateur, puis de l'afficher dans le texte. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compilez et ex√©cutez les applications. Acc√©dez √† </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profile &amp; BMI</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Cliquez ensuite sur le bouton </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lire les donn√©es HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/841/d4d/35d/841d4d35d54528b5578fe32a3b163c0a.png" alt="image" width="281" height="500"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">G√©nial! </font><font style="vertical-align: inherit;">Vous venez de lire vos premiers √©chantillons du r√©f√©rentiel </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et de les utiliser pour calculer l'IMC.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enregistrement d'√©chantillons </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prancercise Tracker</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ont d√©j√† un indice de masse corporelle de la </font><font style="vertical-align: inherit;">calculatrice √† </font><font style="vertical-align: inherit;">port√©e de </font><font style="vertical-align: inherit;">main. </font><font style="vertical-align: inherit;">Utilisons-le pour enregistrer l'√©chantillon d'IMC de votre utilisateur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProfileDataStore.swift</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et ajoutez la m√©thode suivante:</font></font><br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">func</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">saveBodyMassIndexSample</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bodyMassIndex</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Double</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">date</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Date</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//1. ,      guard let bodyMassIndexType = HKQuantityType.quantityType(forIdentifier: .bodyMassIndex) else { fatalError("Body Mass Index Type is no longer available in HealthKit") } //2.   HKUnit     let bodyMassQuantity = HKQuantity(unit: HKUnit.count(), doubleValue: bodyMassIndex) let bodyMassIndexSample = HKQuantitySample(type: bodyMassIndexType, quantity: bodyMassQuantity, start: date, end: date) //3.      HealthKit HKHealthStore().save(bodyMassIndexSample) { (success, error) in if let error = error { print("Error Saving BMI Sample: \(error.localizedDescription)") } else { print("Successfully saved BMI Sample") } } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme pour les autres types d'√©chantillons, vous devez d'abord vous assurer que le type d'√©chantillon est disponible dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, le code v√©rifie s'il existe un </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">type de quantit√©</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour l'indice de masse corporelle. </font><font style="vertical-align: inherit;">Si c'est le cas, il est utilis√© pour cr√©er un √©chantillon de quantit√©. </font><font style="vertical-align: inherit;">Sinon, l'application cesse de fonctionner.</font></font></li><li>  <i>count()</i>  <b>HKUnit</b>    ,       ,   .  -      ,    ,           . </li><li> <b>HKHealthStore</b>     ,        .      ,        . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Presque termin√©. Pour r√©sumer l'interface utilisateur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProfileViewController.swif</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , recherchez la m√©thode </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saveBodyMassIndexToHealthKit (</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). Cette m√©thode est appel√©e lorsque l'utilisateur clique sur le bouton Enregistrer l'IMC dans le tableau. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Collez le code suivant dans la m√©thode:</font></font><br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bodyMassIndex = userHealthProfile.bodyMassIndex <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { displayAlert(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: <span class="hljs-type"><span class="hljs-type">ProfileDataError</span></span>.missingBodyMassIndex) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-type"><span class="hljs-type">ProfileDataStore</span></span>.saveBodyMassIndexSample(bodyMassIndex: bodyMassIndex, date: <span class="hljs-type"><span class="hljs-type">Date</span></span>())</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous vous souvenez que l'indice de masse corporelle est une propri√©t√© calcul√©e qui renvoie une valeur lorsque des √©chantillons de taille et de poids sont charg√©s √† partir de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HealthKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ce code essaie de calculer cette propri√©t√© et, si possible, il sera transmis √† la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©thode saveBodyMassIndexSample (bodyMassIndex: date :) que</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous venez d'√©crire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il affiche √©galement une alerte pratique si l'indice de masse corporelle ne peut pas √™tre calcul√© pour une raison quelconque. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compilez et ex√©cutez l'application. Acc√©dez √† l'√©cran </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Profil et IMC</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . T√©l√©chargez les donn√©es de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HeathKit</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , puis cliquez sur le bouton Enregistrer l'IMC. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regardez la console. Le voyez-vous?</font></font><br><br><pre> <code class="swift hljs">   <span class="hljs-type"><span class="hljs-type">BMI</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si oui, f√©licitations! </font><font style="vertical-align: inherit;">Votre √©chantillon d'IMC est maintenant stock√© dans le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r√©f√©rentiel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> central </font><b><font style="vertical-align: inherit;">HealthKit</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Voyons voir si nous pouvons le trouver. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ouvrez l'application Sant√©, appuyez sur l'onglet Donn√©es de sant√©, cliquez sur Mesures corporelles dans la vue tabulaire, puis cliquez sur Indice de masse corporelle.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/953/802/724/953802724c0ccad14b5184bd8b01b17f.png" alt="image" width="281" height="500"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr434978/">https://habr.com/ru/post/fr434978/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr434968/index.html">Quelque chose √† propos de l'espace de noms</a></li>
<li><a href="../fr434970/index.html">√Ä propos de l'informatique et plus</a></li>
<li><a href="../fr434972/index.html">Comment √©crire des tests unitaires si vous n'en avez pas envie du tout</a></li>
<li><a href="../fr434974/index.html">Travailler avec un format de configurations 1C: Enterprise</a></li>
<li><a href="../fr434976/index.html">ITAB University Fablab: DIY-coworking pour les cr√©atifs - montrer ce qu'il y a √† l'int√©rieur</a></li>
<li><a href="../hi432402/index.html">‡§Ö‡§∞‡•á ‡§è‡§ö‡§Ü‡§∞, ‡§Æ‡•á‡§∞‡•Ä ‡§∏‡•ç‡§Æ‡§æ‡§∞‡§ø‡§ï‡§æ ‡§ï‡§π‡§æ‡§Å ‡§π‡•à?</a></li>
<li><a href="../hi432404/index.html">‡§≤‡§ø‡§®‡§ï‡•ç‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡•à‡§ï‡§Ö‡§™ ‡§™‡§§‡•ç‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§≤‡§ø‡§ñ‡§§‡§æ ‡§π‡•à</a></li>
<li><a href="../hi432408/index.html">‡§´‡§ø‡§®‡§ü‡•á‡§ï ‡§°‡§æ‡§á‡§ú‡•á‡§∏‡•ç‡§ü: ‡§µ‡•Ä‡§ú‡§º‡§æ ‡§î‡§∞ ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞‡§ï‡§æ‡§∞‡•ç‡§°, ‡§è‡§ï ‡§™‡•á‡§Ç‡§∂‡§® ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞ ‡§î‡§∞ ‡§® ‡§ï‡•á‡§µ‡§≤ ‡§∏‡•á ‡§õ‡•ã‡§ü‡•á ‡§¨‡•à‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡•ã ‡§°‡§ø‡§∏‡•ç‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä</a></li>
<li><a href="../hi432410/index.html">‡§°‡•Ä‡§°‡•Ä‡§°‡•Ä ‡§∂‡•à‡§≤‡•Ä ‡§è‡§Ç‡§ü‡§ø‡§ü‡•Ä ‡§´‡•ç‡§∞‡•á‡§Æ‡§µ‡§∞‡•ç‡§ï ‡§ï‡•ã‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ‡§ì‡§Ç</a></li>
<li><a href="../hi432412/index.html">Highload ++: ‡§à‡§Ü‡§∞‡§™‡•Ä ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§ï‡•ã ‡§™‡•ç‡§∞‡§§‡§ø ‡§∏‡•á‡§ï‡§Ç‡§° 500,000 ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§æ‡§Æ‡§®‡§æ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>