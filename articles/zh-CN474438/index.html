<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸš³ â—½ï¸ ğŸ“¿ ç®€å•ï¼Œä½¿ç”¨C ++ã€‚ Userver Basics-ç”¨äºç¼–å†™å¼‚æ­¥å¾®æœåŠ¡çš„æ¡†æ¶ ğŸŒ€ ğŸŒ¼ ğŸ”§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Yandex.TaxiåšæŒå¾®æœåŠ¡æ¶æ„ã€‚ éšç€å¾®æœåŠ¡æ•°é‡çš„å¢åŠ ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°å¼€å‘äººå‘˜å°†å¤§é‡æ—¶é—´èŠ±åœ¨æ ·æ¿å’Œå…¸å‹é—®é¢˜ä¸Šï¼Œè€Œè§£å†³æ–¹æ¡ˆå¹¶ä¸æ€»æ˜¯èƒ½è¾¾åˆ°æœ€ä½³æ•ˆæœã€‚ 

 æˆ‘ä»¬å†³å®šä½¿ç”¨C ++ 17å’Œåç¨‹åˆ›å»ºè‡ªå·±çš„æ¡†æ¶ã€‚ è¿™æ˜¯å…¸å‹çš„å¾®æœåŠ¡ä»£ç ç°åœ¨çš„å¤–è§‚ï¼š 



Response View::Handle(Reque...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ç®€å•ï¼Œä½¿ç”¨C ++ã€‚ Userver Basics-ç”¨äºç¼–å†™å¼‚æ­¥å¾®æœåŠ¡çš„æ¡†æ¶</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/474438/">  Yandex.TaxiåšæŒå¾®æœåŠ¡æ¶æ„ã€‚ éšç€å¾®æœåŠ¡æ•°é‡çš„å¢åŠ ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°å¼€å‘äººå‘˜å°†å¤§é‡æ—¶é—´èŠ±åœ¨æ ·æ¿å’Œå…¸å‹é—®é¢˜ä¸Šï¼Œè€Œè§£å†³æ–¹æ¡ˆå¹¶ä¸æ€»æ˜¯èƒ½è¾¾åˆ°æœ€ä½³æ•ˆæœã€‚ <br><br> æˆ‘ä»¬å†³å®šä½¿ç”¨C ++ 17å’Œåç¨‹åˆ›å»ºè‡ªå·±çš„æ¡†æ¶ã€‚ è¿™æ˜¯å…¸å‹çš„å¾®æœåŠ¡ä»£ç ç°åœ¨çš„å¤–è§‚ï¼š <br><br><pre><code class="cpp hljs">Response View::Handle(Request&amp;&amp; request, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Dependencies&amp; dependencies) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> cluster = dependencies.pg-&gt;GetCluster(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> trx = cluster-&gt;Begin(storages::postgres::ClusterHostType::kMaster); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* statement = <span class="hljs-string"><span class="hljs-string">"SELECT ok, baz FROM some WHERE id = $1 LIMIT 1"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> row = psql::Execute(trx, statement, request.id)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!row[<span class="hljs-string"><span class="hljs-string">"ok"</span></span>].As&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;()) { LOG_DEBUG() &lt;&lt; request.id &lt;&lt; <span class="hljs-string"><span class="hljs-string">" is not OK of "</span></span> &lt;&lt; GetSomeInfoFromDb(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response400(); } psql::Execute(trx, queries::kUpdateRules, request.foo, request.bar); trx.Commit(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response200{row[<span class="hljs-string"><span class="hljs-string">"baz"</span></span>].As&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;()}; }</code> </pre> <br> è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒéå¸¸æœ‰æ•ˆå’Œå¿«é€Ÿçš„åŸå› -æˆ‘ä»¬å°†åœ¨å‰Šå‡ä¸­å‘Šè¯‰æ‚¨ã€‚ <br><a name="habracut"></a><br><h2>  Userver-å¼‚æ­¥ </h2><br> æˆ‘ä»¬çš„å›¢é˜Ÿä¸ä»…ç”±ç»éªŒä¸°å¯Œçš„C ++å¼€å‘äººå‘˜ç»„æˆï¼šè¿˜æœ‰å—è®­äººå‘˜ï¼Œåˆçº§å¼€å‘äººå‘˜ï¼Œç”šè‡³æ˜¯ä¸ä¹ æƒ¯ä½¿ç”¨C ++ç¼–å†™çš„äººå‘˜ã€‚ å› æ­¤ï¼Œç”¨æˆ·è®¾è®¡åŸºäºæ˜“ç”¨æ€§ã€‚ ä½†æ˜¯ï¼Œå‡­å€Ÿæˆ‘ä»¬çš„æ•°æ®é‡å’Œè´Ÿè½½ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•æ‰¿å—æ— æ•ˆç‡åœ°æµªè´¹é“èµ„æºçš„è´Ÿæ‹…ã€‚ <br><br> å¾®æœåŠ¡çš„ç‰¹å¾åœ¨äºå¯¹è¾“å…¥/è¾“å‡ºçš„æœŸæœ›ï¼šå¾®æœåŠ¡çš„å“åº”é€šå¸¸ç”±å…¶ä»–å¾®æœåŠ¡å’Œæ•°æ®åº“çš„å‡ ç§å“åº”å½¢æˆã€‚ æœ‰æ•ˆçš„I / Oç­‰å¾…ä»»åŠ¡æ˜¯é€šè¿‡å¼‚æ­¥æ–¹æ³•å’Œå›è°ƒè§£å†³çš„ï¼šé€šè¿‡å¼‚æ­¥æ“ä½œï¼Œä¸éœ€è¦äº§ç”Ÿæ‰§è¡Œçº¿ç¨‹ï¼Œå› æ­¤ï¼Œåˆ‡æ¢æµç¨‹æ²¡æœ‰å¤§çš„å¼€é”€â€¦â€¦ä»…ä»£ç å¾ˆéš¾ç¼–å†™å’Œç»´æŠ¤ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> View::Handle(Request&amp;&amp; request, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Dependencies&amp; dependencies, Response response) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> cluster = dependencies.pg-&gt;GetCluster(); cluster-&gt;Begin(storages::postgres::ClusterHostType::kMaster, [request = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(request), response](<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; trx) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* statement = <span class="hljs-string"><span class="hljs-string">"SELECT ok, baz FROM some WHERE id = $1 LIMIT 1"</span></span>; psql::Execute(trx, statement, request.id, [request = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(request), response, trx = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(trx)](<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; res) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> row = res[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!row[<span class="hljs-string"><span class="hljs-string">"ok"</span></span>].As&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (LogDebug()) { GetSomeInfoFromDb([id = request.id](<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> info) { LOG_DEBUG() &lt;&lt; id &lt;&lt; <span class="hljs-string"><span class="hljs-string">" is not OK of "</span></span> &lt;&lt; info; }); } *response = Response400{}; } psql::Execute(trx, queries::kUpdateRules, request.foo, request.bar, [row = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(row), trx = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(trx), response]() { trx.Commit([row = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::move(row), response]() { *response = Response200{row[<span class="hljs-string"><span class="hljs-string">"baz"</span></span>].As&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;()}; }); }); }); }); }</code> </pre><br> åœ¨è¿™é‡Œï¼Œstackfull-åç¨‹è¿›è¡Œäº†æ•‘æ´ã€‚ æ¡†æ¶çš„ç”¨æˆ·è®¤ä¸ºä»–ç¼–å†™äº†é€šå¸¸çš„åŒæ­¥ä»£ç ï¼š <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> row = psql::Execute(trx, queries::kGetRules, request.id)[<span class="hljs-number"><span class="hljs-number">0</span></span>];</code> </pre><br> ä½†æ˜¯ï¼Œå¤§çº¦åœ¨å¼•æ“ç›–ä¸‹å‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š <br><br><ol><li> ç”ŸæˆTCPæ•°æ®åŒ…ï¼Œå¹¶å°†å…¶ä¸è¯·æ±‚ä¸€èµ·å‘é€åˆ°æ•°æ®åº“ï¼› </li><li> å½“å‰æ­£åœ¨è¿è¡ŒView :: Handleå‡½æ•°çš„åç¨‹çš„æ‰§è¡Œè¢«æŒ‚èµ·ï¼› </li><li> æˆ‘ä»¬å¯¹æ“ä½œç³»ç»Ÿçš„å†…æ ¸è¯´ï¼šâ€œä¸€æ—¦æ•°æ®åº“ä¸­æœ‰è¶³å¤Ÿçš„TCPæ•°æ®åŒ…ï¼Œå°±å°†æŒ‚èµ·çš„åç¨‹æ”¾å…¥å¾…æ‰§è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—ä¸­â€ï¼› </li><li> æ— éœ€ç­‰å¾…ä¸Šä¸€æ­¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨å¦ä¸€ä¸ªåç¨‹å¹¶å‡†å¤‡ä»é˜Ÿåˆ—ä¸­æ‰§è¡Œã€‚ </li></ol><br> æ¢å¥è¯è¯´ï¼Œç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­çš„å‡½æ•°æ˜¯å¼‚æ­¥å·¥ä½œçš„ï¼Œå¹¶ä¸”ä½¿ç”¨C ++ 20 Coroutinesæ¥è¿‘äºè¿™æ ·çš„ä»£ç ï¼š <br><br><pre> <code class="cpp hljs">Response View::Handle(Request&amp;&amp; request, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Dependencies&amp; dependencies) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> cluster = dependencies.pg-&gt;GetCluster(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> trx = co_await cluster-&gt;Begin(storages::postgres::ClusterHostType::kMaster); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* statement = <span class="hljs-string"><span class="hljs-string">"SELECT ok, baz FROM some WHERE id = $1 LIMIT 1"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> row = co_await psql::Execute(trx, statement, request.id)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!row[<span class="hljs-string"><span class="hljs-string">"ok"</span></span>].As&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;()) { LOG_DEBUG() &lt;&lt; request.id &lt;&lt; <span class="hljs-string"><span class="hljs-string">" is not OK of "</span></span> &lt;&lt; <span class="hljs-function"><span class="hljs-function">co_await </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSomeInfoFromDb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; co_return Response400{<span class="hljs-string"><span class="hljs-string">"NOT_OK"</span></span>, <span class="hljs-string"><span class="hljs-string">"Please provide different ID"</span></span>}; } co_await psql::Execute(trx, queries::kUpdateRules, request.foo, request.bar); co_await trx.Commit(); co_return Response200{row[<span class="hljs-string"><span class="hljs-string">"baz"</span></span>].As&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;()}; }</code> </pre><br> åªæ˜¯ç”¨æˆ·ä¸éœ€è¦è€ƒè™‘co_awaitå’Œco_returnï¼Œä¸€åˆ‡éƒ½â€œç‹¬ç«‹â€è¿›è¡Œã€‚ <br><br> åœ¨æˆ‘ä»¬çš„æ¡†æ¶ä¸­ï¼Œåç¨‹ä¹‹é—´çš„åˆ‡æ¢æ¯”è°ƒç”¨std :: this_thread :: yieldï¼ˆï¼‰æ›´å¿«ã€‚ æ•´ä¸ªå¾®æœåŠ¡èŠ±è´¹å¾ˆå°‘çš„çº¿ç¨‹ã€‚ <br><br> ç›®å‰ï¼ŒuserveråŒ…å«å¼‚æ­¥é©±åŠ¨ç¨‹åºï¼š <br>  *ç”¨äºOSæ’æ§½ï¼› <br>  * httpå’Œhttpsï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼‰ï¼› <br>  * PostgreSQL; <br>  * MongoDB; <br>  * Redis; <br>  *å¤„ç†æ–‡ä»¶ï¼› <br>  *è®¡æ—¶å™¨ï¼› <br>  *åŸè¯­ä»¥åŒæ­¥å¹¶å¯åŠ¨æ–°çš„åç¨‹ã€‚ <br><br> ä¸Šé¢çš„å¼‚æ­¥æ–¹æ³•è§£å†³äº†I / Oç»‘å®šä»»åŠ¡ï¼Œè¿™å¯¹Goå¼€å‘äººå‘˜åº”è¯¥å¾ˆç†Ÿæ‚‰ã€‚ ä½†æ˜¯ï¼Œä¸Goä¸åŒï¼Œæˆ‘ä»¬ä¸ä¼šä»åƒåœ¾æ”¶é›†å™¨ä¸­è·å¾—å†…å­˜å’ŒCPUçš„å¼€é”€ã€‚ å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨å…·æœ‰å„ç§å®¹å™¨å’Œé«˜æ€§èƒ½åº“çš„ä¸°å¯Œè¯­è¨€ï¼Œè€Œä¸ä¼šé­å—ç¼ºä¹ä¸€è‡´æ€§ï¼ŒRAIIæˆ–æ¨¡æ¿çš„å›°æ‰°ã€‚ <br><br><h2>  Userver-ç»„ä»¶ </h2><br> å½“ç„¶ï¼Œä¸€ä¸ªå®Œæ•´çš„æ¡†æ¶ä¸ä»…æ˜¯åç¨‹ã€‚ å‡ºç§Ÿè½¦ä¸­çš„å¼€å‘äººå‘˜çš„ä»»åŠ¡æä¸ºå¤šæ ·åŒ–ï¼Œæ¯ä¸ªå¼€å‘äººå‘˜éƒ½éœ€è¦ä¸€å¥—è‡ªå·±çš„å·¥å…·æ¥è§£å†³ã€‚ å› æ­¤ï¼Œuserverå…·æœ‰æ‚¨éœ€è¦çš„ä¸€åˆ‡ï¼š <br>  *ç”¨äºè®°å½•ï¼› <br>  *ç¼“å­˜ï¼› <br>  *å¤„ç†å„ç§æ•°æ®æ ¼å¼ï¼› <br>  *ä½¿ç”¨é…ç½®å¹¶æ›´æ–°é…ç½®ï¼Œè€Œæ— éœ€é‡æ–°å¯åŠ¨æœåŠ¡ï¼› <br>  *åˆ†å¸ƒå¼é”ï¼› <br>  *æµ‹è¯•ï¼› <br>  *æˆæƒå’Œè®¤è¯ï¼› <br>  *åˆ›å»ºå’Œå‘é€æŒ‡æ ‡ï¼› <br>  *ç¼–å†™RESTå¤„ç†ç¨‹åºï¼› <br>  +ä»£ç ç”Ÿæˆå’Œä¾èµ–å…³ç³»æ”¯æŒï¼ˆåœ¨æ¡†æ¶çš„å•ç‹¬éƒ¨åˆ†ä¸­å®Œæˆï¼‰ã€‚ <br><br><h2>  Userver-ä»£ç ç”Ÿæˆ </h2><br> è®©æˆ‘ä»¬å›åˆ°ç¤ºä¾‹çš„ç¬¬ä¸€è¡Œï¼Œçœ‹çœ‹Responseå’ŒRequeståé¢éšè—äº†ä»€ä¹ˆï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Response </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request&amp;&amp; request, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Dependencies&amp; dependencies)</span></span></span></span>;</code> </pre><br> ä½¿ç”¨userverå¯ä»¥ç¼–å†™ä»»ä½•å¾®æœåŠ¡ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬çš„å¾®æœåŠ¡ï¼Œè¦æ±‚å¿…é¡»è®°å½•å…¶APIï¼ˆé€šè¿‡å¤§æ‘‡å¤§æ‘†çš„æ–¹æ¡ˆè¿›è¡Œæè¿°ï¼‰ã€‚ <br><br> ä¾‹å¦‚ï¼Œå¯¹äºç¤ºä¾‹ä¸­çš„Handleï¼Œæ‘‡æ‘‡å›¾å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="json hljs">paths: /some/sample/{bar}: post: description: |     Habr. summary: | ,  -   . parameters: - in: query name: id type: string required: <span class="hljs-literal"><span class="hljs-literal">true</span></span> - in: header name: foo type: string enum: - foo<span class="hljs-number"><span class="hljs-number">1</span></span> - foo<span class="hljs-number"><span class="hljs-number">2</span></span> required: <span class="hljs-literal"><span class="hljs-literal">true</span></span> - in: path name: bar type: string required: <span class="hljs-literal"><span class="hljs-literal">true</span></span> responses: '<span class="hljs-number"><span class="hljs-number">200</span></span>': description: OK schema: type: object additionalProperties: <span class="hljs-literal"><span class="hljs-literal">false</span></span> required: - baz properties: baz: type: string '<span class="hljs-number"><span class="hljs-number">400</span></span>': $ref: '#/responses/ResponseCommonError'</code> </pre><br> å¥½å§ï¼Œæ—¢ç„¶å¼€å‘äººå‘˜å·²ç»æœ‰äº†ä¸€ä¸ªåŒ…å«è¯·æ±‚å’Œå“åº”æè¿°çš„æ–¹æ¡ˆï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸åŸºäºå®ƒç”Ÿæˆè¿™äº›è¯·æ±‚å’Œå“åº”å‘¢ï¼Ÿ åŒæ—¶ï¼Œè¿˜å¯ä»¥åœ¨æ–¹æ¡ˆä¸­æŒ‡ç¤ºåˆ°protobuf / flatbuffer / ...æ–‡ä»¶çš„é“¾æ¥-ä»è¯·æ±‚æœ¬èº«ç”Ÿæˆçš„ä»£ç å°†è·å¾—æ‰€æœ‰å†…å®¹ï¼Œæ ¹æ®æ–¹æ¡ˆéªŒè¯è¾“å…¥æ•°æ®ï¼Œå¹¶å°†å…¶åˆ†è§£ä¸ºResponseç»“æ„çš„å­—æ®µã€‚ ç”¨æˆ·åªéœ€è¦åœ¨Handleæ–¹æ³•ä¸­ç¼–å†™åŠŸèƒ½ï¼Œè€Œä¸ä¼šå› è¯·æ±‚è§£æå’Œå“åº”åºåˆ—åŒ–è€Œåˆ†æ•£æ³¨æ„åŠ›ã€‚ <br><br> åŒæ—¶ï¼Œä»£ç ç”Ÿæˆé€‚ç”¨äºæœåŠ¡å®¢æˆ·ã€‚ æ‚¨å¯ä»¥æŒ‡ç¤ºæ‚¨çš„æœåŠ¡éœ€è¦å®¢æˆ·ç«¯æŒ‰ç…§è¿™ç§æ–¹æ¡ˆå·¥ä½œï¼Œå¹¶å‡†å¤‡å¥½ä¸€ä¸ªç±»ä»¥ç”¨äºåˆ›å»ºå¼‚æ­¥è¯·æ±‚ï¼š <br><br><pre> <code class="cpp hljs">Request req; req.id = id; req.foo = foo; req.bar = bar; dependencies.sample_client.SomeSampleBarPost(req);</code> </pre><br> è¿™ç§æ–¹æ³•è¿˜æœ‰å¦ä¸€ä¸ªä¼˜ç‚¹ï¼šå§‹ç»ˆæ˜¯æœ€æ–°æ–‡æ¡£ã€‚ å¦‚æœå¼€å‘äººå‘˜çªç„¶å°è¯•ä½¿ç”¨æ–‡æ¡£ä¸­æœªåŒ…å«çš„å‚æ•°ï¼Œåˆ™å°†æ”¶åˆ°ç¼–è¯‘é”™è¯¯ã€‚ <br><br><h2>  Userver-è®°å½• </h2><br> æˆ‘ä»¬å–œæ¬¢å†™æ—¥å¿—ã€‚ å¦‚æœä»…è®°å½•æœ€é‡è¦çš„ä¿¡æ¯ï¼Œåˆ™æ¯å°æ—¶å°†è¿è¡Œå‡ ä¸ªTBçš„æ—¥å¿—ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬çš„æ—¥å¿—è®°å½•æœ‰è‡ªå·±çš„æŠ€å·§å¹¶ä¸å¥‡æ€ªï¼š <br>  *å®ƒæ˜¯å¼‚æ­¥çš„ï¼ˆå½“ç„¶æ˜¯:-)ï¼‰ï¼› <br>  *æˆ‘ä»¬å¯ä»¥ç»•è¿‡æ…¢çš„std :: localeå’Œstd :: ostreamæ¥è®°å½•æ—¥å¿—ï¼› <br>  *æˆ‘ä»¬å¯ä»¥å³æ—¶åˆ‡æ¢æ—¥å¿—è®°å½•çº§åˆ«ï¼ˆæ— éœ€é‡æ–°å¯åŠ¨æœåŠ¡ï¼‰ï¼› <br>  *å¦‚æœä»…ç”¨äºæ—¥å¿—è®°å½•ï¼Œåˆ™æˆ‘ä»¬ä¸æ‰§è¡Œç”¨æˆ·ä»£ç ã€‚ <br><br> ä¾‹å¦‚ï¼Œåœ¨å¾®æœåŠ¡æ­£å¸¸è¿è¡ŒæœŸé—´ï¼Œæ—¥å¿—è®°å½•çº§åˆ«å°†è®¾ç½®ä¸ºINFOï¼Œæ•´ä¸ªè¡¨è¾¾å¼ <br><br><pre> <code class="cpp hljs"> LOG_DEBUG() &lt;&lt; request.id &lt;&lt; <span class="hljs-string"><span class="hljs-string">" is not OK of "</span></span> &lt;&lt; GetSomeInfoFromDb();</code> </pre><br> å°†ä¸ä¼šè¢«è®¡ç®—ã€‚ ä¸ä¼šåŒ…å«å¯¹èµ„æºå¯†é›†å‹å‡½æ•°GetSomeInfoFromDbï¼ˆï¼‰çš„è°ƒç”¨ã€‚ <br><br> å¦‚æœæœåŠ¡çªç„¶å˜å¾—â€œå‚»ç“œâ€ï¼Œåˆ™å¼€å‘äººå‘˜æ€»æ˜¯å¯ä»¥å‘Šè¯‰å·¥ä½œæœåŠ¡ï¼šâ€œä»¥DEBUGæ¨¡å¼ç™»å½•â€ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œâ€œä¸æ­£ç¡®çš„â€æ¡ç›®å°†å¼€å§‹å‡ºç°åœ¨æ—¥å¿—ä¸­ï¼Œå°†æ‰§è¡ŒGetSomeInfoFromDbï¼ˆï¼‰å‡½æ•°ã€‚ <br><br><h2> ä»£æ›¿æ€»æ•° </h2><br> åœ¨ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œä¸å¯èƒ½ä¸€æ¬¡è®²è¿°æ‰€æœ‰åŠŸèƒ½å’ŒæŠ€å·§ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬ä»ç®€çŸ­çš„ä»‹ç»å¼€å§‹ã€‚ åœ¨è¯„è®ºä¸­å†™ä¸‹æœ‰å…³æ‚¨æœ‰å…´è¶£å­¦ä¹ å’Œé˜…è¯»çš„ç”¨æˆ·å†…å®¹çš„ä¿¡æ¯ã€‚ <br><br> ç°åœ¨ï¼Œæˆ‘ä»¬æ­£åœ¨è€ƒè™‘æ˜¯å¦å°†æ¡†æ¶å‘å¸ƒåœ¨å¼€æºä¸­ã€‚ å¦‚æœæˆ‘ä»¬å†³å®šæ˜¯çš„è¯ï¼Œé‚£ä¹ˆå‡†å¤‡å¼€æ”¾æºä»£ç çš„æ¡†æ¶å°†éœ€è¦å¤§é‡çš„åŠªåŠ›ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN474438/">https://habr.com/ru/post/zh-CN474438/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN474424/index.html">æ··åˆè®­ç»ƒ-å®ƒæ˜¯ä»€ä¹ˆä»¥åŠå®ƒå¦‚ä½•å·¥ä½œ</a></li>
<li><a href="../zh-CN474426/index.html">åŠ¨ç”»ç³»åˆ—â€œæ•°å­¦ç•Œâ€</a></li>
<li><a href="../zh-CN474430/index.html">è«æ–¯ç§‘DevOpsDays-ç¤¾åŒºä¸ºç¤¾åŒºä¸¾åŠçš„ä¼šè®®</a></li>
<li><a href="../zh-CN474434/index.html">è‡ªå·±çš„Telegramæœºå™¨äººï¼Œç”¨äºåœ¨pythonå’Œdockerä¸­è·Ÿè¸ªå…¶æœåŠ¡å™¨çš„æ­£å¸¸è¿è¡Œæ—¶é—´</a></li>
<li><a href="../zh-CN474436/index.html">ç”±äºæ”¿ç­–åŸå› ï¼ŒGitLabç»ˆæ­¢äº†ä»ä¿„ç½—æ–¯å’Œä¸­å›½æ‹›å‹Ÿå·¥ç¨‹å¸ˆ</a></li>
<li><a href="../zh-CN474440/index.html">iOSåº”ç”¨ç¨‹åºä¸­è‡ªåŠ¨ç»­è®¢è®¢é˜…çš„æ”¶å…¥è®¡ç®—å›°éš¾</a></li>
<li><a href="../zh-CN474442/index.html">çˆ±å°”å…°å»¶å¯¿æ•…äº‹</a></li>
<li><a href="../zh-CN474444/index.html">é’ˆå¯¹å¼€å‘äººå‘˜çš„å¦å¤–5ä¸ªå¤§èƒ†çš„åŸ¹è®­é¡¹ç›®ï¼ˆå±‚ï¼ŒSqueoshï¼Œè®¡ç®—å™¨ï¼Œç½‘ç«™æŠ“å–å·¥å…·ï¼ŒéŸ³ä¹æ’­æ”¾å™¨ï¼‰</a></li>
<li><a href="../zh-CN474448/index.html">è®¡ç®—æœºä¸–ç•Œä¸­å­¦ç”Ÿçš„å¤§è„‘æœ‰ä»€ä¹ˆèƒ½åŠ›</a></li>
<li><a href="../zh-CN474450/index.html">åœæ­¢ä¸ºDNSä½¿ç”¨éå¸¸å°çš„TTL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>