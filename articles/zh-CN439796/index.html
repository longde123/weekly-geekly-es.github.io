<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑 🤦🏾 👶🏼 Spring Boot 2：他们在发行说明中没有写的内容 ➖ 🤳🏾 🍆</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="当大型项目进行大规模更新时，一切都不是那么简单：不可避免地会有细微的差别（换句话说，就是耙子）。 然后，无论文档的质量如何，只有您自己或他人的经验才能对您有所帮助。 

 在Joker 2018大会上，我谈到了我自己切换到Spring Boot 2时遇到的问题以及如何解决这些问题。 现在专门针对Ha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Spring Boot 2：他们在发行说明中没有写的内容</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/439796/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/a4/e3/fc/a4e3fcwl22r0y3nlx8z-6pkhtny.jpeg"></div><br><br> 当大型项目进行大规模更新时，一切都不是那么简单：不可避免地会有细微的差别（换句话说，就是耙子）。 然后，无论文档的质量如何，只有您自己或他人的经验才能对您有所帮助。 <br><br> 在Joker 2018大会上，我谈到了我自己切换到Spring Boot 2时遇到的问题以及如何解决这些问题。 现在专门针对Habr-此报告的文本版本。 为了方便起见，该帖子同时提供了视频记录和目录：您无法阅读全部内容，但可以直接解决让您担心的问题。 <br><a name="habracut"></a><br><h2> 目录 </h2><br><ul><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">录像录像</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">参赛作品</a></b> </li><li>  <b>耙编译时间</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">问题例子</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">如何成为</a> </li><li>  <b>内容类型。</b>  <b>确定HTTP响应的类型</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">问题</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">如何成为</a> </li><li>  <b>排程。</b>  <b>预定发射</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">问题</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">如何成为</a> </li><li>  <b>春云公司</b>  <b>库兼容性</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">问题</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">奖金：增加情况</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">如何成为</a> </li><li>  <b>放松绑定。</b>  <b>模糊参数绑定</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">问题</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">如何成为</a> </li><li>  <b>单元测试。</b>  <b>在Mockito 2中运行测试</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">问题</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">如何成为</a> </li><li>  <b>Gradle插件。</b>  <b>构建Spring Boot项目</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">问题</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">如何成为</a> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">其他</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">结论</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">总结与结论</a></b> </li></ul><br><br><a name="video"></a><iframe width="560" height="315" src="https://www.youtube.com/embed/8jNXZXdb3no" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="intro"></a> 美好的一天！ 我想告诉您有关将Spring Boot框架更新到第二个版本及其后续操作时可能遇到的一些功能（我们称它们为rakes）。 <br><br> 我叫VladimirPlizgá（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub</a> ），我在CFT工作，CFT是俄罗斯最大，最古老的软件开发商之一。 在过去的几年中，我一直在那里进行后端开发，负责预付卡在线银行的技术开发。 正是在这个项目中，我成为了从整体架构到微服务架构（仍在进行中）过渡的发起者和执行者。 好吧，由于我决定与您分享的大多数知识都是在这个特定项目的示例中积累的，因此，我将向您详细介绍一下。 <br><br><h2> 简要介绍实验产品 </h2><br> 这是一家互联网银行，为俄罗斯境内超过二十多家合作伙伴公司提供一手服务：它为最终客户提供了通过远程银行服务（移动应用程序，网站）管理其资金的能力。 合作伙伴之一是Beeline及其支付卡。 从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Markswebb Mobile Banking Rank</a>的等级来看，事实证明，这对于Internet银行来说是相当不错的，我们的产品在初学者中<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">排名很高</a> 。 <br><br>  “勇气”仍在过渡中，因此我们拥有一个整体，即所谓的核心，围绕它构建了23个微服务。 内部包含Spring Cloud Netflix微服务，Spring Integration等。 在Spring Boot 2上，整个过程从7月份开始就一直在进行。 而在这个地方，我们将更详细地介绍。 将这个项目翻译成第二版，我遇到了一些我想告诉你的功能。 <br><br><h2> 报告大纲 </h2><br><img src="https://habrastorage.org/webt/rl/jd/zq/rljdzqye-_lbzjguklndonlyc-4.jpeg"><br><br>  Spring Boot 2的功能在很多地方都出现过，我们将尝试遍历所有领域。 为了快速做到这一点，我们需要经验丰富的侦探或调查员-像我们一样发掘所有这些东西的人。 由于Holmes和Watson已经在Joker上<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">做了演讲</a> ，我们将得到另一位专家科伦坡中尉的协助。 来吧！ <br><br><h2> 春季靴/ 2 </h2><br> 首先，简要介绍一下Spring Boot，尤其是第二个版本。 首先，发布此版本的目的是要适度而不是昨天发布：2018年3月1日，该版本已经正式发布。 开发人员追求的主要目标之一是在源代码级别完全支持Java 8。 也就是说，尽管运行时兼容，但不能在较小的版本上进行编译。 第五版的Spring Framework（比Spring Boot 2早一些发布）被作为基础，而这并不是唯一的依赖关系。 他还具有诸如<a href="">BOM</a> （ <a href="">物料清单</a> ）之类的概念-这是一个巨大的XML，其中列出了对各种第三方库，其他框架，工具等的所有（对我们而言是可传递的）依赖项。 <br><br> 因此，第二个Spring Boot带来的所有特殊效果并非全部来自其自身或Spring生态系统。 已经为整个服务器场编写了两个出色的文档： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">发行说明</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">迁移指南</a> 。 文档很酷，Spring在这个意义上通常做得很好。 但是，出于明显的原因，要覆盖那里的所有内容是远远不可能的：有些细节，偏差等无法包含或不应包含在其中。 我们将讨论这些功能。 <br><br><a name="compile"></a><h2> 编译时间。  API变更范例 </h2><br> 让我们从或多或少简单和明显的角度开始：这些是在编译时出现的。 也就是说，如果仅将Boot脚本中的数字1更改为2，则甚至无法编译项目。 <br><br> 当然，更改的主要来源（成为Spring Boot进行此类编辑的基础）是Spring向Java 8的过渡。此外，相对而言，Spring 5和Spring Boot 2的Web堆栈也分为两部分。 现在它是servlet，对我们来说是传统的，并且是被动的。 此外，有必要考虑以前版本的许多缺点。 第三方库（从Spring外部）启动。 如果您查看发行说明，那么您将看不到任何陷阱，坦率地说，当我第一次阅读发行说明时，在我看来一切都很好。 对我来说，它看起来像这样： <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/uJ2P16LXA94" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> 但是，您可能会猜到，一切都不尽如人意。 <br><br>  <b>编译将中断的内容（示例1）：</b> <br><br><ul><li> <b>原因</b> ： <code>WebMvcConfigurerAdapter</code>类不再存在； </li><li>  <b>原因</b> ：支持Java 8芯片（接口中的默认方法）； </li><li>  <b>怎么做</b> ：使用<code>WebMvcConfigurer</code>界面。 </li></ul><br> 至少由于某些类不再存在的事实，项目可能无法编译。 怎么了 是的，因为在Java 8中不需要它们。 如果这些适配器具有方法的原始实现，则没有什么特别的解释，默认方法可以完美地解决所有这些问题。 这是此类的一个示例，很明显，使用接口本身就足够了，并且不需要适配器。 <br><br>  <b>编译将中断（示例2）：</b> <br><br><ul><li>  <b>原因</b> ： <code>PropertySourceLoader#load</code>方法开始返回源列表，而不是一个； </li><li>  <b>原因</b> ：支持多文档资源，例如YAML； </li><li>  <b>怎么做</b> ：将响应包装在<code>singletonList()</code> （当被重写时）。 </li></ul><br> 来自完全不同区域的示例。 有些方法甚至更改了签名。 如果您曾经使用过加载PropertySourceLoader方法，那么它现在将返回一个集合。 因此，这允许多文档资源的支持。 例如，在YAML中，可以通过三个破折号在一个文件中指定一堆文档。 如果现在需要通过Java使用它，请记住，这必须通过集合来完成。 <br><br>  <b>编译将中断（示例3）：</b> <br><br><ul><li>  <b>原因</b> ： <code>org.springframework.boot.autoconfigure.web</code>包中的某些类与<code>org.springframework.boot.autoconfigure.web</code>包中的<code>.reactive</code>和<code>.reactive</code> ； </li><li>  <b>为什么</b> ：与传统喷气机一样支持喷气机； </li><li>  <b>怎么做</b> ：更新导入。 </li></ul><br> 引入了更多的更改，从而进行堆叠。 例如，以前在同一个Web程序包中的内容现在已分成具有一堆类的两个程序包。 这些是<code>.reactive</code>和<code>.reactive</code> 。 为什么要这样做？ 因为喷气栈不应该成为servlet顶部的巨大拐杖。 必须这样做，以便他们可以维持自己的生命周期，朝着自己的方向发展并且不会互相干扰。 怎么办呢？ 足以更改导入：这些类中的大多数在API级别上保持兼容。 大多数，但不是全部。 <br><br>  <b>编译将中断（示例4）：</b> <br><br><ul><li>  <b>原因</b> ： <code>ErrorAttributes</code>类的方法的签名已<code>ErrorAttributes</code> ：开始使用<code>WebRequest(servlet)</code>和<code>ServerRequest(reactive)</code>代替<code>RequestAttributes</code> ； </li><li>  <b>为什么</b> ：与传统喷气机一样支持喷气机； </li><li>  <b>怎么做</b> ：替换签名中的类名。 </li></ul><br> 例如，现在在ErrorAttributes类中，代替了RequestAttributes，在方法中开始使用了另外两个类：WebRequest和ServerRequest。 原因是一样的。 怎么办呢？ 如果从第一个Spring Boot切换到第二个Spring Boot，则需要将RequestAttributes更改为WebRequest。 好吧，如果您已经处于第二个位置，请使用ServerRequest。 显然不是吗？ <br><br><a name="compile_solution"></a><h3> 如何成为 </h3><br> 有很多这样的例子；我们不会全部整理出来。 怎么办呢？ 首先，值得一看的是《 Spring Boot 2.0迁移指南》，以便及时发现与您有关的更改。 例如，它提到重命名完全不明显的类。 但是，如果某些事情已经破裂和破裂，则值得考虑的是，“ web”的概念分为2：“ servlet”和“ reactive”。 通过在所有类和程序包中定向，这可以有所帮助。 另外，应该记住，不仅重命名了类和包本身，而且还重命名了整个依赖关系和工件。 例如，Spring Cloud就发生了这种情况。 <br><br><hr><br><a name="contenttype"></a><h2> 内容类型。 确定HTTP响应的类型 </h2><br> 从编译时开始，这些简单的事情就足够了，那里的一切都清晰明了。 让我们讨论一下，即使Spring Boot 2已经为您工作了很长时间，在运行时可能发生的事情并因此可以进行射击。 让我们谈谈内容类型的定义。 <br><br><img src="https://habrastorage.org/webt/03/a2/db/03a2dbs5_suz7osfukciaumo0-y.jpeg"><br><br>  Spring可以编写页面和REST API的Web应用程序，并且可以呈现各种类型的内容（XML，JSON或其他类型），这已经不是什么秘密了。  Spring如此钟爱的魅力之一是，您不必费心在代码中指定类型的定义。 你可以希望魔术。 相对而言，这种魔术以三种不同的方式起作用：要么依赖于来自客户端的Accept标头，要么依赖于请求文件的扩展名，或者依赖于URL中的特殊参数，当然，也可以对其进行控制。 <br><br> 考虑一个简单的示例（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">完整的源代码</a> ）。 在下文中，我将使用Gradle的表示法，但是即使您是Maven粉丝，您也不难理解这里写的内容：我们在第一个Spring Boot上构建了一个微型应用程序，并且仅使用一个入门网站。 <br><br> 范例（v1.x）： <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'1.5.14.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web:$springBootVersion"</span></span>) }</code> </pre><br> 作为可执行代码，我们有一个单独的类，其中的控制器方法立即被声明。 <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(value = <span class="hljs-string"><span class="hljs-string">"/download/{fileName: .+}"</span></span>, produces = {TEXT_HTML_VALUE, APPLICATION_JSON_VALUE, TEXT_PLAIN_VALUE}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ResponseEntity&lt;Resource&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">download</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathVariable String fileName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,  Content-Type }</span></span></code> </pre><br> 它以某个文件名作为输入，据称它将形成并给出。 它实际上以三种指示的类型之一（由文件名确定）来形成其内容，但没有以任何方式指定内容类型-我们拥有Spring，他将自己做所有事情。 <br><br><img src="https://habrastorage.org/webt/wa/nd/77/wand77z2iocxhhqbcr-bn6lvzxm.jpeg"><br><br> 通常，您甚至可以尝试这样做。 确实，如果我们请求具有不同扩展名的同一文档，则将根据返回的内容返回正确的内容类型：如果需要-json，如果需要-txt，如果需要-html。 它像童话一样工作。 <br><br><h3> 更新到v2.x </h3><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'2.0.4.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web:$springBootVersion"</span></span>) }</code> </pre><br> 现在该升级到第二个Spring Boot了。 我们只是将数字1更改为2。 <br><br><img src="https://habrastorage.org/webt/rk/ki/dg/rkkidgg5r97wfxcfq_3djkria_u.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Spring MVC路径匹配默认行为更改</a> <br><br> 但是我们是工程师，我们将看一下《迁移指南》，突然之间有人对此发表意见。 但是它提到了某种“后缀路径匹配”。 它是关于如何使用URL正确映射Java中的方法。 但这不是我们的情况，尽管有点像。 <br><br><img src="https://habrastorage.org/webt/cy/re/_f/cyre_fno26kbqiepmtpr0tewmrw.jpeg"><br><br> 因此，我们得分，检查并爆炸！  -突然不起作用。 出于某种原因，随处可见文本/ html，如果您对其进行挖掘，不仅是文本/ html，还只是您在@GetMapping注释的Produces属性中指定的第一种类型。 为什么这样 坦率地说，它看起来令人难以理解。 <br><br><img src="https://habrastorage.org/webt/xt/mj/50/xtmj50wpv1ossdx_6nqeakchwxc.jpeg"><br><br> 在这里，任何发行说明都无济于事，您必须阅读源代码。 <br><br><h3>  ContentNegotiationManagerFactoryBean </h3><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ContentNegotiationManagerFactoryBean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ List&lt;ContentNegotiationStrategy&gt; strategies = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.strategies != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { strategies.addAll(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.strategies); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.favorPathExtension) { PathExtensionContentNegotiationStrategy strategy; <span class="hljs-comment"><span class="hljs-comment">// …</span></span></code> </pre><br> 在这里，您可以找到经典的名称，它的缩写很容易理解，其中提到了一个称为“在途中考虑扩展”（favorPathExtension）的标志。 该标志“ true”的值对应于某个策略的应用，该策略具有另一个易于理解的简短名称，从中可以明显看出，它仅负责通过文件扩展名确定内容类型。 如您所见，如果该标志为false，则该策略将不适用。 <br><br><img src="https://habrastorage.org/webt/qy/g3/ms/qyg3mscyw2mnlyqewltjefecwri.jpeg"><br><br> 是的，可能很多人注意到Spring显然有某种指导方针，因此名称必须很好，至少20个字符长。 <br><br><img src="https://habrastorage.org/webt/ef/j8/il/efj8ilxfvvc1_dtss-7-becc_m0.jpeg"><br><br> 如果您深入研究，则可以挖掘出这样的片段。 在Spring框架本身中，而不是在第五版中，正如您所期望的那样，但是从远古时代开始，该标志默认情况下已设置为“ true”。 在Spring Boot和第二个版本中，它被另一个版本阻止，现在可以通过设置进行控制。 也就是说，现在我们可以从环境管理中引导他们，这仅是第二版。 你有感觉吗 在那里，他已经假设了“假”的含义。 也就是说，他们希望做到最好，将这个标志放在设置中（这很好），但是默认值已切换到另一个（不是很大）。 <br><br> 框架的开发人员也是人，他们也容易出错。 怎么办呢？ 很明显，您需要在项目中切换参数，一切都会好起来的。 <br><br> 为了防患于未然，唯一值得做的事情就是看一下Spring Boot文档，以发现对该标志的任何提及。 在这里确实<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">提到了</a>他，但只是在一些奇怪的情况下： <br><blockquote> 如果您<b>了解了注意事项</b> ，但仍希望您的应用程序使用后缀模式匹配，则需要以下配置： <br>  spring.mvc.contentnegotiation.favor-path-extension = true <br>  ... <br></blockquote> 他们说，如果您理解所有技巧，但仍然想使用后缀路径匹配，请选中该框。 感到差异？ 似乎我们在此标记的上下文中讨论的是内容类型的定义，但是在这里我们在讨论Java方法和URL的匹配。 看起来有些难以理解。 <br><br> 我们必须进一步挖掘。  GitHub上有这样的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">拉取请求</a> ： <br><br><img src="https://habrastorage.org/webt/qa/ra/e8/qarae8b3dxgmf-mwhx1-bf9tev0.jpeg"><br><br> 在此拉取请求的框架内，进行了这些更改-切换了默认值-框架的一位作者说此问题有两个方面：一个是路径匹配，第二是内容类型的定义。 也就是说，标志适用于两者，并且它们之间有着千丝万缕的联系。 <br><br> 当然，如果您只知道查找位置，则可以立即在GitHub上找到它。 <br><br><img src="https://habrastorage.org/webt/nb/pr/sq/nbprsqxl5nlwzs5qtnv3vohv26y.jpeg"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">后缀匹配</a> <br><br> 此外，Spring框架本身的文档还指出，较早使用文件扩展名是必要的，但现在不再认为是必须的。 而且，在许多情况下，这被证明是有问题的。 <br><br><h3> 总结一下 </h3><br> 更改默认标志值根本不是一个错误，而是一个功能。 它与路径匹配的定义有着千丝万缕的联系，旨在完成<b>三件事</b> ： <br><br><ul><li> 降低安全风险（我将澄清哪些风险）； </li><li> 调整WebFlux和WebMvc的行为，它们在这一方面有所不同； </li><li> 使文档中的语句与框架代码对齐。 </li></ul><br><a name="contenttype_solution"></a><h3> 如何成为 </h3><br> 首先，只要有可能，就不应该依赖扩展内容类型的定义。 我展示的示例是一个反例，无需这样做！ 不仅不必依赖这样的事实，例如，形式为“ GET something.json”的请求将仅“ GET something”。 在Spring Framework 4和Spring Boot 1中就是这种情况。这不再起作用。 如果需要映射到具有扩展名的文件，则需要明确地执行此操作。 相反，最好依靠Accept标头或URL参数，您可以控制其名称。 好吧，如果您无法采取任何措施，例如，您有一些旧的移动客户端在上个世纪停止更新，那么您将必须返回此标志并将其设置为“ true”，并且所有内容都将像以前一样工作。 <br><br> 此外，为了获得一般性理解，您可以阅读Spring框架文档中的“后缀匹配”一章，开发人员将其视为该领域的一种最佳实践集合，并熟悉<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Reflected File Download攻击是什么</a> ，只需使用以下操作即可实现文件扩展名。 <br><br><a name="scheduling"></a><h2> 排程。 计划或定期任务 </h2><br> 让我们稍微改变一下范围，谈论按计划或定期完成任务。 <br><br><h3> 任务示例。 每3秒记录一次消息 </h3><br> 我认为所说的是可以理解的。 我们有一些业务需求，需要做一些重复，所以我们将立即进行示例。 假设我们有一个超级复杂的任务：每3秒向日志输出一些粪便。 <br><br><img src="https://habrastorage.org/webt/rf/ay/mh/rfaymhimyivf7htbkhf7fw3nia0.jpeg"><br><br> 显然，这可以通过多种方式来完成，对于Spring来说，无论如何，它们都已经存在了。 并找到它-很多方法。 <br><br><h3> 选项1：在项目中搜索示例 </h3><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *A very helpful service */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReallyBusinessService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// … a bunch of methods … @Scheduled(fixedDelay = 3000L) public void runRepeatedlyWithFixedDelay() { assert Runtime.getRuntime().availableProcessors() &gt;= 4; } // … another bunch of methods … }</span></span></code> </pre><br> 我们可以查看自己的项目，并且可能会找到类似的内容。 一个注释将挂在公共方法上，从中可以清楚地看到，一旦挂起它，一切都将像童话故事一样工作。 <br><br><h3> 选项2：搜索所需的注释 </h3><br><img src="https://habrastorage.org/webt/nr/ax/sv/nraxsvpmgs9u7z2yjavxhceqrli.jpeg"><br><br> 您可以直接按名称搜索注释，并且从文档中也可以清楚地看到您已将其挂起-一切正常。 <br><br><h3> 选项3：Google搜索 </h3><br> 如果您对自己不信任，那么可以谷歌搜索，并从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">发现的</a>内容中清楚地<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">发现，</a>所有内容都将以一个注释开头。 <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventCreator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger LOG = LoggerFactory.getLogger(EventCreator.class); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> EventRepository eventRepository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventCreator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> EventRepository eventRepository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.eventRepository = eventRepository; } <span class="hljs-meta"><span class="hljs-meta">@Scheduled</span></span>(fixedRate = <span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LocalDateTime start = LocalDateTime.now(); eventRepository.save( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EventKey(<span class="hljs-string"><span class="hljs-string">"An event type"</span></span>, start, UUID.randomUUID()), Math.random() * <span class="hljs-number"><span class="hljs-number">1000</span></span>)); LOG.debug(<span class="hljs-string"><span class="hljs-string">"Event created!"</span></span>); } }</code> </pre><br> 谁看到这个陷阱？ 毕竟我们是工程师，让我们检查一下它是如何工作的。 <br><br><h3> 给我看看代码！ </h3><br> 考虑一个特定的任务（任务本身和代码<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在我的资源库中</a> ）。 <br><br> 谁不想读，您可以观看演示的视频片段（最多22分钟）： <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8jNXZXdb3no" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> 作为依赖，我们将使用具有两个启动器的第一个Spring Boot。 一种是用于网络，就像我们正在开发网络服务器，第二种是弹簧启动器致动器，因此我们具有可投入生产的功能，因此至少有点像真实的东西。 <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'1.5.14.RELEASE'</span></span> <span class="hljs-comment"><span class="hljs-comment">// springBootVersion = '2.0.4.RELEASE' } compile("org.springframework.boot:spring-boot-starter-web:$springBootVersion") compile("org.springframework.boot:spring-boot-starter-actuator:$springBootVersion") // +100500      }</span></span></code> </pre> <br> 而且我们的可执行代码将更加简单。 <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> tech.toparvion.sample.joker18.schedule; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.Logger; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.LoggerFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.boot.autoconfigure.SpringBootApplication; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.scheduling.annotation.Scheduled; <span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnableSchedulingDemoApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(EnableSchedulingDemoApplication.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(EnableSchedulingDemoApplication.class, args); } <span class="hljs-meta"><span class="hljs-meta">@Scheduled</span></span>(fixedRate = <span class="hljs-number"><span class="hljs-number">3000L</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doOnSchedule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ log.info(“ <span class="hljs-number"><span class="hljs-number">3</span></span>     …”); } }</code> </pre><br> 通常，除了悬挂注释的唯一方法之外，几乎没有什么特别的。 我们将其复制到某个地方，并期望它能正常工作。 <br><br> 让我们检查一下，我们是工程师。 我们开始。 我们假设每三秒钟会记录一次这样的消息。 一切都应该开箱即用，我们确保一切都在第一个Spring Boot上启动，并且我们期望得到期望的行的输出。 三秒钟过去-输出一行，六遍-显示一行。 乐观主义者赢了，一切正常。 <br><br><img src="https://habrastorage.org/webt/ed/em/ir/edemirx8zopb5wbf193tlbbh6fi.png"><br><br> 只有时间来升级到第二个Spring Boot。 我们不会打扰，只需从一个切换到另一个即可： <br><br><pre> <code class="java hljs">dependencies { ext { <span class="hljs-comment"><span class="hljs-comment">// springBootVersion = '1.5.14.RELEASE' springBootVersion = '2.0.4.RELEASE' }</span></span></code> </pre><br> 从理论上讲，《迁移指南》并没有警告我们任何事情，我们希望一切都会正常进行。 从可执行代码的角度来看，由于应用程序尽可能简单，因此我们没有前面提到的其他任何内容（在API级别或其他方面不兼容）。 <br><br> 我们开始。 首先，我们确信我们正在开发第二个Spring Boot，否则似乎没有任何偏差。 <br><br><img src="https://habrastorage.org/webt/e4/rq/cy/e4rqcy4gms2t-cog16ru4cr8qcu.png"><br><br> 但是，经过3秒，即6、9，但是仍然没有德语-没有结论，没有任何效果。 <br> 通常，期望与现实不符。 他们经常在文档中给我们写信，实际上，所有东西在Spring Boot中都是开箱即用的，我们可以以最小的麻烦就这样开始，并且不需要任何配置。 但是，一旦谈到现实，通常就会发现仍然应该阅读该文档。 特别是，如果您深入研究，可以在以下几行中找到： <br><blockquote>  7.3.1。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">启用计划注释</a> <br> 要启用对@Scheduled和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Async</a>批注的支持，可以将@EnableScheduling和@EnableAsync添加到您的@Configuration类之一。 </blockquote> 为了使Scheduled注释起作用，您需要将另一个注释与另一个注释一起挂在类上。 好，像往常一样在春天。 但是为什么以前能起作用呢？ 我们没有那样做。 显然，此注释在第一个Spring Boot的较早版本中已挂起，但由于某种原因现在不在第二个Spring Boot中。 <br><br><img src="https://habrastorage.org/webt/zz/7_/ar/zz7_ardj3w6--f-wefbyenp7_p0.jpeg"><br><br> 我们开始翻阅第一个Spring Boot的源代码。 我们发现它应该挂在某个类上。 我们仔细观察一下，它被称为“ MetricExportAutoConfiguration”，并且显然负责将这些性能指标传递给一些集中的聚合器，并且确实具有此注释。 <br><br><img src="https://habrastorage.org/webt/mf/ya/pb/mfyapbujxbyzbumuxy2cghrs2qk.jpeg"><br><br> 而且，它以这样的方式工作：它立即将其行为包括在整个应用程序中，而不必挂在单独的类上。 正是此类提供了这种行为，然后由于某种原因而没有这样做。 怎么了 <br><br><img src="https://habrastorage.org/webt/vd/p_/fj/vdp_fjs2gqgaicooirzzwu-tjg8.jpeg"><br><br> 相同的GitHub促使我们进行考古挖掘：作为向Spring Boot第二版过渡的一部分，该类与注释一起被删除。 怎么了 是的，因为指标交付引擎也发生了变化：他们不再使用自己的脚本，而是切换到了Micrometer-一个真正有意义的解决方案。 那只是他多余的东西。 也许这是正确的。 <br><br> 谁不想阅读，请观看30秒钟的简短演示： <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8jNXZXdb3no" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> 因此，如果我们现在采用并手动将丢失的注释挂在我们的原始类中，那么从理论上讲，该行为应该变得正确。 <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> tech.toparvion.sample.joker18.schedule; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.Logger; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.slf4j.LoggerFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.boot.autoconfigure.SpringBootApplication; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.scheduling.annotation.EnableScheduling; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.scheduling.annotation.Scheduled; <span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableScheduling</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnableSchedulingDemoApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(EnableSchedulingDemoApplication.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(EnableSchedulingDemoApplication.class, args); } <span class="hljs-meta"><span class="hljs-meta">@Scheduled</span></span>(fixedRate = <span class="hljs-number"><span class="hljs-number">3000L</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doOnSchedule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ log.info(“ <span class="hljs-number"><span class="hljs-number">3</span></span>     …”); } }</code> </pre><br> 您认为这行得通吗？ 让我们检查一下。 我们开始。 <br><br><img src="https://habrastorage.org/webt/6f/pg/ld/6fpgldlhinmkrdq6git1-dovdrg.png"><br><br> 可以看出，在3秒钟之后，6以后以及9以后，我们期望的消息仍然显示在日志中。 <br><br><a name="scheduling_solution"></a><h3> 如何成为 </h3><br> 在这种特殊且更普遍的情况下，该怎么办？ 无论听起来有多道德，首先，值得一读的不仅是复制的文档片段，而且还有一点更广的范围，以涵盖这些方面。 <br><br> 其次，请记住，在Spring Boot中，即使许多功能都是现成的（计划，异步，缓存等），它们也不总是包括在内，必须显式启用。 <br><br> 第三，安全并不麻烦：在代码中添加<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Enable</a> *注释（及其整个家族），而不希望使用框架。 但是随后出现了一个问题：如果我和我的同事偶然添加一些注释，会发生什么情况？   ,        .    :  .   ,       . <br><br> , @EnableAsync  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Enable</a> Caching  , ,  ,  ,        ,    . ,             .     ?      javadoc    ,      .  ,        .    ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Enable</a> *,       ,    .     ?            . <br><br><a name="proxy"></a><h2> Spring Cloud &amp; Co.   </h2><br><img src="https://habrastorage.org/webt/0a/sa/qj/0asaqj87-tg2xetyig_ytjreb34.jpeg"><br><br>       Spring Boot 2   ,    Spring Cloud —      Service Discovery (   ).      JavaMelody.     -  .  , ,    JDBC,    H2. <br><br><img src="https://habrastorage.org/webt/as/fd/lb/asfdlb0f-iqfgaquxgr7bjitwpq.jpeg"><br><br>    ,      ,  JavaMelody —   ,           ,   .   dev-,  test,          -  ,  Prometheus. <br><br>      Gradle   : <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'2.0.4.RELEASE'</span></span> springCloudVersion = <span class="hljs-string"><span class="hljs-string">'2.0.1.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web:$springBootVersion"</span></span>) runtime(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-jdbc:$springBootVersion"</span></span>) runtime group: <span class="hljs-string"><span class="hljs-string">"org.springframework.cloud"</span></span>, name: <span class="hljs-string"><span class="hljs-string">"spring-clooud-starter-netflix-eureka-client"</span></span>, version: <span class="hljs-function"><span class="hljs-function">springCloudVersion </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runtime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"net.bull.javamelody:javamelody-spring-boot-starter:1.72.0"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//… }</span></span></span></span></code> </pre><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">(  )</a> <br><br>      Spring Boot —  web  jdbc,  Spring Cloud     eureka (,    ,    Service Discovery),   JavaMelody.        . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HikariJavamelodyDemoApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(HikariJavamelodyDemoApplication.class, args); } }</code> </pre><br> 我们开始。 <br><br><img src="https://habrastorage.org/webt/uj/os/hr/ujoshrw-kj_cn72s23h5e7fjgka.jpeg"><br><br>      .      ,        ,      -  com.sun.proxy  Hikari, HikariDataSource.    ,  Hikari —      ,    Tomcat, C3P0  . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hv/la/u9/hvlau913-05gppcoqmjfsbuzip0.jpeg" width="50%"></div><br>   ?       . <br><br><h2>   </h2><br><h3> Spring Cloud  dataSource   </h3><br>  ,  Spring Cloud   ,    dataSource (   ),  .     ,    AutoRefresh  RefreshScope —                .          .      CGLIB. <br><br>  , ,   Spring Boot     Spring    :     JDK  (    ,   )     CGLIB (   ).     BeanPostProcessor'    BeanDefinition      ,        . <br><br><h3> JavaMelody  dataSource   </h3><br>   —  JavaMelody.    DataSource  ,      ,         . JavaMelody   JDK-,      ,   .       —   BeanPostProcessor. <br><br>        ,   ,     DataSource     JDK-,    CGLIB-.    : <br><br><img src="https://habrastorage.org/webt/j8/la/aj/j8laaj9tuxuewycjnpqzuxcaxpw.png"><br><br>     .      ,         . <br><br><h3> Spring Boot  dataSource.unwrap() </h3><br>     Spring Boot,     DataSource#unwrap(),        JMX.    JDK-       (     ),  CGLIB-,   Spring Cloud,     Spring Context. ,   ,      JDK-,    CGLIB API    . <br><br>       ,     : <br><br><img src="https://habrastorage.org/webt/a4/tb/aw/a4tbawwbqhd72cn7zw-ain4zm4c.jpeg"><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://jira.spring.io/browse/SPR-17381</a> <br><br>       ,   ,     ,         .     ,     , , , -   . <br><br><img src="https://habrastorage.org/webt/ke/bn/ns/kebnnswvcy8kwtnqezvikitcdvw.jpeg"><br><br>     .       Hikari? <br><br>  ,     Hikari  -    ,   Spring Cloud    .   : Hikari       Spring Boot 2. ? -    - .   ,  Spring Cloud?   ,    -  ,       ?   .  ,       . <br><br><h3>    … </h3><br><pre> <code class="java hljs">org.springframework.cloud.autoconfigure.RefreshAutoConfiguration .RefreshScopeBeanDefinitionEnhancer: <span class="hljs-comment"><span class="hljs-comment">/** * Class names for beans to post process into refresh scope. Useful when you * don't control the bean definition (eg it came from auto-configuration). */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Set&lt;String&gt; refreshables = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;&gt;( Arrays.asList(<span class="hljs-string"><span class="hljs-string">"com.zaxxer.hikari.HikariDataSource"</span></span>));</code> </pre><br>      Spring Cloud    autoconfiguration,       Enhancer BeanDefinition',       ,      Hikari.    Spring Cloud        .       . <br><br>      ?    Spring Cloud   ,        CGLIB-.   , ,  ,  ,    -      .        (jira.spring.io/browse/SPR-17381).       BeanPostProcessor,     .      BeanDefinition       ,    BeanPostProcessor'.   Stack Overflow    ,      -  ,    , proxyTargetClass   true  false  ,   .    ,        .      . <br><br>            ,      -   ,     . <br><br>    : <br><br><ul><li>      (, Tomcat JDBC Pool) <br> spring.datasource.type=org.apache.tomcat.jdbc.pool.DataSource <br>     <br> runtime 'org.apache.tomcat:tomcat-jdbc:8.5.29' <br> Hikari ,  , ,   ,      ,      Tomcat,     Spring Boot. </li><li>   JavaMelody,   JDBC-,    . <br> javamelody.excluded-datasources=scopedTarget.dataSource </li><li>      Spring Cloud. <br> spring.cloud.refresh.enabled=false <br> ,  ,     ,    Service Discovery,       . </li></ul><br><br>      .              ,          . <br><br><a name="bonus"></a><h3>  ( *) </h3><br> *  Spring Cloud (   JavaMelody) <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@ManagedResource</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableAsync</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyJmxResource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ManagedOperation</span></span> <span class="hljs-meta"><span class="hljs-meta">@Async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">launchLongLastingJob</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// -   } }</span></span></code> </pre><br>   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/toparvion/joker-2018-samples/tree/master/jmx-resource</a> . <br><br>   .    ,      Spring Cloud.   JavaMelody ,    Spring-,   .       ,  ,     ,    JMX   .      -  ,      Async,    JMX-  .      JMX,      @ManagedOperation,     ,     (    Spring —    ,     OK). <br><br>      ,     ,      , , ,  myJMXResource     JMX,     .     ,          —     , CGLIB  JDK. <br><br><img src="https://habrastorage.org/webt/de/c2/bo/dec2bo6sbaa1zipyhg55jigk960.jpeg"><br><br>  JDK  CGLIB-.    ,  -   BeanPostProcessor. <br><br>  ,    BeanPostProcessor': <br> AsyncAnnotationBeanPostProcessor <br><br><ul><li> :      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Async</a> </li><li> : org.springframework.scheduling </li><li>  :  @EnableAsync ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Import</a> ) </li></ul><br> 2. DefaultAdvisorAutoProxyCreator <br><ul><li> :     AOP-,        </li><li> : org.springframework.aop.framework.autoproxy </li><li>  : @Configuration- PointcutAdvisorConfig (  ) </li></ul><br> DefaultAdvisorAutoProxyCreator   @Configuration-.   ,      ,   JavaMelody,             configuration-.  ,    PointcutAdvisorConfig,        . <br><br><img src="https://habrastorage.org/webt/ta/bq/lh/tabqlh0jqjk71cnajqj5trjwp10.jpeg"><br><br>   ,    .   PointcutAdvisorConfig,   AdvisorConfig,     ,  configuration-,   ,  ,  ,    ,          . <br><br>  ,     ,   ,   ,    -. <br><br><img src="https://habrastorage.org/webt/nx/hw/vk/nxhwvkroqzaw8eziviybh7ct2sk.jpeg"><br><br>       BeanPostProcessor'.        ,       ,   ,    BeanPostProcessor         .    ,         Advised (  BeanPostProcessor'),   , ,   ,     , ,   JDK-,         .      . <br><br>        .     ,     : <br><br><img src="https://habrastorage.org/webt/kz/_r/te/kz_rtesazmfb1jdrd-2cbt7_kfo.png"><br><br>       JMX     .        BeanPostProcessor.       BeanPostProcessor',        , ,   ,   ,            JAR,    ,   . <br><br><a name="proxy_solution"></a><h3> 如何成为 </h3><br> -,       ,   Spring AOP,  , .  « »?        ,  -       Advice  Advisor,      ,       . <br><br> -,    best practices. ,          JMX-  ,       .  - ,       , ,     .      ,   autowire' ()     .     .  ,    ,    - .           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Order</a> ,     .  ,   ,     , ..     proxyTargetClass,   . <br><br> :     ,   . -, «Keep calm and YAGNI».   ,                .  « »,      - , -   ,    ,       ,   .     ,  ,       :    -,   ,       —  ,    .          . , Spring    ,      ,    .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">tolkkv</a> ,   ,      436- ,   .      ,      . <br><br><a name="relax"></a><h2> Relax Binding.    ()  </h2><br>   ,    . <br><br><img src="https://habrastorage.org/webt/ry/xw/mv/ryxwmvrfnmzbmona2o3vys4yqim.jpeg"><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-external-config-relaxed-binding</a> <br><br>    ,  Relax Binding  Spring Boot.       -         . ,      -   firstName   ,       acme.my-project.person,  Spring Boot      .        :  camel case,  ,     ,  -  —       firstName.      Relax Binding. <br><br>      Spring Boot'    ,   ,          —        . ,  ,   ,     : <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide#relaxed-binding</a> ( 1 ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">docs.spring.io/spring-boot/docs/2.0.5.RELEASE/reference/htmlsingle/#boot-features-external-config-relaxed-binding</a> ( 3 ) </li><li> <a href="">github.com/spring-projects/spring-boot/wiki/Relaxed-Binding-2.0</a> ( 4 ) </li></ul><br>   ,  ,  .  - . ,      . <br><br> 例如： <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'1.5.4.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter:$springBootVersion"</span></span>) }</code> </pre><br> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a> ) <br><br>       - ,   web,   Spring Boot,         -  . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RelaxBindingApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationRunner</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(RelaxBindingDemoApplication.class); <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SecurityProperties securityProperties; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ SpringApplication.run(RelaxBindingDemoApplication.class, args); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> main </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ApplicationArguments args)</span></span></span><span class="hljs-function"> </span></span>{ log.info(<span class="hljs-string"><span class="hljs-string">"KEYSTORE TYPE IS: {}"</span></span>, securityProperties.getKeyStoreType()); } }</code> </pre><br>  ,    POJO- ( )        ,    KEYSTORE TYPE.  POJO          ,      applications.properties  application.yaml,  . <br><br>      keystoreType,     private String keystoreType,      applications.properties: security.keystoreType=jks. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@ConfigurationProperties</span></span>(prefix = <span class="hljs-string"><span class="hljs-string">"security"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SecurityProperties</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String keystorePath; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String keystoreType; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKeystorePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keystorePath; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setKeystorePath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String keystorePath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.keystorePath = keystorePath; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getKeyStoreType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> keystoreType; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setKeystoreType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String keystoreType)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.keystoreType = keystoreType; } }</code> </pre><br>     Spring Boot     . <br><br><img src="https://habrastorage.org/webt/ya/fn/kg/yafnkgxoaoudil70xnvdw1q_hhc.jpeg"><br><br>  ,  ,  ,  .      ,      . <br><br><img src="https://habrastorage.org/webt/qz/1b/s6/qz1bs6ydorm1cfaej8lcfzvxc84.jpeg"><br><br>      ,   .   ,   ,  ,    -   ,       , - key-store-type.        ,    ,        ,     . <br><br>       .    ,      . <br><br><img src="https://habrastorage.org/webt/kf/8j/8e/kf8j8eytzsayh7xarx_dx_kaedy.jpeg"><br><br>     .      2  ,   ,   .           Java   properties —  ,    .    , , ,     ,    ,      .   —      Java bean       .   ,    ,  .       ,   «keystore»  ,    : «Key»  «Store». … <br><br><img src="https://habrastorage.org/webt/9-/ak/rw/9-akrwm5gftlarfdvte2s1hqkas.jpeg"><br><br>  ,    ,    ? . <br><br> ,    ,    Relax Binding    (   getStoreType()).   ,     . ,         .    ,  keyStoreType,   . ,       Relax Binding,    ,        ,    . <br><br>  ,   -  ,  -   ,     .      ,     .         : <br><br><img src="https://habrastorage.org/webt/ll/s_/c2/lls_c2hpqhq6ea7eooc_bf65c_u.jpeg"><br><br>        ,  -    ,    ,   , ,     -,         .        . <br><br><a name="relax_solution"></a><h3> 如何成为 </h3><br>        :       - . -,   ,     dev-   , ,  YAML  properties,    —      ,    ,    . -,     <a href="">c   </a> ,       Relax Binding,    .  , , ,     Spring Boot   . <br><br><a name="unit"></a><h2> Unit Testing.    Mockito 2 </h2><br>    ,    -     ,        Mockito. <br><br> Mockito    ,        Spring Boot Starter,      Spring,        Mockito. <br><br><pre> <code class="plaintext hljs">$gradle -q dependencyInsight --configuration testCompile --dependency mockito org.mockito:mockito-core:2.15.0 variant "runtime" /--- org.springframework.boot:spring-boot-starter-test:2.0.2.RELEASE /---testCompile</code> </pre><br>     ?      .    Spring Boot  Mockito   ,    1.5.2 Spring Boot     Mockito 2,      .     -  .         Mockito 2. <br><br>  Mockito   ,    2016-   Mockito 2.0  Mockito.2.1—      :  Java 8    ,     Hamcrest     - .   ,     ,     . <br><br>     ,           ,     (  ) . <br><br><img src="https://habrastorage.org/webt/5a/yt/fo/5aytfoqxgbx4crbjwmngut1dh1i.jpeg"><br><br> ,       ,     JButton  Swing,    null,   ,     -  .   , string'   null,   , null   instanceof  string.  ,  Mockito 1     ,  Mockito 2          ,  anyString  null   ,        ,       .      :      null,     .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> ,  ,         ,     Mockito 1. <br><br>  ,   , . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTarget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object target)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//… } } &lt;hr/&gt; @Test public void testAnyStringMatcher() { MyService myServiceMock = mock(MyService.class); myServiceMock.setTarget(new JButton()); verify(myServiceMock).setTarget(anyString()); }</span></span></code> </pre><br> ,        ,   .                 JButton.       anyString.  ,   :   ,     —    .   ,       .    -       10-    ,        .  Mockito 1   ,     : <br><br><img src="https://habrastorage.org/webt/ts/_s/cd/ts_scdhl4ikfptceteyv-plex0o.png"><br><br> Mockito 2    , ,   , anyString     : <br><br><img src="https://habrastorage.org/webt/db/tw/ec/dbtwecp6onmr9f_r4k-ufverzb8.jpeg"><br><br>     .   ,    . ,        ,      ,         ,         SocketTimeoutException,       -   .          ,  SocketTimeoutException ,  .         Mockito 1. <br><br><img src="https://habrastorage.org/webt/2b/nc/9d/2bnc9dqcfgkh7htm6-tiih1mf38.png"><br><br>   Mockito 2        ,        : <br><br><img src="https://habrastorage.org/webt/41/ya/uh/41yauhpileynqw_fqvdisk26h_k.jpeg"><br><br>   ,  Mockito 1    ,     ,        .      new SocketTimeoutException   new,  constructor,  Mockito 1   . <br><br> 怎么办呢？    , ,  RuntimeException,       ,    Mockito     . <br><br>    .    ,       .       compile-time. -     ,     Hamcrest.  Spring Boot,  Mockito 1     @MockBean  @SpyBean.        ,    Spring Integration,         review. <br> (: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://docs.spring.io/spring-integration/docs/5.0.0.RELEASE/reference/htmlsingle/#testing</a> ) <br><br><h3> 如何成为 </h3><br>     ,   ,      Mockito 1,      Mockito 2 ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">dzone.com/refcardz/mockito</a> ). <br><br> -,      ,     ,    Spring Boot 1.5.2  Mockito 2. <br><br> -, ,    ,    Mockito 2,          : <a href=""></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> . <br><br><a name="gradle"></a><h2> Gradle Plugin.  Spring Boot  </h2><br> ,     , —  Spring Boot-  Gradle. <br><br>   Migration Guide ,  Spring Boot   Gradle   .  ,  .  :    Gradle 4  (,    settings.gradle   ).       dependency management plugin,    .    bootRepackage,  ,   :  bootWar  bootJar.     bootJar     . <br><br>  bootJar: <br><br><ul><li>  ,    org.springframework.boot  java; </li><li>   jar; </li><li>   mainClassName (    )   (  ,  -  ). </li></ul><br>  ,    ,      —   ,   ,   Gradle,     Spring Boot. <br><br>     ?   -    Spring Boot 2, , ,  Gradle 4      Spring Boot-.     ,     ,  :      ,  ,     (    ,     ). <br><br><img src="https://habrastorage.org/webt/kb/uh/y4/kbuhy4rtm7yyl_zjp2ij62wavoq.jpeg"><br><br>   ,   .    app1 ,    app2, app3  . .  app1    lib. <br><br><h3> «Show me the code!» </h3><br>   <br><br><pre> <code class="java hljs">subprojects { repositories { mavenCentral() } apply plugin: <span class="hljs-string"><span class="hljs-string">'java'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'org.springframework.boot'</span></span> }</code> </pre><br>         —   : java   Spring Boot   . <br><br> ,   ,       ,   .      ,        ,     ,     .       . <br><br> app1:   <br><br><pre> <code class="java hljs">dependencies { ext { springBootVersion = <span class="hljs-string"><span class="hljs-string">'2.0.4.RELEASE'</span></span> } compile(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter:$springBootVersion"</span></span>) <span class="hljs-function"><span class="hljs-function">compile </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">':lib'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> }</span></span></code> </pre><br>          lib  ,   Spring Boot-. <br><br> app1:   <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GradlePluginDemoApplication</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationRunner</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//… @Override public void run(ApplicationArguments args) { String appVersion = Util.getAppVersion(getClass()); log.info("Current application version: {}", appVersion); } }</span></span></code> </pre><br>         Util,     . <br><br> lib:   <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Util</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAppVersion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Class&lt;?&gt; appClass)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> appClass.getPackage().getImplementationVersion(); } }</code> </pre><br>   Util   getAppVersion    ,    ,  ImplementationVersion   .        . <br><br><img src="https://habrastorage.org/webt/jc/ax/ur/jcaxur0f1_-yhxot9uvkfsf3fos.jpeg"><br><br>      IDE,   ,    ,     .    gradle build  IDE ,   .         Util.  ,  ,    ,      ,       . <br><br><a name="gradle_solution"></a><h3>   </h3><br> : <br><br><ul><li> bootJar   jar; </li><li> Gradle        jar. </li></ul><br> : <ul><li>       ; </li><li>   ,    jar (  ImplementationVersion), . </li></ul><br>    ?   :        . <br><br><img src="https://habrastorage.org/webt/dz/lr/p8/dzlrp85l4z8wsgc12ttn7cwsqec.jpeg"><br><br>       Spring Boot-   , ,   lib    .     . <br><br>  2:  SB Gradle Plugin   Spring Boot- <br><br><pre> <code class="java hljs">bootJar { enabled = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> }</code> </pre><br>    ,      -   ,    , ,    , ,      bootJar   . ,    jar  ,       . <br><br><a name="other"></a><h2>  </h2><br>  , ,      ,      Spring Boot.       . <br><br><img src="https://habrastorage.org/webt/xm/8w/kx/xm8wkxoaoc2ujoy0kicwn5v2n9w.jpeg"><br><br>  Spring Boot        :       web-,       ,    .    - ,       ,  Spring Boot properties migrator,      ,  ,        .      ,     ,     -,        . <br><br>      Actuator.  ,       ()  ,      Spring Security.       . <br><br><img src="https://habrastorage.org/webt/hv/sl/d4/hvsld4a0hcak8jvs3rbwsbugi00.jpeg"><br><br>  Spring Cloud   .   ,        .   ,  Netflix  Feign. <br><br><img src="https://habrastorage.org/webt/lu/a5/6l/lua56loq0hsapwtgkstpf0_7ik0.jpeg"><br><br>  Spring Integration,     ,   Spring Framework,   .     —  ,    Java DSL      , ,        .   ,       ,   ,      ,        handle    handleWithAdapter. <br><br><a name="summary"></a><h2> .    </h2><br> ,    ,     : <br><br><img src="https://habrastorage.org/webt/ww/ob/aq/wwobaqaf8ncw8fsfowcbdvipbvu.jpeg"><br><br>   ,   , , Web,       . <br><br>  (Properties Binding),   ,       ,    Relax Binding. <br><br>  — ,     :   , AOP  ,        ,   Spring Boot 2     . <br><br> , , ,  —   ,     Mockito 1  Mockito 2.    -  ,     ? <br><br><ul><li>  « » (YAGNI) </li><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">;</a> </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Migration Guide</a> ; </li><li>   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> </li></ul><br> -,   ,         ,     ,    YAGNI.   ,    -  ,     .  ,  ,     . <br><br> -,   - - ,     ,   ,     .     ,      ,  , ,       .           Migration Guide.  ,         ,   ,       ,  ,          . <br><br>     ,             Spring Boot. ,                 Spring Boot,     ,       …    . <br><blockquote>    ,  : <b>5-6   </b>  <b>JPoint</b> ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>  Spring Boot:      Spring Boot-  Java 8  Java 11.    — <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN439796/">https://habr.com/ru/post/zh-CN439796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN439786/index.html">审查IP电话Snom D712（和少许D710）</a></li>
<li><a href="../zh-CN439788/index.html">GOST Grasshopper和Stribog算法的另一个奇怪之处</a></li>
<li><a href="../zh-CN439790/index.html">测试JaCarta WebClient或将令牌存储在安全的环境中</a></li>
<li><a href="../zh-CN439792/index.html">NASA正在寻找美国航空业的合作伙伴，以创建部分可重复使用的载人着陆</a></li>
<li><a href="../zh-CN439794/index.html">背痛-从现代医学的角度理解</a></li>
<li><a href="../zh-CN439804/index.html">单元测试之禅</a></li>
<li><a href="../zh-CN439806/index.html">本地Docker容器的有效SSL域名</a></li>
<li><a href="../zh-CN439808/index.html">最大的望远镜。 从笔记本电脑和眼睛到340万像素相机和数据中心。 第一部分</a></li>
<li><a href="../zh-CN439810/index.html">了解Moleculer微服务框架</a></li>
<li><a href="../zh-CN439812/index.html">Kaggle在产品中实现CV的方法：您无法实施削减</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>