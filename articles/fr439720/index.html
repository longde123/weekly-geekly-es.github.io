<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò≥ üëµüèΩ üëâüèº Introduction √† la programmation: un jeu de tir 3D simple √† partir du sol pendant le week-end, partie 2 ‚úçüèø üë®üèª‚Äçüî¨ üë©üèº‚Äçü§ù‚Äçüë®üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous poursuivons la conversation sur le jeu de tir 3D ce week-end. Si quoi que ce soit, je vous rappelle que c'est la seconde moiti√©: 



- Premi√®re p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Introduction √† la programmation: un jeu de tir 3D simple √† partir du sol pendant le week-end, partie 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439720/">  Nous poursuivons la conversation sur le jeu de tir 3D ce week-end.  Si quoi que ce soit, je vous rappelle que c'est la seconde moiti√©: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Premi√®re partie: dessiner des murs</a> </li><li>  <b>Deuxi√®me partie: habiter notre interface monde + fen√™tre</b> </li></ul><br>  Comme je l'ai dit, je fais de mon mieux pour soutenir le d√©sir des √©l√®ves de faire quelque chose de leurs propres mains.  En particulier, lorsque je donne un cours sur l'introduction √† la programmation, puis comme exercices pratiques je leur laisse une libert√© presque totale.  Il n'y a que deux limitations: le langage de programmation (C ++) et le th√®me du projet, ce devrait √™tre un jeu vid√©o.  Voici un exemple de l'un des centaines de jeux cr√©√©s par mes √©tudiants de premi√®re ann√©e: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Ekomnk1eNFU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Malheureusement, la plupart des √©tudiants choisissent des jeux simples tels que des jeux de plateforme 2D.  J'√©cris cet article pour montrer que cr√©er l'illusion d'un monde en trois dimensions n'est pas plus difficile que de cloner mario broz. <br><a name="habracut"></a><br>  Je vous rappelle que nous nous sommes arr√™t√©s √† une √©tape qui vous permet de texturer les murs: <br><br><img src="https://raw.githubusercontent.com/ssloy/tinyraycaster/master/doc/012.gif"><br><br><hr><br><h1>  √âtape 13: dessinez des monstres sur la carte </h1><br>  Qu'est-ce qu'un monstre dans notre jeu?  Ce sont ses coordonn√©es et son num√©ro de texture: <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sprite</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x, y; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> tex_id; }; [..] <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;Sprite&gt; sprites{ {<span class="hljs-number"><span class="hljs-number">1.834</span></span>, <span class="hljs-number"><span class="hljs-number">8.765</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">5.323</span></span>, <span class="hljs-number"><span class="hljs-number">5.365</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">4.123</span></span>, <span class="hljs-number"><span class="hljs-number">10.265</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>} };</code> </pre> <br>  Apr√®s avoir d√©fini plusieurs monstres, pour commencer nous les dessinons simplement sur la carte: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/60f/15a/824/60f15a824cec0e8a93ff42f4d7a2722b.png"><br><br>  Les changements que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous pouvez voir ici</a> . <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://gitpod.io/&amp;usg=ALkJrhg0eCkGWdTvY1OuLIgIbPSqGQeStg#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Ouvrir dans gitpod"></a> <br><br><hr><br><h1>  √âtape 14: des carr√©s noirs au lieu de monstres en 3D </h1><br>  Nous allons maintenant dessiner des sprites dans la fen√™tre 3D.  Pour ce faire, nous devons d√©terminer deux choses: la position du sprite sur l'√©cran et sa taille.  Voici la fonction qui dessine un carr√© noir √† la place de chaque sprite: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw_sprite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sprite &amp;sprite, FrameBuffer &amp;fb, Player &amp;player, Texture &amp;tex_sprites)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// absolute direction from the player to the sprite (in radians) float sprite_dir = atan2(sprite.y - player.y, sprite.x - player.x); // remove unnecessary periods from the relative direction while (sprite_dir - player.a &gt; M_PI) sprite_dir -= 2*M_PI; while (sprite_dir - player.a &lt; -M_PI) sprite_dir += 2*M_PI; // distance from the player to the sprite float sprite_dist = std::sqrt(pow(player.x - sprite.x, 2) + pow(player.y - sprite.y, 2)); size_t sprite_screen_size = std::min(2000, static_cast&lt;int&gt;(fb.h/sprite_dist)); // do not forget the 3D view takes only a half of the framebuffer, thus fb.w/2 for the screen width int h_offset = (sprite_dir - player.a)*(fb.w/2)/(player.fov) + (fb.w/2)/2 - sprite_screen_size/2; int v_offset = fb.h/2 - sprite_screen_size/2; for (size_t i=0; i&lt;sprite_screen_size; i++) { if (h_offset+int(i)&lt;0 || h_offset+i&gt;=fb.w/2) continue; for (size_t j=0; j&lt;sprite_screen_size; j++) { if (v_offset+int(j)&lt;0 || v_offset+j&gt;=fb.h) continue; fb.set_pixel(fb.w/2 + h_offset+i, v_offset+j, pack_color(0,0,0)); } } }</span></span></code> </pre><br>  Voyons comment cela fonctionne.  Voici le sch√©ma: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/472/062/e0d/472062e0d02a32186987ee94f7364cdd.png"><br><br>  Dans la premi√®re ligne, nous consid√©rons l'angle absolu sprite_dir (l'angle entre la direction du joueur au sprite et l'abscisse).  L'angle relatif entre le sprite et la direction du regard est √©videmment obtenu en soustrayant simplement deux angles absolus: sprite_dir - player.a.  La distance du joueur au sprite est triviale √† calculer, et la taille du sprite est une simple division de la taille de l'√©cran par la distance.  Eh bien, juste au cas o√π, j'en couperais deux mille du haut pour ne pas avoir de carr√©s g√©ants (au fait, ce code peut facilement √™tre divis√© par z√©ro).  h_offset et v_offset donnent les coordonn√©es du coin sup√©rieur gauche du sprite sur l'√©cran;  puis une simple double boucle remplit notre carr√© de noir.  V√©rifiez avec un stylo et un morceau de papier que h_offset et v_offset sont correctement calcul√©s, dans mon commit il y a une erreur (non critique), croyez le code dans l'article :) Eh bien, le code le plus r√©cent dans le r√©f√©rentiel a √©galement √©t√© corrig√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/03a/795/77c/03a79577c9c0781121b529494b1dafe1.png"><br><br>  Les changements que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous pouvez voir ici</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://gitpod.io/&amp;usg=ALkJrhg0eCkGWdTvY1OuLIgIbPSqGQeStg#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Ouvrir dans gitpod"></a> <br><br><hr><br><h1>  √âtape 15: Carte de profondeur </h1><br>  Nos carr√©s sont miraculeusement bons, mais il n'y a qu'un seul probl√®me: le monstre lointain jette un coup d'≈ìil au coin et le carr√© est enti√®rement dessin√©.  Comment √™tre  Tr√®s simple.  Nous dessinons des sprites <b>apr√®s</b> le dessin des murs.  Par cons√©quent, pour chaque colonne de notre √©cran, nous connaissons la distance au mur le plus proche.  Nous enregistrons ces distances dans un tableau de 512 valeurs et passons le tableau √† la fonction de rendu de sprite.  Les sprites sont √©galement dessin√©s colonne par colonne, donc pour chaque colonne du sprite, nous comparerons la distance √† celle-ci avec la valeur de notre tableau de profondeur. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec8/1c3/71f/ec81c371f35f7ddff4086a8e1a51268b.png"><br>  Les changements que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous pouvez voir ici</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://gitpod.io/&amp;usg=ALkJrhg0eCkGWdTvY1OuLIgIbPSqGQeStg#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Ouvrir dans gitpod"></a> <br><br><hr><br><h1>  √âtape 16: probl√®me avec les sprites </h1><br>  Ils sont devenus de grands monstres, non?  Mais √† ce stade je n'ajouterai aucune fonctionnalit√©, au contraire, je vais tout casser en ajoutant un autre monstre: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/28f/5a8/9b8/28f5a89b8ea84373d9812c3e3a66d61d.png"><br>  Les changements que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous pouvez voir ici</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://gitpod.io/&amp;usg=ALkJrhg0eCkGWdTvY1OuLIgIbPSqGQeStg#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Ouvrir dans gitpod"></a> <br><br><hr><br><h1>  √âtape 17: tri des sprites </h1><br>  Quel √©tait le probl√®me?  Le probl√®me est que je peux avoir un ordre arbitraire de dessin de sprites, et pour chacun d'eux je compare sa distance avec les murs, mais pas avec d'autres sprites, de sorte que la cr√©ature √©loign√©e rampait sur la plus proche.  Est-il possible d'adapter une solution avec une carte de profondeur pour dessiner des sprites? <br><br><div class="spoiler">  <b class="spoiler_title">Texte masqu√©</b> <div class="spoiler_text">  La bonne r√©ponse est ¬´vous pouvez¬ª.  Mais comment?  √âcrivez dans les commentaires. <br></div></div><br>  J'irai dans l'autre sens, en r√©solvant le probl√®me b√™tement dans le front.  Je vais simplement dessiner tous les sprites du plus √©loign√© au plus √©loign√©.  Autrement dit, je vais trier les sprites par ordre d√©croissant de distance et les dessiner dans cet ordre. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/73c/820/c20/73c820c20c220093733774e6a1553a50.png"><br>  Les changements que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous pouvez voir ici</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://gitpod.io/&amp;usg=ALkJrhg0eCkGWdTvY1OuLIgIbPSqGQeStg#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Ouvrir dans gitpod"></a> <br><br><hr><br><h1>  √âtape 18: Heure SDL </h1><br>  Le temps est venu pour SDL.  Il existe de nombreuses biblioth√®ques de fen√™tres multiplateformes diff√©rentes, et je ne les comprends pas du tout.  Personnellement, j'aime <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">imgui</a> , mais pour une raison quelconque mes √©tudiants pr√©f√®rent SDL, donc je fais le lien avec lui.  La t√¢che de cette √©tape est tr√®s simple: cr√©ez une fen√™tre et affichez l'image de l'√©tape pr√©c√©dente: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ce/63a/9b5/7ce63a9b5ea3ca1c608fcdcf207d482e.png"><br><br>  Les changements que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous pouvez voir ici</a> .  Je ne donne plus de lien vers le gitpod, car  SDL dans le navigateur n'a pas encore appris √† d√©marrer :( <br><br>  <b>Mise √† jour: APPRIS!</b>  <b>Vous pouvez ex√©cuter le code en un clic dans le navigateur!</b> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://gitpod.io/&amp;usg=ALkJrhg0eCkGWdTvY1OuLIgIbPSqGQeStg#"><img src="https://habrastorage.org/getpro/habr/post_images/212/d5a/2a2/212d5a2a20d3071af82393c33309f62c.svg" alt="Ouvrir dans gitpod"></a> <br><br><h1>  √âtape 19: Traitement et nettoyage des √©v√©nements </h1><br>  Ajouter une r√©action aux frappes n'est m√™me pas dr√¥le, je ne d√©crirai pas.  Lors de l'ajout de SDL, j'ai supprim√© la d√©pendance sur stb_image.h.  C'est beau, mais √ßa prend trop de temps √† compiler. <br><br>  Pour ceux qui ne comprennent pas, les sources de la dix-neuvi√®me √©tape <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sont ici</a> .  Eh bien, voici une performance typique: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zPIVTqVilCM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h1>  Conclusion </h1><br>  Mon code ne contient pour le moment que 486 lignes, et en m√™me temps je ne les ai pas √©conomis√©es du tout: <br><br><pre> <code class="bash hljs">haqreu@daffodil:~/tinyraycaster$ cat *.cpp *.h | wc -l 486</code> </pre><br>  Je n'ai pas l√©ch√© mon code, jetant intentionnellement du linge sale.  Oui, j'√©cris comme √ßa (et pas seulement moi).  Un samedi matin, je me suis juste assis et j'ai √©crit ceci :) <br><br>  Je n'ai pas fait le jeu fini, ma t√¢che est seulement de donner une impulsion initiale au vol de votre imagination.  √âcrivez votre propre code, il sera probablement meilleur que le mien.  Partagez votre code, partagez vos id√©es, envoyez des demandes de tirage. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr439720/">https://habr.com/ru/post/fr439720/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr439710/index.html">Caract√©ristiques de la cr√©ation de produits pour le march√© am√©ricain</a></li>
<li><a href="../fr439712/index.html">March√©s publics: l'√©quilibre entre la gr√®ve italienne et le criminel russe</a></li>
<li><a href="../fr439714/index.html">Les Russes chez Apple: comment le n√¥tre a obtenu un contrat de plusieurs millions avec les Beatles et des chansons de ¬´certains Jerry¬ª</a></li>
<li><a href="../fr439716/index.html">Tails OS ou comment vous prot√©ger en ligne</a></li>
<li><a href="../fr439718/index.html">D√©veloppement d'applications sur Elixir / Phoenix avec Docker</a></li>
<li><a href="../fr439722/index.html">Effets des filtres SVG. Partie 2. D√©crire le texte avec feMorphology</a></li>
<li><a href="../fr439724/index.html">Aper√ßu des solutions AI et ML en 2018 et pr√©visions pour 2019: Partie 2 - Outils et biblioth√®ques, AutoML, RL, √©thique en IA</a></li>
<li><a href="../fr439726/index.html">Lock-in: vrai ou fiction?</a></li>
<li><a href="../fr439728/index.html">Configurer la sauvegarde et la restauration Zimbra OSE compl√®tes et s√©par√©es sans utiliser Zextras</a></li>
<li><a href="../fr439730/index.html">Organisation du r√©ducteur √† travers une classe standard</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>