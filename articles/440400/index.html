<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõçÔ∏è ‚ôéÔ∏è ‚úàÔ∏è Apache Kafka + Spring Boot: Hola, microservicios üïü üôÑ ü•Ç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! En esta publicaci√≥n, escribiremos una aplicaci√≥n en Spring Boot 2 usando Apache Kafka en Linux, desde la instalaci√≥n de JRE a una aplicaci√≥...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apache Kafka + Spring Boot: Hola, microservicios</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440400/"> Hola Habr!  En esta publicaci√≥n, escribiremos una aplicaci√≥n en Spring Boot 2 usando Apache Kafka en Linux, desde la instalaci√≥n de JRE a una aplicaci√≥n de microservicio que funcione. <br><br>  Los colegas del departamento de desarrollo front-end que vieron el art√≠culo se quejan de que no estoy explicando qu√© son Apache Kafka y Spring Boot.  Creo que cualquiera que necesite ensamblar un proyecto terminado utilizando las tecnolog√≠as anteriores sabe qu√© es y por qu√© lo necesita.  Si para el lector la pregunta no est√° inactiva, aqu√≠ hay excelentes art√≠culos sobre Habr, qu√© son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Apache Kafka</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Spring Boot</a> . <br><br>  Podemos prescindir de largas explicaciones de lo que son Kafka, Spring Boot y Linux, y en su lugar, ejecutar el servidor Kafka desde cero en una m√°quina Linux, escribir dos microservicios y hacer que uno de ellos env√≠e mensajes al otro, en general, configure Arquitectura completa de microservicios. <br><br><img src="https://habrastorage.org/webt/5d/p3/ab/5dp3abjx-c62zmfmmtp5tjvbjci.jpeg"><br><br>  La publicaci√≥n constar√° de dos secciones.  En el primero configuramos y ejecutamos Apache Kafka en una m√°quina Linux, en el segundo escribimos dos microservicios en Java. <br><a name="habracut"></a><br>  En el inicio, en el que comenc√© mi carrera profesional como programador, hab√≠a microservicios en Kafka, y uno de mis microservicios tambi√©n trabaj√≥ con otros a trav√©s de Kafka, pero no sab√≠a c√≥mo funcionaba el servidor, si estaba escrito como una aplicaci√≥n o si ya estaba completamente en caja producto.  ¬øCu√°l fue mi sorpresa y decepci√≥n cuando result√≥ que Kafka todav√≠a era un producto en caja, y mi tarea ser√≠a no solo escribir un cliente en Java (que me encanta hacer), as√≠ como implementar y configurar la aplicaci√≥n terminada como devOps (que yo odio hacer).  Sin embargo, incluso si pudiera subirlo al servidor virtual de Kafka en menos de un d√≠a, es realmente bastante simple hacerlo.  Entonces <br><br>  Nuestra aplicaci√≥n tendr√° la siguiente estructura de interacci√≥n: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wy/id/y5/wyidy5ttuw6eam5buszy6rb8z0m.jpeg"></div><br>  Al final de la publicaci√≥n, como de costumbre, habr√° enlaces a git con c√≥digo de trabajo. <br><br><h1>  Implemente Apache Kafka + Zookeeper en una m√°quina virtual </h1><br>  Trat√© de criar a Kafka en Linux local, en una amapola y en Linux remoto.  En dos casos (Linux), tuve √©xito bastante r√°pido.  Con la amapola no pas√≥ nada.  Por lo tanto, elevaremos Kafka en Linux.  Eleg√≠ Ubuntu 18.04. <br><br>  Para que Kafka funcione, ella necesita un Zookeeper.  Para hacer esto, debe descargarlo y ejecutarlo antes de iniciar Kafka. <br><br>  Entonces <br><br><h4>  0. Instalar JRE </h4><br>  Esto se realiza mediante los siguientes comandos: <br><br><pre><code class="bash hljs">sudo apt-get update sudo apt-get install default-jre</code> </pre> <br>  Si todo sali√≥ bien, entonces puedes ingresar el comando <br><br><pre> <code class="bash hljs">java -version</code> </pre> <br>  y aseg√∫rese de que Java est√© instalado. <br><br><h4>  1. Descargar Zookeeper </h4><br>  No me gustan los equipos m√°gicos en Linux, especialmente cuando solo dan algunos comandos y no est√° claro lo que est√°n haciendo.  Por lo tanto, describir√© cada acci√≥n, qu√© hace exactamente.  Por lo tanto, necesitamos descargar Zookeeper y descomprimirlo en una carpeta conveniente.  Es aconsejable que todas las aplicaciones se almacenen en la carpeta / opt, es decir, en nuestro caso ser√° / opt / zookeeper. <br><br>  Us√© el comando a continuaci√≥n.  Si conoce otros comandos de Linux que, en su opini√≥n, le permitir√°n hacer esto m√°s racialmente correctamente, √∫selos.  Soy un desarrollador, no un despojo, y me comunico con servidores al nivel de "la cabra misma".  Entonces, descargue la aplicaci√≥n: <br><br><pre> <code class="bash hljs">wget -P /home/xpendence/downloads/ <span class="hljs-string"><span class="hljs-string">"http://apache-mirror.rbc.ru/pub/apache/zookeeper/zookeeper-3.4.12/zookeeper-3.4.12.tar.gz"</span></span></code> </pre> <br>  La aplicaci√≥n se descarga en la carpeta que especifique, cre√© la carpeta / home / xpendence / downloads para descargar all√≠ todas las aplicaciones que necesito. <br><br><h4>  2. Desempaquete Zookeeper </h4><br>  Us√© el comando: <br><br><pre> <code class="bash hljs">tar -xvzf /home/xpendence/downloads/zookeeper-3.4.12.tar.gz</code> </pre> <br>  Este comando descomprime el archivo en la carpeta en la que se encuentra.  Es posible que deba transferir la aplicaci√≥n a / opt / zookeeper.  Y puede entrar de inmediato y desde all√≠ ya desempaquetar el archivo. <br><br><h4>  3. Editar configuraci√≥n </h4><br>  En la carpeta / zookeeper / conf / hay un archivo zoo-sample.cfg, sugiero cambiarle el nombre a zoo.conf, es este archivo el que JVM buscar√° en el inicio.  Lo siguiente debe agregarse a este archivo al final: <br><br><pre> <code class="bash hljs">tickTime=2000 dataDir=/var/zookeeper clientPort=2181</code> </pre> <br>  Adem√°s, cree el directorio / var / zookeeper. <br><br><h4>  4. Inicie Zookeeper </h4><br>  Vaya a la carpeta / opt / zookeeper e inicie el servidor con el comando: <br><br><pre> <code class="bash hljs">bin/zkServer.sh start</code> </pre> <br>  Deber√≠a aparecer "COMENZADO". <br><br>  Despu√©s de lo cual, propongo verificar que el servidor est√© funcionando.  Nosotros escribimos: <br><br><pre> <code class="bash hljs">telnet localhost 2181</code> </pre> <br>  Deber√≠a aparecer un mensaje de que la conexi√≥n fue un √©xito.  Si tiene un servidor d√©bil y el mensaje no apareci√≥, intente nuevamente, incluso cuando aparezca INICIADO, la aplicaci√≥n comienza a escuchar el puerto mucho m√°s tarde.  Cuando intent√© todo esto en un servidor d√©bil, me sucedi√≥ todo el tiempo.  Si todo est√° conectado, ingrese el comando <br><br><pre> <code class="bash hljs">ruok</code> </pre> <br>  ¬øQu√© significa: "¬øEst√°s bien?"  El servidor debe responder: <br><br><pre> <code class="bash hljs">imok ( !)</code> </pre> <br>  y desconectar.  Entonces, todo est√° de acuerdo al plan.  Procedemos a lanzar Apache Kafka. <br><br><h4>  5. Crear un usuario bajo Kafka </h4><br>  Para trabajar con Kafka necesitamos un usuario separado. <br><br><pre> <code class="bash hljs">sudo adduser --system --no-create-home --disabled-password --disabled-login kafka</code> </pre> <br><h4>  6. Descargar Apache Kafka </h4><br>  Hay dos distribuciones: binaria y fuentes.  Necesitamos un binario.  En apariencia, el archivo con el binario es diferente en tama√±o.  El binario pesa 59 MB y pesa 6.5 MB. <br><br>  Descargue el binario en el directorio all√≠, utilizando el siguiente enlace: <br><br><pre> <code class="bash hljs">wget -P /home/xpendence/downloads/ <span class="hljs-string"><span class="hljs-string">"http://mirror.linux-ia64.org/apache/kafka/2.1.0/kafka_2.11-2.1.0.tgz"</span></span></code> </pre> <br><h4>  7. Desempaquete Apache Kafka </h4><br>  El procedimiento de desempaque no es diferente del mismo para Zookeeper.  Tambi√©n desempaquetamos el archivo en el directorio / opt y le cambiamos el nombre a kafka para que la ruta a la carpeta / bin sea / opt / kafka / bin <br><br><pre> <code class="bash hljs">tar -xvzf /home/xpendence/downloads/kafka_2.11-2.1.0.tgz</code> </pre> <br><h4>  8. Editar configuraci√≥n </h4><br>  La configuraci√≥n est√° en /opt/kafka/config/server.properties.  Agrega una l√≠nea: <br><br><pre> <code class="bash hljs">delete.topic.enable = <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br>  Esta configuraci√≥n parece ser opcional, funciona sin ella.  Esta configuraci√≥n le permite eliminar temas.  De lo contrario, simplemente no puede eliminar temas a trav√©s de la l√≠nea de comando. <br><br><h4>  9. Damos acceso a los directorios kafka del usuario Kafka </h4><br><pre> <code class="bash hljs">chown -R kafka:nogroup /opt/kafka chown -R kafka:nogroup /var/lib/kafka</code> </pre> <br><h4>  10. El tan esperado lanzamiento de Apache Kafka </h4><br>  Ingresamos el comando, despu√©s del cual Kafka deber√≠a comenzar: <br><br><pre> <code class="bash hljs">/opt/kafka/bin/kafka-server-start.sh /opt/kafka/config/server.properties</code> </pre> <br>  Si las acciones habituales (Kafka est√° escrito en Java y Scala) no se desbordaron en el registro, entonces todo funcion√≥ y puede probar nuestro servicio. <br><br><h4>  10.1  Problemas de servidor d√©biles </h4><br>  Para los experimentos en Apache Kafka, tom√© un servidor d√©bil con un n√∫cleo y 512 MB de RAM (por solo 99 rublos), lo que result√≥ ser varios problemas para m√≠. <br><br>  Sin memoria  Por supuesto, no puede hacer overclock con 512 MB, y el servidor no pudo implementar Kafka debido a la falta de memoria.  El hecho es que, por defecto, Kafka consume 1 GB de memoria.  No es de extra√±ar que faltara :) <br><br>  Vamos a kafka-server-start.sh, zookeeper-server-start.sh.  Ya hay una l√≠nea que regula la memoria: <br><br><pre> <code class="java hljs">export KAFKA_HEAP_OPTS=<span class="hljs-string"><span class="hljs-string">"-Xmx1G -Xms1G"</span></span></code> </pre> <br>  C√°mbielo a: <br><br><pre> <code class="java hljs">export KAFKA_HEAP_OPTS=<span class="hljs-string"><span class="hljs-string">"-Xmx256M -Xms128M"</span></span></code> </pre> <br>  Esto reducir√° el apetito de Kafka y permitir√° que se inicie el servidor. <br><br>  El segundo problema con una computadora d√©bil es la falta de tiempo para conectarse a Zookeeper.  Por defecto, esto tiene 6 segundos.  Si el hierro es d√©bil, esto, por supuesto, no es suficiente.  En server.properties aumentamos el tiempo de conexi√≥n al zukipper: <br><br><pre> <code class="bash hljs">zookeeper.connection.timeout.ms=30000</code> </pre> <br>  Me puse medio minuto. <br><br><h4>  11. Pruebe el servidor Kafka </h4><br>  Para hacer esto, abriremos dos terminales, en una lanzaremos al productor, a la otra: el consumidor. <br>  En la primera consola, ingrese una l√≠nea: <br><br><pre> <code class="bash hljs">/opt/kafka/bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> /opt/kafka/bin/kafka-console-producer.sh --broker-list localhost:9092 --topic <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br>  Este √≠cono deber√≠a aparecer, indicando que el productor est√° listo para recibir mensajes de spam: <br><br><pre> <code class="bash hljs">&gt;</code> </pre> <br>  En la segunda consola, ingrese el comando: <br><br><pre> <code class="bash hljs">/opt/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> --from-beginning</code> </pre> <br>  Ahora, escribiendo en la consola del productor, cuando presiona Enter, aparecer√° en la consola del consumidor. <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/k7/uu/kf/k7uukff1u2kyygrgetrnvjnqmmg.png"></a> <br><br>  Si ve en la pantalla aproximadamente lo mismo que yo, felicidades, ¬°lo peor ya pas√≥! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/n7/rg/lz/n7rglz4s3wvbqzg_chzjjooiazw.jpeg"></div><br>  Ahora solo tenemos que escribir un par de clientes en Spring Boot que se comunicar√°n entre s√≠ a trav√©s de Apache Kafka. <br><br><h1>  Escribir una aplicaci√≥n en Spring Boot </h1><br>  Escribiremos dos aplicaciones que intercambiar√°n mensajes a trav√©s de Apache Kafka.  El primer mensaje se llamar√° kafka-server y contendr√° tanto al productor como al consumidor.  El segundo se llamar√° kafka-tester, est√° dise√±ado para que tengamos una arquitectura de microservicio. <br><br><h3>  servidor kafka </h3><br>  Para nuestros proyectos creados a trav√©s de Spring Initializr, necesitamos el m√≥dulo Kafka.  Agregu√© Lombok y Web, pero eso es cuesti√≥n de gustos. <br><br>  El cliente Kafka consta de dos componentes: el productor (env√≠a mensajes al servidor Kafka) y el consumidor (escucha al servidor Kafka y toma nuevos mensajes desde all√≠ sobre los temas a los que est√° suscrito).  Nuestra tarea es escribir ambos componentes y hacer que funcionen. <br><br>  Consumidor: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KafkaConsumerConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${kafka.server}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String kafkaServer; <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${kafka.group.id}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String kafkaGroupId; <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaListenerContainerFactory&lt;?&gt; batchFactory() { ConcurrentKafkaListenerContainerFactory&lt;Long, AbstractDto&gt; factory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentKafkaListenerContainerFactory&lt;&gt;(); factory.setConsumerFactory(consumerFactory()); factory.setBatchListener(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); factory.setMessageConverter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BatchMessagingMessageConverter(converter())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> factory; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaListenerContainerFactory&lt;?&gt; singleFactory() { ConcurrentKafkaListenerContainerFactory&lt;Long, AbstractDto&gt; factory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentKafkaListenerContainerFactory&lt;&gt;(); factory.setConsumerFactory(consumerFactory()); factory.setBatchListener(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); factory.setMessageConverter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringJsonMessageConverter()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> factory; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ConsumerFactory&lt;Long, AbstractDto&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">consumerFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultKafkaConsumerFactory&lt;&gt;(consumerConfigs()); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaListenerContainerFactory&lt;?&gt; kafkaListenerContainerFactory() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentKafkaListenerContainerFactory&lt;&gt;(); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Map&lt;String, Object&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">consumerConfigs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Map&lt;String, Object&gt; props = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaServer); props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, LongDeserializer.class); props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class); props.put(ConsumerConfig.GROUP_ID_CONFIG, kafkaGroupId); props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> props; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> StringJsonMessageConverter </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">converter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringJsonMessageConverter(); } }</code> </pre> <br>  Necesitamos 2 campos inicializados con datos est√°ticos de kafka.properties. <br><br><pre> <code class="java hljs">kafka.server=localhost:<span class="hljs-number"><span class="hljs-number">9092</span></span> kafka.group.id=server.broadcast</code> </pre> <br>  kafka.server es la direcci√≥n en la que se cuelga nuestro servidor, en este caso, local.  Por defecto, Kafka escucha en el puerto 9092. <br><br>  kafka.group.id es un grupo de consumidores, dentro del cual se entrega una instancia del mensaje.  Por ejemplo, tiene tres correos en un grupo, y todos escuchan el mismo tema.  Tan pronto como aparece un nuevo mensaje en el servidor con este tema, se entrega a alguien del grupo.  Los dos consumidores restantes no est√°n recibiendo el mensaje. <br><br>  A continuaci√≥n, estamos creando una f√°brica para consumidores: ConsumerFactory. <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ConsumerFactory&lt;Long, AbstractDto&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">consumerFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultKafkaConsumerFactory&lt;&gt;(consumerConfigs()); }</code> </pre> <br>  Inicializado con las propiedades que necesitamos, servir√° como una f√°brica est√°ndar para los consumidores en el futuro. <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Map&lt;String, Object&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">consumerConfigs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Map&lt;String, Object&gt; props = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaServer); props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, LongDeserializer.class); props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class); props.put(ConsumerConfig.GROUP_ID_CONFIG, kafkaGroupId); props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> props; }</code> </pre> <br>  consumerConfigs son solo configuraciones de mapas.  Proporcionamos la direcci√≥n del servidor, el grupo y los deserializadores. <br><br>  Adem√°s, uno de los puntos m√°s importantes para un consumidor.  El consumidor puede recibir tanto objetos individuales como colecciones, por ejemplo, StarshipDto y List.  Y si obtenemos StarshipDto como JSON, entonces obtenemos List como, m√°s o menos, como una matriz JSON.  Por lo tanto, tenemos al menos dos f√°bricas de mensajes: para mensajes individuales y para matrices. <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaListenerContainerFactory&lt;?&gt; singleFactory() { ConcurrentKafkaListenerContainerFactory&lt;Long, AbstractDto&gt; factory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentKafkaListenerContainerFactory&lt;&gt;(); factory.setConsumerFactory(consumerFactory()); factory.setBatchListener(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); factory.setMessageConverter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringJsonMessageConverter()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> factory; }</code> </pre> <br>  Instanciamos ConcurrentKafkaListenerContainerFactory, escribimos Long (clave de mensaje) y AbstractDto (valor de mensaje abstracto), e inicializamos sus campos con propiedades.  Nosotros, por supuesto, inicializamos la f√°brica con nuestra f√°brica est√°ndar (que ya contiene configuraciones de Mapa), luego marcamos que no escuchamos paquetes (las mismas matrices) y especificamos un convertidor JSON simple como el convertidor. <br><br>  Cuando creamos una f√°brica para paquetes / matrices (lote), la principal diferencia (aparte del hecho de que marcamos que escuchamos paquetes) es que especificamos como convertidor un convertidor de paquete especial que convertir√° paquetes que consisten en de cadenas JSON. <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaListenerContainerFactory&lt;?&gt; batchFactory() { ConcurrentKafkaListenerContainerFactory&lt;Long, AbstractDto&gt; factory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentKafkaListenerContainerFactory&lt;&gt;(); factory.setConsumerFactory(consumerFactory()); factory.setBatchListener(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); factory.setMessageConverter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BatchMessagingMessageConverter(converter())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> factory; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> StringJsonMessageConverter </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">converter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringJsonMessageConverter(); }</code> </pre> <br>  Y una cosa m√°s.  Al inicializar los Spring beans, el contenedor bajo el nombre kafkaListenerContainerFactory puede no contarse y la aplicaci√≥n se arruinar√°.  Seguramente hay opciones m√°s elegantes para resolver el problema, escriba sobre ellos en los comentarios, por ahora acabo de crear un contenedor descargado con funcionalidad con el mismo nombre: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KafkaListenerContainerFactory&lt;?&gt; kafkaListenerContainerFactory() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentKafkaListenerContainerFactory&lt;&gt;(); }</code> </pre> <br>  El consumidor est√° configurado.  Pasamos al productor. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KafkaProducerConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${kafka.server}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String kafkaServer; <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${kafka.producer.id}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String kafkaProducerId; <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Map&lt;String, Object&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">producerConfigs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Map&lt;String, Object&gt; props = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, kafkaServer); props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, LongSerializer.class); props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class); props.put(ProducerConfig.CLIENT_ID_CONFIG, kafkaProducerId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> props; } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ProducerFactory&lt;Long, StarshipDto&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">producerStarshipFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultKafkaProducerFactory&lt;&gt;(producerConfigs()); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> KafkaTemplate&lt;Long, StarshipDto&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kafkaTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ KafkaTemplate&lt;Long, StarshipDto&gt; template = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> KafkaTemplate&lt;&gt;(producerStarshipFactory()); template.setMessageConverter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringJsonMessageConverter()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> template; } }</code> </pre> <br>  De las variables est√°ticas, necesitamos la direcci√≥n del servidor kafka y el ID del productor.  √âl puede ser cualquier cosa. <br><br>  En las configuraciones, como vemos, no hay nada especial.  Casi lo mismo.  Pero con respecto a las f√°bricas, hay una diferencia significativa.  Debemos registrar una plantilla para cada clase, cuyos objetos enviaremos al servidor, as√≠ como una f√°brica para ello.  Tenemos uno de esos pares, pero puede haber docenas de ellos. <br><br>  En la plantilla, marcamos que serializaremos objetos en JSON, y esto, tal vez, es suficiente. <br><br>  Tenemos un consumidor y un productor, queda por escribir un servicio que enviar√° mensajes y los recibir√°. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-meta"><span class="hljs-meta">@Slf</span></span>4j <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StarshipServiceImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StarshipService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> KafkaTemplate&lt;Long, StarshipDto&gt; kafkaStarshipTemplate; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ObjectMapper objectMapper; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StarshipServiceImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(KafkaTemplate&lt;Long, StarshipDto&gt; kafkaStarshipTemplate, ObjectMapper objectMapper)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.kafkaStarshipTemplate = kafkaStarshipTemplate; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.objectMapper = objectMapper; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StarshipDto dto)</span></span></span><span class="hljs-function"> </span></span>{ kafkaStarshipTemplate.send(<span class="hljs-string"><span class="hljs-string">"server.starship"</span></span>, dto); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-meta"><span class="hljs-meta">@KafkaListener</span></span>(id = <span class="hljs-string"><span class="hljs-string">"Starship"</span></span>, topics = {<span class="hljs-string"><span class="hljs-string">"server.starship"</span></span>}, containerFactory = <span class="hljs-string"><span class="hljs-string">"singleFactory"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">consume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StarshipDto dto)</span></span></span><span class="hljs-function"> </span></span>{ log.info(<span class="hljs-string"><span class="hljs-string">"=&gt; consumed {}"</span></span>, writeValueAsString(dto)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeValueAsString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StarshipDto dto)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> objectMapper.writeValueAsString(dto); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (JsonProcessingException e) { e.printStackTrace(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">"Writing value to JSON failed: "</span></span> + dto.toString()); } } }</code> </pre> <br>  Solo hay dos m√©todos en nuestro servicio, son suficientes para que podamos explicar el trabajo del cliente.  Autoconectamos los patrones que necesitamos: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> KafkaTemplate&lt;Long, StarshipDto&gt; kafkaStarshipTemplate;</code> </pre> <br>  M√©todo del productor: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StarshipDto dto)</span></span></span><span class="hljs-function"> </span></span>{ kafkaStarshipTemplate.send(<span class="hljs-string"><span class="hljs-string">"server.starship"</span></span>, dto); }</code> </pre> <br>  Todo lo que se requiere para enviar un mensaje al servidor es llamar al m√©todo de env√≠o en la plantilla y transferir el tema (asunto) y nuestro objeto all√≠.  El objeto se serializar√° en JSON y volar√° al servidor bajo el tema especificado. <br><br>  El m√©todo de escucha se ve as√≠: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-meta"><span class="hljs-meta">@KafkaListener</span></span>(id = <span class="hljs-string"><span class="hljs-string">"Starship"</span></span>, topics = {<span class="hljs-string"><span class="hljs-string">"server.starship"</span></span>}, containerFactory = <span class="hljs-string"><span class="hljs-string">"singleFactory"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">consume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(StarshipDto dto)</span></span></span><span class="hljs-function"> </span></span>{ log.info(<span class="hljs-string"><span class="hljs-string">"=&gt; consumed {}"</span></span>, writeValueAsString(dto)); }</code> </pre> <br>  Marcamos este m√©todo con la anotaci√≥n @KafkaListener, donde indicamos cualquier ID que nos guste, temas escuchados y una f√°brica que convertir√° el mensaje recibido a lo que necesitamos.  En este caso, dado que aceptamos un objeto, necesitamos una sola f√°brica.  Para Lista &lt;?&gt;, Especifique batchFactory.  Como resultado, enviamos el objeto al servidor kafka usando el m√©todo de env√≠o y lo obtenemos usando el m√©todo de consumo. <br><br>  Puede escribir una prueba en 5 minutos que demostrar√° la fuerza completa de Kafka, pero iremos m√°s all√°: pase 10 minutos y escriba otra aplicaci√≥n que enviar√° mensajes al servidor que escuchar√° nuestra primera aplicaci√≥n. <br><br><h2>  kafka-tester </h2><br>  Teniendo la experiencia de escribir la primera aplicaci√≥n, podemos escribir f√°cilmente la segunda, especialmente si copiamos el paquete pegar y el paquete dto, registramos solo al productor (solo enviaremos mensajes) y agregaremos el √∫nico m√©todo de env√≠o al servicio.  Usando el siguiente enlace, puede descargar f√°cilmente el c√≥digo del proyecto y asegurarse de que no haya nada complicado all√≠. <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Scheduled</span></span>(initialDelay = <span class="hljs-number"><span class="hljs-number">10000</span></span>, fixedDelay = <span class="hljs-number"><span class="hljs-number">5000</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">produce</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ StarshipDto dto = createDto(); log.info(<span class="hljs-string"><span class="hljs-string">"&lt;= sending {}"</span></span>, writeValueAsString(dto)); kafkaStarshipTemplate.send(<span class="hljs-string"><span class="hljs-string">"server.starship"</span></span>, dto); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> StarshipDto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createDto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StarshipDto(<span class="hljs-string"><span class="hljs-string">"Starship "</span></span> + (LocalTime.now().toNanoOfDay() / <span class="hljs-number"><span class="hljs-number">1000000</span></span>)); }</code> </pre> <br>  Despu√©s de los primeros 10 segundos, kafka-tester comienza a enviar mensajes con los nombres de naves espaciales al servidor Kafka cada 5 segundos (se puede hacer clic en la imagen). <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/oo/ri/gk/oorigkqltxuntytvhzbarlninhk.png"></a> <br><br>  All√≠, son escuchados y recibidos por el servidor kafka (tambi√©n se puede hacer clic en la imagen). <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/cs/w-/vc/csw-vcgajjpjymkdxcwibqllnoi.png"></a> <br><br>  Espero que aquellos que sue√±an con comenzar a escribir microservicios en Kafka tengan √©xito tan f√°cilmente como yo.  Y aqu√≠ est√°n los enlaces a los proyectos: <br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">servidor kafka</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">kafka-tester</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/440400/">https://habr.com/ru/post/440400/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../440388/index.html">Intervalos: la pr√≥xima evoluci√≥n de C ++</a></li>
<li><a href="../440390/index.html">El mundo diverso de los sistemas embebidos y el lugar de Embox en √©l.</a></li>
<li><a href="../440392/index.html">WebRTC en su sitio: sin errores ni presupuesto</a></li>
<li><a href="../440394/index.html">Escalada de privilegios de PostgreSQL: an√°lisis de CVE-2018-10915</a></li>
<li><a href="../440398/index.html">Historia de participaci√≥n (y victoria) en la Copa AI rusa 2018 - CodeBall</a></li>
<li><a href="../440402/index.html">Desarrollador de SearchFace sobre las caracter√≠sticas del algoritmo</a></li>
<li><a href="../440404/index.html">"Arquitectura de la informaci√≥n": mitap en OZON</a></li>
<li><a href="../440410/index.html">Seleccionar, almacenar en cach√© y mostrar fotos en el mapa</a></li>
<li><a href="../440412/index.html">Zimbra Collaboration Suite y MS Exchange en el mismo dominio</a></li>
<li><a href="../440414/index.html">Sobre linter, calidad de c√≥digo, calidad en general y gesti√≥n de calidad</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>