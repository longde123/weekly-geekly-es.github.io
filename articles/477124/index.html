<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíπ ‚òÆÔ∏è üÜî Bitcoin en una jaula? üòè üàØÔ∏è üë©‚Äçüë©‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dio la casualidad de que soy un administrador profesional de sistemas inform√°ticos y redes (en resumen: sysadmin), y le dije al profesor. la actividad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bitcoin en una jaula?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477124/"><p> Dio la casualidad de que soy un administrador profesional de sistemas inform√°ticos y redes (en resumen: sysadmin), y le dije al profesor.  la actividad de una amplia variedad de sistemas, incluidos los que requieren [debido] a las medidas de seguridad mencionadas anteriormente.  Y result√≥ que hace alg√∫n tiempo encontr√© a <a href="https://www.lopp.net/bitcoin-information.html">Bitcoin</a> interesante para m√≠, y no solo lo us√©, sino que tambi√©n lanc√© varios microservicios para aprender a trabajar de forma independiente con la red de Bitcoin (despu√©s de todo, es p2p) desde el punto de vista del desarrollo (Yo, por supuesto, soy un gran desarrollador, as√≠ que pas√© por alto).  Pero no estoy hablando de desarrollo, estoy hablando de un entorno seguro y efectivo para las aplicaciones. </p><a name="habracut"></a><br><p>  Las tecnolog√≠as financieras ( <em>fintech</em> ) van junto con la seguridad de la informaci√≥n ( <em>infosec</em> ) y la primera puede funcionar sin la segunda, pero no por mucho tiempo.  Es por eso que quiero compartir mi experiencia y el conjunto de herramientas que uso, que incluye tanto <em>fintech</em> como <em>infosec</em> , y al mismo tiempo, tambi√©n se puede usar para un prop√≥sito m√°s amplio o completamente diferente.  En este art√≠culo, le contar√© no tanto sobre Bitcoin, sino sobre el modelo de infraestructura para el desarrollo y operaci√≥n de servicios financieros (y no solo), en una palabra, aquellos servicios en los que "B" es importante.  Esto se aplica tanto al intercambio de Bitcoin como al zool√≥gico corporativo m√°s t√≠pico de los servicios de una peque√±a empresa sin bitcoin de ninguna manera. </p><br><p>  Quiero se√±alar que soy partidario de los principios de <em>"mantenerlo est√∫pido simple"</em> y <em>"menos es m√°s"</em> , por lo que tanto el art√≠culo como el descrito en √©l tendr√°n las propiedades sobre las cuales se basan estos principios. </p><br><p>  <em>Escenario imaginario:</em> echemos un vistazo a un ejemplo de un intercambiador de bitcoin.  Decidimos comenzar a intercambiar rublos, d√≥lares, euros por bitcoins y viceversa, y ya tenemos una soluci√≥n de trabajo, pero por otro dinero digital como kiwi y webmoney, es decir.  Hemos cerrado todos los problemas legales, hay una aplicaci√≥n preparada que act√∫a como una pasarela de pago para rublos, d√≥lares y euros y otros sistemas de pago.  Est√° vinculado a nuestras cuentas bancarias y tiene alg√∫n tipo de API para nuestras aplicaciones finales.  Tambi√©n tenemos una aplicaci√≥n web que act√∫a como un intercambiador para los usuarios, como una cuenta t√≠pica de kiwi o webmoney: abra una cuenta, agregue una tarjeta, etc.  Se comunica con nuestra aplicaci√≥n de puerta de enlace, aunque utiliza la API REST en LAN.  Entonces decidimos conectar bitcoins y al mismo tiempo actualizar la infraestructura, porque  inicialmente todo se apresur√≥ en cajas virtuales en la oficina debajo de la mesa ... comenzaron a usar el sitio, y comenzamos a preocuparnos por el tiempo de actividad y el rendimiento. </p><br><p>  Entonces, comencemos con el principal: la selecci√≥n del servidor.  Porque  la empresa en nuestro ejemplo es peque√±a y confiamos en el host (OVH), elegiremos una <a href="https://www.kimsufi.com/">opci√≥n de presupuesto</a> en la que sea imposible instalar el sistema desde la imagen .iso original, pero no importa, el departamento de seguridad de TI definitivamente analizar√° la imagen instalada.  Y cuando crezcamos, generalmente alquilaremos nuestro armario con cerradura y llave con acceso f√≠sico limitado, o tal vez construiremos nuestro propio DC.  En cualquier caso, vale la pena recordar que al alquilar hierro e instalar im√°genes prefabricadas, existe la posibilidad de que su sistema tenga un "troyano del host", que en la mayor√≠a de los casos no est√° dise√±ado para rastrearlo, sino para ofrecer herramientas de administraci√≥n m√°s convenientes servidor </p><br><p>  <strong>Instalaci√≥n del servidor</strong> </p><br><p>  Todo es simple aqu√≠.  Elegimos hierro que se adapte a nuestras necesidades.  Luego seleccione la imagen de FreeBSD.  Bueno, o nos conectamos (en el caso de otro host y nuestro propio hardware) a trav√©s de IPMI o con un monitor y alimentamos la imagen .iso FreeBSD a la descarga.  Para instalaciones orquestales, uso <a href="https://github.com/ansible/ansible">Ansible</a> y <a href="https://mfsbsd.vx.sk/">mfsbsd</a> .  Lo √∫nico, en nuestro caso con kimsufi, elegimos <em>una instalaci√≥n personalizada</em> para que los dos discos en el espejo solo tuvieran "inicio" y / particiones de inicio "abiertas", el resto del espacio en disco se cifrar√°, pero m√°s sobre eso m√°s adelante. </p><br><p><img src="https://habrastorage.org/webt/-m/ve/av/-mveavdklaybhokh5sznmisf7be.png"></p><br><p>  El sistema se instala de la manera est√°ndar, no me detendr√© all√≠, solo noto que antes de comenzar la operaci√≥n vale la pena prestar atenci√≥n a las opciones de <em>endurecimiento</em> , que <code>bsdinstaller</code> ofrece al final de la instalaci√≥n (si instala el sistema usted mismo): </p><br><p><img src="https://habrastorage.org/webt/pj/6w/no/pj6wnohhskxkw6vqigcucollot0.png"></p><br><p>  Hay <a href="http://bsdadventures.com/harden-freebsd/">buen material</a> sobre este tema, en breve lo repetir√© aqu√≠. </p><br><p>  Es posible habilitar los par√°metros anteriores de la misma manera en un sistema ya instalado.  Para hacer esto, edite el archivo del gestor de arranque y habilite los par√°metros del kernel.  * <em>ee es un editor como este en BSD</em> </p><br><p> <code># ee /etc/rc.conf</code> </p> <br><pre> <code class="plaintext hljs">... #sec hard clear_tmp_enable="YES" syslogd_flags="-ss" sendmail_enable="NONE"</code> </pre><br><p> <code># ee /etc/sysctl.conf</code> </p> <br><pre> <code class="plaintext hljs">... #sec hard security.bsd.see_other_uids=0 security.bsd.see_other_gids=0 security.bsd.unprivileged_read_msgbuf=0 security.bsd.unprivileged_proc_debug=0 kern.randompid=$(jot -r 1 9999) security.bsd.stack_guard_page=1</code> </pre> <br><p>  Tambi√©n vale la pena asegurarse de tener instalada la √∫ltima versi√≥n del sistema y <a href="https://www.freebsd.org/doc/handbook/updating-upgrading-freebsdupdate.html">completar todas las actualizaciones</a> .  En nuestro caso, por ejemplo, se requiere una actualizaci√≥n a la √∫ltima versi√≥n, porque  las im√°genes previas a la instalaci√≥n tienen un retraso de seis meses a un a√±o.  Bueno, all√≠ cambiamos el puerto SSH a uno diferente de forma predeterminada, agregamos la autenticaci√≥n de clave y la deshabilitamos con una contrase√±a. </p><br><p>  Luego configuramos el <code>aide</code> , monitoreando el estado de los archivos de configuraci√≥n del sistema.  M√°s masticado se puede leer <a href="https://www.digitalocean.com/community/tutorials/how-to-install-aide-on-a-digitalocean-vps">aqu√≠</a> . </p><br><p> <code>pkg install aide</code> </p> <br><p>  y edite nuestro crontab </p><br><p> <code>crontab -e</code> </p> <br><p> <code>06 01 * * 0-6 /root/chkaide.sh</code> </p> <br><pre> <code class="plaintext hljs">#! /bin/sh #chkaide.sh MYDATE=`date +%Y-%m-%d` MYFILENAME="Aide-"$MYDATE.txt /bin/echo "Aide check !! `date`" &gt; /tmp/$MYFILENAME /usr/local/bin/aide --check &gt; /tmp/myAide.txt /bin/cat /tmp/myAide.txt|/usr/bin/grep -v failed &gt;&gt; /tmp/$MYFILENAME /bin/echo "**************************************" &gt;&gt; /tmp/$MYFILENAME /usr/bin/tail -20 /tmp/myAide.txt &gt;&gt; /tmp/$MYFILENAME /bin/echo "****************DONE******************" &gt;&gt; /tmp/$MYFILENAME</code> </pre> <br><p>  Active la <a href="https://www.freebsd.org/doc/handbook/audit-config.html">auditor√≠a del sistema</a> </p><br><p> <code>sysrc auditd_enable=YES</code> </p> <br><p> <code># service auditd start</code> </p> <br><p>  La forma de administrar este negocio est√° bien descrita en el <a href="https://www.freebsd.org/doc/handbook/audit-administration.html">manual</a> . </p><br><p>  Ahora reiniciamos y procedemos con el software en el servidor.  Cada servidor es un hipervisor para contenedores o m√°quinas virtuales completas.  Por lo tanto, es importante que el procesador sea compatible con VT-x y EPT si planeamos usar la virtualizaci√≥n completa. </p><br><p>  Como administrador de contenedores y m√°quinas virtuales, uso <a href="https://bsdstore.ru/">clevd</a> de <a href="https://github.com/olevole">olevole</a> , ¬°le deseo m√°s salud y beneficios para esta maravillosa utilidad! </p><br><p>  <strong>Contenedores?</strong>  <strong>¬øOtra vez docker o qu√©?</strong> </p><br><p>  Pero no  <a href="https://www.freebsd.org/doc/handbook/jails.html">FreeBSD Jails</a> es una gran herramienta de contenedorizaci√≥n, pero el <code>cbsd</code> mencionado <code>cbsd</code> para orquestar estos contenedores, cuyo nombre son celdas. </p><br><p>  Una celda es una soluci√≥n extremadamente efectiva para construir infraestructura para una variedad de prop√≥sitos, que en √∫ltima instancia requiere el aislamiento completo de servicios o procesos individuales.  Esto es esencialmente un clon del sistema host, pero no requiere la virtualizaci√≥n completa del hardware.  Y los recursos debido a esto no se gastan en un "SO hu√©sped", sino solo en el trabajo realizado.  Cuando las celdas se usan para necesidades internas, esta es una soluci√≥n muy conveniente para el uso √≥ptimo del recurso: un grupo de celdas en un servidor de hierro puede usar individualmente todo el recurso del servidor si es necesario.  Dado que generalmente los diferentes sub-servicios necesitan m√°s.  recursos en diferentes momentos, puede extraer el m√°ximo rendimiento de un servidor, si planifica y desequilibra las celdas entre los servidores correctamente.  Si es necesario, las celdas tambi√©n pueden establecer l√≠mites en el recurso utilizado. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/95c/817/901/95c8179015447a58c383f4a4a81a510d.gif" alt="imagen"></p><br><p>  <strong>¬øQu√© pasa con la virtualizaci√≥n completa?</strong> </p><br><p>  Hasta donde yo s√©, <code>cbsd</code> soporta el trabajo de los hipervisores <code>bhyve</code> y XEN.  Nunca us√© el segundo, pero el primero es un <a href="https://www.freebsd.org/doc/handbook/virtualization-host-bhyve.html">hipervisor</a> relativamente joven <a href="https://www.freebsd.org/doc/handbook/virtualization-host-bhyve.html">de FreeBSD</a> .  Veremos un ejemplo de uso de <code>bhyve</code> en el siguiente ejemplo. </p><br><p>  <strong>Instalar y configurar el entorno host</strong> </p><br><p>  Usamos FS <a href="https://www.freebsd.org/doc/handbook/zfs.html">ZFS</a> .  Esta es una herramienta extremadamente poderosa para administrar el espacio del servidor.  Gracias a ZFS, puede construir directamente matrices de varias configuraciones directamente desde discos, expandir din√°micamente el espacio "activo", cambiar discos muertos, administrar instant√°neas y mucho, mucho m√°s que se puede describir en una serie de art√≠culos.  Volvamos a nuestro servidor y sus discos.  Al comienzo de la instalaci√≥n en discos, dejamos espacio libre para particiones encriptadas.  Por qu√©  Esto es para que el sistema se eleve autom√°ticamente y escuche en SSH. </p><br><p> <code>gpart add -t freebsd-zfs /dev/ada0</code> </p> <br><p> <code>/dev/ada0p4 added!</code> </p> <br><p>  agregue la partici√≥n del disco al espacio restante </p><br><p> <code>geli init /dev/ada0p4</code> </p> <br><p>  maneje nuestra contrase√±a de cifrado </p><br><p> <code>geli attach /dev/ada0p4</code> </p> <br><p>  nuevamente ingrese la contrase√±a y tenemos el dispositivo /dev/ada0p4.eli - este es nuestro espacio encriptado.  Luego repetimos lo mismo para / dev / ada1 y otros discos en la matriz.  Y cree un nuevo <a href="https://www.freebsd.org/doc/handbook/zfs-zpool.html">grupo de ZFS</a> . </p><br><p>  <code>zpool create vms mirror /dev/ada0p4.eli /dev/ada1p4.eli /dev/ada3p4.eli</code> - bueno, ahora tenemos listo el conjunto m√≠nimo de combate.  Una matriz de discos reflejada en caso de que uno de los tres falle. </p><br><p>  Crear un conjunto de datos en el nuevo "grupo" </p><br><p> <code>zfs create vms/jails</code> </p> <br><p>  <code>pkg install cbsd</code> : ejecuta el comando e instala la administraci√≥n de nuestras celdas. </p><br><p>  Despu√©s de instalar <code>cbsd</code> , debe inicializarse: </p><br><p> <code># env workdir="/vms/jails" /usr/local/cbsd/sudoexec/initenv</code> </p> <br><p>  Bueno, respondemos un mont√≥n de preguntas, en su mayor√≠a respuestas por defecto. </p><br><p>  * Si usa cifrado, es importante que el demonio <code>cbsdd</code> se inicie autom√°ticamente hasta que descifre los discos de forma manual o autom√°tica (en nuestro ejemplo, zabbix hace esto) </p><br><p>  ** Adem√°s, no uso NAT de <code>cbsd</code> , sino que lo configuro yo mismo en <code>pf</code> . </p><br><p> <code># sysrc pf_enable=YES</code> </p> <br><p> <code># ee /etc/pf.conf</code> </p> <br><pre> <code class="plaintext hljs">IF_PUBLIC="em0" IP_PUBLIC="1.23.34.56" JAIL_IP_POOL="192.168.0.0/24" #WHITE_CL="{ 127.0.0.1 }" icmp_types="echoreq" set limit { states 20000, frags 20000, src-nodes 20000 } set skip on lo0 scrub in all #NAT for jails nat pass on $IF_PUBLIC from $JAIL_IP_POOL to any -&gt; $IP_PUBLIC ## Bitcoin network port forward IP_JAIL="192.168.0.1" PORT_JAIL="{8333}" rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL</code> </pre><br><p> <code># service pf start</code> </p> <br><p> <code># pfctl -f /etc/pf.conf</code> </p> <br><p>  La configuraci√≥n de las pol√≠ticas de firewall tambi√©n es un tema aparte, por lo que no profundizar√© en la configuraci√≥n de BLOQUEAR TODAS las pol√≠ticas y establecer listas blancas; puede hacerlo leyendo la <a href="https://www.freebsd.org/doc/handbook/firewalls-pf.html">documentaci√≥n oficial</a> o cualquiera de la gran cantidad de art√≠culos disponibles en Google. </p><br><p>  Bueno ... tenemos instalado cbsd, es hora de crear nuestro primer caballo de batalla: ¬°un demonio bitcoin en una jaula! </p><br><p> <code>cbsd jconstruct-tui</code> </p> <br><p><img src="https://habrastorage.org/webt/jf/yn/l5/jfynl5o0yozaua314r4e65yxy0y.png"></p><br><p>  Aqu√≠ vemos el di√°logo de creaci√≥n celular.  Despu√©s de configurar todos los valores, ¬°crea! </p><br><p>  Al crear la primera celda, debe elegir qu√© usar como base para las celdas.  Selecciono el kit de distribuci√≥n del repositorio de FreeBSD con el comando <code>repo</code> .  Esta elecci√≥n se realiza solo cuando se crea la primera celda de una versi√≥n espec√≠fica (puede alojar celdas de cualquier versi√≥n que sea anterior a la versi√≥n del host). </p><br><p>  Despu√©s de que todo est√© instalado, ¬°ejecute la celda! </p><br><p> <code># cbsd jstart bitcoind</code> </p> <br><p>  Pero necesitamos instalar software en la jaula. </p><br><p> <code># jls</code> </p> <br><pre> <code class="plaintext hljs"> JID IP Address Hostname Path 1 192.168.0.1 bitcoind.space.com /zroot/jails/jails/bitcoind</code> </pre> <br><p>  <code>jexec bitcoind</code> para entrar en la consola celular </p><br><p>  y ya dentro de la celda instalamos software con sus dependencias (nuestro sistema host permanece limpio) </p><br><p> <code>bitcoind:/@[15:25] # pkg install bitcoin-daemon bitcoin-utils</code> </p> <br><p> <code>bitcoind:/@[15:30] # sysrc bitcoind_enable=YES</code> </p> <br><p> <code>bitcoind:/@[15:30] # service bitcoind start</code> </p> <br><p>  Hay bitcoin en la celda, pero necesitamos el anonimato, porque queremos conectarnos a algunas celdas a trav√©s de la red TOP.  En general, tenemos planes para convertir la mayor√≠a de las celdas con software sospechoso solo a trav√©s de un proxy.  Gracias a <code>pf</code> puede deshabilitar NAT para un rango espec√≠fico de direcciones IP en la red local y permitir NAT solo para nuestro nodo TOR.  Por lo tanto, incluso si el malware ingresa a la c√©lula, lo m√°s probable es que no se ponga en contacto con el mundo exterior, y si lo hace, no revelar√° la IP de nuestro servidor.  por lo tanto, creamos una celda m√°s, para servicios de "reenv√≠o" como un servicio ".onion" y como un proxy para acceder a Internet a celdas individuales. </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart tor</code> </p> <br><p> <code># jexec tor</code> </p> <br><p> <code>tor:/@[15:38] # pkg install tor</code> </p> <br><p> <code>tor:/@[15:38] # sysrc tor_enable=YES</code> </p> <br><p> <code>tor:/@[15:38] # ee /usr/local/etc/tor/torrc</code> </p> <br><p>  Ponemos escuchar en la direcci√≥n local (disponible para todas las celdas) </p><br><p> <code>SOCKSPort 192.168.0.2:9050</code> </p> <br><p>  Lo que todav√≠a nos falta para la felicidad completa.  S√≠, necesitamos un servicio para nuestra web, quiz√°s no uno.  Ejecute nginx, que actuar√° como proxy inverso y se encargar√° de renovar los certificados Let's Encrypt </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart nginx-rev</code> </p> <br><p> <code># jexec nginx-rev</code> </p> <br><p> <code>nginx-rev:/@[15:47] # pkg install nginx py36-certbot</code> </p> <br><p>  <em>Y ahora ponemos 150 MB de dependencias en una jaula.</em>  <em>Y el anfitri√≥n todav√≠a est√° limpio.</em> </p><br><p>  Volvamos a configurar nginx m√°s tarde, necesitamos elevar dos celdas m√°s para nuestra pasarela de pago a nodejs and rust y una aplicaci√≥n web, que por alguna raz√≥n est√° en apache y pkhp, y la base de datos MySQL tambi√©n es necesaria para este √∫ltimo. </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart paygw</code> </p> <br><p> <code># jexec paygw</code> </p> <br><p> <code>paygw:/@[15:55] # pkg install git node npm</code> </p> <br><p> <code>paygw:/@[15:55] # curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh</code> </p> <br><p>  <em>... y otros 380 MB de paquetes de forma aislada</em> </p><br><p>  Luego, bombeamos nuestra aplicaci√≥n con git y la ejecutamos. </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart webapp</code> </p> <br><p> <code># jexec webapp</code> </p> <br><p> <code>webapp:/@[16:02] # pkg install mariadb104-server apache24 php74 mod_php74 php74-pdo_mysql</code> </p> <br><p>  <em>Paquetes de 450 MB.</em>  <em>en la jaula</em> </p><br><p>  aqu√≠ le damos acceso al desarrollador a trav√©s de SSH directamente a la celda, ellos har√°n todo por s√≠ mismos all√≠: </p><br><p> <code>webapp:/@[16:02] # ee /etc/ssh/sshd_config</code> </p> <br><p>  <code>Port 2267</code> : cambie el puerto de la celda SSH a cualquier arbitrario </p><br><p> <code>webapp:/@[16:02] # sysrc sshd_enable=YES</code> </p> <br><p> <code>webapp:/@[16:02] # service sshd start</code> </p> <br><p>  Bueno, el servicio se est√° ejecutando, queda agregar una regla en el firewall <code>pf</code> </p><br><p>  Veamos qu√© IP tenemos en las celdas y c√≥mo se ve nuestro "lokalka" </p><br><p> <code># jls</code> </p> <br><pre> <code class="plaintext hljs"> JID IP Address Hostname Path 1 192.168.0.1 bitcoind.space.com /zroot/jails/jails/bitcoind 2 192.168.0.2 tor.space.com /zroot/jails/jails/tor 3 192.168.0.3 nginx-rev.space.com /zroot/jails/jails/nginx-rev 4 192.168.0.4 paygw.space.com /zroot/jails/jails/paygw 5 192.168.0.5 webapp.my.domain /zroot/jails/jails/webapp</code> </pre> <br><p>  y agrega una regla </p><br><p> <code># ee /etc/pf.conf</code> </p> <br><pre> <code class="plaintext hljs">## SSH for web-Devs IP_JAIL="192.168.0.5" PORT_JAIL="{ 2267 }" rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL</code> </pre><br><p>  Bueno, ya que estamos aqu√≠, agregaremos la misma regla en el proxy inverso: </p><br><pre> <code class="plaintext hljs">## web-ports for nginx-rev IP_JAIL="192.168.0.3" PORT_JAIL="{ 80, 443 }" rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL</code> </pre> <br><p> <code># pfctl -f /etc/pf.conf</code> </p> <br><p>  <strong>Bueno, ahora un poco sobre bitcoins</strong> </p><br><p>  Lo que tenemos: tenemos una aplicaci√≥n web accesible desde el exterior y que se comunica localmente con nuestra pasarela de pago.  Ahora necesitamos preparar un entorno de trabajo para la interacci√≥n con la red bitcoin en s√≠ misma: el nodo <code>bitcoind</code> es solo un demonio que admite una copia local de la cadena de bloques actual.  Este demonio tiene funcionalidad RPC y billetera, pero hay "envoltorios" m√°s convenientes para desarrollar aplicaciones.  Para empezar, decidimos poner <code>electrum</code> : esta es una billetera CLI.  Utilizaremos <a href="https://electrum.org/">esta billetera</a> como un "almacenamiento en fr√≠o" para nuestros bitcoins, en general, esos bitcoins que deber√°n almacenarse "fuera" del sistema, accesibles para los usuarios y, en general, lejos de todos.  √âl tambi√©n tiene una GUI, por lo que vamos a usar la misma billetera en nuestro <br>  computadoras port√°tiles  Si bien usaremos el electrum con servidores p√∫blicos, y luego en otra celda <a href="https://github.com/kyuupichan/electrumx">elevaremos ElectrumX</a> , para que no dependa de nadie en absoluto. </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart electrum</code> </p> <br><p> <code># jexec electrum</code> </p> <br><p> <code>electrum:/@[8:45] # pkg install py36-electrum</code> </p> <br><p>  <em>otros 700 MB de software en nuestra jaula</em> </p><br><p> <code>electrum:/@[8:53] # adduser</code> </p> <br><pre> <code class="plaintext hljs">Username: wallet Full name: Uid (Leave empty for default): Login group [wallet]: Login group is wallet. Invite wallet into other groups? []: Login class [default]: Shell (sh csh tcsh nologin) [sh]: tcsh Home directory [/home/wallet]: Home directory permissions (Leave empty for default): Use password-based authentication? [yes]: no Lock out the account after creation? [no]: Username : wallet Password : &lt;disabled&gt; Full Name : Uid : 1001 Class : Groups : wallet Home : /home/wallet Home Mode : Shell : /bin/tcsh Locked : no OK? (yes/no): yes adduser: INFO: Successfully added (wallet) to the user database. Add another user? (yes/no): no Goodbye! electrum:/@[8:53] # su wallet</code> </pre> <br><p> <code>electrum:/@[8:53] # su wallet</code> </p> <br><p> <code>wallet@electrum:/ % electrum-3.6 create</code> </p> <br><pre> <code class="plaintext hljs">{ "msg": "Please keep your seed in a safe place; if you lose it, you will not be able to restore your wallet.", "path": "/usr/home/wallet/.electrum/wallets/default_wallet", "seed": "jealous win pig material ribbon young punch visual okay cactus random bird" }</code> </pre> <br><p>  Ahora hemos creado una billetera. </p><br><p> <code>wallet@electrum:/ % electrum-3.6 listaddresses</code> </p> <br><pre> <code class="plaintext hljs">[ "18WEhbjvMLGRMfwudzUrUd25U5C7uZYkzE", "14XHSejhxsZNDRtk4eFbqAX3L8rftzwQQU", "1KQXaN8RXiCN1ne9iYngUWAr6KJ6d4pPas", ... "1KeVcAwEYhk29qEyAfPwcBgF5mMMoy4qjw", "18VaUuSeBr6T2GwpSHYF3XyNgLyLCt1SWk" ]</code> </pre> <br><p> <code>wallet@electrum:/ % electrum-3.6 help</code> </p> <br><p>  De ahora en adelante, solo un c√≠rculo limitado de personas podr√° conectarse a nuestra billetera en <em>cadena</em> .  Para no abrir el acceso desde el exterior a esta celda, las conexiones SSH ocurrir√°n a trav√©s de TOR (una versi√≥n descentralizada de VPN).  Iniciamos SSH en la celda, pero no tocamos nuestro pf.conf en el host. </p><br><p> <code>electrum:/@[9:00] # sysrc sshd_enable=YES</code> </p> <br><p> <code>electrum:/@[9:00] # service sshd start</code> </p> <br><p>  Ahora apague el acceso a Internet a la celda con la billetera.  Le daremos una direcci√≥n IP desde otro espacio de subred que no est√© basado en NAT.  Primero, cambie <code>/etc/pf.conf</code> en el host </p><br><p> <code># ee /etc/pf.conf</code> </p> <br><p>  <code>JAIL_IP_POOL="192.168.0.0/24"</code> cambie a <code>JAIL_IP_POOL="192.168.0.0/25"</code> , por lo que todas las direcciones 192.168.0.126-255 no tendr√°n acceso directo a Internet.  Una especie de red de software "entrehierro".  Y la regla NAT permanece como estaba </p><br><p> <code>nat pass on $IF_PUBLIC from $JAIL_IP_POOL to any -&gt; $IP_PUBLIC</code> </p> <br><p>  Sobrecargando las reglas </p><br><p> <code># pfctl -f /etc/pf.conf</code> </p> <br><p>  Ahora toma nuestra jaula </p><br><p> <code># cbsd jconfig jname=electrum</code> </p> <br><p><img src="https://habrastorage.org/webt/mj/zo/ui/mjzouia2v_lhuzln_o9inimlwca.png"></p><br><p><img src="https://habrastorage.org/webt/_x/7-/c9/_x7-c9zdmlojjeqrpzfmv2j5fpc.png"></p><br><pre> <code class="plaintext hljs">jset mode=quiet jname=electrum ip4_addr="192.168.0.200" Remove old IP: /sbin/ifconfig em0 inet 192.168.0.6 -alias Setup new IP: /sbin/ifconfig em0 inet 192.168.0.200 alias ip4_addr: 192.168.0.200</code> </pre> <br><p>  Hmm, pero ahora el sistema mismo dejar√° de funcionar para nosotros.  Sin embargo, podemos especificar un proxy del sistema.  Pero hay una cosa, pero en TOR es un proxy SOCKS5, y por conveniencia tambi√©n tendr√≠amos un proxy HTTP. </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart polipo</code> </p> <br><p> <code># jexec polipo</code> </p> <br><p> <code>polipo:/@[9:28] # pkg install polipo</code> </p> <br><p> <code>polipo:/@[9:28] # ee /usr/local/etc/polipo/config</code> </p> <br><pre> <code class="plaintext hljs">socksParentProxy = "192.168.0.2:9050" socksProxyType = socks5</code> </pre> <br><p> <code>polipo:/@[9:42] # sysrc polipo_enable=YES</code> </p> <br><p> <code>polipo:/@[9:43] # service polipo start</code> </p> <br><p>  Bueno, ahora en nuestro sistema hay dos proxies, y ambos salen a trav√©s de TOR: socks5: //192.168.0.2: 9050 y <a href="http://192.168.0.6:8123/">http://192.168.0.6:8123</a> </p><br><p>  Ahora puedes personalizar el entorno de nuestra billetera </p><br><p> <code># jexec electrum</code> </p> <br><p> <code>electrum:/@[9:45] # su wallet</code> </p> <br><p> <code>wallet@electrum:/ % ee ~/.cshrc</code> </p> <br><pre> <code class="plaintext hljs">#in the end of file proxy config setenv http_proxy http://192.168.0.6:8123 setenv https_proxy http://192.168.0.6:8123</code> </pre> <br><p>  Bueno, ahora el shell funcionar√° desde un proxy.  Si desea instalar paquetes, entonces vale la pena agregarlos a <code>/usr/local/etc/pkg.conf</code> desde debajo de la ra√≠z de la celda </p><br><pre> <code class="plaintext hljs">pkg_env: { http_proxy: "http://my_proxy_ip:8123", }</code> </pre> <br><p>  Bueno, ahora es el momento de agregar el servicio oculto TOR como la direcci√≥n de nuestro servicio SSH en la celda de la billetera. </p><br><p> <code># jexec tor</code> </p> <br><p> <code>tor:/@[9:59] # ee /usr/local/etc/tor/torrc</code> </p> <br><pre> <code class="plaintext hljs">HiddenServiceDir /var/db/tor/electrum/ HiddenServicePort 22 192.168.0.200:22</code> </pre> <br><p> <code>tor:/@[10:01] # mkdir /var/db/tor/electrum</code> </p> <br><p> <code>tor:/@[10:01] # chown -R _tor:_tor /var/db/tor/electrum</code> </p> <br><p> <code>tor:/@[10:01] # chmod 700 /var/db/tor/electrum</code> </p> <br><p> <code>tor:/@[10:03] # service tor restart</code> </p> <br><p> <code>tor:/@[10:04] # cat /var/db/tor/electrum/hostname</code> </p> <br><pre> <code class="plaintext hljs">mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion</code> </pre> <br><p>  Aqu√≠ est√° nuestra direcci√≥n de conexi√≥n.  Vamos a ver desde la m√°quina local.  Pero primero debe agregar nuestra clave SSH: </p><br><p> <code>wallet@electrum:/ % mkdir ~/.ssh</code> </p> <br><p> <code>wallet@electrum:/ % ee ~/.ssh/authorized_keys</code> </p> <br><pre> <code class="plaintext hljs">ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBAG9Fk2Lqi4GQ8EXZrsH3EgSrVIQPQaAlS38MmJLBabihv9KHIDGXH7r018hxqLNNGbaJWO/wrWk7sG4T0yLHAbdQAFsMYof9kjoyuG56z0XZ8qaD/X/AjrhLMsIoBbUNj0AzxjKNlPJL4NbHsFwbmxGulKS0PdAD5oLcTQi/VnNdU7iFw== user@local</code> </pre> <br><p>  Bueno, desde la m√°quina Linux del cliente </p><br><p> <code>user@local ~$ nano ~/.ssh/config</code> </p> <br><pre> <code class="plaintext hljs">#remote electrum wallet Host remotebtc User wallet Port 22 Hostname mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion ProxyCommand /bin/ncat --proxy localhost:9050 --proxy-type socks5 %h %p</code> </pre><br><p>  Con√©ctese <em>(para que esto funcione, necesita un demonio TOR local que escuche en el 9050)</em> </p><br><p> <code>user@local ~$ ssh remotebtc</code> </p> <br><pre> <code class="plaintext hljs">The authenticity of host 'mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion (&lt;no hostip for proxy command&gt;)' can't be established. ECDSA key fingerprint is SHA256:iW8FKjhVF4yyOZB1z4sBkzyvCM+evQ9cCL/EuWm0Du4. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added 'mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion' (ECDSA) to the list of known hosts. FreeBSD 12.1-RELEASE-p1 GENERIC To save disk space in your home directory, compress files you rarely use with "gzip filename". -- Dru &lt;genesis@istar.ca&gt; wallet@electrum:~ % logout</code> </pre><br><p>  √âxito! </p><br><p>  Para trabajar con pagos instant√°neos y micropagos, tambi√©n necesitamos el nodo <a href="https://www.lopp.net/lightning-information.html">Lightning Network</a> , de hecho, esta ser√° nuestra principal herramienta de trabajo con bitcoin.  * <a href="https://github.com/ElementsProject/lightning">C-lightning</a> , que vamos a utilizar como demonio, tiene <a href="https://github.com/fiatjaf/sparko">un complemento Sparko</a> , que es una interfaz HTTP (REST) ‚Äã‚Äãcompleta y permite trabajar con transacciones fuera de la cadena y transacciones dentro de la cadena.  <code>c-lightning</code> requiere un nodo <code>bitcoind</code> para funcionar. </p><br><p>  * <em>Existen diferentes implementaciones en diferentes PL del protocolo Lightning Network.</em>  <em>De los que probamos c-lightning (escrito en C) parec√≠a ser el m√°s estable y eficiente en recursos</em> </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart cln</code> </p> <br><p> <code># jexec cln</code> </p> <br><p> <code>lightning:/@[10:23] # adduser</code> </p> <br><pre> <code class="plaintext hljs">Username: lightning ...</code> </pre> <br><p> <code>lightning:/@[10:24] # pkg install git</code> </p> <br><p> <code>lightning:/@[10:23] # su lightning</code> </p> <br><p> <code>cd ~ &amp;&amp; git clone https://github.com/ElementsProject/lightning</code> </p> <br><p> <code>lightning@lightning:~ % exit</code> </p> <br><p> <code>lightning:/@[10:30] # cd /home/lightning/lightning/</code> </p> <br><p> <code>lightning:/home/lightning/lightning@[10:31] # pkg install autoconf automake gettext git gmp gmake libtool python python3 sqlite3 libsodium py36-mako bash bitcoin-utils</code> </p> <br><p> <code>lightning:/home/lightning/lightning@[10:34] # ./configure &amp;&amp; gmake &amp;&amp; gmake install</code> </p> <br><p>  Si bien todo lo que necesita est√° compilado e instalado, cree el usuario RPC para <code>lightningd</code> en <code>bitcoind</code> </p><br><p> <code># jexec bitcoind</code> </p> <br><p> <code>bitcoind:/@[10:36] # ee /usr/local/etc/bitcoin.conf</code> </p> <br><pre> <code class="plaintext hljs">rpcbind=192.168.0.1 rpcuser=test rpcpassword=test #allow only c-lightning rpcallowip=192.168.0.7/32</code> </pre> <br><p> <code>bitcoind:/@[10:39] # service bitcoind restart</code> </p> <br><p>  <em>Mi cambio ca√≥tico entre celdas no es tan ca√≥tico si observa la utilidad <code>tmux</code> , que le permite crear muchas sub-sesiones de terminales dentro de una sesi√≥n.</em>  <em>Anal√≥gico: <code>screen</code></em> </p><br><p><img src="https://habrastorage.org/webt/xu/cz/14/xucz14wosjbbeme4iis8ws4nxq8.png"></p><br><p>  Dachshunds, no queremos que brille la IP real de nuestro nodo, y queremos realizar todas las transacciones financieras a trav√©s de TOP.  Por lo tanto, necesita un .onion m√°s. </p><br><p> <code># jexec tor</code> </p> <br><p> <code>tor:/@[9:59] # ee /usr/local/etc/tor/torrc</code> </p> <br><pre> <code class="plaintext hljs">HiddenServiceDir /var/db/tor/cln/ HiddenServicePort 9735 192.168.0.7:9735</code> </pre> <br><p> <code>tor:/@[10:01] # mkdir /var/db/tor/cln</code> </p> <br><p> <code>tor:/@[10:01] # chown -R _tor:_tor /var/db/tor/cln</code> </p> <br><p> <code>tor:/@[10:01] # chmod 700 /var/db/tor/cln</code> </p> <br><p> <code>tor:/@[10:03] # service tor restart</code> </p> <br><p> <code>tor:/@[10:04] # cat /var/db/tor/cln/hostname</code> </p> <br><pre> <code class="plaintext hljs">en5wbkavnytti334jc5uzaudkansypfs6aguv6kech4hbzpcz2ove3yd.onion</code> </pre> <br><p>  ahora crea una configuraci√≥n para c-lightning </p><br><p> <code>lightning:/home/lightning/lightning@[10:31] # su lightning</code> </p> <br><p> <code>lightning@lightning:~ % mkdir .lightning</code> </p> <br><p> <code>lightning@lightning:~ % ee .lightning/config</code> </p> <br><pre> <code class="plaintext hljs">alias=My-LN-Node bind-addr=192.168.0.7:9735 rgb=ff0000 announce-addr=en5wbkavnytti334jc5uzaudkansypfs6aguv6kech4hbzpcz2ove3yd.onion:9735 network=bitcoin log-level=info fee-base=0 fee-per-satoshi=1 proxy=192.168.0.2:9050 log-file=/home/lightning/.lightning/c-lightning.log min-capacity-sat=200000 # sparko plugin # https://github.com/fiatjaf/lightningd-gjson-rpc/tree/master/cmd/sparko sparko-host=192.168.0.7 sparko-port=9737 sparko-tls-path=sparko-tls #sparko-login=mywalletusername:mywalletpassword #sparko-keys=masterkey;secretread:+listchannels,+listnodes;secretwrite:+invoice,+listinvoices,+delinvoice,+decodepay,+waitpay,+waitinvoice sparko-keys=masterkey;secretread:+listchannels,+listnodes;ultrawrite:+invoice,+listinvoices,+delinvoice,+decodepay,+waitpay,+waitinvoice # for the example above the initialization logs (mixed with lightningd logs) should print something like</code> </pre> <br><p> <code>lightning@lightning:~ % mkdir .lightning/plugins</code> </p> <br><p> <code>lightning@lightning:~ % cd .lightning/plugins/</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins:% fetch https://github.com/fiatjaf/sparko/releases/download/v0.2.1/sparko_full_freebsd_amd64</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % mkdir ~/.lightning/sparko-tls</code> </p> <br><p> <code>lightning@lightning:~/.lightning/sparko-tls % cd ~/.lightning/sparko-tls</code> </p> <br><p> <code>lightning@lightning:~/.lightning/sparko-tls % openssl genrsa -out key.pem 2048</code> </p> <br><p> <code>lightning@lightning:~/.lightning/sparko-tls % openssl req -new -x509 -sha256 -key key.pem -out cert.pem -days 3650</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % chmod +x sparko_full_freebsd_amd64</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % mv sparko_full_freebsd_amd64 sparko</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % cd ~</code> </p> <br><p>  tambi√©n necesita crear un archivo de configuraci√≥n para bitcoin-cli, una utilidad que se comunica con <code>bitcoind</code> </p><br><p> <code>lightning@lightning:~ % mkdir .bitcoin</code> </p> <br><p> <code>lightning@lightning:~ % ee .bitcoin/bitcoin.conf</code> </p> <br><pre> <code class="plaintext hljs">rpcconnect=192.168.0.1 rpcuser=test rpcpassword=test</code> </pre> <br><p>  comprobar </p><br><p> <code>lightning@lightning:~ % bitcoin-cli echo "test"</code> </p> <br><pre> <code class="plaintext hljs">[ "test" ]</code> </pre> <br><p>  corre <code>lightningd</code> </p><br><p> <code>lightning@lightning:~ % lightningd --daemon</code> </p> <br><p>  <code>lightning-cli</code> se puede controlar mediante la <code>lightning-cli</code> , por ejemplo: </p><br><p>  <code>lightning-cli newaddr</code> <em>obtener direcci√≥n para el nuevo pago entrante</em> </p><br><pre> <code class="plaintext hljs">{ "address": "bc1q2n2ffq3lplhme8jufcxahfrnfhruwjgx3c78pv", "bech32": "bc1q2n2ffq3lplhme8jufcxahfrnfhruwjgx3c78pv" }</code> </pre> <br><p>  <code>lightning-cli withdraw bc1jufcxahfrnfhruwjgx3cq2n2ffq3lplhme878pv all</code> <em>enviar a la direcci√≥n todo el dinero de la billetera (todas las direcciones en cadena)</em> </p><br><p>  Adem√°s, los comandos para operaciones fuera de la cadena de <code>lightning-cli invoice</code> <code>lightning-cli listinvoices</code> , las <code>lightning-cli listinvoices</code> <code>lightning-cli pay</code> etc. </p><br><p>  Bueno, para la comunicaci√≥n con la aplicaci√≥n tenemos REST Api </p><br><p> <code>curl -k https://192.168.0.7:9737/rpc -d '{"method": "pay", "params": ["lnbc..."]}' -H 'X-Access masterkey'</code> </p> <br><p>  <strong>Para resumir</strong> </p><br><p> <code># jls</code> </p> <br><pre> <code class="plaintext hljs"> JID IP Address Hostname Path 1 192.168.0.1 bitcoind.space.com /zroot/jails/jails/bitcoind 2 192.168.0.2 tor.space.com /zroot/jails/jails/tor 3 192.168.0.3 nginx-rev.space.com /zroot/jails/jails/nginx-rev 4 192.168.0.4 paygw.space.com /zroot/jails/jails/paygw 5 192.168.0.5 webapp.my.domain /zroot/jails/jails/webapp 7 192.168.0.200 electrum.space.com /zroot/jails/jails/electrum 8 192.168.0.6 polipo.space.com /zroot/jails/jails/polipo 9 192.168.0.7 lightning.space.com /zroot/jails/jails/cln</code> </pre> <br><p><img src="https://habrastorage.org/webt/nt/0k/ew/nt0kewrhuin48nj-lbfk1jpa4rc.png"></p><br><p>     ,            . </p><br><p> <code># zfs list</code> </p> <br><pre> <code class="plaintext hljs">NAME USED AVAIL REFER MOUNTPOINT zroot 279G 1.48T 88K /zroot zroot/ROOT 1.89G 1.48T 88K none zroot/ROOT/default 1.89G 17.6G 1.89G / zroot/home 88K 1.48T 88K /home zroot/jails 277G 1.48T 404M /zroot/jails zroot/jails/bitcoind 190G 1.48T 190G /zroot/jails/jails-data/bitcoind-data zroot/jails/cln 653M 1.48T 653M /zroot/jails/jails-data/cln-data zroot/jails/electrum 703M 1.48T 703M /zroot/jails/jails-data/electrum-data zroot/jails/nginx-rev 190M 1.48T 190M /zroot/jails/jails-data/nginx-rev-data zroot/jails/paygw 82.4G 1.48T 82.4G /zroot/jails/jails-data/paygw-data zroot/jails/polipo 57.6M 1.48T 57.6M /zroot/jails/jails-data/polipo-data zroot/jails/tor 81.5M 1.48T 81.5M /zroot/jails/jails-data/tor-data zroot/jails/webapp 360M 1.48T 360M /zroot/jails/jails-data/webapp-data</code> </pre> <br><p>  , bitcoind   190  .          ?  ZFS   .   <code>cbsd jclone old=bitcoind new=bitcoind-clone host_hostname=clonedbtc.space.com</code>          .        ,               (   190 ) </p><br><p>       ZFS,    . <a href="https://www.freebsd.org/doc/handbook/zfs-zfs.html">ZFS   </a>     ,     SSH.    ,   . </p><br><p>        ,      <a href="https://zabbix.org/wiki/Main_Page">Zabbix</a> . </p><br><p> <strong> ‚Äî </strong> </p><br><p>   ,        : </p><br><p> <em></em> ‚Äî   UNIX-     .           ‚Äî .          .           .                   .       -,             . </p><br><p> <em></em> ‚Äî        . -       , ECC , ZFS  " "        .            .   -     . </p><br><p> <em></em> ‚Äî   .           .           .                (     ).           ,         . </p><br><p> <em> </em> ‚Äî            ,  .          ,               . </p><br><p>            ,     ,    ,         . </p><br><p> <strong>    ?</strong> </p><br><p>     cbsd  <a href="https://www.bsdstore.ru/en/11.2.x/wf_bcreate_ssi.html"> </a> .   ,    <code>bhyve</code>     . </p><br><p> <code># cat /etc/rc.conf</code> </p> <br><pre> <code class="plaintext hljs">... kld_list="vmm if_tap if_bridge nmdm" ...</code> </pre> <br><p> <code># cat /boot/loader.conf</code> </p> <br><pre> <code class="plaintext hljs">... vmm_load="YES" ...</code> </pre> <br><p>        ,   - debian  ! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ffd/cb6/219/ffdcb6219c701e2e114100d9601e9fea.gif"></p><br><p> <strong>  </strong> </p><br><p>       .          ‚Äî <a href="https://sochain.com/address/BTC/bc1qu7lhf45xw83ddll5mnzte6ahju8ktkeu6qhttc">bc1qu7lhf45xw83ddll5mnzte6ahju8ktkeu6qhttc</a> .          ,      <a href="https://bitclouds.sh/">pet-project</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/477124/">https://habr.com/ru/post/477124/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../477110/index.html">Planificaci√≥n entretenida</a></li>
<li><a href="../477114/index.html">Implementaci√≥n del int√©rprete MSH</a></li>
<li><a href="../477118/index.html">MIRO es una plataforma abierta de robot de interior. Parte 5 - Componente de software: ARDUINO (AVR), subimos "bajo el cap√≥"</a></li>
<li><a href="../477120/index.html">Software de monitorizaci√≥n continua de glucosa en sangre para Windows</a></li>
<li><a href="../477122/index.html">El cerebro de la empresa. Parte 3</a></li>
<li><a href="../477126/index.html">Administrador en 5 minutos. Frontend - react-admin, backend - Flask-RESTful</a></li>
<li><a href="../477128/index.html">Habra detective en el fin de semana</a></li>
<li><a href="../477130/index.html">"Eugene Onegin": inversi√≥n (historia N.-F.)</a></li>
<li><a href="../477132/index.html">Datos personales en la Federaci√≥n de Rusia: ¬øqui√©nes somos todos? A donde vamos</a></li>
<li><a href="../477136/index.html">C√≥mo FL.ru enga√±a a los usuarios vendiendo un servicio dos veces, rompiendo sus propias reglas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>