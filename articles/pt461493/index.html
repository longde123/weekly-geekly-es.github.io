<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§§ ‚òïÔ∏è üõï O Django 3.0 ser√° ass√≠ncrono üöù üëµüèª üì†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Andrew Godwin publicou o DEP 0009: Django compat√≠vel com Async em 9 de maio e foi aprovado pelo conselho t√©cnico do Django em 21 de julho. Portanto, e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O Django 3.0 ser√° ass√≠ncrono</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461493/"><p>  <em>Andrew Godwin publicou o <a href="">DEP 0009: Django compat√≠vel com Async</a> em 9 de maio e foi aprovado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pelo conselho t√©cnico do</a> Django em 21 de julho. Portanto, espera-se que, com o lan√ßamento do Django 3.0, eles tenham tempo para fazer algo interessante.</em>  <em>J√° foi mencionado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em algum lugar nos coment√°rios de Habr</a> , mas decidi transmitir essas not√≠cias para um p√∫blico mais amplo traduzindo-as - principalmente para aqueles que, como eu, n√£o seguem particularmente as not√≠cias do Django.</em> </p><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1153030952915890177"></twitter-widget><blockquote class="twitter-tweet" data-lang="en_US" data-twitter-extracted-i1582370706873615076="true"><p lang="en" dir="ltr">  Tenho o prazer de anunciar que o Conselho T√©cnico do Django aprovou o DEP 0009 (Async no Django)!  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://t.co/yaaR0Mjg61</a> </p> - Andrew Godwin (@andrewgodwin) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">21 de julho de 2019</a> </blockquote><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br><p>  O Python ass√≠ncrono foi desenvolvido por muitos anos e, no ecossistema do Django, n√≥s o experimentamos em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">canais</a> com o foco principal no suporte a soquetes da web. </p><br><p>  √Ä medida que o ecossistema se desenvolveu, tornou-se evidente que, embora n√£o houvesse necessidade urgente de estender o Django para suportar protocolos n√£o HTTP, como soquetes da Web, o suporte ass√≠ncrono traria muitos benef√≠cios para a estrutura tradicional de modelo de exibi√ß√£o de modelo do Django. </p><br><p>  Os benef√≠cios s√£o descritos na se√ß√£o Motiva√ß√£o abaixo, mas a conclus√£o geral a que cheguei √© que obtemos tanto do Django ass√≠ncrono que vale a pena o trabalho duro que √© necess√°rio.  Tamb√©m acredito que √© muito importante fazer altera√ß√µes de maneira iterativa e apoiada pela comunidade, que n√£o depender√° de um ou dois colaboradores antigos que possam se queimar. <a name="habracut"></a></p><br><p>  Embora o documento seja designado como DEP "Recurso", tudo isso significa que ele tamb√©m √© parcialmente um DEP de processo.  O escopo das altera√ß√µes abaixo √© incrivelmente grande, e √© prov√°vel que o lan√ßamento delas como um processo tradicional de recurso √∫nico falhe. </p><br><p>  Obviamente, ao longo deste documento, √© importante lembrar a filosofia do Django, que √© manter tudo seguro e compat√≠vel com vers√µes anteriores.  O plano n√£o √© remover o Django s√≠ncrono - o plano √© mant√™-lo em sua forma atual, mas adicionar assincronia como uma op√ß√£o para aqueles que pensam que precisam de desempenho ou flexibilidade extra. </p><br><p>  Este √© um trabalho gigantesco?  Claro.  Mas acho que isso nos permite mudar significativamente o futuro do Django - temos a oportunidade de adotar uma estrutura comprovada e uma comunidade incr√≠vel, e introduzir um conjunto completamente novo de op√ß√µes que antes eram imposs√≠veis. </p><br><p>  A web mudou, e o Django deve mudar com ela, mas de acordo com nossos ideais, seja acess√≠vel, seguro por padr√£o e flex√≠vel √† medida que os projetos crescem e suas necessidades mudam.  No mundo do data warehousing em nuvem, arquitetura orientada a servi√ßos e back-end como base da l√≥gica de neg√≥cios complexa, a capacidade de fazer as coisas de forma competitiva √© essencial. </p><br><p>  Esta DEP esbo√ßa um plano que acho que nos levar√° at√© l√°.  Esta √© uma vis√£o em que realmente acredito e com a qual trabalharei para ajudar a fazer todo o poss√≠vel.  Ao mesmo tempo, justifica-se uma an√°lise cuidadosa e ceticismo;  Pe√ßo suas cr√≠ticas construtivas e sua confian√ßa.  O Django conta com uma comunidade de pessoas e com os aplicativos que eles criam, e se precisarmos determinar o caminho para o futuro, devemos faz√™-lo juntos. </p><br><h2 id="kratkoe-opisanie">  Breve descri√ß√£o </h2><br><p>  N√≥s vamos adicionar suporte para representa√ß√µes ass√≠ncronas, middleware, ORM e outros elementos importantes no Django. </p><br><p>  Isso ser√° feito executando o c√≥digo s√≠ncrono nos encadeamentos, substituindo-o gradualmente pelo c√≥digo ass√≠ncrono.  APIs s√≠ncronas continuar√£o a existir e ser√£o totalmente suportadas e, com o tempo, se transformar√£o em inv√≥lucros s√≠ncronos para c√≥digo inicialmente ass√≠ncrono. </p><br><p>  O modo ASGI iniciar√° o Django como um aplicativo ass√≠ncrono nativo.  O modo WSGI acionar√° um loop de eventos separado toda vez que o Django for acessado, para que a camada ass√≠ncrona seja compat√≠vel com o servidor s√≠ncrono. </p><br><p>  A multithreading em torno dos ORMs √© complexa e requer um novo conceito de contextos de conex√£o e threads persistentes para executar o c√≥digo ORM s√≠ncrono. </p><br><p>  Muitas partes do Django continuar√£o trabalhando em sincronia, e nossa prioridade ser√° oferecer suporte aos usu√°rios que escrevem visualiza√ß√µes nos dois estilos, permitindo que eles escolham o melhor estilo para a apresenta√ß√£o em que est√£o trabalhando. </p><br><p>  Algumas fun√ß√µes, como modelos e armazenamento em cache, precisar√£o de DEPs e estudos separados sobre como torn√°-los completamente ass√≠ncronos.  Essa DEP se concentra principalmente no fluxo de exibi√ß√£o de HTTP-middleware e no ORM. </p><br><p>  Haver√° compatibilidade com vers√µes anteriores.  Um projeto Django 2.2 padr√£o deve ser executado no Django ass√≠ncrono (seja 3.0 ou 3.1) sem altera√ß√µes. </p><br><p>  Esta proposta est√° focada na implementa√ß√£o de pequenas partes iterativas com sua coloca√ß√£o gradual no ramo mestre para evitar problemas com uma bifurca√ß√£o de longa dura√ß√£o e nos permite mudar de rumo √† medida que os problemas s√£o descobertos. </p><br><p>  Esta √© uma boa oportunidade para atrair novos membros.  Precisamos financiar o projeto para que isso aconte√ßa mais rapidamente.  O financiamento deve estar em uma escala √† qual n√£o estamos acostumados. </p><br><h2 id="specifikaciya">  Especifica√ß√£o </h2><br><p>  O objetivo geral √© fazer com que todas as partes do Django, que podem estar bloqueando - isto √©, n√£o apenas os c√°lculos ligados √† CPU - se tornem ass√≠ncronas (executadas em um loop de eventos ass√≠ncrono sem bloqueios). </p><br><p>  Isso inclui os seguintes recursos: </p><br><ul><li>  Camadas intermedi√°rias (Middleware) </li><li>  Visualiza√ß√µes </li><li>  ORM </li><li>  Padr√µes </li><li>  Teste </li><li>  Armazenamento em cache </li><li>  Valida√ß√£o de formul√°rio </li><li>  E-mail </li></ul><br><p>  No entanto, isso n√£o inclui coisas como internacionaliza√ß√£o, que n√£o trar√° nenhum ganho de desempenho, pois √© uma tarefa vinculada √† CPU que tamb√©m √© executada rapidamente ou migra√ß√µes que s√£o segmentadas por um √∫nico elemento quando iniciadas pelo comando de gerenciamento. </p><br><p>  Cada fun√ß√£o individual que se torna ass√≠ncrona por dentro tamb√©m fornecer√° uma interface s√≠ncrona compat√≠vel com a API atual (em 2.2) no futuro pr√≥ximo - poder√≠amos alter√°-la com o tempo para melhor√°-las, mas as APIs s√≠ncronas n√£o v√£o a lugar algum. </p><br><p>  Uma vis√£o geral de como isso √© tecnicamente alcan√ßado √© apresentada abaixo e, em seguida, s√£o fornecidos detalhes de implementa√ß√£o espec√≠ficos para √°reas espec√≠ficas.  N√£o √© exaustivo para todas as fun√ß√µes do Django, mas se atingirmos esse objetivo inicial, incluiremos quase todos os casos de uso. </p><br><p>  A parte final desta se√ß√£o, ‚ÄúProcedimento‚Äù, tamb√©m discute como essas mudan√ßas podem ser implementadas gradualmente e por v√°rias equipes de desenvolvimento em paralelo, o que √© importante para concluir essas altera√ß√µes com a ajuda de volunt√°rios em um per√≠odo de tempo razo√°vel. </p><br><h3 id="tehnicheskiy-obzor">  Revis√£o t√©cnica </h3><br><p>  O princ√≠pio que nos permite manter implementa√ß√µes s√≠ncronas e ass√≠ncronas em paralelo √© a capacidade de executar um estilo dentro de outro. </p><br><p>  Cada fun√ß√£o passar√° por tr√™s est√°gios de implementa√ß√£o: </p><br><ul><li>  Somente s√≠ncrona (estamos aqui) </li><li>  Implementa√ß√£o s√≠ncrona com wrapper ass√≠ncrono </li><li>  Implementa√ß√£o ass√≠ncrona com wrapper s√≠ncrono </li></ul><br><h4 id="asinhronnaya-obyortka">  Wrapper ass√≠ncrono </h4><br><p>  Primeiro, o c√≥digo s√≠ncrono existente ser√° agrupado em uma interface ass√≠ncrona, que executa o c√≥digo s√≠ncrono no pool de threads.  Isso nos permitir√° projetar e fornecer uma interface ass√≠ncrona de forma relativamente r√°pida, sem precisar reescrever todo o c√≥digo dispon√≠vel para assincronia. </p><br><p> O kit de ferramentas para isso j√° est√° dispon√≠vel no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">asgiref</a> como uma fun√ß√£o <code>sync_to_async</code> , que suporta coisas como tratamento de exce√ß√µes ou <code>sync_to_async</code> (mais sobre isso abaixo). </p><br><p>  A execu√ß√£o de c√≥digo em encadeamentos provavelmente n√£o levar√° a um aumento de produtividade - a sobrecarga exibida provavelmente diminuir√° um pouco quando voc√™ executar o c√≥digo linear normal - mas isso permitir√° que os desenvolvedores comecem a executar algo competitivamente e se acostumem a novos recursos. </p><br><p>  Al√©m disso, existem v√°rias partes do Django que s√£o sens√≠veis a iniciar no <em>mesmo</em> thread com acesso repetido;  por exemplo, processando transa√ß√µes no banco de dados.  Se empacot√°ssemos algum c√≥digo em <code>atomic()</code> que acessaria o ORM por meio de encadeamentos aleat√≥rios retirados do pool, a transa√ß√£o n√£o teria efeito, pois estava vinculada √† conex√£o dentro do encadeamento no qual a transa√ß√£o foi iniciada. </p><br><p>  Nessas situa√ß√µes, √© necess√°rio um "encadeamento", no qual o contexto ass√≠ncrono chama seq√ºencialmente todo o c√≥digo s√≠ncrono no mesmo encadeamento, em vez de empurr√°-lo para o conjunto de encadeamentos, mantendo o comportamento correto do ORM e de outras partes sens√≠veis ao encadeamento.  Todas as partes do Django que suspeitamos que sejam necess√°rias, incluindo todo o ORM, usar√£o a vers√£o <code>sync_to_async</code> , que leva isso em conta, para que tudo esteja seguro por padr√£o.  Os usu√°rios poder√£o desativ√°-lo seletivamente para execu√ß√£o competitiva de consultas - para obter mais detalhes, consulte "ORM" abaixo. </p><br><h4 id="asinhronnaya-realizaciya">  Implementa√ß√£o ass√≠ncrona </h4><br><p>  A pr√≥xima etapa √© reescrever a implementa√ß√£o da fun√ß√£o em c√≥digo ass√≠ncrono e, em seguida, apresentar a interface s√≠ncrona por meio de um wrapper que executa o c√≥digo ass√≠ncrono em um loop de evento √∫nico.  Isso j√° est√° dispon√≠vel no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">asgiref</a> como uma fun√ß√£o <code>async_to_sync</code> . </p><br><p>  N√£o √© necess√°rio reescrever todas as fun√ß√µes de uma s√≥ vez para pular rapidamente para o terceiro est√°gio.  Podemos concentrar nossos esfor√ßos nas partes que podemos fazer bem e que t√™m o apoio de bibliotecas de terceiros, enquanto ajudamos o restante do ecossistema Python em coisas que exigem mais trabalho para implementar a assincronia nativa;  Isso √© discutido abaixo. </p><br><p>  Esta vis√£o geral funciona com quase todas as fun√ß√µes do Django que devem se tornar ass√≠ncronas, exceto naqueles lugares para os quais o Python n√£o fornece equivalentes de fun√ß√µes ass√≠ncronas que j√° usamos.  O resultado ser√° uma mudan√ßa na forma como o Django apresenta sua API no modo ass√≠ncrono ou trabalhando com os desenvolvedores principais do Python para ajudar a desenvolver recursos ass√≠ncronos do Python. </p><br><h3 id="threadlocals">  Threadlocals </h3><br><p>  Um dos detalhes b√°sicos da implementa√ß√£o do Django que precisa ser mencionado separadamente da maioria das fun√ß√µes descritas abaixo √© o threadlocals.  Como o nome sugere, threadlocals funcionam em um thread e, embora o Django mantenha o objeto <code>HttpRequest</code> fora do threadlocal, colocamos algumas outras coisas nele - por exemplo, conex√µes com o banco de dados ou o idioma atual. </p><br><p>  O uso de threadlocals pode ser dividido em duas op√ß√µes: </p><br><ul><li>  ‚ÄúLocais de contexto‚Äù, onde um valor √© necess√°rio em algum contexto baseado em pilha, como uma solicita√ß√£o.  Isso √© necess√°rio para definir o idioma atual. </li><li>  "Threadlocals verdadeiros", onde o c√≥digo protegido √© realmente inseguro para chamadas de outro thread.  Isso √© para conectar-se ao banco de dados. </li></ul><br><p>  √Ä primeira vista, pode parecer que ‚Äúlocais de contexto‚Äù podem ser resolvidos usando o novo m√≥dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">contextvars</a> no Python, mas o Django 3.0 ainda precisar√° suportar o Python 3.6, enquanto este m√≥dulo apareceu na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">vers√£o</a> 3.7.  Al√©m disso, o <code>contextvars</code> projetado especificamente para se livrar do contexto ao alternar, por exemplo, para um novo encadeamento, enquanto precisamos salvar esses valores para permitir que as fun√ß√µes <code>async_to_sync</code> e <code>async_to_sync</code> funcionem normalmente como wrappers.  Quando o Django suporta apenas 3.7 e posterior, podemos considerar o uso de <code>contextvars</code> , mas isso exigiria um trabalho consider√°vel no Django. </p><br><p>  Isso j√° foi resolvido com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">asgiref</a> <code>Local</code> , que √© compat√≠vel com corotinas e threads.  Agora ele n√£o usa <code>contextvars</code> , mas podemos <code>contextvars</code> lo para trabalhar com o backport for 3.6 ap√≥s alguns testes. </p><br><p>  Os threadlocals verdadeiros, por outro lado, podem simplesmente continuar trabalhando no thread atual.  No entanto, devemos ter mais cuidado para impedir que esses objetos vazem para outro fluxo;  quando a apresenta√ß√£o n√£o √© mais executada no mesmo encadeamento, mas gera um encadeamento para cada chamada ORM (durante a fase "implementa√ß√£o s√≠ncrona, wrapper ass√≠ncrona"), algumas coisas poss√≠veis no modo s√≠ncrono n√£o ser√£o poss√≠veis no modo ass√≠ncrono. </p><br><p>  Isso exigir√° aten√ß√£o especial e a proibi√ß√£o de algumas opera√ß√µes anteriormente poss√≠veis no modo ass√≠ncrono;  Os casos que conhecemos s√£o descritos abaixo em se√ß√µes espec√≠ficas. </p><br><h3 id="odnovremennaya-podderzhka-sinhronnogo-i-asinhronnogo-interfeysov">  Suporte simult√¢neo para interfaces s√≠ncronas e ass√≠ncronas </h3><br><p>  Um dos grandes problemas que encontraremos ao tentar portar o Django √© que o Python n√£o permite criar vers√µes s√≠ncronas e ass√≠ncronas de uma fun√ß√£o com o mesmo nome. </p><br><p>  Isso significa que voc√™ n√£o pode simplesmente pegar e criar uma API que funcione dessa maneira: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   value = cache.get("foo") #   value = await cache.get("bar")</span></span></code> </pre> <br><p>  Essa √© uma limita√ß√£o infeliz da maneira como o Python √© implementado de forma ass√≠ncrona, e n√£o h√° solu√ß√£o √≥bvia.  Quando algo √© chamado, voc√™ n√£o sabe se estar√° aguardando ou n√£o; portanto, n√£o h√° como determinar o que precisa ser devolvido. </p><br><p>  (Nota: isso ocorre porque o Python implementa fun√ß√µes ass√≠ncronas como "uma chamada s√≠ncrona que retorna uma corotina", em vez de algo como "chamar o m√©todo <code>__acall__</code> em um objeto". Os gerenciadores e iteradores de contexto ass√≠ncronos n√£o t√™m esse problema, porque eles t√™m m√©todos separados <code>__aiter__</code> e <code>__aenter__</code> .) </p><br><p>  Com isso em mente, devemos colocar os namespaces das implementa√ß√µes s√≠ncronas e ass√≠ncronas separadamente um do outro para que n√£o entrem em conflito.  Poder√≠amos fazer isso com o argumento nomeado <code>sync=True</code> , mas isso leva a corpos confusos de fun√ß√µes / m√©todos e evita o uso de <code>async def</code> , al√©m de permitir que voc√™ acidentalmente esque√ßa de escrever esse argumento.  Uma chamada aleat√≥ria para um m√©todo s√≠ncrono quando voc√™ deseja cham√°-lo de forma ass√≠ncrona √© perigosa. </p><br><p>  A solu√ß√£o proposta para a maioria dos locais na base de c√≥digo do Django √© fornecer um sufixo para nomes de implementa√ß√µes ass√≠ncronas de fun√ß√µes - por exemplo, <code>cache.get_async</code> al√©m de <code>cache.get</code> s√≠ncrono.  Embora essa seja uma solu√ß√£o feia, facilita muito a detec√ß√£o de erros ao exibir o c√≥digo (voc√™ deve usar <code>_async</code> com o m√©todo <code>_async</code> ). </p><br><h3 id="predstavleniya-i-obrabotka-http">  Exibi√ß√µes e manipula√ß√£o de HTTP </h3><br><p>  As visualiza√ß√µes s√£o provavelmente a pedra angular da utilidade da assincronia, e esperamos que a maioria dos usu√°rios escolha entre c√≥digo ass√≠ncrono e s√≠ncrono. </p><br><p>  O Django suportar√° dois tipos de visualiza√ß√µes: </p><br><ul><li>  Representa√ß√µes s√≠ncronas, definidas como agora, por uma fun√ß√£o ou classe s√≠ncrona com <code>__call__</code> s√≠ncrona </li><li>  Representa√ß√µes ass√≠ncronas definidas por uma fun√ß√£o ass√≠ncrona (retornando uma corotina) ou uma classe com <code>__call__</code> ass√≠ncrona. </li></ul><br><p>  Eles ser√£o tratados pelo <code>BaseHandler</code> , que verificar√° a exibi√ß√£o recebida do resolvedor de URL e a chamar√° de acordo.  O manipulador base deve ser a primeira parte do Django a se tornar ass√≠ncrono, e precisaremos modificar o manipulador WSGI para cham√°-lo em seu pr√≥prio loop de eventos usando <code>async_to_sync</code> . </p><br><p>  Camadas intermedi√°rias (middleware) ou configura√ß√µes como <code>ATOMIC_REQUESTS</code> , que <code>ATOMIC_REQUESTS</code> as visualiza√ß√µes em c√≥digo n√£o ass√≠ncrono (por exemplo, o bloco <code>atomic()</code> ), continuar√£o funcionando, mas sua velocidade ser√° afetada (por exemplo, a proibi√ß√£o de chamadas ORM paralelas dentro da visualiza√ß√£o com <code>atomic()</code> ) </p><br><p>  A classe <code>StreamingHttpResponse</code> existente ser√° modificada para poder aceitar um iterador s√≠ncrono ou ass√≠ncrono e, em seguida, sua implementa√ß√£o interna ser√° sempre ass√≠ncrona.  Da mesma forma para <code>FileResponse</code> .  Como esse √© um poss√≠vel ponto de incompatibilidade com vers√µes anteriores do c√≥digo de terceiros que acessa diretamente os objetos Response, ainda precisamos fornecer um <code>__iter__</code> s√≠ncrono para o per√≠odo de transi√ß√£o. </p><br><p>  O WSGI continuar√° a ser suportado pelo Django indefinidamente, mas o manipulador do WSGI passar√° a executar middleware ass√≠ncrono e visualiza√ß√µes em seu pr√≥prio loop de eventos √∫nicos.  √â prov√°vel que isso leve a uma ligeira diminui√ß√£o no desempenho, mas nas experi√™ncias iniciais n√£o teve muito impacto. </p><br><p>  Todas as fun√ß√µes HTTP ass√≠ncronas funcionar√£o dentro do WSGI, incluindo pesquisas longas e respostas lentas, mas ser√£o t√£o ineficientes quanto s√£o agora, ocupando um encadeamento / processo para cada conex√£o.  Os servidores ASGI ser√£o os √∫nicos que podem suportar com efici√™ncia muitas solicita√ß√µes simult√¢neas, al√©m de lidar com protocolos n√£o HTTP, como o WebSocket, para uso por extens√µes como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">canais</a> . </p><br><h3 id="promezhutochnye-sloi">  Camadas intermedi√°rias </h3><br><p>  Enquanto a se√ß√£o anterior se concentrou principalmente no caminho de solicita√ß√£o / resposta, o middleware precisa de uma se√ß√£o separada devido √† complexidade inerente ao seu design atual. </p><br><p>  Os middlewares do Django agora s√£o organizados na forma de uma pilha na qual cada middleware recebe <code>get_response</code> para executar o pr√≥ximo na ordem do middleware (ou a exibi√ß√£o do middleware mais baixo na pilha).  No entanto, precisamos manter uma mistura de middleware s√≠ncrono e ass√≠ncrono para compatibilidade com vers√µes anteriores, e esses dois tipos n√£o poder√£o acessar um ao outro nativamente. </p><br><p>  Portanto, para garantir que o middleware funcione, teremos que inicializar cada middleware com o espa√ßo reservado get_response, que retorna o controle de volta ao manipulador e lida com a transfer√™ncia de dados entre o middleware e a visualiza√ß√£o e o lan√ßamento da exce√ß√£o.  De certa forma, eventualmente parecer√° o middleware da era do Django 1.0 de um ponto de vista interno, embora, obviamente, a API do usu√°rio permane√ßa a mesma. </p><br><p>  Podemos declarar obsoleto o middleware s√≠ncrono, mas recomendo n√£o fazer isso t√£o cedo.  Se e quando chegarmos ao final do ciclo de obsolesc√™ncia, poderemos retornar a implementa√ß√£o do middleware para um modelo de pilha puramente recursivo, como √© agora. </p><br><h3 id="orm">  ORM </h3><br><p>  ORM √© a maior parte do Django em termos de tamanho de c√≥digo e a mais dif√≠cil de converter para ass√≠ncrona. </p><br><p>  Isso se deve principalmente ao fato de os drivers de banco de dados subjacentes serem s√≠ncronos por design e o progresso ser lento em rela√ß√£o a um conjunto de drivers de banco de dados ass√≠ncronos, padronizados e maduros.  Em vez disso, devemos projetar um futuro no qual os drivers de banco de dados sejam inicialmente s√≠ncronos e estabelecer as bases para os contribuidores que continuar√£o a desenvolver drivers ass√≠ncronos de maneira iterativa. </p><br><p>  Os problemas com o ORM se enquadram em duas categorias principais - threads e bloqueio impl√≠cito. </p><br><h4 id="potoki">  Streams </h4><br><p>  O principal problema com o ORM √© que o Django √© projetado em torno de um √∫nico objeto de <code>connections</code> globais, o que, magicamente, fornece a conex√£o correta para o encadeamento atual. </p><br><p>  Em um mundo ass√≠ncrono - onde todas as corotinas trabalham no mesmo segmento - isso n√£o √© apenas irritante, mas simplesmente perigoso.  Sem nenhuma seguran√ßa adicional, um usu√°rio que acessa um ORM como de costume arrisca quebrar objetos de conex√£o acessando-o de v√°rios locais diferentes. </p><br><p>  Felizmente, os objetos de conex√£o s√£o pelo menos port√°teis entre os threads, embora n√£o possam ser chamados de dois threads ao mesmo tempo.  O Django j√° se preocupa com a seguran√ßa de threads para drivers de banco de dados no c√≥digo ORM, e por isso temos um lugar para alterar seu comportamento para funcionar corretamente. </p><br><p>  Modificaremos o objeto de <code>connections</code> para que ele entenda as corotinas e os threads - reutilizando algum c√≥digo do <code>asgiref.local</code> , mas com a adi√ß√£o de l√≥gica adicional.  As conex√µes ser√£o compartilhadas em c√≥digo ass√≠ncrono e s√≠ncrono que se chama - com o contexto passando por <code>sync_to_async</code> e <code>async_to_sync</code> - e o c√≥digo s√≠ncrono ser√° for√ßado a executar sequencialmente em um thread <code>async_to_sync</code> , portanto, isso n√£o funcionar√° quebrando ao mesmo tempo a seguran√ßa da linha. </p><br><p>  Isso implica que precisamos de uma solu√ß√£o como um gerenciador de contexto para abrir e fechar uma conex√£o com o banco de dados, como <code>atomic()</code> .  Isso nos permitir√° fornecer uma chamada consistente e threads persistentes nesse contexto e permitir que os usu√°rios criem m√∫ltiplos contextos se desejarem abrir v√°rias conex√µes.  Tamb√©m nos oferece uma maneira potencial de nos livrarmos de <code>connections</code> m√°gicas globais, se quisermos desenvolver isso ainda mais. </p><br><p>  No momento, o Django n√£o possui gerenciamento do ciclo de vida da conex√£o que seja independente dos sinais da classe manipuladora e, portanto, os usaremos para criar e limpar esses "contextos de conex√£o".  A documenta√ß√£o tamb√©m ser√° atualizada para tornar mais claro como lidar adequadamente com conex√µes fora do ciclo de solicita√ß√£o / resposta;  mesmo no c√≥digo atual, muitos usu√°rios n√£o sabem que qualquer equipe de gerenciamento de longa dura√ß√£o deve chamar periodicamente <code>close_old_connections</code> para funcionar corretamente. </p><br><p>  Compatibilidade com vers√µes anteriores significa que devemos permitir que os usu√°rios acessem <code>connections</code> de qualquer c√≥digo aleat√≥rio a qualquer momento, mas s√≥ permitiremos isso para c√≥digo s√≠ncrono;  garantiremos que o c√≥digo seja agrupado em um "contexto de conex√£o", se for ass√≠ncrono, desde o primeiro dia. </p><br><p>  Pode parecer bom adicionar <code>transaction.atomic()</code> al√©m de <code>transaction.atomic()</code> e exigir que o usu√°rio execute todo o c√≥digo em um deles, mas isso pode causar confus√£o sobre o que acontece se voc√™ anexar um deles est√° dentro do outro. </p><br><p>  Em vez disso, sugiro a cria√ß√£o de um novo gerenciador de contexto <code>db.new_connections()</code> que habilite esse comportamento e fa√ßa com que ele crie uma nova conex√£o sempre que for chamada, e permita aninhamento <code>atomic()</code> arbitr√°rio <code>atomic()</code> dentro dele. </p><br><p>  Cada vez que voc√™ <code>new_connections()</code> bloco <code>new_connections()</code> , o Django configura um novo contexto com novas conex√µes com o banco de dados.  Todas as transa√ß√µes realizadas fora do bloco continuam;  qualquer chamada ORM dentro do bloco funciona com uma nova conex√£o com o banco de dados e o ver√° desse ponto de vista.  Se o isolamento da transa√ß√£o estiver ativado no banco de dados, como normalmente √© feito por padr√£o, isso significa que novas conex√µes dentro do bloco podem n√£o ver as altera√ß√µes feitas por quaisquer transa√ß√µes n√£o confirmadas fora dele. </p><br><p>  Al√©m disso, as conex√µes dentro desse bloco <code>new_connections</code> podem usar <code>atomic()</code> para acionar transa√ß√µes adicionais nessas novas conex√µes.  Qualquer aninhamento desses dois gerenciadores de contexto √© permitido, mas cada vez que <code>new_connections</code> usadas, transa√ß√µes abertas anteriormente s√£o "suspensas" e n√£o afetam as chamadas ORM at√© que um novo bloco de novas <code>new_connections</code> seja <code>new_connections</code> . </p><br><p>  Um exemplo de como essa API pode parecer: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_authors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pattern)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Create a new context to call concurrently async with db.new_connections(): return [ author.name async for author in Authors.objects.filter(name__icontains=pattern) ] async def get_books(pattern): # Create a new context to call concurrently async with db.new_connections(): return [ book.title async for book in Book.objects.filter(name__icontains=pattern) ] async def my_view(request): # Query authors and books concurrently task_authors = asyncio.create_task(get_authors("an")) task_books = asyncio.create_task(get_books("di")) return render( request, "template.html", { "books": await task_books, "authors": await task_authors, }, )</span></span></code> </pre> <br><p>  Isso √© um pouco detalhado, mas o objetivo tamb√©m √© adicionar atalhos de alto n√≠vel para ativar esse comportamento (e tamb√©m cobrir a transi√ß√£o de <code>asyncio.ensure_future</code> no Python 3.6 para <code>asyncio.create_task</code> na 3.7). </p><br><p>  Usando esse gerenciador de contexto e fluxos persistentes no mesmo contexto de conex√£o, garantimos que todo o c√≥digo ser√° o mais seguro poss√≠vel por padr√£o.  existe a possibilidade de o usu√°rio poder usar a conex√£o em um encadeamento para duas partes diferentes da solicita√ß√£o usando <code>yield</code> , mas isso <code>yield</code> √© poss√≠vel agora. </p><br><h4 id="neyavnye-blokirovki">  Bloqueios impl√≠citos </h4><br><p>  Outro problema do design atual do ORM √© que opera√ß√µes de bloqueio (relacionadas √† rede), em particular campos relacionados √† leitura, s√£o encontradas nas inst√¢ncias do modelo. </p><br><p>  Se voc√™ pegar uma inst√¢ncia de modelo e acessar <code>model_instance.related_field</code> , o Django carregar√° o conte√∫do do modelo associado de forma transparente e o retornar√° para voc√™.  No entanto, isso n√£o √© poss√≠vel no c√≥digo ass√≠ncrono - o c√≥digo de bloqueio n√£o deve ser executado no encadeamento principal e n√£o h√° acesso ass√≠ncrono aos atributos. </p><br><p>  Felizmente, o Django j√° tem uma maneira de resolver isso - <code>select_related</code> , que carrega os campos relacionados antecipadamente, e <code>prefetch_related</code> para relacionamentos muitos-para-muitos.  Se voc√™ usar o ORM de forma ass√≠ncrona, proibiremos qualquer opera√ß√£o de bloqueio impl√≠cito, como acesso em segundo plano a atributos, e retornaremos um erro indicando que voc√™ deve primeiro recuperar o campo. </p><br><p>  Isso tem o benef√≠cio adicional de impedir o c√≥digo lento que executa solicita√ß√µes N em um loop <code>for</code> , o que √© um erro comum de muitos novos programadores do Django.  Isso aumenta a barreira de entrada, mas lembre-se de que o Django ass√≠ncrono ser√° opcional - os usu√°rios ainda poder√£o escrever c√≥digo s√≠ncrono se desejarem (e isso ser√° incentivado no tutorial, pois √© muito mais dif√≠cil cometer erros no c√≥digo s√≠ncrono). </p><br><p>  Felizmente, o <code>QuerySet</code> pode implementar facilmente geradores ass√≠ncronos e dar suporte transparente √† sincroniza√ß√£o e assincronia: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> data = [] <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> user <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> User.objects.all(): data.append(<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> extract_important_info(user)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> render(<span class="hljs-string"><span class="hljs-string">"template.html"</span></span>, data)</code> </pre> <br><h4 id="drugoe">  Outros </h4><br><p>  Partes do ORM associadas a altera√ß√µes de esquema n√£o ser√£o ass√≠ncronas;  eles devem ser chamados apenas de equipes de gerenciamento.  Alguns projetos j√° os chamam de envios, mas essa n√£o √© uma boa ideia. </p><br><h3 id="shablony">  Padr√µes </h3><br><p>  Os modelos agora s√£o completamente s√≠ncronos, e o plano √© deix√°-los assim na primeira etapa.     ,      ,     DEP. </p><br><p>  ,  Jinja2   ,              . </p><br><p>  ,         Django     ,       .  Jinja2       ,    ,        ,    . </p><br><p>       ,     <code>render_async</code> ,   <code>render</code> ;      ,   ,        . </p><br><h3 id="keshirovanie">  </h3><br><p>    Django      ‚Äî     <code>_async</code> -  (, <code>get_async</code> , <code>set_async</code> ). </p><br><p>   ,       API  <code>sync_to_async</code> ,    <code>BaseCache</code> . </p><br><p> ,     thread-safety   API ,   Django,        ,       .    ,     ORM, ,      . </p><br><h3 id="formy">  </h3><br><p>         ,        ,    ,     <code>ModelForm</code>  ORM     . </p><br><p>  ,   -   <code>clean</code>  <code>save</code> ,  ,   . ,      ,  ,                         DEP. </p><br><h3 id="email"> Email </h3><br><p>         Django,      .    <code>send_mail_async</code>  <code>send_mail</code> ,   <code>async</code> -        (, <code>mail_admins</code> ). </p><br><p>         Django  ,    -  SMTP,     .  , ,      ,      ,   . </p><br><h3 id="testirovanie">  Teste </h3><br><p>     ,      Django  . </p><br><p>     ASGI-     <code>asgiref.testing.ApplicationCommunicator</code> .             assert'  . </p><br><p>    Django        ,    ,      .  ,      ‚Äî     ,    ,        HTTP    event loop,    WSGI. </p><br><p>                .  ,      ,      . </p><br><p>   ,     ,      .       <code>async def</code>    <code>@async_to_sync</code> ,       , ,    Django test runner. </p><br><p>        asyncio (   loop'  ,    )   , , ,   <code>DEBUG=True</code> .          ‚Äî   ,       ,       . </p><br><h3 id="websockets"> WebSockets </h3><br><p>       Django;      ,   Channels   ,        ASGI,      . </p><br><p>    ,         Channels,        ,     ASGI. </p><br><h3 id="poryadok-deystviy">   </h3><br><p>      ,     ,   .       ,          . </p><br><p>   ,                .         ,       ‚Äî         . </p><br><p>  ,      ,              .    ,   ORM,       ,  ,          . </p><br><p>   : </p><br><ul><li><p>   (  3.0) </p><br><ul><li>  HTTP,     (    ) </li><li>  async       ORM </li><li>    </li></ul><br></li><li><p>   (  3.1) </p><br><ul><li> ORM (     ) </li><li>  (     ) </li><li>  (     ) </li></ul><br></li><li><p>    </p><br><ul><li> ORM (       ) </li><li>  (    ) </li><li> Email </li><li>  </li></ul><br></li></ul><br><p>          ;      ,    .     ,   ,       , ,            . </p><br><p>   ,      -   ;            ,     ,        .    ,      ,  Django,     Django  async-only . </p><br><p>    ,  ,    DEP  ,   , , email  .         DBAPI ‚Äî  ,        core Python , , PEP,         . </p><br><h2 id="motivaciya">  </h2><br><p>     ,  , ,    .   Django      ,   -       ,    -;             . </p><br><p>          ,      - .         ,   ‚Äî  ,       ,       . </p><br><p>          Python ‚Äî   . -  Python       ,     ,       . </p><br><p>  Python            <code>asyncio</code> ,       ,         .     ,     ,     ,  ,      Django-size   . </p><br><h3 id="chto-eto-dayot">    </h3><br><p>       Django,     ¬´¬ª;    ,    ,      ‚Äî ,      Django ‚Äî     . </p><br><p>     ,       .      ,    API     ,   Django      -   . </p><br><p>      ,      ,  Django     .             ,    Django ORM ,     ,    ,      -. </p><br><p>  ,   , ‚Äî             .    -   long-poll   server-sent events.  Django          ,    -      . </p><br><h3 id="sinhronnost-vsyo-eschyo-imeet-znachenie">      </h3><br><p>     <em></em>    Django;         .   ,  ,             ,          . </p><br><p> Django          ,    .    ;  Django-   ,         ,  ,     ,     ,     . </p><br><p>      ,       --  Django      . </p><br><h3 id="obratnaya-sovmestimost">   </h3><br><p>  ,    .      ¬´ Django¬ª,       ;     ,        ,          . </p><br><p>  ,      ,     ,        ,    API Django,      ,      ,    Python 3,        API,        Django  Python. </p><br><h3 id="pomosch-python">  Python </h3><br><p> Python     .           Python,  ,    ,     . </p><br><p>   , Django ‚Äî   - Python   ‚Äî   ,    Python,        Python   .      ,       ,    ,        . </p><br><h3 id="privlechenie-novyh-uchastnikov">    </h3><br><p>      ,   Django,              .   ,  Django   ,       . </p><br><p>                   ‚Äî  ,  ,    ,   ,        . </p><br><p>  ,      ‚Äî      ,   , ‚Äî               Django (     ,       Python  ). </p><br><h3 id="chto-takoe-django">   Django? </h3><br><p>      ,   Django.   ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lawrence Journal-World</a>    ‚Äî    ,  , SPA ‚Äî  , ,    .  , ,   ,     ,     . </p><br><p>    ,   Django   ,   - ,    ‚Äî        ‚Äî     . , ,        ; ,     Django    , . </p><br><p>   ,     Django     .     ,       .    ,         ,    ,    ‚Äî ,        ,   . </p><br><h2 id="obosnovanie">  </h2><br><p>    Django       django-developers   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>    ,        ,  ,   ,   DEP. </p><br><p>      , ,   ,      : </p><br><ul><li> :       master-        Django    . </li><li>  :     Django    ,    ,    ,     ,      Django       . </li><li> :    ,    ,      Django,   ,  Django.     ,   ,   ,      ,  . </li></ul><br><p>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Channels</a>          DEP ;        Django      ,  . </p><br><p>   ,   ,     .  DEP    ,   ,       ‚Äî      Django           . </p><br><p>                 .     Django, ,     ,    WSGI    ,    event loop     ,      .         10%   ‚Äî     ,      .     ,      . </p><br><p>     ,  ,      (-  ,   Python    ).    ,     Django      ;     ,   ,     ,   Django   master-    . </p><br><p>  ,           ( ORM,    ..),      ;                 Python. </p><br><p>        ,      ,        Django,     ¬´¬ª  .   ,      ,              ,  ,     . </p><br><h3 id="alternativy">  Alternativas </h3><br><p>       ,   ,  , . </p><br><h4 id="asinhronnye-moduli-vmesto-_async-funkciy">    _async  </h4><br><p>        ,    ,     (, <code>django.core.cache.cache.get_async</code> ),               : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.core.cache_async <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cache cache.get(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>)</code> </pre> <br><p>   ,           ;   ,    ,        . </p><br><p>   ,    ,      ;       . </p><br><h4 id="fork-django">  Django </h4><br><p> -   ,      ;  ,        ,       ,       ‚Äî  . </p><br><p>           ,   ,     , ‚Äî   ,      . </p><br><h4 id="rasshirenie-channels">  Channels </h4><br><p>    ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Channels</a>      , ¬´¬ª  Django. ,     -     ,  ,         Django;      ORM,   HTTP/middleware flow    . </p><br><h4 id="ne-asyncio">  asyncio </h4><br><p>      event loop'  Python,   <code>asyncio</code>          ,   Django.   <code>await</code>  <code>async</code>  Python     event loop   . </p><br><p>   ,   <code>asyncio</code> ,     ; Django     ,        ,   .         Django        ;    , ,      async runtime,    ,    . </p><br><h4 id="greenletsgevent"> Greenlets/Gevent </h4><br><p>       Gevent,      ,      Python. </p><br><p>        ,       .   <code>yield</code>  <code>await</code> ,   API,    Django,       ,         .               ,     . </p><br><p>   ,      ,  ,     .      greenlet-safe   Django ORM   -   new-connection-context,  . </p><br><p>  ,      .   Django     ¬´ ¬ª    gevent, , ,      ,   . </p><br><h2 id="finansirovanie">  </h2><br><p>             DEP. </p><br><p>   ,        ‚Äî        , ‚Äî     ,             (   ). </p><br><p>  ,       ,  -           .    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Django Fellows</a>  ;     ‚Äî   ,           (  ), ,   ,  - . </p><br><p>       ‚Äî ,   Kickstarter  <code>migrations</code>  <code>contrib.postgres</code> ,    MOSS (Mozilla)  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Channels</a> .   ,   Django,  ,          . </p><br><p>     , <em></em>     .  ‚Äî      Python,    Django ‚Äî    ‚Äî       .        ,     Django/async,        . </p><br><p>                HTTP/middleware/view flow,     ,  ,  ,      ¬´ ¬ª,      . </p><br><p>     ,     ,     ,            (   ,  Fellows, /     ,     Channels,       ,   ),   ,       . </p><br><p>         ,         ,   ,        ,       Django,      . </p><br><h2 id="obratnaya-sovmestimost-1">   </h2><br><p> , ,   ,       ,            API. </p><br><p>   , ,        ,  , HTTP/middleware flow. ,    API,       APM,     . </p><br><p>  ,  ,   Django     ,     ,      .  ,   ORM  , ,   ‚Äî      ,  ORM             . </p><br><h2 id="etalonnaya-realizaciya">   </h2><br><p>  DEP  ,    ;       Django      . </p><br><p>   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">asgiref</a> ,       ,         .      Django         Django. </p><br><p>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Channels</a> ,         Django,          Django. </p><br><h2 id="avtorskie-prava">   </h2><br><p>   <em>(  )</em>       <a href="">CC0 1.0 Universal</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt461493/">https://habr.com/ru/post/pt461493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt461471/index.html">Ferramentas para trabalhar com multithreading e assincronia - Parte 2</a></li>
<li><a href="../pt461473/index.html">Algoritmos de depura√ß√£o em gr√°ficos - agora com imagens</a></li>
<li><a href="../pt461475/index.html">AMA com Habr.1011</a></li>
<li><a href="../pt461483/index.html">Balanceamento de carga Openstack</a></li>
<li><a href="../pt461487/index.html">Tarefas Mini CTF</a></li>
<li><a href="../pt461497/index.html">Renderiza√ß√£o de texto moderno no Linux: parte 1</a></li>
<li><a href="../pt461499/index.html">Quais idiomas para traduzir seu jogo em 2019</a></li>
<li><a href="../pt461501/index.html">Por que nos EUA est√£o investigando o trabalho de grandes empresas de TI</a></li>
<li><a href="../pt461503/index.html">Disponibilizando o banco de dados para conex√£o remota</a></li>
<li><a href="../pt461505/index.html">8 erros de desenvolvedores iniciantes em JavaScript que impedem que voc√™ se torne um profissional</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>