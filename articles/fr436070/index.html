<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüåæ üßñ ü§üüèæ Comment g√©rer les tests floconneux dans la communaut√© opensource üë®‚Äçüè´ üê∞ üíê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De nombreux projets sont confront√©s au probl√®me des tests floconneux, et ce sujet a √©t√© soulev√© plus d'une fois sur Habr√©. Les tests qui n'ont pas d√©c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment g√©rer les tests floconneux dans la communaut√© opensource</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/436070/">  De nombreux projets sont confront√©s au probl√®me des tests floconneux, et ce sujet a √©t√© soulev√© plus d'une fois sur Habr√©.  Les tests qui n'ont pas d√©cid√© de leur condition prennent constamment non seulement le temps machine, mais aussi le temps des d√©veloppeurs et des testeurs.  Et si dans une entreprise commerciale vous pouvez allouer une certaine ressource pour r√©soudre ce probl√®me et nommer des personnes responsables, alors dans la communaut√© opensource, ce n'est pas si simple.  Surtout quand il s'agit de grands projets - par exemple, comme Apache Ignite, o√π il y a pr√®s de 60 000 tests diff√©rents. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f92/3f5/dd2/f923f5dd2d414a1737fb093c3e0ddac4.png"><br><br>  Dans cet article, nous vous expliquerons en fait comment r√©soudre ce probl√®me dans Apache Ignite.  Nous sommes Dmitry Pavlov, ing√©nieur logiciel principal / gestionnaire de communaut√© chez GridGain, et Nikolai Kulagin, ing√©nieur informatique chez Sberbank Technologies. <br><a name="habracut"></a><br>  <i>Tout ce qui est √©crit ci-dessous ne repr√©sente la position d'aucune entreprise, y compris Sberbank.</i>  <i>Cette histoire provient exclusivement de membres de la communaut√© Apache Ignite.</i> <br><br><h2>  Apache Ignite et tests </h2><br>  L'histoire d'Apache Ignite commence en 2014, lorsque GridGain a fait don de la premi√®re version du produit interne √† Apache Software Foundation.  Plus de 4 ans se sont √©coul√©s depuis lors, et pendant ce temps, le nombre de tests a approch√© la barre des 60 mille. <br><br>  Nous utilisons JetBrains TeamCity comme serveur d'int√©gration continue - merci aux gars de JetBrains pour soutenir le mouvement open source.  Tous nos tests sont r√©partis entre les suites, dont le nombre pour la branche master est proche de 140. Dans les suites, les tests sont regroup√©s par crit√®re.  Cela peut tester uniquement les fonctionnalit√©s de Machine Learning [RunMl], uniquement le cache [RunCache] ou l'ensemble [RunAll].  √Ä l'avenir, l'ex√©cution des tests signifiera exactement [RunAll] - une v√©rification compl√®te.  Cela prend environ 55 heures de temps machine. <br><br>  Junit est utilis√© comme biblioth√®que principale, mais il y a peu de tests unitaires.  Pour la plupart, tous nos tests sont des tests d'int√©gration, car ils contiennent le lancement d'un ou plusieurs n≈ìuds (et cela prend plusieurs secondes).  Bien s√ªr, les tests d'int√©gration sont pratiques car l'un de ces tests couvre de nombreux aspects et interactions, ce qui est assez difficile √† r√©aliser avec un seul test unitaire.  Mais il y a aussi des inconv√©nients: dans notre cas, c'est un d√©lai assez long, ainsi que la difficult√© de trouver un probl√®me. <br><br><h2>  Probl√®mes avec floconneux </h2><br>  Une partie de ces tests est floconneuse.  Maintenant, selon la classification TeamCity, environ 1 700 tests sont marqu√©s comme feuillet√©s, c'est-√†-dire avec un changement d'√©tat sans changer le code ou la configuration.  De tels tests ne peuvent pas √™tre ignor√©s, car il y a un risque de bogue en production.  Par cons√©quent, ils doivent √™tre rev√©rifi√©s et red√©marr√©s, parfois plusieurs fois, pour analyser les r√©sultats des chutes - et cela prend un temps et des efforts pr√©cieux.  Et si les membres existants de la communaut√© font face √† cette t√¢che, alors pour les nouveaux contributeurs, cela peut devenir un v√©ritable obstacle.  Vous devez admettre que lorsque vous apportez des modifications au Java Doc, vous ne vous attendez pas √† rencontrer un plantage, mais pas un, mais plusieurs dizaines. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/723/db8/c6b/723db8c6b70264074788f6783717f2b6.png"><br><br><h2>  Qui est √† bl√¢mer? </h2><br>  La moiti√© des probl√®mes avec les tests feuillet√©s sont dus √† la configuration de l'√©quipement, √† la taille de l'installation.  Et la seconde moiti√© est directement li√©e aux personnes qui ont rat√© et n'ont pas corrig√© leur bug. <br><br>  Classiquement, tous les membres de la communaut√© peuvent √™tre divis√©s en deux groupes: <br><br><ul><li>  Les amateurs qui entrent dans la communaut√© de leur plein gr√© et contribuent √† leur temps libre. <br></li><li>  Contributeurs √† temps plein travaillant pour des entreprises qui utilisent ou sont associ√©es √† ce produit open source. <br></li></ul><br>  Un contributeur du premier groupe peut tr√®s bien faire une seule modification et quitter la communaut√©.  Et l'atteindre en cas de d√©tection d'un bug est presque impossible.  Il est plus facile d'interagir avec les personnes du deuxi√®me groupe, elles sont plus susceptibles de r√©pondre √† un test qu'elles r√©ussissent.  Mais il arrive qu'une entreprise qui √©tait auparavant int√©ress√©e par un produit ait cess√© d'en avoir besoin.  Elle quitte la communaut√© et ses collaborateurs contribuent avec elle.  Ou il est possible que le contributeur quitte l'entreprise, et avec elle la communaut√©.  Bien s√ªr, apr√®s de tels changements, certains continuent de participer √† la communaut√©.  Mais pas tous. <br><br><h2>  Qui va r√©parer? </h2><br>  Si nous parlons de personnes qui ont quitt√© la communaut√©, alors leurs bugs, bien s√ªr, vont aux contributeurs actuels.  Il convient de noter que pour la r√©vision qui a conduit au bogue, le r√©viseur est √©galement responsable, mais il peut √©galement √™tre un passionn√© - c'est-√†-dire qu'il ne sera pas toujours disponible. <br><br>  Il se trouve que cela tend √† tendre la main √† une personne, dites-lui: c'est le probl√®me.  Mais il dit: non, ce n'est pas ma solution qui a introduit un bug.  Comme une ex√©cution compl√®te de la branche principale est automatiquement effectu√©e avec une file d'attente relativement libre, cela se produit le plus souvent la nuit.  Avant cela, plusieurs commits peuvent √™tre vers√©s dans la branche pour toute la journ√©e. <br><br>  Dans TeamCity, toute modification de code est consid√©r√©e comme un journal des modifications.  Si apr√®s trois changeurs nous avons une nouvelle chute, alors trois personnes diront que ce n'est pas d√ª √† leur engagement.  S'il y a cinq changeurs, alors nous l'entendrons de cinq personnes. <br><br>  Autre probl√®me: informer le contributeur que les tests doivent √™tre ex√©cut√©s avant chaque revue.  Certains ne savent pas o√π, quoi et comment courir.  Ou les tests ont √©t√© ex√©cut√©s, mais le contributeur n'a pas √©crit √† ce sujet dans le ticket.  Il y a aussi des probl√®mes √† ce stade. <br><br>  Allez-y.  Supposons que les tests soient ex√©cut√©s et que le ticket contienne un lien vers les r√©sultats.  Mais, il s'est av√©r√© que cela ne donne aucune garantie de l'analyse des tests de passage.  Le contributeur peut regarder sa course, y voir quelques gouttes, mais √©crire ¬´TeamCity Looks Good¬ª.  Le r√©viseur - surtout s'il conna√Æt le contributeur ou l'a d√©j√† examin√© avec succ√®s - peut ne pas vraiment voir le r√©sultat.  Et nous obtenons ce "TeamCity Looks Good": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/055/26c/db2/05526cdb20d19b264ac4750695e46dee.png"><br><br>  O√π "bon" est ici n'est pas clair.  Mais apparemment, les auteurs savent au moins que des tests doivent √™tre ex√©cut√©s. <br><br><h2>  Comment nous avons combattu cela </h2><br><h3>  M√©thode 1. Tests s√©par√©s </h3><br>  Nous avons divis√© les tests en deux groupes.  Dans le premier, "propre" - des tests stables.  Dans le second - instable.  L'approche est assez √©vidente, mais elle n'a pas fonctionn√© m√™me avec deux tentatives.  Pourquoi?  Parce qu'une suite avec des tests instables se transforme en ghetto o√π quelque chose commence n√©cessairement √† expirer, plante, etc.  En cons√©quence, tout le monde commence simplement √† ignorer ces tests toujours probl√©matiques.  En g√©n√©ral, il est inutile de diviser les tests par grade. <br><br><h4>  M√©thode 2. S√©paration et notification </h4><br>  La deuxi√®me option est similaire √† la premi√®re - pour allouer des tests plus stables et ex√©cuter les tests PR restants la nuit.  Si quelque chose se casse dans un groupe stable, un message est envoy√© au contributeur avec les outils TeamCity standard disant que quelque chose doit √™tre corrig√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/321/7d1/7ba/3217d17ba4744bf932a498f8c2dcd63d.png"><br><br>  ... 0 personne a r√©agi √† ces messages.  Tous les ont ignor√©s. <br><br><h3>  M√©thode 3. Surveillance quotidienne </h3><br>  Nous avons divis√© les suites en plusieurs ¬´observateurs¬ª, les membres les plus responsables de la communaut√©, et les avons sign√©s pour des alertes de chutes.  En cons√©quence, il a √©t√© confirm√© dans la pratique que l'enthousiasme a tendance √† cesser.  Les contributeurs abandonnent cette entreprise et cessent de v√©rifier r√©guli√®rement.  Puis je l'ai rat√©, j'ai regard√© l√†-bas - et encore quelque chose a ramp√© dans le ma√Ætre. <br><br><h3>  M√©thode 4. Automatisation </h3><br>  Apr√®s une autre m√©thode infructueuse, les gars de GridGain se sont souvenus d'un utilitaire pr√©c√©demment d√©velopp√© qui avait ajout√© la fonctionnalit√© manquante √† ce moment-l√† sur TeamCity.  A savoir, la possibilit√© de visualiser des statistiques g√©n√©rales sur le nombre de chutes: combien et ce qui a chut√©, d√©t√©rior√© ou am√©lior√© le r√©sultat le lendemain.  Cet utilitaire a √©t√© progressivement d√©velopp√©, des rapports ont √©t√© ajout√©s et renomm√©s.  Puis ils ont ajout√© des notifications, renomm√©es √† nouveau.  Il s'est donc av√©r√© TeamCity Bot.  Maintenant, il a pr√®s de 500 commits et 7 contributeurs et il est dans le d√©p√¥t suppl√©mentaire d'Apache. <br><br>  Que fait le bot?  Ses capacit√©s peuvent √™tre combin√©es en deux groupes: <br><br><ul><li>  Surveillance de projet - surveillance visuelle en affichant les r√©sultats des ex√©cutions, ainsi que la notification automatique dans les messageries instantan√©es (par exemple, mou) <br></li><li>  V√©rification de succursale - analyse des tests de relations publiques et d√©livrance d'un visa sur un ticket. <br></li></ul><br><h2>  Flux de travail TeamCity Bot </h2><br>  Avant Apache Ignite Teamcity Bot, le processus de ¬´contribution¬ª √† la communaut√© √©tait le suivant: <br><br><ol><li>  Dans JIRA, l'un des tickets est s√©lectionn√© et corrig√©; <br></li><li>  Une demande d'extraction est cr√©√©e; <br></li><li>  Ex√©cute des tests qui peuvent √™tre affect√©s par les modifications apport√©es; <br></li><li>  Si les tests r√©ussissent, la requ√™te d'extraction peut √™tre pr√©visualis√©e et temp√©r√©e par le committer. <br></li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/1b2/c5c/d81/1b2c5cd81a826ec8e761b8c12b62c7f4.png"><br><br>  Cela semble simple, mais en fait, le troisi√®me point peut √™tre un obstacle pour certains contributeurs.  Par exemple: un nouveau venu dans la communaut√© d√©cide d'apporter sa premi√®re contribution en choisissant le ticket le plus simple.  Cela peut √™tre la modification d'un document Java ou la mise √† jour de versions de d√©pendances maven.  Analysant les r√©sultats de la course dans sa petite correction, il d√©couvre soudain qu'une trentaine de tests sont tomb√©s.  D'o√π vient le nombre d'√©checs et comment les analyser - il ne sait pas.  Il est fort probable que le contributeur ne reviendra plus jamais ici. <br><br>  Les membres plus exp√©riment√©s de la communaut√© souffrent √©galement de probl√®mes de qualit√© - ils passent du temps √† analyser les tests qui sont tomb√©s par hasard, et entravent ainsi le d√©veloppement de produits. <br><img src="https://habrastorage.org/getpro/habr/post_images/c42/290/ffb/c42290ffb3ead465704b6a3a990b09b2.png"><br>  <i>Plan de contribution avec TeamCity Bot</i> <br><br>  Avec l'av√®nement du bot, les √©tapes du contre-jeu ont augment√©, mais le temps pass√© √† analyser les tests tomb√©s a consid√©rablement diminu√©.  Il suffit maintenant de lancer le test et apr√®s l'avoir r√©ussi, regardez la page du bot correspondante.  S'il y a des bloqueurs possibles (tests abandonn√©s qui ne sont pas consid√©r√©s comme feuillet√©s), il suffit d'effectuer un double contr√¥le, ce qui entra√Ænera un visa sous la forme d'un commentaire dans JIRA avec les r√©sultats du test. <br><br><h2>  Pr√©sentation des fonctionnalit√©s </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/07c/a1b/a0e/07ca1ba0eb4d07a1537e75062eda2dd5.png"><br><br>  <i>Inspect Contribution - une liste de tous les RP non divulgu√©s avec un r√©sum√© de chaque information: la date de la derni√®re mise √† jour, le num√©ro du PR, le nom, l'auteur et le ticket dans JIRA</i> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d9/7ec/2f8/6d97ec2f8eba182718d88d291edfa58d.png"><br>  <i>Pour chaque pull request, un onglet avec des informations plus d√©taill√©es est disponible: le nom correct du PR, sans lequel le bot ne pourra pas trouver le ticket souhait√© dans JIRA;</i>  <i>si des tests ont √©t√© effectu√©s;</i>  <i>si le r√©sultat du test est pr√™t;</i>  <i>a laiss√© un commentaire dans JIRA.</i> <br><br>  Analyse des r√©sultats des tests: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed8/104/3c2/ed81043c26693ca7f40f3f9379797b7a.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/c42/a79/22c/c42a7922ce4b4163c9561bfaa4964ea9.png"><br><br>  Voici deux rapports sur les tests du m√™me PR.  Le premier vient du bot.  Le second est un rapport standard sur Teamcity.  La diff√©rence dans la quantit√© d'informations est √©vidente, et cela ne tient pas compte du fait que pour afficher l'historique des ex√©cutions de test TC, il sera √©galement n√©cessaire d'effectuer plusieurs transitions vers des pages adjacentes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c66/7d5/24d/c667d524d85a956b5aca555343056563.png"><br><br>  Revenons au rapport du bot.  Ce rapport est visuellement divis√© en deux tableaux: les bloqueurs possibles et tous les plantages.  Les bloqueurs incluent des tests qui: <br><br><ul><li>  avoir un taux d'√©chec dans le ma√Ætre de moins de 4% (moins de 4 d√©marrages sur 100 ont √©chou√©); <br></li><li>  ne sont pas feuillet√©s selon la classification de TeamCity; <br></li><li>  est tomb√© en raison d'un d√©lai d'attente, de m√©moire insuffisante, de code de sortie, d'une d√©faillance de la JVM. <br></li></ul><br>  Par exemple, dans la capture d'√©cran ci-dessus, deux suites sont indiqu√©es comme bloqueurs possibles - dans la premi√®re, le test est tomb√© et dans la seconde, un d√©lai d'attente a eu lieu. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/867/ba7/53b/867ba753b7fee200ae041c36c30fc136.png"><br><br>  Pour enfin comprendre ce qu'est un test feuillet√© et ce qu'est un bug, consid√©rez l'image ci-dessus.  La barre horizontale est de 100 pistes.  Barre verte verticale - r√©ussite au test, goutte rouge.  Dans le cas d'un bug, l'historique de l'ex√©cution semble naturel: une barre verte unie √† la fin change de couleur en rouge.  Cela signifie que c'est √† cet endroit qu'un bug est apparu et que le test a commenc√© √† tomber constamment.  Si nous avons devant nous un test floconneux, alors son historique de course est une alternance continue de couleurs vertes et rouges. <br><br>  Analyse des r√©sultats des tests <br><br><img src="https://habrastorage.org/getpro/habr/post_images/faa/050/154/faa050154f92d1cd4cb388efa59f461d.png"><br><br>  Par exemple, nous analysons les r√©sultats de la r√©ussite des tests dans la capture d'√©cran ci-dessus.  Selon la version du bot, il peut y avoir deux plantages en raison d'un bogue - ils sont r√©pertori√©s dans le tableau des bloqueurs possibles.  Mais il peut s'agir de tests irr√©guliers avec un faible taux d'√©chec.  Pour exclure cette option, cliquez simplement sur le bouton Re-run possible blockers, et ces deux suites iront en double v√©rification.  Pour rendre la t√¢che encore plus facile, vous pouvez cliquer sur Re-run possible blockers &amp; comment JIRA, et obtenir un commentaire (et avec lui une notification par e-mail) du bot une fois la v√©rification termin√©e.  Ensuite, entrez et voyez s'il y a un probl√®me ou non. <br><br>  Pour les critiques, c'est tr√®s cool.  Vous pouvez oublier les modifications qui n'ont r√©ussi aucun contr√¥le, mais cliquez simplement sur un certain nombre de modifications, cliquez sur le gros bouton vert de r√©ex√©cution et attendez la lettre. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eb0/352/de5/eb0352de55fe68f17e69139426ac4474.png"><br>  <i>Rapport parfait: aucun bloqueur d√©tect√©</i> <i><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ce9/8aa/303/ce98aa3034b0b39391aa1fe4db081375.png"><br></i>  <i>Visa vert (commentaire) du bot.</i>  <i>Aucun bloqueur trouv√©.</i> <i><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9c5/be4/802/9c5be48026aad0175d690636ea5d14d9.png"><br></i>  <i>Visa rouge - double v√©rification et / ou modification des bogues requise</i> <br><br>  Il arrive que certains bugs fuient encore dans le ¬´ma√Ætre¬ª.  Comme nous l'avons dit, avant cela a √©t√© combattu gr√¢ce √† des notifications personnelles.  Ou quelqu'un s'est assur√© que rien ne tombait.  Maintenant, nous utilisons une solution plus simple: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57d/c82/90f/57dc8290f1643362d93ff95e497ce36c.png"><br><br>  Lorsqu'un nouveau bogue est d√©tect√©, un message est envoy√© √† la liste de d√©veloppement, qui indique les contributeurs et leurs changeurs, ce qui peut √™tre la cause de l'erreur.  Ainsi, toute la communaut√© d√©couvrira qui a caus√© tout. <br><br>  Ainsi, nous avons pu augmenter le nombre de correctifs et r√©duire consid√©rablement le temps n√©cessaire pour r√©soudre le probl√®me. <br><br>  Surveillance de l'√©tat de l'assistant <br>  Une autre des fonctions du bot est de surveiller l'√©tat de l'assistant avec les statistiques sur les derniers lancements. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ce6/3da/e80/ce63dae8033464df004d8a168e75c9c1.png"><br><br>  Ma√Ætriser les tendances <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ab4/d34/ecc/ab4d34ecc348552b4de5804a1b66a7a6.png"><br><br>  La page Tendances principales compare deux s√©lections ¬´principales¬ª pour des p√©riodes sp√©cifiques.  Pour chaque √©l√©ment du tableau affiche la valeur maximale, minimale et la m√©diane. <br><img src="https://habrastorage.org/getpro/habr/post_images/564/8c5/fd1/5648c5fd1dd4080a736856bf2d9afbd3.png"><br><br>  En plus des r√©sultats g√©n√©raux pour l'ensemble de l'√©chantillon, le tableau contient des graphiques pour chaque indicateur avec l'affichage des valeurs de chaque build.  En cliquant sur un point, vous pouvez acc√©der aux r√©sultats de la course sur TeamCity.  De plus, il est possible de supprimer le r√©sultat des statistiques.  Cela est utile lorsque des valeurs anormales se produisent en raison de graves pannes, ce que le contributeur n'est probablement pas √† bl√¢mer.  Ces r√©sultats doivent √™tre exclus afin qu'ils ne soient pas pris en compte lors du calcul des m√™mes tests feuillet√©s.  En outre, la g√©n√©ration peut √©galement √™tre distingu√©e pour suivre les r√©sultats de chaque indicateur. <br><br>  Apache Ignite Teamcity Bot compte d√©sormais plus de 65 membres inscrits.  Sur toute la p√©riode d'utilisation du bot, les visas ont re√ßu plus de 400 demandes de retrait, et en moyenne cinq visas sont d√©livr√©s par jour. <br><br><h2>  Structure de TeamCity Bot </h2><br>  Le bot est h√©berg√© sur un serveur s√©par√©, va sur ignite.apache.org pour les donn√©es, informe publiquement tout le monde sur la liste de d√©veloppement - c'est notre principale plate-forme pour les d√©veloppeurs Ignite - et √©crit des visas sur les tickets via l'API JIRA. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/609/73e/734/60973e7345a076dbabedb9ef35921b7e.png"><br><br>  Il utilise le serveur Jetty, les servlets Jersey, un certain nombre de services avec une logique m√©tier complexe du bot lui-m√™me, y compris les services Teamcity, JIRA et GitHub qui acc√®dent au service Ignited Integration.  En plus de cette int√©gration pure pour les requ√™tes http.  En tant que stockage - propre produit d'Apache Ignite en mode int√©gr√© de configuration √† n≈ìud unique avec persistance active.  En plus des avantages √©vidents de l'utilisation d'Ignite comme base de donn√©es, cela nous aide √©galement √† trouver divers domaines d'application d'Ignite et √† comprendre ce qui est pratique et ce qui ne l'est pas. <br><br>  La premi√®re version de l'impl√©mentation du bot a √©t√© inspir√©e par un article sur la mise en cache REST et √©tait un cache REST et des services GitHub et Teamcity.  Teamcity xml et json renvoy√©s par le serveur ont √©t√© analys√©s par Pure Java Objects, qui ont ensuite √©t√© mis en cache.  Au d√©but, cela a fonctionn√©, et assez rapidement.  Mais avec une augmentation de la quantit√© de donn√©es, les r√©sultats ont commenc√© √† se d√©t√©riorer. <br><br>  Il convient de noter que TeamCity supprime une histoire de plus de ~ 2 semaines, mais pas le bot.  En fin de compte, avec cette approche, des tonnes de donn√©es sont apparues qui sont tr√®s difficiles √† g√©rer. <br><br><h2>  D√©veloppement TeamCity Bot </h2><br>  La nouvelle approche impl√©mente une option de stockage de donn√©es compacte et opte pour un petit nombre de partitions de cache.  Un grand nombre de partitions sur un n≈ìud affecte n√©gativement la vitesse de synchronisation des donn√©es sur le disque et augmente l'heure de d√©marrage du cluster. <br><br>  Toutes les mises √† jour de donn√©es majeures sont effectu√©es de mani√®re asynchrone, car sinon nous risquons d'obtenir une mauvaise UX en raison du retour lent des donn√©es TeamCity. <br><br>  Pour les cha√Ænes qui changent rarement leurs valeurs (par exemple, les noms des tests), un mappage simple est effectu√© dans id, qui est g√©n√©r√© par Atomic Sequence.  Voici un exemple d'une telle entr√©e: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/408/1f8/1f5/4081f81f553eb5b318799e11ea847043.png"><br><br>  Le nom de test long correspond au num√©ro int, qui est stock√© dans toutes les g√©n√©rations.  Cela √©conomise une √©norme quantit√© de ressources.  En plus des m√©thodes qui retournent cette ligne se trouve l'intercepteur de cache en m√©moire de Guava.  Gr√¢ce √† l'annotation du cache, m√™me en tas, nous ne s√©lectionnons pas les lignes en les lisant dans Ignite by id.  Et par id, nous obtenons toujours la m√™me ligne, ce qui est bon pour les performances. <br><br>  Pour les lignes "impr√©visibles", par exemple, les journaux de trace de pile, diff√©rents types de compression sont utilis√©s - compression gzip, compression instantan√©e ou non compress√©e, selon la meilleure solution.  Toutes ces m√©thodes aident √† tenir un maximum de donn√©es en m√©moire et √† donner rapidement une r√©ponse au client. <br><br><h2>  Pourquoi TeamCity Bot est meilleur </h2><br>  Cela ne veut pas dire que TeamCity ne poss√®de pas les fonctionnalit√©s √©num√©r√©es ci-dessus.  Ils le sont, mais dispers√©s sur un tas d'endroits diff√©rents.  Dans le bot, tout est rassembl√© sur une seule page et vous pouvez rapidement comprendre quel est le probl√®me. <br><br>  Un bon ajout est la lettre que le bot envoie sur la feuille de d√©veloppement lorsqu'il d√©tecte un probl√®me.  Imm√©diatement dans la communaut√©, il y a une occasion d'entamer une discussion: ¬´Allons, peut-√™tre, maintenant nous allons inverser?¬ª.  Cela ajoute de la confiance aux examinateurs. <br><br>  Avec le bot, il est beaucoup plus facile pour les nouveaux contributeurs de rejoindre le processus de d√©veloppement.  Lorsque vous effectuez votre premier correctif, vous ne savez pas toujours ce que les modifications apport√©es peuvent impliquer.  Et en plongeant t√™te baiss√©e dans l'analyse des r√©sultats des tests sur TeamCity, vous pouvez facilement perdre votre enthousiasme pour un d√©veloppement ult√©rieur.  Apache Ignite TeamCity Bot vous aidera √† comprendre rapidement s'il y a un probl√®me et √† maintenir votre enthousiasme. <br><br>  Nous esp√©rons que le bot simplifiera la vie des contributeurs actuels et attirera de nouvelles personnes dans la communaut√©.  Enfin, nous conseillons, bien s√ªr, d'√©viter l'apparition d'un grand nombre de tests feuillet√©s, car il est difficile de les g√©rer.  Et faites confiance aux robots - ils n'ont aucune pr√©f√©rence et ne prennent pas la parole des gens pour cela. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr436070/">https://habr.com/ru/post/fr436070/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr436060/index.html">Solutions architecturales pour un jeu mobile. Partie 3: Vue sur la pouss√©e du jet</a></li>
<li><a href="../fr436062/index.html">Syst√®me d'arbitrage pour d√©butants, partie 1</a></li>
<li><a href="../fr436064/index.html">L'intelligence artificielle pour tous</a></li>
<li><a href="../fr436066/index.html">Math√©matiques de l'apocalypse: th√©orie des jeux et crise nucl√©aire des Cara√Øbes</a></li>
<li><a href="../fr436068/index.html">Conf√©rence C ++ Russie 2019</a></li>
<li><a href="../fr436072/index.html">Nettoyer, marquer: comment nous avons appris √† chatbot √† distinguer les probl√®mes des clients</a></li>
<li><a href="../fr436076/index.html">Analyse des attaques de Cowrie Hanipot</a></li>
<li><a href="../fr436080/index.html">Semaine de la s√©curit√© 03: 2019 - Ann√©e de la confidentialit√©</a></li>
<li><a href="../fr436082/index.html">Comment l'UEBA contribue √† am√©liorer la cybers√©curit√©</a></li>
<li><a href="../fr436086/index.html">Pr√©sentation de la mise √† jour 4 pour Veeam Cloud Connect</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>