<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😞 🍢 ☎️ نقوم بإنشاء عناصر نائبة SVG جميلة على Node.js ⤵️ 🕌 💠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="يعد استخدام صور SVG كعناصر نائبة فكرة جيدة جدًا ، خاصة في عالمنا ، عندما تتكون جميع المواقع تقريبًا من مجموعة من الصور التي نحاول تحميلها بشكل غير متز...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>نقوم بإنشاء عناصر نائبة SVG جميلة على Node.js</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431232/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ko/6n/vo/ko6nvoj9m3q1bdzvbeogrcbt09i.jpeg"></p><br><p style=";text-align:right;direction:rtl"> يعد استخدام صور SVG كعناصر نائبة فكرة جيدة جدًا ، خاصة في عالمنا ، عندما تتكون جميع المواقع تقريبًا من مجموعة من الصور التي نحاول تحميلها بشكل غير متزامن.  كلما زادت الصور وكلما زاد حجمها ، زادت احتمالية الحصول على مشاكل مختلفة ، بدءًا من حقيقة أن المستخدم لا يفهم تمامًا ما يتم تحميله هناك ، وينتهي بالقفزة الشهيرة للواجهة بأكملها بعد تحميل الصور.  خاصة على الإنترنت السيئ من هاتفك - يمكن أن يطير على شاشات متعددة.  في مثل هذه اللحظات تأتي الإنقاذ.  خيار آخر لاستخدامها هو الرقابة.  هناك أوقات تحتاج فيها إلى إخفاء صورة عن المستخدم ، لكني أرغب في الحفاظ على النمط العام للصفحة والألوان والمكان الذي تشغله الصورة. </p><br><p style=";text-align:right;direction:rtl">  ولكن في معظم المقالات ، يتحدث الجميع عن النظرية ، أنه سيكون من اللطيف إدراج جميع هذه الصور العنيدة في الصفحات في السطر ، واليوم سنرى عمليًا كيف يمكنك توليدها حسب ذوقك ولونك باستخدام Node.js.  سننشئ قوالب المقاود من صور SVG ونملأها بطرق مختلفة ، من التعبئة البسيطة بالألوان أو التدرج إلى التثليث ، فسيفساء Voronoi واستخدام الفلاتر.  سيتم فرز جميع الإجراءات في خطوات.  أعتقد أن هذه المقالة ستكون مثيرة للاهتمام للمبتدئين المهتمين بكيفية القيام بذلك ويحتاجون إلى تحليل مفصل للإجراءات ، ولكن المطورين ذوي الخبرة قد يحبون أيضًا بعض الأفكار. </p><a name="habracut"></a><br><h2 id="podgotovka" style=";text-align:right;direction:rtl">  التحضير </h2><br><p style=";text-align:right;direction:rtl"> بادئ ذي بدء ، سوف نذهب إلى مستودع لا نهاية له لجميع أنواع الأشياء تسمى NPM.  نظرًا لأن مهمة إنشاء صور كعب الروتين تتضمن جيلًا لمرة واحدة منها على جانب الخادم (أو حتى على جهاز المطور ، إذا كنا نتحدث عن موقع ثابت تقريبًا) ، فلن نتعامل مع التحسين المبكر.  سنربط كل ما نحب.  لذا ، نبدأ <code>npm init</code> اختيار التبعيات. </p><br><p style=";text-align:right;direction:rtl">  بالنسبة للمبتدئين ، هذا هو <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ColorThief</a> .  ربما سمعت عنه بالفعل.  مكتبة رائعة يمكنها عزل لوحة ألوان الألوان الأكثر استخدامًا في الصورة.  نحن فقط بحاجة إلى شيء من هذا القبيل كبداية. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">npm i --save color-thief</code> </pre> <br><p style=";text-align:right;direction:rtl">  عند تثبيت هذه الحزمة في Linux ، كانت هناك مشكلة - بعض حزمة القاهرة المفقودة ، والتي ليست في دليل NPM.  تم حل هذا الخطأ الغريب عن طريق تثبيت إصدارات التطوير لبعض المكتبات: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">sudo apt install libcairo2-dev libjpeg-dev libgif-dev</code> </pre> <br><p style=";text-align:right;direction:rtl">  ستتم مراقبة كيفية عمل هذه الأداة في هذه العملية.  ولكن لن يكون من غير الضروري توصيل حزمة rgb-hex على الفور لتحويل تنسيق الألوان من RGB إلى Hex ، وهو أمر واضح من اسمه.  لن نشارك في ركوب الدراجات بهذه الوظائف البسيطة. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">npm i --save rgb-hex</code> </pre> <br><blockquote style=";text-align:right;direction:rtl">  من وجهة نظر التدريب ، من المفيد أن تكتب مثل هذه الأشياء بنفسك ، ولكن عندما تكون المهمة هي تجميع نموذج أولي يعمل بشكل ضئيل ، فإن ربط كل شيء من كتالوج NPM فكرة جيدة.  يوفر الكثير من الوقت. </blockquote><p style=";text-align:right;direction:rtl">  واحدة من أهم المعلمات للنسب هي النسب.  يجب أن تتطابق مع نسب الصورة الأصلية.  وبناءً على ذلك ، نحتاج إلى معرفة حجمه.  سنستخدم حزمة حجم الصورة لحل هذه المشكلة. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">npm i --save image-size</code> </pre> <br><p style=";text-align:right;direction:rtl">  نظرًا لأننا سنحاول إنشاء إصدارات مختلفة من الصور وستكون جميعها بتنسيق SVG ، بطريقة أو بأخرى ، سيظهر سؤال عن النماذج الخاصة بهم.  يمكنك بالطبع المراوغة مع سلاسل الأنماط في JS ، ولكن لماذا كل هذا؟  من الأفضل أن تأخذ محرك نموذج "عادي".  على سبيل المثال ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">المقاود</a> .  بسيطة ولذيذة ، لأن مهمتنا ستكون صحيحة. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">npm i --save handlebars</code> </pre> <br><p style=";text-align:right;direction:rtl">  لن نقوم على الفور بترتيب نوع من العمارة المعقدة لهذه التجربة.  نقوم بإنشاء ملف main.js واستيراد جميع تبعياتنا هناك ، بالإضافة إلى وحدة للعمل مع نظام الملفات. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ColorThief = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'color-thief'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Handlebars = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'handlebars'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rgbHex = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'rgb-hex'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sizeOf = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'image-size'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>);</code> </pre> <br><p style=";text-align:right;direction:rtl">  يتطلب ColorThief تهيئة إضافية </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> thief = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ColorThief();</code> </pre> <br><p style=";text-align:right;direction:rtl">  ليس من الصعب استخدام التبعيات التي قمنا بتوصيلها ، وحل مشاكل "تحميل صورة إلى برنامج نصي" و "الحصول على حجمها".  لنفترض أن لدينا صورة 1.jpg: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> image = fs.readFileSync(<span class="hljs-string"><span class="hljs-string">'1.jpg'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> size = sizeOf(<span class="hljs-string"><span class="hljs-string">'1.jpg'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> height = size.height; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> width = size.width;</code> </pre> <br><p style=";text-align:right;direction:rtl">  بالنسبة للأشخاص غير المعتادين على Node.js ، تجدر الإشارة إلى أن كل شيء متعلق بنظام الملفات يمكن أن يحدث بشكل متزامن أو غير متزامن.  بالنسبة للطرق المتزامنة ، تتم إضافة "Sync" في نهاية الاسم.  سنستخدمها حتى لا نواجه تعقيدات لا داعي لها ولا نخرج عقولنا من فراغ. </p><br><p style=";text-align:right;direction:rtl">  دعنا ننتقل إلى المثال الأول. </p><br><h2 id="zalivka-cvetom" style=";text-align:right;direction:rtl">  تعبئة اللون </h2><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/xa/1p/7g/xa1p7gmnqwkm9rcdntn9qbtnrjm.jpeg"></p><br><p style=";text-align:right;direction:rtl">  بادئ ذي بدء ، سوف نحل مشكلة ملء مستطيل بسيط.  ستحتوي صورتنا على ثلاث معلمات - العرض والارتفاع ولون التعبئة.  نقوم بعمل صورة SVG مع مستطيل ، ولكن بدلاً من هذه القيم نستبدل أزواج الأقواس وأسماء الحقول التي ستحتوي على البيانات المرسلة من البرنامج النصي.  ربما تكون قد شاهدت بالفعل بناء الجملة هذا مع HTML التقليدي (على سبيل المثال ، يستخدم Vue شيئًا مشابهًا) ، ولكن لا أحد يزعج استخدامه مع صورة SVG - لا يهتم محرك القالب بما سيكون عليه على المدى الطويل.  النص هو والنص في إفريقيا. </p><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'1.1'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'http://www.w3.org/2000/svg'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">viewBox</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0 0 100 100'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">preserveAspectRatio</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'none'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ height }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ width }}'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rect</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'100'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'100'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ color }}'</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  يعطينا هذا اللون أحد أكثر الألوان شيوعًا ، في المثال هو اللون الرمادي.  من أجل استخدام القالب ، نقرأ الملف معه ، على سبيل المثال المقاود بحيث تقوم هذه المكتبة بتجميعه ثم ننشئ خطًا مع كعب SVG النهائي.  يستبدل محرك القالب نفسه بياناتنا (اللون والحجم) في الأماكن المناسبة. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateOneColor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rgb = thief.getColor(image); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> color = <span class="hljs-string"><span class="hljs-string">'#'</span></span> + rgbHex(...rgb); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> template = Handlebars.compile(fs.readFileSync(<span class="hljs-string"><span class="hljs-string">'template-one-color.svg'</span></span>, <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svg = template({ height, width, color }); fs.writeFileSync(<span class="hljs-string"><span class="hljs-string">'1-one-color.svg'</span></span>, svg, <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  يبقى فقط لكتابة النتيجة إلى ملف.  كما ترى ، فإن العمل مع SVG أمر رائع - كل الملفات نصية ، يمكنك قراءتها وكتابتها بسهولة.  والنتيجة هي صورة مستطيل.  لا يوجد شيء مثير للاهتمام ، ولكن على الأقل تأكدنا من أن النهج كان يعمل (سيكون هناك رابط إلى المصادر الكاملة في نهاية المقالة). </p><br><h2 id="zalivka-gradientom" style=";text-align:right;direction:rtl">  تعبئة متدرجة </h2><br><p style=";text-align:right;direction:rtl">  استخدام التدرجات هو نهج أكثر إثارة للاهتمام.  هنا يمكننا استخدام زوجين من الألوان الشائعة من الصورة وإجراء انتقال سلس من واحد إلى آخر.  يمكن العثور على هذا في بعض الأحيان على المواقع التي تقوم بتحميل أشرطة طويلة من الصور. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/_e/hk/dp/_ehkdpgdhchgknqkcvbadu8dwpq.jpeg"></p><br><p style=";text-align:right;direction:rtl">  تم توسيع قالب SVG الخاص بنا الآن مع هذا التدرج.  على سبيل المثال ، سنستخدم التدرج الخطي المعتاد.  نحن مهتمون بمعلمتين فقط - اللون في البداية واللون في النهاية: </p><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">defs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">linearGradient</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'my-gradient'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0%'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0%'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x2</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'100%'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y2</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0%'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gradientTransform</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'rotate(45)'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stop</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">offset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0%'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'stop-color:{{ startColor }};stop-opacity:1'</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stop</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">offset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'100%'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'stop-color:{{ endColor }};stop-opacity:1'</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">linearGradient</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">defs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rect</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'100'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'100'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'url(#my-gradient)'</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  يتم الحصول على الألوان نفسها باستخدام ColorThief نفسه.  يحتوي على وضعين للتشغيل - إما أنه يمنحنا لونًا أساسيًا واحدًا ، أو لوحة تحتوي على عدد الألوان التي نحددها.  مريح بما فيه الكفاية.  بالنسبة إلى التدرج ، نحتاج إلى لونين. </p><br><p style=";text-align:right;direction:rtl">  خلاف ذلك ، هذا المثال مشابه للمثال السابق: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateGradient</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> palette = thief.getPalette(image, <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> startColor = <span class="hljs-string"><span class="hljs-string">'#'</span></span> + rgbHex(...palette[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> endColor = <span class="hljs-string"><span class="hljs-string">'#'</span></span> + rgbHex(...palette[<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> template = Handlebars.compile(fs.readFileSync(<span class="hljs-string"><span class="hljs-string">'template-gradient.svg'</span></span>, <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svg = template({ height, width, startColor, endColor }); <span class="hljs-comment"><span class="hljs-comment">// . . .</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  بهذه الطريقة ، يمكنك إنشاء جميع أنواع التدرجات - وليس بالضرورة أن تكون خطية.  ولكن لا تزال هذه نتيجة مملة إلى حد ما.  سيكون من الرائع إنشاء نوع من الفسيفساء يشبه عن بعد الصورة الأصلية. </p><br><h2 id="mozaika-iz-pryamougolnikov" style=";text-align:right;direction:rtl">  فسيفساء مستطيل </h2><br><p style=";text-align:right;direction:rtl">  للبدء ، دعنا فقط نصنع الكثير من المستطيلات ونملأها بألوان من اللوحة التي ستقدمها لنا نفس المكتبة. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/l6/w2/hd/l6w2hd1l4bgc-pand_tz2gixe3s.jpeg"></p><br><p style=";text-align:right;direction:rtl">  يمكن أن تؤدي المقاود العديد من الأشياء المختلفة ، على وجه الخصوص لها دورات.  سنمرره بمجموعة من الإحداثيات والألوان ، وبعد ذلك سوف يكتشفها.  نحن فقط نلف المستطيل الخاص بنا في القالب في كل: </p><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">{{# each rects }} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rect</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ x }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ y }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'11'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'11'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ color }}'</span></span></span><span class="hljs-tag"> /&gt;</span></span> {{/each }}</code> </pre> <br><p style=";text-align:right;direction:rtl">  وفقًا لذلك ، في البرنامج النصي نفسه ، لدينا الآن لوحة ألوان كاملة ، حلقة من خلال إحداثيات X / Y وإنشاء مستطيل بلون عشوائي من اللوحة.  كل شيء بسيط للغاية: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateMosaic</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> palette = thief.getPalette(image, <span class="hljs-number"><span class="hljs-number">16</span></span>); palette.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">color, index</span></span></span><span class="hljs-function">) </span></span>{ palette[index] = <span class="hljs-string"><span class="hljs-string">'#'</span></span> + rgbHex(...color); }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rects = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; x += <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; y += <span class="hljs-number"><span class="hljs-number">10</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> color = palette[<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * <span class="hljs-number"><span class="hljs-number">15</span></span>)]; rects.push({ x, y, color }); } } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> template = Handlebars.compile(fs.readFileSync(<span class="hljs-string"><span class="hljs-string">'template-mosaic.svg'</span></span>, <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svg = template({ height, width, rects }); <span class="hljs-comment"><span class="hljs-comment">// . . .</span></span></code> </pre><br><p style=";text-align:right;direction:rtl">  من الواضح أن الفسيفساء ، على الرغم من تشابهها في اللون مع الصورة ، ولكن مع ترتيب الألوان ، كل شيء ليس على الإطلاق كما نود.  قدرات ColorThief في هذا المجال محدودة.  أود الحصول على فسيفساء يتم فيها تخمين الصورة الأصلية ، وليس مجرد مجموعة من الطوب من نفس الألوان تقريبًا. </p><br><h2 id="uluchshaem-mozaiku" style=";text-align:right;direction:rtl">  تحسين الفسيفساء </h2><br><p style=";text-align:right;direction:rtl">  هنا يجب أن نتعمق قليلاً ونحصل على الألوان من البكسل في الصورة ... </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/qf/mt/60/qfmt60p4wqhi0yil0r28wtdjskq.jpeg"></p><br><p style=";text-align:right;direction:rtl">  نظرًا لأنه من الواضح أنه ليس لدينا لوحة في وحدة التحكم التي نحصل عادةً على هذه البيانات منها ، فسنستخدم المساعدة في شكل حزمة get-pixels.  يمكنه سحب المعلومات اللازمة من المخزن المؤقت مع صورة لدينا بالفعل. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">npm i --save get-pixels</code> </pre> <br><p style=";text-align:right;direction:rtl">  سيبدو شيء من هذا القبيل: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs">getPixels(image, <span class="hljs-string"><span class="hljs-string">'image/jpg'</span></span>, (err, pixels) =&gt; { <span class="hljs-comment"><span class="hljs-comment">// . . . });</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  نحصل على كائن يحتوي على حقل البيانات - صفيف من البكسل ، نفس ما نحصل عليه من قماش.  دعني أذكرك أنه من أجل الحصول على لون بكسل بواسطة الإحداثيات (X ، Y) ، تحتاج إلى إجراء حسابات بسيطة: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pixelPosition = <span class="hljs-number"><span class="hljs-number">4</span></span> * (y * width + x); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rgb = [ pixels.data[pixelPosition], pixels.data[pixelPosition + <span class="hljs-number"><span class="hljs-number">1</span></span>], pixels.data[pixelPosition + <span class="hljs-number"><span class="hljs-number">2</span></span>] ];</code> </pre> <br><p style=";text-align:right;direction:rtl">  وبالتالي ، لكل مستطيل ، يمكننا أخذ اللون ليس من اللوحة ، ولكن مباشرة من الصورة ، واستخدامه.  ستحصل على شيء مثل هذا (الشيء الرئيسي هنا هو ألا تنسى أن الإحداثيات في الصورة تختلف عن "المعدل" لدينا من 0 إلى 100): </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateImprovedMosaic</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ getPixels(image, <span class="hljs-string"><span class="hljs-string">'image/jpg'</span></span>, (err, pixels) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(err); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rects = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; x += <span class="hljs-number"><span class="hljs-number">5</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> realX = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(x * width / <span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; y += <span class="hljs-number"><span class="hljs-number">5</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> realY = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(y * height / <span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pixelPosition = <span class="hljs-number"><span class="hljs-number">4</span></span> * (realY * width + realX); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rgb = [ pixels.data[pixelPosition], pixels.data[pixelPosition + <span class="hljs-number"><span class="hljs-number">1</span></span>], pixels.data[pixelPosition + <span class="hljs-number"><span class="hljs-number">2</span></span>] ]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> color = <span class="hljs-string"><span class="hljs-string">'#'</span></span> + rgbHex(...rgb); rects.push({ x, y, color }); } } <span class="hljs-comment"><span class="hljs-comment">// . . .</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  لمزيد من الجمال ، يمكننا زيادة عدد "الطوب" قليلاً ، مما يقلل حجمه.  نظرًا لأننا لا نمرر هذا الحجم إلى القالب (بالطبع ، سيكون من المفيد جعله نفس المعلمة مثل عرض أو ارتفاع الصورة) ، سنقوم بتغيير قيم الحجم في القالب نفسه: </p><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">{{# each rects }} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rect</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ x }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ y }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'6'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'6'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ color }}'</span></span></span><span class="hljs-tag"> /&gt;</span></span> {{/each }}</code> </pre> <br><p style=";text-align:right;direction:rtl">  الآن لدينا فسيفساء تشبه الصورة الأصلية حقًا ، ولكن في نفس الوقت تأخذ ترتيبًا بحجم أقل. </p><br><blockquote style=";text-align:right;direction:rtl">  لا تنس أن GZIP يضغط مثل هذه التسلسلات المتكررة في الملفات النصية جيدًا ، بحيث عند النقل إلى المتصفح ، سيصبح حجم هذه المعاينة أصغر. </blockquote><p style=";text-align:right;direction:rtl">  لكن دعنا ننتقل. </p><br><h2 id="triangulyaciya" style=";text-align:right;direction:rtl">  التثليث </h2><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/by/h7/dq/byh7dqqiigv_3v5ayf-1lw8deyw.jpeg"></p><br><p style=";text-align:right;direction:rtl">  المستطيلات جيدة ، لكن المثلثات تعطي نتائج أكثر إثارة للاهتمام.  لذا دعونا نحاول صنع فسيفساء من كومة من المثلثات.  هناك طرق مختلفة لهذه المسألة ، سنستخدم <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تثليث Delaunay</a> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">npm i --save delaunay-triangulate</code> </pre> <br><p style=";text-align:right;direction:rtl">  الميزة الرئيسية للخوارزمية التي سنستخدمها هي أنها تتجنب المثلثات ذات الزوايا الحادة جدًا والمنفرجة كلما أمكن ذلك.  للحصول على صورة جميلة ، لا نحتاج إلى مثلثات ضيقة وطويلة. </p><br><blockquote style=";text-align:right;direction:rtl">  هذه واحدة من تلك اللحظات عندما يكون من المفيد معرفة ما هي الخوارزميات الرياضية الموجودة في مجالنا وما الفرق بينهما.  ليس من الضروري تذكر جميع عمليات التنفيذ الخاصة بها ، ولكن على الأقل من المفيد معرفة ما يجب البحث عنه. </blockquote><p style=";text-align:right;direction:rtl">  تقسيم مهمتنا إلى مهام أصغر.  تحتاج أولاً إلى إنشاء نقاط لرؤوس المثلثات.  وسيكون من اللطيف إضافة بعض العشوائية إلى إحداثياتهم: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateTriangulation</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// . . . const basePoints = []; for (let x = 0; x &lt;= 100; x += 5) { for (let y = 0; y &lt;= 100; y += 5) { const point = [x, y]; if ((x &gt;= 5) &amp;&amp; (x &lt;= 95)) { point[0] += Math.floor(10 * Math.random() - 5); } if ((y &gt;= 5) &amp;&amp; (y &lt;= 95)) { point[1] += Math.floor(10 * Math.random() - 5); } basePoints.push(point); } } const triangles = triangulate(basePoints); // . . .</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  بعد مراجعة هيكل المصفوفة مع المثلثات (console.log لمساعدتنا) ، نجد أنفسنا نقاطًا نأخذ فيها لون البكسل.  يمكنك ببساطة حساب المتوسط ​​الحسابي لإحداثيات رؤوس المثلثات.  ثم ننقل النقاط الإضافية من الحدود القصوى بحيث لا تخرج في أي مكان ، وبعد تلقي إحداثيات حقيقية غير طبيعية ، نحصل على لون البكسل ، والذي سيصبح لون المثلث. </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> polygons = []; triangles.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">triangle</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> x = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor((basePoints[triangle[<span class="hljs-number"><span class="hljs-number">0</span></span>]][<span class="hljs-number"><span class="hljs-number">0</span></span>] + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">1</span></span>]][<span class="hljs-number"><span class="hljs-number">0</span></span>] + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">2</span></span>]][<span class="hljs-number"><span class="hljs-number">0</span></span>]) / <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> y = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor((basePoints[triangle[<span class="hljs-number"><span class="hljs-number">0</span></span>]][<span class="hljs-number"><span class="hljs-number">1</span></span>] + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">1</span></span>]][<span class="hljs-number"><span class="hljs-number">1</span></span>] + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">2</span></span>]][<span class="hljs-number"><span class="hljs-number">1</span></span>]) / <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x === <span class="hljs-number"><span class="hljs-number">100</span></span>) { x = <span class="hljs-number"><span class="hljs-number">99</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (y === <span class="hljs-number"><span class="hljs-number">100</span></span>) { y = <span class="hljs-number"><span class="hljs-number">99</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> realX = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(x * width / <span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> realY = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(y * height / <span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pixelPosition = <span class="hljs-number"><span class="hljs-number">4</span></span> * (realY * width + realX); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rgb = [ pixels.data[pixelPosition], pixels.data[pixelPosition + <span class="hljs-number"><span class="hljs-number">1</span></span>], pixels.data[pixelPosition + <span class="hljs-number"><span class="hljs-number">2</span></span>] ]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> color = <span class="hljs-string"><span class="hljs-string">'#'</span></span> + rgbHex(...rgb); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> points = <span class="hljs-string"><span class="hljs-string">' '</span></span> + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">0</span></span>]][<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">','</span></span> + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">0</span></span>]][<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-string"><span class="hljs-string">' '</span></span> + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">1</span></span>]][<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">','</span></span> + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">1</span></span>]][<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-string"><span class="hljs-string">' '</span></span> + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">2</span></span>]][<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">','</span></span> + basePoints[triangle[<span class="hljs-number"><span class="hljs-number">2</span></span>]][<span class="hljs-number"><span class="hljs-number">1</span></span>]; polygons.push({ points, color }); });</code> </pre> <br><p style=";text-align:right;direction:rtl">  يبقى فقط لجمع إحداثيات النقاط المطلوبة في سلسلة وإرسالها مع اللون إلى المقاود للمعالجة ، كما فعلنا من قبل. </p><br><p style=";text-align:right;direction:rtl">  في القالب نفسه ، لن يكون لدينا الآن مستطيلات ، ولكن مضلعات: </p><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">{{# each polygons }} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">polygon</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">points</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ points }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'stroke-width:0.1;stroke:{{ color }};fill:{{ color }}'</span></span></span><span class="hljs-tag"> /&gt;</span></span> {{/each }}</code> </pre> <br><p style=";text-align:right;direction:rtl">  التثليث شيء مثير للاهتمام.  من خلال زيادة عدد المثلثات ، يمكنك الحصول على صور جميلة فقط ، لأنه لا أحد يقول أنه يجب علينا استخدامها فقط كعنصر. </p><br><h2 id="mozaika-voronogo" style=";text-align:right;direction:rtl">  فسيفساء Voronoi </h2><br><p style=";text-align:right;direction:rtl">  هناك مشكلة ، مرآة السابقة - قسم أو <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">فسيفساء Voronoi</a> .  لقد استخدمناه بالفعل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">عند العمل مع تظليل</a> ، ولكن هنا يمكن أن يكون مفيدًا أيضًا. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ij/-y/4m/ij-y4mnhq9tlbbkewlmfeyn-q0k.jpeg"></p><br><p style=";text-align:right;direction:rtl">  كما هو الحال مع الخوارزميات المعروفة الأخرى ، لدينا تنفيذ جاهز: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">npm i --save voronoi</code> </pre> <br><p style=";text-align:right;direction:rtl">  ستكون الإجراءات الأخرى مشابهة جدًا لما فعلناه في المثال السابق.  الفرق الوحيد هو أنه لدينا الآن بنية مختلفة - بدلاً من مجموعة من المثلثات لدينا كائن معقد.  والخيارات مختلفة قليلاً.  خلاف ذلك ، كل شيء هو نفسه تقريبا.  يتم إنشاء مصفوفة من النقاط الأساسية بنفس الطريقة ، تخطيها حتى لا تجعل القائمة طويلة جدًا: </p><br><pre style=";text-align:right;direction:rtl"> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateVoronoi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// . . . const box = { xl: 0, xr: 100, yt: 0, yb: 100 }; const diagram = voronoi.compute(basePoints, box); const polygons = []; diagram.cells.forEach((cell) =&gt; { let x = cell.site.x; let y = cell.site.y; if (x === 100) { x = 99; } if (y === 100) { y = 99; } const realX = Math.floor(x * width / 100); const realY = Math.floor(y * height / 100); const pixelPosition = 4 * (realY * width + realX); const rgb = [ pixels.data[pixelPosition], pixels.data[pixelPosition + 1], pixels.data[pixelPosition + 2] ]; const color = '#' + rgbHex(...rgb); let points = ''; cell.halfedges.forEach((halfedge) =&gt; { const endPoint = halfedge.getEndpoint(); points += endPoint.x.toFixed(2) + ',' + endPoint.y.toFixed(2) + ' '; }); polygons.push({ points, color }); }); // . . .</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  نتيجة لذلك ، نحصل على فسيفساء من المضلعات المحدبة.  أيضا نتيجة مثيرة جدا للاهتمام. </p><br><blockquote style=";text-align:right;direction:rtl">  من المفيد تقريب جميع الأرقام إلى أعداد صحيحة أو على الأقل إلى منزلين عشريين.  الدقة المفرطة في SVG غير ضرورية تمامًا هنا ، فهي ستزيد فقط من حجم الصور. </blockquote><br><h2 id="razmytaya-mozaika" style=";text-align:right;direction:rtl">  فسيفساء غير واضحة </h2><br><p style=";text-align:right;direction:rtl">  المثال الأخير الذي سنراه هو فسيفساء ضبابية.  لدينا كل قوة SVG في أيدينا ، فلماذا لا تستخدم المرشحات؟ </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/xt/us/k1/xtusk1lqy7g9zsolqqanjrmqcva.jpeg"></p><br><p style=";text-align:right;direction:rtl">  خذ الفسيفساء الأولى للمستطيلات وأضف مرشح "التمويه" القياسي إليها: </p><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">defs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'my-filter'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">feGaussianBlur</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">in</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'SourceGraphic'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stdDeviation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'2'</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">defs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">g</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">filter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'url(#my-filter)'</span></span></span><span class="hljs-tag">&gt;</span></span> {{# each rects }} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rect</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ x }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ y }}'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'6'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'6'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'{{ color }}'</span></span></span><span class="hljs-tag"> /&gt;</span></span> {{/each }} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">g</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  والنتيجة هي معاينة ضبابية وواضحة لصورتنا ، فهي تشغل مساحة أقل 10 مرات تقريبًا (بدون ضغط) ومتجه وتمتد إلى أي حجم للشاشة.  بنفس الطريقة ، يمكنك طمس بقية الفسيفساء لدينا. </p><br><blockquote style=";text-align:right;direction:rtl">  عند تطبيق مثل هذا المرشح على فسيفساء منتظمة من المستطيلات ، يمكن أن يتحول "تأثير الجيب" ، لذلك إذا كنت تستخدم شيئًا كهذا في الإنتاج ، خاصة على الصور كبيرة الحجم ، فقد يكون من الأفضل تطبيق التمويه ليس عليه ، ولكن على تقسيم Voronoi. </blockquote><br><h2 id="vmesto-zaklyucheniya" style=";text-align:right;direction:rtl">  بدلا من الاستنتاج </h2><br><p style=";text-align:right;direction:rtl">  في هذه المقالة ، نظرنا في كيفية إنشاء جميع أنواع صور كعب SVG على Node.js وتأكدنا من أن هذه ليست مهمة صعبة إذا لم تكتب كل شيء يدويًا ، وإذا أمكن ، قم بتجميع الوحدات الجاهزة.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تتوفر</a> مصادر كاملة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">على جيثب</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar431232/">https://habr.com/ru/post/ar431232/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar431220/index.html">نظرة عالم الأحياء إلى جذور شيخوخةنا</a></li>
<li><a href="../ar431222/index.html">أرشفة الموقع</a></li>
<li><a href="../ar431226/index.html">لعبة الثعبان لـ FPGA Cyclone IV (مع VGA و SPI جويستيك)</a></li>
<li><a href="../ar431228/index.html">تشغيل عقبة للضوء: بلورات سائلة للمساعدة</a></li>
<li><a href="../ar431230/index.html">التخزين للبنية التحتية HPC ، أو كيف جمعنا 65 PB التخزين في مركز RIKEN للأبحاث اليابانية</a></li>
<li><a href="../ar431234/index.html">11 ديسمبر ، موسكو - Alfa JS MeetUp</a></li>
<li><a href="../ar431236/index.html">كيفية الكتابة على الهدف جيم في 2018. الجزء الأول</a></li>
<li><a href="../ar431238/index.html">ملخص الأحداث لمتخصصي الموارد البشرية في مجال تكنولوجيا المعلومات لشهر ديسمبر 2018</a></li>
<li><a href="../ar431242/index.html">شهادات TLS وشبكة الإنترنت</a></li>
<li><a href="../ar431244/index.html">"اثنان بدون تصفية" أو طريقة سهلة لاطلاق النار على ساق</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>