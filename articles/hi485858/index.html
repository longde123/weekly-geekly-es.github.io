<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЫ┤ ЁЯТЖЁЯП╛ ЁЯСЖЁЯП╛ рд╕реМрдВрджрд░реНрдп рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдлреЛрди рдХреИрд╕реЗ рд╕рд┐рдЦрд╛рдПрдВ ЁЯОЩя╕П ЁЯН│ ЁЯСиЁЯП╝тАНЁЯОд</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╣рд╛рд▓ рд╣реА рдореЗрдВ, рдореИрдВрдиреЗ рдЧрдгрд┐рдд рдФрд░ рд▓реЛрдЧреЛрдВ рдХреА рд╕реБрдВрджрд░рддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдкреБрд╕реНрддрдХ рдкрдврд╝реА рдФрд░ рд╕реЛрдЪрд╛ рдХрд┐ рдПрдХ рджрд╢рдХ рдкрд╣рд▓реЗ рдХреНрдпрд╛ рд╡рд┐рдЪрд╛рд░ рдерд╛ рдХрд┐ рдорд╛рдирд╡ рд╕реБрдВрджрд░рддрд╛ рдХреНрдпрд╛ рдереА, рдЗрд╕реЗ рдХреИрд╕реЗ рд╕рдордЭрд╛ рдЬрд╛рдПред...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рд╕реМрдВрджрд░реНрдп рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдлреЛрди рдХреИрд╕реЗ рд╕рд┐рдЦрд╛рдПрдВ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485858/"><img src="https://habrastorage.org/webt/-f/0z/on/-f0zonxrb_qtnmaxp2bt34gu-d4.png" alt="рдЫрд╡рд┐"><br><br>  рд╣рд╛рд▓ рд╣реА рдореЗрдВ, рдореИрдВрдиреЗ рдЧрдгрд┐рдд рдФрд░ рд▓реЛрдЧреЛрдВ рдХреА рд╕реБрдВрджрд░рддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдПрдХ рдкреБрд╕реНрддрдХ рдкрдврд╝реА рдФрд░ рд╕реЛрдЪрд╛ рдХрд┐ рдПрдХ рджрд╢рдХ рдкрд╣рд▓реЗ рдХреНрдпрд╛ рд╡рд┐рдЪрд╛рд░ рдерд╛ рдХрд┐ рдорд╛рдирд╡ рд╕реБрдВрджрд░рддрд╛ рдХреНрдпрд╛ рдереА, рдЗрд╕реЗ рдХреИрд╕реЗ рд╕рдордЭрд╛ рдЬрд╛рдПред  рддрд░реНрдХ рдЬрд┐рд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЧрдгрд┐рдд рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ рд╕реБрдВрджрд░ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕ рддрдереНрдп рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рдЖрдпрд╛ рдХрд┐ рдпрд╣ рд╕рдордорд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкреБрдирд░реНрдЬрд╛рдЧрд░рдг рдХреЗ рдмрд╛рдж рд╕реЗ, рдЪреЗрд╣рд░реЗ рдкрд░ рдХреБрдЫ рдмрд┐рдВрджреБрдУрдВ рдкрд░ рджреВрд░реА рдХреЗ рдмреАрдЪ рд╕рдВрдмрдВрдзреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕реБрдВрджрд░ рдЪреЗрд╣рд░реЗ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЙрд╕ рд╕реБрдВрджрд░ рдЪреЗрд╣рд░реЗ рдХреЗ рд╕реБрдирд╣рд░реЗ рдЕрдиреБрдкрд╛рдд рдХреЗ рдХрд░реАрдм рдХрд┐рд╕реА рддрд░рд╣ рдХрд╛ рд╕рдВрдмрдВрдз рд╣реИред  рдЕрдВрдХ рдХреЗ рд╕реНрдерд╛рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЗрд╕реА рддрд░рд╣ рдХреЗ рд╡рд┐рдЪрд╛рд░реЛрдВ рдХреЛ рдЕрдм рдЪреЗрд╣рд░реЗ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЪреЗрд╣рд░реЗ рдХреЗ рд╕реНрдерд╛рди рдХреА рдЦреЛрдЬ)ред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдиреБрднрд╡ рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдпрджрд┐ рдЖрдк рдЪреЗрд╣рд░реЗ рдкрд░ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдмрд┐рдВрджреБрдУрдВ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рд╕реЗрдЯ рдХреЛ рд╕реАрдорд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдХрдИ рдХрд╛рд░реНрдпреЛрдВ рдореЗрдВ рдмреЗрд╣рддрд░ рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, <a href="https://arxiv.org/abs/1603.01249" rel="nofollow">рдЬрд┐рд╕рдореЗрдВ рдЙрдореНрд░, рд▓рд┐рдВрдЧ</a> рдпрд╛ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ <a href="https://www.gsb.stanford.edu/sites/gsb/files/publication-pdf/wang_kosinski.pdf" rel="nofollow">рдпреМрди рдЕрднрд┐рд╡рд┐рдиреНрдпрд╛рд╕</a> <a href="https://arxiv.org/abs/1603.01249" rel="nofollow">рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ</a> ред  рдпрд╣рд╛рдВ рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рдЗрд╕ рддрд░рд╣ рдХреЗ рдЕрдзреНрдпрдпрди рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░рдиреЗ рдХреА рдиреИрддрд┐рдХрддрд╛ рдХрд╛ рдореБрджреНрджрд╛ рдПрдХ рддреАрд╡реНрд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред <br><a name="habracut"></a><br>  рд▓реЛрдЧреЛрдВ рдХреА рд╕реБрдВрджрд░рддрд╛ рдФрд░ рдЙрд╕рдХреЗ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд╛ рд╡рд┐рд╖рдп рднреА рдиреИрддрд┐рдХ рд░реВрдк рд╕реЗ рд╡рд┐рд╡рд╛рджрд╛рд╕реНрдкрдж рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╡рд┐рдХрд╕рд┐рдд рдХрд░рддреЗ рд╕рдордп, рдореЗрд░реЗ рдХрдИ рджреЛрд╕реНрддреЛрдВ рдиреЗ рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреА рддрд╕реНрд╡реАрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдЗрдирдХрд╛рд░ рдХрд░ рджрд┐рдпрд╛, рдпрд╛ рдмрд╕ рдкрд░рд┐рдгрд╛рдо рдЬрд╛рдирдирд╛ рдирд╣реАрдВ рдЪрд╛рд╣рддреЗ рдереЗ (рдпрд╣ рд╣рд╛рд╕реНрдпрд╛рд╕реНрдкрдж рд╣реИ рдХрд┐ рдЬреНрдпрд╛рджрд╛рддрд░ рд▓рдбрд╝рдХрд┐рдпреЛрдВ рдиреЗ рдкрд░рд┐рдгрд╛рдо рдЬрд╛рдирдиреЗ рд╕реЗ рдЗрдирдХрд╛рд░ рдХрд░ рджрд┐рдпрд╛)ред  рд╕рд╛рде рд╣реА, рд╕реМрдВрджрд░реНрдп рдореВрд▓реНрдпрд╛рдВрдХрди рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХрд░рдиреЗ рдХрд╛ рд▓рдХреНрд╖реНрдп рджрд┐рд▓рдЪрд╕реНрдк рджрд╛рд░реНрд╢рдирд┐рдХ рдкреНрд░рд╢реНрди рдЙрдард╛ рд╕рдХрддрд╛ рд╣реИред  рд╕рдВрд╕реНрдХреГрддрд┐ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╕реМрдВрджрд░реНрдп рдХреА рдЕрд╡рдзрд╛рд░рдгрд╛ рдХрд┐рд╕ рд╕реАрдорд╛ рддрдХ рд╣реИ?  рдХрд┐рддрдирд╛ рд╕рдЪ рд╣реИ тАЬрджреЗрдЦрдиреЗ рд╡рд╛рд▓реЗ рдХреА рдЖрдБрдЦреЛрдВ рдореЗрдВ рд╕реБрдВрджрд░рддрд╛тАЭ?  рдХреНрдпрд╛ рд╕реМрдВрджрд░реНрдп рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рд╕рдВрдХреЗрддреЛрдВ рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ? <br><br>  рдЗрди рд╕рд╡рд╛рд▓реЛрдВ рдХрд╛ рдЬрд╡рд╛рдм рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рджреВрд╕рд░реЛрдВ рджреНрд╡рд╛рд░рд╛ рдХреБрдЫ рд▓реЛрдЧреЛрдВ рдХреА рд░реЗрдЯрд┐рдВрдЧ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЖрдВрдХрдбрд╝реЛрдВ рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдореИрдВрдиреЗ рдПрдХ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдореЙрдбрд▓ рдХреЛ рдбрд┐рдЬрд╛рдЗрди рдХрд░рдиреЗ рдФрд░ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛ рдЬреЛ рд╕реМрдВрджрд░реНрдп рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░реЗрдЧрд╛, рд╕рд╛рде рд╣реА рдЗрд╕реЗ рдПрдВрдбреНрд░реЙрдЗрдб рдлреЛрди рдкрд░ рднреА рдЪрд▓рд╛рдПрдЧрд╛ред <br><br><h2>  рднрд╛рдЧ 0. рдкрд╛рдЗрдкрд▓рд╛рдЗрди </h2><br>  рдпрд╣ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдЕрдЧрд▓реЗ рдЪрд░рдг рдПрдХ-рджреВрд╕рд░реЗ рд╕реЗ рдХреИрд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИрдВ, рдореИрдВрдиреЗ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ рдПрдХ рдЪрд┐рддреНрд░ рдмрдирд╛рдпрд╛: <br><br><img src="https://habrastorage.org/webt/cy/jp/zh/cyjpzhhy_hiczxqefjp9qgaohf0.png" alt="рдЫрд╡рд┐"><br><br>  рдиреАрд▓рд╛ - рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкреБрд╕реНрддрдХрд╛рд▓рдп рдФрд░ рдмрд╛рд╣рд░реА рдбреЗрдЯрд╛ред  рдкреАрд▓рд╛ - рдЖрд╡реЗрджрди рдореЗрдВ рдирд┐рдпрдВрддреНрд░рдгред <br><br><h2>  рднрд╛рдЧ 1. рдЕрдЬрдЧрд░ </h2><br>  рдЪреВрдБрдХрд┐ рд╕реМрдВрджрд░реНрдп рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдПрдХ рдирд╛рдЬрд╝реБрдХ рд╡рд┐рд╖рдп рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдбреЛрдореЗрди рдореЗрдВ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдбреЗрдЯрд╛рд╕реЗрдЯ рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ, рдЬрд┐рдирдореЗрдВ рдореВрд▓реНрдпрд╛рдВрдХрди рдХреЗ рд╕рд╛рде рдлрд╝реЛрдЯреЛ рд╣реЛрддреЗ рд╣реИрдВ (рдореБрдЭреЗ рдпрдХреАрди рд╣реИ рдХрд┐ рдСрдирд▓рд╛рдЗрди рдбреЗрдЯрд┐рдВрдЧ рд╕реЗрд╡рд╛рдУрдВ рдЬреИрд╕реЗ рдЯрд┐рдВрдбрд░ рдореЗрдВ рдЖрдВрдХрдбрд╝реЛрдВ рдХрд╛ рдмрд╣реБрдд рдмрдбрд╝рд╛ рд╕рдореВрд╣ рд╣реИ)ред  рдореБрдЭреЗ рдЪреАрди рдХреЗ рд╡рд┐рд╢реНрд╡рд╡рд┐рджреНрдпрд╛рд▓рдпреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдореЗрдВ рд╕рдВрдХрд▓рд┐рдд <a href="https://github.com/HCIILAB/SCUT-FBP5500-Database-Release" rel="nofollow">рдПрдХ рдбреЗрдЯрд╛рдмреЗрд╕</a> рдорд┐рд▓рд╛, рдЬрд┐рд╕рдореЗрдВ 5500 рддрд╕реНрд╡реАрд░реЗрдВ рдереАрдВ, рдкреНрд░рддреНрдпреЗрдХ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди 7 рдореВрд▓реНрдпрд╛рдВрдХрдирдХрд░реНрддрд╛рдУрдВ рдиреЗ рдЪреАрдиреА рдЫрд╛рддреНрд░реЛрдВ рдХреЗ рдмреАрдЪ рдХрд┐рдпрд╛ред  5,500 рддрд╕реНрд╡реАрд░реЛрдВ рдореЗрдВ рд╕реЗ, 2,000 рдПрд╢рд┐рдпрд╛рдИ рдкреБрд░реБрд╖ (рдПрдПрдо), 2000 рдПрд╢рд┐рдпрд╛рдИ рдорд╣рд┐рд▓рд╛ (рдПрдПрдл), рдФрд░ 750 рдпреВрд░реЛрдкрд┐рдпреЛрдЗрдб рдкреБрд░реБрд╖ (рд╕реАрдПрдо) рдФрд░ рдорд╣рд┐рд▓рд╛ (рд╕реАрдПрдл) рд╣реИрдВред <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fcf/1db/f9b/fcf1dbf9b67fee5543fdc9833d429676.jpg" alt="рдЫрд╡рд┐"><br><br>  рдЖрдЗрдП рдкрд╛рдпрдерди рдкрд╛рдВрдбрд╛ рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдбреЗрдЯрд╛ рдкрдврд╝реЗрдВ рдФрд░ рдбреЗрдЯрд╛ рдкрд░ рдПрдХ рддреНрд╡рд░рд┐рдд рдирдЬрд╝рд░ рдбрд╛рд▓реЗрдВред  рд╡рд┐рднрд┐рдиреНрди рд▓рд┐рдВрдЧ рдФрд░ рджреМрдбрд╝ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорд╛рдирд┐рдд рд╡рд┐рддрд░рдг: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.pyplot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt ratingDS=pd.read_excel(<span class="hljs-string"><span class="hljs-string">'../input/faces-scut/scut-fbp5500_v2/SCUT-FBP5500_v2/All_Ratings.xlsx'</span></span>) Answer=ratingDS.groupby(<span class="hljs-string"><span class="hljs-string">'Filename'</span></span>).mean()[<span class="hljs-string"><span class="hljs-string">'Rating'</span></span>] ratingDS[<span class="hljs-string"><span class="hljs-string">'race'</span></span>]=ratingDS[<span class="hljs-string"><span class="hljs-string">'Filename'</span></span>].apply(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x:x[:<span class="hljs-number"><span class="hljs-number">2</span></span>]) fig, ax = plt.subplots(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, sharex=<span class="hljs-string"><span class="hljs-string">'col'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, race <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate([<span class="hljs-string"><span class="hljs-string">'CF'</span></span>,<span class="hljs-string"><span class="hljs-string">'CM'</span></span>,<span class="hljs-string"><span class="hljs-string">'AF'</span></span>,<span class="hljs-string"><span class="hljs-string">'AM'</span></span>]): sbp=ax[i%<span class="hljs-number"><span class="hljs-number">2</span></span>,i//<span class="hljs-number"><span class="hljs-number">2</span></span>] ratingDS[ratingDS[<span class="hljs-string"><span class="hljs-string">'race'</span></span>]==race].groupby(<span class="hljs-string"><span class="hljs-string">'Filename'</span></span>)[<span class="hljs-string"><span class="hljs-string">'Rating'</span></span>].mean().hist(alpha=<span class="hljs-number"><span class="hljs-number">0.5</span></span>, bins=<span class="hljs-number"><span class="hljs-number">20</span></span>,label=race,grid=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>,rwidth=<span class="hljs-number"><span class="hljs-number">0.9</span></span>,ax=sbp) sbp.set_title(race)</code> </pre> <br><img src="https://habrastorage.org/webt/fz/1q/fo/fz1qfoby_-ijefbbl4ifctz3llo.png" alt="рдЫрд╡рд┐"><br><br>  рдпрд╣ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐, рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдкреБрд░реБрд╖реЛрдВ рдХреЛ рдорд╣рд┐рд▓рд╛рдУрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдХрдо рд╕реБрдВрджрд░ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╡рд┐рддрд░рдг рдмрд┐рдореЛрдбрд▓ рд╣реИ - рд╡рд╣рд╛рдБ рд╣реИрдВред  рдЬрд┐рдиреНрд╣реЗрдВ рд╕реБрдВрджрд░ рдФрд░ "рдФрд╕рдд" рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред  рд▓рдЧрднрдЧ рдХреЛрдИ рдХрдо рд░реЗрдЯрд┐рдВрдЧ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдбреЗрдЯрд╛ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЕрд╕рд╛рдорд╛рдиреНрдп рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рд╣рдо рдЙрдиреНрд╣реЗрдВ рдЕрднреА рдХреЗ рд▓рд┐рдП рдЫреЛрдбрд╝ рджреЗрдВред <br><br>  рдЖрдЗрдП рдЕрдиреБрдорд╛рдиреЛрдВ рдореЗрдВ рдорд╛рдирдХ рд╡рд┐рдЪрд▓рди рджреЗрдЦреЗрдВ: <br><br><pre> <code class="python hljs">ratingDS.groupby(<span class="hljs-string"><span class="hljs-string">'Filename'</span></span>)[<span class="hljs-string"><span class="hljs-string">'Rating'</span></span>].std().mean()</code> </pre><br>  рдпрд╣ 0.64 рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рд╡рд┐рднрд┐рдиреНрди рдореВрд▓реНрдпрд╛рдВрдХрдирдХрд░реНрддрд╛рдУрдВ рдХреЗ рдЖрдХрд▓рди рдореЗрдВ рдЕрдВрддрд░ 5 рдореЗрдВ рд╕реЗ 1 рдЕрдВрдХ рд╕реЗ рдХрдо рд╣реИ, рдЬреЛ рд╕реМрдВрджрд░реНрдп рдХреЗ рдЖрдХрд▓рди рдореЗрдВ рдПрдХрдорддрддрд╛ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рдпрдереЛрдЪрд┐рдд рдХрд╣рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ "рд╕реБрдВрджрд░рддрд╛ рджреЗрдЦрдиреЗ рд╡рд╛рд▓реЗ рдХреА рдирдЬрд░ рдореЗрдВ рдирд╣реАрдВ рд╣реИред"  рдФрд╕рдд рд╣реЛрдиреЗ рдкрд░, рдЖрдк рдореЙрдбрд▓ рдХреЛ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдордЬрд╝рдмреВрддреА рд╕реЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкреНрд░реЛрдЧреНрд░рд╛рдореЗрдЯрд┐рдХ рдореВрд▓реНрдпрд╛рдВрдХрди рдХреА рдореМрд▓рд┐рдХ рдЕрд╕рдВрднрд╡рддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЪрд┐рдВрддрд╛ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдиреБрдорд╛рди рдХреЗ рдорд╛рдирдХ рд╡рд┐рдЪрд▓рди рдХреЗ рдЫреЛрдЯреЗ рдореВрд▓реНрдп рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдХреБрдЫ рдореВрд▓реНрдпрд╛рдВрдХрдирдХрд░реНрддрд╛рдУрдВ рдХреА рд░рд╛рдп "рд╕рд╛рдзрд╛рд░рдг" рдПрдХ рд╕реЗ рдмрд╣реБрдд рдЕрд▓рдЧ рд╣реЛ рд╕рдХрддреА рд╣реИред  рдЖрдЗрдП рдЕрдиреБрдорд╛рди рдФрд░ рдорд╛рдзреНрдпрд┐рдХрд╛ рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХреЗ рд╡рд┐рддрд░рдг рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВ: <br><br><pre> <code class="python hljs">R2=ratingDS.join(ratingDS.groupby(<span class="hljs-string"><span class="hljs-string">'Filename'</span></span>)[<span class="hljs-string"><span class="hljs-string">'Rating'</span></span>].median(), on=<span class="hljs-string"><span class="hljs-string">'Filename'</span></span>, how=<span class="hljs-string"><span class="hljs-string">'inner'</span></span>,rsuffix =<span class="hljs-string"><span class="hljs-string">' median'</span></span>) R2[<span class="hljs-string"><span class="hljs-string">'ratingdiff'</span></span>]=(R2[<span class="hljs-string"><span class="hljs-string">'Rating median'</span></span>]-R2[<span class="hljs-string"><span class="hljs-string">'Rating'</span></span>]).astype(int) print(set(R2[<span class="hljs-string"><span class="hljs-string">'ratingdiff'</span></span>])) R2[<span class="hljs-string"><span class="hljs-string">'ratingdiff'</span></span>].hist(label=<span class="hljs-string"><span class="hljs-string">'difference of raings'</span></span>,bins=[<span class="hljs-number"><span class="hljs-number">-3.5</span></span>,<span class="hljs-number"><span class="hljs-number">-2.5</span></span>,<span class="hljs-number"><span class="hljs-number">-1.5</span></span>,<span class="hljs-number"><span class="hljs-number">-0.5</span></span>,<span class="hljs-number"><span class="hljs-number">0.5</span></span>,<span class="hljs-number"><span class="hljs-number">1.5</span></span>,<span class="hljs-number"><span class="hljs-number">2.5</span></span>,<span class="hljs-number"><span class="hljs-number">3.5</span></span>,<span class="hljs-number"><span class="hljs-number">4.5</span></span>],grid=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>,rwidth=<span class="hljs-number"><span class="hljs-number">0.5</span></span>)</code> </pre><br><img src="https://habrastorage.org/webt/ww/qb/7w/wwqb7wdyk_neg_semros1qthb_g.png" alt="рдЫрд╡рд┐"><br><br>  рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рдкреИрдЯрд░реНрди рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЬрд┐рди рд▓реЛрдЧреЛрдВ рдХрд╛ рд╕реНрдХреЛрд░ рдФрд╕рдд рд╕реЗ 1 рдЕрдВрдХ рдЕрдзрд┐рдХ рд╣реИ <br><br><pre> <code class="python hljs">len(R2[R2[<span class="hljs-string"><span class="hljs-string">'ratingdiff'</span></span>].abs()&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>])/len(R2)</code> </pre><br>  .029433333333333332 <br>  3% рд╕реЗ рдХрдо рд╣реИред  рдпрд╣реА рд╣реИ, рд╕реМрдВрджрд░реНрдп рдХрд╛ рдЖрдХрд▓рди рдХрд░рдиреЗ рдХреЗ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рд╣рдбрд╝рддрд╛рд▓реА рдПрдХрдордд рдлрд┐рд░ рд╕реЗ рдкреБрд╖реНрдЯрд┐ рдХреА рдЬрд╛рддреА рд╣реИред <br>  рдЖрд╡рд╢реНрдпрдХ рдФрд╕рдд рд░реЗрдЯрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рдмрдирд╛рдПрдВ <br><br><pre> <code class="python hljs">Answer=ratingDS.groupby(<span class="hljs-string"><span class="hljs-string">'Filename'</span></span>).mean()[<span class="hljs-string"><span class="hljs-string">'Rating'</span></span>]</code> </pre><br>  рд╣рдорд╛рд░рд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдЫреЛрдЯрд╛ рд╣реИ;  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╕рднреА рддрд╕реНрд╡реАрд░реЛрдВ рдореЗрдВ рдЬреНрдпрд╛рджрд╛рддрд░ рдкреВрд░реНрдг-рдЪреЗрд╣рд░реЗ рд╡рд╛рд▓реА рдЫрд╡рд┐рдпрд╛рдВ рд╣реЛрддреА рд╣реИрдВ, рдФрд░ рдореИрдВ рдЪреЗрд╣рд░реЗ рдХреА рдХрд┐рд╕реА рднреА рд╕реНрдерд┐рддрд┐ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдкрд░рд┐рдгрд╛рдо рдЪрд╛рд╣реВрдВрдЧрд╛ред  рдбреЗрдЯрд╛ рдХреА рдереЛрдбрд╝реА рдорд╛рддреНрд░рд╛ рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рд╕реАрдЦрдиреЗ рдХреА рддрдХрдиреАрдХ рдХрд╛ рдЕрдХреНрд╕рд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ - рд╕рдорд╛рди рдХрд╛рд░реНрдпреЛрдВ рдФрд░ рдЙрдирдХреЗ рд╕рдВрд╢реЛрдзрди рдХреЗ рд▓рд┐рдП рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧред  рдореЗрд░реЗ рдХрд╛рд░реНрдп рдХреЗ рдХрд░реАрдм рдЪреЗрд╣рд░рд╛ рдкрд╣рдЪрд╛рди рдХрд╛рд░реНрдп рд╣реИред  рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рддреАрди-рдЪрд░рдг рддрд░реАрдХреЗ рд╕реЗ рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  1. рдЫрд╡рд┐ рдФрд░ рдЙрд╕рдХреЗ рд╕реНрдХреЗрд▓рд┐рдВрдЧ рдкрд░ рдПрдХ рдЪреЗрд╣рд░рд╛ рдкрд╣рдЪрд╛рди рд╣реИред <br><br>  2. рдПрдХ рджреГрдврд╝ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдЪреЗрд╣рд░реЗ рдХреА рдЫрд╡рд┐ рдХреЛ рдПрдХ рдлреАрдЪрд░ рд╡реЗрдХреНрдЯрд░ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕ рддрд░рд╣ рдХреЗ рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рдЧреБрдг рдРрд╕реЗ рд╣реЛрддреЗ рд╣реИрдВ рдХрд┐ рдкрд░рд┐рд╡рд░реНрддрди рдЪреЗрд╣рд░реЗ рдХреЗ рд░реЛрдЯреЗрд╢рди рдФрд░ рдХреЗрд╢ рд╡рд┐рдиреНрдпрд╛рд╕ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ рдЕрдкрд░рд┐рд╡рд░реНрддрдиреАрдп рд╣реИред  рднрд╛рд╡рдирд╛рдУрдВ рдФрд░ рдХрд┐рд╕реА рднреА рдЕрд╕реНрдерд╛рдпреА рдЫрд╡рд┐рдпреЛрдВ рдХреА рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпрд╛рдБред  рдЗрд╕ рддрд░рд╣ рдХреЗ рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рд╕реАрдЦрдирд╛ рдЕрдкрдиреЗ рдЖрдк рдореЗрдВ рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рдХрд╛рдо рд╣реИ, рдЬрд┐рд╕реЗ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдмрдбрд╝реЗ рдкреИрдорд╛рдиреЗ рдкрд░ рдЯреНрд░реИрдХрд┐рдВрдЧ рдФрд░ рдкрд╣рдЪрд╛рди рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдореЗрдВ рд╕реБрдзрд╛рд░ рдХреЗ рд▓рд┐рдП рдЗрд╕ рд░реВрдкрд╛рдВрддрд░рдг рдХреЛ рдмреЗрд╣рддрд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рдЧрд╛рддрд╛рд░ рдирдП рд╡рд┐рдХрд╛рд╕ рджрд┐рдЦрд╛рдИ рджреЗ рд░рд╣реЗ рд╣реИрдВред  рд╡реЗ рдиреЗрдЯрд╡рд░реНрдХ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдФрд░ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд╡рд┐рдзрд┐ (рдЙрджрд╛рд╣рд░рдг рдЯреНрд░рд┐рдкрд▓ рд▓реЙрд╕-рд╕реЗрдВрд╕рд░рдлреЗрд╕-рдЖрд░реНрдХрдлреЗрд╕ рд▓реЙрд╕) рджреЛрдиреЛрдВ рдХрд╛ рдЕрдиреБрдХреВрд▓рди рдХрд░рддреЗ рд╣реИрдВред <br><br>  3. рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд▓реЛрдЧреЛрдВ рдХреЗ рд╕рд╛рде рдлрд╝реАрдЪрд░ рд╡реЗрдХреНрдЯрд░ рдХреА рддреБрд▓рдирд╛ред <br><br>  рд╣рдорд╛рд░реЗ рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ 1-2 рдмрд┐рдВрджреБрдУрдВ рдХреЗ рддреИрдпрд╛рд░ рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред  рдЪреЗрд╣рд░реЗ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХрд╛ рдХрд╛рд░реНрдп рдЖрдорддреМрд░ рдкрд░ рдХрдИ рддрд░реАрдХреЛрдВ рд╕реЗ рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд▓рдЧрднрдЧ рдХрд┐рд╕реА рднреА рдореЛрдмрд╛рдЗрд▓ рдбрд┐рд╡рд╛рдЗрд╕ рдореЗрдВ рдлреЗрд╕ рдбрд┐рдЯреЗрдХреНрдЯрд░ рд╣реЛрддреЗ рд╣реИрдВ (рдПрдВрдбреНрд░реЙрдЗрдб рдкрд░ рд╡реЗ рдорд╛рдирдХ GooglePlay рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рдкреИрдХреЗрдЬ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИрдВ), рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдлрд╝реЛрдЯреЛрдЧреНрд░рд╛рдлрд╝ рдХрд░рддреЗ рд╕рдордп рдЪреЗрд╣рд░реЛрдВ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рджрд┐рд╢ рд░реВрдк рдореЗрдВ рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ рдХреЗ рдЕрдиреБрд╡рд╛рдж рдХреЗ рд▓рд┐рдП, рдПрдХ рдЧреИрд░-рд╕реНрдкрд╖реНрдЯ рд╕реВрдХреНрд╖реНрдо рдмрд┐рдВрджреБ рд╣реИред  рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рд╕рдВрдХреЗрддред  рдорд╛рдиреНрдпрддрд╛ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдХрд╛рд▓реА рдЧрдИ - рдПрдХ рд╡реНрдпрдХреНрддрд┐ рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╡реЗ рд╕реБрдВрджрд░рддрд╛ рдХреЗ рд╕рд╛рде рдмрд┐рд▓реНрдХреБрд▓ рднреА рд╕рдВрдмрдВрдз рдирд╣реАрдВ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред  рдЕрдзрд┐рдХред  рдХрдиреНрд╡реЗрдиреНрд╢рдирд▓ рдиреНрдпреВрд░рд▓ рдиреЗрдЯрд╡рд░реНрдХ рдХреА рдЦрд╝рд╛рд╕рд┐рдпрддреЛрдВ рдХреЗ рдХрд╛рд░рдг, рдпреЗ рд╕рдВрдХреЗрдд рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдиреАрдп рд╣реИрдВ, рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░ рдпрд╣ рдХрдИ рд╕рдорд╕реНрдпрд╛рдУрдВ (рдПрдХрд▓ рдкрд┐рдХреНрд╕реЗрд▓ рд╣рдорд▓реЗ) рдХрд╛ рдХрд╛рд░рдг рдмрди рд╕рдХрддрд╛ рд╣реИред  рдлрд┐рд░ рднреА, рдореИрдВрдиреЗ рдкрд╛рдпрд╛ рдХрд┐ рдкрд░рд┐рдгрд╛рдо рд╡реЗрдХреНрдЯрд░ рдХреЗ рдЖрдпрд╛рдо рдкрд░ рдЕрддреНрдпрдзрд┐рдХ рдирд┐рд░реНрднрд░ рд╣реИрдВ, рдФрд░ рдЕрдЧрд░ рд╕реМрдВрджрд░реНрдп рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 128 рд╕рдВрдХреЗрдд рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИрдВ, рддреЛ 512 рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред  рдЗрд╕рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдПрдХ <a href="https://github.com/shaoanlu/face_toolbox_keras" rel="nofollow">рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рд░реАрд╕реЗрдЯ-рдЖрдзрд╛рд░рд┐рдд рдЕрдВрддрд░реНрджреГрд╖реНрдЯрд┐ рдиреЗрдЯрд╡рд░реНрдХ</a> рдЪреБрдирд╛ рдЧрдпрд╛ рдерд╛ред  рд╣рдо рдорд╢реАрди рд╕реАрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд░реВрдкрд░реЗрдЦрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдХреЗрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рднреА рдХрд░реЗрдВрдЧреЗред <br>  рдкреВрд░реНрд╡-рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбрд▓ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╕реНрддреГрдд рдХреЛрдб <a href="https://www.kaggle.com/alexanderkhar/face-beauty-ranking-ported-to-android" rel="nofollow">рдпрд╣рд╛рдВ</a> рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ <a href="https://www.kaggle.com/alexanderkhar/face-beauty-ranking-ported-to-android" rel="nofollow">рд╣реИред</a> <br><br><pre> <code class="python hljs">model=LResNet100E_IR()</code> </pre><br>  <a href="https://github.com/ipazc/mtcnn" rel="nofollow">Mtcnn рдлреЗрд╕</a> рдбрд┐рдЯреЗрдХреНрдЯрд░ рдкреНрд░реАрдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдлреЗрд╕ рдбрд┐рдЯреЗрдХреНрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ <a href="https://github.com/ipazc/mtcnn" rel="nofollow">ред</a> <br><br><pre> <code class="python hljs">detector = MtcnnDetector(model_folder=mtcnn_path, ctx=ctx, num_worker=<span class="hljs-number"><span class="hljs-number">1</span></span>, accurate_landmark = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, threshold=det_threshold)</code> </pre><br>  рдбреЗрдЯрд╛рд╕реЗрдЯ рд╕реЗ рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░реЗрдВ, рдХреНрд░реЙрдк рдХрд░реЗрдВ рдФрд░ рдЪрд┐рддреНрд░ рдмрдирд╛рдПрдВ: <br><br><pre> <code class="python hljs">imgpath=<span class="hljs-string"><span class="hljs-string">'../input/faces-scut/scut-fbp5500_v2/SCUT-FBP5500_v2/Images/'</span></span> <span class="hljs-comment"><span class="hljs-comment">#    facevecs=[] for name in tqdm.tqdm(Answer.index): #   img1 = cv2.imread(imgpath+name) # ,     pre1 = np.moveaxis(get_input(detector,img1),0,-1) #  vec = model.predict(np.stack([pre1])) #   facevecs.append(vec)</span></span></code> </pre><br>  рд╣рдо рдбреЗрдЯрд╛ рдХреЛ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдореЗрдВ рддреЛрдбрд╝рдХрд░ рддреИрдпрд╛рд░ рдХрд░реЗрдВрдЧреЗ (рдЙрдирдореЗрдВ рд╕реЗ 90%, рд╣рдо рдЙрди рдкрд░ рдЕрдзреНрдпрдпрди рдХрд░реЗрдВрдЧреЗ) рдФрд░ рд╕рддреНрдпрд╛рдкрди (рд╣рдо рдЙрди рдкрд░ рдореЙрдбрд▓ рдХреЗ рдХрд╛рдо рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВрдЧреЗ) рд╡реИрдХреНрдЯрд░ред  рд╣рдо рдбреЗрдЯрд╛ рдХреЛ 0-1 рдХреА рд╕реАрдорд╛ рддрдХ рд╕рд╛рдорд╛рдиреНрдп рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="python hljs">X=np.stack(facevecs)[:,<span class="hljs-number"><span class="hljs-number">0</span></span>,:] Y=(Answer[:])/<span class="hljs-number"><span class="hljs-number">5</span></span> Indicies=np.arange(len(Answer)) X,Y,Indicies=sklearn.utils.shuffle(X,Y,Indicies) Xtrain=X[:int(len(facevecs)*<span class="hljs-number"><span class="hljs-number">0.9</span></span>)] Ytrain=Y[:int(len(facevecs)*<span class="hljs-number"><span class="hljs-number">0.9</span></span>)] Indtrain=Indicies[:int(len(facevecs)*<span class="hljs-number"><span class="hljs-number">0.9</span></span>)] Xval=X[int(len(facevecs)*<span class="hljs-number"><span class="hljs-number">0.9</span></span>):] Yval=Y[int(len(facevecs)*<span class="hljs-number"><span class="hljs-number">0.9</span></span>):] Indval=Indicies[int(len(facevecs)*<span class="hljs-number"><span class="hljs-number">0.9</span></span>):]</code> </pre><br>  рдЕрдм рдЪрд▓реЛ рдореЙрдбрд▓ рдкрд░ рдЪрд▓рддреЗ рд╣реИрдВред  рд╕реБрдВрджрд░рддрд╛ рдХрд╛ рд╡рд░реНрдгрдиред <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Createheadmodel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> inp=keras.layers.Input((<span class="hljs-number"><span class="hljs-number">512</span></span>,)) x=keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">32</span></span>,activation=<span class="hljs-string"><span class="hljs-string">'elu'</span></span>)(inp) x=keras.layers.Dropout(<span class="hljs-number"><span class="hljs-number">0.1</span></span>)(x) out=keras.layers.Dense(<span class="hljs-number"><span class="hljs-number">1</span></span>,activation=<span class="hljs-string"><span class="hljs-string">'hard_sigmoid'</span></span>,use_bias=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>,kernel_initializer=keras.initializers.Ones())(x) model=keras.models.Model(input=inp,output=out) model.layers[<span class="hljs-number"><span class="hljs-number">-1</span></span>].trainable=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span> model.compile(optimizer=keras.optimizers.Adam(lr=<span class="hljs-number"><span class="hljs-number">0.0001</span></span>), loss=<span class="hljs-string"><span class="hljs-string">'mse'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model modelhead=Createheadmodel()</code> </pre><br>  рдпрд╣ рдореЙрдбрд▓ 32-рдиреНрдпреВрд░реЙрдиреНрд╕ рдФрд░ 512 рдЗрдирдкреБрдЯ рдиреЛрдбреНрд╕ рдХреЗ рд╕рд╛рде рдПрдХ рдПрдХрд▓-рдкрд░рдд рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рд╣реИ - рд╕рдмрд╕реЗ рд╕рд░рд▓ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдореЗрдВ рд╕реЗ рдПрдХ, рдЬреЛ, рдлрд┐рд░ рднреА, рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рд╣реИ: <br><br><pre> <code class="python hljs">hist=modelhead.fit(Xtrain,Ytrain, epochs=<span class="hljs-number"><span class="hljs-number">4000</span></span>, batch_size=<span class="hljs-number"><span class="hljs-number">5000</span></span>, validation_data=(Xval,Yval) )</code> </pre><br>  4950/4950 [===============================] - 0s 3us / рдЪрд░рдг - рд╣рд╛рдирд┐: 0.0069 - val_loss: 0.0071 <br>  рдЖрдЗрдП рд╕реАрдЦрдиреЗ рдХреЗ рдШрдЯрддрд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВ <br><br><pre> <code class="python hljs">plt.plot(hist.history[<span class="hljs-string"><span class="hljs-string">'loss'</span></span>][<span class="hljs-number"><span class="hljs-number">100</span></span>:], label=<span class="hljs-string"><span class="hljs-string">'loss'</span></span>) plt.plot(hist.history[<span class="hljs-string"><span class="hljs-string">'val_loss'</span></span>][<span class="hljs-number"><span class="hljs-number">100</span></span>:],label=<span class="hljs-string"><span class="hljs-string">'validation_loss'</span></span>) plt.legend(bbox_to_anchor=(<span class="hljs-number"><span class="hljs-number">0.95</span></span>, <span class="hljs-number"><span class="hljs-number">0.95</span></span>), loc=<span class="hljs-string"><span class="hljs-string">'upper right'</span></span>, borderaxespad=<span class="hljs-number"><span class="hljs-number">0.</span></span>)</code> </pre><br>  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд╣рд╛рдирд┐ (рдорддрд▓рдм рд╡рд░реНрдЧ рд╡рд┐рдЪрд▓рди) рд╕рддреНрдпрд╛рдкрди рдбреЗрдЯрд╛ рдкрд░ 0.0071 рд╣реИ, рдЗрд╕рд▓рд┐рдП рдорд╛рдирдХ рд╡рд┐рдЪрд▓рди = 0.084 рдпрд╛ 0.42 рдЕрдВрдХ рдкрд╛рдВрдЪ-рдмрд┐рдВрджреБ рдкреИрдорд╛рдиреЗ рдкрд░ рд╣реИ, рдЬреЛ рд▓реЛрдЧреЛрдВ рджреНрд╡рд╛рд░рд╛ рджрд┐рдП рдЧрдП рдЕрдиреБрдорд╛рдиреЛрдВ рдореЗрдВ рдкреНрд░рд╕рд╛рд░ (0.6 рдЕрдВрдХ) рд╕реЗ рдХрдо рд╣реИред  рд╣рдорд╛рд░рд╛ рдореЙрдбрд▓ рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реИред <br><br>  рдпрд╣ рдХрд▓реНрдкрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдореЙрдбрд▓ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЖрдк рдмрд┐рдЦрд░рдиреЗ рдЖрд░реЗрдЦ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - рд╕рддреНрдпрд╛рдкрди рдбреЗрдЯрд╛ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рддрд╕реНрд╡реАрд░ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ рдмрд┐рдВрджреБ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддреЗ рд╣реИрдВ, рдЬрд╣рд╛рдВ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдореЗрдВ рд╕реЗ рдПрдХ рдФрд╕рдд рдЪреЗрд╣рд░реЗ рдХреА рд░реЗрдЯрд┐рдВрдЧ рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ рдФрд░ рджреВрд╕рд░реЗ рд╕реЗ рдФрд╕рдд рдЕрдиреБрдорд╛рдирд┐рдд рд░реЗрдЯрд┐рдВрдЧ: <br><br><pre> <code class="python hljs">Answer2=Answer.to_frame()[:<span class="hljs-number"><span class="hljs-number">5500</span></span>] Answer2[<span class="hljs-string"><span class="hljs-string">'ans'</span></span>]=<span class="hljs-number"><span class="hljs-number">0</span></span> Answer2[<span class="hljs-string"><span class="hljs-string">'race'</span></span>]=Answer2.index Answer2[<span class="hljs-string"><span class="hljs-string">'race'</span></span>]=Answer2[<span class="hljs-string"><span class="hljs-string">'race'</span></span>].apply(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x[:<span class="hljs-number"><span class="hljs-number">2</span></span>]) Answer2[<span class="hljs-string"><span class="hljs-string">'ans'</span></span>]=modelhead.predict(np.stack(facevecs)[:,<span class="hljs-number"><span class="hljs-number">0</span></span>,:])*<span class="hljs-number"><span class="hljs-number">5</span></span> xy=np.array(Answer2.iloc[Indval][[<span class="hljs-string"><span class="hljs-string">'ans'</span></span>,<span class="hljs-string"><span class="hljs-string">'Rating'</span></span>]]) plt.scatter(xy[:,<span class="hljs-number"><span class="hljs-number">1</span></span>],xy[:,<span class="hljs-number"><span class="hljs-number">0</span></span>])</code> </pre><br><img src="https://habrastorage.org/webt/w2/t9/dd/w2t9ddnfyzjpx-xp7q3_wmsubzk.png" alt="рдЫрд╡рд┐"><br><br>  рд╡рд╛рдИ рдЕрдХреНрд╖ - рдореЙрдбрд▓ рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрдорд╛рдирд┐рдд рдореВрд▓реНрдп, рдПрдХреНрд╕ рдЕрдХреНрд╖ - рд▓реЛрдЧреЛрдВ рдХреЗ рдЕрдиреБрдорд╛рдиреЛрдВ рдХрд╛ рдФрд╕рдд рдореВрд▓реНрдпред  рд╣рдо рдПрдХ рдЙрдЪреНрдЪ рд╕рд╣рд╕рдВрдмрдВрдз рджреЗрдЦрддреЗ рд╣реИрдВ (рдЪрд┐рддреНрд░ рд╡рд┐рдХрд░реНрдг рдХреЗ рд╕рд╛рде рд▓рдореНрдмреА рд╣реИ)ред  рдЖрдк рд╣рдорд╛рд░реЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдиреЗрддреНрд░рд╣реАрди рд░реВрдк рд╕реЗ рднреА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ - рдкреНрд░рддреНрдпреЗрдХ рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдХреЗ рдЪреЗрд╣рд░реЛрдВ рдХреЛ 1 рд╕реЗ 5 рддрдХ рдХреА рдЕрдиреБрдорд╛рдирд┐рдд рд░реЗрдЯрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рд▓реЗрдВ <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> matplotlib.image <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> mpimg f, axarr = plt.subplots(<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,figsize=(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, race <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate([<span class="hljs-string"><span class="hljs-string">'AF'</span></span>,<span class="hljs-string"><span class="hljs-string">'CF'</span></span>, <span class="hljs-string"><span class="hljs-string">"AM"</span></span>, <span class="hljs-string"><span class="hljs-string">'CM'</span></span>]): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rating <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>): <span class="hljs-comment"><span class="hljs-comment">#axarr[i,rating-1].axis('off') axarr[i,rating-1].tick_params(# changes apply to the x-axis which='both', # both major and minor ticks are affected bottom=False, # ticks along the bottom edge are off top=False, # ticks along the top edge are off right=False, left=False, labelbottom=False, labelleft=False ) picname=(Answer2[Answer2['race']==race]['ans']-rating).abs().argmin() axarr[i,rating-1].set_xlabel(Answer2.loc[picname]['ans']) axarr[i,rating-1].imshow(mpimg.imread(imgpath+picname))</span></span></code> </pre><br><img src="https://habrastorage.org/webt/i4/az/pe/i4azpe-biju4pozojrgpiyxkoag.png" alt="рдЫрд╡рд┐"><br><br>  рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рд╕реБрдВрджрд░рддрд╛ рджреНрд╡рд╛рд░рд╛ рдЫрдБрдЯрд╛рдИ рдХреЗ рд╕рд╛рде рдкрд░рд┐рдгрд╛рдо рдЙрдЪрд┐рдд рд▓рдЧрддрд╛ рд╣реИред <br><br>  рдЕрдм рд╣рдо рдПрдХ рдкреВрд░реНрдг рдореЙрдбрд▓ рдмрдирд╛рдПрдВрдЧреЗ рдЬрд┐рд╕рдореЗрдВ рд╣рдо рдЗрдирдкреБрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рдЪреЗрд╣рд░рд╛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддреЗ рд╣реИрдВ, рдЖрдЙрдЯрдкреБрдЯ рдкрд░ рд╣рдореЗрдВ 0 рд╕реЗ 1 рддрдХ рдХреА рд░реЗрдЯрд┐рдВрдЧ рдорд┐рд▓рддреА рд╣реИ рдФрд░ рдЗрд╕реЗ рдлреЛрди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рдЯреИрдлрд▓рд╛рдЗрдЯ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдмрджрд▓ рджреЗрддреЗ рд╣реИрдВред <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tensorflow <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tf finmodel=Model(input=model.input, output=modelhead(model.output)) finmodel.save(<span class="hljs-string"><span class="hljs-string">'finmodel.h5'</span></span>) converter = tf.lite.TFLiteConverter.from_keras_model_file(<span class="hljs-string"><span class="hljs-string">'finmodel.h5'</span></span>) converter.optimizations = [tf.lite.Optimize.OPTIMIZE_FOR_SIZE] tflite_quant_model = converter.convert() open (<span class="hljs-string"><span class="hljs-string">"modelquant.tflite"</span></span> , <span class="hljs-string"><span class="hljs-string">"wb"</span></span>).write(tflite_quant_model) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> IPython.display <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> FileLink FileLink(<span class="hljs-string"><span class="hljs-string">r'modelquant.tflite'</span></span>)</code> </pre><br>  рдЗрд╕ рдореЙрдбрд▓ рдХреЛ рдЖрдХрд╛рд░ рдореЗрдВ 112 * 112 * 3 рдХреЗ рдЪреЗрд╣рд░реЗ рдХреА рдЫрд╡рд┐ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддреА рд╣реИ, рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рдкрд░ рдпрд╣ 0 рд╕реЗ 1 рддрдХ рдПрдХ рд╣реА рдирдВрдмрд░ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдЪреЗрд╣рд░реЗ рдХреА рд╕реБрдВрджрд░рддрд╛ (рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдпрд╛рдж рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдбреЗрдЯрд╛рд╕реЗрдЯ рдореЗрдВ рд░реЗрдЯрд┐рдВрдЧ 0 рд╕реЗ 5 рддрдХ рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ 1 рд╕реЗ 5 рддрдХ рднрд┐рдиреНрди рд╣реЛрддреА рд╣реИ)ред <br><br><h2>  рднрд╛рдЧ 2. рдЬрд╛рд╡рд╛ </h2><br>  рдЖрдЗрдП рдПрдВрдбреНрд░реЙрдЗрдб рдлреЛрди рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд▓рд┐рдЦрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред  рдЬрд╛рд╡рд╛ рднрд╛рд╖рд╛ рдореЗрд░реЗ рд▓рд┐рдП рдирдИ рд╣реИ, рдФрд░ рдореИрдВ рдХрднреА рднреА рдПрдВрдбреНрд░реЙрдЗрдб рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд╛рд╕ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реБрдЖ рд╣реВрдВ, рдЗрд╕рд▓рд┐рдП, рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛рдо рдХреЗ рдЕрдиреБрдХреВрд▓рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреА рд╣реИ, рдкреНрд░рд╡рд╛рд╣ рдирд┐рдпрдВрддреНрд░рдг рдФрд░ рдЕрдиреНрдп рдЪреАрдЬреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреА рд╣реИ рдЬреЛ рд╢реБрд░реБрдЖрдд рдХреЗ рд▓рд┐рдП рд╢реНрд░рдо-рдЧрд╣рди рд╣реИрдВред  рдЪреВрдБрдХрд┐ java code рдмрд▓реНрдХрд┐ рдмреЛрдЭрд┐рд▓ рд╣реИ, рдпрд╣рд╛рдБ рдореИрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЯреБрдХрдбрд╝реЗ рджреВрдБрдЧрд╛ред  рдкреВрд░реНрдг рдЖрд╡реЗрджрди рдХреЛрдб <a href="https://github.com/Alexankharin/HowCuteAmI" rel="nofollow">рдпрд╣рд╛рдВ</a> рдЙрдкрд▓рдмреНрдз <a href="https://github.com/Alexankharin/HowCuteAmI" rel="nofollow">рд╣реИ</a> ред  рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдПрдХ рдлреЛрдЯреЛ рдЦреЛрд▓рддрд╛ рд╣реИ, рдкрд╣рд▓реЗ рд╕реЗ рд╕рд╣реЗрдЬреЗ рдЧрдП рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЪреЗрд╣рд░реЗ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИ рдФрд░ рдЙрд╕рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рддрд╛ рд╣реИ рдФрд░ рдкрд░рд┐рдгрд╛рдо рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ: <br><br><img src="https://habrastorage.org/webt/7s/si/a-/7ssia-98n-lxqpitskjaudyohpc.png" alt="рдЫрд╡рд┐"><br><br>  рд╡рд┐рдХрд╛рд╕ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, рдЗрд╕рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛рд░реНрдп рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВред <br><br>  1. рдлрд╝рд╛рдЗрд▓ рдореЙрдбрд▓ рд╕реЗ рдиреНрдпреВрд░рд▓ рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдХрд╛рд░реНрдпред рдЗрдВрдЯрд░рдкреНрд░реЗрдЯрд░ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рдПрд╕реЗрдЯ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдлрд╛рдЗрд▓ <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.tensorflow.lite.Interpreter; Interpreter interpreter; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { interpreter=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Interpreter(loadModelFile(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); Log.e(<span class="hljs-string"><span class="hljs-string">"TIME"</span></span>, <span class="hljs-string"><span class="hljs-string">"Interpreter_started "</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { e.printStackTrace(); Log.e(<span class="hljs-string"><span class="hljs-string">"TIME"</span></span>, <span class="hljs-string"><span class="hljs-string">"Interpreter NOT started "</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> MappedByteBuffer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadModelFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Activity activity)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ AssetFileDescriptor fileDescriptor = activity.getAssets().openFd(<span class="hljs-string"><span class="hljs-string">"model.tflite"</span></span>); FileInputStream inputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(fileDescriptor.getFileDescriptor()); FileChannel fileChannel = inputStream.getChannel(); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> startOffset = fileDescriptor.getStartOffset(); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> declaredLength = fileDescriptor.getDeclaredLength(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fileChannel.map(FileChannel.MapMode.READ_ONLY, startOffset, declaredLength); }</code> </pre><br>  2. рдлреЗрд╕рдЯреИрдХреНрдЯрд░ рдореЙрдбреНрдпреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЪреЗрд╣рд░реЗ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛, рдЬреЛ рдХрд┐ рдЧреВрдЧрд▓ рд╕реЗ рдорд╛рдирдХ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдкреИрдХреЗрдЬ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ, рдПрдХ рддрдВрддреНрд░рд┐рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдФрд░ рдкрд░рд┐рдгрд╛рдо рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИред <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.android.gms.vision.face.Face; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.android.gms.vision.face.FaceDetector; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectFace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//Create a Paint object for drawing with Paint myRectPaint = new Paint(); myRectPaint.setStrokeWidth(5); myRectPaint.setColor(Color.GREEN); myRectPaint.setStyle(Paint.Style.STROKE); Paint fontPaint = new Paint(); fontPaint.setStrokeWidth(3); fontPaint.setTextSize(70); fontPaint.setColor(Color.BLUE); fontPaint.setStyle(Paint.Style.FILL_AND_STROKE); //Create a Canvas object for drawing on tempBitmap = Bitmap.createBitmap(myBitmap.getWidth(), myBitmap.getHeight(), Bitmap.Config.RGB_565); Canvas tempCanvas = new Canvas(tempBitmap); tempCanvas.drawBitmap(myBitmap, 0, 0, null); //Detect the Faces FaceDetector faceDetector = new FaceDetector.Builder(getApplicationContext()).build(); Frame frame = new Frame.Builder().setBitmap(myBitmap).build(); SparseArray&lt;Face&gt; faces = faceDetector.detect(frame); Face face; float[][] labelProbArray = new float[1][1]; imgData.order(ByteOrder.nativeOrder()); //Draw Rectangles on the Faces if (faces.size()&gt;0){ for (int i = 0; i &lt; faces.size(); i++) { face = faces.valueAt(i); isFaceFound=true; float x1 = Math.max(face.getPosition().x,0); float y1 = Math.max(face.getPosition().y,0); float x2 = Math.min(x1 + face.getWidth(),frame.getBitmap().getWidth()); float y2 = Math.min(y1 + face.getHeight(),frame.getBitmap().getHeight()); Bitmap tempbitmap2 = Bitmap.createBitmap(tempBitmap, (int)x1, (int)y1, (int) (x2-x1), (int) (y2-y1)); tempbitmap2 = Bitmap.createScaledBitmap(tempbitmap2, 112, 112, true); convertBitmapToByteBuffer(tempbitmap2); interpreter.run(imgData, labelProbArray); String textToShow = String.format("%.1f", (Answer[0][0]*5-1)/4 * 10); textToShow = textToShow + "/10"; int width= tempCanvas.getWidth(); //int height=tempCanvas.getHeight(); int fontsize=Math.max(width/20,imgView.getWidth()/20); fontPaint.setTextSize(fontsize); tempCanvas.drawText(textToShow, x1, y1-10, fontPaint); tempCanvas.drawRoundRect(new RectF(x1, y1, x2, y2), 2, 2, myRectPaint) } imgView.setImageDrawable(new BitmapDrawable(getResources(),tempBitmap)); } }</span></span></code> </pre><br>  рдпрджрд┐ рдЖрдк рдЕрдкрдиреЗ рдлреЛрди рдкрд░ рдЧреНрд░реЗрдбрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдЦреЗрд▓рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.beautyfromphoto.androidfacedetection" rel="nofollow">GooglePlay рдмрд╛рдЬрд╛рд░ рд╕реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди</a> рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi485858/">https://habr.com/ru/post/hi485858/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi485846/index.html">Fujitsu рдФрд░ SUSE рд╕рдВрдпреБрдХреНрдд рд╡реЗрдмрд┐рдирд╛рд░: "рдбрд┐рдЬрд┐рдЯрд▓ рдпреБрдЧ рдХреЗ рд▓рд┐рдП рдЦреБрд▓рд╛ рдФрд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╕рдорд╛рдзрд╛рди"</a></li>
<li><a href="../hi485850/index.html">рд╕реЛрд▓рд░ рдЧреИрд▓реЗрдХреНрд╕реА рдореЗрдВ Clickhouse рдХреЛ рдХреИрд╕реЗ рдЪреБрдирд╛ рдЧрдпрд╛</a></li>
<li><a href="../hi485852/index.html">10 рдХрд╛рд░рдг рдкреНрд░рдпреЛрдЬреНрдп рд▓реЗрдЦрд╛рдкрд░реАрдХреНрд╖рд╛ рдСрдирд▓рд╛рдЗрди рд╕реНрдЯреЛрд░ рдХрд╛ рдЖрджреЗрд╢ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ</a></li>
<li><a href="../hi485854/index.html">рдлрдВрдХреНрд╢рди рдУрд╡рд░рд▓реЛрдбрд┐рдВрдЧ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдореЗрдВ C ++ рдХрдВрдкрд╛рдЗрд▓рд░ рдХреА рдорджрдж рдХрд░реЗрдВ</a></li>
<li><a href="../hi485856/index.html">рд╣рдордиреЗ рд╣реЗрдХреНрд╕рд╛рдкреЙрдб рдХреЛ рдХреИрд╕реЗ рдЫрд╛рдкрд╛ рдФрд░ рдЗрд╕рдХрд╛ рдХреНрдпрд╛ рд╣реБрдЖ</a></li>
<li><a href="../hi485862/index.html">рдХреЙрдлреА рдирд┐рд░реНрдорд╛рддрд╛ рд╕реЗ DDoS</a></li>
<li><a href="../hi485866/index.html">рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рдкреЛрд░реНрдЯрд▓ рдХреЗ рд╕рд╛рде рдЬреЛрдореНрдмреНрд░рд╛ рдУрдкрди-рд╕реЛрд░реНрд╕ рдПрдбрд┐рд╢рди рдХрд╛ рдПрдХреАрдХрд░рдг</a></li>
<li><a href="../hi485868/index.html">рдХрдХреНрд╖рд╛рдУрдВ рдФрд░ рдХрдХреНрд╖рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░рдХрд╛рд╢ рд╡реНрдпрд╡рд╕реНрдерд╛</a></li>
<li><a href="../hi485870/index.html">рдХреНрдпрд╛ рд╕рдЦрд╛рд▓рд┐рди рдореЗрдВ рдХреЛрдИ рдЧреЗрдордбреЗрд╡ рд╣реИ? 2.V</a></li>
<li><a href="../hi485872/index.html">рд▓реЙрдЬрд┐рд╕реНрдЯрд┐рдХ рд░рд┐рдЧреНрд░реЗрд╢рди рдЪрдмрд╛рдирд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>