<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìë üòë üïì Comment utiliser Control Inversion en JavaScript et Reactjs pour simplifier la gestion du code üê¥ ü§ûüèΩ üç∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Inversion of Control est un principe de programmation assez facile √† comprendre qui, en m√™me temps, peut consid√©rablement am√©liorer votre code. Cet ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment utiliser Control Inversion en JavaScript et Reactjs pour simplifier la gestion du code</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485012/"><p><img src="https://habrastorage.org/getpro/habr/post_images/ca6/d2e/e7c/ca6d2ee7cdf0a14a1357e78d9f266507.webp" alt="Comment utiliser Control Inversion en JavaScript et Reactjs pour simplifier la gestion du code"></p><br><p>  <em>Inversion of Control est un principe de programmation assez facile √† comprendre qui, en m√™me temps, peut consid√©rablement am√©liorer votre code.</em>  <em>Cet article montrera comment appliquer Control Inversion en JavaScript et dans Reactjs.</em> </p><br><p>  Si vous avez d√©j√† √©crit du code utilis√© √† plusieurs endroits, vous connaissez cette situation: </p><br><ol><li>  Vous cr√©ez un morceau de code r√©utilisable (il peut s'agir d'une fonction, d'un composant React, d'un hook React, etc.) et le partagez (pour la collaboration ou la publication en open source). </li><li>  Quelqu'un vous demande d'ajouter de nouvelles fonctionnalit√©s.  Votre code ne prend pas en charge la fonctionnalit√© propos√©e, mais il pourrait le faire si vous apportiez une petite modification. </li><li>  Vous ajoutez un nouvel argument / prop / option √† votre code et √† sa logique associ√©e pour que cette nouvelle fonctionnalit√© continue de fonctionner. </li><li>  R√©p√©tez les √©tapes 2 et 3 plusieurs fois (ou plusieurs fois). </li><li> Maintenant, votre code r√©utilisable est difficile √† utiliser et √† maintenir. </li></ol><br><p>  Qu'est-ce qui fait du code un cauchemar √† utiliser et √† maintenir?  Plusieurs aspects peuvent rendre votre code probl√©matique: </p><a name="habracut"></a><br><ol><li>  <strong>Taille et / ou performances du package: un</strong> peu plus de code √† ex√©cuter sur les appareils peut entra√Æner de mauvaises performances.  Parfois, cela peut conduire √† des personnes refusant simplement d'utiliser votre code. </li><li>  <strong>Difficile √† maintenir:</strong> Auparavant, votre code r√©utilisable n'avait que quelques options, et il √©tait ax√© sur une bonne chose, mais maintenant il peut faire un tas de choses diff√©rentes, et vous devez tout documenter.  De plus, les gens commenceront √† vous poser des questions sur la fa√ßon d'utiliser votre code pour certains cas d'utilisation qui peuvent ou non √™tre comparables aux cas d'utilisation pour lesquels vous avez d√©j√† ajout√© un support.  Vous pouvez m√™me avoir deux cas d'utilisation presque identiques qui sont l√©g√®rement diff√©rents, vous devrez donc r√©pondre √† des questions sur ce qui est le mieux √† utiliser dans une situation donn√©e. </li><li> <strong>Complexit√© de l'impl√©mentation</strong> : chaque fois qu'il <em>ne</em> s'agit <em>pas simplement d'</em> une autre <code>if</code> , chaque branche de la logique de votre code coexiste avec les branches de logique existantes.  En fait, des situations sont possibles lorsque vous essayez de conserver une combinaison d'arguments / options / accessoires que personne n'utilise m√™me, mais vous devez toujours envisager toutes les options possibles, car vous ne savez pas exactement si quelqu'un utilisera ou non ces combinaisons. </li><li>  <strong>API sophistiqu√©e</strong> : chaque nouvel argument / option / accessoire que vous ajoutez √† votre code r√©utilisable le rend difficile √† utiliser, car maintenant vous avez un √©norme README ou un site o√π toutes les fonctionnalit√©s disponibles sont document√©es, et les gens doivent apprendre tout cela pour une utilisation efficace votre code.  Son utilisation n'est pas pratique, car la complexit√© de votre API p√©n√®tre dans le code du d√©veloppeur qui l'utilise, ce qui complique son code. </li></ol><br><p>  En cons√©quence, tout le monde souffre.  Il convient de noter que la mise en ≈ìuvre du programme final est un √©l√©ment essentiel du d√©veloppement.  Mais ce serait formidable si nous r√©fl√©chissions davantage √† la mise en ≈ìuvre de nos abstractions (lire √† propos de la <a href="https://kentcdodds.com/blog/aha-programming" rel="nofollow">"programmation AHA"</a> ).  Existe-t-il un moyen de r√©duire les probl√®mes li√©s au code r√©utilisable tout en profitant des avantages des abstractions? </p><br><h2 id="inversiya-upravleniya">  Inversion de contr√¥le </h2><br><p>  L'inversion du contr√¥le est un principe qui simplifie vraiment la cr√©ation et l'utilisation d'abstractions.  Voici ce que Wikipedia en dit: </p><br><blockquote>  ... dans la programmation traditionnelle, le code utilisateur qui exprime le but du programme est appel√© dans des biblioth√®ques r√©utilisables pour r√©soudre les probl√®mes courants, mais avec l'inversion de contr√¥le, c'est un environnement qui appelle du code personnalis√© ou sp√©cifique √† la t√¢che, </blockquote><p>  Pensez-y de cette fa√ßon: "R√©duisez les fonctionnalit√©s de votre abstraction et faites en sorte que vos utilisateurs puissent impl√©menter les fonctionnalit√©s dont ils ont besoin."  Cela peut sembler une absurdit√© compl√®te, car nous utilisons des abstractions pour masquer des t√¢ches complexes et r√©p√©titives, et ainsi rendre notre code plus ¬´propre¬ª et ¬´soign√©¬ª.  Mais, comme nous l'avons vu plus haut, les abstractions traditionnelles ne simplifient pas toujours le code. </p><br><h1 id="chto-takoe-inversiya-upravleniya-v-kode">  Qu'est-ce que l'inversion de la gestion dans le code? </h1><br><p>  Pour commencer, voici un exemple tr√®s artificiel: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   Array.prototype.filter   function filter(array) { let newArray = [] for (let index = 0; index &lt; array.length; index++) { const element = array[index] if (element !== null &amp;&amp; element !== undefined) { newArray[newArray.length] = element } } return newArray } // : filter([0, 1, undefined, 2, null, 3, 'four', '']) // [0, 1, 2, 3, 'four', '']</span></span></code> </pre> <br><p>  Jouons maintenant un ¬´cycle de vie d'abstraction¬ª typique en ajoutant de nouveaux cas d'utilisation √† cette abstraction et en l '¬´am√©liorant sans r√©fl√©chir¬ª pour prendre en charge ces nouveaux cas d'utilisation: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   Array.prototype.filter   function filter( array, { filterNull = true, filterUndefined = true, filterZero = false, filterEmptyString = false, } = {}, ) { let newArray = [] for (let index = 0; index &lt; array.length; index++) { const element = array[index] if ( (filterNull &amp;&amp; element === null) || (filterUndefined &amp;&amp; element === undefined) || (filterZero &amp;&amp; element === 0) || (filterEmptyString &amp;&amp; element === '') ) { continue } newArray[newArray.length] = element } return newArray } filter([0, 1, undefined, 2, null, 3, 'four', '']) // [0, 1, 2, 3, 'four', ''] filter([0, 1, undefined, 2, null, 3, 'four', ''], {filterNull: false}) // [0, 1, 2, null, 3, 'four', ''] filter([0, 1, undefined, 2, null, 3, 'four', ''], {filterUndefined: false}) // [0, 1, 2, undefined, 3, 'four', ''] filter([0, 1, undefined, 2, null, 3, 'four', ''], {filterZero: true}) // [1, 2, 3, 'four', ''] filter([0, 1, undefined, 2, null, 3, 'four', ''], {filterEmptyString: true}) // [0, 1, 2, 3, 'four']</span></span></code> </pre> <br><p>  Donc, notre programme ne fonctionne qu'avec six cas d'utilisation, mais en fait, nous prenons en charge toute combinaison de fonctions possible, et il y en a jusqu'√† 25 (si j'ai calcul√© correctement). </p><br><p>  En g√©n√©ral, il s'agit d'une abstraction assez simple.  Mais cela peut √™tre simplifi√©.  Il arrive souvent que l'abstraction dans laquelle de nouvelles fonctionnalit√©s ont √©t√© ajout√©es pourrait √™tre consid√©rablement simplifi√©e pour les cas d'utilisation qu'elle prend en charge.  Malheureusement, d√®s que l'abstraction commence √† prendre en charge quelque chose (par exemple, en ex√©cutant <code>{ filterZero: true, filterUndefined: false }</code> ), nous avons peur de supprimer cette fonctionnalit√© car elle risque de casser le code qui en d√©pend. </p><br><p>  Nous √©crivons m√™me des tests pour des cas d'utilisation que nous n'avons pas r√©ellement, simplement parce que notre abstraction prend en charge ces sc√©narios, et nous devrons peut-√™tre le faire √† l'avenir.  Et lorsque ces cas d'utilisation ou d'autres deviennent inutiles pour nous, nous ne supprimons pas leur support, car nous l'oublions simplement, ou pensons qu'il peut nous √™tre utile √† l'avenir, ou simplement nous avons peur de casser quelque chose. </p><br><p>  D'accord, √©crivons maintenant une abstraction plus √©labor√©e pour cette fonction et appliquons la m√©thode d'inversion de contr√¥le pour prendre en charge tous les cas d'utilisation dont nous avons besoin: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   Array.prototype.filter   function filter(array, filterFn) { let newArray = [] for (let index = 0; index &lt; array.length; index++) { const element = array[index] if (filterFn(element)) { newArray[newArray.length] = element } } return newArray } filter( [0, 1, undefined, 2, null, 3, 'four', ''], el =&gt; el !== null &amp;&amp; el !== undefined, ) // [0, 1, 2, 3, 'four', ''] filter([0, 1, undefined, 2, null, 3, 'four', ''], el =&gt; el !== undefined) // [0, 1, 2, null, 3, 'four', ''] filter([0, 1, undefined, 2, null, 3, 'four', ''], el =&gt; el !== null) // [0, 1, 2, undefined, 3, 'four', ''] filter( [0, 1, undefined, 2, null, 3, 'four', ''], el =&gt; el !== undefined &amp;&amp; el !== null &amp;&amp; el !== 0, ) // [1, 2, 3, 'four', ''] filter( [0, 1, undefined, 2, null, 3, 'four', ''], el =&gt; el !== undefined &amp;&amp; el !== null &amp;&amp; el !== '', ) // [0, 1, 2, 3, 'four']</span></span></code> </pre> <br><p>  Super!  Cela s'est av√©r√© beaucoup plus facile.  Nous venons juste de contr√¥ler la fonction, en transf√©rant la responsabilit√© de d√©cider quel √©l√©ment appartient au nouveau tableau, de la fonction de <code>filter</code> √† la fonction qui appelle la fonction de filtre.  Notez que la fonction de <code>filter</code> est toujours une abstraction utile en soi, mais maintenant elle est beaucoup plus flexible. </p><br><p>  Mais la version pr√©c√©dente de cette abstraction √©tait-elle si mauvaise?  Probablement pas.  Mais depuis que nous avons pris le contr√¥le, nous pouvons d√©sormais prendre en charge des cas d'utilisation beaucoup plus uniques: </p><br><pre> <code class="javascript hljs">filter( [ {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'dog'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'dolphin'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'eagle'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'elephant'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'robin'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'cat'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'salmon'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}, ], animal =&gt; animal.legs === <span class="hljs-number"><span class="hljs-number">0</span></span>, ) <span class="hljs-comment"><span class="hljs-comment">// [ // {name: 'dolphin', legs: 0, mammal: true}, // {name: 'salmon', legs: 0, mammal: false}, // ]</span></span></code> </pre> <br><p>  Imaginez simplement si vous aviez besoin de prendre en charge ce cas d'utilisation sans appliquer d'inversion de contr√¥le?  Oui, ce serait tout simplement ridicule. </p><br><h1 id="plohoy-api">  Mauvaise API? </h1><br><p>  L'une des plaintes les plus courantes que j'entends des gens concernant les API qui utilisent l'inversion de contr√¥le est: "Oui, mais maintenant c'est plus difficile √† utiliser qu'auparavant."  Prenez cet exemple: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  filter([0, 1, undefined, 2, null, 3, 'four', '']) //  filter( [0, 1, undefined, 2, null, 3, 'four', ''], el =&gt; el !== null &amp;&amp; el !== undefined, )</span></span></code> </pre> <br><p>  Oui, l'une des options est clairement plus facile √† utiliser que l'autre.  Mais l'un des avantages de l'inversion de contr√¥le est que vous pouvez utiliser une API qui utilise l'inversion de contr√¥le pour r√©impl√©menter votre ancienne API.  C'est g√©n√©ralement assez simple.  Par exemple: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">filterWithOptions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> array, { filterNull = true, filterUndefined = true, filterZero = false, filterEmptyString = false, } = {}, </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filter( array, element =&gt; !( (filterNull &amp;&amp; element === <span class="hljs-literal"><span class="hljs-literal">null</span></span>) || (filterUndefined &amp;&amp; element === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) || (filterZero &amp;&amp; element === <span class="hljs-number"><span class="hljs-number">0</span></span>) || (filterEmptyString &amp;&amp; element === <span class="hljs-string"><span class="hljs-string">''</span></span>) ), ) }</code> </pre> <br><p>  Cool, hein?  De cette fa√ßon, nous pouvons cr√©er des abstractions au-dessus de l'API dans laquelle l'inversion de contr√¥le est appliqu√©e, et ainsi cr√©er une API plus simple.  Et si notre API "plus simple" n'a pas suffisamment de cas d'utilisation, alors nos utilisateurs peuvent appliquer les m√™mes blocs de construction que nous avons utilis√©s pour cr√©er notre API de haut niveau pour d√©velopper des solutions pour des t√¢ches plus complexes.  Ils n'ont pas besoin de nous demander d'ajouter une nouvelle fonction √† <code>filterWithOptions</code> et d'attendre qu'elle soit impl√©ment√©e.  Ils disposent d√©j√† d'outils avec lesquels ils peuvent d√©velopper ind√©pendamment les fonctionnalit√©s suppl√©mentaires dont ils ont besoin. </p><br><p>  Et, juste pour le fan: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">filterByLegCount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">array, legCount</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filter(array, animal =&gt; animal.legs === legCount) } filterByLegCount( [ {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'dog'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'dolphin'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'eagle'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'elephant'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'robin'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'cat'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'salmon'</span></span>, <span class="hljs-attr"><span class="hljs-attr">legs</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">mammal</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}, ], <span class="hljs-number"><span class="hljs-number">0</span></span>, ) <span class="hljs-comment"><span class="hljs-comment">// [ // {name: 'dolphin', legs: 0, mammal: true}, // {name: 'salmon', legs: 0, mammal: false}, // ]</span></span></code> </pre> <br><p>  Vous pouvez cr√©er des fonctionnalit√©s sp√©ciales pour toute situation qui se produit souvent avec vous. </p><br><h2 id="primery-iz-realnoy-zhizni">  Exemples concrets </h2><br><p>  Donc, cela fonctionne dans des cas simples, mais ce concept convient-il √† la vie r√©elle?  Eh bien, vous utilisez probablement constamment l'inversion de contr√¥le.  Par exemple, la fonction <code>Array.prototype.filter</code> applique un contr√¥le inverse.  Comme la fonction <code>Array.prototype.map</code> . </p><br><p>  Il existe diff√©rents mod√®les que vous connaissez peut-√™tre d√©j√† et qui ne sont qu'une forme d'inversion de contr√¥le. </p><br><p>  Voici deux de mes mod√®les pr√©f√©r√©s qui en font la d√©monstration: <a href="https://kentcdodds.com/blog/compound-components-with-react-hooks" rel="nofollow">¬´Compos√©s compos√©s¬ª</a> et <a href="https://kentcdodds.com/blog/the-state-reducer-pattern" rel="nofollow">¬´R√©ducteurs d'√©tat¬ª</a> .  Vous trouverez ci-dessous de brefs exemples d'application de ces mod√®les. </p><br><h3 id="sostavnye-komponenty-compound-components">  Composants compos√©s </h3><br><p>  Supposons que vous vouliez cr√©er un composant <code>Menu</code> qui poss√®de un bouton pour ouvrir un menu et une liste d'√©l√©ments de menu qui seront affich√©s lorsque vous cliquez sur le bouton.  Ensuite, lorsque l'√©l√©ment est s√©lectionn√©, il effectuera une action.  Habituellement, pour impl√©menter cela, ils cr√©ent simplement des accessoires: </p><br><pre> <code class="xml hljs">function App() { return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Menu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">buttonContents</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{</span></span></span><span class="hljs-tag"> &lt;&gt;</span></span> Actions <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">aria-hidden</span></span></span><span class="hljs-tag">&gt;</span></span>‚ñæ<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/&gt;</span></span> } items={[ {contents: 'Download', onSelect: () =&gt; alert('Download')}, {contents: 'Create a Copy', onSelect: () =&gt; alert('Create a Copy')}, {contents: 'Delete', onSelect: () =&gt; alert('Delete')}, ]} /&gt; ) }</code> </pre> <br><p>  Cela nous permet de configurer beaucoup de choses dans les √©l√©ments de menu.  Mais que se passe-t-il si nous voulons ins√©rer une ligne avant l'√©l√©ment de menu Supprimer?  Faut-il ajouter une option sp√©ciale aux objets li√©s aux <code>items</code> ?  Eh bien, je ne sais pas, par exemple: <code>precedeWithLine</code> ?  Id√©e moyenne. </p><br><p>  Cr√©ez peut-√™tre un type de menu sp√©cial, par exemple <code>{contents: &lt;hr /&gt;}</code> .  Je pense que cela fonctionnerait, mais il nous faudrait alors g√©rer les cas o√π il n'y a pas d' <code>onSelect</code> .  Et pour √™tre honn√™te, il s'agit d'une API tr√®s maladroite. </p><br><p>  Lorsque vous r√©fl√©chissez √† la fa√ßon de cr√©er une bonne API pour les personnes qui essaient de faire quelque chose d'un peu diff√©remment, au lieu d'atteindre l'instruction <code>if</code> , essayez d'inverser le contr√¥le.  Et si nous transf√©rons la responsabilit√© de la visualisation des menus √† l'utilisateur?  Nous utilisons l'une des forces de la r√©action: </p><br><pre> <code class="xml hljs">function App() { return ( <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Menu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuButton</span></span></span><span class="hljs-tag">&gt;</span></span> Actions <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">aria-hidden</span></span></span><span class="hljs-tag">&gt;</span></span>‚ñæ<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuButton</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuList</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuItem</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onSelect</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span><span class="hljs-tag"> =&gt;</span></span> alert('Download')}&gt;Download<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuItem</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuItem</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onSelect</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span><span class="hljs-tag"> =&gt;</span></span> alert('Copy')}&gt;Create a Copy<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuItem</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuItem</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onSelect</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span><span class="hljs-tag"> =&gt;</span></span> alert('Delete')}&gt;Delete<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuItem</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MenuList</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Menu</span></span></span><span class="hljs-tag">&gt;</span></span> ) }</code> </pre> <br><p>  Un point important √† prendre en compte est qu'il n'y a aucun √©tat des composants visible par l'utilisateur.  L'√©tat est implicitement partag√© entre ces composants.  Il s'agit de la valeur fondamentale du mod√®le de composant.  En utilisant cette opportunit√©, nous avons donn√© un certain contr√¥le sur le rendu √† l'utilisateur de nos composants, et maintenant ajouter une ligne suppl√©mentaire (ou quelque chose d'autre) est une action simple et intuitive.  Pas de documentation suppl√©mentaire, pas de fonctions suppl√©mentaires, pas de code ou de tests suppl√©mentaires.  Tout le monde gagne. </p><br><p>  Vous pouvez en savoir plus sur ce mod√®le <a href="https://kentcdodds.com/blog/compound-components-with-react-hooks" rel="nofollow">ici</a> .  Merci √† <a href="https://twitter.com/ryanflorence" rel="nofollow">Ryan Florence</a> , qui m'a appris cela. </p><br><h3 id="redyuser-sostoyaniya-state-reducer">  R√©ducteur d'√©tat </h3><br><p>  J'ai trouv√© ce mod√®le pour r√©soudre le probl√®me de la configuration de la logique des composants.  Vous pouvez en savoir plus sur cette situation sur mon blog <a href="https://kentcdodds.com/blog/the-state-reducer-pattern" rel="nofollow">, The State Reducer Pattern</a> , mais le point principal est que j'ai une biblioth√®que de recherche / saisie semi-automatique / <code>Downshift</code> appel√©e <code>Downshift</code> , et l'un des utilisateurs de la biblioth√®que d√©veloppait une version de composant √† choix multiples , √† cause de quoi il voulait que le menu reste ouvert m√™me apr√®s avoir s√©lectionn√© un √©l√©ment. </p><br><p>  La logique derri√®re <code>Downshift</code> sugg√©r√© qu'apr√®s le choix, le menu devrait se fermer.  Un utilisateur de biblioth√®que qui avait besoin de changer ses fonctionnalit√©s a sugg√©r√© d'ajouter prop <code>closeOnSelection</code> .  J'ai d√©clin√© cette offre, car une fois que j'avais d√©j√† parcouru le chemin menant √† un <a href="https://twitter.com/gurlcode/status/1002110517094371328" rel="nofollow">propalapse</a> , <a href="https://twitter.com/gurlcode/status/1002110517094371328" rel="nofollow">je</a> voulais l'√©viter. </p><br><p>  Au lieu de cela, j'ai cr√©√© l'API pour que les utilisateurs eux-m√™mes puissent contr√¥ler la fa√ßon dont les changements d'√©tat se produisent.  Consid√©rez le r√©ducteur d'√©tat comme l'√©tat d'une fonction qui est appel√©e √† chaque fois que l'√©tat du composant change, et donne au d√©veloppeur d'application la possibilit√© d'influencer le changement d'√©tat qui est sur le point de se produire. </p><br><p>  Un exemple d'utilisation de la biblioth√®que <code>Downshift</code> pour qu'elle ne ferme pas le menu apr√®s que l'utilisateur a cliqu√© sur l'√©l√©ment s√©lectionn√©: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stateReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, changes</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (changes.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Downshift.stateChangeTypes.keyDownEnter: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Downshift.stateChangeTypes.clickItem: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...changes, <span class="hljs-comment"><span class="hljs-comment">//     Downshift   //       isOpen  highlightedIndex //      isOpen: state.isOpen, highlightedIndex: state.highlightedIndex, } default: return changes } } // ,   // &lt;Downshift stateReducer={stateReducer} {...restOfTheProps} /&gt;</span></span></code> </pre> <br><p>  Apr√®s avoir ajout√© cet accessoire, nous avons commenc√© √† recevoir BEAUCOUP moins de demandes d'ajout de nouveaux param√®tres pour ce composant.  Le composant est devenu plus flexible et il est devenu plus facile pour les d√©veloppeurs de le configurer selon leurs besoins. </p><br><h3 id="render-propsy-render-props">  Accessoires de rendu </h3><br><p>  Il convient de mentionner le mod√®le des <a href="https://reactjs.org/docs/render-props.html" rel="nofollow">¬´accessoires de rendu¬ª</a> .  Ce mod√®le est un exemple id√©al d'utilisation de l'inversion de contr√¥le, mais nous n'en avons surtout pas besoin.  En savoir plus ici: <a href="https://kentcdodds.com/blog/react-hooks-whats-going-to-happen-to-render-props" rel="nofollow">pourquoi nous n'avons plus autant besoin de Render Props</a> . </p><br><h2 id="preduprezhdenie">  Avertissement </h2><br><p>  L'inversion du contr√¥le est un excellent moyen de contourner le probl√®me des id√©es fausses sur la fa√ßon dont votre code sera utilis√© √† l'avenir.  Mais avant de terminer, je voudrais vous donner quelques conseils. </p><br><p>  Revenons √† notre exemple tir√© par les cheveux: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   Array.prototype.filter   function filter(array) { let newArray = [] for (let index = 0; index &lt; array.length; index++) { const element = array[index] if (element !== null &amp;&amp; element !== undefined) { newArray[newArray.length] = element } } return newArray } // : filter([0, 1, undefined, 2, null, 3, 'four', '']) // [0, 1, 2, 3, 'four', '']</span></span></code> </pre><br><p>  Et si c'est tout ce dont nous avons besoin de la fonction de <code>filter</code> ?  Et nous n'avons jamais fait face √† une situation o√π nous aurions besoin de filtrer quoi que ce soit sauf <code>null</code> et <code>undefined</code> ?  Dans ce cas, l'ajout d'une inversion de contr√¥le pour un cas d'utilisation unique compliquerait simplement le code et n'apporterait pas beaucoup d'avantages. </p><br><p>  Comme pour toute abstraction, veillez √† appliquer le principe de la <a href="https://kentcdodds.com/blog/aha-programming" rel="nofollow">programmation AHA</a> et √©vitez les abstractions h√¢tives! </p><br><h2 id="vyvody">  Conclusions </h2><br><p>  J'esp√®re que l'article vous a √©t√© utile.  J'ai montr√© comment appliquer le concept de Control Inversion dans une r√©action.  Ce concept, bien s√ªr, ne s'applique pas seulement √† React (comme nous l'avons vu avec la fonction de <code>filter</code> ).  La prochaine fois que vous remarquerez que vous ajoutez une autre <code>if</code> √† la fonction <code>coreBusinessLogic</code> de votre application, r√©fl√©chissez √† la fa√ßon dont vous pouvez inverser le contr√¥le et transf√©rer la logique l√† o√π il est utilis√© (ou, s'il est utilis√© √† plusieurs endroits, vous pouvez cr√©er une abstraction plus sp√©cialis√©e pour cela. cas particulier). </p><br><p>  Si vous le souhaitez, vous pouvez jouer avec un exemple d'un article sur <a href="https://codesandbox.io/s/inversion-of-control-qunm8%3Ffontsize%3D14%26hidenavigation%3D1%26theme%3Ddark" rel="nofollow">CodeSandbox</a> . </p><br><p>  Bonne chance et merci pour votre attention! </p><br><p>  PS.  Si vous avez aim√© cet article, vous aimerez peut-√™tre cet expos√©: <a href="https://youtu.be/AiJ8tRRH0f8" rel="nofollow">youtube Kent C Dodds - Simply React</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr485012/">https://habr.com/ru/post/fr485012/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr485000/index.html">Le trafic am√©ricain est-il cher ou non?</a></li>
<li><a href="../fr485002/index.html">Flutter BloC pattern + Provider + tests + souvenez-vous de l'√©tat</a></li>
<li><a href="../fr485006/index.html">Livre (d'√™tre?). R√©flexions sur la nature de l'esprit. Partie II</a></li>
<li><a href="../fr485008/index.html">Encapsuleurs de propri√©t√©s Swift</a></li>
<li><a href="../fr485010/index.html">Ne pleure pas, ma fille! R√©ponse √† l'auteur avec vc.ru sur la lettre concernant Habr√©</a></li>
<li><a href="../fr485014/index.html">Dois-je me plaindre des entretiens?</a></li>
<li><a href="../fr485016/index.html">Bases de donn√©es g√©r√©es chez Selectel: Bienvenue dans la version b√™ta</a></li>
<li><a href="../fr485018/index.html">√âcriture de shaders avec du code dans Unity LWRP</a></li>
<li><a href="../fr485022/index.html">Playme Sigma: DVR fonctionnel et abordable</a></li>
<li><a href="../fr485024/index.html">Qu'est-ce qui se cache sous le capot des optimisations du compilateur GraalVM?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>