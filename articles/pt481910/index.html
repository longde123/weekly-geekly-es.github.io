<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüåæ üéá üçó Como escrever VerticalSwipeBehavior flex√≠vel ü•© üëãüèø üõÄüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° Habr! Meu nome √© Ilya Osintsev, sou desenvolvedor Android da Apiqa. Abaixo do gato, voc√™ encontrar√° um exemplo do uso do ViewDragHelper para criar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como escrever VerticalSwipeBehavior flex√≠vel</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481910/"><p>  Ol√° Habr!  Meu nome √© Ilya Osintsev, sou desenvolvedor Android da Apiqa.  Abaixo do gato, voc√™ encontrar√° um exemplo do uso do ViewDragHelper para criar um componente da interface do usu√°rio semelhante ao SwipeDismissBehavior, mas trabalhando na vertical. </p><br><p>  Com o advento do Design de materiais, os aplicativos se tornaram elementos mais interativos que respondem √†s a√ß√µes do usu√°rio.  Eles n√£o apenas economizam espa√ßo, mas tamb√©m introduzem micro-intera√ß√µes divertidas.  Em v√°rios de nossos projetos, decidimos usar banners em movimento vertical na mec√¢nica deslizar para dispensar.  Para dar vida √† interface, os banners devem levar em considera√ß√£o a velocidade do ponteiro e alterar a transpar√™ncia, dependendo da dire√ß√£o do deslocamento. </p><a name="habracut"></a><br><h2 id="ocenivaem-zadachu">  Avalie a tarefa </h2><br><div class="scrollable-table"><table><thead><tr><th>  Conta pessoal </th><th>  T√©cnico de Gabinete </th></tr></thead><tbody><tr><td><img src="https://habrastorage.org/webt/au/bz/ma/aubzmap7axgperiid2fkvvttt20.jpeg" alt="Conta pessoal"></td><td><img src="https://habrastorage.org/webt/c6/n6/ox/c6n6oxsscnhr7elqtgullowpjte.jpeg" alt="T√©cnico de Gabinete"></td></tr></tbody></table></div><br><p>  Em nosso aplicativo de <a href="https://apiqa.io/case_pik_app">conta pessoal, o</a> banner funciona como uma maneira r√°pida de deixar um apelo ao servi√ßo de pesquisa de inquilinos da sua casa.  No aplicativo "Cabinet Appliance", o banner permite salvar o contexto do trabalho do usu√°rio com a tarefa ao mudar de um cart√£o de informa√ß√µes para coment√°rios.  No primeiro caso, enfatizamos a opcionalidade do servi√ßo PIK-Rent e deixamos o cliente se sentir em casa no aplicativo.  Em outro caso, implementamos furto no prompt para que n√£o se sobreponha √† linha de mensagem entre o expedidor e os executores. </p><br><p>  Para come√ßar, montei uma demonstra√ß√£o simples baseada no SwipeDismissBehavior para aprender como funciona e estimar a escala das altera√ß√µes.  Tentar especific√°-lo na marca√ß√£o xml lan√ßa uma exce√ß√£o quando executado: </p><br><pre><code class="plaintext hljs">E/AndroidRuntime: FATAL EXCEPTION: main Process: io.apiqa.android.example, PID: 1024 android.view.InflateException: Binary XML file line #115: Could not inflate Behavior subclass com.google.android.material.behavior.SwipeDismissBehavior</code> </pre> <br><p>  Os desenvolvedores violaram o contrato de comportamento e esqueceram de substituir o construtor de <a href="">classe</a> do contexto e do AttributeSet.  Agora voc√™ pode usar esse comportamento apenas criando uma inst√¢ncia dele no seu c√≥digo, mas mesmo assim, o comportamento da visualiza√ß√£o n√£o satisfaz fundamentalmente nossos requisitos, mesmo sem levar em considera√ß√£o a dire√ß√£o horizontal. </p><br><p><img src="https://habrastorage.org/webt/sb/ud/5b/sbud5byhw9ufcoj7hpqdjg2lcbq.gif" alt="SwipeDismissBehavior fora da caixa"></p><br><p>  Havia mensagens nos logs do aplicativo de demonstra√ß√£o de que alguns dos eventos de toque n√£o ca√≠ram no manipulador. </p><br><blockquote>  E / ViewDragHelper: Ignorando pointerId = -1 porque ACTION_DOWN n√£o foi recebido para esse ponteiro antes de ACTION_MOVE.  Provavelmente aconteceu porque o ViewDragHelper n√£o recebeu todos os eventos no fluxo de eventos. </blockquote><p>  Como alternativa, havia uma solu√ß√£o baseada no <code>OnTouchListener</code> , que nos priva da oportunidade de usar o OnClickListener, o que significa que teremos que descrever a lei do movimento do banner em atividade.  N√£o queremos alterar os par√¢metros de movimento (por exemplo, sensibilidade) √† medida que avan√ßamos, e usar o OnTouchListener aqui parece redundante.  Al√©m disso, em ambos os nossos projetos, banners foram colocados no CoordinatorLayout. </p><br><p>  Se voc√™ n√£o levar em considera√ß√£o os getters e setters dos par√¢metros opcionais, o SwipeDismissBehavior em si √© bastante curto, ele usa o <code>ViewDragHelper</code> .  Encontrei <a href="https://medium.com/android-development-p-ractises/dragging-panel-with-viewdraghelper-6df8dd980082">v√°rias</a> <a href="https://newfivefour.com/android-viewdraghelper-example-tutorial.html">publica√ß√µes</a> sobre ele na rede e decidi escrever minha pr√≥pria implementa√ß√£o do componente necess√°rio. </p><br><h2 id="koordiniruem-s-viewdraghelper">  N√≥s coordenamos com ViewDragHelper </h2><br><p>  <a href="https://developer.android.com/reference/androidx/customview/widget/ViewDragHelper.html">ViewDragHelper</a> √© uma classe de utilit√°rio para facilitar o suporte ao arrastar e soltar no n√≠vel de exibi√ß√£o.  Ele rastreia a posi√ß√£o dos widgets e cont√©m v√°rias fun√ß√µes √∫teis para anim√°-los ao longo de um ou dois eixos dentro do ViewGroup pai.  Para trabalhar, ele precisa de um manipulador que implemente o <a href="https://developer.android.com/reference/androidx/customview/widget/ViewDragHelper.Callback.html">ViewDragHelper.Callback</a> .  O manipulador tem um m√©todo obrigat√≥rio e, para que o banner comece a se mover, basta redefinir mais alguns.  Em geral, esse auxiliar √© f√°cil de usar, est√° dispon√≠vel em qualquer projeto, pois √© fornecido com o appcompat.  Para criar um auxiliar, √© necess√°ria uma refer√™ncia ao CoordinatorLayout pai, para que organizemos a inicializa√ß√£o lenta.  Em <code>onInterceptTouchEvent</code> e <code>onTouchEvent</code> devemos chamar os m√©todos auxiliares correspondentes, o restante da l√≥gica estar√° dentro do manipulador. </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerticalSwipeBehavior</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">V: View</span></span></span><span class="hljs-class">&gt;: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CoordinatorLayout.Behavior</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">V</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-meta"><span class="hljs-meta">@Suppress(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"UNCHECKED_CAST"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;V: View&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(v: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">V</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: VerticalSwipeBehavior&lt;V&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lp = v.layoutParams require(lp <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> CoordinatorLayout.LayoutParams) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> behavior = lp.behavior requireNotNull(behavior) require(behavior <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> VerticalSwipeBehavior) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> behavior <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> VerticalSwipeBehavior&lt;V&gt; } } <span class="hljs-meta"><span class="hljs-meta">@Suppress(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"unused"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() : <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>() <span class="hljs-meta"><span class="hljs-meta">@Suppress(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"unused"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(context: Context, attrs: AttributeSet) : <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, attrs) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dragHelper: ViewDragHelper? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> interceptingEvents = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onInterceptTouchEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CoordinatorLayout</span></span></span></span><span class="hljs-function"><span class="hljs-params">, child: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">V</span></span></span></span><span class="hljs-function"><span class="hljs-params">, ev: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MotionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isIntercept = interceptingEvents <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (ev.actionMasked) { MotionEvent.ACTION_DOWN -&gt; { isIntercept = parent.isPointInChildBounds(child, ev.x.toInt(), ev.y.toInt()) interceptingEvents = isIntercept } MotionEvent.ACTION_UP, MotionEvent.ACTION_CANCEL -&gt; { interceptingEvents = <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isIntercept) { helper(parent).shouldInterceptTouchEvent(ev) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouchEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">CoordinatorLayout</span></span></span></span><span class="hljs-function"><span class="hljs-params">, child: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">V</span></span></span></span><span class="hljs-function"><span class="hljs-params">, ev: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MotionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> helper = helper(parent) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> isViewUnder = helper.isViewUnder(child, ev.x.toInt(), ev.y.toInt()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (helper.capturedView == child || isViewUnder ) { helper.processTouchEvent(ev) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">helper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ViewGroup</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ViewDragHelper { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> h = dragHelper <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (h == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { h = ViewDragHelper.create(parent, callback) dragHelper = h <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> h } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> h } }</code> </pre> <br><p>  No <code>tryCaptureView</code> manipulador <code>tryCaptureView</code> necess√°rio <code>tryCaptureView</code> devemos decidir se devemos mover uma exibi√ß√£o espec√≠fica.  Para que o ajudante n√£o perca os eventos necess√°rios, admitimos o ponteiro que foi recebido anteriormente.  Para obter a solu√ß√£o mais flex√≠vel, tr√™s interfaces adicionais s√£o introduzidas, atrav√©s das quais voc√™ pode controlar o design do banner em detalhes: </p><br><ul><li>  <code>SideEffect</code> reflete o progresso do <code>SideEffect</code> nas propriedades da exibi√ß√£o </li><li>  <code>VerticalClamp</code> projetado para limitar o movimento da vista verticalmente </li><li>  <code>PostAction</code> √© chamado depois que o usu√°rio interrompe o furto, aqui podemos continuar o movimento da visualiza√ß√£o. </li></ul><br><p>  Em cada um deles, o <code>onViewCaptured(View)</code> √© <code>onViewCaptured(View)</code> , aqui as implementa√ß√µes do cliente podem extrair os valores iniciais das propriedades da exibi√ß√£o.  A ordem das chamadas para esse m√©todo n√£o √© garantida. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sideEffect: SideEffect = AlphaElevationSideEffect() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> clamp: VerticalClamp = FractionConstraintWithTopMargin(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> settle: PostAction = OriginSettleAction() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> callback = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>: ViewDragHelper.Callback() { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> INVALID_POINTER_ID = -<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentPointer = INVALID_POINTER_ID <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> originTop: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tryCaptureView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(child: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, pointerId: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> currentPointer == INVALID_POINTER_ID || pointerId == currentPointer } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewCaptured</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(child: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, activePointerId: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { originTop = child.top currentPointer = activePointerId sideEffect.onViewCaptured(child) settle.onViewCaptured(child) clamp.onViewCaptured(child.top) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewReleased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(child: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, xvel: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, yvel: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// TODO currentPointer = INVALID_POINTER_ID } override fun clampViewPositionHorizontal(child: View, left: Int, dx: Int) = child.left // TODO }</span></span></code> </pre> <br><p>  Embora nossa vis√£o n√£o se mova verticalmente, devemos lembrar de implementar <code>clampViewPositionHorizontal</code> no manipulador para evitar erros visuais.  Uma implementa√ß√£o simples retorna a coordenada esquerda, o que significa que o widget n√£o se move horizontalmente. </p><br><p>  No nosso caso, a chamada para o manipulador <code>clampViewPositionVertical</code> √© delegada √† interface <em>VerticalClamp</em> .  O m√©todo de <code>constraint</code> deve retornar uma coordenada de altura limitada pela posi√ß√£o de visualiza√ß√£o m√°xima e / ou m√≠nima.  Quando atingido, o ViewDragHelper limitar√° o movimento.  Os <code>upCast(distance, top, height, dy)</code> e <code>downCast</code> t√™m a mesma assinatura e retornam uma fra√ß√£o da dist√¢ncia percorrida, levando em considera√ß√£o a posi√ß√£o inicial da visualiza√ß√£o.  No <code>onViewPositionChanged</code> manipulador <code>onViewPositionChanged</code> obtemos o progresso da movimenta√ß√£o e passamos para o <code>SideEffect#apply(View, Float)</code> , no qual voc√™ pode alterar a transpar√™ncia ou outras propriedades da visualiza√ß√£o, dependendo do andamento do gesto.  Se a posi√ß√£o atual da vista for maior que a inicial, o progresso ser√° transmitido com um sinal de menos. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clampViewPositionVertical</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(child: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, top: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, dy: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> clamp.constraint(child.height, top, dy) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewPositionChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(child: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, left: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, top: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, dx: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, dy: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> factor = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (top &lt; originTop) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> diff = originTop - top -clamp.bottomCast(diff, top, child.height, dy) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> diff = top - originTop clamp.topCast(diff, top, child.height, dy) } sideEffect.apply(child, factor) }</code> </pre> <br><p>  Por padr√£o, <code>FractionClamp</code> usado, o que limita o movimento da vista uma altura para cima e para baixo (os coeficientes s√£o definidos no construtor), <code>AlphaElevationSideEffect</code> altera a transpar√™ncia e a eleva√ß√£o do banner.  Para considerar a tarefa conclu√≠da, voc√™ deve adicionar a capacidade de mover animado o banner depois que o usu√°rio o liberou. </p><br><p>  Quando o usu√°rio libera a exibi√ß√£o, o ajudante se lembra da velocidade do ponteiro e chama <code>onViewReleased</code> no manipulador.  Nele, podemos iniciar a anima√ß√£o do movimento usando <code>settleCapturedViewAt</code> ou <code>smoothSlideViewTo</code> .  De acordo com o contrato, ap√≥s uma chamada bem-sucedida de qualquer um deles, <code>continueSettling</code> deve ser chamado em cada pr√≥ximo quadro para que a visualiza√ß√£o continue a se mover.  Nesse caso, <em>settleCapturedViewAt</em> s√≥ pode ser chamado a partir do m√©todo onViewReleased quando o sinalizador interno do <em>auxiliar</em> mReleaseInProgress <em>estiver</em> definido como true.  Outra diferen√ßa √© que <em>smoothSlideViewTo</em> n√£o leva em considera√ß√£o a velocidade do ponteiro. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewReleased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(child: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">, xvel: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, yvel: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> diff = child.top - originTop <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (abs(yvel) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> settled = dragHelper?.let { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (diff &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { settle.releasedBelow(it, diff, child) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { settle.releasedAbove(it, diff, child) } } ?: <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (settled) { listener?.onPreSettled(diff) child.postOnAnimation(RecursiveSettle(child, diff)) } } currentPointer = INVALID_POINTER_ID }</code> </pre> <br><p>  Essa l√≥gica √© encapsulada na interface <code>PostAction</code> .  Os m√©todos <code>releasedBelow</code> e releaseBelow podem ser implementados para que, quando mudado para cima, o banner continue a se mover na mesma velocidade, deixando a tela e, quando mudado para baixo, retorne √† sua posi√ß√£o original.  Se algum dos m√©todos retornar true, a anima√ß√£o foi acionada e um RecursiveSettle ser√° adicionado √† fila de eventos de exibi√ß√£o, que permanecer√° nela at√© a anima√ß√£o terminar.  Por padr√£o, <code>OriginSettleAction</code> usado quando a exibi√ß√£o em qualquer deslocamento retorna ao ponto inicial.  Outra op√ß√£o - <code>SettleOnTopAction</code> ao mover a visualiza√ß√£o para baixo, retorna ao ponto inicial e, quando se move mais alto, tira voc√™ da tela. </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SettleOnTopAction</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostAction</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> originTop: Int = -<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onViewCaptured</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(child: View)</span></span></span><span class="hljs-function"> </span></span>{ originTop = child.top } <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">releasedAbove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(helper: ViewDragHelper, child: View)</span></span></span><span class="hljs-function">: Boolean </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> helper.settleCapturedViewAt(child.left, originTop) } <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">releasedBelow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(helper: ViewDragHelper, child: View)</span></span></span><span class="hljs-function">: Boolean </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> helper.settleCapturedViewAt(child.left, -child.height) } }</code> </pre> <br><p>  Se necess√°rio, voc√™ pode se inscrever em eventos implementando a interface <code>VerticalSwipeBehavior.SwipeListener</code> .  Ele tem dois m√©todos sim√©tricos, um chamado antes do in√≠cio da anima√ß√£o de movimento e o outro ap√≥s o t√©rmino.  O argumento mostra a dire√ß√£o e a dist√¢ncia na qual o usu√°rio liberou o banner.  O resultado resultante satisfaz nossos requisitos. </p><br><p><img src="https://habrastorage.org/webt/fw/er/9e/fwer9eaidf1vlmzsym0wyygdbvm.gif" alt="O resultado resultante"></p><br><p>  Para obter seu resultado, basta definir as propriedades da seguinte maneira: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> drag = findViewById&lt;View&gt;(R.id.drag) VerticalSwipeBehavior.from(drag).apply { settle = SettleOnTopAction() sideEffect = NegativeFactorFilterSideEffect(AlphaElevationSideEffect()) clamp = BelowFractionalClamp() }</code> </pre> <br><p>  A prop√≥sito, o auxiliar tamb√©m fornece outros recursos de controle de movimento.  Por exemplo, usando o m√©todo <code>setMinVelocity(Float)</code> , voc√™ pode limitar a velocidade m√≠nima para a exibi√ß√£o se mover.  O auxiliar tamb√©m suporta o reconhecimento de furtos a partir das bordas da tela, para isso √© necess√°rio especific√°-los no m√©todo <code>setEdgeTrackingEnabled(Int)</code> .  Deve-se lembrar que uma inst√¢ncia do ViewDragHelper pode controlar o movimento de apenas uma visualiza√ß√£o e leva em considera√ß√£o apenas um ponteiro. </p><br><h2 id="delaem-vyvody">  Tirar conclus√µes </h2><br><p>  Minha experi√™ncia √© que o ViewDragHelper facilita a cria√ß√£o de arrastar e soltar ou mover pain√©is em um aplicativo.  O Helper √© f√°cil de usar no Comportamento ou no ViewGroup substitu√≠do.  Possui v√°rios m√©todos √∫teis para animar a vista e controla seus movimentos.  Estudar a implementa√ß√£o interna dos componentes do Material Design √© uma boa experi√™ncia na carreira de um desenvolvedor Android.  Essas tarefas dos designers me motivam a explorar novas abordagens para criar uma interface de aplicativo e compartilhar conhecimento com colegas e a comunidade. </p><br><p>  Voc√™ pode usar a biblioteca resultante em seus projetos.  Para ativ√°-lo, especifique a depend√™ncia no arquivo <code>build.gradle</code> </p><br><pre> <code class="plaintext hljs">dependencies { implementation 'io.apiqa.android:verticalswipebehavior:1.0.0' }</code> </pre> <br><p>  Para uma visualiza√ß√£o adequada dentro do CoordinatorLayout, especifique a propriedade do <code>app:layout_behavior="io.apiqa.android.verticalswipe.VerticalSwipeBehavior"</code> na marca√ß√£o.  Voc√™ pode posicionar o banner no pai usando recuos.  Ao coordenar as <em>implementa√ß√µes SideEffect</em> , <em>VerticalClamp</em> e <em>PostAction,</em> voc√™ pode obter o comportamento do banner necess√°rio.  No <a href="https://github.com/pik-software/android-verticalSwipeBehavior">reposit√≥rio</a> , vers√µes de trabalho de cada um deles est√£o dispon√≠veis. </p><br><p>  <em>Feliz Ano Novo!</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt481910/">https://habr.com/ru/post/pt481910/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt481896/index.html">PHP Vs ASP.NET: Como escolher o caminho certo?</a></li>
<li><a href="../pt481898/index.html">Servidor web simples para SPA / PWA em 5 minutos</a></li>
<li><a href="../pt481902/index.html">Modelagem da opera√ß√£o de uma usina termel√©trica real para otimizar os modos: vapor e matem√°tica</a></li>
<li><a href="../pt481904/index.html">Vladimir Marshinin, tamb√©m conhecido como mavl: ‚ÄúA chamada‚Äú N√£o copie outros cart√µes ‚Äùpermite evitar problemas de licen√ßa do OpenStreetMap‚Äù</a></li>
<li><a href="../pt481906/index.html">C√©rebro chin√™s, ou em defesa da primavera</a></li>
<li><a href="../pt481912/index.html">Durante uma semana eu era estagi√°rio na SRE-engenheiro. Assista atrav√©s dos olhos de um engenheiro de software</a></li>
<li><a href="../pt481914/index.html">Spring Boot vs Spring MVC vs Spring - Como eles se comparam?</a></li>
<li><a href="../pt481916/index.html">Qual foi o ano de 2019 lembrado em desenvolvimento?</a></li>
<li><a href="../pt481922/index.html">Ano Novo IMaskjs 6 - Reagir Native, Pipes, ESM</a></li>
<li><a href="../pt481924/index.html">Apache Spark, avalia√ß√£o lenta e consultas SQL de v√°rias p√°ginas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>