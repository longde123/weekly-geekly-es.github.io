<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëãüèø üì∂ üåµ Int√©gration continue dans Yandex ü§© üìÖ ü§±üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Maintenir une √©norme base de code tout en garantissant une productivit√© √©lev√©e √† un grand nombre de d√©veloppeurs est un s√©rieux d√©fi. Au cours des 5 d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Int√©gration continue dans Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/428972/"><p>  Maintenir une √©norme base de code tout en garantissant une productivit√© √©lev√©e √† un grand nombre de d√©veloppeurs est un s√©rieux d√©fi.  Au cours des 5 derni√®res ann√©es, Yandex a d√©velopp√© un syst√®me sp√©cial d'int√©gration continue.  Dans cet article, nous parlerons de l'√©chelle de la base de code Yandex, du transfert du d√©veloppement vers un r√©f√©rentiel unique avec une approche de d√©veloppement bas√©e sur les troncs, des t√¢ches qu'un syst√®me d'int√©gration continue doit r√©soudre pour fonctionner efficacement dans de telles conditions. </p><br><img src="https://habrastorage.org/webt/wb/mt/xc/wbmtxcvurtd6cdv1aomjrtcyfw8.png"><br><p>  Il y a de nombreuses ann√©es, Yandex n'avait pas de r√®gles particuli√®res dans le d√©veloppement des services: chaque d√©partement pouvait utiliser toutes les langues, toutes les technologies, tous les syst√®mes de d√©ploiement.  Et comme la pratique l'a montr√©, une telle libert√© n'a pas toujours aid√© √† avancer plus vite.  √Ä cette √©poque, pour r√©soudre les m√™mes probl√®mes, il y avait souvent plusieurs d√©veloppements propri√©taires ou open source.  Au fur et √† mesure que l'entreprise grandissait, un tel √©cosyst√®me fonctionnait moins bien.  Dans le m√™me temps, nous voulions rester un seul grand Yandex, et ne pas √™tre scind√© en plusieurs soci√©t√©s ind√©pendantes, car cela donne beaucoup d'avantages: beaucoup de gens font les m√™mes t√¢ches, les r√©sultats de leur travail peuvent √™tre r√©utilis√©s.  √Ä partir d'une vari√©t√© de structures de donn√©es, telles que des tables de hachage distribu√©es et des files d'attente sans verrouillage, et se terminant par un grand nombre de codes sp√©cialis√©s diff√©rents que nous avons √©crits sur 20 ans. </p><a name="habracut"></a><br><p>  Beaucoup de t√¢ches que nous r√©solvons ne r√©solvent pas dans le monde open-source.  Il n'y a pas de MapReduce qui fonctionne bien sur nos volumes (5000+ serveurs) et nos t√¢ches; il n'y a pas de traqueur de t√¢ches qui peut g√©rer toutes nos dizaines de millions de tickets.  C'est attrayant dans Yandex - vous pouvez faire de tr√®s grandes choses. </p><br><p>  Mais nous perdons s√©rieusement en efficacit√© lorsque nous r√©solvons √† nouveau les m√™mes probl√®mes, refaisons des solutions toutes faites, rendant l'int√©gration entre les composants difficile.  Il est bon et pratique de tout faire uniquement pour vous dans votre coin, vous ne pouvez pas penser aux autres pour le moment.  Mais d√®s que le service deviendra suffisamment visible, il aura des d√©pendances.  Il semble seulement que divers services d√©pendent faiblement les uns des autres, en fait - il y a beaucoup de connexions entre les diff√©rentes parties de l'entreprise.  De nombreux services sont disponibles via l'application Yandex / Navigateur / etc., ou sont int√©gr√©s les uns aux autres.  Par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Alice</a> appara√Æt dans le navigateur, en utilisant Alice, vous pouvez commander un taxi.  Nous utilisons tous des composants communs: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">YT</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">YQL</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nirvana</a> . </p><br><p>  L'ancien mod√®le de d√©veloppement avait des probl√®mes importants.  En raison de la pr√©sence de nombreux r√©f√©rentiels, il est difficile pour un d√©veloppeur ordinaire, en particulier un d√©butant, de d√©couvrir: </p><br><ul><li>  o√π est le composant? </li><li>  comment √ßa marche: il n'y a aucun moyen de "prendre et lire" </li><li>  Qui le d√©veloppe et le soutient maintenant? </li><li>  comment commencer √† l'utiliser? </li></ul><br><p> En cons√©quence, le probl√®me de l'utilisation mutuelle des composants s'est pos√©.  Les composants ne pouvaient presque pas utiliser d'autres composants car ils repr√©sentaient des ¬´bo√Ætes noires¬ª les unes pour les autres.  Cela a affect√© n√©gativement l'entreprise, car non seulement les composants n'ont pas √©t√© r√©utilis√©s, mais ils ne se sont souvent pas am√©lior√©s.  De nombreux composants ont √©t√© dupliqu√©s, la quantit√© de code qui devait √™tre prise en charge augmentait consid√©rablement.  Nous nous d√©placions g√©n√©ralement plus lentement que possible. </p><br><h3 id="edinyy-repozitoriy-i-infrastruktura">  R√©f√©rentiel et infrastructure uniques </h3><br><p>  Il y a 5 ans, nous avons lanc√© un projet de transfert de d√©veloppement vers un r√©f√©rentiel unique, avec des syst√®mes communs d'assemblage, de test, de d√©ploiement et de surveillance. </p><br><p>  L'objectif principal que nous voulions atteindre √©tait de supprimer les obstacles qui emp√™chent l'int√©gration du code de quelqu'un d'autre.  Le syst√®me doit fournir un acc√®s facile au code de travail fini, un sch√©ma clair pour sa connexion et son utilisation, la possibilit√© de collecte: les projets sont toujours collect√©s (et r√©ussissent les tests). </p><br><p>  √Ä la suite du projet, une seule pile de technologies d'infrastructure pour l'entreprise a vu le jour: stockage du code source, syst√®me de r√©vision du code, syst√®me de construction, syst√®me d'int√©gration continue, d√©ploiement, surveillance. </p><br><p>  Maintenant, la plupart du code source des projets Yandex est stock√© dans un r√©f√©rentiel unique, ou est en train de le d√©placer: </p><br><ul><li>  Plus de 2000 d√©veloppeurs travaillent sur des projets. </li><li>  plus de 50 000 projets et biblioth√®ques. </li><li>  La taille du r√©f√©rentiel d√©passe 25 Go. </li><li>  Plus de 3 000 000 de validations ont d√©j√† √©t√© valid√©es dans le r√©f√©rentiel. </li></ul><br><p>  Avantages pour l'entreprise: </p><br><ul><li>  tout projet du r√©f√©rentiel re√ßoit une infrastructure pr√™te √† l'emploi: <br><ul><li>  un syst√®me de visualisation et de navigation du code source et un syst√®me de r√©vision de code. </li><li>  syst√®me d'assemblage et assemblage distribu√©.  Il s'agit d'un grand sujet distinct, et nous le couvrirons certainement dans les articles suivants. </li><li>  syst√®me d'int√©gration continue. </li><li>  d√©ploiement, int√©gration avec le syst√®me de surveillance. </li></ul></li><li>  partage de code, interaction d'√©quipe active. </li><li>  tout le code est commun, vous pouvez venir √† un autre projet et y apporter les modifications dont vous avez besoin.  Ceci est particuli√®rement important dans une grande entreprise, car une autre √©quipe dont vous avez besoin de quelque chose peut ne pas avoir les ressources.  Avec le code commun, vous avez la possibilit√© de faire une partie du travail vous-m√™me et ¬´d'aider √† r√©aliser¬ª les changements dont vous avez besoin. </li><li>  Il y a une opportunit√© de refactoring global.  Vous n'avez pas besoin de prendre en charge les anciennes versions de votre API ou biblioth√®que, vous pouvez les modifier et modifier les emplacements o√π elles sont utilis√©es dans d'autres projets. </li><li>  le code devient moins "diversifi√©".  Vous disposez d'un ensemble de moyens pour r√©soudre les probl√®mes, et il n'est pas n√©cessaire d'ajouter un autre moyen qui fait √† peu pr√®s la m√™me chose, mais avec de l√©g√®res diff√©rences. </li><li>  dans le projet √† c√¥t√© de vous, il n'y aura probablement pas de langues et de biblioth√®ques absolument exotiques. </li></ul><br><p>  Il faut √©galement comprendre qu'un tel mod√®le de d√©veloppement pr√©sente des inconv√©nients qui doivent √™tre pris en compte: </p><br><ul><li>  Un r√©f√©rentiel partag√© n√©cessite une infrastructure distincte et sp√©cifique. </li><li>  la biblioth√®que dont vous avez besoin n'est peut-√™tre pas dans le r√©f√©rentiel, mais elle est en open-source.  Il y a des co√ªts pour l'ajouter et le mettre √† jour.  Tr√®s d√©pendant de la langue et de la biblioth√®que, quelque part presque gratuitement, quelque part tr√®s cher. </li><li>  vous devez constamment travailler sur la "sant√©" du code.  Cela inclut au moins la lutte contre les d√©pendances inutiles et le code mort. </li></ul><br><p>  Notre approche d'un r√©f√©rentiel commun impose des r√®gles g√©n√©rales que chacun doit suivre.  Dans le cas de l'utilisation d'un r√©f√©rentiel unique, des restrictions sont plac√©es sur les langues utilis√©es, les biblioth√®ques et les m√©thodes de d√©ploiement.  Mais dans le projet voisin, tout sera identique ou tr√®s similaire au v√¥tre, et vous pouvez m√™me y r√©parer quelque chose. </p><br><p>  Le mod√®le d'un r√©f√©rentiel commun gravite dans toutes les grandes entreprises.  Le d√©p√¥t monolithique est un sujet vaste et bien √©tudi√© et discut√©, donc maintenant nous n'entrerons pas dans les d√©tails.  Si vous voulez en savoir plus, √† la fin de l'article, vous trouverez plusieurs liens utiles qui r√©v√®lent ce sujet plus en d√©tail. </p><br><h3 id="usloviya-v-kotoryh-rabotaet-sistema-nepreryvnoy-integracii">  Conditions de fonctionnement du syst√®me d'int√©gration continue </h3><br><p>  Le d√©veloppement est effectu√© selon le mod√®le de d√©veloppement bas√© sur Trunk.  La plupart des utilisateurs travaillent avec HEAD, ou la copie la plus r√©cente du r√©f√©rentiel, obtenue √† partir de la branche principale appel√©e trunk, dans laquelle le d√©veloppement est en cours.  La validation des modifications dans le r√©f√©rentiel se fait de mani√®re s√©quentielle.  Imm√©diatement apr√®s la validation, le nouveau code est visible et peut √™tre utilis√© par tous les d√©veloppeurs.  Le d√©veloppement dans des branches distinctes n'est pas encourag√©, bien que les branches puissent √™tre utilis√©es pour les versions. </p><br><p>  Les projets d√©pendent du code source.  Les projets et les biblioth√®ques forment un graphique de d√©pendance complexe.  Et cela signifie que les modifications apport√©es dans un projet affectent potentiellement le reste du r√©f√©rentiel. </p><br><p>  Un grand flux de validations va au r√©f√©rentiel: </p><br><ul><li>  plus de 2000 commits par jour. </li><li>  jusqu'√† 10 changements par minute pendant les heures de pointe. </li></ul><br><p>  La base de code contient plus de 500 000 cibles de construction et tests. </p><br><p>  Sans un syst√®me sp√©cial d'int√©gration continue dans de telles conditions, il serait tr√®s difficile d'avancer rapidement. </p><br><h3 id="sistema-nepreryvnoy-integracii">  Syst√®me d'int√©gration continue </h3><br><p>  Le syst√®me d'int√©gration continue lance des assemblages et des tests pour chaque changement: </p><br><ul><li>  Contr√¥les pr√©liminaires.  Ils permettent de v√©rifier le code avant de valider et d'√©viter de casser les tests dans le coffre.  Les assemblages et les tests sont ensuite ex√©cut√©s au-dessus de HEAD.  √Ä l'heure actuelle, les contr√¥les pr√©alables √† l'audit sont lanc√©s volontairement.  Pour les projets critiques, des v√©rifications pr√©alables √† l'audit sont requises. </li><li>  V√©rifications apr√®s validation apr√®s validation dans le r√©f√©rentiel. </li></ul><br><p>  Les builds et les tests s'ex√©cutent en parall√®le sur de grands clusters de centaines de serveurs.  Les builds et les tests s'ex√©cutent sur diff√©rentes plateformes.  Sous la plate-forme principale (linux), tous les projets sont assembl√©s et tous les tests ex√©cut√©s, sous les autres plates-formes - un sous-ensemble de ceux configurables par l'utilisateur. </p><br><p>  Apr√®s avoir re√ßu et analys√© les r√©sultats des assemblages et ex√©cut√© les tests, l'utilisateur re√ßoit des commentaires, par exemple, si les modifications interrompent les tests. </p><br><img src="https://habrastorage.org/webt/kr/7s/re/kr7srek9pwwq-88vz8b3orjmtqc.png"><br><br><p>  En cas de nouveaux √©checs d'assemblage ou de tests, nous envoyons une notification aux propri√©taires des tests et √† l'auteur des modifications.  Le syst√®me stocke et affiche √©galement les r√©sultats des contr√¥les dans une interface sp√©ciale.  L'interface Web du syst√®me d'int√©gration affiche la progression et le r√©sultat du test, ventil√©s par type de test.  L'√©cran avec les r√©sultats de l'analyse peut maintenant ressembler √† ceci: </p><br><img src="https://habrastorage.org/webt/c_/p-/p3/c_p-p3pb17bzgmefh0-su2gmrnc.png"><br><br><h3 id="osobennosti-i-vozmozhnosti-sistemy-nepreryvnoy-integracii">  Caract√©ristiques et capacit√©s du syst√®me d'int√©gration continue </h3><br><p>  R√©solvant divers probl√®mes rencontr√©s par les d√©veloppeurs et testeurs, nous avons d√©velopp√© notre syst√®me d'int√©gration continue.  Le syst√®me r√©sout d√©j√† de nombreux probl√®mes, mais beaucoup reste √† am√©liorer. </p><br><h4 id="tipy-i-razmery-testov">  Types et tailles de tests </h4><br><p>  Il existe plusieurs types d'objectifs qu'un syst√®me d'int√©gration continue peut d√©clencher: </p><br><ul><li>  configurer.  Phase de configuration effectu√©e par le syst√®me de g√©n√©ration.  La configuration comprend une analyse des fichiers de configuration du syst√®me d'assemblage, d√©terminant les d√©pendances entre les projets et les param√®tres de l'assemblage et ex√©cutant les tests. </li><li>  construire.  Assemblage de biblioth√®ques et projets. </li><li>  style.  √Ä ce stade, le style de code correspond aux exigences sp√©cifi√©es. </li><li>  test.  Les tests sont divis√©s en √©tapes en fonction de leur d√©lai d'expiration du temps de travail et des besoins en ressources informatiques. <br><ul><li>  petit.  &lt;1 min </li><li>  moyen.  &lt;10 min </li><li>  grand.  &gt; 10 min  De plus, il peut y avoir des exigences particuli√®res pour les ressources informatiques. </li><li>  extra large.  Il s'agit d'un type sp√©cial de test.  Ces tests se caract√©risent par un ensemble des caract√©ristiques suivantes: un long temps de fonctionnement, une grande consommation de ressources, une grande quantit√© de donn√©es d'entr√©e, ils peuvent n√©cessiter des acc√®s sp√©ciaux et, surtout, la prise en charge des sc√©narios de test complexes d√©crits ci-dessous.  Ces tests sont moins nombreux que les autres types de tests, mais ils sont tr√®s importants. </li></ul></li></ul><br><h4 id="chastota-zapuska-testov-i-binarnyy-poisk-polomok">  Tester la fr√©quence de lancement et la d√©tection des d√©fauts binaires </h4><br><p>  D'√©normes ressources sont allou√©es pour les tests dans Yandex - des centaines de serveurs puissants.  Mais m√™me avec un grand nombre de ressources, nous ne pouvons pas ex√©cuter tous les tests pour chaque changement qui les affecte.  Mais en m√™me temps, il est tr√®s important pour nous d'aider toujours le d√©veloppeur √† localiser l'endroit o√π le test se casse, en particulier dans un si grand r√©f√©rentiel. </p><br><p>  Que faisons-nous.  Pour chaque modification de tous les projets concern√©s, des assemblages, des v√©rifications de style et des tests avec des tailles petites et moyennes sont ex√©cut√©s.  Les autres tests ne sont pas ex√©cut√©s pour chaque validation d'influence, mais avec une certaine p√©riodicit√©, si des validations affectent les tests.  Dans certains cas, les utilisateurs peuvent contr√¥ler la fr√©quence de d√©marrage; dans d'autres cas, la fr√©quence de d√©marrage est d√©finie par le syst√®me.  Lorsqu'un √©chec de test est d√©tect√©, le processus de recherche d'un commit de rupture de test d√©marre.  Moins le test s'ex√©cute, plus nous rechercherons un commit de rupture apr√®s la d√©tection d'un √©chec. </p><br><img width="700" src="https://habrastorage.org/webt/1b/7r/hg/1b7rhgcpvzuuqnkue2cmn8yytam.png"><br><br><p>  Lors du d√©marrage des v√©rifications pr√©alables √† l'audit, nous ex√©cutons √©galement uniquement des assemblages et des tests d'√©clairage.  Ensuite, l'utilisateur peut lancer manuellement le lancement de tests lourds en s√©lectionnant dans la liste des tests affect√©s par les modifications apport√©es par le syst√®me. </p><br><h4 id="obnaruzhenie-migayuschih-testov">  D√©tection de test clignotant </h4><br><p>  Les tests de clignotement sont des tests dont les r√©sultats d'ex√©cution (r√©ussi / √©chou√©) sur le m√™me code peuvent d√©pendre de divers facteurs.  Les causes des tests clignotants peuvent √™tre diff√©rentes: sommeil dans le code de test, erreurs lors du travail avec le multithreading, probl√®mes d'infrastructure (indisponibilit√© de tout syst√®me), etc.  Les tests de clignotement pr√©sentent un probl√®me s√©rieux: </p><br><ul><li>  Ils conduisent au fait que le syst√®me d'int√©gration continue spam de fausses alertes sur les √©checs de test. </li><li>  Contaminer les r√©sultats des tests.  Il devient de plus en plus difficile de d√©cider du succ√®s des r√©sultats de la v√©rification. </li><li>  Retarder la sortie des produits. </li><li>  Difficile √† d√©tecter.  Les tests peuvent clignoter tr√®s rarement. <br>  Les d√©veloppeurs peuvent ignorer les tests clignotants lorsqu'ils analysent les r√©sultats des tests.  Parfois incorrect. <br>  Il est impossible d'√©liminer compl√®tement les tests de clignotement, cela doit √™tre pris en compte dans un syst√®me d'int√©gration continue. </li></ul><br><p>  Actuellement, pour chaque test, nous ex√©cutons tous les tests deux fois pour d√©tecter les tests clignotants.  Nous prenons √©galement en compte les r√©clamations des utilisateurs (destinataires des notifications).  Si nous d√©tectons un clignotement, nous marquons le test avec un drapeau sp√©cial (muet) et informons le propri√©taire du test.  Apr√®s cela, seuls les propri√©taires de tests recevront des notifications d'√©checs de test.  Ensuite, nous continuons d'ex√©cuter le test en mode normal, tout en analysant l'historique de ses lancements.  Si le test n'a pas clignot√© dans une certaine fen√™tre de temps, l'automatisation peut d√©cider que le test a cess√© de clignoter et vous pouvez effacer l'indicateur. </p><br><p>  Notre algorithme actuel est assez simple et de nombreuses am√©liorations sont pr√©vues √† cet endroit.  Tout d'abord, nous voulons utiliser des signaux beaucoup plus utiles. </p><br><h4 id="avtomaticheskoe-obnovlenie-vhodnyh-dannyh-testov">  Mise √† jour automatique de l'entr√©e de test </h4><br><p>  Lors du test des syst√®mes Yandex les plus complexes, en plus des autres m√©thodes de test, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le test de strat√©gie de bo√Æte noire</a> + <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le test bas√© sur les donn√©es est</a> souvent utilis√©.  Pour garantir une bonne couverture, ces tests n√©cessitent un grand ensemble de donn√©es d'entr√©e.  Les donn√©es peuvent √™tre s√©lectionn√©es √† partir de clusters de production.  Mais il y a un probl√®me avec le fait que les donn√©es deviennent rapidement obsol√®tes.  Le monde ne s'arr√™te pas, nos syst√®mes √©voluent constamment.  Des donn√©es de test obsol√®tes au fil du temps ne fourniront pas une bonne couverture de test, puis conduiront compl√®tement √† une panne de test car les programmes commencent √† utiliser de nouvelles donn√©es qui ne sont pas disponibles dans des donn√©es de test obsol√®tes. </p><br><p>  Afin que les donn√©es ne deviennent pas obsol√®tes, le syst√®me d'int√©gration continue peut les mettre √† jour automatiquement.  Comment √ßa marche? </p><br><ol><li>  Les donn√©es de test sont stock√©es dans un stockage sp√©cial de ressources. </li><li>  Le test contient des m√©tadonn√©es d√©crivant l'entr√©e requise. </li><li>  La correspondance entre l'entr√©e de test requise et les ressources est stock√©e dans un syst√®me d'int√©gration continue. </li><li>  Le d√©veloppeur fournit une livraison r√©guli√®re de nouvelles donn√©es au magasin de ressources. </li><li>  Le syst√®me d'int√©gration continue recherche les nouvelles versions des donn√©es de test dans le r√©f√©rentiel de ressources et commute les donn√©es d'entr√©e. </li></ol><br><p>  Il est important de mettre √† jour les donn√©es afin que le faux test ne se produise pas.  Vous ne pouvez pas simplement prendre et, √† partir d'un certain commit, commencer √† utiliser de nouvelles donn√©es, car  en cas de panne de test, il ne sera pas clair qui est √† bl√¢mer - commit ou nouvelles donn√©es.  Cela rendra √©galement les tests diff (d√©crits ci-dessous) inop√©rants. </p><br><img width="600" src="https://habrastorage.org/webt/yz/xq/ew/yzxqew6kgfu-irgksx-mbgejtz8.png"><br><p>  Par cons√©quent, nous faisons en sorte qu'il y ait un petit intervalle de validations, sur lequel le test est lanc√© avec les anciennes et les nouvelles versions des donn√©es d'entr√©e. </p><br><img width="700" src="https://habrastorage.org/webt/r1/zr/j8/r1zrj8e-kxo8bmnd0evq6tgzktg.png"><br><br><h4 id="diff-testy">  Tests de diff </h4><br><p>  Les tests diff, nous appelons un type sp√©cial de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tests bas√©s</a> sur les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">donn√©es</a> , qui diff√®rent de l'approche g√©n√©ralement accept√©e en ce sens que le test n'a pas de r√©sultat de r√©f√©rence, mais en m√™me temps, nous devons trouver dans ce qui commet le test a chang√© son comportement. </p><br><p>  L'approche standard des tests bas√©s sur les donn√©es est la suivante.  Le test a un r√©sultat de r√©f√©rence obtenu lors du premier test.  Le r√©sultat de r√©f√©rence peut √™tre stock√© dans le r√©f√©rentiel √† c√¥t√© du test.  Les ex√©cutions suivantes du test devraient produire le m√™me r√©sultat. </p><br><img width="600" src="https://habrastorage.org/webt/gj/bq/gx/gjbqgx1rtrgb1lwxhih01ojki3k.png"><br><p>  Si le r√©sultat diff√®re de la r√©f√©rence, le d√©veloppeur doit d√©cider si cette modification ou erreur attendue.  Si la modification est attendue, le d√©veloppeur doit mettre √† jour le r√©sultat de r√©f√©rence en m√™me temps qu'il valide les modifications dans le r√©f√©rentiel. </p><br><p>  Il existe des difficult√©s lors de l'utilisation de cette approche dans un grand r√©f√©rentiel avec des flux de validation importants: </p><br><ol><li>  Il peut y avoir de nombreux tests et les tests peuvent √™tre tr√®s difficiles.  Le d√©veloppeur n'a pas la possibilit√© d'ex√©cuter tous les tests concern√©s dans un environnement de travail. </li><li>  Apr√®s avoir apport√© des modifications, le test peut √©chouer si le r√©sultat de r√©f√©rence n'a pas √©t√© mis √† jour simultan√©ment avec les modifications apport√©es au code.  Ensuite, un autre d√©veloppeur peut apporter des modifications au m√™me composant et le r√©sultat du test changera √† nouveau.  Nous obtenons l'imposition d'une erreur sur une autre.  Il est tr√®s difficile de g√©rer de tels probl√®mes, cela prend du temps aux d√©veloppeurs. </li></ol><br><p>  Que faisons-nous.  Les tests de diff se composent de 2 parties: </p><br><ul><li>  V√©rifiez le composant. <br><ul><li>  Nous commen√ßons le test et enregistrons le r√©sultat dans le stockage des ressources. </li><li>  Ne comparez pas le r√©sultat avec la r√©f√©rence. </li><li>  Nous pouvons d√©tecter certaines des erreurs, par exemple, le programme ne d√©marre pas / ne se termine pas, se bloque, le programme ne r√©pond pas.  La validation du r√©sultat peut √©galement √™tre effectu√©e: pr√©sence de champs dans la r√©ponse, etc. </li></ul></li><li>  Composant diff. <br><ul><li>  Comparez les r√©sultats obtenus sur diff√©rents lancements et construisez diff.  Dans le cas le plus simple, il s'agit d'une fonction qui prend 2 param√®tres et renvoie diff. </li><li>  L'apparence de diff d√©pend du test, mais cela devrait √™tre quelque chose de compr√©hensible pour quelqu'un qui regardera diff.  Diff est g√©n√©ralement un fichier html. </li></ul></li></ul><br><p>  Le lancement des composants check et diff est contr√¥l√© par un syst√®me d'int√©gration continue. </p><br><img width="600" src="https://habrastorage.org/webt/jp/g2/2z/jpg22zjvje4rqvytyy8-qlrf-yo.png"><br><br><p>  Si le syst√®me d'int√©gration continue d√©tecte diff, une recherche binaire est d'abord effectu√©e pour la validation qui a provoqu√© la modification.  Apr√®s avoir re√ßu une notification du d√©veloppeur, il devient possible d'√©tudier le diff et de d√©cider quoi faire ensuite: reconna√Ætre le diff comme pr√©vu (pour cela, vous devez effectuer une action sp√©ciale) ou r√©parer / "annuler" vos modifications. </p><br><h3 id="prodolzhenie-sleduet">  √Ä suivre </h3><br><p>  Dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prochain article,</a> nous parlerons du fonctionnement du syst√®me d'int√©gration continue. </p><br><h3 id="ssylki">  Les r√©f√©rences </h3><br><p>  D√©p√¥t monolithique, d√©veloppement bas√© sur tronc </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Monorepo - Wikipedia</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://trunkbaseddevelopment.com</a> </li></ul><br><p>  Tests bas√©s sur les donn√©es </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tests bas√©s sur les donn√©es - Wikipedia</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr428972/">https://habr.com/ru/post/fr428972/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr428954/index.html">Comment on s'est tir√© une balle dans la jambe et on a essay√© de comprendre</a></li>
<li><a href="../fr428956/index.html">Drones sur l'ISS</a></li>
<li><a href="../fr428960/index.html">Rapport 2018 du Club de Rome, chapitre 1.5: D√©fi climatique</a></li>
<li><a href="../fr428962/index.html">D√©localisation √† Luxoft: comment se passe la vie</a></li>
<li><a href="../fr428964/index.html">Les vuln√©rabilit√©s du SSD chiffr√© par le mat√©riel permettent aux attaquants de contourner facilement les mesures de protection</a></li>
<li><a href="../fr428974/index.html">Int√©ressant √† Interlight 2018</a></li>
<li><a href="../fr428976/index.html">Colline de fourmis ou forteresse? Je construis une maison pour le prix d'un appartement. Partie 2: Chauffage</a></li>
<li><a href="../fr428980/index.html">Broker JavaScript hors ligne</a></li>
<li><a href="../fr428982/index.html">Comment √©crire D sur ARM</a></li>
<li><a href="../fr428984/index.html">Julia et portraits de phases de syst√®mes dynamiques</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>