<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üÜï üÜô üï¥üèº Confer√™ncia DEFCON 18. Engenharia reversa de trollim usando matem√°tica üì≤ üë©üèº‚Äçü§ù‚Äçüë©üèª üëâüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Trollagem matem√°tica √© o que eu vou falar. Esses n√£o s√£o alguns truques de hackers da moda; √© uma express√£o art√≠stica, uma tecnologia inteligente e en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Confer√™ncia DEFCON 18. Engenharia reversa de trollim usando matem√°tica</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/433280/"> Trollagem matem√°tica √© o que eu vou falar.  Esses n√£o s√£o alguns truques de hackers da moda; √© uma express√£o art√≠stica, uma tecnologia inteligente e engra√ßada para que as pessoas o considerem um idiota.  Agora vou verificar se meu relat√≥rio est√° pronto para ser exibido na tela.  Tudo parece estar indo bem, para que eu possa me apresentar. <br><br><img src="https://habrastorage.org/webt/ez/pj/s8/ezpjs8mlxgrkekfrl6cyjia0zhu.jpeg"><a name="habracut"></a><br><br>  Meu nome √© Frank Tu, soletrado frank ^ 2 e @franksquared no Twitter, porque o Twitter tamb√©m possui algum tipo de spammer chamado "frank 2".  Tentei aplicar a engenharia social a eles para que eles exclu√≠ssem sua conta, porque tecnicamente √© spam e tenho o direito de me livrar dela como meu clone.  Mas, aparentemente, se voc√™ os tratar honestamente, eles n√£o retribuem, porque, apesar do meu pedido para excluir a conta do spammer, eles n√£o fizeram nada com ela, ent√£o enviei essa merda do Twitter para o inferno. <br><br>  Muitas pessoas me reconhecem pelo meu bon√©.  Trabalho nos grupos regionais DefCon DC949 e DC310.  Tamb√©m trabalho com o Rapid7, mas n√£o posso falar sobre isso aqui sem usar linguagem obscena, e meu gerente n√£o quer que eu jure.  Ent√£o, preparei esta apresenta√ß√£o para a DefCon e cumprirei o prazo de 15 minutos, embora esse seja um t√≥pico bastante complicado.  Esta √© essencialmente uma apresenta√ß√£o padr√£o que se concentra em engenharia reversa e coisas engra√ßadas relacionadas. <br><br>  Ao discutir este t√≥pico no Twitter, dois campos se formaram.  Um cara disse: "Eu n√£o tenho id√©ia do que essa merda ^ 2 est√° falando, mas √© incr√≠vel!"  O segundo cara do Reddit viu meus slides e ficou chateado por causa de links para coisas que n√£o estavam relacionadas ao t√≥pico, fiquei com raiva por um assunto t√£o s√©rio n√£o ter sido totalmente abordado, ent√£o desejei que minha apresenta√ß√£o tivesse "mais conte√∫do e menos lixo". <br><br><img src="https://habrastorage.org/webt/dw/wg/il/dwwgilfsbikiyjsa8kkr-ifito8.jpeg"><br><br>  Portanto, quero focar nesta cita√ß√£o.  Nada pessoal, cara do Reddit - digo isso n√£o apenas no caso de ele estar presente nesta sala, mas tamb√©m porque foi uma cr√≠tica justa.  Porque uma conversa que n√£o cont√©m conte√∫do √∫til suficiente √© conversa vazia. <br><br>  O t√≥pico da minha conversa √© uma rotina padr√£o para hackers, mas parece-me que, de fato, os palestrantes geralmente n√£o tentam apresentar suas informa√ß√µes de maneira divertida, mesmo quando poss√≠vel, preferindo conclus√µes secas e emasculadas.  "Aqui est√° o IP, aqui est√° o ESP, aqui est√° como voc√™ pode executar uma explora√ß√£o, aqui est√° o meu" dia zero ", agora aplaude!"  - e todos batem palmas. <br><br>  Obrigado pelos aplausos, agrade√ßo!  Parece-me que h√° muitos pontos interessantes no meu material, por isso merece ser declarado de uma maneira um tanto divertida, que tentarei fazer. <br><br>  Voc√™ ver√° uma atitude excepcionalmente superficial em rela√ß√£o √† ci√™ncia da computa√ß√£o e ao humor completamente infantil, por isso espero que voc√™ aprecie o que vou mostrar aqui.  Sinto muito se voc√™ veio aqui √† procura de uma conversa s√©ria. <br><br>  No slide, voc√™ v√™ uma an√°lise cient√≠fica do meu √∫ltimo relat√≥rio comparando o compartilhamento de uma abordagem estritamente cient√≠fica e o compartilhamento de um "medicamento" que fornece seguran√ßa ao computador. <br><br><img src="https://habrastorage.org/webt/sg/dy/ef/sgdyefwk3c8k5olv7tjymmpd77a.jpeg"><br><br>  Voc√™ v√™ que existem muito mais "drogas", mas n√£o se preocupe, agora a participa√ß√£o da ci√™ncia aumentou um pouco. <br><br><img src="https://habrastorage.org/webt/t8/8e/u6/t88eu666sy0qrgwbk8qxydshdfe.jpeg"><br><br>  Ent√£o, h√° algum tempo, meu amigo Merlin, sentado aqui em primeiro plano, escreveu um incr√≠vel bot baseado no script IRC Python, que ocupa apenas uma linha. <br><br>  Este √© um exerc√≠cio realmente incr√≠vel para aprender programa√ß√£o funcional, o que √© muito divertido de se mexer.  Voc√™ pode simplesmente adicionar uma fun√ß√£o ap√≥s a outra e obter combina√ß√µes de todos os tipos de fun√ß√µes diferentes, e tudo isso √© desenhado na tela como uma onda do arco-√≠ris; em geral, essa √© uma das coisas mais est√∫pidas que voc√™ pode fazer. <br><br><img src="https://habrastorage.org/webt/hc/bk/oe/hcbkoelnorhbl1idrue1ishlk7c.jpeg"><br><br>  Eu pensei que se voc√™ aplicar esse princ√≠pio aos arquivos bin√°rios?  N√£o sei de onde veio essa ideia, mas ficou incr√≠vel!  No entanto, quero esclarecer alguns conceitos b√°sicos. <br><br>  √â poss√≠vel que seu professor de matem√°tica tenha apresentado essas fun√ß√µes muito mais complicadas do que realmente s√£o. <br><br><img src="https://habrastorage.org/webt/fj/-q/rp/fj-qrpljhzhe4dadrmw-wpxqdyk.jpeg"><br><br>  Portanto, a f√≥rmula f (x) tem um significado muito simples, funciona como fun√ß√µes comuns.  Voc√™ tem X, tem entrada e recebe X 7 vezes, e isso √© igual ao seu valor.  No Python, voc√™ pode criar uma fun√ß√£o (lambda x: x * 7).  Se voc√™ deseja trabalhar com Java - desculpe, espero que voc√™ nunca queira fazer isso -, voc√™ pode fazer algo como: <br><br><pre><code class="plaintext hljs">public static int multiplyBySevenAndReturn(Integer x) { return x * 7; }</code> </pre> <br>  Voc√™ sabe, fun√ß√µes matem√°ticas podem at√© ser muito mais complicadas, mas √© tudo o que precisamos saber sobre elas no momento. <br><br>  Se voc√™ observar o conjunto de c√≥digos, notar√° que as instru√ß√µes JMP e CALL n√£o est√£o vinculadas a valores espec√≠ficos, elas funcionam com um deslocamento.  Se voc√™ usar um depurador, poder√° ver que o JMP00401000 √© mais uma instru√ß√£o de salto para bytes a frente do que uma instru√ß√£o espec√≠fica para pular para 5 ou 10 bytes.  O mesmo se aplica √† fun√ß√£o CALL, exceto que ela coloca v√°rias coisas na sua pilha.  A exce√ß√£o ocorre quando voc√™ "cola" o endere√ßo no registro, ou seja, est√° acessando um endere√ßo espec√≠fico.  Tudo acontece aqui de uma maneira completamente diferente.  Depois de conectar o endere√ßo ao registro e fazer algo como CALL EAX, a fun√ß√£o acessa o valor espec√≠fico no EAX.  O mesmo vale para CALL [EAX] ou JMP [EAX] - apenas desreferencia o EAX e vai para esse endere√ßo.  Ao usar um depurador, talvez voc√™ n√£o consiga determinar qual endere√ßo espec√≠fico a CALL est√° acessando.  Isso pode ser um problema, ent√£o voc√™ deve estar ciente disso. <br>  Vejamos o recurso de salto curto JMP curto.  Esta √© uma instru√ß√£o especial na arquitetura x86 que permite usar um deslocamento de 1 byte em vez de um deslocamento de 4 bytes, o que reduz o espa√ßo de mem√≥ria usado.  Isso ser√° importante mais tarde para todas as manipula√ß√µes que ocorrer√£o com instru√ß√µes individuais.  √â importante lembrar que o JMP SHORT possui um intervalo de 256 bytes.  No entanto, n√£o existe um CURSO DE CHAMADA. <br><br><img src="https://habrastorage.org/webt/qr/0o/fg/qr0ofgmfo8ypyexaxbhe-bmlcpo.jpeg"><br><br>  Agora considere a bruxaria da ci√™ncia da computa√ß√£o.  No meio da cria√ß√£o desses slides, percebi que, na verdade, voc√™ pode definir uma montagem como espa√ßo zero, ou seja, tecnicamente, existe espa√ßo zero entre cada instru√ß√£o.  Se voc√™ observar instru√ß√µes individuais, ver√° que cada uma √© executada uma ap√≥s a outra.  Tecnicamente, isso pode ser interpretado como um salto incondicional para a pr√≥xima instru√ß√£o.  Isso nos fornece um espa√ßo entre cada instru√ß√£o de montagem, enquanto cada instru√ß√£o est√° associada a um salto incondicional. <br><br>  Se voc√™ olhar para este exemplo de montagem, a prop√≥sito, estas s√£o coisas muito simples que recomendo decodificar com ASCII, portanto, este √© apenas um conjunto de instru√ß√µes regulares. <br><br><img src="https://habrastorage.org/webt/ud/ld/7n/udld7n6wwfcvyuvxr6jdd28b1by.jpeg"><br><br>  Os 0s do JMP localizados entre cada instru√ß√£o s√£o saltos incondicionais que voc√™ normalmente n√£o v√™.  Eles se seguem ap√≥s cada instru√ß√£o.  Portanto, √© poss√≠vel colocar cada instru√ß√£o de montagem individual em um local de mem√≥ria arbitr√°ria se e somente se cada instru√ß√£o de unidade for acompanhada de um salto incondicional para a pr√≥xima instru√ß√£o.  Porque se voc√™ transferir a montagem e precisar usar o mesmo c√≥digo de antes, dever√° anexar um salto incondicional a cada instru√ß√£o. <br>  Vamos olhar mais longe.  Tecnicamente, uma matriz unidimensional pode ser interpretada como uma matriz bidimensional, requer apenas um pouco de matem√°tica, linhas ou algo parecido, n√£o vou dizer com certeza, mas n√£o √© muito dif√≠cil.  Isso nos d√° a oportunidade de interpretar o local na mem√≥ria na forma de uma treli√ßa (x, y).  Em combina√ß√£o com a interpreta√ß√£o do espa√ßo vazio entre as instru√ß√µes como saltos incondicionais que podem ser relacionados entre si, podemos literalmente desenhar instru√ß√µes.  Isso √© demais! <br><br>  Para implementar isso na pr√°tica, voc√™ precisa executar as seguintes etapas: <br><br><ul><li>  desmonte cada instru√ß√£o para descobrir qual √© o c√≥digo; </li><li>  Aloque um lugar na mem√≥ria muito maior que o tamanho do conjunto de instru√ß√µes.  Eu costumo reservar 10 vezes mais mem√≥ria que o tamanho do c√≥digo; </li><li>  para cada instru√ß√£o, determine f (x); </li><li>  defina cada instru√ß√£o no local correspondente (x, y) na mem√≥ria; </li><li>  anexar um salto incondicional √† instru√ß√£o; </li><li>  marque a mem√≥ria como execut√°vel e execute o c√≥digo. </li></ul><br>  Infelizmente, muitas quest√µes surgem aqui.  √â como a gravidade, que funciona apenas na teoria, mas na pr√°tica vemos uma coisa completamente diferente.  Porque, na realidade, o x86 envia para o inferno suas instru√ß√µes JMP, instru√ß√µes CALL, distorcem seu c√≥digo auto-referencial, c√≥digo auto-modificador que usa a itera√ß√£o. <br><br><img src="https://habrastorage.org/webt/wi/8c/cq/wi8ccqnv606718u6worjzx7bnok.jpeg"><br><br>  Vamos come√ßar com as instru√ß√µes do JMP.  Como as instru√ß√µes do JMP s√£o tendenciosas, quando colocadas em um local arbitr√°rio, elas n√£o apontam mais para onde voc√™ acha que deveriam apontar.  O JMP CURTO encontra-se em uma posi√ß√£o semelhante.  Colocados acidentalmente pela sua fun√ß√£o (x, y), eles n√£o indicam o que voc√™ est√° contando.  Por√©m, diferentemente dos JMPs longos, os JMPs curtos s√£o mais f√°ceis de corrigir, especialmente se voc√™ estiver lidando com uma matriz unidimensional.  O JMP CURTO √© f√°cil de converter para o JMP normal, mas √© preciso descobrir qual foi o novo deslocamento. <br><br>  Trabalhar com JMPs baseados em registro ainda √© uma dor de cabe√ßa e, como eles exigem compensa√ß√µes apertadas e podem ser calculados em tempo de execu√ß√£o, n√£o h√° uma maneira f√°cil de descobrir para onde est√£o indo.  Para detectar automaticamente cada registro, voc√™ precisa usar um monte de conhecimentos da teoria da compila√ß√£o.  Em tempo de execu√ß√£o, pode haver ponteiros de fun√ß√£o, ponteiros de classe e similares.  √â verdade que, se voc√™ n√£o quiser fazer um trabalho extra para fazer tudo isso, n√£o poder√° faz√™-lo.  As fun√ß√µes f (x) funcionam em c√≥digo real, n√£o de maneira t√£o elegante quanto no papel.  Se voc√™ quiser fazer isso corretamente, precisar√° fazer muito trabalho. <br><br>  Para definir indicadores de classe e coisas assim, voc√™ precisa conjurar com C e C ++.  Antes de salvar, durante a desmontagem, converta seu JMP CURTO em JMP regular, porque voc√™ precisa lidar com o vi√©s, √© bastante simples. <br><br>  Tentar calcular os deslocamentos reais √© uma enorme dor de cabe√ßa.  Todas as instru√ß√µes encontradas t√™m deslocamentos que ser√£o movidos quando o c√≥digo for movido e dever√£o ser recalculados.  Isso significa que voc√™ precisa seguir as instru√ß√µes e para onde elas est√£o se movendo como metas.  √â dif√≠cil explicar para voc√™ nos slides, mas um exemplo de como conseguir isso est√° no CD com os materiais desta confer√™ncia. <br><br>  Depois de colocar todas as instru√ß√µes, substitua as compensa√ß√µes antigas pelas novas.  Se voc√™ n√£o danificou o deslocamento, tudo vai dar certo.  Agora que voc√™ se preparou, h√° uma oportunidade real de implementar a ideia no n√≠vel mais alto.  Para fazer isso, voc√™ precisa: <br><br><ul><li>  desmontar instru√ß√µes; </li><li>  prepare um buffer de mem√≥ria; </li><li>  inicialize as constantes dispon√≠veis f (x); </li><li>  itere sobre f (x) e determinados ponteiros de dados, segundo os quais o seu c√≥digo ser√° gravado ao rastrear instru√ß√µes de merda; </li><li>  Atribua instru√ß√µes aos √≠ndices criados correspondentes; </li><li>  corrija todos os saltos condicionais; </li><li>  marque a nova parti√ß√£o de mem√≥ria como execut√°vel; </li><li>  executar c√≥digo. </li></ul><br>  Se voc√™ colocar as coisas no lugar delas, ent√£o teremos coisas estranhas - tudo fica bagun√ßado, as instru√ß√µes saltam para lugares obscuros da mem√≥ria e tudo isso parece simplesmente encantador. <br><br><img src="https://habrastorage.org/webt/kv/pi/wf/kvpiwfksxaglubnkdlasc2gwcda.jpeg"><br><br>  Tudo isso tem algum significado pr√°tico ou √© apenas uma performance de circo?  O valor aplicado de tais transforma√ß√µes √© o seguinte.  Isolar as instru√ß√µes de montagem e algumas etapas para calcular f (x) nos permite colocar essas instru√ß√µes de montagem em qualquer lugar do buffer sem nenhuma intera√ß√£o do usu√°rio.  Para confundir os caminhos de execu√ß√£o de c√≥digo, tudo o que voc√™ precisa fazer √© escrever matematicamente a fun√ß√£o e os ponteiros em algum assembler, escolhendo-os aleatoriamente. <br><br>  Isso simplifica bastante as t√©cnicas de codifica√ß√£o polim√≥rfica.  Em vez de escrever c√≥digo cada vez que manipula seu c√≥digo de uma certa maneira, voc√™ pode escrever uma s√©rie de fun√ß√µes que determinam aleatoriamente a posi√ß√£o do seu c√≥digo e, em seguida, seleciona essas fun√ß√µes como aleat√≥rias etc. <br><br>  O anti-reverso n√£o √© t√£o legal e atual quanto a t√©cnica anti-depura√ß√£o. <br><br>  O Anti -version n√£o √© o quanto voc√™ se diverte ao tornar imposs√≠vel o uso do IDA, e n√£o o quanto voc√™ estraga o computador do Reverser com as imagens do GNAA Last Measure, embora seja muito divertido.  Anti-revers√£o significa simplesmente ser um imbecil, porque se voc√™, como o √∫ltimo imbecil, recebe um Reverser, um cara que quebra a prote√ß√£o de diferentes sistemas, ele fica bravo, envia esse programa malicioso para o inferno e sai. <br><br>  Enquanto isso, voc√™ poder√° vender todos os seus bots para redes de neg√≥cios russas, porque com seu software voc√™ "reduz" todos os envolvidos na engenharia reversa.  Todo mundo sabe como encontrar t√©cnicas anti-depura√ß√£o no Google, mas n√£o encontra solu√ß√µes para problemas decorrentes de coisas criativas no local.  Os anti-rev√≥lveres mais criativos far√£o com que os reverters quebrem os dedos do teclado e deixem orif√≠cios do tamanho de punhos nas paredes.  Os inversores fervem de raiva, eles n√£o entender√£o o que diabos voc√™ fez, porque seu c√≥digo estragou tudo. <br><br>  Este √© um tipo de jogo nervoso, uma coisa psicol√≥gica. Se voc√™ √© criativo nessa quest√£o e cria um anti-reverso realmente impressionante, pode se orgulhar disso.  Mas voc√™ sabe que, na verdade, voc√™ est√° apenas tentando afast√°-los do seu c√≥digo. <br><br>  Ent√£o o que eu vou fazer?  Vou pegar as fun√ß√µes de ofusca√ß√£o e ofusc√°-las.  Ent√£o, vou usar a segunda vers√£o da ofusca√ß√£o de fun√ß√µes emaranhadas e aplicar a ofusca√ß√£o novamente.  Ent√£o, vamos puxar o c√≥digo.  Este √© um exemplo de trolling matem√°tico, que tomei como exemplo. <br><br><img src="https://habrastorage.org/webt/qt/rn/sx/qtrnsxmxi2hcqfrtyilcqrtxaem.jpeg"><br><br>  Ent√£o, insiro o comando "confundir pela f√≥rmula" na janela que √© aberta. <br><br><img src="https://habrastorage.org/webt/_8/mi/gg/_8miggm7ypffnzh5pxg9wqp_mls.jpeg"><br><br>  Em seguida, voc√™ v√™ instru√ß√µes de montagem que fazem seu trabalho.  Observe que eu uso C ++ aqui, embora na menor oportunidade eu tente evitar isso. <br><br><img src="https://habrastorage.org/webt/vo/rs/0n/vors0n4cbvak6erlntuxupbibyw.jpeg"><br><br>  Aqui, a fun√ß√£o ativa CALL EAX √© destacada, seguida pela instru√ß√£o de salto que ser√° aplicada, voc√™ v√™ v√°rios tipos de coisas diferentes no buffer, e tudo isso √© feito com cada instru√ß√£o individual. <br><br><img src="https://habrastorage.org/webt/ei/eg/ls/eiegls4lpaq-5ktwrcmvxfm7xhg.jpeg"><br><br><img src="https://habrastorage.org/webt/bb/vl/rp/bbvlrpccrihcbvjxklexk-hee7a.jpeg"><br><br>  Agora eu rebobino o programa at√© o fim, e voc√™ ver√° o resultado.  Portanto, o c√≥digo ainda parece √≥timo, v√°rias instru√ß√µes JMP s√£o compiladas aqui, parece confuso e, na verdade, confuso. <br><br><img src="https://habrastorage.org/webt/fe/n4/-f/fen4-ff9er24oisuviqc2gpc_rg.jpeg"><br><br>  O pr√≥ximo slide mostra uma representa√ß√£o gr√°fica da apar√™ncia da pilha. <br><br><img src="https://habrastorage.org/webt/zi/d9/sa/zid9sadg9n0azq5oeesabhfq2wm.jpeg"><br><br>  Toda vez que isso acontece, eu gero uma f√≥rmula aleat√≥ria de ondas senoidais com forma arbitr√°ria, voc√™ v√™ aqui v√°rias formas diferentes, e isso √© legal.  Acho que o c√≥digo come√ßa em algum lugar no canto superior esquerdo, mas n√£o me lembro exatamente.  Ent√£o ele torce tudo, voc√™ pode n√£o apenas produzir sinus√≥ides, mas tamb√©m torcer as espirais. <br><br><img src="https://habrastorage.org/webt/tk/hq/iq/tkhqiqo6k4yxin-xboy7wqepcic.jpeg"><br><br>  Apenas duas f√≥rmulas funcionam aqui, que eu inclu√≠ no c√≥digo fonte.  Com base nisso, voc√™ pode fazer quantas coisas criativas quiser, basicamente √© apenas DIFF do buffer inicial ao buffer final. <br><br>  O problema √© que este exemplo de c√≥digo usa saltos incondicionais, o que √© realmente ruim, porque o c√≥digo deve ser exatamente o mesmo de antes, ou seja, saltos incondicionais seguem apenas uma dire√ß√£o.  Portanto, voc√™ precisa ir do ponto de entrada at√© o final da mesma maneira, livrar-se das instru√ß√µes de salto e pronto - voc√™ conseguiu seu c√≥digo!  O que fazer?  √â necess√°rio transformar saltos incondicionais em condicionais.  Saltos condicionais s√£o feitos em duas dire√ß√µes, √© muito melhor, podemos dizer que √© 50% melhor. <br><br>  Aqui temos um dilema interessante: se precisamos de saltos condicionais, ainda precisamos usar saltos incondicionais ... que diabos?  Ent√£o o que fazemos?  Predicados opacos nos salvar√£o!  Para quem n√£o sabe, um predicado opaco √© essencialmente uma instru√ß√£o booleana que √© sempre executada para uma vers√£o espec√≠fica, independentemente de qualquer coisa. <br>  Ent√£o, vejamos a extens√£o do espa√ßo zero que mencionei anteriormente.  Se voc√™ tiver um conjunto de instru√ß√µes e eles tiverem saltos incondicionais, transi√ß√µes entre cada instru√ß√£o, segue-se que uma s√©rie de instru√ß√µes de montagem que n√£o afetam diretamente as instru√ß√µes de que precisamos podem preceder ou seguir uma √∫nica instru√ß√£o. <br>  Por exemplo, se voc√™ escreveu instru√ß√µes muito espec√≠ficas que n√£o alteram a montagem principal do que voc√™ est√° tentando confundir, ou seja, tenta n√£o se envolver com os registros, desde que mantenha o estado de cada instru√ß√£o de montagem.  E isso √© ainda mais incr√≠vel. <br>  Voc√™ pode considerar cada instru√ß√£o de montagem, que pode ser confundida, como pre√¢mbulo, dados de montagem e postscript.  O pre√¢mbulo √© o que precede a instru√ß√£o de montagem e o p√≥s-escrito √© o que segue.  O pre√¢mbulo √© geralmente usado ou pode ser usado para duas coisas: <br><br><ul><li>  corre√ß√£o das conseq√º√™ncias do predicado opaco do pre√¢mbulo anterior; </li><li>  fragmentos de c√≥digo anti-depura√ß√£o. </li></ul><br>  Mas o pre√¢mbulo √© essencialmente limitado porque voc√™ n√£o pode fazer muito. <br>  Postscript √© uma coisa mais engra√ßada.  Pode ser usado para: <br><br><ul><li>  predicados opacos e saltos intrincados para as seguintes se√ß√µes do c√≥digo; </li><li>  anti-depura√ß√£o e ofusca√ß√£o da execu√ß√£o geral do c√≥digo; </li><li>  criptografia e descriptografia de v√°rios fragmentos de c√≥digo no pr√≥prio programa. </li></ul><br>  No momento, estou trabalhando na possibilidade de criptografar e descriptografar cada instru√ß√£o individual para que, quando cada instru√ß√£o for executada, descriptografar a pr√≥xima se√ß√£o, a pr√≥xima se√ß√£o, a pr√≥xima e assim por diante.  O slide a seguir mostra um exemplo disso. <br><br><img src="https://habrastorage.org/webt/co/is/tj/coistjw3lgdiwggoqth_c9hnq2y.jpeg"><br><br>  As linhas de pre√¢mbulo e a chamada do depurador s√£o destacadas em verde.  Tudo o que essa chamada faz √© verificar se temos um depurador, ap√≥s o qual vamos para uma se√ß√£o arbitr√°ria do c√≥digo. <br><br>  Abaixo, temos um predicado opaco muito simples.  Se voc√™ mantiver o valor Eax no postscript na instru√ß√£o superior, siga o operador XOR, para que o seu JZ pense: ‚ÄúOK, obviamente posso ir para a esquerda ou direita, acho melhor ir para a direita, porque existe 0‚Äù.  Em seguida, o POP EAX √© executado, seu EAX retorna, ap√≥s o qual a pr√≥xima instru√ß√£o √© processada e assim por diante. <br><br>  Obviamente, isso cria problemas muito maiores do que nossa estrat√©gia b√°sica, como efeitos residuais e a complica√ß√£o de gerar diferentes conjuntos de instru√ß√µes.  Portanto, ser√° muito dif√≠cil determinar como uma instru√ß√£o afeta outra.  Voc√™ pode jogar chinelos em mim, porque ainda n√£o terminei este programa incr√≠vel, mas pode acompanhar o progresso do desenvolvimento em meu blog. <br><br><img src="https://habrastorage.org/webt/c9/ce/el/c9ceelekpf6j1kv8f9x-qooiug8.jpeg"><br><br>  Observo que nossas f√≥rmulas f (x) n√£o precisam ser computadas iterativamente, por exemplo f (1), f (2), ... f (n).  Nada impede que eles sejam calculados aleatoriamente.  Se voc√™ for esperto, poder√° determinar quantas instru√ß√µes precisa e depois atribuir, por exemplo, f (27), f (54), f (9), e este ser√° o local em que suas instru√ß√µes ser√£o colocadas aleatoriamente.  Ao fazer isso, dependendo de como voc√™ escreveu seu c√≥digo, voc√™ pode interromp√™-lo antecipadamente, e o c√≥digo ainda vincular√° suas instru√ß√µes aleatoriamente. <br><br>  Se o seu c√≥digo for gerado com base em uma f√≥rmula previs√≠vel, o ponto de entrada tamb√©m √© previs√≠vel, para que voc√™ possa subir mais um n√≠vel antes de terminar de receber o c√≥digo e confundir significativamente o ponto de entrada em um grau ou outro.  Por exemplo, siga 300 instru√ß√µes de montagem provenientes de um √∫nico ponto de entrada. <br><br>  Agora vamos falar sobre as defici√™ncias. <br><br><img src="https://habrastorage.org/webt/2l/wp/7i/2lwp7iffr7n-s_mn-tdcztkkay8.jpeg"><br><br>  Esse m√©todo requer uma compila√ß√£o cuidadosa do c√≥digo, principalmente usando GCC ou, se Deus permitir, usando C ++.  C ++ √© na verdade uma linguagem bastante interessante por v√°rios motivos, mas voc√™ sabe que todos os compiladores s√£o p√©ssimos.  Portanto, o principal nesse assunto √© uma compila√ß√£o feita √† m√£o, porque se sua tentativa de confundir sua pr√≥pria assembl√©ia causar√° a aprova√ß√£o da quadrilha que inventou o worm Conficker, voc√™ estragou tudo. <br><br>  Voc√™ precisar√° de uma grande quantidade de mem√≥ria.  Lembre-se da imagem com ondas senoidais.  Vermelho √© o c√≥digo e azul √© a mem√≥ria necess√°ria para que ele funcione, e deve ser suficiente para que tudo funcione como deveria. <br><br>  Voc√™ provavelmente estar√° lidando com um conjunto de dados gigantesco depois de concluir o c√≥digo.  E aumentar√° significativamente se voc√™ quiser confundir mais de uma fun√ß√£o. <br><br>  Os ponteiros de fun√ß√£o se comportam de forma imprevis√≠vel - √†s vezes corretamente, √†s vezes n√£o.  Depende do que voc√™ est√° fazendo, e definitivamente haver√° um problema, porque voc√™ n√£o poder√° prever onde e quando o ponteiro da fun√ß√£o ser√° acionado em sua montagem. <br><br>  Quanto mais complicado voc√™ gerar ofusca√ß√£o e manipular a montagem no pre√¢mbulo e no postscript, mais dif√≠cil √© corrigir e depurar.  Portanto, escrever esse c√≥digo √© como equilibrar entre "ok, vou inserir cuidadosamente um ou dois JMPs aqui" e "como diabos posso descobrir tudo isso em pouco tempo"?  Ent√£o voc√™ s√≥ precisa inserir instru√ß√µes e depois descobrir por v√°rios meses o que fez. <br><br>  Espero que voc√™ tenha aprendido algo √∫til hoje.  Na minha opini√£o, fiquei muito b√™bado e, portanto, n√£o entendo o que aconteceu agora.  O pr√≥ximo slide mostra meus contatos no Twitter, meu blog e site, ent√£o me visite ou escreva. <br><br><img src="https://habrastorage.org/webt/l3/0j/ps/l30jpsxkmmgtsez-k-pxvr9vg70.jpeg"><br><br>  Isso √© tudo, obrigado por ter vindo! <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/y124L75ZKAc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Obrigado por ficar conosco.  Voc√™ gosta dos nossos artigos?  Deseja ver materiais mais interessantes?  Ajude-nos fazendo um pedido ou recomendando a seus amigos, um <b>desconto de 30% para os usu√°rios da Habr em um an√°logo exclusivo de servidores b√°sicos que inventamos para voc√™:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Toda a verdade sobre o VPS (KVM) E5-2650 v4 (6 n√∫cleos) 10GB DDR4 240GB SSD 1Gbps de US $ 20 ou como dividir o servidor?</a>  (as op√ß√µes est√£o dispon√≠veis com RAID1 e RAID10, at√© 24 n√∫cleos e at√© 40GB DDR4). <br><br>  <b>VPS (KVM) E5-2650 v4 (6 n√∫cleos) 10GB DDR4 240GB SSD de 1Gbps at√© janeiro de gra√ßa</b> quando pagar por um per√≠odo de seis meses, voc√™ pode fazer o pedido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  <b>Dell R730xd 2 vezes mais barato?</b>  Somente n√≥s temos <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">2 TVs Intel Dodeca-Core Xeon E5-2650v4 128GB DDR4 6x480GB SSD 1Gbps 100 a partir de US $ 249</a> na Holanda e nos EUA!</b>  Leia sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como criar um pr√©dio de infraestrutura.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">classe usando servidores Dell R730xd E5-2650 v4 custando 9.000 euros por um centavo?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt433280/">https://habr.com/ru/post/pt433280/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt433270/index.html">Solu√ß√£o de problemas do MapStruct com ManyToMany</a></li>
<li><a href="../pt433272/index.html">Entrevista com David Gobel</a></li>
<li><a href="../pt433274/index.html">Oleg Dokuka sobre desenvolvimento reativo em jug.msk.ru</a></li>
<li><a href="../pt433276/index.html">Sobre os benef√≠cios da incorpora√ß√£o de CSS em JS</a></li>
<li><a href="../pt433278/index.html">Programa√ß√£o de vento WebGL e GPU. Palestra no FrontTalks 2018</a></li>
<li><a href="../pt433282/index.html">Gateways de protocolos de troca industrial no Linux. Monte-se</a></li>
<li><a href="../pt433286/index.html">10 reuni√µes de TI e hackers mais pr√≥ximos em Moscou</a></li>
<li><a href="../pt433288/index.html">Seguran√ßa na Web: Introdu√ß√£o ao HTTP</a></li>
<li><a href="../pt433292/index.html">O resumo de materiais interessantes para o desenvolvedor m√≥vel n¬∫ 279 (de 10 a 16 de dezembro)</a></li>
<li><a href="../pt433294/index.html">Algumas recomenda√ß√µes simples para o trabalho em equipe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>