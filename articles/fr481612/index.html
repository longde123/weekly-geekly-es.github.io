<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∞ üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® üßíüèø Notre petite contribution √† la lutte d'Avalonia UI pour moins de plateformes üòô üëáüèª üßóüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article est une revue des bogues trouv√©s dans le projet d'interface utilisateur Avalonia avec l'analyseur statique PVS-Studio. Avalonia UI est un ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Notre petite contribution √† la lutte d'Avalonia UI pour moins de plateformes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/481612/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e34/9b1/06a/e349b106a7c1d3ea775353520b20cd91.png" alt="Figure 2"></div><br>  Cet article est une revue des bogues trouv√©s dans le projet d'interface utilisateur Avalonia avec l'analyseur statique PVS-Studio.  Avalonia UI est un framework UI multiplateforme open source bas√© sur XAML.  Il s'agit de l'un des projets les plus importants sur le plan technologique de l'histoire de .NET car il permet aux d√©veloppeurs de cr√©er des interfaces multiplateformes bas√©es sur le syst√®me WPF.  Nous esp√©rons que les auteurs du projet trouveront cet article utile pour corriger certains bogues et suffisamment convaincant pour int√©grer l'analyse statique √† leur processus de d√©veloppement. <br><a name="habracut"></a><br><h2>  √Ä propos d'Avalonia UI </h2><br>  L'interface utilisateur d'Avalonia (pr√©c√©demment connue sous le nom de Perspex) permet aux d√©veloppeurs de cr√©er des interfaces utilisateur pouvant s'ex√©cuter sur Windows, Linux et MacOS.  En tant que fonctionnalit√© exp√©rimentale, il prend √©galement en charge Android et iOS.  Avalonia UI n'est pas un wrapper autour d'autres wrappers, comme Xamarin Forms, qui encapsule les wrappers Xamarin, mais acc√®de directement √† l'API native.  En regardant l'une des vid√©os de d√©monstration, j'ai √©t√© √©tonn√© d'apprendre que vous pouvez sortir un contr√¥le sur la console Debian.  De plus, gr√¢ce √† l'utilisation du langage de balisage XAML, Avalonia UI offre plus de capacit√©s de conception et de mise en page par rapport √† d'autres constructeurs d'interface utilisateur. <br><br>  Pour ne citer que quelques exemples, Avalonia UI est utilis√© dans <a href="https://github.com/VitalElement/AvalonStudio">AvalonStudio</a> (un IDE multiplateforme pour le d√©veloppement de logiciels C # et C / C ++) et <a href="https://github.com/wieslawsoltes/Core2D">Core2D</a> (un √©diteur de diagramme 2D).  <a href="https://wasabiwallet.io/">Wasabi Wallet</a> (un portefeuille bitcoin) est un exemple de logiciel commercial qui utilise l'interface utilisateur d'Avalonia. <br><br>  La lutte contre la n√©cessit√© de conserver un tas de biblioth√®ques lors de la cr√©ation d'une application multiplateforme est extr√™mement importante.  Nous voulions aider les auteurs d'Avalonia UI avec cela, alors j'ai t√©l√©charg√© le code source du projet et l'ai v√©rifi√© avec notre analyseur.  J'esp√®re qu'ils verront cet article et apporteront les correctifs sugg√©r√©s et commenceront m√™me √† utiliser r√©guli√®rement l'analyse statique dans le cadre de leur processus de d√©veloppement.  Cela peut √™tre facilement r√©alis√© gr√¢ce √† l'option de licence gratuite PVS-Studio disponible pour les d√©veloppeurs open source.  L'utilisation r√©guli√®re de l'analyse statique permet d'√©viter de nombreux probl√®mes et de rendre la d√©tection et la correction des bogues beaucoup moins ch√®res. <br><br><h2>  R√©sultats d'analyse </h2><br>  <b>Message de diagnostic de PVS-Studio: <a href="https://www.viva64.com/en/w/v3001/">V3001</a></b> Il existe des sous-expressions identiques 'controllFlags' √† gauche et √† droite de l'op√©rateur '^'.  WindowImpl.cs 975TwitterClientMessageHandler.cs 52 <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateWMStyles</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action change</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> style = (WindowStyles)GetWindowLong(....); .... style = style | controlledFlags ^ controlledFlags; .... }</code> </pre> <br>  Pour ajouter du symbolisme, commen√ßons par notre premier diagnostic C #.  L'analyseur a d√©tect√© une expression √©trange avec l'op√©rateur OR au niveau du bit.  Permettez-moi d'expliquer cela en utilisant des nombres: <br><br>  l'expression <br><br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">1100</span></span> <span class="hljs-number"><span class="hljs-number">0011</span></span> | <span class="hljs-number"><span class="hljs-number">1111</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> ^ <span class="hljs-number"><span class="hljs-number">1111</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span></code> </pre> <br>  est √©quivalent √† <br><br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">1100</span></span> <span class="hljs-number"><span class="hljs-number">0011</span></span> | <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span></code> </pre> <br>  La priorit√© du OU exclusif ("^") est sup√©rieure √† celle du OU au niveau du bit ("|").  Le programmeur n'avait probablement pas l'intention de cette commande.  Le code peut √™tre corrig√© en mettant la premi√®re expression entre parenth√®ses: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateWMStyles</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action change</span></span></span><span class="hljs-function">)</span></span> { .... style = (style | controlledFlags) ^ controlledFlags; .... }</code> </pre> <br>  Quant aux deux prochains avertissements, je dois admettre: ce sont des faux positifs.  Vous voyez, les d√©veloppeurs utilisent l'API publique de la m√©thode <i>TransformToVisual</i> .  Dans ce cas, <i>VisualRoot</i> est toujours un √©l√©ment parent de <i>visual</i> .  Je n'ai pas compris cela lors de l'examen de l'avertissement;  ce n'est qu'apr√®s avoir termin√© l'article que l'un des auteurs du projet m'en a parl√©.  Par cons√©quent, les correctifs sugg√©r√©s ci-dessous visent en fait √† prot√©ger le code contre des modifications potentielles brisant cette logique plut√¥t qu'un plantage r√©el. <br><br>  <b>Message de diagnostic PVS-Studio: <a href="https://www.viva64.com/en/w/v3080/">V3080 D√©r√©f√©rence</a></b> nulle possible de la valeur de retour de la m√©thode.  Pensez √† inspecter: TranslatePoint (...).  VisualExtensions.cs 23 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Point </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PointToClient</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IVisual visual, PixelPoint point</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rootPoint = visual.VisualRoot.PointToClient(point); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> visual.VisualRoot.TranslatePoint(rootPoint, visual).Value; }</code> </pre> <br>  Cette m√©thode est petite.  L'analyseur estime que la d√©r√©f√©rence de la valeur renvoy√©e par l'appel de <i>TranslatePoint</i> n'est pas s√ªre.  Jetons un ≈ìil √† cette m√©thode: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Point? TranslatePoint(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> IVisual visual, Point point, IVisual relativeTo) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> transform = visual.TransformToVisual(relativeTo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (transform.HasValue) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> point.Transform(transform.Value); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br>  En effet, il pourrait retourner <i>null</i> . <br><br>  Cette m√©thode est appel√©e six fois: trois fois avec une v√©rification de la valeur renvoy√©e et les trois autres sans v√©rification, d√©clenchant ainsi l'avertissement concernant une √©ventuelle d√©r√©f√©rence.  Le premier est celui ci-dessus, et voici les deux autres: <br><br><ul><li>  <a href="https://www.viva64.com/en/w/v3080/">V3080 D√©r√©f√©rence</a> nulle possible.  Pensez √† inspecter ¬´p¬ª.  VisualExtensions.cs 35 </li><li>  <a href="https://www.viva64.com/en/w/v3080/">V3080 D√©r√©f√©rence</a> nulle possible.  Pensez √† inspecter ¬´controlPoint¬ª.  Scene.cs 176 </li></ul><br>  Je sugg√®re de corriger ces bogues en suivant le mod√®le utilis√© dans les versions s√ªres, c'est-√†-dire en ajoutant une <i>v√©rification Nullable &lt;Struct&gt; .HasValue</i> √† l'int√©rieur de la m√©thode <i>PointToClient</i> : <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Point </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PointToClient</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IVisual visual, PixelPoint point</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rootPoint = visual.VisualRoot.PointToClient(point); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rootPoint.HasValue) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> visual.VisualRoot.TranslatePoint(rootPoint, visual).Value; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> ....; }</code> </pre> <br>  <b>Message de diagnostic PVS-Studio:</b> <a href="https://www.viva64.com/en/w/v3080/">V3080 D√©r√©f√©rence</a> nulle possible de la valeur de retour de la m√©thode.  Pensez √† inspecter: TransformToVisual (...).  ViewportManager.cs 381 <br><br>  Ce bug est tr√®s similaire au pr√©c√©dent: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEffectiveViewportChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TransformedBounds? bounds</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> transform = _owner.GetVisualRoot().TransformToVisual(_owner).Value; .... }</code> </pre> <br>  Voici le code de la m√©thode <i>TransformToVisual</i> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Matrix? TransformToVisual(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> IVisual <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, IVisual to) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> common = <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.FindCommonVisualAncestor(to); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (common != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br>  Par ailleurs, la m√©thode <i>FindCommonVisualAncestor</i> peut en effet retourner <i>null</i> comme valeur par d√©faut pour les types de r√©f√©rence: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IVisual </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindCommonVisualAncestor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IVisual visual, IVisual target</span></span></span><span class="hljs-function">)</span></span> { Contract.Requires&lt;ArgumentNullException&gt;(visual != <span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ....FirstOrDefault(); }</code> </pre> <br>  La m√©thode <i>TransformToVisual</i> est appel√©e neuf fois, avec seulement sept v√©rifications.  Le premier appel avec d√©r√©f√©rence non s√©curis√©e est celui ci-dessus, et voici le second: <br><br>  <a href="https://www.viva64.com/en/w/v3080/">V3080 D√©r√©f√©rence</a> nulle possible.  Pensez √† inspecter ¬´transformer¬ª.  MouseDevice.cs 80 <br><br>  <b>Message de diagnostic PVS-Studio: <a href="https://www.viva64.com/en/w/v3022/">V3022 L'</a></b> expression est toujours vraie.  L'op√©rateur '&amp;&amp;' devrait probablement √™tre utilis√© ici.  NavigationDirection.cs 89 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsDirectional</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> NavigationDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> direction &gt; NavigationDirection.Previous || direction &lt;= NavigationDirection.PageDown; }</code> </pre> <br>  Cette v√©rification est √©trange.  L'√©num√©ration <i>NavigationDirection</i> contient 9 types, le type <i>PageDown</i> √©tant le dernier.  Peut-√™tre que cela n'a pas toujours √©t√© ainsi, ou peut-√™tre que c'est une protection contre l'ajout soudain de nouvelles options de direction.  √Ä mon avis, le premier contr√¥le devrait suffire.  Quoi qu'il en soit, laissons cela aux auteurs pour d√©cider. <br><br>  <b>Message de diagnostic PVS-Studio:</b> <a href="https://www.viva64.com/en/w/v3066/">V3066</a> Ordre incorrect possible des arguments transmis au constructeur 'SelectionChangedEventArgs': 'removeSelectedItems' et 'addedSelectedItems'.  DataGridSelectedItemsCollection.cs 338 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> SelectionChangedEventArgs </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSelectionChangedEventArgs</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SelectionChangedEventArgs (DataGrid.SelectionChangedEvent, removedSelectedItems, addedSelectedItems) { Source = OwningGrid }; }</code> </pre> <br>  L'analyseur met en garde contre le mauvais ordre des deuxi√®me et troisi√®me arguments du constructeur.  Jetons un coup d'≈ìil √† ce constructeur: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SelectionChangedEventArgs</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">RoutedEvent routedEvent, IList addedItems, IList removedItems</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">routedEvent</span></span></span><span class="hljs-function">)</span></span> { AddedItems = addedItems; RemovedItems = removedItems; }</code> </pre> <br>  Il prend deux conteneurs de type <i>IList</i> comme arguments, ce qui facilite leur √©criture dans le mauvais ordre.  Un commentaire au d√©but de la classe sugg√®re qu'il s'agit d'une erreur dans le code du contr√¥le emprunt√© √† Microsoft et modifi√© pour une utilisation dans Avalonia.  Mais j'insisterais toujours sur la correction de l'ordre des arguments, ne serait-ce que pour √©viter d'obtenir un rapport de bogue dessus et perdre du temps √† chercher un bogue dans votre propre code. <br><br>  Il y avait trois autres erreurs de ce type: <br><br>  <b>Message de diagnostic PVS-Studio:</b> <a href="https://www.viva64.com/en/w/v3066/">V3066</a> Ordre incorrect possible des arguments pass√©s au constructeur 'SelectionChangedEventArgs': 'supprim√©' et 'ajout√©'.  AutoCompleteBox.cs 707 <br><br><pre> <code class="cs hljs">OnSelectionChanged(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SelectionChangedEventArgs(SelectionChangedEvent, removed, added));</code> </pre> <br>  C'est le m√™me constructeur <i>SelectionChangedEventArgs.</i> <br><br>  <b>Messages de diagnostic PVS-Studio</b> <a href="https://www.viva64.com/en/w/v3066/">V3066</a> : <ul><li>  Ordre incorrect possible des arguments pass√©s au constructeur ¬´ItemsRepeaterElementIndexChangedEventArgs¬ª: ¬´oldIndex¬ª et ¬´newIndex¬ª.  ItemsRepeater.cs 532 </li><li>  Ordre incorrect possible des arguments pass√©s √† la m√©thode ¬´Update¬ª: ¬´oldIndex¬ª et ¬´newIndex¬ª.  ItemsRepeater.cs 536 </li></ul><br>  Deux avertissements sur une m√©thode d'appel d'√©v√©nement. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnElementIndexChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IControl element, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> oldIndex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newIndex</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ElementIndexChanged != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_elementIndexChangedArgs == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _elementIndexChangedArgs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ItemsRepeaterElementIndexChangedEventArgs(element, oldIndex, newIndex); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _elementIndexChangedArgs.Update(element, oldIndex, newIndex); } ..... } }</code> </pre> <br>  L'analyseur a remarqu√© que les arguments <i>oldIndex</i> et <i>newIndex</i> sont √©crits dans un ordre diff√©rent dans les deux m√©thodes <i>ItemsRepeaterElementIndexChangedEventArgs</i> et <i>Update</i> : <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ItemsRepeaterElementIndexChangedEventArgs</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> IControl element, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newIndex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> oldIndex</span></span></span><span class="hljs-function">)</span></span> { Element = element; NewIndex = newIndex; OldIndex = oldIndex; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IControl element, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newIndex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> oldIndex</span></span></span><span class="hljs-function">)</span></span> { Element = element; NewIndex = newIndex; OldIndex = oldIndex; }</code> </pre> <br>  Peut-√™tre que ce code a √©t√© √©crit par diff√©rents programmeurs, dont l'un √©tait plus int√©ress√© par le pass√© et l'autre √† l'avenir :) <br><br>  Tout comme le num√©ro pr√©c√©dent, celui-ci n'appelle pas √† une correction imm√©diate;  il reste √† d√©terminer si ce code est r√©ellement d√©fectueux. <br><br>  <b>Message de diagnostic PVS-Studio:</b> <a href="https://www.viva64.com/en/w/v3004/">V3004</a> L' <a href="https://www.viva64.com/en/w/v3004/">instruction</a> 'then' est √©quivalente √† l'instruction 'else'.  DataGridSortDescription.cs 235 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IOrderedEnumerable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ThenBy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IOrderedEnumerable&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; seq</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_descending) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> seq.ThenByDescending(o =&gt; GetValue(o), InternalComparer); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> seq.ThenByDescending(o =&gt; GetValue(o), InternalComparer); } }</code> </pre> <br>  Il s'agit d'une impl√©mentation assez curieuse de la m√©thode <i>ThenBy</i> .  L'interface <i>IEnumerable</i> , dont h√©rite l'argument <i>seq</i> , contient la m√©thode <i>ThenBy</i> , qui √©tait apparemment destin√©e √† √™tre utilis√©e de la mani√®re suivante: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IOrderedEnumerable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ThenBy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IOrderedEnumerable&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; seq</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_descending) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> seq.ThenByDescending(o =&gt; GetValue(o), InternalComparer); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> seq.ThenBy(o =&gt; GetValue(o), InternalComparer); } }</code> </pre> <br>  <b>Message de diagnostic PVS-Studio:</b> <a href="https://www.viva64.com/en/w/v3106/">V3106</a> Valeur d'index n√©gative possible.  La valeur de l'indice ¬´index¬ª pourrait atteindre -1.  Animator.cs 68 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InterpolationHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> animationTime, T neutralValue</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (kvCount &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (animationTime &lt;= <span class="hljs-number"><span class="hljs-number">0.0</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (animationTime &gt;= <span class="hljs-number"><span class="hljs-number">1.0</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = FindClosestBeforeKeyFrame(animationTime); firstKeyframe = _convertedKeyframes[index]; } .... } .... }</code> </pre> <br>  L'analyseur est s√ªr que la variable d' <i>index</i> peut se retrouver avec la valeur -1.  Cette variable se voit attribuer la valeur renvoy√©e par la m√©thode <i>FindClosestBeforeKeyFrame</i> , alors examinons-la: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindClosestBeforeKeyFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> time</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; _convertedKeyframes.Count; i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_convertedKeyframes[i].Cue.CueValue &gt; time) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Index time is out of keyframe time range."</span></span>); }</code> </pre> <br>  Comme vous pouvez le voir, la boucle contient une condition suivie d'une instruction return retournant la valeur pr√©c√©dente de l'it√©rateur.  Il est difficile de v√©rifier si cette condition est vraie, et je ne peux pas dire avec certitude quelle valeur <i>CueValue</i> aura, mais la description sugg√®re qu'elle prend une valeur de 0,0 √† 1,0.  Mais nous pouvons encore dire quelques mots sur le <i>temps</i> : c'est la variable <i>animationTime</i> pass√©e √† la m√©thode appelante, et elle est nettement sup√©rieure √† z√©ro et inf√©rieure √† un.  S'il n'en √©tait pas ainsi, l'ex√©cution suivrait une branche diff√©rente.  Si ces m√©thodes sont utilis√©es pour l'animation, cette situation ressemble beaucoup √† un Heisenbug d√©cent.  Je recommande de v√©rifier la valeur renvoy√©e par <i>FindClosestBeforeKeyFrame</i> si ce cas n√©cessite un traitement sp√©cial ou de supprimer le premier √©l√©ment de la boucle s'il ne remplit pas d'autres conditions.  Je ne sais pas exactement comment tout cela devrait fonctionner, alors je choisirais la deuxi√®me solution comme exemple: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindClosestBeforeKeyFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> time</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; _convertedKeyframes.Count; i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_convertedKeyframes[i].Cue.CueValue &gt; time) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Index time is out of keyframe time range."</span></span>); }</code> </pre> <br>  <b>Message de diagnostic PVS-Studio: le</b> param√®tre de constructeur <a href="https://www.viva64.com/en/w/v3117/">V3117</a> 't√©l√©phones' n'est pas utilis√©.  Country.cs 25 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Country</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> region, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> population, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> area, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> density, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> coast, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">? migration, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">? infantMorality, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gdp, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">? literacy, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">? phones, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">? birth, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">? death</span></span></span><span class="hljs-function">)</span></span> { Name = name; Region = region; Population = population; Area = area; PopulationDensity = density; CoastLine = coast; NetMigration = migration; InfantMortality = infantMorality; GDP = gdp; LiteracyPercent = literacy; BirthRate = birth; DeathRate = death; }</code> </pre> <br>  C'est un bon exemple de la fa√ßon dont l'analyse statique est meilleure que les revues de code.  Le constructeur est appel√© avec treize arguments, dont l'un n'est pas utilis√©.  En fait, Visual Studio pourrait √©galement le d√©tecter, mais uniquement √† l'aide de diagnostics de troisi√®me niveau (qui sont souvent d√©sactiv√©s).  Nous avons certainement affaire √† un bogue ici parce que la classe contient √©galement treize propri√©t√©s - une par argument - mais il n'y a aucune affectation √† la variable <i>Phones</i> .  √âtant donn√© que le correctif est √©vident, je ne l'expliquerai pas. <br><br>  <b>Message de diagnostic PVS-Studio:</b> <a href="https://www.viva64.com/en/w/v3080/">V3080 D√©r√©f√©rence</a> nulle possible.  Pensez √† inspecter ¬´tabItem¬ª.  TabItemContainerGenerator.cs 22 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IControl </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateContainer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> item</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tabItem = (TabItem)<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.CreateContainer(item); tabItem.ParentTabControl = Owner; .... }</code> </pre> <br>  L'analyseur consid√®re que la d√©r√©f√©rence de la valeur renvoy√©e par la m√©thode <i>CreateContainer n'est</i> pas s√ªre.  Jetons un ≈ìil √† cette m√©thode: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IControl </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateContainer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> item</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> container = item <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> T; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (container != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> container; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } }</code> </pre> <br>  PVS-Studio peut suivre une affectation de <i>null</i> m√™me √† travers une cha√Æne de cinquante m√©thodes, mais il ne peut pas dire si l'ex√©cution suivra jamais cette branche.  Je ne pouvais pas non plus, d'ailleurs ... Les appels sont perdus parmi les m√©thodes surcharg√©es et virtuelles, donc je sugg√®re simplement d'√©crire un ch√®que suppl√©mentaire au cas o√π: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IControl </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateContainer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> item</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tabItem = (TabItem)<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.CreateContainer(item); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(tabItem == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; tabItem.ParentTabControl = Owner; .... }</code> </pre> <br>  <b>Message de diagnostic PVS-Studio:</b> V3142 Code inaccessible d√©tect√©.  Il est possible qu'une erreur soit pr√©sente.  DevTools.xaml.cs 91 <br><br>  Il ne sert √† rien de citer trop de code pour maintenir le suspense;  Je vais vous le dire tout de suite: cet avertissement est un faux positif.  L'analyseur a d√©tect√© un appel de la m√©thode qui l√®ve une exception inconditionnelle: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XamlLoadException(<span class="hljs-string"><span class="hljs-string">$"No precompiled XAML found for </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{obj.GetType()}</span></span></span><span class="hljs-string">, make sure to specify x:Class and include your XAML file as AvaloniaResource"</span></span>); }</code> </pre> <br>  Trente-cinq (!) Avertissements concernant le code inaccessible suite aux appels √† cette m√©thode √©taient trop √† ignorer, j'ai donc demand√© √† l'un des d√©veloppeurs ce qui se passait ici.  Il m'a dit qu'ils utilisaient une technique, o√π vous remplacez les appels √† une m√©thode par des appels √† d'autres m√©thodes √† l'aide de la biblioth√®que <a href="https://www.mono-project.com/docs/">Mono.Cecil</a> .  Cette biblioth√®que vous permet de remplacer les appels directement dans le code IL. <br><br>  Notre analyseur ne prend pas en charge cette biblioth√®que, d'o√π l'√©norme quantit√© de faux positifs.  Cela signifie que ce diagnostic doit √™tre d√©sactiv√© lors de la v√©rification de l'interface utilisateur d'Avalonia.  C'est un peu g√™nant, mais je dois avouer que c'est moi qui ai fait ce diagnostic ... Mais, comme tout autre outil, un analyseur statique a besoin d'un r√©glage fin. <br><br>  Par exemple, nous travaillons actuellement sur un diagnostic d√©tectant les conversions de type non s√©curis√©es.  Il produit environ mille faux positifs sur un projet de jeu o√π la v√©rification de type est effectu√©e du c√¥t√© du moteur. <br><br>  <b>Message de diagnostic PVS-Studio:</b> <a href="https://www.viva64.com/en/w/v3009/">V3009</a> Il est √©trange que cette m√©thode renvoie toujours une seule et m√™me valeur de ¬´vrai¬ª.  DataGridRows.cs 412 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ScrollSlotIntoView</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> slot, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> scrolledHorizontally</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DisplayData.FirstScrollingSlot &lt; slot &amp;&amp; DisplayData.LastScrollingSlot &gt; slot) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DisplayData.FirstScrollingSlot == slot &amp;&amp; slot != <span class="hljs-number"><span class="hljs-number">-1</span></span>) { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } .... } .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  La m√©thode renvoie <i>vrai</i> tout le temps.  Peut-√™tre que son objectif a chang√© depuis sa premi√®re √©criture, mais il ressemble plus √† un bug.  A en juger par le commentaire du d√©but de la classe, il s'agit d'une autre classe de contr√¥le emprunt√©e √† Microsoft.  Si vous me demandez, <i>DataGrid</i> est l'un des contr√¥les les moins stables, donc ce n'est peut-√™tre pas une bonne id√©e de confirmer le d√©filement lorsqu'il ne remplit pas les conditions. <br><br><h2>  Conclusion </h2><br>  Certains des bogues d√©crits ci-dessus ont √©t√© emprunt√©s avec le code copi√© √† partir des contr√¥les WPF, et les auteurs d'Avalonia UI n'ont rien √† voir avec eux.  Mais cela ne fait aucune diff√©rence pour l'utilisateur: une interface qui plante ou qui glisse laisse une mauvaise impression de la qualit√© globale du programme. <br><br>  J'ai mentionn√© la n√©cessit√© de r√©gler finement l'analyseur: les faux positifs sont tout simplement in√©vitables en raison des principes de fonctionnement des algorithmes d'analyse statique.  Ceux qui connaissent le <a href="https://en.wikipedia.org/wiki/Halting_problem">probl√®me de</a> l' <a href="https://en.wikipedia.org/wiki/Halting_problem">arr√™t</a> savent qu'il existe des contraintes math√©matiques dans le traitement d'un morceau de code avec un autre.  Dans ce cas, cependant, nous parlons de d√©sactiver un diagnostic sur pr√®s de cent et demi.  Il n'y a donc pas de probl√®me de perte de sens dans le cas de l'analyse statique.  En outre, ce diagnostic pourrait √©galement produire des avertissements pointant vers de v√©ritables bogues, mais ceux-ci seraient difficiles √† remarquer parmi des tonnes de faux positifs. <br><br>  Je dois mentionner la qualit√© remarquable du projet d'interface utilisateur Avalonia!  J'esp√®re que les d√©veloppeurs continueront ainsi.  Malheureusement, le nombre de bogues augmente in√©vitablement avec la taille du programme.  Un r√©glage fin et sage des syst√®mes CI \ CD, soutenu par une analyse statique et dynamique, est l'un des moyens de garder les bogues √† distance.  Et si vous voulez faciliter le d√©veloppement de grands projets et passer moins de temps √† d√©boguer, <a href="https://www.viva64.com/en/pvs-studio-download/">t√©l√©chargez et essayez</a> PVS-Studio! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr481612/">https://habr.com/ru/post/fr481612/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr481598/index.html">Une petite contribution √† la lutte contre les plateformes de zoo Avalonia UI</a></li>
<li><a href="../fr481600/index.html">Moteur Wiki Bonsai Family: R√©sultats 2019</a></li>
<li><a href="../fr481604/index.html">Comment les d√©veloppeurs de Chelyabinsk durs cr√©ent des jeux pour Google Play et les r√©seaux sociaux</a></li>
<li><a href="../fr481606/index.html">Abonnement statique √† l'aide du mod√®le Observer √† l'aide de C ++ et du microcontr√¥leur Cortex M4</a></li>
<li><a href="../fr481610/index.html">PostgreSQL Antipatterns: mise √† jour d'une grande table en charge</a></li>
<li><a href="../fr481616/index.html">D√¥me g√©od√©sique. √Ä propos de l'appareil et mon exp√©rience des calculs</a></li>
<li><a href="../fr481618/index.html">MVP dans Unity ou comment simplifier la vie</a></li>
<li><a href="../fr481620/index.html">Juniper SRX et Cisco ASA: nouvelle s√©rie</a></li>
<li><a href="../fr481624/index.html">√âcrire une application sur Flutter en collaboration avec Redux</a></li>
<li><a href="../fr481626/index.html">Collections d'affichage complexes dans iOS: probl√®mes et solutions sur l'exemple du flux VKontakte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>