<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêΩ üë∂ ‚§µÔ∏è Contournement de ReCaptcha dans les tests au s√©l√©nium üó≥Ô∏è üîí üåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ReCaptcha (c'est le ¬´captcha¬ª bien-aim√©) est l'une des choses les plus douloureuses qu'un automate de test peut rencontrer sur son chemin. Des millier...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Contournement de ReCaptcha dans les tests au s√©l√©nium</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442034/"> <b>ReCaptcha</b> (c'est le <b>¬´captcha¬ª</b> bien-aim√©) est l'une des choses les plus douloureuses qu'un automate de test peut rencontrer sur son chemin.  Des milliers de vid√©os enregistr√©es par des immigrants de l'Inde ensoleill√©e se prom√®nent sur le Web concernant ce qui danse avec un tambourin, il est possible de tromper cette b√™te.  En effet, il est assez difficile d'essayer d'interagir avec les scripts programm√©s avec une chose dont le but principal est de s'assurer que "vous n'√™tes pas un robot". <br><br>  Un avertissement tr√®s important: <b>il est impossible de tromper un captcha.</b> <br><br>  Si vous avez d√©j√† rencontr√© ce probl√®me et que vous lisez cet article en essayant de rechercher une recette de panac√©e sur Google, sachez qu'il n'existe pas.  De plus, dans votre t√™te, des id√©es innovantes sont probablement apparues concernant la simulation d'un comportement utilisateur r√©aliste √† l'aide de WebDriver, en survolant des √©l√©ments au hasard, en cliquant sur des entr√©es et en pla√ßant Thread.sleep () soigneusement plac√©.  Il est absolument connu que cette approche ne fonctionnera pas, ne perdez pas votre temps en vain. <br><br><img src="https://www.scienceabc.com/wp-content/uploads/2016/07/Captcha-meme.jpg" alt="image"><br><br>  <i>Il s'av√®re qu'il n'y a pas d'issue?</i> <br><a name="habracut"></a><br>  Tout n'est pas si pessimiste.  Parfois, il suffit d‚Äôessayer de vous donner la r√©ponse la plus pr√©cise √† la question "Quel est le d√©fi auquel je suis confront√©?"  et regarder la situation plus large.  Dans la plupart des cas, vous comprendrez que votre objectif n'est pas de tromper le captcha, mais de le contourner afin de tester la fonctionnalit√© cach√©e derri√®re lui.  Sur l'exemple de mon cas, je partagerai avec vous les options que j'ai trouv√©es pour r√©soudre la t√¢che. <br><br>  Contexte: nous avons int√©gr√© une partie de notre produit dans un service tiers, et voulions v√©rifier si tout allait bien de leur c√¥t√©, car  ils ne couvrent pas les parties tierces de leur plateforme.  Pour acc√©der √† nos fonctionnalit√©s, vous devez d'abord vous connecter.  C'est alors que j'ai rencontr√© le captcha face √† face.  Ensuite, je donne toutes les options que j'ai essay√©es pour contourner ce probl√®me. <br><hr><br><h2>  Ne travaille pas </h2><br><h3>  Connectez-vous via Google ou Facebook </h3><br>  En plus de l'authentification classique, il y avait une connexion canonique avec Google / Facebook.  Bien s√ªr, leur "captcha" y √©tait √©galement pr√©sent, donc cette option n'a pas aid√© √† r√©soudre le probl√®me. <br><br><h3>  Simuler le comportement des utilisateurs </h3><br>  Oui, je l'ai essay√© aussi.  C'√©tait dr√¥le, mais trop na√Øf. <br><br><hr><br><h2>  Les travailleurs </h2><br><h3>  Profils Chrome / Firefox </h3><br>  Parlons de la premi√®re option "live".  Les pilotes de ces navigateurs (chromedriver / geckodriver) ont la possibilit√© de d√©marrer sous un profil utilisateur pr√©d√©fini.  Il stocke tous les mots de passe, cookies, sessions et m√™me l'historique et les signets du navigateur.  C'est-√†-dire  ainsi, nous avons simplement rat√© l'√©tape de connexion qui est absolument sans importance pour notre t√¢che, et nous sommes donc arriv√©s directement √† la page avec l'objet de test.  Il est impl√©ment√© comme suit: <br><br><ol><li>  Cr√©ez un profil de navigateur ¬´propre¬ª </li><li>  Entrez manuellement le captcha et connectez-vous √† la ressource souhait√©e </li><li>  Copiez le profil requis dans notre projet (HOWTO pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Firefox</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chrome</a> ) </li></ol><br>  Apr√®s cela, nous devons dire au pilote qu'il doit √™tre charg√© √† partir du profil sp√©cifi√©: <br><br>  <b><u>Firefox:</u></b> <br><br><pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//   FirefoxProfile profile = new FirefoxProfile(new File("////")); //      FirefoxOptions options = new FirefoxOptions(); options.setProfile(profile); //   WebDriver driver = new FirefoxDriver(options);</span></span></code> </pre> <br>  <b><u>Chrome:</u></b> <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//      ChromeOptions options = new ChromeOptions(); options.addArgument("--user-data-dir=/////"); options.addArgument("--profile-directory=____"); //   WebDriver driver = new ChromeDriver(options);</span></span></code> </pre><br>  Cette approche s'est av√©r√©e bonne lors des tests sur une machine locale avec un navigateur install√© et les gecko- / cromedrivers habituels, mais il y avait des probl√®mes lors de l'ex√©cution sur Jenkins.  Nous augmentons le concentrateur et les n≈ìuds Selenium √† l'int√©rieur du cluster Kubernetes, nous avons donc rencontr√© des probl√®mes sous la forme d'un r√©pertoire trop long pour monter le r√©pertoire √† l'int√©rieur du conteneur (un profil propre p√®se environ 25 Mo en moyenne, ce qui est beaucoup), ainsi que certains probl√®mes avec les droits CRUD du navigateur, qui n'a pas pu apporter de modifications au profil lors de l'ex√©cution et est tomb√© avec une ex√©cution ¬´erreur inconnue: √©chec d'√©criture du fichier prefs¬ª.  De plus, la mise √† jour du profil apr√®s que les cookies et les sessions ont atteint leurs dates d'expiration est assez g√™nante, et je ne voulais pas garder un √©norme dossier avec les profils internes dans le projet, donc l'option suivante a finalement √©t√© choisie. <br><br><h3>  Les cookies </h3><br>  ¬´Et la bo√Æte vient de s'ouvrir¬ª - c'est ainsi qu'il a √©t√© possible de d√©crire la situation, apr√®s avoir simplement ajout√© les cookies re√ßus manuellement au conducteur.  L'algorithme d'actions est aussi simple que possible et ne d√©pend pas du navigateur s√©lectionn√©: <br><br><ol><li>  Connectez-vous manuellement </li><li>  √Ä travers le r√©seau, nous recherchons les en-t√™tes de demande -&gt; les cookies que notre navigateur envoie </li></ol><br>  Ajoutez-les √† nos tests comme suit: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//  cookie private static final Cookie COOKIE = new Cookie("", "", "", "", new Date("")); //   WebDriver driver = new ChromeDriver(options); //  cookie   driver.manage().addCookie(COOKIE);</span></span></code> </pre><br>  Le inconv√©nient √©vident de cette approche est la n√©cessit√© de changer manuellement les cookies apr√®s l'expiration de leur p√©riode de validit√©.  Mais, comme cette p√©riode est de 3 mois sur la plateforme test√©e, nous avons choisi cette solution. <br><br><hr><br><h2>  Et si je n'ai pas besoin de me connecter? </h2><br><br>  Mais qu'en est-il de la situation quand il ne s'agit pas d'autorisation et de sessions, mais de la commission d'une action ponctuelle (par exemple passer une commande dans le panier, enregistrer un nouvel utilisateur, etc.)?  Ici, la situation est encore pire.  Deux options que j'ai pu trouver sont: <br><br><ol><li>  Convenez avec vos d√©veloppeurs pour vous fournir une sorte de solution de contournement.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Google offre une telle opportunit√©</a> , mais n'oubliez pas que vous faites consciemment une petite faille dans la s√©curit√©. </li><li>  Profitez des services payants tiers qui prennent une capture d'√©cran captcha de votre part, essayez de la d√©coder et de vous envoyer une valeur d√©crypt√©e.  Je n'ai moi-m√™me pas essay√© cette m√©thode et je ne peux pas la recommander pleinement. </li></ol><br><hr><br><h2>  Pour r√©sumer </h2><br>  Comme vous pouvez le voir, il n'y a pas de situations d√©sesp√©r√©es.  Cependant, il serait stupide de nier qu'absolument toutes les options ci-dessus ont leurs propres inconv√©nients, assez importants, donc le choix vous appartient. <br><br>  Merci de votre attention. <br><br>  PS Si vous connaissez d'autres solutions qui fonctionnent dans la vie r√©elle - veuillez les d√©crire dans les commentaires, ce sera tr√®s int√©ressant √† lire. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr442034/">https://habr.com/ru/post/fr442034/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr442022/index.html">Conception sur CodeFest. Mais ce n'est pas s√ªr</a></li>
<li><a href="../fr442024/index.html">Une strat√©gie nationale d'intelligence artificielle est en cours de cr√©ation en Russie</a></li>
<li><a href="../fr442026/index.html">Trojan.Multi.BroSubsc.gen - Kaspersky fonctionne</a></li>
<li><a href="../fr442028/index.html">St√©ro√Ødes de carri√®re. Samurai Way</a></li>
<li><a href="../fr442032/index.html">R√©introduction du bison (petite victoire des zoologistes)</a></li>
<li><a href="../fr442036/index.html">Runtime de conteneur mature: containerd devient dipl√¥m√© de la CNCF</a></li>
<li><a href="../fr442038/index.html">Le condens√© des √©v√©nements pour les professionnels RH dans le domaine de l'informatique en mars 2019</a></li>
<li><a href="../fr442040/index.html">Le partenariat comme outil efficace de d√©veloppement commercial</a></li>
<li><a href="../fr442044/index.html">Comment nous utilisons le syst√®me de surveillance de d√©tail Zabbix</a></li>
<li><a href="../fr442046/index.html">R√©agir et fractionner le code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>