<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ† ğŸš· â˜ ï¸ è®°å½•PostgreSQLæ•°æ®åº“çš„åŠŸèƒ½ã€‚ ç¬¬ä¸‰éƒ¨åˆ† ğŸš¶ ğŸ¦ƒ ğŸš¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¿™æ˜¯æœ¬æ–‡çš„ç¬¬ä¸‰éƒ¨åˆ†ï¼Œæè¿°äº†ç”¨äºå¤„ç†ç³»ç»Ÿç›®å½•çš„ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼špg_classï¼Œpg_attributeï¼Œpg_constraintsç­‰ã€‚ 

 æœ¬æ–‡çš„æœ¬èŠ‚è®¨è®ºè¿”å›åºåˆ—ç‰¹å¾ï¼Œç»§æ‰¿çš„è¡¨ä»¥åŠè¡¨å±æ€§çš„ç‰¹æ®Šç‰¹å¾çš„å‡½æ•°ã€‚ 



 å¦è¯·å‚é˜… 
 è®°å½•PostgreSQLæ•°æ®åº“çš„åŠŸèƒ½ã€‚ ç¬¬ä¸€éƒ¨åˆ† ; 
 è®°å½•Pos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>è®°å½•PostgreSQLæ•°æ®åº“çš„åŠŸèƒ½ã€‚ ç¬¬ä¸‰éƒ¨åˆ†</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418597/"> è¿™æ˜¯æœ¬æ–‡çš„ç¬¬ä¸‰éƒ¨åˆ†ï¼Œæè¿°äº†ç”¨äºå¤„ç†ç³»ç»Ÿç›®å½•çš„ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼špg_classï¼Œpg_attributeï¼Œpg_constraintsç­‰ã€‚ <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zc/rx/ta/zcrxta08dnfat5cqpgid4lyq7by.png"></div><br> æœ¬æ–‡çš„æœ¬èŠ‚è®¨è®ºè¿”å›<b>åºåˆ—ç‰¹å¾ï¼Œç»§æ‰¿çš„è¡¨</b>ä»¥åŠ<b>è¡¨å±æ€§</b>çš„<b>ç‰¹æ®Šç‰¹å¾çš„</b>å‡½æ•°ã€‚ <br><a name="habracut"></a><br><p>  <b>å¦è¯·å‚é˜…</b> <br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®°å½•PostgreSQLæ•°æ®åº“çš„åŠŸèƒ½ã€‚</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€éƒ¨åˆ†</a> ;</b> <br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®°å½•PostgreSQLæ•°æ®åº“çš„åŠŸèƒ½ã€‚</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬äºŒéƒ¨åˆ†</a> ;</b> <br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®°å½•PostgreSQLæ•°æ®åº“çš„åŠŸèƒ½ã€‚</a></b>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ€åï¼ˆç¬¬å››éƒ¨åˆ†ï¼‰</a> ã€‚</b> <br><br> æœ¬æ–‡çš„å‰åŠéƒ¨åˆ†æä¾›äº†æœ‰å…³åŠŸèƒ½å®ç°çš„è¯„è®ºã€‚ ç¬¬äºŒä¸ªæ˜¯å‡½æ•°çš„æºä»£ç ã€‚ å¯¹äºåªå¯¹æºæ–‡æœ¬æ„Ÿå…´è¶£çš„è¯»è€…ï¼Œæˆ‘ä»¬å»ºè®®ç«‹å³ç»§ç»­é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é™„å½•</a> ã€‚ <br><br></p><h3> è¿”å›è¡¨åºåˆ—ç‰¹å¾åˆ—è¡¨çš„å‡½æ•°çš„ç»“æ„ </h3><br><img src="https://habrastorage.org/webt/i6/dw/f_/i6dwf_jd0ofjr-vqmeide0l1vws.png"><br>  <i>å›¾</i>  <i>2. admtf_Table_Sequenceså‡½æ•°æ‰€ä¾èµ–çš„å‡½æ•°</i> <br><br>  <strong>è¡¨11.åŠŸèƒ½ç”¨é€”</strong> <br><br><table width="95" border="1"><tbody><tr><th width="5"> ä¸è¡Œ </th><th width="10"> èŒç§° </th><th width="40"> é¢„çº¦æ—¶é—´ </th></tr><tr><td width="5">  1ä¸ª </td><td width="10">  admtf_Sequence_Features </td><td width="40"> è¯¥å‡½æ•°è¿”å›è¡¨åºåˆ—ç‰¹å¾çš„åˆ—è¡¨ã€‚ </td></tr><tr><td width="5">  2 </td><td width="10">  admtf_Table_Sequences </td><td width="40"> è¯¥å‡½æ•°è¿”å›æ•°æ®åº“è¡¨åºåˆ—åŠå…¶ç‰¹å¾çš„åˆ—è¡¨ã€‚ </td></tr></tbody></table><br><h3>  <b>Admtf_Sequence_Features</b>å‡½æ•°-æ•°æ®åº“åºåˆ—ç‰¹å¾åˆ—è¡¨ </h3><br><a name="tfSeqF_def"></a><p>  admtf_Sequence_Featureså‡½æ•°è¿”å›æ•°æ®åº“SEQUENCEç‰¹å¾çš„åˆ—è¡¨ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹å’Œä¸‹è½½æºä»£ç </a> ã€‚ </p><br><p>  <b>admtf_Sequence_Features</b>å‡½æ•°è¿”å›æ•°æ®åº“åºåˆ—ç‰¹å¾çš„åˆ—è¡¨ï¼ˆ <b>SEQUENCE</b> ï¼‰ </p>  ã€‚ <br><p> ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°é‡‡ç”¨åºåˆ—çš„åç§°ï¼ˆ <b>a_SequenceName</b> ï¼‰å’Œåœ¨å…¶ä¸­åˆ›å»ºåºåˆ—çš„æ–¹æ¡ˆçš„åç§°ï¼ˆ <b>a_SchemaName</b> ï¼‰ã€‚ </p><br><p> ä¹‹æ‰€ä»¥éœ€è¦<b>admtf_Sequence_Features</b>å‡½æ•°ï¼Œæ˜¯å› ä¸ºè¯¥åºåˆ—çš„ä¸»è¦ç‰¹å¾å®é™…ä¸Šå­˜å‚¨åœ¨åç§°ä¸åºåˆ—åç§°åŒ¹é…çš„è¡¨ä¸­ï¼Œå¹¶ä¸”ä½¿ç”¨<b>SELECTè¯­å¥</b>ä»ä¸­æå–æ•°æ®ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåºåˆ—çš„åç§°ï¼Œæ–¹æ¡ˆçš„åç§°ä»¥åŠå¯¹è¯¥åºåˆ—çš„æ³¨é‡Šå­˜å‚¨åœ¨<b>pg_class</b> ï¼Œ <b>pg_namespace</b>å’Œ<b>pg_descriptionç›®å½•ä¸­</b> ã€‚ </p><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> kr_road_network_vertices_pgr_id_seq;</code> </pre> <br><p>  <b><i>å¤‡æ³¨6</i></b> </p><br><p>  <b>PostgreSQL</b> 10åˆ†ç¦»äº†åºåˆ—çš„ç‰¹å¾åŠå…¶çŠ¶æ€çš„ç‰¹å¾ã€‚ ä¸ºæ­¤ï¼Œ <b>å¼•å…¥äº†</b>å…·æœ‰åºåˆ—ç‰¹å¾çš„<b>pg_sequence</b>ç›®å½•ï¼Œå…¶ä¸­åŒ…å«åºåˆ—çš„åˆå§‹å€¼ï¼ˆ <b>start_value</b> ï¼‰ï¼Œå¢é‡ï¼ˆ <b>crement_by</b> ï¼‰å’Œæœ€å¤§å€¼ï¼ˆ <b>max_value</b> ï¼‰ã€‚ åºåˆ—è¿”å›çš„æœ€åä¸€ä¸ªå€¼ï¼ˆ <b>last_value</b> ï¼‰ä¿ç•™åœ¨â€œè¡¨â€ä¸­ï¼Œå¹¶å¸¦æœ‰åºåˆ—çš„åç§°ã€‚ </p><p></p><p>  <strong>å¤‡æ³¨çš„ç»“å°¾ã€‚</strong> </p><br><p> æˆ‘è®¤ä¸ºï¼Œå°†æ¯ä¸ªåºåˆ—è¡¨ç¤ºä¸ºè¡¨çš„ç±»ä¼¼ç‰©æ˜¯ç”±éœ€è¦å­˜å‚¨åºåˆ—çš„æœ€åä½¿ç”¨å€¼ï¼ˆ <b>last_value</b> ï¼‰å†³å®šçš„ï¼Œè¯¥å€¼æ˜¯åºåˆ—çŠ¶æ€çš„ç‰¹å¾ï¼Œè€Œä¸æ˜¯åºåˆ—æœ¬èº«ã€‚ </p><br><p>  <b>pg_class</b>ç›®å½•ä¸­çš„åºåˆ—æ¡ç›®ä¸è¡¨æ¡ç›®çš„åŒºåˆ«åœ¨äºå…³ç³»ç±»å‹çš„å€¼ï¼ˆrelkind = <font color="red">'S'</font> ï¼‰ã€‚ </p><br><p> ä¸ºäº†æå–ä»»æ„åºåˆ—çš„ç‰¹å¾ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨åŠ¨æ€SQLã€‚ </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> <span class="hljs-string"><span class="hljs-string">'SELECT last_value,start_value,increment_by,max_value FROM '</span></span>|| <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName)||<span class="hljs-string"><span class="hljs-string">'.'</span></span>||<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SequenceName) <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> v_SequenceLastValue,v_SequenceStartValue, v_SequenceIncrementBy,v_SequenceMaxValue ;</code> </pre><br><br>  <strong>è¡¨12.æ‰§è¡Œadmtf_Sequence_Featureså‡½æ•°ï¼ˆâ€œ publicâ€ï¼Œâ€œ kr_road_network_vertices_pgr_id_seqâ€ï¼‰çš„ç»“æœã€‚</strong> <br><br><table width="25"><tbody><tr><th width="5"> èŒç§° </th><th width="5"> è¯„æ³¨ </th><th width="10"> ç°æ—¶ </th><th width="5"> å¼€å§‹ </th><th width="5"> å¢é‡å¼ </th><th width="10"> ç»“æŸ </th></tr><tr><td width="15">  kr_road_network <br>  _vertices_pgr_id <br>  _seq </td><td width="20"> é¡ºåº </td><td width="10">  138023 </td><td width="5">  1ä¸ª </td><td width="5">  1ä¸ª </td><td width="10">  9223372036854775807 </td></tr></tbody></table><br><h3> æ•°æ®åº“è¡¨åºåˆ—åŠå…¶ç‰¹å¾çš„åŠŸèƒ½admtf_Table_Sequencesåˆ—è¡¨ </h3><br><a name="tfTableS_def"></a><p>  <b>admtf_Table_Sequences</b>å‡½æ•°è¿”å›æ•°æ®åº“è¡¨çš„åºåˆ—åˆ—è¡¨ï¼ˆ <b>SEQUENCE</b> ï¼‰ï¼Œç”Ÿæˆå…¶å­—æ®µå€¼å’Œè¿™äº›åºåˆ—çš„ç‰¹å¾ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹å’Œä¸‹è½½æºä»£ç </a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™æ˜¯ä¸ä½¿ç”¨æ¸¸æ ‡çš„å‡½æ•°çš„ç‰ˆæœ¬</a> ã€‚ </p><br><p> ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°é‡‡ç”¨æºè¡¨çš„åç§°ï¼ˆ <b>a_TableName</b> ï¼‰å’Œåœ¨å…¶ä¸­åˆ›å»ºè¡¨çš„æ–¹æ¡ˆçš„åç§°ï¼ˆ </p><p>  a_SchemaName </p>  ï¼‰ <br><img src="https://habrastorage.org/webt/io/cc/ib/ioccibem_rgf_rjzsnmd5va1xt0.png"><br><div class="spoiler">  <b class="spoiler_title">å›¾ä¸­æ“ä½œå‘˜çš„æºä»£ç </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pseq.relname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceName,snsp.nspname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceSchemaName, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(dsc.description,<span class="hljs-string"><span class="hljs-string">',    '</span></span> ||da.attname) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceDescription, d.depType <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> DependcyType,da.attname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> AttributeName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_depend d <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class pseq <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> d.objid = pseq.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace snsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pseq.relnamespace=snsp.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_Description dsc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pseq.oid=dsc.objoid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> dsc.objsubid=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> d.refobjid = tbl.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.relnamespace=nsp.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_attribute da <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> da.attrelid= d.refobjid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> da.attnum= d.refobjsubid <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(nsp.nspname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(tbl.relname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableOID) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> tbl.relkind = <span class="hljs-string"><span class="hljs-string">'r'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pseq.relkind = <span class="hljs-string"><span class="hljs-string">'S'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> pseq.relname;</code> </pre><br></div></div><br><p> å•ä¸ªåºåˆ—çš„æè¿°æ˜¯<b>pg_class</b>ä¸­çš„è®°å½•çš„ç»„åˆï¼Œè¯¥è®°å½•å°†å…¶æè¿°ä¸ºç‰©ç†å…³ç³»ï¼Œæ¡ä»¶è¡¨çš„åºåˆ—åç§°åŒ…å«æœ‰å…³åºåˆ—ç‰¹å®šç‰¹å¾çš„æ•°æ® </p><br><p> æœ‰å…³åºåˆ—å’Œæºè¡¨ä¹‹é—´å…³ç³»çš„ä¿¡æ¯å­˜å‚¨åœ¨<b>pg_depend</b>ç³»ç»Ÿç›®å½•ä¸­ã€‚ </p><br><br>  <strong>è¡¨13.å®ç°è¯¥åŠŸèƒ½æ‰€éœ€çš„<b>pg_depend</b>ç›®å½•çš„å±æ€§ã€‚</strong> <br><table width="25"><tbody><tr><th width="5"> èŒç§° </th><th width="5"> å†…å®¹æè¿° </th></tr><tr><td width="10"> å¯¹è±¡ </td><td width="20">  pg_classç›®å½•ä¸­åºåˆ—çš„OID </td></tr><tr><td width="10">  objsubid </td><td width="20"> è¯¥å­—æ®µåŒ…å«é›¶ </td></tr><tr><td width="10">  refobjid </td><td width="20"> ä½¿ç”¨é¡ºåºå­—æ®µçš„è¡¨çš„OID </td></tr><tr><td width="10">  refobjsubid </td><td width="20"> è¡¨å±æ€§å·ï¼Œå…¶å€¼ä½¿ç”¨åºåˆ—å¡«å…… </td></tr></tbody></table><br><p> å¦å¤–ï¼Œè¯¥å‡½æ•°è®¿é—®ç›®å½•æ•°æ®<b>pg_namespace</b>å’Œ<b>pg_description</b>ä»¥ä¾¿æå–åºåˆ—å’Œæºè¡¨çš„å›¾è¡¨å’Œæ³¨é‡Šã€‚ </p><br><p> ä¸ºäº†ç¡®å®šè¡¨çš„å±æ€§ï¼Œè¯¥è¡¨çš„å€¼ä½¿ç”¨åºåˆ—å¡«å……ï¼Œè¯¥å‡½æ•°åœ¨ä»¥ä¸‹æ¡ä»¶ä¸‹è®¿é—®<b>pg_attribute</b>ç›®å½•ï¼š <b>attrelid = refobjidå’Œattnum = refobjsubid</b> ã€‚  ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <b>pg_depend</b>ç›®å½•å±æ€§çš„åç§°æ˜¾ç¤ºåœ¨ç­‰å·çš„å³ä¾§ï¼‰ã€‚ </p><br><p> é€šè¿‡è°ƒç”¨<b>admtf_Sequence_Features</b>åœ¨å¾ªç¯ä¸­æ£€ç´¢è¡¨åºåˆ—çš„ç‰¹æ®Šç‰¹å¾ã€‚ ä¹‹æ‰€ä»¥ä½¿ç”¨å¾ªç¯ï¼Œæ˜¯å› ä¸ºå¯ä»¥åˆ†é…å¤šä¸ªåºåˆ—æ¥å¡«å†™è¡¨æ ¼çš„å­—æ®µã€‚ </p><br>  <strong>è¡¨14.æ‰§è¡Œadmtf_Table_Sequenceså‡½æ•°ï¼ˆâ€œ publicâ€ï¼Œâ€œ kr_road_network_vertices_pgrâ€ï¼‰çš„ç»“æœã€‚</strong> <br><br><table width="25"><tbody><tr><th width="5"> èŒç§° </th><th width="5"> è¯„æ³¨ </th><th width="5"> å¼€å§‹ </th><th width="5"> å¢é‡å¼ </th><th width="10"> ç»“æŸ </th><th width="10"> é¢†åŸŸ </th></tr><tr><td width="15">  kr_road_network <br>  _vertices_pgr_id <br>  _seq </td><td width="20"> åºåˆ—ç”ŸæˆIDå­—æ®µå€¼ </td><td width="5">  1ä¸ª </td><td width="5">  1ä¸ª </td><td width="10">  9223372036854775807 </td><td width="10"> ç¼–å· </td></tr></tbody></table><br><a name="tfTableS_woc_def"></a><h4> æ²¡æœ‰å…‰æ ‡çš„ç‰ˆæœ¬ </h4><br><p> åœ¨ç‰ˆæœ¬ä½äº10çš„<b>PostgreSQL</b>ç¯å¢ƒä¸­ï¼Œæœ€æœ‰å¯èƒ½åœ¨ä¸ä½¿ç”¨æ¸¸æ ‡çš„æƒ…å†µä¸‹å®ç°<b>admtf_Table_Sequences</b>å‡½æ•°ã€‚ <br> ä½†æ˜¯ç‰ˆæœ¬10çš„å¹¸è¿æ‰€æœ‰è€…å¯ä»¥å¾ˆå¥½åœ°ä½¿ç”¨æ¸¸æ ‡ï¼Œå› ä¸º ä»–ä»¬å¯ä»¥ä½¿ç”¨<b>pg_sequence</b>ç›®å½•ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å•ä¸ª<b>SELECTè¯­å¥</b>æ£€ç´¢åºåˆ—çš„æ‰€æœ‰ç‰¹å¾ã€‚ </p><br><p> åœ¨ç»™å®šçš„å‡½æ•°å®ç°ä¸­ï¼Œä½¿ç”¨çª—å£å‡½æ•°<b>RANKï¼ˆï¼‰OVERï¼ˆPARTITION BY pseq.relnameï¼‰</b> ï¼Œè®¡ç®—ç”¨äºå¡«å……æºè¡¨çš„åºåˆ—çš„åºåˆ—å·ã€‚ </p><br><img src="https://habrastorage.org/webt/1z/qa/r7/1zqar7uba-68o2ya1l_o37ph5jc.png"><br><div class="spoiler">  <b class="spoiler_title">å›¾ä¸­æ“ä½œå‘˜çš„æºä»£ç </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RANK</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> pseq.relname) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceNo, pseq.relname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceName,snsp.nspname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceSchemaName, <span class="hljs-keyword"><span class="hljs-keyword">COALESCE</span></span>(dsc.description,<span class="hljs-string"><span class="hljs-string">',    '</span></span> ||da.attname) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceDescription, seq.seqstart <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceStartValue,seq.seqincrement <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceIncrementBy, seq.seqmax <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> SequenceMaxValue, d.depType <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> DependcyType,da.attname <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> AttributeName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_depend d <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class pseq <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> d.objid = pseq.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_sequence seq <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> seq.seqrelid= pseq.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace snsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pseq.relnamespace=snsp.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_Description dsc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> pseq.oid=dsc.objoid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> dsc.objsubid=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> d.refobjid = tbl.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nsp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.relnamespace=nsp.oid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_attribute da <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> da.attrelid= d.refobjid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> da.attnum= d.refobjsubid <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(nsp.nspname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(tbl.relname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableOID) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> tbl.relkind = <span class="hljs-string"><span class="hljs-string">'r'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> pseq.relkind = <span class="hljs-string"><span class="hljs-string">'S'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> pseq.relname;</code> </pre><br></div></div><br><p>  <strong>å¤‡æ³¨7</strong> </p>  ã€‚ <br><p> æ­¤ç‰ˆæœ¬çš„å‡½æ•°ä¸è¿”å›åºåˆ—ï¼ˆ <b>last_value</b> ï¼‰ç”Ÿæˆçš„æœ€åä¸€ä¸ªå€¼ã€‚ </p><p></p><p>  <strong>å¤‡æ³¨çš„ç»“å°¾ã€‚</strong> </p><br><h3>  Admtf_Table_InheritanceChildrenså‡½æ•°-ç»§æ‰¿è¡¨çš„ç‰¹å¾åˆ—è¡¨ </h3><br><a name="tfTableIC_def"></a><p>  <b>admtf_Table_InheritanceChildrens</b>å‡½æ•°è¿”å›æ•°æ®åº“è¡¨çš„ç»§æ‰¿è¡¨ï¼ˆ <b>INHERITS</b> ï¼‰çš„ç‰¹å¾åˆ—è¡¨ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹å’Œä¸‹è½½æºä»£ç </a> ã€‚ </p><br><p> è¯¥å‡½æ•°å°†æºè¡¨çš„åç§°ï¼ˆ <b>a_TableName</b> ï¼‰å’Œåœ¨å…¶ä¸­åˆ›å»ºè¡¨çš„æ–¹æ¡ˆçš„åç§°ï¼ˆ <b>a_SchemaName</b> ï¼‰ä½œä¸ºå‚æ•°ã€‚ </p><br><p> å•ä¸ªæ—§è¡¨çš„æè¿°åœ¨<b>pg_class</b>çš„æ¡ç›®ä¸­ã€‚ ä½†æ˜¯<b>è¦æŒ‰</b>æºè¡¨çš„åç§°æœç´¢ç»§æ‰¿çš„è¡¨ï¼Œå¿…é¡»ä½¿ç”¨<b>pg_depend</b>ç³»ç»Ÿç›®å½•ã€‚ </p><br>  <strong>è¡¨15.å®ç°è¯¥åŠŸèƒ½æ‰€éœ€çš„<b>pg_depend</b>ç›®å½•çš„å±æ€§ã€‚</strong> <br><table width="25"><tbody><tr><th width="5"> èŒç§° </th><th width="5"> å†…å®¹æè¿° </th></tr><tr><td width="10"> å¯¹è±¡ </td><td width="20">  pg_classç›®å½•ä¸­ç»§æ‰¿è¡¨çš„OID </td></tr><tr><td width="10">  refobjid </td><td width="20"> æºè¡¨çš„OID </td></tr></tbody></table><br><img src="https://habrastorage.org/webt/pa/ew/kl/paewklf4g7qvftdb99sss0efwqc.png"><br><div class="spoiler">  <b class="spoiler_title">å›¾ä¸­æ“ä½œå‘˜çš„æºä»£ç </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> rtbl.relname,rnspc.nspname,rdsc.description,rtbl.relnatts::<span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, rtbl.relchecks::<span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, rtbl.relhaspkey,rtbl.relhasindex,rtbl.relhassubclass, rtbl.reltuples::<span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nspc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.relnamespace = nspc.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_Description dsc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.oid=dsc.objoid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> dsc.objsubid=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_depend dp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.oid=dp.refobjid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class rtbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> rtbl.OID=dp.objid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace rnspc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> rtbl.relnamespace = rnspc.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_Description rdsc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> rtbl.oid=rdsc.objoid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> rdsc.objsubid=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(nspc.nspname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(tbl.relname)=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableOID) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> tbl.relkind = <span class="hljs-string"><span class="hljs-string">'r'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> rtbl.relkind = <span class="hljs-string"><span class="hljs-string">'r'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> rtbl.relname;</code> </pre><br></div></div><br><p> å¦å¤–ï¼Œè¯¥å‡½æ•°è®¿é—®ç›®å½•æ•°æ®<b>pg_namespace</b>å’Œ<b>pg_description</b>ä»¥ä¾¿ä¸ºç»§æ‰¿è¡¨å’Œæºè¡¨æå–æ¨¡å¼å’Œæ³¨é‡Šã€‚ </p><br>  <strong>è¡¨16.æ‰§è¡Œå‡½æ•°admtf_Table_InheritanceChildrensï¼ˆâ€œ publicâ€ï¼Œâ€œ np_houseâ€ï¼‰çš„ç»“æœã€‚</strong> <br><br><table width="95" border="1"><tbody><tr><th width="10"> èŒç§° </th><th width="20"> è¯„æ³¨ </th><th width="5"> å±æ€§ </th><th width="5">  ï¼Ÿ ä¸»é”® </th><th width="5">  ï¼Ÿ æŒ‡æ ‡ </th><th width="5">  ï¼Ÿ åè£” </th><th width="5"> è®°å½•æ•° </th></tr><tr><td width="10">  np_house 04201 000000 </td><td width="20"> å®šå±…ç‚¹çš„æˆ¿å±‹ï¼ˆé˜¿é’¦æ–¯åŸºåŒºï¼‰ </td><td width="5">  15 </td><td width="5">  ËšF </td><td width="5">  ËšF </td><td width="5">  ËšF </td><td width="5">  5651 </td></tr><tr><td width="10">  np_house 4208 000 000 </td><td width="20"> å®šå±…ç‚¹çš„æˆ¿å±‹ï¼ˆæ³¢å“¥å¤§æ–¯åŸºåŒºï¼‰ </td><td width="5">  15 </td><td width="5">  ËšF </td><td width="5">  ËšF </td><td width="5">  ËšF </td><td width="5">  4314 </td></tr></tbody></table><br><p> ä»pg_classç›®å½•çš„reltupleå±æ€§ä¸­é€‰æ‹©ç”Ÿæˆçš„è¡¨ä¸­çš„è®°å½•æ•°ã€‚ å°½ç®¡æ­¤å€¼é€šå¸¸ä¸è¡¨ä¸­çš„å®é™…æ¡ç›®æ•°å®Œå…¨åŒ¹é…ï¼Œä½†å®ƒä»ç„¶æ˜¯ä¼°è®¡å€¼ã€‚ å› æ­¤ï¼Œæ‚¨å¯èƒ½æƒ³è¦è·å¾—ç¡®åˆ‡çš„ç»“æœã€‚ ä¾‹å¦‚ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> <span class="hljs-string"><span class="hljs-string">'SELECT COUNT(*) FROM '</span></span>||<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName)||<span class="hljs-string"><span class="hljs-string">'.'</span></span>||<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableName) <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> v_TableNumberOfRowCalc;</code> </pre><br><p> ä½†æ˜¯ï¼Œé¦–å…ˆï¼Œä¸ºäº†åœ¨æ–‡æœ¬ä¸­å®ç°è¯¥è¯­å¥ï¼Œå‡½æ•°<b>admtf_Table_InheritanceChildrens</b>å°†å¿…é¡»ä½¿ç”¨æ¸¸æ ‡ã€‚ </p><br><p> å…¶æ¬¡ï¼Œæˆ‘å¸Œæœ›è¯¥åŠŸèƒ½åŒæ—¶æ˜¾ç¤ºè¡¨æ¡ç›®çš„ä¼°è®¡æ•°é‡å’Œç¡®åˆ‡æ•°é‡ã€‚ </p><br><p> å› æ­¤ï¼Œè¯¥å‡½æ•°å…·æœ‰å¦ä¸€ä¸ªå¯é€‰å‚æ•°-è·å–è¡¨æ¡ç›®æ•°çš„æ¨¡å¼ï¼ˆ <b>a_Mode</b> ï¼‰ï¼Œè¯¥æ¨¡å¼é‡‡ç”¨å€¼â€œ estimateâ€ï¼ˆ <font color="red">ä¼°è®¡</font> ï¼‰æˆ–â€œ exactlyâ€ï¼ˆ <font color="red">ç²¾ç¡®</font> ï¼‰ã€‚ </p><br><a name="fnTableRC_def"></a><br><p> æ­¤å¤–ï¼Œè¿˜<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ›å»º</a>äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">admfn_Table_RowCount</a>å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›è¡¨æ¡ç›®çš„å‡†ç¡®æ•°é‡ï¼Œå¹¶ä¸”reltupleå±æ€§åœ¨<b>SELECT</b>è¿”å›åˆ—è¡¨ä¸­è¢«æ›¿æ¢ä¸ºä»¥ä¸‹ç»“æ„ã€‚ </p><br><img src="https://habrastorage.org/webt/3f/t_/xf/3ft_xftbnboqxguantdpivkdtva.png"><br><div class="spoiler">  <b class="spoiler_title">å›¾ä¸­æ“ä½œå‘˜çš„æºä»£ç </b> <div class="spoiler_text"><pre> <code class="sql hljs">CASE WHEN a_Mode = 'exactly' THEN admfn_Table_RowCount(rnspc.nspname,rtbl.relname) ELSE reltuples <span class="hljs-keyword"><span class="hljs-keyword">END</span></span></code> </pre><br></div></div><br><p> ç»“æœï¼Œå¦‚æœå‚æ•°<b>a_Mode</b>æ²¡æœ‰<b>æŒ‡å®š</b>è¿”å›ç²¾ç¡®å€¼<b>çš„</b>è¦æ±‚ï¼Œåˆ™è¯¥å‡½æ•°è¿”å›æŒ‡æ ‡â€œè¡¨æ¡ç›®æ•°â€çš„ä¼°è®¡å€¼ã€‚ </p><br><h3> è¿”å›è¡¨å±æ€§ç‰¹å¾åˆ—è¡¨çš„å‡½æ•°çš„ç»“æ„ </h3><br><img src="https://habrastorage.org/webt/hi/du/at/hiduatp-_vtmifufs_u53_roz2q.png"><br>  <i>å›¾</i>  <i>3. admtf_Attribute_Featuresè°ƒç”¨çš„å‡½æ•°</i> <br><img src="https://habrastorage.org/webt/ip/3e/rx/ip3erx3a2sj9_kkoeriysoppfom.png"><br><div class="spoiler">  <b class="spoiler_title">å›¾ä¸­è¡¨æ ¼çš„æ–‡æœ¬ç‰ˆæœ¬</b> <div class="spoiler_text">  <strong>è¡¨17.åŠŸèƒ½ç›®çš„ã€‚</strong> <br><br><table width="95" border="1"><tbody><tr><th width="5"> ä¸è¡Œ </th><th width="10"> èŒç§° </th><th width="40"> é¢„çº¦æ—¶é—´ </th></tr><tr><td width="5">  1ä¸ª </td><td width="10">  admtf_Attribute_PKFeatures </td><td width="40"> è¯¥å‡½æ•°è¿”å›ä¸»é”®ï¼ˆPRIMARY KEYï¼‰ä¸­çš„å±æ€§å­˜åœ¨å±æ€§ï¼Œä»¥åŠè¯¥é”®çš„ä¸€éƒ¨åˆ†ç‰¹æ€§ã€‚ </td></tr><tr><td width="5">  2 </td><td width="10">  admtf_Attribute_FKFeatures </td><td width="40"> è¯¥å‡½æ•°è¿”å›å¤–é”®ï¼ˆFOREIGN KEYï¼‰ä¸­çš„å±æ€§å­˜åœ¨å±æ€§ï¼Œä»¥åŠè¯¥é”®çš„ä¸€éƒ¨åˆ†ç‰¹æ€§ã€‚ </td></tr><tr><td width="5">  3 </td><td width="10">  admtf_Attribute_Features </td><td width="40"> è¯¥å‡½æ•°è¿”å›è¡¨å±æ€§ç‰¹å¾çš„åˆ—è¡¨ã€‚ </td></tr></tbody></table><br></div></div><br><h3> å‡½æ•°<b>admtf_Attribute_PKFeatures--</b>å±æ€§æ˜¯å¦å­˜åœ¨äºä¸»é”®ä¸­ </h3><br><a name="tfAttPK_def"></a><br><p>  <b>admtf_Attribute_PKFeatures</b>å‡½æ•°è¿”å›è¡¨çš„ä¸»é”®ï¼ˆPRIMARY KEYï¼‰ä¸­æ˜¯å¦å­˜åœ¨è¡¨å±æ€§çš„ç¬¦å·ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¯¥é”®ä¸­çš„åºåˆ—å·æ˜¯å¤šå°‘ï¼Œå› ä¸º ä¸»é”®å¯ä»¥æ˜¯å¤åˆé”®ã€‚ <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹å’Œä¸‹è½½æºä»£ç </a> ã€‚ </p><br><p> è¯¥å‡½æ•°å°†æºè¡¨çš„OIDï¼ˆ <b>a_TableOID</b> ï¼‰å’Œå…¶ä¸­æ‰€éœ€å±æ€§çš„åºåˆ—å·ï¼ˆ <b>a_AttributeNo</b> ï¼‰ä½œä¸ºå‚æ•°ã€‚ </p><br><p> è¯¥å‡½æ•°ä»<b>pg_constraint</b>ç›®å½•<b>æ¡ç›®</b>ä¸­æå–<b>æ‰€éœ€çš„</b>æ•°æ®ï¼Œå…¶ä¸­åŒ…å«æºè¡¨çš„ï¼ˆCONSTRAINTï¼‰çº¦æŸï¼ŒåŒ…æ‹¬ä¸»é”®çº¦æŸã€‚ æ‰€éœ€è¡¨çš„OIDå­˜å‚¨åœ¨<b>conrelid</b>å­—æ®µä¸­ï¼Œä¸»é”®æè¿°å­˜å‚¨åœ¨ä¸€æ¡è®°å½•ä¸­ï¼Œå…¶ä¸­contypeå­—æ®µåŒ…å«å€¼<font color="red">``p'</font> </p>  ã€‚ <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> v_PKAttributeList,rs_isAttributePK conkey,<span class="hljs-built_in"><span class="hljs-built_in">ARRAY</span></span>[a_AttributeNo]&lt;@conkey <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_constraint c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.contype=<span class="hljs-string"><span class="hljs-string">'p'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> c.conrelid=a_TableOID;</code> </pre><br><p> ä»¥è¿™ç§æ–¹å¼æ‰¾åˆ°çš„<b>conkey</b>å­—æ®µåŒ…å«ç»„æˆä¸»é”®çš„å±æ€§ç¼–å·æ•°ç»„ã€‚ å› æ­¤ï¼Œä¸ºäº†æ£€æŸ¥ä¸»é”®ä¸­sourceå±æ€§çš„å­˜åœ¨ï¼Œè¶³ä»¥è®¡ç®—é€»è¾‘è¡¨è¾¾å¼<b>ARRAY [a_AttributeNo] &lt;@ conkey</b> ã€‚ </p><br><p> å¦‚æœä¸»é”®ä¸­å­˜åœ¨è¯¥å±æ€§ï¼Œåˆ™åœ¨å¾ªç¯ä¸­è®¡ç®—å…¶åºåˆ—å·ã€‚ </p><br><h3> å‡½æ•°<b>admtf_Attribute_FKFeatures-</b>å¤–é”®ä¸­æ˜¯å¦å­˜åœ¨è¯¥å±æ€§ </h3><br><a name="tfAttFK_def"></a><br><p>  <b>admtf_Attribute_FKFeatures</b>å‡½æ•°è¿”å›è¡¨çš„ä¸€ä¸ªæˆ–å¤šä¸ªå¤–é”®ï¼ˆFOREIGN KEYï¼‰ä¸­æ˜¯å¦å­˜åœ¨è¡¨å±æ€§çš„ç¬¦å·ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™åœ¨è¿™äº›é”®ä¸­å…¶åºå·æ˜¯ä»€ä¹ˆï¼Œå› ä¸º å¤–é”®å¯ä»¥æ˜¯å¤åˆé”®ã€‚ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹å’Œä¸‹è½½æºä»£ç </a> ã€‚ </p><br><p> è¯¥å‡½æ•°å°†æºè¡¨çš„OIDï¼ˆ <b>a_TableOID</b> ï¼‰å’Œå…¶ä¸­æ‰€éœ€å±æ€§çš„åºåˆ—å·ï¼ˆ <b>a_AttributeNo</b> ï¼‰ä½œä¸ºå‚æ•°ã€‚ </p><br><p> è¯¥å‡½æ•°ä»åŒ…å«æºè¡¨CONSTRAINTçš„<b>pg_constraint</b>ç›®å½•<b>æ¡ç›®</b>ä¸­æ£€ç´¢<b>æ‰€éœ€çš„</b>æ•°æ®ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå¤–é”®çº¦æŸã€‚ æ‰€éœ€è¡¨çš„OIDå­˜å‚¨åœ¨<b>conrelid</b>å­—æ®µä¸­ï¼Œä¸»é”®æè¿°å­˜å‚¨åœ¨ä¸€æ¡è®°å½•ä¸­ï¼Œå…¶ä¸­contypeå­—æ®µåŒ…å«å€¼<font color="red">â€œ fâ€</font> </p>  ã€‚ <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_constraint c <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.contype=<span class="hljs-string"><span class="hljs-string">'f '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> c.conrelid=a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-built_in"><span class="hljs-built_in">ARRAY</span></span>[a_AttributeNo]&lt;@conkey <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> c.oid;</code> </pre><br><p> ä»¥è¿™ç§æ–¹å¼æ‰¾åˆ°çš„<b>conkey</b>å­—æ®µåŒ…å«ç»„æˆå¤–é”®çš„å±æ€§å·æ•°ç»„ã€‚ å› æ­¤ï¼Œä¸ºäº†æ£€æŸ¥å¤–é”®ä¸­æºå±æ€§çš„å­˜åœ¨ï¼Œåªéœ€è®¡ç®—é€»è¾‘è¡¨è¾¾å¼<b>ARRAY [a_AttributeNo] &lt;@ conkeyå³å¯</b> ã€‚ </p><br><p> å¦‚æœè¯¥å±æ€§å­˜åœ¨äºå¤–é”®ä¸­ï¼Œåˆ™åœ¨å¾ªç¯ä¸­ï¼Œåœ¨åŒ…å«è¯¥å±æ€§çš„å¤–é”®ä¸­å½¢æˆå…¶åºåˆ—å·çš„æ•°ç»„ã€‚ æ­¤å¤–ï¼Œè¡¨åç§°åŠå…¶å±æ€§æ„æˆäº†å¦å¤–ä¸¤ä¸ªæ•°ç»„ï¼Œè¿™äº›æ•°ç»„ç”±sourceå±æ€§åœ¨åŒ…å«è¯¥è¡¨çš„å¤–é”®ä¸­å¼•ç”¨ã€‚ </p><br><p> é€šè¿‡ä»å¤–é”®é¡¹çš„confrelidå­—æ®µä¸­æ£€ç´¢çš„æ ‡è¯†ç¬¦ï¼ˆOIDï¼‰ä»<b>pg_class</b>ç›®å½•<b>é¡¹</b>ä¸­æ£€ç´¢è¡¨åã€‚ </p><br><p> è¦è·å–å¤–éƒ¨è¡¨çš„å±æ€§åç§°ï¼Œè¯·ä½¿ç”¨å­—æ®µä¸­çš„åºåˆ—å·æ•°ç»„ </p><p>  key </p>  ï¼ˆå…¶åç§°ä¸ä¸Šé¢çš„æ•°ç»„ä¸åŒï¼Œå­—æ¯ä¸ºâ€œ <b>f</b> â€ï¼‰ã€‚ ä»è¯¥æ•°ç»„ä¸­æå–ä¸å¤–éƒ¨å±æ€§å¯¹åº”çš„å¤–éƒ¨è¡¨çš„å±æ€§çš„åºåˆ—å·ã€‚ é€šè¿‡å¤–éƒ¨è¡¨çš„å±æ€§çš„æ­¤åºåˆ—å·åŠå…¶OIDï¼ˆä½äºpg_attributeç›®å½•ä¸­ï¼‰ï¼Œå¯ä»¥æ‰¾åˆ°ç”¨äºæè¿°å±æ€§çš„æ¡ç›®ï¼Œå¹¶æ£€ç´¢å…¶åç§°ã€‚ <br><h3>  <b>Admtf_Attribute_Features</b>å‡½æ•°-è¡¨å±æ€§ç‰¹å¾åˆ—è¡¨ </h3><br><a name="tfAttF_def"></a><p>  <b>admtf_Attribute_Features</b>å‡½æ•°è¿”å›ä»¥ä¸‹è¡¨å±æ€§ç‰¹å¾çš„åˆ—è¡¨ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹å’Œä¸‹è½½æºä»£ç </a> ã€‚ </p><br><img src="https://habrastorage.org/webt/tu/bz/me/tubzmeucr-nzriafiuufgbv31ew.png"><br><div class="spoiler">  <b class="spoiler_title">å›¾ä¸­è¡¨æ ¼çš„æ–‡æœ¬ç‰ˆæœ¬</b> <div class="spoiler_text"><table width="95" border="1"><tbody><tr><th width="5"> ä¸è¡Œ </th><th width="10"> èŒç§° </th><th width="10"> å‹å¼ </th><th width="40"> é¢„çº¦æ—¶é—´ </th></tr><tr><td width="5">  1ä¸ª </td><td width="10">  AttributeName </td><td width="10"> å </td><td width="40"> æºå±æ€§çš„åç§°ã€‚ </td></tr><tr><td width="5">  2 </td><td width="10">  UserTypeName </td><td width="10">  VARCHARï¼ˆ256ï¼‰ </td><td width="40"> è‡ªå®šä¹‰æ¥æºå±æ€§ç±»å‹ </td></tr><tr><td width="5">  3 </td><td width="10"> ç±»å‹å </td><td width="10">  VARCHARï¼ˆ256ï¼‰ </td><td width="40"> æºå±æ€§çš„åŸºæœ¬ç±»å‹ </td></tr><tr><td width="5">  4 </td><td width="10">  isNotNULL </td><td width="10"> å¸ƒå…° </td><td width="40">  ï¼Ÿ ç©ºæœ‰æ•ˆæ€§ </td></tr><tr><td width="5">  5 </td><td width="10">  isAttributePK </td><td width="10"> å¸ƒå…° </td><td width="40">  ï¼Ÿ å‚ä¸PK </td></tr><tr><td width="5">  6 </td><td width="10"> åˆ—PKNo </td><td width="10"> å°çµé€š </td><td width="40">  PKä¸­çš„å±æ€§åºåˆ—å· </td></tr><tr><td width="5">  7 </td><td width="10"> å†…å®¹æè¿° </td><td width="10"> æ–‡å­— </td><td width="40"> è¯„è®ºæ¥æºå±æ€§ </td></tr><tr><td width="5">  8 </td><td width="10">  isAttributeFK </td><td width="10"> å¸ƒå…° </td><td width="40">  ï¼Ÿ å‚åŠ FK </td></tr><tr><td width="5">  9 </td><td width="10">  FKeyName </td><td width="10"> åå­—[] </td><td width="40"> çº¦æŸè¡¨åç§°çš„æ•°ç»„ï¼Œå…¶ä¸­å®šä¹‰äº†å¤–é”® </td></tr><tr><td width="5">  10 </td><td width="10"> åˆ—å· </td><td width="10">  SMALLINT [] </td><td width="40"> è¡¨çš„å¤–é”®ä¸­çš„å±æ€§åºåˆ—å·æ•°ç»„ </td></tr><tr><td width="5">  11 </td><td width="10">  FKTableName </td><td width="10"> åå­—[] </td><td width="40"> å¤–é”®å¼•ç”¨çš„è¡¨çš„æ•°ç»„ </td></tr><tr><td width="5">  12 </td><td width="10">  FKTableColumnName </td><td width="10"> åå­—[] </td><td width="40"> å¤–éƒ¨è¡¨ä¸­ä¸æºå±æ€§ç›¸å¯¹åº”çš„å±æ€§åç§°æ•°ç»„ </td></tr></tbody></table><br></div></div><br><p> è¯¥å‡½æ•°å°†æºè¡¨çš„OIDï¼ˆ <b>a_TableOID</b> ï¼‰å’Œå…¶ä¸­æ‰€éœ€å±æ€§çš„åºåˆ—å·ï¼ˆ <b>a_AttributeNo</b> ï¼‰ä½œä¸ºå‚æ•°ã€‚ <br> ä»ä¸è¾“å…¥å‚æ•°çš„å€¼ç›¸å¯¹åº”çš„<b>pg_attribute</b>ç›®å½•<b>æ¡ç›®</b>ä¸­æ£€ç´¢<b>AttributeName</b>å’Œ<b>isNotNULLå­—æ®µ</b>çš„å€¼ã€‚ </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> attr.attname, attr.attnotnull <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_attribute <span class="hljs-keyword"><span class="hljs-keyword">attr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> attr.attrelid =a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> attr.attnum=a_AttributeNo; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> rs_isAttributePK,rs_ColumnPKNo <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> admtf_Attribute_PKFeatures (a_TableOID,a_AttributeNo); <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> rs_isAttributeFK,rs_FKeyName,rs_ColumnFKNo, rs_FKTableName,rs_FKTableColumnName <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> admtf_Attribute_FKFeatures (a_TableOID,a_AttributeNo);</code> </pre><br><p>  <b>admtf_Attribute_PKFeatures</b>å‡½æ•°è¿”å›<b>isAttributePK</b>å’Œ<b>ColumnPKNoå­—æ®µ</b>çš„å€¼ã€‚ </p><br><p>  <b>isAttributeFK</b> ï¼Œ <b>FKeyName</b> ï¼Œ <b>ColumnFKNo</b> ï¼Œ <b>FKTableName</b> ï¼Œ <b>FKTableColumnNameå­—æ®µçš„å€¼</b>ç”±<b>admtf_Attribute_FKFeatures</b>å‡½æ•°è¿”å›ã€‚ </p><br><p> è°ƒç”¨<b>admtf_Attribute_Featuresï¼ˆï¼ˆä»pg_classä¸­çš„SELECT OIDï¼Œå…¶ä¸­relname ='street'ï¼‰ï¼Œ2 :: SMALLINTï¼‰</b>å°†äº§ç”Ÿä»¥ä¸‹ç»“æœã€‚ </p><br>  <strong>è¡¨18.æ‰§è¡Œå‡½æ•°admtf_Attribute_Featuresçš„ç»“æœ</strong> <br><table width="95" border="1"><tbody><tr><th width="10">  AttributeName </th><th width="10">  UserTypeName </th><th width="10"> ç±»å‹å </th><th width="10">  isNotNULL </th><th width="10">  isAttributePK </th><th width="10"> åˆ—PKNo </th></tr><tr><td width="10"> åœ°åŒºæ€§ </td><td width="10"> åœ°åŒºæ€§ </td><td width="10"> æ•´æ•° </td><td> æ•´æ•° </td><td> æ•´æ•° </td><td width="2"> æ•´æ•° </td></tr></tbody></table><br><br><table width="95" border="1"><tbody><tr><th width="10"> å†…å®¹æè¿° </th><th width="10">  isAttributeFK </th><th width="10">  FKeyName </th><th width="10"> åˆ—å· </th><th width="10">  FKTableName </th><th width="10">  FKTableColumnName </th></tr><tr><td width="10"> ç¤¾åŒºID </td><td width="10">  Å¤ </td><td width="10">  {fk_street_locality} </td><td>  {2} </td><td>  {locality} </td><td width="2">  {localityid} </td></tr></tbody></table><br><a name="Script2"></a><h2> é™„å½•1.è„šæœ¬ </h2><br><a name="tfSeqF"></a><h3> åˆ›å»ºadmtf_Sequence_Featureså‡½æ•° </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ‰å…³åŠŸèƒ½æºä»£ç çš„æ³¨é‡Šï¼Œè¯·å‚è§æ­¤å¤„ã€‚</a> <br><div class="spoiler">  <b class="spoiler_title">åŠŸèƒ½ç </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Sequence_Features (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,a_SequenceName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/****************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     ,   */</span></span> <span class="hljs-comment"><span class="hljs-comment">/****************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Sequence_Features (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_SequenceName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (rs_SequenceName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,rs_SequenceDescription <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>,rs_NumberOfAttribute <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>,rs_SequenceLastValue <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, rs_SequenceStartValue <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>,rs_SequenceIncrementBy <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>,rs_SequenceMaxValue <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> c_SequenceKind <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>:=<span class="hljs-string"><span class="hljs-string">'S'</span></span>; v_SequenceOID OID; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceName NAME; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceDescription TEXT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceStartValue BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_SequenceIncrementBy BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceMaxValue BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_SequenceLastValue BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_SequenceNumberOfRowCalc INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-comment"><span class="hljs-comment">--************************************************************************ BEGIN SELECT INTO rs_SequenceName,rs_SequenceDescription,rs_NumberOfAttribute tbl.relname, COALESCE(dsc.description,'') AS r_SequenceDescription, tbl.relnatts::INTEGER,tbl.relchecks::INTEGER,tbl.relhaspkey, tbl.relhasindex,tbl.relhassubclass,tbl.reltuples::INTEGER FROM pg_class tbl INNER JOIN pg_namespace nspc ON tbl.relnamespace = nspc.oid LEFT OUTER JOIN pg_Description dsc ON tbl.oid=dsc.objoid AND dsc.objsubid=0 WHERE nspc.nspname=LOWER(a_SchemaName) AND tbl.relkind=c_SequenceKind AND tbl.relname =LOWER(a_SequenceName); IF FOUND THEN EXECUTE 'SELECT last_value,start_value,increment_by,max_value FROM '||LOWER(a_SchemaName)||'.'||LOWER(a_SequenceName) INTO v_SequenceLastValue,v_SequenceStartValue, v_SequenceIncrementBy,v_SequenceMaxValue ; RETURN QUERY SELECT rs_SequenceName,rs_SequenceDescription, rs_NumberOfAttribute,v_SequenceLastValue, v_SequenceStartValue,v_SequenceIncrementBy, v_SequenceMaxValue; END IF; RETURN; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Sequence_Features(a_SchemaName NAME,a_SequenceName NAME) IS '    ,  '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Sequence_Features (a_SchemaName VARCHAR(256),a_SequenceName VARCHAR(256)); /****************************************************************************/ /*     ,   */ /****************************************************************************/ CREATE OR REPLACE FUNCTION admtf_Sequence_Features (a_SchemaName VARCHAR(256) default 'public', /*     */ a_SequenceName VARCHAR(256) default NULL /*   */ ) RETURNS TABLE (rs_SequenceName VARCHAR(256),rs_SequenceDescription TEXT, rs_NumberOfAttribute INTEGER,rs_SequenceLastValue BIGINT, rs_SequenceStartValue BIGINT,rs_SequenceIncrementBy BIGINT, rs_SequenceMaxValue BIGINT) AS $BODY$ DECLARE c_SequenceKind CONSTANT CHAR:='S'; --******************************************************** BEGIN RETURN QUERY SELECT sf.rs_SequenceName::VARCHAR(256), sf.rs_SequenceDescription::TEXT, sf.rs_NumberOfAttribute::INTEGER, sf.rs_SequenceLastValue::BIGINT, sf.rs_SequenceStartValue::BIGINT, sf.rs_SequenceIncrementBy::BIGINT, sf.rs_SequenceMaxValue::BIGINT FROM admtf_Sequence_Features(a_SchemaName::NAME,a_SequenceName::NAME) sf; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Sequence_Features(a_SchemaName VARCHAR(256),a_SequenceName VARCHAR(256)) IS '    ,  '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Sequence_Features('public'::VARCHAR(255),'k_dorogi_dijkstra_seq_seq'::VARCHAR(255)); SELECT * FROM admtf_Sequence_Features('public'::NAME,'kr_road_network_vertices_pgr_id_seq'::NAME);</span></span></code> </pre><br></div></div><br><a name="tfTableS"></a><br><h3> åˆ›å»ºadmtf_Table_Sequenceså‡½æ•° </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ‰å…³åŠŸèƒ½æºä»£ç çš„æ³¨é‡Šï¼Œè¯·å‚è§æ­¤å¤„ã€‚</a> <br><div class="spoiler">  <b class="spoiler_title">åŠŸèƒ½ç </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Table_Sequences (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*********************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    ,     */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*********************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_Sequences (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (r_SequenceNumber <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>,r_SequenceName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, r_SequenceSchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_SequenceDescription <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>, r_SequenceStartValue <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>,r_SequenceIncrementBy <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, r_SequenceMaxValue <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>,r_DependType <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, r_RefTableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_RefTableSchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, r_RefAttributeName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> v_TableOID <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>;<span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_Sequence RECORD;<span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceOID INTEGER;<span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_SequenceName NAME; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceSchemaName NAME; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_SequenceDescription TEXT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceStartValue BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_SequenceIncrementBy BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceMaxValue BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_DependcyType NAME; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_AttributeName NAME; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> v_SequenceNumber SMALLINT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> c_Delimiter CONSTANT VARCHAR(2):=','; <span class="hljs-comment"><span class="hljs-comment">--********************************************************************* BEGIN v_SequenceNumber:=0; FOR v_Sequence IN SELECT pseq.relname AS SequenceName, snsp.nspname AS SequenceSchemaName, COALESCE(dsc.description,',    '||da.attname) AS SequenceDescription, d.depType AS DependcyType,da.attname AS AttributeName FROM pg_depend d INNER JOIN pg_class pseq ON d.objid = pseq.oid INNER JOIN pg_namespace snsp ON pseq.relnamespace=snsp.oid LEFT OUTER JOIN pg_Description dsc ON pseq.oid=dsc.objoid AND dsc.objsubid=0 INNER JOIN pg_class tbl ON d.refobjid = tbl.oid INNER JOIN pg_namespace nsp ON tbl.relnamespace=nsp.oid INNER JOIN pg_attribute da ON da.attrelid= d.refobjid AND d.refobjsubid=da.attnum WHERE tbl.relkind = 'r' AND pseq.relkind = 'S' AND LOWER(nsp.nspname)=LOWER(a_SchemaName) AND LOWER(tbl.relname)=LOWER(a_TableName) ORDER BY pseq.relname LOOP v_SequenceNumber:=v_SequenceNumber+1; v_SequenceName:=v_Sequence.SequenceName; v_SequenceSchemaName:=v_Sequence.SequenceSchemaName; v_DependcyType:=v_Sequence.DependcyType; v_AttributeName:=v_Sequence.AttributeName; v_SequenceDescription:=v_Sequence.SequenceDescription; SELECT INTO v_SequenceStartValue,v_SequenceIncrementBy, v_SequenceMaxValue rs_SequenceStartValue,rs_SequenceIncrementBy, rs_SequenceMaxValue FROM admtf_Sequence_Features(v_SequenceSchemaName,v_SequenceName); RETURN QUERY SELECT v_SequenceNumber,v_SequenceName, v_SequenceSchemaName,v_SequenceDescription, v_SequenceStartValue,v_SequenceIncrementBy, v_SequenceMaxValue,v_DependcyType, a_TableName,a_SchemaName,v_AttributeName; END LOOP; RETURN; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Sequences(a_SchemaName NAME, a_TableName NAME) IS '  ,    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Table_Sequences (a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)); /**********************************************************************/ /*    ,     */ /**********************************************************************/ CREATE OR REPLACE FUNCTION admtf_Table_Sequences (a_SchemaName VARCHAR(256) default 'public', /*     */ a_TableName VARCHAR(256) default NULL /*   */ ) RETURNS TABLE (r_SequenceNumber SMALLINT,r_SequenceName VARCHAR(256), r_SequenceSchemaName VARCHAR(256),r_SequenceDescription TEXT, r_SequenceStartValue BIGINT,r_SequenceIncrementBy BIGINT, r_SequenceMaxValue BIGINT,r_DependType VARCHAR(256), r_RefTableName VARCHAR(256),r_RefTableSchemaName VARCHAR(256), r_RefAttributeName VARCHAR(256)) AS $BODY$ DECLARE c_Delimiter CONSTANT VARCHAR(2):=','; --****************************************************** BEGIN RETURN QUERY SELECT ts.r_SequenceNumber::SMALLINT, ts.r_SequenceName::VARCHAR(256), ts.r_SequenceSchemaName::VARCHAR(256) , ts.r_SequenceDescription::TEXT, ts.r_SequenceStartValue::BIGINT, ts.r_SequenceIncrementBy::BIGINT, ts.r_SequenceMaxValue::BIGINT, ts.r_DependType::VARCHAR(256), ts.r_RefTableName::VARCHAR(256), ts.r_RefTableSchemaName::VARCHAR(256), ts.r_RefAttributeName::VARCHAR(256) FROM admtf_Table_Sequences(a_SchemaName::NAME,a_TableName::NAME) ts; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Sequences(a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)) IS '  ,    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Table_Sequences('public'::VARCHAR(255),'kr_road_network_vertices_pgr'::VARCHAR(255)); SELECT * FROM admtf_Table_Sequences('public'::NAME,'kr_road_network_vertices_pgr'::NAME);</span></span></code> </pre><br></div></div><br><a name="tfTableS_woc"></a><h3>   admtf_Table_Sequences   (PostgreSQL 10) </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">       .</a> <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Table_Sequences (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*********************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    ,     */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**********************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_Sequences (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (r_SequenceNumber <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>,r_SequenceName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, r_SequenceSchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_SequenceDescription <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>, r_SequenceStartValue <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>,r_SequenceIncrementBy <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, r_SequenceMaxValue <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>,r_DependType <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, r_RefTableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,r_RefTableSchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, r_RefAttributeName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> v_TableOID <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_Sequence RECORD; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceOID INTEGER; <span class="hljs-comment"><span class="hljs-comment">/* OID */</span></span> v_SequenceName NAME; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceSchemaName NAME; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_SequenceDescription TEXT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceStartValue BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_SequenceIncrementBy BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SequenceMaxValue BIGINT; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_DependcyType NAME; <span class="hljs-comment"><span class="hljs-comment">/*        */</span></span> v_AttributeName NAME; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> v_SequenceNumber SMALLINT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> c_Delimiter CONSTANT VARCHAR(2):=','; <span class="hljs-comment"><span class="hljs-comment">--****************************************************************** BEGIN v_SequenceNumber:=0; FOR v_Sequence IN SELECT pseq.relname AS SequenceName, snsp.nspname AS SequenceSchemaName, COALESCE(dsc.description,',    '||da.attname) AS SequenceDescription, d.depType AS DependcyType,da.attname AS AttributeName FROM pg_depend d INNER JOIN pg_class pseq ON d.objid = pseq.oid INNER JOIN pg_namespace snsp ON pseq.relnamespace=snsp.oid LEFT OUTER JOIN pg_Description dsc ON pseq.oid=dsc.objoid AND dsc.objsubid=0 INNER JOIN pg_class tbl ON d.refobjid = tbl.oid INNER JOIN pg_namespace nsp ON tbl.relnamespace=nsp.oid INNER JOIN pg_attribute da ON da.attrelid= d.refobjid ND d.refobjsubid=da.attnum WHERE tbl.relkind = 'r' AND pseq.relkind = 'S' AND LOWER(nsp.nspname)=LOWER(a_SchemaName) AND LOWER(tbl.relname)=LOWER(a_TableName) ORDER BY pseq.relname LOOP v_SequenceNumber:=v_SequenceNumber+1; v_SequenceName:=v_Sequence.SequenceName; v_SequenceSchemaName:=v_Sequence.SequenceSchemaName; v_DependcyType:=v_Sequence.DependcyType; v_AttributeName:=v_Sequence.AttributeName; v_SequenceDescription:=v_Sequence.SequenceDescription; SELECT INTO v_SequenceStartValue,v_SequenceIncrementBy,v_SequenceMaxValue rs_SequenceStartValue,rs_SequenceIncrementBy,rs_SequenceMaxValue FROM admtf_Sequence_Features(v_SequenceSchemaName,v_SequenceName); RETURN QUERY SELECT v_SequenceNumber,v_SequenceName, v_SequenceSchemaName,v_SequenceDescription, v_SequenceStartValue,v_SequenceIncrementBy, v_SequenceMaxValue,v_DependcyType, a_TableName,a_SchemaName,v_AttributeName; END LOOP; RETURN; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Sequences(a_SchemaName NAME, a_TableName NAME) IS '  ,    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Table_Sequences (a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)); /**********************************************************************/ /*    ,     */ /**********************************************************************/ CREATE OR REPLACE FUNCTION admtf_Table_Sequences (a_SchemaName VARCHAR(256) default 'public', /*     */ a_TableName VARCHAR(256) default NULL /*   */ ) RETURNS TABLE (r_SequenceNumber SMALLINT,r_SequenceName VARCHAR(256), r_SequenceSchemaName VARCHAR(256),r_SequenceDescription TEXT, r_SequenceStartValue BIGINT,r_SequenceIncrementBy BIGINT, r_SequenceMaxValue BIGINT,r_DependType VARCHAR(256), r_RefTableName VARCHAR(256),r_RefTableSchemaName VARCHAR(256), r_RefAttributeName VARCHAR(256)) AS $BODY$ DECLARE c_Delimiter CONSTANT VARCHAR(2):=','; --******************************************************* BEGIN RETURN QUERY SELECT ts.r_SequenceNumber::SMALLINT, ts.r_SequenceName::VARCHAR(256), ts.r_SequenceSchemaName::VARCHAR(256), ts.r_SequenceDescription::TEXT, ts.r_SequenceStartValue::BIGINT, ts.r_SequenceIncrementBy::BIGINT, ts.r_SequenceMaxValue::BIGINT, ts.r_DependType::VARCHAR(256), ts.r_RefTableName::VARCHAR(256), ts.r_RefTableSchemaName::VARCHAR(256), ts.r_RefAttributeName::VARCHAR(256) FROM admtf_Table_Sequences(a_SchemaName::NAME,a_TableName::NAME) ts; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_Sequences(a_SchemaName VARCHAR(256), a_TableName VARCHAR(256)) IS '  ,    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Table_Sequences('public'::VARCHAR(255), 'kr_road_network_vertices_pgr'::VARCHAR(255)); SELECT * FROM admtf_Table_Sequences('public'::NAME, 'kr_road_network_vertices_pgr'::NAME);</span></span></code> </pre><br></div></div><br><a name="fnTableRC"></a><br><h3>   admfn_Table_RowCount </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">       .</a> <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admfn_Table_RowCount (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>); <span class="hljs-comment"><span class="hljs-comment">/******************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> <span class="hljs-comment"><span class="hljs-comment">/******************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admfn_Table_RowCount (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>,<span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> v_TableNumberOfRowCalc <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> v_Found BOOLEAN; <span class="hljs-comment"><span class="hljs-comment">--*********************************************************** BEGIN IF a_SchemaName ~ E'^[a-z_0-9]+$' AND a_TableName ~ E'^[a-z_0-9]+$' THEN EXECUTE 'SELECT count(*) FROM ' ||a_SchemaName ||'.'|| a_TableName INTO v_TableNumberOfRowCalc; ELSE SELECT INTO v_Found true FROM pg_class tbl INNER JOIN pg_namespace nspc ON tbl.relnamespace = nspc.oid WHERE tbl.relkind='r' AND tbl.relname=a_TableName AND nspc.nspname=a_SchemaName; IF FOUND THEN EXECUTE 'SELECT count(*) FROM ' || CASE WHEN a_SchemaName ~ E'^[a-z_0-9]+$' THEN a_SchemaName ELSE quote_ident(a_SchemaName) END ||'.'|| CASE WHEN a_TableName ~ E'^[a-z_0-9]+$' THEN a_TableName ELSE quote_ident(a_TableName) END INTO v_TableNumberOfRowCalc; ELSE SELECT INTO v_Found true FROM pg_class tbl INNER JOIN pg_namespace nspc ON tbl.relnamespace = nspc.oid WHERE tbl.relkind='r' AND LOWER(tbl.relname)= LOWER(a_TableName) AND nspc.nspname=LOWER(a_SchemaName); IF FOUND THEN EXECUTE 'SELECT count(*) FROM ' || a_SchemaName ||'.'||a_TableName INTO v_TableNumberOfRowCalc; END IF; END IF; END IF; RETURN v_TableNumberOfRowCalc; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admfn_Table_RowCount(a_SchemaName NAME,a_TableName NAME) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION;BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admfn_Table_RowCount (a_SchemaName VARCHAR(256),a_TableName VARCHAR(256)); /********************************************************************/ /*       */ /********************************************************************/ CREATE OR REPLACE FUNCTION admfn_Table_RowCount (a_SchemaName VARCHAR(256) default 'public',/*     */ a_TableName VARCHAR(256) default NULL /*   */ ) RETURNS BIGINT AS $BODY$ DECLARE v_TableNumberOfRowCalc BIGINT; /*  */ --********************************************************* BEGIN RETURN admfn_Table_RowCount(a_SchemaName::NAME,a_TableName::NAME); END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admfn_Table_RowCount(a_SchemaName VARCHAR(256),a_TableName VARCHAR(256)) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECt admfn_Table_RowCount('public'::NAME,'Street'::NAME); SELECt admfn_Table_RowCount('public'::VARCHAR(256),'Street'::VARCHAR(256));</span></span></code> </pre><br></div></div><br><a name="tfTableIC"></a><h3>   admtf_Table_InheritanceChildrens </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">       .</a> <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Table_InheritanceChildrens (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,a_Mode <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>)); <span class="hljs-comment"><span class="hljs-comment">/************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> <span class="hljs-comment"><span class="hljs-comment">/************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_InheritanceChildrens (a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> a_Mode <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-string"><span class="hljs-string">'estimate'</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (rs_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,rs_TableDescription <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>, rs_NumberOfAttribute <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>,rs_NumberOfChecks <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, rs_hasPKey <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,rs_hasIndex <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>, rs_hasSubClass <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,rs_NumberOfRow <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> c_TableKind <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHAR</span></span>:=<span class="hljs-string"><span class="hljs-string">'r'</span></span>; c_ExactlyMode CONSTANT VARCHAR(10):='exactly'; c_EstimateMode CONSTANT VARCHAR(10):='estimate'; v_TableOID OID; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_SchemaName NAME; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_TableName NAME; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_TableDescription TEXT; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> v_TableNumberOfRowCalc INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_InheritanceRECORD RECORD; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> v_InheritanceOID OID; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RETURN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">QUERY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> rtbl.relname,rdsc.description,rtbl.relnatts::<span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, rtbl.relchecks::<span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>,rtbl.relhaspkey,rtbl.relhasindex, rtbl.relhassubclass, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> a_Mode=c_ExactlyMode <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> admfn_Table_RowCount(rnspc.nspname,rtbl.relname)::<span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> rtbl.reltuples::<span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_class tbl <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace nspc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.relnamespace = nspc.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_Description dsc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.oid=dsc.objoid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> dsc.objsubid=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_depend dp <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> tbl.oid=dp.refobjid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_class rtbl <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> rtbl.OID=dp.objid <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_namespace rnspc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> rtbl.relnamespace = rnspc.oid <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> pg_Description rdsc <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> rtbl.oid=rdsc.objoid <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> rdsc.objsubid=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> nspc.nspname=<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_SchemaName) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> tbl.relkind=c_TableKind <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> rtbl.relkind=c_TableKind <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> tbl.relname =<span class="hljs-keyword"><span class="hljs-keyword">LOWER</span></span>(a_TableName) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> rtbl.relname; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> plpgsql; <span class="hljs-keyword"><span class="hljs-keyword">COMMENT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Table_InheritanceChildrens(a_SchemaName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,a_TableName <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>,a_Mode <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-string"><span class="hljs-string">'    '</span></span>; <span class="hljs-comment"><span class="hljs-comment">--ROLLBACK TRANSACTION; COMMIT TRANSACTION; BEGIN TRANSACTION; DROP FUNCTION IF EXISTS admtf_Table_InheritanceChildrens (a_SchemaName VARCHAR(256),a_TableName VARCHAR(256),a_TableName NAME,a_Mode VARCHAR(10)); /************************************************************************/ /*       */ /************************************************************************/ CREATE OR REPLACE FUNCTION admtf_Table_InheritanceChildrens (a_SchemaName VARCHAR(256) default 'public',/*     */ a_TableName VARCHAR(256) default NULL,/*   */ a_Mode VARCHAR(10) default 'estimate' /*     */ ) RETURNS TABLE (rs_TableName VARCHAR(256),rs_TableDescription TEXT, rs_NumberOfAttribute INTEGER,rs_NumberOfChecks INTEGER, rs_hasPKey BOOLEAN,rs_hasIndex BOOLEAN, rs_hasSubClass BOOLEAN,rs_NumberOfRow INTEGER) AS $BODY$ DECLARE c_TableKind CONSTANT CHAR:='r'; BEGIN RETURN QUERY SELECT tic.rs_TableName::VARCHAR(256),tic.rs_TableDescription::TEXT, tic.rs_NumberOfAttribute::INTEGER,tic.rs_NumberOfChecks::INTEGER, tic.rs_hasPKey::BOOLEAN,tic.rs_hasIndex::BOOLEAN, tic.rs_hasSubClass::BOOLEAN,tic.rs_NumberOfRow::INTEGER FROM admtf_Table_InheritanceChildrens(a_SchemaName::NAME, a_TableName::NAME,a_Mode::VARCHAR(10)) tic; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Table_InheritanceChildrens(a_SchemaName VARCHAR(256),a_TableName VARCHAR(256),a_Mode VARCHAR(10)) IS '    '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Table_InheritanceChildrens('public'::NAME,'np_house'::NAME); SELECT * FROM admtf_Table_InheritanceChildrens('public'::VARCHAR(256),'np_house'::VARCHAR(256));</span></span></code> </pre><br></div></div><br><a name="tfAttPK"></a><h3>   admtf_Attribute_PKFeatures </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">       .</a> <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Attribute_PKFeatures (a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">OID</span></span>,a_AttributeNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>); <span class="hljs-comment"><span class="hljs-comment">/***************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*        . */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   ,          */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-comment"><span class="hljs-comment">/***************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Attribute_PKFeatures (a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">OID</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> a_AttributeNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (rs_isAttributePK <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,rs_PKeyName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>,rs_ColumnPKNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> C_PKAttributeList_NDims <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>:=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_PKAttributeList SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> v_PKAttributeIndx INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> v_PKAttributeLBound INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> v_PKAttributeUBound INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-comment"><span class="hljs-comment">--********************************************************************** BEGIN rs_isAttributePK:=false; rs_ColumnPKNo:=NULL; SELECT INTO rs_PKeyName,v_PKAttributeList,rs_isAttributePK conname,conkey,ARRAY[a_AttributeNo]&lt;@conkey FROM pg_constraint c WHERE c.contype='p' and c.conrelid=a_TableOID; IF FOUND AND rs_isAttributePK THEN --      v_PKAttributeLBound:=array_lower(v_PKAttributeList,C_PKAttributeList_NDims); v_PKAttributeUBound:=array_upper(v_PKAttributeList,C_PKAttributeList_NDims); v_PKAttributeIndx:=v_PKAttributeLBound; WHILE v_PKAttributeIndx &lt;= v_PKAttributeUBound AND a_AttributeNo&lt;&gt;v_PKAttributeList[v_PKAttributeIndx] LOOP v_PKAttributeIndx:=v_PKAttributeIndx+1; END LOOP; IF v_PKAttributeIndx&lt;=v_PKAttributeUBound THEN rs_ColumnPKNo:=v_PKAttributeIndx; END IF; END IF; RETURN QUERY SELECT rs_isAttributePK,rs_PKeyName,rs_ColumnPKNo; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Attribute_PKFeatures(a_TableOID OID,a_AttributeNo SMALLINT) IS '              '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Attribute_PKFeatures((SELECT OID FROM pg_class WHERE relname='street'),3::SMALLINT);</span></span></code> </pre><br></div></div><br><a name="tfAttFK"></a><h3>   admtf_Attribute_FKFeatures </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">       .</a> <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Attribute_FKFeatures (a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">OID</span></span>,a_AttributeNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>); <span class="hljs-comment"><span class="hljs-comment">/****************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*        . */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   ,         */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   . */</span></span> <span class="hljs-comment"><span class="hljs-comment">/****************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/****************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Attribute_FKFeatures (a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">OID</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> a_AttributeNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (rs_isAttributeFK <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,rs_FKeyName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>[],rs_ColumnFKNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[],rs_FKTableName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>[],rs_FKTableColumnName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>[]) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> C_FKAttributeList_NDims <span class="hljs-keyword"><span class="hljs-keyword">CONSTANT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>:=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_FKAttributeList SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> v_RefAttributeList SMALLINT[]; <span class="hljs-comment"><span class="hljs-comment">/*     , */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_FKAttributeIndx INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> v_RefAttributeListIndx INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*     , */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_FKAttributeLBound INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> v_FKAttributeUBound INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> v_FKConstraintIndx INTEGER; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_FKeyName name; <span class="hljs-comment"><span class="hljs-comment">/*   , */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_FKTableName name; <span class="hljs-comment"><span class="hljs-comment">/*  ,     */</span></span> v_FKTableColumnName name; <span class="hljs-comment"><span class="hljs-comment">/*    , */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_RefAttributeNo SMALLINT; <span class="hljs-comment"><span class="hljs-comment">/*     , */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> v_Constraint pg_constraint%ROWTYPE; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*  (CONSTRANT) */</span></span> <span class="hljs-comment"><span class="hljs-comment">--****************************************************************************************************** BEGIN rs_isAttributeFK:=false; rs_ColumnFKNo:=NULL; v_FKConstraintIndx:=0; FOR v_Constraint IN SELECT * FROM pg_constraint c WHERE c.contype='f' and c.conrelid=a_TableOID AND ARRAY[a_AttributeNo]&lt;@conkey ORDER BY c.oid LOOP v_FKConstraintIndx:=v_FKConstraintIndx+1; rs_isAttributeFK:=true; v_FKeyName:=v_Constraint.conname; v_FKAttributeList:=v_Constraint.conkey; v_RefAttributeList:=v_Constraint.confkey; v_FKAttributeLBound:=array_lower(v_FKAttributeList,C_FKAttributeList_NDims); v_FKAttributeUBound:=array_upper(v_FKAttributeList,C_FKAttributeList_NDims); v_FKAttributeIndx:=v_FKAttributeLBound; WHILE v_FKAttributeIndx &lt;= v_FKAttributeUBound AND a_AttributeNo&lt;&gt;v_FKAttributeList[v_FKAttributeIndx] LOOP v_FKAttributeIndx:=v_FKAttributeIndx+1; END LOOP; rs_FKeyName[v_FKConstraintIndx]:=v_FKeyName; rs_ColumnFKNo[v_FKConstraintIndx]:=v_FKAttributeIndx; SELECT INTO v_FKTableName ftbl.relname FROM pg_class ftbl WHERE ftbl.oid=v_Constraint.confrelid; rs_FKTableName[v_FKConstraintIndx]:=v_FKTableName; v_RefAttributeNo:=v_RefAttributeList[v_FKAttributeIndx]; v_FKTableColumnName:=NULL; SELECT INTO v_FKTableColumnName attname FROM pg_attribute a WHERE a.attrelid=v_Constraint.confrelid AND a.attnum=v_RefAttributeNo; rs_FKTableColumnName[v_FKConstraintIndx]:=v_FKTableColumnName; END LOOP; RETURN QUERY SELECT rs_isAttributeFK,rs_FKeyName,rs_ColumnFKNo, rs_FKTableName,rs_FKTableColumnName; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Attribute_FKFeatures(a_TableOID OID,a_AttributeNo SMALLINT) IS '              '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Attribute_FKFeatures((SELECT OID FROM pg_class WHERE relname='street'),4::SMALLINT);</span></span></code> </pre><br></div></div><br><a name="tfAttF"></a><br><h3>   admtf_Attribute_Features </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">       .</a> <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> admtf_Attribute_Features (a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">OID</span></span>,a_AttributeNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>); <span class="hljs-comment"><span class="hljs-comment">/****************************************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> <span class="hljs-comment"><span class="hljs-comment">/****************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> admtf_Attribute_Features (a_TableOID <span class="hljs-keyword"><span class="hljs-keyword">OID</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> a_AttributeNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span><span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> (rsa_AttributeName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>,rsa_UserTypeName <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">256</span></span>),rsa_TypeName <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">256</span></span>),rsa_isNotNULL <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,rsa_isAttributePK <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>, rsa_ColumnPKNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>,rsa_Description <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>,rsa_isAttributeFK <span class="hljs-built_in"><span class="hljs-built_in">BOOLEAN</span></span>,rsa_FKeyName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>[],rsa_ColumnFKNo <span class="hljs-built_in"><span class="hljs-built_in">SMALLINT</span></span>[],rsa_FKTableName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>[],rsa_FKTableColumnName <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>[]) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> v_Return_Error <span class="hljs-built_in"><span class="hljs-built_in">Integer</span></span> := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-comment"><span class="hljs-comment">--********************************************************************* BEGIN SELECT INTO rsa_AttributeName,rsa_UserTypeName,rsa_TypeName, rsa_isNotNULL,rsa_Description attr.attname, CASE WHEN COALESCE(typ.typbasetype,0)&gt;0 THEN typ.typname::VARCHAR(100) ELSE ''END AS r_UserTypeName, FORMAT_TYPE(COALESCE(NULLIF(typ.typbasetype,0),typ.oid), COALESCE(NULLIF(typ.typtypmod,-1),attr.atttypmod))::VARCHAR(256) AS r_TypeName, attr.attnotnull AS r_isNotNULL, dsc.description AS r_Description FROM pg_attribute attr LEFT OUTER JOIN pg_type typ ON attr.atttypid=typ.oid LEFT OUTER JOIN pg_type btyp ON typ.typbasetype=btyp.oid LEFT OUTER JOIN pg_description dsc ON dsc.objoid=attr.attrelid AND dsc.objsubid=attr.attnum WHERE attr.attrelid =a_TableOID AND attr.attnum=a_AttributeNo; SELECT INTO rsa_isAttributePK,rsa_ColumnPKNo rs_isAttributePK,rs_ColumnPKNo FROM admtf_Attribute_PKFeatures(a_TableOID,a_AttributeNo); SELECT INTO rsa_isAttributeFK,rsa_FKeyName,rsa_ColumnFKNo,rsa_FKTableName, rsa_FKTableColumnName rs_isAttributeFK,rs_FKeyName, rs_ColumnFKNo,rs_FKTableName,rs_FKTableColumnName FROM admtf_Attribute_FKFeatures(a_TableOID,a_AttributeNo); RETURN QUERY SELECT rsa_AttributeName,rsa_UserTypeName,rsa_TypeName,rsa_isNotNULL, rsa_isAttributePK,rsa_ColumnPKNo,rsa_Description,rsa_isAttributeFK, rsa_FKeyName,rsa_ColumnFKNo,rsa_FKTableName,rsa_FKTableColumnName; END $BODY$ LANGUAGE plpgsql; COMMENT ON FUNCTION admtf_Attribute_Features(a_TableOID OID,a_AttributeNo SMALLINT) IS '   '; --ROLLBACK TRANSACTION; COMMIT TRANSACTION; SELECT * FROM admtf_Attribute_Features ((SELECT OID FROM pg_class WHERE relname='street'),2::SMALLINT);</span></span></code> </pre><br></div></div><br><h3> å¦è¯·å‚é˜… </h3><br> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">     PostgreSQL.  </a> ;</b> <br> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">     PostgreSQL.  </a> .</b> <br> <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">     PostgreSQL. ( )</a> .</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN418597/">https://habr.com/ru/post/zh-CN418597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN418585/index.html">åˆ¶ä½œæœºå™¨äººçš„æœ¬åœ°è¶Šé‡åœ°å›¾</a></li>
<li><a href="../zh-CN418587/index.html">é€‚ç”¨äºAndroidå’ŒiOSçš„æ–°3CXå®¢æˆ·ç«¯ï¼Œå…·æœ‰é€‚ç”¨äºå¤šç§è®¾å¤‡çš„OPUSå’ŒPUSHç¼–è§£ç å™¨</a></li>
<li><a href="../zh-CN418589/index.html">ä¸Šå‘¨ç¬¬324å¤©æ¥è‡ªå‰ç«¯ä¸–ç•Œçš„æ–°é²œææ–™æ‘˜è¦ï¼ˆ2018å¹´7æœˆ23æ—¥è‡³29æ—¥ï¼‰</a></li>
<li><a href="../zh-CN418591/index.html">Bug Bounty Kyivstarï¼šå¥–åŠ±å¯¹Jiraï¼ŒAWSï¼ŒAppleï¼ŒGoogle Developerï¼ŒBitbucketæœåŠ¡çš„ç®¡ç†å‘˜è®¿é—®æƒé™-$ 50</a></li>
<li><a href="../zh-CN418593/index.html">å¹¶éæ‰€æœ‰çš„æ— çº¿è€³æœºéƒ½åŒæ ·æœ‰ç”¨ï¼Œæˆ–è€…ä¸æ˜¯å…³äºç¼–è§£ç å™¨é—®é¢˜çš„å‡ å¥è¯</a></li>
<li><a href="../zh-CN418599/index.html">5ä¸ªå°†APMæ•°æ®è½¬æ¢ä¸ºåº”ç”¨ç¨‹åºæ€§èƒ½åˆ†æçš„æ•°æ®æº</a></li>
<li><a href="../zh-CN418601/index.html">å…³äºRTOSçš„å…¨éƒ¨çœŸç›¸ã€‚ ç¬¬7æ¡ Nucleus SEï¼šç®€ä»‹</a></li>
<li><a href="../zh-CN418603/index.html">æ— éœ€å……ç”µçš„Matrix PowerWatchæ™ºèƒ½æ‰‹è¡¨</a></li>
<li><a href="../zh-CN418605/index.html">åˆ†æå¸ˆï¼šå¾®è½¯å¸‚å€¼å¯èƒ½è¾¾åˆ°1ä¸‡äº¿ç¾å…ƒ</a></li>
<li><a href="../zh-CN418607/index.html">é€‰æ‹©ä¼ä¸šWi-Fiçš„ä¾›åº”å•†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>