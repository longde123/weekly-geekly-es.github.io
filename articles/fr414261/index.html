<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí™üèø üé¢ üëÇüèª O√π stockez-vous les donn√©es? ‚¨áÔ∏è üò¥ ‚ôéÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! Nous continuons notre s√©rie exp√©rimentale d'articles, en observant que vous pouvez en temps r√©el influencer le processus de cr√©ation d'...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O√π stockez-vous les donn√©es?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/414261/">  Bonjour, Habr!  Nous continuons notre s√©rie exp√©rimentale d'articles, en observant que vous pouvez en temps r√©el influencer le processus de cr√©ation d'un jeu sur UWP.  Aujourd'hui, nous allons parler de la question ¬´O√π stocker les donn√©es?¬ª Qui se pose constamment dans les rangs des d√©veloppeurs.  Rejoignez-nous et partagez vos r√©flexions dans les commentaires! <br><br><img src="https://habrastorage.org/webt/bi/xw/n9/bixwn96nclriud-rklafycm_rma.jpeg"><a name="habracut"></a><br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Partie 1: Par o√π commencer</b></a> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2: √©cran de d√©marrage avanc√©</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 3: Le style du fils du fils de maman</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 4: Obtention des donn√©es utilisateur (volontaire)</a></b> </li><li>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 5: O√π stockez-vous les donn√©es?</a></b> </li></ul><br>  <i>Je donne la parole √† l'auteur, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Alexei Plotnikov</a> .</i> <br><br>  Dans un article pr√©c√©dent, j'ai soulev√© la question de la synchronisation pratique des donn√©es utilisateur entre les appareils et tout d'abord j'ai r√©solu le probl√®me de son identification, mais c'est la plus petite fraction de ce qui reste √† faire pour atteindre les objectifs. <br><br>  Un probl√®me beaucoup plus complexe est la mani√®re, et surtout, l'emplacement des donn√©es utilisateur et, gr√¢ce aux efforts de Microsoft, lorsqu'il pose une telle question, la premi√®re chose qui vient √† l'esprit est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Microsoft Azure</a> .  La plateforme cloud Azure comprend une gamme de services si vaste qu'il semble qu'aucune t√¢che ne puisse √™tre r√©solue avec son aide.  Que ce soit vrai ou non, je ne peux pas en juger, mais ma t√¢che est certainement √† la port√©e de cette plate-forme.  Cependant, tout d'abord. <br><br>  Nous commen√ßons petit - qu'est-ce qu'un cloud?  Pour la premi√®re fois, j'ai entendu parler du cloud en 2012, puis l'expression ¬´cloud computing¬ª a √©t√© le plus souvent utilis√©e.  L'id√©e initiale de ces calculs √©tait de r√©partir le travail informatique entre diff√©rents appareils distants les uns des autres.  Particuli√®rement impressionnant a parl√© de l'avenir, dans lequel m√™me les t√¢ches les plus difficiles seront trait√©es en quelques instants en raison du fait que les calculs seront r√©partis entre tous les ordinateurs du monde. <br><br>  Dans la pratique, tout se r√©sumait √† des centres de donn√©es diss√©min√©s dans le monde entier et fournissant leur puissance de calcul aux consommateurs, et le concept initial n'√©tait que la distribution entre les machines √† l'int√©rieur du centre de donn√©es et entre les centres de donn√©es eux-m√™mes (le plus souvent dans la m√™me r√©gion). <br><br>  Sur la base de ce qui pr√©c√®de, nous pouvons supposer que lorsque vous entendez le mot "cloud", vous pouvez le percevoir comme un "h√©bergement" plus familier, √† la seule diff√©rence que la puissance du cloud peut √™tre √©tendue sans effort suppl√©mentaire de votre part. <br><br>  La deuxi√®me question que vous pourriez vous poser est pourquoi Azure?  ¬´Comme il s'agit d'un article sur le blog Microsoft, l'auteur ne parlera que de ses produits¬ª, dites-vous, et vous vous tromperez.  Les raisons d'utiliser Azure sont beaucoup plus courantes - puisqu'il s'agit d'un produit Microsoft, il pr√©sente le degr√© d'int√©gration le plus √©lev√© possible avec leurs autres produits, √† l'aide duquel mon application est en cours de d√©veloppement. <br><br>  Cependant, je note que la soci√©t√© met tout en ≈ìuvre pour rendre l'utilisation d'Azure attrayante pour les d√©veloppeurs pour Android ou iOS.  Eh bien, le dernier probl√®me, mais non le moindre, est le co√ªt d'utilisation du cloud.  Depuis que je suis titulaire d'un abonnement BizSpark, j'ai obtenu un pr√™t mensuel pour un sac avec des int√©r√™ts sup√©rieurs √† la couverture de mes besoins en cloud, bien que les conditions fournies gratuitement peuvent √©galement couvrir la plupart des besoins d'un d√©veloppeur priv√©. <br><br>  Passons maintenant √† la s√©lection directe d'un m√©canisme de synchronisation et de stockage des donn√©es.  Je ne vais pas √™tre rus√©, en tant que personne autodidacte, je dois souvent faire face √† des technologies dont je n'ai aucune id√©e avant de conna√Ætre UWP, j'ai r√©solu des probl√®mes similaires en utilisant des bases de donn√©es SQL. <br><br>  Cependant, UWP n'a pas les outils pour travailler avec les SGBD SQL classiques, et SQLite est propos√© comme alternative, et, apr√®s avoir commenc√© son √©tude, j'ai d√©couvert qu'une telle base de donn√©es est int√©gr√©e, ce qui convient pour un stockage et une utilisation pratiques des donn√©es locales, mais ne convient absolument pas pour le placement de donn√©es dans le stockage √† distance.  D√©j√† en train d'√©crire cet article, lorsque la bonne technologie a √©t√© choisie, je suis tomb√© sur l'une des solutions Azure dans le domaine du d√©veloppement d'applications mobiles, qui vous permet de synchroniser les donn√©es de la table SQLite entre les appareils, mais apr√®s m√ªre r√©flexion, je suis rest√© sur le choix initial. <br><br>  Soit dit en passant, faire le choix initial n'a pas √©t√© difficile, car Microsoft a poliment propos√© une liste de technologies auxquelles le d√©veloppeur UWP devrait probablement faire face.  Dans les derni√®res versions de Visual Studio, lors de la cr√©ation d'un nouveau projet UWP, vous verrez une page avec des recommandations pour commencer, o√π l'un des liens indique ¬´Ajout d'un service recommand√©¬ª.  En cliquant sur ce lien, l'onglet ¬´Connecter le service¬ª s'ouvre et nous y voyons d√©j√† l'option ¬´Stockage cloud avec service de stockage Azure¬ª. <br><br><img src="https://habrastorage.org/webt/fr/wx/k9/frwxk9themsqsxrjnxuhfnuzljw.png"><br><br>  L'intuition sugg√®re que c'est exactement ce dont vous avez besoin, j'ai donc d√©cid√© de me concentrer sur une √©tude approfondie de cette question en vue d'une utilisation ult√©rieure dans le projet. <br><br>  Le stockage cloud est un ensemble de plusieurs produits pour diff√©rentes t√¢ches, qui peuvent √™tre lus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , mais je m'int√©ressais principalement au stockage de table, qui s'est av√©r√© √™tre la base de donn√©es NoSQL. <br><br>  NoSQL est une base de donn√©es sans sch√©ma, c'est-√†-dire dans laquelle la table n'a pas besoin d'√™tre structur√©e √† l'avance.  En fait, la table dans ce cas n'est qu'une partie du chemin d'acc√®s √† ce qu'on appelle la section, ce qui signifie qu'une seule table peut contenir des lignes, par exemple, avec trois et cinq colonnes √† la fois.  Pour bien comprendre les fonctionnalit√©s du stockage de table, je vous conseille de lire attentivement le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">manuel</a> , mais je consid√©rerai ce sujet de mon point de vue banal, car au final le mat√©riel s'adresse aux d√©butants, qui je suis dans ce sujet. <br><br>  <b>Pour commencer, voyons comment cr√©er une table NoSQL:</b> <br><br>  1. Enregistrez un compte Azure <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gratuit</a> .  Si vous avez un abonnement MSDN ou BizSpark et qu'il est d√©j√† activ√© dans Azure, vous pouvez ignorer cette √©tape.  Un compte gratuit vous donne un pr√™t de 200 $ pour le premier mois, puis un acc√®s gratuit √† une certaine quantit√© de ressources de la plupart des services Azure.  Traduit dans un langage compr√©hensible, tout est fait de mani√®re √† ce que vous n'ayez pas √† payer jusqu'√† ce que votre produit gagne suffisamment pour couvrir les d√©penses, sans parler de l'utilisation d'Azure pour l'autoformation. <br><br>  Mais m√™me si vous franchissez le seuil gratuit, les prix d'un stockage de table sont beaucoup plus fid√®les que pour une quantit√© similaire de bases de donn√©es SQL.  Par exemple, au moment de la r√©daction de cet article, j'ai cr√©√© jusqu'√† pr√©sent deux tableaux avec une seule entr√©e.  Pendant 18 jours de la p√©riode de r√©f√©rence, je me suis tourn√© vers elle en moyenne 20 √† 30 fois par jour et 2 kopecks ont √©t√© radi√©s du compte de cr√©dit pour cette p√©riode.  En augmentant ces co√ªts pour le volume pr√©vu, j'ai r√©alis√© qu'ils √©taient plus que couverts par les revenus potentiels de l'application. <br><br>  2. Maintenant que vous avez un compte dans Azure, nous proc√©dons √† la cr√©ation d'un compte de stockage. <br><br><img src="https://habrastorage.org/webt/pk/zf/ci/pkzfciggnj3px9azcypmku_rgd8.png"><br><br>  Vous pouvez tout faire √† partir de la m√™me page de connexion aux services Visual Studio, que j'ai d√©crite ci-dessus.  Si vous avez soudainement ferm√© cette page, vous pouvez l'ouvrir en double-cliquant sur ¬´Services connect√©s¬ª dans l'Explorateur de solutions.  Apr√®s avoir s√©lectionn√© le service requis, une fen√™tre avec les comptes de stockage disponibles s'ouvrira et, pour en ajouter un nouveau, cliquez sur le bouton correspondant. <br><br>  <b>Dans la nouvelle fen√™tre, vous devrez effectuer les √©tapes suivantes:</b> <br><br><ul><li>  Pour commencer, vous devrez vous connecter avec votre compte Microsoft.  Vous devez utiliser le compte auquel vos abonnements sont li√©s ou un compte Azure gratuit. </li><li>  Une fois connect√© √† votre compte, votre abonnement (a) appara√Ætra dans le champ "Abonnement".  Tout est simple avec le choix, donc les commentaires sont superflus. </li><li>  Dans le champ "Nom", indiquez le nom souhait√© du service de stockage.  √âtant donn√© qu'il s'agit √©galement du nom de domaine du service, il doit √™tre unique dans tous les comptes disponibles dans Azure, et pas seulement dans le v√¥tre. </li><li>  Le champ ¬´Cat√©gorie de prix¬ª vous demandera de comprendre les diff√©rences entre une plate-forme cloud et l'h√©bergement conventionnel, car en cliquant sur le lien sous le champ, vous pouvez voir une liste de prix, mais pas une explication intelligible, qui vous donne chaque option.  Bien s√ªr, dans la nature des liens annexes, vous pouvez trouver des informations compl√®tes sur toutes ces abr√©viations comme GRS et LRS, mais cela est superflu pour le d√©veloppeur moyen.  Il suffit de comprendre que plus le tarif est cher, plus les centres de donn√©es seront impliqu√©s dans le traitement et le stockage de vos donn√©es et plus la probabilit√© de leur s√©curit√© est √©lev√©e.  Pour un petit projet, le taux LRS le plus bas est correct. </li><li>  Un ¬´groupe de ressources¬ª est une combinaison de plusieurs services Azure pour une seule gestion.  Dans notre cas, cr√©ez-en un nouveau, attribuez un nom convivial et continuez. </li><li>  La derni√®re chose √† choisir est le ¬´lieu¬ª de votre service.  Par emplacement, on entend l'emplacement r√©el des centres de donn√©es qui seront charg√©s de travailler avec nos donn√©es.  Veuillez noter que je parle au pluriel, car dans une r√©gion il peut y avoir plusieurs centres de donn√©es et le travail peut √™tre r√©parti entre eux (au cas o√π vous choisiriez une cat√©gorie de prix conseill√©e).  Choisissez celui qui est le plus proche de votre base d'utilisateurs principale.  Cependant, si vous pr√©voyez de vous d√©velopper √† l'√©chelle du monde entier et que vous avez besoin d'une r√©ponse maximale partout dans le monde, personne ne vous d√©range pour chaque version r√©gionale de l'application pour cr√©er un compte de stockage distinct et impl√©menter la synchronisation des donn√©es entre eux.  C'est un haut niveau d'extensibilit√© qui est le principal avantage du cloud. </li></ul><br>  3. Apr√®s avoir cr√©√© le compte de stockage, il sera ajout√© √† la liste et vous pourrez continuer en cliquant sur le bouton "Ajouter".  Le r√©sultat de cette action sera l'ajout d'un package NuGet pour travailler avec Azure au projet et l'enregistrement de la cha√Æne de connexion dans le fichier app.config du projet. <br><br>  Malheureusement, il est impossible de travailler avec des valeurs de ce fichier dans UWP (ou peut-√™tre avec de terribles b√©quilles), il vous suffit donc de copier la cha√Æne de connexion vers le service de stockage √† partir de l√† vers un emplacement pratique dans le projet et passez √† l'√©tape suivante. <br><br>  4. Il reste maintenant √† cr√©er une table et √† commencer √† travailler avec elle.  Et c'est ici que commence le travail individuel, en fonction directe des t√¢ches. <br><br>  Le fait est qu'avant de commencer √† cr√©er des tables, vous devez r√©fl√©chir soigneusement √† l'architecture de stockage de vos donn√©es.  Travailler avec le stockage de la table est si pratique que la cr√©ation d'une nouvelle table directement √† partir du code ne prend que quelques lignes, et avec une telle commodit√©, il y a un d√©sir naturel d'allouer une table distincte pour chaque utilisateur, car √† la fin la t√¢che consiste √† synchroniser les donn√©es entre ses appareils.  Cependant, lorsque vous travaillez avec une technologie inconnue, vous ne devez pas prendre de d√©cisions h√¢tives et vous devez soigneusement peser le pour et le contre.  Un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> sp√©cial <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">du manuel</a> peut aider √† prendre la bonne d√©cision, mais pr√©parez-vous √† le relire plusieurs fois, car il est tr√®s difficile d'apprendre toutes les donn√©es tout de suite, surtout en tenant compte de la masse des nouveaux termes. <br><br>  Je vais continuer l'histoire en tenant compte du fait que vous avez toujours lu le manuel et compris certaines des fonctionnalit√©s de l'utilisation du stockage de table.  Par exemple, j'ai r√©alis√© que conceptuellement une table n'est pas une sorte d'unit√© isol√©e et est plut√¥t un endroit pour un regroupement logique d'enregistrements.  Ceci est facile √† comprendre si vous pr√©sentez le tableau comme un dossier dans lequel vous stockez des fichiers de donn√©es.  Un dossier en lui-m√™me ne prend pas d'espace et ne fait pas partie int√©grante des fichiers, mais d√©finit simplement une partie du chemin d'acc√®s aux fichiers qui sont logiques, mais pas n√©cessaires, √† enregistrer dans ce dossier. <br><br>  La conclusion est assez simple - personne ne prend la peine de stocker les param√®tres de tous les utilisateurs dans une table, l'essentiel est que la paire de valeurs dans les colonnes PartitionKey et RowKey est unique √† l'int√©rieur de la table.  Ceci est √† nouveau impl√©ment√© dans mon projet, car l'ID utilisateur agira comme PartitionKey, et par exemple, la cha√Æne ¬´UserName¬ª comme RowKey, ce qui nous permettra de d√©terminer l'enregistrement unique dans lequel le nom d'utilisateur est stock√©.  Mais comme je l'ai dit ci-dessus, nous devons peser tous les avantages et les inconv√©nients, alors pesons: <br><br><ul><li>  "Pour" une table s√©par√©e pour les donn√©es de chaque utilisateur est la commodit√© de percevoir la structure des donn√©es.  Si nous prenons la table comme un dossier avec des fichiers, il est logique que tous les fichiers d'un utilisateur se trouvent dans le m√™me dossier et il est plus courant de travailler avec une telle architecture. </li><li>  Tous les autres facteurs sont ¬´contre¬ª un tableau distinct.  Donn√©es utilisateur dans une table distincte - cette pr√©cision est pratique jusqu'√† ce que le nombre de ces tables soit dans les milliers.  √âtant donn√© que le compte de stockage est un niveau sup√©rieur au-dessus de la table, aucun autre regroupement n'est fourni pour eux. <br><br>  Compte tenu de la base d'utilisateurs potentiels, nous risquons de nous noyer dans des milliers de tables individuelles, de perdre celles qui ont une valeur prioritaire.  Dans le m√™me temps, le stockage des param√®tres de tous les utilisateurs dans un seul tableau simplifie l'administration et le travail avec les donn√©es afin de collecter des informations statistiques ou de mettre en ≈ìuvre des fonctions sociales. <br><br>  De plus, le faible co√ªt d'utilisation du stockage de table vous permet de dupliquer toutes les donn√©es dans des tables distinctes, selon la logique requise.  En particulier, je pr√©vois de cr√©er un tableau suppl√©mentaire avec le nom d'utilisateur, un lien vers l'avatar et une indication d'appartenance au pays, qui sera utilis√© pour les tableaux de notation ou d'autres fonctions sociales qui peuvent √™tre ajout√©es √† l'application. </li></ul><br>  Donc, lorsque vous avez compris la structure de stockage des donn√©es, ajoutons enfin une nouvelle table.  Puisque nous avons refus√© de le cr√©er au niveau du code, deux options restent: via le portail Web Azure ou en utilisant l'outil sp√©cial Microsoft Azure Storage Explorer, qui peut √™tre t√©l√©charg√© √† partir de storageexplorer.com.  Dans les deux cas, il est n√©cessaire de s√©lectionner le compte de stockage souhait√© et dans la section "Service Tables / Tables" de s√©lectionner "+ Table / Cr√©er une table".  Dans la bo√Æte de dialogue qui appara√Æt, entrez le nom souhait√© et validez les modifications. <br><br><img src="https://habrastorage.org/webt/ca/0b/j9/ca0bj92etkk7v2qpp-r63wtymeq.png"><br><br>  Apr√®s cela, vous pouvez travailler avec la nouvelle table du code sans aucun probl√®me. <br><br>  Les principales op√©rations que je vais effectuer avec la table sont l'insertion et l'extraction de lignes, appel√©es ¬´entit√©s¬ª dans la terminologie de stockage de la table.  Un tel terme est plus facile √† comprendre lorsque vous r√©alisez que pour ins√©rer et r√©cup√©rer une entit√©, vous devrez lui mapper une classe h√©rit√©e de TableEntity de Microsoft.WindowsAzure.Storage.Table.  La classe successeur contiendra d√©j√† certains champs obligatoires, tels que, par exemple, PartitionKey (nom de section) et RowKey (nom de ligne), et ces champs que nous impl√©mentons ind√©pendamment seront des colonnes dans la ligne (propri√©t√©s d'entit√©). <br><br>  Prenons un exemple de tableau dans lequel une liste de tous les joueurs avec leur nom, leur avatar et leur appartenance au pays sera stock√©e. <br><br><pre><code class="cs hljs">    : Imports Microsoft.WindowsAzure.Storage Imports Microsoft.WindowsAzure.Storage.Table</code> </pre> <br>  J'ai d√©cid√© de mettre les m√©thodes de travail avec la table dans une classe s√©par√©e pour la commodit√© de travailler √† partir de diff√©rents points de l'application.  Cr√©ez-le et ajoutez imm√©diatement les constantes pr√©c√©demment connues: <br><br><pre> <code class="cs hljs">Public Class AzureWorker Private Const AzureStorageConnectionString As String = <span class="hljs-string"><span class="hljs-string">"  ,     app.config"</span></span> Private Const GamerListTableNameString As String = <span class="hljs-string"><span class="hljs-string">"GamerList"</span></span> <span class="hljs-string"><span class="hljs-string">'    ‚Ä¶ End Class</span></span></code> </pre> <br>  Maintenant, nous devons cr√©er une classe que nous mapperons √† l'entit√© (ligne) √† l'int√©rieur du tableau: <br><br><pre> <code class="cs hljs"> Private Class GamerListClodTableDataClass Inherits TableEntity Public Const RowKeyValue As String = <span class="hljs-string"><span class="hljs-string">"UserID"</span></span> <span class="hljs-function"><span class="hljs-function">Public Sub </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">New</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) RowKey</span></span> = RowKeyValue End Sub Public Property UserName As String = <span class="hljs-string"><span class="hljs-string">""</span></span> Public Property UserountryID As String = <span class="hljs-string"><span class="hljs-string">""</span></span> Public Property UserAvatar As String = <span class="hljs-string"><span class="hljs-string">""</span></span> End Class</code> </pre> <br>  La classe √† mapper doit √™tre h√©rit√©e de TableEntity et avoir des champs pour les donn√©es que nous pr√©voyons de placer dans la table.  Notez que la d√©finition de valeurs pour une RowKey ou une PartitionKey au niveau de la classe n'est pas n√©cessaire, mais dans mon cas, la RowKey est d√©finie car elle est immuable quelle que soit l'autre entr√©e. <br><br>  Mais, comme √† ce stade vous n'avez probablement pas compl√®tement compris l'essence de travailler avec le stockage de table, je vais expliquer la logique √©tablie √† ce stade.  Le moyen le plus rapide de travailler avec une table consiste √† interroger l'entit√© par le nom de la cha√Æne et le nom de la section, vous devez donc conna√Ætre ces donn√©es √† l'avance.  De plus, la combinaison de PartitionKey et RowKey doit √™tre unique dans la table, ce qui signifie qu'il est logique d'√©crire un ID utilisateur unique dans l'une de ces cl√©s et d'attribuer √† la deuxi√®me cl√© un nom que nous conna√Ætrons toujours.  C'est exactement ce qui se fait dans la classe GamerListClodTableDataClass. <br><br>  La derni√®re √©tape pr√©paratoire avant les requ√™tes directes sur la table est la cr√©ation de son objet dans une fonction distincte: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Private Shared Function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCloudTable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tableName As String</span></span></span><span class="hljs-function">) As CloudTable Dim storageAccount As CloudStorageAccount</span></span> = CloudStorageAccount.Parse(AzureStorageConnectionString) Dim tableClient As CloudTableClient = storageAccount.CreateCloudTableClient() Dim table As CloudTable = tableClient.GetTableReference(tableName) Return table End Function</code> </pre> <br>  Ceci est fait pour ne pas dupliquer le code chaque fois que nous voulons lire ou √©crire des donn√©es dans la table.  Veuillez noter que ce code ne fait pas de requ√™tes directes sur le cloud et sera ex√©cut√© sans probl√®me en l'absence de connexion.  Il ne fait que cr√©er √©tape par √©tape un objet table √† partir de donn√©es existantes, telles que la cha√Æne de connexion de stockage et le nom de la table. <br><br>  Enfin, passons √† l'utilisation directe de la table et commen√ßons par enregistrer les donn√©es utilisateur actuelles: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Public Shared Async Function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SavedOrUpdateUserData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">u As UserManager</span></span></span><span class="hljs-function">) As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of Boolean</span></span></span><span class="hljs-function">) Dim table As CloudTable</span></span> = GetCloudTable(GamerListTableNameString) Try If Await table.ExistsAsync Then Dim UserDataClodTableData As New GamerListClodTableDataClass With {.PartitionKey = u.UserId, .UserName = u.UserName.Trim, .UserountryID = u.UserountryID, .UserAvatar = <span class="hljs-string"><span class="hljs-string">"https://apis.live.net/v5.0/"</span></span> &amp; u.UserId &amp; <span class="hljs-string"><span class="hljs-string">"/picture"</span></span>} Dim insertOperation As TableOperation = TableOperation.InsertOrReplace(UserDataClodTableData) Await table.ExecuteAsync(insertOperation) Return True End If Catch ex As Exception End Try Return False End Function</code> </pre> <br>  La requ√™te est effectu√©e en tant que fonction asynchrone afin que le code appelant puisse obtenir le r√©sultat de l'ex√©cution (True en cas de succ√®s et False en cas d'√©chec).  En outre, un param√®tre du type UserManager est transmis √† la fonction, qui est une r√©f√©rence √† la classe avec des donn√©es utilisateur.  Nous avons cr√©√© une telle classe dans un article pr√©c√©dent, √† la seule diff√©rence que dans cette version, il existe un champ UserountryID qui stocke des donn√©es sur le pays de l'utilisateur. <br><br>  Pour les requ√™tes sur la table, vous devez d'abord cr√©er son objet en utilisant la cha√Æne de connexion au r√©f√©rentiel et le nom de la table (nous avons mis ce processus dans une fonction distincte plus t√¥t).  Ensuite, vous devez v√©rifier l'existence de la table et, bien que nous soyons s√ªrs que nous ayons une table avec ce nom, une erreur peut se produire, par exemple, en raison d'un manque de connectivit√© r√©seau ou en raison d'une d√©faillance dans le cloud (c'est pourquoi ce code est plac√© dans le Try / Catch).  Ensuite, avant d'√©crire dans la table, vous devez cr√©er une instance de la classe UserDataClodTableData et affecter la valeur requise √† ses champs, puis seulement cr√©er l'op√©ration InsertOrReplace.  Comme vous pouvez le deviner √† partir du nom de l'op√©ration, il ins√©rera une nouvelle ligne dans la table si des lignes avec la m√™me paire de PartitionKey et RowKey n'existent pas dans la table et remplacera les donn√©es si une telle ligne existe d√©j√†.  Eh bien, l'√©quipe finale ExecuteAsync, en fait, effectuera l'action pr√©vue du c√¥t√© du stockage de la table. <br><br>  La lecture des donn√©es d'une table est aussi simple que leur √©criture.  Demandons par exemple un nom d'utilisateur: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Public Shared Async Function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUserName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id As String</span></span></span><span class="hljs-function">) As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of String</span></span></span><span class="hljs-function">) Dim table As CloudTable</span></span> = GetCloudTable(GamerListTableNameString) Try If Await table.ExistsAsync Then Dim retrieveOperation As TableOperation = TableOperation.Retrieve(Of GamerListClodTableDataClass)(id, GamerListClodTableDataClass.RowKeyValue) Dim retrievedResult As TableResult = Await table.ExecuteAsync(retrieveOperation) If retrievedResult.<span class="hljs-function"><span class="hljs-function">Result IsNot Nothing Then Return </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">retrievedResult.Result, GamerListClodTableDataClass</span></span></span><span class="hljs-function">).UserName End If End If Catch ex As Exception End Try Return "" End Function</span></span></code> </pre> <br>  Ce code ne diff√®re presque pas du pr√©c√©dent et commence √©galement par cr√©er un objet table et v√©rifier son existence.  De plus, comme en enregistrement, nous cr√©ons une op√©ration, mais cette fois une op√©ration d'extraction, qui n√©cessite l'indication de PartitionKey et RowKey.  Apr√®s cela, nous extrayons le r√©sultat √† l'aide d'ExecuteAsync et travaillons avec l'objet r√©sultant du type TableResult, ce qui revient en fait √† convertir la propri√©t√© Result en type de classe en cours de mappage et en extrayant le nom d'utilisateur. <br><br>  Travailler avec une table n'est pas limit√© aux op√©rations de lecture et d'√©criture et prend en charge de nombreux scripts diff√©rents.  Par exemple, vous pouvez cr√©er une requ√™te qui extraira toutes les entit√©s avec la cl√© de partition sp√©cifi√©e ou toutes les entit√©s qui ont le champ sp√©cifi√©, mais il est important de se rappeler la vitesse de ces op√©rations, ainsi que la quantit√© de donn√©es qui seront transmises sur le r√©seau. <br><br>  L'exemple ci-dessus est le plus optimal du point de vue de la vitesse de requ√™te, car le syst√®me d'adressage trouvera tr√®s probablement une entit√© le long du chemin "nom de stockage \ nom de table \ PartitionKey + RowKey", cependant, pour obtenir un seul nom, nous chargeons l'entit√© enti√®re dans son ensemble, ce qui n'est pas avantageux sur la quantit√© de donn√©es transf√©r√©es. <br><br>  Voici un code de fonction modifi√© tenant compte de l'optimisation maximale des requ√™tes: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Public Shared Async Function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUserName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id As String</span></span></span><span class="hljs-function">) As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of String</span></span></span><span class="hljs-function">) Dim table As CloudTable</span></span> = GetCloudTable(GamerListTableNameString) Try If Await table.<span class="hljs-function"><span class="hljs-function">ExistsAsync Then Dim projectionQuery As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TableQuery</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of DynamicTableEntity</span></span></span><span class="hljs-function">)</span></span> = <span class="hljs-function"><span class="hljs-function">New </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TableQuery</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of DynamicTableEntity</span></span></span><span class="hljs-function">)(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>).</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Where</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TableQuery.CombineFilters(TableQuery.GenerateFilterCondition(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"PartitionKey"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, QueryComparisons.Equal, id</span></span></span><span class="hljs-function">), "and", TableQuery.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateFilterCondition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"RowKey"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, QueryComparisons.Equal, GamerListClodTableDataClass.RowKeyValue</span></span></span><span class="hljs-function">))).</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Select</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"UserName"</span></span></span></span><span class="hljs-function"><span class="hljs-params">}</span></span></span><span class="hljs-function">) Dim resolver As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EntityResolver</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of String</span></span></span><span class="hljs-function">)</span></span> = Function(pk, rk, ts, props, etag) <span class="hljs-function"><span class="hljs-function">Return </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">props</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"UserName"</span></span></span></span></span><span class="hljs-function">).StringValue End Function Dim result As </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TableQuerySegment</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Of String</span></span></span><span class="hljs-function">)</span></span> = Await table.ExecuteQuerySegmentedAsync(projectionQuery, resolver, Nothing) If result.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-function">Then Return </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">result</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">) End If End If Catch ex As Exception End Try Return "" End Function</span></span></code> </pre> <br>  Au lieu de cr√©er un objet op√©ration, dans ce code, nous cr√©ons un objet requ√™te qui contient plusieurs m√©thodes pour d√©terminer ce qui doit √™tre obtenu en cons√©quence.  La m√©thode Where cr√©e un filtre qui indique la n√©cessit√© de renvoyer uniquement les lignes pour lesquelles PartitionKey et RowKey sont √©gales aux valeurs sp√©cifi√©es, et la prochaine s√©lection indique que seule la colonne UserName doit √™tre s√©lectionn√©e. <br><br>  Avec une telle requ√™te, cela n'a aucun sens de comparer le r√©sultat avec n'importe quelle classe, par cons√©quent, l'IDictionary est utilis√© comme valeur de retour, o√π la cl√© est le nom de la colonne et la valeur est son contenu.  √âtant donn√© que la fonction ExecuteQuerySegmentedAsync ne sait pas quel r√©sultat de son ex√©cution sera obtenu, il est possible (et dans ce cas n√©cessaire) de passer un d√©l√©gu√© EntityResolver, qui fait r√©f√©rence √† une fonction qui prend la valeur souhait√©e dans le dictionnaire.  Le r√©sultat de tout cela devient TableQuerySegment dans le premier index dont le nom de l'utilisateur demand√© est stock√©. <br><br>  En g√©n√©ral, l'utilisation de requ√™tes au lieu de l'op√©ration d'extraction de base vous permet d'√©tendre consid√©rablement les possibilit√©s de travailler avec une table, mais soyez prudent, car contrairement au SQL classique, ici la vitesse de traitement des requ√™tes d√©pend directement de ses param√®tres.  Personne ne vous d√©range pour ex√©cuter une requ√™te afin de r√©cup√©rer tous les enregistrements utilisateur dont les noms sont √©gaux √† celui donn√©, mais une telle requ√™te sera plus longue que son homologue en SQL.  Pour l'apprendre, je vous renvoie une fois de plus au guide de conception de table auquel j'ai fait r√©f√©rence ci-dessus, et je vous recommande √©galement d'√©tudier l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> , qui fournit des exemples sur l'utilisation du stockage de table. <br><br>  <i>Important!</i>  <i>Les articles de lien utilisent du code pour les applications .NET classiques et sont diff√©rents de l'impl√©mentation UWP.</i>  <i>Heureusement, cette diff√©rence n'est pas significative et les analogues sont intuitifs (le plus souvent, les diff√©rences sont dans le pr√©fixe Async).</i> <br><br>  En conclusion, je partagerai les r√©sultats de l'utilisation du stockage Azure dans mon projet pour le moment.  Au premier d√©marrage, apr√®s avoir re√ßu l'ID utilisateur et t√©l√©charg√© les donn√©es depuis le Live ID, je lui propose de choisir un alias (pseudo) au cas o√π le nom stock√© dans le profil ne lui conviendrait pas.  Ensuite, le surnom entr√© est enregistr√© dans la classe UserManager au lieu de la norme, et toutes ces donn√©es sont enregistr√©es dans la table GamerList.  Au prochain d√©marrage, l'ID utilisateur est re√ßu en arri√®re-plan et un alias est demand√© au r√©f√©rentiel.  En cons√©quence, l'utilisateur voit son surnom dans le jeu, et non le nom du profil standard. <br><br>  √âgalement √† l'avenir, un tableau avec une liste d'utilisateurs sera utile pour entrer des fonctions sociales dans le jeu et, maintenant, j'ai trouv√© au moins une application pour ces donn√©es.  Dans la mise en ≈ìuvre de cette t√¢che, les outils Azure tels que le stockage de file d'attente et les fonctions Azure m'aideront √† nouveau, mais j'en parlerai dans l'un des articles suivants. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr414261/">https://habr.com/ru/post/fr414261/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr414245/index.html">Mod√®le de r√©gression polynomiale</a></li>
<li><a href="../fr414249/index.html">Infrastructure √† cl√© publique: biblioth√®que GCrypt comme alternative √† OpenSSL avec prise en charge de la cryptographie russe</a></li>
<li><a href="../fr414251/index.html">D√©veloppement sans programmation: apr√®s tout, hack de vie?</a></li>
<li><a href="../fr414253/index.html">Mod√®les pour les testeurs. Proxy (alternatif)</a></li>
<li><a href="../fr414255/index.html">R√™ve brevet√© du programmeur - Partie II</a></li>
<li><a href="../fr414263/index.html">Y a-t-il de la vie en dehors de Roscosmos? Aper√ßu de l'exploration de l'espace priv√© russe</a></li>
<li><a href="../fr414265/index.html">Richard Hamming: Chapitre 7. Intelligence artificielle - II</a></li>
<li><a href="../fr414267/index.html">Comment remplacer un comptable par un robot?</a></li>
<li><a href="../fr414269/index.html">"20 000 IOPS par n≈ìud sont de bonnes performances avec une latence de 5 ms." Pour OLTP - non</a></li>
<li><a href="../fr414271/index.html">Comment apprivoiser un disque dur dans un ordinateur portable et emp√™cher le stationnement en 8 secondes d'arr√™t</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>