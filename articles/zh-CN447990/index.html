<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🤝‍👨🏽 🤞🏼 ✌🏽 最初是使用Spedgan进行的经典Dendy或Contra游戏的骇客故事 👨‍👨‍👦‍👦 🎮 ☝🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="自从我上一篇文章以来，令我感到非常惊讶的是，您对此感兴趣。 我决定对其结果进行补充，该游戏是“ Contra（J）[T + Rus_Chronix]”游戏的黑手版本，具有一些功能，同时在NES上显示“代码注入”。 这次，我将让玩家使用抽水的Spreadgun开始游戏，要使其进入游戏，您需要选择图标“...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>最初是使用Spedgan进行的经典Dendy或Contra游戏的骇客故事</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/447990/"><p> 自从我上<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一篇文章</a>以来，令我感到非常惊讶的是，您对此感兴趣。 我决定对其结果进行补充，该游戏是“ Contra（J）[T + Rus_Chronix]”游戏的黑手版本，具有一些功能，同时在NES上显示“代码注入”。 这次，我将让玩家使用抽水的Spreadgun开始游戏，要使其进入游戏，您需要选择图标“ S”，然后选择“ R”。 </p><br><p><img src="https://habrastorage.org/webt/nd/lc/4a/ndlc4arnoooy49jv50nfqggzdey.png"></p><br><p> 所有感兴趣的猫都欢迎。 <a name="habracut"></a></p><br><p> 传统上： </p><br><div class="spoiler">  <b class="spoiler_title">无聊乏味的视频录制过程</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/6QTlZS0Gl9A" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><p> 而且我们传统上计划采取行动的顺序。 </p><br><ol><li> 查找地址 </li><li> 找出抽扩散枪的价值 </li><li> 在游戏开始时找出他在这些地址上写的内容 </li><li> 改写ROM <br><ul><li>  Easyway-将基本武器的价值更改为抽水式 </li><li> 困难-如果简单方法失败，请使用完整代码注入 </li></ul></li><li> 将结果保存到新文件 </li></ol><br><p> 为了搜索地址，我们使用前面描述的方法，但是请记住，生活地点在相邻地址中，我们只会从第一位玩家那里寻找武器，希望第二位玩家会在附近。 在第一个级别开始后，打开“ Ram watch”窗口，我们在寻找未知值。 我相信基本武器设置为0，但我不确定。 <br> 我们沿着关卡奔跑而没有前进，向各个方向射击并清除变化的值。 武器尚未改变。 </p><br><p> 让我们使用另一个窗口选项，或者在字段“ Compare To / By”中突出显示射频“ Number of Changes”，将其放在字段0中。比较的类型当然是“等于”。 武器仍然没有改变。 </p><br><p> 因此，从选项“等于上一个值”跳转到选项“更改数量为0”，您可以访问大约10,000个地址。 当进一步的筛选会略微减少或根本不减少地址列表时，人们可以前进得足够远，以击倒第一个武器。 </p><br><p> 拾取后，我们立即使用搜索方法“不等于先前的值”，并通过搜索“更改次数为1”来进一步减少列表，武器仅更改了一次。 </p><br><p> 在我们拿起第一把武器的地方，还出现了一个武器放大器。 选择并拾取它后，您可以将地址数量减少到1，但是如果不能解决，只需杀死角色并再次更改武器即可。  （每次更改后都不要忘记搜索）。 </p><br><p> 使用武器放大器时，存在一些风险，即它不会更改武器本身的值，而是会更改内存中其他位置的标志，但我们希望游戏的作者能够保存内存和说明。 而且，我很幸运，奖金“ R”改变了武器的价值，地址在AA <sub>16</sub>坐标处。  （我可能是错的，但是我在不同版本的《魂斗罗》游戏中反复监视了英雄的武器，就像这个地址到处都是AA <sub>16一样</sub> ）。 </p><br><p> 我还注意到奖金“ R”将地址中的值增加了16 <sub>10</sub>或10 <sub>16</sub> ，即，将十六进制数字的第一位增加了1。 </p><br><p> 在“ Ram watch”窗口中重新启动之后，可以看到基本值为00 00，奖金“ M”将第二个数字增加了1，奖金“ R”则将第一个数字增加了。 </p><br><p> 您可以购买一个Spreadgan，它肯定会在此级别满足要求，或者您可以更改地址的值，以查看它们生成的数字，武器。 根据经验，我发现01 <sub>16</sub>是“机枪”，02 <sub>16</sub>是“火”，03 <sub>16</sub>是“散弹枪”，04 <sub>16</sub>是“激光”。 当您在第二个数字中输入其他值时，会出现各种故障。 </p><br><p> 在重置游戏并输入值1x <sub>16</sub>之后（其中“ x”是任何可接受的选项），然后再选择“快速”奖励，您会发现重新选择奖励不会改变任何内容。 </p><br><p> 现在您可以重新启动游戏，启动游戏两次，然后尝试更改与AA <sub>16</sub>相邻的地址。  （其中有两个，搜索时间不会很长。）在射击了第二名玩家之后，我很快发现第二名玩家的武器确实存放在AB <sub>16号</sub>附近。 现在我们知道了我们感兴趣的地址以及应该在其中添加的值，是时候找出他在这些地址中写的内容了。 </p><br><p> 在此地址的记录上抛出一个断点，我发现记录在那里发生了几次，其中一个在启动屏幕之后。 以下代码进行输入： </p><br><table><thead><tr><th> 住址 </th><th> 操作码 </th><th> 助记符 </th><th> 争论 </th><th> 一 </th><th>  X </th></tr></thead><tbody><tr><td>  C307 </td><td>  A2 28 </td><td>  LDX </td><td>  ＃$ 28 </td><td>  ?? </td><td>  ?? </td></tr><tr><td>  C309 </td><td>  A9 00 </td><td>  Lda </td><td>  ＃$ 00 </td><td>  ?? </td><td>  28或29或...或F0 </td></tr><tr><td>  C30B </td><td>  95 00 </td><td>  STA </td><td>  $ 00，X </td><td>  00 </td><td>  28或29或...或F0 </td></tr><tr><td>  C30d </td><td>  E8 </td><td>  x </td><td></td><td>  00 </td><td>  28或29或...或F0 </td></tr><tr><td>  C30e </td><td>  E0 F0 </td><td>  CPX </td><td>  ＃$ F0 </td><td>  00 </td><td>  29或30或...或F0 </td></tr><tr><td>  C310 </td><td>  D0 F9 </td><td> 贝内 </td><td>  $ C30B </td><td>  00 </td><td>  29或30或...或F0 </td></tr></tbody></table><br><p> 如果您仔细阅读游戏，此处的地址范围将从0028 <sub>16</sub>到00F0 <sub>16</sub> ，这显然是我们感兴趣的两个地址范围。 因此，没有简单的方法。 我将不得不使用“代码注入”和我所看到的最简单的解决方案来找出从这里得到的地址，将执行重定向到内存中没有代码和数据的某个位置，在此处写入我的循环版本，该地址占据整个范围，除了地址00AA <sub>16</sub>和00AB <sub>16</sub>并返回回车执行回来。 顺便说一句，这是注射的最经典版本。 您还可以假设我们是从JSR（跳转到SubRoutine）指令获得的，这很容易通过堆栈进行检查。 </p><br><div class="spoiler">  <b class="spoiler_title">堆栈如何工作？</b> <div class="spoiler_text"><p> 在6502处理器中，对于基于该处理器的所有计算机，堆栈始终位于地址范围0100 16-01FF <sub>16</sub>中，并且从较大的地址增长到较小的地址。 有一个指向栈顶的单独寄存器，最初它等于FF <sub>16，</sub>因为更高有效字节永不改变。 寄存器本身始终指示未占用有用数据的最高字节。 </p></div></div><br><p> 仿真器调试器不显示“堆栈指针”寄存器的值，而是显示该寄存器所指向的地址，现在是01F2 <sub>16</sub> ，简单的计算表明堆栈上的最后一个数据是C3 <sub>16</sub>和C2 <sub>16</sub> ，这可能导致我考虑的是地址C3C2 <sub>16，</sub>但是6502是“ Little Endian”类型的处理器，因此，当执行指令并将地址存储在内存或堆栈中时，低位有效字节将首先写入。 如果该地址确实位于堆栈的顶部，则为地址C2C3 <sub>16</sub> 。 而且，这是JSR指令的最后一个参数的地址，如果它还是一个地址的话。 检查非常容易，只需查看在地址C2C3 <sub>16</sub>上方两个字节写入的内容。 </p><br><table><thead><tr><th> 住址 </th><th> 操作码 </th><th> 助记符 </th><th> 争论 </th></tr></thead><tbody><tr><td>  C2C1 </td><td>  20 07 C3 </td><td>  s </td><td>  $ C307 </td></tr></tbody></table><br><p> 如您所见，这是C307 <sub>16</sub>的JSR指令，这意味着子例程的假设是正确的。 </p><br><p> 现在，您需要正确编写注入代码，为其找到合适的位置，将其写入该位置，并将JSR指令重定向到该注入。 </p><br><div class="spoiler">  <b class="spoiler_title">帮助网站</b> <div class="spoiler_text"><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">操作码</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">指令</a> ，有关<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">6502程序集</a>的大量信息。 </p></div></div><br><p> 为此，使用记事本非常方便，我拥有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Visual Studio Code</a> 。 每个人都有自己的写作风格，我个人是第一个编写带有地址的JSR指令的人，以便知道在哪里更改以及完整的操作码，以便知道要更改的内容。 </p><br><p> 经过几次缩进后，我复制了循环代码，它可以在没有地址的情况下使用，但是查看带有操作码以外参数的助记符非常有用，并且抓住该循环之后的指令以及地址以了解从注入返回的位置非常有用。 </p><br><pre><code class="plaintext hljs">C2C1:20 07 C3 JSR $C307 A2 28 LDX #$28 A9 00 LDA #$00 95 00 STA $00,X E8 INX E0 F0 CPX #$F0 D0 F9 BNE $C30B C312:A2 07 LDX #$07</code> </pre> <br><p> 您可以在下面的几个缩进中编写注入本身的代码，实际上，它是循环本身的重复，并带有一些附加内容。 </p><br><pre> <code class="plaintext hljs">C312:A2 07 LDX #$07 A2 28 LDX #$28 A9 00 LDA #$00 95 00 STA $00,X E8 INX E0 AA CPX #$AA D0 F9 BNE -7 A9 13 LDA #$13 95 00 STA $00,X E8 INX E0 AC CPX #$AC D0 F9 BNE -7 A9 00 LDA #$00 95 00 STA $00,X E8 INX E0 F0 CPX #$F0 D0 F9 BNE -7</code> </pre> <br><p> 为了清楚起见，我指出了缩进而不是跳转位置地址。 </p><br><div class="spoiler">  <b class="spoiler_title">如果您无法阅读此代码</b> <div class="spoiler_text"><p> 这是相同的周期，但分为三个部分，在第一个周期中，我们将寄存器X与值A <sub>16</sub>进行比较，因为我们需要将所有地址清零到地址00AA <sub>16</sub> ，然后将13 <sub>16</sub>放入寄存器A中，然后将抽运的电子枪的值写入第二个周期它将其发送到地址00AC <sub>16，</sub>从该地址起，应再次将范围的其余部分清零。 我们返回到寄存器A零，并将范围的其余部分归零。 </p></div></div><br><p> 必须在最后完成注射返回指令。 </p><br><pre> <code class="plaintext hljs">E0 F0 CPX #$F0 D0 F9 BNE -7 4C 12 C3 JMP $C312</code> </pre> <br><p> 现在，为了方便起见，我更喜欢在文件中编写以下操作码。 </p><br><pre> <code class="plaintext hljs">4C 12 C3 JMP $C312 A2 28 A9 00 95 00 E8 E0 AA D0 F9 A9 13 95 00 E8 E0 AC D0 F9 A9 00 95 00 E8 E0 F0 D0 F9 4C 12 C3</code> </pre> <br><p> 计算完操作码后，很容易发现其中有32个。 因此，您需要在ROM上找到20 <sub>16个</sub>未占用的地址。 通常，未使用的地址是具有相同值的大空间，通常是零或FF16 <sub>。</sub>这是一个很大的块，需要找到，它必须至少有35 <sub>个10个</sub>地址，以便有一定的余量。 </p><br><p> 在“十六进制编辑器”中，我在B29E <sub>16</sub> -BFFF <sub>16中</sub>找到了这样一个范围。 使用此类免费站点的开头进行注入可能很危险，因此建议您在末尾编写注入代码。 开始注入最方便的地址是BFE0 <sub>16</sub> ，但这是控制台内存中的地址，以找出它在ROM文件中的位置，右键单击它，然后选择“在ROM文件中转到此处”。 </p><br><p> 现在，您可以在此处复制粘贴整个操作码（32个值）。 最终触摸更改说明 </p><br><pre> <code class="plaintext hljs">C2C1:20 07 C3 JSR $C307</code> </pre> <br><p> 跳转到我拥有的注入地址是BFE0 <sub>16</sub> 。 </p><br><pre> <code class="plaintext hljs">C2C1:20 E0 BF JSR $BFE0</code> </pre> <br><p> 当然，在ROM上找到真正的指令位置。 </p><br><div class="spoiler">  <b class="spoiler_title">不专心的专业人士的答案。</b> <div class="spoiler_text"><p>  JSR指令的地址到达堆栈，因此，无论跳转的位置如何，都将存在相同的返回地址，并且从注入开始，我们将使用不影响堆栈的JMP指令返回代码。 因此，RTS指令在没有注入的地方工作，并返回到没有注入的地方。 结果，该注入不会破坏堆栈。 </p></div></div><br><p>  PS永远来说，您仍然需要确保角色死后能够以大量传播的方式重生，但是我敢肯定，有了所掌握的知识，您就可以自己解决这个问题。 我将目光转向其他事物。 以Unity引擎为例。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN447990/">https://habr.com/ru/post/zh-CN447990/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN447976/index.html">照相灯的开发和组装</a></li>
<li><a href="../zh-CN447980/index.html">为什么必须为您的企业投资和开发品牌的出租车应用程序？</a></li>
<li><a href="../zh-CN447982/index.html">摘要：有关家庭影院屏幕和投影仪的10种材料</a></li>
<li><a href="../zh-CN447984/index.html">优步已提交IPO文件</a></li>
<li><a href="../zh-CN447986/index.html">完美配色的数学故事</a></li>
<li><a href="../zh-CN447992/index.html">找出VK用户的年龄或社交图还能显示什么</a></li>
<li><a href="../zh-CN447994/index.html">Tox-rs的漫长旅程。 第一部分</a></li>
<li><a href="../zh-CN447996/index.html">科学家如何研究控制人体完全再生的基因</a></li>
<li><a href="../zh-CN447998/index.html">Visual Studio Enterprise 2019中的时间旅行调试</a></li>
<li><a href="../zh-CN448000/index.html">如何在Laravel中快速尝试CQRS / ES或在PHP中编写银行</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>