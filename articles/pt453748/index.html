<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ò™Ô∏è üßôüèº üò† Prototipar um jogo para celular, por onde come√ßar e como faz√™-lo. Parte 3 (final) üëçüèø üë©üèΩ‚Äçüè´ üíÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na primeira parte, falei sobre por que a prototipagem e em geral por onde come√ßar 
 - Parte 1 

 Na segunda parte, uma pequena amostra das principais ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Prototipar um jogo para celular, por onde come√ßar e como faz√™-lo. Parte 3 (final)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453748/">  Na primeira parte, falei sobre por que a prototipagem e em geral por onde come√ßar <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parte 1</a> <br><br>  Na segunda parte, uma pequena amostra das principais classes <br>  e arquitetura - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">parte 2</a> <br><br>  E a terceira parte - na verdade, haver√° um pouco de discuss√£o, analisaremos como os modificadores funcionam e entraremos em campo (isso n√£o √© dif√≠cil, mas h√° nuances).  E um pouco sobre arquitetura, tentarei sem t√©dio. <br><br>  As capturas de tela sobre o foguete geralmente s√£o mon√≥tonas, ent√£o sugiro assistir a um v√≠deo de outro prot√≥tipo, que foi montado em duas semanas junto com os gr√°ficos, e foi abandonado devido ao fato de que no g√™nero de plataformas n√£o h√° maneira de contornar.  A prop√≥sito, essa √© uma das id√©ias principais em torno do prot√≥tipo - montar, ver se isso √© uma merda, √© necess√°rio?  E honestamente jogue na cesta se as respostas n√£o parecerem convincentes para voc√™.  Mas!  Isso n√£o se aplica a projetos criativos - √†s vezes a criatividade acontece em prol da criatividade). <br><br>  Ent√£o vidosik, voc√™ precisa olhar para os textos organizados por n√≠vel, e n√£o para a jogabilidade): <br><iframe width="560" height="315" src="https://www.youtube.com/embed/lY8e1igkzI0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="habracut"></a><br><br><h3>  Pequena digress√£o </h3><br>  No √∫ltimo artigo, recebi o c√≥digo de revis√£o e sou grato por isso; as cr√≠ticas ajudam a se desenvolver mesmo que voc√™ n√£o concorde. <br><br>  <b>Mas quero implantar a arquitetura e a sintaxe em rela√ß√£o aos prot√≥tipos:</b> <br><ol><li>  N√£o importa o qu√£o legal voc√™ seja, voc√™ n√£o pode apenas prever que n√£o haver√° hipoteca, e pode haver muita hipoteca do que n√£o √© necess√°rio.  Portanto, em qualquer caso, ser√° necess√°ria refatora√ß√£o ou expans√£o.  Se voc√™ n√£o conseguir descrever os benef√≠cios espec√≠ficos do c√≥digo / abordagem, √© melhor n√£o gastar muito tempo nesse c√≥digo. </li><li>  Por que, na minha opini√£o, OOP / modelo / composi√ß√£o de eventos √© mais f√°cil para prot√≥tipos do que ECS, Unity COOP, DI FrameWorks, estruturas reativas, etc.  Com menos rabiscos, todas as conex√µes s√£o vis√≠veis no c√≥digo, porque a principal tarefa do prot√≥tipo √© responder √† pergunta principal - √© poss√≠vel reproduzi-lo e v√°rias secund√°rias - o que √© melhor para a jogabilidade, isso ou aquilo.  Portanto, voc√™ precisa implementar a funcionalidade necess√°ria o mais r√°pido poss√≠vel.  Por que introduzir uma estrutura em um projeto pequeno, prescrever todo o lixo para implementar tr√™s entidades do jogo?  Cada uma delas √© na verdade uma classe de 50 a 100 linhas.  A arquitetura deve ser pensada como parte das tarefas de prot√≥tipo e como parte de uma poss√≠vel extens√£o para alfa, mas a segunda √© necess√°ria mais na cabe√ßa do que no c√≥digo, para que voc√™ n√£o queime ao adicionar c√≥digo </li></ol><br><br><h3>  Sobre modificadores: </h3><br>  <b>E finalmente sobre o pr√≥prio modificador:</b> <br>  Aqui e antes, chamo os modificadores de campos de for√ßa em que o foguete toca e que afetam seu caminho. No prot√≥tipo, existem dois tipos deles - acelera√ß√£o e deflex√£o. <br><br><div class="spoiler">  <b class="spoiler_title">Classe modificadora</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PushSideModificator</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonoBehaviour</span></span></span><span class="hljs-class"> </span></span>{ [SerializeField] TypeOfForce typeOfForce = TypeOfForce.Push; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> force; [SerializeField] DropPanelConfig dropPanelConfig; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> boundsOfCollider; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTriggerEnter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collider other)</span></span></span><span class="hljs-function"> </span></span>{ boundsOfCollider = other.bounds.extents.x; GlobalEventAggregator.EventAggregator.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpaceForces { TypeOfForce = typeOfForce, Force = force, ColliderBound = boundsOfCollider, CenterOfObject = transform.position, IsAdded = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTriggerExit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collider other)</span></span></span><span class="hljs-function"> </span></span>{ GlobalEventAggregator.EventAggregator.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpaceForces { CenterOfObject = transform.position, IsAdded = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> }); } }</code> </pre> <br></div></div><br>  Esta √© uma classe muito simples cuja tarefa √© passar dois eventos: <br><ol><li>  A entrada do jogador no campo (que na verdade √© um gatilho de unidade f√≠sica) e todo o contexto necess√°rio - o tipo de modificador, sua posi√ß√£o, o tamanho do colisor, a for√ßa do modificador e assim por diante.  Neste, al√©m do evento do agregador, ele pode transmitir qualquer contexto √†s partes interessadas.  Nesse sentido, este √© um modelo de foguete que processa o modificador. </li><li>  O segundo evento - o jogador deixou o campo.  Para remover sua influ√™ncia na trajet√≥ria do jogador </li></ol><br>  <b>Para que serve o modelo de evento?</b>  <b>Quem mais pode precisar deste evento?</b> <b><br></b>  <b>No projeto atual, isso n√£o √© implementado, mas:</b> <br><ol><li>  Atua√ß√£o por voz (recebeu um evento em que algu√©m entrou em campo - tocamos o som correspondente, algu√©m saiu - da mesma forma) </li><li>  Marcadores de interface do usu√°rio, digamos que, para cada campo, removeremos um pouco de combust√≠vel do foguete, as dicas de ferramentas devem parecer que entramos no campo e perdemos combust√≠vel, ou ganhar pontos por cada acerto no campo; h√° muitas op√ß√µes nas quais a interface est√° interessada no jogador. o campo. </li><li>  Especial  efeitos - quando atingidos em um tipo diferente de campo, efeitos diferentes podem ser sobrepostos, tanto no pr√≥prio foguete quanto no espa√ßo ao redor do foguete / campo.  Especial  os efeitos podem ser tratados por uma entidade / controlador separado, que tamb√©m ser√° inscrito nos eventos dos modificadores. </li><li>  Bem, isso √© um m√≠nimo de c√≥digo, localizadores de servi√ßo, agrega√ß√£o, depend√™ncias etc. n√£o s√£o necess√°rios. </li></ol><br><br><h3>  Base de jogabilidade </h3><br>  Neste prot√≥tipo, a ess√™ncia da jogabilidade √© colocar modificadores no campo de jogo, ajustando a trajet√≥ria de v√¥o do foguete, para contornar obst√°culos e atingir o ponto / planeta de destino.  Para fazer isso, temos um painel √† direita, no qual est√£o localizados √≠cones de modificadores. <br><br><img src="https://habrastorage.org/webt/lj/eb/ga/ljebgar88u47kcyxyhz_6kzxyke.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">Classe do painel</b> <div class="spoiler_text"><pre> <code class="java hljs"> [RequireComponent (typeof(CanvasGroup))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DragAndDropModifiersPanel</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonoBehaviour</span></span></span><span class="hljs-class"> </span></span>{ [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DropModifiersIcon iconPrfb; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DropPanelConfig config; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CanvasGroup canvasGroup; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ GlobalEventAggregator.EventAggregator.AddListener&lt;ButtonStartPressed&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, RocketStarted); canvasGroup = GetComponent&lt;CanvasGroup&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RocketStarted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ButtonStartPressed obj)</span></span></span><span class="hljs-function"> </span></span>{ canvasGroup.DOFade(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); (canvasGroup.transform as RectTransform).DOAnchorPosX(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; x++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mod = config.GetModifierByType(TypeOfForce.Push); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> go = Instantiate(iconPrfb, transform); go.Init(mod); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; x++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mod = config.GetModifierByType(TypeOfForce.AddSpeed); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> go = Instantiate(iconPrfb, transform); go.Init(mod); } } }</code> </pre> <br></div></div><br><br>  Antecipando perguntas: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; x++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>; x++)</code> </pre><br><br>  3 e 1 - os chamados n√∫meros m√°gicos que s√£o simplesmente retirados da cabe√ßa e inseridos no c√≥digo, isso deve ser evitado, mas por que eles est√£o aqui?  O princ√≠pio pelo qual o painel direito √© formado ainda n√£o foi determinado e foi decidido simplesmente testar o prot√≥tipo com tantos modificadores no prot√≥tipo. <br><br>  Como fazer isso certo?  - pelo menos coloque-o em campos serializ√°veis ‚Äã‚Äãe defina as quantidades necess√°rias atrav√©s do inspetor.  Por que sou muito pregui√ßoso e voc√™ deveria faz√™-lo?  Aqui devemos proceder a partir da vis√£o geral, uma entidade e configura√ß√£o separadas ainda ser√£o respons√°veis ‚Äã‚Äãpela forma√ß√£o do n√∫mero necess√°rio de modificadores, ent√£o aqui eu estava com pregui√ßa de esperar muitas refatora√ß√µes no futuro.  Mas √© melhor n√£o pregui√ßoso!  ) <br><br>  Sobre configura√ß√µes - quando as primeiras palestras sobre ScriptableObject apareceram, gostei da ideia de armazenar dados como um ativo.  Voc√™ obt√©m os dados necess√°rios onde precisa, sem estar vinculado a uma inst√¢ncia de c√≥pia √∫nica.  Depois, houve uma palestra sobre uma abordagem para o desenvolvimento de jogos envolvendo ScriptableObject, onde eles costumavam armazenar configura√ß√µes de inst√¢ncia.  Na verdade, as predefini√ß√µes / configura√ß√µes de algo salvo no ativo s√£o a configura√ß√£o. <br><br>  <b>Considere a classe de configura√ß√£o:</b> <br><div class="spoiler">  <b class="spoiler_title">Classe de configura√ß√£o</b> <div class="spoiler_text"><pre> <code class="java hljs"> [CreateAssetMenu(fileName = <span class="hljs-string"><span class="hljs-string">"DropModifiersPanel"</span></span>, menuName = <span class="hljs-string"><span class="hljs-string">"Configs/DropModifier"</span></span>, order = <span class="hljs-number"><span class="hljs-number">2</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DropPanelConfig</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScriptableObject</span></span></span><span class="hljs-class"> </span></span>{ [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ModifierBluePrintSimple[] modifierBluePrintSimples; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> DropModifier </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetModifierByType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TypeOfForce typeOfModifiers)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> modifierBluePrintSimples.FirstOrDefault(x =&gt; x.GetValue.TypeOfModifier == typeOfModifiers).GetValue; } } [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DropModifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TypeOfForce TypeOfModifier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Sprite Icon; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject Modifier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Material Material; }</code> </pre> <br></div></div><br><br>  Qual √© a ess√™ncia do seu trabalho?  Ele armazena uma classe de dados modificadora personalizada. <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DropModifier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TypeOfForce TypeOfModifier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Sprite Icon; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject Modifier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Material Material; }</code> </pre> <br><br>  O tipo de modificador √© necess√°rio para identifica√ß√£o, um √≠cone para a interface, o modo de jogo do objeto de jogo do modificador, o material aqui para que possa ser alterado durante a configura√ß√£o.  Os modificadores j√° podem estar localizados no campo de jogo, e digamos que o designer do jogo altere seu tipo, agora ele d√° acelera√ß√£o, o modificador inicia na configura√ß√£o e atualiza todos os campos, incluindo o material, de acordo com esse tipo de modificador. <br><br>  Trabalhar com a configura√ß√£o √© muito simples - passamos √† configura√ß√£o dos dados para um tipo espec√≠fico, obtemos esses dados, visual √≠ntimos e poss√≠veis configura√ß√µes a partir desses dados. <br><br>  <b>Onde est√° o lucro?</b> <br>  O benef√≠cio √© uma flexibilidade muito grande, por exemplo, voc√™ deseja alterar o material e o √≠cone no modificador de acelera√ß√£o ou, digamos, substituir todo o projeto do jogo.  Em vez de reescrever e encaminhar para os campos do inspetor, apenas alteramos esses dados em uma configura√ß√£o e pronto - tudo ser√° atualizado conosco, em todas as cenas / n√≠veis / pain√©is. <br><br>  <b>E se houver v√°rios dados para o modificador acelerador na configura√ß√£o?</b> <br>  No prot√≥tipo, √© poss√≠vel rastre√°-lo facilmente para que os dados n√£o sejam duplicados; em um rascunho de trabalho, voc√™ precisa de testes e valida√ß√£o de dados. <br><br><h3>  Do √≠cone ao campo de jogo </h3><br><div class="spoiler">  <b class="spoiler_title">Classe de √≠cone do modificador</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DropModifiersIcon</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonoBehaviour</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IDragHandler</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBeginDragHandler</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IEndDragHandler</span></span></span><span class="hljs-class"> </span></span>{ [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Image icon; [Header(<span class="hljs-string"><span class="hljs-string">"       "</span></span>)] [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> RectTransform canvas; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CanvasGroup canvasGroup; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> DropModifier currentModifier; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector3 startPoint; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector3 outV3; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GameObject currentDraggedObj; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ canvasGroup = GetComponent&lt;CanvasGroup&gt;(); startPoint = transform.position; canvas = GetComponentInParent&lt;Canvas&gt;().transform as RectTransform; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DropModifier dropModifier)</span></span></span><span class="hljs-function"> </span></span>{ icon.sprite = dropModifier.Icon; currentModifier = dropModifier; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnBeginDrag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PointerEventData eventData)</span></span></span><span class="hljs-function"> </span></span>{ BlockRaycast(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); currentDraggedObj = Instantiate(currentModifier.Modifier, WorldSpaceCoord(), Quaternion.identity); GlobalEventAggregator.EventAggregator.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImOnDragEvent { IsDragging = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BlockRaycast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bool state)</span></span></span><span class="hljs-function"> </span></span>{ canvasGroup.blocksRaycasts = state; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDrag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PointerEventData eventData)</span></span></span><span class="hljs-function"> </span></span>{ Vector2 outV2; RectTransformUtility.ScreenPointToLocalPointInRectangle(canvas, Input.mousePosition, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, out outV2); transform.position = canvas.transform.TransformPoint(outV2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentDraggedObj != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) currentDraggedObj.transform.position = WorldSpaceCoord(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WorldSpaceCoord</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ RectTransformUtility.ScreenPointToWorldPointInRectangle(canvas, Input.mousePosition, Camera.main, out outV3); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> outV3; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEndDrag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PointerEventData eventData)</span></span></span><span class="hljs-function"> </span></span>{ GlobalEventAggregator.EventAggregator.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImOnDragEvent { IsDragging = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventData.pointerCurrentRaycast.gameObject != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; eventData.pointerCurrentRaycast.gameObject.layer == <span class="hljs-number"><span class="hljs-number">5</span></span>) { Destroy(currentDraggedObj); transform.SetAsLastSibling(); canvasGroup.blocksRaycasts = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Destroy(gameObject); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> struct ImOnDragEvent { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> bool IsDragging; }</code> </pre><br></div></div><br><br>  <b>O que est√° acontecendo aqui?</b> <br>  N√≥s agarramos o √≠cone no painel, abaixo dele criamos um blog de jogo do pr√≥prio modificador.  Na verdade, estamos definindo a coordenada do clique / carrinho de m√£o para o espa√ßo do jogo, ent√£o movemos o modificador no espa√ßo do jogo junto com o √≠cone na interface do usu√°rio, pela maneira como aconselho a ler sobre o RectTransformUtility, esta √© uma √≥tima classe auxiliar na qual h√° muitos recursos para a interface. <br><br>  Digamos que mudemos de id√©ia sobre colocar um modificador e devolv√™-lo ao painel, <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (eventData.pointerCurrentRaycast.gameObject != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; eventData.pointerCurrentRaycast.gameObject.layer == <span class="hljs-number"><span class="hljs-number">5</span></span>)</code> </pre> <br>  Esse trecho de c√≥digo nos permite entender o que est√° sob o clique.  Por que a verifica√ß√£o de camada tamb√©m √© indicada aqui?  E por que novamente √© o n√∫mero m√°gico 5?  Como lembramos da segunda parte, usamos o gr√°fico de rakester n√£o apenas para a interface do usu√°rio, mas tamb√©m para o bot√£o que est√° em cena; tamb√©m, se adicionarmos a funcionalidade para excluir modificadores j√° colocados no campo ou mov√™-los, eles tamb√©m cair√£o no gr√°fico de rake, portanto h√° tamb√©m uma verifica√ß√£o adicional por pertencer √† camada da interface do usu√°rio.  Essa √© a camada padr√£o e sua ordem n√£o muda, portanto o n√∫mero 5 aqui geralmente n√£o √© um n√∫mero m√°gico. <br><br>  Como resultado, acontece que, se soltarmos o √≠cone acima do painel, ele retornar√° ao painel; se, acima do campo de jogo, o modificador permanecer no campo, o √≠cone ser√° exclu√≠do. <br><br>  Foi gasto 1 dia √∫til no c√≥digo do prot√≥tipo.  Al√©m de um pouco de confus√£o em arquivos e gr√°ficos.  Em geral, a jogabilidade foi considerada adequada, apesar das in√∫meras perguntas sobre chips de arte e design de jogos.  Miss√£o Completa. <br><br><h3>  Conclus√µes e recomenda√ß√µes </h3><br><ol><li>  Lay arquitetura m√≠nima, mas ainda assim arquitetura </li><li>  Siga os princ√≠pios b√°sicos, mas sem fanatismo) </li><li>  Escolha solu√ß√µes simples </li><li>  Entre versatilidade e velocidade - √© melhor escolher uma velocidade para o prot√≥tipo </li><li>  Para projetos grandes / m√©dios, significa que √© melhor reescrever do projeto.  Por exemplo, agora a tend√™ncia no Unity √© DOTS, voc√™ precisa escrever muitos componentes e sistemas; para pequenas tiragens, √© ruim, voc√™ perde tempo, para longas tiragens - quando todos os componentes e sistemas s√£o registrados, o ganho de tempo come√ßa.  N√£o acho legal gastar muito tempo na arquitetura de tend√™ncias e descobrir o que o prot√≥tipo √© uma merda </li></ol><br>  Prot√≥tipos de sucesso para todos. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt453748/">https://habr.com/ru/post/pt453748/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt453730/index.html">Odontologia moderna: implanta√ß√£o dent√°ria simult√¢nea e extens√£o do osso maxilar atrav√©s dos olhos do diretor t√©cnico</a></li>
<li><a href="../pt453732/index.html">Eu sou de Moreinis. Opini√µes obl√≠quas ou respeito?</a></li>
<li><a href="../pt453734/index.html">Apresentando o Helm 3</a></li>
<li><a href="../pt453742/index.html">Plugin Memcached: NoSQL no MySQL</a></li>
<li><a href="../pt453744/index.html">Estudamos o princ√≠pio da pseudo-classe: not () usando o exemplo da tarefa "Destacando a linha ativa de uma tabela em CSS puro"</a></li>
<li><a href="../pt453750/index.html">Sobre o recente ataque cibern√©tico de Baltimore</a></li>
<li><a href="../pt453756/index.html">Problemas da metodologia atual para determinar amea√ßas atuais do FSTEC</a></li>
<li><a href="../pt453760/index.html">Campo de treinamento em circuito para tanques e processadores</a></li>
<li><a href="../pt453764/index.html">Amn√©sia volunt√°ria: manipula√ß√µes do hipocampo para remover mem√≥rias dolorosas</a></li>
<li><a href="../pt453766/index.html">R√°dio definido por software - como funciona? Parte 6</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>