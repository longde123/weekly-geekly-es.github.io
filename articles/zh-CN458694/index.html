<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ³ï¸ âª ğŸ• Python GILçœŸçš„æ­»äº†å—ï¼Ÿ ğŸŒµ ğŸ–ï¸ ğŸ—³ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ï¼ ä¸‹å‘¨ä¸€ï¼Œè¯¾ç¨‹å°†åœ¨Pythonå¼€å‘äººå‘˜è¯¾ç¨‹çš„æ–°ç­çº§å¼€å§‹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬æœ‰æ—¶é—´å‘å¸ƒå¦ä¸€ç¯‡æœ‰è¶£çš„ææ–™ï¼Œæˆ‘ä»¬ç°åœ¨å°†åšã€‚ å¥½å¥½é˜…è¯»ã€‚ 



 æ—©åœ¨2003å¹´ï¼Œè‹±ç‰¹å°”å°±å‘å¸ƒäº†æ–°çš„å¥”è…¾4â€œ HTâ€å¤„ç†å™¨ã€‚ è¯¥å¤„ç†å™¨è¶…é¢‘è‡³3GHzï¼Œå¹¶æ”¯æŒè¶…çº¿ç¨‹æŠ€æœ¯ã€‚ 



 åœ¨æ¥ä¸‹æ¥çš„å‡ å¹´ä¸­ï¼Œè‹±ç‰¹å°”å’ŒAMDä¸€ç›´åœ¨åŠªåŠ›é€š...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Python GILçœŸçš„æ­»äº†å—ï¼Ÿ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/458694/"> å¤§å®¶å¥½ï¼ ä¸‹å‘¨ä¸€ï¼Œè¯¾ç¨‹å°†åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Pythonå¼€å‘äººå‘˜</a>è¯¾ç¨‹çš„æ–°ç­çº§å¼€å§‹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬æœ‰æ—¶é—´å‘å¸ƒå¦ä¸€ç¯‡æœ‰è¶£çš„ææ–™ï¼Œæˆ‘ä»¬ç°åœ¨å°†åšã€‚ å¥½å¥½é˜…è¯»ã€‚ <br><br><img src="https://habrastorage.org/webt/jb/cq/wj/jbcqwjrmctxos6x_uzhptngfd9y.png"><br><br> æ—©åœ¨2003å¹´ï¼Œè‹±ç‰¹å°”å°±å‘å¸ƒäº†æ–°çš„å¥”è…¾4â€œ HTâ€å¤„ç†å™¨ã€‚ è¯¥å¤„ç†å™¨è¶…é¢‘è‡³3GHzï¼Œå¹¶æ”¯æŒè¶…çº¿ç¨‹æŠ€æœ¯ã€‚ <a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/9d/z1/es/9dz1esccmgms80liftaeolcqiui.jpeg"><br><br> åœ¨æ¥ä¸‹æ¥çš„å‡ å¹´ä¸­ï¼Œè‹±ç‰¹å°”å’ŒAMDä¸€ç›´åœ¨åŠªåŠ›é€šè¿‡æé«˜æ€»çº¿é€Ÿåº¦ï¼ŒäºŒçº§ç¼“å­˜å¤§å°å’Œå‡å°çŸ©é˜µå¤§å°ä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘å»¶è¿Ÿæ¥å®ç°æœ€ä½³å°å¼æœºæ€§èƒ½ã€‚  2004å¹´ï¼Œé¢‘ç‡ä¸º3 GHzçš„HTæ¨¡å‹è¢«è¶…é¢‘è‡³4 GHzçš„580 Prescottæ¨¡å‹æ‰€å–ä»£ã€‚ <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/AmwzUrL3vMc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br> å‘å‰çœ‹ï¼Œä¼¼ä¹åªæ˜¯æœ‰å¿…è¦å¢åŠ æ—¶é’Ÿé¢‘ç‡ï¼Œä½†æ˜¯ï¼Œæ–°å¤„ç†å™¨é­å—äº†é«˜åŠŸè€—å’Œæ•£çƒ­çš„å›°æ‰°ã€‚ <br><br> æ‚¨çš„å°å¼æœºå¤„ç†å™¨ä»Šå¤©èƒ½æä¾›4 GHzå—ï¼Ÿ è¿™ä¸å¤ªå¯èƒ½ï¼Œå› ä¸ºæé«˜æ€§èƒ½çš„é€”å¾„æœ€ç»ˆå–å†³äºæ€»çº¿é€Ÿåº¦çš„æé«˜å’Œå†…æ ¸æ•°é‡çš„å¢åŠ ã€‚  2006å¹´ï¼Œè‹±ç‰¹å°”é…·ç¿2å–ä»£äº†å¥”è…¾4ï¼Œå¹¶ä¸”æ—¶é’Ÿé€Ÿåº¦ä½å¾—å¤šã€‚ <br><br> é™¤äº†ä¸ºå¹¿å¤§ç”¨æˆ·æä¾›å¤šæ ¸å¤„ç†å™¨å¤–ï¼Œ2006å¹´è¿˜å‘ç”Ÿäº†å…¶ä»–äº‹æƒ…ã€‚  Python 2.5ç»ˆäºäº®äº†ï¼ å®ƒå·²ç»å¸¦æœ‰withå…³é”®å­—çš„betaç‰ˆæœ¬ï¼Œå¤§å®¶éƒ½çŸ¥é“å¹¶å–œæ¬¢å®ƒã€‚ <br><br> å½“ä½¿ç”¨Intel Core 2æˆ–AMD Athlon X2æ—¶ï¼ŒPython 2.5æœ‰ä¸€ä¸ªä¸»è¦é™åˆ¶ã€‚ <br> è¿™æ˜¯ä¸€ä¸ªGILã€‚ <br><br><h2> ä»€ä¹ˆæ˜¯GILï¼Ÿ </h2><br>  GILï¼ˆå…¨å±€è§£é‡Šå™¨é”å®šï¼‰æ˜¯Pythonè§£é‡Šå™¨ä¸­å—äº’æ–¥é‡ä¿æŠ¤çš„å¸ƒå°”å€¼ã€‚ åœ¨ä¸»CPythonå­—èŠ‚ç è®¡ç®—å¾ªç¯ä¸­ä½¿ç”¨è¯¥é”æ¥ç¡®å®šå½“å‰æ­£åœ¨æ‰§è¡ŒæŒ‡ä»¤çš„çº¿ç¨‹ã€‚ <br><br>  CPythonæ”¯æŒåœ¨å•ä¸ªè§£é‡Šå™¨ä¸­ä½¿ç”¨å¤šä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯çº¿ç¨‹å¿…é¡»è¯·æ±‚è®¿é—®GILæ‰èƒ½æ‰§è¡Œä½çº§æ“ä½œã€‚ åè¿‡æ¥ï¼Œè¿™æ„å‘³ç€Pythonå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨å¼‚æ­¥ä»£ç ï¼Œå¤šçº¿ç¨‹ï¼Œè€Œä¸å¿…æ‹…å¿ƒæ­»é”æœŸé—´åœ¨å¤„ç†å™¨çº§åˆ«é˜»å¡ä»»ä½•å˜é‡æˆ–å´©æºƒã€‚ <br><br>  GILç®€åŒ–äº†å¤šçº¿ç¨‹Pythonç¼–ç¨‹ã€‚ <br><br><img src="https://habrastorage.org/webt/lg/yz/3h/lgyz3hoq07fkumzp4axuuiqxplk.gif"><br><br>  GILè¿˜å‘Šè¯‰æˆ‘ä»¬ï¼Œå°½ç®¡CPythonå¯ä»¥æ˜¯å¤šçº¿ç¨‹çš„ï¼Œä½†ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ã€‚ è¿™æ„å‘³ç€æ‚¨çš„å››æ ¸å¤„ç†å™¨ä¼šæ‰§è¡Œç±»ä¼¼çš„æ“ä½œï¼ˆå¸Œæœ›è“å±é™¤å¤–ï¼‰ã€‚ <br><br> å½“å‰ç‰ˆæœ¬çš„GIL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº2009å¹´ç¼–å†™ï¼Œ</a>æ”¯æŒå¼‚æ­¥åŠŸèƒ½ï¼Œå³ä½¿åœ¨åŸåˆ™ä¸Šå°è¯•åˆ é™¤å®ƒæˆ–æ›´æ”¹å…¶è¦æ±‚ä¹‹åï¼Œä»ä¿æŒä¸å˜ã€‚ <br><br> ä»»ä½•å»ºè®®åˆ é™¤GILçš„ç†ç”±éƒ½æ˜¯è§£é‡Šå™¨çš„å…¨å±€é”å®šä¸åº”é™ä½å•çº¿ç¨‹ä»£ç çš„æ€§èƒ½ã€‚ ä»»ä½•åœ¨2003å¹´å°è¯•å¯ç”¨è¶…çº¿ç¨‹çš„äººéƒ½ä¼šç†è§£<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æˆ‘åœ¨è¯´ä»€ä¹ˆ</a> ã€‚ <br><br><h2> åœ¨CPythonä¸­æ”¾å¼ƒäº†Gil </h2><br> å¦‚æœè¦çœŸæ­£å¹¶è¡ŒåŒ–CPythonä¸­çš„ä»£ç ï¼Œåˆ™å¿…é¡»ä½¿ç”¨å¤šä¸ªè¿‡ç¨‹ã€‚ <br><br> åœ¨CPython 2.6ä¸­ï¼Œ <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¤šå¤„ç†</a></i>æ¨¡å—å·²æ·»åŠ åˆ°æ ‡å‡†åº“ä¸­ã€‚ å¤šé‡å¤„ç†æ©ç›–äº†CPythonä¸­è¿›ç¨‹çš„ç”Ÿæˆï¼ˆæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„GILï¼‰ã€‚ <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> multiprocessing <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Process <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'hello'</span></span>, name <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: p = Process(target=f, args=(<span class="hljs-string"><span class="hljs-string">'bob'</span></span>,)) p.start() p.join()</code> </pre> <br><br> åˆ›å»ºæµç¨‹ï¼Œä½¿ç”¨ç¼–è¯‘åçš„æ¨¡å—å’ŒPythonå‡½æ•°å°†å‘½ä»¤å‘é€ç»™å®ƒä»¬ï¼Œç„¶åå°†å®ƒä»¬é‡æ–°åŠ å…¥ä¸»æµç¨‹ã€‚ <br><br> å¤šé‡å¤„ç†è¿˜æ”¯æŒé€šè¿‡é˜Ÿåˆ—æˆ–é€šé“ä½¿ç”¨å˜é‡ã€‚ å¥¹æœ‰ä¸€ä¸ªé”å®šå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ç”¨äºé”å®šä¸»è¿›ç¨‹ä¸­çš„å¯¹è±¡å¹¶ä»å…¶ä»–è¿›ç¨‹å†™å…¥ã€‚ <br><br> å¤šå¤„ç†æœ‰ä¸€ä¸ªä¸»è¦ç¼ºç‚¹ã€‚ å®ƒæ‰¿è½½ç€å·¨å¤§çš„è®¡ç®—è´Ÿè·ï¼Œè¿™ä¼šå½±å“å¤„ç†æ—¶é—´å’Œå†…å­˜ä½¿ç”¨ç‡ã€‚ å³ä½¿æ²¡æœ‰æ— ç«™ç‚¹ï¼ŒCPythonçš„å¯åŠ¨æ—¶é—´ä¹Ÿæ˜¯100-200æ¯«ç§’ï¼ˆæœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://hackernoon.com/which-is-the-fastest-version-of-python-2ae7c61a6b2b</a> ï¼‰ã€‚ <br><br> ç»“æœï¼Œæ‚¨å¯èƒ½åœ¨CPythonä¸­æ‹¥æœ‰å¹¶è¡Œä»£ç ï¼Œä½†æ˜¯æ‚¨ä»ç„¶éœ€è¦ä»”ç»†è®¡åˆ’å…±äº«å¤šä¸ªå¯¹è±¡çš„é•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹çš„å·¥ä½œã€‚ <br><br> å¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨ç¬¬ä¸‰æ–¹ç¨‹åºåŒ…ï¼Œä¾‹å¦‚Twistedã€‚ <br><br><h2>  PEP554å’ŒGILçš„æ­»äº¡ï¼Ÿ </h2><br> å› æ­¤ï¼Œè®©æˆ‘æé†’æ‚¨ï¼ŒCPythonä¸­çš„å¤šçº¿ç¨‹å¾ˆç®€å•ï¼Œä½†å®é™…ä¸Šä¸æ˜¯å¹¶è¡ŒåŒ–ï¼Œè€Œæ˜¯å¤šå¤„ç†æ˜¯å¹¶è¡Œçš„ï¼Œä½†ä¼šå¸¦æ¥å¤§é‡å¼€é”€ã€‚ <br><br>  <i>å¦‚æœæœ‰æ›´å¥½çš„æ–¹æ³•æ€ä¹ˆåŠï¼Ÿ</i> <br> ç»•è¿‡GILçš„å…³é”®åœ¨äºåç§°ï¼Œè§£é‡Šå™¨çš„å…¨å±€é”å®šæ˜¯è§£é‡Šå™¨å…¨å±€çŠ¶æ€çš„ä¸€éƒ¨åˆ†ã€‚  CPythonè¿›ç¨‹å¯ä»¥å…·æœ‰å¤šä¸ªè§£é‡Šå™¨ï¼Œå› æ­¤å¯ä»¥å…·æœ‰å¤šä¸ªé”ï¼Œä½†æ˜¯å¾ˆå°‘ä½¿ç”¨æ­¤å‡½æ•°ï¼Œå› ä¸ºåªèƒ½é€šè¿‡C-APIå¯¹å…¶è¿›è¡Œè®¿é—®ã€‚ <br><br>  CPython 3.8çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯PEP554ï¼Œå®ƒæ˜¯åœ¨æ ‡å‡†åº“ä¸­å¸¦æœ‰æ–°<code>interpreters</code>æ¨¡å—çš„å­è§£é‡Šå™¨å’ŒAPIçš„å®ç°ã€‚ <br><br> è¿™ä½¿æ‚¨å¯ä»¥åœ¨å•ä¸ªè¿‡ç¨‹ä¸­ä»Pythonåˆ›å»ºå¤šä¸ªè§£é‡Šå™¨ã€‚  Python 3.8çš„å¦ä¸€é¡¹åˆ›æ–°æ˜¯ï¼Œæ‰€æœ‰è§£é‡Šå™¨éƒ½å°†æ‹¥æœ‰è‡ªå·±çš„GILã€‚ <br><br><img src="https://habrastorage.org/webt/bq/nc/m2/bqncm29jhm-ytakgrlkasbfe_6y.png"><br><br> ç”±äºè§£é‡Šå™¨çš„çŠ¶æ€åŒ…å«åœ¨å†…å­˜ä¸­åˆ†é…çš„åŒºåŸŸï¼Œæ‰€æœ‰æŒ‡å‘Pythonå¯¹è±¡çš„æŒ‡é’ˆï¼ˆæœ¬åœ°å’Œå…¨å±€ï¼‰çš„é›†åˆï¼Œå› æ­¤PEP554ä¸­çš„å­è§£é‡Šå™¨æ— æ³•è®¿é—®å…¶ä»–è§£é‡Šå™¨çš„å…¨å±€å˜é‡ã€‚ <br><br> åƒå¤šå¤„ç†ä¸€æ ·ï¼Œè§£é‡Šå™¨å…±äº«å¯¹è±¡åŒ…æ‹¬åºåˆ—åŒ–å®ƒä»¬å¹¶ä½¿ç”¨IPCå½¢å¼ï¼ˆç½‘ç»œï¼Œç£ç›˜æˆ–å…±äº«å†…å­˜ï¼‰ã€‚ æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥åœ¨Pythonä¸­åºåˆ—åŒ–å¯¹è±¡ï¼Œä¾‹å¦‚ï¼Œ <code>marshal</code>æ¨¡å—ï¼Œ <code>pickle</code>æ¨¡å—æˆ–æ›´æ ‡å‡†åŒ–çš„æ–¹æ³•ï¼ˆå¦‚<code>json</code>æˆ–<code>simplexml</code> ã€‚ å®ƒä»¬æ¯ä¸ªéƒ½æœ‰å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œå¹¶ä¸”éƒ½ç»™è®¡ç®—å¸¦æ¥äº†è´Ÿæ‹…ã€‚ <br><br> æœ€å¥½å…·æœ‰ä¸€ä¸ªå…¬å…±çš„å†…å­˜ç©ºé—´ï¼Œè¯¥å†…å­˜ç©ºé—´å¯ä»¥é€šè¿‡ç‰¹å®šçš„è¿‡ç¨‹è¿›è¡Œæ›´æ”¹å’Œæ§åˆ¶ã€‚ å› æ­¤ï¼Œå¯¹è±¡å¯ä»¥ç”±ä¸»è§£é‡Šå™¨å‘é€å¹¶ç”±å¦ä¸€ä¸ªè§£é‡Šå™¨æ¥æ”¶ã€‚ è¿™å°†æ˜¯ç”¨äºæœç´¢PyObjectæŒ‡é’ˆçš„æ‰˜ç®¡å†…å­˜ç©ºé—´ï¼Œæ¯ä¸ªè§£é‡Šå™¨éƒ½å¯ä»¥è®¿é—®è¯¥å†…å­˜ç©ºé—´ï¼Œè€Œä¸»è¿›ç¨‹å°†ç®¡ç†é”ã€‚ <br><br><img src="https://habrastorage.org/webt/be/ww/d8/bewwd8ju-3akmyhs7ujq7xmyliy.png"><br><br> ä¸æ­¤ç›¸å…³çš„APIä»åœ¨å¼€å‘ä¸­ï¼Œä½†å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _xxsubinterpreters <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> interpreters <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> threading <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> textwrap <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tw <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> marshal <span class="hljs-comment"><span class="hljs-comment"># Create a sub-interpreter interpid = interpreters.create() # If you had a function that generated some data arry = list(range(0,100)) # Create a channel channel_id = interpreters.channel_create() # Pre-populate the interpreter with a module interpreters.run_string(interpid, "import marshal; import _xxsubinterpreters as interpreters") # Define a def run(interpid, channel_id): interpreters.run_string(interpid, tw.dedent(""" arry_raw = interpreters.channel_recv(channel_id) arry = marshal.loads(arry_raw) result = [1,2,3,4,5] # where you would do some calculating result_raw = marshal.dumps(result) interpreters.channel_send(channel_id, result_raw) """), shared=dict( channel_id=channel_id ), ) inp = marshal.dumps(arry) interpreters.channel_send(channel_id, inp) # Run inside a thread t = threading.Thread(target=run, args=(interpid, channel_id)) t.start() # Sub interpreter will process. Feel free to do anything else now. output = interpreters.channel_recv(channel_id) interpreters.channel_release(channel_id) output_arry = marshal.loads(output) print(output_arry)</span></span></code> </pre> <br><br> æœ¬ç¤ºä¾‹ä½¿ç”¨NumPyã€‚  numpyæ•°ç»„é€šè¿‡é€šé“å‘é€ï¼Œä½¿ç”¨<code>marshal</code>æ¨¡å—è¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶åå­è§£é‡Šå™¨å¤„ç†æ•°æ®ï¼ˆåœ¨å•ç‹¬çš„GILä¸Šï¼‰ï¼Œå› æ­¤å¯èƒ½å­˜åœ¨ä¸CPUç›¸å…³çš„å¹¶è¡ŒåŒ–é—®é¢˜ï¼Œè¿™æ˜¯å­è§£é‡Šå™¨çš„ç†æƒ³é€‰æ‹©ã€‚ <br><br><h4>  <b>æ•ˆç‡ä½ä¸‹</b> </h4><br>  <code>marshal</code>æ¨¡å—çš„å·¥ä½œé€Ÿåº¦éå¸¸å¿«ï¼Œä½†ä¸å¦‚ç›´æ¥ä»å†…å­˜ä¸­å…±äº«å¯¹è±¡é‚£æ ·å¿«ã€‚ <br><br>  PEP574å¼•å…¥äº†æ–°çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pickle</a>åè®®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ï¼ˆv5ï¼‰</a> ï¼Œè¯¥åè®®æ”¯æŒä¸å…¶ä½™pickleæµåˆ†å¼€å¤„ç†å†…å­˜ç¼“å†²åŒºçš„åŠŸèƒ½ã€‚ å¯¹äºå¤§å‹æ•°æ®å¯¹è±¡ï¼Œä¸€æ¬¡æ€§å°†å®ƒä»¬å…¨éƒ¨åºåˆ—åŒ–å¹¶ä»å­è§£é‡Šå™¨ååºåˆ—åŒ–å°†å¢åŠ å¾ˆå¤šå¼€é”€ã€‚ <br><br> æ–°çš„APIå¯ä»¥å¦‚ä¸‹ï¼ˆçº¯ç²¹å‡è®¾ï¼‰å®ç°ï¼š <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> _xxsubinterpreters <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> interpreters <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> threading <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> textwrap <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tw <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pickle <span class="hljs-comment"><span class="hljs-comment"># Create a sub-interpreter interpid = interpreters.create() # If you had a function that generated a numpy array arry = [5,4,3,2,1] # Create a channel channel_id = interpreters.channel_create() # Pre-populate the interpreter with a module interpreters.run_string(interpid, "import pickle; import _xxsubinterpreters as interpreters") buffers=[] # Define a def run(interpid, channel_id): interpreters.run_string(interpid, tw.dedent(""" arry_raw = interpreters.channel_recv(channel_id) arry = pickle.loads(arry_raw) print(f"Got: {arry}") result = arry[::-1] result_raw = pickle.dumps(result, protocol=5) interpreters.channel_send(channel_id, result_raw) """), shared=dict( channel_id=channel_id, ), ) input = pickle.dumps(arry, protocol=5, buffer_callback=buffers.append) interpreters.channel_send(channel_id, input) # Run inside a thread t = threading.Thread(target=run, args=(interpid, channel_id)) t.start() # Sub interpreter will process. Feel free to do anything else now. output = interpreters.channel_recv(channel_id) interpreters.channel_release(channel_id) output_arry = pickle.loads(output) print(f"Got back: {output_arry}")</span></span></code> </pre> <br><h4>  <b>çœ‹èµ·æ¥æœ‰å›¾æ¡ˆ</b> </h4><br> æœ¬è´¨ä¸Šï¼Œè¯¥ç¤ºä¾‹åŸºäºä½¿ç”¨ä½çº§å­è§£é‡Šå™¨çš„APIæ„å»ºã€‚ å¦‚æœæ‚¨å°šæœªä½¿ç”¨<code>multiprocessing</code>åº“ï¼Œåˆ™æ‚¨å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚ å®ƒä¸åƒæµå¤„ç†é‚£æ ·ç®€å•ï¼Œæ‚¨ä¸èƒ½è¯´åœ¨å•ç‹¬çš„è§£é‡Šå™¨ä¸­ä½¿ç”¨è¿™æ ·çš„è¾“å…¥æ•°æ®åˆ—è¡¨è¿è¡Œæ­¤åŠŸèƒ½ã€‚ <br><br> è¯¥PEPä¸å…¶ä»–PEPåˆå¹¶åï¼Œæˆ‘è®¤ä¸ºæˆ‘ä»¬ä¼šåœ¨PyPiä¸­çœ‹åˆ°å‡ ä¸ªæ–°çš„APIã€‚ <br><br><h3> å­è§£é‡Šå™¨æœ‰å¤šå°‘å¼€é”€ï¼Ÿ </h3><br>  <b>ç®€çŸ­çš„ç­”æ¡ˆï¼š</b>ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæµï¼Œå°‘äºä¸€ä¸ªè¿‡ç¨‹ã€‚ <br>  <b>é•¿ç­”æ¡ˆï¼š</b>è§£é‡Šå™¨å…·æœ‰å…¶è‡ªå·±çš„çŠ¶æ€ï¼Œå› æ­¤å°½ç®¡PEP554ç®€åŒ–äº†å­è§£é‡Šå™¨çš„åˆ›å»ºï¼Œä½†å®ƒä»éœ€è¦å…‹éš†å¹¶åˆå§‹åŒ–ä»¥ä¸‹å†…å®¹ï¼š <br><br><ul><li>  <code>__main__</code>å’Œ<code>importlib</code>ä¸­çš„<code>__main__</code> ï¼› </li><li>  <code>sys</code>å­—å…¸çš„å†…å®¹ï¼› </li><li> å†…ç½®å‡½æ•°ï¼ˆ <code>print()</code> ï¼Œ <code>assert</code>ç­‰ï¼‰ï¼› </li><li> æºªæµ; </li><li> å†…æ ¸é…ç½®ã€‚ </li></ul><br><br> å¯ä»¥å¾ˆå®¹æ˜“åœ°ä»å†…å­˜ä¸­å…‹éš†å†…æ ¸é…ç½®ï¼Œä½†æ˜¯å¯¼å…¥æ¨¡å—å¹¶ä¸æ˜¯é‚£ä¹ˆç®€å•ã€‚ åœ¨Pythonä¸­å¯¼å…¥æ¨¡å—çš„é€Ÿåº¦å¾ˆæ…¢ï¼Œå› æ­¤ï¼Œå¦‚æœåˆ›å»ºå­è§£é‡Šå™¨æ„å‘³ç€æ¯æ¬¡éƒ½å°†æ¨¡å—å¯¼å…¥ä¸åŒçš„åç§°ç©ºé—´ï¼Œåˆ™ä¼šé™ä½æ”¶ç›Šã€‚ <br><br><h3> é‚£å¼‚æ­¥å‘¢ï¼Ÿ </h3><br> æ ‡å‡†åº“ä¸­<code>asyncio</code>äº‹ä»¶<code>asyncio</code>çš„ç°æœ‰å®ç°åˆ›å»ºç”¨äºè¯„ä¼°çš„å †æ ˆæ¡†æ¶ï¼Œå¹¶åœ¨ä¸»è§£é‡Šå™¨ä¸­<code>asyncio</code>çŠ¶æ€ï¼ˆå› æ­¤å…±äº«GILï¼‰ã€‚ <br><br> åˆå¹¶PEP554ï¼ˆå¯èƒ½å·²ç»åœ¨python 3.9ä¸­ä½¿ç”¨ï¼‰ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨äº‹ä»¶å¾ªç¯çš„å¦ä¸€ç§å®ç°æ–¹å¼ï¼ˆå°½ç®¡è¿˜æ²¡æœ‰äººè¿™æ ·åšï¼‰ï¼Œå®ƒå¯ä»¥åœ¨å­è§£é‡Šå™¨ä¸­å¹¶è¡Œè¿è¡Œå¼‚æ­¥æ–¹æ³•ã€‚ <br><br><h3> å¬èµ·æ¥å¾ˆé…·ï¼Œä¹ŸæŠŠæˆ‘åŒ…èµ·æ¥ï¼ </h3><br> å¥½å§ï¼Œä¸æ˜¯çœŸçš„ã€‚ <br> ç”±äºCPythonåœ¨åŒä¸€ä¸ªè§£é‡Šå™¨ä¸Šè¿è¡Œäº†å¾ˆé•¿æ—¶é—´ï¼Œå› æ­¤ä»£ç åº“çš„è®¸å¤šéƒ¨åˆ†ä½¿ç”¨â€œè¿è¡Œæ—¶çŠ¶æ€â€è€Œä¸æ˜¯â€œè§£é‡Šå™¨çŠ¶æ€â€ï¼Œå› æ­¤ï¼Œå¦‚æœç°åœ¨å¼•å…¥PEP554ï¼Œä»ç„¶ä¼šæœ‰å¾ˆå¤šé—®é¢˜ã€‚ <br><br> ä¾‹å¦‚ï¼Œåƒåœ¾æ”¶é›†å™¨çš„çŠ¶æ€ï¼ˆåœ¨ç‰ˆæœ¬3.7 &lt;ä¸­ï¼‰å±äºè¿è¡Œæ—¶ã€‚ <br><br> åœ¨PyConå†²åˆºæœŸé—´çš„æ›´æ”¹ä¸­ï¼Œåƒåœ¾æ”¶é›†å™¨çš„çŠ¶æ€<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¼€å§‹ç§»è‡³</a>è§£é‡Šå™¨ï¼Œä»¥ä¾¿æ¯ä¸ªå­è§£é‡Šå™¨å°†æ‹¥æœ‰è‡ªå·±çš„åƒåœ¾æ”¶é›†å™¨ï¼ˆåº”å¦‚æ­¤ï¼‰ã€‚ <br><br> å¦ä¸€ä¸ªé—®é¢˜æ˜¯CPythonä»£ç åº“ä¸­å­˜åœ¨ä¸€äº›â€œå…¨å±€â€å˜é‡ä»¥åŠCè¯­è¨€ä¸­çš„è®¸å¤šæ‰©å±•ã€‚å› æ­¤ï¼Œå½“äººä»¬çªç„¶å¼€å§‹æ­£ç¡®åœ°å¹¶è¡ŒåŒ–å…¶ä»£ç æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€äº›é—®é¢˜ã€‚ <br><br> å¦ä¸€ä¸ªé—®é¢˜æ˜¯æ–‡ä»¶æè¿°ç¬¦å±äºè¯¥è¿›ç¨‹ï¼Œå› æ­¤ï¼Œå¦‚æœæ‰“å¼€äº†è¦åœ¨ä¸€ä¸ªè§£é‡Šå™¨ä¸­å†™å…¥çš„æ–‡ä»¶ï¼Œåˆ™å­è§£é‡Šå™¨å°†æ— æ³•è®¿é—®è¯¥æ–‡ä»¶ï¼ˆæ— éœ€å¯¹CPythonè¿›è¡Œè¿›ä¸€æ­¥æ›´æ”¹ï¼‰ã€‚ <br><br> ç®€è€Œè¨€ä¹‹ï¼Œä»ç„¶æœ‰è®¸å¤šé—®é¢˜éœ€è¦è§£å†³ã€‚ <br><br><h2> ç»“è®ºï¼šGILæ˜¯å¦æ­£ç¡®ï¼Ÿ </h2><br>  GILå°†ç»§ç»­ç”¨äºå•çº¿ç¨‹åº”ç”¨ç¨‹åºã€‚ å› æ­¤ï¼Œå³ä½¿éµå¾ªPEP554ï¼Œå•çº¿ç¨‹ä»£ç ä¹Ÿå°†çªç„¶å˜å¾—ä¸å¹¶è¡Œã€‚ <br> å¦‚æœè¦ç”¨Python 3.8ç¼–å†™å¹¶è¡Œä»£ç ï¼Œå°†é‡åˆ°ä¸å¤„ç†å™¨ç›¸å…³çš„å¹¶è¡ŒåŒ–é—®é¢˜ï¼Œä½†è¿™ä¹Ÿæ˜¯æœªæ¥çš„è¶‹åŠ¿ï¼ <br><br><h2> ä»€ä¹ˆæ—¶å€™ </h2><br>  Pickle v5å’Œç”¨äºå¤šå¤„ç†çš„å†…å­˜å…±äº«å¾ˆå¯èƒ½ä¼šåœ¨Python 3.8ï¼ˆ2019å¹´10æœˆï¼‰ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”å­è§£é‡Šå™¨å°†å‡ºç°åœ¨3.8å’Œ3.9ç‰ˆæœ¬ä¹‹é—´ã€‚ <br> å¦‚æœæ‚¨å¸Œæœ›å°è¯•ä½¿ç”¨æ‰€æä¾›çš„ç¤ºä¾‹ï¼Œé‚£ä¹ˆæˆ‘åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«æ‰€æœ‰å¿…éœ€ä»£ç çš„å•ç‹¬åˆ†æ”¯ï¼š <a href="">https</a> : <a href="">//github.com/tonybaloney/cpython/tree/subinterpretersã€‚</a> <br><br> æ‚¨å¦‚ä½•çœ‹å¾…ï¼Ÿ å†™æ‚¨çš„è¯„è®ºå¹¶åœ¨è¯¾ç¨‹ä¸­è§ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN458694/">https://habr.com/ru/post/zh-CN458694/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN458684/index.html">äº’è”ç½‘åç§°ä¸æ•°å­—åœ°å€åˆ†é…æœºæ„ï¼ˆICANNï¼‰å–æ¶ˆ.orgåŸŸçš„ä»·æ ¼é—¨æ§›-ITç¤¾åŒºåå¯¹çš„ç†ç”±ä»¥åŠä¸‹ä¸€æ­¥å°†å‘ç”Ÿä»€ä¹ˆ</a></li>
<li><a href="../zh-CN458686/index.html">@Pythonetc 2019å¹´6æœˆ</a></li>
<li><a href="../zh-CN458688/index.html">æˆ‘çš„ç”µæŠ¥é¢‘é“@pythonetcçš„æç¤ºå’ŒæŠ€å·§ï¼Œ2019å¹´6æœˆ</a></li>
<li><a href="../zh-CN458690/index.html">è‡ªåŠ¨åŒ–ï¼ æˆ‘ä»¬å¦‚ä½•æ”¹è¿›é›†æˆæµ‹è¯•</a></li>
<li><a href="../zh-CN458692/index.html">åœ¨Cï¼ƒä¸­é€šè¿‡å¼‚æ­¥/ç­‰å¾…æ¥â€œä¹Ÿè®¸â€ monadï¼ˆæ— ä»»åŠ¡ï¼ï¼‰</a></li>
<li><a href="../zh-CN458696/index.html">çº¹ç†ï¼Œæˆ–æˆä¸ºSurface Artistæ‰€éœ€è¦äº†è§£çš„çŸ¥è¯†ã€‚ ç¬¬3éƒ¨åˆ†ã€‚PBRå’Œææ–™</a></li>
<li><a href="../zh-CN458698/index.html">ITé¡¹ç›®çš„å’Œå¹³ä¹‹è·¯å’Œæˆ˜äº‰ä¹‹è·¯</a></li>
<li><a href="../zh-CN458702/index.html">é›ªæ©‡çŠ¬ï¼šæ‚¨éœ€è¦äº†è§£ä»€ä¹ˆï¼Œä»¥åŠå®ƒä»¬çš„é¥²å…»æ–¹å¼</a></li>
<li><a href="../zh-CN458704/index.html">ä»¥é›¶å”®ä¸ºä¾‹å®ç°DLPç³»ç»Ÿ</a></li>
<li><a href="../zh-CN458706/index.html">Gopniksç°åœ¨åœ¨å›½å¤–å¸‚åœºï¼Œæˆ–è€…â€œä¸ºä»€ä¹ˆæ‰¾åˆ°æ™®é€šçš„ç¨‹åºå‘˜è¿™ä¹ˆéš¾ï¼Ÿâ€</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>