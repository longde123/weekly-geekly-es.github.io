<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>โก๏ธ โ๏ธ ๐ฆ ููููุฉ ุชูููู ุตุฏุงูุงุช PyTorch ู C ++. ุจุงุณุชุฎุฏุงู TorchScript โ๐ผ ๐จโ๐ฉโ๐ฆ ๐ข</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุฐ ุนุงู ุชูุฑูุจูุง ุ ูุฏู ูุทูุฑู PyTorch ูุฌุชูุน TorchScript ุ ููู ุฃุฏุงุฉ ุชุณูุญ ูู ุจุฅูุฌุงุฏ ุญู ูุงุจู ููุงุณุชุจุฏุงู ูู ุฎุท ุฃูุงุจูุจ ูู ุจูุซูู ูุน ุจุถุน ููุฑุงุช ุจุงููุงูุณ ูููู ุชุถูู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ููููุฉ ุชูููู ุตุฏุงูุงุช PyTorch ู C ++. ุจุงุณุชุฎุฏุงู TorchScript</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ods/blog/480328/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> ููุฐ ุนุงู ุชูุฑูุจูุง ุ ูุฏู ูุทูุฑู <strong>PyTorch</strong> ูุฌุชูุน <strong>TorchScript</strong> ุ ููู ุฃุฏุงุฉ ุชุณูุญ ูู ุจุฅูุฌุงุฏ ุญู ูุงุจู ููุงุณุชุจุฏุงู ูู ุฎุท ุฃูุงุจูุจ ูู ุจูุซูู ูุน ุจุถุน ููุฑุงุช ุจุงููุงูุณ ูููู ุชุถููููุง ูู ูุธุงู C ++.  ุฃุดุงุฑู ุฃุฏูุงู ุชุฌุฑุจุฉ ุงุณุชุฎุฏุงูู ูุฃุญุงูู ูุตู ุงููุฒุงูู ุงูุชู ุตูุฏูุช ูู ูุฐุง ุงููุณุงุฑ.  ุณุฃููู ุงูุชูุงููุง ุฎุงุตูุง ูุชูููุฐ ุงููุดุฑูุน ุนูู Windows ุ ูุฃูู ุนูู ุงูุฑุบู ูู ุฅุฌุฑุงุก ุงูุฃุจุญุงุซ ูู ML ุนุงุฏุฉู ุนูู Ubuntu ุ ุบุงูุจูุง ูุง ูููู ุงูุญู ุงูููุงุฆู (ูุฌุฃุฉ!) ูุทููุจูุง ุจููุฌุจ "windows". </p><br><p style=";text-align:right;direction:rtl">  ูููู ุงูุนุซูุฑ ุนูู ูููุฐุฌ ุงูุชุนูููุฉ ุงูุจุฑูุฌูุฉ ูุชุตุฏูุฑ ูููุฐุฌ ููุดุฑูุน C ++ ุจุงุณุชุฎุฏุงู ุงููููุฐุฌ ูู <a href="https://github.com/IlyaOvodov/TorchScriptTutorial">ูุณุชูุฏุน ุงูุชุฎุฒูู ุนูู GitHub</a> . </p><br><p style=";text-align:right;direction:rtl"> <a href="https://habr.com/ru/company/ods/blog/480328/"><img src="https://habrastorage.org/webt/3k/u1/ub/3ku1ubmzigl3j016ezncczdonqm.jpeg"></a> </p><a name="habracut"></a><br><a name="continue"></a><br><p style=";text-align:right;direction:rtl">  ูุทูุฑู PyTorch ูุง ููุฎุฏุนูู.  ุชุชูุญ ูู ุงูุฃุฏุงุฉ ุงูุฌุฏูุฏุฉ ุจุงููุนู ุชุญููู ูุดุฑูุน ุจุญุซู ูู โโPyTorch ุฅูู ููุฏ ูุถูู ูู ูุธุงู C ++ ูู ุจุถุนุฉ ุฃูุงู ุนูู ุ ูุจุจุนุถ ุงูููุงุฑุงุช ุจุดูู ุฃุณุฑุน. </p><br><p style=";text-align:right;direction:rtl">  ุธูุฑ TorchScript ูู PyTorch ุงูุฅุตุฏุงุฑ 1.0 ููุณุชูุฑ ูู ุงูุชุทูุฑ ูุงูุชุบููุฑ.  ุฅุฐุง ูุงู ุงูุฅุตุฏุงุฑ ุงูุฃูู ูุจู ุนุงู ููุชูุฆูุง ุจุงูุฃุฎุทุงุก ููุงู ุฃูุซุฑ ุชุฌุฑูุจูุฉ ุ ูุฅู ุงูุฅุตุฏุงุฑ ุงูุญุงูู 1.3 ุนูู ุงูุฃูู ูู ุงูููุทุฉ ุงูุซุงููุฉ ุฃุตุจุญ ูุฎุชูููุง ุจุดูู ููุญูุธ: ูู ูุนุฏ ุจุงูุฅููุงู ุชุณููุชู ุชุฌุฑูุจููุง ุ ููู ููุงุณุจ ุชูุงููุง ููุงุณุชุฎุฏุงู ุงูุนููู.  ุณูู ุฃุฑูุฒ ุนูููุง. </p><br><p style=";text-align:right;direction:rtl">  ููุฌุฏ ูู ููุจ TorchScript ูุชุฑุฌู ูุณุชูู (ุฎุงูู ูู ุจูุซูู) ุจูุบุฉ ุชุดุจู ุงูุซุนุจุงู ุ ูุถูุงู ุนู ุฃุฏูุงุช ูุชุญููู ุจุฑูุงูุฌ ููุชูุจ ุจุจูุซูู ู PyTorch ุฅููู ุ ูุทุฑู ูุญูุธ ูุชุญููู ุงููุญุฏุงุช ุงูููุทูุฉ ุงููุงุชุฌุฉ ุ ูููุชุจุฉ ูุงุณุชุฎุฏุงููุง ูู C ++.  ููุนูู ุ ุณูู ุชุถุทุฑ ุฅูู ุฅุถุงูุฉ ุนุฏุฉ ููุชุจุงุช ุงูุงุฑุชุจุงุท ุงูุญููู (DLL) ุฅูู ุงููุดุฑูุน ุจูุฒู ุฅุฌูุงูู ูุจูุบ ุญูุงูู 70 ููุบุงุจุงูุช (ููุธุงู Windows) ููุนูู ุนูู ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ู 300 ููุบุงุจุงูุช ูุฅุตุฏุงุฑ GPU.  ูุฏุนู TorchScript ูุนุธู ููุฒุงุช PyTorch ูุงูููุฒุงุช ุงูุฑุฆูุณูุฉ ููุบุฉ ุจูุซูู.  ููู ููุชุจุงุช ุงูุฃุทุฑุงู ุงูุซุงูุซุฉ ุ ูุซู OpenCV ุฃู NumPy ุ ูุฌุจ ุฃู ุชูุณู.  ูุญุณู ุงูุญุธ ุ ูุฅู ุงูุนุฏูุฏ ูู ุงููุธุงุฆู ูู NumPy ููุง ุชูุงุธุฑูุฉ ูู PyTorch. </p><br><h2 id="konvertiruem-payplayn-na-pytorch-model-na-torchscript" style=";text-align:right;direction:rtl">  ุชุญููู ุฎุท ุงูุฃูุงุจูุจ ุฅูู ูููุฐุฌ PyTorch ุนูู TorchScript </h2><br><p style=";text-align:right;direction:rtl">  ูููุฑ TorchScript ุทุฑููุชูู ูุชุญููู ุดูุฑุฉ Python ุฅูู ุชูุณูููุง ุงูุฏุงุฎูู: ุงูุชุชุจุน ูุงูุจุฑูุฌุฉ ุงููุตูุฉ (ุงูุชุชุจุน ูุงูุจุฑูุฌุฉ ุงููุตูุฉ).  ููุงุฐุง ุงุซูููุ  ูุง ุ ูู ุงููุงุถุญ ุ ุจุงูุทุจุน ุ ุฃู ุงูุงุซููู ุฃูุถู ูู ูุงุญุฏ ... </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/lh/xp/ww/lhxpwwynynljq2_sxj35jhpp9yc.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ููู ูู ุญุงูุฉ ูุฐู ุงูุฃุณุงููุจ ุ ุงุชุถุญ ุ ููุง ูู ุงูููู ุงููุฃุซูุฑ ุงููุนุฑูู ุ ุญูู ุงูุงูุญุฑุงูุงุช ุงููููู ูุงููุณุฑู: ููุงููุง ุฃุณูุฃ.  ุญุณููุง ุ ุงูุนุงูู ููุณ ูุซุงูููุง.  ููุท ูู ุญุงูุฉ ูุนููุฉ ุ ุชุญุชุงุฌ ุฅูู ุงุฎุชูุงุฑ ุงููููู ุงูุฃูุซุฑ ููุงุกูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุทุฑููุฉ ุงูุชุชุจุน ุจุณูุทุฉ ุฌุฏุง.  ูุชู ุฃุฎุฐ ุนููุฉ ูู ุงูุจูุงูุงุช (ุนุงุฏุฉ ูุง ุชุชู ุชููุฆุชูุง ุจุฃุฑูุงู ุนุดูุงุฆูุฉ) ุ ููุชู ุฅุฑุณุงููุง ุฅูู ูุธููุฉ ุฃู ุทุฑููุฉ ุงููุตู ุงูุชู ุชูููุง ุ ูุชููู PyTorch ุจุฅูุดุงุก ูุชุฎุฒูู ุงูุฑุณู ุงูุจูุงูู ููุญุณุงุจ ุจููุณ ุงูุทุฑููุฉ ุงูุชู ุชูุนู ุจูุง ุนุงุฏุฉ ุนูุฏ ุชุฏุฑูุจ ุดุจูุฉ ุนุตุจูุฉ.  ููููุง - ุงููุต ุฌุงูุฒ: </p><br><pre style=";text-align:right;direction:rtl"><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torch <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torchvision model = torchvision.models.resnet34(pretrained = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) model.eval() sample = torch.rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">224</span></span>, <span class="hljs-number"><span class="hljs-number">224</span></span>) scripted_model = torch.jit.trace(model, sample)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููุซุงู ุฃุนูุงู ููุชุฌ ูุงุฆู ูู ูุฆุฉ ScriptModule.  ูููู ุญูุธู </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">scripted_model.save(<span class="hljs-string"><span class="hljs-string">'my_script.pth'</span></span>)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุซู ูู ุจุชุญูููู <a href="https://github.com/IlyaOvodov/TorchScriptTutorial/tree/master/cpp_proj">ูู ุจุฑูุงูุฌ C ++</a> (ุงููุฒูุฏ ุญูู ุฐูู <a href="https://habr.com/ru/company/ods/blog/480328/">ุฃุฏูุงู</a> ) ุฃู ูู ุฑูุฒ Python ุจุฏูุงู ูู ุงููุงุฆู ุงูุฃุตูู: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูููุฐุฌ ุดูุฑุฉ ุจูุซูู ุจุงุณุชุฎุฏุงู ูููุฐุฌ ูุญููุธ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> torchvision.transforms <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Compose, ToTensor, Normalize transforms = Compose([ToTensor(), Normalize(mean=[<span class="hljs-number"><span class="hljs-number">0.485</span></span>, <span class="hljs-number"><span class="hljs-number">0.456</span></span>, <span class="hljs-number"><span class="hljs-number">0.406</span></span>], std=[<span class="hljs-number"><span class="hljs-number">0.229</span></span>, <span class="hljs-number"><span class="hljs-number">0.224</span></span>, <span class="hljs-number"><span class="hljs-number">0.225</span></span>])]) img = cv2.resize(cv2.imread(<span class="hljs-string"><span class="hljs-string">'pics/cat.jpg'</span></span>), (<span class="hljs-number"><span class="hljs-number">224</span></span>,<span class="hljs-number"><span class="hljs-number">224</span></span>)) img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB) x = transforms(img).unsqueeze(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment"># add batch dimension scripted_model = torch.jit.load('my_script.pth') y = scripted_model(x) print(y[0].argmax(), y[0][y[0].argmax()])</span></span></code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">tensor(282) tensor(12.8130, grad_fn=&lt;SelectBackward&gt;)</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูููู ุฃู ูุธูุฑ <code>ScriptModule</code> ุงููุงุชุฌ ูู ุฃู ููุงู. ูุชู ุงุณุชุฎุฏุงู <code>nn.Module</code> ุจุดูู ุดุงุฆุน. </p><br><p style=";text-align:right;direction:rtl">  ุจุงูุทุฑููุฉ ุงูููุถุญุฉ ุ ููููู ุชุชุจุน ูุซููุงุช ูุฆุฉ ููุธุงุฆู <code>nn.Module</code> (ูู ุงูุญุงูุฉ ุงูุฃุฎูุฑุฉ ุ ูุชู <code>torch._C.Function</code> ุนูู ูุซูู ูู ูุฆุฉ <code>torch._C.Function</code> ). </p><br><p style=";text-align:right;direction:rtl">  ุชุชูุชุน ูุฐู ุงูุทุฑููุฉ (ุงูุชุชุจุน) ุจููุฒุฉ ูุงูุฉ: ูุจูุฐู ุงูุทุฑููุฉ ููููู ุชุญููู ุฃู ุฑูุฒ Python ูุง ูุณุชุฎุฏู ููุชุจุงุช ุฎุงุฑุฌูุฉ ุชูุฑูุจูุง.  ูููู ููุงู ุนูุจูุง ูุง ููู ุฃูููุฉ: ุจุงููุณุจุฉ ูุฃู ูุฑูุน ุ ูู ูุชู ุชุฐูุฑ ุณูู ุงููุฑุน ุงูุฐู ุชู ุชูููุฐู ุนูู ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x.max() &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -x my_abs_traced = torch.jit.trace(my_abs, torch.tensor(<span class="hljs-number"><span class="hljs-number">0</span></span>)) print(my_abs_traced(torch.tensor(<span class="hljs-number"><span class="hljs-number">1</span></span>)), my_abs_traced(torch.tensor(<span class="hljs-number"><span class="hljs-number">-1</span></span>)))</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">c:\miniconda3\lib\site-packages\ipykernel_launcher.py:2: TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs! tensor(1) tensor(-1)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนููุง!  ูุจุฏู ุฃู ูุฐุง ููุณ ูุง ููุฏ ุ ุฃููุณ ูุฐููุ  ูู ุงูุฌูุฏ ุฃู ูุชู ุฅุตุฏุงุฑ ุฑุณุงูุฉ ุชุญุฐูุฑ ุนูู ุงูุฃูู (TracerWarning).  ูุฌุฏุฑ ุงูุงูุชุจุงู ุฅูู ูุฐู ุงูุฑุณุงุฆู. </p><br><p style=";text-align:right;direction:rtl">  ููุง ุงูุทุฑููุฉ ุงูุซุงููุฉ ุชุฃุชู ููุณุงุนุฏุชูุง - ุงูุจุฑูุฌุฉ ุงููุตูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">my_abs_script = torch.jit.script(my_abs) print(my_abs_script(torch.tensor(<span class="hljs-number"><span class="hljs-number">1</span></span>)), my_abs_script(torch.tensor(<span class="hljs-number"><span class="hljs-number">-1</span></span>)))</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">tensor(1) tensor(1)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุตูุญุฉ ุ ูุชู ุงุณุชูุงู ุงููุชูุฌุฉ ุงููุชููุนุฉ!  ุชุญูู ุงูุจุฑูุฌุฉ ุงููุตูุฉ ุจุดูู ูุชูุฑุฑ ุดูุฑุฉ Python ูุชุญูููุง ุฅูู ููุฏ ุจูุบุชูุง ุงูุฎุงุตุฉ.  ูู ุงูุฅุฎุฑุงุฌ ุ ูุญุตู ุฃูุถูุง ุนูู ูุฆุฉ <code>ScriptModule</code> (ูููุญุฏุงุช ุงูููุทูุฉ) ุฃู <code>torch._C.Function</code> (ูููุธุงุฆู).  ูุจุฏู ุ ููุง ูู ุ ุงูุณุนุงุฏุฉ!  ูููู ููุงู ูุดููุฉ ุฃุฎุฑู ุชูุดุฃ: ูุบุฉ TorchScript ุงูุฏุงุฎููุฉ ููุชูุจุฉ ุจููุฉ ุ ุนูู ุนูุณ ุจูุซูู.  ูุชู ุชุญุฏูุฏ ููุน ูู ูุชุบูุฑ ุจูุงุณุทุฉ ุงููุงุฌุจ ุงูุฃูู ุ ูููุน ูุณูุทุงุช ุงูุฏุงูุฉ ุจุดูู ุงูุชุฑุงุถู ูู <code>Tensor</code> .  ูุฐูู ุ ุนูู ุณุจูู ุงููุซุงู ุ ููุท ูุฃููู </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> y = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x.max() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: y = x <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> y my_func = torch.jit.script(my_func)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณูู ุชูุดู ุชุชุจุน. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุฎุทุฃ ุชุชุจุน ูุดุจู ูุฐุง</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">RuntimeError Traceback (most recent call last) &lt;ipython-input-9-25414183a687&gt; in &lt;module&gt;() ----&gt; 1 my_func = torch.jit.script(my_func) d:\programming\3rd_party\pytorch\pytorch_ovod_1.3.0a0_de394b6\torch\jit\__init__.py in script(obj, optimize, _frames_up, _rcb) 1224 if _rcb is None: 1225 _rcb = _gen_rcb(obj, _frames_up) -&gt; 1226 fn = torch._C._jit_script_compile(qualified_name, ast, _rcb, get_default_args(obj)) 1227 # Forward docstrings 1228 fn.__doc__ = obj.__doc__ RuntimeError: Variable 'y' previously has type None but is now being assigned to a value of type Tensor : at &lt;ipython-input-8-75677614fca6&gt;:4:8 def my_func(x): y = None if x.max() &gt; 0: y = x ~ &lt;--- HERE return y</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฅูู ุฃูู ุนูู ุงูุฑุบู ูู ุญุฏูุซ ุฎุทุฃ ุนูุฏ <code>torch.jit.script</code> ุ ุชุชู ุงูุฅุดุงุฑุฉ ุฃูุถูุง ุฅูู ุงูููุงู ุงูุฐู ุชุณุจุจ ููู ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุตูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุญุชู ุงูููุงุท ุงูุชู ุชุจุฏุฃ ุจุนุฏ ุงูุซูุงุจุช ุชูุนุจ ุฏูุฑูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x.max() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: y = <span class="hljs-number"><span class="hljs-number">1.25</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: y = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> y my_func = torch.jit.script(my_func)</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุณูู ูุนุทู ุฎุทุฃ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">RuntimeError Traceback (most recent call last) &lt;ipython-input-10-0a5f18586763&gt; in &lt;module&gt;() 5 y = 0 6 return y ----&gt; 7 my_func = torch.jit.script(my_func) d:\programming\3rd_party\pytorch\pytorch_ovod_1.3.0a0_de394b6\torch\jit\__init__.py in script(obj, optimize, _frames_up, _rcb) 1224 if _rcb is None: 1225 _rcb = _gen_rcb(obj, _frames_up) -&gt; 1226 fn = torch._C._jit_script_compile(qualified_name, ast, _rcb, get_default_args(obj)) 1227 # Forward docstrings 1228 fn.__doc__ = obj.__doc__ d:\programming\3rd_party\pytorch\pytorch_ovod_1.3.0a0_de394b6\torch\jit\__init__.py in _rcb(name) 1240 # closure rcb fails 1241 result = closure_rcb(name) -&gt; 1242 if result: 1243 return result 1244 return stack_rcb(name) RuntimeError: bool value of Tensor with more than one value is ambiguous</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูุฃูู ูู ุงูุถุฑูุฑู ุนุฏู ูุชุงุจุฉ <code>0</code> ุ ูููู <code>0.</code> ุจุญูุซ ูููู ุงูููุน ูู ููุง ุงููุฑุนูู ูู ููุณู!  ูุฏูู ุ ููุง ุชุนูููู ุ ูุน ุงูุซุนุจุงู ุงูุฎุงุต ุจู! </p><br><p style=";text-align:right;direction:rtl">  ูุฐู ูุฌุฑุฏ ุจุฏุงูุฉ ูุงุฆูุฉ ุงูุชุบููุฑุงุช ุงูุชู ุชุญุชุงุฌ ุฅูู ุฅุฌุฑุงุฆูุง ูุดูุฑุฉ python ุจุญูุซ ูููู ุชุญููููุง ุจูุฌุงุญ ุฅูู ูุญุฏุฉ TorchScript.  ุณุฃุฐูุฑ ุงูุญุงูุงุช ุงูุฃูุซุฑ ูููุฐุฌูุฉ ุจูุฒูุฏ ูู ุงูุชูุงุตูู <a href="https://habr.com/ru/company/ods/blog/480328/">ูุงุญููุง</a> .  ูู ุญูุซ ุงููุจุฏุฃ ุ ูุง ููุฌุฏ ุนูู ุตูุงุฑูุฎ ููุง ุ ููููู ุชุตุญูุญ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุฎุงุตุฉ ุจู ููููุง ูุฐูู.  ููู ูู ูุนุธู ุงูุฃุญูุงู ูุง ุฃุฑูุฏ ุฅุตูุงุญ ูุญุฏุงุช ุงูุฌูุงุช ุงูุฎุงุฑุฌูุฉ ุ ุจูุง ูู ุฐูู ุงููุญุฏุงุช ุงูููุงุณูุฉ ูู <code>torchvision</code> ุ ููุงูุนุงุฏุฉ ูุง ุชููู ุนุงุฏุฉู ููุงุณุจุฉ ููุจุฑูุฌุฉ ุงููุตูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุญุณู ุงูุญุธ ุ ูููู ุฏูุฌ ููุชุง ุงูุชูููุชูู: ูุง ูุฌุฑู ูุชุงุจุชู ูุชู ูุชุงุจุชู ููุง ูุง ูุชู ูุชุงุจุชู ูู ุชุชุจุน: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyModule</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(torch.nn.Module)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super(MyModule, self).__init__() self.resnet = torchvision.models.resnet34(pretrained = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-comment"><span class="hljs-comment">#       torch.jit.script(my_module) #    -   resnet34. #     self.resnet  ScriptModule. self.resnet.eval() # NB:     !  -  ! self.resnet = torch.jit.trace(self.resnet, torch.rand((1,3,224,224), dtype=torch.float)) def forward(self, x): if x.shape[2] &lt; 224 or x.shape[3] &lt; 224: return torch.tensor(0) else: return self.resnet(x) my_module = MyModule() my_module = torch.jit.script(my_module)</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงููุซุงู ุฃุนูุงู ุ ูุชู ุงุณุชุฎุฏุงู ุงูุชุชุจุน ูุชุถููู ูุญุฏุฉ ุบูุฑ ูุงุจูุฉ ููุจุฑูุฌุฉ ูู ูุญุฏุฉ ููุทูุฉ ุญูุซ ูุง ููุฌุฏ ูุง ูููู ูู ุงูุชุชุจุน ูุงููุต ุงูุจุฑูุฌู ุถุฑูุฑู.  ููุงู ูููู ุนูุณู.  ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ููุง ุจุญุงุฌุฉ ุฅูู ุชุญููู ูููุฐุฌ ุฅูู ONNX ุ ูุณูุชู ุงุณุชุฎุฏุงู ุงูุชุชุจุน.  ููู ุงููููุฐุฌ ุงููุชุชุจุน ูุฏ ูุชุถูู ูุธุงุฆู TorchScript ุ ูุฐูู ูููู ุชูููุฐ ุงูููุทู ุงูุฐู ูุชุทูุจ ูุฌูุฏ ูุฑูุน ูุญููุงุช ููุงู!  ููุฑุฏ ูุซุงู ูู <a href="https://pytorch.org/docs/stable/onnx.html">ุงููุซุงุฆู ุงูุฑุณููุฉ ู torch.onnx</a> . </p><br><p style=";text-align:right;direction:rtl">  ูุชู ูุตู ุงูููุฒุงุช ุงูุชู ุชููุฑูุง PyTorch ูุฅูุดุงุก ูุญุฏุงุช TorchScript ุจูุฒูุฏ ูู ุงูุชูุตูู ูู <a href="https://pytorch.org/docs/stable/jit.html">ุงููุซุงุฆู ุงูุฑุณููุฉ</a> <code>torch.jit</code> .  ุนูู ูุฌู ุงูุฎุตูุต ุ ูู ุฃุฐูุฑ ุทุฑููุฉ ููุงุฆูุฉ ูุงุณุชุฎุฏุงู <code>torch.jit.trace</code> ู <code>torch.jit.script</code> ูู ุดูู <code>torch.jit.script</code> ุ ุญูู ุฎุตูุตูุงุช ุชุตุญูุญ ุงูุฃุฎุทุงุก ุงูุจุฑูุฌูุฉ ุงููุตูุฉ.  ูุฐุง ูุฃูุซุฑ ูู ุฐูู ุจูุซูุฑ ูู ุงููุซุงุฆู. </p><br><h2 id="anchorcppanchorvklyuchaem-model-v-proekt-na-c" style=";text-align:right;direction:rtl"><a name="cpp"></a>  ูุญู ูุฏุฑุฌ ุงููููุฐุฌ ูู ูุดุฑูุน C ++ </h2><br><p style=";text-align:right;direction:rtl">  ูุณูุก ุงูุญุธ ุ ุชูุชุตุฑ <a href="https://pytorch.org/tutorials/advanced/cpp_export.html">ุงููุซุงุฆู ุงูุฑุณููุฉ</a> ุนูู ุฃูุซูุฉ ูู ุงููููุฐุฌ "ุฅุถุงูุฉ 2 <code>torch.ones</code> ุงููุชููุฏุฉ ุจุงุณุชุฎุฏุงู <code>torch.ones</code> ".  ููุช ุจุฅุนุฏุงุฏ ูุซุงู <a href="https://github.com/IlyaOvodov/TorchScriptTutorial/tree/master/cpp_proj">ููุดุฑูุน ุฃูุฑุจ ุฅูู ุงููุงูุน</a> ูุฑุณู ุตูุฑุฉ ูู OpenCV ุฅูู ุงูุดุจูุฉ ุงูุนุตุจูุฉ ููุชููู ุงููุชุงุฆุฌ ูู ุดูู ููุชุฑ ุงูุงุณุชุฌุงุจุฉ ุ ูุฌููุนุฉ ูู ุงููุชุบูุฑุงุช ุ ุตูุฑุฉ ูุน ูุชุงุฆุฌ ุชุฌุฒุฆุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููุญุตูู ุนูู ูุซุงู ููุนูู ุ ุชุญุชุงุฌ ุฅูู ุจุฑุงูุฌ ูุตูุฉ ูุญููุธุฉ ูุญููุธุฉ ุจุงุณุชุฎุฏุงู ResNet34 ูุงูุชุฌุฒุฆุฉ ุจุงุณุชุฎุฏุงู DeepLabV3.  ูุฅุนุฏุงุฏ ูุฐู ุงูุจุฑุงูุฌ ุงููุตูุฉ ุ ุชุญุชุงุฌ ุฅูู ุชุดุบูู <a href="https://github.com/IlyaOvodov/TorchScriptTutorial/blob/master/prepare_scripts.ipynb">ูุฐู ุงููููุฑุฉ jupyter</a> . </p><br><p style=";text-align:right;direction:rtl">  ูุญู ุจุญุงุฌุฉ ุฅูู ููุชุจุฉ <code>torchlib</code> .  ููููู ุงูุญุตูู ุนููู ุจุนุฏุฉ ุทุฑู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู PyTorch ูุซุจุชูุง ูุฏูู ุจุงููุนู ุจุงุณุชุฎุฏุงู <code>pip install</code> ุ ูููููู ุงูุนุซูุฑ ุนููู ูู ุฏููู Python: <code>&lt;Miniconda3&gt;\Lib\site-packages\torch</code> ุ </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ูุฏูู PyTorch ูุชุฑุฌู ูู ุงููุตุฏุฑ ุ ูููุงู: <code>&lt;My Pytorch repo&gt;\build\lib.win-amd64-3.6\torch</code> ุ </li><li style=";text-align:right;direction:rtl">  ุฃุฎูุฑูุง ุ ููููู ุชูุฒูู <a href="https://pytorch.org/">ุงูููุชุจุฉ</a> ุจุดูู ูููุตู ูู <a href="https://pytorch.org/">pytorch.org</a> ุจุงุฎุชูุงุฑ Language = C ++ ุ ููู ุถุบุท ุงูุฃุฑุดูู. </li></ol><br><p style=";text-align:right;direction:rtl">  ุฑูุฒ C ++ ุจุณูุท ููุบุงูุฉ.  ูู ุงูุถุฑูุฑู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุถููู ููู ุงูุฑุฃุณ <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#include &lt;torch/script.h&gt;</code> </pre> </li><li style=";text-align:right;direction:rtl">  ุชุญููู ูููุฐุฌ <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">torch::jit::script::Module module = torch::jit::load("../resnet34_infer.pth");</code> </pre> </li><li style=";text-align:right;direction:rtl">  ุฅุนุฏุงุฏ ุงูุจูุงูุงุช <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">torch::Tensor tensor = torch::from_blob(img.data, { img.rows, img.cols, 3 }, torch::kByte);</code> </pre> </li><li style=";text-align:right;direction:rtl">  ุงุณุชุฏุนุงุก ูุธููุฉ <code>forward</code> ูุงูุญุตูู ุนูู ูุชูุฌุฉ <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">auto output = module.forward( { tensor } )</code> </pre> </li><li style=";text-align:right;direction:rtl">  ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ูู ุงููุชูุฌุฉ.  ุชุนุชูุฏ ููููุฉ ุงูููุงู ุจุฐูู ุนูู ูุง ุชููู ุจู ุงูุดุจูุฉ ุงูุนุตุจูุฉ.  ุจุงูููุงุณุจุฉ ุ ูู ุงูุญุงูุฉ ุงูุนุงูุฉ ุ ููููู ุฃูุถูุง ูุจูู ุตูุฑุฉ ูุงุญุฏุฉ ููุท ุ ูุฐูู ูู ุงูุฃูุถู ุฃู ููุธุฑ <a href="">ุฅูู ุงูููุฏ ุงููุตุฏุฑู ูููุซุงู</a> ุจุงููุงูู ุ ููุงู ุฎูุงุฑุงุช ูุฎุชููุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ููุญุตูู ุนูู ุจูุงูุงุช ูู ุงูููุชุฑ ุฃุญุงุฏู ุงูุจุนุฏ ูู ุงูููุน float: <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">float* data = static_cast&lt;float*&gt;(output.toTensor().data_ptr());</code> </pre> </li><li style=";text-align:right;direction:rtl">  ููุงู ูุงุญุฏ ุฃูุซุฑ ุฏูุฉ.  ูุง ุชูุณู ุฅุฏุฑุงุฌ ุงูุชูุงุซููุฉ <code>with torch.no_grad()</code> ูู ุงูููุฏ ุญุชู ูุง ุชูุฏุฑ ุงูููุงุฑุฏ ุนูุฏ ุญุณุงุจ ุงูุชุฏุฑุฌุงุช ุงูุชู ูุง ูุญุชุงุฌ ุฅูููุง ูุชุฎุฒูููุง.  ูุณูุก ุงูุญุธ ุ ูุง ูููู ุชุถููู ูุฐุง ุงูุฃูุฑ ูู ุงูุจุฑูุงูุฌ ุงููุตู ุ ูุฐูู ูุฌุจ ุนููู ุฅุถุงูุชู ุฅูู ุฑูุฒ C ++: <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">torch::NoGradGuard no_grad;</code> </pre> </li></ol><br><p style=";text-align:right;direction:rtl">  ุชู ุดุฑุญ ููููุฉ ุจูุงุก ูุดุฑูุน ุจุงุณุชุฎุฏุงู CMake ูู <a href="https://pytorch.org/tutorials/advanced/cpp_export.html">ุงูุฏููู ุงูุฑุณูู</a> .  ููู ูู ูุชู ุงููุดู ุนู ููุถูุน ุงููุดุฑูุน ูู Visual Studio ุ ูุฐูู ุณุฃุตูู ุจูุฒูุฏ ูู ุงูุชูุงุตูู.  ุณูุชุนูู ุนููู ุชุนุฏูู ุฅุนุฏุงุฏุงุช ุงููุดุฑูุน ูุฏูููุง: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงุฎุชุจุฑุช ูู Visual Studio 2017. ูุง ุฃุณุชุทูุน ุฃู ุฃููู ุนู ุงูุฅุตุฏุงุฑุงุช ุงูุฃุฎุฑู. </li><li style=";text-align:right;direction:rtl">  ูุฌุจ ุชุซุจูุช ูุฌููุนุฉ ุฃุฏูุงุช v14.11 v141 (ุนูุงูุฉ ุงุฎุชูุงุฑ <code>"VC++ 2017 version 15.4 v14.11 toolset"</code> ูู ุงููุซุจุช VS). </li><li style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุชููู ุงูููุตุฉ <code>x64</code> . </li><li style=";text-align:right;direction:rtl">  ูู <code>General โ Platform Toolset</code> ุญุฏุฏ <code>v141(Visual Studio 2017)</code> </li><li style=";text-align:right;direction:rtl">  ูู <code>C/C++ โ General โ Additional Include Directories</code> ุฅุถุงูุฉ <code>C/C++ โ General โ Additional Include Directories</code> <code>&lt;libtorch dir&gt;\include</code> </li><li style=";text-align:right;direction:rtl">  ูู <code>Linker โ General โ Additional Library Directories</code> ุฃุถู <code>&lt;libtorch dir&gt;\lib</code> </li><li style=";text-align:right;direction:rtl">  ูู <code>Linker โ Input โ Additional Dependencies</code> ุฅุถุงูุฉ <code>torch.lib; c10.lib</code>  <code>torch.lib; c10.lib</code> .  ุนูู ุงูุฅูุชุฑูุช ุ ููุชุจูู ุฃู <code>caffe2.lib</code> ูุฏ ูุง ุชุฒุงู ููุงู ุญุงุฌุฉ ุ ูุจุงููุณุจุฉ ุฅูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช ูุดูุก ุขุฎุฑ ูู <code>&lt;libtorch dir&gt;\lib</code> ุ ูููู ูู ุงูุฅุตุฏุงุฑ ุงูุญุงูู ุ ูุงูุช ุฅุถุงูุฉ ูุงุชูู ุงูููุชุจุชูู ูุงููุฉ ูู.  ุฑุจูุง ูุฐู ูุนูููุงุช ูุฏููุฉ. </li><li style=";text-align:right;direction:rtl">  ููุชุจูู ุฃูุถูุง ุฃูู ุจุญุงุฌุฉ ุฅูู ุถุจุท <code>C/C++ โ Language โ Conformance Mode</code> = <code>No</code> ุ ููููู ูู ุฃุฑ ุงููุฑู. </li></ol><br><p style=";text-align:right;direction:rtl">  ุฃูุถูุง ุ ูุฌุจ ุนุฏู ุฅุนูุงู ูุชุบูุฑ <code>__cplusplus</code> ูู ุงููุดุฑูุน.  ูุญุงููุฉ ุฅุถุงูุฉ <a href="https://docs.microsoft.com/ru-ru/cpp/build/reference/zc-cplusplus%3Fview%3Dvs-2017"><code>  /Zc:__cplusplus</code></a> ุณููุชุฌ ุนูู ุฃุฎุทุงุก ูู <code>ivalue.h</code> ููู <code>ivalue.h</code> . </p><br><p style=";text-align:right;direction:rtl">  ูู <a href="https://github.com/IlyaOvodov/TorchScriptTutorial/tree/master/cpp_proj">ุงููุดุฑูุน ุงููุฑูู ุ ูุชู</a> ุฅุนุฏุงุฏ ุฅุนุฏุงุฏุงุช ุงููุณุงุฑ (ููุณ ููุท TorchLib ุ ูููู ุฃูุถูุง ุนูู OpenCV ู CUDA) ูู <a href="https://github.com/IlyaOvodov/TorchScriptTutorial/blob/master/cpp_proj/cpp_proj.props">ููู ุงูุฏุนุงุฆู</a> ุ ูุจู ุงูุชุฌููุน ุ ุชุญุชุงุฌ ุฅูู ุชุณุฌูููู ููุงู ููููุง ููุชููุฆุฉ ุงููุญููุฉ.  ูุฐุง ุ ูู ุงููุงูุน ุ ูู ูู ุดูุก. </p><br><h2 id="anchortipsanchorchto-eschyo-sleduet-imet-v-vidu" style=";text-align:right;direction:rtl"><a name="tips"></a>  ูุงุฐุง ูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ </h2><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ุจุฏุง ูู ุฃู ุงูุนูููุฉ ุงูููุตููุฉ ุจุณูุทุฉ ููุบุงูุฉ ุ ููู ูุฎุฏุนู ุญุฏุณู.  ููุงู ุนุฏุฏ ูู ุงููุฑูู ุงูุฏูููุฉ ุงูุชู ูุฌุจ ูุฑุงุนุงุชูุง ูู ุฃุฌู ุชุญููู ูููุฐุฌ PyTorch ุงูููุชูุจ ูู Python ุฅูู TorchScript.  ุณุฃุฏุฑุฌ ุฃุฏูุงู ุชูู ุงูุชู ูุงุฌูุชูู.  ููุฏ ุฐูุฑุช ุจุงููุนู ุงูุจุนุถ ุ ููููู ูุฑุฑุช ุฌูุน ูู ุดูุก ูู ููุงู ูุงุญุฏ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/iv/xy/q-/ivxyq-lqqw8s1aqd_cy4t4uwj5i.jpeg"></p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุน ุงููุชุบูุฑุงุช ุงูุชู ุชู ุชูุฑูุฑูุง ุฅูู ุงููุธููุฉ ูู Tensor ุจุดูู ุงูุชุฑุงุถู.  ุฅุฐุง ูุงู ูุฐุง ุบูุฑ ููุจูู ูู ุจุนุถ ุงูุญุงูุงุช (ุงููุชูุฑุฑุฉ ุฌุฏูุง) ุ ูุณูุชุนูู ุนููู ุงูุฅุนูุงู ุนู ุงูุฃููุงุน ูุฏูููุง ุจุงุณุชุฎุฏุงู ุงูุชุนูููุงุช ุงูุชูุถูุญูุฉ ูููุน ููุท MyPy ุ ููุฐุง ุดูุก ูุซู ูุฐุง: </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calc_letter_statistics</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, cls_preds: List[Tensor], cls_thresh: float)</span></span></span><span class="hljs-function">-&gt;Tuple[int, Tuple[Tensor, Tensor, Tensor]]</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงู ูุญู ุฐูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calc_letter_statistics</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, cls_preds, cls_thresh)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># type: (List[Tensor], float)-&gt;Tuple[int, Tuple[Tensor, Tensor, Tensor]]</span></span></code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุชู ูุชุงุจุฉ ุงููุชุบูุฑุงุช ุจุดุฏุฉ ููุชู ุชุญุฏูุฏ ุงูููุน ุ ุฅุฐุง ูู ูุชู ุชุญุฏูุฏู ุตุฑุงุญุฉ ุ ุจูุงุณุทุฉ ุงููุงุฌุจ ุงูุฃูู.  ุงูุฅูุดุงุกุงุช ุงููุฃูููุฉ ูููููุฐุฌ <code>x=[]; for ...: x.append(y)</code>  <code>x=[]; for ...: x.append(y)</code> ุ ูุฃู  ูู ููุช ุงูุชุนููู <code>[]</code> ูุง ูููู ูููุชุฑุฌู ูุนุฑูุฉ ุฃู ููุน ุณูููู ูู ุงููุงุฆูุฉ.  ูุฐูู ุ ูุฌุจ ุนููู ุชุญุฏูุฏ ุงูููุน ุจุดูู ุตุฑูุญ ุ ุนูู ุณุจูู ุงููุซุงู: </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> typing <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> List x: List[float] = []</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃู (ุขุฎุฑ "ุนูู ุณุจูู ุงููุซุงู") </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> torch <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Tensor <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> typing <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dict, Tuple, List x: Dict[int: Tuple[float, List[Tensor], List[List[int]]]] = {}</code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุงููุซุงู ุฃุนูุงู ุ ูู ุงูุฃุณูุงุก ุงูุชู ูุฌุจ ุงุณุชูุฑุงุฏูุง ุ ุญูุซ ูุชู ุญูุงูุฉ ูุฐู ุงูุฃุณูุงุก ูู ุดูุฑุฉ TorchScript.  ููุฌ ุจุฏูู ูุงูููู ุนูู ูุง ูุจุฏู </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> torch <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> typing x: typing.List[torch.Tensor] = []</code> </pre> <br><p style=";text-align:right;direction:rtl">  <em>ุณููุชุฌ</em> ุฎุทุฃ <em>ููุดุฆ ูุชุงุจุฉ ุบูุฑ ูุนุฑูู ููุดุฆ ุงููุชุงุจุฉ</em> ุนูุฏ ุงูุจุฑูุฌุฉ ุงููุตูุฉ </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุตููู ูุฃููู ุขุฎุฑ ูุฌุจ ุฃู ุชุชุฎูู ุนูู: </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">x = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> smth: x = torch.tensor([<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>])</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงู ุฎูุงุฑุงู.  ุฃู ูู ุจุชุนููู Tensor ูู ูู ูุฑุฉ (ุญูููุฉ ุฃูู ูู ุฃุจุนุงุฏ ูุฎุชููุฉ ููุณ ูุฎูููุง): </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">x = torch.tensor(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> smth: x = torch.tensor([<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>])</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ุชูุณู ุฃู ุชุจุญุซ ุนู ูุง ุณูู ูููุณุฑ ุจุนุฏ ูุฐุง ุงูุงุณุชุจุฏุงู.  ุฃู ุญุงูู ุฃู ุชูุชุจ ุจุฃูุงูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">x: Optional[Tensor] = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> smth: x = torch.tensor([<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>])</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุจุนุฏ ุฐูู ูุน ุงูุงุณุชุฎุฏุงู ุงูุฅุถุงูู ูู <code>x</code> ุญูุซ ูุชููุน ุญุฏูุซ ุงูููุชุฑ ุ ูู ุงููุญุชูู ุฃู ูุญุตู ุนูู ุฎุทุฃ: <em>ุชููุน ูููุฉ ุงูููุน 'Tensor' ูููุณูุทุฉ 'x' ูููู ุจุฏูุงู ูู ุฐูู ุ ูุฌุฏูุง ุงูููุน 'ุงุฎุชูุงุฑู [Tensor]'.</em> </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุง ุชูุณ ุงููุชุงุจุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ <code>x=0.</code> ุฃุซูุงุก ุงููููุฉ ุงูุฃููู <code>x=0.</code>  ุจุฏูุงู ูู ุงููุนุชุงุฏ <code>x=0</code> ุ ุฅูุฎ ุ ุฅุฐุง ูุงู ุงููุชุบูุฑ <code>x</code> ูุฌุจ ุฃู ูููู ูู ุงูููุน <code>float</code> . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุฅุฐุง ุงุณุชุฎุฏููุง ูู ููุงู ูุง ุงูุชููุฆุฉ ุงููุฏููุฉ <code>x = torch.Tensor(...)</code> ุนุจุฑ <code>x = torch.Tensor(...)</code> ุ ูุณูุชุนูู ุนููู <code>x = torch.Tensor(...)</code> ุนูู ูุงุณุชุจุฏุงูู ุจุฅุตุฏุงุฑ ุฃุตุบุฑ ุจุญุฑู ุตุบูุฑ <code>x = torch.tensor(...)</code> .  ุฎูุงู ุฐูู ุ ุฃุซูุงุก ุงูุจุฑูุฌุฉ ุงููุตูุฉ ุณูู ูุทูุฑ: <em>Unknown buildin op: aten :: Tensor.</em>  <em>ูููุง ููู ุจุนุถ ุงูุงูุชุฑุงุญุงุช: aten :: tensor</em> .  ูุจุฏู ุฃููู ุญุชู ููุณุฑูู ูุง ูู ุงููุดููุฉ ุ ููู ุงููุงุถุญ ูุง ูุฌุจ ุงูููุงู ุจู.  ููุน ุฐูู ุ ููู ุงููุงุถุญ ุฅุฐุง ููุช ุชุนุฑู ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ ุจุงููุนู. </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุชุชู <code>torch.jit.script</code> ุงูุดูุฑุฉ ูู ุณูุงู ุงููุญุฏุฉ ุงูููุทูุฉ ุญูุซ <code>torch.jit.script</code> ุงุณุชุฏุนุงุก <code>torch.jit.script</code> .  ูุฐูู ุ ุฅุฐุง ูุงู ููุงู ููุงู ูุง ุ ูู ุฃุญุดุงุก ุงูุทุจูุฉ ุฃู ุงููุธููุฉ ุงููุตูุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ <code>math.pow</code> ุ <code>math.pow</code> ุฅูู ุฅุถุงูุฉ <code>import math</code> ุฅูู ูุญุฏุฉ <code>math.pow</code> .  ููู ุงูุฃูุถู ูุชุงุจุฉ ุงูุจุฑูุงูุฌ ุงููุตู ูููุฆุฉ ุญูุซ ูุชู ุงูุฅุนูุงู ุนููุง: ุฅูุง ุจุงุณุชุฎุฏุงู <code>@torch.jit.script</code> ุงูุฏูููุฑ <code>@torch.jit.script</code> ุ ุฃู ุนู ุทุฑูู ุงูุฅุนูุงู ุนู ูุธููุฉ ุฅุถุงููุฉ ุจุฌุงูุจูุง ุชุฌุนู ScriptModule ุฎุงุฑุฌูุง.  ุฎูุงู ุฐูู ุ ูุญุตู ุนูู ุฑุณุงูุฉ ุฎุทุฃ ูู <em>ุงูุฑูุงุถูุงุช ุบูุฑ ูุญุฏุฏุฉ ุงููููุฉ</em> ุนูุฏูุง ูุญุงูู ุชุฑุฌูุฉ ูุฆุฉ ูู ูุญุฏุฉ ููุทูุฉ ุ ุนูู ูุง ูุจุฏู ุ ุชู ุฅุฌุฑุงุก ุงุณุชูุฑุงุฏ <code>math</code> . </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ูุฏูู ูู ููุงู ูุง ุจูุงุก ุงููููุฐุฌ <code>my_tensor[my_tensor &lt; 10] = 0</code> ุฃู ูุง ุดุงุจู ุ ูุณูู ุชุญุตู ุนูู ุฎุทุฃ ูุดูุฑ ุนูุฏ ุงูุจุฑูุฌุฉ ุงููุตูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">*aten::index_put_(Tensor(a!) self, Tensor?[] indices, Tensor values, bool accumulate=False) -&gt; (Tensor(a!)):* *Expected a value of type 'Tensor' for argument 'values' but instead found type 'int'.* *aten::index_put_(Tensor(a!) self, Tensor[] indices, Tensor values, bool accumulate=False) -&gt; (Tensor(a!)):* *Expected a value of type 'List[Tensor]' for argument 'indices' but instead found type 'List[Optional[Tensor]]'.*</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุง ุชุญุชุงุฌู ูู ุงุณุชุจุฏุงู ุงูุฑูู <code>my_tensor[my_tensor &lt; 10] = torch.tensor(0.).to(my_tensor.device)</code> : <code>my_tensor[my_tensor &lt; 10] = torch.tensor(0.).to(my_tensor.device)</code> .  ููุง ุชูุณู ุฃ) ูุฑุงุณูุงุช ุฃููุงุน <code>my_tensor</code> ู tensor ุงูุชู ุชู ุฅูุดุงุคูุง (ูู ูุฐู ุงูุญุงูุฉ ุ ุชุทูู) ู b) ุญูู <code>.to(my_tensor.device)</code> .  ุฅุฐุง ูุณูุช ุงูุซุงููุฉ ุ ูุณูุชู ูุชุงุจุฉ ูู ุดูุก ุ ูููู ุจุงููุนู ูู ุนูููุฉ ุงูุนูู ูุน GPU ุ ุณูู ุชุดุนุฑ ุจุงูุงูุฒุนุงุฌ ุ ูุงูุชู ุณุชุจุฏู ููุฃููุง ูููุฉ ุฎููุฉ <em>CUDA error: ุชูุช ูุตุงุฏูุฉ ูุตูู ุบูุฑ ูุงูููู ููุฐุงูุฑุฉ</em> ุ ุฏูู ุงูุฅุดุงุฑุฉ ุฅูู ููุงู ุญุฏูุซ ุงูุฎุทุฃ! </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุง ุชูุณู ุฃูู ูุชู ุงูุชุฑุงุถููุง <code>nn.Module</code> ุ ูุจุงูุชุงูู ูุชู ุฅูุดุงุก ููุงุฐุฌ ูู torchvision ูู "ูุถุน ุงููุทุงุฑ" (ูู ุชุตุฏู ุฐูู ุ ููู ูุจุฏู ุฃู <a href="https://fooobar.com/questions/16769103/error-when-converting-pytorch-model-to-torchscript/25666033">ููุงู ูุซู ูุฐุง ุงููุถุน</a> ).  ูู ูุฐู ุงูุญุงูุฉ ุ ูุชู ุงุณุชุฎุฏุงู Dropout ูุงูุญูู ุงูุฃุฎุฑู ูู ูุถุน ุงููุทุงุฑ ุ ูุงูุชู ุฅูุง ุฃู ุชูุณุฑ ุงูุชุชุจุน ุฃู ุชุคุฏู ุฅูู ูุชุงุฆุฌ ุบูุฑ ูุงููุฉ ุนูุฏ ุชูููุฐูุง.  ุชุฐูุฑ ุงุณุชุฏุนุงุก <code>model.eval()</code> ูุจู ุงูุจุฑูุฌุฉ ุงููุตูุฉ ุฃู ุงูุชุชุจุน. </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ูููุธุงุฆู ูุงููุฆุงุช ุงูุนุงุฏูุฉ ุ ุชุญุชุงุฌ ุฅูู ูุชุงุจุฉ ุงูุณููุงุฑูู ุ ุจุงููุณุจุฉ ุฅูู nn.Module - ูุซูู </p><br></li><li style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุญุงููุฉ ุจุทุฑููุฉ ูุตูุฉ ูููุตูู ุฅูู ูุชุบูุฑ ุนูููู </p><br></li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">cls_thresh = <span class="hljs-number"><span class="hljs-number">0.3</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyModule</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(torch.nn.Module)</span></span></span><span class="hljs-class">:</span></span> ... x = r &lt; cls_thresh ...</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณูุคุฏู ุฐูู ุฅูู ุญุฏูุซ ุฎุทุฃ ูู ุงูุจุฑูุฌุฉ ุงููุตูุฉ <em>ููููุฉ python ููููุน 'float' ูุง ูููู ุงุณุชุฎุฏุงูู ููููุฉ</em> .  ูู ุงูุถุฑูุฑู ุฌุนู ุงููุชุบูุฑ ุณูุฉ ูู ุงููููุดุฆ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">cls_thresh = <span class="hljs-number"><span class="hljs-number">0.3</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyModule</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(torch.nn.Module)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> ... self.cls_thresh = cls_thresh ... x = r &lt; self.cls_thresh ...</code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชูุดุฃ ุฏูุฉ ุฃุฎุฑู ุฅุฐุง ุชู ุงุณุชุฎุฏุงู ุณูุฉ ุงููุฆุฉ ููุนููุฉ ุดุฑูุญุฉ: </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FPN</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(nn.Module)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, block, num_blocks, num_layers =</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> ... self.num_layers = num_layers <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">forward</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (p3, p4, p5, p6, p7)[:self.num_layers]</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุคุฏู <em>ูุฌุจ ุฃู ุชููู ูุคุดุฑุงุช ุงูุดุฑูุญุฉ tuple</em> ุฎุทุฃ ุงูุจุฑูุฌุฉ ุงููุตูุฉ <em>ุซูุงุจุช ุนุฏุฏ ุตุญูุญ</em> .  ูู ุงูุถุฑูุฑู ุงูุฅุดุงุฑุฉ ุฅูู ุฃู ุณูุฉ num_layers ุซุงุจุชุฉ ููู ุชุชุบูุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FPN</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(nn.Module)</span></span></span><span class="hljs-class">:</span></span> num_layers: torch.jit.Final[int] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, block, num_blocks, num_layers =</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> ...</code> </pre> <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุจุนุถ ุงูุญุงูุงุช ุ ุญูุซ ูุงู ุงูููุชุฑ ูุณุชุฎุฏู ูุชูุงุณุจ ุจุดูู ุทุจูุนู ุ ุชุญุชุงุฌ ุฅูู ุชูุฑูุฑ ุงูุฑูู ุจุดูู ุตุฑูุญ: </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">xx1 = x1.clamp(min=x1[i])</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุฎุทุฃ ุนูุฏ ุงูุจุฑูุฌุฉ ุงููุตูุฉ <em><code>Expected a value of type 'Optional[number]' for argument 'min' but instead found type 'Tensor'.</code></em>  .  ุญุณููุง ุ ูู ุฑุณุงูุฉ ุงูุฎุทุฃ ุ ูู ุงููุงุถุญ ูุง ูุฌุจ ุงูููุงู ุจู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">xx1 = x1.clamp(min=x1[i].item())</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงููุดุงูู ุงููุฐููุฑุฉ ุฃุนูุงู ุชุญุฏุซ ุนูุฏ ุงูุจุญุซ ุนู ุงูููููุฏูู.  ุจุณุจุจูู ุ ูุง ูููู ุนุงุฏุฉู ุชุฑุฌูุฉ ุงูุญููู ุงูุฌุงูุฒุฉ ูู TorchScript ุ ูุนููู ุฅูุง ุชุฏููู ุงูููุฏ ุงููุตุฏุฑู ููุชุฑุฉ ุทูููุฉ (ุฅุฐุง ูุงู ุงูููุฏ ุงููุตุฏุฑู ููุงุณุจูุง ููุชุญุฑูุฑ) ุ ุฃู ุงุณุชุฎุฏุงู ุงูุชุชุจุน.  ููู ุชุชุจุน ุงููุฑูู ุงูุฏูููุฉ ุงูุฎุงุตุฉ ุจู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุง ุชุนูู ุจููุงุช ุงููููุฐุฌ ูู ุงูุชุชุจุน </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">tensor_a.to(tensor_b.device)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุชุซุจูุช ุงูุฌูุงุฒ ุงูุฐู ุชู ุชุญููู ุงูููุชุฑ ุนููู ูู ููุช ุงูุชุชุจุน ููุง ูุชุบูุฑ ุฃุซูุงุก ุงูุชูููุฐ.  ูููู ุงูุชุบูุจ ุนูู ูุฐู ุงููุดููุฉ ุฌุฒุฆููุง ุนู ุทุฑูู ุฅุนูุงู ุงูููุชุฑ ุนุถููุง ูู <code>nn.Module</code> ุงูููุน <code>Parameter</code> .  ุซู ุ ุนูุฏ ุชุญููู ุงููููุฐุฌ ุ ุณูุชู ุชุดุบููู ุนูู ุงูุฌูุงุฒ ุงููุญุฏุฏ ูู ูุธููุฉ <code>torch.jit.load</code> . </p><br><h2 id="epilog" style=";text-align:right;direction:rtl">  ุฎุงุชูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ูู ูุง ุณุจู ุ ุจุงูุทุจุน ุ ูุฎูู ูุดุงูู.  ููู TorchScript ูุชูุญ ูู ุงูุฌูุน ุจูู ุงููููุฐุฌ ูุฅุฑุณุงูู ุฅูู ุงูุญู ููู ูุฑูุฒ Python ุงูุฐู ูููุฑ ุงููุนุงูุฌุฉ ูุจู ูุจุนุฏ ุงููุนุงูุฌุฉ.  ูุนู ุ ูุงูููุช ุงููุงุฒู ูุฅุนุฏุงุฏ ุงูุญู ููุชุฌููุน ุ ุนูู ุงูุฑุบู ูู ุงูุตุนูุจุงุช ุงููุฐููุฑุฉ ุฃุนูุงู ุ ุฃูู ุจูุซูุฑ ูู ุชูููุฉ ุฅูุดุงุก ุญู ุ ูููู ููุง PyTorch ุชูุฏู ูุฒุงูุง ุฑุงุฆุนุฉ ุ ูุจุงูุชุงูู ูุฅู ุงููุนุจุฉ ุชุณุชุญู ูู ูุฐุง ุงูุนูุงุก. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/v0/3m/qt/v03mqtayxdfh5be4ut3nrr0c86q.jpeg"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar480328/">https://habr.com/ru/post/ar480328/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar480316/index.html">ููููุฉ ุชูููู ุงุณุชููุงู ูุญุฏุงุช wifi ุจููุฏุงุฑ ุนุดุฑ ูุฑุงุช ุฃู ุฃูุซุฑ</a></li>
<li><a href="../ar480318/index.html">ูุฌููุนุฉ ูุฎุชุงุฑุฉ ูู ุงูุฃุญุฏุงุซ ุงููุฌุงููุฉ ุงููุงุฏูุฉ ูููุทูุฑูู ูู ููุณูู ุฑูู 3 (16-24 ุฏูุณูุจุฑ)</a></li>
<li><a href="../ar480320/index.html">ุนุดุฑ ุณููุงุช ูู ONYX ูู ุฑูุณูุง - ููู ุชุบูุฑุช ุงูุชูููุงุช ูุงููุฑุงุก ูุงูุณูู ุฎูุงู ูุฐุง ุงูููุช</a></li>
<li><a href="../ar480324/index.html">ุชูููุฐ ููุน ุงูุณูุณูุฉ ูู CPython</a></li>
<li><a href="../ar480326/index.html">ุชุฑุณู F5 Networks Corporation ุฑุณุงุฆู ุฅูู ุนููุงุฆูุง ูุฅุจูุงุบูู ุจุงููุถุน ุงูุญุงูู ูุน NGINX</a></li>
<li><a href="../ar480330/index.html">ุฃุฏุงุฉ ุชูููู ุงูููุธู ุงููุซุงูู</a></li>
<li><a href="../ar480332/index.html">ุชุญููู ุจูุงูุงุช ุงูุชุตููุช blockchain 2019 ูู ูุฏููุฉ ููุณูู ุฏููุง</a></li>
<li><a href="../ar480334/index.html">QtQML / ููุญุฉ ุงูุงุฑุชุจุงุท ุงูุณุฑูุน</a></li>
<li><a href="../ar480338/index.html">ููู ูุนูู ุนุฑุถ ุงูุฃูุนุงุจ ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ: ุงูุชูููุท ูุชุนูุจ ุงูุดุนุงุน</a></li>
<li><a href="../ar480340/index.html">ููุฏ ุนุงุฑุถุช ูุฏูุฑูุง ุบูุฑ ููุก ุ ุซู ุชูุช ุชุฑููุชู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>