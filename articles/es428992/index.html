<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚öñÔ∏è üêñ üôé Bypass selectivo de bloqueos en enrutadores con firmware Padavan y Keenetic OS üßíüèø üè£ ü§∂üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se ha publicado una gran cantidad de instrucciones con varias opciones para evitar el bloqueo de recursos de Internet. Pero el tema no pierde relevanc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bypass selectivo de bloqueos en enrutadores con firmware Padavan y Keenetic OS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428992/"> Se ha publicado una gran cantidad de instrucciones con varias opciones para evitar el bloqueo de recursos de Internet.  Pero el tema no pierde relevancia.  A√∫n m√°s a menudo, se escuchan iniciativas a nivel legislativo para bloquear art√≠culos sobre m√©todos para evitar las cerraduras.  Y hubo rumores de que Roskomnadzor recibir√° otro paquete de dinero de los contribuyentes por "mejores" cerraduras.  Los usuarios experimentados no aprender√°n nada nuevo o √∫til del art√≠culo.  Pero otros recibir√°n instrucciones paso a paso ya preparadas para una derivaci√≥n selectiva simple y efectiva de las cerraduras en los enrutadores populares con firmware Padavan y Keenetic. <br><br><img src="https://habrastorage.org/webt/is/kb/td/iskbtdxuaisqiyg3r4tsrjhj6aw.jpeg"><br><a name="habracut"></a><br><h1>  Contenido </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Introduccion</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬øC√≥mo lograr√° evitar los bloqueos despu√©s de la configuraci√≥n?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Principio de funcionamiento</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Configurar un enrutador Padavan</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Configurar un enrutador con Keenetic OS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">M√©todos b√°sicos para diagnosticar errores despu√©s de la configuraci√≥n.</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Bypass adicional para filtrar consultas DNS por parte del proveedor</a> </li></ul><br><a name="con1"></a><h1>  Introduccion </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Us√©</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la opci√≥n de bypass de bloqueo</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Zolg</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">durante</a> unos dos a√±os.  Muchas instrucciones en la red se basan en ella.  El m√≠o incluido. <br><br>  Todo estaba bien, pero "lo mejor siempre es enemigo de lo bueno".  En primer lugar, algunos programas nuevos se han vuelto demasiado "inteligentes" y resolver√°n dominios usando sus propios m√©todos, sin pasar por el servidor DNS del enrutador.  Esto no permite que dnsmasq en el enrutador agregue la direcci√≥n al conjunto de ipset para desbloquear y conduce a un resultado l√≥gico: el recurso permanece bloqueado.  En Android 9, soporte nativo para DNS sobre TLS, es decir  Este m√©todo de evitar el bloqueo deja de funcionar (si el otro dispositivo no ha accedido a dnsmasq antes).  En segundo lugar, actualizar toda la lista de dominios desde antizapret conduce a resultados impredecibles cada vez.  La lista puede incluir dominios que no est√°n realmente bloqueados y cuya operaci√≥n es importante a trav√©s del canal principal.  Debe estar constantemente alerta y editar los archivos generados con sus manos.  En tercer lugar, estoy cansado de "llevar" una enorme lista de dominios con decenas de miles de casinos y similares, que simplemente no son necesarios.  Con el tiempo, me di cuenta de que solo necesitaba una peque√±a lista espec√≠fica de recursos bloqueados. <br><br>  As√≠ que durante un a√±o he estado usando un m√©todo de desbloqueo ligeramente modificado, con el que estoy completamente satisfecho: <br><br><ul><li>  Simplicidad y facilidad de control (despu√©s de la configuraci√≥n). </li><li>  Control total sobre los recursos que necesita para desbloquear. </li><li>  Requisitos m√≠nimos para los recursos del procesador y la RAM del enrutador. </li><li>  Amplia cobertura de matices al evitar las cerraduras. </li></ul><br>  Es importante tener en cuenta que mi opci√≥n no est√° pensada para el caso en que necesite desbloquear cientos y miles de dominios.  Porque cuando se inicia el enrutador, se resuelve cada dominio de la lista dada.  Cuantos m√°s dominios haya en la lista, mayor ser√° la inicializaci√≥n de muchos ipset para desbloquear. <br><br>  La base para evitar las cerraduras es la misma: la red Tor.  Su uso se debe a dos factores simples: de forma gratuita, y la probabilidad de que Tor sea bloqueado en Rusia es cercana a cero, a diferencia de cualquier servicio VPN.  Tor es la base del narcotr√°fico en Rusia desde el medio hasta el fondo.  El bloqueo de Tor conducir√° a la b√∫squeda de nuevas herramientas para el mercado y a una disminuci√≥n del anonimato, lo que implicar√° la activaci√≥n exitosa del trabajo de las agencias locales de aplicaci√≥n de la ley.  En √∫ltima instancia, esto, como un virus, comenzar√° a afectar negativamente el enlace superior.  Dadas las √∫ltimas noticias sorprendentes sobre la relaci√≥n de altos funcionarios del gobierno con el tr√°fico mundial de drogas hacia Rusia, el bloqueo de Tor en Rusia es solo un tab√∫, aunque es trivial.  Ni Roskomnadzor, no importa cu√°ntos miles de millones se asignen a este departamento, ni un solo tribunal en Rusia tiene permiso "desde arriba" para bloquear Tor.  Y ni siquiera sorprende a nadie ni asusta a nadie, a pesar de que Rusia simplemente se est√° ahogando en drogas (cualquier alumno sabe lo que va a hacer, y despu√©s de 30 minutos es realmente posible en cualquier ciudad con una poblaci√≥n de 10 mil personas obtener pr√°cticamente cualquier droga de forma gratuita en cualquier cantidad, una verdad tan malvada de la vida).  En el modo actual, la probabilidad de bloquear la red Tor es menor que la probabilidad de bloquear el sitio del museo Hermitage. <br><br>  Las instrucciones dadas son f√°ciles de adaptar para enrutadores con OpenWrt.  Adem√°s, peque√±os cambios hacen que sea f√°cil reemplazar Tor con OpenVPN. <br><br><a name="con11"></a><h1>  ¬øC√≥mo lograr√° evitar los bloqueos despu√©s de la configuraci√≥n? </h1><br>  Todo es muy sencillo.  Tiene el archivo /opt/etc/unblock.txt, una lista simple para desbloquear.  Puede desbloquear un dominio, direcci√≥n IP, rango de direcciones o CIDR.  Una l√≠nea, un elemento.  Se permiten l√≠neas vac√≠as, y puede usar el car√°cter # al comienzo de la l√≠nea para ignorar. <br><br><div class="spoiler">  <b class="spoiler_title">Aqu√≠ hay un ejemplo de mi archivo personal</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">###- rutracker.org rutor.info rutor.is mega-tor.org kinozal.tv nnm-club.me nnm-club.ws tfile.me tfile-home.org tfile1.cc megatfile.cc megapeer.org megapeer.ru tapochek.net tparser.org tparser.me rustorka.com uniongang.tv fast-torrent.ru ###    rezka.ag hdrezka.ag hdrezka.me filmix.co filmix.cc seasonvar.ru ### lib.rus.ec flibusta.is flibs.me flisland.net flibusta.site ### telegram.org tdesktop.com tdesktop.org tdesktop.info tdesktop.net telesco.pe telegram.dog telegram.me t.me telegra.ph web.telegram.org desktop.telegram.org updates.tdesktop.com venus.web.telegram.org flora.web.telegram.org vesta.web.telegram.org pluto.web.telegram.org aurora.web.telegram.org 149.154.160.0/20 91.108.4.0/22 91.108.8.0/22 91.108.12.0/22 91.108.16.0/22 91.108.56.0/22 109.239.140.0/24 67.198.55.0/24 ### 7-zip.org edem.tv 4pna.com 2019.vote ### Tor check.torproject.org ###   IP ( #   ) #195.82.146.214 ###   CIDR ( #   ) #103.21.244.0/22 ###    ( #   ) #100.100.100.200-100.100.100.210</span></span></code> </pre> <br></div></div><br>  Despu√©s de editar este archivo, simplemente ejecute el comando para aplicar la nueva configuraci√≥n: <br><br><pre> <code class="bash hljs">unblock_update.sh</code> </pre> <br>  Todos los recursos de unblock.txt se desbloquean sin tener que reiniciar el enrutador. <br><br><a name="con12"></a><h1>  Principio de funcionamiento </h1><br><ul><li>  La inicializaci√≥n del enrutador crea un conjunto vac√≠o de direcciones IP de IPset llamadas desbloqueo. </li><li>  Se agrega al firewall una regla para redirigir todos los paquetes con destinos desde desbloquear al servicio Tor. </li><li>  El servicio Tor se inicia en modo proxy transparente. </li><li>  Se inicia el script especial unblock_ipset.sh, que resuelve todos los dominios de unblock.txt y agrega sus direcciones IP al conjunto de desbloqueo.  Las direcciones IP, rangos y CIDR de este archivo tambi√©n se agregan para desbloquear. </li><li>  Dnsmasq se inicia con un archivo de configuraci√≥n adicional, unblock.dnsmasq, que indica la adici√≥n de direcciones IP de dominio de unblock.txt al conjunto de desbloqueo al resolver. </li><li>  cron ejecuta unblock_ipset.sh con cierta frecuencia para compensar parcialmente los posibles casos con matices. </li><li>  Si es necesario, todos los dominios de unblock.txt (y solo ellos) se resuelven a trav√©s de dnscrypt-proxy si el proveedor filtra DNS. </li></ul><br><a name="con2"></a><h1>  Configurar un enrutador Padavan </h1><br>  Debe tener un enrutador con firmware Padavan instalado y un administrador de paquetes Entware ya configurado.  En Windows, puede usar el cliente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PuTTY</a> para conectarse al enrutador a trav√©s de SSH. <br><br>  Aseg√∫rese de estar utilizando Entware, no el Entware-ng heredado.  Ver el contenido de la carpeta / opt / var / opkg-lists.  Habr√° un archivo entware o entware-ng.  En el segundo caso, debe actualizar el firmware Padavan de su enrutador a la √∫ltima versi√≥n y reinstalar el administrador de paquetes Entware.  Solo entonces proceda con las instrucciones paso a paso. <br><br>  Como mostraron las revisiones, principalmente aquellos que tienen Entware configurado incorrectamente inicialmente (es decir, los scripts de init.d no se cargan) en la memoria interna del enrutador.  Si tiene Xiaomi Mi Router 3 o 3G, y no est√° seguro de que Entware en su memoria interna funcione correctamente (inicio autom√°tico), simplemente configure todo de nuevo.  Toma PROMETHEUS.  Actualiza el script (1).  Actualice el c√≥digo fuente (2).  Recopile y actualice el firmware m√°s reciente (4).  Restablezca la configuraci√≥n del firmware (NVRAM y almacenamiento de archivos) - Avanzado&gt; Administraci√≥n&gt; Configuraci√≥n.  Configure el acceso a Internet en el enrutador y habilite SSH.  Realice en PROMETHEUS Firmware&gt; Formateo RWFS.  Elija Avanzado&gt; Administraci√≥n&gt; Configuraci√≥n&gt; Montar sistema de archivos en la secci√≥n R / W&gt; UBIFS.  Reinicia el enrutador.  Todos los scripts de inicio de Entware actuales de la memoria interna se registrar√°n autom√°ticamente y todo funcionar√° como un reloj. <br><br>  Para las pruebas, utilic√© el popular Xiaomi Mi Router 3G (Entware est√° instalado en la memoria interna) con el √∫ltimo firmware: 32a93db.  Todo funcionar√° incluso en el legendario beb√© WT3020 AD / F / H por $ 10. <br><br><img src="https://habrastorage.org/webt/th/kf/2k/thkf2kvtt2rhtnbxvmx0qri7dsk.jpeg"><br><br><h3>  1. Instalar el software necesario en el enrutador </h3><br><pre> <code class="bash hljs">opkg update opkg install mc tor tor-geoip <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-dig cron</code> </pre> <br>  <b>mc</b> : administrador de archivos de Midnight Commander.  Solo es necesario debido al conveniente editor mcedit.  Si est√° acostumbrado a usar otro editor de texto, entonces no se puede instalar mc. <br>  <b>tor</b> - Servicio de tor. <br>  <b>tor-geoip</b> - base de datos geo-IP para Tor. <br>  <b>bind-dig</b> : cliente DNS (an√°logo de nslookup y host). <br>  <b>cron</b> - programador de tareas. <br><cut></cut><br><h3>  2. Inicialice ipset, cree m√∫ltiples direcciones IP de desbloqueo (start_script.sh) </h3><br>  Conecte los m√≥dulos necesarios y cree un conjunto de direcciones vac√≠o con el nombre <b>desbloqueado</b> cuando se <b>inicie</b> el enrutador.  Para hacer esto, abra el archivo <b>/etc/storage/start_script.sh</b> en el editor: <br><br><pre> <code class="bash hljs">mcedit /etc/storage/start_script.sh</code> </pre> <br>  A√±adir al final: <br><br><pre> <code class="bash hljs">modprobe ip_set modprobe ip_set_hash_ip modprobe ip_set_hash_net modprobe ip_set_bitmap_ip modprobe ip_set_list_set modprobe xt_set ipset create unblock <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>:net</code> </pre> <br>  Para pegar desde el b√∫fer, use May√∫s + Insertar, guarde - F2, salga - F10. <br><br><img src="https://habrastorage.org/webt/tr/zp/cq/trzpcqqnadbonhsb0x3ebe7ltpo.png"><br><br>  Si lo desea, puede editar el archivo start_script.sh a trav√©s de la interfaz web del enrutador: "Avanzado"&gt; "Personalizaci√≥n"&gt; "Scripts"&gt; "Ejecutar antes de inicializar el enrutador".  Despu√©s de editar, haga clic en "Aplicar". <br><br><img src="https://habrastorage.org/webt/yr/aa/8q/yraa8qgcfwu-vesrp3wvvne2vui.png"><br><br><h3>  3. Configuraci√≥n de Tor </h3><br>  Elimine el contenido del archivo de configuraci√≥n Tor: <br><br><pre> <code class="bash hljs">cat /dev/null &gt; /opt/etc/tor/torrc</code> </pre> <br>  Abra el archivo de configuraci√≥n de Tor: <br><br><pre> <code class="bash hljs">mcedit /opt/etc/tor/torrc</code> </pre> <br>  Pegue (May√∫s + Insertar) el contenido: <br><br><pre> <code class="bash hljs">User admin PidFile /opt/var/run/tor.pid ExcludeExitNodes {RU},{UA},{AM},{KG},{BY} StrictNodes 1 TransPort 192.168.0.1:9141 ExitRelay 0 ExitPolicy reject *:* ExitPolicy reject6 *:* GeoIPFile /opt/share/tor/geoip GeoIPv6File /opt/share/tor/geoip6 DataDirectory /opt/var/lib/tor</code> </pre> <br>  Si es necesario, reemplace <b>192.168.0.1</b> con la direcci√≥n interna de su enrutador (LAN).  Breve descripci√≥n de la configuraci√≥n: <br><br><ul><li>  Excluir nodos de salida: Rusia, Ucrania, Armenia, Kirguist√°n, Bielorrusia. </li><li>  Cuelgue un proxy transparente en la direcci√≥n 192.168.0.1, puerto 9141. </li><li>  Negarse a ser un punto de salida. </li></ul><br><h3>  4. La lista de dominios (y no solo) para evitar el bloqueo (unblock.txt) </h3><br>  unblock.txt es una lista simple para desbloquear.  Puede desbloquear un dominio, direcci√≥n IP, rango o CIDR.  Una l√≠nea, un elemento.  Las l√≠neas vac√≠as (incluidos los espacios y las pesta√±as) se ignoran.  Puede usar el car√°cter # al comienzo de una l√≠nea para ignorarlo. <br><br>  Cree el archivo <b>/opt/etc/unblock.txt</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/unblock.txt</code> </pre> <br>  Cada fila puede contener un nombre de dominio, direcci√≥n IP, rango o CIDR.  Puede usar el car√°cter # para comentar l√≠neas. <br><br><div class="spoiler">  <b class="spoiler_title">Aqu√≠ hay un ejemplo de mi archivo personal</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">###- rutracker.org rutor.info rutor.is mega-tor.org kinozal.tv nnm-club.me nnm-club.ws tfile.me tfile-home.org tfile1.cc megatfile.cc megapeer.org megapeer.ru tapochek.net tparser.org tparser.me rustorka.com uniongang.tv fast-torrent.ru ###    rezka.ag hdrezka.ag hdrezka.me filmix.co filmix.cc seasonvar.ru ### lib.rus.ec flibusta.is flibs.me flisland.net flibusta.site ### telegram.org tdesktop.com tdesktop.org tdesktop.info tdesktop.net telesco.pe telegram.dog telegram.me t.me telegra.ph web.telegram.org desktop.telegram.org updates.tdesktop.com venus.web.telegram.org flora.web.telegram.org vesta.web.telegram.org pluto.web.telegram.org aurora.web.telegram.org 149.154.160.0/20 91.108.4.0/22 91.108.8.0/22 91.108.12.0/22 91.108.16.0/22 91.108.56.0/22 109.239.140.0/24 67.198.55.0/24 ### 7-zip.org edem.tv 4pna.com 2019.vote ### Tor check.torproject.org ###   IP ( #   ) #195.82.146.214 ###   CIDR ( #   ) #103.21.244.0/22 ###    ( #   ) #100.100.100.200-100.100.100.210</span></span></code> </pre> <br></div></div><br><h3>  5. Un script para completar un conjunto de direcciones IP desbloqueadas de una lista de dominios dada (unblock_ipset.sh) </h3><br>  Cree el script <b>/opt/bin/unblock_ipset.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_ipset.sh</code> </pre> <br>  Pegue (May√∫s + Insertar) el contenido: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh until ADDRS=$(dig +short google.com @localhost) &amp;&amp; [ -n "$ADDRS" ] &gt; /dev/null 2&gt;&amp;1; do sleep 5; done while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue cidr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/[0-9]{1,2}') if [ ! -z "$cidr" ]; then ipset -exist add unblock $cidr continue fi range=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$range" ]; then ipset -exist add unblock $range continue fi addr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$addr" ]; then ipset -exist add unblock $addr continue fi dig +short $line @localhost | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | awk '{system("ipset -exist add unblock "$1)}' done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  Dar derechos de ejecuci√≥n: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_ipset.sh</code> </pre> <br>  El script es bastante simple, esa es la esencia de su trabajo ... Estamos esperando que funcione la resoluci√≥n de dominio de google.com (si esto no se hace, no se completar√° mucho desbloqueo cuando se inicie el enrutador, porque el enrutador a√∫n estar√° en proceso de inicializaci√≥n).  Leemos las l√≠neas en el archivo unblock.txt.  Las l√≠neas de lectura eliminan autom√°ticamente espacios y pesta√±as al principio y al final.  Salta las l√≠neas vac√≠as.  Omita las l√≠neas que comienzan con el car√°cter #.  Estamos buscando en la l√≠nea CIDR.  Si se encuentra CIDR, agr√©guelo para desbloquear.  Estamos buscando en el rango de rango.  Si se encuentra, agr√©guelo para desbloquear.  Estamos buscando la direcci√≥n IP en la cadena.  Si se encuentra IP, agr√©guelo para desbloquear.  Resolvamos una l√≠nea a trav√©s de la excavaci√≥n.  Todas las direcciones IP del resultado se agregan para desbloquear. <br><br><h3>  6. Un script para generar un archivo de configuraci√≥n dnsmasq adicional a partir de una lista dada de dominios (unblock_dnsmasq.sh) </h3><br>  Cree el script <b>/opt/bin/unblock_dnsmasq.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  Pegue (May√∫s + Insertar) el contenido: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cat /dev/null &gt; /opt/etc/unblock.dnsmasq while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue echo $line | grep -Eq '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' &amp;&amp; continue echo "ipset=/$line/unblock" &gt;&gt; /opt/etc/unblock.dnsmasq done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  Dar derechos de ejecuci√≥n: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  El gui√≥n es bastante simple, esa es la esencia de su trabajo ... Leemos secuencialmente las l√≠neas de /opt/etc/unblock.txt.  Las l√≠neas de lectura eliminan autom√°ticamente espacios y pesta√±as al principio y al final.  Salta las l√≠neas vac√≠as.  Salta las l√≠neas que comienzan con #.  Omitimos las l√≠neas que contienen la direcci√≥n IP (IP, rango, CIDR), es decir  solo nos interesan las cadenas con nombres de dominio.  En el archivo /opt/etc/unblock.dnsmasq agregamos l√≠neas de la forma "ipset = / domain_name / unblock".  Esto significa que despu√©s de determinar las direcciones IP de un dominio en particular, se agregar√°n autom√°ticamente al conjunto de desbloqueo. <br><br>  Aseg√∫rese de ejecutar el script para generar el archivo unblock.dnsmasq: <br><br><pre> <code class="bash hljs">unblock_dnsmasq.sh</code> </pre> <br>  Verifique que se haya creado el archivo unblock.dnsmasq: <br><br><pre> <code class="bash hljs">cat /opt/etc/unblock.dnsmasq</code> </pre> <br><h3>  7. El script para la actualizaci√≥n forzada manual del sistema despu√©s de editar la lista de dominios (unblock_update.sh) </h3><br>  Cree el script <b>/opt/bin/unblock_update.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_update.sh</code> </pre> <br>  Pegue (May√∫s + Insertar) el contenido: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh ipset flush unblock /opt/bin/unblock_dnsmasq.sh restart_dhcpd sleep 3 /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre> <br>  Dar derechos de ejecuci√≥n: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_update.sh</code> </pre> <br><h3>  8. Script para completar autom√°ticamente un conjunto de desbloqueo al iniciar un enrutador (S99unblock) </h3><br>  Cree el script <b>/opt/etc/init.d/S99unblock</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/init.d/S99unblock</code> </pre> <br>  Pegue (May√∫s + Insertar) el contenido: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$1" != "start" ] &amp;&amp; exit 0 /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre><br>  Dar derechos de ejecuci√≥n: <br><br><pre> <code class="bash hljs">chmod +x /opt/etc/init.d/S99unblock</code> </pre> <br><h3>  9. Reenv√≠o de paquetes con destinos desde desbloquear a Tor (post_iptables_script.sh) </h3><br>  Abra el archivo <b>/etc/storage/post_iptables_script.sh</b> en el editor: <br><br><pre> <code class="bash hljs">mcedit /etc/storage/post_iptables_script.sh</code> </pre> <br>  A√±adir al final: <br><br><pre> <code class="bash hljs">iptables -t nat -A PREROUTING -i br0 -p tcp -m <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> --match-set unblock dst -j REDIRECT --to-port 9141</code> </pre> <br><img src="https://habrastorage.org/webt/af/u2/dl/afu2dld3v0nrhtjwfekvo6i-wsi.png"><br><br>  Si lo desea, puede editar el archivo post_iptables_script.sh a trav√©s de la interfaz web del enrutador: "Avanzado"&gt; "Personalizaci√≥n"&gt; "Scripts"&gt; "Ejecutar despu√©s de reiniciar las reglas del firewall".  Despu√©s de editar, haga clic en "Aplicar". <br><br><img src="https://habrastorage.org/webt/pv/be/ot/pvbeotspo0xhzrukgp3dgvu5aws.png"><br><br>  Puede agregar (esto es opcional) al mismo archivo para redirigir todas las solicitudes al puerto externo 53 hacia usted.  Esto es necesario para que los clientes en la red local no utilicen servicios DNS de terceros.  Las solicitudes pasar√°n por el servidor DNS normal. <br><br><pre> <code class="bash hljs">iptables -t nat -I PREROUTING -i br0 -p udp --dport 53 -j DNAT --to 192.168.0.1 iptables -t nat -I PREROUTING -i br0 -p tcp --dport 53 -j DNAT --to 192.168.0.1</code> </pre> <br>  Si es necesario, reemplace <b>192.168.0.1</b> con la direcci√≥n interna de su enrutador (LAN). <br><br><h3>  10. Conexi√≥n de un archivo de configuraci√≥n adicional a dnsmasq </h3><br>  Necesitamos conectar el archivo unblock.dnsmasq creado a dnsmasq.  Para hacer esto, abra el archivo <b>/etc/storage/dnsmasq/dnsmasq.conf</b> en el editor: <br><br><pre> <code class="bash hljs">mcedit /etc/storage/dnsmasq/dnsmasq.conf</code> </pre> <br>  A√±adir al final: <br><br><pre> <code class="bash hljs">conf-file=/opt/etc/unblock.dnsmasq</code> </pre> <br>  Si lo desea (esto es opcional), puede agregar un servidor adicional para resoluci√≥n y confiabilidad: <br><br><pre> <code class="bash hljs">server=8.8.8.8</code> </pre> <br>  Si lo desea, puede editar el archivo dnsmasq.conf a trav√©s de la interfaz web del enrutador: "Avanzado"&gt; "LAN"&gt; "Servidor DHCP"&gt; "Archivo de configuraci√≥n del usuario dnsmasq.conf".  Despu√©s de editar, haga clic en "Aplicar". <br><br><img src="https://habrastorage.org/webt/x0/ar/4c/x0ar4cm6v9pgsluqabh74qck-s0.png"><br><br><h3>  11. Agregar una tarea a cron para actualizar peri√≥dicamente el contenido del conjunto de desbloqueo </h3><br>  Este es un seguro adicional en caso de que los programas / dispositivos usen su propio m√©todo de resoluci√≥n y la direcci√≥n IP del dominio haya cambiado.  Todo lo que necesita hacer es ejecutar el script unblock_ipset.sh con la frecuencia deseada.  Por ejemplo, lanzaremos todos los d√≠as a las 6 de la ma√±ana. <br><br>  Reemplace el nombre ra√≠z con admin en el archivo de configuraci√≥n cron: <br><br><pre> <code class="bash hljs">sed -i <span class="hljs-string"><span class="hljs-string">'s/root/admin/g'</span></span> /opt/etc/crontab</code> </pre> <br>  Abra el archivo <b>/ opt / etc / crontab</b> en el editor: <br><br><pre> <code class="bash hljs">mcedit /opt/etc/crontab</code> </pre> <br>  A√±adir al final: <br><br><pre> <code class="bash hljs">00 06 * * * admin /opt/bin/unblock_ipset.sh</code> </pre> <br>  Si lo desea, puede comentar todas las dem√°s tareas de plantilla.  As√≠ se ver√° su archivo crontab: <br><br><img src="https://habrastorage.org/webt/hf/lb/fc/hflbfcv04lpvzlrjmehoc3l51ts.png"><br><br><h3>  12. Reiniciando el enrutador </h3><br>  Ejecute el comando: <br><br><pre> <code class="bash hljs">reboot</code> </pre> <br>  Despu√©s del reinicio, abra el sitio web check.torproject.org en su navegador (debe agregarse a unblock.txt).  Si hiciste todo correctamente, ver√°s la inscripci√≥n "Felicitaciones.  Este navegador est√° configurado para usar Tor ". <br><br><img src="https://habrastorage.org/webt/wa/19/dz/wa19dzxbu8qtldwrvkeijfqna7q.png"><br><br><br><a name="con3"></a><h1>  Configurar un enrutador con Keenetic OS </h1><br>  Debe tener un enrutador Keenetic / Zyxel con Entware Package Manager (OPKG) ya configurado.  Por ejemplo, aqu√≠ hay una lista de algunos enrutadores que admiten Entware: Keenetic II, Keenetic III, Extra, Extra II, Giga II, Giga III, Omni, Omni II, Viva, Ultra, Ultra II, Omni (KN-1410), Extra (KN -1710), Giga (KN-1010), Ultra (KN-1810), Viva (KN-1910), DSL (KN-2010), Duo (KN-2110).  Las instrucciones para configurar Entware se pueden encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> (hasta 10 puntos). <br><br>  Si anteriormente (con firmware bajo 2.07) ya agreg√≥ soporte para Entware, entonces aseg√∫rese de estar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">usando el Entware-ng obsoleto</a> . <br><br>  Aseg√∫rese de habilitar "M√≥dulos del n√∫cleo del subsistema Netfilter" - Configuraci√≥n general&gt; Cambiar conjunto de componentes.  Si no est√° en la lista de disponibles, intente instalar primero el componente de protocolo IPv6.  Si despu√©s de esto no aparece, intente sin √©l, pero es muy probable que no pueda desbloquear por rango y CIDR (porque no habr√° soporte para el conjunto hash: net). <br><br><img src="https://habrastorage.org/webt/vv/dh/hi/vvdhhirhcktuefrgbxh3fkx5i0i.png"><br><br>  Para las pruebas, utilic√© Keenetic Ultra (KN-1810) con el √∫ltimo firmware: 2.14.C.0.0-4. <br><br>  <u>Nota importante.</u>  <u>Tendr√° que deshabilitar el servidor DNS normal en el sistema, usaremos dnsmasq en su lugar.</u>  <u>Perder√° la capacidad de asignar servicios DNS (Yandex.DNS / SkyDNS / AdGuard DNS) individualmente para los clientes, pero puede usarlos globalmente a trav√©s de la configuraci√≥n de dnsmasq si es necesario.</u> <br><br><h3>  1. Instalar el software necesario en el enrutador </h3><br><pre> <code class="bash hljs">opkg update opkg install mc tor tor-geoip <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-dig cron dnsmasq-full ipset iptables</code> </pre> <br>  <b>mc</b> : administrador de archivos de Midnight Commander.  Solo es necesario debido al conveniente editor mcedit.  Si est√° acostumbrado a usar otro editor de texto, entonces no se puede instalar mc. <br>  <b>tor</b> - Servicio de tor. <br>  <b>tor-geoip</b> - base de datos geo-IP para Tor. <br>  <b>bind-dig</b> : cliente DNS (an√°logo de nslookup y host). <br>  <b>cron</b> - programador de tareas. <br>  <b>dnsmasq-full</b> : servidor DNS. <br>  <b>ipset e iptables</b> son utilidades de la consola <b>ipset e iptables</b> (pueden estar ya en el sistema y no son necesarias, las agregu√© por seguridad). <br><br><h3>  2. Inicialice ipset, cree m√∫ltiples direcciones IP de desbloqueo (100-ipset.sh) </h3><br>  Compruebe que su sistema de enrutador admite muchos hash: net (como result√≥, no todos los enrutadores Keenetic lo tienen): <br><br><pre> <code class="bash hljs">ipset create <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>:net</code> </pre> <br>  Si el equipo no dio ning√∫n error o mensaje, entonces hay soporte y simplemente siga las instrucciones.  De lo contrario (hay un error) en el siguiente script, debe reemplazar <b>hash: net</b> con <b>hash: ip</b> .  En este caso, pierde la capacidad de desbloquear el rango y el CIDR. <br><br>  Cree un conjunto de direcciones vac√≠o llamado <b>desbloqueo</b> cuando se inicia el enrutador.  Para hacer esto, cree el archivo <b>/opt/etc/ndm/fs.d/100-ipset.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/ndm/fs.d/100-ipset.sh</code> </pre> <br>  Pegue (May√∫s + Insertar) el contenido: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$1" != "start" ] &amp;&amp; exit 0 ipset create unblock hash:net -exist exit 0</span></span></code> </pre> <br>  Para pegar desde el b√∫fer, use May√∫s + Insertar, guarde - F2, salga - F10. <br><br>  Dar derechos de ejecuci√≥n: <br><br><pre> <code class="bash hljs">chmod +x /opt/etc/ndm/fs.d/100-ipset.sh</code> </pre> <br><h3>  3. Configuraci√≥n de Tor </h3><br>  Elimine el contenido del archivo de configuraci√≥n Tor: <br><br><pre> <code class="bash hljs">cat /dev/null &gt; /opt/etc/tor/torrc</code> </pre> <br>  Abra el archivo de configuraci√≥n de Tor: <br><br><pre> <code class="bash hljs">mcedit /opt/etc/tor/torrc</code> </pre> <br>  Pegue (May√∫s + Insertar) el contenido: <br><br><pre> <code class="bash hljs">User root PidFile /opt/var/run/tor.pid ExcludeExitNodes {RU},{UA},{AM},{KG},{BY} StrictNodes 1 TransPort 192.168.0.1:9141 ExitRelay 0 ExitPolicy reject *:* ExitPolicy reject6 *:* GeoIPFile /opt/share/tor/geoip GeoIPv6File /opt/share/tor/geoip6 DataDirectory /opt/var/lib/tor</code> </pre> <br>  Si es necesario, reemplace <b>192.168.0.1</b> con la direcci√≥n interna de su enrutador (LAN).  Breve descripci√≥n de la configuraci√≥n: <br><br><ul><li>  Excluir nodos de salida: Rusia, Ucrania, Armenia, Kirguist√°n, Bielorrusia. </li><li>  Cuelgue un proxy transparente en la direcci√≥n 192.168.0.1, puerto 9141. </li><li>  Negarse a ser un punto de salida. </li></ul><br><h3>  4. La lista de dominios (y no solo) para evitar el bloqueo (unblock.txt) </h3><br>  unblock.txt es una lista simple para desbloquear.  Puede desbloquear un dominio, direcci√≥n IP, rango o CIDR.  Una l√≠nea, un elemento.  Las l√≠neas vac√≠as (incluidos los espacios y las pesta√±as) se ignoran.  Puede usar el car√°cter # al comienzo de una l√≠nea para ignorarlo. <br><br>  Cree el archivo <b>/opt/etc/unblock.txt</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/unblock.txt</code> </pre> <br>  Cada fila puede contener un nombre de dominio, direcci√≥n IP, rango o CIDR.  Puede usar el car√°cter # para comentar l√≠neas. <br><br><div class="spoiler">  <b class="spoiler_title">Aqu√≠ hay un ejemplo de mi archivo personal</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">###- rutracker.org rutor.info rutor.is mega-tor.org kinozal.tv nnm-club.me nnm-club.ws tfile.me tfile-home.org tfile1.cc megatfile.cc megapeer.org megapeer.ru tapochek.net tparser.org tparser.me rustorka.com uniongang.tv fast-torrent.ru ###    rezka.ag hdrezka.ag hdrezka.me filmix.co filmix.cc seasonvar.ru ### lib.rus.ec flibusta.is flibs.me flisland.net flibusta.site ### telegram.org tdesktop.com tdesktop.org tdesktop.info tdesktop.net telesco.pe telegram.dog telegram.me t.me telegra.ph web.telegram.org desktop.telegram.org updates.tdesktop.com venus.web.telegram.org flora.web.telegram.org vesta.web.telegram.org pluto.web.telegram.org aurora.web.telegram.org 149.154.160.0/20 91.108.4.0/22 91.108.8.0/22 91.108.12.0/22 91.108.16.0/22 91.108.56.0/22 109.239.140.0/24 67.198.55.0/24 ### 7-zip.org edem.tv 4pna.com 2019.vote ### Tor check.torproject.org ###   IP ( #   ) #195.82.146.214 ###   CIDR ( #   ) #103.21.244.0/22 ###    ( #   ) #100.100.100.200-100.100.100.210</span></span></code> </pre> <br></div></div><br><h3>  5. Un script para completar un conjunto de direcciones IP desbloqueadas de una lista de dominios dada (unblock_ipset.sh) </h3><br>  Cree el script <b>/opt/bin/unblock_ipset.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_ipset.sh</code> </pre> <br>  Pegue (May√∫s + Insertar) el contenido: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh until ADDRS=$(dig +short google.com @localhost) &amp;&amp; [ -n "$ADDRS" ] &gt; /dev/null 2&gt;&amp;1; do sleep 5; done while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue cidr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/[0-9]{1,2}') if [ ! -z "$cidr" ]; then ipset -exist add unblock $cidr continue fi range=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$range" ]; then ipset -exist add unblock $range continue fi addr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$addr" ]; then ipset -exist add unblock $addr continue fi dig +short $line @localhost | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | awk '{system("ipset -exist add unblock "$1)}' done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  Dar derechos de ejecuci√≥n: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_ipset.sh</code> </pre> <br>  El script es bastante simple, esa es la esencia de su trabajo ... Estamos esperando que la resoluci√≥n del dominio google.com funcione (si esto no se hace, no se completar√° mucho desbloqueo cuando se inicie el enrutador, porque el enrutador a√∫n estar√° en proceso de inicializaci√≥n).  Leemos las l√≠neas en el archivo unblock.txt.  Las l√≠neas de lectura eliminan autom√°ticamente espacios y pesta√±as al principio y al final.  Salta las l√≠neas vac√≠as.  Omita las l√≠neas que comienzan con el car√°cter #.  Estamos buscando en la l√≠nea CIDR.  Si se encuentra CIDR, agr√©guelo para desbloquear.  Estamos buscando un rango en la cadena.  Si se encuentra, agr√©guelo para desbloquear.  Estamos buscando la direcci√≥n IP en la cadena.  Si se encuentra IP, agr√©guelo para desbloquear.  Resolvamos una l√≠nea a trav√©s de la excavaci√≥n.  Todas las direcciones IP del resultado se agregan para desbloquear. <br><br><h3>  6. Un script para generar un archivo de configuraci√≥n dnsmasq adicional a partir de una lista dada de dominios (unblock_dnsmasq.sh) </h3><br>  Cree el script <b>/opt/bin/unblock_dnsmasq.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  Pegue (May√∫s + Insertar) el contenido: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cat /dev/null &gt; /opt/etc/unblock.dnsmasq while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue echo $line | grep -Eq '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' &amp;&amp; continue echo "ipset=/$line/unblock" &gt;&gt; /opt/etc/unblock.dnsmasq done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br>  Dar derechos de ejecuci√≥n: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_dnsmasq.sh</code> </pre> <br>  El gui√≥n es bastante simple.  Leemos secuencialmente las l√≠neas de /opt/etc/unblock.txt.  Las l√≠neas de lectura eliminan autom√°ticamente espacios y pesta√±as al principio y al final.  Salta las l√≠neas vac√≠as.  Salta las l√≠neas que comienzan con #.  Omitir l√≠neas que contienen una direcci√≥n IP (IP o CIDR), es decir  solo nos interesan las cadenas con nombres de dominio.  En el archivo /opt/etc/unblock.dnsmasq agregamos l√≠neas de la forma "ipset = / domain_name / unblock".  Esto significa que despu√©s de determinar las direcciones IP de un dominio en particular, se agregar√°n autom√°ticamente al conjunto de desbloqueo. <br><br>  Aseg√∫rese de ejecutar el script para generar el archivo unblock.dnsmasq: <br><br><pre> <code class="bash hljs">unblock_dnsmasq.sh</code> </pre> <br>  Verifique que se haya creado el archivo unblock.dnsmasq: <br><br><pre> <code class="bash hljs">cat /opt/etc/unblock.dnsmasq</code> </pre> <br><h3>  7. El script para la actualizaci√≥n forzada manual del sistema despu√©s de editar la lista de dominios (unblock_update.sh) </h3><br>  Cree el script <b>/opt/bin/unblock_update.sh</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_update.sh</code> </pre> <br>  Pegue (May√∫s + Insertar) el contenido: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh ipset flush unblock /opt/bin/unblock_dnsmasq.sh /opt/etc/init.d/S56dnsmasq restart /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre> <br>  Dar derechos de ejecuci√≥n: <br><br><pre> <code class="bash hljs">chmod +x /opt/bin/unblock_update.sh</code> </pre> <br><h3>  8. Script para completar autom√°ticamente un conjunto de desbloqueo al iniciar un enrutador (S99unblock) </h3><br>  Cree el script <b>/opt/etc/init.d/S99unblock</b> : <br><br><pre> <code class="bash hljs">mcedit /opt/etc/init.d/S99unblock</code> </pre> <br>  Pegue (May√∫s + Insertar) el contenido: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$1" != "start" ] &amp;&amp; exit 0 /opt/bin/unblock_ipset.sh &amp;</span></span></code> </pre><br>  Dar derechos de ejecuci√≥n: <br><br><pre> <code class="bash hljs">chmod +x /opt/etc/init.d/S99unblock</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9. Reenv√≠o de paquetes con destinos desde desbloquear a Tor (100-redirect.sh) </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para hacer esto, cree el archivo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/opt/etc/ndm/netfilter.d/100-redirect.sh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/ndm/netfilter.d/100-redirect.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pegue (May√∫s + Insertar) el contenido: </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh [ "$type" == "ip6tables" ] &amp;&amp; exit 0 if [ -z "$(iptables-save 2&gt;/dev/null | grep unblock)" ]; then ipset create unblock hash:net -exist iptables -w -t nat -A PREROUTING -i br0 -p tcp -m set --match-set unblock dst -j REDIRECT --to-port 9141 fi exit 0</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si us√≥ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hash: ip</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el paso 2 </font><font style="vertical-align: inherit;">y no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hash: net</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , reemplace hash: net con hash: ip. De hecho, tambi√©n duplicamos la funci√≥n de crear un conjunto de desbloqueo a partir de 2 pasos. Esto es necesario para la seguridad, si los scripts de fs.d a√∫n no han comenzado a ejecutarse, y los scripts netfilter.d ya se est√°n ejecutando. Est√° bien si el desbloqueo ya se ha creado anteriormente, simplemente se ignorar√° el comando. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Puede agregar (esto es opcional) al mismo archivo para redirigir todas las solicitudes al puerto externo 53 hacia usted. Esto es necesario para que los clientes en la red local no utilicen servicios DNS de terceros. Las solicitudes pasar√°n por el servidor DNS normal. Antes de la √∫ltima salida, agregue:</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(iptables-save 2&gt;/dev/null | grep "udp \-\-dport 53 \-j DNAT")</span></span></span><span class="hljs-string">"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> iptables -w -t nat -I PREROUTING -i br0 -p udp --dport 53 -j DNAT --to 192.168.0.1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(iptables-save 2&gt;/dev/null | grep "tcp \-\-dport 53 \-j DNAT")</span></span></span><span class="hljs-string">"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> iptables -w -t nat -I PREROUTING -i br0 -p tcp --dport 53 -j DNAT --to 192.168.0.1 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si es necesario, reemplace </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con la direcci√≥n interna de su enrutador (LAN). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dar derechos de ejecuci√≥n:</font></font><br><br><pre> <code class="bash hljs">chmod +x /opt/etc/ndm/netfilter.d/100-redirect.sh</code> </pre> <br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 10. Configurar dnsmasq y adjuntar un archivo de configuraci√≥n adicional a dnsmasq </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Elimine el contenido del archivo de configuraci√≥n dnsmasq: </font></font><br><br><pre> <code class="bash hljs">cat /dev/null &gt; /opt/etc/dnsmasq.conf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Abra el archivo de configuraci√≥n dnsmasq: </font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/dnsmasq.conf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pegue (May√∫s + Insertar) el contenido: </font></font><br><br><pre> <code class="bash hljs">user=nobody bogus-priv no-negcache clear-on-reload <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-dynamic listen-address=192.168.0.1 listen-address=127.0.0.1 min-port=4096 cache-size=1536 expand-hosts <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>-async conf-file=/opt/etc/unblock.dnsmasq server=8.8.8.8</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si es necesario, reemplace </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.0.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con la direcci√≥n interna de su enrutador (LAN).</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11. Agregar una tarea a cron para actualizar peri√≥dicamente el contenido del conjunto de desbloqueo </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este es un seguro adicional en caso de que los programas / dispositivos usen su propio m√©todo de resoluci√≥n y la direcci√≥n IP del dominio haya cambiado. </font><font style="vertical-align: inherit;">Todo lo que necesita hacer es ejecutar el script unblock_ipset.sh con la frecuencia deseada. </font><font style="vertical-align: inherit;">Por ejemplo, lanzaremos todos los d√≠as a las 6 de la ma√±ana. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra el archivo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ opt / etc / crontab</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el editor </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/crontab</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A√±adir al final: </font></font><br><br><pre> <code class="bash hljs">00 06 * * * root /opt/bin/unblock_ipset.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si lo desea, puede comentar todas las dem√°s tareas de plantilla. </font><font style="vertical-align: inherit;">As√≠ se ver√° su archivo crontab:</font></font><br><br><img src="https://habrastorage.org/webt/le/y5/sl/ley5slcvjfvs-9odj9air9qdd8s.png"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 12. Deshabilitar el servidor DNS normal y reiniciar el enrutador </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Con√©ctese a la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLI de Keenetic Router</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (puerto 23 para Telnet y 22 para SSH si el componente "Servidor SSH" se agrega al sistema). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejecute el comando:</font></font><br><br><pre> <code class="bash hljs">opkg dns-override system configuration save system reboot</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El servidor DNS integrado en el firmware se apagar√°, y en su lugar se usar√° dnsmasq de Entware. </font><font style="vertical-align: inherit;">El enrutador, en el arranque, verifica si la carpeta opt est√° montada (¬øhay una unidad flash USB / unidad con Entware). </font><font style="vertical-align: inherit;">Si lo hay, no se utiliza un servidor DNS normal. </font><font style="vertical-align: inherit;">Si no, √∫salo.</font></font> Es decir<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">retirando la unidad flash y reiniciando el enrutador, todo funcionar√° para usted, como antes (antes de configurar). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despu√©s del reinicio, abra el sitio web check.torproject.org en su navegador (debe agregarse a unblock.txt). </font><font style="vertical-align: inherit;">Si hiciste todo correctamente, ver√°s la inscripci√≥n "Felicitaciones. </font><font style="vertical-align: inherit;">Este navegador est√° configurado para usar Tor ".</font></font><br><br><img src="https://habrastorage.org/webt/wa/19/dz/wa19dzxbu8qtldwrvkeijfqna7q.png"><br><br><br><a name="con31"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> M√©todos b√°sicos para diagnosticar errores despu√©s de la configuraci√≥n. </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si el cheque con el sitio check.torproject.org (debe agregarse a unblock.txt) pasa, pero el tal√≥n del proveedor contin√∫a abri√©ndose para otros recursos (o no se abre), lo m√°s probable es que el proveedor interfiera con el tr√°fico DNS, reemplazando las respuestas: usted Se necesita una soluci√≥n adicional para filtrar las consultas DNS. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si despu√©s de la configuraci√≥n algo no funciona como deber√≠a, use comandos simples para determinar el paso del problema. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mostrar el contenido del conjunto de desbloqueo:</font></font><br><br><pre> <code class="bash hljs">ipset list unblock</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si el sistema informa que no existen tales conjuntos, el error se encuentra en el paso 2 o no activ√≥ el m√≥dulo Netfilter en el sistema (en el caso de Keenetic). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si el conjunto resulta estar vac√≠o, la secuencia de comandos unblock_ipset.sh no funcion√≥, que a su vez deber√≠a iniciarse con la secuencia de comandos de inicio S99unblock. Ejecute este script unblock_ipset.sh manualmente. Si el conjunto est√° lleno, entonces el error se encuentra en el paso 8. Si el script no se puede ejecutar (lo m√°s probable es que est√© esperando la resoluci√≥n de google.com), entonces el error est√° en alg√∫n lugar del lado del servidor DNS, posiblemente en el paso 10 o 6. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verifique la redirecci√≥n en iptables :</font></font><br><br><pre> <code class="bash hljs">iptables-save 2&gt;/dev/null | grep unblock</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si no est√° all√≠, entonces el error est√° en el paso 9. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si todos los sitios no funcionan, es decir, </font><font style="vertical-align: inherit;">DNS no funciona, el error est√° en alg√∫n lugar en la etapa 6 o 10. Quiz√°s, en la etapa 9. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si todos los sitios de unblock.txt no funcionan (se excede el tiempo de espera), pero todos los dem√°s funcionan, entonces el problema est√° en alg√∫n lado del lado de Tor, error en la etapa 3.</font></font><br><br><br><a name="con4"></a><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bypass adicional para filtrar consultas DNS por parte del proveedor </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si un proveedor interfiere con el tr√°fico DNS al reemplazar las respuestas de los recursos bloqueados, es muy f√°cil evitarlo. </font><font style="vertical-align: inherit;">Para esto usaremos dnscrypt-proxy. </font><font style="vertical-align: inherit;">Si lo desea y tiene experiencia, puede reemplazar f√°cilmente dnscrypt con rechoncho (DNS sobre TLS). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dnscrypt solo se usar√° para los dominios enumerados en unblock.txt. </font><font style="vertical-align: inherit;">Todas las dem√°s consultas pasar√°n por servidores DNS regulares. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si est√° seguro de que su proveedor no filtra las consultas DNS, entonces no necesita hacer esta configuraci√≥n adicional. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ya deber√≠a haber configurado la omisi√≥n de los bloqueos descritos anteriormente. </font><font style="vertical-align: inherit;">La siguiente configuraci√≥n es id√©ntica para Padavan y Keenetic OS. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instale software adicional en el enrutador:</font></font><br><br><pre> <code class="bash hljs">opkg update opkg install dnscrypt-proxy2</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Abra el archivo de configuraci√≥n dnscrypt-proxy: </font></font><br><br><pre> <code class="bash hljs">mcedit /opt/etc/dnscrypt-proxy.toml</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Busque los par√°metros listen_addresses, fallback_resolver, cache y c√°mbielos: </font></font><br><br><pre> <code class="bash hljs">listen_addresses = [<span class="hljs-string"><span class="hljs-string">'127.0.0.1:9153'</span></span>] fallback_resolver = <span class="hljs-string"><span class="hljs-string">'77.88.8.8:1253'</span></span> cache = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">77.88.8.8:1253 es la direcci√≥n del servidor Yandex DNS con un puerto no est√°ndar. </font><font style="vertical-align: inherit;">Es una copia de seguridad en caso de que dnscrypt-proxy tenga alg√∫n problema. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejecute dnscrypt-proxy:</font></font><br><br><pre> <code class="bash hljs">/opt/etc/init.d/S09dnscrypt-proxy2 start</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Aseg√∫rese de que dnscrypt-proxy est√© funcionando (deber√≠a ver una lista de direcciones IP en respuesta): </font></font><br><br><pre> <code class="bash hljs">dig +short google.com @localhost -p 9153</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra el script </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/opt/bin/unblock_ipset.sh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el editor </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_ipset.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Reemplace el contenido con: </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh until ADDRS=$(dig +short google.com @localhost -p 9153) &amp;&amp; [ -n "$ADDRS" ] &gt; /dev/null 2&gt;&amp;1; do sleep 5; done while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue cidr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/[0-9]{1,2}') if [ ! -z "$cidr" ]; then ipset -exist add unblock $cidr continue fi range=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}-[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$range" ]; then ipset -exist add unblock $range continue fi addr=$(echo $line | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}') if [ ! -z "$addr" ]; then ipset -exist add unblock $addr continue fi dig +short $line @localhost -p 9153 | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | awk '{system("ipset -exist add unblock "$1)}' done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hicimos un peque√±o cambio: ahora cavar para resolver no utiliza un servidor DNS normal, sino dnscrypt-proxy con el puerto 9153. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra el script </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/opt/bin/unblock_dnsmasq.sh</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en el editor </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs">mcedit /opt/bin/unblock_dnsmasq.sh</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Reemplace el contenido con: </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh cat /dev/null &gt; /opt/etc/unblock.dnsmasq while read line || [ -n "$line" ]; do [ -z "$line" ] &amp;&amp; continue [ "${line:0:1}" = "#" ] &amp;&amp; continue echo $line | grep -Eq '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' &amp;&amp; continue echo "ipset=/$line/unblock" &gt;&gt; /opt/etc/unblock.dnsmasq echo "server=/$line/127.0.0.1#9153" &gt;&gt; /opt/etc/unblock.dnsmasq done &lt; /opt/etc/unblock.txt</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hicimos un peque√±o cambio: ahora al generar el archivo unblock.dnsmasq, se agregan l√≠neas adicionales como "server = / domain_name / 127.0.0.1 # 9153". </font><font style="vertical-align: inherit;">Esto significa que la resoluci√≥n de dominios de la lista ocurrir√° a trav√©s de dnscrypt-proxy. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejecute unblock_update.sh:</font></font><br><br><pre> <code class="bash hljs">unblock_update.sh</code> </pre> <br>  Listo<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todas las configuraciones complicadas est√°n atr√°s. </font><font style="vertical-align: inherit;">Ahora solo editar√° la lista unblock.txt si es necesario, agregando o eliminando dominios o direcciones IP para desbloquearla, y activar√° los cambios realizados con el comando unblock_update.sh. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACTUALIZACI√ìN 01/04/2019</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A menudo vienen mensajes personales en el art√≠culo con preguntas t√≠picas. </font><font style="vertical-align: inherit;">Contestar√© aqu√≠ lo m√°s com√∫n. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo poner a disposici√≥n los sitios de la zona de dominio .onion? </font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En torrc agregue:</font></font><br><pre> <code class="bash hljs">VirtualAddrNetwork 10.254.0.0/16 DNSPort 127.0.0.1:9053 AutomapHostsOnResolve 1</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para acceder a todos los dominios de la zona de cebolla, agregue dnsmasq.conf: </font></font><br><pre> <code class="bash hljs">server=/onion/127.0.0.1<span class="hljs-comment"><span class="hljs-comment">#9053 ipset=/onion/unblock</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si no desea abrir el acceso a todos los dominios de la zona de cebolla, sino solo a ciertos dominios, agregue las siguientes entradas en dnsmasq.conf: </font></font><br><pre> <code class="bash hljs">server=/rutorc6mqdinc4cz.onion/127.0.0.1<span class="hljs-comment"><span class="hljs-comment">#9053 ipset=/rutorc6mqdinc4cz.onion/unblock server=/nnmclub5toro7u65.onion/127.0.0.1#9053 ipset=/nnmclub5toro7u65.onion/unblock server=/flibustahezeous3.onion/127.0.0.1#9053 ipset=/flibustahezeous3.onion/unblock</span></span></code> </pre> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øC√≥mo evitar bloqueos para clientes de un servidor VPN que se ejecuta en un enrutador? </font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En torrc, reemplace la l√≠nea con TransPort con:</font></font><br><pre> <code class="bash hljs">TransPort 0.0.0.0:9141</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agregue una redirecci√≥n adicional con la interfaz necesaria (INTERFAZ - Interfaz de red VPN): </font></font><br><pre> <code class="bash hljs">iptables -t nat -A PREROUTING -i  -p tcp -m <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> --match-set unblock dst -j REDIRECT --to-port 9141</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es428992/">https://habr.com/ru/post/es428992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es428982/index.html">C√≥mo escribir D en ARM</a></li>
<li><a href="../es428984/index.html">Julia y retratos de fase de sistemas din√°micos</a></li>
<li><a href="../es428986/index.html">Conferencia ThinkJava # 8 en Jarkov</a></li>
<li><a href="../es428988/index.html">Consejos de la naturaleza: luz nocturna nublada</a></li>
<li><a href="../es428990/index.html">Ejemplos de configuraci√≥n de UIViewControllers que utilizan RouteComposer</a></li>
<li><a href="../es428994/index.html">Redes en Android usando Corutin y Retrofit</a></li>
<li><a href="../es428996/index.html">Club de An√≥nimos Pap√° Noel 2018-2019 en Habrahabr</a></li>
<li><a href="../es428998/index.html">C√≥mo usar la nueva funci√≥n experimental Profiler en React</a></li>
<li><a href="../es429000/index.html">¬øPor qu√© Bill Gates invent√≥ el ba√±o por $ 233 mil millones?</a></li>
<li><a href="../es429006/index.html">China: "taller de ensamblaje mundial" no es tan simple como parece</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>