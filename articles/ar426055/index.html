<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐐 👈🏽 🧚🏽 TensorFlow.js و clmtrackr.js: تتبع اتجاه نظرة المستخدم في المتصفح 💠 🆕 🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="يعرض كاتب المقال ، الذي ننشر ترجمته ، الحديث عن حل المشاكل من مجال رؤية الكمبيوتر حصريًا باستخدام متصفح الويب. حل هذه المشكلة ليس صعبًا للغاية بفضل مك...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TensorFlow.js و clmtrackr.js: تتبع اتجاه نظرة المستخدم في المتصفح</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/426055/" style=";text-align:right;direction:rtl">  يعرض كاتب المقال ، الذي ننشر ترجمته ، الحديث عن حل المشاكل من مجال رؤية الكمبيوتر حصريًا باستخدام متصفح الويب.  حل هذه المشكلة ليس صعبًا للغاية بفضل مكتبة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">TensorFlow</a> JavaScript.  بدلاً من تدريب النموذج الخاص بنا وتقديمه للمستخدمين كجزء من المنتج النهائي ، سنمنحهم الفرصة لجمع البيانات بشكل مستقل وتدريب النموذج مباشرة في متصفح على جهاز الكمبيوتر الخاص بنا.  باستخدام هذا الأسلوب ، تكون معالجة البيانات من جانب الخادم غير ضرورية على الإطلاق. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/1n/6k/57/1n6k57nn-wdkux5hhohvjnyadve.jpeg"></div><br>  يمكنك تجربة ما تم تخصيص هذه المواد لإنشائه <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> .  ستحتاج إلى متصفح حديث وكاميرا ويب وماوس لهذا الغرض.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا هو</a> كود المصدر للمشروع.  لم يتم تصميمه للعمل على الأجهزة المحمولة ، يقول مؤلف المادة أنه لم يكن لديه الوقت للتحسينات المناسبة.  بالإضافة إلى ذلك ، يشير إلى أن المهمة التي تم النظر فيها هنا ستصبح أكثر تعقيدًا إذا كان عليك معالجة دفق الفيديو من كاميرا متحركة. <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">فكرة</font> </h2><br>  دعنا نستخدم تقنية تعلُّم الآلة لمعرفة المكان الذي يبحث عنه المستخدم بالضبط عندما ينظر إلى صفحة ويب.  نقوم بذلك من خلال مشاهدة عينيه باستخدام كاميرا ويب. <br><br>  من السهل جدًا الوصول إلى كاميرا الويب في المتصفح.  إذا افترضنا أنه سيتم استخدام الصورة الكاملة من الكاميرا كمدخلات للشبكة العصبية ، فيمكننا القول أنها كبيرة جدًا لهذه الأغراض.  سيتعين على النظام القيام بالكثير من العمل فقط لتحديد المكان الذي توجد فيه الصورة في الصورة.  يمكن أن يظهر هذا النهج نفسه جيدًا إذا كنا نتحدث عن نموذج يقوم المطور بتدريبه بنفسه ونشره على الخادم ، ولكن إذا كنا نتحدث عن التدريب واستخدام النموذج في متصفح ، فهذا كثير جدًا. <br><br>  من أجل تسهيل مهمة الشبكة ، يمكننا تزويدها بجزء فقط من الصورة - الجزء الذي يحتوي على عيون المستخدم ومنطقة صغيرة حولهم.  يمكن تحديد هذه المنطقة ، وهي مستطيل يحيط بالعينين ، باستخدام مكتبة طرف ثالث.  لذلك ، يبدو الجزء الأول من عملنا كما يلي: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/pg/fc/fp/pgfcfppfo3_6wddvm58zikfoqlw.png"></div><br>  <i><font color="#999999">إدخال كاميرا الويب ، التعرف على الوجوه ، كشف العين ، الصورة المقطوعة</font></i> <br><br>  للكشف عن الوجه في الصورة ، استخدمت مكتبة تسمى <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">clmtrackr</a> .  إنه ليس مثاليًا ، ولكنه يختلف في الحجم الصغير والأداء الجيد ، وبشكل عام ، يتواءم مع مهمته بكرامة. <br><br>  إذا تم استخدام صورة صغيرة ولكن تم اختيارها بذكاء كمدخلات لشبكة عصبية تلافيفية بسيطة ، يمكن للشبكة التعلم دون أي مشاكل.  إليك ما تبدو عليه هذه العملية: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/yh/k_/th/yhk_thr05faoc09immbn8fz1vou.png"></div><br>  <i><font color="#999999">صورة المدخلات ، النموذج عبارة عن شبكة عصبية تلافيفية ، إحداثيات ، المكان الذي تنبأت به الشبكة على الصفحة التي يبحث عنها المستخدم.</font></i> <br><br>  سيتم وصف الحد الأدنى من التنفيذ الكامل للأفكار التي تمت مناقشتها في هذا القسم هنا.  يحتوي المشروع ، الذي يوجد رمزه في <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هذا</a> المستودع ، على العديد من الميزات الإضافية. <br><br><h2 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">تحضير</font> </h2><br>  للبدء ، قم <code>clmtrackr.js</code> من <a href="">المستودع</a> المناسب.  سنبدأ العمل بملف HTML فارغ ، والذي يستورد jQuery و TensorFlow.js و <code>main.js</code> وملف <code>main.js</code> مع <code>main.js</code> ، والذي سنعمل عليه بعد قليل: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://code.jquery.com/jquery-3.3.1.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.12.0"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clmtrackr.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h2 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">تلقي دفق فيديو من كاميرا ويب</font> </h2><br>  لتنشيط كاميرا الويب وعرض دفق الفيديو على الصفحة ، نحتاج إلى الحصول على إذن المستخدم.  لا أقدم هنا كودًا يحل مشاكل التوافق للمشروع مع متصفحات مختلفة.  سننطلق من افتراض أن مستخدمينا يعملون على الإنترنت باستخدام أحدث إصدار من Google Chrome. <br><br>  أضف التعليمات البرمجية التالية إلى ملف HTML.  يجب أن يكون موجودًا داخل علامة <code>&lt;body&gt;</code> ، ولكن فوق <code>&lt;body&gt;</code> <code>&lt;script&gt;</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"webcam"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"400"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autoplay</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  الآن دعنا نعمل مع ملف <code>main.js</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs javascript">$(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> video = $(<span class="hljs-string"><span class="hljs-string">'#webcam'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStreaming</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function">) </span></span>{   video.srcObject = stream; } navigator.mediaDevices.getUserMedia({ <span class="hljs-attr"><span class="hljs-attr">video</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }).then(onStreaming); });</code> </pre> <br>  جرب هذا الرمز بنفسك.  عندما تفتح الصفحة ، يجب أن يطلب المتصفح الإذن ، ثم تظهر صورة من كاميرا الويب على الشاشة. <br><br>  سنقوم لاحقًا بتوسيع كود وظيفة <code>onStreaming()</code> . <br><br><h2 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">البحث عن الوجه</font> </h2><br>  الآن دعنا نستخدم مكتبة clmtrackr.js للبحث عن وجوه في الفيديو.  أولاً ، قم بتهيئة نظام تتبع الوجه عن طريق إضافة الكود التالي بعد <code>const video = ...</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ctrack = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> clm.tracker(); ctrack.init();</code> </pre> <br>  الآن ، في وظيفة <code>onStreaming()</code> ، نقوم بتوصيل نظام البحث عن الوجه بإضافة الأمر التالي هناك: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">ctrack.<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>(video);</code> </pre> <br>  هذا كل ما نحتاجه.  الآن سيتمكن النظام من التعرف على الوجه في دفق الفيديو. <br><br>  لا تصدق؟  دعنا نرسم "قناع" حول وجهك للتأكد من صحة ذلك. <br>  للقيام بذلك ، نحتاج إلى عرض الصورة أعلى العنصر المسؤول عن عرض الفيديو.  يمكنك رسم شيء ما على صفحات HTML باستخدام علامة <code>&lt;canvas&gt;</code> .  لذلك ، سنقوم بإنشاء مثل هذا العنصر من خلال تركيبه على العنصر الذي يعرض الفيديو.  سيساعدنا الكود التالي في ذلك ، والذي تحتاج إلى إضافته إلى ملف HTML تحت العنصر <code>&lt;video&gt;</code> بالفعل: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"overlay"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"400"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"300"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css">   </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#webcam</span></span></span><span class="css">, </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#overlay</span></span></span><span class="css"> {       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">position</span></span></span><span class="css">: absolute;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">top</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">left</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;   } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  إذا أردت ، يمكنك نقل النمط المضمن إلى ملف CSS منفصل. <br><br>  أضفنا هنا عنصر <code>&lt;canvas&gt;</code> نفس الحجم إلى الصفحة كعنصر <code>&lt;video&gt;</code> .  حقيقة أن العناصر ستوضع في نفس الموضع مضمونة من خلال الأنماط المستخدمة هنا. <br><br>  الآن ، في كل مرة يعرض المستعرض الإطار التالي للفيديو ، سنقوم برسم شيء على <code>&lt;canvas&gt;</code> .  يتم تنفيذ أي رمز أثناء إخراج كل إطار باستخدام آلية <code>requestAnimationLoop()</code> .  قبل إخراج أي شيء إلى <code>&lt;canvas&gt;</code> ، نحتاج إلى إزالة ما كان عليه من قبل ، ومسحه.  يمكننا بعد ذلك اقتراح <code>clmtrackr</code> لإخراج الرسم مباشرة إلى <code>&lt;canvas&gt;</code> . <br><br>  إليك الشفرة التي تنفذ ما تحدثنا عنه للتو.  <code>ctrack.init()</code> أسفل الأمر <code>ctrack.init()</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs matlab">const overlay = $(<span class="hljs-string"><span class="hljs-string">'#overlay'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; const overlayCC = overlay.getContext(<span class="hljs-string"><span class="hljs-string">'2d'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trackingLoop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { // ,     , //     -   . </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestAnimationFrame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(trackingLoop)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentPosition</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ctrack</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCurrentPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">overlayCC</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearRect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0, 0, 400, 300)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(currentPosition)</span></span></span><span class="hljs-function"> {   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ctrack</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(overlay)</span></span></span><span class="hljs-function">; } }</span></span></code> </pre> <br>  الآن استدعاء دالة <code>trackingLoop()</code> في الدالة <code>onStreaming()</code> مباشرة بعد <code>ctrack.start()</code> .  ستخطط هذه الوظيفة نفسها لإعادة تشغيلها في كل إطار. <br><br>  قم بتحديث الصفحة وانظر إلى كاميرا الويب.  يجب أن ترى "قناع" أخضر حول وجهك في نافذة الفيديو.  في بعض الأحيان ، لكي يتعرف النظام على الوجه بشكل صحيح ، تحتاج إلى تحريك رأسك قليلاً في الإطار. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/394/ab1/98a/394ab198a25c82f7a6c03eefdbe7c73c.png"></div><br>  <i><font color="#999999">نتائج التعرف على الوجه</font></i> <br><br><h2 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">حدد منطقة الصورة التي تحتوي على العينين</font> </h2><br>  الآن نحن بحاجة إلى العثور على المنطقة المستطيلة من الصورة التي توجد فيها العيون ووضعها على عنصر <code>&lt;canvas&gt;</code> منفصل. <br><br>  لحسن الحظ ، لا تعطينا cmltracker معلومات فقط حول موقع الوجه ، ولكن أيضًا 70 نقطة تحكم.  إذا نظرت إلى <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">وثائق</a> cmltracker ، يمكنك تحديد نقاط التحكم التي نحتاجها بالضبط. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/6e7/334/c6f/6e7334c6fa51c5c55ebd66b45d0d8dd8.png"></div><br>  <i><font color="#999999">نقاط التحكم</font></i> <br><br>  نقرر أن العيون هي الجزء المستطيل من الصورة ، التي تلامس حدودها النقاط 23 و 28 و 24 و 26 ، موسعة بمقدار 5 بكسل في كل اتجاه.  يجب أن يتضمن هذا المستطيل كل ما هو مهم بالنسبة لنا ، ما لم يميل المستخدم رأسه أكثر من اللازم. <br><br>  الآن ، قبل أن نتمكن من استخدام هذا الجزء من الصورة ، نحتاج إلى عنصر <code>&lt;canvas&gt;</code> واحد <code>&lt;canvas&gt;</code> .  ابعادها ستكون 50x25 بكسل.  سوف يتناسب هذا العنصر مع مستطيل مع العيون.  تشوه الصورة طفيف ليست مشكلة. <br><br>  أضف هذا الرمز إلى ملف HTML الذي يصف <code>&lt;canvas&gt;</code> ، والذي سيتضمن جزء الصورة الذي يحتوي على عيون: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"eyes"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"50"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css">   </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#eyes</span></span></span><span class="css"> {       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">position</span></span></span><span class="css">: absolute;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">top</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">right</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">;   } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  ستقوم الوظيفة التالية بإرجاع إحداثيات <code>y</code> وص ، بالإضافة إلى عرض وارتفاع المستطيل المحيط بالعينين.  كمدخل ، يأخذ مجموعة من <code>positions</code> المستلمة من clmtrackr.  لاحظ أن كل إحداثي مستلم من clmtrackr يحتوي على مكونين <code>x</code> و <code>y</code> .  يجب إضافة هذه الوظيفة إلى <code>main.js</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs markdown">function getEyesRectangle(positions) { const minX = positions[<span class="hljs-string"><span class="hljs-string">23</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">0</span></span>] - 5; const maxX = positions[<span class="hljs-string"><span class="hljs-string">28</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">0</span></span>] + 5; const minY = positions[<span class="hljs-string"><span class="hljs-string">24</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">1</span></span>] - 5; const maxY = positions[<span class="hljs-string"><span class="hljs-string">26</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">1</span></span>] + 5; const width = maxX - minX; const height = maxY - minY; return [minX, minY, width, height]; }</code> </pre> <br>  الآن ، في كل إطار ، سنقوم باستخراج مستطيل بعيون من دفق الفيديو ، وضع دائرة حوله بخط أحمر على <code>&lt;canvas&gt;</code> ، والذي تم فرضه على عنصر <code>&lt;video&gt;</code> ، ثم نسخه إلى <code>&lt;canvas&gt;</code> الجديد.  يرجى ملاحظة أنه من أجل تحديد المنطقة التي نحتاجها بشكل صحيح ، سنقوم بحساب المؤشرات <code>resizeFactorX</code> و <code>resizeFactorY</code> . <br><br>  استبدل كتلة <code>if</code> في وظيفة <code>trackingLoop()</code> بالكود التالي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentPosition) { //  ,     //   &lt;canvas&gt;,    &lt;video&gt; ctrack.draw(overlay); //  ,  ,    //   const eyesRect = getEyesRectangle(currentPosition); overlayCC.strokeStyle = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; overlayCC.strokeRect(eyesRect[<span class="hljs-number"><span class="hljs-number">0</span></span>], eyesRect[<span class="hljs-number"><span class="hljs-number">1</span></span>], eyesRect[<span class="hljs-number"><span class="hljs-number">2</span></span>], eyesRect[<span class="hljs-number"><span class="hljs-number">3</span></span>]); //      , //        //      const resizeFactorX = video.videoWidth / video.width; const resizeFactorY = video.videoHeight / video.height; //          //    &lt;canvas&gt; const eyesCanvas = <span class="hljs-variable"><span class="hljs-variable">$</span></span>(<span class="hljs-string"><span class="hljs-string">'#eyes'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; const eyesCC = eyesCanvas.getContext(<span class="hljs-string"><span class="hljs-string">'2d'</span></span>); eyesCC.drawImage(   video,   eyesRect[<span class="hljs-number"><span class="hljs-number">0</span></span>] * resizeFactorX, eyesRect[<span class="hljs-number"><span class="hljs-number">1</span></span>] * resizeFactorY,   eyesRect[<span class="hljs-number"><span class="hljs-number">2</span></span>] * resizeFactorX, eyesRect[<span class="hljs-number"><span class="hljs-number">3</span></span>] * resizeFactorY,   <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, eyesCanvas.width, eyesCanvas.height ); }</code> </pre> <br>  بعد إعادة تحميل الصفحة الآن ، من المفترض أن ترى مستطيلًا أحمر حول العينين ، وما يحتويه هذا المستطيل موجود في <code>&lt;canvas&gt;</code> المقابل.  إذا كانت عيناك أكبر من عيناي ، <code>getEyeRectangle</code> وظيفة <code>getEyeRectangle</code> . <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/6c8/29e/5a3/6c829e5a354575ed9c269bebf20c5a5a.png"></div><br>  <i><font color="#999999">عنصر &lt;canvas&gt; يرسم مستطيلاً يحتوي على صورة عيون المستخدم</font></i> <br><br><h2 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">جمع البيانات</font> </h2><br>  هناك طرق عديدة لجمع البيانات.  قررت استخدام المعلومات التي يمكن الحصول عليها من الماوس ولوحة المفاتيح.  في مشروعنا ، يبدو جمع البيانات هكذا. <br><br>  يقوم المستخدم بتحريك المؤشر حول الصفحة ويراقبه بعينيه ، بالضغط على <code></code> على لوحة المفاتيح في كل مرة يحتاج فيها البرنامج إلى تسجيل عينة أخرى.  مع هذا النهج ، من السهل جمع مجموعة كبيرة من البيانات بسرعة لتدريب النموذج. <br><br><h3 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">ouseتتبع الماوس</font> </h3><br>  من أجل معرفة مكان مؤشر الماوس بالضبط على صفحة الويب ، نحتاج إلى معالج أحداث <code>document.onmousemove</code> .  وظيفتنا ، بالإضافة إلى ذلك ، تطبيع الإحداثيات بحيث تتناسب مع النطاق [-1 ، 1]: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">//   : const mouse = { x: <span class="hljs-number"><span class="hljs-number">0</span></span>, y: <span class="hljs-number"><span class="hljs-number">0</span></span>, handleMouseMove: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(event) {   //      ,    [<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>]   mouse.x = (event.clientX / $(<span class="hljs-keyword"><span class="hljs-keyword">window</span></span>).width()) * <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>;   mouse.y = (event.clientY / $(<span class="hljs-keyword"><span class="hljs-keyword">window</span></span>).height()) * <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>; }, } document.onmousemove = mouse.handleMouseMove;</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">Cap التقاط الصور</font> </h3><br>  لالتقاط الصورة التي يعرضها <code>&lt;canvas&gt;</code> وحفظها كموتر ، يوفر <code>tf.fromPixels()</code> وظيفة المساعد <code>tf.fromPixels()</code> .  نستخدمها لحفظ الصورة ثم تطبيعها من <code>&lt;canvas&gt;</code> الذي يعرض مستطيلاً يحتوي على عيون المستخدم: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { //       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tf.tidy(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {   const image = tf.fromPixels($(<span class="hljs-string"><span class="hljs-string">'#eyes'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]);   //  &lt;i&gt;&lt;font color=<span class="hljs-string"><span class="hljs-string">"#999999"</span></span>&gt;&lt;/font&gt;&lt;/i&gt;:   const batchedImage = image.expandDims(<span class="hljs-number"><span class="hljs-number">0</span></span>);   //    :   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> batchedImage.toFloat().div(tf.scalar(<span class="hljs-number"><span class="hljs-number">127</span></span>)).<span class="hljs-built_in"><span class="hljs-built_in">sub</span></span>(tf.scalar(<span class="hljs-number"><span class="hljs-number">1</span></span>)); }); }</code> </pre> <br>  لاحظ أنه يتم استخدام وظيفة <code>tf.tidy()</code> للتنظيف بعد الانتهاء. <br><br>  يمكننا فقط حفظ جميع العينات في مجموعة تدريب كبيرة واحدة ، ولكن في التعلم الآلي ، من المهم التحقق من جودة تدريب النموذج.  هذا هو السبب في أننا بحاجة إلى حفظ بعض العينات في عينة تحكم منفصلة.  بعد ذلك ، يمكننا التحقق من سلوك النموذج على البيانات الجديدة لذلك ومعرفة ما إذا كان النموذج قد تم تدريبه بشكل مفرط.  لهذا الغرض ، يتم تضمين 20٪ من إجمالي عدد العينات في عينة التحكم. <br><br>  فيما يلي الكود المستخدم لجمع البيانات والعينة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">const dataset = { train: {   n: <span class="hljs-number"><span class="hljs-number">0</span></span>,   x: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>,   y: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, }, val: {   n: <span class="hljs-number"><span class="hljs-number">0</span></span>,   x: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>,   y: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, }, } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> captureExample() { //            tf.tidy(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>() {   const image = getImage();   const mousePos = tf.tensor1d([mouse.x, mouse.y]).expandDims(<span class="hljs-number"><span class="hljs-number">0</span></span>);   // ,    (  )     const subset = dataset[Math.random() &gt; <span class="hljs-number"><span class="hljs-number">0.2</span></span> ? <span class="hljs-string"><span class="hljs-string">'train'</span></span> : <span class="hljs-string"><span class="hljs-string">'val'</span></span>];   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (subset.x == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) {     //        subset.x = tf.keep(image);     subset.y = tf.keep(mousePos);   } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {     //          const oldX = subset.x;     const oldY = subset.y;     subset.x = tf.keep(oldX.concat(image, <span class="hljs-number"><span class="hljs-number">0</span></span>));     subset.y = tf.keep(oldY.concat(mousePos, <span class="hljs-number"><span class="hljs-number">0</span></span>));   }   //     subset.n += <span class="hljs-number"><span class="hljs-number">1</span></span>; }); }</code> </pre> <br>  وأخيرًا ، نحتاج إلى ربط هذه الوظيفة <code></code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs matlab">$(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).keyup(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span><span class="hljs-function"> { //         </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event.keyCode == 32)</span></span></span><span class="hljs-function"> {   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">captureExample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preventDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function">; } });</span></span></code> </pre> <br>  الآن في كل مرة تضغط فيها على <code></code> ، تتم إضافة صورة العين وإحداثيات مؤشر الماوس إلى إحدى مجموعات البيانات. <br><br><h2 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">تدريب نموذجي</font> </h2><br>  إنشاء شبكة عصبية تلافيفية بسيطة.  يوفر TensorFlow.js واجهة برمجة تطبيقات تذكرنا بـ Keras لهذا الغرض.  يجب أن تحتوي الشبكة على طبقة <code>conv2d</code> ، وطبقة <code>maxPooling2d</code> ، وأخيرًا طبقة <code>dense</code> <code>maxPooling2d</code> إخراج (تمثل إحداثيات الشاشة).  على طول الطريق ، أضفت طبقة <code>dropout</code> وطبقة <code>flatten</code> إلى الشبكة ، كمنظم ، من أجل تحويل البيانات ثنائية الأبعاد إلى أحادية البعد.  يتم التدريب على الشبكة باستخدام محسن آدم. <br><br>  يرجى ملاحظة أنني استقرت على إعدادات الشبكة المستخدمة هنا بعد تجربة جهاز MacBook Air الخاص بي.  يمكنك اختيار التكوين الخاص بك للنموذج. <br><br>  هنا هو رمز النموذج: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell">let currentModel; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { const model = tf.sequential(); model.add(tf.layers.conv2d({   kernelSize: <span class="hljs-number"><span class="hljs-number">5</span></span>,   filters: <span class="hljs-number"><span class="hljs-number">20</span></span>,   strides: <span class="hljs-number"><span class="hljs-number">1</span></span>,   activation: <span class="hljs-string"><span class="hljs-string">'relu'</span></span>,   inputShape: [<span class="hljs-variable"><span class="hljs-variable">$</span></span>(<span class="hljs-string"><span class="hljs-string">'#eyes'</span></span>)<span class="hljs-type"><span class="hljs-type">.height</span></span>(), <span class="hljs-variable"><span class="hljs-variable">$</span></span>(<span class="hljs-string"><span class="hljs-string">'#eyes'</span></span>)<span class="hljs-type"><span class="hljs-type">.width</span></span>(), <span class="hljs-number"><span class="hljs-number">3</span></span>], })); model.add(tf.layers.maxPooling2d({   poolSize: [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>],   strides: [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>], })); model.add(tf.layers.flatten()); model.add(tf.layers.dropout(<span class="hljs-number"><span class="hljs-number">0.2</span></span>)); //    x  y model.add(tf.layers.dense({   units: <span class="hljs-number"><span class="hljs-number">2</span></span>,   activation: <span class="hljs-string"><span class="hljs-string">'tanh'</span></span>, })); //   Adam     <span class="hljs-number"><span class="hljs-number">0.0005</span></span>     MSE model.compile({   optimizer: tf.train.adam(<span class="hljs-number"><span class="hljs-number">0.0005</span></span>),   loss: <span class="hljs-string"><span class="hljs-string">'meanSquaredError'</span></span>, }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model; }</code> </pre> <br>  قبل البدء في تدريب الشبكة ، قمنا بتعيين عدد ثابت من العصور وحجم حزمة متغير (حيث من المحتمل أن نعمل مع مجموعات بيانات صغيرة جدًا). <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fitModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> batchSize = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(dataset.train.n * <span class="hljs-number"><span class="hljs-number">0.1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (batchSize &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) {   batchSize = <span class="hljs-number"><span class="hljs-number">4</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (batchSize &gt; <span class="hljs-number"><span class="hljs-number">64</span></span>) {   batchSize = <span class="hljs-number"><span class="hljs-number">64</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentModel == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) {   currentModel = createModel(); } currentModel.fit(dataset.train.x, dataset.train.y, {   <span class="hljs-attr"><span class="hljs-attr">batchSize</span></span>: batchSize,   <span class="hljs-attr"><span class="hljs-attr">epochs</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>,   <span class="hljs-attr"><span class="hljs-attr">shuffle</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,   <span class="hljs-attr"><span class="hljs-attr">validationData</span></span>: [dataset.val.x, dataset.val.y], }); }</code> </pre> <br>  الآن قم بإضافة زر إلى الصفحة لبدء التعلم.  ينتقل هذا الرمز إلى ملف HTML: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"train"</span></span></span><span class="hljs-tag">&gt;</span></span>Train!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css">   </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#train</span></span></span><span class="css"> {       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">position</span></span></span><span class="css">: absolute;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">top</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">50%</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">left</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">50%</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">transform</span></span></span><span class="css">: </span><span class="hljs-built_in"><span class="css"><span class="hljs-built_in">translate</span></span></span><span class="css">(-50%, -50%);       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">font-size</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">24pt</span></span></span><span class="css">;   } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  يجب إضافة هذا الرمز إلى ملف JS: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs matlab">$(<span class="hljs-string"><span class="hljs-string">'#train'</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fitModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; });</span></span></code> </pre> <br><h2 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">أين ينظر المستخدم؟</font> </h2><br>  الآن بعد أن نتمكن من جمع البيانات وإعداد النموذج ، يمكننا البدء في توقع المكان على الصفحة التي يبحث عنها المستخدم.  نشير إلى هذا المكان بمساعدة دائرة خضراء تتحرك حول الشاشة. <br><br>  أولاً ، أضف دائرة إلى الصفحة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"target"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css">   </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#target</span></span></span><span class="css"> {       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background-color</span></span></span><span class="css">: lightgreen;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">position</span></span></span><span class="css">: absolute;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border-radius</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">50%</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">height</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">40px</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">width</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">40px</span></span></span><span class="css">;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">transition</span></span></span><span class="css">: all </span><span class="hljs-number"><span class="css"><span class="hljs-number">0.1s</span></span></span><span class="css"> ease;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">box-shadow</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">20px</span></span></span><span class="css"> </span><span class="hljs-number"><span class="css"><span class="hljs-number">10px</span></span></span><span class="css"> white;       </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">4px</span></span></span><span class="css"> solid </span><span class="hljs-built_in"><span class="css"><span class="hljs-built_in">rgba</span></span></span><span class="css">(0,0,0,0.5);   } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  من أجل تحريكها حول الصفحة ، ننقل بشكل دوري الصورة الحالية لعيني الشبكة العصبية ونطرح عليها سؤالًا عن المكان الذي يبحث فيه المستخدم.  ينتج عن النموذج استجابة إحداثيتين يجب تحريك الدائرة على طولهما: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moveTarget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(currentModel == null)</span></span></span><span class="hljs-function"> {   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function">; } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tf</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tidy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(function()</span></span></span><span class="hljs-function"> {   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prediction</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currentModel</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">predict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image)</span></span></span><span class="hljs-function">;   //          </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">targetWidth</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('#target')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">outerWidth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">targetHeight</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('#target')</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">outerHeight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">;   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(prediction.get(0, 0)</span></span></span><span class="hljs-function"> + 1) / 2 * </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">width</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">targetWidth</span></span></span><span class="hljs-function">);   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(prediction.get(0, 1)</span></span></span><span class="hljs-function"> + 1) / 2 * </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($(window)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">height</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">targetHeight</span></span></span><span class="hljs-function">);   //     :   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">const</span></span></span><span class="hljs-function"> $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">target</span></span></span><span class="hljs-function"> = $</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('#target')</span></span></span><span class="hljs-function">;   $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">css</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('left', x + 'px')</span></span></span><span class="hljs-function">;   $</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">target</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">css</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('top', y + 'px')</span></span></span><span class="hljs-function">; }); } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setInterval</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(moveTarget, 100)</span></span></span><span class="hljs-function">;</span></span></code> </pre> <br>  قمت بتعيين الفاصل الزمني إلى 100 مللي ثانية.  إذا لم يكن جهاز الكمبيوتر الخاص بك قويًا مثل جهاز الكمبيوتر الخاص بي ، فقد تقرر تكبيره. <br><br><h2 style=";text-align:right;direction:rtl">  <font color="#3AC1EF">الملخص</font> </h2><br>  الآن لدينا كل ما نحتاجه لتنفيذ الفكرة المقدمة في بداية هذه المواد.  تجربة ما قمنا به.  حرك مؤشر الماوس ، واتبع عينيه ، واضغط على مفتاح المسافة.  ثم انقر فوق زر بدء التدريب. <br><br>  جمع المزيد من البيانات ، انقر فوق الزر مرة أخرى.  بعد فترة ، ستبدأ الدائرة الخضراء في التحرك حول الشاشة بعد نظراتك.  في البداية ، لن يكون من الجيد بشكل خاص الوصول إلى المكان الذي تبحث فيه ، ولكن بدءًا من حوالي 50 عينة تم جمعها ، بعد عدة مراحل من التدريب ، وإذا كنت محظوظًا ، فسوف تنتقل بدقة إلى النقطة التي تبحث عنها في الصفحة .  يمكن العثور على الرمز الكامل للمثال الذي تم تحليله في هذه المادة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> . <br><br>  على الرغم من أن ما فعلناه يبدو مثيرًا للاهتمام بالفعل ، لا يزال هناك العديد من التحسينات التي يمكن إجراؤها.  ماذا لو حرك المستخدم رأسه أو غيّر مكانه أمام الكاميرا؟  لن يضر مشروعنا بالإمكانيات المتعلقة باختيار حجم المستطيل وموضعه وزاويته التي تحيط بمنطقة الصورة التي توجد فيها العيون.  في الواقع ، يتم تنفيذ عدد غير قليل من الميزات الإضافية في <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">النسخة الكاملة من</a> المثال الذي نوقش هنا.  هنا بعض منهم: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  خيارات تخصيص المستطيل المحيط بالعين الموصوف أعلاه. </li><li style=";text-align:right;direction:rtl">  تحويل صورة إلى درجات رمادية. </li><li style=";text-align:right;direction:rtl">  باستخدام <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">إدارة الإحداثيات</a> . </li><li style=";text-align:right;direction:rtl">  خريطة حرارية للتحقق من أداء النموذج بشكل جيد وأين لم ينجح. </li><li style=";text-align:right;direction:rtl">  القدرة على حفظ وتحميل مجموعات البيانات. </li><li style=";text-align:right;direction:rtl">  القدرة على حفظ وتحميل النماذج. </li><li style=";text-align:right;direction:rtl">  الحفاظ على الأوزان التي أظهرت الحد الأدنى من فقدان التدريب بعد التدريب. </li><li style=";text-align:right;direction:rtl">  واجهة مستخدم محسنة مع تعليمات موجزة للعمل مع النظام. </li></ul><br>  <b>أعزائي القراء!</b>  هل تستخدم TensorFlow؟ <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar426055/">https://habr.com/ru/post/ar426055/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar426041/index.html">حل رمزي للمعادلات التفاضلية الخطية والنظم باستخدام طريقة تحويل لابلاس باستخدام SymPy</a></li>
<li><a href="../ar426045/index.html">استثناءات خاصة في .NET وكيفية إعدادها</a></li>
<li><a href="../ar426047/index.html">10 كتب رائعة للمبتدئين باللغة الإنجليزية</a></li>
<li><a href="../ar426051/index.html">تحسين مهارات تصحيح البرامج - بعض النصائح</a></li>
<li><a href="../ar426053/index.html">التخزين المؤقت لمعالج الأحداث وتحسين أداء التطبيق المتفاعل</a></li>
<li><a href="../ar426059/index.html">لقاء توتو PHP # 2: فيديو الخطب</a></li>
<li><a href="../ar426061/index.html">تنضم Microsoft إلى شبكة الاختراع المفتوح وتمنح 60،000 ترخيص</a></li>
<li><a href="../ar426063/index.html">ابتكارات المصفوفة المبتدئة HPE MSA: مصفوفة فلاش أكثر بأسعار معقولة وتكامل الحلول الغنية</a></li>
<li><a href="../ar426065/index.html">Smart TV ، الذي يحدد القناة الأكثر إثارة للاهتمام ، أو حل Sudoku غير عادي لمحتوى الفيديو</a></li>
<li><a href="../ar426067/index.html">تتحرك كالنارتين؟ مرة أخرى حول نقل الموظفين</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>