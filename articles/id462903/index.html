<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌀 🤴🏽 👨‍🏭 Bagaimana kami merancang dan mengimplementasikan jaringan baru pada Huawei di kantor Moskow, bagian 3: pabrik server ✍🏼 👨🏼‍💼 🍺</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam dua bagian sebelumnya ( satu , dua ), kami memeriksa prinsip-prinsip atas dasar di mana pabrik pengguna baru dibangun, dan berbicara tentang mig...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana kami merancang dan mengimplementasikan jaringan baru pada Huawei di kantor Moskow, bagian 3: pabrik server</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/462903/"><img src="https://habrastorage.org/webt/wz/jm/r-/wzjmr-ahppfvfoyv2dheb53oz0a.jpeg"><br><br>  Dalam dua bagian sebelumnya ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">satu</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dua</a> ), kami memeriksa prinsip-prinsip atas dasar di mana pabrik pengguna baru dibangun, dan berbicara tentang migrasi semua pekerjaan.  Sekarang saatnya berbicara tentang pabrik server. <br><a name="habracut"></a><br>  Sebelumnya, kami tidak memiliki infrastruktur server terpisah: sakelar server terhubung ke inti yang sama dengan sakelar distribusi pengguna.  Kontrol akses dilakukan menggunakan jaringan virtual (VLAN), routing VLAN dilakukan pada satu titik - pada inti (sesuai dengan prinsip <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Collapsed Backbone</a> ). <br><br><img src="https://habrastorage.org/webt/04/kd/qt/04kdqtepl7b-ep1kx95iq5rgi0u.png"><br>  <i>Infrastruktur jaringan lama</i> <br><br>  Seiring dengan jaringan kantor baru, kami memutuskan untuk membangun ruang server baru, dan untuk itu - pabrik baru yang terpisah.  Ternyata menjadi kecil (tiga lemari server), tetapi mengikuti semua kanon: inti terpisah pada sakelar CE8850, topologi (spine-leaf) yang terhubung penuh, atas rak (ToR) - komuter CE6870, sepasang sakelar terpisah untuk berinteraksi dengan sisa jaringan (perbatasan) daun).  Singkatnya, isian penuh. <br><br><img src="https://habrastorage.org/webt/8h/ga/lu/8hgalupfr7ce8l_5ic5dkyszjse.png"><br>  <i>Jaringan pabrik server baru</i> <br><br>  Kami memutuskan untuk meninggalkan server SCS demi menghubungkan server secara langsung ke sakelar ToR.  Mengapa  Kami sudah memiliki dua ruang server yang dibangun menggunakan SCS berbasis server, dan kami menyadari bahwa ini adalah: <br><br><ul><li>  nyaman dalam operasi (banyak pergantian, Anda harus hati-hati memperbarui log kabel); </li><li>  mahal dalam hal ruang yang ditempati oleh panel patch; </li><li>  jika perlu, tambah kecepatan server penghubung (misalnya, beralih dari koneksi tembaga 1 Gbit / dtk ke optik 10 Gbit / dtk). </li></ul><br>  Ketika pindah ke pabrik server baru, kami mencoba melepaskan diri dari menghubungkan server dengan kecepatan 1 Gbit / dt dan membatasi diri pada antarmuka 10-gigabit.  Virtualisasi hampir semua server lama yang tidak tahu caranya, dan sisanya melalui transceiver gigabit terhubung ke port 10-gigabit.  Kami menghitung dan memutuskan bahwa akan lebih murah daripada memasang sakelar gigabit terpisah untuk mereka. <br><br><img src="https://habrastorage.org/webt/11/ff/xk/11ffxkxee9-jpdsh44k8j5eiix8.jpeg"><br>  <i>Switch ToR</i> <br><br>  Juga di ruang server baru kami, kami memasang sakelar manajemen out-of-band (OOM) terpisah pada 24 port, satu per rak.  Gagasan ini ternyata sangat bagus, hanya port-port yang tidak cukup, lain kali kita akan menginstal switch OOM untuk 48 port. <br><br>  Di jaringan OOM, kami menghubungkan antarmuka manajemen jarak jauh untuk server seperti iLO, atau iBMC menurut terminologi Huawei.  Jika server telah kehilangan koneksi utama ke jaringan, maka Anda dapat mencapainya melalui antarmuka ini.  Sakelar OOM juga menghubungkan antarmuka manajemen sakelar ToR, sensor suhu, antarmuka kontrol UPS, dan perangkat serupa lainnya.  Jaringan OOM dapat diakses melalui antarmuka firewall yang terpisah. <br><br><img src="https://habrastorage.org/webt/a6/5i/c3/a65ic3qnr4xzbu5igjrsgzd5afy.png"><br>  <i>Koneksi jaringan OOM</i> <br><br><h2>  Server pasangan dan jaringan pengguna </h2><br>  Di pabrik khusus, VRF terpisah digunakan untuk tujuan yang berbeda - untuk menghubungkan workstation pengguna, sistem pengawasan video, sistem multimedia di ruang rapat, untuk mengatur stan dan zona demo, dll. <br><br>  Satu set VRF yang berbeda telah dibuat di pabrik server: <br><br><ul><li>  Untuk menghubungkan server konvensional yang digunakan layanan korporat. </li><li>  Pisahkan VRF, di mana server digunakan dengan akses dari Internet. </li><li>  Pisahkan VRF untuk server basis data yang hanya diakses oleh server lain (misalnya, server aplikasi). </li><li>  Pisahkan VRF untuk sistem email kami (MS Exchange + Skype for Business). </li></ul><br>  Dengan demikian, kami memiliki satu set VRF dari sisi pabrik pengguna dan satu set VRF dari sisi pabrik server.  Kedua set dikelompokkan pada firewall perusahaan (ME).  UM terhubung ke switch perbatasan dari pabrik server dan pabrik pengguna. <br><br><img src="https://habrastorage.org/webt/kd/bl/zl/kdblzlgck3jiqyixodt51tqop2g.png"><br>  <i>Menghubungkan pabrik melalui ME - fisika</i> <br><br><img src="https://habrastorage.org/webt/mf/yz/0f/mfyz0f3qjyv2hhjyiogff7mtyse.png"><br>  <i>Menghubungkan pabrik melalui ME - logika</i> <br><br><h2>  Bagaimana migrasi berjalan </h2><br>  Selama migrasi, kami menghubungkan pabrik server baru dan lama di tingkat saluran, melalui batang sementara.  Untuk memigrasikan server yang terletak di VLAN tertentu, kami membuat domain jembatan terpisah, yang mencakup VLAN dari pabrik server lama dan VXLAN dari pabrik server baru. <br><br>  Konfigurasi terlihat seperti ini, kuncinya adalah dua baris terakhir: <br><br><pre><code class="plaintext hljs">bridge-domain 22 vxlan vni 600022 evpn route-distinguisher 10.xxx.xxx.xxx:60022 vpn-target 6xxxx:60022 export-extcommunity vpn-target 6xxxx:60022 import-extcommunity interface Eth-Trunk1 mode lacp-static dfs-group 1 m-lag 1 interface Eth-Trunk1.1022 mode l2 encapsulation dot1q vid 22 bridge-domain 22</code> </pre> <br><img src="https://habrastorage.org/webt/ub/5c/9t/ub5c9tgrmvvmbzcwvk-ciknpbfo.png"><br>  <i>Migrasi mesin virtual</i> <br><br>  Kemudian, menggunakan VMware vMotion, mesin virtual dalam VLAN ini bermigrasi dari hypervisor lama (versi 5.5) ke yang baru (versi 6.5).  Sepanjang jalan, server perangkat keras divirtualisasikan. <br><br><div class="spoiler">  <b class="spoiler_title">Ketika Anda mencoba mengulanginya</b> <div class="spoiler_text">  Konfigurasikan MTU sebelumnya dan periksa paket end-to-end yang besar. <br></div></div><br>  Di jaringan server lama, kami menggunakan VMware vShield ME virtual.  Karena VMware tidak lagi mendukung alat ini, pada saat yang sama ketika kami bermigrasi ke virtual farm baru, kami beralih dari vShield ke firewall perangkat keras. <br><br>  Setelah tidak ada server yang tersisa di VLAN tertentu di jaringan lama, kami beralih perutean.  Sebelumnya, itu diimplementasikan pada inti lama, dibangun menggunakan teknologi Collapsed Backbone, dan di pabrik server baru kami menggunakan teknologi Anycast Gateway. <br><br><img src="https://habrastorage.org/webt/an/he/19/anhe19styzfsf1s7lwq40jcnm5g.png"><br>  <i>Sakelar perutean</i> <br><br>  Setelah beralih perutean untuk VLAN tertentu, itu terputus dari domain jembatan dan dikeluarkan dari trunk antara jaringan lama dan baru, mis., Itu sepenuhnya ditransfer ke pabrik server baru.  Jadi kami memigrasikan sekitar 20 VLAN. <br><br>  Jadi kami membuat jaringan baru, server baru, dan peternakan virtualisasi baru.  Dalam salah satu artikel berikut, kami akan berbicara tentang apa yang kami lakukan dengan Wi-Fi. <br><br>  <i>Maxim Klochkov</i> <i><br></i>  <i>Konsultan Senior, Audit Jaringan dan Proyek Terpadu</i> <i><br></i>  <i>Pusat Solusi Jaringan</i> <i><br></i>  <i>Jet Infosystems</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id462903/">https://habr.com/ru/post/id462903/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id462887/index.html">Pengalaman mempersonalisasi toko online menggunakan contoh rekomendasi dinamis</a></li>
<li><a href="../id462889/index.html">Kisah Lanjutan: Kompilator Pascal sendiri untuk Windows dari awal</a></li>
<li><a href="../id462893/index.html">Pengenalan Wajah di Kota-kota: Keamanan vs Privasi</a></li>
<li><a href="../id462895/index.html">Memecahkan pekerjaan dengan pwnable.kr 17 - memcpy. Penyelarasan data</a></li>
<li><a href="../id462897/index.html">Pelajari OpenGL. Pelajaran 7.1 - Debugging</a></li>
<li><a href="../id462905/index.html">Menulis bot telegram dengan python menggunakan library telebot bagian 2</a></li>
<li><a href="../id462907/index.html">mingguan ngFanatic</a></li>
<li><a href="../id462909/index.html">Buah dari evolusi ASIC: tentang produsen, penambang untuk SHA-256 dan keanehan hashrate astronomi</a></li>
<li><a href="../id462911/index.html">Setahun di belakang kemudi mobil listrik</a></li>
<li><a href="../id462915/index.html">Performa AMD EPYC 7452 melalui mata Cinebench R20</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>