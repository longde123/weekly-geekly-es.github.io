<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗻 🈯️ 🏪 CDN dinamis untuk streaming WebRTC latensi rendah ❓ 👬 🙇🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sebelumnya, menganalisis kemungkinan konfigurasi server standar di Digital Ocean dari sudut pandang streaming WebRTC, kami mencatat bahwa satu server ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CDN dinamis untuk streaming WebRTC latensi rendah</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flashphoner/blog/477310/"><p><img src="https://habrastorage.org/webt/qp/yd/gy/qpydgy2jfifixw87t9seev0eb7o.jpeg"></p><br><p>  Sebelumnya, menganalisis kemungkinan konfigurasi <a href="https://habr.com/en/company/flashphoner/blog/476546/">server</a> standar <a href="https://habr.com/en/company/flashphoner/blog/476546/">di Digital Ocean</a> dari sudut pandang streaming WebRTC, kami mencatat bahwa satu server dapat melayani hingga 2.000 penonton.  Dalam kehidupan nyata, sering ada kasus ketika satu server tidak cukup. </p><br><p>  Katakanlah penggemar kegembiraan di Jerman menonton balap kuda waktu nyata di Australia.  Karena balap kuda tidak hanya olahraga berkuda, tetapi juga kemenangan besar, dengan taruhan dilakukan tepat waktu, video harus dikirim dengan penundaan sesedikit mungkin. </p><a name="habracut"></a><br><p>  Contoh lain.  Sebuah perusahaan global, salah satu pemimpin di pasar FCMG dengan anak perusahaan di Eropa, Rusia dan Asia Tenggara, menyelenggarakan webinar untuk melatih manajer penjualan dengan terjemahan dari kantor pusat di Mediterania.  Pemirsa harus melihat dan mendengar presenter secara langsung. </p><br><p>  Contoh-contoh ini menggabungkan persyaratan: mengirimkan aliran media ke sejumlah besar pemirsa dengan latensi rendah.  Untuk melakukan ini, Anda perlu menggunakan jaringan pengiriman konten - CDN. </p><br><p>  Perhatikan bahwa teknologi klasik pengiriman aliran menggunakan HLS tidak cocok, karena dapat memberikan penundaan hingga 30 detik, dan ini sangat penting untuk pertunjukan waktu nyata.  Bayangkan bahwa kuda sudah mencapai garis finish, hasilnya diterbitkan di situs, dan para penggemar masih memeriksa balapan.  Kekurangan ini dirampas dari teknologi WebRTC, yang dapat memberikan penundaan dalam 1 detik, dengan saluran komunikasi modern ini mungkin terjadi bahkan antar benua. </p><br><p>  Pertama, mari kita lihat bagaimana menggunakan CDN yang paling sederhana untuk mengirimkan aliran WebRTC, dan kemudian skala itu. </p><br><h2 id="struktura-cdn">  Struktur CDN </h2><br><p>  Server dalam CDN dapat melakukan salah satu dari peran berikut: </p><br><ul><li>  Origin adalah server untuk menerbitkan stream media.  Mendistribusikan stream ke server lain, juga dapat mendistribusikan ke pelanggan. </li><li>  Transcoder - server yang didedikasikan untuk transcoding stream.  Mengambil aliran dari server Asal dan mendistribusikan aliran yang ditranskode ke Edge.  Kami akan berurusan dengan peran ini di bagian selanjutnya. </li><li>  Edge - server yang dirancang untuk mendistribusikan streaming ke pelanggan.  Dibutuhkan stream dari server Origin atau Transcoder, tidak mendistribusikan stream ke server CDN lainnya. </li></ul><br><p> Anda bisa menerbitkan aliran WebRTC dan RTMP ke server Asal, atau menangkap aliran dari sumber lain melalui RTMP, RTSP dan metode lain yang mungkin. </p><br><p>  Pelanggan dapat memutar stream dari server Edge melalui WebRTC, RTMP, RTSP, HLS </p><br><p>  Antara server CDN, diinginkan untuk streaming melalui WebRTC untuk mengurangi latensi. </p><br><p>  CDN statis sepenuhnya dijelaskan pada tahap konfigurasi.  Faktanya, pengaturan CDN statis mirip dengan pengaturan penyeimbang beban: semua penerima tercantum dalam pengaturan server sumber arus. </p><br><p>  Misalnya, kami memiliki server Origin di Frankfurt, satu Edge di New York dan satu di Singapura </p><br><p><img src="https://habrastorage.org/webt/so/gg/1w/sogg1wq1m_67p9waxgdyjbtix4y.png"></p><br><p>  Dalam hal ini, Origin mengonfigurasi sesuatu seperti ini: </p><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">loadbalancer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"roundrobin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stream_distribution</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"webrtc"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ip</span></span></span><span class="hljs-tag">&gt;</span></span>edge1.thestaticcdn.com<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ip</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wss</span></span></span><span class="hljs-tag">&gt;</span></span>443<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wss</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ip</span></span></span><span class="hljs-tag">&gt;</span></span>edge2.thestaticcdn.com<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ip</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wss</span></span></span><span class="hljs-tag">&gt;</span></span>443<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wss</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">loadbalancer</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Inilah masalah pertama dengan CDN statis: untuk menambahkan Edge server baru ke CDN tersebut, atau untuk menghapus server dari CDN, Anda perlu mengubah pengaturan dan memulai kembali semua server Origin. </p><br><p>  Streaming yang diterbitkan pada Asal disiarkan ke semua server yang tercantum dalam pengaturan Edge.  Keputusan tentang server Edge mana yang akan dihubungkan oleh pelanggan juga dibuat pada server Origin.  Ini adalah masalah kedua: jika tidak ada penonton atau sangat sedikit, misalnya, di Singapura pada sore hari, dan di New York di tengah malam, aliran sungai masih disiarkan ke Edge 1. Lalu lintas dihabiskan diam-diam, dan sama sekali tidak gratis. </p><br><p>  CDN dinamis dapat menyelesaikan dua masalah ini. </p><br><p>  Jadi, kami ingin mengonfigurasi CDN tanpa memulai ulang semua server Origin, dan kami tidak ingin melakukan streaming ke server Edge tersebut di mana tidak ada pelanggan.  Dalam hal ini, Anda tidak perlu menyimpan seluruh daftar server CDN di suatu tempat di pengaturan.  Setiap server itu sendiri harus membuat daftar seperti itu, dan untuk ini, ia harus mengetahui status server lain saat ini pada waktu tertentu. </p><br><p>  Idealnya, dalam pengaturan itu harus cukup untuk menentukan titik masuk, server dari mana CDN dimulai.  Pada titik entri ini, setiap server pada saat permulaan harus mengirim permintaan dan menerima daftar node CDN dan daftar aliran yang diterbitkan sebagai tanggapan.  Jika titik masuk tidak tersedia, server harus mengharapkan pesan dari server lain. </p><br><p>  Server harus mengirim perubahan apa pun ke statusnya ke server lain di CDN. </p><br><h2 id="prosteyshaya-cdn-v-centre-evropy">  CDN paling sederhana: di pusat Eropa </h2><br><p>  Jadi, mari kita coba mengkonfigurasi dan menjalankan CDN dinamis.  Misalkan, sebagai permulaan, kita perlu mendistribusikan streaming video ke pemirsa Eropa, sementara hingga 5.000 pengguna harus didukung.  Misalkan sumber arus juga di Eropa. </p><br><p><img src="https://habrastorage.org/webt/xo/oi/rx/xooirxhid75yiqsfuff8sdu5xge.png"></p><br><p>  Kami menyebarkan tiga server di pusat data Eropa.  Kami akan menggunakan Flashphoner WebCallServer (server video streaming WebRTC) sebagai elemen untuk membangun CDN. </p><br><p><img src="https://habrastorage.org/webt/ts/de/4x/tsde4xzznh96b-15pb7pephsqlc.png"></p><br><p>  Pengaturan: </p><br><ul><li>  Asal EU </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=o-eu1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=origin</code> </pre> <br><ul><li>  Edge 1 EU </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=e-eu1.flashphoner.com cdn_point_of_entry=o-eu1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=edge</code> </pre> <br><ul><li>  Edge 2 EU </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=e-eu2.flashphoner.com cdn_point_of_entry=o-eu1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=edge</code> </pre> <br><p>  Perpesanan antara node CDN dinamis terjadi melalui Websocket, dan, tentu saja, Secure Websocket juga didukung. </p><br><p>  Di dalam CDN, stream disiarkan melalui WebRTC.  Sebagai aturan, UDP digunakan sebagai transportasi, tetapi Anda dapat beralih ke TCP jika Anda perlu memastikan kualitas siaran dengan saluran yang tidak terlalu baik antar server.  Sayangnya, dalam hal ini penundaan meningkat. </p><br><p>  Kami me-restart server, membuka contoh Two Way Streaming pada <code>o-eu1</code> , menerbitkan video siklik dengan penghitung waktu mundur dari 10 menit hingga 0 </p><br><p><img src="https://habrastorage.org/webt/96/l1/ir/96l1irnyaa3owncv9nlj7acek74.png"></p><br><p>  Buka contoh Player di <code>e-eu1</code> , mainkan stream </p><br><p><img src="https://habrastorage.org/webt/fc/3p/st/fc3pst40kkeh0gh0dunrcktlksg.png"></p><br><p>  Dan lakukan hal yang sama pada <code>e-eu2</code> </p><br><p><img src="https://habrastorage.org/webt/el/j5/ew/elj5ew8cqvaxpvmbmr14wwl1dvu.png"></p><br><p>  CDN berhasil!  Seperti yang dapat Anda lihat di tangkapan layar, waktu dalam video bertepatan di sisi penerbitan dan di pemirsa hingga satu detik, terima kasih WebRTC dan saluran yang baik. </p><br><h2 id="dalee-vezde-podklyuchaem-ameriku">  Lebih jauh di mana-mana: menghubungkan Amerika </h2><br><p>  Sekarang kami akan mengirimkan streaming kepada pemirsa di benua Amerika, dan kami tidak akan melupakan publikasi. </p><br><p><img src="https://habrastorage.org/webt/y6/8r/ig/y68rigg5xu5uq32qmvrb2_6yexq.png"></p><br><p>  Tanpa menonaktifkan bagian Eropa dari CDN, kami menyebarkan tiga server di pusat data Amerika </p><br><p><img src="https://habrastorage.org/webt/t5/q8/vh/t5q8vh5mlwgvixiq_l-zdin6bje.png"></p><br><p>  Pengaturan: </p><br><ul><li>  Asal kami </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=o-us1.flashponer.com cdn_point_of_entry=o-eu1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=origin</code> </pre> <br><ul><li>  Edge 1 AS </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=e-us1.flashphoner.com cdn_point_of_entry=o-eu1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=edge</code> </pre> <br><ul><li>  Edge 2 AS </li></ul><br><pre> <code class="plaintext hljs">cdn_enabled=true cdn_ip=e-us2.flashphoner.com cdn_point_of_entry=o-eu1.flashponer.com cdn_nodes_resolve_ip=false cdn_role=edge</code> </pre> <br><p>  Kami me-restart server Amerika, kami memeriksa publikasi </p><br><p><img src="https://habrastorage.org/webt/6s/s1/uq/6ss1uquwqf-a0nctys-rsc6p4xo.png"><br>  dan reproduksi </p><br><p><img src="https://habrastorage.org/webt/4i/ur/_s/4iur_sn57za5_ypd9pssupfg8rm.png"></p><br><p>  Pada saat yang sama, segmen Eropa terus bekerja.  Periksa untuk melihat apakah pelanggan Amerika akan melihat aliran yang diterbitkan dari Eropa.  Kami menerbitkan aliran <code>test_eu</code> di <code>o-eu1</code> </p><br><p><img src="https://habrastorage.org/webt/yp/dk/0o/ypdk0o9fnrje0kbmtx7-duhrkuo.png"></p><br><p>  dan mainkan di <code>e-us1</code> </p><br><p><img src="https://habrastorage.org/webt/ld/6n/u3/ld6nu3rzicqjotfzz88goggo1lk.png"></p><br><p>  Dan itu juga berhasil!  Adapun keterlambatan, dalam screenshot kami lagi mengamati kebetulan waktu dalam video di sisi penerbitan dan di pemirsa hingga satu detik. </p><br><p>  Harap perhatikan bahwa stream yang diterbitkan pada server Origin lain tidak dapat diputar langsung dari server Origin secara default, tetapi jika Anda membutuhkannya, Anda dapat mengonfigurasinya seperti ini </p><br><pre> <code class="plaintext hljs">cdn_origin_to_origin_route_propagation=true</code> </pre> <br><h2 id="prodolzhenie-sleduet">  Untuk dilanjutkan </h2><br><p>  Jadi, kami menggunakan CDN sederhana dan kemudian berhasil menskalakannya ke dua benua, menerbitkan dan memainkan aliran WebRTC latensi rendah.  Pada saat yang sama, kami tidak mengubah parameter streaming selama pemutaran, yang dalam kehidupan nyata sangat diperlukan: semua pemirsa memiliki saluran yang berbeda, dan untuk menjaga kualitas siaran, perlu, misalnya, untuk menurunkan resolusi atau bitrate.  Ini akan kita lakukan di bagian selanjutnya ... </p><br><h2 id="ssylki">  Referensi </h2><br><p>  <a href="https://flashphoner.com/cdn-dlya-striminga-webrtc-s-nizkoj-zaderzhkoj/%3Flang%3Dru">CDN streaming WebRTC latensi rendah adalah</a> jaringan pengiriman konten berbasis Web Call Server. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id477310/">https://habr.com/ru/post/id477310/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id477298/index.html">Apa yang ada di dalam bandara: pusat kendali</a></li>
<li><a href="../id477300/index.html">Apa yang ada di dalam bandara regional terbaik di negara ini: layanan terminal</a></li>
<li><a href="../id477304/index.html">CDN Dinamis untuk Streaming WebRTC Latensi Rendah</a></li>
<li><a href="../id477306/index.html">Dari Produksi-Ke-Gaji ke Produksi-Ke-Pesanan. Urutan langkah-langkah dan contoh implementasi praktis</a></li>
<li><a href="../id477308/index.html">Clone Numpy</a></li>
<li><a href="../id477312/index.html">Pengembangan game di jejaring sosial</a></li>
<li><a href="../id477314/index.html">Mengirim acara dari ViewModel ke Aktivitas / Fragmen di MVVM</a></li>
<li><a href="../id477318/index.html">PHP Digest No. 168 (5 - 25 November 2019)</a></li>
<li><a href="../id477320/index.html">Bagian Depan Lingkungan: Bagaimana Internet of Things Akan Membantu Melindungi Lingkungan</a></li>
<li><a href="../id477324/index.html">Mengapa Anda Harus Memilih Penganalisis Statis PVS-Studio untuk Diintegrasikan ke dalam Proses Pengembangan Anda</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>