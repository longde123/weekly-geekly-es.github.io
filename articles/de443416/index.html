<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìπ üéà üò∂ Winnti: ein Angriff auf Lieferketten - asiatische Spieleentwickler stehen an vorderster Front üëºüèª üöï üå¶Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dies ist nicht das erste Mal, dass Angreifer die Spielebranche angreifen, Entwickler kompromittieren, der Build-Umgebung des Spiels Backdoors hinzuf√ºg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Winnti: ein Angriff auf Lieferketten - asiatische Spieleentwickler stehen an vorderster Front</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/443416/"> Dies ist nicht das erste Mal, dass Angreifer die Spielebranche angreifen, Entwickler kompromittieren, der Build-Umgebung des Spiels Backdoors hinzuf√ºgen und dann Malware unter dem Deckmantel einer legitimen Umgebung verbreiten.  Im April 2013 meldete Kaspersky Lab einen √§hnlichen Vorfall.  Dieser Angriff wird einer Cybergruppe namens Winnti zugeschrieben. <br><br>  Vor kurzem wurden ESET-Experten von neuen Angriffen auf Lieferketten angezogen.  Zwei Spiele und eine Spieleplattform wurden kompromittiert, um eine Hintert√ºr einzuf√ºhren.  Diese Angriffe zielen auf Asien und die Spielebranche ab, gefolgt von Winnti. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/da/mm/9k/damm9kh-fnuiccaivkprl3kc9w0.jpeg"></div><a name="habracut"></a><br><h2>  Drei F√§lle, eine Hintert√ºr </h2><br>  Trotz der unterschiedlichen Malware-Konfigurationen enthielten die drei kompromittierten Softwareprodukte denselben Backdoor-Code und verwendeten denselben Mechanismus.  Jetzt gibt es in zwei Produkten keine Hintert√ºren mehr, aber eine wird immer noch in einer trojanisierten Version vertrieben - ironischerweise hei√üt dieses Spiel Infestation, das von der thail√§ndischen Firma Extreme Extreme ver√∂ffentlicht wird.  Wir haben seit Anfang Februar versucht, den Entwickler zu kontaktieren, aber bisher ohne Erfolg. <br><br>  Wir werden analysieren, wie die sch√§dliche Nutzlast eingef√ºhrt wird, und dann die Hintert√ºr im Detail betrachten. <br><br><h4>  Payload-Implementierung </h4> <br>  Der Payload-Code wird w√§hrend der Ausf√ºhrung der trojanisierten ausf√ºhrbaren Datei ausgef√ºhrt.  Unmittelbar nach dem PE-Einstiegspunkt wird der Standardaufruf zur C-Laufzeitinitialisierung ( <code>__scrt_common_main_seh</code> in der folgenden Abbildung) abgefangen, um die b√∂swillige Nutzlast vor allem anderen zu starten (Abbildung 2).  Dies kann darauf hinweisen, dass die Angreifer die Assemblykonfiguration und nicht den Quellcode selbst ge√§ndert haben. <br><br><img src="https://habrastorage.org/webt/9x/5t/_z/9x5t_zr__dskzxeisuvum2z4at4.png"><br><br>  <i>Abbildung 1. Nettoeinstiegspunkt zur ausf√ºhrbaren Datei</i> <br><br><img src="https://habrastorage.org/webt/rc/ow/c5/rcowc5sx8hx2mi0our57vhagmea.png"><br><br>  <i>Abbildung 2. Einstiegspunkt einer kompromittierten ausf√ºhrbaren Datei</i> <br><br>  Der der ausf√ºhrbaren Datei hinzugef√ºgte Code entschl√ºsselt und startet die Hintert√ºr im RAM, bevor die normale Ausf√ºhrung des C Runtime-Initialisierungscodes und des nachfolgenden Hostanwendungscodes fortgesetzt wird.  Die eingebaute Nutzlast hat eine spezielle Struktur (siehe Abbildung unten), die durch den hinzugef√ºgten Dekomprimierungscode interpretiert wird. <br><br><img src="https://habrastorage.org/webt/uh/cc/_l/uhcc_l8yhoevfiwi71sfvm0fqrw.png"><br><br>  <i>Abbildung 3. Eingebettete Nutzlaststruktur</i> <br><br>  Es enth√§lt den RC4-Schl√ºssel (verschl√ºsseltes XOR mit 0x37), mit dem der Dateiname und die eingebettete DLL-Datei entschl√ºsselt werden. <br><br><h2>  B√∂sartige Nutzlast </h2><br>  Die tats√§chliche b√∂swillige Nutzlast enth√§lt nur 17 KB Code und Daten. <br><br><h4>  Konfiguration </h4><br>  Die in der folgenden Abbildung gezeigten Konfigurationsdaten sind eine Liste von durch Leerzeichen getrennten Zeilen. <br><br><img src="https://habrastorage.org/webt/07/xa/fk/07xafkyspktcwa2ladwz-yqx1aq.png"><br><br>  <i>Abbildung 4. Nutzdatenkonfigurationsdaten</i> <br><br>  Die Konfiguration besteht aus vier Feldern: <br><br><ol><li>  URL des verwaltenden C &amp; C-Servers. </li><li>  Die Variable (t), mit der das Zeitlimit in Millisekunden ermittelt wird, bevor fortgefahren wird.  Die Wartezeit wird zuf√§llig im Bereich von 2/3 bis 5/3 t gew√§hlt. </li><li>  Zeile zur Identifizierung der Kampagne. </li><li>  Eine Liste ausf√ºhrbarer Dateinamen, die durch ein Semikolon getrennt sind.  Wenn einer von ihnen funktioniert, stoppt die Hintert√ºr ihre Ausf√ºhrung. </li></ol><br>  Wir haben f√ºnf Versionen der Nutzlast identifiziert: <br><br><img src="https://habrastorage.org/webt/9h/ni/mi/9hnimigerpgsvcibhsz67pzmtdy.png"><br><br>  Bei den ersten drei Optionen wurde der Code nicht neu kompiliert, aber die Konfigurationsdaten wurden in der DLL-Datei selbst bearbeitet.  Der Rest des Inhalts ist eine Bytekopie. <br><br><h4>  C &amp; C-Infrastruktur </h4><br>  Domain-Namen werden so ausgew√§hlt, dass sie den Websites von Entwicklern kompromittierter Anwendungen √§hneln.  Die Top-Level-Domain ist so konfiguriert, dass sie mithilfe des Namecheap-Dienstes zur entsprechenden legitimen Site umleitet, w√§hrend die Subdomain einen b√∂swilligen C &amp; C-Server anzeigt. <br><br><img src="https://habrastorage.org/webt/es/hi/ha/eshihaiupa4riqbqhjva7x3zy0u.png"><br><br>  Zum Zeitpunkt dieses Schreibens ist keine der Dom√§nen verf√ºgbar, C &amp; C-Server antworten nicht. <br><br><h4>  Studienbericht </h4><br>  Die Bot-ID wird aus der MAC-Adresse des Computers generiert.  Die Hintert√ºr √ºbertr√§gt Maschineninformationen, einschlie√ülich Benutzername, Computername, Windows-Version und Systemsprache, an den C &amp; C-Server und wartet dann auf einen Befehl.  Daten werden mit XOR unter Verwendung des Schl√ºssels " <code>*&amp;b0i0rong2Y7un1</code> " verschl√ºsselt und mit base64 codiert.  Vom C &amp; C-Server empfangene Daten werden mit demselben Schl√ºssel verschl√ºsselt. <br><br><h4>  Teams </h4><br>  Eine einfache Hintert√ºr unterst√ºtzt nur vier Teams, die von Angreifern verwendet werden k√∂nnen: <br><br>  - <code>DownUrlFile</code> <br>  - <code>DownRunUrlFile</code> <br>  - <code>RunUrlBinInMem</code> <br>  - <code>UnInstall</code> <br><br>  Die Namen der Teams sprechen f√ºr sich.  Sie erm√∂glichen es Angreifern, zus√§tzliche ausf√ºhrbare Dateien von einer bestimmten URL aus auszuf√ºhren. <br><br>  Vielleicht ist der letzte Befehl weniger offensichtlich.  <code>UnInstall</code> entfernt die Malware nicht vom System.  Am Ende ist es in eine legitime ausf√ºhrbare Datei eingebettet, die weiterhin ausgef√ºhrt wird.  Anstatt etwas zu l√∂schen, deaktiviert der Befehl den Schadcode, indem der Wert f√ºr den Registrierungsschl√ºssel auf 1 gesetzt wird: <br><br> <code>HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\ImageFlag</code> <br> <br>  Nach dem Starten der Nutzdaten wird der Wert aus der Registrierung angefordert und, falls angegeben, die Ausf√ºhrung abgebrochen.  Vielleicht versuchen die Angreifer, die Belastung ihrer C &amp; C-Server zu verringern, indem sie R√ºckrufe von Opfern ohne Interesse vermeiden. <br><br><h2>  Zweite Stufe </h2><br>  Laut Telemetrie ist Win64 / Winnti.BN eine der Nutzlasten der zweiten Stufe, die an die Opfer gesendet werden.  Soweit wir das beurteilen k√∂nnen, wird der Dropper dieser Malware √ºber HTTPs von <code>api.goallbandungtravel[.]com</code> heruntergeladen.  Wir haben gesehen, dass es als Windows-Dienst und als DLL in <code>C:\Windows\System32</code> Verwendung der folgenden Dateinamen installiert wurde: <br><br>  - cscsrv.dll <br>  - dwmsvc.dll <br>  - iassrv.dll <br>  - mprsvc.dll <br>  - nlasrv.dll <br>  - powfsvc.dll <br>  - racsvc.dll <br>  - slcsvc.dll <br>  - snmpsvc.dll <br>  - sspisvc.dll <br><br>  Die von uns analysierten Proben waren gro√ü genug - etwa 60 MB.  Dies ist jedoch nur eine Sichtbarkeit, da die tats√§chliche Gr√∂√üe oder PE-Datei je nach Version zwischen 63 und 72 KB liegt.  Viele saubere werden einfach zu sch√§dlichen Dateien hinzugef√ºgt.  Dies wird wahrscheinlich von einer Komponente durchgef√ºhrt, die einen sch√§dlichen Dienst zur√ºcksetzt und installiert. <br><br>  Nach dem Starten des Dienstes wird die Erweiterung <code>.mui</code> zu seinem DLL- <code>.mui</code> und mit RC5 entschl√ºsselt.  Die entschl√ºsselte MUI-Datei enth√§lt positionsunabh√§ngigen Code mit Offset 0. Der RC5-Schl√ºssel wird aus der Seriennummer der Festplatte und der Zeile ‚Äû <code>f@Ukd!rCto R$.</code>  ""  Wir konnten weder die MUI-Dateien noch den Code abrufen, der sie zuerst installiert.  Daher ist uns der genaue Zweck des b√∂swilligen Dienstes unbekannt. <br><br>  Neuere Malware-Versionen enthalten einen Mechanismus zur automatischen Aktualisierung √ºber den C &amp; C-Server <code>http://checkin.travelsanignacio[.]com</code> .  Dieser Server stellte die neueste Version der mit dem statischen RC5-Schl√ºssel verschl√ºsselten MUI-Dateien bereit.  Im Verlauf unserer Forschung hat dieser C &amp; C-Server nicht geantwortet. <br><br><h2>  Ziele </h2><br>  Beginnen wir mit denen, auf die die Kampagne <b>nicht</b> speziell ausgerichtet ist.  Zu Beginn der Nutzlast pr√ºft die Malware, ob die Systemsprache Russisch oder Chinesisch ist (siehe Abbildung unten).  Wenn die Antwort Ja lautet, funktioniert das Programm nicht mehr.  Es ist unm√∂glich, diese Ausnahme zu umgehen - Angreifer sind nicht grunds√§tzlich an Computern mit diesen Spracheinstellungen interessiert. <br><br><img src="https://habrastorage.org/webt/dg/p8/tg/dgp8tgq_fhjjewczstuavcsgo34.png"><br><br>  <i>Abbildung 5. √úberpr√ºfen der Sprache vor dem Starten der Nutzdaten</i> <br><br><h4>  Verteilungsstatistik </h4><br>  Laut Telemetrie traten die meisten Infektionen in Asien auf, insbesondere in Thailand.  Angesichts der Popularit√§t der kompromittierten Anwendung, die immer noch vom Entwickler vertrieben wird, ist es nicht verwunderlich, wenn die Zahl der Opfer Zehntausende und Hunderttausende betr√§gt. <br><br><img src="https://habrastorage.org/webt/65/pl/fn/65plfnqbnt3lm1rvbmtt60vwo_c.png"><br><br><h2>  Fazit </h2><br>  Supply-Chain-Angriffe sind auf der Benutzerseite schwer zu erkennen.  Es ist unm√∂glich, die gesamte laufende Software sowie alle empfohlenen Updates zu analysieren.  Standardm√§√üig vertraut der Benutzer den Entwicklern und geht davon aus, dass ihre Dateien keinen Schadcode enthalten.  Dies ist wahrscheinlich der Grund, warum mehrere Cybergroups auf Angriffe auf Softwareanbieter abzielen. Durch Kompromisse kann ein Botnetz erstellt werden, dessen Gr√∂√üe mit der Popularit√§t von trojanisierter Software vergleichbar ist.  Diese Taktik hat einen Nachteil: Wenn das Schema enth√ºllt wird, verlieren Angreifer die Kontrolle √ºber das Botnetz und Benutzer k√∂nnen das System durch die Installation des n√§chsten Updates bereinigen. <br><br>  Die Motive der Winnti-Cybergruppe sind derzeit nicht bekannt.  Vielleicht suchen die Angreifer nach finanziellem Gewinn oder planen, das Botnetz als Teil einer gr√∂√üeren Operation zu verwenden. <br><br>  <i>ESET-Produkte erkennen die Bedrohung als Win32 / HackedApp.Winnti.A, Win32 / HackedApp.Winnti.B, die Nutzlast als Win32 / Winnti.AG, die zweite Stufe als Win64 / Winnti.BN.</i> <i><br><br></i>  <i>Kompromissindikatoren finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> .</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de443416/">https://habr.com/ru/post/de443416/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de443404/index.html">Das neue Ziel der NASA f√ºr die Suche nach au√üerirdischen Zivilisationen: technologische Zeichen</a></li>
<li><a href="../de443406/index.html">Top 20 Fehler bei der Arbeit mit Multithreading in C ++ und M√∂glichkeiten, sie zu vermeiden</a></li>
<li><a href="../de443408/index.html">Photonen, Quanten und Fock-Zustand: Manipulationen auf Quantenebene mit einem Hochfrequenzresonator</a></li>
<li><a href="../de443412/index.html">Warum Programmierer weiterhin ausf√ºhrliches Java verwenden, obwohl es pr√§gnantes Python gibt</a></li>
<li><a href="../de443414/index.html">Wegweiser: Wenn Haltepunkte nicht ausreichen</a></li>
<li><a href="../de443418/index.html">Software-Testmethoden</a></li>
<li><a href="../de443422/index.html">Flexible Datenspeicherung in MySQL (JSON)</a></li>
<li><a href="../de443424/index.html">Umschreiben des Testfalls f√ºr das Junior-Frontend auf TypeScript und React-Hooks</a></li>
<li><a href="../de443426/index.html">Schwarze Markierung - wie OpenShift mit SELinux vor Container-Schwachstellen sch√ºtzt</a></li>
<li><a href="../de443428/index.html">Palmer Lucky, der "Vater" von Oculus Rift, entwickelt ein virtuelles Schlachtfeldsystem f√ºr das Pentagon</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>