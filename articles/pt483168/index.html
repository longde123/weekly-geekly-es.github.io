<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè´ üë®üèæ‚Äçüî¨ üåñ Como fazer um bot que transforma uma foto em quadrinhos. Parte Dois Modelo de treinamento üèà üìÇ ü§úüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚á® A primeira parte 
 ‚á® Terceira parte 

 Ol√° novamente! 

 Como voc√™ pode ver, os feriados prejudicaram um pouco a linha do tempo dos artigos. 
 Eu ac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como fazer um bot que transforma uma foto em quadrinhos. Parte Dois Modelo de treinamento</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483168/">  <a href="https://habr.com/ru/post/479218/">‚á® A primeira parte</a> <br>  <a href="https://habr.com/ru/post/485824/">‚á® Terceira parte</a> <br><br>  Ol√° novamente! <br><br>  Como voc√™ pode ver, os feriados prejudicaram um pouco a linha do tempo dos artigos. <br>  Eu acho que muitos durante esse tempo conseguiram, se n√£o totalmente treinar seu modelo, pelo menos experimentaram diferentes conjuntos de dados. <br><blockquote>  1. Coloque a distribui√ß√£o <br>  2. Baixando fotos <br>  3. ??? <br>  4. Lucro! <br></blockquote>  Se voc√™ n√£o gostou dessas redes neurais ou come√ßou a ler este artigo, ent√£o, como eles dizem, n√£o h√° tempo para explicar, pegamos o kit de distribui√ß√£o, baixamos as fotos necess√°rias e vamos l√°! <br><a name="habracut"></a><br>  Instru√ß√µes detalhadas est√£o <a href="https://habr.com/ru/post/479218/">no artigo anterior da s√©rie</a> . <br><br><h2>  A primeira panqueca √© irregular </h2><br>  Quando treinei o modelo para o <a href="https://t.me/photo2comicsbot" rel="nofollow">@ photo2comicsbot</a> pela primeira vez, sem mais delongas, simplesmente coloquei cerca de 1000 p√°ginas de quadrinhos em um conjunto de dados. <br>  Sim, junto com capas, an√∫ncios e outros itens de preenchimento. <br><br>  Na entrada, parecia assim: <br><br><img src="https://habrastorage.org/webt/vs/7t/p8/vs7tp8lqmuevcrv_3cpuzbyaef4.png"><br><br>  O resultado √© correspondente: <br><br><img src="https://habrastorage.org/webt/2s/sf/5s/2ssf5st8mk1oge_9rrfbyepmlhk.png"><br><br><img src="https://habrastorage.org/webt/7x/dl/kp/7xdlkpn70yzd8qfljqusgn6jy5y.png"><br><br><img src="https://habrastorage.org/webt/ll/ll/v8/llllv8gmtfys_udt5euohplcjzw.png"><br><br><div class="spoiler">  <b class="spoiler_title">Mais fotos</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/tl/ey/8e/tley8enuh1qlcjt3nc7e9-wnzse.png"><br><br><img src="https://habrastorage.org/webt/2u/cz/5n/2ucz5nwpenvhonfh84m080tj_t0.png"><br><br><img src="https://habrastorage.org/webt/o7/qb/xt/o7qbxtxqcrgdcih_4m-ysiksd_e.png"><br><br><img src="https://habrastorage.org/webt/xc/-8/yl/xc-8ylyfuk71me4v59xxvn3qhj4.png"><br><br><img src="https://habrastorage.org/webt/ys/zx/vm/yszxvm-2hc8xt6rjsvvxcpuyy3w.png"><br><br><img src="https://habrastorage.org/webt/jl/p9/3t/jlp93trm26hwitdzgmdt_kylhfw.png"><br><br><img src="https://habrastorage.org/webt/3l/fb/y6/3lfby6xuenl47xlggsv9n2p9hss.png"><br><br><img src="https://habrastorage.org/webt/bq/mt/sd/bqmtsdr7xedmcxsogpa4j8olk8c.png"><br><br></div></div><br>  O modelo transmite perfeitamente as diferen√ßas gerais entre quadrinhos e fotos: <br><br><ul><li>  Classifica√ß√£o de cores t√≠pica </li><li>  Sele√ß√£o de estrutura de t√≥picos </li><li>  Bloqueio </li><li>  Nuvem de texto </li></ul><br>  Em princ√≠pio, esta op√ß√£o pode ser suficiente para a produ√ß√£o. <br><br>  Mas eu queria saber quais resultados podem ser obtidos em um conjunto de dados mais "limpo". <br><br><h2>  Pegue dois </h2><br>  Para o pr√≥ximo experimento, deixei as p√°ginas com um bloco e, no restante, recortei as pe√ßas maiores, constitu√≠das por um bloco, para eliminar as linhas divis√≥rias verticais e horizontais no modelo final. <br><blockquote>  Se voc√™ fizer altera√ß√µes no seu conjunto de dados, por exemplo, excluir ou adicionar fotos, n√£o se esque√ßa de salvar a vers√£o anterior.  Voc√™ ter√° um lugar para retornar se algo der errado. </blockquote>  O segundo conjunto de dados ficou assim: <br><br><img src="https://habrastorage.org/webt/ww/j9/8f/wwj98fxmy0d15c0xgxfz8w9bfs4.png"><br><br>  O resultado, como se costuma dizer, √© √≥bvio: <br><br><img src="https://habrastorage.org/webt/zn/b3/sc/znb3sczf0ypubx8jya-uryrqbxm.png"><br><br><img src="https://habrastorage.org/webt/xp/n9/zv/xpn9zvimruobxodr4wa2vhrutxk.png"><br><br><img src="https://habrastorage.org/webt/xh/nf/sp/xhnfspsgqrkxvuvhdkj7vaqz5yy.png"><br><br><div class="spoiler">  <b class="spoiler_title">Mais fotos</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ag/6b/pw/ag6bpwlw1xefb9o8igrdixarhqc.png"><br><br><img src="https://habrastorage.org/webt/h7/xb/di/h7xbdiuyzdmukmjalf3o6rdou8e.png"><br><br><img src="https://habrastorage.org/webt/by/j8/zk/byj8zkaujwhx52po8xqw37un2oo.png"><br><br><img src="https://habrastorage.org/webt/pl/po/0y/plpo0yucjtvt0sbfc-pefnxz940.png"><br><br><img src="https://habrastorage.org/webt/65/4f/el/654fellkdx6_ebimev8ardha_e0.png"><br><br><img src="https://habrastorage.org/webt/zj/9u/vq/zj9uvqeres9m1kr2nmzcpgt-8uc.png"><br></div></div><br>  As linhas divis√≥rias desapareceram, mas com elas a expressividade deixada nas nuvens com o texto: elas come√ßaram a se encontrar com muito menos frequ√™ncia no conjunto de dados e deixaram de ser a principal caracter√≠stica. <br><br>  O espa√ßo vazio que costumava ser preenchido com texto agora est√° preenchido com ru√≠do psicod√©lico. <br><br><h2>  A terceira vez √© um charme </h2><br>  Decidi me livrar completamente do texto, deixando apenas as partes dos quadrinhos onde ele n√£o est√°.  Ningu√©m sobreviveu: sem nuvens, sem manchetes ou nomes de s√©ries. <br><br>  Conjunto de dados ap√≥s o "genoc√≠dio lingu√≠stico": <br><br><img src="https://habrastorage.org/webt/zu/pw/az/zupwaz8q1toeo9qvqncmfamino8.png"><br><br>  O resultado final: <br><br><img src="https://habrastorage.org/webt/9s/o2/qg/9so2qgo6e6jpkdazfsqf2wlu1-w.png"><br><br><img src="https://habrastorage.org/webt/gs/nr/7p/gsnr7pfyfu4bcowe0bpyqlqn1vc.png"><br><br><img src="https://habrastorage.org/webt/me/vs/m6/mevsm6y3hlgvrvsa8qce0xhenqa.png"><br><br><div class="spoiler">  <b class="spoiler_title">Mais fotos</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/uv/hn/ua/uvhnuapobrpzdu8fxhyjqnz-ozg.png"><br><br><img src="https://habrastorage.org/webt/w1/gu/2e/w1gu2enojimz-lrpkzrzlkvihv8.png"><br><br><img src="https://habrastorage.org/webt/_e/j0/91/_ej091msilwm4hhlmbl3j7nw6sq.png"><br><br><img src="https://habrastorage.org/webt/ql/o6/th/qlo6thuiesfbqx_f2yx6yanf4ne.png"><br><br><img src="https://habrastorage.org/webt/cm/xg/4t/cmxg4tu9jp4-6dcjvjp2nwei3gq.png"><br></div></div><br>  Por um lado, h√° menos artefatos, por outro, a expressividade se foi.  Como no treinamento da GAN a qualidade do resultado √© amplamente determinada por voc√™ e eu, n√£o existe uma receita √∫nica para um bom modelo. <br><br>  A beleza est√° nos olhos de quem v√™, portanto, n√£o tenha medo de experimentar e escolher o que voc√™ mais gosta. <br><br><h2>  Para a arma! </h2><br>  Bem, j√° falamos sobre as principais armadilhas e m√©todos para lidar com elas, √© hora de come√ßarmos a trabalhar. <br><br>  V√° para a pasta em que baixamos a distribui√ß√£o.  Deixe-me lembr√°-lo de que foi chamado <b>pytorch-CycleGAN-and-pix2pix</b> <br><br>  Como temos instru√ß√µes para manequins, n√£o tocaremos no c√≥digo de distribui√ß√£o, pois todos os par√¢metros necess√°rios podem ser definidos na linha de comando. <br><br>  Nesta distribui√ß√£o, o treinamento padr√£o ocorre mais de duzentas eras, com uma atenua√ß√£o linear da taxa de aprendizado ap√≥s a cent√©sima √©poca. <br><blockquote>  A resolu√ß√£o m√°xima que minha placa de oito gigabytes conseguiu dominar era de 400x400.  O treinamento completo levou cerca de 33 horas, ent√£o usaremos um pequeno truque de vida.  Primeiro, treinaremos o modelo em 128x128 fotos, depois 256x256, e somente na fase final mostraremos a ela nossos lindos 400x400. <br>  A primeira etapa durar√° 100 √©pocas, a segunda e a terceira - 50 cada, o que nos permitir√° reduzir o tempo de treinamento em quase metade. <br><br>  Como mostra a pr√°tica, o resultado dessa abordagem n√£o √© pior e, √†s vezes, melhor do que quando se treina imediatamente em resolu√ß√£o m√°xima. </blockquote>  Talvez seja teoria suficiente, √© hora de come√ßar a praticar. <br><br>  No prompt de comando, insira. <br><br><h3>  Est√°gio um </h3><br><pre><code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 128 --load_size 180 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 4</code> </pre> <br>  <i>N√£o se esque√ßa de substituir as chaves por seus pr√≥prios valores.</i> <i><br></i> <br>  Analisaremos alguns par√¢metros com mais detalhes: <br><br><pre> <code class="bash hljs">--batch_size {number}</code> </pre> <br>  Esse par√¢metro √© respons√°vel pelo n√∫mero de imagens processadas por ciclo, afetando positivamente a velocidade e negativamente a gula do modelo. <br><br>  Em cada est√°gio, selecione o m√°ximo poss√≠vel --batch_size, o que n√£o causa erros devido √† falta de mem√≥ria da GPU. <br><br><pre> <code class="bash hljs">-- dataroot {dataset root folder}</code> </pre> <br>  - pasta com nosso conjunto de dados.  Dentro dela, devem estar as pastas trainA, trainB, testA, testB, conforme descrito no artigo anterior. <br><br><pre> <code class="bash hljs">--name {model name}</code> </pre> <br>  - o nome do seu projeto.  Pode ser arbitr√°rio, mas recomendo incluir a arquitetura do modelo, a resolu√ß√£o m√°xima e o nome do conjunto de dados no nome. <br>  Por exemplo: "resnet9_128to400_comics8" <br>  Assim, voc√™ pode distinguir entre experimentos com v√°rios par√¢metros e dados. <br><br>  A primeira etapa do treinamento pode ser interrompida na cent√©sima era. <br><br>  Voc√™ pode observar o progresso no navegador: <a href="http://localhost/" rel="nofollow">localhost</a> : 8097 / <br>  (ou outro link que ficar√° vis√≠vel no console) <br><br><h3>  Est√°gio Dois </h3><br><pre> <code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 256 --load_size 290 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 2 --epoch 100 --epoch_count 0 --continue_train</code> </pre> <br>  √â importante indicar a √©poca em que terminamos nossos estudos na primeira etapa. <br>  ‚Äú- √âpoca 100‚Äù significa que carregaremos o modelo a partir do ponto de verifica√ß√£o da cent√©sima era <br>  "--Epoch_count 0" significa que come√ßaremos o treinamento do zero, com a velocidade m√°xima de aprendizado. <br><br>  A segunda etapa do treinamento pode ser interrompida na 50¬™ era. <br><br><h3>  Est√°gio Tr√™s </h3><br><pre> <code class="bash hljs">python train.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --crop_size 400 --load_size 430 --init_type kaiming --netG resnet_9blocks --no_dropout --batch_size 1 --epoch 50 --epoch_count 0 --continue_train</code> </pre> <br><br>  A terceira etapa do treinamento pode ser interrompida na era 50, mas √© uma quest√£o de gosto.  Voc√™ pode terminar at√© o fim e escolher o resultado intermedi√°rio que desejar.  √â importante lembrar que o resultado na era 200 pode ser pior do que na 150. <br><br><h2>  Agora saia e veja o que voc√™ fez </h2><br>  Durante o treinamento, o modelo e os resultados intermedi√°rios ser√£o salvos em uma pasta <br>  / pytorch-CycleGAN-and-pix2pix / checkpoints / {nome do modelo} <br><br>  Para testar o modelo, basta digitar a linha de comando: <br><br><pre> <code class="bash hljs">python test.py --dataroot {dataset root folder} --name {model name} --model cycle_gan --netG resnet_9blocks --crop_size 512 --load_size 580 --epoch {epoch name}</code> </pre> <br>  Voc√™ pode ver o resultado em um conjunto de dados de teste para qualquer ponto de verifica√ß√£o, apenas especifique-o como {epoch name}.  Se {epoch name} n√£o for especificado, o √∫ltimo ponto de verifica√ß√£o ser√° adotado. <br><br>  O resultado ser√° salvo na pasta: <br> <code>/pytorch-CycleGAN-and-pix2pix/results/{model name}/test_{epoch name}</code> <br> <blockquote>  Para n√£o se confundir qual modelo em qual conjunto de dados fornece qual resultado, <br>  comece a manter um pequeno di√°rio.  Registre dados da linha de base e resultados de aprendizagem. <br><br>  Por exemplo, a linha de comando e a √©poca a que voc√™ alcan√ßou.  Esses dados s√£o suficientes para salvar os par√¢metros de treinamento e o conjunto de dados no qual treinamos. <br><br>  Afinal, qual √© a diferen√ßa entre um experimento cient√≠fico e uma brincadeira?  O fato de tudo estar documentado conosco! </blockquote>  Isso √© tudo por hoje!  No pr√≥ximo artigo, aprenderemos como exportar um modelo pronto e hosped√°-lo na nuvem. <br><br>  N√£o tenha medo de experimentar.  N√£o deixe de experimentar v√°rios conjuntos de dados diferentes, comparar os resultados e compartilh√°-los nos coment√°rios! <br><br>  At√© breve! <br><br>  <a href="https://habr.com/ru/post/485824/">‚á® Pr√≥xima parte</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt483168/">https://habr.com/ru/post/pt483168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt483148/index.html">Discutimos g√™meos digitais e simula√ß√£o com o fundador de uma empresa de consultoria</a></li>
<li><a href="../pt483154/index.html">Gastei US $ 40 mil e arruinei uma √≥tima id√©ia para uma startup</a></li>
<li><a href="../pt483156/index.html">Coloque o gato de p√©</a></li>
<li><a href="../pt483160/index.html">Espa√ßo 2020: Marte, constela√ß√µes de sat√©lites e novos foguetes</a></li>
<li><a href="../pt483166/index.html">Detectar automaticamente a codifica√ß√£o de texto</a></li>
<li><a href="../pt483170/index.html">Banco de dados do Messenger (parte 2): dividimos "lucro"</a></li>
<li><a href="../pt483172/index.html">Como localizar um aplicativo ou jogo? Dez principais fontes gratuitas de e-learning</a></li>
<li><a href="../pt483174/index.html">Grave e transfira som de um dispositivo para outro usando a conectividade de v√°rios usu√°rios</a></li>
<li><a href="../pt483176/index.html">Banco de dados do Messenger (parte 1): projetamos o quadro base</a></li>
<li><a href="../pt483178/index.html">Aqui est√° uma atualiza√ß√£o sobre o Flutter 1.9, juntamente com a programa√ß√£o do Dart 2.5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>