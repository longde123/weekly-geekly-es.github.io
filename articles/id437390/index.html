<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíâ üë®üèΩ‚Äçüîß üçê "Rahasia" DPAPI. Lihatlah keledai itu ‚ôêÔ∏è ‚ùÑÔ∏è üí¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Selain artikel terakhir kami tentang decoding gumpalan DPAPI, kita akan berbicara tentang dua kasus lagi yang harus kita hadapi. Ini akan tentang kata...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"Rahasia" DPAPI. Lihatlah keledai itu</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437390/"> Selain <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> terakhir kami tentang decoding gumpalan DPAPI, kita akan berbicara tentang dua kasus lagi yang harus kita hadapi.  Ini akan tentang kata sandi yang disimpan di browser MS IE11 dan Edge. <br><br>  Strateginya tetap sama - kami akan mendekripsi semuanya offline.  Untuk melakukan ini, Anda perlu mengambil file yang diperlukan. <br><br>  Bergantung pada sistem operasi (Windows 7 atau lebih tinggi), kata sandi yang disimpan harus dicari di dua tempat: <br><br>  Dalam kasus Windows 7, ini adalah cabang registri <br><br><pre><code class="plaintext hljs">HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\IntelliForms\Storage2</code> </pre> <br>  Untuk Windows 8 dan di atasnya, penyimpanan Windows Vault. <br><br>  Perlu dicatat juga bahwa pada Windows 7, kata sandi dasar otorisasi http juga disimpan di Windows Vault, jadi mengambilnya tidak ada salahnya. <br><br>  Nah, sesuai dengan tradisi lama yang baik - semua ini, tentu saja, dienkripsi melalui mekanisme DPAPI. <br><br>  Sekarang pertimbangkan algoritma dekripsi secara lebih rinci. <br><a name="habracut"></a><br><h3>  Windows 7 + IE11 (Tepi) </h3><br>  Seperti disebutkan di atas, kata sandi disimpan dalam registri pengguna saat ini dan gumpalan DPAPI dienkripsi dengan kunci utama pengguna. <br><br>  Tetapi ada perbedaan penting - entropi digunakan saat mengenkripsi kata sandi.  Entropi adalah URL tempat kata sandi dimasukkan dalam format <code>("https://url"+"\x00").lower().encode("utf-16-le")</code> . <br><br>  <b>Untuk mendekripsi kata sandi, Anda perlu mengetahui URL lengkap!</b>  Kalau tidak, tidak ada apa-apa. <br><br>  Tetapi agar IE sendiri tahu cara mendekripsi kata sandi, URL ini di-hash dan disimpan dalam registri sebagai nama kunci dengan gumpalan DPAPI. <br><br>  Pertimbangkan sebuah contoh kecil.  Untuk situs <code>https://rdot.org/forum/</code> kata sandi yang disimpan akan terlihat seperti ini: <br><br><pre> <code class="plaintext hljs">A88E21329B5372B856CE238B79D1F28D8EA1FD359D REG_BINARY 01000000D08C9DDF0115D1118C7A00C......BC310C51EE0F9B05D</code> </pre> <br>  dimana <br>  A88 ... adalah URL hash <code>https://rdot.org/forum/</code> <br>  01000000D08C ... - Gumpalan DPAPI yang berisi nama pengguna dan kata sandi <br><br>  Algoritma hashing URL sangat mudah.  Informasi lebih lanjut tentang dia dapat ditemukan dalam pengembangan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Vault7 yang</a> berbasis CIA. <br><br>  Dengan python, tampilannya seperti ini: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> hashlib url = <span class="hljs-string"><span class="hljs-string">"https://rdot.org/Forum/"</span></span>.lower() + <span class="hljs-string"><span class="hljs-string">"\x00"</span></span> url_utf_16_le = url.encode(<span class="hljs-string"><span class="hljs-string">"utf-16-le"</span></span>) sha1obj = hashlib.sha1(url_utf_16_le) urldigest = sha1obj.digest() checksum = <span class="hljs-number"><span class="hljs-number">0</span></span> len(urldigest) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> abyte <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> urldigest: checksum = (checksum + (ord(abyte))) &amp; <span class="hljs-number"><span class="hljs-number">0xFF</span></span> hash = sha1obj.hexdigest().upper() cksum = <span class="hljs-string"><span class="hljs-string">"%02X"</span></span> % checksum reg_value_name = <span class="hljs-string"><span class="hljs-string">"%s%s"</span></span> % (hash, cksum) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> reg_value_name</code> </pre> <br>  Daftar 50 URL terakhir yang dimasukkan juga dapat ditemukan di registri: <br><br><pre> <code class="plaintext hljs"> HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\typedurls</code> </pre> <br>  Mari kita kembali ke contoh.  Misalkan kita perlu menemukan kata sandi yang disimpan dari <code>https://rdot.org/forum/</code> di registri. <br><br>  Mengganti nilai URL ke dalam skrip konversi - kami mendapatkan nilainya <br><br><pre> <code class="plaintext hljs">A88E21329B5372B856CE238B79D1F28D8EA1FD359D</code> </pre> <br>  Kunci dengan nama ini perlu kita temukan di registri <br><br><pre> <code class="xml hljs">req query "HKEY_USERS\<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SID</span></span></span><span class="hljs-tag">&gt;</span></span>\Software\Microsoft\Internet Explorer\IntelliForms\Storage2"</code> </pre> <br>  Jika kunci tersebut ditemukan, maka harus disalin ke file sebagai nilai hex (mis., Mengartikan nilai kunci sebagai hex blob) dan didekripsi sebagai blob DPAPI menggunakan entropi: <code>("https://rdot.org/forum/".lower() + "\x00").encode("utf-16-le") <br></code> <code>("https://rdot.org/forum/".lower() + "\x00").encode("utf-16-le") <br></code> <br><br>  Untuk dekripsi, Anda dapat menggunakan dpapick, membuat perubahan yang sesuai untuk memperhitungkan entropi dalam dekripsi. <br><br>  Dalam file contoh / filegeneric.py, panggilan fungsi <br><br><pre> <code class="python hljs"> probe.try_decrypt_with_password(options.password, mkp, options.sid)</code> </pre> <br>  ganti dengan <br><br><pre> <code class="python hljs">probe.try_decrypt_with_password(options.password, mkp, options.sid, entropy=(<span class="hljs-string"><span class="hljs-string">"https://rdot.org/forum/"</span></span>.lower() + <span class="hljs-string"><span class="hljs-string">"\x00"</span></span>).encode(<span class="hljs-string"><span class="hljs-string">"utf-16-le"</span></span>))</code> </pre> <br>  dan setelah itu panggil dpapick seperti biasa: <br><br><pre> <code class="xml hljs"> ./filegeneric.py --sid <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SID</span></span></span><span class="hljs-tag">&gt;</span></span> --masterkey <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">..</span></span></span><span class="hljs-tag">&gt;</span></span> --inputfile <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dpapi</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">blob</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">from</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">registry</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Jika kunci master didekripsi dengan benar, maka output akan menerima nama pengguna dan kata sandi yang disimpan (setelah sejumlah data biner layanan). <br><br><h3>  Windows 8.1 dan lebih tinggi </h3><br>  Dalam hal menyimpan kata sandi di Win8 dan yang lebih tinggi, kata sandi dari formulir http, serta otorisasi dasar http, disimpan di Windows Vault.  Dan apa yang baik - bersama dengan kata sandi, URL lengkap dari situs yang didekati juga disimpan. <br><br>  Vault sendiri dienkripsi dalam dua tahap - pertama, seluruh blok data dienkripsi oleh AES, dan kunci simetris untuk dekripsi dienkripsi oleh DPAPI dan disimpan ke file.  Algoritma enkripsi-dekripsi lengkap dijelaskan dalam artikel oleh orang-orang dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Zena Forensics</a> . <br><br>  Mereka juga mengembangkan dekripsi khusus untuk Windows Vault berdasarkan dpapick (dpapilab).  Anda dapat mengambilnya di ZF git atau mengunduh garpu dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github</a> kami. <br><br>  Penyimpanan Vault terletak di profil pengguna: <br><br><pre> <code class="xml hljs">C:\Users\<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>\AppData\Local\Microsoft\Vault\<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GUID</span></span></span><span class="hljs-tag">&gt;</span></span>\</code> </pre> <br>  Di dalam file .vpol adalah gumpalan DPAPI dienkripsi dengan kunci pengguna dan menyimpan kunci AES untuk mendekripsi .vcrd <br><br>  Untuk mendekripsi Vault, Anda harus menjalankan: <br><br><pre> <code class="python hljs">./vaultdec.py --masterkey &lt;mk dir&gt; --sid &lt;SID&gt; --password &lt;<span class="hljs-keyword"><span class="hljs-keyword">pass</span></span>&gt; &lt;VAULT DIR&gt;</code> </pre> <br>  Alih-alih kata sandi, Anda dapat menggunakan kunci domain, seperti yang ditunjukkan pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel sebelumnya</a> .  Perlu juga dicatat bahwa jika kebijakan Roaming Kredensial dimasukkan dalam mesin dalam domain, maka data Windows Vault akan disimpan dalam ldap.  Anda dapat membaca tentang ini di artikel pertama kami tentang DPAPI. <br><br>  Tambahan kecil: agar skrip berfungsi dengan benar, Anda kemungkinan besar perlu menginstal tautan Python lama: <br><br><pre> <code class="plaintext hljs">apt install python-construct.legacy</code> </pre> <br><h3>  Lembar curang </h3><br>  Untuk mendekripsi kata sandi IE, Edge, serta kata sandi yang disimpan di Windows, Anda perlu mengambil: <br><br>  <b>Direktori kubah</b> <br><br><pre> <code class="xml hljs">c:\Users\<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>\AppData\Local\Microsoft\Vault\<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GUID</span></span></span><span class="hljs-tag">&gt;</span></span>\</code> </pre> <br>  <b>katalog dengan kunci utama</b> <br><br><pre> <code class="xml hljs">c:\Users\<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user</span></span></span><span class="hljs-tag">&gt;</span></span>\AppData\roaming\microsoft\Protect\<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SID</span></span></span><span class="hljs-tag">&gt;</span></span>\</code> </pre> <br>  <b>isi kunci registri</b> <br><br><pre> <code class="xml hljs">HKEY_USERS\<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SID</span></span></span><span class="hljs-tag">&gt;</span></span>\Software\Microsoft\Internet Explorer\IntelliForms\Storage2 HKEY_USERS&gt;\<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SID</span></span></span><span class="hljs-tag">&gt;</span></span>\Software\Microsoft\Internet Explorer\typedurls</code> </pre> <br>  Selain itu, Anda perlu mengetahui kata sandi pengguna atau kunci cadangan domain dpapi untuk dekripsi tanpa kata sandi. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id437390/">https://habr.com/ru/post/id437390/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id437378/index.html">Apa itu ARCore? Yang perlu Anda ketahui</a></li>
<li><a href="../id437380/index.html">Semua orang menegur kerangka kerja tes tertulis. Dan kami senang dengan kami</a></li>
<li><a href="../id437382/index.html">Teori kembang api. Fantasi kosmologis</a></li>
<li><a href="../id437384/index.html">Kementerian Tenaga Kerja dan Rostelecom menyimpang dalam menilai jumlah pejabat yang akan menerima smartphone di OS Sailfish domestik</a></li>
<li><a href="../id437386/index.html">Wawancara - Tampilan Pewawancara</a></li>
<li><a href="../id437396/index.html">Mengapa CarPrice digerakkan oleh kecerdasan buatan?</a></li>
<li><a href="../id437400/index.html">Pengeluaran cloud melebihi pengeluaran infrastruktur tradisional untuk pertama kalinya - apa artinya</a></li>
<li><a href="../id437402/index.html">Bagaimana saya mengajar robot untuk berjalan di video YouTube</a></li>
<li><a href="../id437406/index.html">Microkernel seL4. Verifikasi formal program di dunia nyata</a></li>
<li><a href="../id437408/index.html">802.1x, EX2200, NPS, dan semuanya ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>