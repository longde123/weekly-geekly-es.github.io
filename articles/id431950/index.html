<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🎓 🐆 👨‍👧 Cara memperkirakan permintaan dan mengotomatiskan pembelian menggunakan pembelajaran mesin: Kasing Ozon 🖖🏿 🧟 🍶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Toko online Ozon memiliki segalanya: lemari es, makanan bayi, laptop seharga 100.000, dll. Ini berarti bahwa semua ini juga ada di gudang perusahaan -...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara memperkirakan permintaan dan mengotomatiskan pembelian menggunakan pembelajaran mesin: Kasing Ozon</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ozontech/blog/431950/"><img src="https://habrastorage.org/webt/rl/bh/0z/rlbh0zbeah9dcpem3uio1wdstxs.png" alt="gambar"><br>  Toko online Ozon memiliki segalanya: lemari es, makanan bayi, laptop seharga 100.000, dll.  Ini berarti bahwa semua ini juga ada di gudang perusahaan - dan semakin lama barang ada, semakin mahal perusahaan tersebut.  Untuk mengetahui berapa banyak dan apa yang ingin dipesan orang, dan Ozon perlu membeli, kami menggunakan pembelajaran mesin. <br><a name="habracut"></a><br><h3>  Prakiraan Penjualan: Tantangan </h3><br>  Sebelum mempelajari pernyataan masalah, kita mulai dengan sebuah contoh.  Ini adalah jadwal penjualan Ozon yang sebenarnya untuk sementara waktu.  Pertanyaan: kemana dia akan pergi selanjutnya? <br><br><img src="https://habrastorage.org/webt/jl/nk/1j/jlnk1jejwxtqka-skph4hjccxno.png" alt="gambar"><br><br>  Seseorang dengan pendidikan yang hampir teknis untuk perumusan masalah akan memiliki pertanyaan: Di mana kapak?  Dan produk apa?  Dan di unit apa?  Dari institusi mana Anda lulus?  - dan banyak lainnya yang tidak termasuk dalam artikel ini karena alasan etis. <br><br>  Bahkan, tidak ada yang bisa menjawab pertanyaan dengan benar dalam pernyataan seperti itu, dan jika seseorang bisa, maka kemungkinan besar dia akan salah. <br><br>  Tambahkan beberapa informasi lebih lanjut ke bagan ini: sumbu dan perubahan harga di situs web Ozon (biru) dan situs web pesaing (oranye). <br><br><img src="https://habrastorage.org/webt/n1/m8/ap/n1m8apunf5mos5bid2xs4qsq1ka.png" alt="gambar"><br><br>  Harga kami turun di beberapa titik, tetapi persaingan tetap sama - dan penjualan Ozon naik.  Kita tahu rencana penetapan harga: harga kita akan tetap pada tingkat yang sama, tetapi pesaing, mengikuti Ozon, menurunkan harganya ke hampir kita. <br><br>  Data ini cukup untuk membuat asumsi yang bermakna - misalnya, bahwa penjualan akan kembali ke tingkat sebelumnya.  Dan jika Anda melihat grafiknya, ternyata memang demikian. <br><br><img src="https://habrastorage.org/webt/rk/mb/aw/rkmbawctxwb2hf4lhs7l025c9y4.png" alt="gambar"><br><br>  Masalahnya adalah bahwa pada kenyataannya, permintaan untuk produk ini tidak begitu banyak dipengaruhi oleh harga, dan pertumbuhan penjualan disebabkan, antara lain, oleh tidak adanya sebagian besar pesaing produk ini di toko kami.  Masih ada banyak faktor yang tidak kami perhitungkan: apakah barang diiklankan di TV?  atau mungkin itu manis, dan segera 8 Maret? <br><br>  Satu hal yang jelas: membuat ramalan "berlutut" tidak akan berhasil.  Kami mengikuti jalur standar <s>rake dan kruk untuk</s> membangun algoritma ML.  Dan begitulah adanya. <br><br><h3>  Pemilihan Metrik </h3><br>  Memilih metrik adalah tempat untuk memulai jika setidaknya satu orang selain Anda akan menggunakan perkiraan Anda. <br><br>  Pertimbangkan sebuah contoh: kami memiliki tiga opsi perkiraan.  Mana yang lebih baik? <br><img src="https://habrastorage.org/webt/ix/zg/gp/ixzggpclvbgaqpmkzaeehzhamb0.png" alt="gambar"><br>  Dari sudut pandang spesialis di gudang, kami membutuhkan perkiraan biru - kami akan membeli sedikit lebih sedikit, dan biarkan kami melewatkan puncaknya pada pertengahan Oktober, tetapi tidak ada yang tersisa di gudang.  Para ahli yang terikat KPI dengan penjualan memiliki pendapat yang berlawanan: bahkan perkiraan turquoise tidak cukup benar, tidak semua lompatan permintaan telah tercermin - lanjutkan memodifikasinya.  Tetapi dari sudut pandang seseorang, dari luar, sesuatu yang lebih baik umumnya teratur - sehingga semua orang akan merasa baik atau sebaliknya. <br><br>  Karena itu, sebelum membuat perkiraan, perlu untuk menentukan siapa yang akan menggunakannya dan mengapa.  Yaitu, pilih metrik dan pahami apa yang diharapkan dari ramalan yang dibangun di atas metrik tersebut.  Dan tunggu saja. <br><br>  Kami memilih MAE - kesalahan absolut rata-rata.  Metrik ini cocok untuk sampel pelatihan kami yang sangat tidak seimbang.  Karena bermacam-macam sangat luas (1,5 juta item), setiap produk secara individual di wilayah tertentu dijual dalam jumlah kecil.  Dan jika secara total kami menjual ratusan gaun hijau, maka gaun hijau khusus dengan kucing dijual dengan harga 2-3 per hari.  Akibatnya, sampel bergeser ke nilai yang kecil.  Di sisi lain, ada iPhone, pemintal, buku baru karya Olga Buzova (lelucon), dll.  - dan mereka dijual di kota mana pun dalam jumlah besar.  MAE memungkinkan Anda untuk tidak mendapatkan denda besar pada iPhone bersyarat dan umumnya bekerja dengan baik pada sebagian besar barang. <br><br><h3>  Langkah pertama </h3><br>  Kami mulai dengan membuat ramalan paling bodoh yang bisa berupa: angka acak dari 0 hingga 1000 akan dijual selama minggu depan dan mendapatkan metrik MAE = 496. Mungkin, ini bisa lebih buruk, tetapi ini sudah sangat buruk.  Jadi kami mendapat pedoman: jika kami mendapatkan nilai metrik yang demikian, maka jelas kami melakukan sesuatu yang salah. <br><br>  Kemudian kami mulai bermain orang-orang yang tahu cara membuat perkiraan tanpa pembelajaran mesin, dan mencoba memprediksi penjualan barang selama minggu depan sama dengan penjualan rata-rata untuk semua minggu terakhir, dan mendapatkan metrik MAE = 1,45 - yang jauh lebih baik. <br><br>  Melanjutkan dengan alasan, kami memutuskan bahwa penjualan minggu lalu tidak akan lebih relevan untuk memperkirakan penjualan untuk minggu berikutnya.  Untuk perkiraan seperti itu, MAE adalah 1,26.  Pada putaran pemikiran prognostik berikutnya, kami memutuskan untuk memperhitungkan kedua faktor dan memperkirakan penjualan untuk minggu berikutnya sebagai jumlah 50% dari penjualan rata-rata dan 50% dari penjualan selama seminggu terakhir - kami mendapat MAE = 1,23. <br><br>  Tapi bagi kami itu kelihatannya terlalu sederhana, dan kami memutuskan untuk mempersulit.  Kami mengumpulkan sampel pelatihan kecil di mana tanda-tanda sudah lewat dan penjualan rata-rata, dan targetnya adalah penjualan selama minggu berikutnya, dan kami melatihnya dengan regresi linier sederhana.  Kami mendapat bobot 0,46 dan 0,55 untuk rata-rata dan minggu terakhir dan MAE pada sampel uji sama dengan 1,2. <br>  Kesimpulan: data kami memiliki potensi prediksi. <br><br><h3>  Rekayasa fitur </h3><br>  Setelah memutuskan bahwa membuat ramalan dengan dua alasan bukanlah level kami, kami duduk untuk menghasilkan fitur kompleks yang baru.  Ini adalah informasi tentang penjualan sebelumnya - 1, 2, 3, 4 minggu lalu, seminggu tepat setahun yang lalu, dll.  Dan tampilan selama beberapa minggu terakhir, penambahan ke keranjang, konversi tampilan dan penambahan ke keranjang dalam pesanan - dan semua ini untuk periode yang berbeda. <br><br>  Kami perlu memberikan model pengetahuan tentang bagaimana produk secara keseluruhan dijual, bagaimana dinamika penjualannya telah berubah belakangan ini, bagaimana minat di dalamnya berkembang, bagaimana penjualannya bergantung pada harga dan faktor-faktor lain yang, menurut pendapat kami, dapat bermanfaat. <br><br>  Ketika ide-ide kami habis, kami pergi ke ahli departemen penjualan.  Di sana, misalnya, kami belajar bahwa tahun berikutnya adalah tahun babi, oleh karena itu, barang-barang yang setidaknya menyerupai babi akan sangat populer.  Atau, misalnya, bahwa "tidak beku" yang tidak dibeli orang-orang kami sebelumnya, tetapi tepat pada hari salju pertama - jadi harap, perhitungkan ramalan cuaca.  Secara umum, semua orang puas.  Kami - karena kami menerima banyak ide baru yang tidak akan pernah kami pikirkan tentang diri kami, dan pengusaha - bahwa segera mungkin untuk melakukan sesuatu yang lebih menarik daripada perkiraan penjualan. <br><br>  Tapi itu masih terlalu sederhana - dan kami telah menambahkan gejala gabungan: <br><br><ul><li>  konversi dari tampilan ke penjualan - bagaimana itu, bagaimana itu berubah; </li><li>  rasio penjualan lebih dari 4 minggu dengan penjualan selama seminggu terakhir (jika angka ini sangat berbeda dari 4, saat ini permintaan untuk produk ini tunduk pada "turbulensi"); </li><li>  rasio penjualan produk dengan penjualan di seluruh kategori - jika angka ini mendekati satu, maka produk tersebut adalah "perusahaan monopoli". </li></ul><br>  Pada tahap ini, Anda harus membuat sebanyak mungkin - membuang tanda-tanda non-informatif di tahap pelatihan. <br><br>  Hasilnya, kami mendapat 170 tanda.  Ke depan, fitur terpenting yang dimiliki <br><br><ul><li>  Penjualan selama seminggu terakhir (untuk dua, tiga dan empat). </li><li>  Ketersediaan produk minggu lalu adalah persentase waktu produk hadir di situs. </li><li>  Koefisien sudut jadwal penjualan barang selama 7 hari terakhir. </li><li>  Rasio harga masa lalu ke masa depan - dengan diskon besar, mulai membeli barang lebih aktif. </li><li>  Jumlah pesaing langsung dalam situs kami.  Jika, misalnya, pena ini adalah satu-satunya dalam kategorinya, penjualan akan cukup stasioner. </li><li>  Dimensi produk - ternyata panjang dan lebar secara signifikan memengaruhi prediktabilitas penjualan.  Untuk beberapa alasan, untuk objek yang panjang dan sempit - payung atau pancing, misalnya - jadwalnya jauh lebih tidak stabil.  Kami belum tahu bagaimana menjelaskannya. </li><li>  Jumlah hari dalam setahun - ini menunjukkan apakah Tahun Baru akan datang, 8 Maret, awal kenaikan musiman dalam penjualan, dll. </li></ul><br><h3>  Sampling </h3><br>  Sampel pelatihan adalah nyeri.  Kami mengumpulkannya selama sekitar 4 minggu, dua di antaranya hanya pergi ke penjaga data yang berbeda dan meminta untuk melihat apa yang mereka miliki.  Ini terjadi setiap kali Anda membutuhkan data untuk jangka waktu yang lama.  Bahkan dalam sistem pengumpulan data yang ideal, untuk waktu yang lama, sesuatu akan terjadi dalam semangat "kami dulu berpikir seperti ini, tapi kemudian kami mulai berpikir secara berbeda dan menulis data dalam kolom yang sama".  Atau satu atau dua tahun lalu server macet, tetapi tidak ada yang menuliskan kapan tepatnya - dan nol tidak lagi berarti bahwa tidak ada penjualan. <br><br>  Akibatnya, kami mendapat informasi tentang apa yang dilakukan orang di situs, apa, dan dalam jumlah berapa, mereka ditambahkan ke favorit dan keranjang, dan dibeli.  Kami mengumpulkan sampel sekitar 15 juta sampel masing-masing 170 fitur, targetnya adalah jumlah penjualan untuk minggu depan. <br><br>  Kami menulis 2 ribu baris kode di Spark.  Ini bekerja lambat, tetapi memungkinkan untuk mengunyah sejumlah besar data.  Sepertinya menghitung kemiringan garis lurus itu sederhana.  Dan untuk melakukannya 10kk kali ketika penjualan ditarik dari beberapa pangkalan - tugasnya bukan untuk menjadi lemah hati. <br><br>  Untuk satu minggu lagi, kami terlibat dalam pembersihan data sehingga model tersebut tidak terganggu oleh emisi dan fitur pengambilan sampel lokal, tetapi hanya mengekstraksi ketergantungan nyata yang melekat dalam penjualan Ozon.  Di sini 3 sigma dan lebih banyak metode licik untuk mencari anomali akan muncul.  Kasus yang paling sulit adalah mengembalikan penjualan selama periode kekurangan barang dalam persediaan.  Solusi paling sederhana adalah membuang minggu-minggu ketika produk keluar selama minggu "target". <br><br><img src="https://habrastorage.org/webt/kk/li/_z/kkli_zozkhocyxgrkur-eocnq3g.png" alt="gambar"><br><br>  Akibatnya, dari 15 juta sampel, 10 juta tetap. Penting di sini untuk tidak terbawa dan tidak kehilangan kelengkapan sampel (pada kenyataannya, kurangnya barang di gudang adalah karakteristik tidak langsung dari pentingnya bagi perusahaan; mengeluarkan barang-barang dari sampel tidak sama dengan membuang sampel acak) ) <br><br><h3>  Waktu ML </h3><br>  Pada sampel yang bersih dan mulai melatih model.  Secara alami, kami mulai dengan regresi linier dan mendapat MAE = 1,15.  Tampaknya ini adalah peningkatan yang sangat kecil, tetapi ketika Anda memiliki sampel 10 juta di mana nilai rata-rata 5-10, bahkan perubahan kecil dalam nilai metrik memberikan peningkatan yang tidak dapat dibandingkan dalam kualitas visual perkiraan.  Dan karena Anda pada akhirnya harus menghadirkan solusi untuk pelanggan bisnis, meningkatkan tingkat kegembiraan mereka adalah faktor penting. <br><br>  Berikutnya adalah sklearn.ensemble.RandomForestRegressor, yang setelah pemilihan singkat hyperparameters menunjukkan MAE = 1,10.  Selanjutnya kami mencoba XGBoost (di mana tanpanya) - semuanya akan baik-baik saja dan MAE = 1.03 - hanya dalam waktu yang sangat lama.  Sayangnya, kami tidak memiliki akses ke GPU untuk pelatihan XGBoost, dan pada prosesor, satu model dilatih untuk waktu yang sangat lama.  Kami mencoba menemukan sesuatu yang lebih cepat, dan menggunakan LightGBM - ia berlatih dua kali lebih cepat dan menunjukkan MAE bahkan sedikit kurang - 1,01. <br><br>  Kami membagi semua produk menjadi 13 kategori, seperti dalam katalog di situs: tabel, laptop, botol, dan untuk setiap kategori kami melatih model dengan kedalaman perkiraan yang berbeda - dari 5 hingga 16 hari. <br><br>  Pelatihan ini memakan waktu sekitar lima hari, dan untuk ini kami meningkatkan cluster komputasi besar.  Kami mengembangkan saluran pipa seperti itu: pencarian acak bekerja untuk waktu yang lama, memberikan 10 set hyperparameter teratas, dan kemudian ilmuwan bekerja dengan mereka secara manual - membangun metrik kualitas tambahan (kami menghitung MAE untuk rentang target yang berbeda), membangun kurva belajar (misalnya, kami membuang sebagian pelatihan) sampel dan dilatih lagi, memeriksa untuk melihat apakah data baru mengurangi kerugian pada sampel uji) dan grafik lainnya. <br><br>  Contoh analisis terperinci untuk salah satu set hiperparameter: <br><br><div class="spoiler">  <b class="spoiler_title">Metrik kualitas terperinci</b> <div class="spoiler_text"><table><tbody><tr><td><p>  Set kereta: </p><br></td><td><p>  Set tes: </p><br></td></tr><tr><td>  Untuk target = 0, MAE = 0.142222484602 </td><td>  Untuk 0 MAE = 0.141900737761 </td></tr><tr><td>  Untuk target&gt; 0, MAPE = 45.168530676 </td><td>  Untuk&gt; 0 MAPE = 45.5771812826 </td></tr><tr><td>  Kesalahan lebih besar dari 0 - 67,931341691% </td><td>  Kesalahan lebih besar dari 0 - 51.6405939896% </td></tr><tr><td>  Kesalahan lebih besar dari 1 - 19.0346986379% </td><td>  Kesalahan lebih besar dari 1 - 12.1977096603% </td></tr><tr><td>  Kesalahan lebih dari 2 - 8,94313926245% </td><td>  Kesalahan lebih dari 2 - 5,16977226441% </td></tr><tr><td>  Kesalahan lebih dari 3 - 5,42406856507% </td><td>  Kesalahan lebih dari 3 - 3,12760834969% </td></tr><tr><td>  Kesalahan lebih dari 4 - 3,67938161595% <br></td><td>  Kesalahan lebih dari 4 - 2,10263125679% </td></tr><tr><td>  Kesalahan lebih dari 5 - 2,67322988948% <br></td><td>  Kesalahan lebih dari 5 - 1,56473158807% <br></td></tr><tr><td>  Kesalahan lebih dari 6 - 2,0618556701% <br></td><td>  Kesalahan lebih dari 6 - 1,19599209102% <br></td></tr><tr><td>  Kesalahan lebih dari 7 - 1,65887701209% </td><td>  Kesalahan lebih besar dari 7 - 0,949300173983% <br></td></tr><tr><td>  Kesalahan lebih dari 8 - 1,36821095777% <br></td><td>  Kesalahan lebih dari 8 - 0,78310772461% </td></tr><tr><td>  Kesalahan lebih dari 9 - 1,15368611519% </td><td>  Kesalahan lebih besar dari 9 - 0,659205318158% <br></td></tr><tr><td>  Kesalahan lebih dari 10 - 0,99199395014% </td><td>  Kesalahan lebih dari 10 - 0,554593106723% </td></tr><tr><td>  Kesalahan lebih dari 11 - 0,863969667827% </td><td>  Kesalahan lebih dari 11 - 0,490045146476% <br></td></tr><tr><td>  Kesalahan lebih dari 12 - 0,764347266082% <br></td><td>  Kesalahan lebih dari 12 - 0,428835873827% <br></td></tr><tr><td>  Kesalahan lebih dari 13 - 0,68086818247% </td><td>  Kesalahan lebih dari 13 - 0,386545830907% <br></td></tr><tr><td>  Kesalahan lebih dari 14 - 0,613446089087% </td><td>  Kesalahan lebih dari 14 - 0,343884822697% <br></td></tr><tr><td>  Kesalahan lebih dari 15 - 0,556297016335% <br></td><td>  Kesalahan lebih dari 15 - 0,316433391328% <br></td></tr><tr><td>  Untuk target = 0, MAE = 0.142222484602 <br></td><td>  Untuk target = 0, MAE = 0.141900737761 <br></td></tr><tr><td>  Untuk target = 1, MAE = 0,63978556493 <br></td><td>  Untuk target = 1, MAE = 0,660823509405 </td></tr><tr><td>  Untuk target = 2, MAE = 1.01528075312 </td><td>  Untuk target = 2, MAE = 1.01098070566 </td></tr><tr><td>  Untuk target = 3, MAE = 1.43762342295 </td><td>  Untuk target = 3, MAE = 1.44836233499 </td></tr><tr><td>  Untuk target = 4, MAE = 1.82790678437 <br></td><td>  Untuk target = 4, MAE = 1.86539223382 <br></td></tr><tr><td>  Untuk target = 5, MAE = 2.15369976552 <br></td><td>  Untuk target = 5, MAE = 2.16017884573 </td></tr><tr><td>  Untuk target = 6, MAE = 2.51629758129 <br></td><td>  Untuk target = 6, MAE = 2.51987403661 <br></td></tr><tr><td>  Untuk target = 7, MAE = 2.80225497415 <br></td><td>  Untuk target = 7, MAE = 2.97580015564 <br></td></tr><tr><td>  Untuk target = 8, MAE = 3.09405048248 <br></td><td>  Untuk target = 8, MAE = 3.21914648525 <br></td></tr><tr><td>  Untuk target = 9, MAE = 3.39256765159 <br></td><td>  Untuk target = 9, MAE = 3.54572928241 <br></td></tr><tr><td>  Untuk target = 10, MAE = 3.6640339953 </td><td>  Untuk target = 10, MAE = 3.84409605282 <br></td></tr><tr><td>  Untuk target = 11, MAE = 4.02797747118 <br></td><td>  Untuk target = 11, MAE = 4.21828735273 <br></td></tr><tr><td>  Untuk target = 12, MAE = 4.17163467899 <br></td><td>  Untuk target = 12, MAE = 3,92536509115 <br></td></tr><tr><td>  Untuk target = 14, MAE = 4.78590364522 <br></td><td>  Untuk target = 14, MAE = 5.11290428675 </td></tr><tr><td>  Untuk target = 15, MAE = 4.89409916994 <br></td><td>  Untuk target = 15, MAE = 5.20892023117 <br></td></tr></tbody></table><br>  Kehilangan kereta = 0,535842111392 <br>  Kehilangan uji = 0,895529959873 <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Prediksi grafik (target) untuk set pelatihan</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/3m/o6/ho/3mo6hoqfklfc69z55btog7e6q_w.png" alt="gambar"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Prediksi grafik (target) untuk sampel uji</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hq/q6/bm/hqq6bm7aqcbngqum8mgdyhjibna.png" alt="gambar"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Kesalahan prediksi dari waktu ke waktu</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/in/mu/be/inmubedyg9b6hzyttimdneuh5-s.png" alt="gambar"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Urutkan kesalahan naik pada sampel uji</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/74/h3/kt/74h3ktebx43a9mhmie6sgp5ua_i.png" alt="gambar"><br></div></div><br>  Jika tidak ada yang cocok, cari lagi secara acak.  Inilah cara kami melatih model selama 5 atau 5 hari dengan kecepatan industri.  Kami sedang bertugas, seseorang di malam hari, seseorang bangun di pagi hari, melihat 10 parameter teratas, memulai kembali atau menyelamatkan model dan pergi tidur lebih jauh.  Dalam mode ini, kami bekerja selama seminggu dan melatih 130 model - 13 jenis barang dan 10 kedalaman perkiraan, masing-masing memiliki 170 fitur.  MAE rata-rata untuk seri waktu 5 kali lipat cv yang kami dapatkan sama dengan 1. <br><br>  Mungkin terlihat bahwa ini tidak terlalu keren - dan memang demikian, kecuali jika Anda memiliki bagian besar dalam pemilihan unit.  Sebagai analisis hasil menunjukkan, unit diprediksi terburuk dari semua - fakta bahwa suatu produk dibeli seminggu sekali tidak mengatakan apa-apa tentang apakah ada permintaan untuk itu.  Setelah apa pun dapat dijual - ada seseorang yang akan membeli patung porselen dalam bentuk dokter gigi, dan ini tidak mengatakan apa-apa tentang penjualan di masa depan atau tentang yang di masa lalu.  Secara umum, kami tidak menjadi sangat sedih tentang hal ini. <br><br><h3>  Kiat dan trik </h3><br>  Apa yang salah dan bagaimana ini bisa dihindari? <br><br>  Masalah pertama adalah pemilihan parameter.  Kami mulai menggunakan RandomizedSearchCV - alat yang terkenal dari sklearn untuk menyortir hiperparameter.  Di sinilah kejutan pertama menunggu kita. <br><br><div class="spoiler">  <b class="spoiler_title">Seperti ini</b> <div class="spoiler_text"><code>from sklearn.model_selection import ParameterSampler <br> from sklearn.model_selection import RandomizedSearchCV <br> <br> estimator = lightgbm.LGBMRegressor(application='regression_l1', is_training_metric = True, objective = 'regression_l1', num_threads=72) <br> param_grid = {'boosting_type': boosting_type, 'num_leaves': num_leaves, 'max_depth': max_depth, 'learning_rate':learning_rate, 'n_estimators': n_estimators, 'subsample_for_bin': subsample_for_bin, 'min_child_samples': min_child_samples, 'colsample_bytree': colsample_bytree, 'reg_alpha': reg_alpha, 'max_bin': max_bin} <br> <br> rscv = RandomizedSearchCV(estimator, param_grid, refit=False, n_iter=100, scoring='neg_mean_absolute_error', n_jobs=1, cv=10, verbose=3, pre_dispatch='1*n_jobs', error_score=-1, return_train_score='warn') <br> <br> rscv .fit(X_train.values, y_train['target'].values) <br> print('Best parameters found by grid search are:', rscv.best_params_)</code> <br> </div></div><br>  Perhitungannya hanya berhenti (yang penting, tidak jatuh, tetapi terus bekerja, tetapi pada jumlah inti yang lebih kecil dan pada titik tertentu itu hanya berhenti). <br><br><div class="spoiler">  <b class="spoiler_title">Saya harus memparalelkan proses karena RandomizedSearchCV</b> <div class="spoiler_text"> <code>estimator = lightgbm.LGBMRegressor(application='regression_l1', is_training_metric = True, objective = 'regression_l1', num_threads=1) <br> <br> rscv = RandomizedSearchCV(estimator, param_grid, refit=False, n_iter=100, scoring='neg_mean_absolute_error', n_jobs=72, cv=10, verbose=3, pre_dispatch='1*n_jobs', error_score=-1, return_train_score='warn') <br> <br> rscv .fit(X_train.values, y_train['target'].values) <br> print('Best parameters found by grid search are:', rscv.best_params_)</code> <br> </div></div><br>  Tapi RandomizedSearchCV meraih hampir seluruh dataset untuk setiap "pekerjaan".  Oleh karena itu, perlu untuk memperluas jumlah RAM, mungkin mengorbankan jumlah core. <br><br>  Siapa yang akan memberi tahu kami tentang hal-hal luar biasa seperti hyperopt!  Karena kami belajar, kami hanya menggunakannya. <br><br>  Trik lain yang muncul di benak kami menjelang akhir proyek adalah memilih model yang memiliki parameter colsample_bytree (ini adalah parameter LightGBM, yang mengatakan berapa persen fitur yang harus diberikan kepada setiap lerner) di wilayah 0,2-0,3, karena ketika mobil Ini berfungsi dalam produksi, mungkin tidak ada tabel, dan fitur individual mungkin tidak dihitung dengan benar.  Pengaturan seperti itu memungkinkan Anda untuk memastikan bahwa fitur-fitur yang tidak terhitung ini memengaruhi setidaknya tidak semua lerner dalam model. <br>  Secara empiris, kita sampai pada kesimpulan bahwa kita perlu melakukan lebih banyak penaksir dan memutar peraturan menjadi lebih sulit.  Ini bukan aturan kerja dengan LightGBM, tetapi skema seperti itu berhasil bagi kami. <br><br>  Yah dan, tentu saja, Spark.  Misalnya, ada bug yang diketahui Spark: jika Anda mengambil beberapa kolom dari sebuah tabel dan membuat yang baru, dan kemudian mengambil yang lain dari tabel yang sama dan membuat yang baru, dan kemudian menyetel tabel yang Anda terima, semuanya akan pecah, meskipun seharusnya tidak.  Anda dapat diselamatkan hanya dengan menyingkirkan semua perhitungan malas.  Kami bahkan menulis fungsi khusus - bumb_df, mengubah Bingkai Data menjadi RDD kembali menjadi Bingkai Data.  Artinya, me-reset semua perhitungan malas.  Ini dapat melindungi diri Anda dari sebagian besar masalah Spark. <br><br><div class="spoiler">  <b class="spoiler_title">bumb_df</b> <div class="spoiler_text"> <code>def bump_df(df): <br> # to avoid problem: AnalysisException: resolved attribute(s) <br> df_rdd = df.rdd <br> if df_rdd.isEmpty(): <br> df = df_rdd.toDF(schema=df.schema) <br> return df <br> else: <br> return df_rdd.toDF(schema=df.schema) <br></code> <br></div></div><br><h3>  Ramalan sudah siap: berapa banyak yang akan kami pesan? </h3><br>  Peramalan penjualan adalah murni tugas matematika, dan jika distribusi normal kesalahan nol-rata adalah kemenangan bagi ahli matematika, maka bagi pedagang yang memiliki setiap rubel di akun mereka, ini tidak dapat diterima. <br><br>  Jika satu iPhone tambahan atau satu pakaian modis di gudang tidak menjadi masalah, tetapi lebih merupakan stok asuransi, maka tidak adanya iPhone yang sama di gudang adalah kehilangan setidaknya margin, dan sebagai maksimum gambar, dan ini tidak dapat diizinkan. <br><br>  Untuk mengajarkan algoritma membeli sebanyak yang diperlukan, kami harus menghitung biaya pembelian kembali dan pembelian di bawah setiap produk dan melatih model sederhana untuk meminimalkan kemungkinan kerugian dalam uang. <br><br>  Model menerima perkiraan penjualan pada input, menambahkan suara acak, yang terdistribusi normal ke input tersebut (kami mensimulasikan ketidaksempurnaan pemasok), dan belajar untuk menambahkan sebanyak mungkin perkiraan untuk setiap produk tertentu untuk meminimalkan kerugian uang. <br><br>  Dengan demikian, pesanan adalah persediaan + prakiraan keamanan, yang menjamin jangkauan kesalahan prakiraan dan ketidaksempurnaan dunia luar. <br><br><h3>  Seperti dalam prod </h3><br>  Ozon memiliki kluster komputasi yang agak besar sendiri, di mana setiap malam sebuah pipa (kami menggunakan aliran udara) dari lebih dari 15 pekerjaan diluncurkan.  Ini terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/cc/sq/gb/ccsqgbj2p2xztr9qlllahzgr_4c.png" alt="gambar"><br><br>  Setiap malam, algoritma diluncurkan, menarik sekitar 20 GB data dari berbagai sumber ke HDF lokal, memilih pemasok untuk setiap produk, mengumpulkan fitur untuk setiap produk, membuat perkiraan penjualan dan menghasilkan pesanan berdasarkan jadwal pengiriman.  Pada 6-7 pagi, kami memberikan kepada orang-orang meja yang bertanggung jawab untuk bekerja dengan pemasok meja siap pakai yang terbang dengan mengklik tombol ke pemasok. <br><br><h3>  Tidak ada satu pun ramalan </h3><br>  Model yang terlatih tahu tentang ketergantungan prakiraan pada fitur apa pun dan, sebagai hasilnya, jika Anda membekukan tanda N-1 dan mulai mengubahnya, Anda dapat mengamati bagaimana hal itu memengaruhi prakiraan.  Tentu saja, hal yang paling menarik tentang ini adalah bagaimana penjualan bergantung pada harga. <br><br>  Penting untuk dicatat bahwa permintaan tidak hanya bergantung pada harga.  Misalnya, jika Anda membuat diskon kecil untuk kereta luncur di musim panas, itu tetap tidak membantu mereka menjual.  Kami membuat diskon lebih banyak, dan orang-orang muncul yang "menyiapkan kereta luncur di musim panas."  Tetapi sampai tingkat diskon tertentu, kita masih tidak dapat mencapai bagian otak yang bertanggung jawab untuk perencanaan.  Di musim dingin, ia berfungsi seperti untuk produk apa pun - Anda membuat diskon dan menjualnya lebih cepat. <br><br><img src="https://habrastorage.org/webt/zp/by/jg/zpbyjgawjuxfa0pfm3rrp0sb4f0.png" alt="gambar"><br><br><h3>  Paket </h3><br>  Sekarang kami secara aktif mempelajari pengelompokan deret waktu untuk mendistribusikan barang di antara kluster berdasarkan sifat kurva yang menggambarkan penjualan mereka.  Misalnya, musiman, populer secara tradisional di musim panas atau, sebaliknya, di musim dingin.  Saat kami mempelajari cara memisahkan produk dengan riwayat penjualan yang panjang, kami berencana untuk menyoroti fitur berbasis item yang akan memberi tahu Anda seperti apa pola penjualan untuk produk yang baru saja muncul - untuk saat ini, ini adalah tugas utama kami. <br><br>  Jaringan saraf, dan model parametrik deret waktu, dan semua ini dalam ansambel, pasti akan lebih jauh. <br><br>  Khususnya, berkat sistem peramalan yang baru, Ozon beralih dari pembelian barang dengan stok ke pengiriman siklus, ketika kami membeli dari satu suplai ke suplai lain dan tidak menyimpan saldo dalam stok. <br><br>  Sekarang kita harus memutuskan bagaimana cara mengajarkan algoritma untuk memprediksi penjualan produk baru dan seluruh kategori.  Tahun depan, perusahaan berencana untuk meningkatkan penjualan x10 dalam kategori dan x2.5 di bidang pemenuhan.  Dan kita perlu memberi tahu para model bahwa data lama ini relevan, tetapi untuk toko sebelumnya yang berbeda.  Dan sementara kami berpikir bagaimana melakukannya. <br><br>  Yang kedua secara alami hal yang tidak rasional yang harus kita pelajari untuk diprediksi adalah mode.  Bagaimana orang bisa memprediksi bahwa seorang pemintal akan menjual seperti itu?  Bagaimana cara memprediksi penjualan buku baru Dan Brown jika salah satu bukunya terjual habis dan yang lainnya tidak?  Sementara kami sedang mengerjakannya. <br><br>  Jika Anda tahu cara melakukan yang lebih baik, atau Anda memiliki cerita tentang menggunakan pembelajaran mesin dalam pertempuran di komentar, kami akan membahasnya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id431950/">https://habr.com/ru/post/id431950/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id431940/index.html">Orang-orang terbakar jika mereka tidak merasakan nilai mereka. Apa yang harus dilakukan?</a></li>
<li><a href="../id431942/index.html">Injeksi ketergantungan hirarkis dalam React dan MobX State Tree sebagai model domain</a></li>
<li><a href="../id431944/index.html">Yealink Meeting Server 2.0 - Fitur Konferensi Video Baru</a></li>
<li><a href="../id431946/index.html">Pekan Keamanan 49: meretas Dell dan Marriott</a></li>
<li><a href="../id431948/index.html">Deep Mind mengajarkan AI-nya untuk memprediksi struktur protein</a></li>
<li><a href="../id431954/index.html">Mantan wakil presiden Sun dan DEC menjadi presiden MIPS / Wave, berbicara tentang Rusia dan RISC / V</a></li>
<li><a href="../id431956/index.html">Logika, kemampuan menjelaskan dan pemahaman masa depan</a></li>
<li><a href="../id431958/index.html">Stasiun Daya Baterai Virtual Tesla Diperluas ke 1.000 Rumah di Australia</a></li>
<li><a href="../id431960/index.html">Nvidia menjadi gila dan membuka PhysX di bawah BSD-3</a></li>
<li><a href="../id431964/index.html">Gabungkan Urusan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>