<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò∏ üìØ üêâ Software de seguran√ßa adicional para NAS üö∂üèº üê¥ ü§õüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A s√©rie de artigos √© intitulada Construindo um Secure NAS . Portanto, este artigo considerar√° aumentar o n√≠vel de seguran√ßa. Al√©m disso, ser√£o descrit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Software de seguran√ßa adicional para NAS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421279/"><p><img src="https://habrastorage.org/webt/39/ch/xl/39chxldtklziggqygx3wgmom0ky.png"></p><br><p>  A s√©rie de artigos √© intitulada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Construindo um Secure NAS</a> .  Portanto, este artigo considerar√° aumentar o n√≠vel de seguran√ßa.  Al√©m disso, ser√£o descritas as ferramentas que n√£o usei, mas √© poss√≠vel aplicar. </p><a name="habracut"></a><br><h2 id="kto-i-kak">  Quem e como </h2><br><p>  Quem vai atacar o sistema e como ele far√° isso? </p><br><p>  Geralmente, essa √© a primeira pergunta que precisa ser respondida antes de falar sobre seguran√ßa. <br>  Pelo menos no caso do NAS, essa resposta j√° est√° impl√≠cita.  Mas, para responder totalmente a essa pergunta, um modelo de amea√ßa e um intruso est√£o sendo constru√≠dos. </p><br><p>  As empresas est√£o embarcando em uma fase de modelagem de amea√ßas em seus ciclos de desenvolvimento. <br>  A Microsoft tem um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SDL</a> para isso, as pessoas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">t√™m outros modelos</a> . </p><br><p>  Elas implicam o uso de certas t√©cnicas, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">STRIDE</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">DREAD</a> (STRIDE √© ainda mais geral e tem mais suporte instrumental). </p><br><p>  No STRIDE, por exemplo, um modelo √© constru√≠do em fluxos de dados e geralmente √© grande, pesado e mal compreendido.  No entanto, a ferramenta fornece uma lista de amea√ßas em potencial, o que facilita sua considera√ß√£o. </p><br><p>  O modelo de amea√ßa √© uma informa√ß√£o classificada, pois torna mais f√°cil para um invasor analisar o sistema e encontrar pontos fracos.  Se ele receber um modelo, ele n√£o precisar√° constru√≠-lo por conta pr√≥pria, porque os analistas j√° cuidaram de tudo. </p><br><p>  <strong>Foi um minuto de publicidade.</strong> </p><br><p><img src="https://habrastorage.org/webt/w4/ye/cz/w4yeczwns0wzroeq-ufxttf9yhm.jpeg"></p><br><p>  √â assim que as empresas s√©rias constroem o modelo.  E se isso for interessante, posso descrever de alguma forma em um artigo separado. </p><br><p>  Aqui, descreverei o que √© chamado de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"prote√ß√£o"</a> em ingl√™s e lidarei com as falhas de seguran√ßa que foram feitas durante a constru√ß√£o do sistema. </p><br><p>  Basicamente, a manuten√ß√£o da seguran√ßa nesse n√≠vel √© feita fechando as vulnerabilidades conhecidas do sistema, monitorando-as e verificando-as periodicamente. </p><br><h2 id="literatura-po-teme">  Literatura Relacionada </h2><br><p>  O que ler: </p><br><ul><li>  Vale a pena come√ßar com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o projeto Hardened Linux</a> , onde todos encontrar√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">muitas coisas √∫teis</a> . </li><li>  O pacote harden-doc cont√©m o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Manual de Seguran√ßa do Debian,</a> antigo em 2012, mas correr ao redor n√£o interfere no entendimento do problema. </li><li>  Ent√£o, leia o passo a passo curto do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Debian 8 Hardening</a> . </li><li>  E, finalmente, um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pequeno guia para Hardening pacotes deb</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">c√≥digo C / C ++</a> que voc√™ provavelmente n√£o precisar√°. </li></ul><br><h2 id="snapshoty-i-doker">  Instant√¢neos e Docker </h2><br><p>  Anteriormente, o zfs-autosnapshot era instalado.  Ele me ajudou repetidamente, porque  Eu poderia restaurar configura√ß√µes corrompidas (para Nextcloud, por exemplo) a partir de instant√¢neos. <br>  No entanto, com o tempo, o sistema come√ßou a desacelerar e v√°rios milhares de instant√¢neos se multiplicaram. </p><br><p> Aconteceu que, ao criar o sistema de arquivos pai para cont√™ineres, esqueci de definir o sinalizador <code>com.sun:auto-snapshot=false</code> . </p><br><p>  No <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo original,</a> esse problema j√° foi corrigido. Aqui mostrarei como se livrar de snapshots extras. </p><br><div class="spoiler">  <b class="spoiler_title">Detalhes sobre como corrigir o erro.</b> <div class="spoiler_text"><p>  Primeiro, desative o zfs-auto-snapshot no sistema de arquivos pai da janela de encaixe: </p><br><pre> <code class="plaintext hljs">zfs set com.sun:auto-snapshot=false tank0/docker/lib</code> </pre> <br><p>  Agora remova recipientes e imagens n√£o utilizados: </p><br><pre> <code class="plaintext hljs">docker container prune docker image prune</code> </pre> <br><p>  Excluir instant√¢neos: </p><br><pre> <code class="plaintext hljs">zfs list -t snapshot -o name -S creation | grep -e ".*docker/lib.*@zfs-auto-snap" | tail -n +1500 | xargs -n 1 zfs destroy -vr</code> </pre> <br><p>  E desative-os em todos os sistemas de arquivos de imagem: </p><br><pre> <code class="plaintext hljs">zfs list -t filesystem -o name -S creation | grep -e "tank0/docker/lib" | xargs -n 1 zfs set com.sun:auto-snapshot=false</code> </pre> <br><p>  Mais detalhes podem ser lidos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p></div></div><br><h2 id="ldap">  LDAP </h2><br><p>  Na √∫ltima vez, apenas um usu√°rio LDAP com uma fun√ß√£o de administrador foi criado. </p><br><p>  Mas a maioria dos servi√ßos n√£o precisa alterar nada no banco de dados do usu√°rio.  Portanto, seria bom adicionar um usu√°rio somente leitura.  Para n√£o criar fun√ß√µes manualmente, √© poss√≠vel usar um script de inicializa√ß√£o do cont√™iner. </p><br><p>  Primeiro, adicione as configura√ß√µes no <code>docker-compose.yml</code> para ativar o usu√°rio somente leitura: </p><br><pre> <code class="plaintext hljs">- "LDAP_READONLY_USER=true" - "LDAP_READONLY_USER_USERNAME=readonly" - "LDAP_READONLY_USER_PASSWORD=READONLY_PASSWORD"</code> </pre> <br><p>  Arquivo completo sob o spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">docker-compose.yml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">version: "2" networks: ldap: docker0: external: name: docker0 services: open-ldap: image: "osixia/openldap" hostname: "open-ldap" restart: always environment: - "LDAP_ORGANISATION=NAS" - "LDAP_DOMAIN=nas.nas" - "LDAP_ADMIN_PASSWORD=ADMIN_PASSWORD" - "LDAP_CONFIG_PASSWORD=CONFIG_PASSWORD" - "LDAP_READONLY_USER=true" - "LDAP_READONLY_USER_USERNAME=readonly" - "LDAP_READONLY_USER_PASSWORD=READONLY_PASSWORD" - "LDAP_TLS=true" - "LDAP_TLS_ENFORCE=false" - "LDAP_TLS_CRT_FILENAME=ldap_server.crt" - "LDAP_TLS_KEY_FILENAME=ldap_server.key" - "LDAP_TLS_CA_CRT_FILENAME=ldap_server.crt" volumes: - ./certs:/container/service/slapd/assets/certs - ./ldap_data/var/lib:/var/lib/ldap - ./ldap_data/etc/ldap/slapd.d:/etc/ldap/slapd.d networks: - ldap ports: - 172.21.0.1:389:389 - 172.21.0.1:636:636 phpldapadmin: image: "osixia/phpldapadmin:0.7.1" hostname: "nas.nas" restart: always networks: - ldap - docker0 expose: - 443 links: - open-ldap:open-ldap-server volumes: - ./certs:/container/service/phpldapadmin/assets/apache2/certs environment: - VIRTUAL_HOST=ldap.* - VIRTUAL_PORT=443 - VIRTUAL_PROTO=https - CERT_NAME=NAS.cloudns.cc - "PHPLDAPADMIN_LDAP_HOSTS=open-ldap-server" #- "PHPLDAPADMIN_HTTPS=false" - "PHPLDAPADMIN_HTTPS_CRT_FILENAME=certs/ldap_server.crt" - "PHPLDAPADMIN_HTTPS_KEY_FILENAME=private/ldap_server.key" - "PHPLDAPADMIN_HTTPS_CA_CRT_FILENAME=certs/ldap_server.crt" - "PHPLDAPADMIN_LDAP_CLIENT_TLS_REQCERT=allow" ldap-ssp: image: openfrontier/ldap-ssp:https volumes: - /etc/ssl/certs/ssl-cert-snakeoil.pem:/etc/ssl/certs/ssl-cert-snakeoil.pem - /etc/ssl/private/ssl-cert-snakeoil.key:/etc/ssl/private/ssl-cert-snakeoil.key restart: always networks: - ldap - docker0 expose: - 80 links: - open-ldap:open-ldap-server environment: - VIRTUAL_HOST=ssp.* - VIRTUAL_PORT=80 - VIRTUAL_PROTO=http - CERT_NAME=NAS.cloudns.cc - "LDAP_URL=ldap://open-ldap-server:389" - "LDAP_BINDDN=cn=admin,dc=nas,dc=nas" - "LDAP_BINDPW=ADMIN_PASSWORD" - "LDAP_BASE=ou=users,dc=nas,dc=nas" - "MAIL_FROM=admin@nas.nas" - "PWD_MIN_LENGTH=8" - "PWD_MIN_LOWER=3" - "PWD_MIN_DIGIT=2" - "SMTP_HOST=" - "SMTP_USER=" - "SMTP_PASS="</code> </pre> </div></div><br><p>  Em seguida, voc√™ precisa despejar e excluir: </p><br><pre> <code class="plaintext hljs">$ cd /tank0/docker/services/ldap $ tar czf ~/ldap_backup.tgz . $ ldapsearch -Wx -D "cn=admin,dc=nas,dc=nas" -b "dc=nas,dc=nas" -H ldap://172.21.0.1 -LLL &gt; ldap_dump.ldif $ docker-compose down $ rm -rf ldap_data $ docker-compose up -d</code> </pre> <br><p>  Para impedir que o servidor se recupere de um despejo de palavr√µes em elementos duplicados, exclua as linhas no arquivo: </p><br><pre> <code class="plaintext hljs">dn: dc=nas,dc=nas objectClass: top objectClass: dcObject objectClass: organization o: NAS dc: nas dn: cn=admin,dc=nas,dc=nas objectClass: simpleSecurityObject objectClass: organizationalRole cn: admin description: LDAP administrator userPassword:: PASSWORD_BASE64</code> </pre><br><p>  E restaure usu√°rios e grupos: </p><br><pre> <code class="plaintext hljs">$ ldapadd -Wx -D "cn=admin,dc=nas,dc=nas" -H ldap://172.21.0.1 -f ldap_dump.ldif</code> </pre> <br><p>  Um animal assim aparecer√° no banco de dados: </p><br><pre> <code class="plaintext hljs">dn: cn=readonly,dc=nas,dc=nas cn: readonly objectClass: simpleSecurityObject objectClass: organizationalRole userPassword:: PASSWORD_BASE64 description: LDAP read only user</code> </pre> <br><p>  As fun√ß√µes na configura√ß√£o do servidor LDAP ser√£o criadas pelo cont√™iner. <br>  Execute verifica√ß√µes ap√≥s a recupera√ß√£o e exclua o backup: </p><br><pre> <code class="plaintext hljs">$ rm ~/ldap_backup.tgz</code> </pre> <br><h3 id="dobavlenie-grupp-v-ldap">  Adicionando grupos ao LDAP </h3><br><p>  Conveniente √© a separa√ß√£o de usu√°rios LDAP em grupos semelhantes aos grupos POSIX no Linux. <br>  Por exemplo, √© poss√≠vel criar grupos cujos usu√°rios ter√£o acesso a reposit√≥rios, acesso √† nuvem ou acesso √† biblioteca. </p><br><p>  Grupos s√£o facilmente adicionados ao phpLDAPAdmin, e n√£o vou me concentrar nisso. </p><br><p>  Observo apenas o seguinte: </p><br><ul><li>  O grupo √© criado a partir do modelo "Padr√£o".  Este <strong>n√£o</strong> √© <strong>um</strong> grupo <strong>POSIX</strong> , mas um grupo de nomes. </li><li>  Assim, o grupo possui um atributo <code>objectClass</code> que inclui o valor de <code>groupOfUniqueNames</code> . </li></ul><br><p> <a href=""><img src="https://habrastorage.org/webt/tx/i8/yj/txi8yjxxtbvlzynr1yttkn-ddgc.png" alt="Adicionando um grupo ao phpLDAPAdmin"></a> </p><br><h2 id="docker">  Docker </h2><br><p>  No Docker, quase tudo foi feito para voc√™. <br>  Por padr√£o, ele usa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a restri√ß√£o de chamada do sistema</a> , inclu√≠da no kernel OMV: </p><br><pre> <code class="plaintext hljs"># grep SECCOMP /boot/config-4.16.0-0.bpo.2-amd64 CONFIG_HAVE_ARCH_SECCOMP_FILTER=y CONFIG_SECCOMP_FILTER=y CONFIG_SECCOMP=y</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aqui voc√™</a> pode ler sobre as regras b√°sicas de seguran√ßa do Docker com mais detalhes. <br>  Al√©m disso, se o AppArmor estiver ativado, o Docker poder√° se integrar a ele e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">encaminhar seus perfis para o cont√™iner</a> . </p><br><h2 id="set">  Rede </h2><br><h3 id="ustranenie-vozmozhnosti-obnaruzheniya-os">  Eliminar a descoberta do SO </h3><br><p>  A rede est√° localizada atr√°s do roteador, mas √© poss√≠vel fazer um exerc√≠cio curioso alterando alguns par√¢metros da pilha de rede para que o sistema operacional n√£o possa ser identificado pelas respostas. <br>  H√° pouco benef√≠cio real com isso, porque o invasor estudar√° os banners de servi√ßo e ainda entender√° o SO que voc√™ est√° usando. </p><br><div class="spoiler">  <b class="spoiler_title">O Nmap mostra qual SO est√° sendo executado no dispositivo.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># nmap -O localhost Starting Nmap 7.40 ( https://nmap.org ) at 2018-08-26 14:39 MSK Nmap scan report for localhost (127.0.0.1) Host is up (0.000015s latency). Other addresses for localhost (not scanned): ::1 Not shown: 992 closed ports PORT STATE SERVICE 53/tcp open domain 80/tcp open http 443/tcp open https 5432/tcp open postgresql Device type: general purpose Running: Linux 3.X|4.X OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4 OS details: Linux 3.8 - 4.6 Network Distance: 0 hops OS detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 4.07 seconds</code> </pre> </div></div><br><p>  Fa√ßa o download das configura√ß√µes do sysctl.conf: </p><br><pre> <code class="plaintext hljs"># sysctl -p /etc/sysctl.conf net.ipv4.conf.all.accept_redirects = 0 net.ipv6.conf.all.accept_redirects = 0 net.ipv4.conf.all.send_redirects = 0 net.ipv4.conf.all.accept_source_route = 0 net.ipv6.conf.all.accept_source_route = 0 net.ipv4.tcp_rfc1337 = 1 net.ipv4.ip_default_ttl = 128 net.ipv4.icmp_ratelimit = 900 net.ipv4.tcp_synack_retries = 7 net.ipv4.tcp_syn_retries = 7 net.ipv4.tcp_window_scaling = 1 net.ipv4.tcp_timestamps = 1</code> </pre> <br><p>  E assim ... </p><br><div class="spoiler">  <b class="spoiler_title">O Nmap n√£o pode determinar o sistema operacional.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># nmap -O localhost Starting Nmap 7.40 ( https://nmap.org ) at 2018-08-26 14:40 MSK Nmap scan report for localhost (127.0.0.1) Host is up (0.000026s latency). Other addresses for localhost (not scanned): ::1 Not shown: 992 closed ports PORT STATE SERVICE 53/tcp open domain 80/tcp open http 443/tcp open https 5432/tcp open postgresql No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ). TCP/IP fingerprint: OS:SCAN(V=7.40%E=4%D=8/26%OT=53%CT=1%CU=43022%PV=N%DS=0%DC=L%G=Y%TM=5B8291C OS:3%P=x86_64-pc-linux-gnu)SEQ(SP=FA%GCD=1%ISR=105%TI=Z%CI=I%TS=8)OPS(O1=MF OS:FD7ST11NW7%O2=MFFD7ST11NW7%O3=MFFD7NNT11NW7%O4=MFFD7ST11NW7%O5=MFFD7ST11 OS:NW7%O6=MFFD7ST11)WIN(W1=AAAA%W2=AAAA%W3=AAAA%W4=AAAA%W5=AAAA%W6=AAAA)ECN OS:(R=Y%DF=Y%T=80%W=AAAA%O=MFFD7NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%F= OS:AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=80%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5( OS:R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0%S=A%A=Z% OS:F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N OS:%T=80%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=80%C OS:D=S) Network Distance: 0 hops OS detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 19.52 seconds</code> </pre> </div></div><br><p>  Essas configura√ß√µes precisam ser escritas em <code>/etc/sysctl.conf</code> , e a cada reinicializa√ß√£o elas ser√£o lidas automaticamente. </p><br><div class="spoiler">  <b class="spoiler_title">/Etc/sysctl.conf completo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">################################################################### # Additional settings - these settings can improve the network # security of the host and prevent against some network attacks # including spoofing attacks and man in the middle attacks through # redirection. Some network environments, however, require that these # settings are disabled so review and enable them as needed. # # Do not accept ICMP redirects (prevent MITM attacks) net.ipv4.conf.default.accept_redirects = 0 net.ipv6.conf.default.accept_redirects = 0 net.ipv4.conf.all.accept_redirects = 0 net.ipv6.conf.all.accept_redirects = 0 # _or_ # Accept ICMP redirects only for gateways listed in our default # gateway list (enabled by default) # net.ipv4.conf.all.secure_redirects = 1 # # Do not send ICMP redirects (we are not a router) net.ipv4.conf.all.send_redirects = 0 # # Do not accept IP source route packets (we are not a router) net.ipv4.conf.all.accept_source_route = 0 net.ipv6.conf.all.accept_source_route = 0 ## protect against tcp time-wait assassination hazards ## drop RST packets for sockets in the time-wait state ## (not widely supported outside of linux, but conforms to RFC) net.ipv4.tcp_rfc1337 = 1 # # Log Martian Packets #net.ipv4.conf.all.log_martians = 1 # ################################################################### # Magic system request Key # 0=disable, 1=enable all # Debian kernels have this set to 0 (disable the key) # See https://www.kernel.org/doc/Documentation/sysrq.txt # for what other values do #kernel.sysrq=1 ################################################################### # Protected links # # Protects against creating or following links under certain conditions # Debian kernels have both set to 1 (restricted) # See https://www.kernel.org/doc/Documentation/sysctl/fs.txt #fs.protected_hardlinks=0 #fs.protected_symlinks=0 vm.overcommit_memory = 1 vm.swappiness = 10 ################################################################### # Anti-fingerprinting. # # Def: 64. net.ipv4.ip_default_ttl = 128 #   ICMP  (  1000) net.ipv4.icmp_ratelimit = 900 #    ,     . # Def: 5. net.ipv4.tcp_synack_retries = 7 # Def: 5. net.ipv4.tcp_syn_retries = 7 #   TCP window  timespamp    1323. net.ipv4.tcp_window_scaling = 1 net.ipv4.tcp_timestamps = 1 # Redis requirement. net.core.somaxconn = 511</code> </pre> </div></div><br><p>  A prote√ß√£o contra a defini√ß√£o de vers√µes de servi√ßo √© mais √∫til, para a qual um invasor tamb√©m pode usar o Nmap: </p><br><pre> <code class="plaintext hljs"># nmap -sV -sR --allports --version-trace 127.0.0.1</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">O resultado n√£o √© muito bom para o sistema.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Not shown: 991 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u3 (protocol 2.0) 25/tcp open smtp Postfix smtpd 80/tcp open http nginx 1.13.12 111/tcp open rpcbind 2-4 (RPC #100000) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 443/tcp open ssl/http nginx 1.13.12 445/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 3493/tcp open nut Network UPS Tools upsd 8000/tcp open http Icecast streaming media server 2.4.2 Service Info: Hosts: nas.localdomain, NAS; OS: Linux; CPE: cpe:/o:linux:linux_kernel Final times for host: srtt: 22 rttvar: 1 to: 100000</code> </pre> </div></div><br><p>  Mas com o disfarce de servi√ßos, nem tudo √© tranquilo: </p><br><ul><li>  Para cada servi√ßo, √© necess√°ria uma abordagem individual aqui. </li><li>  A capacidade de remover a vers√£o nem sempre est√° dispon√≠vel. </li></ul><br><p>  Por exemplo, para SSH, √© poss√≠vel adicionar a op√ß√£o <code>DebianBanner no</code> a <code>/etc/ssh/sshd_confg</code> . </p><br><p>  Como resultado: </p><br><pre> <code class="plaintext hljs">22/tcp open ssh OpenSSH 7.4p1 (protocol 2.0)</code> </pre> <br><p>  Melhor, infelizmente, n√£o funcionar√°: a vers√£o √© usada pelo SSH para estabelecer quais recursos s√£o suportados, e √© poss√≠vel alter√°-lo apenas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aplicando patches no servidor</a> . </p><br><h3 id="port-knocking">  Porto batendo </h3><br><p>  N√£o √© a t√©cnica de seguran√ßa mais conhecida, permitindo que um usu√°rio remoto que conhe√ßa o segredo se conecte a uma porta fechada. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O trabalho se parece com um bloqueio de c√≥digo</a> : todos sabem que os daemons de servi√ßo est√£o trabalhando no servidor, mas "eles n√£o est√£o l√°" at√© que o c√≥digo seja discado. <br>  Por exemplo, para conectar-se a um servidor SSH, um usu√°rio precisa bater nas portas UDP 7000, TCP 7007 e UDP 7777. <br>  Depois disso, com seu IP, o firewall ser√° iniciado em uma porta TCP 22 <strong>fechada</strong> . </p><br><p>  Voc√™ pode ler mais sobre como isso funciona <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  E <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no manual para Debian</a> . </p><br><p>  Eu n√£o recomendo usar, como  fail2ban geralmente √© suficiente. </p><br><h3 id="fayrvoll">  Firewall </h3><br><p>  Eu configuro o firewall atrav√©s da GUI da Web OpenMediaVault, que eu recomendo. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/cv/a9/eo/cva9eoxcbu4h8ut8cwrwczkjop8.png"></a> </p><br><p>  Abra as portas necess√°rias, como 443 e 22, o resto a gosto.  Tamb√©m √© aconselh√°vel habilitar o log de pacotes descartados. </p><br><h3 id="ssh">  Ssh </h3><br><div class="spoiler">  <b class="spoiler_title">Se o SSH travar na porta 22, aberta √† Internet, voc√™ receber√° muitas mensagens interessantes ...</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># grep "invalid user" /var/log/auth.log|head Aug 26 00:07:57 nas sshd[29786]: input_userauth_request: invalid user test [preauth] Aug 26 00:07:59 nas sshd[29786]: Failed password for invalid user test from 185.143.160.137 port 51268 ssh2 Aug 26 00:11:01 nas sshd[5641]: input_userauth_request: invalid user 0 [preauth] Aug 26 00:11:01 nas sshd[5641]: Failed none for invalid user 0 from 5.188.10.180 port 49025 ssh2 Aug 26 00:11:04 nas sshd[5644]: input_userauth_request: invalid user 0101 [preauth] Aug 26 00:11:06 nas sshd[5644]: Failed password for invalid user 0101 from 5.188.10.180 port 59867 ssh2 Aug 26 00:32:55 nas sshd[20367]: input_userauth_request: invalid user ftp [preauth] Aug 26 00:32:56 nas sshd[20367]: Failed password for invalid user ftp from 5.188.10.144 port 47981 ssh2 Aug 26 00:32:57 nas sshd[20495]: input_userauth_request: invalid user guest [preauth] Aug 26 00:32:59 nas sshd[20495]: Failed password for invalid user guest from 5.188.10.144 port 34202 ssh2</code> </pre> </div></div><br><p>  Correndo o risco de parecer trivial, ainda me lembro de que √© necess√°rio: </p><br><ul><li>  Proibir estritamente o login root. </li><li>  Limite o login apenas aos usu√°rios especificados. </li><li>  Mude a porta para fora do padr√£o. </li><li>  √â aconselh√°vel desativar a autentica√ß√£o de senha, deixando apenas a chave. </li></ul><br><p>  Leia mais √© poss√≠vel, por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><p>  Tudo isso √© feito facilmente a partir da interface do OpenMediaVault atrav√©s do menu "Servi√ßos -&gt; SSH". <br>  S√≥ que eu n√£o mudei a porta para fora do padr√£o, deixando 22 na rede local e simplesmente substituindo a porta no roteador NAT. </p><br><div class="spoiler">  <b class="spoiler_title">Aqui est√° uma lista interessante de contas que tentei compilar, at√© alterar a porta SSHD para outra diferente de 22.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># grep "invalid user" /var/log/auth.log|sed 's/.*invalid user \([^ ]*\) .*/\1/'|sort|uniq 0 0101 1234 22 admin ADMIN administrateur administrator admins alfred amanda amber Anonymous apache avahi backup@network bcnas benjamin bin cacti callcenter camera cang castis charlotte clamav client cristina cron CSG cvsuser cyrus david db2inst1 debian debug default denis elvira erik fabio fax ftp ftpuser gary gast GEN2 guest I2b2workdata2 incoming jboss john juan matilda max mia miner muhammad mysql nagios nginx noc office oliver operator oracle osmc pavel pi pmd postgres PROCAL prueba RSCS sales sales1 scaner selena student07 sunos support sybase sysadmin teamspeak telecomadmin test test1 test2 test3 test7 tirocu token tomcat tplink ubnt ubuntu user1 vagrant victor volition www-data xghwzp xxx zabbix zimbra</code> </pre> </div></div><br><p>  Feito isso, as tentativas n√£o autorizadas de login ser√£o feitas com muito menos frequ√™ncia. </p><br><p>  Para melhorar ainda mais a situa√ß√£o, √© poss√≠vel bloquear os invasores de determinados IPs ap√≥s v√°rias tentativas de login. </p><br><p>  O que pode ser usado para: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fail2ban</a> .  Um utilit√°rio popular que funciona n√£o apenas para SSH, mas tamb√©m para muitos outros aplicativos. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Denyhosts</a>  Parece fail2ban. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sshguard</a> , se desejar, voc√™ pode tentar us√°-lo, mas eu n√£o estava interessado em detalhes. </li></ul><br><p>  Estou usando fail2ban.  Ele monitorar√° os logs em busca de v√°rias a√ß√µes indesej√°veis ‚Äã‚Äãpor parte de determinados IPs e os banir√° se o n√∫mero de respostas for excedido: </p><br><div class="spoiler">  <b class="spoiler_title">/var/log/fail2ban.log.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">2018-08-29 21:17:25,351 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.144 2018-08-29 21:17:25,473 fail2ban.actions [8650]: NOTICE [sshd] Ban 5.188.10.144 2018-08-29 21:17:27,359 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.144 2018-08-29 21:28:13,128 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:13,132 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:15,137 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:20,145 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:25,153 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.176 2018-08-29 21:28:25,421 fail2ban.actions [8650]: NOTICE [sshd] Ban 5.188.10.176 2018-08-29 21:30:05,272 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:05,274 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:13,285 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:13,286 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:15,289 fail2ban.filter [8650]: INFO [sshd] Found 5.188.10.180 2018-08-29 21:30:15,803 fail2ban.actions [8650]: NOTICE [sshd] Ban 5.188.10.180</code> </pre> </div></div><br><p>  Uma proibi√ß√£o √© feita adicionando uma regra de firewall.  Ap√≥s um tempo especificado, a regra √© exclu√≠da e o usu√°rio pode tentar novamente fazer login. </p><br><p>  Inicialmente, apenas o SSH est√° ativado, mas √© poss√≠vel ativar o controle dos logs do servidor da Web e de outros servi√ßos, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pelo menos do mesmo OMV</a> . <br>  Al√©m disso, retire os logs dos cont√™ineres e defina fail2ban neles tamb√©m. </p><br><p>  Eu recomendo adicionar servi√ßos a gosto. <br>  Voc√™ pode ler mais sobre a configura√ß√£o, por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> ou no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wiki nativo</a> . </p><br><h2 id="logi">  Logs </h2><br><h3 id="lwatchhttpspackagesdebianorgstretchadminlwatch">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lwatch</a> </h3><br><p>  Um pequeno utilit√°rio que deve ser instalado por conveni√™ncia.  Ele destacar√° os logs e os exibir√° de uma forma bonita. <br>  √â poss√≠vel usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">qualquer utilit√°rio</a> , o principal √© que os erros e as √°reas problem√°ticas dos logs sejam destacados para facilitar a an√°lise visual. </p><br><h3 id="logcheckhttplogcheckorg">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Verifica√ß√£o de log</a> </h3><br><p>  Vale a pena instalar e configurar a verifica√ß√£o de log simplesmente para que, ao identificar problemas de configura√ß√£o relatados nos logs, voc√™ o veja imediatamente no correio. <br>  Ajuda muito ver o que est√° errado, embora exija ajuste. </p><br><p>  Instala√ß√£o: </p><br><pre> <code class="plaintext hljs"># apt-get install logcheck</code> </pre> <br><p>  Imediatamente ap√≥s a instala√ß√£o, ele enviar√° relat√≥rios. </p><br><div class="spoiler">  <b class="spoiler_title">Exemplo de relat√≥rio.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">System Events =-=-=-=-=-=-= Oct 2 02:02:15 nas kernel: [793847.981226] [DROPPED] IN=br-ce OUT= PHYSIN=veth6c2a68e MAC=ff:ff:ff:ff:ff:ff: SRC=172.22.0.11 DST=255.255.255.255 LEN=29 TOS=0x00 PREC=0x00 TTL=64 ID=40170 DF PROTO=UDP SPT=35623 DPT=35622 LEN=9 Oct 2 02:02:20 nas hddtemp[13791]: /dev/sdh: Micron_1100 N #020–Ç: 32 C Oct 2 02:02:37 nas kernel: [793869.247128] [DROPPED] IN=br-7ba OUT= MAC= SRC=172.31.0.1 DST=172.31.255.255 LEN=239 TOS=0x00 PREC=0x00 TTL=128 ID=23017 DF PROTO=UDP SPT=138 DPT=138 LEN=219 Oct 2 02:02:37 nas kernel: [793869.247174] [DROPPED] IN=br-7ba OUT= MAC= SRC=172.31.0.1 DST=172.31.255.255 LEN=232 TOS=0x00 PREC=0x00 TTL=128 ID=23018 DF PROTO=UDP SPT=138 DPT=138 LEN=212 Oct 2 02:02:37 nas kernel: [793869.247195] [DROPPED] IN=br-673 OUT= MAC= SRC=192.168.224.1 DST=192.168.239.255 LEN=239 TOS=0x00 PREC=0x00 TTL=128 ID=8959 DF PROTO=UDP SPT=138 DPT=138 LEN=219 Oct 2 02:02:37 nas kernel: [793869.247203] [DROPPED] IN=br-673 OUT= MAC= SRC=192.168.224.1 DST=192.168.239.255 LEN=232 TOS=0x00 PREC=0x00 TTL=128 ID=8960 DF PROTO=UDP SPT=138 DPT=138 LEN=212 Oct 2 02:02:50 nas hddtemp[13791]: /dev/sdh: Micron_1100 N #020–Ç: 32 C</code> </pre> </div></div><br><p>  Pode-se ver que h√° muito sup√©rfluo, e mais ajustes ser√£o necess√°rios para filtr√°-lo. </p><br><p>  Primeiro, desative hddtemp, que n√£o funciona corretamente devido a caracteres n√£o ASCII no nome do SSD. <br>  Depois de corrigir o arquivo hddtemp, as mensagens pararam de chegar: </p><br><div class="spoiler">  <b class="spoiler_title">/etc/logcheck/ignore.d.server/hddtemp</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">^\w{3} [ :0-9]{11} [._[:alnum:]-]+ hddtemp\[[0-9]+\]: /dev/([hs]d[az]|sg[0-9]):.*[0-9]+.*[CF] ^\w{3} [ :0-9]{11} [._[:alnum:]-]+ hddtemp\[[0-9]+\]: /dev/([hs]d[az]|sg[0-9]):.*drive is sleeping</code> </pre> </div></div><br><p>  Em seguida, √© poss√≠vel ver o que a verifica√ß√£o de log diz estar bloqueando o tr√°fego de broadcast pelo firewall: </p><br><pre> <code class="plaintext hljs">[793869.247128] [DROPPED] IN=br-7ba OUT= MAC= SRC=172.31.0.1 DST=172.31.255.255 LEN=239 TOS=0x00 PREC=0x00 TTL=128 ID=23017 DF PROTO=UDP SPT=138 DPT=138 LEN=219</code> </pre> <br><p>  Portanto, voc√™ precisa habilitar o tr√°fego de broadcast do roteador e dos cont√™ineres: </p><br><ul><li>  Porta 35622 do cont√™iner com urbackup. </li><li>  A porta 5678 do roteador √© a descoberta do vizinho RouterOS.  Pode ser desativado no roteador. </li><li>  A porta 5353 para o endere√ßo 224.0.0.251 √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mDNS</a> . </li></ul><br><p>  Verifique o logcheck: </p><br><pre> <code class="plaintext hljs">sudo -u logcheck logcheck -t -d</code> </pre> <br><p>  Finalmente, os problemas se tornam vis√≠veis: </p><br><pre> <code class="plaintext hljs">Oct 21 21:58:18 nas systemd[1]: Removed slice User Slice of user. Oct 21 21:58:31 nas systemd[1]: smbd.service: Unit cannot be reloaded because it is inactive. Oct 21 21:58:31 nas root: /etc/dhcp/dhclient-enter-hooks.d/samba returned non-zero exit status 1</code> </pre> <br><p>  Acontece que o SAMBA n√£o inicia.  De fato, a an√°lise mostrou que eu o disfarcei atrav√©s do systemctl, e o OMV estava tentando inici√°-lo. </p><br><p>  A verifica√ß√£o de log ainda enviar√° spam para v√°rias mensagens. <br>  Aqui, por exemplo, o zfs-auto-snapshot passou: </p><br><pre> <code class="plaintext hljs">Oct 21 22:00:57 nas zfs-auto-snap: @zfs-auto-snap_frequent-2018-10-21-1900, 16 created, 16 destroyed, 0 warnings.</code> </pre> <br><p>  Para ignorar: </p><br><div class="spoiler">  <b class="spoiler_title">/etc/logcheck/ignore.d.server/zfs-auto-snapshot</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">^\w{3} [ :0-9]{11} [._[:alnum:]-]+ zfs-auto-snap: \@zfs-auto-snap_[[:alnum:]-]+, [0-9]+ created, [0-9]+ destroyed, 0 warnings.$</code> </pre> </div></div><br><p>  O rrdcached tamb√©m est√° em ignorar: </p><br><div class="spoiler">  <b class="spoiler_title">/etc/logcheck/ignore.d.server/rrdcached</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">^\w{3} [ :[:digit:]]{11} [._[:alnum:]-]+ rrdcached\[[0-9]+\]: flushing old values$ ^\w{3} [ :[:digit:]]{11} [._[:alnum:]-]+ rrdcached\[[0-9]+\]: rotating journals$ ^\w{3} [ :[:digit:]]{11} [._[:alnum:]-]+ rrdcached\[[0-9]+\]: started new journal [./[:alnum:]]+$ ^\w{3} [ :[:digit:]]{11} [._[:alnum:]-]+ rrdcached\[[0-9]+\]: removing old journal [./[:alnum:]]+$</code> </pre> </div></div><br><p>  Al√©m disso, √© recomend√°vel remover o zed se ele ainda n√£o for removido: </p><br><div class="spoiler">  <b class="spoiler_title">/etc/logcheck/ignore.d.server/zed</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">^\w{3} [ :0-9]{11} [._[:alnum:]-]+ (/usr/bin/)?zed: .*$ ^\w{3} [ :0-9]{11} [._[:alnum:]-]+ (/usr/bin/)?zed\[[0-9]+\]: .*$</code> </pre> </div></div><br><p>  Bem e assim por diante.  Muitas pessoas pensam que o logcheck √© um utilit√°rio bastante in√∫til. <br>  Isso √© verdade se voc√™ us√°-lo como algo que voc√™ define e esquece. </p><br><p>  No entanto, se voc√™ entender que o logcheck √© apenas um filtro de log personalizado, sem heur√≠sticas, algoritmos m√°gicos e adaptativos, a quest√£o de sua necessidade n√£o surge.  Iterativamente, analisando o que ele envia e, adicionando-o para ignor√°-lo ou corrigi-lo, √© gradualmente poss√≠vel obter relat√≥rios informativos. </p><br><p>  O uso de uma ferramenta automatizada para an√°lise √© muito melhor do que executar os logs pelas mesmas express√µes regulares com as m√£os e, geralmente, melhor do que usar um sistema completo de an√°lise de dados como o Splunk. </p><br><p>  O logcheck e sua configura√ß√£o podem ser lidos no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wiki Gentoo</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </p><br><h2 id="ids-urovnya-uzla">  IDS no n√≠vel do n√≥ </h2><br><p>  Aqui vou me referir ao meu pr√≥prio artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Uma breve an√°lise de solu√ß√µes no campo do SOC e o desenvolvimento de um detector de anomalia de rede neural em redes de transmiss√£o de dados"</a> , no qual existem v√°rios exemplos. </p><br><p>  Voc√™ pode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ler uma</a> revis√£o e compara√ß√£o mais completa de IDS similares <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no Wiki</a> . </p><br><h3 id="stig-4httpswwwstigviewercomstigred_hat_enterprise_linux_6">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">STIG-4</a> </h3><br><p>  Um script complexo e amplo para an√°lise est√°tica de lacunas conhecidas do RedHat. <br>  Existe uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">porta no Debian</a> , que eu recomendo baixar e executar pelo menos uma vez. </p><br><div class="spoiler">  <b class="spoiler_title">Exemplo de Opera√ß√£o STIG-4</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># cd root@nas:~# git clone https://github.com/hardenedlinux/STIG-4-Debian Cloning into 'STIG-4-Debian'... remote: Enumerating objects: 572, done. remote: Total 572 (delta 0), reused 0 (delta 0), pack-reused 572 Receiving objects: 100% (572/572), 634.37 KiB | 0 bytes/s, done. Resolving deltas: 100% (316/316), done. root@nas:~# cd STIG-4-Debian/ root@nas:~/STIG-4-Debian# bash stig-4-debian.sh -H Script Run: Mon Nov 12 23:58:34 MSK 2018 Start checking process... [ FAIL ] The cryptographic hash of system files and commands must match vendor values. ... Pass Count: 54 Failed Count: 137</code> </pre> </div></div><br><p>  O processo de trabalho com esse script √© aproximadamente o seguinte: </p><br><ul><li>  Livre-se do script. </li><li>  Pesquise na Internet todas as linhas com <code>[ FAIL ]</code> . </li><li>  Como regra, ser√° encontrado um link para o banco de dados on-line STIG. </li><li>  Correto, seguindo as instru√ß√µes no banco de dados, fazendo um desconto no fato de ser o Debian. </li><li>  Execute o script novamente. </li></ul><br><h3 id="rkhunterhttprkhuntersourceforgenet">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Rkhunter</a> </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Muito foi</a> escrito sobre o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RkHunter</a> . <br>  Usado por muito tempo, amplamente, ainda em desenvolvimento.  Existe um reposit√≥rio Debian. </p><br><h3 id="tigerhttpswwwnongnuorgtiger">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tigre</a> </h3><br><p>  Um script de shell modular que executa auditoria do sistema e detec√ß√£o de intrus√£o. <br>  √â um pouco semelhante ao STIG-4. <br>  Ele pode usar utilit√°rios de terceiros para analisar logs e detectar viola√ß√µes da soma de verifica√ß√£o. </p><br><p>  Consiste em um grande n√∫mero de m√≥dulos diferentes. </p><br><p>  Por exemplo, existe um m√≥dulo que detecta servi√ßos que usam arquivos exclu√≠dos, o que acontece quando as bibliotecas usadas pelo servi√ßo foram alteradas durante o processo de atualiza√ß√£o do sistema, mas o servi√ßo n√£o foi reiniciado por algum motivo. </p><br><p>  Existem m√≥dulos para pesquisar usu√°rios do servi√ßo que n√£o s√£o mais usados, verificar o sistema por falta de patches de seguran√ßa, verificar umask etc. </p><br><p>  Mais detalhes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em man</a> . </p><br><p>  N√£o est√° em desenvolvimento h√° 10 anos (sim, n√£o sou o √∫nico a abandonar o software). </p><br><h3 id="samhainhttpswwwla-samhnadesamhain">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Samhain</a> </h3><br><p>  HIDS t√≠picos que podem: </p><br><ul><li>  Verifique a integridade de todo o sistema usando hashes criptogr√°ficos. </li><li>  Procure v√°rios execut√°veis ‚Äã‚Äãcom o SUID instalado, que n√£o deve ser instalado. </li><li>  Detecte processos ocultos. </li><li>  Assine logs e bancos de dados. </li></ul><br><p>  Al√©m disso, possui monitoramento centralizado com uma interface da Web e envio centralizado de logs para o servidor. <br>       ,        . <br>       . </p><br><p> ,  ,           . ,  ,    ,    ,         . </p><br><p> -     HIDS:        . <br>     Samhain,      . </p><br><h3 id="tripwirehttpssourceforgenetprojectstripwire"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tripwire</a> </h3><br><p>   ,   Samhain,  Tripwire ‚Äî    . <br>    ,   . </p><br><h3 id="lynishttpscisofycomlynis"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lynis</a> </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  RkHunter</a> . </p><br><p>  ,    . <br>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a>     . <br>   Tiger       ,     ,  . <br>   ,  .    ,       , Lynix    Tripwire. </p><br><h3 id="chkrootkithttpwwwchkrootkitorg"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Chkrootkit</a> </h3><br><p>     .    . <br> : </p><br><ul><li>   ,  . </li><li>       . </li><li> ,     latslog, wtmp  utmp. </li><li>     ,   ,     . </li></ul><br><p>      . </p><br><h3 id="ninjahttpforkbomborgninja"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ninja</a> </h3><br><p>        Linux. </p><br><p>      ninja-build. </p><br><p> ,      .      UID/GID, Ninja      ,         ,    (,     , ). <br>          (, su). <br>   ,     . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  Ubuntu</a> ,     Debian. </p><br><h2 id="skanery-bezopasnosti">   </h2><br><p>       .   .    ,    ,    ,   . <br>       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Nmap</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">W3af</a>  Web-. </p><br><h2 id="sistemy-alternativnyh-modeley-bezopasnosti">     </h2><br><p>  Linux  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> (  )  </a> . <br>      .  ,     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a> . </p><br><p>   ,  ,   ,    . </p><br><p>        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  " Linux"  IBM</a> . </p><br><p>  NAS        ,    AppArmor. <br>  ,       ,     . <br> ,          ,          ,         . </p><br><h3 id="access-control-listshttpsdocsoraclecomcde19253-01820-0836ftyxiindexhtml"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Access Control Lists</a> </h3><br><p>     ,     . <br>  , ZFS       . </p><br><div class="spoiler"> <b class="spoiler_title">   ACL  ZFS.</b> <div class="spoiler_text"><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiss√£o para adicionar um novo arquivo ao diret√≥rio. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiss√£o para criar um subdiret√≥rio em um diret√≥rio. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiss√£o para excluir um arquivo. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiss√£o para excluir um arquivo ou diret√≥rio dentro de um diret√≥rio. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiss√£o para executar um arquivo ou pesquisar o conte√∫do de um diret√≥rio. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiss√£o para listar o conte√∫do do diret√≥rio. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiss√£o para ler ACLs (comando ls). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiss√£o para ler atributos b√°sicos do arquivo (exceto ACLs, atributos no n√≠vel de comando "stat"). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiss√£o para ler o conte√∫do do arquivo. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Permiss√£o para ler atributos de arquivo estendidos ou procurar no diret√≥rio por atributos de arquivo estendidos. </font></font></li><li>           . </li><li>       . </li><li>      ,     ,   . </li><li>       ACL    chmod. </li><li>        .        chown  chgrp . </li><li>           ,     .               PRIV_FILE_CHOWN. </li><li>      ACL   . </li><li>   ACL      . </li><li>   ACL   ,         ,     .     ACL    file_inherit,  dir_inherit   . </li><li>   ACL       ,      . </li></ul></div></div><br><p>  ACL    , ,     ,   .         . </p><br><p>    EXT ,  ZFS  ACL      <code>setfacl/getfacl</code> ,    <code>chmod</code>  <code>ls</code> . </p><br><h3 id="apparmorhttpsgitlabcomapparmorapparmorwikishome"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AppArmor</a> </h3><br><p><img src="https://habrastorage.org/webt/p2/yt/br/p2ytbr0l4cq_ujt9sh_njrh1t7k.jpeg"></p><br><p>         . </p><br><p> ,         ,     <code>exec</code> ,  ,      <code>open</code> , <code>exec</code>  . <br>      ,     . <br> AppArmor ,       . <br>  ,      . <br>     capabilites. </p><br><p>     ,    .       ,   ,      ,   . </p><br><div class="spoiler"> <b class="spoiler_title">     ping.</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#include &lt;tunables/global&gt; profile ping /{usr/,}bin/ping flags=(complain) { #include &lt;abstractions/base&gt; #include &lt;abstractions/consoles&gt; #include &lt;abstractions/nameservice&gt; capability net_raw, capability setuid, network inet raw, network inet6 raw, /{,usr/}bin/ping mixr, /etc/modules.conf r, # Site-specific additions and overrides. See local/README for details. #include &lt;local/bin.ping&gt; }</code> </pre> </div></div><br><p> ,       , ..     . ,  ,           ( <code>local/bin.ping</code> ),    ,     . </p><br><p>     deb-based . <br>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  firejail</a> ,    . </p><br><p>      ,   ,      . </p><br><p>    Debian, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> . </p><br><h3 id="selinuxhttpselinuxprojectorgpagemain_page"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SELinux</a> </h3><br><p> <a href=""><img src="https://habrastorage.org/webt/uk/8e/_4/uk8e_4yzmie_mnhkeak2sxxztem.png" alt="Arquitetura SELinux"></a> </p><br><p>    . <br>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NSA</a> ,      Debian   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> . </p><br><p>   SELinux   " " (type enforcement). </p><br><p>  , , ,      SELinux .      "". </p><br><p> ,    ,   <code>firefox_t</code> . <br> SELinux         ,     . </p><br><p>  Um exemplo: </p><br><pre> <code class="plaintext hljs">allow firefox_t user_home_t : file { read write };</code> </pre> <br><p>     , ,  <code>firefox_t</code>         , ,  <code>user_home_t</code> . </p><br><p>  Um exemplo: </p><br><pre> <code class="plaintext hljs">allow user_t user_home_t:file { create read write unlink };</code> </pre> <br><p>    <code>user_t</code>  , ,       <code>user_home_t</code> .  <code>user_t</code> ,  ,  . </p><br><p> ,      . </p><br><p>     AppArmor -,  ,   ,        . </p><br><div class="spoiler"> <b class="spoiler_title">     SELinux   .</b> <div class="spoiler_text"><ul><li> <strong></strong>  SELinux     Linux.     su  sudo,  SELinux  .   Linux    SELinux ,     1:1,     root. </li><li> <strong></strong> ,   ,   .  " ", "Web-", " ".     ,     <code>object_r</code> . <br>      ,  . </li><li> <strong></strong>  <strong></strong>      .  ‚Äî    ,  . </li><li> <strong></strong>  <strong></strong>     .  ,   ,        . ,     <code>user_u:user_r:user_t</code> ,        <code>user_u:object_r:user_home_t</code> .     : </li></ul><br><pre> <code class="plaintext hljs">user:role:type:range</code> </pre> <br><p>   ‚Äî SELinux user.    ‚Äî   , .  ‚Äî   MLS . </p><br><p> ,     ,  ,  <code>user_home_t.</code> <code>user_home_t</code> ‚Äî  ,         ,     . </p><br><ul><li> <strong> </strong>  <strong> </strong> ,   <code>dir</code>    <code>file</code>     ,    ,    .      ,     . , <code>file</code>     (create),  (read),  (write)   (unlink),   <code>unix_stream_socket object</code> ( UNIX)     (create),   (connect),    (sendto). </li></ul></div></div><br><p>     ,        . <br>     . ,    (,     ),    . </p><br><p> ,   AppArmor,  permissive ,       ,    . <br>       . <br>   ,       ,    AppArmor       . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   SELinux</a>   . <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> . <br>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  IBM</a> . </p><br><h3 id="grsecurityhttpswwwgrsecuritynet"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GrSecurity</a> </h3><br><p>    Debian -  .  ,    ,   . <br> ,   (     ), ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Gentoo</a> .     : hardening <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> . </p><br><p> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   </a> . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  Debian</a>  ,    GrSecurity  PaX. </p><br><h3 id="tomoyohttptomoyoosdnjp"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tomoyo</a> </h3><br><p> Tomoyo  Debian   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> . </p><br><p>        .   AppArmor,   .   2003 . <br>   ,    ,  . <br>    ,    AppArmor,     . </p><br><h2 id="melochi">  </h2><br><p>        <code>/etc/securetty</code>  ,  root       ( ),        . </p><br><p>       PAM,       <code>/etc/security</code> . </p><br><p>    ,  Samhain  Tripwire,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">debsums</a> ,      . </p><br><h2 id="zaklyuchenie">  Conclus√£o </h2><br><p>    .     ,      . </p><br><p>  ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Github </a> ,   . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt421279/">https://habr.com/ru/post/pt421279/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt421267/index.html">Refrigera√ß√£o semi-passiva da fonte de alimenta√ß√£o do computador</a></li>
<li><a href="../pt421269/index.html">O sistema de reconhecimento facial instalado no aeroporto americano ajudou a capturar o atacante</a></li>
<li><a href="../pt421271/index.html">Uma sele√ß√£o de materiais √∫teis no Azure. Parte 2 - cursos</a></li>
<li><a href="../pt421275/index.html">O que eu entendi depois de vender duas startups em 12 meses</a></li>
<li><a href="../pt421277/index.html">Segmenta√ß√£o de imagens de sat√©lite usando o reconhecimento de √°rvores como exemplo</a></li>
<li><a href="../pt421281/index.html">Respostas do suporte t√©cnico da 3CX: instala√ß√£o do seu pr√≥prio logotipo no visor do telefone IP</a></li>
<li><a href="../pt421283/index.html">O livro sobre "Par√°grafo" em Habr√©. Cap√≠tulo Um: O Cientista Watchman</a></li>
<li><a href="../pt421285/index.html">Rastreadores √≥pticos: ASEF e MOSSE</a></li>
<li><a href="../pt421287/index.html">Tijolos da lua de um forno solar</a></li>
<li><a href="../pt421289/index.html">O n√∫mero de carros el√©tricos na R√∫ssia aumentou de 920 para 2500 em um ano e meio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>