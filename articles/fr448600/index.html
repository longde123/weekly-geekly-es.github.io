<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé± üë¶üèΩ üë®üèº‚Äç‚úàÔ∏è Comment Windows 10 Explore une vuln√©rabilit√© critique DHCP d√©tecte deux autres erreurs de s√©curit√© üëí üå´Ô∏è üë≤üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Image: Unsplash 

 Comme d√©crit dans un article pr√©c√©dent sur CVE-2019-0726 , la recherche parfois de d√©tails sur une vuln√©rabilit√© d√©j√† connue condui...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment Windows 10 Explore une vuln√©rabilit√© critique DHCP d√©tecte deux autres erreurs de s√©curit√©</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/448600/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/yp/f9/um/ypf9um_w-o9bemj0w8q9gucekre.png"></a> <br><br>  <i>Image: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Unsplash</a></i> <br><br>  Comme d√©crit dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2019-0726</a> , la recherche parfois de d√©tails sur une vuln√©rabilit√© d√©j√† connue conduit √† la d√©couverte d'une nouvelle vuln√©rabilit√©.  Et dans certains cas, il existe plusieurs de ces nouvelles vuln√©rabilit√©s. <a name="habracut"></a><br><br>  L'article a examin√© deux fonctions de la biblioth√®que dhcpcore.dll: le UpdateDomainSearchOption mentionn√© avec d√©sinvolture et une analyse plus d√©taill√©e du DecodeDomainSearchListData qu'il appelle.  Comme cela se produit toujours lors de la recherche de vuln√©rabilit√©s, m√™me si des conclusions importantes √† la fin se r√©sument √† une ou deux fonctions, dans le processus d'analyse, vous devez examiner une quantit√© de code beaucoup plus importante.  Et parfois, l'≈ìil s'accroche √† des bagatelles qui ne sont pas li√©es √† la t√¢che en cours, mais peuvent avoir une signification ind√©pendante ou √™tre utiles plus tard.  Supposons qu'√† l'heure actuelle, il n'y ait pas de temps pour y pr√™ter attention, mais de telles bagatelles sont report√©es dans le sous-cortex et, si apr√®s un certain laps de temps il y a une opportunit√© de revenir vers eux et de v√©rifier leurs suppositions, ils surgissent √† nouveau dans la conscience. <br><br>  Et c'est arriv√© cette fois.  Lors de l'√©tude de la fonction DhcpExtractFullOptions, qui est responsable du traitement de toutes les options sp√©cifi√©es dans la r√©ponse DHCP du serveur, en particulier, en appelant UpdateDomainSearchOption, deux tableaux sur la pile de 256 √©l√©ments attirent imm√©diatement l'attention: <br><br><img src="https://habrastorage.org/webt/6e/ug/5g/6eug5gck41wlfwrzpfcdkxqr1x0.png"><br><br>  Dans ce cas, la pr√©sence de contr√¥les restreignant les valeurs des it√©rateurs de ces tableaux n'est pas perceptible.  Puisqu'√† ce moment nous analysions une autre vuln√©rabilit√©, ces informations n'√©taient pas pertinentes.  Il ne restait donc qu'√† se souvenir de cette place dans le code pour y revenir plus tard. <br><br><h2>  Analyse </h2><br>  Quelques semaines s'√©coulent et nous rappelons √† nouveau la fonction DhcpExtractFullOptions qui avait attir√© l'attention plus t√¥t.  Nous nous tournons vers lui dans le d√©sassembleur, peignons les morceaux de code pr√©c√©demment incompl√®tement cadr√©s et essayons de comprendre quels sont les deux tableaux statiques qui nous intriguent. <br><br>  Au tout d√©but de l'ex√©cution de la fonction, les tableaux et leurs it√©rateurs sont mis √† z√©ro: <br><br><img src="https://habrastorage.org/webt/9i/cd/y8/9icdy8i_mroton7j0dmxna_qrrs.png"><br><br>  La fonction analyse toutes les options du paquet re√ßu du serveur DHCP, recueille ces informations puis les traite.  De plus, selon les r√©sultats de l'analyse, elle √©crit √©galement l'√©v√©nement correspondant dans le service ETW (Event Tracing for Windows).  C'est dans la journalisation des √©v√©nements que participent les tampons qui nous int√©ressent.  Avec beaucoup d'autres donn√©es, elles sont transf√©r√©es vers la proc√©dure EtwEventWriteTransfer.  Le travail de pr√©paration de toutes les donn√©es pour la journalisation est assez volumineux et n'a pas beaucoup d'importance pour la vuln√©rabilit√© que nous consid√©rons, nous pouvons donc nous passer d'illustrations. <br><br>  Il est plus important de d√©terminer comment ces tampons sont remplis.  Le remplissage se produit dans la boucle d'analyse des options.  Tout d'abord, une fonction avec le nom parlant ParseDhcpv4Option est appel√©e pour l'option actuelle re√ßue pour le traitement, qui remplit les champs de l'objet dhcp_pointers en fonction des donn√©es re√ßues, ou prend note d'une option inconnue lorsqu'elle rencontre un identificateur d'option avec une valeur pour laquelle il n'y a pas de gestionnaire. <br><br><img src="https://habrastorage.org/webt/_w/9h/w1/_w9hw1bnfgfpfsodjisbt9xx4hk.png"><br><br>  Au retour de ParseDhcpv4Option, la valeur d'identifiant de l'option_tag actuelle est √©crite dans l'√©l√©ment suivant du tableau all_tags, le premier des tableaux qui nous int√©resse.  Si la fonction a rencontr√© une option inconnue et, par cons√©quent, n'a pas d√©fini l'indicateur is_known_option, la valeur d'identificateur est √©galement √©crite dans l'√©l√©ment suivant du deuxi√®me tableau - unknown_tags.  Naturellement, les noms significatifs des variables dans cet article ont d√©j√† √©t√© obtenus en analysant le code. <br><br>  Ainsi, le tableau all_tags stocke les balises de toutes les options du message re√ßu et le tableau unknown_tags ne stocke les balises que pour les options inconnues de l'analyseur.  Dans le m√™me temps, la v√©rification des valeurs des indices de ces tableaux est totalement absente.  Par cons√©quent, les valeurs de ces indices peuvent d√©passer 256 et conduire √† l'√©criture au-del√† des limites allou√©es sur la pile pour les matrices de m√©moire.  Pour surcharger le premier tableau, il suffit d'envoyer un paquet avec un nombre d'options sup√©rieur √† 256 √† partir du serveur DHCP. Il en va de m√™me pour le deuxi√®me tableau, la seule diff√©rence √©tant que les options que le client ne peut pas traiter doivent √™tre envoy√©es. <br><br><h2>  Fonctionnement </h2><br>  Essayons maintenant d'utiliser un exemple pratique pour nous assurer que nos conclusions sont correctes.  Pour commencer, nous pr√™tons attention au fait que les balises d'option occupent un octet, tandis que les √©l√©ments de tableau sont de type int, c'est-√†-dire qu'ils sont de quatre octets.  Ainsi, nous avons un d√©bordement dans lequel nous contr√¥lons tous les quatre octets, et le reste est remis √† z√©ro lors de l'√©crasement. <br><br><img src="https://habrastorage.org/webt/bi/ww/vy/biwwvyyk6c-1mnlqz7l_mrgb3pi.png"><br><br>  Pour tester notre hypoth√®se, le moyen le plus simple est d'√©craser le cookie de s√©curit√© sur la fonction en question, ce qui d√©clenchera une exception li√©e au contr√¥le de s√©curit√©.  Simulons une situation dans laquelle le serveur DHCP envoie un nombre suffisant d'options de r√©√©criture.  Que ce soit des options 0x1a0 (416) avec l'identifiant 0xaa et une taille nulle.  Ainsi, chaque option prend deux octets, et la taille totale des paquets avec tous les en-t√™tes est de 1100-1200 octets.  Cette valeur se trouve dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MTU</a> pour Ethernet, par cons√©quent, il y a des raisons de croire que le message ne sera pas fragment√©, ce qui nous permettra d'√©viter d'√©ventuels effets n√©gatifs. <br><br>  Nous envoyons le paquet form√© de la mani√®re d√©crite en r√©ponse √† une demande du client DHCP et interceptons l'exception dans le processus svchost.exe correspondant sur la machine cliente: <br><br><img src="https://habrastorage.org/webt/yt/n_/sg/ytn_sgcs4d4e-1yvzebztfcpb1a.png"><br><br>  Comme vous pouvez le voir sur la trace de la pile, le cookie de pile et l'adresse de retour de la fonction ont √©t√© r√©√©crits par les identifiants des options de notre package. <br><br>  Bien s√ªr, la cr√©ation d'un exploit fonctionnel pour cette erreur n√©cessitera beaucoup d'efforts de la part de l'attaquant.  Sur les syst√®mes modernes, le d√©bordement de tampon sur la pile est une vuln√©rabilit√© assez complexe et exigeante en main-d'≈ìuvre en raison de tous les m√©canismes de d√©fense existants.  D'un autre c√¥t√©, il ne faut pas oublier que tous ces m√©canismes prot√®gent contre l'√©crasement de l'adresse de retour et des gestionnaires d'exceptions, ou interdisent l'ex√©cution de code dans des r√©gions de m√©moire non pr√©vues √† cet effet, ou interf√®rent avec la pr√©diction d'adresse.  Par exemple, ils ne peuvent en aucun cas emp√™cher d'√©craser ceux stock√©s sur la pile entre le tampon d√©bord√© et l'adresse de retour des variables locales.  Et la fonction DhcpExtractFullOptions en question contient plusieurs variables potentiellement dangereuses dans cet intervalle. <br><br>  Encore une fois, nous √©crivons √† Microsoft sur l'erreur d√©tect√©e.  Apr√®s une courte correspondance et une analyse de l'application, qui ont pris environ une semaine, nous obtenons la r√©ponse qu'un identifiant CVE est en cours de pr√©paration pour la vuln√©rabilit√© d√©crite, un correctif est pr√©vu pour une publication en mars et des informations sur la vuln√©rabilit√© sont d√©j√† disponibles chez Microsoft, a √©t√© signal√©e par quelqu'un plus t√¥t.  Le fait, d'une mani√®re g√©n√©rale, n'est pas surprenant, car l'erreur se trouve litt√©ralement √† la surface, et les tampons qui ne contiennent pas de v√©rification des limites des indices attirent toujours l'attention en premier et peuvent souvent √™tre d√©tect√©s par des outils d'analyse automatiques. <br><br>  En mars, comme annonc√©, une mise √† jour a √©t√© publi√©e pour corriger l'erreur d√©crite, qui a re√ßu l'identifiant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2019-0697</a> .  Le chercheur qui a rapport√© les informations plus t√¥t √©tait Mitch Adair, le m√™me employ√© de Microsoft qui a d√©couvert la vuln√©rabilit√© DHCP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2019-0547</a> corrig√©e en janvier. <br><br>  <b>Publi√© par</b> Mikhail Tsvetkov, sp√©cialiste en analyse d'application des technologies positives. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448600/">https://habr.com/ru/post/fr448600/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448584/index.html">7 erreurs courantes lors de l'utilisation de pr√©positions en anglais et comment les √©viter</a></li>
<li><a href="../fr448588/index.html">L'architecture de l'√©quilibreur de charge r√©seau dans Yandex.Cloud</a></li>
<li><a href="../fr448590/index.html">Des inconnus familiers ou encore une fois sur l'utilisation de mod√®les de conception</a></li>
<li><a href="../fr448594/index.html">Antivirus et pare-feu gratuits (UTM, NGFW) de Sophos</a></li>
<li><a href="../fr448596/index.html">Porte-tablette sur tapis roulant ou recherchez des √©tapes gratuites</a></li>
<li><a href="../fr448602/index.html">La surveillance est-elle morte? - Surveillance longue dur√©e</a></li>
<li><a href="../fr448606/index.html">Sidorin: KnowledgeConf est sur la fa√ßon de maintenir les connaissances avec une dur√©e moyenne de travail en un seul endroit en 2-3 ans</a></li>
<li><a href="../fr448608/index.html">Comment faire les premiers pas en robotique?</a></li>
<li><a href="../fr448610/index.html">DIY: Comment nous avons cr√©√© un programme en direct pour Codefest X</a></li>
<li><a href="../fr448612/index.html">Ce qui a √©t√© gel√© au gel des fonctionnalit√©s 2019. Partie I. JSONPath</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>