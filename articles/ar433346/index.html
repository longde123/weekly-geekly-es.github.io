<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ โ๏ธ ๐ ุงูุชุจุฏูู ูู Redshift ุฅูู ClickHouse ๐๐ฟ ๐๐พ ๐ฅ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ููุชุฑุฉ ุทูููุฉ ุ ุงุณุชุฎุฏู iFunny Redshift ููุงุนุฏุฉ ุจูุงูุงุช ููุฃุญุฏุงุซ ุงูุชู ุชุญุฏุซ ูู ุงูุฎุฏูุงุช ุงูุฎูููุฉ ูุชุทุจููุงุช ุงูุฃุฌูุฒุฉ ุงููุญูููุฉ. ุชู ุงุฎุชูุงุฑู ูุฃูู ูู ููุช ุงูุชูููุฐ ุ ุฅู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูุชุจุฏูู ูู Redshift ุฅูู ClickHouse</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/433346/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/s8/xo/0d/s8xo0dnodxojhff6jufnruyg660.jpeg"><br><br>  ููุชุฑุฉ ุทูููุฉ ุ ุงุณุชุฎุฏู iFunny Redshift ููุงุนุฏุฉ ุจูุงูุงุช ููุฃุญุฏุงุซ ุงูุชู ุชุญุฏุซ ูู ุงูุฎุฏูุงุช ุงูุฎูููุฉ ูุชุทุจููุงุช ุงูุฃุฌูุฒุฉ ุงููุญูููุฉ.  ุชู ุงุฎุชูุงุฑู ูุฃูู ูู ููุช ุงูุชูููุฐ ุ ุฅูู ุญุฏ ูุจูุฑ ุ ูู ุชูู ููุงู ุจุฏุงุฆู ูุงุจูุฉ ููููุงุฑูุฉ ูู ุงูุชูููุฉ ูุงูุฑุงุญุฉ. <br><br>  ููุน ุฐูู ุ ุชุบูุฑ ูู ุดูุก ุจุนุฏ ุงูุฅุตุฏุงุฑ ุงูุนุงู ูู ClickHouse.  ููุฏ ุฏุฑุณูุงูุง ููุชุฑุฉ ุทูููุฉ ุ ููุงุฑูุฉู ุจุงูุชูููุฉ ุ ูุชุธุงูุฑูุง ุจุฃููุง ุจููุฉ ุชูุฑูุจูุฉ ุ ูุฃุฎูุฑุงู ุ ูุฑุฑูุง ูุฐุง ุงูุตูู ุฃู ูุฑู ูุฏู ูุงุฆุฏุฉ ุฐูู ุจุงููุณุจุฉ ููุง.  ูู ูุฐู ุงูููุงูุฉ ุ ุณูู ุชุชุนูู ุนู ุงููุดููุฉ ุงูุชู ุณุงุนุฏูุง Redshift ูู ุญููุง ุ ูููู ููููุง ูุฐุง ุงูุญู ุฅูู ClickHouse. <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  ุงููุดููุฉ </h2><br>  ุงุญุชุงุฌ iFunny ุฅูู ุฎุฏูุฉ ูุดุงุจูุฉ ูู Yandex.Metrica ุ ูููู ุญุตุฑููุง ููุงุณุชููุงู ุงููุญูู.  ุณุงูุถุญ ููุงุฐุง. <br><br>  ุนููุงุก ุงูุฎุงุฑุฌูุฉ ูุชุงุจุฉ ุงูุฃุญุฏุงุซ.  ูููู ุฃู ูููู ุชุทุจููุงุช ุงููุญููู ุ ูุงูููุงูุน ุงูุฅููุชุฑูููุฉ ุฃู ุฎุฏูุงุช ุงููุงุฌูุฉ ุงูุฎูููุฉ ุงูุฏุงุฎููุฉ.  ูุตุนุจ ุนูู ูุคูุงุก ุงูุนููุงุก ุชูุถูุญ ุฃู ุฎุฏูุฉ ุงุณุชูุจุงู ุงูุฃุญุฏุงุซ ุบูุฑ ูุชุงุญุฉ ุญุงูููุง ุ "ุญุงูู ุฅุฑุณุงููุง ูู ุบุถูู 15 ุฏูููุฉ ุฃู ูู ุณุงุนุฉ".  ููุงู ุงูุนุฏูุฏ ูู ุงูุนููุงุก ุ ูุฑุบุจูู ูู ุฅุฑุณุงู ุงูุฃุญุฏุงุซ ุทูุงู ุงูููุช ููุง ูููููู ุงูุงูุชุธุงุฑ ุนูู ุงูุฅุทูุงู. <br><br>  ุนูู ุนูุณ ูุฐู ุงูุฎุฏูุงุช ุ ููุงู ุฎุฏูุงุช ุฏุงุฎููุฉ ููุณุชุฎุฏููู ูุชุณุงูุญูู ููุบุงูุฉ ูู ูุฐุง ุงูุตุฏุฏ: ูููููู ุงูุนูู ุจุดูู ุตุญูุญ ุญุชู ูุน ุฎุฏูุฉ ุชุญูููุงุช ูุชุนุฐุฑ ุงููุตูู ุฅูููุง.  ููุนุธู ููุงููุณ ุงูููุชุฌ ููุชุงุฆุฌ ุงุฎุชุจุงุฑุงุช A / B ููุทููุฉ ุนููููุง ูููุดุงูุฏุฉ ูุฑุฉ ูุงุญุฏุฉ ููุท ูููููุง ุ ุฃู ุฑุจูุง ุฃูู ูู ุฐูู ูุซูุฑูุง.  ูุฐูู ุ ูุชุทูุจุงุช ุงููุฑุงุกุฉ ููุฎูุถุฉ ููุบุงูุฉ.  ูู ุญุงูุฉ ูููุน ุญุงุฏุซ ุฃู ุชุญุฏูุซ ุ ูููููุง ุชุญูู ุตุนูุจุฉ ุงููุตูู ุฃู ุนุฏู ุงูุงุชุณุงู ูู ุงููุฑุงุกุฉ ูุนุฏุฉ ุณุงุนุงุช ุฃู ุญุชู ุฃูุงู (ูู ุญุงูุฉ ููููุฉ ุจุดูู ุฎุงุต). <br><br>  ุฅุฐุง ุชุญุฏุซูุง ุนู ุงูุฃุฑูุงู ุ ูุนูููุง ุฃู ูุฃุฎุฐ ุญูุงูู ุฎูุณุฉ ูููุงุฑุงุช ุญุฏุซ (300 ุฌูุฌุงุจุงูุช ูู ุงูุจูุงูุงุช ุงููุถุบูุทุฉ) ูููููุง ุ ุจูููุง ูููู ุจุชุฎุฒูู ุงูุจูุงูุงุช ููุฏุฉ ุซูุงุซุฉ ุฃุดูุฑ ูู ุดูู "ุณุงุฎู" ุ ูููู ุงููุตูู ุฅููู ูุงุณุชุนูุงูุงุช SQL ุ ููู "ุจุงุฑุฏ" ููุฏุฉ ุนุงููู ุฃู ุฃูุซุฑ ุ ูููู ุญุชู ูู ุบุถูู ุจุถุนุฉ ุฃูุงู ูููููุง ุชุญููููุง ุฅูู "ุญุงุฑ". <br><br>  ูู ุงูุฃุณุงุณ ุ ุงูุจูุงูุงุช ูู ูุฌููุนุฉ ูู ุงูุฃุญุฏุงุซ ูุฑุชุจุฉ ุญุณุจ ุงูููุช.  ููุงู ุญูุงูู ุซูุงุซูุงุฆุฉ ููุน ูู ุงูุฃุญุฏุงุซ ุ ูููู ูููุง ูุฌููุนุฉ ุงูุฎุตุงุฆุต ุงูุฎุงุตุฉ ุจู.  ูุง ุชุฒุงู ููุงู ุจุนุถ ุงูุจูุงูุงุช ูู ูุตุงุฏุฑ ุงูุฌูุงุช ุงูุฎุงุฑุฌูุฉ ุงูุชู ูุฌุจ ูุฒุงููุชูุง ูุน ูุงุนุฏุฉ ุจูุงูุงุช ุงูุชุญูููุงุช: ุนูู ุณุจูู ุงููุซุงู ุ ูุฌููุนุฉ ูู ุนูููุงุช ุชุซุจูุช ุงูุชุทุจูู ูู MongoDB ุฃู ุฎุฏูุฉ AppsFlyer ุฎุงุฑุฌูุฉ. <br><br>  ุงุชุถุญ ุฃููุง ุจุญุงุฌุฉ ุฅูู ุญูุงูู 40 ุชูุฑุงุจุงูุช ูู ุงููุฑุต ููุงุนุฏุฉ ุงูุจูุงูุงุช ุ ูุญูุงูู 250 ุชูุฑุงุจุงูุช ููุชุฎุฒูู "ุงูุจุงุฑุฏ". <br><br><h2 style=";text-align:right;direction:rtl">  Redshift ุงูุญู </h2><br><img src="https://habrastorage.org/webt/f0/nq/dl/f0nqdl7cvriq9ygc3jlhelfdlqi.png"><br><br>  ูุฐูู ุ ููุงู ุนููุงุก ูุชููููู ูุฎุฏูุงุช ุฎูููุฉ ุชุญุชุงุฌ ุฅูู ุชููู ุงูุฃุญุฏุงุซ ูููุง.  ุชูุจู ุฎุฏูุฉ HTTP ุงูุจูุงูุงุช ุ ูุชุฌุฑู ุงูุญุฏ ุงูุฃุฏูู ูู ุงูุชุญูู ูู ุงูุตุญุฉ ุ ูุชุฌูุน ุงูุฃุญุฏุงุซ ุนูู ุงููุฑุต ุงููุญูู ูู ูููุงุช ูุฌูุนุฉ ููุฏุฉ ุฏูููุฉ ูุงุญุฏุฉ ุ ูุชุถุบุทูุง ุนูู ุงูููุฑ ูุชุฑุณููุง ุฅูู ุฏูู S3.  ูุนุชูุฏ ูุฏู ุชููุฑ ูุฐู ุงูุฎุฏูุฉ ุนูู ูุฏู ุชููุฑ ุงูุฎูุงุฏู ูุน ุงูุชุทุจูู ู AWS S3.  ูุง ุชุฎุฒู ุงูุชุทุจููุงุช ุงูุญุงูุฉ ุ ูุฐุง ููู ูุชูุงุฒูุฉ ุจุณูููุฉ ุ ููููุงุณุฉ ููุชุจุงุฏูุฉ.  S3 ูู ุฎุฏูุฉ ุชุฎุฒูู ูููุงุช ุจุณูุทุฉ ูุณุจููุง ูุชุชูุชุน ุจุณูุนุฉ ุฌูุฏุฉ ูุชูุงูุฑ ุ ูุฐุง ููููู ุงูุงุนุชูุงุฏ ุนูููุง. <br><br>  ุจุนุฏ ุฐูู ุ ุชุญุชุงุฌ ุฅูู ุชุณููู ุงูุจูุงูุงุช ุจุทุฑููุฉ ูุง ุฅูู Redshift.  ูู ุดูุก ุจุณูุท ููุบุงูุฉ ููุง: ูุฏู Redshift ูุณุชูุฑุฏ S3 ูุถูู ุ ููู ุงูุทุฑููุฉ ุงูููุตู ุจูุง ูุชุญููู ุงูุจูุงูุงุช.  ูุฐูู ุ ูุฑุฉ ูุงุญุฏุฉ ูู 10 ุฏูุงุฆู ุ ูุจุฏุฃ ุงูุจุฑูุงูุฌ ุงููุตู ุงูุฐู ูุชุตู ุจู Redshift ููุทูุจ ููู ุชูุฒูู ุงูุจูุงูุงุช ุจุงุณุชุฎุฏุงู ุจุงุฏุฆุฉ <code>s3://events-bucket/main/year=2018/month=10/day=14/10_3*</code> <br><br>  ูู ุฃุฌู ูุฑุงูุจุฉ ุญุงูุฉ ูููุฉ ุงูุชูุฒูู ุ ูุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Apache Airflow</a> : ููู ูุชูุญ ูู ุชูุฑุงุฑ ุงูุนูููุฉ ูู ุญุงูุฉ ูุฌูุฏ ุฃุฎุทุงุก ูุณุฌู ูุญููุธ ููุชูููุฐ ุ ููู ุฃูุฑ ููู ุจุงููุณุจุฉ ูุนุฏุฏ ูุจูุฑ ูู ูุฐู ุงูููุงู.  ููู ุญุงูุฉ ุญุฏูุซ ูุดุงูู ุ ููููู ุชูุฑุงุฑ ุงูุชูุฒูู ูููุงุตู ุฒูููุฉ ุฃู ุชูุฒูู ุงูุจูุงูุงุช "ุงูุจุงุฑุฏุฉ" ูู S3 ูุจู ุนุงู. <br><br>  ูู ููุณ Airflow ุ ุจุงูุทุฑููุฉ ููุณูุง ุ ููููุง ููุฌุฏูู ุงูุฒููู ุ ุชุนูู ุงูุจุฑุงูุฌ ุงููุตูุฉ ุงูุชู ุชุชุตู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูุชููู ุจุชูุฒููุงุช ุฏูุฑูุฉ ูู ุงููุณุชูุฏุนุงุช ุงูุฎุงุฑุฌูุฉ ุ ุฃู ุชูุดุฆ ูุฌููุนุงุช ูู ุงูุฃุญุฏุงุซ ูู ุดูู <code>INSERT INTO ... SELECT ...</code> <br><br>  ูุฏู Redshift ุถูุงูุงุช ุชููุฑ ุถุนููุฉ.  ูุฑุฉ ูุงุญุฏุฉ ูู ุงูุฃุณุจูุน ุ ููุฏุฉ ุชุตู ุฅูู ูุตู ุณุงุนุฉ (ุชู ุชุญุฏูุฏ ุฅุทุงุฑ ุงูููุช ูู ุงูุฅุนุฏุงุฏุงุช) ูููู ูู AWS ุฅููุงู ุงููุชูุฉ ูู ุงูุชุญุฏูุซ ุฃู ุฃู ุนูู ูุฌุฏููุฉ ุขุฎุฑ.  ูู ุญุงูุฉ ุญุฏูุซ ูุดู ุนูู ุนูุฏุฉ ูุงุญุฏุฉ ุ ุชุตุจุญ ุงููุชูุฉ ุบูุฑ ูุชููุฑุฉ ุญุชู ุชุชู ุงุณุชุนุงุฏุฉ ุงููุถูู.  ูุฐุง ูุณุชุบุฑู ุนุงุฏุฉ ุญูุงูู 15 ุฏูููุฉ ููุญุฏุซ ูุฑุฉ ูุงุญุฏุฉ ูู ุณุชุฉ ุฃุดูุฑ.  ูู ุงููุธุงู ุงูุญุงูู ุ ูุฐู ููุณุช ูุดููุฉ ุ ููุฏ ุชู ุชุตููููุง ูู ุงูุฃุตู ูุชููู ุงููุงุนุฏุฉ ุบูุฑ ูุชููุฑุฉ ุจุดูู ุฏูุฑู. <br><br>  ุชุญุช Redshift ุ ุชู ุงุณุชุฎุฏุงู 4 ูุซููุงุช ds2.8xlarge (36 ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ ุ 16 ุชูุฑุงุจุงูุช HDD) ุ ูุงูุชู ุชุนุทููุง ูู ุงููุฌููุน 64 ุชูุฑุงุจุงูุช ูู ูุณุงุญุฉ ุงููุฑุต. <br><br>  ุงูููุทุฉ ุงูุฃุฎูุฑุฉ ูู ุงููุณุฎ ุงูุงุญุชูุงุทู.  ูููู ุชุญุฏูุฏ ุฌุฏูู ุงููุณุฎ ุงูุงุญุชูุงุทู ูู ุฅุนุฏุงุฏุงุช ุงููุชูุฉ ุ ููุนูู ุจุดูู ุฌูุฏ. <br><br><h2 style=";text-align:right;direction:rtl">  ClickHouse ุงูุงูุชูุงู ุงูุฏุงูุน </h2><br>  ุจุงูุทุจุน ุ ุฅุฐุง ูู ุชูู ููุงู ูุดุงูู ุ ููู ูููุฑ ุฃุญุฏ ูู ุงูุชุฑุญูู ุฅูู ClickHouse.  ููุน ุฐูู ุ ูุงููุง ูุฐูู. <br><br>  ุฅุฐุง ูุธุฑุช ุฅูู ูุธุงู ุงูุชุฎุฒูู ClickHouse ุจุงุณุชุฎุฏุงู ูุญุฑู MergeTree ู Redshift ุ ููููู ุฃู ุชุฑู ุฃู ุฃูุฏููููุฌูุชูุง ูุชุดุงุจูุฉ ููุบุงูุฉ.  ููุง ููุงุนุฏ ุงูุจูุงูุงุช ุนููุฏูุฉ ุ ุชุนูู ุจุดูู ุฌูุฏ ูุน ุนุฏุฏ ูุจูุฑ ูู ุงูุฃุนูุฏุฉ ูุถุบุท ุงูุจูุงูุงุช ุนูู ุงููุฑุต ุจุดูู ุฌูุฏ ููุบุงูุฉ (ููู Redshift ููููู ุชูููู ุฃููุงุน ุงูุถุบุท ููู ุนููุฏ ุนูู ุญุฏุฉ).  ุญุชู ูุชู ุชุฎุฒูู ุงูุจูุงูุงุช ุจุงูุทุฑููุฉ ููุณูุง: ูุชู ูุฑุฒูุง ุญุณุจ ุงูููุชุงุญ ุงูุฃุณุงุณู ุ ููุง ูุชูุญ ูู ูุฑุงุกุฉ ูุชู ูุญุฏุฏุฉ ููุท ูุนุฏู ุงูุงุญุชูุงุธ ุจููุงุฑุณ ูุฑุฏูุฉ ูู ุงูุฐุงูุฑุฉ ุ ููุฐุง ุฃูุฑ ููู ุนูุฏ ุงูุนูู ุจูููุงุช ูุจูุฑุฉ ูู ุงูุจูุงูุงุช. <br><br>  ุงููุฑู ุงูุฃุณุงุณู ุ ููุง ูู ุงูุญุงู ุฏุงุฆูุง ุ ูู ูู ุงูุชูุงุตูู. <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุฌุฏูู ุงููููู </h3><br>  ูุญุฏุซ ูุฑุฒ ุงูุจูุงูุงุช ุนูู ุงููุฑุต ูุญุฐููุง ูุนูููุง ูู Redshift ุนูุฏ ุงูููุงู ุจูุง ููู: <pre style=";text-align:right;direction:rtl"> <code class="xml hljs">VACUUM <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tablename</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  ูู ูุฐู ุงูุญุงูุฉ ุ ุชุนูู ุนูููุฉ ุงููุฑุงุบ ูุน ุฌููุน ุงูุจูุงูุงุช ูู ูุฐุง ุงูุฌุฏูู.  ุฅุฐุง ููุช ุจุชุฎุฒูู ุงูุจูุงูุงุช ููุฏุฉ ุซูุงุซุฉ ุฃุดูุฑ ูู ุฌุฏูู ูุงุญุฏ ุ ูุฅู ูุฐู ุงูุนูููุฉ ุชุณุชุบุฑู ููุชูุง ุบูุฑ ูุงุฆู ุ ูุชุญุชุงุฌ ุฅูู ุงูููุงู ุจูุง ูููููุง ุนูู ุงูุฃูู ุ ูุฃูู ูุชู ุญุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ ูุฅุถุงูุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ.  ุงุถุทุฑุฑุช ุฅูู ุฅูุดุงุก ุฌุฏุงูู ูููุตูุฉ ูู ููู ูุฏูุฌูุง ูู ุฎูุงู ุทุฑููุฉ ุงูุนุฑุถ ุ ููุฐุง ููุณ ููุท ุตุนูุจุฉ ูู ุชุฏููุฑ ูุฏุนู ูุฐุง ุงูุนุฑุถ ุ ูููู ุฃูุถูุง ุฅุจุทุงุก ุงูุงุณุชุนูุงูุงุช.  ุจูุงุกู ุนูู ุงูุทูุจ ุ ููููุง ููุดุฑุญ ุ ุชู ูุญุต ุฌููุน ุงูุฌุฏุงูู.  ูุนูู ุงูุฑุบู ูู ุฃู ุงููุณุญ ุงูุถูุฆู ูุฌุฏูู ูุงุญุฏ ูุณุชุบุฑู ุฃูู ูู ุซุงููุฉ ูุงุญุฏุฉ ุ ูุน ูููุฉ 90 ูุทุนุฉ ุ ูุชุจูู ุฃู ุฃู ุงุณุชุนูุงู ูุณุชุบุฑู ุฏูููุฉ ุนูู ุงูุฃูู.  ูุฐู ููุณุช ูุฑูุญุฉ ููุบุงูุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุชูุฑุงุฑุงุช </h3><br>  ุงููุดููุฉ ุงูุชุงููุฉ ูู ุงูุชูุฑุงุฑุงุช.  ุจุทุฑููุฉ ุฃู ุจุฃุฎุฑู ุ ุนูุฏ ููู ุงูุจูุงูุงุช ุนุจุฑ ุดุจูุฉ ุ ููุงู ุฎูุงุฑุงู: ุฅูุง ููุฏุงู ุงูุจูุงูุงุช ุฃู ุชููู ุงูุชูุฑุงุฑุงุช.  ูู ูุชููู ูู ููุฏ ุงูุฑุณุงุฆู ุ ูุฐุง ููุฏ ุชุตุงูุญูุง ูุน ุญูููุฉ ุฃู ูุณุจุฉ ูุฆููุฉ ุตุบูุฑุฉ ูู ุงูุฃุญุฏุงุซ ุณูู ุชุชูุฑุฑ.  ููููู ุญุฐู ุงูุชูุฑุงุฑุงุช ูููููุง ุนู ุทุฑูู ุฅูุดุงุก ุฌุฏูู ุฌุฏูุฏ ุ ูุฅุฏุฑุงุฌ ุงูุจูุงูุงุช ูู ุงูุฌุฏูู ุงููุฏูู ููู ุ ุญูุซ ูุชู ุญุฐู ุตููู ูุธููุฉ ุงููุงูุฐุฉ ุฐุงุช ุงููุนุฑูู ุงูููุฑุฑ ุ ููุชู ุญุฐู ุงูุฌุฏูู ุงููุฏูู ูุฅุนุงุฏุฉ ุชุณููุฉ ุงูุฌุฏูู ุงูุฌุฏูุฏ.  ูุธุฑูุง ููุฌูุฏ ุทุฑููุฉ ุนุฑุถ ุฃุนูู ุงูุฌุฏุงูู ุงูููููุฉ ุ ูุงู ูู ุงูุถุฑูุฑู ุนุฏู ูุณูุงููุง ูุญุฐููุง ููุช ุฅุนุงุฏุฉ ุชุณููุฉ ุงูุฌุฏุงูู.  ูู ูุฐู ุงูุญุงูุฉ ุ ูุงู ูู ุงูุถุฑูุฑู ุฃูุถูุง ูุฑุงูุจุฉ ุงูุฃููุงู ุ ูุฅูุง ุ ูู ุญุงูุฉ ูุฌูุฏ ุงุณุชุนูุงู ูุญุธุฑ ุทุฑููุฉ ุงูุนุฑุถ ุฃู ุฃุญุฏ ุงูุฌุฏุงูู ุ ูููู ุฃู ุชุณุชูุฑ ูุฐู ุงูุนูููุฉ ููุชุฑุฉ ุทูููุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุฑุตุฏ ูุงูุตูุงูุฉ </h3><br>  ูุง ููุฌุฏ ุทูุจ ูุงุญุฏ ูู Redshift ูุณุชุบุฑู ุฃูู ูู ุซุงููุชูู.  ุญุชู ุฅุฐุง ููุช ุชุฑุบุจ ููุท ูู ุฅุถุงูุฉ ูุณุชุฎุฏู ุฃู ุงูุงุทูุงุน ุนูู ูุงุฆูุฉ ุจุงูุทูุจุงุช ุงููุดุทุฉ ุ ูุณูุชุนูู ุนููู ุงูุงูุชุธุงุฑ ุจุถุน ุนุดุฑุงุช ูู ุงูุซูุงูู.  ุจุงูุทุจุน ุ ููููู ุฃู ุชุชุณุงูุญ ูุน ูุฐุง ุงูููุน ูู ููุงุนุฏ ุงูุจูุงูุงุช ููุฐุง ููุจูู ุ ูููู ูู ุงูููุงูุฉ ูุชุฑุฌู ุฅูู ูุฌููุนุฉ ูู ุงูููุช ุงูุถุงุฆุน. <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุชูููุฉ </h3><br>  ููููุง ูุญุณุงุจุงุชูุง ุ ูุฅู ูุดุฑ ClickHouse ุนูู ูุซููุงุช AWS ุจููุณ ุงูููุงุฑุฏ ุจุงูุถุจุท ูู ูุตู ุงูุณุนุฑ ุชูุงููุง.  ุจุงูุทุจุน ุ ูุฌุจ ุฃู ูููู ุงูุฃูุฑ ูุฐูู ุ ูุฃูู ุจุงุณุชุฎุฏุงู Redshift ุ ููููู ุงูุญุตูู ุนูู ูุงุนุฏุฉ ุจูุงูุงุช ุฌุงูุฒุฉ ููููู ุงูุงุชุตุงู ุจูุง ูุน ุฃู ุนููู PostgreSQL ูุจุงุดุฑุฉ ุจุนุฏ ุงูููุฑ ุนูู ุงุซููู ูู ุงูุฃุฒุฑุงุฑ ูู ูุญุฏุฉ AWS ุ ูุณูู ุชููู AWS ุจุงูุจุงูู ูู.  ูููู ูู ูุณุชุญู ูู ูุฐุง ุงูุนูุงุกุ  ูุฏููุง ุจุงููุนู ุงูุจููุฉ ุงูุชุญุชูุฉ ุ ููุจุฏู ุฃููุง ูุงุฏุฑูู ุนูู ุนูู ูุณุฎ ุงุญุชูุงุทูุฉ ููุฑุงูุจุฉ ูุชูููู ุ ููุญู ููุนู ุฐูู ููุฌููุนุฉ ูู ุงูุฎุฏูุงุช ุงูุฏุงุฎููุฉ.  ููุงุฐุง ูุง ุชุนุงูุฌ ุฏุนู ClickHouseุ <br><br><h2 style=";text-align:right;direction:rtl">  ุนูููุฉ ุงูุงูุชูุงู </h2><br>  ุฃููุงู ุ ูููุง ุจุฑูุน ุชุซุจูุช ClickHouse ุตุบูุฑ ูู ุฌูุงุฒ ูุงุญุฏ ุ ุญูุซ ุจุฏุฃูุง ุจุดูู ุฏูุฑู ุ ุจุงุณุชุฎุฏุงู ุงูุฃุฏูุงุช ุงููุฏูุฌุฉ ุ ุชูุฒูู ุงูุจูุงูุงุช ูู S3.  ูุจุงูุชุงูู ุ ุชูููุง ูู ุงุฎุชุจุงุฑ ุงูุชุฑุงุถุงุชูุง ุญูู ุณุฑุนุฉ ููุฏุฑุงุช ClickHouse. <br><br>  ุจุนุฏ ุฃุณุจูุนูู ูู ุงูุงุฎุชุจุงุฑ ุนูู ูุณุฎุฉ ุตุบูุฑุฉ ูู ุงูุจูุงูุงุช ุ ุฃุตุจุญ ูู ุงููุงุถุญ ุฃูู ูุงุณุชุจุฏุงู Redshift ุจู Clickhouse ุ ูุฌุจ ุญู ุงูุนุฏูุฏ ูู ุงููุดููุงุช: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุง ุฃููุงุน ุงูุญุงูุงุช ูุงูุฃูุฑุงุต ุงูุชู ุณูุชู ูุดุฑูุง ุ </li><li style=";text-align:right;direction:rtl">  ูุงุณุชุฎุฏุงู ุงููุณุฎ ุงููุชูุงุซูุ </li><li style=";text-align:right;direction:rtl">  ููููุฉ ุชุฑููุจ ูุชูููู ูุชุดุบูู ุ </li><li style=";text-align:right;direction:rtl">  ููููุฉ ุงูููุงู ุงูุฑุตุฏ ุ </li><li style=";text-align:right;direction:rtl">  ูุง ููุน ุงููุฎุทุท ุณูููู ุ </li><li style=";text-align:right;direction:rtl">  ููููุฉ ุชูุตูู ุงูุจูุงูุงุช ูู S3 ุ </li><li style=";text-align:right;direction:rtl">  ููููุฉ ุฅุนุงุฏุฉ ูุชุงุจุฉ ุฌููุน ุงูุงุณุชุนูุงูุงุช ูู SQL ููุงุณู ุฅูู ุบูุฑ ููุงุณูุ </li></ul><br>  <b>ุฃููุงุน ุงูุญุงูุงุช ูุงูุฃูุฑุงุต</b> .  ูู ุนุฏุฏ ุงููุนุงูุฌุงุช ุ ุงููุฑุต ูุงูุฐุงูุฑุฉ ุ ูุฑุฑูุง ุงูุจูุงุก ุนูู ุงูุชุซุจูุช ุงูุญุงูู ูู Redshift.  ูุงูุช ููุงู ุงูุนุฏูุฏ ูู ุงูุฎูุงุฑุงุช ุ ุจูุง ูู ุฐูู ูุซููุงุช i3 ูุน ุฃูุฑุงุต NVMe ุงููุญููุฉ ุ ูููู ูุฑุฑุช ุงูุชููู ุนูุฏ r5.4xlarge ูุงูุชุฎุฒูู ูู ุดูู 8T ST1 EBS ููู ูุซูู.  ููููุง ููุชูุฏูุฑุงุช ุ ููุจุบู ุฃู ูููู ูุฐุง ูุฏ ูุฏู ุฃุฏุงุกู ูุดุงุจููุง ูุน Redshift ุจูุตู ุงูุชูููุฉ.  ูู ุงูููุช ููุณู ุ ูุธุฑูุง ูุงุณุชุฎุฏุงู ุฃูุฑุงุต EBS ุ ูุญุตู ุนูู ูุณุฎ ุงุญุชูุงุทูุฉ ุจุณูุทุฉ ูุงุณุชุฑุฏุงุฏ ูู ุฎูุงู ููุทุงุช ููุฃูุฑุงุต ุ ููุง ูู Redshift ุชูุฑูุจูุง. <br><br>  <b>ุงููุณุฎ ุงููุชูุงุซู</b> .  ููุฐ ุฃู ุจุฏุฃูุง ููุง ูู ุจุงููุนู ูู Redshift ุ ูุฑุฑูุง ุนุฏู ุงุณุชุฎุฏุงู ุงููุณุฎ ุงููุชูุงุซู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุฐุง ูุง ูุฌุจุฑูุง ุนูู ุฏุฑุงุณุฉ ZooKeeper ุนูู ุงูููุฑ ุ ูุงูุชู ูู ุชุตู ุจุนุฏ ุฅูู ุงูุจููุฉ ุงูุชุญุชูุฉ ุ ูููู ูู ุงูุฑุงุฆุน ุงูุขู ุฃูู ูู ุงููููู ุฅุฌุฑุงุก ูุณุฎ ูุชูุงุซู ุนูุฏ ุงูุทูุจ. <br><br>  <b>ุงูุชุซุจูุช</b>  ูุฐุง ูู ุฃุณูู ุฌุฒุก.  ุฏูุฑ ุตุบูุฑ ูุงูู ูู Ansible ุ ูุงูุฐู ุณูููู ุจุชุซุจูุช ุญุฒู RPM ุฌุงูุฒุฉ ุงูุตูุน ููููู ุจููุณ ุงูุชูููู ุนูู ูู ูุถูู. <br><br>  <b>ุงูุฑุตุฏ</b>  ููุฑุงูุจุฉ ุฌููุน ุงูุฎุฏูุงุช ุ ูุชู ุงุณุชุฎุฏุงู Prometheus ูุน Telegraf ู Grafana ุ ูุจุงูุชุงูู ุ ูุฅููู ุจุจุณุงุทุฉ ูุถุนูู ูููุงุก Telegraf ุนูู ูุถูููู ูุน ClickHouse ุ ูุฌูุนูุง ููุญุฉ ุฃุฌูุฒุฉ ุงูููุงุณ ูู Grafana ุ ูุงูุชู ุฃุธูุฑุช ุชุญููู ุงูุฎุงุฏู ุงูุญุงูู ุญุณุจ ุงููุนุงูุฌ ูุงูุฐุงูุฑุฉ ูุงูุฃูุฑุงุต.  ูู ุฎูุงู ุงูููููู ุงูุฅุถุงูู ุฅูู Grafana ุ ูุฏููุง โโุฅูู ููุญุฉ ุงูููุงุฏุฉ ูุฐู ุงูุทูุจุงุช ุงููุดุทุฉ ุงูุญุงููุฉ ูููุชูุฉ ุ ูุญุงูุฉ ุงููุงุฑุฏุงุช ูู S3 ุ ูุบูุฑูุง ูู ุงูุฃุดูุงุก ุงููููุฏุฉ.  ุงุชุถุญ ุฃูู ุฃูุถู ูุฃูุซุฑ ุฅูุงุฏุฉ (ูุฃุณุฑุน ุจูุซูุฑ) ูู ููุญุฉ ุงูููุงุฏุฉ ุงูุชู ุฃุนุทุช ูุญุฏุฉ ุงูุชุญูู AWS. <br><br>  <b>ูุฎุทุท</b> .  ูุงู ุฃุญุฏ ุฃุฎุทุงุฆูุง ุงูุฑุฆูุณูุฉ ูู Redshift ูู ูุถุน ุญููู ุงูุฃุญุฏุงุซ ุงูุฑุฆูุณูุฉ ููุท ูู ุฃุนูุฏุฉ ูููุตูุฉ ุ ูุฅุถุงูุฉ ุงูุญููู ุงูุชู ูุงุฏุฑุงู ูุง ุชุณุชุฎุฏู ูุฅุถุงูุฉ <br>  ูู ุฎุตุงุฆุต ุนููุฏ ูุงุญุฏ ูุจูุฑ.  ูู ูุงุญูุฉ ุ ุฃุนุทุงูุง ุฐูู ูุฑููุฉ ูู ุชุบููุฑ ุงูุญููู ูู ุงููุฑุงุญู ุงูุฃูููุฉ ุ ุนูุฏูุง ูู ููู ููุงู ููู ูุงูู ููุฃุญุฏุงุซ ุงูุชู ูุฌูุนูุง ุจุงูุถุจุท ุ ูุน ุงูุฎุตุงุฆุต ุ ุนูุงูุฉ ุนูู ุฐูู ุ ุชุบูุฑุช 5 ูุฑุงุช ูู ุงูููู.  ููู ูุงุญูุฉ ุฃุฎุฑู ุ ุงุณุชุบุฑูุช ุทูุจุงุช ุงูุญุตูู ุนูู ุนููุฏ ูุจูุฑ ูู ุงูุนูุงุฑุงุช ุงููุฒูุฏ ูุงููุฒูุฏ ูู ุงูููุช.  ูู ClickHouse ุ ูุฑุฑูุง ุฃู ููุนู ุงูุดูุก ุงูุตุญูุญ ุนูู ุงูููุฑ ุ ูุฐูู ูููุง ุจุฌูุน ุฌููุน ุงูุฃุนูุฏุฉ ุงูููููุฉ ูุฃุฏุฎููุง ุงูููุน ุงูุฃูุซู ููุง.  ูุงููุชูุฌุฉ ูู ุฌุฏูู ูุญุชูู ุนูู ูุง ููุฑุจ ูู ูุงุฆุชู ุนููุฏ. <br><br>  ูุงูุช ุงููููุฉ ุงูุชุงููุฉ ูู ุงุฎุชูุงุฑ ุงููุญุฑู ุงูููุงุณุจ ููุชุฎุฒูู ูุงูุชูุณูู. <br>  ูู ูููุฑูุง ูู ุงูุชูุณูู ูุฑุฉ ุฃุฎุฑู ุ ููููู ูุนููุง ุงูุดูุก ููุณู ููุง ุญุฏุซ ูู Redshift - ูุณู ููู ููู ุ ูููู ุงูุขู ุฌููุน ุงูุฃูุณุงู ูู ุฌุฏูู ูุงุญุฏ ุ ูุงูุฐู <br>  ูุณุฑุน ุจุดูู ูุจูุฑ ุงูุทูุจุงุช ููุจุณุท ุงูุตูุงูุฉ.  ุชู ุฃุฎุฐ ูุญุฑู ุงูุชุฎุฒูู ุนู ุทุฑูู ReplacingMergeTree ุ ูุฃูู ูุชูุญ ูู ุฅุฒุงูุฉ ุงูุชูุฑุงุฑุงุช ูู ูุณู ูุนูู ุ ุจุจุณุงุทุฉ ุนู ุทุฑูู ุฅุฌุฑุงุก <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">OPTIMIZE ... FINAL</a> .  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุณูุญ ูุธุงู ุงูุชูุณูู ุงููููู ุ ูู ุญุงูุฉ ูุฌูุฏ ุฃุฎุทุงุก ุฃู ุญูุงุฏุซ ุ ุจุงูุนูู ููุท ูุน ุงูุจูุงูุงุช ูููู ูุงุญุฏ ุ ูููุณ ููุฏุฉ ุดูุฑ ุ ููู ุฃุณุฑุน ุจูุซูุฑ. <br><br>  <b>ุชุณููู ุงูุจูุงูุงุช ูู s3 ุฅูู ClickHouse</b> .  ูุงูุช ูุฐู ูุงุญุฏุฉ ูู ุฃุทูู ุงูุนูููุงุช.  ูู ููุฌุญ ุงูุฃูุฑ ูู ุฅุฌุฑุงุก ุงูุชุญููู ุจูุงุณุทุฉ ุฃุฏูุงุช ClickHouse ุงููุถููุฉ ุ ูุฃู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ุนูู S3 ูู JSON ุ ูุฌุจ ุงุณุชุฎุฑุงุฌ ูู ุญูู ูู jsonpath ุงูุฎุงุต ุจู ุ ููุง ูุนููุง ูู Redshift ุ ููู ุจุนุถ ุงูุฃุญูุงู ูุญุชุงุฌ ุฃูุถูุง ุฅูู ุงุณุชุฎุฏุงู ุงูุชุญููู: ุนูู ุณุจูู ุงููุซุงู ุ UUID ูุฑุณุงูุฉ ูู ุณุฌู ููุงุณู ูู ุงููููุฐุฌ <code>DD96C92F-3F4D-44C6-BCD3-E25EB26389E9</code> ุชุญููู ุฅูู ุจุงูุช ููุถุน ูู FixedString ููุน (16). <br><br>  ููุช ุฃุฑุบุจ ูู ุงูุญุตูู ุนูู ุฎุฏูุฉ ุฎุงุตุฉ ููุงุซูุฉ ููุง ูุงู ูุฏููุง ูู Redshift ูุฃูุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">COPY</a> .  ูู ูุฌุฏูุง ุฃู ุดูุก ุฌุงูุฒูุง ุ ูุฐูู ุงุถุทุฑุฑุช ููููุงู ุจุฐูู.  ููููู ูุชุงุจุฉ ููุงูุฉ ูููุตูุฉ ุญูู ููููุฉ ุนูููุง ุ ูููู ุจุงุฎุชุตุงุฑ ุ ูุฐู ุฎุฏูุฉ HTTP ูุชู ูุดุฑูุง ุนูู ูู ูุถูู ุจุงุณุชุฎุฏุงู ClickHouse.  ููููู ุงูุฑุฌูุน ุฅูู ุฃู ูููู.  ุชุญุฏุฏ ูุนููุงุช ุงูุทูุจ ุจุงุฏุฆุฉ S3 ุงูุชู ูุชู ุฃุฎุฐ ุงููููุงุช ูููุง ุ ููุงุฆูุฉ jsonpath ููุชุญููู ูู JSON ุฅูู ูุฌููุนุฉ ูู ุงูุฃุนูุฏุฉ ุ ูุถูุงู ุนู ูุฌููุนุฉ ูู ุงูุชุญูููุงุช ููู ุนููุฏ.  ูุจุฏุฃ ุงูุฎุงุฏู ุงูุฐู ุฌุงุก ุฅููู ุงูุทูุจ ูู ูุญุต ุงููููุงุช ุนูู S3 ูุชูุฒูุน ุชูุฒูุน ุงูุนูู ุนูู ูุถูููู ุขุฎุฑูู.  ูู ุงูููุช ููุณู ุ ูู ุงูููู ุจุงููุณุจุฉ ููุง ุฃู ุชุชู ุฅุถุงูุฉ ุงูุตููู ุงูุชู ูุง ูููู ุงุณุชูุฑุงุฏูุง ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงูุฎุทุฃ ุ ุฅูู ุฌุฏูู ClickHouse ูููุตู.  ูุณุงุนุฏ ูุฐุง ูุซูุฑูุง ูู ุงุณุชูุดุงู ุงููุดููุงุช ูุงูุฃุฎุทุงุก ูู ุฎุฏูุฉ ุชููู ุงูุฃุญุฏุงุซ ูุงูุนููุงุก ุงูุฐูู ููุดุฆูู ูุฐู ุงูุฃุญุฏุงุซ.  ูุน ูุถุน ุงููุณุชูุฑุฏ ูุจุงุดุฑุฉ ุนูู ูุถููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ุงุณุชุฎุฏููุง ูุฐู ุงูููุงุฑุฏ ุ ูุงูุชู ุ ููุงุนุฏุฉ ุนุงูุฉ ุ ุฎุงูุฏุฉ ุ ูุฃู ุงูุทูุจุงุช ุงููุนูุฏุฉ ูุง ุชุฏูู ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ.  ุจุงูุทุจุน ุ ุฅุฐุง ูุงู ููุงู ุงููุฒูุฏ ูู ุงูุทูุจุงุช ุ ููููู ุฏุงุฆููุง ููู ุฎุฏูุฉ ุงููุณุชูุฑุฏ ููุตู ุงููุถูููู. <br><br>  ูู ุชูู ููุงู ูุดุงูู ูุจูุฑุฉ ูู ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช ูู ูุตุงุฏุฑ ุฎุงุฑุฌูุฉ.  ูู ุชูู ุงููุตูุต ุงูุชู ูุงูุช ุ ูุงููุง ููุท ุจุชุบููุฑ ุงููุฌูุฉ ูู Redshift ุฅูู ClickHouse. <br><br>  ูุงู ููุงู ุฎูุงุฑ ููุงุชุตุงู MongoDB ูู ุดูู ูุงููุณ ุ ูุนุฏู ุงูููุงู ุจูุณุฎ ููููุฉ.  ูุณูุก ุงูุญุธ ุ ูู ููู ูุฐุง ููุงุณุจูุง ุ ูุฃูู ูุฌุจ ูุถุน ุงููุงููุณ ูู ุงูุฐุงูุฑุฉ ุ ููุง ูุณูุญ ุญุฌู ูุนุธู ุงููุฌููุนุงุช ูู MongoDB ุจูุฐุง.  ููู ุงูููุงููุณ ูุงูุช ูููุฏุฉ ููุง ุฃูุถูุง: ุงุณุชุฎุฏุงููุง ููุงุณุจ ุฌุฏูุง ูุชูุตูู ููุงุนุฏ ุจูุงูุงุช GeoIP ูู MaxMind ูุงุณุชุฎุฏุงููุง ูู ุงูุงุณุชุนูุงูุงุช.  ููุฐุง ูุณุชุฎุฏู ุชุฎุทูุท ip_trie ููููุงุช CSV ุงูุชู ุชููุฑูุง ุงูุฎุฏูุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุจุฏู ุชูููู ุงููุงููุณ geoip_asn_blocks_ipv4 ููุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dictionaries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dictionary</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>geoip_asn_blocks_ipv4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">path</span></span></span><span class="hljs-tag">&gt;</span></span>GeoLite2-ASN-Blocks-IPv4.csv<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">path</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">format</span></span></span><span class="hljs-tag">&gt;</span></span>CSVWithNames<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">format</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">\</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lifetime</span></span></span><span class="hljs-tag">&gt;</span></span>300<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lifetime</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ip_trie</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">structure</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attribute</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>prefix<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span>String<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attribute</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attribute</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>autonomous_system_number<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span>UInt32<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">null_value</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">null_value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attribute</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attribute</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>autonomous_system_organization<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span>String<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">null_value</span></span></span><span class="hljs-tag">&gt;</span></span>?<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">null_value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">attribute</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">structure</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dictionary</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dictionaries</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  ูููู ูุถุน ูุฐุง ุงูุชูููู ูู <code>/etc/clickhouse-server/geoip_asn_blocks_ipv4_dictionary.xml</code> ุ ูุจุนุฏ ุฐูู ููููู ุฅุฌุฑุงุก ุงุณุชุนูุงูุงุช ูู ุงููุงููุณ ููุญุตูู ุนูู ุงุณู ุงููููุฑ ุญุณุจ ุนููุงู IP: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> dictGetString(<span class="hljs-string"><span class="hljs-string">'geoip_asn_blocks_ipv4'</span></span>, <span class="hljs-string"><span class="hljs-string">'autonomous_system_organization'</span></span>, tuple(IPv4StringToNum(<span class="hljs-string"><span class="hljs-string">'192.168.1.1'</span></span>)));</code> </pre><br>  <b>ุชุบููุฑ ูุฎุทุท ุงูุจูุงูุงุช</b> .  ููุง ุฐูุฑูุง ุฃุนูุงู ุ ูุฑุฑูุง ุนุฏู ุงุณุชุฎุฏุงู ุงููุณุฎ ุงููุชูุงุซู ุญุชู ุงูุขู ุ ูุธุฑูุง ูุฃููุง ุงูุขู ูุง ูููููุง ุงููุตูู ุฅููู ูู ุญุงูุฉ ูููุน ุงูุญูุงุฏุซ ุฃู ุงูุนูู ุงููุฎุทุท ูู ุ ูููุงู ูุณุฎุฉ ูู ุงูุจูุงูุงุช ููุฌูุฏุฉ ุจุงููุนู ุนูู s3 ููููููุง ููููุง ุฅูู ClickHouse ูู ูุชุฑุฉ ุฒูููุฉ ูุนูููุฉ.  ุฅุฐุง ูู ููู ููุงู ูุณุฎ ูุชูุงุซู ุ ููู ูููููุง ุจุชูุณูุน ZooKeeper ุ ููุคุฏู ุบูุงุจ ZooKeeper ุฃูุถูุง ุฅูู ุนุฏู ุงููุฏุฑุฉ ุนูู ุงุณุชุฎุฏุงู ุชุนุจูุฑ ON CLUSTER ูู ุงุณุชุนูุงูุงุช DDL.  ุชู ุญู ูุฐู ุงููุดููุฉ ุนู ุทุฑูู ุจุฑูุงูุฌ ูุตู ุจูุซูู ุตุบูุฑ ูุชุตู ุจูู ูุถูู ClickHouse (ููุงู ุซูุงููุฉ ูููู ููุท ุญุชู ุงูุขู) ููููุฐ ุงุณุชุนูุงู SQL ุงููุญุฏุฏ. <br><br>  <b>ุฏุนู SQL ุบูุฑ ูุงูู ูู ClickHouse</b> .  ุชูุช ุนูููุฉ ููู ุงูุทูุจุงุช ูู ุจูุงุก ุฌููุฉ Redshift ุฅูู ุจูุงุก ุฌููุฉ ClickHouse ุจุงูุชูุงุฒู ูุน ุชุทูุฑ ุงููุณุชูุฑุฏ ุ ูุชู ุงูุชุนุงูู ูุนูุง ุจุดูู ุฃุณุงุณู ุจูุงุณุทุฉ ูุฑูู ูู ุงููุญูููู.  ุจุดูู ุบุฑูุจ ุ ููู ุงูุฃูุฑ ูู ููู ุญุชู ูู JOIN ุ ูููู ูู ูุธุงุฆู ุงููุงูุฐุฉ.  ูููู ููููุฉ ุงูููุงู ุจุฐูู ูู ุฎูุงู ุงููุตูููุงุช ููุธุงุฆู lambda ุ ุงุณุชุบุฑู ุงูุฃูุฑ ุนุฏุฉ ุฃูุงู.  ูู ุงูุฌูุฏ ุฃู ูุชู ุชูุงูู ูุฐู ุงููุดููุฉ ุบุงูุจูุง ูู ุชูุงุฑูุฑ ุญูู ClickHouse ุ ูุงูุชู ููุฌุฏ ุจูุง ุนุฏุฏ ูุจูุฑ ุ ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">events.yandex.ru/lib/talks/5420</a> .  ูู ูุฐู ุงููุฑุญูุฉ ุ ุชูุช ูุชุงุจุฉ ุงูุจูุงูุงุช ุจุงููุนู ูุฑุฉ ูุงุญุฏุฉ ูู ููุงููู: ูู ูู ูู Redshift ู ClickHouse ุงูุฌุฏูุฏ ุ ูุฐูู ุนูุฏูุง ูููุง ุจููู ุงูุทูุจุงุช ุ ูููุง ุจููุงุฑูุฉ ุงููุชุงุฆุฌ.  ูุงู ูู ุงูุตุนุจ ููุงุฑูุฉ ุงูุณุฑุนุฉ ุ ูุธุฑูุง ูุฃููุง ุฃุฒููุง ุนููุฏูุง ูุจูุฑูุง ูู ุงูุฎุตุงุฆุต ุ ูุจุฏุฃุช ูุนุธู ุงูุงุณุชุนูุงูุงุช ูู ุงูุนูู ููุท ูุน ุงูุฃุนูุฏุฉ ุงูุถุฑูุฑูุฉ ุ ูุงูุชู ุ ุจุงูุทุจุน ุ ุฃุนุทุช ุฒูุงุฏุฉ ูุจูุฑุฉ ุ ููู ุชูู ุงูุงุณุชุนูุงูุงุช ุงูุชู ูู ูุดุงุฑู ูููุง ุนููุฏ ุงูุฎุตุงุฆุต ุ ุฃู ุนููุช ุจููุณ ุงูุทุฑููุฉ ุ ุฃู ุฃุณุฑุน ููููุงู. <br><br>  ูุชูุฌุฉ ูุฐูู ุ ุญุตููุง ุนูู ุงููุฎุทุท ุงูุชุงูู: <br><br><img src="https://habrastorage.org/webt/tj/h8/ka/tjh8kagqccdbjgnswbmbm9wkloc.png"><br><br><h2 style=";text-align:right;direction:rtl">  ุงููุชุงุฆุฌ </h2><br>  ูู ุงูุฎูุงุตุฉ ุ ุญุตููุง ุนูู ุงูููุงุฆุฏ ุงูุชุงููุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฌุฏูู ูุงุญุฏ ุจุฏูุง ูู 90 </li><li style=";text-align:right;direction:rtl">  ูุชู ุชูููุฐ ุทูุจุงุช ุงูุฎุฏูุฉ ุจุงููููู ุซุงููุฉ </li><li style=";text-align:right;direction:rtl">  ููุฏ ุงูุฎูุถุช ุงูุชูููุฉ ุฅูู ุงููุตู </li><li style=";text-align:right;direction:rtl">  ุณูููุฉ ุฅุฒุงูุฉ ุงูุฃุญุฏุงุซ ุงูููุฑุฑุฉ </li></ul><br>  ููุงู ุฃูุถูุง ุนููุจ ูุฌูุฒูุง: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุญุงูุฉ ูููุน ุญุงุฏุซ ุ ุณูู ุชุถุทุฑ ุฅูู ุฅุตูุงุญ ุงููุชูุฉ ุจููุณู </li><li style=";text-align:right;direction:rtl">  ููุฒู ุฅุฌุฑุงุก ุชุบููุฑุงุช ุงููุฎุทุท ุงูุขู ุนูู ูู ูุถูู ุจุดูู ูููุตู </li><li style=";text-align:right;direction:rtl">  ุงูุชุญุฏูุซ ุฅูู ุงูุฅุตุฏุงุฑุงุช ุงูุฌุฏูุฏุฉ ุณูุชุนูู ุนููู ุงูููุงู ุจุฐูู ุจููุณู </li></ul><br>  ูุง ูููููุง ููุงุฑูุฉ ุณุฑุนุฉ ุงูุทูุจุงุช ุจุดูู ูุจุงุดุฑ ุ ูุฃู ูุธุงู ุงูุจูุงูุงุช ูุฏ ุชุบูุฑ ุจุดูู ูุจูุฑ.  ุฃุตุจุญุช ุงูุนุฏูุฏ ูู ุงูุงุณุชุนูุงูุงุช ุฃุณุฑุน ุ ูุฐูู ุจุจุณุงุทุฉ ูุฃููุง ุชูุฑุฃ ุจูุงูุงุช ุฃูู ูู ุงููุฑุต.  ุจุทุฑููุฉ ุฌูุฏุฉ ุ ูุงู ูุฌุจ ุฅุฌุฑุงุก ูุซู ูุฐุง ุงูุชุบููุฑ ูู Redshift ุ ูููู ุชูุฑุฑ ุฏูุฌู ูุน ุงูุชุฑุญูู ุฅูู ClickHouse. <br><br>  ุงุณุชุบุฑูุช ูู ุงููุฌุฑุฉ ุฅูู ุฌุงูุจ ุงูุฅุนุฏุงุฏ ุญูุงูู ุซูุงุซุฉ ุฃุดูุฑ.  ูุดูุช ูู ุจุฏุงูุฉ ููููู ุฅูู ููุงูุฉ ุณุจุชูุจุฑ ูุทุงูุจุช ุจูุดุงุฑูุฉ ุดุฎุตูู.  ูู 27 ุฃูููู (ุณุจุชูุจุฑ) ุ ูููุง ุจุฅููุงู ุชุดุบูู Redshift ูููุฐ ุฐูู ุงูุญูู ูุนูู ููุท ุนูู ClickHouse.  ุงุชุถุญ ุ ุจุงููุนู ูุง ูุฒูุฏ ููููุง ุนู ุดูุฑูู.  ุงููุตุทูุญ ูุตูุฑ ุ ููู ุญุชู ุงูุขู ูู ุชุตุงุฏู ุฃุจุฏูุง ุฃู ููุฏ ููุจูุงูุงุช ุฃู ุฎูู ุญุฑุฌ ุ ูุธุฑูุง ูุฃู ุงููุฌููุนุฉ ุจุฃููููุง ุณุชุณุชููุธ.  ุฃูุงููุง ููุชุธุฑูู ุงูุชุญุฏูุซุงุช ุนูู ุงูุฅุตุฏุงุฑุงุช ุงูุฌุฏูุฏุฉ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar433346/">https://habr.com/ru/post/ar433346/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar433336/index.html">ุชูููุฐ ุงูููุชุจุฉ ุงูุจุงุจููุฉ</a></li>
<li><a href="../ar433338/index.html">Creality 3D Printer ูุธุฑุฉ ุนุงูุฉ ุนูู ุงูุดุฑูุฉ ุงููุตูุนุฉ</a></li>
<li><a href="../ar433340/index.html">ุงูุฃุฌูุฒุฉ ุงููุงุณูููุฉ Xiaomi ูู ุงูููุฒู ุงูุฐูู ioBroker</a></li>
<li><a href="../ar433342/index.html">ููุฑูููุฌ ุขุฎุฑ ุจุณูุท ุงููุนุงูุฌ</a></li>
<li><a href="../ar433344/index.html">ูุฌุงุญุงู ูู ุงููุถุงุก ุงูุฎุงุต</a></li>
<li><a href="../ar433348/index.html">ูุชุจุชู DSL ูู TypeScript ูู JSX</a></li>
<li><a href="../ar433350/index.html">ุงูุฃุญุฏุงุซ ุงูุฑูููุฉ ูู ููุณูู ูู 17 ุฏูุณูุจุฑ - 23 ุฏูุณูุจุฑ</a></li>
<li><a href="../ar433352/index.html">ููุฎุต ุงูููุงุฏ ุงูุทุงุฒุฌุฉ ูู ุนุงูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ููุฃุณุจูุน ุงููุงุถู ุฑูู 343 (10-16 ุฏูุณูุจุฑ 2018)</a></li>
<li><a href="../ar433354/index.html">ุฃุฎุจุงุฑ ูู ุฎุฑูุทุฉ ุงูุดุงุฑุน ุงูููุชูุญ ุฑูู 438 (12/04/2018 - 12/10/2018)</a></li>
<li><a href="../ar433356/index.html">ุชุนูู ุงูููุงุฌููู ุชุฌุงูุฒ ุงููุตุงุฏูุฉ ุซูุงุฆูุฉ ุนุงูู Yahoo Mail ู Gmail</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>