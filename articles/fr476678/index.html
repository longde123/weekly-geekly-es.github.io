<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸˆ¸ ğŸ‘©ğŸ¼â€ğŸ­ ğŸ‘¦ğŸ» API pour l'extraction asynchrone Ã  distance Ã  l'aide d'Apple Combine ğŸ†” ğŸ‘– ğŸ–ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Combine est un framework Swift rÃ©actif fonctionnel qui a Ã©tÃ© rÃ©cemment implÃ©mentÃ© pour toutes Apple plateformes Apple , y compris Xcode 11 . Avec Comb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>API pour l'extraction asynchrone Ã  distance Ã  l'aide d'Apple Combine</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476678/"><img src="https://habrastorage.org/webt/t6/lj/xl/t6ljxl5w2xxh7v0inoq5oebgbro.png"><br><br>  <font color="#0000FF">Combine</font> est un framework <code>Swift</code> rÃ©actif fonctionnel qui a Ã©tÃ© rÃ©cemment implÃ©mentÃ© pour toutes <code>Apple</code> plateformes <code>Apple</code> , y compris <code>Xcode 11</code> .  Avec <font color="#0000FF">Combine, il est</font> trÃ¨s facile de traiter des sÃ©quences de valeurs qui apparaissent de maniÃ¨re asynchrone dans le temps.  Il simplifie Ã©galement le code asynchrone en abandonnant la dÃ©lÃ©gation et les <font color="#0000FF">rappels</font> imbriquÃ©s complexes. <br><br>  Mais Ã©tudier <font color="#0000FF">Combiner lui-mÃªme</font> au dÃ©but peut ne pas sembler si simple.  Le fait est que les principaux Â«acteursÂ» de <font color="#0000FF">Combine</font> sont des concepts abstraits tels que Â«Ã©diteursÂ» <font color="#0000FF">Ã‰diteurs</font> , Â«abonnÃ©sÂ» <font color="#0000FF">AbonnÃ©s</font> et opÃ©rateurs <font color="#0000FF">OpÃ©rateurs</font> , sans lesquels il ne sera pas possible d'avancer dans la comprÃ©hension de la logique de fonctionnement de <font color="#0000FF">Combine</font> .  Cependant, Ã©tant donnÃ© <code>Apple</code> fournit aux dÃ©veloppeurs des "Ã©diteurs", des "abonnÃ©s" et des opÃ©rateurs prÃªts Ã  l'emploi, le code Ã©crit avec <font color="#0000FF">Combine</font> est trÃ¨s compact et bien lisible. <br><br>  Vous le verrez dans l'exemple d'une application liÃ©e Ã  la <a href="https://developers.themoviedb.org/3/getting-started/introduction">rÃ©cupÃ©ration</a> asynchrone <a href="https://developers.themoviedb.org/3/getting-started/introduction">des</a> informations sur les <a href="https://developers.themoviedb.org/3/getting-started/introduction">films</a> de la trÃ¨s populaire base de donnÃ©es <a href="https://developers.themoviedb.org/3/getting-started/introduction">TMDb</a> .  Nous allons crÃ©er deux applications diffÃ©rentes: <font color="#0000FF">UIKit</font> et <font color="#0000FF">SwiftUI</font> , et montrer comment <font color="#0000FF">Combine</font> fonctionne avec elles. <br><br><img src="https://habrastorage.org/webt/sd/jn/py/sdjnpyhqecxf8q7wvtxlkm7qbr0.png"><br><a name="habracut"></a><br>  J'espÃ¨re que cet article vous facilitera l'apprentissage du <font color="#0000FF">Combine</font> .  Le code de toutes les applications dÃ©veloppÃ©es dans cet article se trouve sur <a href="https://github.com/BestKora/CombineFetchAPI">Github</a> . <br><br>  <font color="#0000FF">La moissonneuse-batteuse</font> comprend plusieurs composants principaux: <br><br><h3>  Publisher <b><font color="#0000FF">Publisher</font></b> . </h3><br><img src="https://habrastorage.org/webt/cu/6q/93/cu6q93meoo0iyfmkyqa4si1y68c.png"><br><br>  Ã‰diteurs Les <font color="#0000FF">Ã©diteurs</font> sont des TYPES qui apportent des <font color="#0000FF">valeurs Ã </font> tous ceux qui se soucient.  <font color="#0000FF">Le</font> concept Â«Ã©diteurÂ» de l'Ã©diteur est implÃ©mentÃ© dans <font color="#0000FF">Combine en</font> tant que <font color="#0000FF">protocole</font> , et non en tant que TYPE spÃ©cifique.  Le protocole <font color="#0000FF">Publisher</font> a associÃ© des TYPES gÃ©nÃ©riques pour la valeur de sortie et l'erreur d' <font color="#0000FF">Ã©chec</font> . <br>  Un Â«Ã©diteurÂ» qui ne publie jamais d'erreur utilise l'erreur TYPE <font color="#0000FF">Never</font> for a <font color="#0000FF">Failure</font> . <br><br><img src="https://habrastorage.org/webt/04/mt/gt/04mtgtm8ucbh38ywukqa-jv0qb0.png"><br><br><img src="https://habrastorage.org/webt/c9/py/wg/c9pywgmfyp5aa8t9mb0extzy764.png"><br><br>  <code>Apple</code> fournit aux dÃ©veloppeurs des implÃ©mentations spÃ©cifiques de Â«Ã©diteursÂ» prÃªts Ã  l'emploi: <font color="#0000FF">Just</font> , <font color="#0000FF">Future</font> , <font color="#0000FF">Empty</font> , <font color="#0000FF">Deferred</font> , <font color="#0000FF">Sequence</font> , <font color="#0000FF">@Published</font> , etc.  Des "Ã©diteurs" sont Ã©galement ajoutÃ©s aux classes <font color="#0000FF">Foundation</font> : <font color="#0000FF">URLSession</font> , &lt; <font color="#0000FF">NotificationCenter</font> , <font color="#0000FF">Timer</font> . <br><br><h3>  AbonnÃ© "AbonnÃ©". </h3><br><img src="https://habrastorage.org/webt/1t/h5/aj/1th5aj2egefg5fkjsikc-jurleq.png"><br><br>  C'est Ã©galement un protocole <font color="#0000FF">protocolaire</font> qui fournit une interface pour Â«s'abonnerÂ» aux <font color="#0000FF">valeurs</font> d'un Â«Ã©diteurÂ».  Il a associÃ© des TYPES gÃ©nÃ©riques pour les erreurs d' <font color="#0000FF">entrÃ©e</font> et d' <font color="#0000FF">Ã©chec</font> .  Ã‰videmment, les TYPES de Publisher <font color="#0000FF">Publisher</font> et <font color="#0000FF">Subscriber Subscriber</font> doivent correspondre. <br><br><img src="https://habrastorage.org/webt/2g/de/2n/2gde2nlg6zae1fezvtewfziyh0w.png"><br><br>  Pour tout Ã©diteur Publisher, il existe deux <font color="#0000FF">abonnÃ©s</font> intÃ©grÃ©s: <font color="#0000FF">regrouper</font> et <font color="#0000FF">attribuer</font> : <br><br><img src="https://habrastorage.org/webt/vq/ua/q-/vquaq-t465oyg5ku4plfd-jvyks.png"><br><br>  Le rÃ©cepteur Â«SubscriberÂ» <font color="#0000FF">est</font> basÃ© sur deux fermetures: une fermeture, <font color="#0000FF">receiveValue</font> , est exÃ©cutÃ©e lorsque vous obtenez les <font color="#0000FF">valeurs</font> , la deuxiÃ¨me fermeture, <font color="#0000FF">receiveCompletion</font> , est exÃ©cutÃ©e lorsque la Â«publicationÂ» est terminÃ©e (normalement ou avec une erreur). <br><br><img src="https://habrastorage.org/webt/im/fj/56/imfj56ymla1daatwof2b1qxkja8.png"><br><br>  L' <font color="#0000FF">affectation</font> Â«AbonnÃ©Â» avance chaque valeur reÃ§ue vers le <code>key Path</code> spÃ©cifiÃ©. <br><br><h3>  Abonnement "Abonnement". </h3><br><img src="https://habrastorage.org/webt/ha/rn/bv/harnbvbg6gigvyslb2aex_ujy4m.png"><br><br>  PremiÃ¨rement, l'Ã©diteur Â«Ã©diteurÂ» crÃ©e et livre l'abonnement Â«AbonnementÂ» <font color="#0000FF">Ã  l'</font> abonnÃ© Â« <font color="#0000FF">AbonnÃ©</font> Â» via sa mÃ©thode de <font color="#0000FF">rÃ©ception (abonnement :)</font> : <br><br><img src="https://habrastorage.org/webt/rk/tk/s8/rktks8zchgxyblozzz96otrxiee.png"><br><br>  AprÃ¨s cela, l' <font color="#0000FF">abonnement</font> peut envoyer ses <font color="#0000FF">valeurs aux</font> Â«abonnÃ©sÂ» des <font color="#0000FF">abonnÃ©s en</font> utilisant deux mÃ©thodes: <br><br><img src="https://habrastorage.org/webt/hl/4x/ev/hl4xev6fakwtgs-wpv3afwuaywa.png"><br><br>  Si vous avez fini de travailler avec l' <font color="#0000FF">abonnement Abonnement</font> , vous pouvez appeler sa mÃ©thode <font color="#0000FF">cancel ()</font> : <br><br><img src="https://habrastorage.org/webt/lz/ap/bt/lzapbts_gq9by1lw8qicdg3v2hc.png"><br><br><h3>  Sujet "Sujet". </h3><br><img src="https://habrastorage.org/webt/hy/cq/5p/hycq5pytsfa_gkzmqrwtmtal7tw.png"><br><br>  Il s'agit d'un protocole de <font color="#0000FF">protocole</font> qui fournit une interface pour les deux clients, Ã  la fois pour Â«l'Ã©diteurÂ» et pour Â«l'abonnÃ©Â».  Essentiellement, le sujet Â« <font color="#0000FF">subject</font> Â» est le Â«publisherÂ» <font color="#0000FF">Publisher</font> , qui peut accepter la valeur d' <font color="#0000FF">entrÃ©e Input</font> et que vous pouvez utiliser pour Â«injecterÂ» les <font color="#0000FF">valeurs</font> dans le flux en appelant la mÃ©thode <font color="#0000FF">send ()</font> .  Cela peut Ãªtre utile lors de l'adaptation du code impÃ©ratif existant dans les modÃ¨les <font color="#0000FF">combinÃ©s</font> . <br><br><h3>  OpÃ©rateur <font color="#0000FF">OpÃ©rateur</font> . </h3><br><img src="https://habrastorage.org/webt/h-/d-/r1/h-d-r1jmm2yxa5kefxpf5opmuw4.png"><br><br>  Ã€ l'aide de l'opÃ©rateur, vous pouvez crÃ©er un nouvel Â«Ã©diteurÂ» d'Ã©diteur Ã  partir d'un autre Â«Ã©diteurÂ» d'Ã©diteur en convertissant, en filtrant et mÃªme en combinant les <font color="#0000FF">valeurs</font> des nombreux <b><font color="#0000FF">Ã©diteurs en</font></b> <code>upstream</code> prÃ©cÃ©dents. <br><br><img src="https://habrastorage.org/webt/ol/he/rz/olherzm4jvlkfwer3x0gdbc0guk.png"><br><br>  Vous voyez ici beaucoup de noms d'opÃ©rateurs familiers: <font color="#0000FF">compactMap</font> , <font color="#0000FF">map</font> , <font color="#0000FF">filter</font> , <font color="#0000FF">dropFirst</font> , <font color="#0000FF">append</font> . <br><br><h3>  <font color="#0000FF">Ã‰diteurs de</font> la <font color="#0000FF">Fondation</font> <font color="#0000FF">Ã‰diteurs</font> intÃ©grÃ©s Ã  la <font color="#0000FF">Fondation</font> . </h3><br>  <code>Apple</code> fournit Ã©galement aux dÃ©veloppeurs plusieurs des fonctionnalitÃ©s <font color="#0000FF">Combine dÃ©jÃ </font> intÃ©grÃ©es dans le framework <font color="#0000FF">Foundation</font> &lt;, c'est-Ã -dire les Ã©diteurs des Ã©diteurs, pour des tÃ¢ches telles que la rÃ©cupÃ©ration de donnÃ©es Ã  l'aide d' <font color="#0000FF">URLSession</font> , l'utilisation de notifications Ã  l'aide de <font color="#0000FF">Notification</font> , <font color="#0000FF">Timer</font> et les propriÃ©tÃ©s de surveillance basÃ©es sur <font color="#0000FF">KVO</font> .  Cette compatibilitÃ© intÃ©grÃ©e nous aidera vraiment Ã  intÃ©grer le framework <font color="#0000FF">Combine</font> dans notre projet actuel. <br>  Pour en savoir plus Ã  ce sujet, consultez l'article <a href="https://theswiftdev.com/2019/10/31/the-ultimate-combine-framework-tutorial-in-swift/">Â«Le didacticiel ultime du framework Combine dans SwiftÂ»</a> . <br><br><h3>  Qu'apprenons-nous Ã  faire avec <font color="#0000FF">Combine</font> ? </h3><br>  Dans cet article, nous allons apprendre Ã  utiliser le framework <font color="#0000FF">Combine</font> pour rÃ©cupÃ©rer des donnÃ©es de film Ã  partir du site Web <a href="https://developers.themoviedb.org/3/getting-started/introduction">TMDb</a> .  Voici ce que nous Ã©tudierons ensemble: <br><br><ul><li>  Utiliser le <font color="#0000FF">futur</font> "Ã©diteur" pour crÃ©er une fermeture avec <font color="#0000FF">Promise</font> pour une seule valeur: <font color="#0000FF">valeur</font> ou erreur. </li><li>  Utilisation de l' <font color="#0000FF">URL</font> " <font color="#0000FF">session</font> " de l'Ã©diteur " <font color="#0000FF">datataskPublisher</font> " pour "s'abonner" aux <font color="#0000FF">donnÃ©es</font> publiÃ©es par un <code>UR</code> L. donnÃ© </li><li>  Utilisation de l'opÃ©rateur <font color="#0000FF">tryMap</font> pour convertir des donnÃ©es de <font color="#0000FF">donnÃ©es Ã  l'</font> aide d'un autre Ã©diteur Publisher. </li><li>  Utilisation de l'opÃ©rateur de <font color="#0000FF">dÃ©codage</font> pour convertir les donnÃ©es de <font color="#0000FF">donnÃ©es</font> en un objet <font color="#0000FF">dÃ©codable</font> et les publier pour transmission aux Ã©lÃ©ments suivants de la chaÃ®ne. </li><li>  Utiliser l'opÃ©rateur <font color="#0000FF">rÃ©cepteur</font> pour Â«s'abonnerÂ» Ã  un Â«Ã©diteurÂ» d'Ã©diteur Ã  l'aide de fermetures. </li><li>  Utilisez l'instruction <font color="#0000FF">assign</font> pour vous Â«abonnerÂ» Ã  l'Ã©diteur Â«Ã©diteurÂ» et attribuer la valeur qu'il fournit au <code>key Path</code> donnÃ©. </li></ul><br><h3>  Projet initial </h3><br>  Avant de commencer, nous devons nous enregistrer pour recevoir la clÃ© <code>API</code> sur le site Web <a href="https://developers.themoviedb.org/3/getting-started/introduction">TMDb</a> .  Vous devez Ã©galement tÃ©lÃ©charger le projet initial Ã  partir du rÃ©fÃ©rentiel <a href="https://github.com/alfianlosari/CombineFetchAPIStarter">GitHub</a> . <br>  Assurez-vous de placer votre clÃ© <code>API</code> dans la <font color="#0000FF">classe MovieStore de classe</font> dans <font color="#0000FF">let apiKey</font> constant. <br><br><img src="https://habrastorage.org/webt/u0/fp/ev/u0fpevrqivppfng0lyoglbkp-cq.png"><br><br>  Voici les principaux blocs de construction Ã  partir desquels nous allons crÃ©er notre projet: <br><br><ul><li>  1. Ã€ l'intÃ©rieur du fichier <code>Movie.swift</code> trouvent des modÃ¨les que nous utiliserons dans notre projet.  La structure racine de <font color="#0000FF">struct MoviesResponse</font> implÃ©mente le protocole <font color="#0000FF">Decodable</font> , et nous l'utiliserons lors du dÃ©codage <code>JSON</code> donnÃ©es <code>JSON</code> dans un modÃ¨le.  La structure <font color="#0000FF">MoviesResponse</font> a une propriÃ©tÃ© <font color="#0000FF">results</font> , qui implÃ©mente Ã©galement le protocole <font color="#0000FF">Decodable</font> et est une collection de films <font color="#0000FF">[Movie]</font> .  C'est elle qui nous intÃ©resse: </li></ul><br><img src="https://habrastorage.org/webt/1o/9s/xz/1o9sxzm4t-edp2l2hhauqky2dve.png"><br><br><ul><li>  2. <font color="#0000FF">Ã‰numÃ©ration</font> Ã©numÃ©ration <font color="#0000FF">MovieStoreAPIError</font> implÃ©mente le protocole d' <font color="#0000FF">erreur</font> .  Notre <code>API</code> utilisera cette Ã©numÃ©ration pour reprÃ©senter diffÃ©rents types d'erreurs: erreurs de <font color="#0000FF">rÃ©cupÃ©ration d'</font> <code>URL</code> <font color="#0000FF">urlError</font> , erreurs de dÃ©codage <font color="#0000FF">decodingError</font> et erreurs d'extraction de donnÃ©es <font color="#0000FF">responseError</font> . </li></ul><br><img src="https://habrastorage.org/webt/kn/3n/av/kn3nav2xvctmabav1v2zdi_6hrw.png"><br><br><ul><li>  3. Notre <code>API</code> possÃ¨de un protocole <font color="#0000FF">MovieService</font> avec une seule mÃ©thode, <font color="#0000FF">fetchMovies (de endpoint: Endpoint)</font> , qui sÃ©lectionne les films <font color="#0000FF">[Movie] en</font> fonction du paramÃ¨tre de <font color="#0000FF">endpoint</font> .  <font color="#0000FF">Le point de terminaison</font> lui-mÃªme est un <font color="#0000FF">enum enum</font> qui reprÃ©sente un <font color="#0000FF">point</font> de <font color="#0000FF">terminaison</font> pour accÃ©der Ã  la base de donnÃ©es <a href="https://developers.themoviedb.org/3/getting-started/introduction">TMDb</a> pour rÃ©cupÃ©rer des films comme <font color="#0000FF">nowPlaying</font> (dernier), <font color="#0000FF">populaire</font> (populaire), <font color="#0000FF">topRated</font> (haut) et Ã  <font color="#0000FF">venir</font> (Ã  venir bientÃ´t Ã  l'Ã©cran). </li></ul><br><img src="https://habrastorage.org/webt/4b/a1/ki/4ba1kiw5glfklazq04txpbbs6fy.png"><br><br><ul><li>  4. La <font color="#0000FF">classe</font> MovieStore est une classe spÃ©cifique qui implÃ©mente le protocole <font color="#0000FF">MovieService</font> pour rÃ©cupÃ©rer des donnÃ©es Ã  partir du site <a href="https://developers.themoviedb.org/3/getting-started/introduction">TMDb</a> .  Dans cette classe, nous implÃ©mentons la <font color="#0000FF">mÃ©thode fetchMovies (...) en</font> utilisant <font color="#0000FF">Combine</font> . </li></ul><br><img src="https://habrastorage.org/webt/l2/lr/q1/l2lrq1ff5w76cxbvpmr53eywiy4.png"><br><br><ul><li>  5. La classe <font color="#0000FF">MovieListViewController</font> est la principale classe <font color="#0000FF">ViewController</font> dans laquelle nous utilisons la mÃ©thode <font color="#0000FF">Sink</font> pour Â«souscrireÂ» Ã  la mÃ©thode de lecture de film <font color="#0000FF">fetchMovies (...)</font> , qui renvoie le <font color="#0000FF">futur</font> Â«Ã©diteurÂ», puis mettre Ã  jour la table <font color="#0000FF">TableView</font> avec de nouvelles donnÃ©es de film <font color="#0000FF">films</font> utilisant la nouvelle <code>API</code> <font color="#0000FF">DiffableDataSourceSnapshot</font> . </li></ul><br>  Avant de commencer, examinons certains des composants de base de <font color="#0000FF">Combine</font> que nous utiliserons pour <code>API</code> rÃ©cupÃ©ration de donnÃ©es Ã  distance. <br><br><h3>  Â«Abonnez-vousÂ» Ã  Â«l'Ã©diteurÂ» en utilisant <font color="#0000FF">Ã©vier</font> et ses fermetures. </h3><br>  Le moyen le plus simple de Â«souscrireÂ» Ã  Â«l'Ã©diteurÂ» de l'Ã©diteur est d'utiliser le <font color="#0000FF">rÃ©cepteur</font> avec ses fermetures, dont l'une sera exÃ©cutÃ©e chaque fois que nous obtiendrons une nouvelle <font color="#0000FF">valeur</font> , et l'autre lorsque Â«l'Ã©diteurÂ» aura fini de livrer les <font color="#0000FF">valeurs</font> . <br><br><img src="https://habrastorage.org/webt/yb/wt/ng/ybwtnglt5iuxpbfpkj3tgud_qpo.png"><br><br>  N'oubliez pas que dans <font color="#0000FF">Combine,</font> chaque Â«abonnementÂ» renvoie une <font color="#0000FF">annulation</font> , qui sera supprimÃ©e dÃ¨s que nous quitterons notre contexte.  Afin de maintenir un Â«abonnementÂ» pendant une pÃ©riode plus longue, par exemple, pour obtenir des valeurs de maniÃ¨re asynchrone, nous devons enregistrer Â«l'abonnementÂ» dans la propriÃ©tÃ© <font color="#0000FF">subscription1</font> .  Cela nous a permis d'obtenir systÃ©matiquement toutes les <font color="#0000FF">valeurs (7,8,3,4)</font> . <br><br><h3>  <font color="#0000FF">Future</font> Â«publieÂ» de faÃ§on asynchrone une seule valeur: soit une <font color="#0000FF">valeur,</font> soit une erreur d' <font color="#0000FF">Ã©chec</font> . </h3><br>  Dans le cadre <font color="#0000FF">Combine</font> , le <font color="#0000FF">futur</font> Â«Ã©diteurÂ» peut Ãªtre utilisÃ© pour obtenir de maniÃ¨re asynchrone un seul TYPE de <font color="#0000FF">rÃ©sultat Ã  l'</font> aide d'une fermeture.  La fermeture a un paramÃ¨tre - <font color="#0000FF">Promise</font> , qui est une fonction de TYPE <font color="#0000FF">(Result &lt;Output, Failure&gt;) -&gt; Void</font> . <br><br>  Regardons un exemple simple pour comprendre comment fonctionne le <font color="#0000FF">futur</font> Ã©diteur: <br><br><img src="https://habrastorage.org/webt/x9/6p/_p/x96p_plt6deyew9_q5yupqa_zsc.png"><br><br>  Nous crÃ©ons <font color="#0000FF">Future</font> avec un rÃ©sultat rÃ©ussi de TYPE <font color="#0000FF">Int</font> et une erreur de TYPE <font color="#0000FF">Never</font> .  Dans la fermeture <font color="#0000FF">Future</font> , nous utilisons <font color="#0000FF">DispatchQueue.main.asyncAfter (...)</font> pour retarder l'exÃ©cution du code de <font color="#0000FF">2</font> secondes, simulant ainsi un comportement asynchrone.  Ã€ l'intÃ©rieur de la fermeture, nous <font color="#0000FF">renvoyons</font> <font color="#0000FF">Promise</font> avec un rÃ©sultat de <font color="#0000FF">promesse rÃ©ussi (.success (...)) en</font> tant que valeur entiÃ¨re alÃ©atoire <font color="#0000FF">Int</font> comprise entre <font color="#0000FF">0</font> et <font color="#0000FF">100</font> .  Ensuite, nous utilisons deux abonnements <font color="#0000FF">futurs</font> - <font color="#0000FF">annulable</font> et <font color="#0000FF">annulable1</font> - et les deux donnent le mÃªme rÃ©sultat, bien qu'un nombre alÃ©atoire soit gÃ©nÃ©rÃ© Ã  l'intÃ©rieur. <br><blockquote>  <u><i><code> 1.</code></i></u> Il convient de noter que l 'Â«Ã©diteurÂ» de <font color="#0000FF">Future</font> in <font color="#0000FF">Combine</font> prÃ©sente certaines caractÃ©ristiques comportementales par rapport aux autres Â«Ã©diteursÂ»: <br><br><ul><li>  Le <font color="#0000FF">futur</font> "Ã©diteur" publie toujours "UNE valeur ( <font color="#0000FF">valeur</font> ou erreur), et ceci termine son travail. </li></ul><br><ul><li>  <font color="#0000FF">Le futur</font> Â«Ã©diteurÂ» est une <font color="#0000FF">classe</font> ( <code>reference type</code> ), contrairement aux autres Â«Ã©diteursÂ», qui sont principalement des <font color="#0000FF">structures struct</font> ( <code>value type</code> ), et il est transmis en tant que paramÃ¨tre une fermeture de <font color="#0000FF">promesse</font> , qui est crÃ©Ã©e immÃ©diatement lors de l'initialisation de l'instance d'Ã©diteur <font color="#0000FF">futur</font> .  C'est-Ã -dire que la clÃ´ture de la <font color="#0000FF">promesse</font> est transmise avant que tout abonnÃ© Â« <font color="#0000FF">abonnÃ©</font> Â» ne <font color="#0000FF">s'abonne</font> Ã  la <font color="#0000FF">future</font> instance Â«Ã©diteurÂ».  L 'Â«Ã©diteurÂ» de <font color="#0000FF">Future</font> n'a <font color="#0000FF">absolument</font> pas besoin d'un Â«abonnÃ©Â» pour son fonctionnement, comme tous les autres <font color="#0000FF">Ã©diteurs</font> ordinaires l'exigent.  C'est pourquoi le texte Â«Bonjour de l'intÃ©rieur du futur!Â» N'est imprimÃ© qu'une seule fois dans le code ci-dessus. </li></ul><br><ul><li>  <font color="#0000FF">Le futur</font> "Ã©diteur" est un "Ã©diteur" <code>eager</code> (impatient), contrairement Ã  la plupart des autres "Ã©diteurs" <font color="#0000FF">paresseux</font> ("publier" uniquement s'il y a un "abonnement").  Ce n'est qu'une fois que le <font color="#0000FF">futur</font> Ã©diteur a fermÃ© sa <font color="#0000FF">promesse que</font> le rÃ©sultat est mÃ©morisÃ© et ensuite transmis aux Â«abonnÃ©sÂ» actuels et futurs.  D'aprÃ¨s le code ci-dessus, nous voyons que lorsque vous vous Â«abonnezÂ» Ã  plusieurs reprises au <font color="#0000FF">futur</font> Ã©diteur, vous obtenez toujours la mÃªme valeur Â«alÃ©atoireÂ» (dans ce cas <font color="#0000FF">6</font> , mais elle peut Ãªtre diffÃ©rente, mais toujours la mÃªme), bien qu'elle soit utilisÃ©e dans la fermeture valeur <font color="#0000FF">int</font> alÃ©atoire. </li></ul></blockquote><br>  Une telle logique de Â«l'Ã©diteurÂ» de <font color="#0000FF">Future</font> permet de l'utiliser avec succÃ¨s pour stocker un rÃ©sultat calculÃ© asynchrone consommateur de ressources et de ne pas perturber le Â«serveurÂ» pour les multiples Â«abonnementsÂ» ultÃ©rieurs. <br><br>  Si une telle logique de l 'Â«Ã©diteurÂ» de <font color="#0000FF">Future</font> ne vous convient pas et que vous voulez que votre <font color="#0000FF">Future soit</font> appelÃ© <font color="#0000FF">paresseux</font> et chaque fois que vous obtenez de nouvelles valeurs <font color="#0000FF">Int</font> alÃ©atoires, alors vous devriez Â«bouclerÂ» <font color="#0000FF">Future</font> dans <font color="#0000FF">Deferred</font> : <br><br><img src="https://habrastorage.org/webt/j3/gf/25/j3gf25golyfoyl0jvkfddej2mk8.png"><br><br>  Nous utiliserons <font color="#0000FF">Future de maniÃ¨re</font> classique, comme suggÃ©rÃ© dans <font color="#0000FF">Combine</font> , c'est-Ã -dire comme un Â«Ã©diteurÂ» asynchrone calculÃ© Â«partagÃ©Â». <br><br><blockquote>  Remarque 2. Nous devons faire une derniÃ¨re remarque concernant l 'Â«abonnementÂ» utilisant le rÃ©cepteur au Â«PublisherÂ» asynchrone.  La mÃ©thode <font color="#0000FF">Sink</font> renvoie <font color="#0000FF">AnyCancellable</font> , dont nous ne nous souvenons pas constamment.  Cela signifie que <code>Swift</code> dÃ©truira <font color="#0000FF">AnyCancellable</font> au moment oÃ¹ vous quitterez le contexte donnÃ©, ce qui se produit sur le <code>main thread</code> .  Ainsi, il s'avÃ¨re que <font color="#0000FF">AnyCancellable</font> est dÃ©truit avant que la fermeture avec <font color="#0000FF">Promise</font> ne puisse dÃ©marrer sur le <code>main thread</code> .  Lorsque <font color="#0000FF">AnyCancellable est</font> dÃ©truit, sa mÃ©thode d' <font color="#0000FF">annulation</font> est appelÃ©e, ce qui annule dans ce cas Â«l'abonnementÂ».  C'est pourquoi nous nous souvenons de nos Â«abonnementsÂ» de <font color="#0000FF">puits</font> au <font color="#0000FF">futur</font> dans les variables <font color="#0000FF">annulables &lt;et annulables1</font> ou dans <font color="#0000FF">Set &lt;AnyCancellable&gt; ()</font> . </blockquote><br><br><h3>  Utilisation de <font color="#0000FF">Combine</font> pour rÃ©cupÃ©rer des films sur le site Web de <a href="https://developers.themoviedb.org/3/getting-started/introduction">TMDb</a> . </h3><br>  Pour commencer, vous ouvrez le projet de dÃ©marrage et accÃ©dez au fichier <code>MovieStore.swift</code> et Ã  la mÃ©thode <font color="#0000FF">fetchMovies</font> avec une implÃ©mentation vide: <br><br><img src="https://habrastorage.org/webt/fg/aw/s0/fgaws0kq7u9kz5ojjz3jlij9zl8.png"><br><br>  En utilisant la mÃ©thode <font color="#0000FF">fetchMovies,</font> nous pouvons sÃ©lectionner diffÃ©rents films en dÃ©finissant des valeurs spÃ©cifiques pour le <font color="#0000FF">paramÃ¨tre d'</font> entrÃ©e de <font color="#0000FF">point final</font> de TYPE <font color="#0000FF">Endpoint</font> .  TYPE <font color="#0000FF">Endpoint</font> est une <font color="#0000FF">Ã©numÃ©ration d'</font> Ã©numÃ©ration qui prend les valeurs <font color="#0000FF">nowPlaying</font> (actuel), Ã  <font color="#0000FF">venir</font> (bientÃ´t Ã  l'Ã©cran), <font color="#0000FF">populaire</font> (populaire), <font color="#0000FF">topRated</font> (haut): <br><br><img src="https://habrastorage.org/webt/-a/xt/-f/-axt-f0lhtfrt8u_a-ay7q3z8jk.png"><br><br>  CommenÃ§ons par initialiser <font color="#0000FF">Future</font> avec une fermeture de <code>callback</code> .  ReÃ§u <font color="#0000FF">Future,</font> nous vous rembourserons ensuite. <br><br><img src="https://habrastorage.org/webt/hu/v0/pu/huv0pu3w26r2fms4ih4fvhrx8to.png"><br><br>  Ã€ l'intÃ©rieur de la fermeture de <code>callback</code> , nous gÃ©nÃ©rons l' <code>URL</code> de la valeur correspondante du <font color="#0000FF">paramÃ¨tre d'</font> entrÃ©e de <font color="#0000FF">point final en</font> utilisant la fonction <font color="#0000FF">generateURL (avec endpoint: Endpoint)</font> : <br><br><img src="https://habrastorage.org/webt/q8/ce/9e/q8ce9ez5nokjff1c_oowpfdlncm.png"><br><br>  Si l' <code>URL</code> correcte n'a pas pu Ãªtre gÃ©nÃ©rÃ©e, nous <font color="#0000FF">renvoyons</font> une erreur Ã  l'aide de <font color="#0000FF">promise (.failure (.urlError (...))</font> , sinon nous allons de l'avant et implÃ©mentons l' <font color="#0000FF">URL</font> Â« <font color="#0000FF">session</font> Ã©diteurÂ» <font color="#0000FF">URLSession.dataTaskPublisher</font> . <br><br>  Pour "souscrire" aux donnÃ©es d'une certaine <code>URL</code> nous pouvons utiliser la mÃ©thode <font color="#0000FF">datataskPublisher</font> intÃ©grÃ©e Ã  la classe <font color="#0000FF">URLSession</font> , qui prend l' <code>URL</code> comme paramÃ¨tre et renvoie l'Ã©diteur "publisher" avec les donnÃ©es de sortie du tuple <font color="#0000FF">(data: Data, response: URLResponse)</font> et une erreur <font color="#0000FF">URLError</font> . <br><br><img src="https://habrastorage.org/webt/wb/dv/uy/wbdvuyzbpv6w3qxfzjyfxxwtmx8.png"><br><br>  Pour convertir un Ã©diteur Publisher vers un autre Ã©diteur Publisher, utilisez l'opÃ©rateur <font color="#0000FF">tryMap</font> .  Par rapport Ã  la <font color="#0000FF">carte</font> , l'opÃ©rateur <font color="#0000FF">tryMap</font> peut <font color="#0000FF">renvoyer</font> une erreur <font color="#0000FF">Error</font> <font color="#0000FF">throws Ã  l'</font> intÃ©rieur d'une fermeture, ce qui nous renvoie le nouvel Ã©diteur Publisher. <br><br>  Dans l'Ã©tape suivante, nous utiliserons l'opÃ©rateur <font color="#0000FF">tryMap</font> pour vÃ©rifier le code <code>http</code> <font color="#0000FF">statusCode</font> de la rÃ©ponse de <font color="#0000FF">rÃ©ponse</font> pour nous assurer que sa valeur est comprise entre <font color="#0000FF">200</font> et <font color="#0000FF">300</font> .  Sinon, nous lanÃ§ons <font color="#0000FF">la</font> valeur d'erreur d' <font color="#0000FF">Ã©numÃ©ration MovieStoreAPIError enum responseError</font> .  Sinon (lorsqu'il n'y a pas d'erreur), nous renvoyons simplement les donnÃ©es reÃ§ues <font color="#0000FF">au</font> prochain <font color="#0000FF">Ã©diteur</font> de la chaÃ®ne Â«Ã©diteurÂ». <br><br><img src="https://habrastorage.org/webt/wy/ln/6c/wyln6c46anluun6s7woysgopsma.png"><br><br>  Dans l'Ã©tape suivante, nous utiliserons l'opÃ©rateur de <font color="#0000FF">dÃ©codage</font> , qui dÃ©code les donnÃ©es <code>JSON</code> sortie du <font color="#0000FF">tryMap</font> Â«Ã©diteurÂ» <font color="#0000FF">prÃ©cÃ©dent</font> dans <font color="#0000FF">MovieResponse</font> &lt;Model Ã  l'aide de <font color="#0000FF">JSONDecoder</font> . <br><br><img src="https://habrastorage.org/webt/-s/jt/0j/-sjt0j9lf5pbkugsryptozbb0ei.png"><br><br>  ... <font color="#0000FF">jsonDecoder est</font> configurÃ© pour un format de date spÃ©cifique: <br><br><img src="https://habrastorage.org/webt/ub/ed/pu/ubedpue91eckdhygbfmxbnk4oqk.png"><br><br>  Pour que le traitement soit effectuÃ© sur le <code>main thread</code> , nous utiliserons l'opÃ©rateur <font color="#0000FF">receive (on :)</font> et passerons <font color="#0000FF">RunLoop.main</font> comme paramÃ¨tre d'entrÃ©e.  Cela permettra Ã  "l'abonnÃ©" d'obtenir la valeur de <font color="#0000FF">valeur</font> sur le thread <code>main</code> . <br><br><img src="https://habrastorage.org/webt/gr/n2/wh/grn2whzqqawxp_1-ffqh6jwhmse.png"><br><br>  Enfin, nous sommes arrivÃ©s Ã  la fin de notre chaÃ®ne de transformation, et lÃ , nous utilisons le <font color="#0000FF">puits</font> pour obtenir un abonnement Â« <font color="#0000FF">abonnement</font> Â» Ã  la Â«chaÃ®neÂ» formÃ©e d'Ã©diteurs Â«Ã©diteursÂ».  Pour initialiser une instance de la classe <font color="#0000FF">Sink</font> , nous avons besoin de deux choses, bien que l'une d'entre elles soit facultative: <br><br><ul><li>  fermeture <font color="#0000FF">recevoirValeur :.</font>  Il sera appelÃ© chaque fois qu'un abonnement "abonnement" reÃ§oit une nouvelle <font color="#0000FF">valeur</font> de l'Ã©diteur "Ã©diteur". </li></ul><br><ul><li>  <font color="#0000FF">ClÃ´ture de la rÃ©ception:</font> (Facultatif).  Il sera appelÃ© une fois que l' <font color="#0000FF">Ã©diteur</font> Â«Ã©diteurÂ» a fini de publier la <font color="#0000FF">valeur</font> , il recevra l'Ã©numÃ©ration d' <font color="#0000FF">achÃ¨vement</font> , que nous pouvons utiliser pour vÃ©rifier si la Â«publicationÂ» des valeurs est vraiment terminÃ©e ou si l'achÃ¨vement est dÃ» Ã  une erreur. </li></ul><br>  Dans la fermeture de <font color="#0000FF">receiveValue</font> , nous <font color="#0000FF">invoquons</font> simplement <font color="#0000FF">une</font> <font color="#0000FF">promesse</font> avec une option <font color="#0000FF">.success</font> et une valeur de <font color="#0000FF">0 $ .rÃ©sultats</font> , qui dans notre cas est un tableau de films <font color="#0000FF">films</font> .  Dans la fermeture de <font color="#0000FF">receiveCompletion,</font> nous vÃ©rifions si l' <font color="#0000FF">achÃ¨vement comporte une</font> erreur d' <font color="#0000FF">erreur</font> , puis transmettons l'erreur de <font color="#0000FF">promesse</font> correspondante avec l'option <font color="#0000FF">.failure</font> . <br><br><img src="https://habrastorage.org/webt/gr/qh/tm/grqhtm3xthdx7snxlmwfawmd3rq.png"><br><br>  Notez que nous collectons ici toutes les erreurs Â«rejetÃ©esÂ» dans les Ã©tapes prÃ©cÃ©dentes de la Â«chaÃ®ne des Ã©diteursÂ». <br><br>  Ensuite, nous mÃ©morisons l'abonnement Â«souscriptionÂ» dans la propriÃ©tÃ© <font color="#0000FF">Set &lt;AnyCancellable&gt; ()</font> . <br>  Le fait est que l'abonnement Â«abonnementÂ» est <font color="#0000FF">annulable</font> , c'est un tel protocole qui dÃ©truit et efface tout aprÃ¨s l'achÃ¨vement de la fonction <font color="#0000FF">fetchMovies</font> .  Pour garantir la conservation de l'abonnement Â«abonnementÂ» mÃªme aprÃ¨s l'achÃ¨vement de cette fonction, il faut se souvenir de l'abonnement Â« <font color="#0000FF">abonnement</font> Â» dans la variable externe Ã  la fonction <font color="#0000FF">fetchMovies</font> .  Dans notre cas, nous utilisons la propriÃ©tÃ© <font color="#0000FF">subscriptions</font> , qui a le type <font color="#0000FF">Set &lt;AnyCancellable&gt; ()</font> et utilisons la <font color="#0000FF">mÃ©thode .store (in: &amp; self.subscriptions)</font> , qui garantit la <font color="#0000FF">convivialitÃ© de l '</font> Â«abonnementÂ» une fois que la fonction <font color="#0000FF">fetchMovies a terminÃ©</font> son travail. <br><br><img src="https://habrastorage.org/webt/uh/zx/j9/uhzxj91hkb5y5tm-hd1bheoukcu.png"><br><br>  Ceci conclut la formation de la mÃ©thode <font color="#0000FF">fetchMovies pour</font> sÃ©lectionner des films dans la base de donnÃ©es <a href="https://developers.themoviedb.org/3/getting-started/introduction">TMDb en</a> utilisant le framework <font color="#0000FF">Combine</font> .  La mÃ©thode <font color="#0000FF">fetchMovies</font> , en tant que paramÃ¨tre d'entrÃ©e <font color="#0000FF">de,</font> prend la valeur de l' <font color="#0000FF">Ã©numÃ©ration enum Endpoint</font> , c'est-Ã -dire quels films spÃ©cifiques nous intÃ©ressent: <br><br>  <font color="#0000FF">.nowPlaying</font> - films actuellement Ã  l'Ã©cran, <br>  <font color="#0000FF">.upcoming</font> - films Ã  venir, <br>  <font color="#0000FF">.popular</font> - films populaires, <br>  <font color="#0000FF">.topRated</font> - meilleurs films, c'est-Ã -dire avec une cote trÃ¨s Ã©levÃ©e. <br>  Essayons d'appliquer cette <code>API</code> Ã  la conception d'applications avec les interfaces utilisateur <font color="#0000FF">UIKit</font> habituelles sous la forme d'un <code>Table View Controller</code> : <br><br><img src="https://habrastorage.org/webt/lr/6g/gu/lr6gguhjajdke_udcrw1ihyaonu.png"><br><br>  et Ã  une application dont l'interface utilisateur est construite en utilisant le nouveau <font color="#0000FF">framework</font> dÃ©claratif <font color="#0000FF">SwiftUI</font> : <br><br><img src="https://habrastorage.org/webt/md/_v/kf/md_vkfmsoa--efg4ig5ej-98nue.png"><br><br><h3>  "Abonnez-vous" aux <font color="#0000FF">films</font> des <font color="#0000FF">films</font> <code>View Controller</code> habituels. </h3><br>  Nous passons au fichier <i>MovieListViewController.swift</i> et dans la mÃ©thode <font color="#0000FF">viewDidLoad</font> appelons la mÃ©thode <font color="#0000FF">fetchMovies</font> . <br><br><img src="https://habrastorage.org/webt/k3/pw/p_/k3pwp_hzhixbhhkgnvuughyv5na.png"><br><br>  Dans notre mÃ©thode <font color="#0000FF">fetchMovies,</font> nous utilisons le <font color="#0000FF">movieAPI</font> dÃ©veloppÃ© prÃ©cÃ©demment et sa mÃ©thode <font color="#0000FF">fetchMovies</font> avec le paramÃ¨tre <font color="#0000FF">.nowPlaying</font> comme <font color="#0000FF">point de terminaison du paramÃ¨tre d'</font> entrÃ©e <font color="#0000FF">from</font> .  Autrement dit, nous choisirons les films qui sont actuellement sur les Ã©crans des salles de cinÃ©ma. <br><br><img src="https://habrastorage.org/webt/k2/x0/xj/k2x0xjbdbgvi-sk9ifo9u5zxj9e.png"><br><br>  La <font color="#0000FF">mÃ©thode movieAPI.fetchMovies (from: .nowPlaying)</font> renvoie le <font color="#0000FF">futur</font> "Ã©diteur", auquel nous "souscrivons" Ã  l'aide de <font color="#0000FF">sink</font> , et lui fournissons deux fermetures.  Dans la fermeture de <font color="#0000FF">receiveCompletion</font> , <font color="#0000FF">nous</font> vÃ©rifions s'il y a une erreur d' <font color="#0000FF">erreur</font> et affichons un avertissement d'urgence Ã  l'alerte de l'utilisateur avec le message d'erreur affichÃ©. <br><br><img src="https://habrastorage.org/webt/i8/3f/po/i83fpotmo-qab-imavpikbmsbxo.png"><br><br>  Dans la fermeture <font color="#0000FF">receiveValue,</font> nous appelons la mÃ©thode <font color="#0000FF">generateSnapshot</font> et lui passons les <font color="#0000FF">films</font> sÃ©lectionnÃ©s. <br><br><img src="https://habrastorage.org/webt/iz/hm/qi/izhmqi60prl_u55nf-iypvstnnq.png"><br><br>  La fonction <font color="#0000FF">generateSnapshot gÃ©nÃ¨re</font> un nouveau <font color="#0000FF">NSDiffableDataSourceSnapshot Ã  l'</font> aide de nos <font color="#0000FF">films</font> et applique l' <font color="#0000FF">instantanÃ©</font> rÃ©sultant au <font color="#0000FF">diffableDataSource de</font> notre table. <br><br>  Nous lanÃ§ons l'application et <font color="#0000FF">observons</font> comment <font color="#0000FF">UIKit</font> fonctionne avec les Â«Ã©diteursÂ» et les Â«abonnÃ©sÂ» du framework <font color="#0000FF">Combine</font> .  Il s'agit d'une application trÃ¨s simple qui ne vous permet pas de syntoniser diverses collections de films - dÃ©sormais prÃ©sentÃ©s Ã  l'Ã©cran, populaires, trÃ¨s apprÃ©ciÃ©s ou qui vont apparaÃ®tre Ã  l'Ã©cran dans un avenir proche.  Nous ne voyons que les films qui vont apparaÃ®tre Ã  l'Ã©cran (. Ã€ <font color="#0000FF">venir</font> ).  Bien sÃ»r, vous pouvez le faire en ajoutant un Ã©lÃ©ment d' <code>UI</code> pour dÃ©finir les valeurs de l'Ã©numÃ©ration de point <font color="#0000FF">final</font> , par exemple, Ã  l'aide de <code>Stepper</code> ou de <code>Segmented Control</code> , puis mettez Ã  jour l'interface utilisateur.  C'est bien connu, mais nous ne le ferons pas dans une <font color="#0000FF">application</font> basÃ©e sur <font color="#0000FF">UIKit</font> , mais laissons cela au nouveau cadre dÃ©claratif <font color="#0000FF">SwiftUI</font> . <br>  Le code d'une <font color="#0000FF">application</font> basÃ©e sur <font color="#0000FF">UIKit</font> se trouve sur <a href="https://github.com/BestKora/CombineFetchAPI">Github</a> dans le <i><code>CombineFetchAPICompleted-UIKit</code></i> . <br><br><h3>  Utilisez <font color="#0000FF">SwiftUI</font> pour afficher des films <font color="#0000FF">films</font> </h3>  . <br>    <code>CombineFetchAPI-MY</code>  <font color="#0000FF">SwiftUI</font>     <code>File</code> -&gt; <code>New</code> -&gt; <code>Project</code>    <code>Single View App</code>   <code>iOS</code> : <br><br><img src="https://habrastorage.org/webt/pi/bu/xu/pibuxuc4tnqd6roa_puo0-iwdpq.png"><br><br>        <code>UI</code> â€” <font color="#0000FF">SwiftUI</font> : <br><br><img src="https://habrastorage.org/webt/mm/zy/_o/mmzy_o9znv-qwuodqzaveavzsak.png"><br><br>            <code><i>Movie.swift</i></code>      <code><i>Model</i></code> ,     <a href="https://developers.themoviedb.org/3/getting-started/introduction">TMDb</a>  <code><i>MovieStore.swift</i></code> , <code><i>MovieStoreAPIError.swift</i></code>  <code><i>MovieService.swift</i></code> ,       <code><i>MovieService</i></code>  <code><i>Protocol</i></code> : <br><br><img src="https://habrastorage.org/webt/21/ni/4f/21ni4fl3gnd-j4jrehzqt7vf218.png"><br><br>  <font color="#0000FF">SwiftUI</font> ,  <code></code>  <font color="#0000FF">Codable</font> ,      <code>JSON</code> ,  <font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identifiable</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , si l' </font><font style="vertical-align: inherit;">on veut faciliter l'affichage de la liste des films </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Film]</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sous la forme d'une liste d' </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">une liste</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Les modÃ¨les dans </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SwiftUI</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'ont pas besoin d'Ãªtre </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã©quitables</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hashable</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , comme requis par </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIKit</font></font></font> <code>API</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UITableViewDiffableDataSource</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans l' </font><font style="vertical-align: inherit;">application </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIKit</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> prÃ©cÃ©dente </font><font style="vertical-align: inherit;">. Par consÃ©quent, nous supprimons de la </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">structure</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &lt; </font><font color="#0000FF"><font style="vertical-align: inherit;">struct Movie</font></font><font style="vertical-align: inherit;"> toutes les mÃ©thodes associÃ©es aux </font><font color="#0000FF"><font style="vertical-align: inherit;">protocoles </font></font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equatable</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hashable</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/9m/tu/zd/9mtuzdjefl-wbw3jigfpr5op5bw.png"><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">............................</font></font></b> <br><img src="https://habrastorage.org/webt/_q/uc/b2/_qucb2csrso2vfuac1cvow_ysvm.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il existe un excellent article </font></font><a href="https://nshipster.com/identifiable/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">identifiable</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui montre la diffÃ©rence et les similitudes entre les </font></font><code>Swift</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protocoles.</font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Identifiable</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hashable</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã©quitable</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'interface utilisateur que nous crÃ©erons Ã  l'aide de </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SwiftUI</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est basÃ©e sur le fait que nous changeons le </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">point de terminaison</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lors de la rÃ©cupÃ©ration des donnÃ©es et obtenons la collection de films dont nous avons besoin, qui est prÃ©sentÃ©e sous la forme d'une liste: </font></font><br><br><img src="https://habrastorage.org/webt/o4/-k/qa/o4-kqamned7_ee6snel_57zc0ek.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ainsi que dans le cas d' </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIKit</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , les donnÃ©es sont Ã©chantillonnÃ©es Ã  l'aide de la fonction </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">movieAPI .fetchMovies (from endpoint: Endpoint)</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui obtient le </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">point de terminaison</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> souhaitÃ© </font><font style="vertical-align: inherit;">et renvoie le "publisher" </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Future &lt;[Movie, MovieStoreAPIError]&gt;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Si nous jetons un Å“il Ã  l'Ã©numÃ©ration </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Endpoint</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous verrons que nous pouvons initialiser l'option souhaitÃ©e</font></font><font color="#0000FF">case</font>   <font color="#0000FF">Endpoint</font>         <font color="#0000FF">index</font> : <br><br><img src="https://habrastorage.org/webt/ze/jb/9d/zejb9d_o2gr4m4oymkatehr2uuw.png"><br><br> ,       <font color="#0000FF">movies</font> ,     <font color="#0000FF">indexEndpoint</font>  <font color="#0000FF">Endpoint</font> .     <code>View Model</code> ,       <font color="#0000FF">MoviesViewModel</font> ,   <font color="#0000FF">ObservableObject</font> .       <i>MoviesViewModel.swift</i>   <code>View Model</code> : <br><br><img src="https://habrastorage.org/webt/w3/tx/bl/w3txblf8e8ectsgykvterljstjk.png"><br><br>         <font color="#0000FF">@Published</font> :  <font color="#0000FF">@Published var indexEndpoint: Int</font> â€” ,  <font color="#0000FF">@Published var movies: [Movie]</font> - .     <font color="#0000FF">@Published</font>   <font color="#0000FF">indexEndpoint</font> ,          <font color="#0000FF">indexEndpoint</font> ,    <font color="#0000FF">$indexEndpoint</font> . <br>      <font color="#0000FF">MoviesViewModel</font>       Â«Â» <font color="#0000FF">$indexEndpoint</font>   Â«Â»  <font color="#0000FF">AnyPublisher&lt;[Movie], Never&gt;</font> ,          <font color="#0000FF">movieAPI.fetchMovies (from: Endpoint (index: indexPoint))</font>   <font color="#0000FF">flatMap</font> . <br><br><img src="https://habrastorage.org/webt/ur/e7/y2/ure7y2ym3mkucrvj-r0ubwezc0i.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuite, nous nous Â«abonnonsÂ» Ã  cet Â«Ã©diteurÂ» nouvellement reÃ§u en utilisant un </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assing</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Â«abonnÃ©Â» trÃ¨s simple </font><font color="#0000FF"><font style="vertical-align: inherit;">(Ã : \ .movies, on: self)</font></font><font style="vertical-align: inherit;"> et attribuons la valeur reÃ§ue de Â«l'Ã©diteurÂ» au tableau de sortie des </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">films</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nous pouvons appliquer l' </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assing</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Â«abonnementÂ» </font><font color="#0000FF"><font style="vertical-align: inherit;">(Ã : \ .movies, on: self)</font></font><font style="vertical-align: inherit;"> uniquement si Â«l'Ã©diteurÂ» ne </font><font color="#0000FF"><font style="vertical-align: inherit;">renvoie</font></font><font style="vertical-align: inherit;"> pas d'erreur, c'est-Ã -dire qu'il a un TYPE d'erreur </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Never</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Comment y parvenir? Utilisation de l' </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">opÃ©rateur replaceError (avec: [])</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui remplace toute erreur par un tableau de </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">films</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vide de </font><font color="#0000FF"><font style="vertical-align: inherit;">films</font></font><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autrement dit, la premiÃ¨re version plus simple de notre </font><font style="vertical-align: inherit;">application </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SwiftUI</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n'affichera pas d'informations sur les erreurs possibles pour l'utilisateur.</font></font><br><br> ,     <code>View Model</code>   ,    <code>UI</code> .    <i>ContentView.swift</i>  <code>View Model</code>  <font color="#0000FF">@EnvironmentObject</font>  <font color="#0000FF">var moviesViewModel</font>   <font color="#0000FF">Text(Â«Hello, World!Â»)</font>  <br> <font color="#0000FF">Text("\(moviesViewModel.indexEndpoint)")</font> ,     <font color="#0000FF">indexEndpoint</font>   . <br><br><img src="https://habrastorage.org/webt/pr/bu/ic/prbuicibqgoshncctnfzxustbby.png"><br><br>     <code>View Model</code>   <font color="#0000FF">indexEndpoint = 2</font> ,         ,        ( <font color="#0000FF">Upcoming</font> ): <br><br><img src="https://habrastorage.org/webt/bz/ll/-g/bzll-g26ytgu4kya4dh0t5m5wjw.png"><br><br>   <code>UI</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰lÃ©ments pour contrÃ´ler la collection de films que nous voulons montrer. Voici </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stepper</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/o5/4j/rg/o54jrgkra0vggnuxmzjrgrfrkkc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... et </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Picker</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : les </font></font><br><br><img src="https://habrastorage.org/webt/ei/ln/g6/eilng6a6zeizbtswoq5isrsbxje.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deux utilisent le "publisher" </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ moviesViewModel.indexEndpoint de la</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nÃ´tre </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, et avec l'un d'eux (de toute faÃ§on, lequel) nous pouvons sÃ©lectionner la collection de films dont nous avons besoin: </font></font><br><br><img src="https://habrastorage.org/webt/hb/sz/mi/hbszmixxzg4_njoodr2_p-bz3v8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ensuite, nous ajoutons la liste des films reÃ§us en utilisant </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">List</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ForEach</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et des attributs minimaux film lui-mÃªme </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">film</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/no/zf/g7/nozfg7kd8ednspilzhe0ibzw9cg.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Liste des films affichÃ©s </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filmsViewModel.movies que</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous prenons Ã©galement du nÃ´tre </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/6g/mi/eu/6gmieuzemvr0tjecr_ks_rpq9_w.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous N'utilisons PAS le </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> publisher </font><font color="#0000FF"><font style="vertical-align: inherit;">$ moviesViewModel.movies</font></font><font style="vertical-align: inherit;"> avec le signe </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, car nous n'allons rien Ã©diter dans cette liste de films. Nous utilisons la propriÃ©tÃ© habituelle </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moviesViewModel.movies</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez rendre la liste de films plus intÃ©ressante en affichant dans chaque ligne de la liste l'affiche du film correspondant, </font></font><code>URL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qui est prÃ©sentÃ©e dans la structure du </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">film</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/wj/wc/mr/wjwcmrzdsx2g_dxzkj5tt7-cets.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous empruntons cette opportunitÃ© Ã  </font></font><a href="https://twitter.com/Dimillian"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thomas Ricouard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de son beau projet </font></font><a href="https://github.com/Dimillian/MovieSwiftUI/blob/1d0ebdcb33f1164a3eba8b52a3f212ef0aef1dd9/MovieSwift/MovieSwift/binding/ImageLoader.swift"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MovieSwiftUI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme dans le cas du chargement de </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">films</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pour l'image </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UIImage</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , nous avons le service </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageService</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui implÃ©mente </font><font style="vertical-align: inherit;">la mÃ©thode </font><font color="#0000FF"><font style="vertical-align: inherit;">fetchImage</font></font><font style="vertical-align: inherit;"> avec </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine</font></font></font><font style="vertical-align: inherit;"></font><font color="#0000FF"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De retour Â« Ã©diteurÂ» </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AnyPublisher &lt;?, un UIImage Never&gt;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/ta/rq/zi/tarqziqr1neusqhuvy3xusnbb-c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... et </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageLoader de classe finale: ObservableObject</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , met en </font><font style="vertical-align: inherit;">Å“uvre le protocole </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ObservableObject</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> avec </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Published</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> propriÃ©tÃ© d' </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image: UIImage?</font></font></font>  : <br><br><img src="https://habrastorage.org/webt/nm/mf/xb/nmmfxbdfrw54rbwkeghgbrbbq_i.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La seule condition requise par le protocole </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ObservableObject</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est l'existence de la propriÃ©tÃ© </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objectWillChange</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SwiftUI</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilise cette propriÃ©tÃ© pour comprendre que quelque chose a changÃ© dans l'instance de cette classe et dÃ¨s que cela se produit, met Ã  jour toutes les </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vues</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui dÃ©pendent de l'instance de cette classe. En rÃ¨gle gÃ©nÃ©rale, le compilateur crÃ©e automatiquement une propriÃ©tÃ© </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objectWillChange</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et toutes les </font><font style="vertical-align: inherit;">propriÃ©tÃ©s </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Published</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la notifient Ã©galement automatiquement. Dans le cas de certaines situations exotiques, vous pouvez crÃ©er manuellement un </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objectWillChange</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et le notifier des modifications. Nous avons juste un tel cas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans la classe </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageLoader</font></font></font>    <font color="#0000FF">@Published</font>  <font color="#0000FF">var image:UIImage?</font>  .           ,     <font color="#0000FF">ImageLoader</font> ,   Â«Â» <font color="#0000FF">$image</font>   Â«Â»     <font color="#0000FF">loadImage()</font> ,      <font color="#0000FF">poster</font>   <font color="#0000FF">size</font>    <font color="#0000FF">@Published</font>  <font color="#0000FF">var image:UIImage?</font>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous informerons </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">objectWillChange de</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ces modifications </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous pouvons avoir beaucoup de ces images dans le tableau, ce qui entraÃ®ne des coÃ»ts de temps importants, nous utilisons donc la mise en cache des instances </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">imageLoader</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de la classe </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ImageLoader</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/bh/3z/yr/bh3zyrhhwbalksaw_78v2iotffk.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons une </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vue</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> spÃ©ciale </font><font style="vertical-align: inherit;">pour lire l' </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">affiche du</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> film </font><font color="#0000FF"><font style="vertical-align: inherit;">MoviePosterImage</font></font><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/8o/hs/bj/8ohsbjrvisd-ijjef0nbfrc3p6i.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... et nous l'utiliserons lors de l'affichage d'une liste de films dans notre </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ContentView</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> principal </font><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/h0/xn/l9/h0xnl9hwptsp8flgpsxwq2zpf-u.png"><br><br><img src="https://habrastorage.org/webt/ew/ft/op/ewftopem4n5r0wwh_zv2xj2r07g.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le code de l' </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> basÃ©e sur </font><font color="#0000FF"><font style="vertical-align: inherit;">SwiftUI</font></font><font style="vertical-align: inherit;"> sans affichage d'erreur peut Ãªtre trouvÃ© sur </font></font><a href="https://github.com/BestKora/CombineFetchAPI"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le dossier </font></font><code>CombineFetchAPI-NOError</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Afficher les erreurs de rÃ©cupÃ©ration de film asynchrone Ã  distance. </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jusqu'Ã  prÃ©sent, nous n'avons pas utilisÃ© ou affichÃ© d'erreurs qui se produisent lors de la sÃ©lection asynchrone Ã  distance de films sur le site Web de </font></font><a href="https://developers.themoviedb.org/3/getting-started/introduction"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMDb</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Bien que la fonction </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">movieAPI.fetchMovies (de endpoint: Endpoint) que nous utilisons</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous permette de le faire, car elle renvoie le "publisher" </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Future &lt;[Movie, MovieStoreAPIError]&gt;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afin de permettre des erreurs, ajouter Ã  notre </font></font><code>View Model</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autre </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Published</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> propriÃ©tÃ© </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moviesError: MovieStoreAPIError?</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cela reprÃ©sente l'erreur. Il s'agit d'une </font><font style="vertical-align: inherit;">propriÃ©tÃ© </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">facultative</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , sa valeur initiale est </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nil</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ce qui correspond Ã  l'absence d'erreur: </font></font><br><br><img src="https://habrastorage.org/webt/-t/em/_y/-tem_ynqrewyk3bdubok9jcb7pu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pour obtenir cette erreur </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">moviesError</font></font></font> ,       <font color="#0000FF">MoviesViewModel</font>     Â«Â» <font color="#0000FF">sink</font> : <br><br><img src="https://habrastorage.org/webt/7c/ie/m0/7ciem0walfc1pwbjraeqlzpwr5q.png"><br><br>  <font color="#0000FF">moviesError</font>    <code>UI</code> ,     <font color="#0000FF">nil</font> â€¦ <br><br><img src="https://habrastorage.org/webt/i1/o5/ve/i1o5ve67nptlwcubxxl7ylvup5i.png"><br><br>   <font color="#0000FF">AlertView</font> : <br><br><img src="https://habrastorage.org/webt/kd/st/u8/kdstu80nyu1jvikbxzunxfigkks.png"><br><br>    ,    <code>API</code> : <br><br><img src="https://habrastorage.org/webt/f_/4i/ha/f_4ihalskxufzgz1xra_pdqxwoy.png"><br><br>      <font color="#0000FF">SwiftUI</font>       <a href="https://github.com/BestKora/CombineFetchAPI">Github</a>   <i>CombineFetchAPI-Error</i> . <br><br>       ,     <font color="#0000FF">Future&lt;[Movie],MovieStoreAPIError&gt;</font> ,    <font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AnyPublisher &lt;[Movie], Never&gt;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans la mÃ©thode </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fetchMoviesLight</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/-v/3m/hx/-v3mhx-uwkxlzzla7iu-qgigyt0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'absence d'erreurs ( </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Never</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) nous permet d'utiliser une </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">assignation</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "abonnÃ©" trÃ¨s simple </font><font color="#0000FF"><font style="vertical-align: inherit;">(Ã : \ .movies, on: self)</font></font><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/webt/zw/ro/up/zwroupvq_yi7shbzefyhsdj8t6e.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout fonctionnera comme avant:</font></font><br><br><img src="https://habrastorage.org/webt/ux/sa/-n/uxsa-n17hh_tu7nqp_znak3oa-w.png"><br><br><h3>  Conclusion </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'utilisation du framework </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour traiter une sÃ©quence de </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valeurs</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> apparaissant de maniÃ¨re asynchrone dans le temps est </font><font style="vertical-align: inherit;">trÃ¨s simple et facile. Les opÃ©rateurs </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proposÃ©s</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par </font><font color="#0000FF"><font style="vertical-align: inherit;">Combine</font></font><font style="vertical-align: inherit;"> sont puissants et flexibles. </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous permet d'Ã©viter d'Ã©crire du code asynchrone complexe en utilisant la chaÃ®ne en amont des Ã©diteurs </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ã‰diteurs</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , en utilisant des opÃ©rateurs et des </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">abonnÃ©s</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intÃ©grÃ©s </font><font style="vertical-align: inherit;">. </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La moissonneuse-batteuse est</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> construite Ã  un niveau infÃ©rieur Ã  </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foundation</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dans de nombreux cas n'a pas besoin de </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foundation</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et a des performances incroyables. </font></font><br><br><img src="https://habrastorage.org/webt/eo/la/1q/eola1qc122ogmvluicy5odv9x4g.png"><br><br> <font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SwiftUI est</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ã©galement fortement liÃ© Ã  </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;grÃ¢ce Ã  ses </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@ObservableObject</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Binding</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><font color="#0000FF"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@EnvironmentObject</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br> <code>iOS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les dÃ©veloppeurs attendent depuis longtemps </font></font><code>Apple</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ce genre </font><font style="vertical-align: inherit;">de </font><font style="vertical-align: inherit;">cadre officiel, et finalement cette annÃ©e, c'est arrivÃ©.</font></font><br><br>  RÃ©fÃ©rences: <br><br> <a href="https://medium.com/%40alfianlosari/fetching-remote-async-api-with-apple-combine-framework-f7c067c7bb3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RÃ©cupÃ©rer l'API Remote Async avec Apple Combine Framework </font></font></a> <br> <a href="https://www.youtube.com/watch%3Fv%3DfejmsuxoIvA"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">essayez! Swift NYC 2019 - Premiers pas avec Combine </font></font></a> <br> <a href="https://theswiftdev.com/2019/10/31/the-ultimate-combine-framework-tutorial-in-swift/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Le tutoriel ultime du framework Combine dans Swift". </font></font></a> <br><br> <a href="https://store.raywenderlich.com/products/combine-asynchronous-programming-with-swift"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine: Programmation asynchrone avec Swift </font></font></a> <br><br> <a href="https://developer.apple.com/videos/play/wwdc2019/722/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PrÃ©sentation de Combine - WWDC 2019 - VidÃ©os - DÃ©veloppeur Apple. session 722 </font></font></a> <br> <a href="https://developer.apple.com/videos/play/wwdc2019/722/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(synopsis de la session 722 "Introduction to Combine" en russe) </font></font></a> <br><br> <a href="https://developer.apple.com/videos/play/wwdc2019/721"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combine in Practice - WWDC 2019 - VidÃ©os - Apple Developer. session 721 </font></font></a> <br> <a href="https://docs.google.com/document/d/1Klsc_7OLx_NWQ-vj6WbdyrmJG1DmoqAAoxLoVB2lbaA/edit%3Fusp%3Dsharing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(synopsis de la session 721 "Utilisation pratique de Combine" en russe) </font></font></a> <br><br> <a href="https://bestkora.com/IosDeveloper/swiftui-combine-vmeste-luchshe-pochemu-swiftui-i-combine-pomogut-vam-sozdavat-bolee-luchshie-prilozheniya/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SwiftUI &amp; Combine: Together is better. Pourquoi SwiftUI et Combine vous aident Ã  crÃ©er de meilleures applications. </font></font></a> <br><br> <a href="https://github.com/Dimillian/MovieSwiftUI/blob/1d0ebdcb33f1164a3eba8b52a3f212ef0aef1dd9/MovieSwift/MovieSwift/binding/ImageLoader.swift"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MovieSwiftUI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <a href="https://medium.com/flawless-app-stories/visualize-combine-magic-with-swiftui-part-1-3a56e2a461b3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visualisez Combine Magic avec SwiftUI Partie 1 ()</font></font></a> <br> <a href="https://medium.com/better-programming/visualize-combine-magic-with-swiftui-part-2-2c613370388b">Visualize Combine Magic with SwiftUI â€“ Part 2 (Operators, subscribing, and canceling in Combine)</a> <br><a href="https://medium.com/better-programming/visualize-combine-magic-with-swiftui-part-2-2c613370388b"></a> <a href="https://medium.com/better-programming/visualize-combine-magic-with-swiftui-part-2-2c613370388b">Visualize Combine Magic with SwiftUI Part 3 (See Combine Merge and Append in Action) <br> Visualize Combine Magic with SwiftUI â€” Part 4</a> <br> <a href="https://medium.com/flawless-app-stories/visualize-combine-magic-with-swiftui-part-5-2783adddbd1d">Visualize Combine Magic with SwiftUI â€” Part 5</a> <br><br> <a href="https://medium.com/better-programming/getting-started-with-the-combine-framework-in-swift-36fe4ff6e568">Getting Started With the Combine Framework in Swift</a> <br> <a href="https://www.vadimbulavin.com/map-flatmap-switchtolatest-in-combine-framework/">Transforming Operators in Swift Combine Framework: Map vs FlatMap vs SwitchToLatest</a> <br> <a href="https://www.thomasvisser.me/2019/07/06/combine-future/">Combine's Future</a> <br> <a href="https://heckj.github.io/swiftui-notes/">Using Combine</a> <br> <a href="https://theswiftdev.com/2019/08/15/urlsession-and-the-combine-framework/">URLSession and the Combine framework</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr476678/">https://habr.com/ru/post/fr476678/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr476666/index.html">Biologie pour les programmeurs: comment une approche d'ingÃ©nierie change le monde</a></li>
<li><a href="../fr476668/index.html">Comment j'ai contrÃ´lÃ© l'ordinateur Ã  partir du tÃ©lÃ©phone</a></li>
<li><a href="../fr476670/index.html">Vue d'ensemble de la CAO sur le noyau gÃ©omÃ©trique C3D - 2</a></li>
<li><a href="../fr476674/index.html">DÃ©ploiement rapide de ReportPortal pour la familiarisation</a></li>
<li><a href="../fr476676/index.html">48 ressources open source pour JavaScript (2019)</a></li>
<li><a href="../fr476680/index.html">Le systÃ¨me de planification de la production continue de Rodov est le Lean / MRP soviÃ©tique de 1961. DÃ©collage, coucher de soleil et nouvelle naissance</a></li>
<li><a href="../fr476682/index.html">Comment Ã©crire un sapeur dans Phaser et exÃ©cuter une tÃ¢che de test de dÃ©veloppeur HTML5</a></li>
<li><a href="../fr476686/index.html">DÃ©veloppement d'une passerelle IoT basÃ©e sur Raspberry CM3 +</a></li>
<li><a href="../fr476688/index.html">Nouveau cours d'OTUS. Â«DÃ©veloppeur IOS. Cours avancÃ© V 2.0 Â»</a></li>
<li><a href="../fr476692/index.html">Principes du marketing de contenu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>