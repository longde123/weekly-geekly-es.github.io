<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüè≠ üàØÔ∏è üõãÔ∏è Impor laporan panggilan terjadwal dari CoMagic ke BigQuery pada jadwal menggunakan Google Cloud Functions üßíüèæ ü§ò üçê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Untuk apa 
 Dengan struktur kompleks kampanye iklan dan sejumlah besar panggilan, alat tambahan untuk menyimpan, memproses, dan menganalisis informasi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Impor laporan panggilan terjadwal dari CoMagic ke BigQuery pada jadwal menggunakan Google Cloud Functions</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475804/"><h2>  Untuk apa </h2><br>  Dengan struktur kompleks kampanye iklan dan sejumlah besar panggilan, alat tambahan untuk menyimpan, memproses, dan menganalisis informasi tentang panggilan masuk menjadi penting.  Seringkali Anda membutuhkan akses cepat ke data dalam jangka waktu yang lama.  Terkadang Anda membutuhkan pemrosesan data yang kompleks, menghubungkan panggilan ke saluran atau kampanye tertentu. <br><br>  Salah satu opsi untuk mempercepat pekerjaan, yang juga memberikan manfaat tambahan, adalah mengimpor panggilan dari CoMagic ke Google BigQuery.  Banyak yang telah ditulis tentang manfaat BigQuery, jadi mari kita beralih ke penciptaan. <br><a name="habracut"></a><br>  Untuk membuat impor otomatis, Anda perlu: <br><br><ol><li>  Akun Google (jika belum) dengan proyek yang dibuat </li><li>  Pengetahuan python </li><li>  Memperkenalkan Dokumentasi Google Cloud </li>
</ol><br>  Cara membuat proyek dijelaskan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .  Setelah proyek dibuat, Anda perlu membuat dataset di BigQuery.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dokumentasi</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">instruksi</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">BQ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">untuk membuat dataset</a> . <br><br><h2>  Mengambil data dari CoMagic </h2><br>  Beralih ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> CoMagic.  Untuk mendapatkan daftar panggilan atau panggilan, kami membutuhkan bagian laporan. <br><br>  Kami membuat kelas sederhana untuk bekerja dengan CoMagic API.  Semua persyaratan yang diperlukan akan ditunjukkan di akhir tautan ke GitHub. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ComagicClient</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     CoMagic"""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, login, password)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     CoMagic"""</span></span> self.login = login self.password = password self.base_url = <span class="hljs-string"><span class="hljs-string">'https://dataapi.comagic.ru/v2.0'</span></span> self.payload_ = {<span class="hljs-string"><span class="hljs-string">"jsonrpc"</span></span>:<span class="hljs-string"><span class="hljs-string">"2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">"params"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>} self.token = self.get_token(self.login, self.password) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base_request</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, method, params)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     CoMagic.      API   .    JSON-like . : https://www.comagic.ru/support/api/data-api/"""</span></span> id_ = random.randrange(<span class="hljs-number"><span class="hljs-number">10</span></span>**<span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  payload = self.payload_.copy() payload["method"] = method payload["params"] = params payload["id"] = id_ self.r = requests.post(self.base_url, data=json.dumps(payload)) self.last_response = json.loads(self.r.text) return self.last_response def get_token(self, login, password): """   .       .  .""" method = "login.user" params = {"login":self.login, "password":self.password} response = self.base_request(method, params) token = response['result']['data']['access_token'] return token def get_report_per_page(self, method, params): """  .      10000 .    .     110000 .     JSON-like .""" response = self.base_request(method, params) print(f"""  c {params["date_from"]}  {params["date_till"]}.  = {params["offset"]}""") result = response['result']['data'] if len(result) &lt; 10000: return result else: params['offset'] += 10000 add_result = self.get_report_per_page(method, params) return result + add_result def get_basic_report(self, method, fields, date_from, date_till, filter=None, offset=0): """   .       method  fields.       .       ,   ,       . method -- &lt;string&gt;   date_from -- &lt;string&gt;  .  "YYYY-MM-DD hh:mm:ss" date_till -- &lt;string&gt;  .  "YYYY-MM-DD hh:mm:ss" fields -- &lt;list&gt;,    filter [] - &lt;dict&gt;  offset [] -- &lt;int&gt;  return -- &lt;list&gt;  """ params = {"access_token":self.token, "limit":10000, "date_from":date_from, "date_till":date_till, "fields": fields, "offset": offset} if filter: params['filter'] = filter report = self.get_report_per_page(method, params) return report</span></span></code> </pre> <br>  Sekarang Anda perlu menentukan jenis data apa yang dibutuhkan.  Data perlu diproses dan dibuat terlihat sehingga dapat dimuat ke BigQuery. <br><br>  Buat kelas pembantu dan tentukan data yang diterima dari CoMagic. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ComagicHandler</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ComagicClient)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    ,   CoMagic"""</span></span> time_partition_field = <span class="hljs-string"><span class="hljs-string">'PARTITION_DATE'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, login, password, first_call_date)</span></span></span><span class="hljs-function">:</span></span> self.day_before_first_call = pd.to_datetime(first_call_date) - pd.Timedelta(days=<span class="hljs-number"><span class="hljs-number">1</span></span>) super().__init__(login, password) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_calls_report</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, date_from, date_till)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""        .           .    Pandas DataFrame.      .      Connector    .    .    .  Pnadas.DataFrame"""</span></span> method = <span class="hljs-string"><span class="hljs-string">"get.calls_report"</span></span> fields = [<span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-string"><span class="hljs-string">'visitor_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'person_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'start_time'</span></span>, <span class="hljs-string"><span class="hljs-string">'finish_reason'</span></span>, <span class="hljs-string"><span class="hljs-string">'is_lost'</span></span>, <span class="hljs-string"><span class="hljs-string">'tags'</span></span>, <span class="hljs-string"><span class="hljs-string">'campaign_name'</span></span>,<span class="hljs-string"><span class="hljs-string">'communication_number'</span></span>, <span class="hljs-string"><span class="hljs-string">'contact_phone_number'</span></span>, <span class="hljs-string"><span class="hljs-string">'talk_duration'</span></span>, <span class="hljs-string"><span class="hljs-string">'clean_talk_duration'</span></span>, <span class="hljs-string"><span class="hljs-string">'virtual_phone_number'</span></span>, <span class="hljs-string"><span class="hljs-string">'ua_client_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'ym_client_id'</span></span>, <span class="hljs-string"><span class="hljs-string">'entrance_page'</span></span>, <span class="hljs-string"><span class="hljs-string">'gclid'</span></span>, <span class="hljs-string"><span class="hljs-string">'yclid'</span></span>, <span class="hljs-string"><span class="hljs-string">'visitor_type'</span></span>, <span class="hljs-string"><span class="hljs-string">'visits_count'</span></span>, <span class="hljs-string"><span class="hljs-string">'visitor_first_campaign_name'</span></span>, <span class="hljs-string"><span class="hljs-string">'visitor_device'</span></span>, <span class="hljs-string"><span class="hljs-string">'site_domain_name'</span></span>,<span class="hljs-string"><span class="hljs-string">'utm_source'</span></span>, <span class="hljs-string"><span class="hljs-string">'utm_medium'</span></span>, <span class="hljs-string"><span class="hljs-string">'utm_campaign'</span></span>, <span class="hljs-string"><span class="hljs-string">'utm_content'</span></span>, <span class="hljs-string"><span class="hljs-string">'eq_utm_source'</span></span>, <span class="hljs-string"><span class="hljs-string">'eq_utm_medium'</span></span>, <span class="hljs-string"><span class="hljs-string">'eq_utm_campaign'</span></span>, <span class="hljs-string"><span class="hljs-string">'attributes'</span></span>] <span class="hljs-comment"><span class="hljs-comment">#   CoMagic calls_data = self.get_basic_report(method, fields, date_from, date_till) # DataFrame df = pd.DataFrame(calls_data) #    .    . df[self.time_partition_field] = pd.to_datetime(df.start_time).apply(lambda x: x.date()) #  tags,   BigQuery       ,  # CoMagic.    . df['tags'] = df.tags.apply(lambda x: x if x == None else [i['tag_name'] for i in x]) return df</span></span></code> </pre> <br><h2>  Mengirim data ke BigQuery </h2><br>  Setelah data dari CoMagic diterima dan dikonversi, Anda harus mengirimkannya ke BigQuery. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> google.cloud <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> bigquery <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> google.cloud.exceptions <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> NotFound <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BQTableHanler</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     BigQuery"""</span></span> time_partition_field = <span class="hljs-string"><span class="hljs-string">'PARTITION_DATE'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, full_table_id, service_account_file_key_path = None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""       `myproject.mydataset.mytable`.  ,   Application Default Credentials,           ."""</span></span> self.full_table_id = full_table_id project_id, dataset_id, table_id = full_table_id.split(<span class="hljs-string"><span class="hljs-string">"."</span></span>) self.project_id = project_id self.dataset_id = dataset_id self.table_id = table_id <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> service_account_file_key_path: <span class="hljs-comment"><span class="hljs-comment">#      from google.oauth2 import service_account self.credentials = service_account.Credentials.from_service_account_file( service_account_file_key_path, scopes=["https://www.googleapis.com/auth/cloud-platform"],) self.bq_client = bigquery.Client(credentials = self.credentials, project = self.project_id) else: self.bq_client = bigquery.Client() self.dataset = self.bq_client.get_dataset(self.dataset_id) self.location = self.dataset.location self.table_ref = self.dataset.table(self.table_id) def get_last_update(self): """        Pandas datetime.      False.""" try: self.bq_client.get_table(self.full_table_id) except NotFound as error: return False query = f"""SELECT MAX({self.time_partition_field}) as last_call FROM `{self.full_table_id}`""" result = self.bq_client.query(query,location=self.location).to_dataframe() date = pd.to_datetime(result.iloc[0,0]).date() return date def insert_dataframe(self, dataframe): """      BigQuery.     Pandas DataFrame.    ,       .""" job_config = bigquery.LoadJobConfig() #     job_config._properties['load']['timePartitioning'] = {'type': 'DAY', 'field': self.time_partition_field} result = self.bq_client.load_table_from_dataframe(dataframe, self.table_ref, job_config=job_config).result() return result</span></span></code> </pre> <br><h2>  Tentukan logika untuk memperbarui data </h2><br>  Karena ada batasan jumlah baris data yang diterima dari CoMagic, perlu untuk membatasi jumlah data yang diminta.  Kami akan membatasi periode permintaan.  Untuk melakukan ini, Anda memerlukan fungsi bantu yang akan membagi periode waktu besar menjadi segmen-segmen dengan panjang yang ditentukan. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interval_split</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array, interval)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""      .   ,      2,    -   ,     -    . : get_intervals([1,2,3,4,5,6,7], 3) =&gt; [[1,3], [4,6], [7]] get_intervals([1,2,3], 4) =&gt; [[1,3]]"""</span></span> intervals = [] iw, i = <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> l = len(array) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> array: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i==<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (i)%interval==<span class="hljs-number"><span class="hljs-number">0</span></span>: intervals.append([v]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i+<span class="hljs-number"><span class="hljs-number">1</span></span>)%interval == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (i+<span class="hljs-number"><span class="hljs-number">1</span></span>) == l: intervals[iw].append(v) iw+=<span class="hljs-number"><span class="hljs-number">1</span></span> i+=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> intervals</code> </pre> <br>  Ini diperlukan saat memuat data untuk pertama kalinya, saat Anda perlu mengunduh data untuk jangka waktu yang lama.  Periode ini dibagi menjadi beberapa periode kecil.  Ngomong-ngomong, lebih baik melakukan ini tanpa menggunakan Fungsi Cloud, karena mereka memiliki batas waktu.  Baik, atau, sebagai opsi, Anda dapat menjalankan fungsinya berkali-kali. <br><br>  Kami membuat kelas konektor untuk menautkan tabel BigQuery tempat kami ingin menyimpan data dan data dari CoMagic. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> helpfunctions <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> interval_split <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Connector</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""      """</span></span> time_partition_field = <span class="hljs-string"><span class="hljs-string">'PARTITION_DATE'</span></span> <span class="hljs-comment"><span class="hljs-comment">#  -.       def __init__ (self, source, dest): """          """ self.source = source self.dest = dest self.source.time_partition_field = self.time_partition_field self.dest.time_partition_field = self.time_partition_field def insert_data_in_dest(self, start_date, end_date): """      .          ,     .""" dates = pd.date_range(start_date, end_date) week_intervals = interval_split(dates, 7) #     7  for week_interval in week_intervals: date_from = week_interval[0].strftime("%Y-%m-%d") + " 00:00:00" date_till = week_interval[1].strftime("%Y-%m-%d") + " 23:59:59" calls_df = self.source.get_calls_report(date_from, date_till) self.dest.insert_dataframe(calls_df) print (f"  {date_from}  {date_till}   ") return True def update_dest_data(self): #     BigQuery last_date = self.dest.get_last_update() if not last_date: #    last_date = self.source.day_before_first_call yesterday = pd.Timestamp.today(tz='Europe/Moscow').date() - pd.Timedelta(days=1) if last_date == yesterday: print("  ") else: last_date = last_date + pd.Timedelta(days=1) self.insert_data_in_dest(last_date, yesterday) return True</span></span></code> </pre> <br>  Selanjutnya, kami meresepkan fungsi utama untuk memperbarui data, yang akan diluncurkan sesuai jadwal. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> connector <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Connector <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bqhandler <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BQTableHanler <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> comagichandler <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ComagicHandler <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> credfile <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event, context)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    event, context  : https://cloud.google.com/functions/docs/writing/background#functions-writing-background-hello-pubsub-python"""</span></span> <span class="hljs-comment"><span class="hljs-comment">#import base64 #pubsub_message = base64.b64decode(event['data']).decode('utf-8') # c      comagic_handler = ComagicHandler(COMAGIC_LOGIN, COMAGIC_PASSWORD, FIRST_CALL_DATE) bq_handelr = BQTableHanler(full_table_id, google_credintials_key_path) #  connector = Connector(comagic_handler, bq_handelr) #     connector.update_dest_data()</span></span></code> </pre> <br><h2>  Konfigurasikan Google Cloud Platform </h2><br>  Kami mengumpulkan semua file dalam arsip ZIP.  Di file credfile.py, kami memasukkan login dan kata sandi CoMagic untuk menerima token, serta nama lengkap tabel di BigQuery dan jalur ke file akun layanan jika skrip diluncurkan dari mesin lokal. <br><br><h3>  Buat Fungsi Cloud </h3><br><ul><li>  Pergi ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">konsol</a> </li><li>  Jika belum ada fungsi yang dibuat, klik "Buat fungsi" </li><li>  Di bidang pemicu, pilih PUB / SUB </li><li>  Buat tema baru untuk PUB / SUB.  Misalnya, 'update_calls' </li><li>  Sumber: Unggahan ZIP (file ZIP lokal) </li><li>  Lingkungan: Python 3.7 </li><li>  Unduh file zip </li><li>  Memilih segmen sementara Penyimpanan Cloud </li><li>  Di bidang `disebut fungsi` kita menulis 'utama' </li><li>  Memori yang dialokasikan: opsional </li></ul><br><img src="https://habrastorage.org/webt/vf/im/kk/vfimkkyd9b9zzmtvzzi3ibfxu_o.png"><br><br><h3>  Mengkonfigurasi Penjadwal dan PUB / SUB </h3><br>  Pada langkah terakhir, kami membuat pemicu `update_calls`.  Topik otomatis ini telah muncul dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">daftar topik</a> . <br><img src="https://habrastorage.org/webt/c2/il/lr/c2illresxku-ax6tojs8dwc_txs.png"><br>  Sekarang, dengan Cloud Scheduler Anda perlu mengonfigurasi pelatuk.  kapan akan menyala dan GCF akan mulai. <br><br><ul><li>  Pergi ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">konsol</a> </li><li>  Di bidang frekuensi dalam format CRON, atur kapan pelatuk akan diaktifkan dan fungsi dimulai. </li><li>  Tujuan: Pub / Sub </li><li>  Subjek: daftarkan tema yang ditentukan saat membuat fungsi: "update_calls" </li><li>  Payloads * (Payloads) - ini adalah informasi yang akan ditransfer ke Pub / Sub dan ke fungsi utama </li></ul><br><img src="https://habrastorage.org/webt/im/py/uo/impyuoar2-db0vanz8p5iylpahk.png"><br><br>  Sekarang skrip akan diluncurkan setiap hari pada pukul 01:00 dan data panggilan akan diperbarui pada akhir hari sebelumnya. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tautan</a> ke GitHub untuk dijalankan dari komputer lokal <br>  GitHub <a href="">Tautan</a> ke File ZIP </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id475804/">https://habr.com/ru/post/id475804/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id475784/index.html">Mengukur kualitas kode aplikasi Android dengan Sonarqube dan Jacoco pada tahun 2019</a></li>
<li><a href="../id475788/index.html">"Rupanya, ada pertempuran besar di depan." Apa yang menanti industri TI dalam waktu dekat</a></li>
<li><a href="../id475790/index.html">Startup yang bisa mengejutkan</a></li>
<li><a href="../id475796/index.html">Stack Overflow Mengubah Kebijakan Reputasi untuk Masalah</a></li>
<li><a href="../id475802/index.html">Bagaimana membuat Harian / Stand-up tidak terlihat seperti pertemuan status?</a></li>
<li><a href="../id475808/index.html">GitHub telah membuat repositori berusia ribuan tahun yang akan menyimpan repositori Open Source untuk anak cucu</a></li>
<li><a href="../id475810/index.html">Bagaimana 82.000 ton cadangan nuklir Uni Soviet akan diekspor dari Ural</a></li>
<li><a href="../id475812/index.html">Cara tetap gila di Ruang Terbuka: membuat kantor baru dari awal</a></li>
<li><a href="../id475814/index.html">Transformasi Docker: menjual Docker Enterprise di Mirantis dan jalur yang diperbarui</a></li>
<li><a href="../id475816/index.html">Xcode 11 dan XCFrameworks: format kemasan kerangka kerja baru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>