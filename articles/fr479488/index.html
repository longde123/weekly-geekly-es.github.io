<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òÉÔ∏è üèáüèª ü§ì D'un ordinateur portable - un serveur domestique avec alimentation redondante au routeur Mikrotik üë®‚Äçüëß‚Äçüë¶ üé∞ üíá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bri√®vement 
 Un article pour les fans afin de souder eux-m√™mes des sch√©mas simples et de comprendre pourquoi ils sont fabriqu√©s de cette fa√ßon. 

 Et ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D'un ordinateur portable - un serveur domestique avec alimentation redondante au routeur Mikrotik</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479488/"><img src="https://habrastorage.org/webt/pl/gi/hh/plgihhkmxbo7cvnzhnbtwwdi85w.jpeg"><br><br><h1>  Bri√®vement </h1><br>  Un article pour les fans afin de souder eux-m√™mes des sch√©mas simples et de comprendre pourquoi ils sont fabriqu√©s de cette fa√ßon. <br><br>  Et aussi pour ceux qui ont vraiment besoin d'un tel serveur. <br><br>  Il n'y a pas de super r√©alisations ici, mais il existe une solution bon march√©, compacte et √©conomique, qui dans certains cas remplace un √©quipement volumineux: <br><br><ul><li>  fait un serveur domestique √† partir d'un vieil ordinateur portable et d'un appareil d'alimentation de routeur, </li><li>  a expliqu√© le sch√©ma d'alimentation du routeur √† partir de la charge et de la batterie de l'ordinateur portable, </li><li>  Le sch√©ma de mise sous tension de l'ordinateur portable √† la mise sous tension est expliqu√©. </li></ul><a name="habracut"></a><br><h1>  Id√©e </h1><br>  J'avais besoin d'un petit serveur de fichiers, qui devait √©galement r√©sister √† des pannes de courant allant jusqu'√† 15 minutes. <br><br>  J'ai d√©cid√© de le faire √† partir d'un vieil ordinateur portable. <br><br>  Un ordinateur portable (Asus A8J) a √©t√© sp√©cialement achet√© pour l'exp√©rience avec une matrice cass√©e, mais avec une batterie et un ventilateur en direct. <br><br>  <i>(Remarque: si vous avez d√©j√† un ordinateur portable, alors, comme dans la t√¢che bien connue concernant la bouilloire, il n'est pas n√©cessaire de casser la matrice. Cependant, si votre routeur, comme le mien, fonctionne avec un modem 4G, il est pr√©f√©rable de d√©sactiver la matrice, alors je vais vous expliquer pourquoi.</i> <i><br><br></i>  <i>Travailler sans matrice ne cr√©e aucun inconfort, utilisez d'abord un moniteur externe, puis SSH.)</i> <br><br>  Dans le processus, j'ai attir√© l'attention sur le fait que le routeur Mikrotik (j'ai RB-951G) peut √™tre aliment√© de 9 √† 30 V, et l'id√©e est venue de l'alimenter √† partir d'un ordinateur portable. <br><br>  Il s'est av√©r√© √™tre une combinaison tr√®s r√©ussie: en pr√©sence de tension secteur, le routeur est aliment√© par le chargeur d'ordinateur portable (19-20 V), et en cas de panne de courant, par la batterie du m√™me ordinateur portable (de 12 √† 9 V lorsqu'il est d√©charg√©), c'est-√†-dire  tout est dans les limites normales. <br><br>  <i>Plus pr√©cis√©ment, la tension sur le routeur sera inf√©rieure de 0,2 √† 0,4 V en raison d'une chute sur les diodes, mais toujours dans la plage acceptable (√† l'exception de la limite inf√©rieure de d√©charge de la batterie, que nous ne connaissons pas avec certitude, mais dans mon cas, il est peu probable qu'elle l'atteigne .</i> <i><br><br></i>  <i>Et si c'est le cas, alors rien de terrible n'arrivera au routeur).</i> <br><br><h1>  Sch√©ma d'alimentation du routeur </h1><br><img src="https://habrastorage.org/webt/x8/ym/3x/x8ym3xsabcnw62ea6dmynhylwic.jpeg"><br><br>  Puisqu'une tension plus √©lev√©e (20V) a ici la priorit√©, le circuit de commutation est tr√®s simple, de deux diodes. <br><br>  Il est √©galement pratique qu'aucune protection de tension ne soit n√©cessaire. <br><br>  En cas de longue absence du r√©seau, la batterie sera d√©charg√©e √† la limite √† laquelle son contr√¥leur int√©gr√© d√©connectera la charge et ainsi aucune d√©charge excessive ne se produira. <br><br>  Ensuite, lorsque l'alimentation secteur est appliqu√©e, la batterie commence √† se charger et le routeur est aliment√© par le chargeur. <br><br>  <i>Th√©oriquement, en cas d'√©chec, nous pouvons d√©passer le courant admissible du chargeur et / ou de la batterie (car nous apportons le 0,4-0,8 A suppl√©mentaire au routeur √† 20 V), mais en pratique, le courant excessif ne se produira pas, et voici pourquoi: j'ai retir√© le lecteur de DVD de l'ordinateur portable, du contr√¥leur WIFI, ainsi que la matrice.</i>  <i>En cons√©quence, la consommation actuelle a diminu√©.</i> <br><br>  Pour r√©duire les pertes de tension, nous s√©lectionnons les diodes Schottky, et plus pr√©cis√©ment, j'ai pris un assemblage de deux diodes (je ne me souviens pas du type), qui se trouve dans les alimentations informatiques et ressemble √† un transistor puissant. <br><br>  <i>La consommation actuelle du routeur avec le modem 4G inclus peut atteindre 1,7 A dans le pire des cas - lorsqu'il est aliment√© √† partir de 9 V.</i> <i><br><br></i>  <i>(L'alimentation de commutation √† l'int√©rieur du routeur consomme une puissance constante, donc plus la tension d'entr√©e est basse, plus la consommation de courant est √©lev√©e).</i> <br><br>  Les diodes d'assemblage supportent un courant continu de 20A, ce qui est √©galement pratique. <br><br>  Vous n'avez pas besoin de prot√©ger contre les courts-circuits de sortie.  Ce r√¥le, le cas √©ch√©ant, sera jou√© par les circuits internes de charge et de protection de la batterie. <br><br>  Si quelqu'un veut utiliser des diodes Schottky distinctes, vous devez les prendre pour un courant d'au moins 5A et au moins l√©g√®rement cool, par exemple, √† travers les pistes de la carte. <br><br><h1>  Circuit d'ordinateur portable </h1><br><img src="https://habrastorage.org/webt/tz/lz/aw/tzlzawj3w4knkung90wa0vakney.jpeg"><br><br>  Mais il y avait un autre probl√®me: l'ordinateur portable lui-m√™me ne s'allume pas lorsque la tension secteur appara√Æt.  <i>Il n'y a pas une telle option dans le BIOS.</i>  <i>(Pour une raison quelconque, de nombreux ordinateurs portables n'ont pas un certain nombre de fonctions utiles, par exemple, ils n'ont toujours pas de d√©marrage √† partir de la carte m√©moire).</i> <br><br>  Bien que de telles interruptions afin de d√©charger compl√®tement la batterie, nous n'arrivons pratiquement pas, mais je voulais d√©j√† terminer cette question. <br><br>  Sur mon ordinateur portable, le bouton d'alimentation ferme l'entr√©e du circuit √† moins d'√©nergie (la v√¥tre, tr√®s probablement aussi). <br><br>  √Ä la m√™me entr√©e, j'ai soud√© le fil du connecteur de mon appareil. <br><br>  Dans l'appareil, cette entr√©e est ferm√©e par un transistor moins, l'ordinateur portable s'allume. <br><br>  Pour prot√©ger le transistor en cas de mauvaise connexion, une r√©sistance R8 a √©t√© ajout√©e au circuit collecteur. <br><br>  Il est v√©rifi√© que l'ordinateur portable s'allume de mani√®re stable m√™me avec une augmentation de 3 fois de cette r√©sistance.  (Il est √©galement pr√©f√©rable de v√©rifier votre ordinateur portable, car les param√®tres d'entr√©e du bouton peuvent varier). <br><br>  Pour contr√¥ler le transistor, un g√©n√©rateur d'impulsions RC a √©t√© fabriqu√© sur une puce CD4093 avec des d√©clencheurs Schmitt et des √©l√©ments R4, R5, C3.  La dur√©e de l'impulsion et de la pause pendant environ 1 s, la pr√©cision n'est pas importante. <br><br>  Il est important que le fonctionnement du g√©n√©rateur commence par une pause. <br><br>  <i>Et voici pourquoi j'ai cr√©√© un g√©n√©rateur d'impulsions: mon ordinateur portable ne s'allumait parfois pas lorsque j'appuyais sur le bouton pour la premi√®re fois, mais il s'allumait lorsque j'appuyais sur le second, je ne sais pas pourquoi.</i>  <i>En tout cas, il s'est av√©r√© une solution universelle et fiable.</i> <br><br>  Lorsque l'ordinateur portable est allum√©, vous n'avez plus besoin d'appuyer sur le bouton et nous arr√™tons le g√©n√©rateur. <br><br>  Le circuit apprend √† allumer l'ordinateur portable √† l'aide d'un autre fil soud√© √† + 5V de n'importe quel connecteur USB. <br><br>  <i>Mon ordinateur portable ne fournit que + 5 V √† USB lorsqu'il est allum√©.</i> <i><br><br></i>  <i>(Si votre tension USB est toujours pr√©sente lorsqu'elle est aliment√©e par le r√©seau, vous devez d√©sactiver l'option correspondante dans le BIOS ou rechercher un autre point de connexion pour ce signal).</i> <br>  Le microcircuit est aliment√© par l'entr√©e + 20 V via le stabilisateur le plus simple de R1 et VD3, et C2 juste au cas o√π il se prot√©gerait des impulsions de puissance. <br><br>  L'alimentation de ce circuit √† partir de + 5V USB a √©galement √©t√© effectu√©e de sorte que lorsque l'alimentation secteur tombe en panne, l'alimentation du g√©n√©rateur ne diminue pas et de fausses impulsions se forment qui peuvent √©teindre l'ordinateur portable. <br><br>  Les deux alimentations sont fournies au microcircuit via le circuit le plus simple sur deux diodes VD1, VD2, les m√™mes que sur le routeur, mais √† tr√®s faible puissance. <br><br><h1>  La construction </h1><br><img src="https://habrastorage.org/webt/bg/i3/eb/bgi3ebghkos-hpssa5w7wrsrsie.jpeg"><br><br>  Le connecteur est √† 10 broches: PLD-10 + PBD-10, 2 fils en parall√®le sont utilis√©s sur les fils d'alimentation. <br><br>  Sur les 4 restants, deux sont occup√©s par l'entr√©e du bouton et + 5V USB, 2 de plus ne sont pas utilis√©s. <br><br>  <i>L'emplacement des contacts est choisi de sorte que si vous allumez le connecteur en position invers√©e, alors rien ne br√ªlera, le routeur sera aliment√© et la fonction pour allumer l'ordinateur portable ne fonctionnera pas.</i> <br><br>  Le dispositif est assembl√© sur une planche √† pain et plac√© dans un tube thermor√©tractable. <br><br>  Aucun refroidissement suppl√©mentaire n'est requis. <br>  Vous pouvez le placer dans le compartiment o√π se trouvait le lecteur de DVD. <br>  Les pi√®ces peuvent √™tre remplac√©es par des analogues dans une tr√®s large gamme. <br>  Je ne donne pas de photo g√©n√©rale, car  ordinateurs portables cass√©s et donc ils l'ont tous vu. <br><br><h1>  Qu'est-il arriv√©? </h1><br><img src="https://habrastorage.org/webt/q0/ym/hx/q0ymhxprycrw8yq0wg_h-szf8ue.jpeg"><br><br>  Cela fonctionne depuis un mois. <br><br>  Consommation d'au moins 13 watts (mesur√©e par un compteur √©lectrique), avec un travail actif passant √† 25 watts. <br><br>  2 probl√®mes mat√©riels ont √©t√© d√©tect√©s: <br><br>  Glitch n ¬∞ 1: si vous d√©sactivez le connecteur de charge de l'ordinateur portable, l'ordinateur portable s'√©teint parfois instantan√©ment. <br><br>  <i>Tr√®s probablement, cela est d√ª au fait que j'ai fait passer le fil de la charge √† l'appareil directement sur la carte, et m√™me avec + 5V USB et le fil du bouton.</i> <i><br><br></i>  <i>Lorsque vous d√©connectez le connecteur de charge sur le fil, une s√©rie d'impulsions plut√¥t ¬´raides¬ª passe de +19 √† + 12V et vice versa, et m√™me avec un ¬´rebond¬ª, et cela √† travers la capacit√© des fils peut interf√©rer avec d'autres circuits d'ordinateur portable.</i> <i><br><br></i>  <i>Mais alors, si vous ne d√©connectez pas ce connecteur et d√©connectez la charge du r√©seau, rien de mauvais ne se produit.</i>  <i>Apparemment, la tension sur le fil est lente √† cause des condensateurs dans la charge et aucune interf√©rence ne se produit.</i> <br><br>  Je n'ai pas r√©par√© l'installation, mais en g√©n√©ral, bien s√ªr, cela ne vaut pas la peine de poser les fils sur la carte de circuit comme je l'ai fait.  Ils doivent en quelque sorte √™tre prot√©g√©s ou transport√©s √† l'ext√©rieur de l'ordinateur portable ou au moins loin de la carte.  (C‚Äôest un peu que le fait que tous mes fils soient √† tension constante). <br>  Ajout du condensateur C1 entre le moins et le plus de la charge, il semble que le p√©pin n ¬∞ 1 ait disparu. <br><br>  Glitch n ¬∞ 2: l'ordinateur portable n'a pas pu √™tre √©teint avec un bouton. <br><br>  Pour √©teindre correctement l'ordinateur portable, coupez d'abord l'alimentation (au cas o√π, d√©connectez la charge du r√©seau, pas de l'ordinateur portable, comme nous le savons d√©j√† par l'exp√©rience pr√©c√©dente). <br>  Et puis nous appuyons sur le bouton d'alimentation.  Le syst√®me d'exploitation s'arr√™te et √©teint l'ordinateur portable. <br><br>  MAIS.  √Ä ce moment, il y a encore de la tension sur les condensateurs d'alimentation USB (en l'absence d'appareils consommateurs) dans l'ordinateur portable, il s'assoit lentement et √† un moment donn√©, le circuit donne une fausse impulsion au bouton et l'ordinateur portable se rallume! <br><br>  <i>Pour √©viter que cela ne se produise, une r√©sistance R2 a √©t√© ajout√©e, qui parvient √† d√©charger les condensateurs en une seconde, et tout est devenu normal.</i>  <i>Si vous avez un tel probl√®me, alors la r√©sistance doit √™tre r√©duite d'un facteur 2. Cela ne vaut pas la peine de faire la r√©sistance trop basse, car</i>  <i>il se pr√©lassera.</i> <i><br><br></i>  <i>Cela n'ajoute pratiquement pas de consommation d'√©nergie.</i> <br><br><h1>  OS et programmes </h1><br>  J'ai install√© le serveur Ubuntu 14.04 et configur√© la samba, tout fonctionne et cela suffit pour l'instant. <br><br>  Il y avait les inconv√©nients suivants: <br><br>  1) Le ventilateur de l'ordinateur portable √©tait tr√®s bruyant quelle que soit la charge du processeur. <br><br>  J'ai essay√© le programme fancontrol, mais elle n'a pas pu acc√©der au contr√¥le du ventilateur. <br>  En train de creuser Internet, un autre programme a √©t√© trouv√©: asusfan, qui aimait les gens sp√©cialement pour mon mod√®le d'ordinateur portable.  Cela a fonctionn√© imm√©diatement apr√®s la compilation et l'installation, et maintenant le ventilateur est automatiquement r√©gul√© et fait peu de bruit, et la ressource est √©conomis√©e. <br><br>  2) Il est impossible d'arr√™ter le disque dur pour la nuit avec la commande hdparm -S 241 / dev / sda. <br><br>  Le programme de journalisation jbd2 le ¬´tire¬ª toutes les 5 √† 10 minutes, m√™me lorsqu'aucune action n'a √©t√© effectu√©e pendant une heure. <br><br>  Les forums √©crivent qu'il s'agit d'un probl√®me irr√©cup√©rable avec le syst√®me de fichiers ext4 ou son impl√©mentation dans Ubuntu. <br><br>  Ensuite, je vais essayer de passer √† xfs (ou peut-√™tre √† SSD), mais pour l'instant - "Et c'est ainsi!" (C). <br><br><h1>  Autres id√©es (qui resteront √† ce stade) </h1><br><ul><li>  Cr√©ez un circuit ind√©pendant sur certains appareils comme le ¬´relais GSM¬ª pour red√©marrer le syst√®me. </li><li>  Cr√©ez sur le m√™me appareil GSM un circuit pour connecter √† distance un lecteur flash USB avec un syst√®me de ¬´sauvegarde¬ª afin de pouvoir d√©marrer √† partir de celui-ci et corriger quelque chose dans la configuration si le syst√®me principal ne d√©marre pas. </li></ul><br>  Pourquoi via GSM, pas Ethernet? <br><br>  Tout d'abord, √† cause des vuln√©rabilit√©s possibles des contr√¥leurs Ethernet, dont j'ai entendu parler quelque part. <br>  Deuxi√®mement, vous devrez peut-√™tre red√©marrer le routeur, c'est-√†-dire  besoin d'un r√©gime ind√©pendant. <br><br>  Mais les routeurs Mikrotik √† cet √©gard sont assez fiables et donc ce n'est en fait pas n√©cessaire, et le serveur semble √©galement fonctionner sans poser de questions. <br><br><h1>  Remerciements </h1><br>  Le routeur m'a aid√© (√† 99%) √† configurer le camarade @rifei, merci beaucoup √† lui. <br><br>  Et aussi √† tous ceux qui ont √©crit des instructions sur Internet telles que "comment ex√©cuter le programme sur Ubuntu 14.04", etc., car je suis moi-m√™me une th√©i√®re compl√®te dans ce domaine, mais en lisant 100500 de telles instructions, j'ai r√©ussi √† tout configurer. <br><br>  Et s√©par√©ment - √† ceux qui ont cr√©√© et publi√© toutes sortes de programmes utiles, mentionn√©s et non mentionn√©s ici. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr479488/">https://habr.com/ru/post/fr479488/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr479474/index.html">Pourquoi l'auto-organisation des √©quipes est-elle si importante dans Scrum et pourquoi il ne peut y avoir de managers</a></li>
<li><a href="../fr479478/index.html">Plug-in Java sans douleur</a></li>
<li><a href="../fr479480/index.html">SDK SARIF et ses erreurs</a></li>
<li><a href="../fr479482/index.html">SDK SARIF et ses erreurs</a></li>
<li><a href="../fr479486/index.html">Programmation h√©t√©rog√®ne et oneAPI Toolkit. Une conf√©rence improvis√©e d'experts Intel r√©pond √† vos questions</a></li>
<li><a href="../fr479492/index.html">Informatique sans serveur bas√©e sur OpenWhisk, partie 3</a></li>
<li><a href="../fr479496/index.html">Analyse des t√¢ches WTF en JavaScript</a></li>
<li><a href="../fr479498/index.html">Comment le temps lin√©aire se transforme en Windows en O (n¬≤)</a></li>
<li><a href="../fr479502/index.html">Comment survivre √† la p√©riode glaciaire la plus s√©v√®re de l'histoire de la Terre?</a></li>
<li><a href="../fr479504/index.html">Cr√©er un client l√©ger RDP bas√© sur Raspberry Pi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>