<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“’ ğŸ¤¾ğŸ¾ ğŸ‘©ğŸ¼â€ğŸ”§ åœ¨Unityä¸­å®ç°çŠ¶æ€æ¨¡æ¿ ğŸ‘©ğŸ½â€âš•ï¸ ğŸŒ‹ âœ‹ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨å¯¹æ¸¸æˆä¸­å®ä½“è¿›è¡Œç¼–ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µï¼šå®ƒä»¬å¿…é¡»åœ¨ä¸åŒæ¡ä»¶ä¸‹ä»¥ä¸åŒæ–¹å¼è¡ŒåŠ¨ï¼Œè¿™è¡¨æ˜ä½¿ç”¨çŠ¶æ€ ã€‚ 

 ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å†³å®šä½¿ç”¨è›®åŠ›ï¼Œä»£ç å°†å¾ˆå¿«å˜æˆæ··ä¹±çš„æ··ä¹±çŠ¶æ€ï¼Œå…¶ä¸­åŒ…å«è®¸å¤šåµŒå¥—çš„if-elseè¯­å¥ã€‚ 

 ä¸ºè§£å†³æ­¤é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨Stateè®¾è®¡æ¨¡å¼ã€‚ æˆ‘ä»¬å°†æŠŠæœ¬æ•™ç¨‹å¥‰çŒ®ç»™ä»–ï¼ 

 åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>åœ¨Unityä¸­å®ç°çŠ¶æ€æ¨¡æ¿</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484176/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fa/bf6/c19/4fabf6c19761d028d621903401a84746.png" alt="å›¾ç‰‡"></div><br> åœ¨å¯¹æ¸¸æˆä¸­å®ä½“è¿›è¡Œç¼–ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µï¼šå®ƒä»¬å¿…é¡»åœ¨ä¸åŒæ¡ä»¶ä¸‹ä»¥ä¸åŒæ–¹å¼è¡ŒåŠ¨ï¼Œè¿™è¡¨æ˜ä½¿ç”¨<i>çŠ¶æ€</i> ã€‚ <br><br> ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å†³å®šä½¿ç”¨è›®åŠ›ï¼Œä»£ç å°†å¾ˆå¿«å˜æˆæ··ä¹±çš„æ··ä¹±çŠ¶æ€ï¼Œå…¶ä¸­åŒ…å«è®¸å¤šåµŒå¥—çš„if-elseè¯­å¥ã€‚ <br><br> ä¸ºè§£å†³æ­¤é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨Stateè®¾è®¡æ¨¡å¼ã€‚ æˆ‘ä»¬å°†æŠŠæœ¬æ•™ç¨‹å¥‰çŒ®ç»™ä»–ï¼ <br><br> åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨ï¼š <br><br><ul><li> äº†è§£Unityä¸­Stateæ¨¡æ¿çš„åŸºç¡€ã€‚ </li><li> æ‚¨å°†äº†è§£ä»€ä¹ˆæ˜¯çŠ¶æ€æœºä»¥åŠä½•æ—¶ä½¿ç”¨å®ƒã€‚ </li><li> äº†è§£å¦‚ä½•ä½¿ç”¨è¿™äº›æ¦‚å¿µæ¥æ§åˆ¶è§’è‰²çš„åŠ¨ä½œã€‚ </li></ul><br><blockquote>  <em>æ³¨æ„</em> ï¼šæœ¬æ•™ç¨‹é€‚ç”¨äºé«˜çº§ç”¨æˆ·ï¼› å‡è®¾æ‚¨å·²ç»çŸ¥é“å¦‚ä½•åœ¨Unityä¸­å·¥ä½œï¼Œå¹¶ä¸”å…·æœ‰Cï¼ƒçš„å¹³å‡çŸ¥è¯†æ°´å¹³ã€‚ æ­¤å¤–ï¼Œæœ¬æ•™ç¨‹ä½¿ç”¨Unity 2019.2å’ŒCï¼ƒ7ã€‚ </blockquote><a name="habracut"></a><br><h2> å¼€å§‹å·¥ä½œ </h2><br> ä¸‹è½½<a href="">é¡¹ç›®èµ„æ–™</a> ã€‚ è§£å‹ç¼©<em>zipæ–‡ä»¶ï¼Œ</em>ç„¶ååœ¨Unityä¸­æ‰“å¼€<em>starter</em>é¡¹ç›®ã€‚ <br><br> é¡¹ç›®ä¸­æœ‰å‡ ä¸ªæ–‡ä»¶å¤¹å¯ä»¥å¸®åŠ©æ‚¨å…¥é—¨ã€‚  <em>Assets / RW</em>æ–‡ä»¶å¤¹åŒ…å«<em>Animations</em> ï¼Œ <em>Materials</em> ï¼Œ <em>Models</em> ï¼Œ <em>Prefabs</em> ï¼Œ <em>Resources</em> ï¼Œ <em>Scenes</em> ï¼Œ <em>Scripts</em>å’Œ<em>Sounds</em>æ–‡ä»¶å¤¹ï¼Œå¹¶æ ¹æ®å®ƒä»¬åŒ…å«çš„èµ„æºè¿›è¡Œå‘½åã€‚ <br><br> ä¸ºäº†å®Œæˆæœ¬æ•™ç¨‹ï¼Œæˆ‘ä»¬å°†ä»…ä½¿ç”¨<em>Scenes</em>å’Œ<em>Scripts</em> ã€‚ <br><br> è½¬åˆ°<em>RW /åœºæ™¯</em>å¹¶æ‰“å¼€<em>Main</em> ã€‚ åœ¨æ¸¸æˆæ¨¡å¼ä¸‹ï¼Œæ‚¨å°†åœ¨ä¸­ä¸–çºªåŸå ¡å†…çš„å¼•æ“ç›–ä¸­çœ‹åˆ°ä¸€ä¸ªè§’è‰²ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/478/f1b/4e1/478f1b4e1ec3a2e8702e365e4082a605.png"></div><br> å•å‡»<em>æ’­æ”¾</em> ï¼Œæ³¨æ„<em>ç›¸æœº</em>å¦‚ä½•ç§»åŠ¨ä»¥é€‚åˆ<em>è§’è‰²</em>æ¡†ã€‚ ç›®å‰ï¼Œåœ¨æˆ‘ä»¬çš„å°æ¸¸æˆä¸­æ²¡æœ‰äº¤äº’ï¼Œæˆ‘ä»¬å°†åœ¨æ•™ç¨‹ä¸­è¿›è¡Œå¤„ç†ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ba3/62c/536/ba362c53682371294f90576b5fd5adc6.gif"></div><br><h2> æ¢ç´¢è§’è‰² </h2><br> åœ¨<em>å±‚æ¬¡ç»“æ„ä¸­ï¼Œ</em>é€‰æ‹©<em>å­—ç¬¦</em> ã€‚ æ£€æŸ¥æ£€æŸ¥<em>å™¨</em> ã€‚ æ‚¨å°†çœ‹åˆ°ä¸€ä¸ªåŒ…å«<em>Character</em>æ§åˆ¶é€»è¾‘çš„åŒå<em>ç»„ä»¶</em> ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/957/ffd/2ba/957ffd2ba0299d4b509b75bedb094581.png"></div><br> æ‰“å¼€ä½äº<em>RW /è„šæœ¬ä¸­çš„</em> <em>Character.cs</em> ã€‚ <br><br> è¯¥è„šæœ¬æ‰§è¡Œè®¸å¤šæ“ä½œï¼Œä½†æ˜¯å…¶ä¸­å¤§å¤šæ•°å¯¹æˆ‘ä»¬å¹¶ä¸é‡è¦ã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ³¨æ„ä»¥ä¸‹æ–¹æ³•ã€‚ <br><br><ul><li> <code>Move</code> ï¼šå®ƒç§»åŠ¨è§’è‰²ï¼Œæ¥æ”¶float <code>speed</code>ç±»å‹çš„å€¼ä½œä¸ºç§»åŠ¨é€Ÿåº¦ï¼Œ <code>rotationSpeed</code>ç±»å‹çš„å€¼ä½œä¸ºè§’é€Ÿåº¦ã€‚ </li><li>  <code>ResetMoveParams</code> ï¼šæ­¤æ–¹æ³•é‡ç½®ç”¨äº<i>åŠ¨ç”»åŒ–</i>è§’è‰²<i>çš„è¿åŠ¨</i>å’Œè§’é€Ÿåº¦çš„å‚æ•°ã€‚ å®ƒä»…ç”¨äºæ¸…æ´ã€‚ </li><li>  <code>SetAnimationBool</code> ï¼šå°†Boolç±»å‹çš„<code>param</code>åŠ¨ç”»å‚æ•°è®¾ç½®ä¸ºvalueã€‚ </li><li>  <code>CheckCollisionOverlap</code> ï¼šå®ƒæ¥æ”¶ä¸€ä¸ª<code>Vector3</code>ç±»å‹çš„<code></code>å¹¶è¿”å›ä¸€ä¸ª<code>bool</code> ï¼Œè¯¥<code>bool</code>ç¡®å®šä»è¯¥<code></code>çš„æŒ‡å®šåŠå¾„å†…æ˜¯å¦æœ‰ä»»ä½•ç¢°æ’ä½“ã€‚ </li><li>  <code>TriggerAnimation</code> ï¼š <code>TriggerAnimation</code>è¾“å…¥<code>param</code>åŠ¨ç”»å‚æ•°ã€‚ </li><li>  <code>ApplyImpulse</code> ï¼šå¯¹Character <code>ApplyImpulse</code>è„‰å†²ï¼Œ <code>ApplyImpulse</code>è„‰å†²ç­‰äº<code>Vector3</code>ç±»å‹çš„è¾“å…¥å‚æ•°<code>force</code> ã€‚ </li></ul><br> åœ¨ä¸‹é¢ï¼Œæ‚¨å°†çœ‹åˆ°è¿™äº›æ–¹æ³•ã€‚ åœ¨æˆ‘ä»¬çš„æ•™ç¨‹ä¸­ï¼Œå®ƒä»¬çš„å†…å®¹å’Œå†…éƒ¨å·¥ä½œå¹¶ä¸é‡è¦ã€‚ <br><br><h2> ä»€ä¹ˆæ˜¯çŠ¶æ€æœº </h2><br> çŠ¶æ€æœºæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œå…¶ä¸­å®¹å™¨åœ¨ç»™å®šçš„æ—¶é—´å­˜å‚¨ä¸œè¥¿çš„çŠ¶æ€ã€‚ åŸºäºè¾“å…¥æ•°æ®ï¼Œå®ƒå¯ä»¥æ ¹æ®å½“å‰çŠ¶æ€æä¾›ç»“è®ºï¼Œå¹¶å°†æ­¤è¿‡ç¨‹ä¼ é€’åˆ°æ–°çŠ¶æ€ã€‚ çŠ¶æ€æœºå¯ä»¥è¡¨ç¤ºä¸º<a href="https://www.geeksforgeeks.org/unified-modeling-language-uml-state-diagrams/" rel="noopener">çŠ¶æ€å›¾</a> ã€‚ å‡†å¤‡çŠ¶æ€å›¾ä½¿æ‚¨å¯ä»¥è€ƒè™‘ç³»ç»Ÿçš„æ‰€æœ‰å¯èƒ½çŠ¶æ€ä»¥åŠå®ƒä»¬ä¹‹é—´çš„è¿‡æ¸¡ã€‚ <br><br><h3> çŠ¶æ€æœº </h3><br>  <em>æœ‰é™çŠ¶æ€æœº</em>æˆ–<em>FSMï¼ˆæœ‰é™çŠ¶æ€æœºï¼‰</em>æ˜¯å››ä¸ªä¸»è¦çš„<em>æœºå™¨</em>å®¶æ—ä¹‹ä¸€ã€‚ è‡ªåŠ¨æœºæ˜¯ç®€å•æœºå™¨çš„æŠ½è±¡æ¨¡å‹ã€‚ åœ¨<a href="https://cs.stanford.edu/people/eroberts/courses/soco/projects/2004-05/automata-theory/basics.html" rel="noopener"><em>è‡ªåŠ¨æœº</em></a>ç†è®ºï¼ˆè®¡ç®—æœºç§‘å­¦çš„ç†è®ºåˆ†æ”¯ï¼‰çš„æ¡†æ¶å†…ç ”ç©¶å®ƒä»¬ã€‚ <br><br> ç®€è€Œè¨€ä¹‹ï¼š <br><br><ul><li>  FSMç”±æœ‰é™æ•°é‡çš„<em>æ¡ä»¶ç»„æˆ</em> ã€‚ åœ¨ä»»ä½•ç»™å®šæ—¶é—´<em>ï¼Œ</em>è¿™äº›çŠ¶æ€ä¸­åªæœ‰ä¸€ä¸ª<em>å¤„äºæ´»åŠ¨çŠ¶æ€</em> ã€‚ </li><li> æ¯ä¸ªçŠ¶æ€æ ¹æ®æ”¶åˆ°çš„<em>ä¼ å…¥ä¿¡æ¯</em>åºåˆ—ç¡®å®šå®ƒå°†è¿›å…¥<em>è¾“å‡º</em>çš„çŠ¶æ€ã€‚ </li><li> è¾“å‡ºçŠ¶æ€å˜ä¸ºæ–°çš„æ´»åŠ¨çŠ¶æ€ã€‚ æ¢å¥è¯è¯´ï¼Œ <em>çŠ¶æ€ä¹‹é—´</em>å­˜åœ¨<em>è¿‡æ¸¡</em> ã€‚ </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c43/111/f04/c43111f045f3727ab5f3b02c05c6ecc2.png"></div><br> ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸€ç‚¹ï¼Œè¯·è€ƒè™‘åœ°é¢å¹³å°æ¸¸æˆçš„ç‰¹å¾ã€‚ è§’è‰²å¤„äº<i>ç«™ç«‹</i>çŠ¶æ€ã€‚ è¿™å°†æ˜¯ä»–çš„<em>æ´»åŠ¨çŠ¶æ€ï¼Œ</em>ç›´åˆ°ç©å®¶æŒ‰ä¸‹æŒ‰é’®ä»¥ä½¿è§’è‰²è·³è·ƒä¸ºæ­¢ã€‚ <br><br>  <i>ç«™ç«‹</i>çŠ¶æ€å°†æŒ‰é’®çš„æŒ‰ä¸‹æ ‡è¯†ä¸ºé‡è¦<em>è¾“å…¥ï¼Œ</em>å¹¶ä¸”ä½œä¸º<em>è¾“å‡º</em> ï¼Œåˆ‡æ¢åˆ°<i>è·³è·ƒ</i>çŠ¶æ€ã€‚ <br><br> å‡è®¾å­˜åœ¨ä¸€å®šæ•°é‡çš„è¿™ç§è¿åŠ¨çŠ¶æ€ï¼Œå¹¶ä¸”è§’è‰²ä¸€æ¬¡åªèƒ½å¤„äºä¸€ç§çŠ¶æ€ã€‚ è¿™æ˜¯FSMçš„ç¤ºä¾‹ã€‚ <br><br><h3> åˆ†å±‚çŠ¶æ€æœº </h3><br> è€ƒè™‘ä¸€ä¸ªä½¿ç”¨FSMçš„å¹³å°ç¨‹åºï¼Œå…¶ä¸­å‡ ä¸ªçŠ¶æ€å…±äº«ä¸€ä¸ªå…±åŒçš„ç‰©ç†é€»è¾‘ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨<em>è¹²ä¼</em>å’Œ<em>ç«™ç«‹</em>çŠ¶æ€ä¸‹ç§»åŠ¨å’Œè·³è·ƒã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‡ ä¸ªä¼ å…¥å˜é‡å¯¼è‡´ä¸¤ç§ä¸åŒçŠ¶æ€çš„ç›¸åŒè¡Œä¸ºå’Œä¿¡æ¯è¾“å‡ºã€‚ <br><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ä¸€èˆ¬è¡Œä¸ºå§”æ´¾ç»™å…¶ä»–çŠ¶æ€æ˜¯åˆä¹é€»è¾‘çš„ã€‚ å¹¸è¿çš„æ˜¯ï¼Œè¿™å¯ä»¥ä½¿ç”¨<em>åˆ†å±‚</em>çŠ¶æ€æœºæ¥å®ç°ã€‚ <br><br> åœ¨åˆ†å±‚FSMä¸­ï¼Œæœ‰ä¸€äº›<em>å­çŠ¶æ€</em>å°†<i>åŸå§‹çš„</i>ä¼ å…¥ä¿¡æ¯å§”æ´¾ç»™å®ƒä»¬çš„<em>å­çŠ¶æ€</em> ã€‚ åè¿‡æ¥ï¼Œè¿™åˆä½¿æ‚¨å¯ä»¥åœ¨ä¿æŒFSMé€»è¾‘çš„åŒæ—¶ä¼˜é›…åœ°å‡å°FSMçš„å¤§å°å’Œå¤æ‚æ€§ã€‚ <br><br><h2> çŠ¶æ€æ¨¡æ¿ </h2><br>  Erich Gammaï¼ŒRichard Helmï¼ŒRalph Johnsonå’ŒJohn Vlissidisåœ¨ã€Š <i>è®¾è®¡æ¨¡å¼ï¼šå¯é‡ç”¨çš„é¢å‘å¯¹è±¡è½¯ä»¶çš„å…ƒç´ ã€‹</i>ä¸€ä¹¦ä¸­å°†Stateæ¨¡æ¿çš„<i>ä»»åŠ¡</i>å®šä¹‰å¦‚ä¸‹ï¼š <br><br>  â€œä»–å¿…é¡»å…è®¸å¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ›´æ”¹æ—¶æ›´æ”¹å…¶è¡Œä¸ºã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¼¼ä¹è¯¥å¯¹è±¡å·²æ›´æ”¹å…¶ç±»ã€‚â€ <br><br> ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸€ç‚¹ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼š <br><br><ul><li> æ¥æ”¶ç”¨äºè¿åŠ¨é€»è¾‘çš„ä¼ å…¥ä¿¡æ¯çš„è„šæœ¬é™„åŠ åˆ°æ¸¸æˆå†…å®ä½“ã€‚ </li><li> æ­¤ç±»å­˜å‚¨<i>å½“å‰çŠ¶æ€</i>å˜é‡ï¼Œè¯¥<i>çŠ¶æ€</i>å˜é‡ä»…å¼•ç”¨<i>çŠ¶æ€</i>ç±»çš„å®ä¾‹ã€‚ </li><li> ä¼ å…¥ä¿¡æ¯è¢«å§”æ´¾ç»™è¯¥å½“å‰çŠ¶æ€ï¼Œè¯¥çŠ¶æ€å¯¹å…¶è¿›è¡Œå¤„ç†å¹¶åœ¨å…¶å†…éƒ¨åˆ›å»ºè¡Œä¸ºã€‚ å®ƒè¿˜å¤„ç†æ‰€éœ€çš„çŠ¶æ€è½¬æ¢ã€‚ </li></ul><br> å› æ­¤ï¼Œç”±äºä»¥ä¸‹äº‹å®ï¼š <i>å½“å‰çŠ¶æ€</i>å˜é‡åœ¨ä¸åŒçš„æ—¶é—´å¼•ç”¨äº†ä¸åŒçš„çŠ¶æ€ï¼Œå› æ­¤åŒä¸€è„šæœ¬ç±»çš„è¡Œä¸ºä¼¼ä¹æœ‰æ‰€ä¸åŒã€‚ è¿™æ˜¯â€œçŠ¶æ€â€æ¨¡æ¿çš„æœ¬è´¨ã€‚ <br><br> åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œå‰è¿°çš„<em>Character</em>ç±»å°†æ ¹æ®ä¸åŒçš„çŠ¶æ€è¡¨ç°ä¸åŒã€‚ ä½†æ˜¯æˆ‘ä»¬éœ€è¦ä»–è¡¨ç°è‡ªå·±ï¼ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d8/d20/f59/3d8d20f5921bf342b2ac84b5677e9a3b.png"></div><br> åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçŠ¶æ€ç±»éƒ½æœ‰ä¸‰ä¸ªå…³é”®ç‚¹ï¼Œè¿™äº›å…³é”®ç‚¹å…è®¸æ•´ä¸ªçŠ¶æ€è¿è¡Œï¼š <br><br><ul><li>  <em>è¿›å…¥</em> ï¼šè¿™æ˜¯å®ä½“è¿›å…¥çŠ¶æ€å¹¶æ‰§è¡Œä»…åœ¨è¿›å…¥çŠ¶æ€æ—¶åªéœ€æ‰§è¡Œä¸€æ¬¡çš„æ“ä½œçš„æ—¶åˆ»ã€‚ </li><li>  <em>é€€å‡º</em> ï¼šç±»ä¼¼äºè¾“å…¥-æ­¤å¤„å°†æ‰§è¡Œæ‰€æœ‰é‡ç½®æ“ä½œï¼Œå¿…é¡»ä»…åœ¨çŠ¶æ€æ›´æ”¹ä¹‹å‰æ‰§è¡Œæ­¤æ“ä½œã€‚ </li><li>  <em>æ›´æ–°å¾ªç¯</em> ï¼šè¿™æ˜¯åœ¨æ¯ä¸ªå¸§ä¸­è¿è¡Œçš„åŸºæœ¬<i>æ›´æ–°é€»è¾‘</i> ã€‚ å®ƒå¯ä»¥åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼Œç”¨äºæ›´æ–°ç‰©ç†çš„å¾ªç¯å’Œç”¨äºå¤„ç†ç©å®¶è¾“å…¥çš„å¾ªç¯ã€‚ </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a26/847/8e6/a268478e6da2566cc58d1083fefed27f.png"></div><br><h3> å®šä¹‰çŠ¶æ€å’ŒçŠ¶æ€æœº </h3><br> è½¬åˆ°<em>RW / Scripts</em>å¹¶æ‰“å¼€<em>StateMachine.cs</em> ã€‚ <br><br> æ‚¨å¯èƒ½ä¼šçŒœåˆ°ï¼ŒçŠ¶æ€æœºä¸ºçŠ¶æ€æœºæä¾›äº†ä¸€ç§æŠ½è±¡ã€‚ è¯·æ³¨æ„ï¼Œ <code>CurrentState</code>æ­£ç¡®ä½äºæ­¤ç±»å†…ã€‚ å®ƒå°†å­˜å‚¨åˆ°å½“å‰æ´»åŠ¨çŠ¶æ€æœºçŠ¶æ€çš„é“¾æ¥ã€‚ <br><br> ç°åœ¨ï¼Œè¦å®šä¹‰<i>çŠ¶æ€</i>çš„æ¦‚å¿µï¼Œè®©æˆ‘ä»¬è½¬åˆ°<em>RW / Scripts</em>å¹¶åœ¨IDEä¸­æ‰“å¼€<em>State.cs</em>è„šæœ¬ã€‚ <br><br>  <em>çŠ¶æ€</em>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒä½œä¸º<i>æ¨¡å‹</i> ï¼Œä»ä¸­æ´¾ç”Ÿæ‰€æœ‰é¡¹ç›®<i>çŠ¶æ€ç±»</i> ã€‚ é¡¹ç›®èµ„æ–™ä¸­çš„éƒ¨åˆ†ä»£ç å·²å‡†å¤‡å°±ç»ªã€‚ <br><br>  <code>DisplayOnUI</code>ä»…åœ¨å±å¹•UIä¸­æ˜¾ç¤ºå½“å‰çŠ¶æ€çš„åç§°ã€‚ æ‚¨æ— éœ€äº†è§£å…¶å†…éƒ¨ç»“æ„ï¼Œåªéœ€äº†è§£å®ƒæ¥æ”¶åˆ°ç±»å‹ä¸º<code>UIManager.Alignment</code>çš„æšä¸¾æ•°ä½œä¸ºè¾“å…¥å‚æ•°ï¼Œå¯ä»¥æ˜¯<code>Left</code>æˆ–<code>Right</code> ã€‚ çŠ¶æ€åç§°åœ¨å±å¹•å·¦ä¸‹éƒ¨æˆ–å³ä¸‹éƒ¨çš„æ˜¾ç¤ºå–å†³äºæ­¤åç§°ã€‚ <br><br> æ­¤å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªå—ä¿æŠ¤çš„å˜é‡<code>character</code>å’Œ<code>stateMachine</code> ã€‚  <code>character</code>å˜é‡å¼•ç”¨<em>Character</em>ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œ <code>stateMachine</code>å¼•ç”¨ä¸<em>è¯¥çŠ¶æ€</em>å…³è”<em>çš„çŠ¶æ€æœºçš„</em>ä¸€ä¸ªå®ä¾‹ã€‚ <br><br> åˆ›å»ºçŠ¶æ€å®ä¾‹æ—¶ï¼Œæ„é€ å‡½æ•°ä¼šç»‘å®š<code>character</code>å’Œ<code>stateMachine</code> ã€‚ <br><br> åœºæ™¯ä¸­<code>Character</code>çš„è®¸å¤šå®ä¾‹ä¸­çš„æ¯ä¸ªå®ä¾‹éƒ½å¯ä»¥å…·æœ‰è‡ªå·±çš„ä¸€ç»„çŠ¶æ€å’ŒçŠ¶æ€æœºã€‚ <br><br> ç°åœ¨ï¼Œå°†ä»¥ä¸‹æ–¹æ³•æ·»åŠ åˆ°<em>State.cs</em>å¹¶ä¿å­˜æ–‡ä»¶ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { DisplayOnUI(UIManager.Alignment.Left); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { }</code> </pre> <br> è¿™äº›è™šæ‹Ÿæ–¹æ³•å®šä¹‰äº†ä¸Šè¿°å…³é”®çŠ¶æ€ç‚¹ã€‚ å½“<em>çŠ¶æ€æœº</em>åœ¨çŠ¶æ€ä¹‹é—´è¿›è¡Œè½¬æ¢æ—¶ï¼Œæˆ‘ä»¬å°†ä¸Šä¸€ä¸ªçŠ¶æ€ç§°ä¸º<code>Exit</code>å¹¶<code>Enter</code>æ–°çš„<i>æ´»åŠ¨çŠ¶æ€</i> ã€‚ <br><br>  <code>HandleInput</code> ï¼Œ <code>LogicUpdate</code>å’Œ<code>PhysicsUpdate</code>ä¸€èµ·å®šä¹‰<i>äº†ä¸€ä¸ªæ›´æ–°å¾ªç¯</i> ã€‚  <code>HandleInput</code>å¤„ç†ç©å®¶è¾“å…¥ã€‚  <code>LogicUpdate</code>å¤„ç†åŸºæœ¬é€»è¾‘ï¼Œè€Œ<code>PhyiscsUpdate</code>å¤„ç†é€»è¾‘å’Œç‰©ç†è®¡ç®—ã€‚ <br><br> ç°åœ¨å†æ¬¡æ‰“å¼€<em>StateMachine.cs</em> ï¼Œæ·»åŠ ä»¥ä¸‹æ–¹æ³•å¹¶ä¿å­˜æ–‡ä»¶ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">State startingState</span></span></span><span class="hljs-function">)</span></span> { CurrentState = startingState; startingState.Enter(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChangeState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">State newState</span></span></span><span class="hljs-function">)</span></span> { CurrentState.Exit(); CurrentState = newState; newState.Enter(); }</code> </pre> <br>  <code>Initialize</code>é€šè¿‡å°†<code>CurrentState</code>è®¾ç½®ä¸º<code>startingState</code>å¹¶ä¸ºå…¶è°ƒç”¨<code>Enter</code>æ¥é…ç½®çŠ¶æ€æœºã€‚ è¿™å°†åˆå§‹åŒ–çŠ¶æ€æœºï¼Œè¿™æ˜¯ç¬¬ä¸€æ¬¡è®¾ç½®æ´»åŠ¨çŠ¶æ€ã€‚ <br><br>  <code>ChangeState</code>å¤„ç†<em>çŠ¶æ€</em>è½¬æ¢ã€‚ åœ¨å°†å…¶å¼•ç”¨æ›¿æ¢ä¸º<code>newState</code>ä¹‹å‰ï¼Œå®ƒå°†ä¸ºæ—§çš„<code>CurrentState</code>è°ƒç”¨<code>Exit</code> ã€‚ æœ€åï¼Œå®ƒä¸º<code>Enter</code>è°ƒç”¨<code>newState</code> ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬è®¾ç½®<em>çŠ¶æ€</em>å’Œ<em>çŠ¶æ€æœº</em> ã€‚ <br><br><h3> åˆ›å»ºè¿åŠ¨çŠ¶æ€ </h3><br> è¯·çœ‹ä¸‹é¢çš„çŠ¶æ€å›¾ï¼Œå…¶ä¸­æ˜¾ç¤º<i>äº†</i>ç©å®¶æ¸¸æˆä¸­æœ¬è´¨çš„ä¸åŒ<i>è¿åŠ¨çŠ¶æ€</i> ã€‚ åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¸º<i>FSM</i>å›¾ä¸­æ‰€ç¤ºçš„<i>ç§»åŠ¨</i>å®ç°â€œçŠ¶æ€â€æ¨¡æ¿ï¼š <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fa/bf6/c19/4fabf6c19761d028d621903401a84746.png"></div><br> æ³¨æ„è¿åŠ¨çŠ¶æ€ï¼Œå³<em>ç«™ç«‹</em> ï¼Œ <em>èº²é¿</em>å’Œ<em>è·³è·ƒ</em> ï¼Œä»¥åŠè¾“å…¥æ•°æ®å¦‚ä½•å¼•èµ·çŠ¶æ€ä¹‹é—´çš„è½¬æ¢ã€‚ è¿™æ˜¯åˆ†å±‚FSMï¼Œå…¶ä¸­<em>Grounded</em>æ˜¯<em>Ducking</em>å’Œ<em>Standing</em> <em>å­çŠ¶æ€çš„å­çŠ¶æ€</em> ã€‚ <br><br> è¿”å›Unityå¹¶è½¬åˆ°<em>RW /è„šæœ¬/çŠ¶æ€</em> ã€‚ åœ¨è¿™é‡Œï¼Œæ‚¨å°†æ‰¾åˆ°å‡ ä¸ªåç§°ä»¥<i>State</i>ç»“å°¾çš„Cï¼ƒæ–‡ä»¶ã€‚ <br><br> è¿™äº›æ–‡ä»¶ä¸­çš„æ¯ä¸ªæ–‡ä»¶éƒ½å®šä¹‰ä¸€ä¸ªç±»ï¼Œæ¯ä¸ªç±»éƒ½ä»<code>State</code>ç»§æ‰¿ã€‚ å› æ­¤ï¼Œè¿™äº›ç±»å®šä¹‰äº†æˆ‘ä»¬å°†åœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„çŠ¶æ€ã€‚ <br><br> ç°åœ¨ä»<em>RW / Scripts</em>æ–‡ä»¶å¤¹ä¸­æ‰“å¼€<em>Character.cs</em> ã€‚ <br><br> æ»šåŠ¨åˆ°<code>#region Variables</code>æ–‡ä»¶ä¸Šæ–¹ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StateMachine movementSM; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StandingState standing; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DuckingState ducking; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> JumpingState jumping;</code> </pre> <br> è¿™ä¸ª<code>movementSM</code>æ˜¯æŒ‡çŠ¶æ€æœºï¼Œå®ƒå¤„ç†<code>Character</code>å®ä¾‹çš„è¿åŠ¨é€»è¾‘ã€‚ æˆ‘ä»¬è¿˜æ·»åŠ äº†é’ˆå¯¹æ¯ç§è¿åŠ¨ç±»å‹å®ç°çš„ä¸‰ä¸ªçŠ¶æ€çš„é“¾æ¥ã€‚ <br><br> åœ¨åŒä¸€æ–‡ä»¶ä¸­è½¬åˆ°<code>#region MonoBehaviour Callbacks</code> ã€‚ æ·»åŠ ä»¥ä¸‹<a href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.html" rel="noopener">MonoBehaviour</a>æ–¹æ³•ï¼Œç„¶åä¿å­˜ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { movementSM = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StateMachine(); standing = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StandingState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, movementSM); ducking = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DuckingState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, movementSM); jumping = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JumpingState(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, movementSM); movementSM.Initialize(standing); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { movementSM.CurrentState.HandleInput(); movementSM.CurrentState.LogicUpdate(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { movementSM.CurrentState.PhysicsUpdate(); }</code> </pre> <br><ul><li> åœ¨â€œ <code>Start</code>ä»£ç åˆ›å»º<em>çŠ¶æ€æœº</em>çš„å®ä¾‹å¹¶å°†å…¶åˆ†é…ç»™<code>movementSM</code> ï¼Œè¿˜å®ä¾‹åŒ–å„ç§è¿åŠ¨çŠ¶æ€ã€‚ åœ¨åˆ›å»ºæ¯ä¸ªè¿åŠ¨çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>this</code>ä»¥åŠ<code>Character</code>å®ä¾‹å°†å¯¹<code>Character</code>å®ä¾‹çš„å¼•ç”¨ä¼ é€’ç»™<code>Character</code>å®ä¾‹ã€‚ æœ€åï¼Œæˆ‘ä»¬ä¸º<code>movementSM</code> <code>Initialize</code>è°ƒç”¨<code>Initialize</code> ï¼Œå¹¶å°†<code>Standing</code>ä½œä¸ºåˆå§‹çŠ¶æ€ã€‚ </li><li> åœ¨<code>Update</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¸º<code>HandleInput</code>æœºå™¨çš„<code>CurrentState</code>è°ƒç”¨<code>HandleInput</code>å’Œ<code>LogicUpdate</code> ã€‚ åŒæ ·ï¼Œåœ¨<code>FixedUpdate</code>æˆ‘ä»¬å°†<code>PhysicsUpdate</code>æœºå™¨çš„<code>CurrentState</code>ç§°ä¸º<code>PhysicsUpdate</code> ã€‚ ä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™å°†ä»»åŠ¡å§”æ´¾ä¸ºæ´»åŠ¨çŠ¶æ€ã€‚ è¿™å°±æ˜¯â€œçŠ¶æ€â€æ¨¡æ¿çš„å«ä¹‰ã€‚ </li></ul><br> ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªè¿åŠ¨çŠ¶æ€å†…è®¾ç½®è¡Œä¸ºã€‚ æŒ¯ä½œèµ·æ¥ï¼Œä¼šæœ‰å¾ˆå¤šä»£ç ï¼ <br><br><h3> å¸¸è®¾å…¬å¸ </h3><br> åœ¨â€œé¡¹ç›®â€çª—å£ä¸­è¿”å›åˆ°<em>RW /è„šæœ¬/çŠ¶æ€</em> ã€‚ <br><br> æ‰“å¼€<em>Grounded.cs</em> ï¼Œæ³¨æ„è¯¥ç±»çš„æ„é€ å‡½æ•°ä¸<code>State</code>æ„é€ å‡½æ•°åŒ¹é…ã€‚ è¿™æ˜¯åˆä¹é€»è¾‘çš„ï¼Œå› ä¸ºæ­¤ç±»ä»å…¶ç»§æ‰¿ã€‚ æ‚¨å°†åœ¨æ‰€æœ‰å…¶ä»–<i>çŠ¶æ€</i>ç±»ä¸­çœ‹åˆ°ç›¸åŒçš„å†…å®¹ã€‚ <br><br> æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); horizontalInput = verticalInput = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Exit(); character.ResetMoveParams(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.HandleInput(); verticalInput = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>); horizontalInput = Input.GetAxis(<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.PhysicsUpdate(); character.Move(verticalInput * speed, horizontalInput * rotationSpeed); }</code> </pre> <br> è¿™æ˜¯è¿™é‡Œå‘ç”Ÿçš„æƒ…å†µï¼š <br><br><ul><li> æˆ‘ä»¬é‡æ–°å®šä¹‰åœ¨çˆ¶ç±»ä¸­å®šä¹‰çš„è™šæ‹Ÿæ–¹æ³•ä¹‹ä¸€ã€‚ ä¸ºäº†ä¿ç•™çˆ¶çº§ä¸­å¯èƒ½å­˜åœ¨çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæˆ‘ä»¬ä»æ¯ä¸ªé‡å†™çš„æ–¹æ³•ä¸­è°ƒç”¨å…·æœ‰ç›¸åŒåç§°çš„<code>base</code>æ–¹æ³•ã€‚ è¿™æ˜¯æˆ‘ä»¬å°†ç»§ç»­ä½¿ç”¨çš„é‡è¦æ¨¡æ¿ã€‚ </li><li> ä¸‹ä¸€è¡Œ<code>Enter</code>å°†<code>horizontalInput</code>å’Œ<code>verticalInput</code>ä¸ºå…¶é»˜è®¤å€¼ã€‚ </li><li> å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨<code>Exit</code>å†…éƒ¨<code>Exit</code>æˆ‘ä»¬è°ƒç”¨<code></code> <code>ResetMoveParams</code>æ–¹æ³•ä»¥åœ¨æ›´æ”¹ä¸ºå…¶ä»–çŠ¶æ€æ—¶è¿›è¡Œé‡ç½®ã€‚ </li><li> åœ¨<code>HandleInput</code>æ–¹æ³•ä¸­ï¼Œ <code>horizontalInput</code>å’Œ<code>verticalInput</code>å˜é‡<code>HandleInput</code>æ°´å¹³å’Œå‚ç›´è¾“å…¥è½´çš„å€¼ã€‚ å› æ­¤ï¼Œç©å®¶å¯ä»¥ä½¿ç”¨é”®<em>W</em> ï¼Œ <em>A</em> ï¼Œ <em>S</em>å’Œ<em>D</em>æ§åˆ¶è§’è‰²<em>ã€‚</em> </li><li> åœ¨<code>PhysicsUpdate</code>æˆ‘ä»¬è¿›è¡Œä¸€æ¬¡<code>Move</code>è°ƒç”¨ï¼Œå°†<code>horizontalInput</code>å’Œ<code>verticalInput</code>å˜é‡ä¹˜ä»¥ç›¸åº”çš„é€Ÿåº¦ã€‚ åœ¨<code>speed</code>å­˜å‚¨ç§»åŠ¨<code>speed</code>åœ¨<code>rotationSpeed</code> ï¼Œå­˜å‚¨è§’é€Ÿåº¦ã€‚ </li></ul><br> ç°åœ¨æ‰“å¼€<em>Standing.csï¼Œ</em>å¹¶æ³¨æ„å®ƒç»§æ‰¿è‡ª<code>Grounded</code>çš„äº‹å®ã€‚ ä¹‹æ‰€ä»¥å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œæ˜¯å› ä¸ºå¦‚ä¸Šæ‰€è¿°ï¼Œ <em>ç«™ç«‹</em>æ˜¯<em>Groundedçš„</em>ä¸€ä¸ªå­çŠ¶æ€ã€‚ æœ‰å¤šç§æ–¹æ³•å¯ä»¥å®ç°è¿™ç§å…³ç³»ï¼Œä½†æ˜¯åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç»§æ‰¿ã€‚ <br><br> æ·»åŠ ä»¥ä¸‹<code>override</code>æ–¹æ³•å¹¶ä¿å­˜è„šæœ¬ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); speed = character.MovementSpeed; rotationSpeed = character.RotationSpeed; crouch = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; jump = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.HandleInput(); crouch = Input.GetButtonDown(<span class="hljs-string"><span class="hljs-string">"Fire3"</span></span>); jump = Input.GetButtonDown(<span class="hljs-string"><span class="hljs-string">"Jump"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.LogicUpdate(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (crouch) { stateMachine.ChangeState(character.ducking); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (jump) { stateMachine.ChangeState(character.jumping); } }</code> </pre> <br><ul><li> åœ¨<code>Enter</code>æˆ‘ä»¬é…ç½®ä»<code>Grounded</code>ç»§æ‰¿çš„å˜é‡ã€‚ å°†è§’è‰²çš„<code>MovementSpeed</code>å’Œ<code>RotationSpeed</code>åº”ç”¨äº<code>speed</code>å’Œ<code>rotationSpeed</code> ã€‚ ç„¶åï¼Œå®ƒä»¬åˆ†åˆ«ä¸<i>æ­£å¸¸</i>è¿åŠ¨é€Ÿåº¦å’Œè§’è‰²æœ¬è´¨æ‰€è¦è¾¾åˆ°çš„è§’é€Ÿåº¦æœ‰å…³ã€‚ <br><br> æ­¤å¤–ï¼Œç”¨äºå­˜å‚¨<code>crouch</code>å’Œ<code>jump</code>è¾“å…¥çš„å˜é‡å°†é‡ç½®ä¸ºfalseã€‚ </li><li> åœ¨<code>HandleInput</code>å†…éƒ¨ï¼Œ <code>crouch</code>å’Œ<code>jump</code>å˜é‡å­˜å‚¨ä¸‹è¹²å’Œè·³è·ƒçš„ç©å®¶è¾“å…¥ã€‚ å¦‚æœåœ¨ä¸»åœºæ™¯ä¸­ç©å®¶æŒ‰ä¸‹<em>Shifté”®ï¼Œåˆ™</em>æ·±è¹²å°†è®¾ç½®ä¸ºtrueã€‚ åŒæ ·ï¼Œç©å®¶å¯ä»¥ä½¿ç”¨<em>ç©ºæ ¼</em>é”®<code>jump</code> ã€‚ </li><li> åœ¨<code>LogicUpdate</code>æˆ‘ä»¬æ£€æŸ¥ç±»å‹ä¸º<code>bool</code>çš„<code>crouch</code>å’Œ<code>jump</code>å˜é‡ã€‚ å¦‚æœ<code>crouch</code>ä¸ºtrueï¼Œåˆ™<code>movementSM.CurrentState</code>æ›´æ”¹ä¸º<code>character.ducking</code> ã€‚ å¦‚æœ<code>jump</code>ä¸ºtrueï¼Œåˆ™çŠ¶æ€æ›´æ”¹ä¸º<code>character.jumping</code> ã€‚ </li></ul><br> ä¿å­˜å¹¶ç»„è£…é¡¹ç›®ï¼Œç„¶åå•å‡»â€œ <em>æ’­æ”¾â€</em> ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨<em>W</em> ï¼Œ <em>A</em> ï¼Œ <em>S</em>å’Œ<em>D</em>é”®åœ¨åœºæ™¯ä¸­å››å¤„ç§»åŠ¨<em>ã€‚</em> å¦‚æœæ‚¨å°è¯•æŒ‰<em>Shift</em>æˆ–<em>Space</em> ï¼Œåˆ™ä¼šå‘ç”Ÿæ„å¤–è¡Œä¸ºï¼Œå› ä¸ºå°šæœªå®ç°ç›¸åº”çš„çŠ¶æ€ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/450/89a/564/45089a5640a8d492b20ac5948e0fdf69.gif"></div><br> å°è¯•åœ¨è¡¨æ ¼å¯¹è±¡ä¸‹ç§»åŠ¨ã€‚ æ‚¨ä¼šçœ‹åˆ°ç”±äºè§’è‰²å¯¹æ’æœºçš„é«˜åº¦ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ã€‚ ä¸ºäº†ä½¿è§’è‰²åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‚¨éœ€è¦æ·»åŠ è¹²è¡Œä¸ºã€‚ <br><br><h3> æˆ‘ä»¬çˆ¬åˆ°æ¡Œå­åº•ä¸‹ </h3><br> æ‰“å¼€<em>Ducking.cs</em>è„šæœ¬ã€‚ è¯·æ³¨æ„ï¼Œ <code>Ducking</code>ä¹Ÿå‡ºäºä¸<code>Standing</code>ç›¸åŒçš„åŸå› è€Œç»§æ‰¿è‡ª<code>Grounded</code>ç±»ã€‚ æ·»åŠ ä»¥ä¸‹<code>override</code>æ–¹æ³•å¹¶ä¿å­˜è„šæœ¬ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); character.SetAnimationBool(character.crouchParam, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); speed = character.CrouchSpeed; rotationSpeed = character.CrouchRotationSpeed; character.ColliderSize = character.CrouchColliderHeight; belowCeiling = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Exit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Exit(); character.SetAnimationBool(character.crouchParam, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); character.ColliderSize = character.NormalColliderHeight; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.HandleInput(); crouchHeld = Input.GetButton(<span class="hljs-string"><span class="hljs-string">"Fire3"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.LogicUpdate(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(crouchHeld || belowCeiling)) { stateMachine.ChangeState(character.standing); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.PhysicsUpdate(); belowCeiling = character.CheckCollisionOverlap(character.transform.position + Vector3.up * character.NormalColliderHeight); }</code> </pre> <br><ul><li> åœ¨<code>Enter</code>å†…éƒ¨<code>Enter</code>å¯¼è‡´ä¸‹è¹²åŠ¨ç”»åˆ‡æ¢<code>Enter</code>å‚æ•°è®¾ç½®ä¸ºâ€œè¹²ä¸‹â€ï¼Œè¿™å°†å¯ç”¨ä¸‹è¹²åŠ¨ç”»ã€‚ ä¸º<code>character.CrouchSpeed</code>å’Œ<code>character.CrouchRotationSpeed</code>å±æ€§åˆ†é…äº†<code>speed</code>å’Œ<code>rotation</code>å€¼ï¼Œå½“å®ƒä»¬<i>ä¸‹è¹²</i>æ—¶ï¼Œå®ƒä»¬è¿”å›è§’è‰²çš„è¿åŠ¨å’Œè§’é€Ÿåº¦ã€‚ <br><br> ä¸‹ä¸€ä¸ª<code>character.CrouchColliderHeight</code> ã€‚CrouchColliderHeightè®¾ç½®è§’è‰²çš„ç¢°æ’ä½“çš„å¤§å°ï¼Œè¹²æ—¶è¿”å›æ‰€éœ€çš„ç¢°æ’ä½“é«˜åº¦ã€‚ æœ€åï¼Œå°†<code>belowCeiling</code>é‡ç½®ä¸ºfalseã€‚ </li><li> åœ¨<code>Exit</code>å†…éƒ¨<code>Exit</code>å°†è¹²ä¸‹åŠ¨ç”»å‚æ•°è®¾ç½®ä¸ºfalseã€‚ è¿™å°†ç¦ç”¨ä¸‹è¹²åŠ¨ç”»ã€‚ ç„¶åè®¾ç½®æ­£å¸¸çš„å¯¹æ’æœºé«˜åº¦ï¼Œç”±<code>character.NormalColliderHeight</code>è¿”å›ã€‚ </li><li> åœ¨<code>HandleInput</code>å†…éƒ¨<code>HandleInput</code>å˜é‡<code>crouchHeld</code>è®¾ç½®æ’­æ”¾å™¨çš„è¾“å…¥å€¼ã€‚ åœ¨<em>ä¸»</em>åœºæ™¯ä¸­ï¼ŒæŒ‰ä½<em>Shifté”®å¯</em>å°†<code>crouchHeld</code>è®¾ç½®ä¸ºtrueã€‚ </li><li> åœ¨<code>PhysicsUpdate</code>å†…éƒ¨<code>PhysicsUpdate</code>é€šè¿‡å°†<code>Vector3</code>æ ¼å¼çš„ä¸€ä¸ªç‚¹ï¼ˆå¸¦æœ‰è§’è‰²çš„æ¸¸æˆå¯¹è±¡çš„å¤´éƒ¨ï¼‰ä¼ é€’ç»™<code>PhysicsUpdate</code> <code>belowCeiling</code>å˜é‡åˆ†é…äº†ä¸€ä¸ªå€¼ã€‚ å¦‚æœåœ¨è¯¥ç‚¹é™„è¿‘å‘ç”Ÿç¢°æ’ï¼Œåˆ™è¡¨ç¤ºè§’è‰²å¤„äºæŸç§å¤©èŠ±æ¿ä¹‹ä¸‹ã€‚ </li><li> åœ¨å†…éƒ¨ï¼Œ <code>LogicUpdate</code>æ£€æŸ¥<code>crouchHeld</code>æˆ–<code>belowCeiling</code>æ˜¯å¦ä¸ºçœŸã€‚ å¦‚æœå®ƒä»¬éƒ½ä¸æ˜¯çœŸå®çš„ï¼Œåˆ™<code>movementSM.CurrentState</code>æ›´æ”¹ä¸º<code>character.standing</code> ã€‚ </li></ul><br> ç”Ÿæˆé¡¹ç›®ï¼Œç„¶åå•å‡»â€œ <em>æ’­æ”¾â€</em> ã€‚ ç°åœ¨æ‚¨å¯ä»¥åœ¨åœºæ™¯ä¸­å››å¤„ç§»åŠ¨ã€‚ å¦‚æœæŒ‰<em>Shifté”®</em> ï¼Œè§’è‰²å°†åä¸‹ï¼Œç„¶åå¯ä»¥ä¸‹è¹²ã€‚ <br><br> æ‚¨ä¹Ÿå¯ä»¥åœ¨å¹³å°ä¸‹æ”€çˆ¬ã€‚ å¦‚æœæ‚¨åœ¨å¹³å°ä¸‹é‡Šæ”¾<em>Shift</em> ï¼Œè§’è‰²å°†ä¸€ç›´å¤„äºä¸‹è¹²çŠ¶æ€ï¼Œç›´åˆ°ä»–ç¦»å¼€åº‡æŠ¤æ‰€ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee4/dce/657/ee4dce657ae6be49244106652a168a3a.gif"></div><br><h3> å¿«èµ·æ¥ï¼ </h3><br> æ‰“å¼€<em>Jumping.cs</em> ã€‚ æ‚¨å°†çœ‹åˆ°ä¸€ä¸ªåä¸º<code>Jump</code>çš„æ–¹æ³•ã€‚ ä¸ç”¨æ‹…å¿ƒå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ è¶³ä»¥ç†è§£å®ƒçš„ç”¨æ³•ï¼Œä»¥ä¾¿è§’è‰²å¯ä»¥åœ¨è€ƒè™‘ç‰©ç†å’ŒåŠ¨ç”»çš„æƒ…å†µä¸‹è·³è·ƒã€‚ <br><br> ç°åœ¨æ·»åŠ å¸¸ç”¨çš„<code>override</code>æ–¹æ³•å¹¶ä¿å­˜è„šæœ¬ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Enter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Enter(); SoundManager.Instance.PlaySound(SoundManager.Instance.jumpSounds); grounded = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; Jump(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.LogicUpdate(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (grounded) { character.TriggerAnimation(landParam); SoundManager.Instance.PlaySound(SoundManager.Instance.landing); stateMachine.ChangeState(character.standing); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhysicsUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.PhysicsUpdate(); grounded = character.CheckCollisionOverlap(character.transform.position); }</code> </pre> <br><ul><li> åœ¨<code>Enter</code>å†…éƒ¨<code>Enter</code>å•ä¾‹<code>SoundManager</code>æ’­æ”¾è·³è·ƒå£°ã€‚ ç„¶åå°†<code>grounded</code>é‡ç½®ä¸ºå…¶é»˜è®¤å€¼ã€‚ æœ€åï¼Œå°†è°ƒç”¨<code>Jump</code> ã€‚ </li><li> åœ¨<code>PhysicsUpdate</code>å†…éƒ¨<code>PhysicsUpdate</code>è§’è‰²è…¿éƒ¨æ—è¾¹<code>PhysicsUpdate</code>ç‚¹å‘é€åˆ°<code>CheckCollisionOverlap</code> ï¼Œè¿™æ„å‘³ç€å½“è§’è‰²åœ¨åœ°é¢ä¸Šæ—¶ï¼Œ <code>grounded</code>å°†è®¾ç½®ä¸ºtrueã€‚ </li><li> åœ¨<code>LogicUpdate</code> ï¼Œå¦‚æœ<code>LogicUpdate</code>ä¸ºtrueï¼Œæˆ‘ä»¬å°†è°ƒç”¨<code>TriggerAnimation</code>å¯ç”¨è§¦åœ°åŠ¨ç”»ï¼Œæ’­æ”¾è§¦åœ°å£°éŸ³ï¼Œå¹¶å°†<code>LogicUpdate</code>æ›´æ”¹ä¸º<code>character.standing</code> ã€‚ </li></ul><br> å› æ­¤ï¼Œåœ¨æ­¤æˆ‘ä»¬å·²ä½¿ç”¨<em>â€œçŠ¶æ€â€æ¨¡æ¿</em>å®Œæˆäº†FSMä½ç§»çš„å®Œæ•´å®ç°ã€‚ ç”Ÿæˆé¡¹ç›®å¹¶è¿è¡Œå®ƒã€‚ æŒ‰<em>ç©ºæ ¼</em>é”®ä½¿è§’è‰²è·³è½¬ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebd/e16/05d/ebde1605dc739588529c51509e19c0a8.gif"></div><br><h2> æ¥ä¸‹æ¥è¦å»å“ªé‡Œï¼Ÿ </h2><br>  <a href="">é¡¹ç›®ææ–™</a>æœ‰ä¸€ä¸ªé¡¹ç›®è‰æ¡ˆå’Œä¸€ä¸ªå®Œæˆçš„é¡¹ç›®ã€‚ <br><br> å°½ç®¡æœ‰ç”¨ï¼ŒçŠ¶æ€æœºè¿˜æ˜¯æœ‰å±€é™æ€§çš„ã€‚ å¹¶å‘çŠ¶æ€æœºå’Œä¸‹æ¨è‡ªåŠ¨æœºå¯ä»¥å¤„ç†å…¶ä¸­ä¸€äº›é™åˆ¶ã€‚ æ‚¨å¯ä»¥åœ¨Robert Nystrom <a href="https://gameprogrammingpatterns.com/state.html" rel="noopener"><em>Game Programming Patterns</em></a>çš„ä¹¦ä¸­é˜…è¯»æœ‰å…³å®ƒä»¬çš„ä¿¡æ¯ã€‚ <br><br> æ­¤å¤–ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ç”¨äºåˆ›å»ºæ›´å¤æ‚çš„æ¸¸æˆä¸­å®ä½“çš„<a href="https://en.wikipedia.org/wiki/Behavior_tree_(artificial_intelligence,_robotics_and_control)" rel="noopener"><em>è¡Œä¸ºæ ‘</em></a>æ¥æ›´æ·±å…¥åœ°æ¢è®¨è¯¥ä¸»é¢˜ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN484176/">https://habr.com/ru/post/zh-CN484176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN484166/index.html">VVVVVV ??? VVVVVV !!! :)</a></li>
<li><a href="../zh-CN484168/index.html">æˆ‘ä»¬ç¼–å†™äº†ä»Angular CDKè¿›è¡Œè™šæ‹Ÿæ»šåŠ¨çš„ç­–ç•¥</a></li>
<li><a href="../zh-CN484170/index.html">å°†æ£€æŸ¥ç‚¹ä»R77.30æ›´æ–°åˆ°80.20</a></li>
<li><a href="../zh-CN484172/index.html">ä¸Unityçš„æŒç»­é›†æˆï¼šå¦‚ä½•å‡å°‘ç»„è£…æ—¶é—´å¹¶èŠ‚çœèµ„æº+æ”¯ä»˜çº¿ä½œä¸ºç¤¼ç‰©</a></li>
<li><a href="../zh-CN484174/index.html">åŸå ¡åœ¨â€œæç«¯â€æ¡ä»¶ä¸‹é¥®é…’æˆ–æˆ‘ä»¬å¦‚ä½•å‚åŠ â€œ DOZORâ€è¡¨æ¼”</a></li>
<li><a href="../zh-CN484178/index.html">ç”¨äºåœ°çƒçš„æ™ºèƒ½ä»¥å¤ªç½‘äº¤æ¢æœº</a></li>
<li><a href="../zh-CN484180/index.html">Rostelecomè™šæ‹ŸPBXï¼šå¯ä»¥é€šè¿‡APIè¿›è¡Œå“ªäº›æ“ä½œä»¥åŠå¦‚ä½•å®Œæˆ</a></li>
<li><a href="../zh-CN484182/index.html">Xenobotsï¼šæ¥è‡ªé’è›™ç»†èƒçš„æ´»çš„çº³ç±³æœºå™¨äºº</a></li>
<li><a href="../zh-CN484186/index.html">LDAP-â€œèº«ä»½éªŒè¯â€æ˜¯ä¸€ç§åæ¨¡å¼</a></li>
<li><a href="../zh-CN484188/index.html">æ•°æ®åº“è®¾è®¡æ ‡å‡†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>