<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍⚖️ 👩🏿‍🌾 🤽🏽 LLVM dalam hal Go ⤴️ 🥝 🍼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pengembangan kompiler adalah tugas yang sangat sulit. Tetapi, untungnya, dengan pengembangan proyek-proyek seperti LLVM, solusi untuk masalah ini sang...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>LLVM dalam hal Go</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/451476/">  Pengembangan kompiler adalah tugas yang sangat sulit.  Tetapi, untungnya, dengan pengembangan proyek-proyek seperti LLVM, solusi untuk masalah ini sangat disederhanakan, yang bahkan memungkinkan seorang programmer tunggal untuk membuat bahasa baru yang mendekati kinerja C. C. Bekerja dengan LLVM rumit oleh fakta bahwa sistem ini diwakili oleh sejumlah besar kode, dilengkapi dengan dokumentasi kecil.  Untuk mencoba memperbaiki kesalahan ini, penulis materi, yang kami terbitkan hari ini, akan mendemonstrasikan contoh kode yang ditulis dalam Go dan menunjukkan bagaimana mereka ditransmisikan terlebih dahulu ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Go SSA</a> dan kemudian ke LLVM IR menggunakan kompiler <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">TinyGO</a> .  Kode IR SSA dan LLVM Go telah sedikit diedit, sesuatu yang tidak relevan dengan penjelasan yang diberikan di sini telah dihapus darinya untuk membuat penjelasan ini lebih dimengerti. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f4a/50e/d6d/f4a50ed6d13e445eaf3d9c55293e7999.jpg" alt="gambar"></div><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Contoh pertama</font> </h2><br>  Fungsi pertama yang akan saya uraikan di sini adalah mekanisme sederhana untuk menambahkan angka: <br><br><pre><code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myAdd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b }</code> </pre> <br>  Fungsi ini sangat sederhana, dan, mungkin, tidak ada yang lebih mudah untuk tidak muncul.  Ini diterjemahkan ke kode Go SSA berikut: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myAdd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, b </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entry</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">                                                    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span></span></code> </pre> <br>  Dengan representasi fungsi ini, petunjuk tentang tipe data ditempatkan di sebelah kanan, dalam kebanyakan kasus Anda dapat mengabaikannya. <br><br>  Contoh kecil ini sudah memungkinkan Anda untuk melihat inti dari satu aspek SSA.  Yaitu, ketika mengkonversi kode ke bentuk SSA, setiap ekspresi dibagi menjadi bagian-bagian paling dasar yang terdiri darinya.  Dalam kasus kami, perintah <code>return a + b</code> , sebenarnya, mewakili dua operasi: menambahkan dua angka dan mengembalikan hasilnya. <br><br>  Selain itu, di sini Anda dapat melihat blok dasar program, dalam kode ini hanya ada satu blok - input (blok entri).  Kami akan berbicara lebih banyak tentang blok di bawah ini. <br><br>  Go SSA code dapat dengan mudah dikonversi ke LLVM IR: <br><br><pre> <code class="go hljs">define i64 @myAdd(i64 %a, i64 %b) { entry: %<span class="hljs-number"><span class="hljs-number">0</span></span> = add i64 %a, %b ret i64 %<span class="hljs-number"><span class="hljs-number">0</span></span> }</code> </pre> <br>  Anda mungkin memperhatikan bahwa walaupun konstruksi sintaksis lain digunakan di sini, struktur fungsi pada dasarnya tidak berubah.  Kode IR LLVM sedikit lebih kuat daripada kode Go SSA, mirip dengan C. Di sini, dalam deklarasi fungsi, pertama kali datang deskripsi tipe data yang dikembalikan ke sana, tipe argumen ditunjukkan sebelum nama argumen.  Selain itu, untuk menyederhanakan IR parsing, nama entitas global didahului oleh simbol <code>@</code> , dan sebelum nama entitas lokal dengan karakter <code>%</code> (fungsi ini juga dianggap sebagai entitas global). <br><br>  Salah satu fitur dari kode ini yang perlu Anda perhatikan adalah bahwa keputusan untuk mewakili tipe Go <code>int</code> , yang dapat diwakili oleh nilai 32-bit atau 64-bit, tergantung pada kompiler dan tujuan kompilasi, dibuat saat membuat LLVM Kode IR.  Ini adalah salah satu dari banyak alasan bahwa kode IR LLVM bukan platform independen.  Kode seperti itu dibuat untuk satu platform tidak bisa begitu saja diambil dan dikompilasi untuk platform lain (kecuali jika Anda mendekati tugas ini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dengan sangat hati-hati</a> ). <br><br>  Hal menarik lainnya yang patut dicatat adalah bahwa tipe <code>i64</code> bukan bilangan bulat yang ditandatangani: itu netral dalam hal mewakili tanda angka.  Bergantung pada instruksinya, ini dapat mewakili angka yang ditandatangani dan angka yang tidak ditandatangani.  Dalam hal mewakili operasi penambahan, ini tidak berperan, jadi tidak ada perbedaan dalam bekerja dengan angka dengan atau tanpa tanda.  Di sini, saya ingin mencatat bahwa dalam C, overflow dari variabel integer yang ditandatangani mengarah ke perilaku yang tidak terdefinisi, oleh karena itu, frontend Dentang menambahkan bendera <code>nsw</code> (no wrap wraped) ke operasi, yang menunjukkan kepada LLVM bahwa ia dapat melanjutkan dari asumsi bahwa dengan Selain itu tidak pernah terjadi overflow. <br><br>  Ini mungkin penting untuk beberapa optimasi.  Misalnya, penambahan dua nilai <code>i16</code> pada platform 32-bit (dengan register 32-bit) mengharuskan, setelah penambahan selesai, operasi ekstensi tanda untuk tetap berada dalam kisaran <code>i16</code> .  Karena itu, sering kali lebih efisien untuk melakukan operasi integer dengan mempertimbangkan ukuran mesin register. <br><br>  Apa yang terjadi di masa depan dengan kode IR ini tidak terlalu menarik bagi kita sekarang.  Kode dioptimalkan (tetapi dalam kasus contoh sederhana seperti kita, tidak ada yang dioptimalkan), dan kemudian dikonversi ke kode mesin. <br><br><h2>  <font color="#3AC1EF">Contoh kedua</font> </h2><br>  Contoh berikut, yang akan kita periksa, akan sedikit lebih rumit.  Yaitu, kita berbicara tentang fungsi yang menjumlahkan irisan integer: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(numbers []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span></span> {   n := <span class="hljs-number"><span class="hljs-number">0</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(numbers); i++ {       n += numbers[i]   }   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n }</code> </pre> <br>  Kode ini dikonversi menjadi kode Go SSA berikut: <br><br><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(numbers []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entry</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jump</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi</span></span></span><span class="hljs-function"> [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entry</span></span></span><span class="hljs-function">: 0:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">body</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t6</span></span></span><span class="hljs-function">] #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function">                       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi</span></span></span><span class="hljs-function"> [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">entry</span></span></span><span class="hljs-function">: 0:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">body</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t7</span></span></span><span class="hljs-function">] #</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">                       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t2</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">len</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(numbers)</span></span></span><span class="hljs-function">                                              </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t3</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t1</span></span></span><span class="hljs-function"> &lt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t2</span></span></span><span class="hljs-function">                                                  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t3</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">goto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">body</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">done</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">body</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t4</span></span></span><span class="hljs-function"> = &amp;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">numbers</span></span></span><span class="hljs-function">[</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t1</span></span></span><span class="hljs-function">]                                             *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t5</span></span></span><span class="hljs-function"> = *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t4</span></span></span><span class="hljs-function">                                                       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t6</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t5</span></span></span><span class="hljs-function">                                                   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t7</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t1</span></span></span><span class="hljs-function"> + 1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">                                                </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jump</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">done</span></span></span><span class="hljs-function">:   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">t0</span></span></span></span></code> </pre> <br>  Di sini Anda sudah dapat melihat lebih banyak konstruksi khusus untuk penyajian kode dalam bentuk SSA.  Mungkin fitur yang paling jelas dari kode ini adalah kenyataan bahwa tidak ada perintah kontrol aliran terstruktur.  Untuk mengontrol aliran perhitungan, hanya ada lompatan bersyarat dan tanpa syarat, dan, jika kita menganggap perintah ini sebagai perintah untuk mengontrol aliran, perintah balik. <br><br>  Bahkan, di sini Anda dapat memperhatikan fakta bahwa program tidak dibagi menjadi blok menggunakan kurung kurawal (seperti dalam bahasa keluarga C).  Ini dibagi dengan label, yang menyerupai bahasa assembly, dan disajikan dalam bentuk blok dasar.  Dalam SSA, blok dasar adalah urutan kode yang berdekatan yang dimulai dengan label dan diakhiri dengan instruksi untuk menyelesaikan blok dasar, misalnya, <code>return</code> dan <code>jump</code> . <br><br>  Detail menarik lainnya dari kode ini adalah instruksi <code>phi</code> .  Instruksi ini sangat tidak biasa, mungkin perlu beberapa waktu untuk mengetahuinya.  Ingat bahwa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SSA</a> adalah kependekan dari Static Single Assignment.  Ini adalah representasi perantara dari kode yang digunakan oleh kompiler, di mana setiap variabel hanya ditugaskan satu kali.  Ini bagus untuk mengekspresikan fungsi sederhana seperti fungsi <code>myAdd</code> kami yang ditunjukkan di atas, tetapi tidak untuk fungsi yang lebih kompleks seperti fungsi <code>sum</code> dibahas di bagian ini.  Secara khusus, selama eksekusi loop, variabel <code>i</code> dan <code>n</code> berubah. <br><br>  SSA memintas batasan pada penugasan tunggal nilai variabel menggunakan apa yang disebut instruksi <code>phi</code> (namanya diambil dari alfabet Yunani).  Faktanya adalah agar representasi SSA dari kode dapat dibentuk untuk bahasa seperti C, Anda harus menggunakan beberapa trik.  Hasil dari pemanggilan instruksi ini adalah nilai variabel saat ini ( <code>i</code> atau <code>n</code> ), dan daftar blok dasar digunakan sebagai parameternya.  Sebagai contoh, pertimbangkan instruksi ini: <br><br><pre> <code class="go hljs">t0 = phi [entry: <span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.body: t6] #n</code> </pre> <br>  Artinya adalah sebagai berikut: jika blok dasar sebelumnya adalah blok <code>entry</code> (input), maka <code>t0</code> adalah konstan <code>0</code> , dan jika blok dasar sebelumnya adalah <code>for.body</code> , maka Anda perlu mengambil nilai <code>t6</code> dari blok ini.  Semua ini mungkin terlihat agak misterius, tetapi berkat mekanisme ini, SSA dipastikan.  Dari sudut pandang manusia, semua ini memperumit pemahaman kode, tetapi fakta bahwa setiap nilai hanya diberikan sekali sangat menyederhanakan banyak optimasi. <br><br>  Perhatikan bahwa jika Anda menulis kompiler sendiri, maka Anda biasanya tidak harus berurusan dengan hal-hal seperti itu.  Bahkan Dentang tidak menghasilkan semua instruksi <code>phi</code> ini, ia menggunakan mekanisme <code>alloca</code> (seperti bekerja dengan variabel lokal biasa).  Kemudian, ketika melakukan pass optimasi LLVM, yang disebut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mem2reg</a> , instruksi <code>alloca</code> dikonversi ke bentuk SSA.  TinyGo, bagaimanapun, menerima input dari Go SSA, yang, dengan mudah, telah dikonversi ke bentuk SSA. <br><br>  Inovasi lain dari potongan kode perantara ini adalah bahwa akses ke elemen slice menurut indeks disajikan dalam bentuk operasi penghitungan alamat dan operasi dereferencing dari pointer yang diperoleh.  Di sini Anda dapat melihat penambahan konstanta langsung ke kode IR (misalnya - <code>1:int</code> ).  Dalam contoh dengan fungsi <code>myAdd</code> ini tidak digunakan.  Sekarang kami telah menemukan fitur-fitur ini, kami akan melihat apa yang akan menjadi kode ini ketika mengubahnya menjadi bentuk LLVM IR: <br><br><pre> <code class="go hljs">define i64 @sum(i64* %ptr, i64 %<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>, i64 %<span class="hljs-built_in"><span class="hljs-built_in">cap</span></span>) { entry: br label %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop:                                         ; preds = %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.body, %entry %<span class="hljs-number"><span class="hljs-number">0</span></span> = phi i64 [ <span class="hljs-number"><span class="hljs-number">0</span></span>, %entry ], [ %<span class="hljs-number"><span class="hljs-number">5</span></span>, %deref.next ] %<span class="hljs-number"><span class="hljs-number">1</span></span> = phi i64 [ <span class="hljs-number"><span class="hljs-number">0</span></span>, %entry ], [ %<span class="hljs-number"><span class="hljs-number">6</span></span>, %deref.next ] %<span class="hljs-number"><span class="hljs-number">2</span></span> = icmp slt i64 %<span class="hljs-number"><span class="hljs-number">1</span></span>, %<span class="hljs-built_in"><span class="hljs-built_in">len</span></span> br i1 %<span class="hljs-number"><span class="hljs-number">2</span></span>, label %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.body, label %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.done <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.body:                                         ; preds = %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop %<span class="hljs-number"><span class="hljs-number">3</span></span> = getelementptr i64, i64* %ptr, i64 %<span class="hljs-number"><span class="hljs-number">1</span></span> %<span class="hljs-number"><span class="hljs-number">4</span></span> = load i64, i64* %<span class="hljs-number"><span class="hljs-number">3</span></span> %<span class="hljs-number"><span class="hljs-number">5</span></span> = add i64 %<span class="hljs-number"><span class="hljs-number">0</span></span>, %<span class="hljs-number"><span class="hljs-number">4</span></span> %<span class="hljs-number"><span class="hljs-number">6</span></span> = add i64 %<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> br label %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.done:                                         ; preds = %<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>.loop ret i64 %<span class="hljs-number"><span class="hljs-number">0</span></span> }</code> </pre> <br>  Di sini, seperti sebelumnya, kita dapat melihat struktur yang sama, yang mencakup konstruksi sintaksis lainnya.  Misalnya, dalam panggilan <code>phi</code> , nilai dan label ditukar.  Namun, ada juga sesuatu yang layak diperhatikan. <br><br>  Sebagai permulaan, di sini Anda dapat melihat tanda tangan fungsi yang sama sekali berbeda.  LLVM tidak mendukung irisan, sebagai hasilnya, dalam bentuk optimasi, kompiler TinyGo, yang menghasilkan kode perantara ini, membagi deskripsi struktur data ini menjadi beberapa bagian.  Dia bisa mewakili tiga elemen irisan ( <code>ptr</code> , <code>len</code> dan <code>cap</code> ) sebagai struktur (struct), tetapi menghadirkannya sebagai tiga entitas terpisah memungkinkan untuk beberapa optimasi.  Kompiler lain mungkin menyajikan irisan dengan beberapa cara lain, itu tergantung pada konvensi untuk memanggil fungsi platform target. <br><br>  Fitur lain yang menarik dari kode ini adalah penggunaan <code>getelementptr</code> (sering disebut GEP). <br><br>  Instruksi ini bekerja dengan pointer dan digunakan untuk mendapatkan pointer ke elemen slice.  Sebagai contoh, mari kita bandingkan dengan kode berikut yang ditulis dalam C: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* sliceptr(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *ptr, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &amp;ptr[index]; }</code> </pre> <br>  Atau dengan yang setara dengan ini: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* sliceptr(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *ptr, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ptr + index; }</code> </pre> <br>  Yang paling penting di sini adalah pernyataan <code>getelementptr</code> tidak melakukan operasi dereference.  Ini hanya menghitung pointer baru berdasarkan yang sudah ada.  Ini dapat diartikan sebagai <code>mul</code> dan <code>add</code> di tingkat perangkat keras.  Detail tentang instruksi GEP dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Fitur lain yang menarik dari kode perantara ini adalah penggunaan instruksi <code>icmp</code> .  Ini adalah instruksi tujuan umum yang digunakan untuk mengimplementasikan perbandingan integer.  Hasil instruksi ini selalu berupa nilai tipe <code>i1</code> - nilai logis.  Dalam hal ini, perbandingan dibuat menggunakan <code>slt</code> kata kunci (masuk kurang dari), karena kami membandingkan dua angka yang sebelumnya diwakili oleh tipe <code>int</code> .  Jika kita membandingkan dua bilangan bulat yang tidak ditandatangani, maka kita akan menggunakan <code>icmp</code> sebagai instruksi, dan kata kunci yang digunakan dalam perbandingan akan menjadi <code>ult</code> .  Untuk membandingkan angka floating point, instruksi lain digunakan, <code>fcmp</code> , yang bekerja dengan cara yang sama. <br><br><h2>  <font color="#3AC1EF">Ringkasan</font> </h2><br>  Saya percaya bahwa dalam artikel ini saya memeriksa fitur yang paling penting dari LLVM IR.  Tentu saja masih banyak hal.  Secara khusus, dalam representasi kode yang sedang, mungkin ada banyak anotasi yang memungkinkan mempertimbangkan fitur-fitur tertentu dari kode yang diketahui oleh kompiler selama melewati optimisasi yang tidak dapat diekspresikan dengan cara lain dalam IR.  Misalnya, ini adalah flag <code>inbounds</code> dari instruksi <code>inbounds</code> , atau <code>nuw</code> <code>nsw</code> dan <code>nuw</code> , yang dapat ditambahkan ke pernyataan <code>add</code> .  Hal yang sama berlaku untuk kata kunci <code>private</code> , yang menunjukkan kepada pengoptimal bahwa fungsi yang ditandai olehnya tidak akan dirujuk dari luar unit kompilasi saat ini.  Ini memungkinkan Anda untuk melakukan banyak optimasi antar-prosedur yang menarik, seperti menghilangkan argumen yang tidak digunakan. <br><br>  Anda dapat membaca lebih lanjut tentang LLVM dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi</a> , yang akan sering Anda rujuk ketika mengembangkan kompiler berbasis LLVM Anda sendiri.  Berikut ini adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">panduan</a> yang membahas pengembangan kompiler untuk bahasa yang sangat sederhana.  Kedua sumber informasi ini akan berguna ketika membuat kompiler Anda sendiri. <br><br>  <b>Pembaca yang budiman!</b>  Apakah Anda menggunakan LLVM? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id451476/">https://habr.com/ru/post/id451476/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id451460/index.html">Julia dalam labirin</a></li>
<li><a href="../id451462/index.html">Tulis lebih sedikit kode duplikat menggunakan binder di Laravel</a></li>
<li><a href="../id451464/index.html">Frontend Weekly Digest (6 - 12 Mei 2019)</a></li>
<li><a href="../id451466/index.html">graphql - jebakan</a></li>
<li><a href="../id451468/index.html">Intisari bahan-bahan segar dari dunia front-end untuk minggu terakhir No. 364 (6 - 12 Mei 2019)</a></li>
<li><a href="../id451478/index.html">Mempercepat eksplorasi data menggunakan panda-profiling library</a></li>
<li><a href="../id451480/index.html">Mengapa Departemen Perindustrian dan Perdagangan melarang penyimpanan data pada peralatan asing</a></li>
<li><a href="../id451482/index.html">Kompetensi programmer modern dari sudut yang berbeda</a></li>
<li><a href="../id451488/index.html">Perhitungan kanibalisasi didasarkan pada uji A / B klasik dan metode bootstrap</a></li>
<li><a href="../id451492/index.html">Tujuh Variabel Bash yang Tidak Terduga</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>