<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😸 👩🏿‍🔬 🏧 Demande de framework pour un bot multi-plateforme 🧖🏼 🐬 👩🏻‍⚖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les chatbots sont étroitement entrés dans notre vie d'informations, tous les réseaux sociaux qui se respectent et les messageries instantanées prennen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Demande de framework pour un bot multi-plateforme</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422081/"><img src="https://habrastorage.org/getpro/habr/post_images/10c/297/311/10c2973112bf3e696147b9c86d6d333e.jpg" alt="image"><br><br>  Les chatbots sont étroitement entrés dans notre vie d'informations, tous les réseaux sociaux qui se respectent et les messageries instantanées prennent en charge les bots, ils fournissent une API pratique pour leur développement et leur utilisation, le tout pour le confort des utilisateurs et des programmeurs.  Maintenant, pour créer un bot dans Telegram, il n'est même pas nécessaire de connaître un langage de programmation.  Il existe des services qui vous permettent de concevoir un bot à l'aide de l'interface Web.  Et c'est vraiment bien, mais récemment, j'ai rencontré un problème et j'ai été surpris de constater que sur cette vague de popularité des chatbots, qui ne sont désormais plus seulement une fonctionnalité intéressante, mais aussi un outil générateur de revenus - il n'y a pratiquement pas de réponse. <br><br>  Et la question est: et si je veux créer plus d'un bot pour un service?  Par exemple, je sais que CA est assis à Vkontakte et Telegram, comment puis-je écrire des bots avec un minimum d'effort pour travailler avec des gens là et là?  Si soudainement (par exemple, en tant que propriétaire d'une boutique en ligne), je souhaite également travailler avec le public sur Facebook à l'aide de bots, ai-je vraiment besoin de développer un nouveau bot à partir de zéro et de réécrire toute la logique pour cela ou d'essayer de plonger dans une nouvelle API ou bibliothèque.  Et j'ai essayé de trouver la réponse sous la coupe, je demande à la table. <br><a name="habracut"></a><br>  En fait, il existe des solutions, et il y en a beaucoup, mais elles se résument toutes au fait que vous devez héberger votre bot avec un service qui fournit également une plate-forme.  Autrement dit, vous ne pouvez pas obtenir une solution en boîte.  Je me trompe peut-être et je n'ai pas entièrement étudié ce qui existe réellement, mais le fait que le premier lien dans Google ne mène pas à une solution est déjà alarmant.  Il y a aussi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Botman</a> .  Il s'agit d'une bibliothèque open source de développement à part entière très puissante avec un tas de puces et une documentation complète.  Et il est écrit en <i>PHP.</i>  Je n'ai rien contre <i>PHP</i> , en tout cas je ne l'admets pas publiquement, afin de ne pas créer d'holivar inutile, mais je ne veux pas du tout développer dessus.  J'ai décidé de chercher quelque chose de similaire à Python, en plus de Python, il existe de nombreuses bibliothèques qui vous permettent de travailler avec l'API Telegram Bot.  Et je n'ai rien trouvé, alors je suis vite arrivé à la conclusion qu'il valait la peine de m'écrire.  <i>(Peut-être que quelqu'un connaît les solutions appropriées pour les robots multi-plateformes avec un système ouvert, je serai heureux de toute information)</i> <br><br>  Ici, au fait, un autre problème se prépare.  Je ne sais absolument pas où vous pouvez partager votre travail avec le public sous la forme d'un article autre que sur Habré.  Je serai très heureux de vous aider dans cette affaire. <br><br>  Le nom <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Botovod</a> est venu tout seul. <br><br>  En général, je vais donner un petit code en utilisant Botovod et l'expliquer brièvement. <br><div class="spoiler">  <b class="spoiler_title">En-tête de spoiler</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> botovod <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Botovod, Message, utils @utils.convert_to_text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, text)</span></span></span><span class="hljs-function">:</span></span> message = Message() message.text = <span class="hljs-string"><span class="hljs-string">"  "</span></span> agent.send_message(chat, message) @utils.convert_to_images <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler_images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, images)</span></span></span><span class="hljs-function">:</span></span> message = Message() message.text = <span class="hljs-string"><span class="hljs-string">"  "</span></span> agent.send_message(chat, message) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler_echo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, message)</span></span></span><span class="hljs-function">:</span></span> agent.send_message(chat, message) settings = [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"telegram"</span></span>, <span class="hljs-string"><span class="hljs-string">"agent"</span></span>: <span class="hljs-string"><span class="hljs-string">"botovod.agents.telegram"</span></span>, <span class="hljs-string"><span class="hljs-string">"settings"</span></span>: {<span class="hljs-string"><span class="hljs-string">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"462755273:AzBZBQ7AAnqFEXqZ_P8Z-qvCddmjqTVAYPI"</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"polling"</span></span>} }, ] botovod = Botovod(settings) botovod.add_handler(handler_message) botovod.add_handler(handler_images) botovod.add_handler(handler_echo) botovod.start()</code> </pre> <br></div></div><br><br>  Ici, nous définissons 3 gestionnaires pour les messages entrants, chacun envoyant quelque chose en réponse.  Le premier: «J'ai reçu un message», le second: «Je vois une photo», le troisième renvoie simplement ce que j'ai reçu.  Ensuite, nous créons un gestionnaire de bot (Botovod) et lui passons les paramètres pour les bots, dans celui-ci pour le bot dans Telegram.  Ensuite, nous ajoutons séquentiellement des gestionnaires de messages.  Si un message arrive au bot, il ira au premier gestionnaire qui accepte de l'accepter.  Par exemple, si un fichier audio nous a été envoyé, le premier gestionnaire tentera de l'accepter en premier, mais refusera, car il ne s'agit pas de texte.  Ensuite, il acceptera la seconde, mais refusera également, car ce n'est pas une image, puis il acceptera la troisième, qui n'a aucune restriction - de cette façon, il transmettra l'audio orthogonalement.  Les contraintes sont imposées en tant que décorateurs à partir du module utils. <br><br>  Maintenant, je vais essayer de dire en détail ce qui est quoi: <br><br>  Il y a un gestionnaire de bot - un objet de la classe Botovod - le nom du bot (chacun a son propre unique), la classe d'agent qui le traitera et les paramètres du bot lui seront transmis dans le constructeur.  En outre, les gestionnaires sont ajoutés à tour de rôle au gestionnaire de bot.  Si un message arrive au bot, le gestionnaire les vérifiera à son tour jusqu'à ce qu'il trouve le gestionnaire qui lève l'exception NotPassed.  Le premier gestionnaire ajouté est vérifié en premier, le dernier, respectivement, le dernier.  Si vous avez l'intention d'utiliser des webhooks, le gestionnaire de bots peut être connecté au serveur Web.  Pour ce faire, le gestionnaire de bot dispose d'une méthode d'écoute qui accepte le nom du bot, les en-têtes et le corps de la demande.  Il transmet ensuite ces données à l'analyseur d'agent, qui renvoie le message généré, une fois ce message poussé à travers les gestionnaires.  En réponse, la méthode listen renvoie le dictionnaire {"status": any_code, "headers": dict (), "body": "any_text"}, où dans les en-têtes sont les en-têtes de réponse, et dans le corps est le corps de réponse.  Parfois, le messager / réseau social nécessite que le serveur retourne un objet, donc je pense que ce comportement est pratique. <br><br>  Je vais donner un exemple pour le bot Vkontakte sous le nom "vk-bot", et Botovod se connectera au serveur Django <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> response = manager.listen(<span class="hljs-string"><span class="hljs-string">"vk-bot"</span></span>, request.headers, request.text) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HttpResponse(status = response[<span class="hljs-string"><span class="hljs-string">"status"</span></span>], headers = response[<span class="hljs-string"><span class="hljs-string">"headers"</span></span>], response[<span class="hljs-string"><span class="hljs-string">"body"</span></span>])</code> </pre><br><br>  Un message formé est un objet de la classe Message.  Il comprend les champs suivants: texte - texte du message;  images - une liste d'images;  audios - une liste avec des fichiers audio;  vidéos - une liste de vidéos;  documents - une liste de documents;  emplacements - une liste avec des endroits sur la carte;  raw - le corps du message brut ou des informations supplémentaires (dictionnaire). <br><br>  De plus, chaque liste de l'objet Message (images, audios, vidéos, documents) contient des objets spéciaux dont les classes sont héritées de Attachment.  Par défaut, la classe Attachment a les méthodes url et file_path dans lesquelles les analyseurs d'agent mettent généralement des informations sur le fichier reçu.  La liste des emplacements contient des objets Emplacement, au constructeur dont vous devez transmettre la longitude et la latitude (longitude et latitude). <br><br>  Voici un exemple de construction de messages dans les gestionnaires <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, message)</span></span></span><span class="hljs-function">:</span></span> out = botovod.Message() image = botovod.Image() image.file_path = <span class="hljs-string"><span class="hljs-string">"/tmp/1.png"</span></span> location = botovod.Location() out.images.append(image) out.text = <span class="hljs-string"><span class="hljs-string">" ,   "</span></span> agent.send_message(chat, out)</code> </pre><br><br>  C'est tout ce qu'il y a pour l'instant, mais j'espère que quelqu'un sera intéressé par une telle solution et que quelqu'un voudra aider avec des conseils, des commentaires, des idées et peut-être leur propre participation au développement.  Merci à tous d'avoir lu! <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien Github</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr422081/">https://habr.com/ru/post/fr422081/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr422069/index.html">PHP Digest n ° 138 (20 août - 2 septembre 2018)</a></li>
<li><a href="../fr422071/index.html">Assez pour tout le monde, ou comment fournir Internet aux pays en développement</a></li>
<li><a href="../fr422073/index.html">La façon la plus simple de prendre en charge l'intégration d'un client java avec un serveur java</a></li>
<li><a href="../fr422077/index.html">L'injection JavaScript est-elle pertinente?</a></li>
<li><a href="../fr422079/index.html">Le condensé de matières fraîches du monde du front-end de la dernière semaine n ° 329 (27 août - 2 septembre 2018)</a></li>
<li><a href="../fr422083/index.html">Site d'une seule page sur Kotlin et SpringBoot sans utiliser JSP</a></li>
<li><a href="../fr422085/index.html">Trier par sélection</a></li>
<li><a href="../fr422087/index.html">Vision par ordinateur dans l'industrie. Conférence à Yandex</a></li>
<li><a href="../fr422089/index.html">Contexte d'exécution JavaScript et pile d'appels</a></li>
<li><a href="../fr422091/index.html">Utilisation efficace des méthodes de tableau en JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>