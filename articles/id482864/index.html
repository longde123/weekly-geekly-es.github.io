<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™‹ ğŸ‘©â€ğŸš’ ğŸ‘°ğŸ¿ Video pengawasan rumah. Skema menjaga arsip video tanpa pendaftar rumah ğŸ‘¨ğŸ¿ ğŸ§—ğŸ¿ âš°ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Untuk beberapa waktu saya ingin menulis artikel tentang skrip untuk bekerja dengan kamera melalui protokol DVRIP, tetapi diskusi tentang berita terbar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Video pengawasan rumah. Skema menjaga arsip video tanpa pendaftar rumah</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482864/">  Untuk beberapa waktu saya ingin menulis artikel tentang skrip untuk bekerja dengan kamera melalui protokol DVRIP, tetapi diskusi tentang berita terbaru tentang <a href="https://habr.com/ru/news/t/482770">Xiaomi</a> mendorong saya untuk pertama-tama berbicara tentang bagaimana saya mengatur pengawasan video di rumah, kemudian melanjutkan ke skrip dan banyak lagi. <br><br>  <strike>Kami punya 2 paket ...</strike> Jadi, hentikan, ini bukan ceritanya. <br>  Kami memiliki 2 router TP-LINK, akses Internet untuk penyedia NAT, kamera pengintai Partizan Saya tidak ingat model mana (kamera IP apa pun yang mendukung RTSP melalui TCP atau DVRIP akan bekerja) dan VPS murah untuk 4 euro dengan karakteristik: 2 inti CPU 2.4GHz, 4GB RAM, 300 GB HDD, 100 Mbit / s port.  Dan juga keengganan untuk membeli barang lain yang harganya lebih mahal dari kabel patch. <br><a name="habracut"></a><br><h3>  Kata Pengantar </h3><br>  Untuk alasan yang jelas, kita tidak bisa hanya meneruskan port kamera pada router dan menikmati hidup, selain itu, bahkan jika kita bisa, kita tidak boleh melakukan ini. <br><br>  Dari telinga saya, saya mendengar bahwa ada beberapa opsi dengan tunneling IPv6, di mana tampaknya Anda dapat membuat segalanya sehingga semua perangkat di jaringan menerima alamat IPv6 eksternal, dan ini akan menyederhanakan banyak hal, meskipun masih meninggalkan keamanan acara ini dipertanyakan. , dan juga dukungan dalam firmware TP-LINK standar untuk keajaiban ini, entah bagaimana aneh.  Meskipun ada kemungkinan bahwa dalam kalimat sebelumnya saya berbicara omong kosong, jadi jangan perhatikan sama sekali. <br><br>  Tetapi, untungnya, hampir semua firmware untuk router apa pun (pernyataan yang sebenarnya tidak berdasar) mengandung klien PPTP / L2TP atau kemampuan untuk menginstal firmware khusus dengan kehadirannya.  Dan dari sini kita sudah bisa membangun semacam strategi perilaku. <br><br><h3>  Topologi </h3><br>  Dalam demam, otak saya melahirkan sesuatu seperti skema koneksi ini, <br><br><div class="spoiler">  <b class="spoiler_title">dan selama serangan lain dia menggambar untuk memasang majalah geek</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/og/sk/5j/ogsk5j5rwmyz8ocg8qk8kjod8da.png"><br></div></div><br>  <i>Alamat 169.178.59.82 dibuat secara acak dan hanya berfungsi sebagai contoh.</i> <br><br>  Nah, atau jika dalam kata-kata, maka: <br><br><ul><li>  <b>Router TP-LINK 1 (192.168.1.1)</b> , ke mana kabel dimasukkan, yang menjulur keluar dari dinding.  Pembaca yang ingin tahu akan menebak bahwa ini adalah kabel penyedia melalui mana saya mendapatkan akses ke Internet.  Berbagai perangkat rumah terhubung ke router ini melalui kabel patch atau Wi-Fi.  Ini adalah jaringan <b>192.168.1.0</b> </li><li>  <b>Router TP-LINK 2 (192.168.0.1, 192.168.1.200)</b> , ke mana kabel dimasukkan, yang menonjol dari router TP-LINK 1. Berkat kabel ini, router TP-LINK 2, serta perangkat yang terhubung dengannya, juga memiliki akses ke internet.  Pada router ini, koneksi PPTP (10.0.5.100) ke server 169.178.59.82 dikonfigurasi.  IP Camera 192.168.0.200 juga terhubung ke router ini dan port berikut diteruskan <ul><li>  192.168.0.200:80 -&gt; 49151 (webmord) </li><li>  192.168.0.200 âˆ— 4567 -&gt; 49152 (DVRIP) </li><li>  192.168.0.200/1054 -&gt; 49153 (RTSP) </li></ul></li><li>  <b>Server (169.178.59.82, 10.0.5.1)</b> , yang terhubung dengan router TP-LINK 2. Pptpd, shadowsocks dan 3proxy berputar di server, di mana Anda dapat mengakses perangkat jaringan 10.0.5.0 dan karenanya memiliki akses ke router TP-LINK 2 . </li></ul><br>  Dengan demikian, semua perangkat rumah di jaringan 192.168.1.0 memiliki akses ke kamera melalui TP-LINK 2 di 192.168.1.200, dan semua yang lain dapat terhubung melalui pptp, shadowsocks atau socks5 dan akses 10.0.5.100. <br><br><h3>  Kustomisasi </h3><br>  Langkah pertama adalah menghubungkan semua perangkat sesuai dengan diagram pada gambar di atas. <br><br><ul><li>  Menyiapkan router TP-LINK 1 sama dengan reservasi alamat 192.168.1.200 untuk TP-LINK 2. Secara opsional, jika Anda memerlukan alamat tetap untuk akses dari jaringan 192.168.1.0.  Dan, jika diinginkan, Anda dapat memesannya 10-20 Mbit (10 sudah cukup untuk satu streaming video dalam 1080 dengan kepala). </li><li>  Anda perlu menginstal dan mengkonfigurasi pptpd di server.  Saya memiliki Ubuntu 18.04 dan tindakannya kira-kira sebagai berikut (contohnya adalah <a href="" rel="nofollow">blog.xenot.ru/bystraya-nastrojka-vpn-servera-pptp-na-ubuntu-server-18-04-lts.fuck</a> ): <ul><li>  Instal paket yang diperlukan: <br><br><pre><code class="bash hljs">sudo apt install pptpd iptables-persistent</code> </pre> </li><li>  Kami membawa ke formulir berikut <br><br><div class="spoiler">  <b class="spoiler_title">/etc/pptpd.conf</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">option /etc/ppp/pptpd-options bcrelay eth0 # ,        logwtmp localip 10.0.5.1 remoteip 10.0.5.100-200</code> </pre> <br></div></div></li><li>  Benar <br><br><div class="spoiler">  <b class="spoiler_title">/ etc / ppp / pptpd-options</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">novj novjccomp nologfd name pptpd refuse-pap refuse-chap refuse-mschap require-mschap-v2 #require-mppe-128 #  ,   TP-LINK c    ms-dns 8.8.8.8 ms-dns 1.1.1.1 ms-dns 77.88.8.8 ms-dns 8.8.4.4 ms-dns 1.0.0.1 ms-dns 77.88.8.1 proxyarp nodefaultroute lock nobsdcomp</code> </pre></div></div></li><li>  Tambahkan kredensial ke <br><br><div class="spoiler">  <b class="spoiler_title">/ etc / ppp / chap-secrets</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"># Secrets for authentication using CHAP # client server secret IP addresses username pptpd password *</code> </pre> </div></div></li><li>  Tambahkan ke <br><br><div class="spoiler">  <b class="spoiler_title">/etc/sysctl.conf</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">net.ipv4.ip_forward=1</code> </pre> </div></div><br>  dan memuat kembali sysctl <br><br><pre> <code class="bash hljs">sudo sysctl -p</code> </pre> </li><li>  Reboot pptpd dan tambahkan ke startup <br><br><pre> <code class="bash hljs">sudo service pptpd restart sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> pptpd</code> </pre> </li><li>  Benar <br><br><div class="spoiler">  <b class="spoiler_title">iptables</b> <div class="spoiler_text"><pre> <code class="bash hljs">sudo iptables -A INPUT -p tcp -m tcp --dport 22 -j ACCEPT sudo iptables -A INPUT -p tcp -m tcp --dport 1723 -j ACCEPT sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE sudo iptables --table nat --append POSTROUTING --out-interface ppp+ -j MASQUERADE sudo iptables -I INPUT -s 10.0.5.0/24 -i ppp+ -j ACCEPT sudo iptables --append FORWARD --<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>-interface eth0 -j ACCEPT</code> </pre> </div></div><br>  Dan simpan <br><br><pre> <code class="bash hljs">sudo netfilter-persistent save sudo netfilter-persistent reload</code> </pre></li></ul></li><li>  Konfigurasikan TP-LINK 2 <ul><li>  Kami memesan alamat 192.168.0.200 untuk kamera kami: <br><br><div class="spoiler">  <b class="spoiler_title">DHCP -&gt; Reservasi Alamat</b> <div class="spoiler_text">  - Alamat MAC - Kamera MAC, dapat dilihat di DHCP -&gt; Daftar Klien DHCP <br>  - Alamat IP Khusus - 192.168.0.200 </div></div></li><li>  Kami meneruskan port: <br><div class="spoiler">  <b class="spoiler_title">Penerusan -&gt; Server Virtual</b> <div class="spoiler_text">  - Port layanan: 49151, Port internal: 80, alamat IP: 192.168.0.200, Protokol: TCP <br>  - Port layanan: 49152, Port internal: 34567, alamat IP: 192.168.0.200, Protokol: TCP <br>  - Port layanan: 49153, Port internal: 554, alamat IP: 192.168.0.200, Protokol: TCP <br></div></div></li><li>  Konfigurasikan koneksi VPN: <br><br><div class="spoiler">  <b class="spoiler_title">Jaringan -&gt; WAN</b> <div class="spoiler_text">  - Jenis koneksi WAN: PPTP <br>  - Nama pengguna: nama pengguna (lihat / etc / ppp / chap-secrets) <br>  - Kata sandi: kata sandi (lihat / etc / ppp / chap-secrets) <br>  - Konfirmasi kata sandi: kata sandi (lihat / etc / ppp / chap-secrets) <br>  - IP dinamis <br>  - Alamat IP / Nama Server: 169.178.59.82 (jelas IP eksternal server Anda) <br>  - Mode koneksi: Terhubung secara otomatis <br></div></div></li><li>  Secara opsional mengizinkan akses jarak jauh ke router web <br><div class="spoiler">  <b class="spoiler_title">Keamanan -&gt; Manajemen Jarak Jauh</b> <div class="spoiler_text">  - Port Manajemen Web: 80 <br>  - Alamat IP kendali jarak jauh: 255.255.255.255 </div></div></li><li>  Reboot router TP-LINK 2 </li></ul></li></ul><br><br>  <i>Alih-alih PPTP, Anda dapat menggunakan L2TP atau, jika Anda memiliki firmware khusus, maka semua yang diinginkan hati Anda.</i>  <i>Saya memilih PPTP, karena skema ini dibangun bukan karena alasan keamanan, tetapi pptpd dalam pengalaman saya adalah server VPN tercepat.</i>  <i>Selain itu, saya benar-benar tidak ingin menginstal custom firmware, yang berarti saya harus memilih antara PPTP dan L2TP.</i> <br><br>  Jika saya tidak membuat kesalahan dalam panduan di mana pun, dan Anda melakukan segalanya dengan benar dan Anda beruntung, maka setelah semua manipulasi ini <ul><li>  pertama <br><br><pre> <code class="bash hljs">ifconfig</code> </pre> <br>  akan menampilkan antarmuka <code>ppp0 inet 10.0.5.1 netmask 255.255.255.255 destination 10.0.5.100</code> , </li><li>  kedua 10.0.5.100 harus merespons, </li><li>  dan ketiga <br><br><pre> <code class="bash hljs">ffprobe -rtsp_transport tcp <span class="hljs-string"><span class="hljs-string">"rtsp://10.0.5.100:49153/user=admin&amp;password=password&amp;channel=1&amp;stream=0.sdp"</span></span></code> </pre> <br>  Harus mendeteksi aliran. <br>  <i>port rtsp, login dan kata sandi yang dapat Anda temukan di dokumentasi untuk kamera Anda</i> <br></li></ul><br><br><h3>  Kesimpulan </h3><br>  Pada prinsipnya, ini sudah tidak buruk, ada akses ke RTSP, jika perangkat lunak berpemilik bekerja melalui DVRIP, maka Anda dapat menggunakannya.  Anda dapat menyimpan streaming menggunakan ffmpeg, mempercepat video 2-3-5 kali, memecahnya menjadi beberapa jam, mengunggah semuanya ke googledisk atau jejaring sosial dan banyak lagi. <br><br>  Saya tidak suka RTSP melalui TCP, karena entah bagaimana itu tidak bekerja dengan sangat stabil, tetapi lebih dari UDP, karena alasan kami tidak bisa (atau bisa, tapi saya tidak ingin melakukan ini) meneruskan berbagai port tempat RTSP akan mendorong aliran video , Saya tidak bisa menggunakannya, saya menulis skrip yang menyeret aliran melalui TCP melalui DVRIP.  Ternyata lebih stabil. <br><br>  Dari kelebihan pendekatan - kita dapat mengambil sesuatu yang mendukung peluit 4G menggantikan router TP-LINK 2, daya semuanya bersama-sama dengan kamera dari UPS (yang pasti akan diperlukan jauh lebih luas daripada saat menggunakan perekam), di samping itu, rekaman hampir ditransmisikan secara instan ke server, jadi bahkan jika penyusup menembus Anda, mereka tidak akan dapat menghapus video.  Secara umum, ada ruang untuk bermanuver dan itu semua tergantung pada imajinasi Anda. <br><br>  PS: Saya tahu bahwa banyak produsen menawarkan solusi cloud yang sudah jadi, tetapi harganya hampir dua kali lipat dari harga angkatan udara saya (yang sudah saya miliki 3, jadi saya perlu menempatkan sumber daya di suatu tempat), memberikan jauh lebih sedikit kontrol, dan juga tidak kualitas sangat memuaskan. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id482864/">https://habr.com/ru/post/id482864/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id482854/index.html">Tentang Perkiraan</a></li>
<li><a href="../id482856/index.html">Orang Asing Ilahi</a></li>
<li><a href="../id482858/index.html">Sensor Jendela Nirkabel Buatan Rumah: STM32L051 + RFM69 + Android</a></li>
<li><a href="../id482860/index.html">Saya adalah kepala hubungan internasional di Google. Itu sebabnya saya pergi</a></li>
<li><a href="../id482862/index.html">Apakah ada GameDev di Sakhalin? 1.V</a></li>
<li><a href="../id482866/index.html">Apakah layak membeli Bitcoin tahun depan dan berapa biayanya</a></li>
<li><a href="../id482870/index.html">Bagaimana saya membeli laptop yang terkunci di eBay dan mencoba membuat AntiTheft saya berdasarkan IntelAMT</a></li>
<li><a href="../id482872/index.html">Poligon Dunia Lain</a></li>
<li><a href="../id482874/index.html">Kematian Koshchei dalam daftar rekomendasi (dapatkah Anda membuat YouTube nyaman dan aman?)</a></li>
<li><a href="../id482876/index.html">Perhitungan biaya produksi listrik tenaga surya untuk kebutuhan rumah tangga sendiri di pusat Eropa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>