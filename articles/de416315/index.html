<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêï üëª üï¥üèº ASP.NET Razor: L√∂sen einiger Architekturprobleme f√ºr das Ansichtsmodell üò≤ üåã ‚¨úÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einf√ºhrung 


 Hallo Kollegen! 
 Heute m√∂chte ich Ihnen meine Erfahrungen bei der Entwicklung der View Model- Architektur im Rahmen der Entwicklung vo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ASP.NET Razor: L√∂sen einiger Architekturprobleme f√ºr das Ansichtsmodell</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416315/"><p><img src="https://habrastorage.org/webt/43/es/ga/43esgacgwzxp5u79mhvdsxpsmom.png" alt="Bild"></p><br><h3 id="vvedenie">  Einf√ºhrung </h3><br><p> Hallo Kollegen! <br>  Heute m√∂chte ich Ihnen meine Erfahrungen bei der Entwicklung der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong>View Model-</strong></a> Architektur im Rahmen der Entwicklung von ASP.NET-Webanwendungen mithilfe der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong>Razor</strong></a> Template Engine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><strong>mitteilen</strong></a> . <br>  Die in diesem Artikel beschriebenen technischen Implementierungen sind f√ºr alle aktuellen Versionen von <strong>ASP</strong> geeignet <strong>.</strong>  <strong>NET</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MVC 5</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Core</a> usw.).  Der Artikel selbst richtet sich an Leser, die zumindest bereits Erfahrung mit diesem Stapel haben.  Es ist auch erw√§hnenswert, dass <u>wir</u> im Rahmen dessen <u>die N√ºtzlichkeit des Ansichtsmodells</u> und seine hypothetische Anwendung <u>nicht ber√ºcksichtigen</u> (es wird angenommen, dass der Leser bereits mit diesen Dingen vertraut ist), sondern die Implementierung direkt diskutieren. </p><br><h3 id="zadacha">  Herausforderung </h3><br><p>  F√ºr eine bequeme und rationale Assimilation des Materials schlage ich vor, sofort die Aufgabe zu ber√ºcksichtigen, die uns nat√ºrlich zu potenziellen Problemen und deren optimalen L√∂sungen f√ºhrt. <br>  Dies ist das Problem der banalen Hinzuf√ºgung beispielsweise eines neuen <strong>Autos</strong> zu einem bestimmten <strong>Fahrzeugkatalog</strong> .  Um die abstrakte Aufgabe nicht zu komplizieren, werden die Details der verbleibenden Aspekte absichtlich √ºbersehen.  Es scheint jedoch, dass die elementare Aufgabe darin besteht, alles mit einem Fokus auf die weitere Skalierung des Systems zu tun (insbesondere das Erweitern von Modellen in Bezug auf die Anzahl der Eigenschaften und anderer definierender Komponenten), damit es sp√§ter so angenehm wie m√∂glich ist, zu arbeiten. </p><a name="habracut"></a><br><h3 id="realizaciya">  Implementierung </h3><br><p>  Lassen Sie das Modell wie folgt aussehen (der Einfachheit halber werden Dinge wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Navigationseigenschaften</a> usw. nicht angegeben): </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Transport</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TransportTypeId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Number { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  Nat√ºrlich ist <strong>TransportTypeId</strong> ein Fremdschl√ºssel f√ºr ein Objekt vom Typ <strong>TransportType</strong> : </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TransportType</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  F√ºr die Verbindung zwischen Frontend und Backend verwenden wir die Vorlage <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Data Transfer Object</a> .  Dementsprechend sieht der DTO f√ºr das Hinzuf√ºgen eines Autos ungef√§hr so ‚Äã‚Äãaus: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TransportAddDTO</span></span> { [Required] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TransportTypeId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Required] [MaxLength(<span class="hljs-number"><span class="hljs-number">10</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Number { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  * <em>Verwendet Standardvalidierungsattribute aus <code>System.ComponentModel.DataAnnotations</code> .</em> </p><br><p>  Es ist Zeit herauszufinden, wie das Ansichtsmodell f√ºr die Seite zum Hinzuf√ºgen von Autos aussehen wird.  Einige Entwickler w√ºrden gerne erkl√§ren, dass <strong>TransportAddDTO</strong> selbst so w√§re, dies ist jedoch grunds√§tzlich falsch, da nichts in diese Klasse "eingepfercht" werden kann, au√üer direkt die Backend-Informationen, die zum Hinzuf√ºgen eines neuen Elements (per Definition) erforderlich sind.  Dar√ºber hinaus k√∂nnen auf der Hinzuf√ºgungsseite weitere Daten erforderlich sein: beispielsweise ein Verzeichnis <strong>von Fahrzeugtypen</strong> (auf dessen Grundlage <strong>TransportTypeId</strong> anschlie√üend ausgedr√ºckt wird).  In dieser Hinsicht bietet sich das folgende Ansichtsmodell an: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TransportAddViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;TransportTypeDTO&gt; TransportTypes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  Wobei <strong>TransportTypeDTO</strong> in diesem Fall eine direkte Zuordnung von <strong>TransportType ist</strong> (und dies ist bei weitem nicht immer der Fall - sowohl in Richtung der K√ºrzung als auch in Richtung der Erweiterung): </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TransportTypeDTO</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  In dieser Phase stellt sich die vern√ºnftige Frage: In <strong>Razor</strong> kann nur ein Modell √ºbertragen werden (und Gott sei Dank). Wie kann <strong>TransportAddDTO</strong> dann zum Generieren von HTML-Code auf dieser Seite verwendet werden? <br>  Sehr einfach!  Es reicht aus, insbesondere dieses <strong>DTO</strong> zum <strong>Ansichtsmodell</strong> hinzuzuf√ºgen, etwa so: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TransportAddViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TransportAddDTO AddDTO { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;TransportTypeDTO&gt; TransportTypes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  Nun beginnen die ersten Probleme.  Versuchen wir, der Seite in unserer .cshtml-Datei eine Standard- <strong>TextBox</strong> f√ºr die "Fahrzeugnummer" hinzuzuf√ºgen (sei es TransportAddView.cshtml): </p><br><pre> <code class="hljs julia"><span class="hljs-meta"><span class="hljs-meta">@model</span></span> TransportAddViewModel <span class="hljs-meta"><span class="hljs-meta">@Html</span></span>.TextBoxFor(m =&gt; m.AddDTO.<span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>)</code> </pre> <br><p>  Dies wird wie folgt in HTML-Code gerendert: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AddDTO_Number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AddDTO.Number"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p>  Stellen Sie sich vor, der Teil des Controllers mit der Methode zum Hinzuf√ºgen von Fahrzeugen sieht folgenderma√üen aus (der <em>Code gem√§√ü MVC 5 ist f√ºr Core etwas anders, aber das Wesentliche ist dasselbe</em> ): </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Route(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"add"</span></span></span><span class="hljs-meta">), HttpPost</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TransportAddDTO transportAddDto</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     transportAddDto... }</span></span></code> </pre> <br><p>  Hier sehen wir mindestens zwei Probleme: </p><br><ol><li>  <strong>ID-</strong> und <strong>Name-</strong> Attributen wird <strong>AddDTO</strong> vorangestellt. Wenn die Methode zum Hinzuf√ºgen eines Transports im Controller mithilfe des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Modellbindungsprinzips</a> versucht, die vom Client an <strong>TransportAddDTO</strong> <strong>gelieferten</strong> Daten zu binden, besteht das darin enthaltene Objekt vollst√§ndig aus Nullen (Standardwerten). d.h.  Es wird nur eine neue leere Instanz sein.  Es ist logisch - der <strong>Ordner</strong> erwartet Namen der Formularnummer, nicht <strong>AddDTO_Number</strong> . </li><li>  Alle Metaattribute sind weg, d.h.  <strong>Datenwert erforderlich</strong> und alle anderen, die wir in <strong>AddDTO</strong> so sorgf√§ltig als Validierungsattribute beschrieben haben.  F√ºr diejenigen, die die volle Leistung von Razor nutzen, ist dies von entscheidender Bedeutung, da dies einen erheblichen Informationsverlust f√ºr das Frontend darstellt. <br>  Wir haben Gl√ºck und sie haben entsprechende Entscheidungen. </li></ol><br><p>  Diese Dinge "funktionieren", wenn Sie beispielsweise einen Wrapper f√ºr die Kendo-Benutzeroberfl√§che verwenden (d. H. <code>@Html.Kendo().TextBoxFor()</code> usw.). </p><br><p>  Beginnen wir mit dem zweiten Problem: Der Grund daf√ºr ist, dass im <strong>Ansichtsmodell die</strong> √ºbertragene <strong>TransportAddDTO-</strong> Instanz <strong>null war</strong> .  Und die Implementierung von Rendering-Mechanismen ist so, dass Attribute in diesem Fall zumindest nicht vollst√§ndig gelesen werden.  Die L√∂sung liegt auf der Hand - zuerst im <strong>Ansichtsmodell,</strong> um die <strong>TransportAddDTO-</strong> Eigenschaft mit einer Instanz der Klasse unter Verwendung des Standardkonstruktors <strong>zu</strong> initialisieren.  Es ist besser, dies in einem Dienst zu tun, der ein initialisiertes Ansichtsmodell zur√ºckgibt. Als Teil des Beispiels wird jedoch dasselbe getan: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TransportAddViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TransportAddDTO AddDTO { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TransportAddDTO(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;TransportTypeDTO&gt; TransportTypes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  Nach diesen √Ñnderungen sieht das Ergebnis wie folgt aus: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AddDTO_Number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AddDTO.Number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"The Number field is required."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-length</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"The field Number must be a string with a maximum length of 10."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-length-max</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p>  Schon besser!  Es bleibt das erste Problem zu l√∂sen - damit ist √ºbrigens alles etwas komplizierter. <br>  Um dies zu verstehen, m√ºssen Sie zun√§chst herausfinden, was <strong>Razor</strong> (impliziert WebViewPage, von dem eine Instanz in <strong>.cshtml</strong> als <strong>solche</strong> verf√ºgbar ist) eine <strong>HTML-</strong> Eigenschaft ist, auf die wir verweisen, um <code>TextBoxFor</code> . <br>  Wenn Sie es betrachten, k√∂nnen Sie sofort verstehen, dass es vom Typ <code>HtmlHelper&lt;T&gt;</code> , in unserem Fall <code>HtmlHelper&lt;TransportAddViewModel&gt;</code> .  Eine m√∂gliche L√∂sung f√ºr das Problem ergibt sich: Erstellen Sie Ihren eigenen <strong>HtmlHelper im</strong> Inneren und √ºbergeben Sie unser <strong>TransportAddDTO</strong> als Eingabe.  Wir finden den kleinstm√∂glichen Konstruktor f√ºr eine Instanz dieser Klasse: </p><br><pre> <code class="cs hljs">HtmlHelper&lt;T&gt;.HtmlHelper(ViewContext viewContext, IViewDataContainer viewDataContainer);</code> </pre> <br><p>  Wir k√∂nnen <strong>ViewContext</strong> direkt von unserer <strong>WebViewPage-</strong> Instanz √ºber <code>this.ViewContext</code> .  Lassen Sie uns nun herausfinden, wo Sie eine Instanz einer Klasse erhalten, die die IViewDataContainer-Schnittstelle implementiert.  Erstellen Sie beispielsweise Ihre Implementierung: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ViewDataContainer</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">IViewDataContainer</span></span> <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">T</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ViewDataDictionary ViewData { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ViewDataContainer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> model</span></span></span><span class="hljs-function">)</span></span> { ViewData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewDataDictionary(model); } }</code> </pre> <br><p>  Wie Sie sehen k√∂nnen, sind wir jetzt auf ein Objekt angewiesen, das zum Initialisieren des <strong>ViewDataDictionary</strong> an den Konstruktor <strong>√ºbergeben wurde</strong> , da hier alles einfach ist - dies ist eine Instanz unseres <strong>TransportAddDTO</strong> aus dem View-Modell.  Das hei√üt, Sie k√∂nnen die gesch√§tzte Instanz folgenderma√üen erhalten: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vdc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewDataContainer&lt;TransportAddDTO&gt;(Model.AddDTO);</code> </pre> <br><p>  Dementsprechend gibt es auch keine Probleme beim Erstellen eines neuen HtmlHelper: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Helper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HtmlHelper&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ViewContext, vdc);</code> </pre> <br><p>  Jetzt k√∂nnen Sie Folgendes verwenden: </p><br><pre> <code class="hljs scala"><span class="hljs-meta"><span class="hljs-meta">@model</span></span> <span class="hljs-type"><span class="hljs-type">TransportAddViewModel</span></span> @{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vdc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">ViewDataContainer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">TransportAddDTO</span></span>&gt;(<span class="hljs-type"><span class="hljs-type">Model</span></span>.<span class="hljs-type"><span class="hljs-type">AddDTO</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-type"><span class="hljs-type">Helper</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">HtmlHelper</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-type"><span class="hljs-type">ViewContext</span></span>, vdc); } <span class="hljs-meta"><span class="hljs-meta">@Helper</span></span>.<span class="hljs-type"><span class="hljs-type">TextBoxFor</span></span>(m =&gt; m.<span class="hljs-type"><span class="hljs-type">Number</span></span>)</code> </pre> <br><p>  Dies wird wie folgt in HTML-Code gerendert: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"The Number field is required."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-length</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"The field Number must be a string with a maximum length of 10."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-val-length-max</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><p>  Wie Sie sehen k√∂nnen, gibt es jetzt keine Probleme mit dem gerenderten Element und es ist voll einsatzbereit.  Es bleibt nur, den Code zu "k√§mmen", damit er weniger sperrig aussieht.  Zum Beispiel erweitern wir unseren ViewDataContainer wie folgt: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ViewDataContainer</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">IViewDataContainer</span></span> <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">T</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ViewDataDictionary ViewData { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ViewDataContainer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> model</span></span></span><span class="hljs-function">)</span></span> { ViewData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewDataDictionary(model); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HtmlHelper&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHtmlHelper</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ViewContext context</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HtmlHelper&lt;T&gt;(context, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } }</code> </pre> <br><p>  Dann k√∂nnen Sie von Razor aus wie folgt arbeiten: </p><br><pre> <code class="cs hljs">@model TransportAddViewModel @{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Helper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewDataContainer&lt;TransportAddDTO&gt;(Model.AddDTO).GetHtmlHelper(ViewContext); } @Helper.TextBoxFor(m =&gt; m.Number)</code> </pre> <br><p>  Dar√ºber hinaus st√∂rt es niemanden, die Standardimplementierung von <strong>WebViewPage</strong> so zu erweitern, dass sie die gew√ºnschte Eigenschaft enth√§lt (mit einem Setter f√ºr eine Instanz der DTO-Klasse). </p><br><h3 id="zaklyuchenie">  Fazit </h3><br><p>  Dies l√∂ste das Problem und erhielt auch die View Model-Architektur f√ºr die Arbeit mit Razor, die m√∂glicherweise alle erforderlichen Elemente enthalten k√∂nnte. </p><br><p>  Es ist erw√§hnenswert, dass sich der resultierende <strong>ViewDataContainer</strong> als universell und f√ºr die Verwendung geeignet herausstellte. </p><br><p>  Es m√ºssen noch einige Schaltfl√§chen zu unserer CSHTM-Datei hinzugef√ºgt werden, und die Aufgabe wird abgeschlossen (ohne Ber√ºcksichtigung der Verarbeitung im Backend).  Dies schlage ich selbst vor. </p><br><p>  Wenn ein angesehener Leser Ideen hat, wie er das, was ben√∂tigt wird, optimaler umsetzen kann, werde ich gerne in den Kommentaren zuh√∂ren. </p><br><p>  Mit freundlichen Gr√º√üen, <br>  Peter Osetrov </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de416315/">https://habr.com/ru/post/de416315/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de416303/index.html">Den ersten Ausl√∂ser neu erstellen</a></li>
<li><a href="../de416305/index.html">Standardisierung ist das l√§ngste Abenteuer im Internet der Dinge</a></li>
<li><a href="../de416307/index.html">iOS 12: Neu in Benachrichtigungen</a></li>
<li><a href="../de416309/index.html">Verwendung von HDF5-Dateien in Python</a></li>
<li><a href="../de416313/index.html">Checkliste f√ºr die Analyse von Sicherheitsereignisprotokollen</a></li>
<li><a href="../de416319/index.html">Hintergrund: IMEI- und Rossvyaz-Whitelists</a></li>
<li><a href="../de416321/index.html">Wie man ein Sprecher internationaler IT-Konferenzen wird</a></li>
<li><a href="../de416323/index.html">Die Option des wahlfreien Zugriffs auf die Einstellungen und Aufzeichnungen des Autokennzeichners von √ºberall im Internet</a></li>
<li><a href="../de416327/index.html">Was ist neu am neuen Standard 802.11ax (High Efficiency WLAN) und wann muss darauf gewartet werden?</a></li>
<li><a href="../de416329/index.html">Die R√ºckkehr der sowjetischen interplanetaren Station. Vorl√§ufige Prognose</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>