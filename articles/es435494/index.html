<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìè ‚ûï üöö Servidor cliente sin interrupciones üïí ‚ôãÔ∏è üôà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cualquier proyecto cliente-servidor implica una separaci√≥n clara de la base del c√≥digo en 2 partes (a veces m√°s): cliente y servidor. A menudo, cada p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Servidor cliente sin interrupciones</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435494/"><img src="https://habrastorage.org/webt/rq/-9/mh/rq-9mhais2g6p5dd5tsfv8rllak.jpeg" align="left">  Cualquier proyecto cliente-servidor implica una separaci√≥n clara de la base del c√≥digo en 2 partes (a veces m√°s): cliente y servidor.  A menudo, cada parte de este tipo se ejecuta en forma de un proyecto independiente por separado, respaldado por su propio equipo de desarrolladores. <br><br>  En este art√≠culo, propongo una mirada cr√≠tica a la divisi√≥n est√°ndar de c√≥digo en un backend y un frontend.  Y considere una alternativa donde el c√≥digo no tiene una l√≠nea clara entre el cliente y el servidor. <br><br><a name="habracut"></a><br><br><h3>  Contras del enfoque est√°ndar </h3><br>  La principal desventaja de la separaci√≥n est√°ndar del proyecto en 2 partes es la erosi√≥n de la l√≥gica empresarial entre el cliente y el servidor.  Editamos los datos en el formulario en el navegador, los verificamos en el c√≥digo del cliente y los enviamos a la aldea del abuelo (al servidor).  El servidor ya es otro proyecto.  All√≠, tambi√©n debe verificar la exactitud de los datos recibidos (es decir, duplicar la funcionalidad del cliente), hacer algunas manipulaciones adicionales (guardar en la base de datos, enviar correos electr√≥nicos, etc.). <br><br>  Por lo tanto, para rastrear toda la ruta de informaci√≥n desde el formulario en el navegador hasta la base de datos en el servidor, tendremos que profundizar en dos sistemas diversos.  Si los roles se dividen en un equipo y diferentes especialistas son responsables del backend y la interfaz, surgen problemas organizativos adicionales relacionados con su sincronizaci√≥n. <br><br><h3>  So√±emos </h3><br>  Supongamos que podemos describir la ruta de datos completa desde el formulario en el cliente hasta la base de datos en el servidor en un modelo.  En el c√≥digo, puede verse m√°s o menos as√≠ (el c√≥digo no funciona): <br><br><pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyDataModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//         verifyData(data) { //   .... return true; } //       client saveData(data) { if(this.verifyData(data)) this.writeDataToDb(data) else consol.log('error') } //  .     server writeDataToDb(data) { if(this.verifyData(data)) this.db.insert(data) else consol.log('error') } }</span></span></code> </pre> <br>  Por lo tanto, toda la l√≥gica de negocios del modelo est√° ante nuestros ojos.  Mantener dicho c√≥digo es m√°s f√°cil.  Estas son las ventajas que puede aportar la combinaci√≥n de m√©todos cliente-servidor en un modelo: <br><br><ol><li>  La l√≥gica de negocios se concentra en un solo lugar, no es necesario compartirla entre el cliente y el servidor. </li><li>  Puede transferir f√°cilmente la funcionalidad de servidor a cliente o de cliente a servidor durante el desarrollo del proyecto. </li><li>  No es necesario duplicar los mismos m√©todos para el backend y el frontend. </li><li>  Un conjunto √∫nico de pruebas para toda la l√≥gica de negocios del proyecto. </li><li>  Sustituci√≥n de l√≠neas horizontales de delimitaci√≥n de responsabilidad en el proyecto por verticales. </li></ol><br>  Revelar√© el √∫ltimo punto con m√°s detalle.  Imagine una aplicaci√≥n cliente-servidor normal en forma de dicho esquema: <br><br><img src="https://habrastorage.org/webt/8x/c9/de/8xc9degimzw-w-ln5w2ihiybi6w.jpeg" width="400"><br><br>  Vasya es responsable del frontend, Fedya, del backend.  La l√≠nea de delimitaci√≥n de responsabilidad corre horizontalmente.  Este esquema tiene las desventajas de cualquier estructura vertical: es dif√≠cil de escalar y tiene baja tolerancia a fallas.  Si el proyecto se est√° expandiendo, tendr√° que tomar una decisi√≥n bastante dif√≠cil: ¬øa qui√©n fortalecer Vasya o Fedya?  O si Fedya se enferm√≥ o renunci√≥, Vasya no podr√° reemplazarlo. <br><br>  El enfoque propuesto aqu√≠ le permite expandir la l√≠nea de divisi√≥n de responsabilidad en 90 grados y convertir la arquitectura vertical en horizontal. <br><br><img src="https://habrastorage.org/webt/v6/4m/9f/v64m9fuv5sonujosvh4yc4v8vbw.jpeg" width="400"><br><br>  Tal arquitectura es mucho m√°s f√°cil de escalar y m√°s tolerante a fallas.  Vasya y Fedya se vuelven intercambiables. <br><br>  En teor√≠a, se ve bien, intentemos implementar todo esto en la pr√°ctica, sin perder todo lo que nos da la existencia separada del cliente y el servidor en el camino. <br><br><h3>  Declaraci√≥n del problema. </h3><br>  No es necesario que tengamos un servidor cliente integrado en el producto.  Por el contrario, tal decisi√≥n ser√≠a extremadamente perjudicial desde todos los puntos de vista.  La tarea es que en el proceso de desarrollo tendr√≠amos una √∫nica base de c√≥digo para los modelos de datos para el backend y la interfaz, pero la salida ser√≠a un cliente y servidor independientes.  En este caso, obtendremos todas las ventajas del enfoque est√°ndar y obtendremos los servicios enumerados anteriormente para el desarrollo y el soporte del proyecto. <br><br><h3>  Soluci√≥n </h3><br>  He estado experimentando con la integraci√≥n de cliente y servidor en un archivo durante bastante tiempo.  Hasta hace poco, el principal problema era que en JS est√°ndar, la conexi√≥n de m√≥dulos de terceros en el cliente y el servidor era demasiado diferente: requiere (...) en node.js, toda la magia de AJAX en el cliente.  Todo ha cambiado con la llegada de los m√≥dulos ES.  En los navegadores modernos, "importar" ha sido compatible durante mucho tiempo.  Node.js est√° ligeramente retrasado en este aspecto y los m√≥dulos ES solo son compatibles con el indicador "--experimental-modules" habilitado.  Se espera que en el futuro previsible, los m√≥dulos funcionen de forma inmediata en node.js.  Adem√°s, es poco probable que algo cambie mucho, porque  En los navegadores, esta funcionalidad ha estado funcionando por defecto durante mucho tiempo.  Creo que ahora puede usar m√≥dulos ES no solo en el cliente sino tambi√©n en el lado del servidor (si tiene contraargumentos sobre este tema, escriba los comentarios). <br><br>  El esquema de soluci√≥n se ve as√≠: <br><br><img src="https://habrastorage.org/webt/xo/_a/vi/xo_avikvz1udp9-dwhxfe6ypt-q.png" width="600"><br><br>  El proyecto contiene tres cat√°logos principales: <br><br>  <b>protegido</b> - backend; <br>  <b>p√∫blico</b> - frontend; <br>  <b>shared</b> - modelos compartidos cliente-servidor. <br><br>  Un proceso de observaci√≥n independiente monitorea los archivos en el directorio compartido y, con cualquier cambio, crea versiones del archivo modificado por separado para el cliente y por separado para el servidor (en los directorios protegidos / compartidos y p√∫blicos / compartidos). <br><br><h3>  Implementaci√≥n </h3><br>  Considere el ejemplo de un simple mensajero en tiempo real.  Necesitaremos una nueva versi√≥n de node.js (tengo la versi√≥n 11.0.0) y Redis (instalarlos no est√° cubierto aqu√≠). <br><br>  Clonar un ejemplo: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/Kolbaskin/both-example <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ./both-example npm i</code> </pre><br>  Instale y ejecute el proceso de observador (observador en el diagrama): <br><br><pre> <code class="bash hljs">npm i both-js -g both ./index.mjs</code> </pre><br>  Si todo est√° en orden, el observador iniciar√° el servidor web y comenzar√° a monitorear los cambios en los archivos en los directorios compartidos y protegidos.  Cuando se realizan cambios en compartido, se crean las versiones correspondientes de los modelos de datos para el cliente y para el servidor.  Tras los cambios a protegido, el observador reiniciar√° autom√°ticamente el servidor web. <br><br>  Puede ver el rendimiento del mensajero en el navegador haciendo clic en el enlace <br><br> <code>http://localhost:3000/index.html?token=123&amp;user=Vasya</code> <br> <br>  (el token y el usuario son arbitrarios).  Para emular m√∫ltiples usuarios, abra la misma p√°gina en otro navegador especificando diferentes tokens y usuarios. <br><br>  Ahora un peque√±o c√≥digo. <br><br><h4>  Servidor web </h4><br>  protegido / server.mjs <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> express <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'express'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> bodyParser <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'body-parser'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// -     //  -  import wsServer from './lib/wsServer.mjs'; const app = express(); //   - wsServer(app); //  mime  mjs express.static.mime.define({'application/javascript': ['js','mjs']}); app.use( bodyParser.json() ); app.use(bodyParser.urlencoded({ extended: true })); //      public app.use(express.static('public')); const server = app.listen(3000, () =&gt; { console.log('server is running at %s', server.address().port); });</span></span></code> </pre><br>  Este es un servidor express regular, no hay nada interesante aqu√≠.  La extensi√≥n mjs es necesaria para los m√≥dulos ES en node.js.  Por coherencia, utilizaremos esta extensi√≥n para el cliente. <br><br><h4>  Cliente </h4><br>  public / index.html <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://cdn.jsdelivr.net/npm/vue/dist/vue.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/main.mjs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"users"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v-for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"user in users"</span></span></span><span class="hljs-tag">&gt;</span></span> {{ user.name }} ({{user.id}}) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"messages"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v-model</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"msg"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v-on:click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sendMessage()"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v-for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"message in messages"</span></span></span><span class="hljs-tag">&gt;</span></span>[{{ message.date }}] <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span>{{ message.text }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Por ejemplo, uso Vue en el cliente, pero esto no cambia la esencia.  En lugar de Vue, puede haber cualquier cosa en la que pueda separar el modelo de datos en una clase separada (knockout, angular). <br><br>  public / main.mjs <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//      - import ws from "/lib/Ws.mjs"; //       import Messages from "./shared/messages/model/dataModel.mjs"; //    import Users from "./shared/users/model/dataModel.mjs"; //  - (     ) window.WS = new ws({ token: new URLSearchParams(document.location.search).get("token"), user: new URLSearchParams(document.location.search).get("user") }); //       new Messages({ el: '#messages' }) //       new Users({ el: '#users' })</span></span></code> </pre><br>  main.mjs es un script que asocia modelos de datos con vistas correspondientes.  Para simplificar el c√≥digo, las representaciones de muestra para la lista de usuarios activos y feeds de mensajes se integran directamente en index.html <br><br><h4>  Modelo de datos </h4><br>  shared / messages / model / dataModel.mjs <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    //          , //    import Base from '@root/lib/Base.mjs'; export default class dataModel extends Base { //!#client constructor(attr) { attr.data = { msg: '', messages: [] } super(attr); //     this.on('newmessage', (data) =&gt; { this.messages.push(data) }) } //!#client async sendMessage(e) { //    await this.$sendMessage(this.msg); this.msg = ''; } //!#server async $sendMessage(text) { //   newmessage     this.fireEvent('newmessage', 'all', { date: new Date(), text }) return true; } }</span></span></code> </pre><br>  Estos diversos m√©todos implementan toda la funcionalidad de enviar y recibir mensajes en tiempo real.  Las directivas! #Client y! #Server le indican al proceso del observador qu√© m√©todo para qu√© parte (cliente o servidor) est√° destinado.  Si no existen estas directivas antes de definir un m√©todo, dicho m√©todo est√° disponible tanto en el cliente como en el servidor.  Las barras inclinadas de comentarios antes de la directiva son opcionales y existen solo para evitar que el IDE est√°ndar insista en errores de sintaxis. <br><br>  La primera l√≠nea de la ruta utiliza la b√∫squeda &amp; root.  Al generar las versiones de cliente y servidor, &amp; root se reemplazar√° con la ruta relativa a los directorios p√∫blicos y protegidos, respectivamente. <br><br>  Otro punto importante: desde el m√©todo del cliente, puede llamar solo al m√©todo del servidor, cuyo nombre comienza con "$": <br><br><pre> <code class="javascript hljs">... <span class="hljs-comment"><span class="hljs-comment">//    async sendMessage(e) { await this.$sendMessage(this.msg); &lt;-    this.msg = ''; } ...</span></span></code> </pre><br>  Esto se hace por razones de seguridad: desde el exterior solo puede recurrir a m√©todos especialmente dise√±ados para esto. <br><br>  Veamos las versiones de los modelos de datos que el observador gener√≥ para el cliente y el servidor. <br><br>  <b>Cliente</b> (public / shared / messages / model / dataModel.mjs) <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Base <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'/lib/Base.mjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dataModel</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Base</span></span></span><span class="hljs-class"> </span></span>{ __getFilePath__() {<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"messages/model/dataModel.mjs"</span></span>} <span class="hljs-comment"><span class="hljs-comment">// constructor(attr) { attr.data = { msg: '', messages: [] } super(attr); //     this.on('newmessage', (data) =&gt; { this.messages.push(data) }) } // async sendMessage(e) { //    await this.$sendMessage(this.msg); this.msg = ''; } // ... async $sendMessage() {return await this.__runSharedFunction("$sendMessage",arguments)} }</span></span></code> </pre><br>  En el lado del cliente, el modelo es un descendiente de la clase Vue (a trav√©s de Base.mjs).  Por lo tanto, puede trabajar con √©l como con un modelo de datos Vue normal.  El observador agreg√≥ el m√©todo __getFilePath__ a la versi√≥n del cliente del modelo, que devuelve la ruta al archivo de clase y reemplaz√≥ el c√≥digo del m√©todo del servidor $ sendMessage con una construcci√≥n que, en esencia, llamar√° al m√©todo que necesitamos en el servidor a trav√©s del mecanismo rpc (__runSharedFunction se define en la clase principal). <br><br>  <b>Servidor</b> (protegido / compartido / mensajes / modelo / dataModel.mjs) <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Base <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../lib/Base.mjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dataModel</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Base</span></span></span><span class="hljs-class"> </span></span>{ __getFilePath__() {<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"messages/model/dataModel.mjs"</span></span>} ...       ... <span class="hljs-comment"><span class="hljs-comment">// async $sendMessage(text) { //   newmessage     this.fireEvent('newmessage', 'all', { date: new Date(), text }) return true; } }</span></span></code> </pre><br>  ¬°En la versi√≥n del servidor, tambi√©n se agreg√≥ el m√©todo __getFilePath__ y se eliminaron los m√©todos del cliente marcados con la directiva! <br><br>  En ambas versiones generadas del modelo, todas las filas eliminadas se reemplazan por vac√≠as.  Esto se hace para que el mensaje de error en el depurador pueda encontrar f√°cilmente la l√≠nea problem√°tica en el c√≥digo fuente del modelo. <br><br><h4>  Interacci√≥n cliente-servidor </h4><br>  Cuando necesitamos llamar a alg√∫n m√©todo de servidor en el cliente, simplemente lo hacemos. <br>  Si la llamada est√° dentro del mismo modelo, entonces todo es simple: <br><br><pre> <code class="javascript hljs">... !#client <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> sendMessage(e) { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$sendMessage(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.msg); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.msg = <span class="hljs-string"><span class="hljs-string">''</span></span>; } !#server <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> $sendMessage(msg) { <span class="hljs-comment"><span class="hljs-comment">// -    } ...</span></span></code> </pre><br>  Puede "tirar" de otro modelo: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> dataModel <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"/shared/messages/model/dataModel.mjs"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> msg = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> dataModel(); msg.$sendMessage(<span class="hljs-string"><span class="hljs-string">'blah-blah-blah'</span></span>);</code> </pre><br>  En la direcci√≥n opuesta, es decir  Llamar a alg√∫n m√©todo de cliente en el servidor no funciona.  T√©cnicamente, esto es factible, pero desde un punto de vista pr√°ctico no tiene sentido, porque  el servidor es uno, pero hay muchos clientes.  Si necesitamos iniciar algunas acciones en el servidor en el cliente, usamos el mecanismo de eventos: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    ... //!#client constructor(attr) { .... //       "newmessage" this.on('newmessage', (data) =&gt; { this.messages.push(data) }) } //!#server async $sendMessage(text) { //     newmessage     this.fireEvent('newmessage', 'all', { date: new Date(), text }) return true; } ...</span></span></code> </pre><br>  El m√©todo fireEvent toma 3 par√°metros: el nombre del evento, a qui√©n se dirige y los datos.  Puede configurar el destinatario de varias maneras: palabra clave "todos": el evento se enviar√° a todos los usuarios o en la matriz para enumerar los tokens de sesi√≥n de los clientes a los que se dirige el evento. <br><br>  El evento no est√° vinculado a una instancia espec√≠fica de la clase de modelo de datos y los controladores se activar√°n en todas las instancias de la clase en la que se llam√≥ a fireEvent. <br><br><h4>  Escalado horizontal del backend </h4><br>  La monoliticidad de los modelos cliente-servidor en la implementaci√≥n propuesta, a primera vista, deber√≠a imponer restricciones significativas sobre la posibilidad de escalado horizontal de la parte del servidor.  Pero esto no es as√≠: t√©cnicamente, el servidor no depende del cliente.  Puede copiar el directorio "p√∫blico" en cualquier lugar y dar su contenido a trav√©s de cualquier otro servidor web (nginx, apache, etc.). <br><br>  El lado del servidor se puede ampliar f√°cilmente mediante el lanzamiento de nuevas instancias de back-end.  Redis y el sistema de colas Kue se utilizan para interactuar con instancias individuales. <br><br><h4>  API y diferentes clientes para un backend </h4><br>  En proyectos reales, diversos clientes de servidores pueden usar una API de servidor: sitios web, aplicaciones m√≥viles, servicios de terceros.  En la soluci√≥n propuesta, todo esto est√° disponible sin ning√∫n baile adicional.  Bajo el cap√≥ de llamar a los m√©todos del servidor est√° el viejo y bueno rpc.  El servidor web en s√≠ es una aplicaci√≥n express cl√°sica.  Es suficiente agregar un contenedor all√≠ para las rutas con la llamada a los m√©todos necesarios de los mismos modelos de datos. <br><br><h4>  Post scriptum </h4><br>  El enfoque propuesto en el art√≠culo no pretende cambios revolucionarios en las aplicaciones cliente-servidor.  Solo agrega un poco de comodidad al proceso de desarrollo, lo que le permite centrarse en la l√≥gica empresarial reunida en un solo lugar. <br><br>  Este proyecto es experimental, escriba en los comentarios si, en su opini√≥n, vale la pena continuar este experimento. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es435494/">https://habr.com/ru/post/es435494/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es435480/index.html">Microsoft y Kroger le dar√°n a Amazon una pelea en el campo ... el comercio de alimentos</a></li>
<li><a href="../es435482/index.html">Zircon destacado: vDSO (objeto virtual din√°mico compartido)</a></li>
<li><a href="../es435484/index.html">Fuzzing style 1989</a></li>
<li><a href="../es435488/index.html">Simulacros, trozos y esp√≠as en el marco de Spock</a></li>
<li><a href="../es435490/index.html">Cambios de impuestos de Google en 2019</a></li>
<li><a href="../es435496/index.html">Tesla demand√≥ por un accidente en el que murieron el conductor y el pasajero del Modelo S</a></li>
<li><a href="../es435498/index.html">vCloud Director Extender: migraci√≥n</a></li>
<li><a href="../es435500/index.html">Guantes biom√©tricos en automovilismo</a></li>
<li><a href="../es435502/index.html">El estudio revel√≥ los pros y los contras del perfeccionismo.</a></li>
<li><a href="../es435504/index.html">Monstruos de mano en la lucha por la limpieza: selecci√≥n de aspiradora manual Xiaomi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>