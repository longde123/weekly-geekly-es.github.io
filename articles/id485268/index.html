<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐂 ➖ 🙌🏼 Jika .NET berfungsi di mana-mana, maka pada Windows 3.11 dan DOS juga 🧑🏻 🧓🏽 🔋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya sering mengulangi bahwa .NET Core adalah open source dan berfungsi "di mana-mana." MonoGame, Unity, Apple Watch, Raspberry Pi dan mikrokontroler,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Jika .NET berfungsi di mana-mana, maka pada Windows 3.11 dan DOS juga</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485268/">  Saya sering mengulangi bahwa .NET Core adalah open source dan berfungsi "di mana-mana."  MonoGame, Unity, Apple Watch, Raspberry Pi dan mikrokontroler, selusin Linux, Windows dan sebagainya.  Sudah banyak. <br><br>  Tetapi seseorang masih belum cukup.  <a href="https://medium.com/%40MStrehovsky%3Fsource%3Dpost_page-----74c3cf60ea04----------------------" rel="nofollow">Michal Strehowski</a> ingin meluncurkan C # di <i>mana</i> - <i>mana</i> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a16/bfc/532/a16bfc53266ec828bd93f6d8ec96ef3f.png"><br>  <i><font color="gray">C # pada Windows 3.11</font></i> <br><br>  Dia menjalankan kode C # pada dua sistem "tidak mungkin" yang sekarang melengkapi definisi kita tentang "bekerja di mana-mana."  Meskipun ini adalah eksperimen yang menyenangkan (jangan ulangi dalam produksi), mereka menekankan kemampuan teknis dan fleksibilitas platform dasar Michal. <br><a name="habracut"></a><br><h1>  Menjalankan C # di bawah Windows 3.11 </h1><br>  Dalam <a href="https://twitter.com/MStrehovsky/status/1215331352352034818" rel="nofollow">tujuh tweet,</a> Michal berbicara tentang bagaimana ia berhasil menjalankan kode C # di Windows 3.11.  Aplikasi ini sederhana, hanya ada panggilan ke fungsi <a href="https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-messageboxa%3FWT.mc_id%3D-blog-scottha" rel="nofollow">MessageBoxA</a> dengan tampilan kotak dialog yang sesuai, yang ada di Windows sejak hari pertama.  Untuk memanggil fungsi dan mendapatkan <a href="https://docs.microsoft.com/en-us/dotnet/api/system.windows.messageboxresult%3Fview%3Dnetframework-4.8%26WT.mc_id%3D-blog-scottha" rel="nofollow">hasilnya</a> , DllImport / PInvoke digunakan. <br><br>  Saya pertama kali menunjukkan aplikasi ini untuk Windows 3.11 karena itu keren.  Namun dalam kenyataannya, penulis mulai dari tempat di mana eksperimennya dengan DOS berakhir.  Ini mengkompilasi kode C # asli, dan setelah itu aturan tidak ada lagi. <br><br>  Dalam contoh ini, ini berjalan pada platform Win16, bukan Win32.  Namun, pada tahun 1992 (ya, saya hidup dan diprogram saat itu, dan menggunakannya dalam proyek saya!) Ada jembatan teknologi tertentu yang disebut <a href="https://en.wikipedia.org/wiki/Win32s" rel="nofollow">Win32s</a> : subset dari API Windows NT yang porting kembali ke Windows 3.11.  Oleh karena itu, dengan mempertimbangkan beberapa batasan, Anda dapat menulis kode 32-bit dan mengakses Win32 dari Win16. <br><br>  Michal menyadari bahwa file objek yang dibuat oleh kompiler CoreRT AOT pada tahun 2020 dapat dirakit oleh linker dari sampel Visual C ++ 2.0 tahun 1994.  Hasilnya adalah kode mesin yang terhubung dengan antarmuka Win32 yang berjalan pada Windows 3.11 16-bit.  Keajaiban.  Hormati Michalu. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/342/543/565/3425435658b7a8ff087b7de75760560d.png"><br>  <i><font color="gray">Aplikasi Hello World C # yang sederhana</font></i> <br><br><h1>  Menjalankan C # pada 8K di bawah DOS </h1><br>  Saya telah menulis tentang <a href="https://www.hanselman.com/blog/MakingATinyNETCore30EntirelySelfcontainedSingleExecutable.aspx" rel="nofollow">executable mandiri .NET Core 3.x</a> sebelumnya, saya penggemar ini.  Aplikasi saya sudah berkurang hingga 28 megabyte.  Ini cukup sedikit, mengingat bahwa itu termasuk runtime .NET dan banyak sumber daya lainnya.  Tentu saja, seseorang tidak boleh menilai VM / runtime berdasarkan ukuran dari program sekecil mungkin, tetapi Michal <a href="https://medium.com/%40MStrehovsky/building-a-self-contained-game-in-c-under-8-kilobytes-74c3cf60ea04" rel="nofollow">ingin melihat</a> sampai batas mana Anda bisa pergi - dan menetapkan target 8000 byte! <br><br>  Program ini bekerja dalam <a href="https://www.hanselman.com/blog/OpportunityWindowsIsCompletelyMissingTheTextModeBoat.aspx" rel="nofollow">mode teks, yang menurut saya bagus</a> .  Ini juga menghilangkan kebutuhan akan pemulung, karena tidak ada alokasi sumber daya.  Ini berarti Anda tidak dapat menggunakan yang <i>baru di</i> mana pun.  Tidak ada tipe referensi. <br><br>  Untuk mendeklarasikan array statis, ia menggunakan bidang <code>fixed char []</code> : mereka harus hidup di stack, dan kami memiliki stack <i>kecil</i> . <br><br>  Tentu saja, ketika Anda mencoba membuat semacam .NET yang dapat dieksekusi, Anda awalnya mendapatkan file 65 megabyte, yang termasuk aplikasi, runtime, dan perpustakaan standar. <br><br> <code>dotnet publish -r win-x64 -c Release</code> <br> <br>  Anda dapat menggunakan <a href="https://www.hanselman.com/blog/BrainstormingCreatingASmallSingleSelfcontainedExecutableOutOfANETCoreApplication.aspx" rel="nofollow">ILLinker</a> dan PublishedTrimmed untuk mengoptimalkan Pemangkasan Pohon dari .NET Core 3.x, tetapi dengan cara ini Anda mengurangi file menjadi hanya 25 megabyte. <br><br>  Dia mencoba menggunakan Mono dan mkbundle, membawa ukuran menjadi 18,2 megabita, tetapi kemudian menangkap kesalahan.  Dan runtime masih ada. <br><br>  Dengan demikian, satu-satunya runtime yang cocok adalah CoreRT, yang tidak termasuk mesin virtual, tetapi hanya fungsi tambahan. <br><br> <code>dotnet publish -r win-x64 -c Release /p:Mode=CoreRT</code> <br> <br>  Jadi dia mendapat 4,7 megabita, tetapi masih terlalu banyak.  Dengan beberapa pengaturan, Anda dapat berjalan hingga 3 megabyte.  Anda dapat sepenuhnya memperpanjang pantulan dan mencapai 1,2 megabita.  Sekarang akan muat di floppy disk! <br><br> <code>dotnet publish -r win-x64 -c Release /p:Mode=CoreRT-ReflectionFree</code> <br> <br>  Ukuran satu megabyte ini tampaknya seperti batas keras untuk .NET SDK saja. <br><br>  Di sinilah Michal <a href="https://medium.com/%40MStrehovsky/building-a-self-contained-game-in-c-under-8-kilobytes-74c3cf60ea04" rel="nofollow">menjauh dari alat standar</a> .  Itu melakukan <a href="" rel="nofollow">rintisan implementasi ulang untuk tipe dasar Sistem</a> !  Kemudian ia mengkompilasi ulang dengan beberapa switch ajaib sehingga hanya versi IL dari executable yang dirilis. <br><br> <code>csc.exe /debug /O /noconfig /nostdlib /runtimemetadataversion:v4.0.30319 MiniBCL.cs Game\FrameBuffer.cs Game\Random.cs Game\Game.cs Game\Snake.cs Pal\Thread.Windows.cs Pal\Environment.Windows.cs Pal\Console.Windows.cs /out:zerosnake.ilexe /langversion:latest /unsafe</code> <br> <br>  Kemudian ia meneruskan ini ke CoreRT untuk mendapatkan kode asli. <br><br> <code>ilc.exe zerosnake.ilexe -o zerosnake.obj --systemmodule zerosnake --Os -g</code> <br> <br>  Dan inilah kita. <br><br><blockquote>  “Sekarang kita memiliki zerosnake.obj - file objek standar, tidak berbeda dengan file objek yang dibuat oleh kompiler asli lain, seperti C atau C ++.  Langkah terakhir adalah menyatukannya. ” </blockquote><br>  Beberapa trik lagi - dan hasilnya 27 KB!  Kemudian ia menghapus beberapa switch dari linker untuk menonaktifkan dan menghapus berbagai hal menggunakan metode yang sama yang digunakan pengembang assembler, menghasilkan 8176 byte.  Thriller Epik. <br><br> <code>link.exe /debug:full /subsystem:console zerosnake.obj /entry:__managed__Main kernel32.lib ucrt.lib /merge:.modules=.rdata /merge:.pdata=.rdata /incremental:no /DYNAMICBASE:NO /filealign:16 /align:16</code> <br> <br>  Ikuti <a href="https://twitter.com/MStrehovsky" rel="nofollow">Michal</a> di <a href="https://twitter.com/MStrehovsky" rel="nofollow">Twitter</a> dan bertepuk tangan untuknya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id485268/">https://habr.com/ru/post/id485268/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id485240/index.html">Layout go pet project di VPS</a></li>
<li><a href="../id485256/index.html">Ivan Lilekvist dan Kim Dotkom, sebuah wawancara besar: kisah Megaupload, ekstradisi ke Amerika Serikat, kebebasan, bitcoin. Bagian 1</a></li>
<li><a href="../id485260/index.html">13 Kesalahan Umum untuk Analis Bisnis Awal</a></li>
<li><a href="../id485264/index.html">Seperti apa bentuk arsip zip dan apa yang bisa kita lakukan dengannya. Bagian 4 - Membaca arsip</a></li>
<li><a href="../id485266/index.html">Habr Contest: pemenang dari kontes ide</a></li>
<li><a href="../id485270/index.html">Retas admin</a></li>
<li><a href="../id485272/index.html">Komputer Taimyr - evolusi adalah sebaliknya</a></li>
<li><a href="../id485274/index.html">Moscow JS Meetup di Raiffeisenbank: tetap siaran</a></li>
<li><a href="../id485278/index.html">Tangan Tuhan. Bantuan Kupon</a></li>
<li><a href="../id485280/index.html">Pergi Fakedb Emulasi basis data dalam pengujian</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>