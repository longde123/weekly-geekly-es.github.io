<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçü§ù‚Äçüë®üèΩ üëï ‚öΩÔ∏è Migrar a Zimbra con imapsync üèä üëù üç©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Adem√°s de las caracter√≠sticas tan esperadas, como la Libreta de direcciones jer√°rquica y el soporte oficial para Ubuntu 18.10 LTS, el lanzamiento de Z...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Migrar a Zimbra con imapsync</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/zimbra/blog/458912/">  Adem√°s de las caracter√≠sticas tan esperadas, como la Libreta de direcciones jer√°rquica y el soporte oficial para Ubuntu 18.10 LTS, el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lanzamiento de Zimbra 8.8.12</a> nos trajo noticias sobre la pr√≥xima eliminaci√≥n del soporte de una serie de utilidades necesarias para la migraci√≥n de otros sistemas de correo a Zimbra Collaboration Suite.  En particular, la compatibilidad con el Asistente de migraci√≥n de ZCS para Domino se suspendi√≥ por completo, y el Asistente de migraci√≥n de ZCS para Exchange ahora solo admitir√° la importaci√≥n de archivos PST desde Outlook.  Para implementar una migraci√≥n completa, los desarrolladores de Zimbra Collaboration Suite ofrecen el uso de servicios en l√≠nea pagados, pero no todas las empresas est√°n listas para proporcionar sus datos de buzones a terceros por razones de seguridad, y no todas las empresas pueden pagar los costos adicionales asociados con la migraci√≥n a Zimbra.  Especialmente para dichos usuarios, existe el programa imapsync, que puede proporcionar una migraci√≥n incremental confiable desde cualquier sistema de correo a Zimbra. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e98/93d/7d9/e9893d7d9f995c2a24dce02df7fa5d51.png" alt="imagen"><a name="habracut"></a><br><br>  Imapsync es una utilidad gratuita y gratuita disponible en los repositorios de cualquier distribuci√≥n de Zimbra Linux compatible oficialmente.  El prop√≥sito de este programa es transferir el correo electr√≥nico entre diferentes servidores de correo y lo maneja perfectamente.  Gracias a la flexibilidad de la configuraci√≥n, el correo se puede transferir de forma incremental y en un modo totalmente autom√°tico.  Veamos c√≥mo puede usar imapsync para migrar de Lotus Domino y MS Exchange a Zimbra Collaboration Suite. <br><br><h3>  Migraci√≥n de MS Exchange a Zimbra </h3><br>  Para que la migraci√≥n del correo electr√≥nico tenga √©xito, debe completar una serie de preparativos.  En primer lugar, necesitamos crear los mismos usuarios en el servidor Zimbra que en el servidor MS Exchange con las mismas contrase√±as.  Al realizar esta tarea, el autoajuste de los usuarios de Zimbra con AD puede ser muy √∫til.  El proceso de dicho autoajuste se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">describe</a> en uno de nuestros art√≠culos anteriores. <br><br>  Despu√©s de migrar todas las cuentas de AD o Exchange, debe instalar el paquete imapsync en el servidor con Zimbra.  Si usa Ubuntu como sistema operativo para Zimbra, puede instalar el programa usando el comando <b>sudo apt-get install imapsync -y</b> , en CentOS y RHEL, la instalaci√≥n se realizar√° usando el comando <b>sudo yum install imapsync -y</b> . <br><br>  Cuando se complete la instalaci√≥n del paquete y todas las dependencias, pasemos a configurar el servidor de Exchange.  En √©l, necesitaremos habilitar el servicio IMAP4.  Esto se realiza ejecutando el archivo <b>services.msc</b> , despu√©s de lo cual debe ir a Herramientas&gt; Servicios -&gt; IMAP4 Microsoft Exchange -&gt; Iniciar.  Despu√©s de eso, deber√° dar acceso al administrador a los buzones de los usuarios para evitar el uso de contrase√±as de los usuarios durante la migraci√≥n, y tambi√©n deshabilitar o configurar pol√≠ticas de l√≠mite de velocidad para que no interfieran con la migraci√≥n.  Ahora puede comenzar a transferir correo de un servidor a otro. <br><br>  En nuestra infraestructura, MS Exchange se ubicar√° en el host <b>exchange.company.ru</b> , y Zimbra se ubicar√° en el host <b>zimbra.company.ru</b> .  Los usuarios ser√°n transferidos uno por uno utilizando la l√≠nea de comando, en la cual ejecutaremos la utilidad imapsync con una serie de par√°metros necesarios para la migraci√≥n.  En primer lugar, debe tenerse en cuenta que en Zimbra, como en MS Exchange, las cuentas de administrador tienen acceso al contenido de todos los buzones de correo de los usuarios, lo que significa que para migrar a un nuevo servidor de correo, el administrador del sistema no necesita conocer las contrase√±as de las cuentas de usuario normales.  Es por eso que la migraci√≥n de cada usuario de MS Exchange a Zimbra se llevar√° a cabo utilizando un comando de la siguiente forma: <br><br><pre><code class="plaintext hljs">imapsync --host1 exchange.company.ru --user1 "xxxxx" --authuser1 "yyyyy" --password1 "zzzzz" --nosslcheck --host2 zimbra.company.ru --user2 "XXXXX" --authuser1 "YYYYY" --password2 "ZZZZZ"</code> </pre> <br>  En este comando, especificamos el host de origen ( <b>--host1</b> ) del que imapsync recoger√° los datos de la cuenta, as√≠ como el host ( <b>--host2</b> ) en el que se escribir√°n estos datos.  Tambi√©n especificamos el nombre de usuario ( <b>--user1</b> ) en el primer host y el nombre de usuario correspondiente ( <b>--user2</b> ) en el segundo host.  Para acceder a sus datos, especificamos el nombre de la cuenta de administrador ( <b>--authuser1</b> ) y la contrase√±a de administrador ( <b>--password1</b> ) del primer host, y para registrar los datos transmitidos, el nombre de la cuenta de administrador ( <b>--authuser2</b> ) y la contrase√±a administrador ( <b>--password2</b> ) del segundo host. <br><br>  En un mundo ideal, tal comando ser√≠a suficiente para transferir datos de usuario entre servidores con MS Exchange y Zimbra, pero, como suele suceder, las diferencias entre las soluciones hacen sus propias correcciones y, por lo tanto, una simple transferencia de datos desde MS Exchange conducir√° a un terrible caos en los buzones de Zimbra .  El escollo en este caso son los diferentes nombres de las carpetas en los buzones.  Para evitar confusiones durante la transferencia de datos, es necesario que nuestro equipo tenga aproximadamente la siguiente forma: <br><br><pre> <code class="plaintext hljs">imapsync --subscribe_all --maxmessagespersecond 4 --addheader --f1f2 "Inbox=INBOX" \ --f1f2 "Sent Items=Sent" --f1f2 "Sent items=Sent" --exclude "^Journal|^Tasks|^Trash|Contacts|Calendar|RSS Feeds" \ --useheader "Message-ID" --buffersize 8192000 --nosyncacls --allowsizemismatch --usecache --syncinternaldates --skipsize --nofoldersizes \ --tls1 --port1 143 --user1 "xxxxxxxxxx" --authuser1 "besadmin" --password1 "XXXXXXX" \ --host2 'xxxxxxx' --user2 "xxxxxx" --authuser2 "XXXXXX" --password2 "XXXX" --tls2 --port2 7143 \ --regextrans2 "s/Inbox1/INBOX/i" --regextrans2 "s/Sent Items/Sent/i" --regextrans2 "s/sent-mail/Sent/i" --regextrans2 "s/Deleted Items/Trash/i" --regextrans2 "s/Deleted Messages/Trash/" \ --delete2duplicates --timeout 600 --pidfile "impasync.local.pid" --logfile "imapsync.log" --sep1 "/" --errorsmax "100"</code> </pre> <br>  Tenga en cuenta que este no es un script universal que funcionar√° sin problemas en cualquier infraestructura.  Muchas cosas pueden depender de varias caracter√≠sticas de su infraestructura.  Es por eso que, antes de comenzar una migraci√≥n a gran escala, aseg√∫rese de probar la transferencia de datos entre sistemas en varias cuentas comerciales no cr√≠ticas. <br><br>  Deje que la abundancia de par√°metros con los que se lanza imapsync no lo asuste.  la mayor√≠a de ellos son necesarios precisamente para que al transferir carpetas desde el buz√≥n no haya confusi√≥n y todos los elementos de MS Exchange se transfieran a Zimbra.  Por ejemplo, el par√°metro <b>--subscribe_all le</b> permite a imapsync obtener todas las carpetas de su cuenta para que pueda trabajar con ellas m√°s adelante.  La <b>opci√≥n --f1f2 le</b> permite cambiar el nombre de la carpeta durante la sincronizaci√≥n.  Es decir, al sincronizar, por ejemplo.  la carpeta Elementos enviados cambia su nombre a Enviado, lo que le permite ajustar perfectamente su contenido a la estructura de carpetas de Zimbra Collaboration Suite.  El par√°metro <b>--regextrans2</b> tambi√©n le permite cambiar los nombres de las carpetas y se basa en el mecanismo de <b>expresiones</b> regulares del lenguaje de programaci√≥n Perl, por lo que aquellos que est√©n familiarizados con este idioma aprender√°n f√°cilmente este par√°metro. <br><br>  Para explicar lo que <b>hacen las opciones</b> <b>--addheader</b> y <b>--useheader</b> , ser√° necesario profundizar en c√≥mo se lleva a cabo exactamente la sincronizaci√≥n de las letras en imapsync.  El hecho es que para sincronizar imapsync, es necesario identificar letras en ambos servidores para decidir si las sincroniza o no.  Para verificarlos, esta utilidad utiliza par√°metros como "Id. De mensaje:" y "Recibido:" (n√∫mero de identificaci√≥n y hora de recepci√≥n), que est√°n ausentes en dichos correos electr√≥nicos, como borradores.  Para sincronizarlos normalmente, necesitamos el comando --addheader.  Le permite agregarles un n√∫mero de identificaci√≥n para identificar y comparar de alguna manera dichas letras durante la sincronizaci√≥n.  El par√°metro --useheader le permite comparar letras usando solo uno de los dos par√°metros durante la sincronizaci√≥n. <br><br>  Despu√©s de escribir el script perfecto que nos permitir√° transferir la transferencia perfecta de cuentas de MS Exchange a Zimbra, sigue existiendo un problema importante relacionado con el hecho de que todav√≠a tenemos que transferir usuarios entre servidores de uno en uno.  Esto no es muy √≥ptimo, especialmente en aquellas compa√±√≠as donde hay muchos empleados y la cantidad de buzones se mide en miles.  Sin embargo, este proceso puede optimizarse significativamente mediante la creaci√≥n de una lista de cuentas y luego escribir un peque√±o script que transfiere autom√°ticamente el correo en funci√≥n de los nombres de las cuentas.  Para hacer esto, crearemos el archivo <b>imap_users</b> y le agregaremos todos los datos necesarios de la siguiente forma: <br><br><pre> <code class="plaintext hljs">domains=( domain1\ domain2) users=( user1@domain1\ user2@domain1\ user3@domain1\ user1@domain2\ user2@domain2\ user3@domain2)</code> </pre> <br>  Despu√©s de eso, escribiremos el gui√≥n mismo.  Tenemos algo como esto: <br><br><pre> <code class="plaintext hljs">. imap_users src_srv = exchange.company.ru dest_srv = zimbra.company.ru for ((i = 0; i &lt; ${#users[@]}; i++ )) do /usr/bin/imapsync --subscribe_all --maxmessagespersecond 4 --addheader --f1f2 "Inbox=INBOX" \ --f1f2 "Sent Items=Sent" --f1f2 "Sent items=Sent" --exclude "^Journal|^Tasks|^Trash|Contacts|Calendar|RSS Feeds" \ --useheader "Message-ID" --buffersize 8192000 --nosyncacls --allowsizemismatch --usecache --syncinternaldates --skipsize --nofoldersizes \ --tls1 --port1 143 --host1 $src_srv --user1 ${users[$i]} --authuser1 "besadmin" --password1 "XXXXXXX" --nosslcheck \ --host2 $dest_srv --user2 ${users[$i]} --authuser2 "XXXXXX" --password2 "XXXX" --tls2 --port2 7143 \ --regextrans2 "s/Inbox1/INBOX/i" --regextrans2 "s/Sent Items/Sent/i" --regextrans2 "s/sent-mail/Sent/i" --regextrans2 "s/Deleted Items/Trash/i" --regextrans2 "s/Deleted Messages/Trash/" \ --delete2duplicates --timeout 600 --pidfile "impasync.local.pid" --logfile "imapsync.log" --sep1 "/" --errorsmax "100" done</code> </pre> <br>  Dado que la transferencia de datos es incremental, primero puede transferir la mayor parte de los datos entre los servidores y luego, dentro de un breve receso t√©cnico, transferir la peque√±a cantidad de datos que se ha acumulado desde la √∫ltima sincronizaci√≥n, transferir todo el correo entrante a Zimbra y convertirlo en el sistema de correo principal.  Le recordamos que antes de migrar a un nuevo sistema postal, debe notificar a los empleados sobre la pr√≥xima transici√≥n, realizar capacitaci√≥n con ellos y tambi√©n preparar notas sobre d√≥nde se encuentran en Zimbra sus funciones habituales.  Gracias a esto, la migraci√≥n ser√° m√°s fluida y no crear√° problemas para el negocio. <br><br><h3>  Migraci√≥n de Lotus / Domino a Zimbra </h3><br>  En muchos sentidos, el proceso de migraci√≥n desde el sistema de correo de IBM utilizando imapsync repite el proceso de migraci√≥n desde MS Exchange y cualquier otro sistema de correo.  Sin embargo, en el proceso de migraci√≥n directa, muchos administradores encuentran un error con la desconexi√≥n a trav√©s de IMAP y, en consecuencia, la finalizaci√≥n de la sincronizaci√≥n.  Al mismo tiempo, no aparece ning√∫n mensaje de error en los registros.  Si durante la migraci√≥n desde Lotus / Domino se encontr√≥ con este problema, las siguientes acciones ayudar√°n a resolver este problema: <br><br><ul><li>  Inicie Lotus Notes con privilegios de administrador y vaya a la Libreta de direcciones. </li><li>  En la configuraci√≥n de la libreta de direcciones, cambie el formato de mensaje predeterminado a "MIME preferido" </li><li>  En el mismo Lotus Notes que se ejecuta con privilegios de administrador, cambie el formato de la base de datos del usuario a Correo (R6), que se toma del servidor y no del cliente de correo </li><li>  Apague el Lotus Domino Router desde la consola de administraci√≥n de Domino utilizando el comando tell router quit </li><li>  Empaquete la base de datos de usuarios desde la consola de administraci√≥n de Domino utilizando el comando "load compact userdb.nsf" </li><li>  Compruebe la base de datos en busca de errores ejecutando el comando fixup userdb.nsf desde la consola Domino (no desde la consola del administrador) </li><li>  Desde la consola de administraci√≥n de Domino, ejecute el comando "convert -e userdb.nsf" para preparar la base de datos para la transferencia de imap </li><li>  Desde la consola de administraci√≥n de Domino, ejecute el comando "convert -h userdb.nsf" para agregar encabezados imap a todos los mensajes. </li></ul><br>  Despu√©s de completar todos estos pasos, la transferencia de correo de Lotus / Domino a Zimbra usando imapsync deber√≠a pasar sin ning√∫n problema. <br><br>  Adem√°s de las utilidades para la migraci√≥n, los clientes de Zimbra para computadoras de escritorio y dispositivos m√≥viles se quedaron sin soporte.  Adem√°s, el cliente web HTML se elimin√≥ del soporte, que se utiliz√≥ para garantizar la compatibilidad con navegadores antiguos y dispositivos de baja potencia.  Todos ellos pueden ser reemplazados f√°cilmente por clientes de terceros, debido al hecho de que Zimbra admite casi todos los est√°ndares y protocolos abiertos. <br><br>  Recuerde que la migraci√≥n entre los servidores de Zimbra se puede hacer usando la herramienta gratuita de migraci√≥n de Zextras, que puede descargar en el sitio web oficial de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Zextras</a> . <br><br>  Para todas las preguntas relacionadas con la Suite Zextras, puede contactar al representante de Zextras Katerina Triandafilidi por correo electr√≥nico katerina@zextras.com </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/458912/">https://habr.com/ru/post/458912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458902/index.html">5 errores comunes de Python para principiantes</a></li>
<li><a href="../458904/index.html">Visualizaci√≥n del n√∫mero de victorias para los equipos de la NBA utilizando gr√°ficos de barras animados en R</a></li>
<li><a href="../458906/index.html">[Ekaterimburgo, anuncio] Flutteron - un taller sobre desarrollo en Flutter</a></li>
<li><a href="../458908/index.html">Escaneo de documentos a trav√©s de la red</a></li>
<li><a href="../458910/index.html">Benchmarking PostgreSQL con grandes p√°ginas de Linux</a></li>
<li><a href="../458914/index.html">Qu√© (no) necesitas saber para crear juegos en Unity</a></li>
<li><a href="../458916/index.html">Debajo del cap√≥ de React. Escribimos nuestra implementaci√≥n desde cero</a></li>
<li><a href="../458918/index.html">Lo que puedes aprender del dise√±o de juegos hiper-casuales</a></li>
<li><a href="../458920/index.html">Conferencia para fan√°ticos de DevOps</a></li>
<li><a href="../458922/index.html">C√≥mo pasar de ESXi a KVM / LXD y no perder la cabeza</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>