<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§òüèΩ üåµ üòô Como criar um jogo se voc√™ nunca √© um artista üë®‚Äçüëß üíÖ üë©üèø‚Äçüç≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Houve momentos na vida de todo programador quando ele sonhava em fazer um jogo interessante. Muitos programadores realizam esses sonhos e at√© com suce...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como criar um jogo se voc√™ nunca √© um artista</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445278/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/96/hp/x0/96hpx0qpk4w0_hmjm3csu0lj92o.png"></div><br>  Houve momentos na vida de todo programador quando ele sonhava em fazer um jogo interessante.  Muitos programadores realizam esses sonhos e at√© com sucesso, mas isso n√£o √© sobre eles.  √â sobre quem gosta de jogar, que (mesmo sem conhecimento e experi√™ncia) tentou cri√°-los uma vez, inspirado em exemplos de her√≥is √∫nicos que alcan√ßaram fama mundial (e enormes lucros), mas no fundo entendiam que competir com o guru igrostroya que ele n√£o pode pagar. <br><br>  E n√£o ... <br><a name="habracut"></a><br><h2>  Pequena introdu√ß√£o </h2><br>  Farei uma reserva imediatamente: nosso objetivo n√£o √© ganhar dinheiro - h√° muitos artigos sobre esse t√≥pico em Habr√©.  N√£o, vamos fazer um jogo dos sonhos. <br><br><div class="spoiler">  <b class="spoiler_title">Digress√£o l√≠rica sobre o jogo dos sonhos</b> <div class="spoiler_text">  Quantas vezes ouvi essa palavra de desenvolvedores individuais e pequenos est√∫dios.  Onde quer que voc√™ olhe, todos os novatos igrodelov se apressam em revelar seus sonhos e "vis√£o perfeita" para o mundo e, em seguida, escrevem longos artigos sobre seus esfor√ßos her√≥icos, processo de trabalho, dificuldades financeiras inevit√°veis, problemas com editores e geralmente "jogadores-ingratos-cachorros-im-" d√™ gr√°fico e moedas e tudo de gra√ßa e pague-n√£o-quer-um-jogo-piratas-e-perdemos-lucros-por causa deles-aqui. " <br><br>  Pessoas, n√£o se deixe enganar.  Voc√™ n√£o est√° criando um jogo dos sonhos, mas um jogo que vender√° bem - essas s√£o duas coisas diferentes.  Os jogadores (e especialmente os sofisticados) n√£o se importam com o seu sonho e n√£o pagar√£o por ele.  Se voc√™ deseja lucros - estude tend√™ncias, veja o que √© popular agora, fa√ßa algo √∫nico, fa√ßa melhor, mais incomum que outros, leia artigos (s√£o muitos), comunique-se com editores - em geral, realize os sonhos dos usu√°rios finais, n√£o os seus. <br><br>  Se voc√™ ainda n√£o fugiu e ainda deseja realizar o jogo dos seus sonhos, desista dos lucros com anteced√™ncia.  N√£o venda o seu sonho, compartilhe-o gratuitamente.  D√™ √†s pessoas o seu sonho, traga-as para ele, e se o seu sonho vale alguma coisa, voc√™ receber√°, se n√£o dinheiro, mas amor e reconhecimento.  Isso √†s vezes √© muito mais valioso. <br></div></div><br>  Muitas pessoas pensam que os jogos s√£o uma perda de tempo e energia, e que pessoas s√©rias n√£o devem falar sobre esse assunto.  Mas as pessoas reunidas aqui n√£o s√£o s√©rias, ent√£o concordamos apenas em parte - os jogos levam muito tempo se voc√™ os jogar.  No entanto, o desenvolvimento de jogos, embora demore muitas vezes mais, pode trazer muitos benef√≠cios.  Por exemplo, ele permite que voc√™ se familiarize com os princ√≠pios, abordagens e algoritmos que n√£o s√£o encontrados no desenvolvimento de aplicativos que n√£o sejam de jogos.  Ou aprofundar as habilidades de possuir ferramentas (por exemplo, uma linguagem de programa√ß√£o), fazendo algo incomum e emocionante.  Por conta pr√≥pria, posso acrescentar (e muitos concordar√£o) que o desenvolvimento de jogos (mesmo sem sucesso) √© sempre uma experi√™ncia especial e incompar√°vel, que voc√™ se lembra com apreens√£o e amor, que quero experimentar para cada desenvolvedor pelo menos uma vez na vida. <br><br>  N√£o usaremos mecanismos de jogo, estruturas, bibliotecas de novos f√£s - examinaremos a ess√™ncia da jogabilidade e a sentiremos por dentro.  Desistimos de metodologias flex√≠veis de desenvolvimento (a tarefa √© simplificada pela necessidade de organizar o trabalho de apenas uma pessoa).  N√£o gastaremos tempo e energia procurando designers, artistas, compositores e especialistas em som - faremos tudo o que pudermos (mas, ao mesmo tempo, faremos tudo com sabedoria) - se, de repente, tivermos um artista, n√£o faremos muito esfor√ßo para fixar a moda. gr√°ficos no quadro acabado).  No final, nem sequer estudamos as ferramentas e escolhemos a correta - faremos a que conhecemos e sabemos como usar.  Por exemplo, em Java, para que mais tarde, se necess√°rio, transfira-o para Android (ou para uma cafeteira). <br><br>  <i>Ah !!!</i>  <i>Horror!</i>  <i>Um pesadelo!</i>  <i>Como voc√™ pode gastar tempo com essas bobagens!</i>  <i>Saia daqui, vou ler algo mais interessante!</i> <br><br>  Por que fazer isso?  Quero dizer, reinventar a roda?  Por que n√£o usar um mecanismo de jogo pronto?  A resposta √© simples: n√£o sabemos nada sobre ele, mas queremos o jogo agora.  Imagine a mentalidade do programador m√©dio: "Eu quero fazer um jogo!  Haver√° carne, explos√µes e bombeamento, <s>e voc√™ pode roubar um korovan</s> , e a trama est√° bombardeando, e isso nunca aconteceu em nenhum outro lugar!  Vou come√ßar a escrever agora! .. E sobre o que?  Vamos ver o que √© popular entre n√≥s agora ... Sim, X, Y e Z. Vamos pegar o Z, agora todo mundo escreve nele ... ".  E come√ßa a estudar o motor.  E ele lan√ßa a ideia, porque j√° n√£o h√° tempo suficiente para isso.  Fin.  Ou, ok, n√£o desiste, mas sem realmente aprender o mecanismo, ele √© usado para o jogo.  Bem, se ele tem consci√™ncia de n√£o mostrar a ningu√©m o seu primeiro "of√≠cio".  Geralmente n√£o (v√° a qualquer loja de aplicativos, veja por si mesmo) - bem, bem, quero lucros, sem for√ßas para suportar.  Uma vez que a cria√ß√£o de jogos era um monte de pessoas criativas entusiasmadas.  Infelizmente, esse tempo passou irrevogavelmente - agora a principal coisa do jogo n√£o √© a alma, mas o modelo de neg√≥cios (pelo menos h√° muito mais conversas sobre isso).  Nosso objetivo √© simples: vamos fazer jogos com a alma.  Portanto, abstra√≠mos da ferramenta (qualquer um far√°) e focamos na tarefa. <br><br>  Ent√£o, vamos continuar. <br>  N√£o vou entrar em detalhes da minha pr√≥pria experi√™ncia amarga, mas direi que um dos principais problemas para um programador no desenvolvimento de jogos √© o gr√°fico.  Os programadores geralmente n√£o sabem desenhar (embora haja exce√ß√µes) e os artistas geralmente n√£o sabem como programar (embora haja exce√ß√µes).  E sem gr√°ficos, voc√™ deve admitir, um jogo raro √© ignorado.  O que fazer? <br><br>  Existem op√ß√µes: <br><br><div class="spoiler">  <b class="spoiler_title">1. Desenhe tudo voc√™ mesmo em um editor gr√°fico simples</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/5b/no/-o/5bno-orbfc3-ov3esi3ld_ezdqs.png"></a> <br>  <i>Screenshots do jogo "Kill Him All", 2003</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">2. Desenhe tudo sozinho em um vetor</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/46/dj/u8/46dju8rama3wvfx2fzopin-yfiw.png"></a> <br>  <i>Screenshots do jogo "Raven", 2001</i> <br><br> <a href=""><img src="https://habrastorage.org/webt/jn/mm/vz/jnmmvzujgfsziasffz8m6sitmi0.png"></a> <br>  <i>Screenshots do jogo "Inferno", 2002</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">3. Pergunte a um irm√£o que tamb√©m n√£o sabe desenhar (mas o faz um pouco melhor)</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/tf/tx/jc/tftxjcy5luf045ehrm5_kdb5fzy.png"></a> <br>  <i>Screenshots do jogo "Fucking", 2004</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">4. Fa√ßa o download de algum programa para modelagem 3D e arraste ativos de l√°</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/k9/nj/o6/k9njo6wryhhmaiagpool44qt5ua.jpeg"></a> <br>  <i>Screenshots do jogo "Fucking 2. Demo", 2006</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">5. Em desespero, arrancando cabelos na cabe√ßa</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/3p/fw/01/3pfw013bspmxrjyyewsnsgqobma.png"></a> <br> <a href=""><img src="https://habrastorage.org/webt/oa/gx/go/oagxgo1wmfykrll-ji-qwyrsv7e.png"></a> <br>  <i>Screenshots do jogo "Fucking", 2004</i> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">6. Desenhe tudo sozinho em pseudografia (ASCII)</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/db/ht/s5/dbhts5ryeccznntuaiiwjmx32fo.png"></a> <br>  <i>Screenshots do jogo "Fifa", 2000</i> <br><br> <a href=""><img src="https://habrastorage.org/webt/q0/u-/vu/q0u-vuxozevapmdwswaygicakgg.png"></a> <br>  <i>Screenshots do jogo "Sumo", 1998</i> <br></div></div><br>  Vamos nos debru√ßar sobre este √∫ltimo (em parte porque ele n√£o parece t√£o deprimente quanto o resto).  Muitos jogadores inexperientes acreditam que jogos sem gr√°ficos modernos legais n√£o s√£o capazes de conquistar o cora√ß√£o dos jogadores - at√© o nome do jogo nem os transforma em jogos.  Desenvolvedores de obras-primas como <i>ADOM</i> , <i>NetHack</i> e <i>Dwarf Fortress se</i> op√µem tacitamente a esses argumentos.  A apar√™ncia nem sempre √© um fator decisivo, o uso do <abbr title="C√≥digo Padr√£o Americano para Interc√¢mbio de Informa√ß√µes">ASCII</abbr> oferece algumas vantagens interessantes: <br><br><ul><li>  no processo de desenvolvimento, o programador se concentra na jogabilidade, na mec√¢nica do jogo, no componente da trama e muito mais, sem se distrair com coisas menores; </li><li>  o desenvolvimento de um componente gr√°fico n√£o leva muito tempo - um prot√≥tipo funcional (isto √©, uma vers√£o em execu√ß√£o que voc√™ pode entender, mas vale a pena continuar) estar√° pronto muito antes; </li><li>  n√£o h√° necessidade de aprender estruturas e mecanismos gr√°ficos; </li><li>  seus gr√°ficos n√£o ficar√£o obsoletos nos cinco anos em que voc√™ desenvolver√° o jogo; </li><li>  os trabalhadores hardcore poder√£o avaliar seu produto mesmo em plataformas que n√£o possuem um ambiente gr√°fico; </li><li>  se tudo for feito corretamente, os gr√°ficos legais poder√£o ser fixados mais tarde, mais tarde. </li></ul><br>  A longa introdu√ß√£o acima teve como objetivo ajudar o novato igrodelov a superar medos e preconceitos, parar de se preocupar e ainda tentar fazer algo assim.  Voc√™ est√° pronta?  Ent√£o vamos come√ßar. <br><br><h2>  <font color="#0474a0">Primeiro passo</font>  <font color="#0474a0">Id√©ia</font> </h2><br>  Como  Ainda n√£o faz ideia? <br><br>  Desligue o computador, v√° comer, caminhar, exercitar-se.  Ou dormir, na pior das hip√≥teses.  Inventar um jogo n√£o √© lavar janelas - a percep√ß√£o do processo n√£o vem.  Normalmente, a ideia de um jogo nasce repentinamente, inesperadamente, quando voc√™ n√£o pensa sobre isso.  Se isso acontecer repentinamente, pegue um l√°pis mais r√°pido e anote at√© que a id√©ia se esvai.  Qualquer processo criativo √© implementado dessa maneira. <br><br>  E voc√™ pode copiar os jogos de outras pessoas.  Bem, copie.  Obviamente, n√£o rasgue descaradamente, dizendo em todos os cantos como voc√™ √© inteligente, mas use a experi√™ncia de outras pessoas em seu produto.  Quanto depois disso permanecer√° especificamente do seu sonho, √© uma quest√£o secund√°ria, porque muitas vezes os jogadores t√™m isso: eles gostam de tudo no jogo, exceto por duas ou tr√™s coisas irritantes, mas se isso fosse diferente ... Quem sabe talvez trazer √† mente a boa ideia de algu√©m seja o seu sonho. <br><br>  Mas seguiremos o caminho simples - suponha que j√° tenhamos uma id√©ia e n√£o pensemos nisso por um longo tempo.  Como nosso primeiro projeto grandioso, criaremos um clone de um bom jogo da Obsidian - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pathfinder Adventures</a> . <br><br>  <i>‚ÄúQue diabos √© isso!</i>  <i>Alguma mesa?</i> <br><br>  Como se costuma dizer, <i>pourquoi pas?</i>  Parece que j√° abandonamos preconceitos e, com ousadia, come√ßamos a refinar a id√©ia.  Naturalmente, n√£o vamos clonar o jogo individualmente, mas emprestaremos a mec√¢nica b√°sica.  Al√©m disso, a implementa√ß√£o de um jogo cooperativo de tabuleiro baseado em turnos tem suas vantagens: <br><br><ul><li>  √© passo a passo - isso permite que voc√™ n√£o se preocupe com temporizadores, sincroniza√ß√£o, otimiza√ß√£o, FPS e outras coisas tristes; </li><li>  √© cooperativo, ou seja, o jogador ou jogadores n√£o competem entre si, mas contra um certo "ambiente" jogando de acordo com regras determin√≠sticas - isso elimina a necessidade de programar a <abbr title="Intelig√™ncia artificial">IA</abbr> ( <abbr title="Intelig√™ncia Artificial">AI</abbr> ) - uma das etapas mais dif√≠ceis do desenvolvimento do jogo; </li><li>  √© significativo - as mesas s√£o geralmente pessoas extravagantes, n√£o jogam nada: d√™ mec√¢nicas pensadas e jogabilidade interessante - voc√™ n√£o sai em uma imagem bonita (d√° algo aos amigos, certo?); </li><li>  √© com a trama - muitos esportistas eletr√¥nicos n√£o concordam, mas para mim, pessoalmente, o jogo deve contar uma hist√≥ria interessante - como um livro, apenas usando seus meios art√≠sticos especiais. </li><li>  ela √© divertida, o que n√£o √© para todos - as abordagens descritas podem ser aplicadas a qualquer sonho subsequente, n√£o importa quantos voc√™ tenha. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Para quem n√£o conhece as regras, uma breve introdu√ß√£o:</b> <div class="spoiler_text">  <b>O Pathfinder Adventures</b> √© uma vers√£o digital de um jogo de cartas criado com base em um jogo de role-playing (ou melhor, em todo um sistema de role-playing) Pathfinder.  Os jogadores (no valor de 1 a 6) escolhem um personagem para si e, junto com ele, partem para uma aventura dividida em v√°rios cen√°rios.  Cada personagem tem √† sua disposi√ß√£o cartas de v√°rios tipos (como: armas, armaduras, feiti√ßos, aliados, itens etc.), com a ajuda da qual em cada cen√°rio ele deve encontrar e punir brutalmente o Scoundrel - uma carta especial com propriedades especiais. <br><br>  Cada cen√°rio fornece v√°rios locais ou locais (o n√∫mero deles depende do n√∫mero de jogadores) que os jogadores precisam visitar e explorar.  Cada local cont√©m um baralho de cartas virado para baixo, que os personagens exploram por sua vez - ou seja, eles abrem a carta superior e tentam venc√™-la de acordo com as regras relevantes.  Al√©m de cartas inofensivas que reabastecem o baralho do jogador, esses decks tamb√©m cont√™m inimigos e obst√°culos ruins - eles devem ser derrotados para avan√ßar ainda mais.  A carta Scoundrel tamb√©m se encontra em um dos decks, mas os jogadores n√£o sabem qual - precisa ser encontrada. <br><br>  Para derrotar as cartas (e adquirir novas), os personagens devem passar no teste de uma de suas caracter√≠sticas (padr√£o para RPGs, for√ßa, destreza, sabedoria etc.) jogando um dado cujo tamanho √© determinado pelo valor da caracter√≠stica correspondente (de d4 a d12), adicionando modificadores (definidos regras e o n√≠vel de desenvolvimento do personagem) e jogar para aumentar o efeito das cartas apropriadas da m√£o.  Ap√≥s a vit√≥ria, a carta encontrada √© removida do jogo (se for um inimigo) ou reabastece a m√£o de um jogador (se for um item) e a jogada √© direcionada para outro jogador.  Ao perder, o personagem geralmente √© danificado, fazendo com que ele descarte as cartas de sua m√£o.  Uma mec√¢nica interessante √© que a sa√∫de do personagem √© determinada pelo n√∫mero de cartas no seu baralho - assim que o jogador precisar tirar uma carta do baralho, mas elas n√£o estiverem l√°, ele morrer√°. <br><br>  O objetivo √©, tendo percorrido os mapas de localiza√ß√£o, encontrar e derrotar o Scoundrel, tendo anteriormente bloqueado seu caminho para recuar (voc√™ pode aprender mais sobre isso e muito mais lendo as regras).  Isso precisa ser feito por um tempo, que √© a principal dificuldade do jogo.  O n√∫mero de jogadas √© estritamente limitado e uma simples enumera√ß√£o de todas as cartas dispon√≠veis n√£o atinge a meta.  Portanto, voc√™ deve aplicar v√°rios truques e t√©cnicas inteligentes. <br><br>  √Ä medida que os cen√°rios s√£o preenchidos, os personagens crescem e se desenvolvem, melhorando suas caracter√≠sticas e adquirindo novas habilidades √∫teis.  Gerenciar o baralho tamb√©m √© um elemento muito importante do jogo, j√° que o resultado do cen√°rio (especialmente nas fases posteriores) geralmente depende das cartas selecionadas corretamente (e de muita sorte, mas o que voc√™ quer de um jogo com dados?). </div></div><br>  Em geral, o jogo √© interessante, digno, digno de aten√ß√£o e, o que √© importante para n√≥s, bastante complicado (observe que eu digo "dif√≠cil", n√£o no significado de "dif√≠cil") para torn√°-lo interessante para implementar seu clone. <br><br>  No nosso caso, faremos uma mudan√ßa conceitual global - abandonaremos os cart√µes.  Em vez disso, n√£o recusaremos, mas substituiremos os cart√µes por cubos, ainda de tamanhos e cores diferentes (tecnicamente, n√£o √© correto usar seus "cubos", pois existem outras formas al√©m do hex√°gono correto, mas √© incomum cham√°-los de "ossos" e √© desagrad√°vel, mas usar margarida americana √© um sinal de mau gosto, ent√£o deixe como est√°).  Agora, em vez de decks, os jogadores ter√£o sacolas.  E os locais tamb√©m ter√£o sacolas, das quais os jogadores no processo de pesquisa puxar√£o cubos arbitr√°rios.  A cor do cubo determinar√° seu tipo e, consequentemente, as regras para passar no teste.  As caracter√≠sticas pessoais do personagem (for√ßa, destreza, etc.), como resultado, ser√£o eliminadas, mas novas mec√¢nicas interessantes aparecer√£o (mais sobre as quais mais tarde). <br><br>  Vai ser divertido jogar?  Eu n√£o tenho id√©ia, e ningu√©m pode entender isso at√© que um prot√≥tipo de trabalho esteja pronto.  Mas n√≥s n√£o gostamos do jogo, mas do desenvolvimento, certo?  Portanto, n√£o deve haver d√∫vida de sucesso. <br><br><h2>  <font color="#0474a0">Etapa dois</font>  <font color="#0474a0">Desenho</font> </h2><br>  Ter uma ideia √© apenas um ter√ßo da hist√≥ria.  Agora √© importante desenvolver essa id√©ia.  Ou seja, n√£o d√™ um passeio no parque ou tome um banho de vapor, mas sente-se √† mesa, pegue papel com uma caneta (ou abra seu editor de texto favorito) e escreva cuidadosamente um documento de design, trabalhando minuciosamente todos os aspectos da mec√¢nica do jogo.  O tempo para isso ser√° um avan√ßo, portanto, n√£o espere concluir a reda√ß√£o de uma s√≥ vez.  E nem espere pensar em tudo de uma s√≥ vez - √† medida que voc√™ implementa, ver√° a necessidade de fazer v√°rias mudan√ßas e mudan√ßas (e algumas vezes retrabalhar algo globalmente), mas alguma base deve estar presente antes do in√≠cio do processo de desenvolvimento. <br><br><div class="spoiler">  <b class="spoiler_title">Inicialmente, seu documento de design ser√° semelhante a este</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/oi/qw/fp/oiqwfpjf6vasnpmy6ucqglbnwy8.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/ff/gu/7q/ffgu7qx80qefetycgrmdraoetv8.jpeg"></a> <br></div></div><br>  E somente depois de lidar com a primeira onda de id√©ias grandiosas, voc√™ assume a cabe√ßa, decide a estrutura do documento e come√ßa a preench√™-lo metodicamente com conte√∫do (verificando a cada segundo o que j√° foi escrito para evitar repeti√ß√µes desnecess√°rias e especialmente contradi√ß√µes).  Gradualmente, passo a passo, voc√™ obt√©m algo significativo e conciso, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">como este</a> . <br><br>  Ao descrever o design, escolha o idioma em que √© mais f√°cil expressar seus pensamentos, especialmente se voc√™ trabalha sozinho.  Se voc√™ precisar envolver desenvolvedores de terceiros no projeto, verifique se eles entendem toda a bobagem criativa que est√° acontecendo em sua cabe√ßa. <br><br>  Para continuar, eu recomendo fortemente que voc√™ leia o documento citado pelo menos na diagonal, porque no futuro vou me referir aos termos e conceitos apresentados l√°, sem me deter em detalhes sobre sua interpreta√ß√£o. <br><br>  <i>‚ÄúAutor, mate-se contra a parede.</i>  <i>Muitas cartas.</i> <br><br><h2>  <font color="#0474a0">Etapa tr√™s</font>  <font color="#0474a0">Modelagem</font> </h2><br>  Ou seja, com o mesmo design, apenas mais detalhado. <br>  Eu sei que muitos j√° est√£o ansiosos para abrir um IDE e come√ßar a codificar, mas seja paciente um pouco mais.  Quando as id√©ias sobrecarregam nossas cabe√ßas, parece-nos que precisamos tocar o teclado e nossas m√£os correm para grandes dist√¢ncias - antes que o caf√© tenha tempo de ferver no fog√£o, quando a vers√£o de trabalho do aplicativo estiver pronta ... para ir ao lixo.  Para n√£o reescrever a mesma coisa muitas vezes (e especialmente para garantir, ap√≥s tr√™s horas de desenvolvimento, que o layout n√£o esteja funcionando e precise ser reiniciado novamente), sugiro que voc√™ pense primeiro (e documente) na estrutura principal do aplicativo. <br><br>  Como n√≥s, como desenvolvedores, estamos familiarizados com a programa√ß√£o orientada a objetos (OOP), usaremos seus princ√≠pios em nosso projeto.  Mas para OOP, n√£o h√° nada mais esperado do que iniciar o desenvolvimento com v√°rios diagramas UML chatos.  (Voc√™ n√£o sabe o que <abbr title="Linguagem de modelagem unificada">√© UML</abbr> ? Quase esqueci tamb√©m, mas vou lembrar com prazer - apenas para mostrar que programador sou eu, hehe.) <br><br>  Vamos come√ßar com o diagrama de casos de uso.  Iremos descrever as maneiras pelas quais nosso usu√°rio (jogador) interage com o futuro sistema: <br><br><div class="spoiler">  <b class="spoiler_title">Casos de uso</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/rt/ph/st/rtphstumyokd9_gnpgzoewpaux8.png"></a> <br></div></div><br>  <i>"Uh ... o que √© isso tudo?"</i> <br><br>  Brincadeira, brincadeira ... e, talvez, pare de brincar - isso √© um assunto s√©rio (um sonho, afinal).  No diagrama de casos de uso, √© necess√°rio exibir as possibilidades que o sistema oferece ao usu√°rio.  Em detalhes.  Mas aconteceu historicamente que esse tipo particular de diagramas √© o pior para mim - aparentemente, a paci√™ncia n√£o √© suficiente.  E voc√™ n√£o precisa me olhar assim - n√£o estamos na universidade protegendo o diploma, mas gostamos do processo de trabalho.  E para esse processo, os casos de uso n√£o s√£o t√£o importantes.  √â muito mais importante dividir corretamente o aplicativo em m√≥dulos independentes, ou seja, implementar o jogo de forma que os recursos da interface visual n√£o afetem a mec√¢nica do jogo e que o componente gr√°fico possa ser facilmente alterado, se desejado. <br><br>  Este ponto pode ser detalhado no seguinte diagrama de componentes: <br><br><div class="spoiler">  <b class="spoiler_title">Componentes do sistema</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/lm/br/br/lmbrbrdoyppboylxuoopjr--d5u.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui j√° identificamos subsistemas espec√≠ficos que fazem parte de nosso aplicativo e, como ser√° mostrado mais adiante, todos ser√£o desenvolvidos independentemente um do outro. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, no mesmo est√°gio, descobriremos como ser√° o ciclo principal do jogo (ou melhor, sua parte mais interessante √© a que implementa os personagens no script). </font><font style="vertical-align: inherit;">Para isso, um diagrama de atividades √© adequado para n√≥s:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ ficar em p√©, sente-se</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/o-/f6/ev/o-f6evthl0hpqu0rhwlejbxyhty.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E, finalmente, seria bom apresentar em termos gerais a sequ√™ncia da intera√ß√£o do usu√°rio final com o mecanismo do jogo por meio de um sistema de entrada e sa√≠da. </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enchidos</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/hs/jo/_d/hsjo_dinyd5genlr77jrgz0ouys.png"></a> <br></div></div><br>  ,    .     ,        ‚Äî ,          ,   ,   ,     ,          -,            (   , ?). <br><br>     (class)      ‚Äî   <s></s>            .        ,       . <br><br><h2> <font color="#0474a0"> .  </font> </h2><br>    ,    ,         ,     .      Java,    Kotlin,       ,        ,      ( ,     ). <abbr title="Java Virtual Machine">JVM</abbr> ,   ,     (   , -),    Windows,  UNIX,       SSH-    (    ‚Äî ,    ).    ,     ,    . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bibliotecas (n√£o podemos chegar a lugar nenhum sem elas) escolheremos de acordo com nossos requisitos de plataforma cruzada. </font><font style="vertical-align: inherit;">Usaremos o Maven como sistema de compila√ß√£o. </font><font style="vertical-align: inherit;">Ou Gradle. </font><font style="vertical-align: inherit;">Ou mesmo assim, Maven, vamos come√ßar com isso. </font><font style="vertical-align: inherit;">Imediatamente, aconselho a configurar um sistema de controle de vers√£o (qualquer um que voc√™ goste mais), para que, depois de muitos anos, seja mais f√°cil recordar com sentimentos nost√°lgicos o qu√£o bom era antes. </font><font style="vertical-align: inherit;">O IDE tamb√©m escolhe o familiar, favorito e conveniente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na verdade, n√£o precisamos de mais nada. </font><font style="vertical-align: inherit;">Voc√™ pode come√ßar a desenvolver.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quinto passo </font><font style="vertical-align: inherit;">Criando e configurando um projeto</font></font></font> </h2><br>  Se voc√™ usa um IDE, a cria√ß√£o de um projeto √© trivial.  Voc√™ s√≥ precisa escolher um nome sonoro (por exemplo, <b>Dados</b> ) para nossa futura obra-prima, n√£o se esque√ßa de ativar o suporte ao Maven nas configura√ß√µes e escreva os identificadores necess√°rios no arquivo <code>pom.xml</code> : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>my.company<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>dice<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Adicione tamb√©m o suporte ao Kotlin, que est√° ausente por padr√£o: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-stdlib<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  e algumas configura√ß√µes nas quais n√£o vamos nos concentrar em detalhes: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span>UTF-8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.3.20<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Um pouco de informa√ß√£o sobre projetos h√≠bridos</b> <div class="spoiler_text">  Se voc√™ planeja usar Java e Kotlin em seu projeto, al√©m da <code>src/main/kotlin</code> , tamb√©m ter√° a pasta <code>src/main/java</code> .  Os desenvolvedores do Kotlin afirmam que os arquivos de origem da primeira pasta ( <code>*.kt</code> ) devem ser compilados antes dos arquivos de origem da segunda pasta ( <code>*.java</code> ) e, portanto, recomendamos fortemente que voc√™ altere as configura√ß√µes dos destinos padr√£o do Maven: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>process-sources<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDirs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span>${project.basedir}/src/main/kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span>${project.basedir}/src/main/java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDirs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>test-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>test-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDirs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span>${project.basedir}/src/test/kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span>${project.basedir}/src/test/java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDir</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sourceDirs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.apache.maven.plugins<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-compiler-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.5.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Replacing default-compile --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>default-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>none<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Replacing default-testCompile --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>default-testCompile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>none<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>java-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>java-test-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>test-compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>testCompile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  N√£o sei dizer o quanto isso √© importante - os projetos est√£o indo muito bem sem essa planilha.  Mas por precau√ß√£o, voc√™ ser√° avisado. <br></div></div><br>  Vamos criar tr√™s pacotes de uma vez (por que brincar algo?): <br><br><ul><li>  <code>model</code> - para classes que descrevem objetos do mundo do jogo; </li><li>  <code>game</code> - para classes que implementam jogabilidade; </li><li>  <code>ui</code> - para classes respons√°veis ‚Äã‚Äãpela intera√ß√£o do usu√°rio. </li></ul><br>  Este √∫ltimo conter√° apenas interfaces, cujos m√©todos ser√£o utilizados para entrada e sa√≠da de dados.  Armazenaremos implementa√ß√µes espec√≠ficas em um projeto separado, mas mais sobre isso posteriormente.  Enquanto isso, para n√£o borrifar muito, adicionaremos essas classes aqui, lado a lado. <br><br>  N√£o tente faz√™-lo imediatamente de maneira perfeita: pense nos detalhes dos nomes dos pacotes, interfaces, classes e m√©todos;  prescrever minuciosamente a intera√ß√£o dos objetos entre si - tudo isso mudar√° e mais de uma d√∫zia de vezes.  √Ä medida que o projeto se desenvolve, muitas coisas parecer√£o feias, volumosas, ineficazes para voc√™ e similares - fique √† vontade para alter√°-las, pois a refatora√ß√£o nos IDEs modernos √© uma opera√ß√£o muito barata. <br><br>  Tamb√©m criaremos uma classe com a fun√ß√£o <code>main</code> e estamos prontos para grandes conquistas.  Voc√™ pode usar o pr√≥prio IDE para iniciar, mas como voc√™ ver√° mais adiante, esse m√©todo n√£o √© adequado para nossos prop√≥sitos (o console IDE padr√£o n√£o pode exibir nossas descobertas gr√°ficas como deveria), portanto, configuraremos o lan√ßamento de fora usando lote (ou shell nos sistemas UNIX) arquivo  Mas antes disso, faremos algumas configura√ß√µes adicionais. <br><br>  Ap√≥s a opera√ß√£o do <code>mvn package</code> ser conclu√≠da, obtemos a sa√≠da do archive JAR com todas as classes compiladas.  Primeiro, por padr√£o, esse arquivo n√£o inclui as depend√™ncias necess√°rias para o projeto funcionar (at√© o momento n√£o as temos, mas elas certamente aparecer√£o no futuro).  Em segundo lugar, o caminho para a classe principal que cont√©m o m√©todo <code>main</code> n√£o est√° especificado no arquivo de manifesto do archive, portanto, n√£o <code>java -jar dice-1.0.jar</code> iniciar o projeto com o <code>java -jar dice-1.0.jar</code> .  Corrija isso adicionando configura√ß√µes adicionais ao <code>pom.xml</code> : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-assembly-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>package<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>single<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRefs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRef</span></span></span><span class="hljs-tag">&gt;</span></span>jar-with-dependencies<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRef</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRefs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span>my.company.dice.MainKt<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Preste aten√ß√£o ao nome da classe principal.  Para fun√ß√µes Kotlin contidas fora das classes (como fun√ß√µes <code>main</code> ), as classes s√£o criadas de qualquer maneira durante a compila√ß√£o (porque a JVM n√£o sabe nada e n√£o quer saber).  O nome desta classe √© o nome do arquivo com a adi√ß√£o de <code>Kt</code> .  Ou seja, se voc√™ nomeou a classe principal <code>Main</code> , ela ser√° compilada no arquivo <code>MainKt.class</code> .  √â este √∫ltimo que devemos indicar no manifesto do arquivo jar. <br><br>  Agora, ao criar o projeto, obteremos dois arquivos jar na sa√≠da: <code>dice-1.0.jar</code> e <code>dice-1.0-jar-with-dependencies.jar</code> .  Estamos interessados ‚Äã‚Äãno segundo.  Vamos escrever um script de lan√ßamento para ele. <br><br>  <b>dice.bat</b> (para Windows) <br><br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> OFF <span class="hljs-built_in"><span class="hljs-built_in">rem</span></span> Compiling <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> "path_to_maven\mvn.bat" -f "path_to_project\Dice\pom.xml" package <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">errorlevel</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Project compilation failed! &amp; <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span> &amp; <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> :EOF <span class="hljs-built_in"><span class="hljs-built_in">rem</span></span> Running java -jar path_to_project\Dice\target\dice-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>-jar-with-dependencies.jar <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span></code> </pre><br>  <b>dice.sh</b> (para UNIX) <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # Compiling mvn -f "path_to_project/Dice/pom.xml" package if [[ "$?" -ne 0 ]] ; then echo 'Project compilation failed!'; exit $rc fi # Running java -jar path_to_project/Dice/target/dice-1.0-jar-with-dependencies.jar</span></span></code> </pre><br>  Observe que, se a compila√ß√£o falhar, somos for√ßados a interromper o script.  Caso contr√°rio, n√£o ser√° lan√ßada a √∫ltima harpa, mas o arquivo restante da montagem anterior bem-sucedida (√†s vezes nem encontraremos a diferen√ßa).  Freq√ºentemente, os desenvolvedores usam o comando <code>mvn clean package</code> para excluir todos os arquivos compilados anteriormente, mas, neste caso, todo o processo de compila√ß√£o sempre ser√° iniciado desde o in√≠cio (mesmo que o c√≥digo-fonte n√£o tenha sido alterado), o que levar√° muito tempo.  Mas mal podemos esperar - precisamos fazer um jogo. <br><br>  Portanto, o projeto inicia bem, mas at√© agora n√£o faz nada.  N√£o se preocupe, vamos corrigir isso em breve. <br><br><h2>  <font color="#0474a0">Etapa seis</font>  <font color="#0474a0">Objetos principais</font> </h2><br>  Gradualmente, come√ßaremos a preencher o pacote do <code>model</code> com as classes necess√°rias para a jogabilidade. <br><br><div class="spoiler">  <b class="spoiler_title">Diagrama de classe</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/lv/de/4t/lvde4t7282puwgyjgl6qrooazka.png"></a> <br></div></div><br>  Os cubos s√£o tudo, adicione-os primeiro.  Cada dado (uma inst√¢ncia da classe <code>Die</code> ) √© caracterizado por seu tipo (cor) e tamanho.  Para os tipos de cubo, faremos uma enumera√ß√£o separada ( <code>Die.Type</code> ), marcaremos o tamanho com um n√∫mero inteiro de 4 a 12. Tamb√©m implementamos o m√©todo <code>roll()</code> , que produzir√° um n√∫mero arbitr√°rio e uniformemente distribu√≠do a partir do intervalo dispon√≠vel para o cubo (de 1 ao valor inclusive). <br><br>  A classe implementa a interface <code>Comparable</code> que os cubos possam ser comparados entre si (√∫til mais tarde quando exibiremos v√°rios cubos em uma linha ordenada).  Cubos maiores ser√£o colocados anteriormente. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Die</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Type, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> size: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) : Comparable&lt;Die&gt; { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span></span>{ PHYSICAL, <span class="hljs-comment"><span class="hljs-comment">//Blue SOMATIC, //Green MENTAL, //Purple VERBAL, //Yellow DIVINE, //Cyan WOUND, //Gray ENEMY, //Red VILLAIN, //Orange OBSTACLE, //Brown ALLY //White } fun roll() = (1.. size).random() override fun toString() = "d$size" override fun compareTo(other: Die): Int { return compareValuesBy(this, other, Die::type, { -it.size }) } }</span></span></code> </pre><br>  Para n√£o acumular poeira, os cubos s√£o armazenados em bolsas (c√≥pias da classe <code>Bag</code> ).  S√≥ se pode adivinhar o que est√° acontecendo dentro da bolsa; portanto, n√£o faz sentido usar uma cole√ß√£o ordenada.  Parece ser.  Os conjuntos (conjuntos) implementam bem a ideia de que precisamos, mas n√£o se encaixam por dois motivos.  Primeiro, ao us√°-los, voc√™ precisar√° implementar os m√©todos <code>equals()</code> e <code>hashCode()</code> , e n√£o est√° claro como, uma vez que √© incorreto comparar os tipos e tamanhos de cubos - qualquer n√∫mero de cubos id√™nticos pode ser armazenado em nosso conjunto.  Em segundo lugar, puxando o cubo da sacola, esperamos obter n√£o apenas algo n√£o determin√≠stico, mas aleat√≥rio, cada vez que for diferente.  Portanto, recomendo que voc√™ use uma cole√ß√£o ordenada (lista) e a embaralhe toda vez que adicionar um novo elemento (no m√©todo <code>put()</code> ) ou imediatamente antes da emiss√£o (no m√©todo <code>draw()</code> ). <br><br>  O m√©todo <code>examine()</code> √© adequado para casos em que um jogador cansado da incerteza sacode o conte√∫do da sacola sobre a mesa nos cora√ß√µes (preste aten√ß√£o √† classifica√ß√£o) e o m√©todo <code>clear()</code> - se os cubos sacudidos n√£o retornarem √† sacola. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bag</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dice = LinkedList&lt;Die&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> size <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = dice.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">put</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">vararg</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dice: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { dice.forEach(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dice::addLast) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dice.shuffle() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Die = dice.pollFirst() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = dice.clear() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">examine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = dice.sorted().toList() }</code> </pre><br>  Al√©m de sacos com cubos, voc√™ tamb√©m precisa de pilhas com cubos (inst√¢ncias da classe <code>Pile</code> ).  No primeiro, os segundos diferem em que seu conte√∫do √© vis√≠vel para os jogadores e, portanto, se necess√°rio, remova um cubo da pilha, o jogador pode selecionar uma inst√¢ncia espec√≠fica de interesse.  Implementamos essa ideia usando o m√©todo <code>removeDie()</code> . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pile</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Bag</span></span></span></span>() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeDie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = dice.remove(die) }</code> </pre><br>  Agora nos voltamos para nossos personagens principais - her√≥is.  Ou seja, caracteres que agora chamaremos de her√≥is (h√° um bom motivo para n√£o chamar sua classe com o nome <code>Character</code> em Java).  Existem diferentes tipos de caracteres (para classific√°-lo em classes, embora seja melhor n√£o usar a palavra <code>class</code> ), mas para o nosso prot√≥tipo de trabalho, levaremos apenas dois: <i>Brawler</i> (ou seja, Lutador com √™nfase em for√ßa e for√ßa) e <i>Hunter</i> (tamb√©m conhecido como Ranger / Ladr√£o, com √™nfase destreza e discri√ß√£o).  A classe do her√≥i determina suas caracter√≠sticas, habilidades e o conjunto inicial de cubos, mas como ser√° visto mais adiante, os her√≥is n√£o estar√£o estritamente ligados √†s classes e, portanto, suas configura√ß√µes pessoais podem ser facilmente alteradas em um √∫nico local. <br><br>  Adicionaremos as propriedades necess√°rias ao her√≥i de acordo com o documento de design: nome, tipo favorito de cubo, limites de cubo, habilidades aprendidas e n√£o estudadas, m√£o, bolsa e pilha para redefini√ß√£o.  Preste aten√ß√£o aos recursos de implementa√ß√£o das propriedades da cole√ß√£o.  Em todo o mundo civilizado, √© considerado uma m√° forma fornecer acesso externo (com a ajuda de um getter) a cole√ß√µes armazenadas dentro do objeto - programadores inescrupulosos poder√£o alterar o conte√∫do dessas cole√ß√µes sem o conhecimento da classe.  Uma maneira de lidar com isso √© implementar m√©todos separados para adicionar e remover elementos, obter seu n√∫mero e acessar por √≠ndice.  Voc√™ pode implementar o getter, mas ao mesmo tempo retornar n√£o a cole√ß√£o em si, mas sua c√≥pia imut√°vel - para um pequeno n√∫mero de elementos, n√£o √© particularmente assustador fazer exatamente isso. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hero</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Type) { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span></span>{ BRAWLER HUNTER } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isAlive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> favoredDieType: Die.Type = Die.Type.ALLY <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hand = Hand(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bag: Bag = Bag() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> discardPile: Pile = Pile() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> diceLimits = mutableListOf&lt;DiceLimit&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> skills = mutableListOf&lt;Skill&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dormantSkills = mutableListOf&lt;Skill&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addDiceLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(limit: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DiceLimit</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = diceLimits.add(limit) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDiceLimits</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;DiceLimit&gt; = Collections.unmodifiableList(diceLimits) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(skill: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Skill</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = skills.add(skill) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSkills</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Skill&gt; = Collections.unmodifiableList(skills) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addDormantSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(skill: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Skill</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = dormantSkills.add(skill) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDormantSkills</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Skill&gt; = Collections.unmodifiableList(dormantSkills) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">increaseDiceLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { diceLimits.find { it.type == type }?.let { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { it.current &lt; it.maximal -&gt; it.current++ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Already at maximum"</span></span>) } } ?: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Incorrect type specified"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hideDieFromHand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { bag.put(die) hand.removeDie(die) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">discardDieFromHand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { discardPile.put(die) hand.removeDie(die) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Skill</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = skills.any { it.type == type } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">improveSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Skill</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { dormantSkills .find { it.type == type } ?.let { skills.add(it) dormantSkills.remove(it) } skills .find { it.type == type } ?.let { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { it.level &lt; it.maxLevel -&gt; it.level += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Skill already maxed out"</span></span>) } } ?: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Skill not found"</span></span>) } }</code> </pre><br>  A m√£o do her√≥i (os cubos que ele possui no momento) √© descrita por um objeto separado (classe <code>Hand</code> ).  A decis√£o do projeto de manter os cubos aliados separados do bra√ßo principal foi uma das primeiras que lhe vieram √† mente.  No come√ßo, parecia um recurso super legal, mas depois gerou um grande n√∫mero de problemas e inconvenientes.  No entanto, n√£o estamos procurando maneiras f√°ceis e, portanto, as listas de <code>dice</code> e <code>allies</code> est√£o ao nosso servi√ßo, com todos os m√©todos que voc√™ precisa adicionar, receber e excluir (alguns deles determinam inteligentemente qual das duas listas acessar).  Quando voc√™ remove um cubo da sua m√£o, todos os cubos subsequentes ser√£o movidos para o topo da lista, preenchendo os espa√ßos em branco - no futuro, isso facilitar√° bastante a pesquisa (n√£o √© necess√°rio lidar com situa√ß√µes com <code>null</code> ). <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hand</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> capacity: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dice = LinkedList&lt;Die&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allies = LinkedList&lt;Die&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = dice.size <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allyDieCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = allies.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dieAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { (index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> until dieCount) -&gt; dice[index] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allyDieAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { (index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> until allyDieCount) -&gt; allies[index] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addDie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { die.type == Die.Type.ALLY -&gt; allies.addLast(die) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; dice.addLast(die) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeDie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { die.type == Die.Type.ALLY -&gt; allies.remove(die) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; dice.remove(die) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findDieOfType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Die? = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (type) { Die.Type.ALLY -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (allies.isNotEmpty()) allies.first <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; dice.firstOrNull { it.type == type } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">examine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Die&gt; = (dice + allies).sorted() }</code> </pre><br>  A cole√ß√£o de objetos da classe <code>DiceLimit</code> define limites para o n√∫mero de cubos de cada tipo que o her√≥i pode ter no in√≠cio do script.  N√£o h√° nada de especial a dizer, determinamos inicialmente os valores m√°ximos e atuais para cada tipo. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiceLimit</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Die.Type, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initial: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> maximal: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> current: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>)</code> </pre><br>  Mas com habilidades √© mais interessante.  Cada um deles ter√° que ser implementado individualmente (sobre o que mais tarde), mas consideraremos apenas dois: <i>Acertar</i> e <i>Atirar</i> (um para cada classe, respectivamente).  Habilidades podem ser desenvolvidas (‚Äúbombeadas‚Äù) do n√≠vel inicial ao m√°ximo, o que geralmente afeta os modificadores que s√£o adicionados √†s jogadas de dados.  Isso √© <code>maxLevel</code> no <code>level</code> propriedades, <code>maxLevel</code> , <code>modifier1</code> e <code>modifier2</code> . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Skill</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Type) { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//Brawler HIT, //Hunter SHOOT, } var level = 1 var maxLevel = 3 var isActive = true var modifier1 = 0 var modifier2 = 0 }</span></span></code> </pre><br>  Preste aten√ß√£o aos m√©todos auxiliares da classe <code>Hero</code> , que permitem ocultar ou rolar um dado de sua m√£o, verifique se o her√≥i possui uma determinada habilidade e tamb√©m aumente o n√≠vel da habilidade aprendida ou aprenda uma nova.  Todos eles ser√£o necess√°rios mais cedo ou mais tarde, mas agora n√£o iremos nos aprofundar neles em detalhes. <br><br>  Por favor, n√£o tenha medo do n√∫mero de classes que temos que criar.  Para um projeto dessa complexidade, v√°rias centenas s√£o comuns.  Aqui, como em qualquer ocupa√ß√£o s√©ria - come√ßamos pequenos, aumentamos gradualmente o ritmo, em um m√™s temos medo do escopo.  N√£o se esque√ßa, ainda somos um pequeno est√∫dio de uma pessoa - n√£o somos confrontados com tarefas esmagadoras. <br><br>  <i>‚ÄúAlgo me cansou.</i>  <i>Vou fumar ou algo assim ...</i> <br><br>  E n√≥s continuaremos. <br>  Os her√≥is e suas habilidades s√£o descritos, √© hora de passar para as for√ßas opostas - a grande e terr√≠vel Mec√¢nica de Jogo.  Ou melhor, objetos com os quais nossos her√≥is precisam interagir. <br><br><div class="spoiler">  <b class="spoiler_title">Outro diagrama de classes</b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/bq/7k/iq/bq7kiq7fcsqbhrf61f9g1bh-9e8.png"></a> <br></div></div><br>  Nossos protagonistas valentes ser√£o confrontados com tr√™s tipos de cubos e cartas: vil√µes (classe <code>Villain</code> ), inimigos (classe <code>Enemy</code> ) e obst√°culos (classe <code>Obstacle</code> ), unidos sob o termo geral de "amea√ßas" ( <code>Threat</code> √© uma classe abstrata "bloqueada", a lista de seus poss√≠veis herdeiros √© estritamente limitado).  Cada amea√ßa tem um conjunto de caracter√≠sticas distintivas ( <code>Trait</code> ) que descrevem regras especiais de comportamento quando confrontadas com essa amea√ßa e adicionam variedade √† jogabilidade. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Threat</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name: String = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description: String = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits = mutableListOf&lt;Trait&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTrait</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">trait</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Trait</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = traits.add(<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getTraits</span></span></span></span>(): List&lt;Trait&gt; = traits } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Obstacle</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tier: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">vararg</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieTypes: Die.Type) : Threat() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Villain</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Threat</span></span></span></span>() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enemy</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Threat</span></span></span></span>() <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Trait</span></span></span><span class="hljs-class"> </span></span>{ MODIFIER_PLUS_ONE, <span class="hljs-comment"><span class="hljs-comment">//Add +1 modifier MODIFIER_PLUS_TWO, //Add +2 modifier }</span></span></code> </pre><br>  Observe que a lista de objetos da classe <code>Trait</code> √© definida como mut√°vel ( <code>MutableList</code> ), mas √© fornecida como uma interface imut√°vel da <code>List</code> .  Embora isso funcione no Kotlin, no entanto, a abordagem √© insegura, pois n√£o h√° nada que impe√ßa a convers√£o da lista resultante em uma interface mut√°vel e fa√ßa v√°rias modifica√ß√µes - √© especialmente f√°cil fazer isso se voc√™ acessar a classe a partir do c√≥digo Java (onde a interface da <code>List</code> √© mut√°vel).  A maneira mais paran√≥ica de proteger sua cole√ß√£o √© fazer algo assim: <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTraits</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Trait&gt; = Collections.unmodifiableList(traits)</code> </pre> <br>  mas n√£o seremos t√£o escrupulosos ao abordar o problema (voc√™, no entanto, √© avisado). <br><br>  Devido √†s peculiaridades da mec√¢nica do jogo, a classe <code>Obstacle</code> difere de suas contrapartes na presen√ßa de campos adicionais, mas n√£o vamos nos concentrar neles. <br><br>  Cartas de amea√ßa (e se voc√™ ler atentamente o documento de design, lembre-se de que s√£o cartas) s√£o combinadas nos decks representados pela classe <code>Deck</code> : <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Deck</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">E: Threat</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cards = LinkedList&lt;E&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> size <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = cards.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addToTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(card: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">E</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = cards.addFirst(card) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addToBottom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(card: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">E</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = cards.addLast(card) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">revealTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: E = cards.first <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawFromTop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: E = cards.removeFirst() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shuffle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = cards.shuffle() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = cards.clear() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">examine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = cards.toList() }</code> </pre><br>  N√£o h√° nada incomum aqui, exceto que a classe √© parametrizada e cont√©m uma lista ordenada (ou melhor, uma fila de m√£o dupla), que pode ser combinada usando o m√©todo apropriado.  Baralhos de inimigos e obst√°culos ser√£o necess√°rios para n√≥s literalmente em um segundo, quando chegarmos √† considera√ß√£o ... <br><br>  ... da classe <code>Location</code> , em que cada inst√¢ncia descreve uma localidade √∫nica que nossos her√≥is ter√£o que visitar como parte do script. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Location</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name: String = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description: String = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isOpen = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> closingDifficulty = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bag: Bag <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> villain: Villain? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> enemies: Deck&lt;Enemy&gt; <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obstacles: Deck&lt;Obstacle&gt; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules = mutableListOf&lt;SpecialRule&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSpecialRule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rule: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SpecialRule</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = specialRules.add(rule) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSpecialRules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = specialRules }</code> </pre><br>  Cada localidade tem um nome, descri√ß√£o, dificuldade de fechamento e o sinal de "aberto / fechado".  Em algum lugar aqui o vil√£o pode estar √† espreita (ou pode n√£o estar √† espreita, como resultado, a propriedade do <code>villain</code> pode ser <code>null</code> ).  Em cada √°rea, h√° uma sacola com cubos e um baralho de cartas com amea√ßas.  O terreno tamb√©m pode ter seus pr√≥prios recursos exclusivos de jogo ( <code>SpecialRule</code> ), que, como as propriedades das amea√ßas, adicionam variedade √† jogabilidade.  Como voc√™ pode ver, estamos lan√ßando as bases para a funcionalidade futura, mesmo que n√£o planejemos implement√°-la em um futuro pr√≥ximo (para o qual, de fato, precisamos do est√°gio de modelagem). <br><br>  Por fim, resta implementar os scripts (classe <code>Scenario</code> ): <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Scenario</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> description = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> level = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initialTimer = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allySkills = mutableListOf&lt;AllySkill&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules = mutableListOf&lt;SpecialRule&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addAllySkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(skill: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">AllySkill</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = allySkills.add(skill) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAllySkills</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;AllySkill&gt; = Collections.unmodifiableList(allySkills) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addSpecialRule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rule: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SpecialRule</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = specialRules.add(rule) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSpecialRules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;SpecialRule&gt; = Collections.unmodifiableList(specialRules) }</code> </pre><br>  Cada cen√°rio √© caracterizado pelo n√≠vel e valor inicial do cron√¥metro.  Similar ao que foi visto anteriormente, regras especiais ( <code>specialRules</code> ) e habilidades dos aliados s√£o definidas (n√£o consideraremos a considera√ß√£o).  Voc√™ pode pensar que o script tamb√©m deve conter uma lista de locais (objetos da classe <code>Location</code> ) e, logicamente, √© realmente isso.  Mas, como ser√° visto mais adiante, n√£o usaremos essa conex√£o em nenhum lugar e ela n√£o oferece nenhuma vantagem t√©cnica. <br><br>  Lembro que todas as classes consideradas at√© agora est√£o contidas no pacote do <code>model</code> - quando crian√ßa, em antecipa√ß√£o a uma batalha √©pica de brinquedos, colocamos soldados na superf√≠cie da mesa.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E agora, depois de alguns momentos dolorosos, ao sinal do comandante-em-chefe, vamos nos apressar para a batalha, juntando nossos brinquedos e aproveitando as consequ√™ncias da jogabilidade. </font><font style="vertical-align: inherit;">Mas antes disso, um pouco sobre o arranjo em si. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Bem, muuuito ..."</font></font></i> <br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S√©timo passo. </font><font style="vertical-align: inherit;">Padr√µes e Geradores</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos imaginar por um segundo qual ser√° o processo de gera√ß√£o de qualquer um dos objetos considerados anteriormente, por exemplo, localiza√ß√£o (terreno). </font><font style="vertical-align: inherit;">Precisamos criar uma inst√¢ncia da classe </font></font><code>Location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, inicializar seus campos com valores e, portanto, para cada localidade que queremos usar no jogo. </font><font style="vertical-align: inherit;">Mas espere: cada local deve ter uma sacola, que tamb√©m precisa ser gerada. </font><font style="vertical-align: inherit;">E os sacos t√™m cubos - tamb√©m s√£o inst√¢ncias da classe correspondente ( </font></font><code>Die</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">N√£o estou falando sobre inimigos e obst√°culos - eles geralmente precisam ser coletados em decks. </font><font style="vertical-align: inherit;">E o vil√£o n√£o determina o terreno em si, mas as caracter√≠sticas do cen√°rio localizam um n√≠vel acima. </font><font style="vertical-align: inherit;">Bem, voc√™ entendeu. </font><font style="vertical-align: inherit;">O c√≥digo fonte para o acima pode ser assim:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> location = Location().apply { name = <span class="hljs-string"><span class="hljs-string">"Some location"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some description"</span></span> isOpen = <span class="hljs-literal"><span class="hljs-literal">true</span></span> closingDifficulty = <span class="hljs-number"><span class="hljs-number">4</span></span> bag = Bag().apply { put(Die(Die.Type.PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>)) put(Die(Die.Type.SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>)) put(Die(Die.Type.MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>)) put(Die(Die.Type.ENEMY, <span class="hljs-number"><span class="hljs-number">6</span></span>)) put(Die(Die.Type.OBSTACLE, <span class="hljs-number"><span class="hljs-number">6</span></span>)) put(Die(Die.Type.VILLAIN, <span class="hljs-number"><span class="hljs-number">6</span></span>)) } villain = Villain().apply { name = <span class="hljs-string"><span class="hljs-string">"Some villain"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some description"</span></span> addTrait(Trait.MODIFIER_PLUS_ONE) } enemies = Deck&lt;Enemy&gt;().apply { addToTop(Enemy().apply { name = <span class="hljs-string"><span class="hljs-string">"Some enemy"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some description"</span></span> }) addToTop(Enemy().apply { name = <span class="hljs-string"><span class="hljs-string">"Other enemy"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some description"</span></span> }) shuffle() } obstacles = Deck&lt;Obstacle&gt;().apply { addToTop(Obstacle(<span class="hljs-number"><span class="hljs-number">1</span></span>, Die.Type.PHYSICAL, Die.Type.VERBAL).apply { name = <span class="hljs-string"><span class="hljs-string">"Some obstacle"</span></span> description = <span class="hljs-string"><span class="hljs-string">"Some Description"</span></span> }) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso tamb√©m se deve √† linguagem e ao design Kotlin </font></font><code>apply{}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- em Java, o c√≥digo seria duas vezes mais volumoso. Al√©m disso, haver√° muitos lugares, como dissemos, e al√©m deles tamb√©m existem cen√°rios, aventuras e her√≥is com suas habilidades e caracter√≠sticas - em geral, h√° algo para o designer de jogos fazer.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas o designer do jogo n√£o escrever√° c√≥digo e √© inconveniente recompilar o projeto com a menor mudan√ßa no mundo do jogo. </font><font style="vertical-align: inherit;">Aqui, qualquer programador competente objetar√° que as descri√ß√µes dos objetos do c√≥digo da classe sejam separadas - idealmente, para que inst√¢ncias do √∫ltimo sejam geradas dinamicamente com base no primeiro, conforme necess√°rio, semelhante √† forma como uma pe√ßa √© feita a partir de uma planta de desenho. </font><font style="vertical-align: inherit;">Tamb√©m implementamos esses desenhos, apenas os chamamos de modelos e os representamos como inst√¢ncias de uma classe especial. </font><font style="vertical-align: inherit;">Tendo esses padr√µes, um c√≥digo de programa especial (gerador) criar√° os objetos finais a partir do modelo descrito anteriormente.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O processo de gerar um objeto a partir de um modelo</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/lj/cn/hb/ljcnhbcwls0jogmaxfbncrek6gc.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assim, para cada classe de nossos objetos, duas novas entidades devem ser definidas: a interface do modelo e a classe do gerador. </font><font style="vertical-align: inherit;">E como uma quantidade decente de objetos se acumulou, tamb√©m haver√° v√°rias entidades ... indecentes:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagrama de classe</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ef/hu/4k/efhu4kgepx97_87cnpis8ranl0c.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Respire fundo, ou√ßa com aten√ß√£o e n√£o se distraia. Primeiro, o diagrama n√£o mostra todos os objetos do mundo do jogo, mas apenas os principais, dos quais voc√™ n√£o pode prescindir. Em segundo lugar, para n√£o sobrecarregar o circuito com detalhes desnecess√°rios, algumas das conex√µes j√° mencionadas anteriormente em outros diagramas foram omitidas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos come√ßar com algo simples - gerar cubos. Como? voc√™ diz. - N√£o somos construtores suficientes? Sim, esse √© o tipo e tamanho ". N√£o, eu vou responder, n√£o o suficiente. De fato, em muitos casos (leia as regras), os cubos devem ser gerados arbitrariamente em uma quantidade arbitr√°ria (por exemplo: ‚Äúde um a tr√™s cubos de azul ou verde‚Äù). Al√©m disso, o tamanho deve ser selecionado dependendo do n√≠vel de complexidade do script. Portanto, apresentamos uma interface especial </font></font><code>DieTypeFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DieTypeFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diferentes implementa√ß√µes dessa interface verificar√£o se o tipo de cubo corresponde a diferentes conjuntos de regras (qualquer um que venha √† mente). </font><font style="vertical-align: inherit;">Por exemplo, se o tipo corresponde a um valor estritamente especificado ("azul") ou a um intervalo de valores ("azul, amarelo ou verde"); </font><font style="vertical-align: inherit;">ou, inversamente, corresponde a qualquer outro tipo que n√£o o fornecido ("se n√£o fosse branco em nenhum caso" - qualquer coisa, apenas n√£o isso). </font><font style="vertical-align: inherit;">Mesmo que n√£o esteja claro com anteced√™ncia quais implementa√ß√µes espec√≠ficas s√£o necess√°rias, isso n√£o importa - elas podem ser adicionadas mais tarde, o sistema n√£o interromper√° isso (polimorfismo, lembra?).</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleDieTypeFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Die.Type): DieTypeFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type == type) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InvertedSingleDieTypeFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Die.Type): DieTypeFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type != type) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MultipleDieTypeFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">vararg</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types: Die.Type): DieTypeFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InvertedMultipleDieTypeFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">vararg</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types: Die.Type): DieTypeFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (type !<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tamanho do cubo tamb√©m ser√° definido arbitrariamente, mas mais sobre isso posteriormente. </font><font style="vertical-align: inherit;">Enquanto isso, escreveremos um gerador de cubos ( </font></font><code>DieGenerator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), que, diferentemente do construtor de classes </font></font><code>Die</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, n√£o aceitar√° o tipo e tamanho expl√≠citos do cubo, mas o filtro e o n√≠vel de complexidade.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> DISTRIBUTION_LEVEL1 = intArrayOf(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> DISTRIBUTION_LEVEL2 = intArrayOf(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> DISTRIBUTION_LEVEL3 = intArrayOf(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> DISTRIBUTIONS = arrayOf( intArrayOf(<span class="hljs-number"><span class="hljs-number">4</span></span>), DISTRIBUTION_LEVEL1, DISTRIBUTION_LEVEL2, DISTRIBUTION_LEVEL3 ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMaxLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = DISTRIBUTIONS.size - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateDie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filter: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieTypeFilter</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Die(generateDieType(filter), generateDieSize(level)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateDieType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filter: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieTypeFilter</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Die.Type { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> type: Die.Type <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { type = Die.Type.values().random() } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!filter.test(type)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> type } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateDieSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = DISTRIBUTIONS[<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (level &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> || level &gt; getMaxLevel()) <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> level].random()</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em Java, esses m√©todos seriam est√°ticos, mas, como estamos lidando com o Kotlin, n√£o precisamos da classe como tal, o que tamb√©m √© v√°lido para os outros geradores discutidos abaixo (no entanto, no n√≠vel l√≥gico, ainda usaremos o conceito de classe). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dois m√©todos particulares geram separadamente o tipo e o tamanho do cubo - algo interessante pode ser dito sobre cada um. O m√©todo </font></font><code>generateDieType()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode ser direcionado para um loop infinito passando um filtro de entrada com</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filter: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieTypeFilter</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br> (    ,         ,          ).  <code>generateDieSize()</code> ,       ,     (    ).            ,      <b>Dice</b> ,             (   ,      ).    ,     ,      .   -   (       ), ,   . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E como estamos falando de malas, desenvolveremos um modelo para elas. </font><font style="vertical-align: inherit;">Ao contr√°rio de seus companheiros, este modelo ( </font></font><code>BagTemplate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ser√° uma classe espec√≠fica. </font><font style="vertical-align: inherit;">Ele cont√©m outros modelos - cada um deles descreve as regras (ou </font></font><code>Plan</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) pelas quais um ou mais cubos (lembra-se dos requisitos feitos anteriormente?) S√£o adicionados ao saco.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BagTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Plan</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> minQuantity: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> maxQuantity: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> filter: DieTypeFilter) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> plans = mutableListOf&lt;Plan&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPlan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(minQuantity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, maxQuantity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, filter: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieTypeFilter</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { plans.add(Plan(minQuantity, maxQuantity, filter)) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada plano define um padr√£o para o tipo de cubos, bem como o n√∫mero (m√≠nimo e m√°ximo) de cubos que satisfazem esse padr√£o. </font><font style="vertical-align: inherit;">Gra√ßas a essa abordagem, voc√™ pode gerar sacolas de acordo com regras bizarras (e novamente choro amargamente pela velhice, porque meu vizinho se recusa categoricamente a me ajudar). </font><font style="vertical-align: inherit;">Algo assim:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">realizePlan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(plan: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">BagTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Plan</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Array&lt;Die&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> count = (plan.minQuantity..plan.maxQuantity).shuffled().last() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>..count).map { generateDie(plan.filter, level) }.toTypedArray() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateBag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">BagTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Bag { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> template.plans.asSequence() .map { realizePlan(it, level) } .fold(Bag()) { b, d -&gt; b.put(*d); b } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™, assim como eu, est√° cansado de todo esse funcionalismo, aperte-se - isso s√≥ vai piorar. Por√©m, diferentemente de muitos tutoriais indistintos na Internet, temos a oportunidade de estudar o uso de v√°rios m√©todos inteligentes em rela√ß√£o a uma √°rea de assunto real e compreens√≠vel. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por si s√≥, as malas n√£o estar√£o no campo - voc√™ precisa entreg√°-las aos her√≥is e locais. Vamos come√ßar com o √∫ltimo.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocationTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bagTemplate: BagTemplate <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> basicClosingDifficulty: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardsCount: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardsCount: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardPool: Collection&lt;EnemyTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardPool: Collection&lt;ObstacleTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules: List&lt;SpecialRule&gt; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na linguagem Kotlin, em vez de m√©todos, </font></font><code>get()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voc√™ pode usar propriedades da interface - isso √© muito mais conciso. J√° estamos familiarizados com o modelo de bolsa, considere os m√©todos restantes. A propriedade </font></font><code>basicClosingDifficulty</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir√° a complexidade b√°sica da verifica√ß√£o para fechar o terreno. A palavra "b√°sico" aqui significa apenas que a complexidade final depender√° do n√≠vel do cen√°rio e n√£o √© clara nesta fase. Al√©m disso, precisamos definir padr√µes para inimigos e obst√°culos (e vil√µes ao mesmo tempo). Al√©m disso, da variedade de inimigos e obst√°culos descritos no modelo, nem todos ser√£o usados, mas apenas um n√∫mero limitado (para aumentar o valor de repeti√ß√£o). Observe que as regras especiais ( </font></font><code>SpecialRule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) da √°rea s√£o implementadas por uma enumera√ß√£o simples ( </font></font><code>enum class</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) e, portanto, n√£o requerem um modelo separado.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnemyTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits: List&lt;Trait&gt; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObstacleTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tier: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieTypes: Array&lt;Die.Type&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits: List&lt;Trait&gt; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VillainTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits: List&lt;Trait&gt; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E deixe o gerador criar n√£o apenas objetos individuais, mas tamb√©m decks inteiros com eles. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateVillain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">VillainTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Villain().apply { name = template.name description = template.description template.traits.forEach { addTrait(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateEnemy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">EnemyTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Enemy().apply { name = template.name description = template.description template.traits.forEach { addTrait(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateObstacle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ObstacleTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Obstacle(template.tier, *template.dieTypes).apply { name = template.name description = template.description template.traits.forEach { addTrait(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateEnemyDeck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(types: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Collection</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">EnemyTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, limit: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: Deck&lt;Enemy&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deck = types .map { generateEnemy(it) } .shuffled() .fold(Deck&lt;Enemy&gt;()) { d, c -&gt; d.addToTop(c); d } limit?.let { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (deck.size &gt; it) deck.drawFromTop() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deck } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateObstacleDeck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(templates: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Collection</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ObstacleTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, limit: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: Deck&lt;Obstacle&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deck = templates .map { generateObstacle(it) } .shuffled() .fold(Deck&lt;Obstacle&gt;()) { d, c -&gt; d.addToTop(c); d } limit?.let { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (deck.size &gt; it) deck.drawFromTop() } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deck }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se houver mais cartas no baralho do que precisamos (par√¢metro </font></font><code>limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), as removeremos de l√°. </font><font style="vertical-align: inherit;">Sendo capaz de gerar sacolas com cubos e baralhos de cartas, finalmente podemos criar terrenos:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LocationTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Location().apply { name = template.name description = template.description bag = generateBag(template.bagTemplate, level) closingDifficulty = template.basicClosingDifficulty + level * <span class="hljs-number"><span class="hljs-number">2</span></span> enemies = generateEnemyDeck(template.enemyCardPool, template.enemyCardsCount) obstacles = generateObstacleDeck(template.obstacleCardPool, template.obstacleCardsCount) template.specialRules.forEach { addSpecialRule(it) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> O terreno que definimos explicitamente no c√≥digo no in√≠cio do cap√≠tulo agora ter√° uma apar√™ncia completamente diferente: </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeLocationTemplate</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LocationTemplate { override val name = "Some location" override val description = "Some description" override val bagTemplate = BagTemplate</span></span></span></span>().apply { addPlan(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, SingleDieTypeFilter(Die.Type.PHYSICAL)) addPlan(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, SingleDieTypeFilter(Die.Type.SOMATIC)) addPlan(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.MENTAL)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, MultipleDieTypeFilter(Die.Type.ENEMY, Die.Type.OBSTACLE)) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> basicClosingDifficulty = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardsCount = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardsCount = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardPool = listOf( SomeEnemyTemplate(), OtherEnemyTemplate() ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardPool = listOf( SomeObstacleTemplate() ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules = emptyList&lt;SpecialRule&gt;() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeEnemyTemplate</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EnemyTemplate { override val name = "Some enemy" override val description = "Some description" override val traits = emptyList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Trait</span></span></span><span class="hljs-class">&gt;</span></span>() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OtherEnemyTemplate</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EnemyTemplate { override val name = "Other enemy" override val description = "Some description" override val traits = emptyList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Trait</span></span></span><span class="hljs-class">&gt;</span></span>() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeObstacleTemplate</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ObstacleTemplate { override val name = "Some obstacle" override val description = "Some description" override val traits = emptyList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Trait</span></span></span><span class="hljs-class">&gt;</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tier = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieTypes = arrayOf( Die.Type.PHYSICAL, Die.Type.VERBAL ) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> location = generateLocation(SomeLocationTemplate(), <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A gera√ß√£o do cen√°rio ocorrer√° de maneira semelhante. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScenarioTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> description: String <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialTimer: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> staticLocations: List&lt;LocationTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dynamicLocationsPool: List&lt;LocationTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> villains: List&lt;VillainTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules: List&lt;SpecialRule&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateDynamicLocationsCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(numberOfHeroes: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = numberOfHeroes + <span class="hljs-number"><span class="hljs-number">2</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De acordo com as regras, o n√∫mero de locais gerados dinamicamente depende do n√∫mero de her√≥is. </font><font style="vertical-align: inherit;">A interface define uma fun√ß√£o de c√°lculo padr√£o, que, se desejado, pode ser redefinida em implementa√ß√µes espec√≠ficas. </font><font style="vertical-align: inherit;">Em conex√£o com esse requisito, o gerador de cen√°rios tamb√©m gerar√° terreno para esses cen√°rios - no mesmo local os vil√µes ser√£o distribu√≠dos aleatoriamente entre as localidades.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateScenario</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ScenarioTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Scenario().apply { name =template.name description = template.description <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.level = level initialTimer = template.initialTimer template.specialRules.forEach { addSpecialRule(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateLocations</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ScenarioTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, level: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, numberOfHeroes: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;Location&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> locations = template.staticLocations.map { generateLocation(it, level) } + template.dynamicLocationsPool .map { generateLocation(it, level) } .shuffled() .take(template.calculateDynamicLocationsCount(numberOfHeroes)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> villains = template.villains .map(::generateVillain) .shuffled() locations.forEachIndexed { index, location -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &lt; villains.size) { location.villain = villains[index] location.bag.put(generateDie(SingleDieTypeFilter(Die.Type.VILLAIN), level)) } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> locations }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muitos leitores atentos objetam que os modelos precisam ser armazenados n√£o no c√≥digo fonte das classes, mas em alguns arquivos de texto (scripts), para que mesmo aqueles longe da programa√ß√£o possam cri√°-los e mant√™-los. </font><font style="vertical-align: inherit;">Concordo, tiro o chap√©u, mas n√£o aspiro cinzas na cabe√ßa - pois um n√£o interfere no outro. </font><font style="vertical-align: inherit;">Se desejar, basta definir uma implementa√ß√£o especial do modelo, cujos valores de propriedade ser√£o carregados de um arquivo externo. </font><font style="vertical-align: inherit;">O processo de gera√ß√£o n√£o mudar√° nem um pouco disso. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bem, parece que eles n√£o esqueceram nada ... Ah, sim, her√≥is - eles tamb√©m precisam ser gerados, o que significa que tamb√©m precisam de seus pr√≥prios modelos. </font><font style="vertical-align: inherit;">Aqui est√£o alguns, por exemplo:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HeroTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Hero.Type <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialHandCapacity: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> favoredDieType: Die.Type <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialDice: Collection&lt;Die&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialSkills: List&lt;SkillTemplate&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dormantSkills: List&lt;SkillTemplate&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDiceCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Pair&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;? }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E imediatamente notamos duas esquisitices. </font><font style="vertical-align: inherit;">Em primeiro lugar, n√£o usamos modelos para gerar sacolas e cubos neles.</font></font> Porque       ()       ‚Äî      . -, <code>getDiceCount()</code> ‚Äî      ??? ,    <code>DiceLimit</code> ,    .         ,     .    : <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BrawlerHeroTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HeroTemplate { override val type = Hero.Type.BRAWLER override val favoredDieType = PHYSICAL override val initialHandCapacity = 4 override val initialDice = listOf</span></span></span></span>( Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(VERBAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(VERBAL, <span class="hljs-number"><span class="hljs-number">4</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDiceCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (type) { PHYSICAL -&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> to <span class="hljs-number"><span class="hljs-number">12</span></span> SOMATIC -&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> to <span class="hljs-number"><span class="hljs-number">7</span></span> MENTAL -&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">2</span></span> VERBAL -&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> to <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialSkills = listOf( HitSkillTemplate() ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dormantSkills = listOf&lt;SkillTemplate&gt;() } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HunterHeroTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">HeroTemplate { override val type = Hero.Type.HUNTER override val favoredDieType = SOMATIC override val initialHandCapacity = 5 override val initialDice = listOf</span></span></span></span>( Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(SOMATIC, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">6</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(MENTAL, <span class="hljs-number"><span class="hljs-number">4</span></span>), Die(VERBAL, <span class="hljs-number"><span class="hljs-number">4</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDiceCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (type) { PHYSICAL -&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> to <span class="hljs-number"><span class="hljs-number">5</span></span> SOMATIC -&gt; <span class="hljs-number"><span class="hljs-number">7</span></span> to <span class="hljs-number"><span class="hljs-number">11</span></span> MENTAL -&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> to <span class="hljs-number"><span class="hljs-number">7</span></span> VERBAL -&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> initialSkills = listOf( ShootSkillTemplate() ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dormantSkills = listOf&lt;SkillTemplate&gt;() }</code> </pre><br>     ,    . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SkillTemplate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Skill.Type <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> maxLevel: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> modifier1: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> modifier2: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> isActive <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HitSkillTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SkillTemplate { override val type = Skill.Type.HIT override val maxLevel = 3 override val modifier1 = +1 override val modifier2 = +3 } class ShootSkillTemplate : SkillTemplate { override val type = Skill.Type.SHOOT override val maxLevel = 3 override val modifier1 = +0 override val modifier2 = +2 }</span></span></span></span></code> </pre><br>  ,     ,    ,   .       ,       ‚Äî       . ,     ,      .     ,  . <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateSkill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SkillTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">, initialLevel: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Skill { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> skill = Skill(template.type) skill.isActive = template.isActive skill.level = initialLevel skill.maxLevel = template.maxLevel skill.modifier1 = template.modifier1 skill.modifier2 = template.modifier2 <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> skill } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateHero</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">, name: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Hero { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> template = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (type) { BRAWLER -&gt; BrawlerHeroTemplate() HUNTER -&gt; HunterHeroTemplate() } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hero = Hero(type) hero.name = name hero.isAlive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> hero.favoredDieType = template.favoredDieType hero.hand.capacity = template.initialHandCapacity template.initialDice.forEach { hero.bag.put(it) } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ((t, l) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Die.Type.values().map { it to template.getDiceCount(it) }) { l?.let { hero.addDiceLimit(DiceLimit(t, it.first, it.second, it.first)) } } template.initialSkills .map { generateSkill(it) } .forEach { hero.addSkill(it) } template.dormantSkills .map { generateSkill(it, <span class="hljs-number"><span class="hljs-number">0</span></span>) } .forEach { hero.addDormantSkill(it) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hero }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apenas alguns momentos s√£o impressionantes. </font><font style="vertical-align: inherit;">Primeiramente, o pr√≥prio m√©todo de gera√ß√£o seleciona o modelo desejado, dependendo da classe do her√≥i. </font><font style="vertical-align: inherit;">Em segundo lugar, n√£o √© necess√°rio especificar um nome imediatamente (√†s vezes no est√°gio de gera√ß√£o ainda n√£o o saberemos). </font><font style="vertical-align: inherit;">Em terceiro lugar, Kotlin trouxe uma quantidade sem precedentes de a√ß√∫car sint√°tico, que alguns desenvolvedores abusam irracionalmente. </font><font style="vertical-align: inherit;">E nem um pouco envergonhado.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passo Oito. </font><font style="vertical-align: inherit;">Ciclo de jogo</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finalmente, chegamos ao mais interessante - a implementa√ß√£o do ciclo do jogo. </font><font style="vertical-align: inherit;">Em termos simples, eles come√ßaram a "fazer o jogo". </font><font style="vertical-align: inherit;">Muitos desenvolvedores iniciantes geralmente iniciam precisamente a partir desse est√°gio, al√©m da cria√ß√£o de jogos, tudo o mais. </font><font style="vertical-align: inherit;">Especialmente todos os tipos de pequenos esquemas sem sentido para desenhar, pfff ... Mas n√£o vamos nos apressar (ainda est√° longe da manh√£) e, portanto, um pouco mais de modelagem. </font><font style="vertical-align: inherit;">Sim de novo.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gr√°fico de atividades</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/up/tm/6t/uptm6t8obpw80m3_cr1i6b9q62e.png"></a> <br></div></div><br>  ,         ,    .      ,   (       )      .      (,       ) ‚Äî    ?     ,     -  . ,      ‚Äî ,    .       ,       ,  .       ,     ,    .     .     ‚Äî    ,     ,    (  ‚Äî ,   ‚Äî    <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dos seus</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sonhos). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, a primeira coisa a fazer √© decidir de quais objetos precisamos. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Her√≥is O script. Locais.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> J√° revisamos o processo de sua cria√ß√£o - n√£o o repetiremos. Apenas observamos o padr√£o de terreno que usaremos em nosso pequeno exemplo.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestLocationTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LocationTemplate { override val name = "Test" override val description = "Some Description" override val basicClosingDifficulty = 0 override val enemyCardsCount = 0 override val obstacleCardsCount = 0 override val bagTemplate = BagTemplate</span></span></span></span>().apply { addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.PHYSICAL)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.SOMATIC)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.MENTAL)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.VERBAL)) addPlan(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, SingleDieTypeFilter(Die.Type.DIVINE)) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyCardPool = emptyList&lt;EnemyTemplate&gt;() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> obstacleCardPool = emptyList&lt;ObstacleTemplate&gt;() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> specialRules = emptyList&lt;SpecialRule&gt;() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como voc√™ pode ver, na bolsa existem apenas cubos "positivos" - azul, verde, roxo, amarelo e azul. N√£o h√° inimigos e obst√°culos na √°rea, vil√µes e feridas n√£o s√£o encontradas. Tamb√©m n√£o h√° regras especiais - sua implementa√ß√£o √© muito secund√°ria. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pilha para cubos retidos.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ou uma pilha de dissuas√£o. Como colocamos os cubos azuis na sacola do terreno, eles podem ser usados ‚Äã‚Äãem cheques e ap√≥s o uso, mantidos em uma pilha especial. Uma inst√¢ncia da classe √© √∫til para isso </font></font><code>Pile</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modificadores.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ou seja, os valores num√©ricos que precisam ser adicionados ou subtra√≠dos do resultado do rolo de matriz. Voc√™ pode implementar um modificador global ou um modificador separado para cada cubo. Escolheremos a segunda op√ß√£o (com mais clareza), portanto, criaremos uma classe simples </font></font><code>DiePair</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiePair</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> die: Die, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> modifier: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A localiza√ß√£o dos caracteres na √°rea.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> De uma maneira boa, esse momento precisa ser rastreado usando uma estrutura especial. Por exemplo, mapas da forma em </font></font><code>Map&lt;Location, List&lt;Hero&gt;&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que cada localidade conter√° uma lista de her√≥is atualmente nela (bem como um m√©todo para o oposto - determinar a localidade em que um her√≥i espec√≠fico est√° localizado). Se voc√™ decidir seguir esse caminho, n√£o esque√ßa de adicionar </font></font><code>Location</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©todos √† </font><font style="vertical-align: inherit;">classe de </font><font style="vertical-align: inherit;">implementa√ß√£o </font></font><code>equals()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>hashCode()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, espero, n√£o seja necess√°rio explicar o porqu√™. N√£o vamos perder tempo com isso, j√° que a √°rea √© apenas uma e os her√≥is n√£o a deixam em lugar nenhum. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verificando as m√£os do her√≥i.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No processo do jogo, os her√≥is precisam passar constantemente por verifica√ß√µes (descritas a seguir), ou seja, pegar cubos da m√£o, jog√°-los (adicionar modificadores), agregar os resultados se houver v√°rios cubos (resumir, pegar o m√°ximo / m√≠nimo, m√©dia etc.), compar√°-los com o arremesso outro cubo (um que √© removido da bolsa da √°rea) e, dependendo do resultado, execute as seguintes a√ß√µes. Mas, antes de tudo, √© necess√°rio entender se o her√≥i √©, em princ√≠pio, capaz de passar no teste, isto √©, se ele tem os cubos necess√°rios na m√£o. Para isso, fornecemos uma interface simples </font></font><code>HandFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HandFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hand: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hand</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implementa√ß√µes de interface √© recebida no bra√ßo de entrada do her√≥i (o objecto de classe </font></font><code>Hand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) e de regresso </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de acordo com os resultados do teste. Para o nosso fragmento do jogo, precisamos de uma √∫nica implementa√ß√£o: se um cubo azul, verde, roxo ou amarelo for encontrado, precisamos determinar se a m√£o do her√≥i tem um cubo da mesma cor.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleDieHandFilter</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">vararg</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types: Die.Type) : HandFilter { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hand: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hand</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (<span class="hljs-number"><span class="hljs-number">0</span></span> until hand.dieCount).mapNotNull { hand.dieAt(it) }.any { it.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types } || (Die.Type.ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types &amp;&amp; hand.allyDieCount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim, funcionalismo novamente. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Itens ativos / selecionados.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agora que garantimos que a m√£o do her√≥i √© adequada para a realiza√ß√£o do teste, √© necess√°rio que o jogador escolha da m√£o que dados (ou cubos) com os quais ele passar√° no teste. Primeiro, voc√™ precisa destacar (destacar) as posi√ß√µes apropriadas (nas quais existem cubos do tipo desejado). Em segundo lugar, voc√™ precisa marcar de alguma forma os cubos selecionados. Para ambos os requisitos, √© adequada uma classe </font></font><code>HandMask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que, de fato, cont√©m um conjunto de n√∫meros inteiros (n√∫mero de posi√ß√µes selecionadas) e m√©todos para adicion√°-los e remov√™-los.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HandMask</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> positions = mutableSetOf&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allyPositions = mutableSetOf&lt;<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> positionCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = positions.size <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allyPositionCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = allyPositions.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = positions.add(position) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removePosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = positions.remove(position) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addAllyPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = allyPositions.add(position) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeAllyPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = allyPositions.remove(position) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = position <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> positions <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkAllyPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = position <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> allyPositions <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switchPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!removePosition(position)) { addPosition(position) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">switchAllyPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!removeAllyPosition(position)) { addAllyPosition(position) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { positions.clear() allyPositions.clear() } }</code> </pre><br>   ,     ¬´¬ª       ? -             .   -  ,      (,   ,         ‚Äî   -     ) ‚Äî    . <br><br> ,          ( <code>PileMask</code> ),        . <br><br> <b>   .</b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas n√£o basta "destacar" posi√ß√µes aceit√°veis; √© importante alterar esse "destaque" no processo de escolha de cubos. Ou seja, se um jogador precisar retirar apenas um dado da m√£o, ao escolher esse dado, todas as outras posi√ß√µes dever√£o ficar inacess√≠veis. Al√©m disso, em cada est√°gio, √© necess√°rio controlar o cumprimento do objetivo do jogador - ou seja, entender se os cubos selecionados s√£o suficientes para passar em um ou outro teste. Uma tarefa t√£o dif√≠cil requer uma inst√¢ncia complexa de uma classe complexa.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HandMaskRule</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hand: Hand) { <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAllyPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCheckedDice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;Die&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((<span class="hljs-number"><span class="hljs-number">0</span></span> until hand.dieCount).filter(mask::checkPosition).map(hand::dieAt)) .plus((<span class="hljs-number"><span class="hljs-number">0</span></span> until hand.allyDieCount).filter(mask::checkAllyPosition).map(hand::allyDieAt)) .filterNotNull() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L√≥gica bastante complicada, entenderei e perdoarei voc√™ se essa classe for incompreens√≠vel para voc√™. E ainda tenta explicar. As implementa√ß√µes dessa classe sempre armazenam uma refer√™ncia √† m√£o (objeto </font></font><code>Hand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) com a qual elas ir√£o lidar. Cada um dos m√©todos recebe uma m√°scara ( </font></font><code>HandMask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), que reflete o estado atual da sele√ß√£o (quais posi√ß√µes s√£o selecionadas pelo jogador e quais n√£o s√£o). O m√©todo </font></font><code>checkMask()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">relata se os cubos selecionados s√£o suficientes para passar no teste. O m√©todo </font></font><code>isPositionActive()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">diz se √© necess√°rio destacar uma posi√ß√£o espec√≠fica - se √© poss√≠vel adicionar um cubo nessa posi√ß√£o ao teste (ou remover um cubo que j√° esteja selecionado). O m√©todo </font></font><code>isAllyPositionActive()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© o mesmo para dados brancos (sim, eu sei, sou um idiota). Bem e o m√©todo auxiliar</font></font><code>getCheckedDice()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simplesmente retorna uma lista de todos os cubos da m√£o que correspondem √† m√°scara - isso √© necess√°rio para peg√°-los todos de uma vez, jog√°-los na mesa e aproveitar a batida engra√ßada, com a qual eles se espalham em diferentes dire√ß√µes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos precisar de duas realiza√ß√µes dessa classe abstrata (surpresa, surpresa!). O primeiro controla o processo de aprova√ß√£o no teste ao adquirir um novo cubo de um tipo espec√≠fico (n√£o branco). Como voc√™ se lembra, qualquer n√∫mero de cubos azuis pode ser adicionado a essa verifica√ß√£o.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StatDieAcquireHandMaskRule</span></span></span></span>(hand: Hand, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> requiredType: Die.Type) : HandMaskRule(hand) { <span class="hljs-comment"><span class="hljs-comment">/** * Define how many dice of specified type are currently checked */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkedDieCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (<span class="hljs-number"><span class="hljs-number">0</span></span> until hand.dieCount) .filter(mask::checkPosition) .mapNotNull(hand::dieAt) .count { it.type === requiredType } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (mask.allyPositionCount == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; checkedDieCount(mask) == <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = with(hand.dieAt(position)) { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { mask.checkPosition(position) -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == <span class="hljs-literal"><span class="hljs-literal">null</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type === Die.Type.DIVINE -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type === requiredType &amp;&amp; checkedDieCount(mask) &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAllyPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A segunda implementa√ß√£o √© mais complicada. Ela controla a rolagem no final do turno. Nesse caso, duas op√ß√µes s√£o poss√≠veis. Se o n√∫mero de cubos na m√£o exceder seu tamanho m√°ximo permitido (capacidade), devemos descartar todos os cubos extras mais qualquer n√∫mero de cubos adicionais (se quisermos). Se o tamanho n√£o for excedido, n√£o ser√° poss√≠vel redefinir nada (ou redefinir, se desejado). Em nenhum caso os dados cinzentos podem ser descartados.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiscardExtraDiceHandMaskRule</span></span></span></span>(hand: Hand) : HandMaskRule(hand) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> minDiceToDiscard = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hand.dieCount &gt; hand.capacity) min(hand.dieCount - hand.woundCount, hand.dieCount - hand.capacity) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> maxDiceToDiscard = hand.dieCount - hand.woundCount <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = (mask.positionCount <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> minDiceToDiscard..maxDiceToDiscard) &amp;&amp; (mask.allyPositionCount <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>..hand.allyDieCount) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { mask.checkPosition(position) -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> hand.dieAt(position) == <span class="hljs-literal"><span class="hljs-literal">null</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> hand.dieAt(position)!!.type == Die.Type.WOUND -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> mask.positionCount &lt; maxDiceToDiscard -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAllyPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = hand.allyDieAt(position) != <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nezhdanchik: </font></font><code>Hand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma propriedade apareceu de repente </font><font style="vertical-align: inherit;">na classe </font></font><code>woundCount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que n√£o existia antes. Voc√™ pode escrever sua implementa√ß√£o, √© f√°cil. Pratique ao mesmo tempo. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passando cheques.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Finalmente cheguei a eles. Quando os dados s√£o retirados da m√£o, √© hora de jog√°-los. Para cada cubo √© necess√°rio considerar: seu tamanho, seus modificadores, o resultado de seu lan√ßamento. Embora apenas um cubo possa ser retirado da sacola de cada vez, v√°rios dados podem ser jogados contra ela, agregando os resultados de seus testes. Em geral, vamos abstrair dos dados e representar as tropas no campo de batalha. Por um lado, temos um inimigo - ele √© apenas um, mas √© forte e feroz. Por outro lado, um oponente igual em for√ßa a ele, mas com apoio. O resultado da batalha ser√° decidido em um curto conflito, o vencedor pode ser apenas um ...</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desculpe, empolgado. Para simular nossa batalha geral, implementamos uma classe especial.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DieBattleCheck</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> method: Method, opponent: DiePair? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Method</span></span></span><span class="hljs-class"> </span></span>{ SUM, AVG_UP, AVG_DOWN, MAX, MIN } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Wrap</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pair: DiePair, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> roll: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">infix</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> DiePair.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(roll: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Wrap(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, roll) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> opponent: Wrap? = opponent?.with(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroics = ArrayList&lt;Wrap&gt;() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isRolled = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroPairCount <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = heroics.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOpponentPair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = opponent?.pair <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOpponentResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { isRolled -&gt; opponent?.roll ?: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Not rolled yet"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addHeroPair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pair: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DiePair</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method == Method.SUM &amp;&amp; heroics.size &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { pair.modifier = <span class="hljs-number"><span class="hljs-number">0</span></span> } heroics.add(pair with <span class="hljs-number"><span class="hljs-number">0</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addHeroPair</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(die: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Die</span></span></span></span><span class="hljs-function"><span class="hljs-params">, modifier: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = addHeroPair(DiePair(die, modifier)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearHeroPairs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = heroics.clear() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHeroPairAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = heroics[index].pair <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHeroResultAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { isRolled -&gt; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { (index <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> until heroics.size) -&gt; heroics[index].roll <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Not rolled yet"</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">roll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">roll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(wrap: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Wrap</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { wrap.roll = wrap.pair.die.roll() } isRolled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> opponent?.let { roll(it) } heroics.forEach { roll(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isRolled) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Not rolled yet"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> opponentResult = opponent?.let { it.roll + it.pair.modifier } ?: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> stats = heroics.map { it.roll + it.pair.modifier } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroResult = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (method) { DieBattleCheck.Method.SUM -&gt; stats.sum() DieBattleCheck.Method.AVG_UP -&gt; ceil(stats.average()).toInt() DieBattleCheck.Method.AVG_DOWN -&gt; floor(stats.average()).toInt() DieBattleCheck.Method.MAX -&gt; stats.max() ?: <span class="hljs-number"><span class="hljs-number">0</span></span> DieBattleCheck.Method.MIN -&gt; stats.min() ?: <span class="hljs-number"><span class="hljs-number">0</span></span> } result = heroResult - opponentResult } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como cada cubo pode ter um modificador, armazenaremos dados em objetos </font></font><code>DiePair</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Parece ser. Na verdade, n√£o, porque al√©m do cubo e do modificador, voc√™ tamb√©m precisa armazenar o resultado de seu lan√ßamento (lembre-se, embora o pr√≥prio cubo gere esse valor, ele n√£o o armazena entre suas propriedades). Portanto, envolva cada par em um inv√≥lucro ( </font></font><code>Wrap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). Preste aten√ß√£o ao m√©todo infix </font></font><code>with</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, hehe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O construtor da classe define o m√©todo de agrega√ß√£o (uma inst√¢ncia da enumera√ß√£o interna </font></font><code>Method</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) e o oponente (que pode n√£o existir). A lista de cubos de her√≥is √© formada usando os m√©todos apropriados. Ele tamb√©m fornece v√°rios m√©todos para envolver os pares no teste e os resultados de seus lances (se houver). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo</font></font><code>roll()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chama o m√©todo com o mesmo nome de cada cubo, salva os resultados intermedi√°rios e marca o fato de sua execu√ß√£o com um sinalizador </font></font><code>isRolled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Observe que o resultado final do lan√ßamento n√£o √© calculado imediatamente - existe um m√©todo especial para isso </font></font><code>calculateResult()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, cujo resultado √© gravar o valor final na propriedade </font></font><code>result</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Por que isso √© necess√°rio? Para um efeito dram√°tico. O m√©todo </font></font><code>roll()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser√° executado v√°rias vezes, sempre nas faces dos cubos diferentes valores ser√£o exibidos (como na vida real). E somente quando os cubos se acalmam em cima da mesa, aprendemos </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nosso destino como</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> resultado final (a diferen√ßa entre os valores dos cubos do her√≥i e os cubos do oponente). Para aliviar o estresse, direi que um resultado de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ser√° considerado uma aprova√ß√£o bem-sucedida do teste.</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O estado do mecanismo do jogo.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Objetos sofisticados resolvidos, agora as coisas s√£o mais simples. N√£o ser√° uma grande descoberta dizer que precisamos controlar o "progresso" atual do mecanismo de jogo, o est√°gio ou a fase em que ele est√° localizado. Uma enumera√ß√£o especial √© √∫til para isso.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GamePhase</span></span></span><span class="hljs-class"> </span></span>{ SCENARIO_START, HERO_TURN_START, HERO_TURN_END, LOCATION_BEFORE_EXPLORATION, LOCATION_ENCOUNTER_STAT, LOCATION_ENCOUNTER_DIVINE, LOCATION_AFTER_EXPLORATION, GAME_LOSS }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na verdade, existem mais fases, mas selecionamos apenas as que s√£o usadas em nosso exemplo. Para alterar a fase do mecanismo do jogo, usaremos m√©todos </font></font><code>changePhaseX()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, onde </font></font><code>X</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© o valor da lista acima. Nesses m√©todos, todas as vari√°veis ‚Äã‚Äãinternas do mecanismo ser√£o reduzidas a valores adequados para o in√≠cio da fase correspondente, mas mais sobre isso posteriormente. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mensagens</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Manter o estado do mecanismo de jogo n√£o √© suficiente. Tamb√©m √© importante que o usu√°rio informe-o de alguma forma - caso contr√°rio, como ele saber√° o que est√° acontecendo na tela? √â por isso que precisamos de outra listagem.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StatusMessage</span></span></span><span class="hljs-class"> </span></span>{ EMPTY, CHOOSE_DICE_PERFORM_CHECK, END_OF_TURN_DISCARD_EXTRA, END_OF_TURN_DISCARD_OPTIONAL, CHOOSE_ACTION_BEFORE_EXPLORATION, CHOOSE_ACTION_AFTER_EXPLORATION, ENCOUNTER_PHYSICAL, ENCOUNTER_SOMATIC, ENCOUNTER_MENTAL, ENCOUNTER_VERBAL, ENCOUNTER_DIVINE, DIE_ACQUIRE_SUCCESS, DIE_ACQUIRE_FAILURE, GAME_LOSS_OUT_OF_TIME }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como voc√™ pode ver, todos os estados poss√≠veis do nosso exemplo s√£o descritos pelos valores dessa enumera√ß√£o. Para cada um deles, √© fornecida uma linha de texto, que ser√° exibida na tela (exceto </font></font><code>EMPTY</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- este √© um significado especial), mas aprenderemos sobre isso um pouco mais tarde. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ac√ß√µes</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para comunica√ß√£o entre o usu√°rio e o mecanismo do jogo, mensagens simples n√£o s√£o suficientes. Tamb√©m √© importante informar a primeira das a√ß√µes que ele pode executar no momento (pesquisar, ultrapassar os bloqueios, concluir a jogada - tudo bem). Para isso, desenvolveremos uma aula especial.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Action</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: Type, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isEnabled: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Type</span></span></span><span class="hljs-class"> </span></span>{ NONE, <span class="hljs-comment"><span class="hljs-comment">//Blank type CONFIRM, //Confirm some action CANCEL, //Cancel action HAND_POSITION, //Some position in hand HAND_ALLY_POSITION, //Some ally position in hand EXPLORE_LOCATION, //Explore current location FINISH_TURN, //Finish current turn ACQUIRE, //Acquire (DIVINE) die FORFEIT, //Remove die from game HIDE, //Put die into bag DISCARD, //Put die to discard pile } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma enumera√ß√£o interna </font></font><code>Type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descreve o tipo de a√ß√£o executada. O campo √© </font></font><code>isEnabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">necess√°rio para exibir a√ß√µes em um estado inativo. Ou seja, relatar que essa a√ß√£o geralmente est√° dispon√≠vel, mas no momento, por algum motivo, n√£o pode ser executada (essa exibi√ß√£o √© muito mais informativa do que quando a a√ß√£o n√£o √© exibida). A propriedade </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(necess√°ria para alguns tipos de a√ß√µes) armazena um valor especial que comunica alguns detalhes adicionais (por exemplo, o √≠ndice da posi√ß√£o selecionada pelo usu√°rio ou o n√∫mero do item selecionado da lista). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klas</font></font><code>Action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© a principal "interface" entre o mecanismo do jogo e os sistemas de entrada e sa√≠da (sobre os quais abaixo). </font><font style="vertical-align: inherit;">Como geralmente existem v√°rias a√ß√µes (caso contr√°rio, por que escolher?), Elas ser√£o combinadas em grupos (listas). </font><font style="vertical-align: inherit;">Em vez de usar cole√ß√µes padr√£o, escreveremos nossa pr√≥pria cole√ß√£o estendida.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionList</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Iterable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Action</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> actions = mutableListOf&lt;Action&gt;() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> size <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = actions.size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ActionList { actions.add(action) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">, enabled: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ActionList { add(Action(type, enabled)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ActionList { actions.forEach { add(it) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ActionList { actions.removeIf { it.type == type } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(index: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = actions[index] <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = actions.find { it.type == type } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">iterator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Iterator&lt;Action&gt; = ActionListIterator() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionListIterator</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Iterator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Action</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> position = -<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = (actions.size &gt; position + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = actions[++position] } <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> EMPTY <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() = ActionList() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A classe cont√©m muitos m√©todos diferentes para adicionar e remover a√ß√µes da lista (que podem ser encadeados), al√©m de obter tanto por √≠ndice quanto por tipo (observe a ‚Äúsobrecarga‚Äù </font></font><code>get()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- o operador de colchete √© aplic√°vel √† nossa lista). </font><font style="vertical-align: inherit;">A implementa√ß√£o da interface </font></font><code>Iterator</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nos permite fazer </font><font style="vertical-align: inherit;">v√°rias manipula√ß√µes de fluxo (funcionalidade, aha) </font><font style="vertical-align: inherit;">com </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todos os tipos de</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> classe de </font><s><font style="vertical-align: inherit;">merda</font></s><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Um valor VAZIO tamb√©m √© fornecido para criar rapidamente uma lista vazia. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telas.</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por fim, outra lista que descreve os v√°rios tipos de conte√∫do atualmente sendo exibidos ... Voc√™ olha para mim e pisca os olhos, eu sei. Quando comecei a pensar em como descrever com mais clareza essa aula, bati minha cabe√ßa na mesa, porque n√£o conseguia entender nada. Entenda a si mesmo, espero.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GameScreen</span></span></span><span class="hljs-class"> </span></span>{ HERO_TURN_START, LOCATION_INTERIOR, GAME_LOSS }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selecionados apenas aqueles usados ‚Äã‚Äãno exemplo. Um m√©todo de renderiza√ß√£o separado ser√° fornecido para cada um deles ... eu novamente explico inexplicavelmente. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Display" e "input".</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E agora finalmente chegamos ao ponto mais importante - a intera√ß√£o do mecanismo de jogo com o usu√°rio (jogador). Se uma introdu√ß√£o t√£o longa ainda n√£o o aborreceu, √© prov√°vel que voc√™ se lembre de que concordamos em separar funcionalmente essas duas partes uma da outra. Portanto, em vez de uma implementa√ß√£o espec√≠fica do sistema de E / S, forneceremos apenas uma interface. Mais precisamente, dois. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeira interface</font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, projetado para exibir imagens na tela. Lembro que abstra√≠mos de tamanhos de tela, de bibliotecas gr√°ficas espec√≠ficas etc. Simplesmente enviamos o comando: "desenhe-me isso" - e aqueles de voc√™s que entenderam nossa conversa arrastada sobre telas j√° imaginaram que cada uma dessas telas tem seu pr√≥prio m√©todo dentro da interface.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GameRenderer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHeroTurnStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hero: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawLocationInteriorScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( location: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Location</span></span></span></span><span class="hljs-function"><span class="hljs-params">, heroesAtLocation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, timer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, currentHero: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">, battleCheck: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DieBattleCheck</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, encounteredDie: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">DiePair</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, pickedDice: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, activePositions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, statusMessage: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">StatusMessage</span></span></span></span><span class="hljs-function"><span class="hljs-params">, actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawGameLoss</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">StatusMessage</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acho que n√£o h√° necessidade de explica√ß√µes adicionais aqui - o objetivo de todos os objetos transferidos √© discutido em detalhes acima. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para entrada do usu√°rio, implementamos uma interface diferente - </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(sim, os scripts de verifica√ß√£o ortogr√°fica sempre enfatizam sempre essa palavra, embora pare√ßa ...). Seus m√©todos solicitar√£o ao jogador os comandos necess√°rios para v√°rias situa√ß√µes: selecione uma a√ß√£o da lista de propostas, selecione um elemento da lista, selecione cubos da m√£o, apenas pelo menos pressione alguma coisa, etc. Deve-se notar imediatamente que a entrada ocorre de forma s√≠ncrona (o jogo √© passo a passo), ou seja, a execu√ß√£o do loop do jogo √© suspensa at√© que o usu√°rio responda √† solicita√ß√£o.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GameInteractor</span></span></span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">anyInput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickDiceFromHand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(activePositions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre o √∫ltimo m√©todo um pouco mais. </font><font style="vertical-align: inherit;">Como o nome indica, from convida o usu√°rio a selecionar cubos da m√£o, fornecendo um objeto </font></font><code>HandMask</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- o n√∫mero de posi√ß√µes ativas. </font><font style="vertical-align: inherit;">A execu√ß√£o do m√©todo continuar√° at√© que alguns deles sejam selecionados - nesse caso, o m√©todo retornar√° uma a√ß√£o do tipo </font></font><code>HAND_POSITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ou </font></font><code>HAND_ALLY_POSITION</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mda) com o n√∫mero da posi√ß√£o selecionada no campo </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Al√©m disso, √© poss√≠vel selecionar outra a√ß√£o (por exemplo, </font></font><code>CONFIRM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>CANCEL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) do objeto </font></font><code>ActionList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">As implementa√ß√µes dos m√©todos de entrada devem distinguir entre situa√ß√µes em que o campo est√° </font></font><code>isEnabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definido </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e ignorar a entrada do usu√°rio de tais a√ß√µes. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Classe de mecanismo de jogo. </font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examinamos tudo o que √© necess√°rio para o trabalho, chegou a hora e o mecanismo para implementar. </font><font style="vertical-align: inherit;">Crie uma turma</font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com o seguinte conte√∫do: </font></font><br><br><div class="spoiler"> <b class="spoiler_title">,     </b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Game</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> renderer: GameRenderer, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> interactor: GameInteractor, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> scenario: Scenario, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> locations: List&lt;Location&gt;, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroes: List&lt;Hero&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timer = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentHeroIndex = -<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentHero: Hero <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentLocation: Location <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> deterrentPile = Pile() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> encounteredDie: DiePair? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> battleCheck: DieBattleCheck? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> activeHandPositions = HandMask() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pickedHandPositions = HandMask() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> phase: GamePhase = GamePhase.SCENARIO_START <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> screen = GameScreen.SCENARIO_INTRO <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> statusMessage = StatusMessage.EMPTY <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> actions: ActionList = ActionList.EMPTY <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (heroes.isEmpty()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Heroes list is empty!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locations.isEmpty()) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"Location list is empty!"</span></span>) heroes.forEach { it.isAlive = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } timer = scenario.initialTimer <span class="hljs-comment"><span class="hljs-comment">//Draw initial hand for each hero heroes.forEach(::drawInitialHand) //First hero turn currentHeroIndex = -1 changePhaseHeroTurnStart() processCycle() } private fun drawInitialHand(hero: Hero) { val hand = hero.hand val favoredDie = hero.bag.drawOfType(hero.favoredDieType) hand.addDie(favoredDie!!) refillHeroHand(hero, false) } private fun refillHeroHand(hero: Hero, redrawScreen: Boolean = true) { val hand = hero.hand while (hand.dieCount &lt; hand.capacity &amp;&amp; hero.bag.size &gt; 0) { val die = hero.bag.draw() hand.addDie(die) if (redrawScreen) { Audio.playSound(Sound.DIE_DRAW) drawScreen() Thread.sleep(500) } } } private fun changePhaseHeroTurnEnd() { battleCheck = null encounteredDie = null phase = GamePhase.HERO_TURN_END //Discard extra dice (or optional dice) val hand = currentHero.hand pickedHandPositions.clear() activeHandPositions.clear() val allowCancel = if (hand.dieCount &gt; hand.capacity) { statusMessage = StatusMessage.END_OF_TURN_DISCARD_EXTRA false } else { statusMessage = StatusMessage.END_OF_TURN_DISCARD_OPTIONAL true } val result = pickDiceFromHand(DiscardExtraDiceHandMaskRule(hand), allowCancel) statusMessage = StatusMessage.EMPTY actions = ActionList.EMPTY if (result) { val discardDice = collectPickedDice(hand) val discardAllyDice = collectPickedAllyDice(hand) pickedHandPositions.clear() (discardDice + discardAllyDice).forEach { die -&gt; Audio.playSound(Sound.DIE_DISCARD) currentHero.discardDieFromHand(die) drawScreen() Thread.sleep(500) } } pickedHandPositions.clear() //Replenish hand refillHeroHand(currentHero) changePhaseHeroTurnStart() } private fun changePhaseHeroTurnStart() { phase = GamePhase.HERO_TURN_START screen = GameScreen.HERO_TURN_START //Tick timer timer-- if (timer &lt; 0) { changePhaseGameLost(StatusMessage.GAME_LOSS_OUT_OF_TIME) return } //Pick next hero do { currentHeroIndex = ++currentHeroIndex % heroes.size currentHero = heroes[currentHeroIndex] } while (!currentHero.isAlive) currentLocation = locations[0] //Setup Audio.playMusic(Music.SCENARIO_MUSIC_1) Audio.playSound(Sound.TURN_START) } private fun changePhaseLocationBeforeExploration() { phase = GamePhase.LOCATION_BEFORE_EXPLORATION screen = GameScreen.LOCATION_INTERIOR encounteredDie = null battleCheck = null pickedHandPositions.clear() activeHandPositions.clear() statusMessage = StatusMessage.CHOOSE_ACTION_BEFORE_EXPLORATION actions = ActionList() actions.add(Action.Type.EXPLORE_LOCATION, checkLocationCanBeExplored(currentLocation)) actions.add(Action.Type.FINISH_TURN) } private fun changePhaseLocationEncounterStatDie() { Audio.playSound(Sound.ENCOUNTER_STAT) phase = GamePhase.LOCATION_ENCOUNTER_STAT screen = GameScreen.LOCATION_INTERIOR battleCheck = null pickedHandPositions.clear() activeHandPositions.clear() statusMessage = when (encounteredDie!!.die.type) { Die.Type.PHYSICAL -&gt; StatusMessage.ENCOUNTER_PHYSICAL Die.Type.SOMATIC -&gt; StatusMessage.ENCOUNTER_SOMATIC Die.Type.MENTAL -&gt; StatusMessage.ENCOUNTER_MENTAL Die.Type.VERBAL -&gt; StatusMessage.ENCOUNTER_VERBAL else -&gt; throw AssertionError("Should not happen") } val canAttemptCheck = checkHeroCanAttemptStatCheck(currentHero, encounteredDie!!.die.type) actions = ActionList() actions.add(Action.Type.HIDE, canAttemptCheck) actions.add(Action.Type.DISCARD, canAttemptCheck) actions.add(Action.Type.FORFEIT) } private fun changePhaseLocationEncounterDivineDie() { Audio.playSound(Sound.ENCOUNTER_DIVINE) phase = GamePhase.LOCATION_ENCOUNTER_DIVINE screen = GameScreen.LOCATION_INTERIOR battleCheck = null pickedHandPositions.clear() activeHandPositions.clear() statusMessage = StatusMessage.ENCOUNTER_DIVINE actions = ActionList() actions.add(Action.Type.ACQUIRE, checkHeroCanAcquireDie(currentHero, Die.Type.DIVINE)) actions.add(Action.Type.FORFEIT) } private fun changePhaseLocationAfterExploration() { phase = GamePhase.LOCATION_AFTER_EXPLORATION screen = GameScreen.LOCATION_INTERIOR encounteredDie = null battleCheck = null pickedHandPositions.clear() activeHandPositions.clear() statusMessage = StatusMessage.CHOOSE_ACTION_AFTER_EXPLORATION actions = ActionList() actions.add(Action.Type.FINISH_TURN) } private fun changePhaseGameLost(message: StatusMessage) { Audio.stopMusic() Audio.playSound(Sound.GAME_LOSS) phase = GamePhase.GAME_LOSS screen = GameScreen.GAME_LOSS statusMessage = message } private fun pickDiceFromHand(rule: HandMaskRule, allowCancel: Boolean = true, onEachLoop: (() -&gt; Unit)? = null): Boolean { //Preparations pickedHandPositions.clear() actions = ActionList().add(Action.Type.CONFIRM, false) if (allowCancel) { actions.add(Action.Type.CANCEL) } val hand = rule.hand while (true) { //Recurring action onEachLoop?.invoke() //Define success condition val canProceed = rule.checkMask(pickedHandPositions) actions[Action.Type.CONFIRM]?.isEnabled = canProceed //Prepare active hand commands activeHandPositions.clear() (0 until hand.dieCount) .filter { rule.isPositionActive(pickedHandPositions, it) } .forEach { activeHandPositions.addPosition(it) } (0 until hand.allyDieCount) .filter { rule.isAllyPositionActive(pickedHandPositions, it) } .forEach { activeHandPositions.addAllyPosition(it) } //Draw current phase drawScreen() //Process interaction result val result = interactor.pickDiceFromHand(activeHandPositions, actions) when (result.type) { Action.Type.CONFIRM -&gt; if (canProceed) { activeHandPositions.clear() return true } Action.Type.CANCEL -&gt; if (allowCancel) { activeHandPositions.clear() pickedHandPositions.clear() return false } Action.Type.HAND_POSITION -&gt; { Audio.playSound(Sound.DIE_PICK) pickedHandPositions.switchPosition(result.data) } Action.Type.HAND_ALLY_POSITION -&gt; { Audio.playSound(Sound.DIE_PICK) pickedHandPositions.switchAllyPosition(result.data) } else -&gt; throw AssertionError("Should not happen") } } } private fun collectPickedDice(hand: Hand) = (0 until hand.dieCount) .filter(pickedHandPositions::checkPosition) .mapNotNull(hand::dieAt) private fun collectPickedAllyDice(hand: Hand) = (0 until hand.allyDieCount) .filter(pickedHandPositions::checkAllyPosition) .mapNotNull(hand::allyDieAt) private fun performStatDieAcquireCheck(shouldDiscard: Boolean): Boolean { //Prepare check battleCheck = DieBattleCheck(DieBattleCheck.Method.SUM, encounteredDie) pickedHandPositions.clear() statusMessage = StatusMessage.CHOOSE_DICE_PERFORM_CHECK val hand = currentHero.hand //Try to pick dice from performer's hand if (!pickDiceFromHand(StatDieAcquireHandMaskRule(currentHero.hand, encounteredDie!!.die.type), true) { battleCheck!!.clearHeroPairs() (collectPickedDice(hand) + collectPickedAllyDice(hand)) .map { DiePair(it, if (shouldDiscard) 1 else 0) } .forEach(battleCheck!!::addHeroPair) }) { battleCheck = null pickedHandPositions.clear() return false } //Remove dice from hand collectPickedDice(hand).forEach { hand.removeDie(it) } collectPickedAllyDice(hand).forEach { hand.removeDie(it) } pickedHandPositions.clear() //Perform check Audio.playSound(Sound.BATTLE_CHECK_ROLL) for (i in 0..7) { battleCheck!!.roll() drawScreen() Thread.sleep(100) } battleCheck!!.calculateResult() val result = battleCheck?.result ?: -1 val success = result &gt;= 0 //Process dice which participated in the check (0 until battleCheck!!.heroPairCount) .map(battleCheck!!::getHeroPairAt) .map(DiePair::die) .forEach { d -&gt; if (d.type === Die.Type.DIVINE) { currentHero.hand.removeDie(d) deterrentPile.put(d) } else { if (shouldDiscard) { currentHero.discardDieFromHand(d) } else { currentHero.hideDieFromHand(d) } } } //Show message to user Audio.playSound(if (success) Sound.BATTLE_CHECK_SUCCESS else Sound.BATTLE_CHECK_FAILURE) statusMessage = if (success) StatusMessage.DIE_ACQUIRE_SUCCESS else StatusMessage.DIE_ACQUIRE_FAILURE actions = ActionList.EMPTY drawScreen() interactor.anyInput() //Clean up battleCheck = null //Resolve consequences of the check if (success) { Audio.playSound(Sound.DIE_DRAW) currentHero.hand.addDie(encounteredDie!!.die) } return true } private fun processCycle() { while (true) { drawScreen() when (phase) { GamePhase.HERO_TURN_START -&gt; { interactor.anyInput() changePhaseLocationBeforeExploration() } GamePhase.GAME_LOSS -&gt; { interactor.anyInput() return } GamePhase.LOCATION_BEFORE_EXPLORATION -&gt; when (interactor.pickAction(actions).type) { Action.Type.EXPLORE_LOCATION -&gt; { val die = currentLocation.bag.draw() encounteredDie = DiePair(die, 0) when (die.type) { Die.Type.PHYSICAL, Die.Type.SOMATIC, Die.Type.MENTAL, Die.Type.VERBAL -&gt; changePhaseLocationEncounterStatDie() Die.Type.DIVINE -&gt; changePhaseLocationEncounterDivineDie() else -&gt; TODO("Others") } } Action.Type.FINISH_TURN -&gt; changePhaseHeroTurnEnd() else -&gt; throw AssertionError("Should not happen") } GamePhase.LOCATION_ENCOUNTER_STAT -&gt; { val type = interactor.pickAction(actions).type when (type) { Action.Type.DISCARD, Action.Type.HIDE -&gt; { performStatDieAcquireCheck(type === Action.Type.DISCARD) changePhaseLocationAfterExploration() } Action.Type.FORFEIT -&gt; { Audio.playSound(Sound.DIE_REMOVE) changePhaseLocationAfterExploration() } else -&gt; throw AssertionError("Should not happen") } } GamePhase.LOCATION_ENCOUNTER_DIVINE -&gt; when (interactor.pickAction(actions).type) { Action.Type.ACQUIRE -&gt; { Audio.playSound(Sound.DIE_DRAW) currentHero.hand.addDie(encounteredDie!!.die) changePhaseLocationAfterExploration() } Action.Type.FORFEIT -&gt; { Audio.playSound(Sound.DIE_REMOVE) changePhaseLocationAfterExploration() } else -&gt; throw AssertionError("Should not happen") } GamePhase.LOCATION_AFTER_EXPLORATION -&gt; when (interactor.pickAction(actions).type) { Action.Type.FINISH_TURN -&gt; changePhaseHeroTurnEnd() else -&gt; throw AssertionError("Should not happen") } else -&gt; throw AssertionError("Should not happen") } } } private fun drawScreen() { when (screen) { GameScreen.HERO_TURN_START -&gt; renderer.drawHeroTurnStart(currentHero) GameScreen.LOCATION_INTERIOR -&gt; renderer.drawLocationInteriorScreen(currentLocation, heroes, timer, currentHero, battleCheck, encounteredDie, null, pickedHandPositions, activeHandPositions, statusMessage, actions) GameScreen.GAME_LOSS -&gt; renderer.drawGameLoss(statusMessage) } } private fun checkLocationCanBeExplored(location: Location) = location.isOpen &amp;&amp; location.bag.size &gt; 0 private fun checkHeroCanAttemptStatCheck(hero: Hero, type: Die.Type): Boolean { return hero.isAlive &amp;&amp; SingleDieHandFilter(type).test(hero.hand) } private fun checkHeroCanAcquireDie(hero: Hero, type: Die.Type): Boolean { if (!hero.isAlive) { return false } return when (type) { Die.Type.ALLY -&gt; hero.hand.allyDieCount &lt; MAX_HAND_ALLY_SIZE else -&gt; hero.hand.dieCount &lt; MAX_HAND_SIZE } } }</span></span></code> </pre></div></div><br>  <code>start()</code> ‚Äî    .   ,  ,   ,       .        ,      .  <code>drawInitialHand()</code>     (, ,     <code>drawOfType()</code>  <code>Bag</code> ,      ,        ).  <code>refillHeroHand()</code>    (     <code>redrawScreen</code> ):    (        ),     ,          ,     . <br><br>    ,   <code>changePhase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, - como j√° dissemos, eles servem para alterar a fase atual do jogo e est√£o envolvidos na atribui√ß√£o dos valores correspondentes das vari√°veis ‚Äã‚Äãdo jogo. Aqui, uma lista √© formada </font></font><code>actions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onde as a√ß√µes caracter√≠sticas desta fase s√£o adicionadas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O m√©todo de utilidade de </font></font><code>pickDiceFromHand()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma forma generalizada est√° envolvido na sele√ß√£o de cubos da m√£o. Um objeto de uma classe familiar </font></font><code>HandMaskRule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que define as regras de sele√ß√£o </font><font style="vertical-align: inherit;">√© passado aqui </font><font style="vertical-align: inherit;">. Tamb√©m indica a capacidade de recusar a sele√ß√£o ( </font></font><code>allowCancel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), bem como uma fun√ß√£o </font></font><code>onEachLoop</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cujo c√≥digo deve ser chamado sempre que a lista de cubos selecionados √© alterada (geralmente uma tela redesenhada). Os cubos selecionados por esse m√©todo podem ser montados manualmente, usando os m√©todos </font></font><code>collectPickedDice()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>collectPickedAllyDice()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outro m√©todo utilit√°rio</font></font><code>performStatDieAcquireCheck()</code>         .        <code>DieBattleCheck</code> .       <code>pickDiceFromHand()</code> (      ¬´¬ª <code>DieBattleCheck</code> ).     ,    ¬´¬ª ‚Äî      (  ),      .         .       (  ),   ( <code>shouldDiscard = true</code> ),      ( <code>shouldDiscard = false</code> ). <br><br>   <code>processCycle()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m um loop infinito (pergunto sem desmaiar) no qual a tela √© desenhada primeiro, depois o usu√°rio √© solicitado a inserir e, em seguida, essa entrada √© processada - com todas as conseq√º√™ncias resultantes. </font><font style="vertical-align: inherit;">O m√©todo </font></font><code>drawScreen()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chama o m√©todo de interface desejado </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(dependendo do valor atual </font></font><code>screen</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), passando os objetos necess√°rios para a entrada. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m disso, a classe cont√©m v√°rios m√©todos auxiliares: </font></font><code>checkLocationCanBeExplored()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>checkHeroCanAttemptStatCheck()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>checkHeroCanAcquireDie()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Seus nomes falam por si mesmos, portanto, n√£o iremos nos deter neles em detalhes. </font><font style="vertical-align: inherit;">E tamb√©m h√° chamadas de m√©todo de classe </font></font><code>Audio</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, sublinhadas por uma linha ondulada vermelha. </font><font style="vertical-align: inherit;">Comente-os por enquanto - consideraremos seu objetivo posteriormente.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quem n√£o entende nada, aqui est√° um diagrama (para maior clareza, por assim dizer):</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/j3/hl/so/j3hlsov7ev0lducteyrvthdwkge.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso √© tudo, o jogo est√° pronto (hehe). </font><font style="vertical-align: inherit;">Havia pequenas coisas reais sobre eles abaixo.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa nove. </font><font style="vertical-align: inherit;">Exibir imagem</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ent√£o, chegamos ao t√≥pico principal da conversa de hoje - o componente gr√°fico do aplicativo. </font><font style="vertical-align: inherit;">Como voc√™ se lembra, nossa tarefa √© implementar a interface </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e seus tr√™s m√©todos e, como ainda n√£o h√° nenhum artista talentoso em nossa equipe, faremos isso sozinhos usando pseudogr√°ficos. </font><font style="vertical-align: inherit;">Mas, para come√ßar, seria bom entender o que geralmente esperamos ver na sa√≠da. </font><font style="vertical-align: inherit;">E queremos ver tr√™s telas com aproximadamente o seguinte conte√∫do:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tela 1. ID de Turno do Jogador</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ey/kv/ro/eykvrovfqckvawmiylrmb03gx70.png"></a> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tela 2. Informa√ß√µes sobre a √°rea e o her√≥i atual</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/5v/xd/ad/5vxdadvii-aunblqcdkxs4h8jrs.png"></a> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tela 3. Mensagem de perda de script</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ry/l1/6y/ryl16yvaas4njnnu5mxginmvsm0.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acho que a maioria j√° percebeu que as imagens apresentadas s√£o diferentes de tudo o que costumamos ver no console de aplicativos Java e que os recursos habituais </font></font><code>prinltn()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obviamente n√£o ser√£o suficientes para n√≥s. Eu tamb√©m gostaria de poder pular para lugares arbitr√°rios na tela e desenhar s√≠mbolos em cores diferentes. </font><s><font style="vertical-align: inherit;">Os </font></s><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">c√≥digos </font></a><s><font style="vertical-align: inherit;">Chip e Dale </font></s><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">ANSI</font></a></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> correm em nosso aux√≠lio</font></font><s><font style="vertical-align: inherit;"></font></s> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"></font></a> .      ,      :   /,   ,       . ,         ‚Äî     .           ‚Äî  ,      .         -  , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jansi</a> : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.fusesource.jansi<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jansi<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.17.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>    .       <code>Ansi</code> (     <code>Ansi.ansi()</code> )    ,     .    <code>StringBuilder</code> ' ‚Äî   ,     .     : <br><br><ul><li> <code>a()</code> ‚Äî   ; </li><li> <code>cursor()</code> ‚Äî     ; </li><li> <code>eraseLine()</code> ‚Äî -    ; </li><li> <code>eraseScreen()</code> ‚Äî ; </li><li> <code>fg(), bg(), fgBright(), bgBright()</code> ‚Äî           ‚Äî   ,  ; </li><li> <code>reset()</code> ‚Äî     ,  . </li></ul><br>   <code>ConsoleRenderer</code>   ,      .       : <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleRenderer</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ansi: Ansi <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { AnsiConsole.systemInstall() clearScreen() resetAnsi() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resetAnsi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ansi = Ansi.ansi() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { print(Ansi.ansi().eraseScreen(Ansi.Erase.ALL).cursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { print(ansi.toString()) resetAnsi() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O m√©todo </font></font><code>resetAnsi()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cria um novo objeto (vazio) </font></font><code>Ansi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que ser√° preenchido com os comandos necess√°rios (movimenta√ß√£o, sa√≠da, etc.). </font><font style="vertical-align: inherit;">Ap√≥s a conclus√£o do preenchimento, o objeto gerado √© enviado para impress√£o pelo m√©todo </font></font><code>render()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e a vari√°vel √© inicializada com um novo objeto. </font><font style="vertical-align: inherit;">Nada complicado ainda, certo? </font><font style="vertical-align: inherit;">E se sim, ent√£o come√ßaremos a preencher esta classe com outros m√©todos √∫teis. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos come√ßar com os tamanhos. </font><font style="vertical-align: inherit;">O console padr√£o da maioria dos terminais tem 80x24 de tamanho. </font><font style="vertical-align: inherit;">Notamos esse fato com duas constantes </font></font><code>CONSOLE_WIDTH</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>CONSOLE_HEIGHT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">N√£o estaremos apegados a valores espec√≠ficos e tentaremos tornar o design o mais emborrachado poss√≠vel (como na Web). </font><font style="vertical-align: inherit;">A numera√ß√£o das coordenadas come√ßa com uma, a primeira coordenada √© uma linha e a segunda √© uma coluna. </font><font style="vertical-align: inherit;">Sabendo tudo isso, escrevemos um m√©todo utilit√°rio</font></font><code>drawHorizontalLine()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para preencher a sequ√™ncia especificada com o caractere especificado. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHorizontalLine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, filler: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Char</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span>..CONSOLE_WIDTH).forEach { ansi.a(filler) } <span class="hljs-comment"><span class="hljs-comment">//for (i in 1..CONSOLE_WIDTH) { ansi.a(filler) } }</span></span></code> </pre><br>   ,    <code>a()</code>  <code>cursor()</code>       ,      <code>Ansi</code>   .        ,     . <br><br>     <code>for</code>     <code>ClosedRange</code>  <code>forEach{}</code>     ‚Äî    ,   .         ,    <s> ,      </s>          . <br><br>      <code>drawBlankLine()</code> ,    ,   <code>drawHorizontalLine(offsetY, ' ')</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, apenas com extens√£o. </font><font style="vertical-align: inherit;">√Äs vezes, precisamos deixar a linha vazia n√£o completamente, mas deixar uma linha vertical no in√≠cio e no final (quadro, sim). </font><font style="vertical-align: inherit;">O c√≥digo ser√° algo como isto:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawBlankLine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) { ansi.a(<span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span>) (<span class="hljs-number"><span class="hljs-number">2</span></span> until CONSOLE_WIDTH).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.a(<span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ansi.eraseLine(Ansi.Erase.ALL) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como, voc√™ nunca desenhou quadros de pseudografia? </font><font style="vertical-align: inherit;">Os s√≠mbolos podem ser inseridos diretamente no c√≥digo fonte. </font><font style="vertical-align: inherit;">Mantenha pressionada a tecla Alt e digite o c√≥digo de caractere no teclado num√©rico. </font><font style="vertical-align: inherit;">Ent√£o deixe ir. </font><font style="vertical-align: inherit;">Os c√≥digos ASCII que precisamos em qualquer codifica√ß√£o s√£o os mesmos, aqui est√° o conjunto m√≠nimo de cavalheiros:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6u/0y/js/6u0yjs19ntz1fue2wgkichhvnfo.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E ent√£o, como em minecraft, as possibilidades s√£o limitadas apenas pelos limites da sua imagina√ß√£o. </font><font style="vertical-align: inherit;">E o tamanho da tela.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawCenteredCaption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, text: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, color: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Color</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> center = (CONSOLE_WIDTH - text.length) / <span class="hljs-number"><span class="hljs-number">2</span></span> ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) ansi.a(<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) <span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>) (<span class="hljs-number"><span class="hljs-number">2</span></span> until center).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.color(color).a(text).reset() (text.length + center until CONSOLE_WIDTH).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.a(<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) <span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos conversar um pouco sobre as flores. A classe </font></font><code>Ansi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cont√©m constantes </font></font><code>Color</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para oito cores prim√°rias (preto, azul, verde, ciano, vermelho, violeta, amarelo, cinza), que devem ser passadas para a entrada de m√©todos </font></font><code>fg()/bg()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para a vers√£o escura ou </font></font><code>fgBright()/bgBright()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para a clara, o que √© terrivelmente inconveniente, pois identificar a cor por assim, um valor n√£o √© suficiente para n√≥s - precisamos de pelo menos dois (cor e brilho). Portanto, criaremos nossa lista de constantes e nossos m√©todos de extens√£o (al√©m de cores de liga√ß√£o de mapa para tipos de cubos e classes de her√≥is):</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Color</span></span></span><span class="hljs-class"> </span></span>{ BLACK, DARK_BLUE, DARK_GREEN, DARK_CYAN, DARK_RED, DARK_MAGENTA, DARK_YELLOW, LIGHT_GRAY, DARK_GRAY, LIGHT_BLUE, LIGHT_GREEN, LIGHT_CYAN, LIGHT_RED, LIGHT_MAGENTA, LIGHT_YELLOW, WHITE } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> Ansi.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">color</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(color: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Color</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: Ansi = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (color) { Color.BLACK -&gt; fgBlack() Color.DARK_BLUE -&gt; fgBlue() Color.DARK_GREEN -&gt; fgGreen() Color.DARK_CYAN -&gt; fgCyan() Color.DARK_RED -&gt; fgRed() Color.DARK_MAGENTA -&gt; fgMagenta() Color.DARK_YELLOW -&gt; fgYellow() Color.LIGHT_GRAY -&gt; fg(Ansi.Color.WHITE) Color.DARK_GRAY -&gt; fgBrightBlack() Color.LIGHT_BLUE -&gt; fgBrightBlue() Color.LIGHT_GREEN -&gt; fgBrightGreen() Color.LIGHT_CYAN -&gt; fgBrightCyan() Color.LIGHT_RED -&gt; fgBrightRed() Color.LIGHT_MAGENTA -&gt; fgBrightMagenta() Color.LIGHT_YELLOW -&gt; fgBrightYellow() Color.WHITE -&gt; fgBright(Ansi.Color.WHITE) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> Ansi.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">background</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(color: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Color</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: Ansi = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (color) { Color.BLACK -&gt; ansi.bg(Ansi.Color.BLACK) Color.DARK_BLUE -&gt; ansi.bg(Ansi.Color.BLUE) Color.DARK_GREEN -&gt; ansi.bgGreen() Color.DARK_CYAN -&gt; ansi.bg(Ansi.Color.CYAN) Color.DARK_RED -&gt; ansi.bgRed() Color.DARK_MAGENTA -&gt; ansi.bgMagenta() Color.DARK_YELLOW -&gt; ansi.bgYellow() Color.LIGHT_GRAY -&gt; ansi.bg(Ansi.Color.WHITE) Color.DARK_GRAY -&gt; ansi.bgBright(Ansi.Color.BLACK) Color.LIGHT_BLUE -&gt; ansi.bgBright(Ansi.Color.BLUE) Color.LIGHT_GREEN -&gt; ansi.bgBrightGreen() Color.LIGHT_CYAN -&gt; ansi.bgBright(Ansi.Color.CYAN) Color.LIGHT_RED -&gt; ansi.bgBrightRed() Color.LIGHT_MAGENTA -&gt; ansi.bgBright(Ansi.Color.MAGENTA) Color.LIGHT_YELLOW -&gt; ansi.bgBrightYellow() Color.WHITE -&gt; ansi.bgBright(Ansi.Color.WHITE) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> dieColors = mapOf( Die.Type.PHYSICAL to Color.LIGHT_BLUE, Die.Type.SOMATIC to Color.LIGHT_GREEN, Die.Type.MENTAL to Color.LIGHT_MAGENTA, Die.Type.VERBAL to Color.LIGHT_YELLOW, Die.Type.DIVINE to Color.LIGHT_CYAN, Die.Type.WOUND to Color.DARK_GRAY, Die.Type.ENEMY to Color.DARK_RED, Die.Type.VILLAIN to Color.LIGHT_RED, Die.Type.OBSTACLE to Color.DARK_YELLOW, Die.Type.ALLY to Color.WHITE ) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroColors = mapOf( Hero.Type.BRAWLER to Color.LIGHT_BLUE, Hero.Type.HUNTER to Color.LIGHT_GREEN )</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, cada uma das 16 cores dispon√≠veis √© identificada exclusivamente por uma √∫nica constante. Escreveremos mais alguns m√©todos de utilidade, mas antes descobriremos mais uma coisa: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onde armazenar as constantes para cadeias de texto? </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúAs constantes de string precisam ser retiradas em arquivos separados, para que sejam armazenadas em um √∫nico local - isso facilita a manuten√ß√£o. E tamb√©m √© importante para a localiza√ß√£o ... ‚Äù</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As constantes de string precisam ser movidas para arquivos separados ... bem, sim. N√≥s vamos suportar. O mecanismo Java padr√£o para trabalhar com esse tipo de recursos s√£o os objetos </font></font><code>java.util.ResourceBundle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que trabalham com arquivos </font></font><code>.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Aqui come√ßamos com esse arquivo:</font></font><br><br><pre> <code class="plaintext hljs"># Game status messages choose_dice_perform_check=Choose dice to perform check: end_of_turn_discard_extra=END OF TURN: Discard extra dice: end_of_turn_discard_optional=END OF TURN: Discard any dice, if needed: choose_action_before_exploration=Choose your action: choose_action_after_exploration=Already explored this turn. Choose what to do now: encounter_physical=Encountered PHYSICAL die. Need to pass respective check or lose this die. encounter_somatic=Encountered SOMATIC die. Need to pass respective check or lose this die. encounter_mental=Encountered MENTAL die. Need to pass respective check or lose this die. encounter_verbal=Encountered VERBAL die. Need to pass respective check or lose this die. encounter_divine=Encountered DIVINE die. Can be acquired automatically (no checks needed): die_acquire_success=You have acquired the die! die_acquire_failure=You have failed to acquire the die. game_loss_out_of_time=You ran out of time # Die types physical=PHYSICAL somatic=SOMATIC mental=MENTAL verbal=VERBAL divine=DIVINE ally=ALLY wound=WOUND enemy=ENEMY villain=VILLAIN obstacle=OBSTACLE # Hero types and descriptions brawler=Brawler hunter=Hunter # Various labels avg=avg bag=Bag bag_size=Bag size class=Class closed=Closed discard=Discard empty=Empty encountered=Encountered fail=Fail hand=Hand heros_turn=%s's turn max=max min=min perform_check=Perform check: pile=Pile received_new_die=Received new die result=Result success=Success sum=sum time=Time total=Total # Action names and descriptions action_confirm_key=ENTER action_confirm_name=Confirm action_cancel_key=ESC action_cancel_name=Cancel action_explore_location_key=E action_explore_location_name=xplore action_finish_turn_key=F action_finish_turn_name=inish action_hide_key=H action_hide_name=ide action_discard_key=D action_discard_name=iscard action_acquire_key=A action_acquire_name=cquire action_leave_key=L action_leave_name=eave action_forfeit_key=F action_forfeit_name=orfeit</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada linha cont√©m um par de valores-chave, separado por um caractere </font></font><code>=</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Voc√™ pode colocar o arquivo em qualquer lugar - o principal √© que o caminho para ele fa√ßa parte do caminho de classe. </font><font style="vertical-align: inherit;">Observe que o texto para a√ß√µes consiste em duas partes: a primeira letra n√£o √© destacada apenas em amarelo quando exibida na tela, mas tamb√©m determina a tecla que deve ser pressionada para executar esta a√ß√£o. </font><font style="vertical-align: inherit;">Portanto, √© conveniente armazen√°-los separadamente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por√©m, abstra√≠mos de um formato espec√≠fico (no Android, por exemplo, as strings s√£o armazenadas de maneira diferente) e descrevemos a interface para carregar constantes de strings.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringLoader</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A chave √© transmitida para a entrada, a sa√≠da √© uma linha espec√≠fica. </font><font style="vertical-align: inherit;">A implementa√ß√£o √© t√£o direta quanto a pr√≥pria interface (suponha que o arquivo esteja no caminho </font></font><code>src/main/resources/text/strings.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertiesStringLoader</span></span></span></span>() : StringLoader { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> properties = ResourceBundle.getBundle(<span class="hljs-string"><span class="hljs-string">"text.strings"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = properties.getString(key) ?: <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, n√£o ser√° dif√≠cil implementar um m√©todo </font></font><code>drawStatusMessage()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para exibir o estado atual do mecanismo de jogo ( </font></font><code>StatusMessage</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">na tela </font><font style="vertical-align: inherit;">e um m√©todo </font></font><code>drawActionList()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para exibir uma lista de a√ß√µes dispon√≠veis ( </font></font><code>ActionList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">Assim como outros m√©todos oficiais que somente a alma deseja.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° muito c√≥digo, parte dele j√° vimos ... ent√£o aqui est√° um spoiler para voc√™</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleRenderer</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> strings: StringLoader) { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ansi: Ansi <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { AnsiConsole.systemInstall() clearScreen() resetAnsi() } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = strings.loadString(key) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resetAnsi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ansi = Ansi.ansi() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { print(Ansi.ansi().eraseScreen(Ansi.Erase.ALL).cursor(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ansi.cursor(CONSOLE_HEIGHT, CONSOLE_WIDTH) System.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span>.print(ansi.toString()) resetAnsi() } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawBigNumber</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetX: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, number: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> = with(ansi) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentX = offsetX cursor(offsetY, currentX) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> text = number.toString() text.forEach { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (it) { <span class="hljs-string"><span class="hljs-string">'0'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'1'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'2'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'3'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'4'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'5'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'6'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'7'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà‚ñà‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'8'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) } <span class="hljs-string"><span class="hljs-string">'9'</span></span> -&gt; { cursor(offsetY, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">1</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">"‚ñà ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">2</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">3</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà "</span></span>) cursor(offsetY + <span class="hljs-number"><span class="hljs-number">4</span></span>, currentX) a(<span class="hljs-string"><span class="hljs-string">" ‚ñà‚ñà‚ñà "</span></span>) } } currentX += <span class="hljs-number"><span class="hljs-number">6</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHorizontalLine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, filler: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Char</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span>..CONSOLE_WIDTH).forEach { ansi.a(filler) } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawBlankLine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) { ansi.a(<span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span>) (<span class="hljs-number"><span class="hljs-number">2</span></span> until CONSOLE_WIDTH).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.a(<span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ansi.eraseLine(Ansi.Erase.ALL) } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawCenteredCaption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, text: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, color: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Color</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> center = (CONSOLE_WIDTH - text.length) / <span class="hljs-number"><span class="hljs-number">2</span></span> ansi.cursor(offsetY, <span class="hljs-number"><span class="hljs-number">1</span></span>) ansi.a(<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) <span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>) (<span class="hljs-number"><span class="hljs-number">2</span></span> until center).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.color(color).a(text).reset() (text.length + center until CONSOLE_WIDTH).forEach { ansi.a(<span class="hljs-string"><span class="hljs-string">' '</span></span>) } ansi.a(<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawBorders) <span class="hljs-string"><span class="hljs-string">'‚îÇ'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawStatusMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(offsetY: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, message: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">StatusMessage</span></span></span></span><span class="hljs-function"><span class="hljs-params">, drawBorders: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//Setup val messageText = loadString(message.toString().toLowerCase()) var currentX = 1 val rightBorder = CONSOLE_WIDTH - if (drawBorders) 1 else 0 //Left border ansi.cursor(offsetY, 1) if (drawBorders) { ansi.a('‚îÇ') currentX++ } ansi.a(' ') currentX++ //Text ansi.a(messageText) currentX += messageText.length //Right border (currentX..rightBorder).forEach { ansi.a(' ') } if (drawBorders) { ansi.a('‚îÇ') } } protected fun drawActionList(offsetY: Int, actions: ActionList, drawBorders: Boolean = true) { val rightBorder = CONSOLE_WIDTH - if (drawBorders) 1 else 0 var currentX = 1 //Left border ansi.cursor(offsetY, 1) if (drawBorders) { ansi.a('‚îÇ') currentX++ } ansi.a(' ') currentX++ //List of actions actions.forEach { action -&gt; val key = loadString("action_${action.toString().toLowerCase()}_key") val name = loadString("action_${action.toString().toLowerCase()}_name") val length = key.length + 2 + name.length if (currentX + length &gt;= rightBorder) { (currentX..rightBorder).forEach { ansi.a(' ') } if (drawBorders) { ansi.a('‚îÇ') } ansi.cursor(offsetY + 1, 1) currentX = 1 if (drawBorders) { ansi.a('‚îÇ') currentX++ } ansi.a(' ') currentX++ } if (action.isEnabled) { ansi.color(Color.LIGHT_YELLOW) } ansi.a('(').a(key).a(')').reset() ansi.a(name) ansi.a(" ") currentX += length + 2 } //Right border (currentX..rightBorder).forEach { ansi.a(' ') } if (drawBorders) { ansi.a('‚îÇ') } } protected enum class Color { BLACK, DARK_BLUE, DARK_GREEN, DARK_CYAN, DARK_RED, DARK_MAGENTA, DARK_YELLOW, LIGHT_GRAY, DARK_GRAY, LIGHT_BLUE, LIGHT_GREEN, LIGHT_CYAN, LIGHT_RED, LIGHT_MAGENTA, LIGHT_YELLOW, WHITE } protected fun Ansi.color(color: Color?): Ansi = when (color) { Color.BLACK -&gt; fgBlack() Color.DARK_BLUE -&gt; fgBlue() Color.DARK_GREEN -&gt; fgGreen() Color.DARK_CYAN -&gt; fgCyan() Color.DARK_RED -&gt; fgRed() Color.DARK_MAGENTA -&gt; fgMagenta() Color.DARK_YELLOW -&gt; fgYellow() Color.LIGHT_GRAY -&gt; fg(Ansi.Color.WHITE) Color.DARK_GRAY -&gt; fgBrightBlack() Color.LIGHT_BLUE -&gt; fgBrightBlue() Color.LIGHT_GREEN -&gt; fgBrightGreen() Color.LIGHT_CYAN -&gt; fgBrightCyan() Color.LIGHT_RED -&gt; fgBrightRed() Color.LIGHT_MAGENTA -&gt; fgBrightMagenta() Color.LIGHT_YELLOW -&gt; fgBrightYellow() Color.WHITE -&gt; fgBright(Ansi.Color.WHITE) else -&gt; this } protected fun Ansi.background(color: Color?): Ansi = when (color) { Color.BLACK -&gt; ansi.bg(Ansi.Color.BLACK) Color.DARK_BLUE -&gt; ansi.bg(Ansi.Color.BLUE) Color.DARK_GREEN -&gt; ansi.bgGreen() Color.DARK_CYAN -&gt; ansi.bg(Ansi.Color.CYAN) Color.DARK_RED -&gt; ansi.bgRed() Color.DARK_MAGENTA -&gt; ansi.bgMagenta() Color.DARK_YELLOW -&gt; ansi.bgYellow() Color.LIGHT_GRAY -&gt; ansi.bg(Ansi.Color.WHITE) Color.DARK_GRAY -&gt; ansi.bgBright(Ansi.Color.BLACK) Color.LIGHT_BLUE -&gt; ansi.bgBright(Ansi.Color.BLUE) Color.LIGHT_GREEN -&gt; ansi.bgBrightGreen() Color.LIGHT_CYAN -&gt; ansi.bgBright(Ansi.Color.CYAN) Color.LIGHT_RED -&gt; ansi.bgBrightRed() Color.LIGHT_MAGENTA -&gt; ansi.bgBright(Ansi.Color.MAGENTA) Color.LIGHT_YELLOW -&gt; ansi.bgBrightYellow() Color.WHITE -&gt; ansi.bgBright(Ansi.Color.WHITE) else -&gt; this } protected val dieColors = mapOf( Die.Type.PHYSICAL to Color.LIGHT_BLUE, Die.Type.SOMATIC to Color.LIGHT_GREEN, Die.Type.MENTAL to Color.LIGHT_MAGENTA, Die.Type.VERBAL to Color.LIGHT_YELLOW, Die.Type.DIVINE to Color.LIGHT_CYAN, Die.Type.WOUND to Color.DARK_GRAY, Die.Type.ENEMY to Color.DARK_RED, Die.Type.VILLAIN to Color.LIGHT_RED, Die.Type.OBSTACLE to Color.DARK_YELLOW, Die.Type.ALLY to Color.WHITE ) protected val heroColors = mapOf( Hero.Type.BRAWLER to Color.LIGHT_BLUE, Hero.Type.HUNTER to Color.LIGHT_GREEN ) protected open fun shortcut(index: Int) = "1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ"[index] }</span></span></code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por que todos n√≥s fizemos isso, voc√™ pergunta? </font><font style="vertical-align: inherit;">Sim, para herdar nossa implementa√ß√£o de interface desta maravilhosa classe </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagrama de classe</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/tn/00/fj/tn00fjvlnpga4zqm1p-ojveq7nm.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √â assim que a implementa√ß√£o do primeiro m√©todo mais simples se parecer√°: </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawGameLoss</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">StatusMessage</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> centerY = CONSOLE_HEIGHT / <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> until centerY).forEach { drawBlankLine(it, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = loadString(message.toString().toLowerCase()).toUpperCase() drawCenteredCaption(centerY, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>, LIGHT_RED, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) (centerY + <span class="hljs-number"><span class="hljs-number">1</span></span>..CONSOLE_HEIGHT).forEach { drawBlankLine(it, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } render() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nada sobrenatural, apenas uma linha de texto ( </font></font><code>data</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) desenhada em vermelho no centro da tela ( </font></font><code>drawCenteredCaption()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). O restante do c√≥digo preenche o restante da tela com linhas em branco. Talvez algu√©m pergunte por que isso √© necess√°rio - afinal </font></font><code>clearScreen()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font><font style="vertical-align: inherit;">existe um m√©todo </font><font style="vertical-align: inherit;">, basta cham√°-lo no in√≠cio do m√©todo, limpar a tela e desenhar o texto desejado. Infelizmente, essa √© uma abordagem pregui√ßosa que n√£o usaremos. O motivo √© muito simples: com essa abordagem, algumas posi√ß√µes na tela s√£o desenhadas duas vezes, o que leva a um tremor percept√≠vel, especialmente quando a tela √© sequencialmente desenhada v√°rias vezes seguidas (durante as anima√ß√µes). Portanto, nossa tarefa n√£o √© apenas desenhar os caracteres certos nos lugares certos, mas preencher </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todo o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o restante da tela com caracteres vazios (para que artefatos de outras renderiza√ß√µes n√£o permane√ßam nela). E essa tarefa n√£o √© t√£o simples. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O m√©todo a seguir segue esse princ√≠pio:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHeroTurnStart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hero: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> centerY = (CONSOLE_HEIGHT - <span class="hljs-number"><span class="hljs-number">5</span></span>) / <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> until centerY).forEach { drawBlankLine(it, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } ansi.color(heroColors[hero.type]) drawHorizontalLine(centerY, <span class="hljs-string"><span class="hljs-string">'‚îÄ'</span></span>) drawHorizontalLine(centerY + <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'‚îÄ'</span></span>) ansi.reset() ansi.cursor(centerY + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).eraseLine() ansi.cursor(centerY + <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).eraseLine() ansi.cursor(centerY + <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> text = String.format(loadString(<span class="hljs-string"><span class="hljs-string">"heros_turn"</span></span>), hero.name.toUpperCase()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> index = text.indexOf(hero.name.toUpperCase()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> center = (CONSOLE_WIDTH - text.length) / <span class="hljs-number"><span class="hljs-number">2</span></span> ansi.cursor(centerY + <span class="hljs-number"><span class="hljs-number">2</span></span>, center) ansi.eraseLine(Ansi.Erase.BACKWARD) ansi.a(text.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, index)) ansi.color(heroColors[hero.type]).a(hero.name.toUpperCase()).reset() ansi.a(text.substring(index + hero.name.length)) ansi.eraseLine(Ansi.Erase.FORWARD) (centerY + <span class="hljs-number"><span class="hljs-number">5</span></span>..CONSOLE_HEIGHT).forEach { drawBlankLine(it, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } render() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui, al√©m do texto centralizado, h√° tamb√©m duas linhas horizontais (veja as capturas de tela acima). </font><font style="vertical-align: inherit;">Observe que as letras centrais s√£o exibidas em duas cores. </font><font style="vertical-align: inherit;">E tamb√©m verifique se o aprendizado de matem√°tica na escola ainda √© √∫til. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bem, analisamos os m√©todos mais simples e √© hora de conhecer a implementa√ß√£o </font></font><code>drawLocationInteriorScreen()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Como voc√™ mesmo entende, haver√° uma ordem de magnitude mais c√≥digo aqui. </font><font style="vertical-align: inherit;">Al√©m disso, o conte√∫do da tela mudar√° dinamicamente em resposta √†s a√ß√µes do usu√°rio e precisar√° ser constantemente redesenhado (√†s vezes com anima√ß√£o). </font><font style="vertical-align: inherit;">Bem, para finalmente acabar com voc√™: imagine que, al√©m da captura de tela acima, no √¢mbito deste m√©todo, √© necess√°rio implementar a exibi√ß√£o de mais tr√™s:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Reuni√£o com o cubo removido da sacola</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/8x/lx/h9/8xlxh9h-ulu0efaigsnnfuo6nsq.png"></a> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Selecionando dados para passar no teste</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/cd/iw/2e/cdiw2e0fxlfdsjeijyxwauzth-m.png"></a> <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Exibindo Resultados do Teste</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/t3/-w/7r/t3-w7rfvplkfeywr9_5accvkada.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portanto, aqui est√° o meu grande conselho para voc√™: n√£o coloque todo o c√≥digo em um m√©todo. </font><font style="vertical-align: inherit;">Divida a implementa√ß√£o em v√°rios m√©todos (mesmo que cada um deles seja chamado apenas uma vez). </font><font style="vertical-align: inherit;">Bem, n√£o se esque√ßa da "borracha".</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se come√ßar a ondular nos seus olhos, pisque por alguns segundos - isso deve ajudar</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleGameRenderer</span></span></span></span>(loader: StringLoader) : ConsoleRenderer(loader), GameRenderer { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawLocationTopPanel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(location: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Location</span></span></span></span><span class="hljs-function"><span class="hljs-params">, heroesAtLocation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;, currentHero: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Hero</span></span></span></span><span class="hljs-function"><span class="hljs-params">, timer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> closedString = loadString(<span class="hljs-string"><span class="hljs-string">"closed"</span></span>).toLowerCase() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> timeString = loadString(<span class="hljs-string"><span class="hljs-string">"time"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> locationName = location.name.toString().toUpperCase() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> separatorX1 = locationName.length + <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location.isOpen) { <span class="hljs-number"><span class="hljs-number">6</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location.bag.size &gt;= <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { closedString.length + <span class="hljs-number"><span class="hljs-number">7</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> separatorX2 = CONSOLE_WIDTH - timeString.length - <span class="hljs-number"><span class="hljs-number">6</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (timer &gt;= <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">//Top border ansi.cursor(1, 1) ansi.a('‚îå') (2 until CONSOLE_WIDTH).forEach { ansi.a(if (it == separatorX1 || it == separatorX2) '‚î¨' else '‚îÄ') } ansi.a('‚îê') //Center row ansi.cursor(2, 1) ansi.a("‚îÇ ") if (location.isOpen) { ansi.color(WHITE).a(locationName).reset() ansi.a(": ").a(location.bag.size) } else { ansi.a(locationName).reset() ansi.color(DARK_GRAY).a(" (").a(closedString).a(')').reset() } ansi.a(" ‚îÇ") var currentX = separatorX1 + 2 heroesAtLocation.forEach { hero -&gt; ansi.a(' ') ansi.color(heroColors[hero.type]) ansi.a(if (hero === currentHero) '‚òª' else '').reset() currentX += 2 } (currentX..separatorX2).forEach { ansi.a(' ') } ansi.a("‚îÇ ").a(timeString).a(": ") when { timer &lt;= 5 -&gt; ansi.color(LIGHT_RED) timer &lt;= 15 -&gt; ansi.color(LIGHT_YELLOW) else -&gt; ansi.color(LIGHT_GREEN) } ansi.bold().a(timer).reset().a(" ‚îÇ") //Bottom border ansi.cursor(3, 1) ansi.a('‚îú') (2 until CONSOLE_WIDTH).forEach { ansi.a(if (it == separatorX1 || it == separatorX2) '‚î¥' else '‚îÄ') } ansi.a('‚î§') } private fun drawLocationHeroPanel(offsetY: Int, hero: Hero) { val bagString = loadString("bag").toUpperCase() val discardString = loadString("discard").toUpperCase() val separatorX1 = hero.name.length + 4 val separatorX3 = CONSOLE_WIDTH - discardString.length - 6 - if (hero.discardPile.size &gt;= 10) 1 else 0 val separatorX2 = separatorX3 - bagString.length - 6 - if (hero.bag.size &gt;= 10) 1 else 0 //Top border ansi.cursor(offsetY, 1) ansi.a('‚îú') (2 until CONSOLE_WIDTH).forEach { ansi.a(if (it == separatorX1 || it == separatorX2 || it == separatorX3) '‚î¨' else '‚îÄ') } ansi.a('‚î§') //Center row ansi.cursor(offsetY + 1, 1) ansi.a("‚îÇ ") ansi.color(heroColors[hero.type]).a(hero.name.toUpperCase()).reset() ansi.a(" ‚îÇ") val currentX = separatorX1 + 1 (currentX until separatorX2).forEach { ansi.a(' ') } ansi.a("‚îÇ ").a(bagString).a(": ") when { hero.bag.size &lt;= hero.hand.capacity -&gt; ansi.color(LIGHT_RED) else -&gt; ansi.color(LIGHT_YELLOW) } ansi.a(hero.bag.size).reset() ansi.a(" ‚îÇ ").a(discardString).a(": ") ansi.a(hero.discardPile.size) ansi.a(" ‚îÇ") //Bottom border ansi.cursor(offsetY + 2, 1) ansi.a('‚îú') (2 until CONSOLE_WIDTH).forEach { ansi.a(if (it == separatorX1 || it == separatorX2 || it == separatorX3) '‚î¥' else '‚îÄ') } ansi.a('‚î§') } private fun drawDieSize(die: Die, checked: Boolean = false) { when { checked -&gt; ansi.background(dieColors[die.type]).color(BLACK) else -&gt; ansi.color(dieColors[die.type]) } ansi.a(die.toString()).reset() } private fun drawDieFrameSmall(offsetX: Int, offsetY: Int, longDieSize: Boolean) { //Top border ansi.cursor(offsetY, offsetX) ansi.a('‚ïî') (0 until if (longDieSize) 5 else 4).forEach { ansi.a('‚ïê') } ansi.a('‚ïó') //Left border ansi.cursor(offsetY + 1, offsetX) ansi.a("‚ïë ") //Bottom border ansi.cursor(offsetY + 2, offsetX) ansi.a("‚ïö") (0 until if (longDieSize) 5 else 4).forEach { ansi.a('‚ïê') } ansi.a('‚ïù') //Right border ansi.cursor(offsetY + 1, offsetX + if (longDieSize) 6 else 5) ansi.a('‚ïë') } private fun drawDieSmall(offsetX: Int, offsetY: Int, pair: DiePair, rollResult: Int? = null) { ansi.color(dieColors[pair.die.type]) val longDieSize = pair.die.size &gt;= 10 drawDieFrameSmall(offsetX, offsetY, longDieSize) //Roll result or die size ansi.cursor(offsetY + 1, offsetX + 1) if (rollResult != null) { ansi.a(String.format(" %2d %s", rollResult, if (longDieSize) " " else "")) } else { ansi.a(' ').a(pair.die.toString()).a(' ') } //Draw modifier ansi.cursor(offsetY + 3, offsetX) val modString = if (pair.modifier == 0) "" else String.format("%+d", pair.modifier) val frameLength = 4 + if (longDieSize) 3 else 2 var spaces = (frameLength - modString.length) / 2 (0 until spaces).forEach { ansi.a(' ') } ansi.a(modString) spaces = frameLength - spaces - modString.length (0 until spaces).forEach { ansi.a(' ') } ansi.reset() } private fun drawDieFrameBig(offsetX: Int, offsetY: Int, longDieSize: Boolean) { //Top border ansi.cursor(offsetY, offsetX) ansi.a('‚ïî') (0 until if (longDieSize) 3 else 2).forEach { ansi.a("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê") } ansi.a("‚ïê‚ïó") //Left border (1..5).forEach { ansi.cursor(offsetY + it, offsetX) ansi.a('‚ïë') } //Bottom border ansi.cursor(offsetY + 6, offsetX) ansi.a('‚ïö') (0 until if (longDieSize) 3 else 2).forEach { ansi.a("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê") } ansi.a("‚ïê‚ïù") //Right border val currentX = offsetX + if (longDieSize) 20 else 14 (1..5).forEach { ansi.cursor(offsetY + it, currentX) ansi.a('‚ïë') } } private fun drawDieSizeBig(offsetX: Int, offsetY: Int, pair: DiePair) { ansi.color(dieColors[pair.die.type]) val longDieSize = pair.die.size &gt;= 10 drawDieFrameBig(offsetX, offsetY, longDieSize) //Die size ansi.cursor(offsetY + 1, offsetX + 1) ansi.a(" ‚ñà‚ñà‚ñà‚ñà ") ansi.cursor(offsetY + 2, offsetX + 1) ansi.a(" ‚ñà ‚ñà ") ansi.cursor(offsetY + 3, offsetX + 1) ansi.a(" ‚ñà ‚ñà ") ansi.cursor(offsetY + 4, offsetX + 1) ansi.a(" ‚ñà ‚ñà ") ansi.cursor(offsetY + 5, offsetX + 1) ansi.a(" ‚ñà‚ñà‚ñà‚ñà ") drawBigNumber(offsetX + 8, offsetY + 1, pair.die.size) //Draw modifier ansi.cursor(offsetY + 7, offsetX) val modString = if (pair.modifier == 0) "" else String.format("%+d", pair.modifier) val frameLength = 4 + 6 * if (longDieSize) 3 else 2 var spaces = (frameLength - modString.length) / 2 (0 until spaces).forEach { ansi.a(' ') } ansi.a(modString) spaces = frameLength - spaces - modString.length - 1 (0 until spaces).forEach { ansi.a(' ') } ansi.reset() } private fun drawBattleCheck(offsetY: Int, battleCheck: DieBattleCheck) { val performCheck = loadString("perform_check") var currentX = 4 var currentY = offsetY //Top message ansi.cursor(offsetY, 1) ansi.a("‚îÇ ").a(performCheck) (performCheck.length + 4 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') //Left border (1..4).forEach { ansi.cursor(offsetY + it, 1) ansi.a("‚îÇ ") } //Opponent var opponentWidth = 0 var vsWidth = 0 (battleCheck.getOpponentPair())?.let { //Die if (battleCheck.isRolled) { drawDieSmall(4, offsetY + 1, it, battleCheck.getOpponentResult()) } else { drawDieSmall(4, offsetY + 1, it) } opponentWidth = 4 + if (it.die.size &gt;= 10) 3 else 2 currentX += opponentWidth //VS ansi.cursor(currentY + 1, currentX) ansi.a(" ") ansi.cursor(currentY + 2, currentX) ansi.color(LIGHT_YELLOW).a(" VS ").reset() ansi.cursor(currentY + 3, currentX) ansi.a(" ") ansi.cursor(currentY + 4, currentX) ansi.a(" ") vsWidth = 4 currentX += vsWidth } //Clear below for (row in currentY + 5..currentY + 8) { ansi.cursor(row, 1) ansi.a('‚îÇ') (2 until currentX).forEach { ansi.a(' ') } } //Dice for (index in 0 until battleCheck.heroPairCount) { if (index &gt; 0) { ansi.cursor(currentY + 1, currentX) ansi.a(" ") ansi.cursor(currentY + 2, currentX) ansi.a(if (battleCheck.method == DieBattleCheck.Method.SUM) " + " else " / ").reset() ansi.cursor(currentY + 3, currentX) ansi.a(" ") ansi.cursor(currentY + 4, currentX) ansi.a(" ") currentX += 3 } val pair = battleCheck.getHeroPairAt(index) val width = 4 + if (pair.die.size &gt;= 10) 3 else 2 if (currentX + width + 3 &gt; CONSOLE_WIDTH) { //Out of space for (row in currentY + 1..currentY + 4) { ansi.cursor(row, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') } currentY += 4 currentX = 4 + vsWidth + opponentWidth } if (battleCheck.isRolled) { drawDieSmall(currentX, currentY + 1, pair, battleCheck.getHeroResultAt(index)) } else { drawDieSmall(currentX, currentY + 1, pair) } currentX += width } //Clear the rest (currentY + 1..currentY + 4).forEach { row -&gt; ansi.cursor(row, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') } if (currentY == offsetY) { //Still on the first line currentX = 4 + vsWidth + opponentWidth (currentY + 5..currentY + 8).forEach { row -&gt; ansi.cursor(row, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') } } //Draw result (battleCheck.result)?.let { r -&gt; val frameTopY = offsetY + 5 val result = String.format("%+d", r) val message = loadString(if (r &gt;= 0) "success" else "fail").toUpperCase() val color = if (r &gt;= 0) DARK_GREEN else DARK_RED //Frame ansi.color(color) drawHorizontalLine(frameTopY, '‚ñí') drawHorizontalLine(frameTopY + 3, '‚ñí') ansi.cursor(frameTopY + 1, 1).a("‚ñí‚ñí") ansi.cursor(frameTopY + 1, CONSOLE_WIDTH - 1).a("‚ñí‚ñí") ansi.cursor(frameTopY + 2, 1).a("‚ñí‚ñí") ansi.cursor(frameTopY + 2, CONSOLE_WIDTH - 1).a("‚ñí‚ñí") ansi.reset() //Top message val resultString = loadString("result") var center = (CONSOLE_WIDTH - result.length - resultString.length - 2) / 2 ansi.cursor(frameTopY + 1, 3) (3 until center).forEach { ansi.a(' ') } ansi.a(resultString).a(": ") ansi.color(color).a(result).reset() (center + result.length + resultString.length + 2 until CONSOLE_WIDTH - 1).forEach { ansi.a(' ') } //Bottom message center = (CONSOLE_WIDTH - message.length) / 2 ansi.cursor(frameTopY + 2, 3) (3 until center).forEach { ansi.a(' ') } ansi.color(color).a(message).reset() (center + message.length until CONSOLE_WIDTH - 1).forEach { ansi.a(' ') } } } private fun drawExplorationResult(offsetY: Int, pair: DiePair) { val encountered = loadString("encountered") ansi.cursor(offsetY, 1) ansi.a("‚îÇ ").a(encountered).a(':') (encountered.length + 5 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') val dieFrameWidth = 3 + 6 * if (pair.die.size &gt;= 10) 3 else 2 for (row in 1..8) { ansi.cursor(offsetY + row, 1) ansi.a("‚îÇ ") ansi.cursor(offsetY + row, dieFrameWidth + 4) (dieFrameWidth + 4 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') } drawDieSizeBig(4, offsetY + 1, pair) } private fun drawHand(offsetY: Int, hand: Hand, checkedDice: HandMask, activePositions: HandMask) { val handString = loadString("hand").toUpperCase() val alliesString = loadString("allies").toUpperCase() val capacity = hand.capacity val size = hand.dieCount val slots = max(size, capacity) val alliesSize = hand.allyDieCount var currentY = offsetY var currentX = 1 //Hand title ansi.cursor(currentY, currentX) ansi.a("‚îÇ ").a(handString) //Left border currentY += 1 currentX = 1 ansi.cursor(currentY, currentX) ansi.a("‚îÇ ‚ïî") ansi.cursor(currentY + 1, currentX) ansi.a("‚îÇ ‚ïë") ansi.cursor(currentY + 2, currentX) ansi.a("‚îÇ ‚ïö") ansi.cursor(currentY + 3, currentX) ansi.a("‚îÇ ") currentX += 3 //Main hand for (i in 0 until min(slots, MAX_HAND_SIZE)) { val die = hand.dieAt(i) val longDieName = die != null &amp;&amp; die.size &gt;= 10 //Top border ansi.cursor(currentY, currentX) if (i &lt; capacity) { ansi.a("‚ïê‚ïê‚ïê‚ïê").a(if (longDieName) "‚ïê" else "") } else { ansi.a("‚îÄ‚îÄ‚îÄ‚îÄ").a(if (longDieName) "‚îÄ" else "") } ansi.a(if (i &lt; capacity - 1) '‚ï§' else if (i == capacity - 1) '‚ïó' else if (i &lt; size - 1) '‚î¨' else '‚îê') //Center row ansi.cursor(currentY + 1, currentX) ansi.a(' ') if (die != null) { drawDieSize(die, checkedDice.checkPosition(i)) } else { ansi.a(" ") } ansi.a(' ') ansi.a(if (i &lt; capacity - 1) '‚îÇ' else if (i == capacity - 1) '‚ïë' else '‚îÇ') //Bottom border ansi.cursor(currentY + 2, currentX) if (i &lt; capacity) { ansi.a("‚ïê‚ïê‚ïê‚ïê").a(if (longDieName) '‚ïê' else "") } else { ansi.a("‚îÄ‚îÄ‚îÄ‚îÄ").a(if (longDieName) '‚îÄ' else "") } ansi.a(if (i &lt; capacity - 1) '‚ïß' else if (i == capacity - 1) '‚ïù' else if (i &lt; size - 1) '‚î¥' else '‚îò') //Die number ansi.cursor(currentY + 3, currentX) if (activePositions.checkPosition(i)) { ansi.color(LIGHT_YELLOW) } ansi.a(String.format(" (%s) %s", shortcut(i), if (longDieName) " " else "")) ansi.reset() currentX += 5 + if (longDieName) 1 else 0 } //Ally subhand if (alliesSize &gt; 0) { currentY = offsetY //Ally title ansi.cursor(currentY, handString.length + 5) (handString.length + 5 until currentX).forEach { ansi.a(' ') } ansi.a(" ").a(alliesString) (currentX + alliesString.length + 5 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') //Left border currentY += 1 ansi.cursor(currentY, currentX) ansi.a(" ‚îå") ansi.cursor(currentY + 1, currentX) ansi.a(" ‚îÇ") ansi.cursor(currentY + 2, currentX) ansi.a(" ‚îî") ansi.cursor(currentY + 3, currentX) ansi.a(" ") currentX += 4 //Ally slots for (i in 0 until min(alliesSize, MAX_HAND_ALLY_SIZE)) { val allyDie = hand.allyDieAt(i)!! val longDieName = allyDie.size &gt;= 10 //Top border ansi.cursor(currentY, currentX) ansi.a("‚îÄ‚îÄ‚îÄ‚îÄ").a(if (longDieName) "‚îÄ" else "") ansi.a(if (i &lt; alliesSize - 1) '‚î¨' else '‚îê') //Center row ansi.cursor(currentY + 1, currentX) ansi.a(' ') drawDieSize(allyDie, checkedDice.checkAllyPosition(i)) ansi.a(" ‚îÇ") //Bottom border ansi.cursor(currentY + 2, currentX) ansi.a("‚îÄ‚îÄ‚îÄ‚îÄ").a(if (longDieName) "‚îÄ" else "") ansi.a(if (i &lt; alliesSize - 1) '‚î¥' else '‚îò') //Die number ansi.cursor(currentY + 3, currentX) if (activePositions.checkAllyPosition(i)) { ansi.color(LIGHT_YELLOW) } ansi.a(String.format(" (%s) %s", shortcut(i + 10), if (longDieName) " " else "")).reset() currentX += 5 + if (longDieName) 1 else 0 } } else { ansi.cursor(offsetY, 9) (9 until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') ansi.cursor(offsetY + 4, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') } //Clear the end of the line (0..3).forEach { row -&gt; ansi.cursor(currentY + row, currentX) (currentX until CONSOLE_WIDTH).forEach { ansi.a(' ') } ansi.a('‚îÇ') } } override fun drawHeroTurnStart(hero: Hero) { val centerY = (CONSOLE_HEIGHT - 5) / 2 (1 until centerY).forEach { drawBlankLine(it, false) } ansi.color(heroColors[hero.type]) drawHorizontalLine(centerY, '‚îÄ') drawHorizontalLine(centerY + 4, '‚îÄ') ansi.reset() ansi.cursor(centerY + 1, 1).eraseLine() ansi.cursor(centerY + 3, 1).eraseLine() ansi.cursor(centerY + 2, 1) val text = String.format(loadString("heros_turn"), hero.name.toUpperCase()) val index = text.indexOf(hero.name.toUpperCase()) val center = (CONSOLE_WIDTH - text.length) / 2 ansi.cursor(centerY + 2, center) ansi.eraseLine(Ansi.Erase.BACKWARD) ansi.a(text.substring(0, index)) ansi.color(heroColors[hero.type]).a(hero.name.toUpperCase()).reset() ansi.a(text.substring(index + hero.name.length)) ansi.eraseLine(Ansi.Erase.FORWARD) (centerY + 5..CONSOLE_HEIGHT).forEach { drawBlankLine(it, false) } render() } override fun drawLocationInteriorScreen( location: Location, heroesAtLocation: List&lt;Hero&gt;, timer: Int, currentHero: Hero, battleCheck: DieBattleCheck?, encounteredDie: DiePair?, pickedDice: HandMask, activePositions: HandMask, statusMessage: StatusMessage, actions: ActionList) { //Top panel drawLocationTopPanel(location, heroesAtLocation, currentHero, timer) //Encounter info when { battleCheck != null -&gt; drawBattleCheck(4, battleCheck) encounteredDie != null -&gt; drawExplorationResult(4, encounteredDie) else -&gt; (4..12).forEach { drawBlankLine(it) } } //Fill blank space val bottomHalfTop = CONSOLE_HEIGHT - 11 (13 until bottomHalfTop).forEach { drawBlankLine(it) } //Hero-specific info drawLocationHeroPanel(bottomHalfTop, currentHero) drawHand(bottomHalfTop + 3, currentHero.hand, pickedDice, activePositions) //Separator ansi.cursor(bottomHalfTop + 8, 1) ansi.a('‚îú') (2 until CONSOLE_WIDTH).forEach { ansi.a('‚îÄ') } ansi.a('‚î§') //Status and actions drawStatusMessage(bottomHalfTop + 9, statusMessage) drawActionList(bottomHalfTop + 10, actions) //Bottom border ansi.cursor(CONSOLE_HEIGHT, 1) ansi.a('‚îî') (2 until CONSOLE_WIDTH).forEach { ansi.a('‚îÄ') } ansi.a('‚îò') //Finalize render() } override fun drawGameLoss(message: StatusMessage) { val centerY = CONSOLE_HEIGHT / 2 (1 until centerY).forEach { drawBlankLine(it, false) } val data = loadString(message.toString().toLowerCase()).toUpperCase() drawCenteredCaption(centerY, data, LIGHT_RED, false) (centerY + 1..CONSOLE_HEIGHT).forEach { drawBlankLine(it, false) } render() } }</span></span></code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° um pequeno problema associado √† verifica√ß√£o da opera√ß√£o de todo esse c√≥digo. </font><font style="vertical-align: inherit;">Como o console IDE embutido n√£o suporta sequ√™ncias de escape ANSI, voc√™ ter√° que iniciar o aplicativo em um terminal externo (j√° escrevemos um script para inici√°-lo anteriormente). </font><font style="vertical-align: inherit;">Al√©m disso, com o suporte a ANSI, nem tudo est√° bem no Windows - at√© onde eu sei, apenas na vers√£o 10, o cmd.exe padr√£o pode nos agradar com uma exibi√ß√£o de alta qualidade (e isso, com alguns problemas nos quais n√£o focaremos). </font><font style="vertical-align: inherit;">E o PowerShell n√£o aprendeu imediatamente a reconhecer sequ√™ncias (apesar da demanda atual). </font><font style="vertical-align: inherit;">Se voc√™ tiver azar, n√£o desanime - sempre existem solu√ß√µes alternativas ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">isso, por exemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">E seguimos em frente.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa dez </font><font style="vertical-align: inherit;">Entrada do usu√°rio</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A exibi√ß√£o da imagem na tela ainda √© metade da batalha. √â igualmente importante receber corretamente comandos de controle do usu√°rio. E quero dizer que essa tarefa pode ser tecnicamente muito mais dif√≠cil de implementar do que todas as anteriores. Mas as primeiras coisas primeiro. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como voc√™ se lembra, somos confrontados com a necessidade de implementar m√©todos de classe </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Existem apenas tr√™s deles, mas eles requerem aten√ß√£o especial. Em primeiro lugar, sincroniza√ß√£o. O mecanismo do jogo deve ser suspenso at√© o jogador pressionar uma tecla. Em segundo lugar, clique em processamento. Infelizmente, a capacidade das classes padr√£o </font></font><code>Reader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Scanner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>Console</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o √© suficiente para reconhec√™-los mais prementes: n√≥s n√£o exigem que o usu√°rio pressione ENTER depois de cada comando. Precisamos de algo como</font></font><code>KeyListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas, mas est√° intimamente ligado √† estrutura Swing, e nosso aplicativo de console n√£o possui todo esse enfeites gr√°ficos.</font></font><br><br>  O que fazer?  , ,            .   ¬´, ¬ª‚Ä¶  ? ,     ,   ,       .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">jLine</a> ,        ( ). ,    , ,    Windows,   Linux/UNIX (   ).  ,  <i></i>         .   ,   ,     . <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>jline<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jline<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.14.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Observe que n√£o precisamos da terceira vers√£o mais recente, mas da segunda, onde h√° uma classe </font></font><code>ConsoleReader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com um m√©todo </font></font><code>readCharacter()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Como o nome indica, esse m√©todo retorna o c√≥digo do caractere pressionado no teclado (enquanto trabalhamos de forma s√≠ncrona, e √© disso que precisamos). O restante √© uma quest√£o t√©cnica: compile uma tabela de correspond√™ncias entre s√≠mbolos e tipos de a√ß√µes ( </font></font><code>Action.Type</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) e, clicando em uma, retorne a outra. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúVoc√™ sabia que nem todas as teclas do teclado podem ser representadas com um caractere? Muitas teclas usam seq√º√™ncias de escape de dois, tr√™s, quatro caracteres diferentes. Como estar com eles?</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deve-se notar que a tarefa de entrada √© complicada se queremos reconhecer ‚Äúteclas sem caracteres‚Äù: setas, teclas F, In√≠cio, Inserir, PgUp / Dn, Fim, Excluir, teclado num√©rico e outros. </font><font style="vertical-align: inherit;">Mas n√£o queremos, portanto continuaremos. </font><font style="vertical-align: inherit;">Vamos criar uma classe </font></font><code>ConsoleInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com os m√©todos de servi√ßo necess√°rios.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleInteractor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> reader = ConsoleReader() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mapper = mapOf( CONFIRM to <span class="hljs-number"><span class="hljs-number">13</span></span>.toChar(), CANCEL to <span class="hljs-number"><span class="hljs-number">27</span></span>.toChar(), EXPLORE_LOCATION to <span class="hljs-string"><span class="hljs-string">'e'</span></span>, FINISH_TURN to <span class="hljs-string"><span class="hljs-string">'f'</span></span>, ACQUIRE to <span class="hljs-string"><span class="hljs-string">'a'</span></span>, LEAVE to <span class="hljs-string"><span class="hljs-string">'l'</span></span>, FORFEIT to <span class="hljs-string"><span class="hljs-string">'f'</span></span>, HIDE to <span class="hljs-string"><span class="hljs-string">'h'</span></span>, DISCARD to <span class="hljs-string"><span class="hljs-string">'d'</span></span>, ) <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = reader.readCharacter().toChar() <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIndexForKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Char</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-string"><span class="hljs-string">"1234567890abcdefghijklmnopqrstuvw"</span></span>.indexOf(key) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Defina o mapa </font></font><code>mapper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o m√©todo </font></font><code>read()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Al√©m disso, forneceremos um m√©todo </font></font><code>getIndexForKey()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usado em situa√ß√µes em que precisamos selecionar um item de uma lista ou cubos de uma m√£o. </font><font style="vertical-align: inherit;">Resta herdar nossa implementa√ß√£o de interface dessa classe </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagrama de classe</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/hv/oh/h_/hvohh_s5evuqa4kwwwhtvvfbsmw.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E, de fato, o c√≥digo: </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConsoleGameInteractor</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ConsoleInteractor</span></span></span></span>(), GameInteractor { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">anyInput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { read() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> key = read() list .filter(Action::isEnabled) .find { mapper[it.type] == key } ?.let { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> it } } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickDiceFromHand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(activePositions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> : Action { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> key = read() actions.forEach { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mapper[it.type] == key &amp;&amp; it.isEnabled) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> it } <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (key) { <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'1'</span></span>..<span class="hljs-string"><span class="hljs-string">'9'</span></span> -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> index = key - <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activePositions.checkPosition(index)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Action(HAND_POSITION, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = index) } } <span class="hljs-string"><span class="hljs-string">'0'</span></span> -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activePositions.checkPosition(<span class="hljs-number"><span class="hljs-number">9</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Action(HAND_POSITION, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = <span class="hljs-number"><span class="hljs-number">9</span></span>) } } <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'a'</span></span>..<span class="hljs-string"><span class="hljs-string">'f'</span></span> -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> allyIndex = key - <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (activePositions.checkAllyPosition(allyIndex)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Action(HAND_ALLY_POSITION, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = allyIndex) } } } } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A implementa√ß√£o de nossos m√©todos √© bastante educada e bem-educada, a fim de n√£o trazer √† tona v√°rias bobagens inadequadas. </font><font style="vertical-align: inherit;">Eles mesmos verificam se a a√ß√£o selecionada est√° ativa e a posi√ß√£o da m√£o selecionada √© inclu√≠da no conjunto de v√°lidos. </font><font style="vertical-align: inherit;">E desejo que todos n√≥s sejamos t√£o educados com as pessoas ao nosso redor.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa onze. </font><font style="vertical-align: inherit;">Sons e m√∫sica</font></font></font> </h2><br>      -?           (,    ,      ),   ,    .        .       ,       ,      (,     ,    ,     ).         ,      (       ),      ,          ( -)  ,     .   ,     ,     . <br><br>   ,         ‚Äî        ,     .    ,              .   ,        .      ,      .       ,    ,    ‚Äî     ,   ‚Äî       ,        .   ,      :  ,  ,       ‚Äî        ,       .    ,   ‚Äî            ,         ‚Äî     .    ?   ,     .          ,        ( , ,     ). <br><br>  , , ,      .      :  , ,   ?      ‚Äî      ,       .      ,                .      ,            (  ‚Äî    ‚Äî   ).     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">freesound.org</a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">onde centenas de outras pessoas fizeram isso por voc√™ h√° muito tempo. </font><font style="vertical-align: inherit;">Preste aten√ß√£o apenas √† licen√ßa: muitos autores s√£o muito sens√≠veis √†s grava√ß√µes de √°udio de sua tosse alta ou moedas jogadas no ch√£o - voc√™ nunca deseja usar sem escr√∫pulos os frutos de seus trabalhos sem pagar o criador original ou sem mencionar seu pseud√¥nimo criativo (√†s vezes muito bizarro) nos coment√°rios. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arraste os arquivos que voc√™ gosta e coloque-os em algum lugar do caminho de classe. </font><font style="vertical-align: inherit;">Para identific√°-los, usaremos a enumera√ß√£o, onde cada inst√¢ncia corresponde a um efeito sonoro.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sound</span></span></span><span class="hljs-class"> </span></span>{ TURN_START, <span class="hljs-comment"><span class="hljs-comment">//Hero starts the turn BATTLE_CHECK_ROLL, //Perform check, type BATTLE_CHECK_SUCCESS, //Check was successful BATTLE_CHECK_FAILURE, //Check failed DIE_DRAW, //Draw die from bag DIE_HIDE, //Remove die to bag DIE_DISCARD, //Remove die to pile DIE_REMOVE, //Remove die entirely DIE_PICK, //Check/uncheck the die TRAVEL, //Move hero to another location ENCOUNTER_STAT, //Hero encounters STAT die ENCOUNTER_DIVINE, //Hero encounters DIVINE die ENCOUNTER_ALLY, //Hero encounters ALLY die ENCOUNTER_WOUND, //Hero encounters WOUND die ENCOUNTER_OBSTACLE, //Hero encounters OBSTACLE die ENCOUNTER_ENEMY, //Hero encounters ENEMY die ENCOUNTER_VILLAIN, //Hero encounters VILLAIN die DEFEAT_OBSTACLE, //Hero defeats OBSTACLE die DEFEAT_ENEMY, //Hero defeats ENEMY die DEFEAT_VILLAIN, //Hero defeats VILLAIN die TAKE_DAMAGE, //Hero takes damage HERO_DEATH, //Hero death CLOSE_LOCATION, //Location closed GAME_VICTORY, //Scenario completed GAME_LOSS, //Scenario failed ERROR, //When something unexpected happens }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como o m√©todo de reprodu√ß√£o de sons varia dependendo da plataforma de hardware, podemos ser abstra√≠dos de uma implementa√ß√£o espec√≠fica usando a interface. </font><font style="vertical-align: inherit;">Por exemplo, este:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SoundPlayer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sound: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Sound</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como as interfaces discutidas anteriormente </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, sua implementa√ß√£o tamb√©m precisa ser passada para a entrada da inst√¢ncia da classe </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Para iniciantes, uma implementa√ß√£o poderia ser assim:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MuteSoundPlayer</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SoundPlayer { override fun play</span></span></span></span>(sound: Sound) { <span class="hljs-comment"><span class="hljs-comment">//Do nothing } }</span></span></code> </pre><br>      ,     . <br>   ,        ,         .   ,    ,      ( ,      )        ( ,  -           ,            ).    ,       (   ),   ,    ,  - . ,  -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">freemusicarchive.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ou </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">soundcloud.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (ou at√© YouTube) e encontre algo ao seu gosto. </font><font style="vertical-align: inherit;">Para desktops, o ambiente √© uma boa escolha - m√∫sica silenciosa e suave, sem uma melodia pronunciada, adequada para criar um plano de fundo. </font><font style="vertical-align: inherit;">Preste aten√ß√£o √† licen√ßa: at√© a m√∫sica de gra√ßa √†s vezes √© escrita por compositores talentosos que merecem, se n√£o uma recompensa monet√°ria, pelo menos reconhecimento universal. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos criar mais uma enumera√ß√£o:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Music</span></span></span><span class="hljs-class"> </span></span>{ SCENARIO_MUSIC_1, SCENARIO_MUSIC_2, SCENARIO_MUSIC_3, }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Da mesma forma, definimos a interface e sua implementa√ß√£o padr√£o. </font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MusicPlayer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(music: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Music</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MuteMusicPlayer</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MusicPlayer { override fun play</span></span></span></span>(music: Music) { <span class="hljs-comment"><span class="hljs-comment">//Do nothing } override fun stop() { //Do nothing } }</span></span></code> </pre><br>  ,      :    ,    .   ,      (/,  ),       . <br><br>      -        .         ,                    <i></i> (singleton).                      .     : <br><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ie/jf/86/iejf862lemxbjw9vm5ozkq7ow4k.png"></a> <br></div></div><br>  <code>Audio</code> ‚Äî     singleton.      ‚Ä¶ ,  <i></i> (facade) ‚Äî    ,      ( )    . ,       ,    -     .  : <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Audio { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> soundPlayer: SoundPlayer = MuteSoundPlayer() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> musicPlayer: MusicPlayer = MuteMusicPlayer() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(soundPlayer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SoundPlayer</span></span></span></span><span class="hljs-function"><span class="hljs-params">, musicPlayer: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MusicPlayer</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.soundPlayer = soundPlayer <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.musicPlayer = musicPlayer } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playSound</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sound: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Sound</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.soundPlayer.play(sound) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playMusic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(music: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Music</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.musicPlayer.play(music) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopMusic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.musicPlayer.stop() }</code> </pre><br>   <code>init()</code> -  -    (   )      ,     .      ,  ,    ‚Äî      . <br><br>  Isso √© tudo.     .     (,    , <i></i> ),   Java    <code>AudioSystem</code>   <code>Clip</code> . ,   ,      - (     classpath, ?): <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.sound.sampled.AudioSystem <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasicSoundPlayer</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SoundPlayer { private fun pathToFile</span></span></span></span>(sound: Sound) = <span class="hljs-string"><span class="hljs-string">"/sound/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${sound.toString().toLowerCase()}</span></span></span><span class="hljs-string">.wav"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sound: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Sound</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> url = javaClass.getResource(pathToFile(sound)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> audioIn = AudioSystem.getAudioInputStream(url) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> clip = AudioSystem.getClip() clip.<span class="hljs-keyword"><span class="hljs-keyword">open</span></span>(audioIn) clip.start() } }</code> </pre><br>  <code>open()</code>   <code>IOException</code> (   -     ‚Äî        -  ),        <code>try-catch</code> ,         ,          . <br><br> <i>¬´   ,  ...¬ª</i> <br><br>      .   ,      (,   mp3)  Java ,          (  ).       ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JLayer</a> .    : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.googlecode.soundlibs<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jlayer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.1.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>       . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasicMusicPlayer</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MusicPlayer { private var currentMusic: Music? = null private var thread: PlayerThread? = null private fun pathToFile</span></span></span></span>(music: Music) = <span class="hljs-string"><span class="hljs-string">"/music/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${music.toString().toLowerCase()}</span></span></span><span class="hljs-string">.mp3"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(music: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Music</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentMusic == music) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } currentMusic = music thread?.finish() Thread.yield() thread = PlayerThread(pathToFile(music)) thread?.start() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { currentMusic = <span class="hljs-literal"><span class="hljs-literal">null</span></span> thread?.finish() } <span class="hljs-comment"><span class="hljs-comment">// Thread responsible for playback private inner class PlayerThread(private val musicPath: String) : Thread() { private lateinit var player: Player private var isLoaded = false private var isFinished = false init { isDaemon = true } override fun run() { loop@ while (!isFinished) { try { player = Player(javaClass.getResource(musicPath).openConnection().apply { useCaches = false }.getInputStream()) isLoaded = true player.play() } catch (ex: Exception) { finish() break@loop } player.close() } } fun finish() { isFinished = true this.interrupt() if (isLoaded) { player.close() } } } }</span></span></code> </pre><br> -,     ,      ,      .       ( <code>PlayerThread</code> ),    ¬´¬ª (),           . -,            ( <code>currentMusic</code> ).        ,        . -,          ‚Äî     ,        <code>finish()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ou at√© que outros threads sejam conclu√≠dos, como j√° mencionado). </font><font style="vertical-align: inherit;">Quarto, embora o c√≥digo acima esteja repleto de sinalizadores e comandos aparentemente desnecess√°rios, ele √© completamente depurado e testado - o player funciona como esperado, n√£o diminui a velocidade do sistema, n√£o interrompe repentinamente at√© a metade, n√£o leva a vazamentos de mem√≥ria, n√£o cont√©m objetos geneticamente modificados, brilha frescura e pureza. </font><font style="vertical-align: inherit;">Pegue-o e use-o com ousadia em seus projetos.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa Doze. </font><font style="vertical-align: inherit;">Localiza√ß√£o</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nosso jogo est√° quase pronto, mas ningu√©m vai jogar. </font></font> Porque <br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"N√£o h√° russo! .. N√£o h√° russo! .. Adicione o idioma russo! .. Desenvolvido por c√£es!" </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra a p√°gina de qualquer jogo de hist√≥ria interessante (especialmente para celular) no site da loja e leia as resenhas. </font><font style="vertical-align: inherit;">Eles v√£o come√ßar a elogiar incr√≠veis gr√°ficos desenhados √† m√£o? </font><font style="vertical-align: inherit;">Ou se maravilhar com o som atmosf√©rico? </font><font style="vertical-align: inherit;">Ou discuta uma hist√≥ria emocionante que √© viciante desde o primeiro minuto e n√£o deixa passar at√© o fim?</font></font><br><br>  N√£o.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Jogadores" insatisfeitos instruir√£o v√°rias unidades e geralmente excluir√£o o jogo. </font><font style="vertical-align: inherit;">E ent√£o eles tamb√©m exigir√£o dinheiro de volta - e tudo isso por uma simples raz√£o. </font><font style="vertical-align: inherit;">Sim, voc√™ esqueceu de traduzir sua obra-prima para todos os 95 idiomas do mundo. </font><font style="vertical-align: inherit;">Ou melhor, aquele cujas operadoras gritam mais alto.</font></font> E √© isso a√≠!  Voc√™ entende?<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meses de trabalho duro, longas noites sem dormir, colapsos nervosos constantes - tudo isso √© um hamster debaixo da cauda. Voc√™ perdeu um grande n√∫mero de jogadores e isso n√£o pode ser corrigido. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ent√£o pense √† frente. Decida sobre o seu p√∫blico-alvo, selecione v√°rios idiomas principais, solicite servi√ßos de tradu√ß√£o ... em geral, fa√ßa tudo o que outras pessoas descreveram mais de uma vez em artigos tem√°ticos (mais espertos que eu). Vamos nos concentrar no lado t√©cnico da quest√£o e falar sobre como localizar o produto sem dor. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeiro entramos nos modelos. Lembre-se, antes que os nomes e descri√ß√µes fossem armazenados como simples </font></font><code>String</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Agora n√£o vai funcionar. Al√©m do idioma padr√£o, voc√™ tamb√©m precisa fornecer tradu√ß√£o para todos os idiomas que planeja oferecer suporte. Por exemplo, assim:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestEnemyTemplate</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EnemyTemplate { override val name = "Test enemy" override val description = "Some enemy standing in your way." override val nameLocalizations = mapOf</span></span></span></span>( <span class="hljs-string"><span class="hljs-string">"ru"</span></span> to <span class="hljs-string"><span class="hljs-string">" -"</span></span>, <span class="hljs-string"><span class="hljs-string">"ar"</span></span> to <span class="hljs-string"><span class="hljs-string">"ÿ®ÿπÿ∂ ÿßŸÑÿπÿØŸà"</span></span>, <span class="hljs-string"><span class="hljs-string">"iw"</span></span> to <span class="hljs-string"><span class="hljs-string">"◊ê◊ô◊ñ◊î ◊ê◊ï◊ô◊ë"</span></span>, <span class="hljs-string"><span class="hljs-string">"zh"</span></span> to <span class="hljs-string"><span class="hljs-string">"‰∏Ä‰∫õÊïµ‰∫∫"</span></span>, <span class="hljs-string"><span class="hljs-string">"ua"</span></span> to <span class="hljs-string"><span class="hljs-string">"—ñ "</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> descriptionLocalizations = mapOf( <span class="hljs-string"><span class="hljs-string">"ru"</span></span> to <span class="hljs-string"><span class="hljs-string">" - ."</span></span>, <span class="hljs-string"><span class="hljs-string">"ar"</span></span> to <span class="hljs-string"><span class="hljs-string">"ŸàÿµŸÅ ÿßŸÑÿπÿØŸà"</span></span>, <span class="hljs-string"><span class="hljs-string">"iw"</span></span> to <span class="hljs-string"><span class="hljs-string">"◊™◊ô◊ê◊ï◊® ◊î◊ê◊ï◊ô◊ë"</span></span>, <span class="hljs-string"><span class="hljs-string">"zh"</span></span> to <span class="hljs-string"><span class="hljs-string">"‰∏Ä‰∫õÊïµ‰∫∫ÁöÑÊèèËø∞"</span></span>, <span class="hljs-string"><span class="hljs-string">"ua"</span></span> to <span class="hljs-string"><span class="hljs-string">" —ó —ñ   ."</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> traits = listOf&lt;Trait&gt;() }</code> </pre><br>      .       - ,     ‚Äî     .             .   ,    . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocalizedString</span></span></span></span>(defaultValue: String, localizations: Map&lt;String, String&gt;) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: String = defaultValue <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> values: Map&lt;String, String&gt; = localizations.toMap() <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lang: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = values.getOrDefault(lang, <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(other: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> = <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> === other -&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span> other !<span class="hljs-keyword"><span class="hljs-keyword">is</span></span> LocalizedString -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> == other.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.hashCode() } }</code> </pre><br>      . <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateEnemy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">EnemyTemplate</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = Enemy().apply { name = LocalizedString(template.name, template.nameLocalizations) description = LocalizedString(template.description, template.descriptionLocalizations) template.traits.forEach { addTrait(it) } }</code> </pre><br> ,          .   ,     . <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> language = Locale.getDefault().language <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enemyName = enemy.name[language]</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em nosso exemplo, fornecemos uma vers√£o simplificada da localiza√ß√£o, na qual apenas o idioma √© levado em considera√ß√£o. Em geral, os objetos de classe </font></font><code>Locale</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tamb√©m definem o pa√≠s e a regi√£o. Se isso for importante no seu aplicativo, o seu </font></font><code>LocalizedString</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser√° um pouco diferente, mas estamos felizes com isso de qualquer maneira. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lidamos com os modelos, resta localizar as linhas de servi√ßo usadas em nosso aplicativo. Felizmente, ele </font></font><code>ResourceBundle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j√° cont√©m todos os mecanismos necess√°rios. S√≥ √© necess√°rio preparar arquivos com tradu√ß√µes e alterar a maneira como eles s√£o baixados.</font></font><br><br><pre> <code class="plaintext hljs"># Game status messages choose_dice_perform_check=    : end_of_turn_discard_extra= :   : end_of_turn_discard_optional= :    : choose_action_before_exploration=,  : choose_action_after_exploration= .   ? encounter_physical=  .   . encounter_somatic=  .   . encounter_mental=  .   . encounter_verbal=  .   . encounter_divine=  .    : die_acquire_success=   ! die_acquire_failure=    . game_loss_out_of_time=    # Die types physical= somatic= mental= verbal= divine= ally= wound= enemy= villain= obstacle= # Hero types and descriptions brawler= hunter= # Various labels avg= bag= bag_size=  class= closed= discard= empty= encountered=  fail= hand= heros_turn= %s max= min= perform_check= : pile= received_new_die=   result= success= sum= time= total= # Action names and descriptions action_confirm_key=ENTER action_confirm_name= action_cancel_key=ESC action_cancel_name= action_explore_location_key=E action_explore_location_name= action_finish_turn_key=F action_finish_turn_name=  action_hide_key=H action_bag_name= action_discard_key=D action_discard_name= action_acquire_key=A action_acquire_name= action_leave_key=L action_leave_name= action_forfeit_key=F action_forfeit_name=</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu n√£o direi para o registro: escrever frases em russo √© muito mais dif√≠cil do que em ingl√™s. Se houver um requisito para usar um substantivo em um caso definitivo ou para se separar do g√™nero (e esses requisitos necessariamente permanecer√£o), voc√™ precisar√° suar muito antes de obter um resultado que, primeiro, atenda aos requisitos e, em segundo lugar, n√£o pare√ßa uma tradu√ß√£o mec√¢nica feita por um ciborgue com c√©rebros de frango. Observe tamb√©m que n√£o alteramos as teclas de a√ß√£o - como antes, os mesmos caracteres ser√£o usados ‚Äã‚Äãpara execut√°-los como no idioma ingl√™s (que, a prop√≥sito, n√£o funcionar√° em um layout de teclado diferente do latim, mas esse n√£o √© o nosso neg√≥cio. - por enquanto, vamos deixar como est√£o).</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertiesStringLoader</span></span></span></span>(locale: Locale) : StringLoader { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> properties = ResourceBundle.getBundle(<span class="hljs-string"><span class="hljs-string">"text.strings"</span></span>, locale) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = properties.getString(key) ?: <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre>  . <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como j√° mencionado, </font></font><code>ResourceBundle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ele pr√≥prio assumir√° a responsabilidade de encontrar entre os arquivos de localiza√ß√£o o que mais se aproxima do local atual. </font><font style="vertical-align: inherit;">E se ele n√£o encontrar, ele pegar√° o arquivo padr√£o ( </font></font><code>string.properties</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font><font style="vertical-align: inherit;">E tudo vai ficar bem ...</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim! </font><font style="vertical-align: inherit;">L√° estava!</font></font></b> <div class="spoiler_text"> ,  Unicode   <code>.properties</code>     Java 9.       ISO-8859-1 ‚Äî <code>ResourceBundle</code>     .  ,     ,           ‚Äî     .       Unicode- ‚Äî ,  ,   : <code>'\uXXXX'</code> .    ,      ,   Java       <b>native2ascii</b> ,        .         : <br><br><pre> <code class="plaintext hljs"># Game status messages choose_dice_perform_check=\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0443\u0431\u0438\u043a\u0438 \u0434\u043b\u044f \u043f\u0440\u043e\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438: end_of_turn_discard_extra=\u041a\u041e\u041d\u0415\u0426 \u0425\u041e\u0414\u0410: \u0421\u0431\u0440\u043e\u0441\u044c\u0442\u0435 \u043b\u0438\u0448\u043d\u0438\u0435 \u043a\u0443\u0431\u0438\u043a\u0438: end_of_turn_discard_optional=\u041a\u041e\u041d\u0415\u0426 \u0425\u041e\u0414\u0410: \u0421\u0431\u0440\u043e\u0441\u044c\u0442\u0435 \u043a\u0443\u0431\u0438\u043a\u0438 \u043f\u043e \u0436\u0435\u043b\u0430\u043d\u0438\u044e: choose_action_before_exploration=\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435, \u0447\u0442\u043e \u0434\u0435\u043b\u0430\u0442\u044c: choose_action_after_exploration=\u0418\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u043e. \u0427\u0442\u043e \u0434\u0435\u043b\u0430\u0442\u044c \u0434\u0430\u043b\u044c\u0448\u0435? encounter_physical=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u0424\u0418\u0417\u0418\u0427\u0415\u0421\u041a\u0418\u0419 \u043a\u0443\u0431\u0438\u043a. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0440\u043e\u0439\u0442\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443. encounter_somatic=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u0421\u041e\u041c\u0410\u0422\u0418\u0427\u0415\u0421\u041a\u0418\u0419 \u043a\u0443\u0431\u0438\u043a. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0440\u043e\u0439\u0442\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443. encounter_mental=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u041c\u0415\u041d\u0422\u0410\u041b\u042c\u041d\u042b\u0419 \u043a\u0443\u0431\u0438\u043a. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0440\u043e\u0439\u0442\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443. encounter_verbal=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u0412\u0415\u0420\u0411\u0410\u041b\u042c\u041d\u042b\u0419 \u043a\u0443\u0431\u0438\u043a. \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u0440\u043e\u0439\u0442\u0438 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0443. encounter_divine=\u0412\u0441\u0442\u0440\u0435\u0447\u0435\u043d \u0411\u041e\u0416\u0415\u0421\u0422\u0412\u0415\u041d\u041d\u042b\u0419 \u043a\u0443\u0431\u0438\u043a. \u041c\u043e\u0436\u043d\u043e \u0432\u0437\u044f\u0442\u044c \u0431\u0435\u0437 \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438: die_acquire_success=\u0412\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u0438 \u043d\u043e\u0432\u044b\u0439 \u043a\u0443\u0431\u0438\u043a! die_acquire_failure=\u0412\u0430\u043c \u043d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043a\u0443\u0431\u0438\u043a. game_loss_out_of_time=\u0423 \u0432\u0430\u0441 \u0437\u0430\u043a\u043e\u043d\u0447\u0438\u043b\u043e\u0441\u044c \u0432\u0440\u0435\u043c\u044f</code> </pre><br>           .     ‚Äî  .    ‚Äî  .  ,  IDE    ( )  ¬´ ¬ª,       ‚Äî            -  (  ),    IDE,    . <br><br>  ,  .  <code>getBundle()</code> ,    ,   ,      <code>ResourceBundle.Control</code> ‚Äî -         . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertiesStringLoader</span></span></span></span>(locale: Locale) : StringLoader { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> properties = ResourceBundle.getBundle( <span class="hljs-string"><span class="hljs-string">"text.strings"</span></span>, locale, Utf8ResourceBundleControl()) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = properties.getString(key) ?: <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre><br> , ,  : <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Utf8ResourceBundleControl</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ResourceBundle.Control</span></span></span></span>() { <span class="hljs-meta"><span class="hljs-meta">@Throws(IllegalAccessException::class, InstantiationException::class, IOException::class)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newBundle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(baseName: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, locale: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Locale</span></span></span></span><span class="hljs-function"><span class="hljs-params">, format: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, loader: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ClassLoader</span></span></span></span><span class="hljs-function"><span class="hljs-params">, reload: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ResourceBundle? { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bundleName = toBundleName(baseName, locale) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (format) { <span class="hljs-string"><span class="hljs-string">"java.class"</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.newBundle(baseName, locale, format, loader, reload) <span class="hljs-string"><span class="hljs-string">"java.properties"</span></span> -&gt; with((<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"://"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> bundleName) <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> toResourceName(bundleName, <span class="hljs-string"><span class="hljs-string">"properties"</span></span>)) ?: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> { reload -&gt; reload(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, loader) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; loader.getResourceAsStream(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) }?.let { stream -&gt; InputStreamReader(stream, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>).use { r -&gt; PropertyResourceBundle(r) } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Unknown format: </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$format</span></span></span><span class="hljs-string">"</span></span>) } } <span class="hljs-meta"><span class="hljs-meta">@Throws(IOException::class)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(resourceName: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, classLoader: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ClassLoader</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: InputStream { classLoader.getResource(resourceName)?.let { url -&gt; url.openConnection().let { connection -&gt; connection.useCaches = <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> connection.getInputStream() } } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> IOException(<span class="hljs-string"><span class="hljs-string">"Unable to load data!"</span></span>) } }</code> </pre><br>    ,   ‚Ä¶ ,  ( ) ‚Äî   (  Kotlin    ).    ‚Äî ,       <code>.properties</code>   UTF-8  - . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para testar a opera√ß√£o do aplicativo em diferentes idiomas, n√£o √© necess√°rio alterar as configura√ß√µes do sistema operacional - basta especificar o idioma necess√°rio ao iniciar o JRE: </font></font><br><br><pre> <code class="dos hljs">java -Duser.language=ru -jar path_to_project\Dice\target\dice-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>-jar-with-dependencies.jar</code> </pre><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ ainda estiver trabalhando no Windows, espere problemas</font></font></b> <div class="spoiler_text">  ,   Windows (cmd.exe)     437 (   DOSLatinUS),     ‚Äî      .  , UTF-8 ,        : <br><br><pre> <code class="dos hljs"><span class="hljs-built_in"><span class="hljs-built_in">chcp</span></span> <span class="hljs-number"><span class="hljs-number">65001</span></span></code> </pre> <br>    Java  ,    ,       .     : <br><br><pre> <code class="dos hljs">java -Dfile.encoding=UTF-<span class="hljs-number"><span class="hljs-number">8</span></span> -Duser.language=ru -jar path_to_project\Dice\target\dice-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>-jar-with-dependencies.jar</code> </pre><br>   ,      ,  Unicode- (, Lucida Console) <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Depois de todas as nossas emocionantes aventuras, o resultado pode ser demonstrado com orgulho ao p√∫blico em geral e declarado em voz alta: "N√≥s n√£o somos c√£es!" </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Op√ß√£o fiel racial</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ap/92/qd/ap92qdlfulptfgjg_-ms3ejqddm.png"></a> <br></div></div><br>  E isso √© bom. <br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passo Treze </font><font style="vertical-align: inherit;">Juntando tudo</font></font></font> </h2><br>  ,  , ,                . -,       ,       . -,     ,           . -,       (       ,      ),     , ,    ‚Äî      (   , ?). <br><br>          .   ,  <code>main()</code>   ,    .  Vamos precisar de: <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> roteiro e terreno; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Her√≥is </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implementa√ß√£o de interface </font></font><code>GameInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implementa√ß√£o de interfaces </font></font><code>GameRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>StringLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">implementa√ß√£o de interfaces </font></font><code>SoundPlayer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>MusicPlayer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">classe de objecto </font></font><code>Game</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">;</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> uma garrafa de champanhe. </font></font></li></ul><br>  Vamos l√°! <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(args: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Array</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { Audio.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(BasicSoundPlayer(), BasicMusicPlayer()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> loader = PropertiesStringLoader(Locale.getDefault()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> renderer = ConsoleGameRenderer(loader) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> interactor = ConsoleGameInteractor() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> template = TestScenarioTemplate() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> scenario = generateScenario(template, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> locations = generateLocations(template, <span class="hljs-number"><span class="hljs-number">1</span></span>, heroes.size) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> heroes = listOf( generateHero(Hero.Type.BRAWLER, <span class="hljs-string"><span class="hljs-string">"Brawler"</span></span>), generateHero(Hero.Type.HUNTER, <span class="hljs-string"><span class="hljs-string">"Hunter"</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> game = Game(renderer, interactor, scenario, locations, heroes) game.start() }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lan√ßamos e desfrutamos do primeiro prot√≥tipo em funcionamento. </font><font style="vertical-align: inherit;">L√° vai voc√™.</font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passo quatorze. </font><font style="vertical-align: inherit;">Saldo do jogo</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ummm ... </font></font><br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Passo quinze. </font><font style="vertical-align: inherit;">Testes</font></font></font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora que a maior parte do c√≥digo do primeiro prot√≥tipo em funcionamento foi escrita, seria bom adicionar alguns testes de unidade ... </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Como? </font><font style="vertical-align: inherit;">Agora mesmo? </font><font style="vertical-align: inherit;">Sim, os testes tiveram que ser escritos no in√≠cio e depois o c√≥digo! ‚Äù </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muitos leitores percebem, com raz√£o, que escrever testes de unidade deve preceder o desenvolvimento de c√≥digo de trabalho ( </font></font><abbr title="Test-Driven Development"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TDD</font></font></abbr>    ).  :      ,    -  ,    .  -         : ¬´   ,     ‚Äî      ¬ª‚Ä¶           .       (        ),      . ,    (  ,        ), ,        (,         ), ,          (-,    ),  ,         ‚Äî    . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos apenas dizer: muitos programadores (especialmente iniciantes) negligenciam os testes. </font><font style="vertical-align: inherit;">Muitos se justificam dizendo que a funcionalidade de seus aplicativos √© mal coberta por testes. </font><font style="vertical-align: inherit;">Por exemplo, √© muito mais f√°cil iniciar o aplicativo e ver se tudo est√° em ordem com a apar√™ncia e a intera√ß√£o, em vez de cercar constru√ß√µes complexas com a participa√ß√£o de estruturas especializadas para testar a interface do usu√°rio (e existem). </font><font style="vertical-align: inherit;">E eu vou lhe dizer quando eu estava implementando as interfaces </font></font><code>Renderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- fiz exatamente isso. </font><font style="vertical-align: inherit;">No entanto, existem m√©todos no nosso c√≥digo para os quais o conceito de teste de unidade √© √≥timo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por exemplo, geradores. </font><font style="vertical-align: inherit;">E isso √© tudo. </font><font style="vertical-align: inherit;">Esta √© uma caixa preta ideal: modelos s√£o enviados para a entrada, objetos do mundo do jogo s√£o obtidos na sa√≠da. </font><font style="vertical-align: inherit;">H√° algo acontecendo l√° dentro, mas precisamos test√°-lo. </font><font style="vertical-align: inherit;">Por exemplo, assim:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DieGeneratorTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGetMaxLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ assertEquals(<span class="hljs-string"><span class="hljs-string">"Max level should be 3"</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, DieGeneratorKt.getMaxLevel()); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testDieGenerationSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ DieTypeFilter filter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.ALLY); List&lt;? extends List&lt;Integer&gt;&gt; allowedSizes = Arrays.asList( <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, Arrays.asList(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>), Arrays.asList(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), Arrays.asList(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>) ); IntStream.rangeClosed(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>).forEach(level -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = DieGeneratorKt.generateDie(filter, level).getSize(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect level of die generated: "</span></span> + size, allowedSizes.get(level).contains(size)); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die size: "</span></span> + size, size &gt;= <span class="hljs-number"><span class="hljs-number">4</span></span>); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die size: "</span></span> + size, size &lt;= <span class="hljs-number"><span class="hljs-number">12</span></span>); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die size: "</span></span> + size, size % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>); } }); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testDieGenerationType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ List&lt;Die.Type&gt; allowedTypes1 = Arrays.asList(Die.Type.PHYSICAL); List&lt;Die.Type&gt; allowedTypes2 = Arrays.asList(Die.Type.PHYSICAL, Die.Type.SOMATIC, Die.Type.MENTAL, Die.Type.VERBAL); List&lt;Die.Type&gt; allowedTypes3 = Arrays.asList(Die.Type.ALLY, Die.Type.VILLAIN, Die.Type.ENEMY); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { Die.Type type1 = DieGeneratorKt.generateDie(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.PHYSICAL), <span class="hljs-number"><span class="hljs-number">1</span></span>).getType(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die type: "</span></span> + type1, allowedTypes1.contains(type1)); Die.Type type2 = DieGeneratorKt.generateDie(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatsDieTypeFilter(), <span class="hljs-number"><span class="hljs-number">1</span></span>).getType(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die type: "</span></span> + type2, allowedTypes2.contains(type2)); Die.Type type3 = DieGeneratorKt.generateDie(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MultipleDieTypeFilter(Die.Type.ALLY, Die.Type.VILLAIN, Die.Type.ENEMY), <span class="hljs-number"><span class="hljs-number">1</span></span>).getType(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect die type: "</span></span> + type3, allowedTypes3.contains(type3)); } } }</code> </pre><br>  Ou ent√£o: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BagGeneratorTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGenerateBag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ BagTemplate template1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BagTemplate(); template1.addPlan(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.PHYSICAL)); template1.addPlan(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.SOMATIC)); template1.setFixedDieCount(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); BagTemplate template2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BagTemplate(); template2.addPlan(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.DIVINE)); template2.setFixedDieCount(<span class="hljs-number"><span class="hljs-number">5</span></span>); BagTemplate template3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BagTemplate(); template3.addPlan(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleDieTypeFilter(Die.Type.ALLY)); template3.setFixedDieCount(<span class="hljs-number"><span class="hljs-number">50</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { Bag bag1 = BagGeneratorKt.generateBag(template1, <span class="hljs-number"><span class="hljs-number">1</span></span>); assertTrue(<span class="hljs-string"><span class="hljs-string">"Incorrect bag size: "</span></span> + bag1.getSize(), bag1.getSize() &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span> &amp;&amp; bag1.getSize() &lt;= <span class="hljs-number"><span class="hljs-number">15</span></span>); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect number of SOMATIC dice"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, bag1.examine().stream().filter(d -&gt; d.getType() == Die.Type.SOMATIC).count()); Bag bag2 = BagGeneratorKt.generateBag(template2, <span class="hljs-number"><span class="hljs-number">1</span></span>); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect bag size"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, bag2.getSize()); Bag bag3 = BagGeneratorKt.generateBag(template3, <span class="hljs-number"><span class="hljs-number">1</span></span>); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect bag size"</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, bag3.getSize()); List&lt;Die.Type&gt; dieTypes3 = bag3.examine().stream().map(Die::getType).distinct().collect(Collectors.toList()); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect die types"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, dieTypes3.size()); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect die types"</span></span>, Die.Type.ALLY, dieTypes3.get(<span class="hljs-number"><span class="hljs-number">0</span></span>)); } } }</code> </pre><br>   : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocationGeneratorTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testLocationGeneration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, LocationTemplate template)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"Template: "</span></span> + template.getName()); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect template type"</span></span>, name, template.getName()); IntStream.rangeClosed(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>).forEach(level -&gt; { Location location = LocationGeneratorKt.generateLocation(template, level); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect location type"</span></span>, name, location.getName().get(<span class="hljs-string"><span class="hljs-string">""</span></span>)); assertTrue(<span class="hljs-string"><span class="hljs-string">"Location not open by default"</span></span>, location.isOpen()); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> closingDifficulty = location.getClosingDifficulty(); assertTrue(<span class="hljs-string"><span class="hljs-string">"Closing difficulty too small"</span></span>, closingDifficulty &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect closing difficulty"</span></span>, closingDifficulty, template.getBasicClosingDifficulty() + level * <span class="hljs-number"><span class="hljs-number">2</span></span>); Bag bag = location.getBag(); assertNotNull(<span class="hljs-string"><span class="hljs-string">"Bag is null"</span></span>, bag); assertTrue(<span class="hljs-string"><span class="hljs-string">"Bag is empty"</span></span>, location.getBag().getSize() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); Deck&lt;Enemy&gt; enemies = location.getEnemies(); assertNotNull(<span class="hljs-string"><span class="hljs-string">"Enemies are null"</span></span>, enemies); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect enemy threat count"</span></span>, enemies.getSize(), template.getEnemyCardsCount()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bag.drawOfType(Die.Type.ENEMY) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { assertTrue(<span class="hljs-string"><span class="hljs-string">"Enemy cards not specified"</span></span>, enemies.getSize() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); } Deck&lt;Obstacle&gt; obstacles = location.getObstacles(); assertNotNull(<span class="hljs-string"><span class="hljs-string">"Obstacles are null"</span></span>, obstacles); assertEquals(<span class="hljs-string"><span class="hljs-string">"Incorrect obstacle threat count"</span></span>, obstacles.getSize(), template.getObstacleCardsCount()); List&lt;SpecialRule&gt; specialRules = location.getSpecialRules(); assertNotNull(<span class="hljs-string"><span class="hljs-string">"SpecialRules are null"</span></span>, specialRules); }); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGenerateLocation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ testLocationGeneration(<span class="hljs-string"><span class="hljs-string">"Test Location"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestLocationTemplate()); testLocationGeneration(<span class="hljs-string"><span class="hljs-string">"Test Location 2"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestLocationTemplate2()); } }</code> </pre><br> <i>¬´, , !  ? Java???¬ª</i> <br><br>  .          ,      , , . ,                ,       <s>   </s>         (    ,             ,      ).    -     -  ,      :             (    ?). <br><br>  . ,  <code>HandMaskRule</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e seus herdeiros? Agora imagine que, em algum momento, para usar a habilidade, o her√≥i precisa pegar tr√™s dados da m√£o e os tipos desses dados est√£o ocupados por restri√ß√µes severas (por exemplo, ‚Äúo primeiro dado deve ser azul, verde ou branco, o segundo - amarelo, branco ou azul, e o terceiro - azul ou roxo "- voc√™ sente dificuldade?). Como abordar a implementa√ß√£o de classe? Bem ... para iniciantes, voc√™ pode decidir sobre os par√¢metros de entrada e sa√≠da. Obviamente, voc√™ precisa que a classe aceite tr√™s matrizes (ou conjuntos), cada uma contendo tipos v√°lidos para, respectivamente, o primeiro, o segundo e o terceiro cubos, respectivamente. E depois o que? Rebentando? Recurs√µes? E se eu perder alguma coisa? Fa√ßa uma entrada profunda. Agora adie a implementa√ß√£o dos m√©todos de classe e escreva um teste - j√° que os requisitos s√£o simples, compreens√≠veis e bem formaliz√°veis.E melhor escrever alguns testes ... Mas vamos considerar um, aqui como por exemplo:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TripleDieHandMaskRuleTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Hand hand; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ hand = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hand(<span class="hljs-number"><span class="hljs-number">10</span></span>); hand.addDie(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Die(Die.Type.PHYSICAL, <span class="hljs-number"><span class="hljs-number">4</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//0 hand.addDie(new Die(Die.Type.PHYSICAL, 4)); //1 hand.addDie(new Die(Die.Type.SOMATIC, 4)); //2 hand.addDie(new Die(Die.Type.SOMATIC, 4)); //3 hand.addDie(new Die(Die.Type.MENTAL, 4)); //4 hand.addDie(new Die(Die.Type.MENTAL, 4)); //5 hand.addDie(new Die(Die.Type.VERBAL, 4)); //6 hand.addDie(new Die(Die.Type.VERBAL, 4)); //7 hand.addDie(new Die(Die.Type.DIVINE, 4)); //8 hand.addDie(new Die(Die.Type.DIVINE, 4)); //9 hand.addDie(new Die(Die.Type.ALLY, 4)); //A (0) hand.addDie(new Die(Die.Type.ALLY, 4)); //B (1) } @Test public void testRule1() { HandMaskRule rule = new TripleDieHandMaskRule( hand, new Die.Type[]{Die.Type.PHYSICAL, Die.Type.SOMATIC}, new Die.Type[]{Die.Type.MENTAL, Die.Type.VERBAL}, new Die.Type[]{Die.Type.PHYSICAL, Die.Type.ALLY} ); HandMask mask = new HandMask(); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertTrue("Should be on", rule.isPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 2)); assertTrue("Should be on", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertTrue("Should be on", rule.isPositionActive(mask, 5)); assertTrue("Should be on", rule.isPositionActive(mask, 6)); assertTrue("Should be on", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertFalse("Rule should not be met yet", rule.checkMask(mask)); mask.addPosition(0); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertTrue("Should be on", rule.isPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 2)); assertTrue("Should be on", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertTrue("Should be on", rule.isPositionActive(mask, 5)); assertTrue("Should be on", rule.isPositionActive(mask, 6)); assertTrue("Should be on", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertFalse("Rule should not be met yet", rule.checkMask(mask)); mask.addPosition(4); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertTrue("Should be on", rule.isPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 2)); assertTrue("Should be on", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertFalse("Should be off", rule.isPositionActive(mask, 5)); assertFalse("Should be off", rule.isPositionActive(mask, 6)); assertFalse("Should be off", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertFalse("Rule should not be met yet", rule.checkMask(mask)); mask.addAllyPosition(0); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertFalse("Ally should be off", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertFalse("Should be off", rule.isPositionActive(mask, 1)); assertFalse("Should be off", rule.isPositionActive(mask, 2)); assertFalse("Should be off", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertFalse("Should be off", rule.isPositionActive(mask, 5)); assertFalse("Should be off", rule.isPositionActive(mask, 6)); assertFalse("Should be off", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertTrue("Rule should be met", rule.checkMask(mask)); mask.removePosition(0); assertTrue("Ally should be on", rule.isAllyPositionActive(mask, 0)); assertFalse("Ally should be off", rule.isAllyPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 0)); assertTrue("Should be on", rule.isPositionActive(mask, 1)); assertTrue("Should be on", rule.isPositionActive(mask, 2)); assertTrue("Should be on", rule.isPositionActive(mask, 3)); assertTrue("Should be on", rule.isPositionActive(mask, 4)); assertFalse("Should be off", rule.isPositionActive(mask, 5)); assertFalse("Should be off", rule.isPositionActive(mask, 6)); assertFalse("Should be off", rule.isPositionActive(mask, 7)); assertFalse("Should be off", rule.isPositionActive(mask, 8)); assertFalse("Should be off", rule.isPositionActive(mask, 9)); assertFalse("Rule should not be met again", rule.checkMask(mask)); } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso √© cansativo, mas n√£o tanto quanto parece, at√© voc√™ come√ßar (em algum momento, torna-se ainda mais divertido). Mas, depois de escrever esse teste (e alguns outros, em diferentes ocasi√µes), voc√™ subitamente se sentir√° calmo e autoconfiante. Agora, nenhum erro de digita√ß√£o pode estragar seu m√©todo e levar a surpresas desagrad√°veis ‚Äã‚Äãque s√£o muito mais dif√≠ceis de testar manualmente. Pouco a pouco, lentamente, come√ßamos a implementar os m√©todos necess√°rios da classe. E no final, executamos o teste para garantir que cometemos algum erro. Encontre o ponto do problema e reescreva. Repita at√© terminar.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TripleDieHandMaskRule</span></span></span></span>( hand: Hand, types1: Array&lt;Die.Type&gt;, types2: Array&lt;Die.Type&gt;, types3: Array&lt;Die.Type&gt;) : HandMaskRule(hand) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types1 = types1.toSet() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types2 = types2.toSet() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types3 = types3.toSet() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mask.positionCount + mask.allyPositionCount != <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getCheckedDice(mask).asSequence() .filter { it.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 } .any { d1 -&gt; getCheckedDice(mask) .filter { d2 -&gt; d2 !== d1 } .filter { it.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 } .any { d2 -&gt; getCheckedDice(mask) .filter { d3 -&gt; d3 !== d1 } .filter { d3 -&gt; d3 !== d2 } .any { it.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 } } } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mask.checkPosition(position)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> die = hand.dieAt(position) ?: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (mask.positionCount + mask.allyPositionCount) { <span class="hljs-number"><span class="hljs-number">0</span></span> -&gt; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 <span class="hljs-number"><span class="hljs-number">1</span></span> -&gt; with(getCheckedDice(mask).first()) { (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; (die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3)) || (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; (die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3)) || (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; (die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2)) } <span class="hljs-number"><span class="hljs-number">2</span></span>-&gt; with(getCheckedDice(mask)) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> d2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>] (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3) || (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2) || (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; die.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1) } <span class="hljs-number"><span class="hljs-number">3</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isAllyPositionActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mask: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HandMask</span></span></span></span><span class="hljs-function"><span class="hljs-params">, position: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mask.checkAllyPosition(position)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hand.allyDieAt(position) == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (mask.positionCount + mask.allyPositionCount) { <span class="hljs-number"><span class="hljs-number">0</span></span> -&gt; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 <span class="hljs-number"><span class="hljs-number">1</span></span> -&gt; with(getCheckedDice(mask).first()) { (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; (ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3)) || (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; (ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3)) || (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; (ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 || ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2)) } <span class="hljs-number"><span class="hljs-number">2</span></span>-&gt; with(getCheckedDice(mask)) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> d2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>] (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3) || (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2) || (d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1) || (d2.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types2 &amp;&amp; d1.type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types3 &amp;&amp; ALLY <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> types1) } <span class="hljs-number"><span class="hljs-number">3</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } }</code> </pre><br>     ,      ‚Äî    .    ,            . <br><br> <i>¬´  &lt;...&gt;  &lt;...&gt;  &lt;...&gt;  &lt;...&gt;. ! &lt;...&gt; ! &lt;...&gt;  !¬ª</i> <br><br><h2> <font color="#0474a0"> . </font> </h2><br>   ,           ‚Äî              ,    .       ,       .       . <br><br>      .         : <br><br><ul><li>  : ,  , -       ( <b>core</b> ); </li><li>  , ,    ‚Äî     ¬´¬ª ( <b>adventure</b> ); </li><li>   ,    :    ‚Äî   ( <b>cli</b> ). </li></ul><br>             : <br><br><div class="spoiler"> <b class="spoiler_title">    ,          </b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/ci/t5/gm/cit5gmpnmhdsrzoprl0fagpzpw8.png"></a> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie projetos adicionais e transfira a classe correspondente. </font><font style="vertical-align: inherit;">E s√≥ precisamos configurar corretamente a intera√ß√£o dos projetos entre si. </font><font style="vertical-align: inherit;">Projeto </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">principal</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Este projeto √© um mecanismo puro. </font><font style="vertical-align: inherit;">Todas as classes espec√≠ficas foram transferidas para outros projetos - apenas a funcionalidade b√°sica, o n√∫cleo, permaneceu. </font><font style="vertical-align: inherit;">Biblioteca se voc√™ quiser. </font><font style="vertical-align: inherit;">N√£o h√° mais uma classe de inicializa√ß√£o, n√£o h√° nem a necessidade de criar um pacote. </font><font style="vertical-align: inherit;">As montagens deste projeto ser√£o hospedadas no reposit√≥rio local do Maven (mais sobre isso mais tarde) e usadas por outros projetos como depend√™ncias. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O arquivo </font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© o seguinte:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>my.company<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>dice-core<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-stdlib<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>junit<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>junit-dep<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>4.8.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>test<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- other Kotlin setup --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span>UTF-8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.3.20<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A partir de agora iremos colet√°-lo assim: </font></font><br><br><pre> <code class="bash hljs">mvn -f <span class="hljs-string"><span class="hljs-string">"path_to_project/DiceCore/pom.xml"</span></span> install</code> </pre><br> <b> Cli</b> <br>       ‚Äî        .     .        ,    ,      (       ,        ‚Äî   ).      (,  .). <br><br>   <code>pom.xml</code>     : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>my.company<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>dice-cli<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>kotlin-stdlib<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${kotlin.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>my.company<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>dice-core<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.fusesource.jansi<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jansi<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.17.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>jline<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jline<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.14.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.googlecode.soundlibs<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jlayer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.1.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- other Kotlin setup --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-assembly-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>package<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>single<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRefs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRef</span></span></span><span class="hljs-tag">&gt;</span></span>jar-with-dependencies<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRef</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">descriptorRefs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span>my.company.dice.MainKt<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span>UTF-8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project.build.sourceEncoding</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maven.compiler.target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.3.20<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">kotlin.compiler.incremental</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>           ‚Äî   . <br><br> <b></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bem, finalmente, em um projeto separado, retiramos o enredo. Ou seja, todos os cen√°rios, terrenos, inimigos e outros objetos √∫nicos do mundo do jogo que a equipe do departamento de cen√°rios da sua empresa possa imaginar (bem, ou at√© agora apenas nossa pr√≥pria imagina√ß√£o doentia - ainda somos o √∫nico designer de jogos na √°rea). A id√©ia √© agrupar os scripts em conjuntos (aventuras) e distribuir cada um desses conjuntos como um projeto separado (semelhante √† maneira como √© feito no mundo dos jogos de tabuleiro e de v√≠deo). Ou seja, colete os arquivos jar e coloque-os em uma pasta separada para que o mecanismo do jogo verifique essa pasta e conecte automaticamente todas as aventuras contidas nela. No entanto, a implementa√ß√£o t√©cnica dessa abordagem est√° repleta de enormes dificuldades.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por onde come√ßar? Bem, primeiro, pelo fato de distribuirmos modelos na forma de classes java espec√≠ficas (sim, me bata e me repreenda - eu previ isso). E, nesse caso, essas classes devem estar no caminho de classe do aplicativo na inicializa√ß√£o. Impor esse requisito n√£o √© dif√≠cil - voc√™ registra explicitamente seus arquivos jar na vari√°vel de ambiente apropriada (a partir do Java 6, voc√™ pode at√© usar </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caracteres curinga</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> * </font><font style="vertical-align: inherit;">).</font></font><br><br><pre> <code class="bash hljs">java -classpath <span class="hljs-string"><span class="hljs-string">"path_to_project/DiceCli/target/adventures/*"</span></span> -jar path_to_project/DiceCli/target/dice-1.0-jar-with-dependencies.jar</code> </pre><br> <i>¬´,  ?    -jar  -classpath !¬ª</i> <br><br>     . Classpath   jar-       <code>META-INF/MANIFEST.MF</code> (    ‚Äî <code>Claspath:</code> ).  ,       ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">maven-compiler-plugin</a> ,   , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">maven-assembly-plugin</a> ).   wildcards  , ,   ‚Äî       jar-.  ,   ,     . <br><br>  ,    .  ,       .    <code>adventures/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">voc√™ pode jogar qualquer n√∫mero de aventuras e, assim, todas elas ficaram vis√≠veis para o mecanismo do jogo durante a execu√ß√£o. </font><font style="vertical-align: inherit;">Infelizmente, a funcionalidade aparentemente √≥bvia vai al√©m das representa√ß√µes padr√£o do mundo Java. </font><font style="vertical-align: inherit;">Portanto, n√£o √© bem-vindo. </font><font style="vertical-align: inherit;">√â preciso adotar uma abordagem diferente para espalhar a aventura independente. </font><font style="vertical-align: inherit;">Qual? </font><font style="vertical-align: inherit;">N√£o sei, escreva nos coment√°rios - com certeza algu√©m tem id√©ias inteligentes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enquanto isso, n√£o h√° id√©ias. Aqui est√° um pequeno (ou grande, dependendo da sua apar√™ncia), que permite adicionar dinamicamente depend√™ncias ao caminho de classe sem nem mesmo saber seus nomes e sem precisar recompilar o projeto: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No Windows:</font></font><br><br><pre> <code class="dos hljs">@<span class="hljs-built_in"><span class="hljs-built_in">ECHO</span></span> OFF <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> "path_to_maven\mvn.bat" -f "path_to_project\DiceCore\pom.xml" install <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> "path_to_maven\mvn.bat" -f "path_to_project\DiceCli\pom.xml" package <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> "path_to_maven\mvn.bat" -f "path_to_project\TestAdventure\pom.xml" package <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> path_to_project\DiceCli\target\adventures <span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> "path_to_project\TestAdventure\target\test-adventure-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.jar" path_to_project\DiceCli\target\adventures\ <span class="hljs-built_in"><span class="hljs-built_in">chcp</span></span> <span class="hljs-number"><span class="hljs-number">65001</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> path_to_project\DiceCli\target\ java -Dfile.encoding=UTF-<span class="hljs-number"><span class="hljs-number">8</span></span> -cp "dice-cli-<span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>-jar-with-dependencies.jar;adventures\*" my.company.dice.MainKt <span class="hljs-built_in"><span class="hljs-built_in">pause</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E no Unix: </font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh mvn -f "path_to_project/DiceCore/pom.xml" install mvn -f "path_to_project/DiceCli/pom.xml" package mvn -f "path_to_project/TestAdventure/pom.xml" package mkdir path_to_project/DiceCli/target/adventures cp path_to_project/TestAdventure/target/test-adventure-1.0.jar path_to_project/DiceCli/target/adventures/ cd path_to_project/DiceCli/target/ java -cp "dice-cli-1.0-jar-with-dependencies.jar:adventures/*" my.company.dice.MainKt</span></span></code> </pre><br>     .    <code>-jar</code>    <b>Cli</b>  classpath            <code>MainKt</code> .         <code>adventures/</code> . <br><br>     ,     ‚Äî    , .      . <i>Please</i> . (‡≤•Ôπè‡≤•) <br><br><h2> <font color="#0474a0"> . </font> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um pouco de letra. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nosso artigo √© sobre o lado t√©cnico do fluxo de trabalho, mas os jogos n√£o s√£o apenas c√≥digos de software. S√£o mundos emocionantes, com eventos interessantes e personagens animados, nos quais voc√™ mergulha com a cabe√ßa, renunciando ao mundo real. Cada um desses mundos √© incomum √† sua maneira e interessante √† sua maneira, muitos dos quais voc√™ ainda se lembra, depois de muitos anos. Se voc√™ deseja que seu mundo seja lembrado tamb√©m com sentimentos calorosos, torne-o incomum e interessante.</font></font><br><br> ,   ,   -,  -         (  ,   ?).     ,     (        ), , -  ,  (   ,        )   (        ).  ,      ‚Äî        . <br><br>        ‚Äî              . <br><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text">         ,    ,      .      ,     :  ( )   ( ),   .       ,     . <br><br>   ‚Äî   ,              .     ,                  ,     . <br><br> ,  ,  - . ,    ,  ,           ,     .       . <br></div></div><br> ,  ,  ,      ,       ,   ,  .       ,        . ,          :      ,      ,     ,        ‚Äî      :    /,     .      (     )    (,  ). <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu queria me afastar dos clich√™s da trama e dos bens de consumo de fantasia - todos esses elfos, gnomos, drag√µes, senhores negros e o mal absoluto do mundo (assim como: her√≥is selecionados, profecias antigas, super artefatos, batalhas √©picas ... embora o √∫ltimo possa ser deixado). Eu tamb√©m realmente queria dar vida ao mundo, para que cada personagem encontrado (mesmo um menor) tenha sua pr√≥pria hist√≥ria e motiva√ß√£o, que elementos da mec√¢nica do jogo se encaixem nas leis do mundo, que o desenvolvimento de her√≥is ocorra naturalmente, que a presen√ßa de inimigos e obst√°culos nos locais seja logicamente justificada pelas caracter√≠sticas do pr√≥prio local. ... e assim por diante. Infelizmente, esse desejo jogou uma piada cruel, retardando muito o processo de desenvolvimento e nem sempre era poss√≠vel se afastar das conven√ß√µes de jogos. No entanto, a satisfa√ß√£o com o produto final acabou sendo uma ordem de magnitude maior.</font></font><br><br>      ?    ‚Äî ,     ,         :       ,   ‚Äî  .        -  ,   ,   . <br><br><h2>  O que vem a seguir? </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Programa√ß√£o adicional termina e o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">design do jogo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> come√ßa </font><font style="vertical-align: inherit;">. Agora √© hora de n√£o escrever o c√≥digo, mas pensar em cen√°rios, locais, inimigos - voc√™ entende, todo esse lixo. Se voc√™ ainda trabalha sozinho, eu o parabenizo - voc√™ chegou ao est√°gio em que a maioria dos projetos de jogos se apressa. Nos grandes est√∫dios da AAA, pessoas especiais trabalham como designers e roteiristas que recebem dinheiro por isso - elas simplesmente n√£o t√™m para onde ir. Mas temos muitas op√ß√µes: dar um passeio, comer, dormir de uma maneira banal - mas o que pode ser, at√© come√ßar um novo projeto usando a experi√™ncia e o conhecimento acumulados.</font></font><br><br>              ,    .  , ,    ‚Äî    - .      (-,      ),  .         . ,     ,    ,  -      ‚Äî          .  ¬´ ¬ª (roadmap) ,     (  )    .     ( )        (    ).       ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">, </a> )    .   :  ,  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">, </a> )     ,   ,   (  ) ‚Äî ,          ,     .  ,         ,        .    ,      ‚Äî     ,        . <br><br> <i>¬´ -,      ?¬ª</i> <br><br>     ,         .     ‚Äî       ,           : ¬´   ?¬ª.        ,   , : ¬´         ?¬ª.       ( , )   .       ,         (challenge) .   ,    ,         ,  - - .     ,   ‚Äî     ,        .        ,     ‚Ä¶   . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em outras palavras, o jogo precisa ser equilibrado. Isto √© especialmente verdade no jogo de tabuleiro, onde as regras s√£o claramente formalizadas.</font></font> Como fazer isso?   .     -,     ( ,  )         (   ),     ‚Äî <s>  </s> <i>playtesting</i> .     .   ‚Äî   .      , , ,    .     ‚Äî    .  ,  ,     : ¬´  feedback!¬ª. , -     ,   ,      ‚Äî          ( ,     ?) (-). <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Brincadeiras √† parte, desejo a n√≥s ... todos voc√™s sucesso. </font><font style="vertical-align: inherit;">Leia mais (quem pensaria!) - sobre design de jogos e muito mais. </font><font style="vertical-align: inherit;">Todas as quest√µes que examinamos j√° foram abordadas de uma maneira ou de outra em artigos e literatura (embora, se voc√™ ainda estiver aqui, seja obviamente desnecess√°rio insistir para que voc√™ leia). </font><font style="vertical-align: inherit;">Compartilhe suas impress√µes, comunique-se nos f√≥runs - em geral, voc√™ j√° me conhece cada vez melhor. </font><font style="vertical-align: inherit;">N√£o seja pregui√ßoso e voc√™ ter√° sucesso. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesta nota otimista, deixe-me despedir-se. </font><font style="vertical-align: inherit;">Obrigado a todos pela aten√ß√£o. </font><font style="vertical-align: inherit;">At√© breve! </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúEh! </font><font style="vertical-align: inherit;">Que te v√™? </font><font style="vertical-align: inherit;">Como agora lan√ßar tudo isso em um telefone celular? </font><font style="vertical-align: inherit;">Eu esperei em v√£o, ou o qu√™?</font></font></i> <br><br><h2> <font color="#0474a0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Posf√°cio. </font><font style="vertical-align: inherit;">Android</font></font></font> </h2><br>         ,     <code>Game</code>    ,      <code>MainMenu</code> .    ,             ,     . <br><br><div class="spoiler"> <b class="spoiler_title">     </b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/fx/ov/q7/fxovq7xubhonlcjjwziyvhfl_6g.png"></a> <br></div></div><br>    <code>Game</code> ,    ,            .           .      ‚Äî ¬´Exit¬ª. <br><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/0_/xq/b5/0_xqb5sblm16brzqyrpibavvxco.png"></a> <br></div></div><br> , ?  Sobre isso e fala.     . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainMenu</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> renderer: MenuRenderer, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> interactor: MenuInteractor ) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> actions = ActionList.EMPTY <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { Audio.playMusic(Music.MENU_MAIN) actions = ActionList() actions.add(Action.Type.NEW_ADVENTURE) actions.add(Action.Type.CONTINUE_ADVENTURE, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) actions.add(Action.Type.MANUAL, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) actions.add(Action.Type.EXIT) processCycle() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processCycle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { renderer.drawMainMenu(actions) <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (interactor.pickAction(actions).type) { Action.Type.NEW_ADVENTURE -&gt; TODO() Action.Type.CONTINUE_ADVENTURE -&gt; TODO() Action.Type.MANUAL -&gt; TODO() Action.Type.EXIT -&gt; { Audio.stopMusic() Audio.playSound(Sound.LEAVE) renderer.clearScreen() Thread.sleep(<span class="hljs-number"><span class="hljs-number">500</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> AssertionError(<span class="hljs-string"><span class="hljs-string">"Should not happen"</span></span>) } } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A intera√ß√£o com o usu√°rio √© implementada usando interfaces </font></font><code>MenuRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>MenuInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">funcionando de maneira semelhante ao que foi visto anteriormente.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MenuRenderer</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Renderer { fun drawMainMenu</span></span></span></span>(actions: ActionList) } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Interactor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">anyInput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como voc√™ j√° entendeu, separamos intencionalmente interfaces de implementa√ß√µes espec√≠ficas. </font><font style="vertical-align: inherit;">Tudo o que precisamos agora √© substituir o </font><font style="vertical-align: inherit;">projeto </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cli</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por um novo projeto (vamos cham√°-lo de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Droid</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), adicionando uma depend√™ncia ao projeto </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vamos fazer isso. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Execute o Android Studio (geralmente os projetos para Android s√£o desenvolvidos nele), crie um projeto simples, removendo todo o ouropel padr√£o desnecess√°rio e deixando apenas suporte para o idioma Kotlin. </font><font style="vertical-align: inherit;">Tamb√©m adicionamos uma depend√™ncia no projeto </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Core</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que √© armazenado no reposit√≥rio local Maven da nossa m√°quina.</font></font><br><br><pre> <code class="lua hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'com.android.application'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-android'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-android-extensions'</span></span> android { compileSdkVersion <span class="hljs-number"><span class="hljs-number">28</span></span> defaultConfig { applicationId <span class="hljs-string"><span class="hljs-string">"my.company.dice"</span></span> minSdkVersion <span class="hljs-number"><span class="hljs-number">14</span></span> targetSdkVersion <span class="hljs-number"><span class="hljs-number">28</span></span> versionCode <span class="hljs-number"><span class="hljs-number">1</span></span> versionName <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> } } dependencies { implementation <span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"</span></span> implementation <span class="hljs-string"><span class="hljs-string">"my.company:dice-core:1.0"</span></span> }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por padr√£o, no entanto, ningu√©m ver√° nossa depend√™ncia - voc√™ deve indicar explicitamente a necessidade de usar um reposit√≥rio local (mavenLocal) ao criar o projeto.</font></font><br><br><pre> <code class="lua hljs">buildscript { ext.kotlin_version = <span class="hljs-string"><span class="hljs-string">'1.3.20'</span></span> repositories { google() jcenter() mavenLocal() } dependencies { classpath <span class="hljs-string"><span class="hljs-string">'com.android.tools.build:gradle:3.3.0'</span></span> classpath <span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"</span></span> } } allprojects { repositories { google() jcenter() mavenLocal() } }</code> </pre><br>  ,        ,   ‚Äî  .  ,   ,    : <code>SoundPlayer</code> , <code>MusicPlayer</code> , <code>MenuInteractor</code> ( <code>GameInteractor</code> ), <code>MenuRenderer</code> ( <code>GameRenderer</code> )  <code>StringLoader</code> ,    ,    .    ,          . <br><br>           (, ,    ) Android ‚Äî      <code>Canvas</code> .      -   <code>View</code> ‚Äî     ¬´¬ª.    ,       ,      ,          .        <code>View</code> ‚Äî  ,          ( ,       ). <br><br>      View     . <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"my.company.dice"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@mipmap/ic_launcher"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/app_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/AppTheme"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".ui.MainActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:screenOrientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sensorLandscape"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:configChanges</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"orientation|keyboardHidden|screenSize"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.LAUNCHER"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.MAIN"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>      ‚Äî       ,    .  ,      ,     . <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AppTheme"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">parent</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android:Theme.Black.NoTitleBar.Fullscreen"</span></span></span><span class="hljs-tag">/&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E desde que entramos em recursos, transferimos as </font><font style="vertical-align: inherit;">seq√º√™ncias localizadas necess√°rias </font><font style="vertical-align: inherit;">do projeto </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cli</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , trazendo-as para o formato desejado:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_new_adventure_key"</span></span></span><span class="hljs-tag">&gt;</span></span>N<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_new_adventure_name"</span></span></span><span class="hljs-tag">&gt;</span></span>ew adventure<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_continue_adventure_key"</span></span></span><span class="hljs-tag">&gt;</span></span>C<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_continue_adventure_name"</span></span></span><span class="hljs-tag">&gt;</span></span>ontinue adventure<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_manual_key"</span></span></span><span class="hljs-tag">&gt;</span></span>M<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_manual_name"</span></span></span><span class="hljs-tag">&gt;</span></span>anual<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_exit_key"</span></span></span><span class="hljs-tag">&gt;</span></span>X<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action_exit_name"</span></span></span><span class="hljs-tag">&gt;</span></span>Exit<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al√©m dos arquivos de sons e m√∫sicas usados ‚Äã‚Äãno menu principal (um de cada tipo), coloque-os em </font></font><code>/assets/sound/leave.wav</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e, </font></font><code>/assets/music/menu_main.mp3</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">respectivamente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando separamos os recursos, estava na hora de come√ßar a projetar (sim, novamente). </font><font style="vertical-align: inherit;">Diferentemente do console, a plataforma Android tem seus pr√≥prios recursos arquitet√¥nicos, o que nos obriga a usar abordagens e m√©todos espec√≠ficos.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diagrama de classe e interface</font></font></b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/xb/m4/uc/xbm4ucar6ewumegpof3hr53c0a4.png"></a> <br></div></div><br> ,    ,    . <br><br> , ,    ‚Äî  <code>DiceSurface</code> ‚Äî    <code>View</code> ,         (       <code>SurfaceView</code> ‚Äî   <code>GlSurfaceView</code> ‚Äî      ,     ,   ,     ,    ).    ,       :     ,       .    . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando pintamos no console, nosso Renderer enviou comandos de sa√≠da e formou uma imagem na tela. No caso do Android, a situa√ß√£o √© oposta - a renderiza√ß√£o √© iniciada pelo pr√≥prio View, que no momento em que o m√©todo </font></font><code>onDraw()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© </font><font style="vertical-align: inherit;">executado </font><font style="vertical-align: inherit;">j√° deve saber o que, como e para onde desenhar. Mas e o m√©todo de </font></font><code>drawMainMenu()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interface </font></font><code>MainMenu</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">? Ele n√£o controla a sa√≠da agora? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vamos tentar resolver esse problema com a ajuda de interfaces funcionais. A classe </font></font><code>DiceSurface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conter√° um par√¢metro especial </font></font><code>instructions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- na verdade, um bloco de c√≥digo que deve ser executado toda vez que o m√©todo for chamado </font></font><code>onDraw()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O renderizador, usando um m√©todo p√∫blico, indicar√° quais instru√ß√µes espec√≠ficas devem ser seguidas. Se voc√™ est√° interessado, use um padr√£o chamado de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estrat√©gia</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (estrat√©gia). √â assim:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> RenderInstructions = (Canvas, Paint) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiceSurface</span></span></span></span>(context: Context) : View(context) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instructions: RenderInstructions = { _, _ -&gt; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> paint = Paint().apply { color = Color.YELLOW style = Paint.Style.STROKE isAntiAlias = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateInstructions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instructions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RenderInstructions</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.instructions = instructions <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.postInvalidate() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDraw(canvas) canvas.drawColor(Color.BLACK) <span class="hljs-comment"><span class="hljs-comment">//Fill background with black color instructions.invoke(canvas, paint) //Execute current render instructions } } class DroidMenuRenderer(private val surface: DiceSurface): MenuRenderer { override fun clearScreen() { surface.updateInstructions { _, _ -&gt; } } override fun drawMainMenu(actions: ActionList) { surface.updateInstructions { c, p -&gt; val canvasWidth = c.width val canvasHeight = c.height //Draw title text p.textSize = canvasHeight / 3f p.strokeWidth = 0f p.color = Color.parseColor("#ff808000") c.drawText( "DICE", (canvasWidth - p.measureText("DICE")) / 2f, (buttonTop - p.ascent() - p.descent()) / 2f, p ) //Other instructions... } } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ou seja, toda a funcionalidade gr√°fica ainda est√° na classe Renderer, mas desta vez n√£o executamos diretamente os comandos, mas os preparamos para execu√ß√£o pela nossa View. Preste aten√ß√£o ao tipo de propriedade </font></font><code>instructions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- voc√™ pode criar uma interface separada e chamar seu √∫nico m√©todo, mas o Kotlin pode reduzir significativamente a quantidade de c√≥digo.</font></font><br><br>   Interactor.     :       (),   () ,     .       ‚Äî     Looper,          ,      .     Interactor -      ,     Activity    View  ,        . <br><br>          <code>BlockingQueue</code> .  <code>DroidMenuInteractor</code>    <code>take()</code> ,        ,       (    <code>Action</code> ). <code>DiceSurface</code> ,   ,      (  <code>onTouchEvent()</code>  <code>View</code> ),         <code>offer()</code> .     : <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiceSurface</span></span></span></span>(context: Context) : View(context) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> actionQueue: BlockingQueue&lt;Action&gt; = LinkedBlockingQueue&lt;Action&gt;() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">awaitAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Action = actionQueue.take() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouchEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MotionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.action == MotionEvent.ACTION_UP) { actionQueue.offer(Action(Action.Type.NONE), <span class="hljs-number"><span class="hljs-number">200</span></span>, TimeUnit.MILLISECONDS) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidMenuInteractor</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> surface: DiceSurface) : Interactor { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">anyInput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { surface.awaitAction() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pickAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Action { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type = surface.awaitAction().type list .filter(Action::isEnabled) .find { it.type == type } ?.let { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> it } } } }</code> </pre><br>  , Interactor   <code>awaitAction()</code>     - ,   .    ,     .  UI-  ,        ,      ,         (,    ).        /   . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Claro, n√≥s meio que transferimos os comandos, mas apenas o primeiro. Precisamos distinguir entre as coordenadas de pressionar e, dependendo de seus valores, chame este ou aquele comando. No entanto, isso √© uma m√° sorte - o Interactor n√£o tem id√©ia de em que lugar da tela os bot√µes ativos s√£o desenhados - o Renderer √© respons√°vel pela renderiza√ß√£o. Estabeleceremos sua intera√ß√£o da seguinte maneira. A classe </font></font><code>DiceSurface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">armazenar√° uma cole√ß√£o especial - uma lista de ret√¢ngulos ativos (ou outras formas, se chegarmos a esse ponto). Esses ret√¢ngulos cont√™m as coordenadas dos v√©rtices e o limite </font></font><code>Action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. O renderizador gera esses ret√¢ngulos e os adiciona √† lista, o m√©todo </font></font><code>onTouchEvent()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">determina qual dos ret√¢ngulos foi pressionado e adiciona o correspondente √† fila </font></font><code>Action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveRect</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> action: Action, left: <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>, top: <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>, right: <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>, bottom: <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rect = RectF(left, top, right, bottom) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, y: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, w: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, h: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> = rect.contains(x / w, y / h) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O m√©todo </font></font><code>check()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© respons√°vel por verificar se as coordenadas especificadas est√£o dentro do ret√¢ngulo. Observe que, no est√°gio do trabalho do renderizador (e esse √© exatamente o momento em que os ret√¢ngulos s√£o criados), n√£o temos a menor id√©ia sobre o tamanho da tela. Portanto, teremos que armazenar as coordenadas em valores relativos (porcentagem da largura ou altura da tela) com valores de 0 a 1 e recontar no momento da press√£o. Essa abordagem n√£o √© totalmente precisa, pois n√£o leva em considera√ß√£o a propor√ß√£o - no futuro, ela ter√° que ser refeita. No entanto, para nossa tarefa educacional a princ√≠pio, ela ser√° suficiente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implementaremos </font></font><code>DiceSurface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">um campo adicional </font><font style="vertical-align: inherit;">na classe </font><font style="vertical-align: inherit;">, adicionaremos dois m√©todos ( </font></font><code>addRectangle()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>clearRectangles()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) para control√°-lo do lado de fora (do lado do renderizador) e expandiremos </font></font><code>onTouchEvent()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for√ßando as coordenadas dos ret√¢ngulos em considera√ß√£o.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DiceSurface</span></span></span></span>(context: Context) : View(context) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> actionQueue: BlockingQueue&lt;Action&gt; = LinkedBlockingQueue&lt;Action&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rectangles: MutableSet&lt;ActiveRect&gt; = Collections.newSetFromMap(ConcurrentHashMap&lt;ActiveRect, <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>&gt;()) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instructions: RenderInstructions = { _, _ -&gt; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> paint = Paint().apply { color = Color.YELLOW style = Paint.Style.STROKE isAntiAlias = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateInstructions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instructions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">RenderInstructions</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.instructions = instructions <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.postInvalidate() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearRectangles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { rectangles.clear() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addRectangle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(action: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Action</span></span></span></span><span class="hljs-function"><span class="hljs-params">, left: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, top: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, right: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">, bottom: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Float</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { rectangles.add(ActiveRect(action, left, top, right, bottom)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">awaitAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: Action = actionQueue.take() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouchEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MotionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.action == MotionEvent.ACTION_UP) { with(rectangles.firstOrNull { it.check(event.x, event.y, width.toFloat(), height.toFloat()) }) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { actionQueue.put(action) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { actionQueue.offer(Action(Action.Type.NONE), <span class="hljs-number"><span class="hljs-number">200</span></span>, TimeUnit.MILLISECONDS) } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDraw(canvas) canvas.drawColor(Color.BLACK) instructions(canvas, paint) } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma cole√ß√£o competitiva √© usada para armazenar os ret√¢ngulos - permitir√° evitar a ocorr√™ncia </font></font><code>ConcurrentModificationException</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se o conjunto for atualizado e movido ao mesmo tempo por threads diferentes (o que, no nosso caso, ocorrer√°). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O c√≥digo da classe </font></font><code>DroidMenuInteractor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permanecer√° inalterado, mas </font></font><code>DroidMenuRenderer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser√° alterado. Adicione quatro bot√µes √† exibi√ß√£o para cada item </font></font><code>ActionList</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Coloque-os sob o t√≠tulo DICE, distribu√≠dos uniformemente por toda a largura da tela. Bem, n√£o vamos esquecer os ret√¢ngulos ativos.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidMenuRenderer</span></span></span><span class="hljs-class"> </span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> surface: DiceSurface, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> loader: StringLoader ) : MenuRenderer { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> helper = StringLoadHelper(loader) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { surface.clearRectangles() surface.updateInstructions { _, _ -&gt; } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawMainMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(actions: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ActionList</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">//Prepare rectangles surface.clearRectangles() val percentage = 1.0f / actions.size actions.forEachIndexed { i, a -&gt; surface.addRectangle(a, i * percentage, 0.45f, i * percentage + percentage, 1f) } //Prepare instructions surface.updateInstructions { c, p -&gt; val canvasWidth = c.width val canvasHeight = c.height val buttonTop = canvasHeight * 0.45f val buttonWidth = canvasWidth / actions.size val padding = canvasHeight / 144f //Draw title text p.textSize = canvasHeight / 3f p.strokeWidth = 0f p.color = Color.parseColor("#ff808000") p.isFakeBoldText = true c.drawText( "DICE", (canvasWidth - p.measureText("DICE")) / 2f, (buttonTop - p.ascent() - p.descent()) / 2f, p ) p.isFakeBoldText = false //Draw action buttons p.textSize = canvasHeight / 24f actions.forEachIndexed { i, a -&gt; p.color = if (a.isEnabled) Color.YELLOW else Color.LTGRAY p.strokeWidth = canvasHeight / 240f c.drawRect( i * buttonWidth + padding, buttonTop + padding, i * buttonWidth + buttonWidth - padding, canvasHeight - padding, p ) val name = mergeActionData(helper.loadActionData(a)) p.strokeWidth = 0f c.drawText( name, i * buttonWidth + (buttonWidth - p.measureText(name)) / 2f, (canvasHeight + buttonTop - p.ascent() - p.descent()) / 2f, p ) } } } private fun mergeActionData(data: Array&lt;String&gt;) = if (data.size &gt; 1) { if (data[1].first().isLowerCase()) data[0] + data[1] else data[1] } else data.getOrNull(0) ?: "" }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui, retornamos novamente √† interface </font></font><code>StringLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e aos recursos da classe auxiliar </font></font><code>StringLoadHelper</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(n√£o mostrada no diagrama). </font><font style="vertical-align: inherit;">A implementa√ß√£o do primeiro tem um nome </font></font><code>ResourceStringLoader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e est√° envolvida no carregamento de cadeias localizadas a partir de (obviamente) recursos de aplicativos. </font><font style="vertical-align: inherit;">No entanto, faz isso dinamicamente, uma vez que n√£o conhecemos os identificadores de recursos com anteced√™ncia - somos for√ßados a constru√≠-los em movimento.</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceStringLoader</span></span></span></span>(context: Context) : StringLoader { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> packageName = context.packageName <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> resources = context.resources <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String = resources.getString(resources.getIdentifier(key, <span class="hljs-string"><span class="hljs-string">"string"</span></span>, packageName)) }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resta falar sobre sons e m√∫sica. </font><font style="vertical-align: inherit;">H√° uma classe maravilhosa no Android </font></font><code>MediaPlayer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que lida com essas coisas. </font><font style="vertical-align: inherit;">N√£o h√° nada melhor para tocar m√∫sica:</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidMusicPlayer</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> context: Context): MusicPlayer { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentMusic: Music? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> player = MediaPlayer() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(music: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Music</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentMusic == music) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } currentMusic = music player.setAudioStreamType(AudioManager.STREAM_MUSIC) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> afd = context.assets.openFd(<span class="hljs-string"><span class="hljs-string">"music/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${music.toString().toLowerCase()}</span></span></span><span class="hljs-string">.mp3"</span></span>) player.setDataSource(afd.fileDescriptor, afd.startOffset, afd.length) player.setOnCompletionListener { it.seekTo(<span class="hljs-number"><span class="hljs-number">0</span></span>) it.start() } player.prepare() player.start() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { currentMusic = <span class="hljs-literal"><span class="hljs-literal">null</span></span> player.release() } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dois pontos Primeiro, o m√©todo </font></font><code>prepare()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© executado de forma s√≠ncrona, que com um tamanho de arquivo grande (devido ao buffer) suspender√° o sistema. √â recomend√°vel que voc√™ o execute em um thread separado ou use o m√©todo ass√≠ncrono </font></font><code>prepareAsync()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>OnPreparedListener</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Em segundo lugar, seria bom associar a reprodu√ß√£o ao ciclo de vida da atividade (pausa quando o usu√°rio minimiza o aplicativo e retoma durante a recupera√ß√£o), mas n√£o o fizemos. Ai-ai-ai ... </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamb√©m √© </font></font><code>MediaPlayer</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adequado </font><font style="vertical-align: inherit;">para sons </font><font style="vertical-align: inherit;">, mas se forem poucos e simples (como no nosso caso), ser√£o adequados </font></font><code>SoundPool</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Sua vantagem √© que, quando os arquivos de som j√° est√£o carregados na mem√≥ria, a reprodu√ß√£o √© iniciada instantaneamente. A desvantagem √© √≥bvia - pode n√£o haver mem√≥ria suficiente (mas suficiente para n√≥s, somos modestos).</font></font><br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DroidSoundPlayer</span></span></span></span>(context: Context) : SoundPlayer { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> soundPool: SoundPool = SoundPool(<span class="hljs-number"><span class="hljs-number">2</span></span>, AudioManager.STREAM_MUSIC, <span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> sounds = mutableMapOf&lt;Sound, <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>&gt;() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rate = <span class="hljs-number"><span class="hljs-number">1f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> lock = ReentrantReadWriteLock() <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> { Thread(SoundLoader(context)).start() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sound: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Sound</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lock.readLock().tryLock()) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { sounds[sound]?.let { s -&gt; soundPool.play(s, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, rate) } } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { lock.readLock().unlock() } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SoundLoader</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> context: Context) : Runnable { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> assets = context.assets lock.writeLock().lock() <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Sound.values().forEach { s -&gt; sounds[s] = soundPool.load( assets.openFd(<span class="hljs-string"><span class="hljs-string">"sound/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${s.toString().toLowerCase()}</span></span></span><span class="hljs-string">.wav"</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span> ) } } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { lock.writeLock().unlock() } } } }</code> </pre><br>        <code>Sound</code>      .        ,        <code>ReentrantReadWriteLock</code> . <br><br>  -       <code>MainActivity</code> ‚Äî    ?  ,  <code>MainMenu</code> (  <code>Game</code> )     . <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Activity</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) Audio.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(DroidSoundPlayer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>), DroidMusicPlayer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> surface = DiceSurface(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> renderer = DroidMenuRenderer(surface) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> interactor = DroidMenuInteractor(surface, ResourceStringLoader(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) setContentView(surface) Thread { MainMenu(renderer, interactor).start() finish() }.start() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBackPressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { } }</code> </pre><br>  Isso, de fato, √© tudo.          : <br><br><div class="spoiler"> <b class="spoiler_title">      </b> <div class="spoiler_text"> <a href=""><img src="https://habrastorage.org/webt/m0/u7/-7/m0u7-7lcjmuttu9rerrvirhfgyy.png"></a> <br></div></div><br>   ,   ,       ,         . <br><br><h2>  Links √∫teis </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu sei, muitos rolaram direto para esse ponto. </font><font style="vertical-align: inherit;">Tudo bem - a maioria dos leitores fechou a guia completamente. </font><font style="vertical-align: inherit;">Aquelas unidades que, no entanto, resistiram a todo esse fluxo de conversas incoerentes - </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">respeito e respeito,</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> amor e gratid√£o infinitos. </font><font style="vertical-align: inherit;">Bem e links, √© claro, onde sem eles. </font><font style="vertical-align: inherit;">Primeiro, para o c√≥digo-fonte dos projetos (lembre-se de que o estado atual dos projetos foi muito al√©m do considerado no artigo):</font></font><br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projeto </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√∫cleo</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projeto </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cli</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">projetar </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o Droid</font></font></b></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></li></ul><br>     -      ,     ,     : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">!</a> <br><br>      launcher (       ).   JavaFX         OpenJDK ( ‚Äî ),            .       readme.txt ( ?). , , ,    . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se voc√™ estiver interessado em um projeto, ferramenta usada, mec√¢nica ou alguma solu√ß√£o interessante ou, n√£o sei, jogos de hist√≥rias, voc√™ pode examin√°-lo com mais detalhes em outro artigo. </font><font style="vertical-align: inherit;">Se voc√™ quiser </font><font style="vertical-align: inherit;">E se voc√™ n√£o quiser, basta enviar coment√°rios, arrependimentos e sugest√µes. </font><font style="vertical-align: inherit;">Ficarei feliz em conversar.</font></font><br><br>  Tudo de bom. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt445278/">https://habr.com/ru/post/pt445278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt445268/index.html">Detalhes do GraphQL: O que, como e por que</a></li>
<li><a href="../pt445270/index.html">[marcador] Bash para iniciantes: 21 comandos √∫teis</a></li>
<li><a href="../pt445272/index.html">JavaScript √© a melhor linguagem de programa√ß√£o para iniciantes. Ent√£o √© ou n√£o?</a></li>
<li><a href="../pt445274/index.html">Quando "Zo√´"! == "Zo√´", ou por que voc√™ precisa normalizar seq√º√™ncias de caracteres Unicode</a></li>
<li><a href="../pt445276/index.html">Guia completo de UseEffect</a></li>
<li><a href="../pt445280/index.html">Rentabilidade de sites e servi√ßos</a></li>
<li><a href="../pt445284/index.html">An√°lise do produto ClickHouse</a></li>
<li><a href="../pt445286/index.html">Apoio para os p√©s para o c√©rebro: Hedera Hashgraph Distributed Registry Platform</a></li>
<li><a href="../pt445288/index.html">Todos os seus empr√©stimos ao consumidor e dados pessoais "em um s√≥ lugar" ...</a></li>
<li><a href="../pt445290/index.html">Como implementar processos unificados, levando em considera√ß√£o todos os recursos da empresa?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>