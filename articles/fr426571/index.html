<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÖüèº üëâ üîä Une approche syst√©matique de la vitesse: mesures en ligne sur le front end üéã üßóüèæ üêú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La commande de vitesse Yandex optimise manuellement les r√©sultats de la recherche. Le faire √† l'aveuglette est difficile et souvent tout simplement in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Une approche syst√©matique de la vitesse: mesures en ligne sur le front end</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/426571/"> La commande de vitesse Yandex optimise manuellement les r√©sultats de la recherche.  Le faire √† l'aveuglette est difficile et souvent tout simplement inutile.  Par cons√©quent, la soci√©t√© a construit une infrastructure pour collecter des m√©triques, tester la vitesse et analyser les donn√©es. <br><br>  √Ä propos des mesures √† utiliser et de la fa√ßon d'optimiser tout, le d√©veloppeur des interfaces Yandex <b>Andrei Prokopyuk</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Andre_487</a> ) le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">sait</a> . <br><br><img src="https://habrastorage.org/webt/jh/gn/r4/jhgnr48w9fhjphnfjkjcggtsdds.png"><br><br>  Le mat√©riel est bas√© sur le discours d'Andrey lors de la conf√©rence <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HolyJS</a> .  Sous la coupe - et la vid√©o, et une version texte du rapport. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Whm2FMBIgA0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><blockquote>  En plus de ce rapport sur les mesures en ligne, il y a un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport d'Alexei Kalmakov</a> (√©galement de Yandex) sur les mesures hors ligne, dans son cas il n'y a pas de version texte, mais une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vid√©o</a> est disponible. </blockquote><br><br>  Les r√©sultats de recherche Yandex se composent de nombreux blocs diff√©rents, de classes de r√©ponses aux requ√™tes des utilisateurs.  Plus de 50 personnes y travaillent dans l'entreprise, et pour que le taux d'√©mission ne baisse pas, nous veillons en permanence au d√©veloppement. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/044/4e1/e2a/0444e1e2a6db39e37b9c2a085c7433db.jpg"><br><br>  Personne ne dira que les utilisateurs pr√©f√®rent l'interface rapide √† l'interface lente.  Mais avant de commencer l'optimisation, il est important de comprendre comment cela affectera votre entreprise.  Les d√©veloppeurs doivent-ils passer du temps √† acc√©l√©rer l'interface si cela n'affecte pas les mesures commerciales? <br><br>  Pour r√©pondre √† cette question, je vais vous raconter deux histoires. <br><br><h2>  Historique de l'introduction d'une police web sp√©cifique sur l'√©mission </h2><br>  Apr√®s avoir √©tabli une exp√©rience avec les polices, nous avons constat√© que le temps moyen de rendu du contenu s'est d√©t√©rior√© de 3%, de 62 millisecondes.  Pas tellement si vous le prenez pour un delta dans le vide.  Le retard perceptible √† l'≈ìil nu commence avec seulement 100 millisecondes - et pourtant le temps jusqu'au premier clic a imm√©diatement augment√© d'un pour cent et demi. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ef/2b5/548/4ef2b5548ae1789980552312d0b92857.jpg"><br><br>  Les utilisateurs ont commenc√© √† interagir plus tard avec la page.  Le nombre de pages cliqu√©es a diminu√© de pr√®s d'un demi pour cent.  Le temps de pr√©sence sur le service a √©t√© r√©duit et le temps d'absence a √©t√© augment√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c15/215/b5f/c15215b5fb72633582890da9e018d4a4.jpg"><br><br>  Nous n'avons pas commenc√© √† d√©ployer la fonctionnalit√© avec les polices.  Apr√®s tout, ces chiffres semblent petits jusqu'√† ce que vous vous souveniez de l'ampleur du service.  En r√©alit√©, un et demi pour cent - des centaines de milliers de personnes. <br><br>  De plus, la vitesse a un effet cumulatif.  Pour une mise √† jour avec une part de non r√©clam√©s - 0,4% suivra de plus en plus.  Dans Yandex, ces fonctionnalit√©s sont d√©ploy√©es par dizaines par jour, et si vous ne vous battez pas pour chaque part, cela ne durera pas longtemps et atteindra 10%. <br><br><h2>  Historique de la mise en cache LS </h2><br>  Cette histoire est li√©e au fait que nous ins√©rons beaucoup de contenu statique dans la page. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c33/3fd/7d2/c333fd7d205cc0695c8934cb0111c820.jpg"><br><br>  En raison de sa grande variabilit√©, nous ne pouvons pas le compiler en un seul paquet ou le livrer avec des ressources externes.  La pratique a montr√© qu'avec la livraison en ligne, le rendu et l'initialisation de JavaScript sont les plus rapides. <br><br>  Une fois que nous avons d√©cid√© que l'utilisation d'un r√©f√©rentiel de navigateur serait une bonne id√©e.  Mettez tout dans localStorage et, lors des entr√©es suivantes sur la page, chargez-le √† partir de l√† et ne le transmettez pas sur le r√©seau. <br><br>  Ensuite, nous nous sommes concentr√©s principalement sur les m√©triques ¬´taille HTML¬ª et ¬´d√©lai de livraison HTML¬ª et avons obtenu de bons r√©sultats sur celles-ci.  Au fil du temps, nous avons invent√© de nouvelles m√©thodes de mesure de la vitesse, acquis de l'exp√©rience et d√©cid√© de rev√©rifier, de mener une exp√©rience inverse, de d√©sactiver l'optimisation. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3b9/37c/2c9/3b937c2c9c4f0a85c2e76a26d6fdfacf.jpg"><br><br>  Le d√©lai de livraison HTML moyen (la m√©trique cl√© au moment du d√©veloppement de l'optimisation) a augment√© de 12%, ce qui est beaucoup.  Mais en m√™me temps, le temps jusqu'√† ce que l'en-t√™te soit dessin√©, avant le d√©but de l'analyse du contenu et avant l'initialisation de JavaScript.  R√©duit √©galement le temps au premier clic.  Le pourcentage est petit - 0,6, mais si vous vous souvenez de l'√©chelle ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f88/35c/0fd/f8835c0fdce5780914f129f41f445f8d.jpg"><br><br>  En d√©sactivant l'optimisation, nous avons obtenu une d√©t√©rioration de la m√©trique, visible uniquement pour les sp√©cialistes, et en m√™me temps, une am√©lioration notable pour l'utilisateur. <br><br>  On peut en tirer les conclusions suivantes: <br><br>  Premi√®rement, la vitesse affecte vraiment les affaires et les mesures commerciales. <br><br>  Deuxi√®mement, les optimisations doivent √™tre pr√©c√©d√©es de mesures.  Si vous impl√©mentez quelque chose, apr√®s avoir fait de mauvaises mesures, il est probable que vous ne ferez rien d'utile.  La composition de l'audience, la flotte d'appareils, les sc√©narios d'interaction et les r√©seaux sont diff√©rents partout, et vous devez v√©rifier ce qui fonctionnera exactement pour vous. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0bf/2c6/06b/0bf2c606bacfb7bc5769594fbc326a52.jpg"><br><br>  Une fois, Ash nous a appris des morts sinistres d'abord √† tirer, puis √† penser ou √† ne pas penser du tout.  En vitesse, vous n'avez pas √† le faire. <br><br>  Et le troisi√®me point: les mesures doivent refl√©ter l'exp√©rience utilisateur.  Par exemple, la taille HTML et le d√©lai de livraison sont des mesures de vitesse m√©diocres car l'utilisateur ne s'assoit pas avec devTools et ne s√©lectionne pas un service avec moins de retard.  Mais quelles mesures sont bonnes et correctes - nous le dirons plus loin. <br><br><h2>  Quoi et comment mesurer? </h2><br>  Les mesures doivent commencer par quelques mesures cl√©s qui, contrairement, par exemple, √† la taille HTML, sont proches de l'exp√©rience utilisateur. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec1/3c5/783/ec13c57830d7b1b3b8380273dda5bbc8.jpg"><br><br>  Si TTFCP (temps avant la premi√®re peinture compl√®te) et TTFMP (temps avant la premi√®re peinture significative) indiquent le temps jusqu'au premier rendu du contenu et le temps avant le rendu du contenu significatif, alors le troisi√®me est le temps jusqu'√† ce que le cadre soit initialis√©, cela vaut la peine d'√™tre expliqu√©. <br><br>  C'est le moment o√π le framework a d√©j√† travers√© la page, collect√© toutes les donn√©es n√©cessaires et bloqu√© les gestionnaires.  Si l'utilisateur clique quelque part √† ce moment, il recevra une r√©ponse dynamique. <br><br>  Et la derni√®re, quatri√®me m√©trique, le temps jusqu'√† la premi√®re interactivit√©, est g√©n√©ralement appel√©e temps √† interactif (TTI). <br><br>  Ces m√©triques, contrairement √† la taille html ou au d√©lai de livraison, sont proches de l'exp√©rience utilisateur. <br><br><h2>  Il est temps de peindre le premier contenu </h2><br>  Pour mesurer le moment o√π l'utilisateur a vu le premier contenu de la page, il existe une API de synchronisation de peinture, disponible jusqu'√† pr√©sent uniquement en chrome.  Les donn√©es peuvent √™tre obtenues de la mani√®re suivante. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e16/80a/c27/e1680ac270e35eaad20070c90e47066d.jpg"><br><br>  Avec cet appel, nous obtenons un ensemble d'√©v√©nements de rendu.  Jusqu'√† pr√©sent, deux types d'√©v√©nements sont pris en charge: la premi√®re peinture - tout rendu et la premi√®re peinture de contenu - tout rendu de contenu autre que le fond blanc de l'onglet vide et le contenu d'arri√®re-plan de la page. <br><br>  Nous obtenons donc un tableau d'√©v√©nements, filtrons la peinture en premier contenu et envoyons avec un certain ID. <br><br><h2>  Temps de premi√®re peinture significative </h2><br>  Il n'y a aucun √©v√©nement dans l'API Paint Timing signalant qu'un contenu significatif a √©t√© rendu sur la page.  Cela est d√ª au fait que ce contenu sur chaque page est diff√©rent.  Si nous parlons de service vid√©o, l'essentiel est le joueur, dans les r√©sultats de recherche - le premier r√©sultat non publicitaire.  Il existe de nombreux services et une API universelle n'a pas encore √©t√© d√©velopp√©e.  Mais ici, de bonnes b√©quilles √©prouv√©es entrent en jeu. <br><br>  Il y a deux √©coles de b√©quilles dans Yandex pour mesurer cette m√©trique: en utilisant RequestAnimationFrame et en mesurant avec InterceptionObserver. <br><br>  Dans RequestAnimationFrame, le rendu est mesur√© √† l'aide d'un intervalle. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/22b/dfe/945/22bdfe945df84617220936267638cc21.jpg"><br><br>  Supposons qu'il existe un contenu significatif.  Voici une div avec le contenu principal de la classe.  Un script est plac√© devant, o√π RequestAnimationFrame est appel√© deux fois. <br><br>  Dans le rappel du premier appel, √©crivez la limite inf√©rieure de l'intervalle.  Dans le rappel de la seconde - le haut.  Cela est d√ª √† la structure de trame que le navigateur rend. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/79d/783/a88/79d783a883b6a718095228cfbea29469.jpg"><br><br>  Le premier est l'ex√©cution de JavaScript, puis l'analyse des styles, puis le calcul de la mise en page, du rendu et de la composition. <br><br>  Le rappel, appelant RequestAnimationFrame, est activ√© au m√™me stade que JavaScript et le contenu est rendu dans la derni√®re section du cadre lors de la composition.  Par cons√©quent, lors du premier appel, nous n'obtenons que la limite inf√©rieure, sensiblement supprim√©e dans le temps de la sortie des pixels √† l'√©cran. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/81c/788/f38/81c788f38c68e241cf3a34612503f9d0.jpg"><br><br>  Placez deux cadres c√¥te √† c√¥te.  On peut voir qu'√† la fin du premier d'entre eux le contenu a √©t√© rendu.  Nous √©crivons la bordure inf√©rieure de RequestAnimationFrame, appel√©e √† l'int√©rieur du premier rappel, et rappelons dans la deuxi√®me trame.  Ainsi, nous obtenons l'intervalle de JavaScript appel√© dans le cadre o√π le contenu a √©t√© rendu en JavaScript dans le deuxi√®me cadre. <br><br><h2>  InterceptionObserver </h2><br>  Notre deuxi√®me b√©quille avec le m√™me contenu fonctionne diff√©remment.  Cette fois, le script est plac√© ci-dessous.  Nous y cr√©ons InterceptionObserver et souscrivons √† domNode. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd6/dea/87d/fd6dea87dd53e374e2ba19aa79d4a379.jpg"><br><br>  Nous ne transmettons pas de param√®tres suppl√©mentaires, nous mesurons donc son intersection avec la fen√™tre.  Cette heure est enregistr√©e comme l'heure exacte du rendu. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/549/5ab/d02/5495abd0268d0d59077d00ade282989a.jpg"><br><br>  Cela fonctionne parce que l'intersection du contenu principal et de la fen√™tre est l'intersection exacte que l'utilisateur voit.  Cette API a √©t√© con√ßue pour savoir exactement quand un utilisateur a vu une annonce, mais nos recherches ont montr√© que cela fonctionne √©galement sur des blocs non publicitaires. <br><br>  De ces deux m√©thodes, il est toujours pr√©f√©rable d'utiliser RequestAnimationFrame: son support est plus large, et il est mieux test√© par nous en pratique. <br><br><h2>  Js inited </h2><br>  Imaginez un framework qui a une sorte d'√©v√©nement ¬´init¬ª auquel vous pouvez vous abonner, mais rappelez-vous qu'en pratique, JS Inited est √† la fois une m√©trique simple et complexe. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3bf/6fe/85c/3bf6fe85c743f0ad6c255d8e4c448eae.jpg"><br><br>  Simple - car il vous suffit de trouver le moment o√π le framework a termin√© l'organisation des √©v√©nements.  Complexe - car vous devez rechercher ce point par vous-m√™me pour chaque framework. <br><br><h2>  Temps d'interactivit√© </h2><br>  TTI est souvent confondu avec la m√©trique pr√©c√©dente, mais en fait c'est un indicateur du moment o√π le flux principal du navigateur est lib√©r√©.  Pendant le chargement de la page, de nombreuses t√¢ches sont effectu√©es: du rendu de divers √©l√©ments √† l'initialisation du framework.  Ce n'est que lorsqu'il est d√©charg√© que vient le temps de la premi√®re interactivit√©. <br><br>  Le concept de t√¢ches longues et l'API Long Task aident √† mesurer cela. <br><br>  Tout d'abord sur les longues t√¢ches. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f79/67b/828/f7967b8283a7302b1d8d9b1bd076cfac.jpg"><br><br>  Entre les courtes t√¢ches indiqu√©es par des fl√®ches, le navigateur peut facilement entasser le traitement d'un √©v√©nement utilisateur, par exemple une entr√©e, car il a une priorit√© √©lev√©e.  Mais avec les longues t√¢ches indiqu√©es par les fl√®ches rouges, cela ne fonctionnera pas. <br><br>  L'utilisateur devra attendre jusqu'√† √©puisement, et seulement apr√®s que le navigateur aura proc√©d√© au traitement de sa saisie.  Dans le m√™me temps, le framework peut d√©j√† √™tre initialis√©, et les boutons fonctionneront, mais lentement.  Une telle r√©ponse diff√©r√©e est une exp√©rience utilisateur plut√¥t d√©sagr√©able.  Au moment o√π la derni√®re t√¢che longue est termin√©e et le thread est vide depuis longtemps, l'illustration arrive √† 7 secondes et 300 millisecondes. <br><br>  Comment mesurer cet intervalle √† l'int√©rieur de JavaScript? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/66f/f1b/114/66ff1b114d718aa4e31cf8c2f1094525.jpg"><br><br>  La premi√®re √©tape est conditionnellement d√©sign√©e comme la balise d'ouverture du corps, apr√®s quoi vient le script.  Cela cr√©e un PerformanceObserver qui s'abonne √† l'√©v√©nement de t√¢che longue.  Dans le PerformanceObserver de rappel, les informations sur les √©v√©nements sont collect√©es dans un tableau. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3e3/1c4/c60/3e31c4c60298c19431ca84a93c908394.jpg"><br><br>  Apr√®s avoir collect√© les donn√©es, le moment est venu pour la deuxi√®me √©tape.  Il est d√©sign√© sous forme de balise de fermeture.  Nous prenons le dernier √©l√©ment du tableau, la derni√®re longue t√¢che, regardons le moment de son ach√®vement et v√©rifions si suffisamment de temps s'est √©coul√©. <br><br>  Dans le travail original sur cette m√©trique, 5 secondes ont √©t√© prises comme constante, mais le choix n'a √©t√© aucunement √©tay√©.  Cela s'est av√©r√© suffisant pour 3 secondes.  Si 3 secondes s'√©coulent, nous comptons le temps jusqu'√† la premi√®re interactivit√©; sinon, nous r√©glons Timeout et v√©rifions √† nouveau cette constante. <br><br><h2>  Comment traiter les donn√©es? </h2><br>  Les donn√©es doivent √™tre re√ßues des clients, trait√©es et pr√©sent√©es de mani√®re pratique.  Notre concept d'envoi de donn√©es est assez simple.  Cela s'appelle un compteur. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/38f/158/cba/38f158cbaf1233223fdca1ba255f9e25.jpg"><br><br>  Nous transf√©rons les donn√©es d'une certaine m√©trique vers un stylo sp√©cial sur le backend et les collectons dans le r√©f√©rentiel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/884/cda/04a/884cda04a3b619b084dfde376a0645cc.jpg"><br><br>  Ici, l'agr√©gation de donn√©es est classiquement d√©sign√©e comme une requ√™te SQL.  Voici les principales agr√©gations que nous consid√©rons g√©n√©ralement en fonction des m√©triques de vitesse: moyenne arithm√©tique et groupe centile (50e, 75e, 95e, 99e). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/354/84a/d7c/35484ad7c51d967118abb42646a09801.jpg"><br><br>  La moyenne arithm√©tique dans notre s√©rie num√©rique est presque 1900. Elle est sensiblement plus grande que la plupart des √©l√©ments de l'ensemble, car cette agr√©gation est tr√®s sensible aux valeurs aberrantes.  Cette propri√©t√© nous est toujours utile. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d6b/2ac/b00/d6b2acb00b844c6294fa80a50e03495c.jpg"><br><br>  Afin de calculer les centiles pour le m√™me ensemble, triez-le et placez le pointeur sur l'index des centiles.  Disons le 50e, qui est aussi appel√© la m√©diane.  Nous tombons entre les √©l√©ments.  Dans ce cas, vous pouvez sortir de la situation de diff√©rentes mani√®res, nous calculons la moyenne entre elles.  Nous obtenons 150. Par rapport √† la moyenne arithm√©tique, on voit clairement que les centiles sont insensibles aux valeurs aberrantes. <br><br>  Nous prenons en compte et utilisons ces fonctionnalit√©s d'agr√©gation.  La sensibilit√© arithm√©tique des √©missions est un inconv√©nient si vous essayez d'√©valuer l'exp√©rience utilisateur avec.  En effet, un utilisateur peut toujours se connecter au r√©seau, par exemple depuis un train, et g√¢cher la s√©lection. <br><br>  Mais la m√™me sensibilit√© est un avantage en mati√®re de monitoring.  Afin de ne pas rater un probl√®me important, nous utilisons la moyenne arithm√©tique.  Il se d√©place facilement, mais le risque de faux positifs dans ce cas n'est pas un gros probl√®me.  Mieux vaut n√©gliger que n√©gliger. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dcb/e92/a6b/dcbe92a6baf2a4ec1e2ef01580dd948d.jpg"><br><br>  De plus, nous consid√©rons la m√©diane (si nous l'attachons aux m√©triques de temps, la m√©diane est un indicateur de l'heure √† laquelle 50% des demandes correspondent) et le 75e centile.  75% des demandes correspondent √† ce moment, nous consid√©rons cela comme une estimation de la vitesse globale.  Les 95e et 99e centiles sont consid√©r√©s comme mesurant la longue queue lente.  Ce sont de tr√®s grands nombres.  Le 95e est consid√©r√© comme la demande la plus lente.  Le 99e centile est anormal. <br><br>  Il ne sert √† rien de compter le maximum.  C'est le chemin de la folie.  Apr√®s avoir calcul√© le maximum, il peut s'av√©rer que l'utilisateur attend le chargement de la page depuis 20 ans. <br><br>  Apr√®s avoir consid√©r√© les agr√©gations, il ne reste plus qu'√† appliquer ces nombres, et la chose la plus √©vidente qui puisse √™tre faite avec eux est de les pr√©senter sous forme de graphiques. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e8d/552/3e9/e8d5523e9eeebf2545a7f214b75b8ede.jpg"><br><br>  Sur le graphique, notre temps r√©el pour les premi√®res mesures de peinture de contenu pour la recherche.  La ligne bleue refl√®te la dynamique des ordinateurs de bureau, la rouge - pour les appareils mobiles. <br><br>  Nous devons constamment surveiller les graphiques de vitesse et nous avons confi√© cette t√¢che au robot. <br><br><h2>  Suivi </h2><br>  √âtant donn√© que les mesures de vitesse sont volatiles et fluctuent constamment avec diff√©rentes p√©riodes, la surveillance doit √™tre affin√©e.  Pour cela, nous utilisons le concept de frustrations. <br><br>  Le d√©bogage est le moment o√π un processus al√©atoire modifie ses caract√©ristiques, telles que la variance ou l'attente math√©matique.  Dans notre cas, il s'agit de l'√©chantillon moyen.  Comme mentionn√©, la moyenne est sensible aux √©missions et bien adapt√©e √† la surveillance. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/621/9a7/c0b/6219a7c0bc99aef5991cda07179a487a.jpg"><br><br>  Voici un exemple de graphique o√π l'alignement s'est produit et o√π le robot a enregistr√© l'incident.  Comment a-t-il isol√© ce moment de plusieurs autres h√©sitations?  Pour comprendre cela, nous imposons des donn√©es suppl√©mentaires. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/93e/d21/ec4/93ed21ec4f2a624e3d703dc90b2c2530.jpg"><br><br>  Le graphique jaune est un indicateur m√©trique, et le graphique bleu est une moyenne mobile avec une p√©riode suffisamment longue.  Le rouge est la moyenne plus trois √©carts-types.  Le vert est le m√™me, seulement avec un signe moins. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4c8/899/b90/4c8899b90f7e2696100aa4c7069a868c.jpg"><br><br>  Les indicateurs rouges et verts forment un couloir s√ªr.  Alors que la m√©trique et la moyenne mobile fluctuent entre elles - tout est normal, ce sont des fluctuations ordinaires.  Mais s'ils quittent la zone de s√©curit√©, la surveillance est d√©clench√©e. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9fb/d41/25e/9fbd4125ece689bd90a84e520304fd3a.jpg"><br><br><h2>  V√©rification des fonctionnalit√©s pour la vitesse </h2><br>  Tout ce qui a √©t√© discut√© √©tait de travailler avec les donn√©es de vitesse d'un projet d√©j√† lanc√©, mais je veux mesurer la vitesse des fonctionnalit√©s individuelles avant de les envoyer √† une grande production.  Pour ce faire, nous utilisons les tests A / B - une comparaison des m√©triques pour les groupes de contr√¥le et exp√©rimentaux. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/819/128/e94/819128e94c08fec52e22da5914d28cbe.jpg"><br><br>  Nous divisons les utilisateurs en groupes de contr√¥le et exp√©rimentaux.  Les lectures de chaque cr√©neau sont collect√©es s√©par√©ment, agr√©g√©es et tabul√©es. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/31d/89b/1eb/31d89b1eb1915e2a0f8f29bc986f0521.jpg"><br><br>  Dans les tests A / B, en r√®gle g√©n√©rale, la moyenne arithm√©tique est √©galement utilis√©e.  Nous voyons ici un delta et, afin de d√©terminer avec pr√©cision s'il s'agit d'un accident ou d'un r√©sultat significatif, un test statistique est appliqu√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e78/37d/134/e7837d1340c59e00cf61a132c6ac72c9.jpg"><br><br>  Il est d√©sign√© comme ¬´MW¬ª car le test de Mann-Whitney est utilis√© dans le calcul.  Avec son aide, le soi-disant "pourcentage d'exactitude" est calcul√©.  Cet indicateur a un seuil, apr√®s lequel nous consid√©rons le delta comme vrai.  Ici, il est fix√© √† 99,9%. <br><br>  Lorsque le test atteint cette valeur, le delta est mis en surbrillance dans l'interface.  Nous l'appelons coloration.  Ici, nous voyons le vert, c'est-√†-dire une bonne coloration √† temps pour la premi√®re peinture pleine de contenu.  Le temps de la premi√®re peinture significative n'atteint pas cette valeur, c'est-√†-dire que le delta est √©galement bon, mais pas 99,9%.  Il est totalement impossible de lui faire confiance.  Lors de l'initialisation du cadre et du temps d'interactivit√©, une coloration rouge confiante est observ√©e.  On peut en tirer la m√™me conclusion que dans le cas des polices. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/25b/415/b14/25b415b14b30b25549f514aced7b52dd.jpg"><br><br><h2>  Comment le faire soi-m√™me? </h2><br>  Vous pouvez impl√©menter des mesures de vitesse de deux mani√®res.  La premi√®re consiste √† tout faire vous-m√™me. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e30/344/cb5/e30344cb56179ed9a633ff26c187291e.jpg"><br><br>  Une poign√©e pour recevoir des donn√©es des clients, un backend, qui met tout cela dans une base de donn√©es, MongoDB, PostgreSQL, MySQL, n'importe quel SGBD (ils ont des agr√©gations hors de la bo√Æte), plus l'une des nombreuses solutions open source - afin de dessiner des graphiques et d'organiser la surveillance. <br><br>  La deuxi√®me solution consiste √† utiliser les syst√®mes d'analyse Yandex Metric ou Google Analytics.  Sur l'exemple de Yandex Metrics, cela ressemble √† ceci. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/424/a97/f61/424a97f61a797dff9419d7df8828046b.jpg"><br><br>  Voici les mesures que la mesure fournit √† l'utilisateur hors de la bo√Æte.  Bien s√ªr, ce n'est pas tout ce qui pr√©c√®de, mais d√©j√† quelque chose.  Le reste peut √™tre ajout√© manuellement via les param√®tres utilisateur.  Des tests et une surveillance A / B sont √©galement disponibles. <br><br><h2>  Conclusion </h2><br>  Le concept de mesure de vitesse en ligne dont nous avons parl√© est connu sous le nom de RUM - Real User Monitoring.  Nous l'aimons tellement que nous avons m√™me dessin√© un logo avec un tr√©ma rock and roll cool. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e5f/8a9/448/e5f8a94489f01743c09e5ec04453cc56.jpg"><br><br>  Cette approche est bonne car elle est bas√©e sur des chiffres du monde r√©el, ces indicateurs dont dispose l'audience de votre service.  √Ä l'aide de mesures, vous semblez obtenir des commentaires de chaque utilisateur.  Alors commencez √† optimiser et ne vous arr√™tez pas. <br><blockquote>  L'annonce √† la fin.  Si vous avez aim√© cette conversation avec <b>HolyJS 2018 Piter</b> , vous serez probablement int√©ress√© par le prochain <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HolyJS 2018 Moscou</a></b> , qui se <b>tiendra du 24 au 25 novembre</b> .  L√†, vous pouvez non seulement voir de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nombreux autres</a> rapports JS, mais aussi demander √† n'importe quel orateur dans la zone de discussion apr√®s le rapport.  Et demain, √† partir du 1er novembre, le prix des billets augmentera jusqu'√† la finale, c'est donc aujourd'hui la derni√®re occasion de les acheter √† prix r√©duit! </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr426571/">https://habr.com/ru/post/fr426571/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr426559/index.html">R√©seaux de neurones pour le traitement d'images. Dit Alexander Savsunenko de Skylum Software</a></li>
<li><a href="../fr426561/index.html">The Great Five: doit avoir des outils pour acc√©l√©rer le d√©veloppement</a></li>
<li><a href="../fr426563/index.html">Carnet d'adresses hi√©rarchique, changement d'e-mail principal et autres innovations dans Zimbra 8.8.10</a></li>
<li><a href="../fr426565/index.html">¬´Le monde Java ne sera plus jamais le m√™me¬ª - entretien avec Alexander Belokrylov et Alexey Voitilov de BellSoft</a></li>
<li><a href="../fr426567/index.html">Le livre ¬´Chaos math√©matique. Des math√©matiques √©l√©mentaires aux abstractions sublimes ¬ª</a></li>
<li><a href="../fr426573/index.html">ZeroNights 2018. Recharger</a></li>
<li><a href="../fr426575/index.html">Rapport du Club de Rome 2018, chapitre 1.12: ¬´D'un monde vide √† un monde complet¬ª</a></li>
<li><a href="../fr426579/index.html">Engie et Ledger d√©veloppent une solution de blockchain mat√©rielle pour stocker les donn√©es g√©n√©r√©es par les sources d'√©nergie verte</a></li>
<li><a href="../fr426581/index.html">Ouvrir la le√ßon "Pr√©sentation des fonctionnalit√©s de Node.js"</a></li>
<li><a href="../fr426583/index.html">Dix personnes sur 90 mille sites: comment ne pas devenir fou</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>