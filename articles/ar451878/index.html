<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👵🏽 👩🏾‍🎤 👩🏿‍🤝‍👨🏻 البث المباشر للفيديو الاستريو إلى نظارات الواقع الافتراضي (Oculus Go) ⚠️ 🕺🏿 🌮</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="لن نقوم بجزء تمهيدي مطول ، وسوف نذهب مباشرة إلى هذه النقطة. 

 لذلك ، هناك كاميرا استريو يمكنها توصيل فيديو H264 عبر بروتوكولات مختلفة. هناك نظارات Oc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>البث المباشر للفيديو الاستريو إلى نظارات الواقع الافتراضي (Oculus Go)</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451878/" style=";text-align:right;direction:rtl">  لن نقوم بجزء تمهيدي مطول ، وسوف نذهب مباشرة إلى هذه النقطة. <br><br>  لذلك ، هناك كاميرا استريو يمكنها توصيل فيديو H264 عبر بروتوكولات مختلفة.  هناك نظارات Oculus العودة.  كيف يمكنك مشاهدة بث مباشر استريو من كاميرا في نظارات الواقع الافتراضي؟  من المستحسن ، مع الحد الأدنى من التأخير والمحلي ، بحيث تختفي Youtube وخدمات الفيديو RTMP الأخرى. <br><br>  في المستقبل ، هذا ما حدث.  في البداية - تشغيل ملف فيديو مسجل مسبقًا من جهاز استريو ، ثم تشغيل دفق مباشر باستخدام StereoPi (MPEG-TS عبر UDP). <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/MLPNXmZI8-8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><blockquote style=";text-align:right;direction:rtl">  الكاميرا المجسمة التي أستخدمها هي StereoPi ، لذلك سأقدم أمثلة محددة فيما يتعلق بها.  في الواقع ، هذا هو التوت العادي ، ولكن مع اثنين من الكاميرات ، لذلك يمكن تجربة الأمثلة المذكورة على التوت العادي ، إذا كنت تريد حقا.  صحيح ، سوف تحتاج إلى تثبيت البرامج الثابتة من StereoPi. </blockquote>  أول شيء كان محاولة لجعل تطبيق Android منتظم يقوم بتشغيل البث من الكاميرا إلى وضع ملء الشاشة ، وتعبئته في oculus باستخدام طريقة التحميل الجانبي (عبر adb). <br><br>  بعد اختيار بعض مع البيان ، وافقت النظارات على النظر في هذا التطبيق الأصلي.  ظهرت في "مصادر غير معروفة" في المكتبة ، التي بدأت ، وأظهرت كل ما هو مطلوب ، ولكن كانت هناك مشكلة - لم تؤخذ حركات الرأس في الاعتبار ، تم عرض الفيديو من الكاميرا ببساطة بغباء في كامل الشاشة مع النظارات.  كان تأثير الاستريو ، نعم ، ولكن بمجرد تحريك رأسي قليلاً ، بدأ سكان موسكو في الهوس ، مما تسبب في إحساسات غير مريحة للغاية. <br><br>  إذا كان الأمر كذلك ، فإليك تطبيق .apk: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">StereoPi لـ Oculus Go</a> وفي الوقت نفسه في الأرشيف والأكاذيب ، يمكنك محاولة ملء النظارات على الفور.  مجرد أمر <br><br><pre style=";text-align:right;direction:rtl"><code class="bash hljs">adb install StereoPi.apk</code> </pre> <br>  بعد ذلك ، انتقل إلى المكتبة -&gt; مصادر غير معروفة ، يجب أن يظهر التطبيق com.virt2real.stereopi هناك <br><br><img src="https://habrastorage.org/webt/q6/gi/zf/q6gizfqbbj_cftbnek3l8aqupno.png"><br><br>  نبدأ تشغيله وإذا كان StereoPi في نفس شبكة المنطقة المحلية كالنظارات ، فنرى على الفور صورة الاستريو من الكاميرا. <br><br>  ولكن هذا هو القمامة ... أريد تطبيق أصلي طبيعي للعين لمشاهدة الفيديو.  بحيث كانت هناك شاشة بلا حراك وحتى لا تتعرض للعنف عند تحريك رأسك.  لست مستعدًا لتعلم Unity for oculus حتى الآن ، لذلك حصلت على فكرة لمحاولة استخدام تطبيقات مشغل الفيديو الموجود بالفعل في متجر Oculus.  عادةً ما أشاهد الأفلام ثلاثية الأبعاد في <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Skybox</a> ، لذلك حاولت استخدامها. <br><br>  بالإضافة إلى العرض المعتاد لملفات الوسائط من محرك الأقراص المحمول المدمج ومن أجهزة الشبكة ، تم العثور على عنصر "Airscreen" المثير للاهتمام في Skybox.  اتضح أنه يمكنك تثبيت تطبيق Skybox على جهاز كمبيوتر يعمل بنظام Windows (جيدًا ، أو على جهاز Mac) ، وإطعام ملفات الفيديو الخاصة به ، ثم يصبح من الممكن مشاهدة ملفات الفيديو هذه بنظارات.  أي  تطبيق ويندوز هو خادم الفيديو ، والنظارات - عميل.  لم أجد بروتوكول الاتصال في أي مكان ، لذلك اضطررت للكشف عن tcpdump. <br><br>  بعد حفر قصير ، تبين أن Skybox يستخدم رسائل البث UDP للبحث عن خادم في الشبكة المحلية.  تبدو الرسالة مثل هذا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"search"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"project"</span></span>:<span class="hljs-string"><span class="hljs-string">"direwolf"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"66a86b57-b292-3957-9fc9-4041d5e1f841"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceType"</span></span>:<span class="hljs-string"><span class="hljs-string">"vr"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"udpPort"</span></span>:<span class="hljs-string"><span class="hljs-string">"6881"</span></span>}</code> </pre> <br><br>  جميع الرسائل في JSON مريحة للغاية. <br><br>  في هذه الرسالة ، نحتاج إلى إرسال استجابة إلى مضيف المرسل والمنفذ المحدد في الرسالة ، أي  6881 <br><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"udp"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-attr"><span class="hljs-attr">"project"</span></span>:<span class="hljs-string"><span class="hljs-string">"direwolf server"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"searchResult"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"66a86b57-b292-3957-9fc9-4041d5e1f841"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"computerId"</span></span>:<span class="hljs-string"><span class="hljs-string">"53709de962eba2f9695c8a926562486c"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"computerName"</span></span>:<span class="hljs-string"><span class="hljs-string">"STEREO-PI"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"ip"</span></span>:<span class="hljs-string"><span class="hljs-string">"192.168.1.51"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"ips"</span></span>:[<span class="hljs-string"><span class="hljs-string">"192.168.1.51"</span></span>],<span class="hljs-attr"><span class="hljs-attr">"port"</span></span>:<span class="hljs-number"><span class="hljs-number">6888</span></span>}</code> </pre><br>  نوضح هنا مضيفنا ومنفذنا الذي يعمل عليه خادم WebSockets.  جميع الاتصالات سوف تمر عبر websockets. <br><br>  على سبيل المثال ، ستكون الرسالة الأولى عبر مآخذ الويب مثل هذا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"addDevice"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"66a86b57-b292-3957-9fc9-4041d5e1f841"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Oculus Pacific"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceType"</span></span>:<span class="hljs-string"><span class="hljs-string">"vr"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"showLoginCode"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>}</code> </pre> <br>  نرد عليه: <br><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"addDevice"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceId"</span></span>:<span class="hljs-string"><span class="hljs-string">"66a86b57-b292-3957-9fc9-4041d5e1f841"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Oculus Pacific"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"deviceType"</span></span>:<span class="hljs-string"><span class="hljs-string">"vr"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"showLoginCode"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>}</code> </pre> <br>  وبعد ذلك ، في Skybox مع النظارات سنرى لدينا StereoPi.  التالي سيكون مجموعة من الطلبات التي تحتاج إلى إرسال الإجابات.  محتوى قائمة التشغيل ، على سبيل المثال. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">مثال قائمة التشغيل لـ Skybox</b> <div class="spoiler_text" style=";text-align:right;direction:rtl">  [{id: 'livestream-rtsp' ، <br>  اسم: "بث مباشر RTSP" ، <br>  المدة: 0 <br>  الحجم: 0 ، <br>  عنوان url: 'rtsp: //192.168.1.51: 554 / h264' ، <br>  الصورة المصغرة: 'http://192.168.1.51/thumbnail/livestream.png' ، <br>  الصورة المصغرة: 186 ، <br>  thumbnail الارتفاع: 120 ، <br>  last تم التعديل: 1 ، <br>  defaultVR الإعداد: 1 ، <br>  userVRSetting: 2 ، <br>  العرض: 1280 ، <br>  الارتفاع: 720 ، <br>  orientDegree: '0' ، <br>  ترجمات: [] ، <br>  ratioTypeFor2DScreen: 'افتراضي' ، <br>  rotationFor2DScreen: 0 ، <br>  موجود: صحيح <br>  isBadMedia: false ، <br>  وأضاف تايم: 1} ، <br>  {id: 'livestream-mpegts' ، <br>  الاسم: "البث المباشر MPEG-TS" ، <br>  المدة: 0 <br>  الحجم: 0 ، <br>  عنوان url: 'udp: // @: 3001' ، <br>  الصورة المصغرة: 'http://192.168.1.51/thumbnail/livestream.png' ، <br>  الصورة المصغرة: 186 ، <br>  thumbnail الارتفاع: 120 ، <br>  last تم التعديل: 1 ، <br>  defaultVR الإعداد: 1 ، <br>  userVRSetting: 2 ، <br>  العرض: 1280 ، <br>  الارتفاع: 720 ، <br>  orientDegree: '0' ، <br>  ترجمات: [] ، <br>  ratioTypeFor2DScreen: 'افتراضي' ، <br>  rotationFor2DScreen: 0 ، <br>  موجود: صحيح <br>  isBadMedia: false ، <br>  وأضاف تايم: 1}] <br></div></div><br>  هذا مثير للاهتمام خاصة منذ ذلك الحين  في قائمة التشغيل التي تشكل تطبيق Windows ، تم اكتشاف الاختصار المطلوب RTSP.  اتضح أن تطبيق الخادم يعمل على دفق ملفات الفيديو من خلال RTSP ، والذي يعد مناسبًا بالفعل لبث الفيديو المباشر ، والذي نحتاج إليه بالطبع.  بتعبير أدق ، اتضح أن هناك "RTSP" في قائمة التشغيل ، لكن الروابط إلى ملفات الفيديو هي http http منتظمة.  أي  لا يزال تطبيق الخادم يرسل الملفات عبر HTTP ، لكن هذا لا يناسبنا.  في هذه المرحلة ، كنت غاضبًا بالفعل ، لكنني اعتقدت ، لماذا لا أحاول إعطاء رابط في قائمة التشغيل بتنسيق يفهمه VLC عادة ، أي  rtsp: //192.168.1.51: 554 / h264 والهتافات ، بدأ Skybox في تشغيل دفق الفيديو من خادم RTSP على الاستريو.  التأخير كبير للغاية ، 20 ثانية ، لذلك انتقاء.  نحن نحاول تغذية دفق UDP إلى MPEG-TS.  مرة أخرى ، عادةً ما يأكل VLC هذا باستخدام الرابط udp: // @: 3001 ، بالنسبة إلى Skybox حاولت تحديد الطريقة نفسها.  ثم يبقى فقط لتوجيه دفق MPEG-TS إلى مجموعة النظارات ومنفذ UDP المحدد.  تشارك GStreamer في هذا: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">raspivid -3d sbs -w 1280 -h 720 -o - | gst-launch-1.0 -q fdsrc ! h264parse ! mpegtsmux alignment=7 name=muxer ! rndbuffersize max=1316 min=1316 ! multiudpsink clients=<span class="hljs-string"><span class="hljs-string">"192.168.1.60:3001"</span></span> sync=<span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  في صندوق السماء ، نضغط على عنصر قائمة التشغيل "Live Stream MPEG-TS" وفويلا ، ونرى دفق MPEG-TS مباشر على الشاشة الكبيرة في سينما افتراضية.  التأخير أقل بكثير من RTSP ، 2-3 ثواني ، ولكن لا يزال أكثر بكثير مما في تطبيقي البسيط الذي يتلقى دفق H264 خام عبر UDP (عادة ما يكون هناك تأخير 100-150 مللي ثانية بدقة 720p). <br><br>  ثم وصلت إلى طريق مسدود ، حتى الآن لم تنجح في الحد من التأخير.  ربما تحتاج إلى تعطيل التخزين المؤقت في Skybox نفسه ، سأحاول الكتابة إلى المطورين ، وربما سيضعون خيار "تعطيل التخزين المؤقت" :-) <br><br><h3 style=";text-align:right;direction:rtl">  في الختام </h3><br>  بشكل عام ، إذا كنت بحاجة مفاجئة لسبب ما فجأة لمشاهدة بث فيديو مباشر في oculi أو نظارات VR الأخرى (Skybox متاح في العديد من المنصات مثل) - يمكنك تجربة الطريقة التي وصفتها.  لا أعرف ما إذا كان هذا سيعمل مع كاميرات الاستريو الأخرى ، ولكن مع استريو ستيربي تم التحقق منه ، فإنه يحرث. <br><br><h3 style=";text-align:right;direction:rtl">  مراجع </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مصدر الخادم ل skybox</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">منتدى الموضوع مع المناقشة</a> <br><br>  شكرا لكم جميعا ، كل شخص حر. <br><br>  أوه نعم ، لقد نسيت تقريبا.  إذا تمكن شخص ما فجأة من المساعدة في التطبيق الأصلي للعين (بحيث يبدو وكأنه Skybox) - اكتب في رسالة شخصية ، سنناقش التفاصيل. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar451878/">https://habr.com/ru/post/ar451878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar451866/index.html">اختيار أقرب العقد في الشبكة</a></li>
<li><a href="../ar451870/index.html">ميزات C ++ الحديثة التي يحتاج جميع المبرمجين إلى معرفتها</a></li>
<li><a href="../ar451872/index.html">بيثون هو مساعد في إيجاد رحلات رخيصة لأولئك الذين يحبون السفر</a></li>
<li><a href="../ar451874/index.html">كبار كبار المسئولين الاقتصاديين الاتجاهات في جوجل</a></li>
<li><a href="../ar451876/index.html">مركز بيانات فرانكفورت: مركز بيانات Telehouse</a></li>
<li><a href="../ar451880/index.html">DevPRO'19: منظر من كشك Wrike</a></li>
<li><a href="../ar451884/index.html">سبع سنوات من العمل كمطور: ما هي الدروس التي تعلمتها</a></li>
<li><a href="../ar451886/index.html">باستخدام الرياضيات المنفصلة في الاختبار</a></li>
<li><a href="../ar451890/index.html">تفويض منطقة شبكة فرعية عكسي أقل من / 24 في BIND. كيف يعمل؟</a></li>
<li><a href="../ar451894/index.html">لمحة موجزة ومفعم بالحيوية عن برنامج التحويل البرمجي</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>