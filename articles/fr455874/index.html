<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÇüèª üëºüèø üíÜüèæ Proc√©dure de notification pour les applications Electron pour macOS 10.14.5 üëàüèª üòå üç±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avec la sortie de macOS 10.14.5, Apple a ajout√© un processus de notarisation obligatoire pour les applications avant de les distribuer. Je voudrais vo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Proc√©dure de notification pour les applications Electron pour macOS 10.14.5</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455874/"><p>  Avec la sortie de macOS 10.14.5, Apple a ajout√© un processus de notarisation obligatoire pour les applications avant de les distribuer.  Je voudrais vous dire de quoi il s'agit et quelles difficult√©s sont survenues avec cette mise √† jour lors du d√©veloppement sur Electron.js. </p><br><p><img src="https://habrastorage.org/webt/7c/vo/qz/7cvoqzkecwn_jtlk82d33eghvda.png"></p><a name="habracut"></a><br><h2 id="vvedenie">  Pr√©sentation </h2><br><p>  2 ans apr√®s le boom d'Electron.js, tous les holivars chauds sur la fa√ßon dont elle est mauvaise et pourquoi elle est n√©cessaire sont silencieux.  Ne les rallumons pas dans les commentaires.  Je vous remercie </p><br><p>  Notre projet utilise un g√©n√©rateur d'√©lectrons pour cr√©er l'application, mais pour l'√©lectron-emballeur, cette proc√©dure sera √† peu pr√®s la m√™me. </p><br><p>  Le projet lui-m√™me est un lanceur pour les jeux en nuage, √† travers lequel un client natif est lanc√© pour acc√©der √† un ordinateur distant. </p><br><p>  La signature d'une candidature avec √©lectron-constructeur ne semble pas compliqu√©e, mais pour √™tre complet, je vais parler bri√®vement de cette proc√©dure.  Si vous n'avez aucun probl√®me √† signer l'application, vous pouvez ignorer ce chapitre. </p><br><h3 id="podpisanie-prilozheniya">  Signature d'application </h3><br><p>  Pour signer l'application, nous devons exporter les certificats depuis le compte personnel du d√©veloppeur Apple.  Nous aurons besoin de: </p><br><ul><li>  D√©veloppeur ID Application </li><li>  D√©veloppeur ID Installer </li><li>  * Application de d√©veloppeur Mac tiers et programme d'installation de d√©veloppeur Mac tiers (si vous pr√©voyez de publier l'application dans l'AppStore) </li></ul><br><p>  Le certificat Developer ID Installer est √©mis pour une application sp√©cifique, pour ce bundleID est requis.  Pour √©lectron-builder, il est sp√©cifi√© par le param√®tre appId dans package.json </p><br><p><img src="https://habrastorage.org/webt/pz/xc/ut/pzxcutr2ad_xxln6bqd5dlegi1q.png"></p><br><p>  Les certificats doivent √™tre collect√©s dans un seul fichier.  Pour ce faire, ajoutez-les au trousseau (2 clics sur le certificat). <br>  Ensuite, nous allons au trousseau, s√©lectionnez les certificats n√©cessaires et cliquez sur "Exporter les √©l√©ments" dans le menu contextuel.  Apr√®s l'exportation, nous obtenons un fichier avec l'extension .p12. </p><br><p><img src="https://habrastorage.org/webt/uq/si/no/uqsinodlzfxhbrk0y3eqcyw2igi.png"></p><br><p>  Apr√®s le fichier de certificat re√ßu, ajoutez les entr√©es suivantes aux variables d'environnement </p><br><ul><li>  CSC_LINK (chemin d'acc√®s au fichier de certificat .p12) </li><li>  CSC_KEY_PASSWORD (mot de passe d'acc√®s au certificat) </li></ul><br><p>  Si vous n'ajoutez pas ces variables, le collecteur recherchera automatiquement les cl√©s appropri√©es dans le r√©f√©rentiel de trousseaux.  L'ajout de ces entr√©es vous permet de localiser les certificats que vous souhaitez utiliser pour la signature. </p><br><p>  Apr√®s ces op√©rations, vous pouvez d√©marrer le processus de construction et tout devrait se d√©rouler sans probl√®me. </p><br><p>  Cela a fonctionn√© en douceur jusqu'√† la sortie de macOS 10.14.5 .... </p><br><h2 id="chto-izmenilos-s-vyhodom-macos-10145">  Ce qui a chang√© avec macOS 10.14.5 </h2><br><p>  Une petite digression.  R√©alisant le dernier travail sur le nouveau patch de nuit, j'ai d√©cid√© de quitter l'assemblage de la version de production dans la matin√©e.  Remarquant qu'une mise √† jour est arriv√©e sur macOS, elle l'a lanc√©e et s'est mise en veille. </p><br><p>  Le lendemain matin, j'ai √©t√© surpris de voir que l'assemblage tombe d'une erreur inconnue au moment de la signature de l'application - "Unnotarized Developer ID". </p><br><blockquote>  Ne remettez √† demain que ce qui peut √™tre fait aujourd'hui.  Benjamin Franklin </blockquote><br><h4 id="sut-problemy">  L'essence du probl√®me </h4><br><p>  Depuis macOS 10.14.5, Apple a introduit une proc√©dure de notarisation obligatoire.  Le premier article d'Apple √† ce sujet date de 2018, mais c'est avec cette mise √† jour que cette proc√©dure est devenue obligatoire.  √Ä quoi ressemble-t-elle. </p><br><p>  Vous r√©cup√©rez l'application -&gt; l'envoyez au serveur Apple -&gt; Apple la certifie -&gt; Renvoie l'√©tat de la certification r√©ussie -&gt; La commande pour d√©finir le cachet de certification est ex√©cut√©e. </p><br><p>  Pour les d√©veloppeurs sur Xcode, il vous suffit de cocher la notarisation </p><br><p><img src="https://habrastorage.org/webt/-x/sa/t4/-xsat4hgljlntg9x36agif_k13c.png"></p><br><p>  Aussi, le processus de notarisation de l'application assembl√©e peut √™tre effectu√© par une commande dans le terminal. </p><br><pre><code class="plaintext hljs">$ xcrun altool --notarize-app --primary-bundle-id "com.example.ote.zip" --username "AC_USERNAME" --password "@keychain:AC_PASSWORD" --file OvernightTextEditor_11.6.8.zip</code> </pre> <br><ul><li>  primary-bundle-id - bundleID d'application </li><li>  nom d'utilisateur - login utilisateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">developer.apple.com</a> </li><li>  mot de passe - "mot de passe sp√©cifique √† l'application".  Il peut √™tre cr√©√© dans votre compte personnel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">appleid.apple.com</a> sous le compte du d√©veloppeur. </li></ul><br><p>  Si vous n'effectuez pas la proc√©dure de notarisation, alors lorsque l'utilisateur essaie d'installer l'application, une fen√™tre avec une erreur vole.  Gatekeeper est charg√© de v√©rifier la s√©curit√© de l'application.  C'est lui qui a cass√© l'assemblage de l'application sur le g√©n√©rateur d'√©lectrons. </p><br><p><img src="https://habrastorage.org/webt/v6/gm/-a/v6gm-azhc2cgsxtvrqylh4hz_l0.jpeg"></p><br><h4 id="kak-vyglyadel-process-sborki-electron-builder">  √Ä quoi ressemblait le processus de construction du g√©n√©rateur d'√©lectrons </h4><br><p>  Apr√®s avoir cr√©√© l'application dans le fichier .app, √† l'aide de l'utilitaire √©lectron-osx-sign, l'application a √©t√© sign√©e.  Apr√®s avoir sign√© avec le certificat, le processus de v√©rification de l'application avec un gatekepper a √©t√© lanc√©.  Mais avec la publication de la mise √† jour, le portier a commenc√© √† v√©rifier la bonne notarisation de l'application, ce qui n'a pas permis de mener √† bien la proc√©dure de signature de l'application. </p><br><p><img src="https://habrastorage.org/webt/gs/-v/g0/gs-vg0zydktmqzserrjzfqrjmi0.png"></p><br><h4 id="patch-dlya-vozmozhnosti-notarizacii">  Patch pour la notarisation </h4><br><p>  L'utilisateur de Github <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kallin a</a> rapidement sugg√©r√© une solution, avec l'ajout de deux nouveaux param√®tres aux param√®tres.  Le premier est "gatekeeperAssess" - d√©sactive la validation de l'assembly apr√®s la signature, et le second est "sign" - qui d√©sactive la signature du fichier d'installation (dmg) avec un certificat.  Cette validation est incluse dans la version du g√©n√©rateur d'√©lectrons 20.43.0. </p><br><p>  Pour le processus de notarisation lui-m√™me, electron-userland poss√®de un module de notarisation d'√©lectrons qui effectue cette t√¢che, il vous suffit d'√©crire un petit script et de l'ex√©cuter √† l'aide du crochet afterSign. </p><br><h2 id="process-podpisaniya-i-notarizacii-prilozheniya">  Processus de signature et de notarisation des applications </h2><br><p><img src="https://habrastorage.org/webt/mc/qg/n5/mcqgn5yehovsqcheiyq_5a1b-qo.png"></p><br><p>  Au d√©part, vous devez v√©rifier que vous avez install√© la version du g√©n√©rateur d'√©lectrons&gt; = 20.43.0 et installer le package electron-notarize. </p><br><p>  Ajoutez 2 entr√©es aux variables d'environnement: </p><br><ul><li>  appleId - connexion <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">developer.apple.com</a> </li><li>  appleASP - "mot de passe sp√©cifique √† l'application", qui peut √™tre cr√©√© dans votre compte personnel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">appleid.apple.com</a> . </li></ul><br><p><img src="https://habrastorage.org/webt/q0/co/bv/q0cobvddzumimcg6kzffx9hzjkg.png"></p><br><p>  Cr√©ez maintenant un script de notarisation qui sera ex√©cut√© apr√®s la signature de l'application. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> notarize = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'electron-notarize'</span></span>).notarize; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (context) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { electronPlatformName } = context; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (electronPlatformName === <span class="hljs-string"><span class="hljs-string">'darwin'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Try notarize app'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> notarize({ <span class="hljs-attr"><span class="hljs-attr">appBundleId</span></span>: <span class="hljs-string"><span class="hljs-string">'APP_BUNDLE_ID'</span></span>, <span class="hljs-attr"><span class="hljs-attr">appPath</span></span>: <span class="hljs-string"><span class="hljs-string">'./dist/mac/APP_NAME.app'</span></span>, <span class="hljs-attr"><span class="hljs-attr">appleId</span></span>: process.env.appleId, <span class="hljs-attr"><span class="hljs-attr">appleIdPassword</span></span>: process.env.appleASP, }); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Success notarize'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (err) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(err); } } };</code> </pre> <br><p>  Nous l'enregistrons dans un endroit qui vous convient. </p><br><p>  De plus, pour une bonne notarisation, nous devons d√©terminer les droits d'acc√®s <br>  aux ressources syst√®me pour notre application.  Pour ce faire, cr√©ez le fichier build / droitements.mac.inherit.plist </p><br><pre> <code class="plaintext hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt; &lt;plist version="1.0"&gt; &lt;dict&gt; &lt;key&gt;com.apple.security.cs.allow-jit&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.cs.allow-unsigned-executable-memory&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.cs.allow-dyld-environment-variables&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.cs.disable-library-validation&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.cs.disable-executable-page-protection&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.cs.debugger&lt;/key&gt; &lt;true/&gt; &lt;key&gt;com.apple.security.automation.apple-events&lt;/key&gt; &lt;true/&gt; &lt;/dict&gt; &lt;/plist&gt;</code> </pre> <br><p>  Le contenu du dossier dans mon cas.  Il peut y avoir une configuration diff√©rente pour vous.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Description de tous les champs</a> . <br>  Obligatoire pour Electron.js est - com.apple.security.cs.allow-unsigned-executable-memory. </p><br><p>  Maintenant, mettez √† jour les param√®tres dans package.json </p><br><p>  Dans la section pour macOS: </p><br><p><img src="https://habrastorage.org/webt/lg/-2/tn/lg-2tnabm6hagn1s17mrcfgzhbw.png"></p><br><ul><li>  gatekeeperAssess (d√©sactive la validation de l'application c√¥t√© signe √©lectron-osx) </li><li>  hardenedRuntime (permet de cr√©er une liste d'autorisations de s√©curit√© et d'acc√®s aux ressources syst√®me) </li><li>  habilitations (chemin d'acc√®s au fichier des autorisations d'acc√®s pour notre application) </li></ul><br><p>  Dans la section g√©n√©rale des param√®tres du g√©n√©rateur d'√©lectrons: </p><br><p><img src="https://habrastorage.org/webt/jb/6e/ek/jb6eekoqrg9qvfm2wxhilunfdjk.png"></p><br><ul><li>  afterSign (chemin vers le script de notarisation, qui sera lanc√© apr√®s la signature de l'application) </li></ul><br><p>  Nous commen√ßons le processus d'assemblage.  Cela peut sembler un peu suspendu, mais le transfert du fichier vers le serveur Apple et l'attente d'une r√©ponse prennent un certain temps (de 3 √† 10 minutes) </p><br><p>  L'√©tat des notifications peut √™tre consult√© dans le terminal en ex√©cutant la commande: </p><br><p> <code>$ xcrun altool --notarization-history 0 -u $appleId -p $appleASP</code> </p> <br><p>  La r√©ponse sera pr√©sent√©e dans un tableau.  Le champ d'√©tat peut avoir la valeur ¬´processus¬ª, ¬´approuv√©¬ª, ¬´non valide¬ª </p><br><p><img src="https://habrastorage.org/webt/lf/-c/gt/lf-cgtkjf3jwkwses9dnbaztnig.png"></p><br><p>  Si le statut est ¬´invalide¬ª, vous pouvez voir par le num√©ro de la demande ce qui s'est exactement pass√©. </p><br><p> <code>$ xcrun altool --notarization-info "RequestUUID" -u $appleId</code> </p> <br><p>  C'est tout le processus de signature et de notarisation.  J'esp√®re que cet article vous sera utile.  Je vous remercie </p><br><h4 id="nebolshoe-dopolnenie">  Petit ajout </h4><br><p>  Lors du transfert de l'application pour les tests, un probl√®me int√©ressant a √©t√© d√©couvert.  La demande re√ßue par Telegram a simplement refus√© de commencer.  Lors de l'affichage des journaux, il a √©t√© d√©couvert que l'application √©tait mise en quarantaine par Telegram.  Pour quelle raison et comment cela s'est produit, je n'ai pas pu trouver la r√©ponse.  Lors de l'envoi d'un fichier via Yandex.Disk (ou tout autre moyen de t√©l√©chargement via un navigateur), ce probl√®me ne se produit pas. </p><br><p><img src="https://habrastorage.org/webt/ww/3j/4k/ww3j4kakytwimj8uvz89d0jm2l0.png"></p><br><h3 id="poleznye-ssylki">  Liens utiles </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©p√¥t de notaire √©lectronique</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article d'Apple sur la notarisation des applications</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'article de Kallin sur le processus de notarisation, l'a trouv√© lorsque j'ai fini d'√©crire mon</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455874/">https://habr.com/ru/post/fr455874/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455858/index.html">R√©seaux de t√©l√©vision par c√¢ble pour les plus petits. Partie 9: Headend</a></li>
<li><a href="../fr455860/index.html">D√©veloppement de BPM √©l√©gant et √† la mode pour les jeunes chez Camunda</a></li>
<li><a href="../fr455862/index.html">Nouveaut√©s d'AWS: API DATA, Kinesis Data Analytics, S3 Path</a></li>
<li><a href="../fr455868/index.html">Surmonter la loi de Moore: les technologies des transistors du futur</a></li>
<li><a href="../fr455872/index.html">Quels paris Bezos a-t-il faits en 1997 pour qu'Amazon d√©tienne d√©sormais 50% du march√© du e-commerce aux √âtats-Unis et 14% dans le monde?</a></li>
<li><a href="../fr455878/index.html">Sc√©narios d'utilisation de l'analyse vid√©o dans le commerce de d√©tail. Sur les traces de l'analytique vid√©o dans le commerce de d√©tail</a></li>
<li><a href="../fr455880/index.html">Une nouvelle s√©rialisation peut appara√Ætre en Java</a></li>
<li><a href="../fr455882/index.html">Network Factory pour Cisco ACI Data Center - Aide Administrateur</a></li>
<li><a href="../fr455884/index.html">Extension de code VS - Extraits - Je dirai comment gagner du temps</a></li>
<li><a href="../fr455886/index.html">Donnez un nom √† l'√©toile et √† l'exoplan√®te dans le syst√®me HAT-P-3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>