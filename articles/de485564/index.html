<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé≤ üê£ üë®‚Äçüë®‚Äçüë¶ Reverse Engineering des Ngrok v2-Protokolls ü¶Ö üë©üèΩ‚Äçüè´ üçë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Reverse Engineering des Ngrok v2-Protokolls 

 ngrok ist ein Dienst, mit dem Sie Tunnel zum lokalen Computer des Benutzers erstellen k√∂nnen. Mit ander...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reverse Engineering des Ngrok v2-Protokolls</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485564/"><h1>  Reverse Engineering des Ngrok v2-Protokolls </h1><hr><p>  <a href="https://ngrok.com/" rel="nofollow">ngrok</a> ist ein Dienst, mit dem Sie Tunnel zum lokalen Computer des Benutzers erstellen k√∂nnen.  Mit anderen Worten ist eine √∂ffentliche Adresse reserviert, an die alle Anrufe an den lokalen Port weitergeleitet werden. </p><p> Leider wurde seit 2016 die Unterst√ºtzung f√ºr die <a href="https://github.com/inconshreveable/ngrok" rel="nofollow">Open-Source-Version des Clients (ngrok v1)</a> eingestellt, und um den Dienst zu nutzen, m√ºssen Sie die geschlossene Version (ngrok v2) ausf√ºhren, was in vielen F√§llen nicht akzeptabel ist.  Dieser Artikel beschreibt das Erlernen des von einem offiziellen Client verwendeten Protokolls und das Erstellen eines alternativen offenen Clients. </p><a name="habracut"></a><br><h2>  Aber ist es notwendig?  Ngrok Alternativen </h2><hr><p>  Seltsamerweise hat dieser Service nur sehr wenige Alternativen.  Im Einzelnen drei: </p><br><ul><li><p>  <a href="https://serveo.net/" rel="nofollow">serveo.net</a> .  Bietet √§hnliche Funktionen, verwendet jedoch die SSH-Weiterleitung √ºber den umgekehrten Port und keinen benutzerdefinierten Client.  Leider ist das Projekt derzeit geschlossen. </p><blockquote><h3>  Serveo ist wegen Phishing vor√ºbergehend deaktiviert. </h3><p>  Serveo wird in wenigen Tagen mit einigen neuen Einschr√§nkungen zur√ºckkehren, um Missbrauch zu unterbinden.  Vielen Dank f√ºr Ihre Geduld! </p></blockquote></li><li>  <a href="https://localtunnel.me/" rel="nofollow">localtunnel.me</a> .  Es wird nur ein HTTP-Tunnel mit einer Verteilung bereitgestellt, die auf dem Host-Header basiert. Bei HTTPS werden die Daten auf dem Server entschl√ºsselt und im Klartext an die Clientanwendung gesendet.  Die Projektsite ist derzeit nicht verf√ºgbar. </li><li>  <a href="https://pagekite.net/" rel="nofollow">pagekite.net</a> .  Bietet HTTP- und TLS-Tunnel.  Nach einer 30-t√§gigen Testphase m√ºssen Sie f√ºr die weitere Verwendung bezahlen. </li></ul><p>  (PS Die Kommentare deuten darauf hin, dass es <a href="https://localhost.run/" rel="nofollow">localhost.run gibt</a> , das HTTP-Tunnel √ºber SSH-Portweiterleitung bereitstellt, √§hnlich wie serveo.net. Anscheinend stellt der Dienst jedoch im Gegensatz zu ngrok <b>nur</b> HTTP-Tunnel bereit.) </p><br><h2>  Naiver Versuch # 1: Mitmproxy </h2><hr><p>  Versuchen wir, den offiziellen Anwendungsdatenverkehr mit mitmproxy zu √ºberwachen: </p><br><pre><code class="bash hljs">$ mitmproxy $ http_proxy=http://127.0.0.1:8080 https_proxy=http://127.0.0.1:8080 ngrok http 8080 <span class="hljs-comment"><span class="hljs-comment">#    </span></span></code> </pre> <br><p>  Die Anwendung beginnt nat√ºrlich auf einem ung√ºltigen Zertifikat zu schw√∂ren.  Der Fehlertext zeigt jedoch, dass ngrok versucht, die Serveradresse tunnel.us.ngrok.com √ºber DNS-over-HTTPS aufzul√∂sen: </p><br><pre> <code class="plaintext hljs">Get https://dns.google.com/resolve?cd=true&amp;name=tunnel.us.ngrok.com&amp;type=AAAA: x509: certificate signed by unknown authority</code> </pre> <br><p>  Versuchen wir, tunnel.us.ngrok.com selbst zu ziehen: </p><br><pre> <code class="bash hljs">$ curl https://tunnel.us.ngrok.com/ curl: (60) SSL certificate problem: unable to get <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> issuer certificate More details here: https://curl.haxx.se/docs/sslcerts.html curl failed to verify the legitimacy of the server and therefore could not establish a secure connection to it. To learn more about this situation and how to fix it, please visit the web page mentioned above.</code> </pre><br><p>  Anscheinend verwendet der Client das Anheften von Zertifikaten mit einem selbstsignierten Zertifikat.  Versuchen wir den Fehler zu ignorieren: </p><br><pre> <code class="bash hljs">$ curl -k https://tunnel.us.ngrok.com Warning: Binary output can mess up your terminal. Use <span class="hljs-string"><span class="hljs-string">"--output -"</span></span> to tell Warning: curl to output it to your terminal anyway, or consider <span class="hljs-string"><span class="hljs-string">"--output Warning: &lt;FILE&gt;"</span></span> to save to a file. $ curl -k --output - https://tunnel.us.ngrok.com     -illegal WNDINC frame length: 0x474554</code> </pre><br><p>  Google stellt auf Anforderung der "illegalen WNDINC-Frame-L√§nge" eine <a href="https://github.com/inconshreveable/muxado" rel="nofollow">Bibliothek f√ºr Go</a> to Multiplex-TCP-Verbindungen zur Verf√ºgung.  Dieselbe Bibliothek wird im Zusammenhang mit einem Aufruf zum √ñffnen von Quellcodes von ngrok v2 erw√§hnt. </p><br><h2>  Muxado-Bibliothek </h2><hr><p>  √úberpr√ºfen Sie, ob ngrok die Muxado-Bibliothek wirklich verwendet: </p><br><pre> <code class="bash hljs">$ nm ./ngrok | grep muxado 00000000008ae2c0 T github.com/inconshreveable/muxado.(*addr).Network 00000000008ae2e0 T github.com/inconshreveable/muxado.(*addr).String 0000000000e31b40 B github.com/inconshreveable/muxado.bufferClosed 0000000000e31b50 B github.com/inconshreveable/muxado.bufferFull 00000000008ad430 T github.com/inconshreveable/muxado.Client 0000000000e31b60 B github.com/inconshreveable/muxado.closeError 00000000008b4c00 T github.com/inconshreveable/muxado.(*condWindow).Broadcast 00000000008b2ed0 T github.com/inconshreveable/muxado.(*condWindow).Decrement 00000000008b2da0 T github.com/inconshreveable/muxado.(*condWindow).Increment 00000000008b2d30 T github.com/inconshreveable/muxado.(*condWindow).Init ...</code> </pre><br><p>  Aus der Ausgabe dieses Befehls k√∂nnen verschiedene Schlussfolgerungen gezogen werden (Entschuldigung f√ºr die Tautologie): </p><br><ol><li>  ngrok benutzt diese Bibliothek wirklich. </li><li>  Der Autor hat nicht versucht, die ausf√ºhrbare Datei in irgendeiner Weise zu verschleiern, da darin noch Zeichen vorhanden waren. </li></ol><br><p>  Beachten Sie au√üerdem, dass der Fehler vom Server √ºber eine sichere Verbindung (TLS) empfangen wurde. Dies bedeutet, dass das Muxado-Protokoll <b>in einer</b> TLS-Sitzung verwendet wird.  Dies deutet darauf hin, dass √ºber Muxado Daten im Klartext √ºbertragen werden, da eine zus√§tzliche Verschl√ºsselung √ºberfl√ºssig w√§re.  Um unverschl√ºsselte Speicherausz√ºge zu entfernen, m√ºssen Sie nur die Aufrufe (* stream) .Read und (* stream) .Write abfangen. </p><br><h2>  Abi </h2><hr><p>  Bevor Sie versuchen, Anrufe abzufangen, m√ºssen Sie wissen, wie die f√ºr uns interessanten Parameter √ºbertragen werden.  Dazu schreiben wir unter Verwendung der Bibliothek ein einfaches Programm auf Go (netcat fungiert als empfangende Partei): </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"net"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/inconshreveable/muxado"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conn net.Conn conn, _ = net.Dial(<span class="hljs-string"><span class="hljs-string">"tcp"</span></span>, <span class="hljs-string"><span class="hljs-string">"127.0.0.1:1234"</span></span>) sess := muxado.Client(conn, &amp;muxado.Config{}) conn, _ = sess.Open() data := []<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello, world!"</span></span>) conn.Write(data) }</code> </pre></div></div><br><p>  Um den Verkehr abzufangen, interessieren wir uns f√ºr: </p><br><ul><li>  Eindeutige Thread-ID (zur Unterscheidung mehrerer gleichzeitig aktiver Threads erforderlich). </li><li>  Zeiger auf einen Puffer mit Daten. </li><li>  Die L√§nge des Datenpuffers. </li></ul><br><p>  Die Ausgabe von objdump auf dem github.com/inconshreveable/muxado.(*stream).Write-Funktion (lustig, dass Go-Entwickler sich anscheinend nicht mit der Namensverf√§lschung zu besch√§ftigen schienen) </p><br><pre> <code class="plaintext hljs"> 4de2d6: 48 8b 44 24 58 mov 0x58(%rsp),%rax 4de2db: 48 89 44 24 08 mov %rax,0x8(%rsp) 4de2e0: 48 8b 44 24 60 mov 0x60(%rsp),%rax 4de2e5: 48 89 44 24 10 mov %rax,0x10(%rsp) 4de2ea: 48 8b 44 24 68 mov 0x68(%rsp),%rax 4de2ef: 48 89 44 24 18 mov %rax,0x18(%rsp)</code> </pre><br><p>  Es bleibt abzuwarten, wo genau die Werte liegen, die wir auf dem Stack ben√∂tigen.  Verwenden Sie dazu gdb und zeigen Sie den Status des Stapels zum Zeitpunkt des Funktionsaufrufs an. </p><br><pre> <code class="plaintext hljs">Thread 1 "test" hit Breakpoint 1, github.com/inconshreveable/muxado.(*stream).Write (buf=..., err=..., n=&lt;optimized out&gt;, s=&lt;optimized out&gt;) at /home/sergey/muxado/src/github.com/inconshreveable/muxado/stream.go:81 81 func (s *stream) Write(buf []byte) (n int, err error) { (gdb) set language c Warning: the current language does not match this frame. (gdb) p {char*[4]}$rsp $1 = { 0x4e0cbf &lt;main.main+319&gt; "H\213l$XH\203\304`\303\350\002A\367\377\351\255\376\377\377", '\314' &lt;repeats 13 times&gt;, "dH\213\f%\370\377\377\377H;a\020vKH\203\354\bH\211,$H\215,$\017\266\005k\003\025", 0xc0000b4000 "", 0xc000014300 "Hello, world!", 0xd &lt;error: Cannot access memory at address 0xd&gt;}</code> </pre><br><p>  Das erste Element dieses Arrays ist die R√ºcksprungadresse und kann nicht an der √úbergabe von Argumenten teilnehmen.  Die letzten beiden sind offensichtlich die Adresse des Arrays und seine L√§nge;  Da der Zeiger auf den Stream in der Argumentliste an erster Stelle steht, ist es logisch anzunehmen, dass er sich in der zweiten Zelle befindet.  Sie kann (unter Vorbehalt) als eindeutige Kennung f√ºr den Stream verwendet werden. </p><p>  Jetzt wissen wir also, wie sich die Argumente der Funktion (* stream) .Write im Speicher befinden (f√ºr (* stream) .Lesen Sie alles genau gleich, da die Funktionen den gleichen Prototyp haben).  Es bleibt die √úberwachung selbst zu realisieren. </p><br><h2>  Naiver Versuch Nr. 2: Laufzeitfunktions-Hooks </h2><hr><p>  Versuchen wir, Anrufe umzuleiten (* stream) .Schreiben Sie zur Proxy-Funktion: </p><br><div class="spoiler">  <b class="spoiler_title">Ungef√§hr so</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">unsigned long long write_hook() { volatile long long* rsp = RSP(); void* stream = (void*)rsp[1]; char* buf = (char*)rsp[2]; long long len = rsp[3]; UNSET_HOOK(); unsigned long long ans; PUSH(rsp[3]); PUSH(rsp[2]); PUSH(rsp[1]); CALL(syscall_write); POP(24, ans); SET_HOOK(); return ans; }</code> </pre></div></div><br><p>  Wenn wir versuchen, ngrok mit diesem Hook aufzurufen, kommt es zu einem Absturz der folgenden Form: </p><br><pre> <code class="plaintext hljs">unexpected fault address 0x0 fatal error: fault [signal SIGSEGV: segmentation violation code=0x80 addr=0x0 pc=0x4a2dc6] goroutine 1 [running]: runtime.throw(0xac7ca8, 0x5) /usr/local/Cellar/go/1.8.3/libexec/src/runtime/panic.go:596 +0x95 fp=0xc42016f9f0 sp=0xc42016f9d0 runtime.sigpanic() ...</code> </pre><br><p>  Hier warten wir auf ein unerwartetes Hindernis gegen√ºber Goroutinen.  Tatsache ist, dass der Goroutine-Stapel dynamisch zugewiesen wird: Wenn im vorhandenen Stapel nicht gen√ºgend Speicherplatz vorhanden ist, wird er an einer anderen Stelle erneut zugewiesen und der aktuelle Inhalt wird kopiert.  Leider speichern die von gcc generierten Funktionen den alten Stapelzeiger im rbp-Register (dem sogenannten Frame-Zeiger), und wenn Sie von einer solchen Funktion zur√ºckkehren, zeigt der Stapelzeiger auf den bereits freigegebenen alten Stapel (use-after-free).  C ist hier also kein Helfer. </p><br><h2>  Versuch 3: GDB-Skript </h2><hr><p>  Wir werden ein Skript f√ºr gdb schreiben, das alle √ºbertragenen Daten ausgibt: </p><br><pre> <code class="plaintext hljs">set language c break github.com/inconshreveable/muxado.(*stream).Write commands set $stream={void*}($rsp+8) set $buf={char*}($rsp+16) set $len={long long}($rsp+24) p $stream p (*$buf)@$len p $len cont end run tcp 8080 -log stdout -log-format logfmt -log-level debug</code> </pre><br><p>  Dies funktioniert, aber f√ºr einen vollst√§ndigen Speicherauszug m√ºssen Sie die empfangenen Daten speichern.  Und hier gibt es mehrere Probleme: </p><br><ul><li>  Um die empfangenen Daten zu lesen, m√ºssen Sie warten, bis die Ausf√ºhrung der Funktion abgeschlossen ist.  Dieses Problem wird durch Festlegen eines Haltepunkts in der ret-Anweisung behoben. </li><li>  Eine Funktion kann weniger Daten als geplant lesen, w√§hrend die Anzahl der tats√§chlich gelesenen Bytes einer der R√ºckgabewerte der Funktion ist.  Sie m√ºssen verstehen, wie R√ºckgabewerte √ºbertragen werden.  (Es ist auch trivial, einen Stapel zu drucken, nachdem die Funktion ausgef√ºhrt wurde. Die gew√ºnschte Zahl liegt bei $ rsp + 48.) </li><li>  Das dritte und wichtigste Problem.  Die gdb-Ausgabe ist nicht f√ºr das automatische Parsen vorgesehen (siehe z. B. den Ausdruck im Abschnitt ABI), daher sind die so erhaltenen Speicherausz√ºge nur f√ºr die visuelle Analyse geeignet.  (Eigentlich ist das kein Problem, da das Protokoll extrem einfach ist und auf einen Blick erkannt wird). </li></ul><br><h2>  Versuch 4: Montage </h2><hr><p>  Wenn Sie die Bin√§rdatei mit ngrok objdump √∂ffnen, sehen Sie, dass zwischen den Abschnitten .text und .rodata eine L√ºcke von 0xc10 = 3088 Byte besteht: </p><br><pre> <code class="plaintext hljs"> 9773eb: e9 50 ff ff ff jmpq 977340 &lt;type..eq.[2]github.com/kevinburke/cli.Flag&gt;   .rodata: 0000000000978000 &lt;type.*&gt;:</code> </pre><br><p>  Dieselbe L√ºcke befindet sich in der Datei selbst, in der der leere Bereich mit null Bytes gef√ºllt ist.  Auf diese Weise k√∂nnen Sie die Gr√∂√üe des Segments √§ndern, das den in der Datei aufgezeichneten Textabschnitt enth√§lt (Suchen / Ersetzen im Hex-Editor), und dem Anrufprotokollierungsbereich Code hinzuf√ºgen. </p><p>  Der relative √úbergangsbefehl in der x86_64-Architektur ben√∂tigt 5 Bytes: Opcode (E9) + Offset zur endg√ºltigen Adresse (Int mit Vorzeichen).  Da die Gr√∂√üe der ausf√ºhrbaren ngrok-Datei deutlich unter 2 Gigabyte liegt, k√∂nnen Sie mit dieser Anweisung die Steuerung an eine beliebige Stelle im Textabschnitt √ºbertragen, einschlie√ülich unseres neuen Codes. </p><p>  Der erste Befehl beider Funktionen ben√∂tigt 9 Bytes, sodass die ersten 5 Bytes des Befehls durch einen Sprungbefehl ersetzt werden k√∂nnen: </p><br><pre> <code class="plaintext hljs"> 8b0e70: 64 48 8b 0c 25 f8 ff mov %fs:0xfffffffffffffff8,%rcx 8b0e77: ff ff</code> </pre><br><p>  Um die urspr√ºngliche Funktion aufzurufen, befolgen Sie einfach die urspr√ºngliche Anweisung und rufen Sie die Adresse func + 9 auf </p><p>  Mit der ret-Anweisung in der Funktion (* stream) .Read ist alles viel interessanter: </p><br><pre> <code class="plaintext hljs"> 8b0f6d: 7f 22 jg 8b0f91 &lt;github.com/inconshreveable/muxado.(*stream).Read+0xa1&gt; ... 8b0f8c: 48 83 c4 58 add $0x58,%rsp 8b0f90: c3 retq 8b0f91: 48 8b 5c 24 60 mov 0x60(%rsp),%rbx</code> </pre><br><p>  Die ret-Anweisung (im Gegensatz zu retf als retq geschrieben) belegt nur 1 Byte, w√§hrend die darauf folgende Anweisung ein Sprungziel ist, sodass Sie es nicht √§ndern k√∂nnen.  Der √úbergangsbefehl wird jedoch nirgends am Befehl ret selbst ausgef√ºhrt, sodass nichts daran hindert, ihn zusammen mit dem vorherigen Befehl durch den √úbergang zu ersetzen (nat√ºrlich muss er nach dem √úbergang abgeschlossen werden). </p><br><div class="spoiler">  <b class="spoiler_title">Vollst√§ndiger Assembler-Logger-Code</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">section .text org 0x9773f0 use64 write_pre_hook: ;      (*stream).Write push dword 0x74697277 call log add rsp, 8 mov rcx, [fs:-8] ;   (*stream).Write    jmp 0x8b0e79 read_post_hook: ;     0x8b0f8c add rsp, 0x58 ;    ret, .  push dword 0x64616572 call log add rsp, 8 ret log: ;  ,         push rdi push rsi push rdx push rax ;; stack layout: ;; rsp+32 ret ;; rsp+40 kind ('read' or 'writ') ;; rsp+48 ret0 ;; rsp+56 &amp;stream ;; rsp+64 buf ;; rsp+72 len ;; rsp+80 unknown ;; rsp+88 n ;; rsp+96 err ;       mmap mov rax, 9 mov rdi, 0 mov rsi, 44 add rsi, [rsp+72] mov rdx, 3 push r10 push r8 push r9 mov r10, 34 mov r8, -1 mov r9, 0 syscall test rax, rax js segfault pop r9 pop r8 pop r10 ;     mov edi, [rsp+40] mov [rax], edi lea rdi, [rax+4] lea rsi, [rsp+56] push rcx mov rcx, 40 ;up to rsp+96 rep movsb ;    mov rsi, [rsp+72] ;rsp+64 mov rcx, [rsp+80] ;rsp+72 rep movsb pop rcx ;  write mov rdi, 3 mov rsi, rax mov rdx, 44 add rdx, [rsp+72] push rax call writeall ;   pop rdi mov rsi, 44 add rsi, [rsp+72] mov rax, 11 syscall test rax, rax jnz segfault ;   pop rax pop rdx pop rsi pop rdi ret writeall: mov rax, 1 syscall test rax, rax js segfault add rsi, rax sub rdx, rax test rdx, rdx jnz writeall ret segfault: ;          mov [0], rax</code> </pre></div></div><div class="spoiler">  <b class="spoiler_title">Python-Programm zum Analysieren von Protokollen</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys stream = sys.stdin.buffer <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: chunk = stream.read(<span class="hljs-number"><span class="hljs-number">44</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> chunk: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> len(chunk) == <span class="hljs-number"><span class="hljs-number">44</span></span> kind = chunk[:<span class="hljs-number"><span class="hljs-number">4</span></span>].decode(<span class="hljs-string"><span class="hljs-string">'ascii'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> kind <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'read'</span></span>, <span class="hljs-string"><span class="hljs-string">'writ'</span></span>) str_id = hex(int.from_bytes(chunk[<span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>], <span class="hljs-string"><span class="hljs-string">'little'</span></span>)) l = int.from_bytes(chunk[<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">28</span></span>], <span class="hljs-string"><span class="hljs-string">'little'</span></span>) n = int.from_bytes(chunk[<span class="hljs-number"><span class="hljs-number">36</span></span>:], <span class="hljs-string"><span class="hljs-string">'little'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> kind == <span class="hljs-string"><span class="hljs-string">'read'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> l buf = stream.read(l) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> len(buf) == l <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">'--full-data'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sys.argv: buf = buf[:n] print(<span class="hljs-string"><span class="hljs-string">'((%r, %s, %d), (%r, %d))'</span></span>%(kind, str_id, l, buf, n))</code> </pre></div></div><br><p>  Somit haben wir jetzt ein Werkzeug zum Entfernen von Verkehrsdumps aus ngrok.  Probieren Sie es in Aktion aus! </p><br><div class="spoiler">  <b class="spoiler_title">Dump</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">(('writ', 0xc420326600, 4), (b'\x00\x00\x00\x00', 4)) (('writ', 0xc420148e00, 4), (b'\xff\xff\xff\xff', 4)) (('writ', 0xc420326600, 227), (b'{"Version":["2"],"ClientId":"","Extra":{"OS":"linux","Arch":"amd64","Authtoken":"3FjYRxVDd2QvNkX13h82k_6Thwfp93PUZEpsz3vYe5v","Version":"2.2.8","Hostname":"tunnel.us.ngrok.com","UserAgent":"ngrok/2","Metadata":"","Cookie":""}}\n', 227)) (('read', 0xc420326600, 512), (b'{"Version":"2","ClientId":"df05b949e58359ea6901cff60935531d","Error":"","Extra":{"Version":"prod","Cookie":"lh7YagbqJ9ixLYyE05ZDMPvaYNVm5isu$xF1Mp8fDc689269YUGlGNAV/0XRyrEH390rwGqILZqYS5+qDUNbMn2l4puKD2CJHAgI83yo49aopujf0uhPBm4t997BTBvpFSg+zrgnrW9cRNuO8ApSe2+OPpUuPK0GZYZ1bpbz7Pod7cJycwVIgDFZZXLxEeNdXylQxSax9YOxgxcHeLBa79OjqrJpEUUWYtTNiMa5wxkr0AwKh","AccountName":"\xd0\xa1\xd0\xb5\xd1\x80\xd0\xb3\xd0\xb5\xd0\xb9 \xd0\x9b\xd0\xb8\xd1\x81\xd0\xbe\xd0\xb2","SessionDuration":0,"PlanName":"Free"}}', 430)) (('read', 0xc420148a00, 4), (b'\xff\xff\xff\xff', 4)) (('writ', 0xc420148200, 4), (b'\x00\x00\x00\x01', 4)) (('writ', 0xc420148200, 111), (b'{"Id":"","Proto":"https","Opts":{"Hostname":"","Auth":"","Subdomain":""},"Extra":{"Balance":false,"Token":""}}\n', 111)) (('read', 0xc420148200, 512), (b'{"Id":"39b1e32e134eff8671b02268945643f9","URL":"https://deb82e2e.ngrok.io","Proto":"https","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":"","HostHeaderRewrite":false,"LocalURLScheme":""},"Error":"","Extra":{"Token":"WUiWWfM9kRbpFpXoEOCydiJdEob7BKN0$EHrXSWq/fY/mRDRSTNqkVWEVCDJUyBdMSU5uSEMH5RHq5D9W1gA1BTWTUEUbltyhQIlhTJvGxezhDeOYqGe5CwNFHnIOVNidToULds48FCVdWc0zRC3Djyack74P9mQ11VHKQKAXPzXUXlUbo6TRkwMWKrpN0q93pmL3fQamRP6cREZTl2YMdnFUZtwHwyh4LGacxGAvdCP867rTKBL/3eWLdkcF2lSPdHuH8V51RzCMWMIbvmtyySzE', 512)) (('read', 0xc420148200, 1024), (b'cOIiZ09W6pMPTHoTcih0"}}', 23)) (('writ', 0xc4200ea200, 4), (b'\x00\x00\x00\x01', 4)) (('writ', 0xc4200ea200, 127), (b'{"Id":"","Proto":"http","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":""},"Extra":{"Balance":false,"Token":""}}\n', 127)) (('read', 0xc4200ea200, 512), (b'{"Id":"9714ddd4cb111adf6599f099cec98482","URL":"http://deb82e2e.ngrok.io","Proto":"http","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":"","HostHeaderRewrite":false,"LocalURLScheme":""},"Error":"","Extra":{"Token":"G4nIrca8GTvq4H62sTmqdb144FmhMgrg$U6TwkKWafv/3+bFM5AP7xIFfkWqx+HUsYWhkYXivrtMfcqan0mKZx99LHGI7mm5lOMmvI+Kdy7WF/GnwrMDXrRFwhYowczaWKRKnUimnNtndq7rdttMevFabwe5WSzwf+IZhWzQ2yvcW31+qVuS7F6uykUSw+mnBNtsdXFSNpToagqQOM66A8LT+l3f3OOHKrWpdq39Bz2RfoRmXaRpkDrdfT6vPUQd6S8uVUnv3t2173Ik7AgT9PlzOMJ', 512)) (('read', 0xc4200ea200, 1024), (b'hhVDbeM2HP+qV6S5I="}}', 21)) (('writ', 0xc420148e00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148e00, 4), (b'\x00ys7', 4)) (('read', 0xc420148a00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148a00, 4), (b'\x00ys7', 4)) (('read', 0xc420148e00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148e00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc420148a00, 4), (b'\x11|\xb9\x99', 4)) (('writ', 0xc420148a00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc420148e00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc4200ea200, 4), (b'\x00\x00\x00\x03', 4)) (('read', 0xc4200ea200, 8), (b'M\x00\x00\x00\x00\x00\x00\x00', 8)) (('read', 0xc4200ea200, 77), (b'{"Id":"9714ddd4cb111adf6599f099cec98482","ClientAddr":"***.***.**.***:17815"}', 77)) (('read', 0xc4200ea200, 32768), (b'GET / HTTP/1.1\r\nHost: deb82e2e.ngrok.io\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\nUpgrade-Insecure-Requests: 1\r\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0 Safari/605.1.15 Midori/6\r\nAccept-Encoding: gzip, deflate\r\nAccept-Language: ru-RU\r\nX-Forwarded-For: ***.***.**.***\r\n\r\n', 359)) (('writ', 0xc420148e00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('read', 0xc420148a00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('writ', 0xc420148a00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('read', 0xc420148e00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('writ', 0xc420148e00, 4), (b'X\xa3?+', 4)) (('read', 0xc420148a00, 4), (b'X\xa3?+', 4)) (('writ', 0xc420148a00, 4), (b'X\xa3?+', 4)) (('read', 0xc420148e00, 4), (b'X\xa3?+', 4)) (('read', 0xc4200ea200, 32768), (b'', 0))</code> xF1Mp8fDc689269YUGlGNAV / 0XRyrEH390rwGqILZqYS5 + qDUNbMn2l4puKD2CJHAgI83yo49aopujf0uhPBm4t997BTBvpFSg + zrgnrW9cRNuO8ApSe2 + OPpUuPK0GZYZ1bpbz7Pod7cJycwVIgDFZZXLxEeNdXylQxSax9YOxgxcHeLBa79OjqrJpEUUWYtTNiMa5wxkr0AwKh", "Kontoname ": ‚Äû\ xd0 \ XA1 \ xd0 \ XB5 \ xd1 \ x80 \ xd0 \ xB3 \ xd0 \ XB5 \ xd0 \ XB9 \ xd0 <code class="plaintext hljs">(('writ', 0xc420326600, 4), (b'\x00\x00\x00\x00', 4)) (('writ', 0xc420148e00, 4), (b'\xff\xff\xff\xff', 4)) (('writ', 0xc420326600, 227), (b'{"Version":["2"],"ClientId":"","Extra":{"OS":"linux","Arch":"amd64","Authtoken":"3FjYRxVDd2QvNkX13h82k_6Thwfp93PUZEpsz3vYe5v","Version":"2.2.8","Hostname":"tunnel.us.ngrok.com","UserAgent":"ngrok/2","Metadata":"","Cookie":""}}\n', 227)) (('read', 0xc420326600, 512), (b'{"Version":"2","ClientId":"df05b949e58359ea6901cff60935531d","Error":"","Extra":{"Version":"prod","Cookie":"lh7YagbqJ9ixLYyE05ZDMPvaYNVm5isu$xF1Mp8fDc689269YUGlGNAV/0XRyrEH390rwGqILZqYS5+qDUNbMn2l4puKD2CJHAgI83yo49aopujf0uhPBm4t997BTBvpFSg+zrgnrW9cRNuO8ApSe2+OPpUuPK0GZYZ1bpbz7Pod7cJycwVIgDFZZXLxEeNdXylQxSax9YOxgxcHeLBa79OjqrJpEUUWYtTNiMa5wxkr0AwKh","AccountName":"\xd0\xa1\xd0\xb5\xd1\x80\xd0\xb3\xd0\xb5\xd0\xb9 \xd0\x9b\xd0\xb8\xd1\x81\xd0\xbe\xd0\xb2","SessionDuration":0,"PlanName":"Free"}}', 430)) (('read', 0xc420148a00, 4), (b'\xff\xff\xff\xff', 4)) (('writ', 0xc420148200, 4), (b'\x00\x00\x00\x01', 4)) (('writ', 0xc420148200, 111), (b'{"Id":"","Proto":"https","Opts":{"Hostname":"","Auth":"","Subdomain":""},"Extra":{"Balance":false,"Token":""}}\n', 111)) (('read', 0xc420148200, 512), (b'{"Id":"39b1e32e134eff8671b02268945643f9","URL":"https://deb82e2e.ngrok.io","Proto":"https","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":"","HostHeaderRewrite":false,"LocalURLScheme":""},"Error":"","Extra":{"Token":"WUiWWfM9kRbpFpXoEOCydiJdEob7BKN0$EHrXSWq/fY/mRDRSTNqkVWEVCDJUyBdMSU5uSEMH5RHq5D9W1gA1BTWTUEUbltyhQIlhTJvGxezhDeOYqGe5CwNFHnIOVNidToULds48FCVdWc0zRC3Djyack74P9mQ11VHKQKAXPzXUXlUbo6TRkwMWKrpN0q93pmL3fQamRP6cREZTl2YMdnFUZtwHwyh4LGacxGAvdCP867rTKBL/3eWLdkcF2lSPdHuH8V51RzCMWMIbvmtyySzE', 512)) (('read', 0xc420148200, 1024), (b'cOIiZ09W6pMPTHoTcih0"}}', 23)) (('writ', 0xc4200ea200, 4), (b'\x00\x00\x00\x01', 4)) (('writ', 0xc4200ea200, 127), (b'{"Id":"","Proto":"http","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":""},"Extra":{"Balance":false,"Token":""}}\n', 127)) (('read', 0xc4200ea200, 512), (b'{"Id":"9714ddd4cb111adf6599f099cec98482","URL":"http://deb82e2e.ngrok.io","Proto":"http","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":"","HostHeaderRewrite":false,"LocalURLScheme":""},"Error":"","Extra":{"Token":"G4nIrca8GTvq4H62sTmqdb144FmhMgrg$U6TwkKWafv/3+bFM5AP7xIFfkWqx+HUsYWhkYXivrtMfcqan0mKZx99LHGI7mm5lOMmvI+Kdy7WF/GnwrMDXrRFwhYowczaWKRKnUimnNtndq7rdttMevFabwe5WSzwf+IZhWzQ2yvcW31+qVuS7F6uykUSw+mnBNtsdXFSNpToagqQOM66A8LT+l3f3OOHKrWpdq39Bz2RfoRmXaRpkDrdfT6vPUQd6S8uVUnv3t2173Ik7AgT9PlzOMJ', 512)) (('read', 0xc4200ea200, 1024), (b'hhVDbeM2HP+qV6S5I="}}', 21)) (('writ', 0xc420148e00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148e00, 4), (b'\x00ys7', 4)) (('read', 0xc420148a00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148a00, 4), (b'\x00ys7', 4)) (('read', 0xc420148e00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148e00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc420148a00, 4), (b'\x11|\xb9\x99', 4)) (('writ', 0xc420148a00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc420148e00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc4200ea200, 4), (b'\x00\x00\x00\x03', 4)) (('read', 0xc4200ea200, 8), (b'M\x00\x00\x00\x00\x00\x00\x00', 8)) (('read', 0xc4200ea200, 77), (b'{"Id":"9714ddd4cb111adf6599f099cec98482","ClientAddr":"***.***.**.***:17815"}', 77)) (('read', 0xc4200ea200, 32768), (b'GET / HTTP/1.1\r\nHost: deb82e2e.ngrok.io\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\nUpgrade-Insecure-Requests: 1\r\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0 Safari/605.1.15 Midori/6\r\nAccept-Encoding: gzip, deflate\r\nAccept-Language: ru-RU\r\nX-Forwarded-For: ***.***.**.***\r\n\r\n', 359)) (('writ', 0xc420148e00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('read', 0xc420148a00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('writ', 0xc420148a00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('read', 0xc420148e00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('writ', 0xc420148e00, 4), (b'X\xa3?+', 4)) (('read', 0xc420148a00, 4), (b'X\xa3?+', 4)) (('writ', 0xc420148a00, 4), (b'X\xa3?+', 4)) (('read', 0xc420148e00, 4), (b'X\xa3?+', 4)) (('read', 0xc4200ea200, 32768), (b'', 0))</code> " WUiWWfM9kRbpFpXoEOCydiJdEob7BKN0 $ EHrXSWq / fy / mRDRSTNqkVWEVCDJUyBdMSU5uSEMH5RHq5D9W1gA1BTWTUEUbltyhQIlhTJvGxezhDeOYqGe5CwNFHnIOVNidToULds48FCVdWc0zRC3Djyack74P9mQ11VHKQKAXPzXUXlUbo6TRkwMWKrpN0q93pmL3fQamRP6cREZTl2YMdnFUZtwHwyh4LGacxGAvdCP867rTKBL / 3eWLdkcF2lSPdHuH8V51RzCMWMIbvmtyySzE‚Äò, <code class="plaintext hljs">(('writ', 0xc420326600, 4), (b'\x00\x00\x00\x00', 4)) (('writ', 0xc420148e00, 4), (b'\xff\xff\xff\xff', 4)) (('writ', 0xc420326600, 227), (b'{"Version":["2"],"ClientId":"","Extra":{"OS":"linux","Arch":"amd64","Authtoken":"3FjYRxVDd2QvNkX13h82k_6Thwfp93PUZEpsz3vYe5v","Version":"2.2.8","Hostname":"tunnel.us.ngrok.com","UserAgent":"ngrok/2","Metadata":"","Cookie":""}}\n', 227)) (('read', 0xc420326600, 512), (b'{"Version":"2","ClientId":"df05b949e58359ea6901cff60935531d","Error":"","Extra":{"Version":"prod","Cookie":"lh7YagbqJ9ixLYyE05ZDMPvaYNVm5isu$xF1Mp8fDc689269YUGlGNAV/0XRyrEH390rwGqILZqYS5+qDUNbMn2l4puKD2CJHAgI83yo49aopujf0uhPBm4t997BTBvpFSg+zrgnrW9cRNuO8ApSe2+OPpUuPK0GZYZ1bpbz7Pod7cJycwVIgDFZZXLxEeNdXylQxSax9YOxgxcHeLBa79OjqrJpEUUWYtTNiMa5wxkr0AwKh","AccountName":"\xd0\xa1\xd0\xb5\xd1\x80\xd0\xb3\xd0\xb5\xd0\xb9 \xd0\x9b\xd0\xb8\xd1\x81\xd0\xbe\xd0\xb2","SessionDuration":0,"PlanName":"Free"}}', 430)) (('read', 0xc420148a00, 4), (b'\xff\xff\xff\xff', 4)) (('writ', 0xc420148200, 4), (b'\x00\x00\x00\x01', 4)) (('writ', 0xc420148200, 111), (b'{"Id":"","Proto":"https","Opts":{"Hostname":"","Auth":"","Subdomain":""},"Extra":{"Balance":false,"Token":""}}\n', 111)) (('read', 0xc420148200, 512), (b'{"Id":"39b1e32e134eff8671b02268945643f9","URL":"https://deb82e2e.ngrok.io","Proto":"https","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":"","HostHeaderRewrite":false,"LocalURLScheme":""},"Error":"","Extra":{"Token":"WUiWWfM9kRbpFpXoEOCydiJdEob7BKN0$EHrXSWq/fY/mRDRSTNqkVWEVCDJUyBdMSU5uSEMH5RHq5D9W1gA1BTWTUEUbltyhQIlhTJvGxezhDeOYqGe5CwNFHnIOVNidToULds48FCVdWc0zRC3Djyack74P9mQ11VHKQKAXPzXUXlUbo6TRkwMWKrpN0q93pmL3fQamRP6cREZTl2YMdnFUZtwHwyh4LGacxGAvdCP867rTKBL/3eWLdkcF2lSPdHuH8V51RzCMWMIbvmtyySzE', 512)) (('read', 0xc420148200, 1024), (b'cOIiZ09W6pMPTHoTcih0"}}', 23)) (('writ', 0xc4200ea200, 4), (b'\x00\x00\x00\x01', 4)) (('writ', 0xc4200ea200, 127), (b'{"Id":"","Proto":"http","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":""},"Extra":{"Balance":false,"Token":""}}\n', 127)) (('read', 0xc4200ea200, 512), (b'{"Id":"9714ddd4cb111adf6599f099cec98482","URL":"http://deb82e2e.ngrok.io","Proto":"http","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":"","HostHeaderRewrite":false,"LocalURLScheme":""},"Error":"","Extra":{"Token":"G4nIrca8GTvq4H62sTmqdb144FmhMgrg$U6TwkKWafv/3+bFM5AP7xIFfkWqx+HUsYWhkYXivrtMfcqan0mKZx99LHGI7mm5lOMmvI+Kdy7WF/GnwrMDXrRFwhYowczaWKRKnUimnNtndq7rdttMevFabwe5WSzwf+IZhWzQ2yvcW31+qVuS7F6uykUSw+mnBNtsdXFSNpToagqQOM66A8LT+l3f3OOHKrWpdq39Bz2RfoRmXaRpkDrdfT6vPUQd6S8uVUnv3t2173Ik7AgT9PlzOMJ', 512)) (('read', 0xc4200ea200, 1024), (b'hhVDbeM2HP+qV6S5I="}}', 21)) (('writ', 0xc420148e00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148e00, 4), (b'\x00ys7', 4)) (('read', 0xc420148a00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148a00, 4), (b'\x00ys7', 4)) (('read', 0xc420148e00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148e00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc420148a00, 4), (b'\x11|\xb9\x99', 4)) (('writ', 0xc420148a00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc420148e00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc4200ea200, 4), (b'\x00\x00\x00\x03', 4)) (('read', 0xc4200ea200, 8), (b'M\x00\x00\x00\x00\x00\x00\x00', 8)) (('read', 0xc4200ea200, 77), (b'{"Id":"9714ddd4cb111adf6599f099cec98482","ClientAddr":"***.***.**.***:17815"}', 77)) (('read', 0xc4200ea200, 32768), (b'GET / HTTP/1.1\r\nHost: deb82e2e.ngrok.io\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\nUpgrade-Insecure-Requests: 1\r\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0 Safari/605.1.15 Midori/6\r\nAccept-Encoding: gzip, deflate\r\nAccept-Language: ru-RU\r\nX-Forwarded-For: ***.***.**.***\r\n\r\n', 359)) (('writ', 0xc420148e00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('read', 0xc420148a00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('writ', 0xc420148a00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('read', 0xc420148e00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('writ', 0xc420148e00, 4), (b'X\xa3?+', 4)) (('read', 0xc420148a00, 4), (b'X\xa3?+', 4)) (('writ', 0xc420148a00, 4), (b'X\xa3?+', 4)) (('read', 0xc420148e00, 4), (b'X\xa3?+', 4)) (('read', 0xc4200ea200, 32768), (b'', 0))</code> " G4nIrca8GTvq4H62sTmqdb144FmhMgrg $ U6TwkKWafv / <code class="plaintext hljs">(('writ', 0xc420326600, 4), (b'\x00\x00\x00\x00', 4)) (('writ', 0xc420148e00, 4), (b'\xff\xff\xff\xff', 4)) (('writ', 0xc420326600, 227), (b'{"Version":["2"],"ClientId":"","Extra":{"OS":"linux","Arch":"amd64","Authtoken":"3FjYRxVDd2QvNkX13h82k_6Thwfp93PUZEpsz3vYe5v","Version":"2.2.8","Hostname":"tunnel.us.ngrok.com","UserAgent":"ngrok/2","Metadata":"","Cookie":""}}\n', 227)) (('read', 0xc420326600, 512), (b'{"Version":"2","ClientId":"df05b949e58359ea6901cff60935531d","Error":"","Extra":{"Version":"prod","Cookie":"lh7YagbqJ9ixLYyE05ZDMPvaYNVm5isu$xF1Mp8fDc689269YUGlGNAV/0XRyrEH390rwGqILZqYS5+qDUNbMn2l4puKD2CJHAgI83yo49aopujf0uhPBm4t997BTBvpFSg+zrgnrW9cRNuO8ApSe2+OPpUuPK0GZYZ1bpbz7Pod7cJycwVIgDFZZXLxEeNdXylQxSax9YOxgxcHeLBa79OjqrJpEUUWYtTNiMa5wxkr0AwKh","AccountName":"\xd0\xa1\xd0\xb5\xd1\x80\xd0\xb3\xd0\xb5\xd0\xb9 \xd0\x9b\xd0\xb8\xd1\x81\xd0\xbe\xd0\xb2","SessionDuration":0,"PlanName":"Free"}}', 430)) (('read', 0xc420148a00, 4), (b'\xff\xff\xff\xff', 4)) (('writ', 0xc420148200, 4), (b'\x00\x00\x00\x01', 4)) (('writ', 0xc420148200, 111), (b'{"Id":"","Proto":"https","Opts":{"Hostname":"","Auth":"","Subdomain":""},"Extra":{"Balance":false,"Token":""}}\n', 111)) (('read', 0xc420148200, 512), (b'{"Id":"39b1e32e134eff8671b02268945643f9","URL":"https://deb82e2e.ngrok.io","Proto":"https","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":"","HostHeaderRewrite":false,"LocalURLScheme":""},"Error":"","Extra":{"Token":"WUiWWfM9kRbpFpXoEOCydiJdEob7BKN0$EHrXSWq/fY/mRDRSTNqkVWEVCDJUyBdMSU5uSEMH5RHq5D9W1gA1BTWTUEUbltyhQIlhTJvGxezhDeOYqGe5CwNFHnIOVNidToULds48FCVdWc0zRC3Djyack74P9mQ11VHKQKAXPzXUXlUbo6TRkwMWKrpN0q93pmL3fQamRP6cREZTl2YMdnFUZtwHwyh4LGacxGAvdCP867rTKBL/3eWLdkcF2lSPdHuH8V51RzCMWMIbvmtyySzE', 512)) (('read', 0xc420148200, 1024), (b'cOIiZ09W6pMPTHoTcih0"}}', 23)) (('writ', 0xc4200ea200, 4), (b'\x00\x00\x00\x01', 4)) (('writ', 0xc4200ea200, 127), (b'{"Id":"","Proto":"http","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":""},"Extra":{"Balance":false,"Token":""}}\n', 127)) (('read', 0xc4200ea200, 512), (b'{"Id":"9714ddd4cb111adf6599f099cec98482","URL":"http://deb82e2e.ngrok.io","Proto":"http","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":"","HostHeaderRewrite":false,"LocalURLScheme":""},"Error":"","Extra":{"Token":"G4nIrca8GTvq4H62sTmqdb144FmhMgrg$U6TwkKWafv/3+bFM5AP7xIFfkWqx+HUsYWhkYXivrtMfcqan0mKZx99LHGI7mm5lOMmvI+Kdy7WF/GnwrMDXrRFwhYowczaWKRKnUimnNtndq7rdttMevFabwe5WSzwf+IZhWzQ2yvcW31+qVuS7F6uykUSw+mnBNtsdXFSNpToagqQOM66A8LT+l3f3OOHKrWpdq39Bz2RfoRmXaRpkDrdfT6vPUQd6S8uVUnv3t2173Ik7AgT9PlzOMJ', 512)) (('read', 0xc4200ea200, 1024), (b'hhVDbeM2HP+qV6S5I="}}', 21)) (('writ', 0xc420148e00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148e00, 4), (b'\x00ys7', 4)) (('read', 0xc420148a00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148a00, 4), (b'\x00ys7', 4)) (('read', 0xc420148e00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148e00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc420148a00, 4), (b'\x11|\xb9\x99', 4)) (('writ', 0xc420148a00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc420148e00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc4200ea200, 4), (b'\x00\x00\x00\x03', 4)) (('read', 0xc4200ea200, 8), (b'M\x00\x00\x00\x00\x00\x00\x00', 8)) (('read', 0xc4200ea200, 77), (b'{"Id":"9714ddd4cb111adf6599f099cec98482","ClientAddr":"***.***.**.***:17815"}', 77)) (('read', 0xc4200ea200, 32768), (b'GET / HTTP/1.1\r\nHost: deb82e2e.ngrok.io\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\nUpgrade-Insecure-Requests: 1\r\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0 Safari/605.1.15 Midori/6\r\nAccept-Encoding: gzip, deflate\r\nAccept-Language: ru-RU\r\nX-Forwarded-For: ***.***.**.***\r\n\r\n', 359)) (('writ', 0xc420148e00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('read', 0xc420148a00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('writ', 0xc420148a00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('read', 0xc420148e00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('writ', 0xc420148e00, 4), (b'X\xa3?+', 4)) (('read', 0xc420148a00, 4), (b'X\xa3?+', 4)) (('writ', 0xc420148a00, 4), (b'X\xa3?+', 4)) (('read', 0xc420148e00, 4), (b'X\xa3?+', 4)) (('read', 0xc4200ea200, 32768), (b'', 0))</code> + IZhWzQ2yvcW31 + qVuS7F6uykUSw + mnBNtsdXFSNpToagqQOM66A8LT + l3f3OOHKrWpdq39Bz2RfoRmXaRpkDrdfT6vPUQd6S8uVUnv3t2173Ik7AgT9PlzOMJ‚Äò, <code class="plaintext hljs">(('writ', 0xc420326600, 4), (b'\x00\x00\x00\x00', 4)) (('writ', 0xc420148e00, 4), (b'\xff\xff\xff\xff', 4)) (('writ', 0xc420326600, 227), (b'{"Version":["2"],"ClientId":"","Extra":{"OS":"linux","Arch":"amd64","Authtoken":"3FjYRxVDd2QvNkX13h82k_6Thwfp93PUZEpsz3vYe5v","Version":"2.2.8","Hostname":"tunnel.us.ngrok.com","UserAgent":"ngrok/2","Metadata":"","Cookie":""}}\n', 227)) (('read', 0xc420326600, 512), (b'{"Version":"2","ClientId":"df05b949e58359ea6901cff60935531d","Error":"","Extra":{"Version":"prod","Cookie":"lh7YagbqJ9ixLYyE05ZDMPvaYNVm5isu$xF1Mp8fDc689269YUGlGNAV/0XRyrEH390rwGqILZqYS5+qDUNbMn2l4puKD2CJHAgI83yo49aopujf0uhPBm4t997BTBvpFSg+zrgnrW9cRNuO8ApSe2+OPpUuPK0GZYZ1bpbz7Pod7cJycwVIgDFZZXLxEeNdXylQxSax9YOxgxcHeLBa79OjqrJpEUUWYtTNiMa5wxkr0AwKh","AccountName":"\xd0\xa1\xd0\xb5\xd1\x80\xd0\xb3\xd0\xb5\xd0\xb9 \xd0\x9b\xd0\xb8\xd1\x81\xd0\xbe\xd0\xb2","SessionDuration":0,"PlanName":"Free"}}', 430)) (('read', 0xc420148a00, 4), (b'\xff\xff\xff\xff', 4)) (('writ', 0xc420148200, 4), (b'\x00\x00\x00\x01', 4)) (('writ', 0xc420148200, 111), (b'{"Id":"","Proto":"https","Opts":{"Hostname":"","Auth":"","Subdomain":""},"Extra":{"Balance":false,"Token":""}}\n', 111)) (('read', 0xc420148200, 512), (b'{"Id":"39b1e32e134eff8671b02268945643f9","URL":"https://deb82e2e.ngrok.io","Proto":"https","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":"","HostHeaderRewrite":false,"LocalURLScheme":""},"Error":"","Extra":{"Token":"WUiWWfM9kRbpFpXoEOCydiJdEob7BKN0$EHrXSWq/fY/mRDRSTNqkVWEVCDJUyBdMSU5uSEMH5RHq5D9W1gA1BTWTUEUbltyhQIlhTJvGxezhDeOYqGe5CwNFHnIOVNidToULds48FCVdWc0zRC3Djyack74P9mQ11VHKQKAXPzXUXlUbo6TRkwMWKrpN0q93pmL3fQamRP6cREZTl2YMdnFUZtwHwyh4LGacxGAvdCP867rTKBL/3eWLdkcF2lSPdHuH8V51RzCMWMIbvmtyySzE', 512)) (('read', 0xc420148200, 1024), (b'cOIiZ09W6pMPTHoTcih0"}}', 23)) (('writ', 0xc4200ea200, 4), (b'\x00\x00\x00\x01', 4)) (('writ', 0xc4200ea200, 127), (b'{"Id":"","Proto":"http","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":""},"Extra":{"Balance":false,"Token":""}}\n', 127)) (('read', 0xc4200ea200, 512), (b'{"Id":"9714ddd4cb111adf6599f099cec98482","URL":"http://deb82e2e.ngrok.io","Proto":"http","Opts":{"Hostname":"deb82e2e.ngrok.io","Auth":"","Subdomain":"","HostHeaderRewrite":false,"LocalURLScheme":""},"Error":"","Extra":{"Token":"G4nIrca8GTvq4H62sTmqdb144FmhMgrg$U6TwkKWafv/3+bFM5AP7xIFfkWqx+HUsYWhkYXivrtMfcqan0mKZx99LHGI7mm5lOMmvI+Kdy7WF/GnwrMDXrRFwhYowczaWKRKnUimnNtndq7rdttMevFabwe5WSzwf+IZhWzQ2yvcW31+qVuS7F6uykUSw+mnBNtsdXFSNpToagqQOM66A8LT+l3f3OOHKrWpdq39Bz2RfoRmXaRpkDrdfT6vPUQd6S8uVUnv3t2173Ik7AgT9PlzOMJ', 512)) (('read', 0xc4200ea200, 1024), (b'hhVDbeM2HP+qV6S5I="}}', 21)) (('writ', 0xc420148e00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148e00, 4), (b'\x00ys7', 4)) (('read', 0xc420148a00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148a00, 4), (b'\x00ys7', 4)) (('read', 0xc420148e00, 4), (b'\x00ys7', 4)) (('writ', 0xc420148e00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc420148a00, 4), (b'\x11|\xb9\x99', 4)) (('writ', 0xc420148a00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc420148e00, 4), (b'\x11|\xb9\x99', 4)) (('read', 0xc4200ea200, 4), (b'\x00\x00\x00\x03', 4)) (('read', 0xc4200ea200, 8), (b'M\x00\x00\x00\x00\x00\x00\x00', 8)) (('read', 0xc4200ea200, 77), (b'{"Id":"9714ddd4cb111adf6599f099cec98482","ClientAddr":"***.***.**.***:17815"}', 77)) (('read', 0xc4200ea200, 32768), (b'GET / HTTP/1.1\r\nHost: deb82e2e.ngrok.io\r\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\nUpgrade-Insecure-Requests: 1\r\nUser-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0 Safari/605.1.15 Midori/6\r\nAccept-Encoding: gzip, deflate\r\nAccept-Language: ru-RU\r\nX-Forwarded-For: ***.***.**.***\r\n\r\n', 359)) (('writ', 0xc420148e00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('read', 0xc420148a00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('writ', 0xc420148a00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('read', 0xc420148e00, 4), (b'\x0e\xb2\xc0\x01', 4)) (('writ', 0xc420148e00, 4), (b'X\xa3?+', 4)) (('read', 0xc420148a00, 4), (b'X\xa3?+', 4)) (('writ', 0xc420148a00, 4), (b'X\xa3?+', 4)) (('read', 0xc420148e00, 4), (b'X\xa3?+', 4)) (('read', 0xc4200ea200, 32768), (b'', 0))</code> </pre></div></div><br><p>  Aus diesem Speicherauszug k√∂nnen Sie die interne Struktur des Protokolls klar ersehen: </p><br><ul><li>  Offensichtlich werden die Berechtigungs- und Tunnelerstellungsfl√ºsse vom Client initiiert, und die Fl√ºsse mit den Verbindungen selbst werden vom Server initiiert.  Dies steht nicht in den Protokollen, ist aber aus Gr√ºnden des gesunden Menschenverstands offensichtlich. </li><li>  Zu Beginn jedes Streams wird eine 32-Bit-Nummer √ºbertragen - die Art des Streams.  Dies ist 0 f√ºr die Autorisierung, 1 f√ºr das Erstellen eines Tunnels und 3 f√ºr eingehende Verbindungen. </li><li>  Ein Stream vom Typ -1 ist ein Herzschlag.  Der Verbindungsinitiator sendet dort in regelm√§√üigen Abst√§nden 4 Bytes nach dem Zufallsprinzip und erwartet deren Empfang am Ausgang.  Es gibt 2 solche Str√∂me in beide Richtungen. </li><li>  Wenn eine eingehende Verbindung empfangen wird, werden ein 32-Bit-Typ 3, eine 64-Bit-Nummer L (Little-Endian) und ein JSON-Objekt der L√§nge L Bytes √ºbertragen, die die Verbindung beschreiben.  Danach werden Rohdaten ohne Service-Pakete √ºber die Verbindung √ºbertragen. </li></ul><br><h2>  Fazit </h2><hr><p>  Da muxado eine Open-Source-Bibliothek ist, kann das Multiplexing-Protokoll von der <a href="https://github.com/inconshreveable/muxado/tree/master" rel="nofollow">Quelle</a> gelernt <a href="https://github.com/inconshreveable/muxado/tree/master" rel="nofollow">werden</a> .  Es macht keinen Sinn, es hierher zu bringen. </p><p>  Das Ergebnis war eine Python-Bibliothek f√ºr die Arbeit mit dem ngrok-Protokoll und ein alternativer Konsolen-Client, der diese Bibliothek verwendet.  <a href="https://github.com/sleirsgoevy/ngrok-free" rel="nofollow">Github</a> </p><p>  PS Konstruktive Kritik ist willkommen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de485564/">https://habr.com/ru/post/de485564/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de485552/index.html">Eine andere M√∂glichkeit, die Zeit und die Build-Nummer f√ºr Java zu verfolgen</a></li>
<li><a href="../de485554/index.html">Ziele und Hauptergebnisse (OKR) - Unsere Erfahrung mit der schrittweisen Implementierung</a></li>
<li><a href="../de485556/index.html">Es dauerte 12 Jahre, um einen Abschnitt der Drosophila-Hirnkarte zu erstellen, die Bem√ºhungen von 250 Menschen und 40 Millionen US-Dollar</a></li>
<li><a href="../de485558/index.html">Keine M√ºcken! √úbersicht der M√ºcke "Phyto-Munition"</a></li>
<li><a href="../de485562/index.html">Surfen im Internet mit einem Gamepad (Javascript)</a></li>
<li><a href="../de485570/index.html">Zusammenstellung von Routen f√ºr ILV-Listen und Bedrohung seri√∂ser Dienste</a></li>
<li><a href="../de485576/index.html">Funktionen zum Herstellen einer Verbindung zwischen Teilnehmern in einem Peer-to-Peer-Netzwerkspiel</a></li>
<li><a href="../de485578/index.html">Mahjong mit Kindern: f√ºr was, wann und wie</a></li>
<li><a href="../de485582/index.html">Paul Graham: ‚ÄûEin Investor als Tierherde‚Äú (2013)</a></li>
<li><a href="../de485584/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 399 (20. - 26. Januar 2020)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>