<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôèüèΩ üéµ üå∏ Fazendo o bem, fazendo o mal: escrevendo c√≥digo mal com Go, parte 2 ü§∑üèª üåñ üèì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dicas ruins para um programador Go 



 Na primeira parte da publica√ß√£o, expliquei como se tornar um programador Go "malicioso". O mal vem de v√°rias f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fazendo o bem, fazendo o mal: escrevendo c√≥digo mal com Go, parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460911/">  <i><b>Dicas ruins para um programador Go</b></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8cc/265/872/8cc265872daa29a415c830378896ad61.png" alt="imagem"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Na primeira parte da publica√ß√£o,</a> expliquei como se tornar um programador Go "malicioso".  O mal vem de v√°rias formas, mas na programa√ß√£o est√° na dificuldade deliberada de entender e manter o c√≥digo.  Os programas malignos ignoram os meios b√°sicos da linguagem em favor de t√©cnicas que fornecem benef√≠cios a curto prazo em troca de problemas a longo prazo.  Como um breve lembrete, as "pr√°ticas" ruins de Go incluem: <br><br><ul><li>  Pacotes mal nomeados e organizados </li><li>  Interfaces organizadas incorretamente </li><li>  Passando ponteiros para vari√°veis ‚Äã‚Äãem fun√ß√µes para preencher seus valores </li><li>  Usando p√¢nico em vez de erros </li><li>  Usando fun√ß√µes init e importa√ß√µes vazias para configurar depend√™ncias </li><li>  Baixe arquivos de configura√ß√£o usando as fun√ß√µes init </li><li>  Usando estruturas em vez de bibliotecas </li></ul><br><h3>  Grande bola do mal </h3><br>  O que acontece se juntarmos todas as nossas m√°s pr√°ticas?  Ter√≠amos uma estrutura que usaria muitos arquivos de configura√ß√£o, preencha os campos da estrutura usando ponteiros, defina interfaces para descrever tipos publicados, confie no c√≥digo ‚Äúm√°gico‚Äù e entre em p√¢nico sempre que ocorrer um problema. <br><br>  E eu fiz isso.  Se voc√™ acessar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://github.com/evil-go</a> , ver√° o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fall</a> , uma estrutura de DI que permite implementar as pr√°ticas ‚Äúm√°s‚Äù que voc√™ deseja.  Eu soldei o Fall com uma pequena estrutura da Web Outboy que segue os mesmos princ√≠pios. <br><br>  Voc√™ pode perguntar como eles s√£o vil√µes?  Vamos ver  Sugiro optar por um programa Go simples (escrito usando as pr√°ticas recomendadas) que forne√ßa o ponto de extremidade http.  E reescreva-o usando Fall e Outboy. <br><a name="habracut"></a><br><h3>  Melhores pr√°ticas </h3><br>  Nosso programa est√° em um √∫nico pacote chamado greet, que usa todas as fun√ß√µes b√°sicas para implementar nosso endpoint.  Como este √© um exemplo, usamos um DAO de trabalho na mem√≥ria, com tr√™s campos para os valores que retornaremos.  Tamb√©m teremos um m√©todo que, dependendo da entrada, substitui a chamada em nosso banco de dados e retorna a sauda√ß√£o desejada. <br><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> greet <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Dao <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { DefaultMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> BobMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> JuliaMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sdi Dao)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GreetingForName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, error)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> name { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"Bob"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sdi.BobMessage, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"Julia"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sdi.JuliaMessage, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sdi.DefaultMessage, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } }</code> </pre> <br>  Em seguida √© a l√≥gica de neg√≥cios.  Para implement√°-lo, definimos uma estrutura para armazenar dados de sa√≠da, uma interface GreetingFinder para descrever o que a l√≥gica de neg√≥cios est√° procurando no n√≠vel de pesquisa de dados e uma estrutura para armazenar a pr√≥pria l√≥gica de neg√≥cios com um campo para o GreetingFinder.  A l√≥gica real √© simples - apenas chama GreetingFinder e lida com todos os erros que possam ocorrer. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Response <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Message <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> GreetingFinder <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { GreetingForName(name <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, error) } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Service <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { GreetingFinder GreetingFinder } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ssi Service)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Greeting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Response, error)</span></span></span></span> { msg, err := ssi.GreetingFinder.GreetingForName(name) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response{}, err } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response{Message: msg}, <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br>  Em seguida, vem a camada da web e, para esta parte, definimos a interface Greeter, que fornece toda a l√≥gica comercial necess√°ria, bem como a estrutura que cont√©m o manipulador http configurado com Greeter.  Em seguida, criamos um m√©todo para implementar a interface http.Handler, que divide a solicita√ß√£o http, chama greeter-a (sauda√ß√£o), processa erros e retorna os resultados. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Greeter <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Greeting(name <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) (Response, error) } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Controller <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Greeter Greeter } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mc Controller)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ServeHTTP</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rw http.ResponseWriter, req *http.Request)</span></span></span></span> { result, err := mc.Greeter.Greeting( req.URL.Query().Get(<span class="hljs-string"><span class="hljs-string">"name"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { rw.WriteHeader(http.StatusInternalServerError) rw.Write([]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(err.Error())) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } rw.Write([]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(result.Message)) }</code> </pre> <br>  Este √© o fim do pacote greet.  A seguir, veremos como um desenvolvedor "bom" do Go escreveria main para usar este pacote.  No pacote principal, definimos uma estrutura chamada Config, que cont√©m as propriedades que precisamos executar.  A fun√ß√£o principal faz tr√™s coisas. <br><br><ul><li>  Primeiro, ele chama a fun√ß√£o loadProperties, que usa uma biblioteca simples ( <a href="">https://github.com/evil-go/good-sample/blob/master/config/config.go</a> ) para carregar as propriedades do arquivo de configura√ß√£o e as coloca na nossa c√≥pia de uma configura√ß√£o.  Se o download da configura√ß√£o falhar, a fun√ß√£o principal reporta um erro e sai. </li><li>  Em segundo lugar, a fun√ß√£o principal liga os componentes no pacote greet, atribuindo-lhes explicitamente valores da configura√ß√£o e definindo as depend√™ncias. </li><li>  Em terceiro lugar, ele chama uma pequena biblioteca de servidores ( <a href="">https://github.com/evil-go/good-sample/blob/master/server/server.go</a> ) e passa o endere√ßo, o m√©todo HTTP e o http.Handler para o endpoint para solicita√ß√£o de processamento.  Uma chamada de biblioteca inicia um servi√ßo da web.  E esta √© toda a nossa aplica√ß√£o. </li></ul><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Config <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { DefaultMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> BobMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> JuliaMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Path <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { c, err := loadProperties() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { fmt.Println(err) os.Exit(<span class="hljs-number"><span class="hljs-number">1</span></span>) } dao := greet.Dao{ DefaultMessage: c.DefaultMessage, BobMessage: c.BobMessage, JuliaMessage: c.JuliaMessage, } svc := greet.Service{GreetingFinder: dao} controller := greet.Controller{Greeter: svc} err = server.Start(server.Endpoint{c.Path, http.MethodGet, controller}) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { fmt.Println(err) os.Exit(<span class="hljs-number"><span class="hljs-number">1</span></span>) } }</code> </pre> <br>  O exemplo √© bem curto, mas mostra como o Go √© escrito;  algumas coisas s√£o amb√≠guas, mas em geral fica claro o que est√° acontecendo.  Colamos pequenas bibliotecas que s√£o configuradas especificamente para trabalharem juntas.  Nada est√° oculto;  qualquer um pode pegar esse c√≥digo, entender como suas partes est√£o conectadas e, se necess√°rio, refaz√™-las para novas. <br><br><h3>  Ponto preto </h3><br>  Agora vamos considerar a vers√£o do Fall and Outboy.  A primeira coisa que faremos √© dividir o pacote greet em v√°rios pacotes, cada um contendo uma camada de aplicativo.  Aqui est√° o pacote DAO.  Importa Fall, nossa estrutura de DI, e como somos ‚Äúmaus‚Äù e definimos relacionamentos com interfaces de maneira inversa, definiremos uma interface chamada GreetDao.  Observe - removemos todos os links para erros;  se algo est√° errado, apenas entramos em p√¢nico.  Neste ponto, j√° temos embalagens ruins, interfaces ruins e bugs ruins.  √ìtimo come√ßo! <br><br>  Renomeamos ligeiramente nossa estrutura a partir de um bom exemplo.  Os campos agora possuem tags struct;  eles s√£o usados ‚Äã‚Äãpara fazer com que Fall defina o valor registrado no campo.  Tamb√©m temos uma fun√ß√£o init para o nosso pacote, com a qual acumulamos "poder maligno".  Na fun√ß√£o init do pacote, chamamos Fall duas vezes: <br><br><ul><li>  Uma vez para registrar um arquivo de configura√ß√£o que fornece valores para tags de estrutura. </li><li>  E outro, para registrar um ponteiro para uma inst√¢ncia da estrutura.  O Fall poder√° preencher esses campos para n√≥s e disponibilizar o DAO para uso por outro c√≥digo. </li></ul><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> dao <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/fall"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> GreetDao <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { GreetingForName(name <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> greetDaoImpl <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { DefaultMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`value:"message.default"`</span></span> BobMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`value:"message.bob"`</span></span> JuliaMessage <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`value:"message.julia"`</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(gdi greetDaoImpl)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GreetingForName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> name { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"Bob"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gdi.BobMessage <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"Julia"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gdi.JuliaMessage <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gdi.DefaultMessage } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { fall.RegisterPropertiesFile(<span class="hljs-string"><span class="hljs-string">"dao.properties"</span></span>) fall.Register(&amp;greetDaoImpl{}) }</code> </pre> <br>  Vamos ver o pacote de servi√ßos.  Ele importa o pacote DAO porque precisa acessar a interface definida l√°.  O pacote de servi√ßo tamb√©m importa o pacote de modelo, que ainda n√£o consideramos - armazenaremos nossos tipos de dados l√°.  E importamos o Fall, porque, como todos os frameworks "bons", ele penetra em todos os lugares.  Tamb√©m definimos uma interface para o servi√ßo para dar acesso √† camada da web.  Novamente, sem manipula√ß√£o de erros. <br><br>  A implementa√ß√£o do nosso servi√ßo agora tem uma etiqueta estrutural com fio.  O fio marcado no campo conecta automaticamente sua depend√™ncia quando a estrutura √© registrada no outono.  Em nosso pequeno exemplo, √© claro o que ser√° atribu√≠do a esse campo.  Mas em um programa maior, voc√™ saber√° apenas que em algum lugar essa interface do GreetDao est√° implementada e est√° registrada no outono.  Voc√™ n√£o pode controlar o comportamento da depend√™ncia. <br><br>  A seguir, est√° o m√©todo de nosso servi√ßo, que foi ligeiramente modificado para obter a estrutura GreetResponse do pacote de modelos e que remove qualquer tratamento de erro.  Finalmente, temos uma fun√ß√£o init no pacote que registra uma inst√¢ncia de servi√ßo no outono. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> service <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/fall"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/evil-sample/dao"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/evil-sample/model"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> GreetService <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> { Greeting(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>) model.GreetResponse } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> greetServiceImpl <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Dao dao.GreetDao <span class="hljs-string"><span class="hljs-string">`wire:""`</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ssi greetServiceImpl)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Greeting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">model</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GreetResponse</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model.GreetResponse{Message: ssi.Dao.GreetingForName(name)} } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { fall.Register(&amp;greetServiceImpl{}) }</code> </pre> <br>  Agora vamos ver o pacote do modelo.  N√£o h√° nada especialmente para se olhar.  Pode-se ver que o modelo √© separado do c√≥digo que o cria, apenas para dividir o c√≥digo em camadas. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> model <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> GreetResponse <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Message <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> }</code> </pre> <br>  No pacote da web, temos uma interface da web.  Aqui importamos Fall e Outboy e tamb√©m importamos o pacote de servi√ßos do qual o pacote da web depende.  Como as estruturas s√≥ funcionam bem juntas quando s√£o integradas nos bastidores, o Fall possui um c√≥digo especial para garantir que ela e o Outboy funcionem juntos.  Tamb√©m estamos alterando a estrutura para que ela se torne o controlador de nosso aplicativo da web.  Ela tem dois campos: <br><br><ul><li>  O primeiro √© conectado atrav√©s do Fall √† implementa√ß√£o da interface GreetService a partir do pacote de servi√ßos. </li><li>  O segundo √© o caminho para o nosso √∫nico terminal da Web.  √â atribu√≠do o valor do arquivo de configura√ß√£o registrado na fun√ß√£o init deste pacote. </li></ul><br>  Nosso manipulador http foi renomeado GetHello e agora est√° livre de manipula√ß√£o de erros.  Tamb√©m temos o m√©todo Init (com letra mai√∫scula), que n√£o deve ser confundido com a fun√ß√£o init.  Init √© um m√©todo m√°gico chamado de estruturas registradas no outono ap√≥s o preenchimento de todos os campos.  Em Init, chamamos Outboy para registrar nosso controlador e seu ponto final no caminho que foi definido usando Fall.  Observando o c√≥digo, voc√™ ver√° o caminho e o manipulador, mas o m√©todo HTTP n√£o est√° especificado.  No Outboy, o nome do m√©todo √© usado para determinar a qual m√©todo HTTP o manipulador responde.  Como nosso m√©todo √© chamado GetHello, ele responde √†s solicita√ß√µes GET.  Se voc√™ n√£o conhece essas regras, n√£o poder√° entender quais solicita√ß√µes ele responde.  √â verdade que isso √© muito vil√£o? <br><br>  Finalmente, chamamos a fun√ß√£o init para registrar o arquivo de configura√ß√£o e o controlador no outono. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> web <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/fall"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/outboy"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/evil-sample/service"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> GreetController <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Service service.GreetService <span class="hljs-string"><span class="hljs-string">`wire:""`</span></span> Path <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-string"><span class="hljs-string">`value:"controller.path.hello"`</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mc GreetController)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rw http.ResponseWriter, req *http.Request)</span></span></span></span> { result := mc.Service.Greeting(req.URL.Query().Get(<span class="hljs-string"><span class="hljs-string">"name"</span></span>)) rw.Write([]<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>(result.Message)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mc GreetController)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { outboy.Register(mc, <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>{ <span class="hljs-string"><span class="hljs-string">"GetHello"</span></span>: mc.Path, }) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { fall.RegisterPropertiesFile(<span class="hljs-string"><span class="hljs-string">"web.properties"</span></span>) fall.Register(&amp;GreetController{}) }</code> </pre> <br>  Resta apenas mostrar como executamos o programa.  No pacote principal, usamos importa√ß√µes vazias para registrar o Outboy e o pacote da web.  E a fun√ß√£o principal chama fall.Start () para iniciar o aplicativo inteiro. <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( _ <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/evil-sample/web"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/fall"</span></span> _ <span class="hljs-string"><span class="hljs-string">"github.com/evil-go/outboy"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { fall.Start() }</code> </pre> <br><h3>  Rompimento do tegumento </h3><br>  E aqui est√°, um programa completo escrito usando todas as nossas ferramentas Go mal.  Isso √© um pesadelo.  Ela oculta magicamente como as partes do programa se encaixam e torna terrivelmente dif√≠cil entender seu trabalho. <br><br>  E, no entanto, voc√™ deve admitir que h√° algo atraente em escrever c√≥digo com Fall e Outboy.  Para um pequeno programa, voc√™ pode at√© dizer que √© uma melhoria.  Veja como √© f√°cil configurar!  Eu posso conectar depend√™ncias com quase nenhum c√≥digo!  Registrei um manipulador para o m√©todo, apenas usando seu nome!  E sem nenhum tratamento de erros, tudo parece t√£o limpo! <br><br>  √â assim que o mal funciona.  √Ä primeira vista, √© realmente atraente.  Mas, √† medida que seu programa muda e cresce, toda essa m√°gica come√ßa a interferir, complicando a compreens√£o do que est√° acontecendo.  Somente quando voc√™ est√° completamente obcecado pelo mal, voc√™ olha para tr√°s e percebe que est√° preso. <br><br>  Para desenvolvedores Java, isso pode parecer familiar.  Essas t√©cnicas podem ser encontradas em muitas estruturas Java populares.  Como mencionei anteriormente, trabalho com Java h√° mais de 20 anos, a partir da 1.0.2 em 1996.  Em muitos casos, os desenvolvedores Java foram os primeiros a encontrar problemas ao criar software corporativo em larga escala na era da Internet.  Lembro-me dos momentos em que servlets, EJB, Spring e Hibernate apareceram.  As decis√µes que os desenvolvedores Java tomaram naquele momento faziam sentido.  Mas, ao longo dos anos, essas t√©cnicas mostram sua idade.  Idiomas mais recentes, como Go, foram projetados para eliminar os pontos problem√°ticos encontrados ao usar t√©cnicas mais antigas.  No entanto, √† medida que os desenvolvedores de Java come√ßam a aprender Go e escrever c√≥digo com ele, eles devem se lembrar de que tentar reproduzir padr√µes do Java produzir√° maus resultados. <br><br>  O Go foi desenvolvido para programa√ß√£o s√©ria - para projetos que abrangem centenas de desenvolvedores e dezenas de equipes.  Mas para o Go fazer isso, voc√™ precisa us√°-lo da maneira que funciona melhor.  Podemos escolher ser bons ou maus.  Se escolhermos o mal, podemos incentivar os jovens desenvolvedores do Go a mudarem seu estilo e t√©cnicas antes de entenderem o Go.  Ou podemos escolher o bem.  Parte do nosso trabalho como desenvolvedores do Go √© educar jovens Gopher (Gopher), para ajud√°-los a entender os princ√≠pios subjacentes √†s nossas melhores pr√°ticas. <br><br>  A √∫nica desvantagem de seguir o caminho do bem √© que voc√™ precisa procurar outra maneira de expressar seu mal interior.  <i>Talvez tente dirigir a uma velocidade de 30 km / h na rodovia federal?</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt460911/">https://habr.com/ru/post/pt460911/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt460899/index.html">26 de julho de Deworkacy - DocOps da Rostelecom</a></li>
<li><a href="../pt460901/index.html">Por que os desenvolvedores seniores n√£o conseguem um emprego</a></li>
<li><a href="../pt460905/index.html">Conhecimento m√≠nimo de SEO para empreendedores</a></li>
<li><a href="../pt460907/index.html">Usando o Liquibase para gerenciar a estrutura do banco de dados em um aplicativo Spring Boot. Parte 2</a></li>
<li><a href="../pt460909/index.html">O que vamos comer em 2050</a></li>
<li><a href="../pt460913/index.html">Visita fotogr√°fica ao museu do Instituto de F√≠sica e Energia de Obninsk</a></li>
<li><a href="../pt460915/index.html">Sistema de gerenciamento de banco de dados conveniente</a></li>
<li><a href="../pt460923/index.html">Tarefa de teste Yandex</a></li>
<li><a href="../pt460925/index.html">Jogo online com rob√¥s reais de RC em Chernobyl. Parte 2</a></li>
<li><a href="../pt460929/index.html">Conflu√™ncia Atlassian: extens√≠vel em python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>