<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≤ üöΩ üèáüèº Reagir nativo - aplica√ß√£o e cr√≠tica üëæ üëèüèø üñêüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na maioria das vezes, ao escolher esse idioma, espera-se que o desenvolvimento de um aplicativo para duas plataformas leve metade do tempo que o desen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reagir nativo - aplica√ß√£o e cr√≠tica</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468901/"><p>  Na maioria das vezes, ao escolher esse idioma, espera-se que o desenvolvimento de um aplicativo para duas plataformas leve metade do tempo que o desenvolvimento de dois aplicativos.  Mas, no final, verifica-se que o desenvolvimento leva muito, se n√£o mais, devido √†s dificuldades ocultas sob o brilho externo e o marketing.  Falaremos sobre algumas das dificuldades semelhantes que encontramos nos √∫ltimos meses de trabalho com o React Native. </p><a name="habracut"></a><br><p>  O React Native adapta o Javascript para o desenvolvimento m√≥vel.  Isso √© obtido pelo fato de ele usar v√°rios coletores para construir projetos - o Metro Bundler, que interpreta o c√≥digo JS e representa os recursos e o coletor do sistema de destino.  No nosso caso, era um gradle para Android.  Em teoria, o aplicativo React Native deve iniciar de maneira bastante simples.  O comando react-native run-android ativa o Metro Bundler e cria o aplicativo para todos os dispositivos e emuladores Android conectados. </p><br><p> Na realidade, descobriu-se que mesmo nesta fase h√° dificuldades.  Um erro "N√£o foi poss√≠vel baixar o pacote JS" constantemente aparecia em nosso projeto, o que significava que o pacote n√£o p√¥de traduzir o c√≥digo no c√≥digo nativo.  Como se viu depois, devido ao fato de n√£o ter iniciado.  O StackOverflow confirmou a adivinha√ß√£o e sugeriu que voc√™ execute o bundler em um encadeamento separado usando o comando react-native start.  Isso permite que voc√™ reinicie o bundler apenas se o package.json tiver sido alterado, porque o procedimento n√£o diminui muito o desenvolvimento. </p><br><p>  <em>Package.json</em> √© um arquivo que cont√©m um conjunto de m√≥dulos externos para o aplicativo.  No npmjs.com, h√° um grande n√∫mero de bibliotecas diferentes para o React Native, expandindo a funcionalidade e simplificando o desenvolvimento.  Muitas bibliotecas (por exemplo, Firebase) usam fun√ß√µes nativas e, portanto, devem ser associadas diretamente ao c√≥digo nativo.  Para fazer isso, use o comando &lt;library-name&gt; do link react-native, que deve configurar esses relacionamentos com o c√≥digo nativo. </p><br><p>  Devido ao fato de todas as bibliotecas serem gravadas em momentos diferentes, elas usam vers√µes diferentes do SDK e exigem uma abordagem diferente.  √Äs vezes acontece que as bibliotecas s√£o incompat√≠veis entre si, ou a vers√£o mais recente da biblioteca √© experimental, e os pr√≥prios desenvolvedores aconselham fazer o downgrade para a pen√∫ltima.  Frequentemente, o link n√£o configura todas as depend√™ncias necess√°rias.  Portanto, para a base de firmas mencionada acima, voc√™ precisa adicionar muitas bibliotecas adicionais no c√≥digo nativo, conectar v√°rios reposit√≥rios externos, modificar mainApplication.java (e isso √© apenas para o Android!).  Para o Firebase, h√° uma instru√ß√£o bastante compreens√≠vel para executar essas a√ß√µes, mas para outras bibliotecas nem sempre est√° presente. </p><br><p>  Ap√≥s a configura√ß√£o das conex√µes com o c√≥digo nativo, voc√™ pode criar o projeto na esperan√ßa de que a biblioteca conectada funcione.  Ao montar, vale lembrar que, se voc√™ receber um erro, verifique se ele ocorreu precisamente por causa de suas a√ß√µes, e n√£o por um erro do coletor.  Para total confian√ßa, voc√™ deve executar a seguinte sequ√™ncia de a√ß√µes: </p><br><pre><code class="plaintext hljs">rmdir node_modules /s /q &amp;&amp; npm cache clean - force &amp;&amp; npm i</code> </pre> <br><p>  Este comando excluir√° a pasta node_modules e a recarregar√°.  Essa √© uma das tarefas mais longas, portanto, vale a pena us√°-la extremamente raramente.  Em alguns projetos, o node_modules pode ocupar v√°rios gigabytes no disco r√≠gido e, portanto, a reinstala√ß√£o levar√° tempo. </p><br><pre> <code class="plaintext hljs">rmdir android/app/build /s /q</code> </pre> <br><p>  Durante o desenvolvimento, percebeu-se que a compila√ß√£o geralmente malsucedida √© uma conseq√º√™ncia do fato de o coletor n√£o poder criar (ou excluir) uma pasta do diret√≥rio de depura√ß√£o.  Esta a√ß√£o resolve o problema que reage e n√£o pode excluir a pasta por conta pr√≥pria.  Mas, ao mesmo tempo, gerar arquivos para esta pasta do zero novamente levar√° um tempo extra. </p><br><pre> <code class="plaintext hljs">react-native start-reset-cache</code> </pre> <br><p>  Inicie o Metro Bundler.  Essa guia deve permanecer aberta durante todo o processo de depura√ß√£o.  Se ocorrer um erro, o log de erros pode aparecer aqui.  Provavelmente, se ocorrer um erro, esse processo ser√° encerrado e precisar√° ser reiniciado novamente. </p><br><pre> <code class="plaintext hljs">react-native run-android</code> </pre> <br><p>  Instale o aplicativo em um dispositivo ou emulador conectado.  A maioria dos erros de constru√ß√£o acontece aqui, e alguns deles s√£o compreens√≠veis, mas alguns s√£o bastante irracionais e s√£o "curados" ao reiniciar todo o processo. </p><br><p>  Imagine o processo de constru√ß√£o com uma sequ√™ncia de comandos para um projeto (j√° tendo dom√≠nio, redux, navega√ß√£o de rea√ß√£o, cerca de dez outras bibliotecas) depois de conectar o Firebase. </p><br><pre> <code class="plaintext hljs">react-native start react-native run-android &gt;&gt;    debug react-native run-android &gt;&gt; , metro bundler  react-native start react-native run-android &gt;&gt;    debug react-native run-android &gt;&gt;  !  metro bundler ,   JS-   react-native start &gt;&gt;   restart         - </code> </pre><br><p>  Escusado ser√° dizer que leva muito tempo?  E este n√£o √© um processo √∫nico: no momento descrito, esse procedimento era necess√°rio ap√≥s quase todas as altera√ß√µes no c√≥digo do programa.  A cada nova biblioteca, o projeto se torna cada vez menos est√°vel e esse processo pode mudar, na maioria das vezes para pior.  Depurar um aplicativo √© uma das fun√ß√µes mais importantes para um desenvolvedor e, nesse caso, sua velocidade diminui bastante. </p><br><p>  Falando em depura√ß√£o.  O depurador do React Native tem problemas n√£o apenas com o lan√ßamento.  A corre√ß√£o dos erros encontrados como resultado do teste tamb√©m √© um processo bastante doloroso.  No react-native, o c√≥digo JS √© traduzido para o c√≥digo nativo, mas √© ofuscado durante a tradu√ß√£o.  Portanto, se voc√™ n√£o deseja ver erros como "exce√ß√£o de ponteiro nulo em zzz.yyy ()", precisar√° usar o depurador embutido, n√£o pode simplesmente ler exce√ß√µes no logcat.  Em caso de erro, o depurador exibe uma "tela da morte" vermelha com sua descri√ß√£o, empurrando mais ou menos para o caminho da corre√ß√£o.  Mas h√° problemas com esta parte. </p><br><p>  Bem, quando o erro se parece com isso: </p><br><p><img src="https://habrastorage.org/webt/oh/sr/zo/ohsrzozloajbn7g9y0nczb_6zkq.png"></p><br><p>  √â realmente claro o que est√° acontecendo aqui - em vez do objeto esperado da matriz, this.state.noteArray.map √© indefinido na vari√°vel, o que causa o not√≥rio TypeError.  Voc√™ pode corrigi-lo acessando app.js: 14 e verificando o valor nessa vari√°vel antes de usar. </p><br><p>  Pior quando o erro se parece com isso: </p><br><p><img src="https://habrastorage.org/webt/wn/hb/6b/wnhb6bq3akewzc6vidymuhnv9ec.png"></p><br><p>  Ent√£o: </p><br><p><img src="https://habrastorage.org/webt/tn/-k/oe/tn-koehm2wzsl7gu-4hqemsvpz4.png"></p><br><p>  Ou ent√£o: </p><br><p><img src="https://habrastorage.org/webt/qb/jk/qw/qbjkqwgcbm59ffqwesbfholo6zu.png"></p><br><p>  Imagens foram tiradas da Internet, mas as vimos ao vivo.  E, apesar de serem mostrados em tempo de execu√ß√£o, esse erro n√£o se deve ao fato de que algo foi feito incorretamente no seu c√≥digo.  Isso pode ter ocorrido porque voc√™ instalou a biblioteca incorretamente ou se suas importa√ß√µes t√™m depend√™ncias incompat√≠veis ou algo deu errado no c√≥digo nativo e o React tenta capturar o erro.  Cada erro √© individual e √© resolvido de maneira muito diferente.  √â bom que exista StackOverflow e pelo menos algum tipo de modo de depura√ß√£o. </p><br><p>  Pior ainda, quando um erro n√£o √© reproduzido na depura√ß√£o.  Encontramos essa situa√ß√£o ao tentar criar um aplicativo com uma nova vers√£o do React com suporte para arquitetura x64 para Android.  Ao instalar um aplicativo com um depurador, tudo funciona bem.  Mas assim que constru√≠mos o testador no telefone, tudo para de funcionar e quebra assim que se trata de interagir com o banco de dados.  Para depurar sem depura√ß√£o √†s pressas, usamos mensagens do console, que nesse caso foram o componente react toastAndroid.  Este componente exibe um texto breve para alcan√ßar uma determinada linha de c√≥digo.  Metodicamente, preferencialmente dividindo o c√≥digo pela metade, localizamos a fun√ß√£o na qual o erro ocorre e descobrimos que o m√©todo Object.assign ({}, item) n√£o funciona na nova vers√£o do React.  Foi uma sorte que voc√™ pudesse substituir essa fun√ß√£o por um {... item} menor, mantendo a funcionalidade do aplicativo, mas a busca por esse erro custou cerca de uma d√∫zia de horas de trabalho. </p><br><p>  Ap√≥s um pequeno estudo foi realizado em busca de raz√µes.  Como se viu, o React Native usa mecanismos Javascript diferentes para interpretar o c√≥digo JS nas vers√µes de depura√ß√£o e produ√ß√£o: para depurar o mecanismo JS do Chrome e no JavaScriptCore.  Sim, o React Native n√£o converte JavaScript em c√≥digo nativo, mas interpreta √† medida que √© executado.  Ao mesmo tempo, o mecanismo de depura√ß√£o funciona muito mais est√°vel e, portanto, os bugs est√£o cada vez mais entrando na produ√ß√£o.  Por exemplo, este artigo mostra como a formata√ß√£o da data funciona em diferentes condi√ß√µes.  Voltando ao erro: depois de atualizar a vers√£o React Native, o mecanismo da Web de produ√ß√£o e produ√ß√£o perdeu o suporte a Object.assign ().  Mas o mecanismo de depura√ß√£o permaneceu o mesmo. </p><br><p>  Talvez a pior op√ß√£o ocorra quando o aplicativo √© interrompido em locais aleat√≥rios, apenas na vers√£o de produ√ß√£o e sem nenhum registro do React Native.  Exemplo: ap√≥s instalar a vers√£o do aplicativo no telefone, ele "funciona por um tempo" e depois "desliga sem erro ou aviso em um momento aleat√≥rio".  Al√©m disso, o erro n√£o √© reproduzido em todos os dispositivos.  No final, por tentativa e erro (e detectando que o mencionado Firebase Crashlytics n√£o envia os erros correspondentes), conseguimos capturar os logs de queda que eram assim: </p><br><p><img src="https://habrastorage.org/webt/oh/sr/zo/ohsrzozloajbn7g9y0nczb_6zkq.png"></p><br><p>  Este texto nem se aplica ao nosso aplicativo, nem foi marcado em vermelho.  Por√©m, depois que chegamos e fomos aos f√≥runs, descobrimos que a nova vers√£o do React Native est√° quebrada.  E o anterior foi quebrado.  No Issue Tracker oficial, o erro "Android trava: sinal 11 (SIGSEGV)" existe por dois meses e, para nossa sorte, dois dias antes de voltarmos para l√° (!) Foi proposta uma solu√ß√£o experimental que corrigia o erro. </p><br><p>  √â ir√¥nico que alguns desenvolvedores que tiveram que lidar com o Android Studio n√£o tenham certeza de que o IDE tenha op√ß√µes como construir / limpar projeto ou arquivar / invalidar caches.  Isso √© necess√°rio para se livrar do comportamento anormal do gradle, de falsas mensagens de erro e avisos, de erros de sincroniza√ß√£o.  Os desenvolvedores perguntaram: "por que devemos fazer o trabalho para o nosso IDE, em tais situa√ß√µes, esses comandos devem ser executados automaticamente".  E eles podem ser entendidos, mas, ao mesmo tempo, os IDEs modernos fazem todo o trabalho dif√≠cil nos bastidores.  E esses desenvolvedores simplesmente n√£o funcionaram com o React Native. </p><br><p>  Todos os itens acima s√£o casos isolados que ocorreram nas √∫ltimas semanas.  Aqui, n√£o descrevemos a complexidade de executar aplicativos com a Expo, definindo o estilo do c√≥digo em babel / eslint, n√£o censuramos o Javascript por flexibilidade excessiva, n√£o informamos como a depura√ß√£o devido √† liga√ß√£o redux / regi√£o foi quase completamente perdida em um dos projetos.  Considerando as dificuldades descritas de suporte e desenvolvimento e o fato de que para dois sistemas tudo se multiplica por dois, vale a pena considerar se o React Native √© realmente rent√°vel?  Depois que conclu√≠mos nosso terceiro projeto nesse idioma, decidimos que n√£o.  O que voc√™ acha? </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt468901/">https://habr.com/ru/post/pt468901/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt468885/index.html">N√£o aprenda padr√µes, aprenda conceitos</a></li>
<li><a href="../pt468889/index.html">Fun√ß√µes de retorno de chamada de script</a></li>
<li><a href="../pt468891/index.html">Antiguidades: considere a placa-m√£e do 386¬∫ computador</a></li>
<li><a href="../pt468897/index.html">SwiftUI para a √∫ltima tarefa competitiva do Telegram Charts (mar√ßo de 2019): tudo √© simples</a></li>
<li><a href="../pt468899/index.html">Quais projetos faz sentido come√ßar e o que o setor precisa da TI agora</a></li>
<li><a href="../pt468903/index.html">O futuro pertence √†s plataformas educacionais adapt√°veis. Flow Entrevista com Asger Palm</a></li>
<li><a href="../pt468905/index.html">Rumo √† acessibilidade</a></li>
<li><a href="../pt468907/index.html">Desmodula√ß√£o Yandex</a></li>
<li><a href="../pt468909/index.html">Gra√ßas √† autentica√ß√£o de dois fatores, perdi todo o meu dinheiro e tr√™s anos de trabalho</a></li>
<li><a href="../pt468911/index.html">Soberba Quantum Excellence Perguntas e Respostas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>