<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÉ üéØ ‚òòÔ∏è Operation TaskMasters: Como expomos as organiza√ß√µes atacantes do grupo cibern√©tico na R√∫ssia e na CEI üêì üò≤ ü§úüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imagem: Unsplash 

 No outono de 2018, os especialistas do PT Expert Security Center revelaram a atividade de um grupo criminoso cujas atividades visa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Operation TaskMasters: Como expomos as organiza√ß√µes atacantes do grupo cibern√©tico na R√∫ssia e na CEI</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/451566/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/lz/hs/uj/lzhsujgy5_y3llxp6xwz38yycfe.png"></a> <br><br>  <i>Imagem: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Unsplash</a></i> <br><br>  No outono de 2018, os especialistas do PT Expert Security Center revelaram a atividade de um grupo criminoso cujas atividades visavam roubar documentos confidenciais e espionagem.  Hoje falaremos sobre o andamento da investiga√ß√£o, al√©m de descrever os principais m√©todos e ferramentas que o grupo utilizou. <br><br>  <i>Nota</i> : O link fornece um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio de</a> investiga√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">completo</a> .  Ele tamb√©m fornece indicadores de comprometimento que podem ser usados ‚Äã‚Äãpara identificar sinais de um ataque. <a name="habracut"></a><br><br><h2>  Quem o grupo est√° atacando e quando foi descoberto </h2><br>  O agrupamento foi identificado por especialistas do PT Expert Security Center em 2018.  Os criminosos usaram um m√©todo incomum de seguran√ßa na infraestrutura, com base na cria√ß√£o de tarefas espec√≠ficas (tarefas) no agendador de tarefas - √© por isso que a PT ESC chamou o grupo TaskMasters. <br><br>  O Agendador de tarefas permite executar comandos do SO e executar o software em um momento espec√≠fico especificado na tarefa.  Al√©m disso, o agendador do AtNow usado por esse agrupamento permite executar tarefas n√£o apenas localmente, mas tamb√©m em computadores remotos na rede, e fazer isso independentemente das configura√ß√µes de hor√°rio desses n√≥s.  Al√©m disso, este utilit√°rio n√£o requer instala√ß√£o.  Esses recursos simplificam a automa√ß√£o de ataques. <br><br>  Hackers invadiram empresas de diferentes pa√≠ses, com um n√∫mero significativo de v√≠timas na R√∫ssia e na CEI.  A maioria das empresas atacadas pode ser atribu√≠da √† ind√∫stria.  No total, estamos cientes do comprometimento de mais de 30 organiza√ß√µes em v√°rios setores, incluindo os setores de energia e petr√≥leo e g√°s e √≥rg√£os governamentais. <br><br>  O principal objetivo do grupo √© roubar informa√ß√µes confidenciais.  Os invasores tentam se estabelecer no sistema de informa√ß√µes corporativas por um longo tempo e obt√™m acesso aos principais servidores da empresa, esta√ß√µes de trabalho de alta ger√™ncia e sistemas cr√≠ticos de neg√≥cios. <br><br>  Os primeiros rastros da presen√ßa do grupo na infraestrutura datam de 2010 e, naquela √©poca, os criminosos j√° controlavam completamente alguns servidores e esta√ß√µes de trabalho, o que significa que a penetra√ß√£o ocorreu muito antes. <br><br><h2>  Pegada asi√°tica </h2><br>  No c√≥digo no GitHub do shell da Web ASPXSpy2014, usado durante o ataque, h√° links para desenvolvedores chineses.  No entanto, a vers√£o que encontramos cont√©m um link para google.ru. <br><br><img src="https://habrastorage.org/webt/ag/oh/va/agohvad709ucmllwefycordfjhw.png"><br><br>  <i>ASPXSpy: vers√µes p√∫blicas e atacadas</i> <br><br>  Nos pedidos de web shells, foram identificados endere√ßos IP pertencentes ao provedor de hospedagem e gr√°ficas na Europa Oriental.  Por√©m, nos eventos do log do servidor proxy de uma das organiza√ß√µes atacadas, o momento em que os atacantes mudaram para o endere√ßo IP chin√™s 115.171.23.103 foi refletido, o que provavelmente ocorreu devido √† desconex√£o da VPN do software no momento do ataque. <br><br>  Durante o ataque, os atacantes usaram uma c√≥pia do arquivador WinRAR, que foi ativada com uma chave amplamente distribu√≠da em f√≥runs cujos usu√°rios se comunicam em chin√™s. <br><br><img src="https://habrastorage.org/webt/5d/tg/eh/5dtgeh4xjibopstd7zh6altqxas.png"><br><br>  <i>Vers√£o licenciada do WinRAR em recursos de software</i> <br><br><img src="https://habrastorage.org/webt/dc/qs/as/dcqsas2b1wfkqble9g_pntsvbcc.png"><br><br>  <i>Chave de licen√ßa WinRAR publicada em f√≥runs chineses</i> <br><br>  Para uma das tarefas, foi utilizado o dom√≠nio Brengkolang.com, registrado atrav√©s de um registrador chin√™s.  Al√©m disso, muitos utilit√°rios cont√™m mensagens de erro e outras informa√ß√µes de depura√ß√£o escritas em ingl√™s com erros, o que pode indicar que n√£o √© nativo para os desenvolvedores. <br><br><h2>  Como os atacantes agem </h2><br>  O vetor de ataque geral √© bastante previs√≠vel.  Depois de penetrar na rede local, os atacantes examinam a infraestrutura, exploram as vulnerabilidades do sistema (por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CVE-2017-0176</a> ), depois baixam para n√≥s comprometidos e descompactam um conjunto de utilit√°rios.  Usando esse conjunto, eles pesquisam, copiam e arquivam os arquivos de seu interesse e os enviam para os servidores de gerenciamento. <br><br>  Para navegar na rede, os criminosos executam comandos do sistema em n√≥s remotos usando o utilit√°rio AtNow, que permite executar software e executar comandos ap√≥s um intervalo de tempo especificado.  Gerenciar os n√≥s usando pequenas backdoors, atrav√©s das quais eles se conectam aos servidores de gerenciamento.  Ao mesmo tempo, existem canais de backup na forma de shells da Web carregados em recursos externos, por exemplo, no servidor Exchange. <br><br><img src="https://habrastorage.org/webt/_t/4n/wv/_t4nwviraqyi6_wd43biwwuovt8.png"><br><br>  <i>Padr√£o de ataque</i> <br><br>  O grupo usa a infraestrutura de DNS din√¢mico para seus dom√≠nios.  Os invasores usam um grande conjunto de utilit√°rios e ferramentas para realizar ataques cibern√©ticos e usar ativamente o esquema de ataques da cadeia de suprimentos. <br><br>  Para verificar a rede e comprometer os sistemas, os atacantes usam software gratuito (incluindo NBTScan, PWDump, Mimikatz).  Al√©m de ferramentas de terceiros, tamb√©m s√£o utilizados programas de desenvolvimento pr√≥prio. <br><br>  O principal software do grupo TaskMasters, com o qual controlavam os n√≥s infectados, consiste em dois componentes: <br><br><ul><li>  RemShell Downloader - carregador, </li><li>  RemShell - software com um conjunto b√°sico de fun√ß√µes. </li></ul><br>  Vamos considerar em mais detalhes cada um dos componentes. <br><br><h2>  RemShell Downloader </h2><br>  Esse componente do malware foi projetado para fornecer a carga √∫til principal ao sistema atacado.  O esquema geral do carregador de inicializa√ß√£o √© mostrado na figura abaixo. <br><br><img src="https://habrastorage.org/webt/wc/gq/q_/wcgqq_svfh88x9m3gxtf1qamhys.png"><br><br>  <i>Fluxo de trabalho do RemShell Loader</i> <br><br>  O carregador acessa a p√°gina HTML no endere√ßo especificado anteriormente em seu c√≥digo e l√™ o valor do atributo Attribute da tag HTML: <br><br><img src="https://habrastorage.org/webt/of/ug/6c/ofug6cpcp-u6byrh-7ghxx7tf-a.png"><br><br>  <i>Exemplo de arquivo HTML</i> <br><br>  Em seguida, o valor de leitura √© descriptografado e, dependendo do conte√∫do, o carregador de inicializa√ß√£o entra no modo de espera (comando Sleep) ou salva o arquivo PE em disco e o inicia.  O arquivo PE baixado √© apenas a carga √∫til - o principal Trojan RemShell. <br><br><h2>  Trojan RemShell </h2><br>  O RemShell, o principal malware usado pelos atacantes para controlar os n√≥s infectados, fornece aos atacantes as seguintes op√ß√µes: <br><br><ol><li>  Terminal para controle remoto do host (cmd shell). </li><li>  Upload de arquivos para um host remoto. </li><li>  Baixe arquivos de um host remoto para o servidor de gerenciamento. </li></ol><br>  O cavalo de Troia usa dois servidores de gerenciamento.  O primeiro atua como intermedi√°rio ou proxy, que, a pedido de malware, fornece o endere√ßo do servidor de gerenciamento principal.  Al√©m disso, um comando pode ser recebido do primeiro servidor de gerenciamento para transferir malware para outro servidor proxy de gerenciamento. <br><br><img src="https://habrastorage.org/webt/7r/pg/ll/7rpgll7b5bjlvyyljapucz_hsec.png"><br><br>  <i>Migrando do Primeiro Servidor de Gerenciamento para o Principal</i> <br><br>  Encontramos v√°rias varia√ß√µes desse malware.  Em alguns, por exemplo, n√£o havia comando para baixar arquivos do n√≥ para o servidor de gerenciamento - nesses casos, os atacantes usavam um utilit√°rio propriet√°rio para fazer upload de arquivos.  Em outros, foram adicionados comandos que permitem obter uma lista de processos em execu√ß√£o no sistema e concluir o processo por PID (identificador de processo). <br>  Os dados de configura√ß√£o, como o endere√ßo do servidor proxy de controle, porta, agente do usu√°rio, s√£o criptografados usando o RC4 e definidos por constantes no c√≥digo do malware. <br><br>  Os dados enviados entre os servidores de gerenciamento e o malware s√£o criptografados usando o algoritmo RC4 e adicionalmente codificados com Base64.  A chave para RC4 √© gerada usando uma cadeia constante, calculando o hash MD5.  O resultado da execu√ß√£o de comandos recebidos do servidor de gerenciamento √© enviado como uma solicita√ß√£o HTTP para a URL com um prefixo espec√≠fico 1111. <br><br>  O malware tamb√©m inclui o mecanismo de pulsa√ß√£o, que em intervalos aleat√≥rios "toca" em uma solicita√ß√£o HTTP que cont√©m o resultado do comando hostname para um determinado URL com um prefixo espec√≠fico de 0000. <br><br><img src="https://habrastorage.org/webt/ng/-j/f_/ng-jf_ivno95yki2nb0wced6ygo.png"><br><br>  <i>Batimento card√≠aco</i> <br><br><h2>  Servidores de gerenciamento </h2><br>  A parte do servidor para gerenciar malware nos n√≥s infectados √© representada pelos arquivos ELF do console.  A interface de gerenciamento do servidor √© feita na forma de um shell e suporta os comandos apresentados na figura abaixo. <br><br><img src="https://habrastorage.org/webt/dm/zc/oy/dmzcoy-l6yk0yizsuueiksglsta.png"><br><br>  O servidor registra em detalhes todos os comandos enviados ao host remoto.  Esses arquivos de log s√£o armazenados no disco em formato criptografado.  Para criptografar arquivos de log, o algoritmo RC4 √© usado. <br><br>  Conseguimos analisar v√°rias inst√¢ncias do lado do servidor do malware.  Em um caso, encontramos uma men√ß√£o ao desenvolvedor do AiMi, ao qual encontramos refer√™ncias em outras ferramentas do agrupamento TaskMasters. <br><br><img src="https://habrastorage.org/webt/pv/ie/sv/pviesv3b2-pss7d6tyedpcrk1yg.png"><br><br>  <i>Mencionando Desenvolvedores nas Informa√ß√µes Exibidas pelo Script</i> <br><br><h2>  Shell da Web 404-input-shell </h2><br>  A janela de autoriza√ß√£o para acessar a funcionalidade do shell da web √© disfar√ßada como a p√°gina de erro padr√£o 404 do servidor web do IIS.  Para acessar a linha de comandos e executar comandos, voc√™ deve inserir uma senha.  O campo da senha √© oculto e exibido se voc√™ clicar no link Voltar. <br><br><img src="https://habrastorage.org/webt/q_/wv/x1/q_wvx1r71d3xebktyd7fpwl-th0.png"><br><br><pre><code class="bash hljs">Click the &lt;a href=<span class="hljs-string"><span class="hljs-string">"#"</span></span> ondblclick=<span class="hljs-string"><span class="hljs-string">"history_back()"</span></span>&gt;Back&lt;/a&gt; button to try another link.&lt;/li&gt;</code> </pre> <br>  Para autoriza√ß√£o, os atacantes usaram a senha 0p; / 9ol.  - eles usaram a mesma senha para criptografar arquivos.  O c√≥digo do shell da web cont√©m o hash MD5 dessa senha. <br><br><img src="https://habrastorage.org/webt/jg/ia/vg/jgiavgy650zj9gonqkmegfuekk8.png"><br><br>  No total, como parte das investiga√ß√µes, descobrimos tr√™s modifica√ß√µes desse shell da web.  Eles diferem na funcionalidade: um deles √© usado apenas para baixar arquivos do servidor, o outro para carregar arquivos no servidor e o terceiro para executar comandos do SO. <br><br><h2>  Conclus√£o </h2><br>  Nosso estudo mostra que os cibercriminosos podem perseguir n√£o apenas metas financeiras moment√¢neas.  Cada vez mais, eles procuram obter acesso aos dados e capturar o controle dos fluxos de informa√ß√µes das organiza√ß√µes. <br><br>  As v√≠timas de espionagem cibern√©tica podem ser empresas em v√°rios setores da economia.  Para entender como se defender contra esses ataques, √© necess√°rio usar ferramentas especializadas.  Tamb√©m na fase de investiga√ß√£o, √© importante estudar em detalhes as t√°ticas usadas pelos atacantes.  √â muito dif√≠cil para as organiza√ß√µes resolver esse problema por conta pr√≥pria, porque isso requer n√£o apenas ferramentas avan√ßadas, mas tamb√©m especialistas em seguran√ßa da informa√ß√£o altamente qualificados.  A implementa√ß√£o das recomenda√ß√µes recebidas dos profissionais de seguran√ßa aumentar√° o n√≠vel de seguran√ßa da infraestrutura e complicar√° sua invas√£o. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt451566/">https://habr.com/ru/post/pt451566/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt451552/index.html">Criamos canais de vendas em rede do gadget DO-RA</a></li>
<li><a href="../pt451556/index.html">Flutter: localiza√ß√£o de aplicativos usando o Android Studio</a></li>
<li><a href="../pt451558/index.html">Um dia na vida da automa√ß√£o de controle de qualidade</a></li>
<li><a href="../pt451560/index.html">Caro cliente, √© por isso que essa mudan√ßa levou tanto tempo.</a></li>
<li><a href="../pt451562/index.html">Como escapar de uma seita?</a></li>
<li><a href="../pt451570/index.html">Mudar-se para a Fran√ßa para trabalhar: sal√°rios, vistos e curr√≠culos</a></li>
<li><a href="../pt451572/index.html">Tend√™ncias da Tecnologia de Desenvolvimento Web 2019</a></li>
<li><a href="../pt451574/index.html">Desenvolva um utilit√°rio no GraalVM</a></li>
<li><a href="../pt451576/index.html">O livro "Nosso c√≥digo. Artesanato, profiss√£o, arte "</a></li>
<li><a href="../pt451580/index.html">MODX Digest # 5 (22 de abril a 13 de maio de 2019)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>