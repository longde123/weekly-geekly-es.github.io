<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📉 Ⓜ️ 💾 Una introducción práctica al administrador de paquetes para Kubernetes - Helm 🙌🏼 👀 👐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El artículo es una continuación lógica de nuestra reciente publicación sobre la historia del administrador de paquetes para Kubernetes - Helm . Esta v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Una introducción práctica al administrador de paquetes para Kubernetes - Helm</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/420437/"><img src="https://habrastorage.org/webt/ff/1x/js/ff1xjsnvdlnfinirlwb-0p42tlo.png"><br><br>  El artículo es una continuación lógica de nuestra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">reciente publicación</a> sobre la historia del administrador de paquetes para Kubernetes - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b>Helm</b></a> .  Esta vez abordaremos nuevamente los problemas del dispositivo y el funcionamiento del Helm actual ( <b>versión 2.x</b> ), así como sus gráficos y repositorios administrados, después de lo cual pasaremos a la práctica de instalar Helm en el clúster de Kubernetes y usar los gráficos. <a name="habracut"></a><br><br><h2>  Entrada </h2><br>  <b>Helm es una herramienta de gestión de gráficos.</b> <br><br>  <b>El gráfico</b> describe el conjunto de datos necesario para crear instancias de la aplicación en el clúster de Kubernetes.  Puede tener gráficos incrustados y puede usarse tanto para describir servicios completos, que consisten en muchos recursos dependientes, como para describir componentes independientes individuales.  Por ejemplo, el gráfico <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estable / gitlab-ce</a> describe una solución completa <a href="">utilizando los</a> gráficos independientes redis y postgresql. <br><br>  Se puede establecer un gráfico un número ilimitado de veces en el mismo clúster.  Por lo tanto, la descripción de la lógica de implementación de la aplicación en diferentes entornos puede y debe almacenarse en el mismo gráfico. <br><br>  El lado del cliente de Helm es responsable de crear el gráfico y transferir el componente <b>Tiller</b> al clúster de Kubernetes junto con los parámetros del usuario.  A su vez, Tiller es responsable del ciclo de vida de la instancia del gráfico lanzado, lanzamiento.  <i>(Por si acaso, permítame recordarle que la próxima actualización importante de Helm, la versión 3, ya no tendrá Tiller).</i> <br><br>  Y ahora, lo primero es lo primero. <br><br><h2>  Instalación y actualización </h2><br>  Helm requiere que Kubernetes funcione.  Puede usar un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Minikube</a> instalado localmente <i>(consulte también " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Introducción en Kubernetes con Minikube</a> ")</i> o cualquier otro clúster disponible. <br><br>  Comencemos con la instalación del cliente: seleccione la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">versión</a> , descargue y descomprima el archivo de su sistema, transfiera el archivo ejecutable ... <br><br><pre><code class="bash hljs">$ curl https://storage.googleapis.com/kubernetes-helm/helm-v2.10.0-linux-amd64.tar.gz | tar -zxv $ sudo mv linux-amd64/helm /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/helm</code> </pre> <br>  A continuación, instale Tiller en el clúster.  De manera predeterminada, Tiller se instala en el <b><code>kubectl</code> contexto de <code>kubectl</code></b> ( <code>kubectl config current-context</code> ), en el <b>espacio de nombres del <code>kube-system</code></b> , pero esto se puede cambiar utilizando las opciones apropiadas y las variables de entorno; se describen en la ayuda ( <code>helm init --help</code> ).  Completemos la instalación y observemos los recursos creados en el clúster: <br><br><pre> <code class="bash hljs">$ helm init <span class="hljs-variable"><span class="hljs-variable">$HELM_HOME</span></span> has been configured at /home/habr/.helm. (Use --client-only to suppress this message, or --upgrade to upgrade Tiller to the current version.) Happy Helming! $ kubectl get all --selector=name=tiller --namespace kube-system NAME READY STATUS RESTARTS AGE po/tiller-deploy-df4fdf55d-h5mvh 0/1 Running 0 5s NAME CLUSTER-IP EXTERNAL-IP PORT(S) AGE svc/tiller-deploy 10.107.191.68 &lt;none&gt; 44134/TCP 5s NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE deploy/tiller-deploy 1 1 1 0 5s NAME DESIRED CURRENT READY AGE rs/tiller-deploy-df4fdf55d 1 1 0 5s</code> </pre><br>  Ahora Tiller está instalado en el clúster y está listo para la administración de versiones, la interacción con la API de Kubernetes. <br><br>  <i><b>Nota</b> : Durante la instalación y actualización (opción - actualización) de Tiller, puede <b>especificar una imagen específica en</b> lugar de utilizar la última versión estable de forma predeterminada.</i>  <i>El nombre de una imagen arbitraria está determinado por la opción <code>--tiller-image</code> , y con la opción <code>--canary-image</code> , se usará una <code>--canary-image</code> cuando Tiller se despliegue.</i>  <i>La imagen canaria le permite utilizar Tiller, cuya versión del código corresponde a la rama maestra.</i> <br><br>  Los datos de servicio se almacenan en un clúster en recursos especiales, <code>ConfigMaps</code> , por lo que desinstalar y reinstalar Tiller no conduce a la pérdida de datos de versiones instaladas previamente. <br><br><h2>  Repositorios de cartas </h2><br>  Repositorio de gráficos: un servidor HTTP para almacenar y distribuir gráficos.  La información sobre gráficos en el repositorio se almacena en el archivo <code>index.yaml</code> .  También indica desde dónde se puede cargar cada gráfico.  Con mayor frecuencia, los gráficos se almacenan con el archivo <code>index.yaml</code> , pero nada impide que se coloquen en otro servidor.  Por lo general, la estructura del archivo se reduce a una forma plana: <br><br><pre> <code class="bash hljs">. ├── index.yaml ├── artifactory-7.3.0.tgz ├── docker-registry-1.5.2.tgz ... └── wordpress-2.1.10.tgz</code> </pre><br>  Por defecto, Helm usa el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio oficial de gráficos de Kubernetes</a> .  Contiene gráficos actuales cuidadosamente diseñados para resolver muchos problemas aplicados.  Este repositorio se llama <b>estable</b> : <br><br><pre> <code class="bash hljs">$ helm repo list NAME URL stable https://kubernetes-charts.storage.googleapis.com</code> </pre><br>  Si es necesario, <b>crear</b> su propio repositorio no será ningún problema.  Los requisitos del servidor son mínimos, por lo que, como la mayoría de los repositorios de gráficos públicos, se puede alojar en las páginas de GitHub.  Puede leer más sobre las herramientas y los pasos necesarios para esto en la <a href="">documentación</a> . <br><br>  Cuando se utilizan repositorios de gráficos, se pueden agregar y eliminar.  Para que las versiones del gráfico estén actualizadas, debe actualizar periódicamente el índice.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Daré</a> un ejemplo para el repositorio público de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bitnami</a> , la mayoría de los cuales se utilizan en el repositorio oficial de Helm: <br><br><pre> <code class="bash hljs">$ helm repo add bitnami https://charts.bitnami.com/bitnami <span class="hljs-string"><span class="hljs-string">"bitnami"</span></span> has been added to your repositories $ helm repo update Hang tight <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> we grab the latest from your chart repositories... ...Successfully got an update from the <span class="hljs-string"><span class="hljs-string">"bitnami"</span></span> chart repository ...Successfully got an update from the <span class="hljs-string"><span class="hljs-string">"stable"</span></span> chart repository Update Complete. Happy Helming! $ helm repo remove bitnami <span class="hljs-string"><span class="hljs-string">"bitnami"</span></span> has been removed from your repositories</code> </pre><br>  Siguiente: <b>busca</b> en los repositorios.  Una llamada de <code>helm search</code> sin argumentos muestra todos los gráficos disponibles: <br><br><pre> <code class="bash hljs">$ helm search NAME CHART VERSION APP VERSION DESCRIPTION stable/acs-engine-autoscaler 2.2.0 2.1.1 Scales worker nodes within agent pools stable/aerospike 0.1.7 v3.14.1.2 A Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Aerospike <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Kubernetes stable/anchore-engine 0.2.1 0.2.4 Anchore container analysis and policy evaluation engine s... stable/apm-server 0.1.0 6.2.4 The server receives data from the Elastic APM agents and ... stable/ark 1.2.1 0.9.1 A Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ark stable/artifactory 7.3.0 6.1.0 Universal Repository Manager supporting all major packagi... ... stable/weave-cloud 0.2.2 0.2.0 Weave Cloud is a add-on to Kubernetes <span class="hljs-built_in"><span class="hljs-built_in">which</span></span> provides Cont... stable/weave-scope 0.9.3 1.6.5 A Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the Weave Scope cluster visualizer. stable/wordpress 2.1.10 4.9.8 Web publishing platform <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> building blogs and websites. stable/xray 0.4.1 2.3.0 Universal component scan <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> security and license invento... stable/zeppelin 1.0.1 0.7.2 Web-based notebook that enables data-driven, interactive ... stable/zetcd 0.1.9 0.0.3 CoreOS zetcd Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Kubernetes</code> </pre><br>  En el campo opcional de <code>keywords</code> en <code>Chart.yaml</code> desarrolladores especifican etiquetas que se utilizan para simplificar la búsqueda en los repositorios de gráficos: <br><br><pre> <code class="bash hljs">$ helm search web NAME CHART VERSION APP VERSION DESCRIPTION stable/cerebro 0.3.1 0.8.1 A Helm chart <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Cerebro - a web admin tool that replaces... stable/chronograf 0.4.5 1.3 Open-source web application written <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Go and React.js th... stable/jasperreports 2.0.4 7.1.0 The JasperReports server can be used as a stand-alone or ... stable/joomla 2.0.9 3.8.12 PHP content management system (CMS) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> publishing web co... stable/kubernetes-dashboard 0.7.2 1.8.3 General-purpose web UI <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Kubernetes clusters stable/odoo 2.0.7 11.0.20180815 A suite of web based open <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> business apps. stable/phabricator 2.1.9 2018.34.0 Collection of open <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> web applications that <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> soft... stable/redmine 4.1.0 3.4.6 A flexible project management web application. stable/rethinkdb 0.1.4 0.1.0 The open-source database <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the realtime web stable/schema-registry-ui 0.1.0 v0.9.4 This is a web tool <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the confluentinc/schema-registry i... stable/superset 0.1.2 0.24.0 Apache Superset (incubating) is a modern, enterprise-read... stable/testlink 2.0.3 1.9.17 Web-based <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> management system that facilitates softwar... stable/tomcat 0.1.0 7 Deploy a basic tomcat application server with sidecar as ... stable/wordpress 2.1.10 4.9.8 Web publishing platform <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> building blogs and websites. ... $ helm search cms blog NAME CHART VERSION APP VERSION DESCRIPTION stable/drupal 1.1.3 8.5.6 One of the most versatile open <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> content management ... stable/joomla 2.0.9 3.8.12 PHP content management system (CMS) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> publishing web co... stable/wordpress 2.1.10 4.9.8 Web publishing platform <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> building blogs and websites</code> </pre> <br>  <i><b>Nota:</b> Al usar el <code>helm search</code> , puede encontrar una operación inestable de varios filtros: la disponibilidad del resultado depende del orden de indicación y el número de filtros.</i> <br><br>  Después de que el círculo de búsqueda se haya reducido a varias opciones, puede proceder a un análisis más detallado de los gráficos, utilizando el <code>helm inspect</code> .  Muestra el contenido de los archivos de gráficos <code>Chart.yaml</code> , <code>values.yaml</code> y <code>README.md</code> .  Cada sección se puede mostrar individualmente con los argumentos correspondientes: <code>chart</code> , <code>values</code> y <code>readme</code> . <br><br>  En el repositorio oficial, los gráficos están bellamente documentados y contienen ejemplos de uso, y algunos gráficos incluso tienen configuraciones listas para su <b>producción</b> .  Por ejemplo, <a href="">estable / wordpress</a> proporciona un buen <code>readme</code> <i>(para su salida en la consola, consulte <code>helm inspect readme stable/wordpress</code> )</i> . <br><br>  Buscar es una buena forma de encontrar paquetes asequibles.  Después de encontrar el paquete, puede usarlo para instalar la aplicación en el clúster. <br><br><h2>  Primera aplicación </h2><br>  Por ejemplo, se selecciona el gráfico <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estable / wordpress</a> ya mencionado. <br><br>  Utiliza los parámetros descritos en el archivo <code>values.yaml</code> .  Puede anular los parámetros en un archivo YAML y luego transferir este archivo durante la instalación (opciones <code>-f</code> , <code>--values</code> ).  Además, se pueden anular directamente en la línea de comando (opciones <code>--set</code> , <code>--set-string</code> y <code>--set-file</code> ).  Todas las opciones están disponibles para usar un número arbitrario de veces;  Al mismo tiempo, la anulación en la línea de comando tiene prioridad sobre los archivos con parámetros. <br><br>  Al configurar el gráfico, puede configurar el nombre de la versión con la opción <code>--name</code> o usar el nombre aleatorio generado por Helm. <br><br>  Establezca el cuadro de <a href="">configuración para la producción</a> , cambie el nombre del blog, desactive el almacenamiento de datos de WordPress en <code>PersistentVolumeClaim</code> <i>(para obtener más información sobre el almacenamiento persistente, consulte la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentación de Kubernetes</a> )</i> : <br><br><pre> <code class="bash hljs">$ curl https://raw.githubusercontent.com/helm/charts/master/stable/wordpress/values-production.yaml --output values-production.yaml $ helm install --name habr --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"wordpressBlogName=Flant's Blog!"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"persistence.enabled=false"</span></span> -f values-production.yaml stable/wordpress NAME: habr LAST DEPLOYED: Fri Aug 31 15:17:57 2018 NAMESPACE: default STATUS: DEPLOYED RESOURCES: ==&gt; v1/Secret NAME TYPE DATA AGE habr-mariadb Opaque 2 0s habr-wordpress Opaque 2 0s ==&gt; v1/ConfigMap NAME DATA AGE habr-mariadb-init-scripts 1 0s habr-mariadb 1 0s habr-mariadb-tests 1 0s ==&gt; v1/Service NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE habr-mariadb ClusterIP 10.111.7.232 &lt;none&gt; 3306/TCP 0s habr-wordpress ClusterIP 10.106.129.88 &lt;none&gt; 80/TCP,443/TCP 0s ==&gt; v1beta1/Deployment NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE habr-wordpress 3 3 3 0 0s ==&gt; v1beta1/StatefulSet NAME DESIRED CURRENT AGE habr-mariadb 1 1 0s ==&gt; v1beta1/Ingress NAME HOSTS ADDRESS PORTS AGE wordpress.local-habr wordpress.local 80, 443 0s ==&gt; v1/Pod(related) NAME READY STATUS RESTARTS AGE habr-wordpress-7955b95fd-hh7b9 0/1 ContainerCreating 0 0s habr-wordpress-7955b95fd-tgsxk 0/1 ContainerCreating 0 0s habr-wordpress-7955b95fd-xjz74 0/1 ContainerCreating 0 0s habr-mariadb-0 0/1 ContainerCreating 0 0s NOTES: 1. Get the WordPress URL: You should be able to access your new WordPress installation through https://wordpress.local/admin 2. Login with the following credentials to see your blog <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Username: user <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Password: $(kubectl get secret --namespace default habr-wordpress -o jsonpath=<span class="hljs-string"><span class="hljs-string">"{.data.wordpress-password}"</span></span> | base64 --decode)</code> </pre><br>  En el caso de trabajar con un clúster completo, puede seguir las recomendaciones del bloque <i>NOTAS</i> anterior.  Si tiene Minikube, abra el sitio en un navegador de la siguiente manera: <br><br><pre> <code class="bash hljs">$ minikube service habr-wordpress Waiting, endpoint <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> service is not ready yet... Opening kubernetes service default/habr-wordpress <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> default browser...</code> </pre> <br>  ¡Felicidades, la aplicación está en un clúster! <br><br><img src="https://habrastorage.org/webt/on/bg/ub/onbgubke7d2hntrso3asemt5teq.png"><br><br>  Un cuadro detallado con WordPress apareció en la lista de todas las versiones de Helm: <br><br><pre> <code class="bash hljs">$ helm list NAME REVISION UPDATED STATUS CHART APP VERSION NAMESPACE habr 1 Fri Aug 31 15:17:57 2018 DEPLOYED wordpress-2.1.10 4.9.8 default</code> </pre><br>  El siguiente paso es actualizar nuestro lanzamiento y cambiar la imagen con el blog.  Por ejemplo, se <code>4.9.8-ol-7</code> otra etiqueta del mismo repositorio de Docker ( <code>4.9.8-ol-7</code> ): <br><br><pre> <code class="bash hljs">$ helm upgrade habr --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"image.tag=4.9.8-ol-7"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"wordpressBlogName=Flant's Blog!"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-string"><span class="hljs-string">"persistence.enabled=false"</span></span> -f values-production.yaml stable/wordpress Release <span class="hljs-string"><span class="hljs-string">"habr"</span></span> has been upgraded. Happy Helming! LAST DEPLOYED: Fri Aug 31 15:21:08 2018 NAMESPACE: default STATUS: DEPLOYED RESOURCES: ==&gt; v1/Service NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE habr-mariadb ClusterIP 10.111.7.232 &lt;none&gt; 3306/TCP 3m habr-wordpress ClusterIP 10.106.129.88 &lt;none&gt; 80/TCP,443/TCP 3m ==&gt; v1beta1/Deployment NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE habr-wordpress 3 4 2 0 3m ==&gt; v1beta1/StatefulSet NAME DESIRED CURRENT AGE habr-mariadb 1 1 3m ==&gt; v1beta1/Ingress NAME HOSTS ADDRESS PORTS AGE wordpress.local-habr wordpress.local 80, 443 3m ==&gt; v1/Pod(related) NAME READY STATUS RESTARTS AGE habr-wordpress-66f4fd6b74-gqwhh 0/1 Pending 0 0s habr-wordpress-66f4fd6b74-mf6vj 0/1 Pending 0 0s habr-wordpress-7955b95fd-hh7b9 1/1 Running 2 3m habr-wordpress-7955b95fd-tgsxk 1/1 Running 2 3m habr-wordpress-7955b95fd-xjz74 0/1 Terminating 2 3m habr-mariadb-0 1/1 Running 0 3m ==&gt; v1/Secret NAME TYPE DATA AGE habr-mariadb Opaque 2 3m habr-wordpress Opaque 2 3m ==&gt; v1/ConfigMap NAME DATA AGE habr-mariadb-init-scripts 1 3m habr-mariadb 1 3m habr-mariadb-tests 1 3m NOTES: 1. Get the WordPress URL: You should be able to access your new WordPress installation through https://wordpress.local/admin 2. Login with the following credentials to see your blog <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Username: user <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Password: $(kubectl get secret --namespace default habr-wordpress -o jsonpath=<span class="hljs-string"><span class="hljs-string">"{.data.wordpress-password}"</span></span> | base64 --decode)</code> </pre><br>  Tenga en cuenta que <b>al actualizar</b> Tiller compara el gráfico recibido con los parámetros con el último guardado y realiza las solicitudes correspondientes en la API de Kubernetes, y el <b>estado actual de los recursos de la versión no se tiene en cuenta</b> .  Es importante comprender esta característica y no cometer errores: <br><br><ul><li>  La actualización no es diferente de la instalación: el cliente Helm envía la tabla Tiller junto con los parámetros, por lo que debe tener cuidado y recordar especificar los parámetros y archivos con los parámetros que se establecieron durante la instalación (o durante la actualización anterior) y que no deben ignorarse.  En el ejemplo anterior, esto es <code>--set "wordpressBlogName=Flant's Blog!" --set "persistence.enabled=false" -f values-production.yaml</code>  <code>--set "wordpressBlogName=Flant's Blog!" --set "persistence.enabled=false" -f values-production.yaml</code> . </li><li>  Las aplicaciones que se implementan con Helm solo deben servirse con Helm: Helm no tendrá en cuenta los cambios manuales realizados con <code>kubectl</code> y pueden tener consecuencias irreversibles. </li></ul><br>  De ahí la conclusión lógica: el <b>proceso debe automatizarse</b> y los cambios deben realizarse solo mediante la confirmación en el repositorio de Git, cambiando los archivos de gráficos y el archivo de configuración de CI. <br><br>  El estado de los componentes de lanzamiento de la aplicación en un clúster siempre se puede verificar de la siguiente manera: <br><br><pre> <code class="bash hljs">$ helm status habr LAST DEPLOYED: Fri Aug 31 15:21:08 2018 NAMESPACE: default STATUS: DEPLOYED RESOURCES: ==&gt; v1/Secret NAME TYPE DATA AGE habr-mariadb Opaque 2 4m habr-wordpress Opaque 2 4m ==&gt; v1/ConfigMap NAME DATA AGE habr-mariadb-init-scripts 1 4m habr-mariadb 1 4m habr-mariadb-tests 1 4m ==&gt; v1/Service NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE habr-mariadb ClusterIP 10.111.7.232 &lt;none&gt; 3306/TCP 4m habr-wordpress ClusterIP 10.106.129.88 &lt;none&gt; 80/TCP,443/TCP 4m ==&gt; v1beta1/Deployment NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE habr-wordpress 3 4 2 3 4m ==&gt; v1beta1/StatefulSet NAME DESIRED CURRENT AGE habr-mariadb 1 1 4m ==&gt; v1beta1/Ingress NAME HOSTS ADDRESS PORTS AGE wordpress.local-habr wordpress.local 80, 443 4m ==&gt; v1/Pod(related) NAME READY STATUS RESTARTS AGE habr-wordpress-66f4fd6b74-gqwhh 0/1 Pending 0 1m habr-wordpress-66f4fd6b74-mf6vj 1/1 Running 0 1m habr-wordpress-7955b95fd-hh7b9 1/1 Running 3 4m habr-wordpress-7955b95fd-tgsxk 1/1 Running 3 4m habr-mariadb-0 1/1 Running 1 4m NOTES: 1. Get the WordPress URL: You should be able to access your new WordPress installation through https://wordpress.local/admin 2. Login with the following credentials to see your blog <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Username: user <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Password: $(kubectl get secret --namespace default habr-wordpress -o jsonpath=<span class="hljs-string"><span class="hljs-string">"{.data.wordpress-password}"</span></span> | base64 --decode)</code> </pre><br>  Helm le permite <b>retroceder a una revisión de lanzamiento específica</b> .  Actualmente hay dos revisiones: <br><br><pre> <code class="bash hljs">$ helm <span class="hljs-built_in"><span class="hljs-built_in">history</span></span> habr REVISION UPDATED STATUS CHART DESCRIPTION 1 Fri Aug 31 15:17:57 2018 SUPERSEDED wordpress-2.1.10 Install complete 2 Fri Aug 31 15:21:08 2018 DEPLOYED wordpress-2.1.10 Upgrade complete</code> </pre><br>  Regrese la aplicación a su estado original: <br><br><pre> <code class="bash hljs">$ helm rollback habr 1 Rollback was a success! Happy Helming!</code> </pre><br>  Ahora el historial de revisiones se ha rellenado con un registro: <br><br><pre> <code class="plaintext hljs">$ helm history habr REVISION UPDATED STATUS CHART DESCRIPTION 1 Fri Aug 31 15:17:57 2018 SUPERSEDED wordpress-2.1.10 Install complete 2 Fri Aug 31 15:21:08 2018 SUPERSEDED wordpress-2.1.10 Upgrade complete 3 Fri Aug 31 15:25:06 2018 DEPLOYED wordpress-2.1.10 Rollback to 1</code> </pre><br>  ¿El artículo está llegando a su fin y ya no se requiere el lanzamiento? <br><br><pre> <code class="bash hljs">$ helm delete habr release <span class="hljs-string"><span class="hljs-string">"habr"</span></span> deleted</code> </pre><br>  ¿Está realmente eliminado? .. <br><br>  <b>El comando elimina los recursos de Kubernetes asociados con la versión, pero no la versión en sí</b> .  Toda la información sobre el lanzamiento permanece disponible, incluido su historial: <br><br><pre> <code class="bash hljs">$ helm list --all NAME REVISION UPDATED STATUS CHART APP VERSION NAMESPACE habr 3 Fri Aug 31 15:25:06 2018 DELETED wordpress-2.1.10 4.9.8 default</code> </pre><br><pre> <code class="bash hljs">$ helm <span class="hljs-built_in"><span class="hljs-built_in">history</span></span> habr REVISION UPDATED STATUS CHART DESCRIPTION 1 Fri Aug 31 15:17:57 2018 SUPERSEDED wordpress-2.1.10 Install complete 2 Fri Aug 31 15:21:08 2018 SUPERSEDED wordpress-2.1.10 Upgrade complete 3 Fri Aug 31 15:25:06 2018 DELETED wordpress-2.1.10 Deletion complete</code> </pre><br>  <i><b>Nota</b> : Según lo planeado, la versión remota se puede revertir a versiones anteriores, pero en versiones recientes esta característica no funciona; consulte el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">número 3722 para</a> obtener más detalles.</i> <br><br>  Para eliminar completamente la versión, use la opción <code>--purge</code> : <br><br><pre> <code class="bash hljs">$ helm delete --purge habr release <span class="hljs-string"><span class="hljs-string">"habr"</span></span> deleted</code> </pre><br><h2>  Resumiendo </h2><br>  Este artículo habla sobre la arquitectura básica de Helm 2, sus componentes y sus funciones, así como las primitivas básicas, gráficos, versiones y repositorios de gráficos.  Instalamos Helm en el clúster de Kubernetes y entendimos el ciclo de vida de la versión y los comandos básicos para trabajar con él. <br><br>  El siguiente material de esta serie estará dedicado al tema de <b>crear su propio gráfico</b> : en él hablaré sobre la estructura del gráfico, las herramientas de estandarización y depuración.  <b>ACTUALIZADO</b> : Un nuevo artículo está disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este enlace</a> . <br><br><h2>  PS </h2><br><ul><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Creación de paquetes para Kubernetes con Helm: estructura de gráficos y plantillas</a> "; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Administrador de paquetes para Kubernetes - Helm: pasado, presente, futuro</a> "; </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Practica con dapp.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2. Despliegue de imágenes Docker en Kubernetes usando Helm</a> "; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Crear e instalar aplicaciones en Kubernetes utilizando dapp y GitLab CI</a> "; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mejores prácticas de CI / CD con Kubernetes y GitLab</a> " <i>(revisión y video informe)</i> . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es420437/">https://habr.com/ru/post/es420437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es420425/index.html">Teoría y práctica del uso de HBase</a></li>
<li><a href="../es420429/index.html">USE, RED, PgBouncer, su configuración y monitoreo</a></li>
<li><a href="../es420431/index.html">Marte Guía práctica de terraformación para amas de casa</a></li>
<li><a href="../es420433/index.html">"Formato del viernes": caminos musicales: qué es y por qué no están en Rusia</a></li>
<li><a href="../es420435/index.html">Inicio rápido con ARM Mbed: desarrollo en microcontroladores modernos para principiantes</a></li>
<li><a href="../es420439/index.html">Fintech digest: las inversiones en fintech alcanzaron los $ 57 mil millones, la velocidad de transacción está creciendo y el costo está cayendo</a></li>
<li><a href="../es420441/index.html">Los 10 errores de seguridad más comunes en Python y cómo evitarlos</a></li>
<li><a href="../es420443/index.html">Los expertos en ciberseguridad han creado un detector de skimmer - SkimReaper</a></li>
<li><a href="../es420447/index.html">Computer History Museum: el lugar donde se registra la TI</a></li>
<li><a href="../es420451/index.html">Servidor en las nubes: preparándose para lanzar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>