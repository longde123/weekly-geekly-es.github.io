<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï∂Ô∏è üöÑ üë©üèæ‚Äçüíª Por que monitorar sistemas de armazenamento? ‚Ü©Ô∏è üë®üèæ‚Äç‚öñÔ∏è üöÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Algu√©m vai cair em breve 

 Porque o SHD armazena o santo dos santos - dados. Se os dados n√£o estiverem mais dispon√≠veis, eles ter√£o um cheiro frito m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Por que monitorar sistemas de armazenamento?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/croc/blog/413247/"><img src="https://habrastorage.org/webt/ph/hp/en/phhpenviwwkomiriz7rmdco7blo.png"><br>  <i>Algu√©m vai cair em breve</i> <br><br>  Porque o SHD armazena o santo dos santos - dados.  Se os dados n√£o estiverem mais dispon√≠veis, eles ter√£o um cheiro frito muito em breve.  Ou se de repente o lugar acabou - tamb√©m √© uma surpresa desagrad√°vel.  Portanto, o monitoramento deve ser obrigat√≥rio e deve abranger os sistemas de armazenamento. <br><br>  Existem duas abordagens principais para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">monitorar o armazenamento</a> .  Use um sistema de monitoramento universal como o Nagios, Icinga, que coletar√° informa√ß√µes via SNMP ou compre software altamente especializado dos fabricantes dos pr√≥prios sistemas de armazenamento.  Obviamente, a segunda op√ß√£o fornece uma an√°lise mais profunda do estado do ferro, mostra coisas espec√≠ficas como o estado do cache, Iops, taxa de acertos, carregamento do controlador etc. Essa √© a op√ß√£o mais frequentemente escolhida pelos nossos clientes, que t√™m matrizes grandes e caras em servi√ßo. . <br><br>  A prop√≥sito, nem tudo √© t√£o tranquilo com o software de monitoramento comercial.  Mais detalhadamente vou contar mais.  Ser√°, por assim dizer, uma experi√™ncia em primeira m√£o.  Ao mesmo tempo, por quase dois anos, eu estava finalizando um desses sistemas para milhares de peda√ßos de papel verde de um fornecedor famoso.  E ele atendeu para que at√© o suporte do fornecedor come√ßasse a me consultar.  Mas alguns problemas de software foram substitu√≠dos por outros, assim como alguns indianos do suporte foram substitu√≠dos por novos indianos - e foi ent√£o que tive a id√©ia, se n√£o agir radicalmente ... Em geral, tudo come√ßou com isso. <br><a name="habracut"></a><br><h3>  O que h√° de errado com o software do fornecedor? </h3><br>  Como eu disse, o monitoramento do fabricante monitora perfeitamente os sistemas de armazenamento do mesmo fabricante.  Esta √© a sua principal vantagem.  As desvantagens crescem a partir daqui: matrizes de outros fabricantes s√£o suportadas de forma limitada ou nenhuma.  Acontece que, se voc√™ tiver v√°rias matrizes diferentes no farm, precisar√° de v√°rias ferramentas de monitoramento diferentes.  Sim, e n√£o se esque√ßa de qual e quando e quando precisar analis√°-lo na pr√≥xima vez.  Idealmente, geralmente pelo administrador para cada matriz. <br><br>  N√£o √© nenhum segredo que as ferramentas dos fabricantes vendem dinheiro e s√£o bastante grandes.  E a extens√£o do suporte tamb√©m custa um centavo.  E alguns fornecedores dominaram um novo foco: anunciam o fim do ciclo de vida de seu software e oferecem simplesmente a compra de outro produto, sem migra√ß√£o de licen√ßas.  Essa configura√ß√£o aconteceu h√° alguns meses com um de nossos clientes.  N√£o h√° op√ß√µes: se voc√™ quiser continuar monitorando o hardware - fa√ßa uma nova compra. <br><br>  Se voc√™ aprofundar o software do fornecedor, outros recursos desagrad√°veis ‚Äã‚Äãser√£o exibidos.  Por exemplo, em v√°rios produtos, voc√™ pode ver a imagem do status atual, mas n√£o pode ver o hist√≥rico do per√≠odo anterior.  Ou a hist√≥ria √© limitada: o log √© reescrito a cada 3 dias.  Simplesmente n√£o h√° necessidade de falar sobre o ac√∫mulo de estat√≠sticas.  E, muitas vezes, o hist√≥rico de eventos √© necess√°rio para previs√µes, por exemplo, a compra de pe√ßas de reposi√ß√£o, para relat√≥rios e para investigar incidentes.  Por exemplo, os freios de algum sistema comercial podem ser acionados no sistema de armazenamento e, se n√£o houver dados reais, n√£o h√° nada a esconder. <br><br>  E, finalmente, n√£o podemos deixar de reclamar da velocidade das atualiza√ß√µes e mudan√ßas no software do fornecedor.  Oh, quantas vezes me deparei com esse problema durante minha longa pr√°tica!  Novos modelos de arrays est√£o saindo, novos firmwares est√£o saindo, novas configura√ß√µes aparecem.  Tudo isso interrompe com facilidade o monitoramento de trabalho: ou algum tipo de informa√ß√£o deixa de ser coletado ou as matrizes geralmente caem.  Em um novo microc√≥digo, um fabricante desativou o suporte para vers√µes antigas do SSL e o software de monitoramento ainda n√£o suportava o protocolo TLS.  E, a princ√≠pio, ningu√©m conseguiu encontrar uma raz√£o.  Ap√≥s minha pr√≥pria investiga√ß√£o, enviei essas entradas para o fabricante, e elas j√° atualizavam as bibliotecas antigas.  No entanto, toda essa burocracia durou indefinidamente. <br><br>  E uma vez que falhamos o piloto no cliente.  Foi proposto o uso de software de fornecedores, e o cliente gostou de tudo em termos de funcionalidade e interface.  Infelizmente, por√©m, seus principais sistemas produtivos n√£o eram suportados.  Eles estavam prontos para esperar um m√™s ou dois, mas o fornecedor disse que n√£o h√° planos para incluir esses sistemas no suporte no futuro pr√≥ximo (e isso foi apenas uma atualiza√ß√£o da linha Hitachi AMS no HUS). <br><br>  Em geral, muitos inconvenientes e, por algum motivo, muito dinheiro. <br><br><h3>  H√° muito tempo eu n√£o peguei damas ... </h3><br>  Frustrado com esse estado de coisas, sempre pensei em como implementar meu pr√≥prio monitoramento de armazenamento.  Se voc√™ conhece bem a matriz e possui sua CLI, poder√° obter rapidamente as informa√ß√µes necess√°rias sobre o estado ou chegar ao fundo dos problemas.  Obviamente, antes disso, √© necess√°rio escavar muitas docas, f√≥runs de fuma√ßa e bases de conhecimento de fornecedores, fragmentando informa√ß√µes diferentes.  Mas quando voc√™ sabe qual comando digitar com qual chave e o que cada coluna de sa√≠da significa, voc√™ j√° √© um guru.  Restou incorporar esse conhecimento em uma interface conveniente, que continuar√° a fazer tudo por voc√™. <br><br>  Admito que a princ√≠pio planejei escrever a interface do zero tamb√©m, mas depois me deparei com o Zabbix - uma ferramenta madura com uma grande comunidade, que tamb√©m √© f√°cil de expandir.  Tinha tudo o que eu precisava: uma interface, um modelo, notifica√ß√µes, um sistema de gatilho, agentes proxy de cliente.  Restava apenas a essa combina√ß√£o fornecer corretamente informa√ß√µes sobre sistemas de armazenamento e valores limite de v√°rios par√¢metros.  O caso come√ßou a ferver.  Temos uma equipe de especialistas em matrizes.  Obviamente, √© imposs√≠vel conhecer todas as matrizes por uma pessoa, por isso estamos divididos por modelo e fabricante. <br><br>  Outra dificuldade no desenvolvimento de seu pr√≥prio monitoramento √© a capacidade de acessar os pr√≥prios peda√ßos de ferro e para que eles ainda n√£o tenham medo de carregar, quebrar e realizar todo tipo de experimento.  Felizmente, os recursos do nosso laborat√≥rio permitiram tudo isso. <br><br>  A primeira coisa a monitorar √© a integridade de todos os componentes de hardware.  Alguma coisa pode ser feita via SNMP, mas na maioria dos casos, essa √© uma pesquisa usando um protocolo especial (SMI-S, API REST, API SOAP e outros).  Devo dizer que as pr√≥prias matrizes permitem configurar notifica√ß√µes sobre falhas nelas.  E todos os clientes usam isso pelo menos.  Mas o que acontece se a notifica√ß√£o em si na matriz quebrar?  Isso aconteceu, e mais de uma vez, quando a matriz ficou em sil√™ncio por semanas e pareceu a todos que tudo estava em ordem, ficou em sil√™ncio.  E, de repente, ficou claro que um n√∫mero cr√≠tico de discos voava nele, mas j√° era tarde demais. <br><br>  O segundo ponto importante a ser monitorado √© o desempenho.  Porque quando uma performance se baseia em um sistema de armazenamento com um atraso de grava√ß√£o de alguns segundos, o Oracle pode simplesmente subir e descer.  N√£o fa√ßo ideia.  √â o desempenho em grandes infraestruturas com muitos sistemas de armazenamento que √© o pior controlado.  E o Zabbix possui uma an√°lise preditiva extremamente conveniente: com base na previs√£o, voc√™ pode definir o valor da m√©trica, que ela se tornar√° no futuro.  Por exemplo, criamos um gatilho que funcionar√° se houver uma previs√£o de que haver√° apenas 3 meses restantes para o descarte atual.  Ou, por exemplo, que o tempo de resposta de acordo com a previs√£o em duas semanas ser√° maior em 50 milissegundos.  O monitoramento nos d√° tempo para aprender sobre os problemas futuros com anteced√™ncia e fazer algo j√°. <br><br>  Em algum momento, percebemos que √© bom saber sobre o estado do armazenamento, √© claro, mas √© muito melhor entender o que mais est√° acontecendo na rede e no lado do servidor.  Como resultado, ap√≥s v√°rios meses de trabalho, tornou-se poss√≠vel ver os servidores, a rede e os sistemas de armazenamento em uma interface.  Apareceram n√£o apenas plug-ins e conectores para armazenamento, mas tamb√©m uma liga√ß√£o √∫til na forma de mapas de topologia de rede.  At√© agora, √© claro, o plug-in leva em considera√ß√£o nossa experi√™ncia e nossas necessidades, mas se voc√™ nos disser o que precisa ver nele, n√≥s o modificaremos. <br><br><img src="https://habrastorage.org/webt/ut/cc/sz/utccszsrlpc89pbcvjqvzo5pr7y.png"><br>  <i>Topologia de ponta a ponta para o cluster VMware: da m√°quina virtual ao volume de armazenamento</i> <br><br><img src="https://habrastorage.org/webt/tu/uv/nm/tuuvnmtm6hn04e1gs4oqtqzebjm.png"><br><img src="https://habrastorage.org/webt/8q/jc/g6/8qjcg65vrycqdrzzrlxbbfsrls8.png"><br>  <i>Desempenho</i> <br><br>  No gr√°fico de desempenho da matriz, vemos que o sistema est√° muito sobrecarregado.  A alta utiliza√ß√£o de grupos de discos indica que os discos est√£o sobrecarregados.  Existem muitas opera√ß√µes de E / S nas portas de armazenamento, o que significa que os sistemas de TI carregam a matriz por sua parte.  Bem, o gr√°fico caracter√≠stico do tempo de resposta, bem como a utiliza√ß√£o de processadores acima dos valores recomendados.  Veredicto - muitas tarefas foram colocadas na matriz; algumas delas precisam ser migradas. <br><br><img src="https://habrastorage.org/webt/5y/rj/_o/5yrj_osycqxzagfoddfq1y9rd5g.png"><br>  <i>Mapa da rede de armazenamento: localizando gargalos</i> <br><br><h3>  Sum√°rio </h3><br>  O que conseguimos?  Equipamos o popular e muito comum sistema de monitoramento Zabbix com novos recursos, incluindo: <br><br><ol><li>  Coleta de informa√ß√µes sobre o status de todo o hardware e componentes l√≥gicos das matrizes e comutadores de disco da rede de armazenamento. </li><li>  Estat√≠sticas de desempenho para absolutamente todos os sistemas para os quais criamos plugins (os fornecedores t√™m lacunas a esse respeito). </li><li>  Mapas topol√≥gicos de uma rede de armazenamento compartilhada e de ponta a ponta de m√°quinas virtuais para volumes em sistemas de armazenamento (at√© agora apenas para VMware). </li><li>  Coleta de todas as informa√ß√µes de invent√°rio. </li><li>  A quantidade de espa√ßo em disco. </li></ol><br>  O pr√≥prio Zabbix permite criar notifica√ß√µes muito legais, definir limites, enviar cartas informativas sobre o problema.  Por exemplo, se a porta do switch cair (ou o tr√°fego na porta ficar muito grande), a mensagem conter√° n√£o apenas o nome do switch com o n√∫mero da porta, mas tamb√©m informa√ß√µes sobre o dispositivo conectado. <br><br>  Quais sistemas n√≥s suportamos atualmente?  Muitos diferentes: <br><br><ol><li>  Todas as matrizes da Hitachi (AMS, HUS, VSP, VSP G). </li><li>  Matrizes Dell-EMC CLARiiON, VNX, Unity, ISILON, Compellent. </li><li>  Matrizes HPE 3PAR, P9500, XP7. </li><li>  Matrizes do IBM Storwize, DS5000. </li><li>  Matrizes NetApp FAS (modo 7, modo c). </li><li>  HPE StoreOnce, bibliotecas de disco do EMC DataDomain. </li><li>  Comutadores de bicho-da-seda Brocade, Cisco MDS. </li></ol><br>  Tamb√©m temos extens√µes para alguns sistemas operacionais (Windows, ESX), com os quais coletamos dados no FC HBA para desenhar mapas topol√≥gicos no futuro.  Desenvolvimento ativo de plugins para OpenStack e sistemas de virtualiza√ß√£o. <br><br>  Ao desenvolver plug-ins, √© levada em considera√ß√£o a experi√™ncia de nossos engenheiros, por tr√°s dos quais existem muitos casos para resolver problemas em matrizes - hardware e desempenho.  Novos plugins s√£o desenvolvidos sob solicita√ß√£o em pouco tempo devido ao grande n√∫mero de bibliotecas prontas. <br><br>  Alguns de nossos clientes configuram o sistema da seguinte forma: notifica√ß√µes com o n√∫mero do contrato, pessoas de contato e todos os par√¢metros do componente defeituoso s√£o automaticamente enviadas para o nosso correio.  Isso reduz o tempo de rea√ß√£o e solicita as pe√ßas de reposi√ß√£o necess√°rias, uma vez que o engenheiro de servi√ßo n√£o precisa chamar e esclarecer muitas informa√ß√µes - mesmo √† noite.  O aplicativo vai imediatamente para o trabalho. <br><br>  Como voc√™ resolve os problemas de monitoramento de sua infraestrutura, em particular de armazenamento?  Conte-nos nos coment√°rios ou na carta ao correio VRyzhevsky@croc.ru </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt413247/">https://habr.com/ru/post/pt413247/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt413237/index.html">O Facebook nega enviar aos fabricantes de dispositivos os mesmos dados que o desenvolvedor Alexander Kogan</a></li>
<li><a href="../pt413239/index.html">Como tornar um smartphone um pouco mais burro</a></li>
<li><a href="../pt413241/index.html">Interceptando fun√ß√µes no kernel do Linux usando o ftrace</a></li>
<li><a href="../pt413243/index.html">School of Data: como combinar matem√°tica e neg√≥cios</a></li>
<li><a href="../pt413245/index.html">No equipamento Dolby Atmos - apenas som "nativo". Dolby pro√≠be upmixing n√£o nativo</a></li>
<li><a href="../pt413249/index.html">Escrevendo um m√≥dulo do kernel Linux: I2C</a></li>
<li><a href="../pt413251/index.html">Rea√ß√£o em cadeia da polimerase e Vladivostok</a></li>
<li><a href="../pt413253/index.html">Richard Hamming: Cap√≠tulo 21. Fibra √ìptica</a></li>
<li><a href="../pt413255/index.html">Richard Hamming: Cap√≠tulo 27. Dados Inv√°lidos</a></li>
<li><a href="../pt413261/index.html">Como a pesquisa funciona</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>