<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👦 🎛️ 🧑🏿‍🤝‍🧑🏽 为Android Q准备应用程序。第1部分 👩🏼‍🤝‍👨🏾 👩🏾‍🔧 🚣🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="本文的翻译是专门为“ Android-developer”课程的学生准备的。 基础课程 。 “ 我们还提醒您，我们将继续注册高级课程“ Specialization Android-developer” 




 我们处于Android开发的第十年（Android Q必须为10.0版）。 根据Be...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>为Android Q准备应用程序。第1部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/463811/">  <i>本文的翻译是专门为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“ Android-developer”</a>课程的学生准备的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">。</a></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">基础课程</a> 。 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“</a></i>  <i>我们还提醒您，我们将继续注册高级课程<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“ Specialization Android-developer”</a></i> <br><br><img src="https://habrastorage.org/webt/e1/nl/7d/e1nl7dhanfo-bzheggvlnlgd3na.png"><br><br><hr><br> 我们处于Android开发的第十年（Android Q必须为10.0版）。 根据Beta 4，Android Q正式具有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">29级API</a> 。 尽管已经存在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Beta 5</a> ，并且有望推出Beta 6，但该API已被标记为最终版本，现在是时候看看Android Q将如何影响应用程序以及需要进行哪些更改才能完全支持AndroidQ。 <a name="habracut"></a><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pt/rl/f8/ptrlf8nhzcgu1_itjsakkiial6m.png"></div><br>  Android Q中显示的重要更改（不是全部）可以分为两类：a） <b>保密性和安全性</b> ，b） <b>用户体验</b> 。 <br><br>  <i>译者的话：“我们将翻译分为与这些类别相对应的两部分。</i>  <i>因此，在第一部分中，我们将讨论隐私和安全性。”</i> <br><br><h3>  1）机密性和安全性 </h3><br><h4>  a）开始后台活动 </h4><br> 当您的应用程序在后台时，您将无法再启动活动。 <br><br><ul><li>  <b>影响因素：</b>所有在Q上运行的应用程序（与目标SDK无关）。 如果Android Q是应用程序的目标版本，则会引发异常；否则，将抛出异常。 如果Android Q不是该应用程序的目标SDK，那么Activity就不会启动，但它可以在装有Android Q的设备上运行。 </li><li> <b>例外：</b>绑定服务，例如可访问性，自动完成等。如果应用程序从系统接收到<code>PendingIntent</code> ，则可以使用它来启动Activity。 如果该应用程序具有<code>SYSTEM_ALERT_WINDOW</code>权限（在Android GO中已删除）或最近为Activity调用<code>finish()</code>的应用程序<code>finish()</code>建议不要依赖它。“最近”可能非常含糊），则您的应用程序不受此限制。 </li><li>  <b>推荐方法：</b>通知触发活动 </li></ul><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> fullScreenIntent = Intent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, CallActivity::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fullScreenPendingIntent</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PendingIntent</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getActivity</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, fullScreenIntent, PendingIntent.FLAG_UPDATE_CURRENT) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> notificationBuilder = NotificationCompat.Builder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, CHANNEL_ID) .... .setPriority(NotificationCompat.PRIORITY_HIGH) .setCategory(NotificationCompat.CATEGORY_CALL) .setFullScreenIntent(fullScreenPendingIntent, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre> <br> 将<code>Fullscreen PendingIntent</code>添加到通知中。 通知已生效，系统将启动全屏Intent。 <br><br> 因此，如果我们要从后台启动Activity，请首先创建一个通知，该通知将显示给用户。 在此通知中，添加<code>Fullscreen PendingIntent</code> 。 另外，将<code>USE_FULL_SCREEN_INTENT</code>权限添加到清单中。 通知已生效，系统将启动全屏Intent。 <br><br><ul><li>  <b>陷阱：</b>系统决定何时显示通知以及何时显示活动。 如果用户正在使用设备，则会显示一个弹出通知。 如果设备处于静止状态或当用户与通知交互时，将启动全屏活动。 例如，如接听电话时（使用电话时弹出通知，否则全屏活动）。 </li></ul><br><h4>  b）硬件标识符 </h4><br>  Android Q已撤消了对不可重置的设备标识符的访问。 <br><br><ul><li>  <b>影响因素：</b>所有在Q上运行的应用程序（与目标SDK无关）。 如果Q是目标SDK，则抛出异常。 如果目标SDK小于Q，则返回<code>null</code> </li><li>  <b>避免：</b> Mac地址现在是随机的，并且IMEI（ <code>TelephonyManager.getDeviceId()</code> ）和序列号不再可用。 现在，它们是“特权权限”，并且仅可用于操作员应用程序。 </li><li>  <b>推荐的方法：</b>使用可重置的标识符，例如广告ID，实例ID或全局唯一ID（GUID）。 有关在这种情况下使用哪个标识符的更多信息，请参见<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">唯一标识符的最佳做法</a> 。 </li></ul><br><h4>  c）位置的背景定义 </h4><br> 从Android Q开始，系统将区分在前台和后台发出的位置请求。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2-/tq/rk/2-tqrkkbbpp73pbwyr2izasqoxm.png"></div><br> 现在，访问该位置的权限请求将具有3个选项：始终允许，仅在使用该应用程序时允许（仅在前台访问）和拒绝（没有访问权）。 <br><br><ul><li>  <b>它会影响什么：</b>它取决于目标SDK。 如果Q是应用程序的目标SDK，则需要在后台请求新的位置许可。 如果应用程序具有其他目标SDK，则如果它已经对该位置具有访问权限，它将自动获得此权限。 </li></ul><br><img src="https://habrastorage.org/webt/xv/9u/pi/xv9upiapzwlxh1ecfmr1t_ewvj8.png"><br>  <i>图片取自Android开发者文档</i> <br><br><ul><li>  <b>推荐的方法：</b>如果应用程序需要一次性访问用户的位置来执行某些任务，请使用前台服务，并将前台服务类型参数指定为应用程序清单文件中的<code>location</code> 。 </li></ul><br><pre> <code class="kotlin hljs">&lt;service android:name=<span class="hljs-string"><span class="hljs-string">"MyNavigationService"</span></span> android:foregroundServiceType=<span class="hljs-string"><span class="hljs-string">"location"</span></span> ... /&gt;</code> </pre> <br> 如果应用程序需要不断访问设备的位置，例如地理围栏，它可以配置一个请求以允许在后台访问该位置。 该应用程序的其他方面（例如，如何提取和使用位置）无需更改。 要请求访问后台位置，请向清单添加<code>ACCESS_BACKGROUND_LOCATION</code>权限： <br><br><pre> <code class="kotlin hljs">&lt;manifest&gt; &lt;uses-permission android:name=<span class="hljs-string"><span class="hljs-string">"android.permission.ACCESS_COARSE_LOCATION"</span></span> /&gt; &lt;uses-permission android:name=<span class="hljs-string"><span class="hljs-string">"android.permission.ACCESS_BACKGROUND_LOCATION"</span></span> /&gt; &lt;/manifest&gt; <span class="hljs-comment"><span class="hljs-comment">//Request for the permission like any other permission request: ActivityCompat.requestPermissions(this, arrayOf(Manifest.permission.ACCESS_COARSE_LOCATION, Manifest.permission.ACCESS_BACKGROUND_LOCATION), your-permission-request-code)</span></span></code> </pre> <br> 在后台请求位置访问 <br><br><ul><li> 陷阱： </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_1/q3/zi/_1q3zi9aherji3wi542vkyb6igu.png"></div><br>  <i>系统显示的有关在后台访问位置的提醒</i> <br><br> 需要牢记的一些重要事项：在为应用程序授予其在后台访问设备位置的权限后，可以提醒用户，并且像其他任何权限一样，用户可以撤消该权限。 对于其中Q不是目标SDK但在具有Android Q的设备上运行的应用程序来说，这尤其重要，因为如果具有位置许可，它将获得默认的背景分辨率。 确保您的应用程序可以正常处理此类脚本。 因此，无论何时应用程序启动服务或请求位置，请检查用户是否仍允许应用程序访问位置信息。 <br><br> 至此，本文的第一部分结束了，正如所承诺的，我们将在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第二部分中</a>讨论用户体验。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN463811/">https://habr.com/ru/post/zh-CN463811/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN463795/index.html">英语中的含义阴影：如何使用动词“建议”，“推荐”，“建议”</a></li>
<li><a href="../zh-CN463799/index.html">我对Windows 10不满意的地方</a></li>
<li><a href="../zh-CN463801/index.html">成功的产品经理的三项关键素质：Anton Stozhko</a></li>
<li><a href="../zh-CN463803/index.html">我与Haiku的第五天：让我们移植一些程序</a></li>
<li><a href="../zh-CN463805/index.html">想要成为游戏设计师的七本书</a></li>
<li><a href="../zh-CN463813/index.html">Mikrotik RouterOS上的多厢货车和路由</a></li>
<li><a href="../zh-CN463815/index.html">为什么外国银行对您的资金来源感兴趣？</a></li>
<li><a href="../zh-CN463817/index.html">20位产品经理和所有最多的多维矩阵结构。 与Skyeng的对话</a></li>
<li><a href="../zh-CN463819/index.html">PostgreSQL锁：2.字符串锁</a></li>
<li><a href="../zh-CN463821/index.html">AMO，Bitrix，1C等：如何选择从哪里开始？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>