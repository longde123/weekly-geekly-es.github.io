<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ß üñêüèª üåæ JVM-Speicherzuordnung üö¥ üç∂ üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! Wir m√∂chten die √úbersetzung des heutigen Materials mit dem Start eines neuen Threads im Java Developer- Kurs zusammenfallen lassen, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>JVM-Speicherzuordnung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/445312/"> Hallo allerseits!  Wir m√∂chten die √úbersetzung des heutigen Materials mit dem Start eines neuen Threads im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Java Developer-</a> Kurs zusammenfallen lassen, der morgen beginnt.  Nun, fangen wir an. <br><br>  JVM kann ein komplexes Tier sein.  Gl√ºcklicherweise verbirgt sich der gr√∂√üte Teil dieser Komplexit√§t unter der Haube, und wir als Anwendungsentwickler und Verantwortlicher f√ºr die Bereitstellung m√ºssen uns h√§ufig keine gro√üen Sorgen machen.  Aufgrund der wachsenden Beliebtheit der Technologie f√ºr die Bereitstellung von Anwendungen in Containern lohnt es sich jedoch, auf die Speicherzuweisung in der JVM zu achten. <br><br><img src="https://habrastorage.org/webt/ju/oj/ek/juojekjvyfc9pflhqawoxksp-pe.png"><br><br>  <b>Zwei Arten von Erinnerungen</b> <br><br>  Die JVM unterteilt den Speicher in zwei Hauptkategorien: Heap und Nicht-Heap.  Ein Heap ist ein Teil des JVM-Speichers, mit dem Entwickler am besten vertraut sind.  Hier werden die von der Anwendung erstellten Objekte gespeichert.  Sie bleiben dort, bis sie vom M√ºllsammler entfernt werden.  In der Regel h√§ngt die von der Anwendung verwendete Heap-Gr√∂√üe von der aktuellen Last ab. <br><a name="habracut"></a><br>  Der Speicher au√üerhalb des Heapspeichers ist in mehrere Bereiche unterteilt.  In HotSpot k√∂nnen Sie den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NMT-</a> Mechanismus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">(Native Memory Tracking)</a> verwenden, um die Bereiche dieses Speichers zu erkunden.  Beachten Sie, dass NMT zwar nicht die Verwendung des gesamten nativen Speichers verfolgt ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">z. B. nicht die Zuweisung des nativen Speichers durch Code von Drittanbietern</a> ), seine Funktionen jedoch f√ºr die meisten typischen Spring-Anwendungen ausreichen.  Um NMT zu verwenden, f√ºhren Sie die Anwendung mit der <code>-XX:NativeMemoryTracking=summary</code> and using <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">jcmd VM.native_memory Zusammenfassung siehe Informationen zum verwendeten Speicher.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><br><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schauen wir uns NMT als Beispiel unserer alten Freundin Petclinic an</a> .  Das folgende Diagramm zeigt die Verwendung des JVM-Speichers gem√§√ü NMT-Daten (abz√ºglich des eigenen NMT-Overheads) beim Starten von Petclinic mit einer maximalen Heap-Gr√∂√üe von 48 MB ( <code>-Xmx48M</code> ): <br><br><img src="https://habrastorage.org/webt/m8/nk/be/m8nkberjczog7bolri8lwoglbbm.png"><br><br>  Wie Sie sehen k√∂nnen, macht der Speicher au√üerhalb des Heaps den gr√∂√üten Teil des verwendeten JVM-Speichers aus, und der Heap-Speicher macht nur ein Sechstel der Gesamtmenge aus.  In diesem Fall sind es ungef√§hr 44 MB (von denen 33 MB unmittelbar nach der Speicherbereinigung verwendet wurden).  Die Auslastung des Heapspeichers betrug 223 MB. <br><br>  <b>Bereiche des nativen Ged√§chtnisses</b> <br><br>  <b>Komprimierter Klassenraum</b> : Dient zum Speichern von Informationen zu geladenen Klassen.  Beschr√§nkt auf den Parameter <code>MaxMetaspaceSize</code> .  Eine Funktion der Anzahl der geladenen Klassen. <br><br>  <i>Anmerkung des √úbersetzers</i> <br><br><blockquote>  Aus irgendeinem Grund schreibt der Autor √ºber den komprimierten Klassenraum und nicht √ºber den gesamten Klassenbereich.  Der komprimierte Klassenbereich ist Teil des Klassenbereichs, und der Parameter <code>MaxMetaspaceSize</code> begrenzt die Gr√∂√üe des gesamten Klassenbereichs, nicht nur des komprimierten Klassenbereichs.  Um den "komprimierten Klassenraum" einzuschr√§nken, wird der Parameter <code>CompressedClassSpaceSize</code> verwendet. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Von hier aus</a> : <br>  Wenn <code>UseCompressedOops</code> ist und <code>UseCompressedClassesPointers</code> verwendet wird, werden zwei logisch unterschiedliche Bereiche des nativen Speichers f√ºr Klassenmetadaten verwendet ... <br>  F√ºr diese komprimierten Klassenzeiger (die 32-Bit-Offsets) wird eine Region zugewiesen.  Die Gr√∂√üe der Region kann mit <code>CompressedClassSpaceSize</code> und betr√§gt standardm√§√üig 1 Gigabyte (GB) ... <br>  Die <code>MaxMetaspaceSize</code> gilt f√ºr die Summe des festgeschriebenen komprimierten Klassenraums und des Raums f√ºr die anderen Klassenmetadaten <br><br>  Wenn der Parameter <code>UseCompressedOops</code> und <code>UseCompressedOops</code> verwendet wird, werden zwei logisch unterschiedliche Bereiche des nativen Speichers f√ºr Klassenmetadaten verwendet ... <br><br>  F√ºr komprimierte Zeiger wird ein Speicherbereich zugewiesen (32-Bit-Offsets).  Die Gr√∂√üe dieses Bereichs kann mit <code>CompressedClassSpaceSize</code> und betr√§gt standardm√§√üig 1 GB ... <br>  Der Parameter <code>MaxMetaspaceSize</code> bezieht sich auf die Summe des komprimierten Zeigerbereichs und des Bereichs f√ºr andere Klassenmetadaten. </blockquote><br><br><ul><li>  Thread: Der von Threads in der JVM verwendete Speicher.  Die Funktion der Anzahl der laufenden Threads. </li><li>  Code-Cache: Der von JIT zum Ausf√ºhren verwendete Speicher.  Eine Funktion der Anzahl der geladenen Klassen.  Beschr√§nkt auf <code>ReservedCodeCacheSize</code> .  Sie k√∂nnen die Einstellung von JIT reduzieren, indem Sie beispielsweise die gestufte Kompilierung deaktivieren. </li><li>  GC (Garbage Collector): Speichert die vom Garbage Collector verwendeten Daten.  H√§ngt vom verwendeten Garbage Collector ab. </li><li>  Symbol: Speichert Zeichen wie Feldnamen, Methodensignaturen und internierte Zeichenfolgen.  Eine √ºberm√§√üige Verwendung des Zeichenspeichers kann darauf hinweisen, dass die Zeilen zu intern sind. </li><li>  Intern: Speichert andere interne Daten, die in keinem der anderen Bereiche enthalten sind. </li></ul><br>  <b>Unterschiede</b> <br><br>  Im Vergleich zu einem Heap √§ndert sich der Off-Heap-Speicher unter Last weniger.  Sobald die Anwendung alle Klassen l√§dt, die verwendet werden, und die JIT vollst√§ndig aufgew√§rmt ist, wird alles in einen stabilen Zustand versetzt.  Um eine Verringerung der Verwendung des <i>komprimierten Klassenbereichs festzustellen</i> , muss der Klassenladeprogramm, das die Klassen geladen hat, vom Garbage Collector entfernt werden.  Dies war in der Vergangenheit √ºblich, als Anwendungen in Servlet-Containern oder Anwendungsservern bereitgestellt wurden (der Anwendungsklassenlader wurde vom Garbage Collector entfernt, als die Anwendung vom Anwendungsserver entfernt wurde), dies ist jedoch bei modernen Ans√§tzen zur Anwendungsbereitstellung selten der Fall. <br><br>  <b>Konfigurieren Sie JVM</b> <br><br>  Die Konfiguration der JVM zur effizienten Nutzung des verf√ºgbaren Arbeitsspeichers ist nicht einfach.  Wenn Sie die JVM mit dem Parameter <code>-Xmx16M</code> und erwarten, dass nicht mehr als 16 MB Arbeitsspeicher verwendet werden, erhalten Sie eine unangenehme √úberraschung. <br><br>  Ein interessanter Bereich des JVM-Speichers ist der JIT-Code-Cache.  Standardm√§√üig verwendet HotSpot JVM bis zu 240 MB.  Wenn der Code-Cache zu klein ist, verf√ºgt die JIT m√∂glicherweise nicht √ºber gen√ºgend Speicherplatz zum Speichern ihrer Daten. Infolgedessen wird die Leistung verringert.  Wenn der Cache zu gro√ü ist, wird m√∂glicherweise der Speicher verschwendet.  Bei der Bestimmung der Gr√∂√üe eines Caches ist es wichtig, die Auswirkungen auf die Speichernutzung und die Leistung zu ber√ºcksichtigen. <br><br>  Wenn Sie in einem Docker-Container ausgef√ºhrt werden, kennen die neuesten Versionen von Java <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">jetzt</a> die Speicherbeschr√§nkungen des Containers und versuchen, die Gr√∂√üe der JVM entsprechend zu √§ndern.  Leider wird h√§ufig viel Speicher au√üerhalb des Heaps zugewiesen und nicht genug im Heap.  Angenommen, Sie haben eine Anwendung in einem Container mit 2 Prozessoren und 512 MB verf√ºgbarem Speicher.  Sie m√∂chten mehr Workload bew√§ltigen und die Anzahl der Prozessoren auf 4 und den Speicher auf 1 GB erh√∂hen.  Wie oben erl√§utert, variiert die Gr√∂√üe des Heapspeichers normalerweise mit der Last, und der Speicher au√üerhalb des Heapspeichers √§ndert sich erheblich weniger.  Daher erwarten wir, dass der gr√∂√üte Teil der zus√§tzlichen 512 MB dem Heap zugewiesen wird, um die erh√∂hte Last zu bew√§ltigen.  Leider wird die JVM dies standardm√§√üig nicht tun und zus√§tzlichen Speicher mehr oder weniger gleichm√§√üig zwischen dem Speicher auf dem Heap und au√üerhalb des Heaps verteilen. <br><br>  Gl√ºcklicherweise verf√ºgt das CloudFoundry-Team √ºber umfassende Kenntnisse zur Speicherzuweisung in der JVM.  Wenn Sie Anwendungen auf CloudFoundry herunterladen, wendet das Build Pack dieses Wissen automatisch auf Sie an.  Wenn Sie CloudFoudry nicht verwenden oder mehr √ºber die Konfiguration von JVM erfahren m√∂chten, wird empfohlen, die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beschreibung der</a> dritten Version des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Speicherrechners</a> von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Java Buildpack</a> zu lesen. <br><br>  <b>Was bedeutet das f√ºr den Fr√ºhling?</b> <br><br>  Das Spring-Team verbringt viel Zeit damit, √ºber Leistung und Speichernutzung nachzudenken, und erw√§gt die M√∂glichkeit, Speicher sowohl auf dem Heap als auch au√üerhalb des Heaps zu verwenden.  Eine M√∂glichkeit, die Speichernutzung au√üerhalb des Heapspeichers zu begrenzen, besteht darin, Teile des Frameworks so vielseitig wie m√∂glich zu gestalten.  Ein Beispiel hierf√ºr ist die Verwendung von Reflection, um Abh√§ngigkeiten zu erstellen und in die Beans Ihrer Anwendung einzuf√ºgen.  Durch die Verwendung von Reflection bleibt die Menge des von Ihnen verwendeten Framework-Codes unabh√§ngig von der Anzahl der Beans in Ihrer Anwendung konstant.  Um die Startzeit zu optimieren, verwenden wir den Cache auf dem Heap und l√∂schen diesen Cache nach Abschluss des Starts.  Der Heap-Speicher kann vom Garbage Collector problemlos bereinigt werden, um Ihrer Anwendung mehr verf√ºgbaren Speicher zur Verf√ºgung zu stellen. <br><br>  Traditionell warten wir auf Ihre Kommentare zum Material. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de445312/">https://habr.com/ru/post/de445312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de445300/index.html">Nachrichten aus der Spielebranche (11.-25. M√§rz 2019)</a></li>
<li><a href="../de445302/index.html">"Game of Thrones, mach weiter." Was Apple heute bei seinem Show Time Event gezeigt hat</a></li>
<li><a href="../de445304/index.html">Programmieren von LibreOffice Base. Teil 2</a></li>
<li><a href="../de445308/index.html">Merkmale des Hypothesentests f√ºr mobile Anwendungen</a></li>
<li><a href="../de445310/index.html">Der Preis f√ºr Sovereign Runet stieg auf 30 Milliarden Pfund</a></li>
<li><a href="../de445314/index.html">Warum ist es schwierig, Asteroiden abzubauen?</a></li>
<li><a href="../de445316/index.html">DevDay IT verwalten. Leistungsaufzeichnung</a></li>
<li><a href="../de445318/index.html">Trap (Tarp) f√ºr eingehende SSH-Verbindungen</a></li>
<li><a href="../de445320/index.html">Scheiben rollen und rollen</a></li>
<li><a href="../de445322/index.html">Gro√üe Auswahl n√ºtzlicher Ressourcen f√ºr Produktmanager</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>