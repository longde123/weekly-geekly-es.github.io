<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∂üèæ üòÇ üîô ArduPilot para principiantes. Instalar y configurar en BeagleBone Blue üéí üëéüèæ üíπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Con un equipo (al que puedes unirte ) de personas con ideas afines de Habr, estamos desarrollando un robot para recoger pelotas de golf en el campo de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ArduPilot para principiantes. Instalar y configurar en BeagleBone Blue</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/robogazon/blog/429510/"> Con un equipo (al <b>que puedes unirte</b> ) de personas con ideas afines de Habr, estamos desarrollando un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">robot para recoger pelotas de golf en el campo de pr√°cticas</a> .  Este es un robot de servicio altamente especializado, por lo tanto, planeamos desarrollar simult√°neamente un √∫nico complejo de software y hardware, que luego podr√≠a usarse como base para otros robots de servicio y <b>UGV</b> . <br><br><img src="https://habrastorage.org/webt/3x/wy/of/3xwyof39bhwkwbvvqoyjqmxdmay.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">En la √∫ltima publicaci√≥n,</a> describimos por qu√© nos detuvimos en este software.  Al configurar nuestro proyecto, utilizamos la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informaci√≥n del art√≠culo</a> .  En realidad, aqu√≠ presentamos la traducci√≥n de esta breve gu√≠a, tal vez para alguien le sea √∫til y lo ayude a hacer su primer o pr√≥ximo robot. <br><a name="habracut"></a><br>  Antes de comenzar, quiero enfatizar que vale la pena usar BeagleBone Blue (todav√≠a es azul).  Como regla general, conectaremos bastantes dispositivos perif√©ricos relacionados con la navegaci√≥n, y no funcionar√°n correctamente sin suficiente energ√≠a. <br><br><h2>  Parte 1. Preparando el BeagleBone </h2><br>  Vaya a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://rcn-ee.net/rootfs/bb.org/testing/</a> y seleccione el directorio con la √∫ltima fecha.  Luego abra el subdirectorio de la <b>consola de estiramiento</b> .  Aqu√≠ ver√°s varios archivos.  Descargue un archivo llamado Something like <b>'bone-debian-VV-console-armhf-20YY-MM-DD-1gb.img.xz'</b> .  Esta es una distribuci√≥n m√≠nima de Debian que contiene solo lo esencial.  Una alternativa es la imagen IoT (IoT = Internet of Things), que viene con un software adicional y puede hacer que el trabajo sea m√°s c√≥modo si eres nuevo en Linux.  Est√° disponible desde el mismo sitio. <br><br>  Usamos: <a href="">https://rcn-ee.net/rootfs/bb.org/testing/2018-10-07/stretch-console/bone-debian-9.5-console-armhf-2018-10-07-1gb.img .xz</a> . <br><br>  A continuaci√≥n, deber√° actualizar la imagen en la tarjeta microSD.  Ya sea que use Linux o Windows, le recomiendo un programa llamado Etcher para esta tarea ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://etcher.io/</a> ). <br><br>  Ahora puede descargar BeagleBone Blue desde la tarjeta microSD.  Esto est√° m√°s all√° del alcance de este documento para describir en detalle todos los m√©todos de interacci√≥n, pero a menudo esto se logra mediante la conexi√≥n a trav√©s de un cable micro-USB o mediante SSH (a 'debian@192.168.7.2', contrase√±a 'temppwd') o a trav√©s del puerto COM ( Usuario de Debian ', contrase√±a' temppwd) en un programa como minicom o PuTTY.  Esta conexi√≥n a la consola de Linux a trav√©s del puerto COM.  UART1 en las compilaciones BBB siempre est√° vinculado a la consola, primero U-boot y luego Linux.  Puede encontrar m√°s informaci√≥n aqu√≠: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://beagleboard.org/blue</a> <br><br>  Los controladores BeagleBone vienen con Windows 10. En Linux, BBB como puerto USB universal COM no puede ser recogido.  Si tiene problemas, intente: <br><br><pre><code class="bash hljs">sudo -s cat &gt;/etc/udev/rules.d/73-beaglebone.rules &lt;&lt;EOF ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"usb"</span></span>, ENV{DEVTYPE}==<span class="hljs-string"><span class="hljs-string">"usb_interface"</span></span>, ATTRS{idVendor}==<span class="hljs-string"><span class="hljs-string">"0403"</span></span>, ATTRS{idProduct}==<span class="hljs-string"><span class="hljs-string">"a6d0"</span></span>, DRIVER==<span class="hljs-string"><span class="hljs-string">""</span></span>, RUN+=<span class="hljs-string"><span class="hljs-string">"/sbin/modprobe -b ftdi_sio"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"drivers"</span></span>, ENV{DEVPATH}==<span class="hljs-string"><span class="hljs-string">"/bus/usb-serial/drivers/ftdi_sio"</span></span>, ATTR{new_id}=<span class="hljs-string"><span class="hljs-string">"0403 a6d0"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, KERNEL==<span class="hljs-string"><span class="hljs-string">"ttyUSB*"</span></span>, ATTRS{interface}==<span class="hljs-string"><span class="hljs-string">"BeagleBone"</span></span>, ATTRS{bInterfaceNumber}==<span class="hljs-string"><span class="hljs-string">"00"</span></span>, SYMLINK+=<span class="hljs-string"><span class="hljs-string">"beaglebone-jtag"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, KERNEL==<span class="hljs-string"><span class="hljs-string">"ttyUSB*"</span></span>, ATTRS{interface}==<span class="hljs-string"><span class="hljs-string">"BeagleBone"</span></span>, ATTRS{bInterfaceNumber}==<span class="hljs-string"><span class="hljs-string">"01"</span></span>, SYMLINK+=<span class="hljs-string"><span class="hljs-string">"beaglebone-serial"</span></span> EOF udevadm control --reload-rules <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br>  Espero que ahora hayas iniciado sesi√≥n en la l√≠nea de comando.  Comenzaremos permitiendo que el usuario de Debian ejecute sudo sin tener que ingresar una contrase√±a cada vez (posterior): <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"debian ALL=(ALL) NOPASSWD: ALL"</span></span> | sudo tee -a /etc/sudoers.d/debian &gt;/dev/null</code> </pre><br>  El siguiente trabajo es actualizar e instalar el software utilizando una conexi√≥n a Internet asequible, por lo que es hora de configurar connman para el acceso a Wi-Fi.  Hago esto porque facilitar√° el trabajo en el futuro.  Primero, escriba el SSID y la contrase√±a de WiFi de su enrutador.  Luego ingrese lo siguiente: <br><br><pre> <code class="bash hljs"> sudo -s connmanctl services | grep <span class="hljs-string"><span class="hljs-string">'&lt;your SSID&gt;'</span></span> | grep -Po <span class="hljs-string"><span class="hljs-string">'wifi_[^ ]+'</span></span></code> </pre><br>  La respuesta se ver√° as√≠: 'wifi_38d279e099a8_4254487562142d4355434b_managed_psk'.  Si no ve nada, int√©ntelo de nuevo, probablemente cometi√≥ un error tipogr√°fico. <br><br>  Ahora, usando esta ID de red, vamos a ingresar el archivo directamente desde el teclado (stdin) usando cat, una l√≠nea a la vez: <br><br><pre> <code class="bash hljs"> cat &gt;/var/lib/connman/wifi.config [service_&lt;your <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>&gt;] Type = wifi Security = wpa2 Name = &lt;your SSID&gt; Passphrase = &lt;your WiFi password&gt;</code> </pre><br>  Importante!  Antes de Ctrl + C, aseg√∫rese de presionar Enter, de lo contrario se perder√° toda la l√≠nea actual. <br>  Presione Ctrl-C para salir y luego escriba: salir <br><br>  El LED verde visible se encender√°, lo que significa que el Wi-Fi est√° encendido.  BBBlue est√° conectado al enrutador y su direcci√≥n IP en su red Wi-Fi se puede encontrar usando: <br><br><pre> <code class="bash hljs">ip addr show wlan0</code> </pre><br>  Si por alguna raz√≥n no puede solicitar BBBlue directamente, use otras utilidades como nmap (sudo nmap 192.168.0.0/24) o inicie sesi√≥n en su enrutador y busque otras direcciones para encontrar su direcci√≥n IP. <br><br>  Ahora intente conectarse a trav√©s de SSH utilizando su direcci√≥n IP de Wi-Fi.  Recuerde que 192.168.7.2 tambi√©n funcionar√°. <br><br>  Si no puede hacer que WiFi funcione con connman, o simplemente no quiere usar connman, puede usar el siguiente m√©todo.  Primero, escriba: sudo systemctl disable connman.  Luego, con su SSID y contrase√±a de WiFi, edite / etc / network / interfaces <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># The loopback network interface. auto lo iface lo inet loopback # WiFi w/ onboard device (dynamic IP). auto wlan0 iface wlan0 inet dhcp wpa-ssid "&lt;your SSID&gt;" wpa-psk "&lt;your WiFi password&gt;" dns-nameservers 8.8.8.8 1.1.1.1 # Ethernet/RNDIS gadget (g_ether). # Used by: /opt/scripts/boot/autoconfigure_usb0.sh iface usb0 inet static address 192.168.7.2 netmask 255.255.255.252 network 192.168.7.0 gateway 192.168.7.1</span></span></code> </pre><br>  Ahora vuelva a cargar BBBlue con: <b>sudo reboot</b> <br><br>  Despu√©s de iniciar sesi√≥n, escriba: sudo ifup wlan0.  El LED verde deber√≠a encenderse. <br><br>  Si desea que la BB tenga una IP est√°tica (por ejemplo, 192.168.0.99), cambie la secci√≥n "# WiFi con dispositivo integrado (IP din√°mica)". Secci√≥n / etc / network / interfaces para leer: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># WiFi w/ onboard device (static IP). auto wlan0 iface wlan0 inet static wpa-ssid "&lt;your SSID&gt;" wpa-psk "&lt;your WiFi password&gt;" address 192.168.0.99 # &lt;--- The desired static IP address of the BBBlue. netmask 255.255.255.0 gateway 192.168.0.1 # &lt;--- The address of your router. dns-nameservers 8.8.8.8 1.1.1.1</span></span></code> </pre><br>  Actualizaci√≥n e instalaci√≥n de todos los programas de soporte necesarios: <br><br><pre> <code class="bash hljs">sudo apt-get -y update sudo apt-get -y dist-upgrade sudo apt-get install -y cpufrequtils git</code> </pre><br>  Actualizar scripts: cd / opt / scripts &amp; &amp; git pull <br><br>  <b>¬°El kernel en tiempo real actualmente contiene errores!</b>  <b>Use la siguiente soluci√≥n: Especifique el kernel en tiempo real de Ti 4_4.</b>  <b>No use 4_14.</b> <br><br><pre> <code class="bash hljs">sudo /opt/scripts/tools/update_kernel.sh --ti-rt-channel --lts-4_4 sudo sed -i <span class="hljs-string"><span class="hljs-string">'s|uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-14-TI-00A0.dtbo|#uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-14-TI-00A0.dtbo|g'</span></span> /boot/uEnv.txt sudo sed -i <span class="hljs-string"><span class="hljs-string">'s|#uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-4-TI-00A0.dtbo|uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-4-TI-00A0.dtbo|g'</span></span> /boot/uEnv.txt</code> </pre><br>  Finalmente, copie am335x-bone blue.dtb (del directorio bin en este repositorio) a /boot/dtbs/4.4.113-ti-rt-r149 <br><br>  Instale el script en la ejecuci√≥n autom√°tica <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/#dtb=/dtb=am335x-boneblue.dtb/g'</span></span> /boot/uEnv.txt</code> </pre><br>  Establecer frecuencia <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/GOVERNOR="ondemand"/GOVERNOR="performance"/g'</span></span> /etc/init.d/cpufrequtils</code> </pre><br>  Configuraci√≥n de bb-wl18xx-wlan0.service <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/RestartSec=5/RestartSec=1/g'</span></span> /lib/systemd/system/bb-wl18xx-wlan0.service</code> </pre><br>  Configuraci√≥n de bb-wl18xx-wlan0.service <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/RestartSec=5/RestartSec=1/g'</span></span> /lib/systemd/system/bb-wl18xx-wlan0.service</code> </pre><br>  Deshabilitar Bluetooth (opcional) <br><br><pre> <code class="bash hljs">sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> bb-wl18xx-bluetooth.service</code> </pre><br>  Expanda la partici√≥n de la tarjeta microSD existente (/ dev / mmcblk0p1): <br><br><pre> <code class="bash hljs">sudo /opt/scripts/tools/grow_partition.sh</code> </pre><br>  Reiniciar ahora: <br><br><pre> <code class="bash hljs">sudo reboot</code> </pre><br><h2>  Parte 2. Instale ArduPilot en un BeagleBone </h2><br>  Cuando se reinicia el BeagleBone, necesitamos crear algunos archivos de texto.  Primero, mejorando el archivo de configuraci√≥n del entorno, / etc / default / ardupilot: <br>  <i>(Sugerencia: ingrese sudoedit / etc / default / ardupilot e inserte su propia direcci√≥n IP de destino, por ejemplo 192.168.0.13)</i> <br><br><pre> <code class="bash hljs">TELEM1=<span class="hljs-string"><span class="hljs-string">"-C /dev/ttyO1"</span></span> TELEM2=<span class="hljs-string"><span class="hljs-string">"-A udp:&lt;target IP address&gt;:14550"</span></span> GPS=<span class="hljs-string"><span class="hljs-string">"-B /dev/ttyS2"</span></span></code> </pre><br>  Esta es una configuraci√≥n bastante t√≠pica. <br><br>  Este es el par√°metro de lanzamiento -C asigna el puerto serie "Telem1" de ArduPilot (SERIAL1, predeterminado 57600) para UART1 en BBBlue.  Por ejemplo, tengo una radio 868x RFDesign conectada a UART1.  Este es un canal de datos bidireccional con mi dron.  Env√≠a varios datos de telemetr√≠a a la estaci√≥n base y recibe comandos RTK y correcciones diferenciales de la estaci√≥n base. <br><br>  Este es el par√°metro de lanzamiento -A asigna el puerto serie de "Consola" de ArduPilot (SERIAL0, predeterminado 115200) con protocolo, direcci√≥n IP de destino y n√∫mero de puerto opcional.  Por ejemplo, esto me permite recibir datos de MAVLink que llegan a trav√©s de Wi-Fi para fines de prueba.  Realmente √∫til, especialmente porque los datos pueden ir inmediatamente a Mission Planner y QGroundControl. <br><br><img src="https://habrastorage.org/webt/3d/d7/m1/3dd7m1ilxlbkd3elqxnddq_1rcm.jpeg" alt="imagen"><br><br>  Este es el par√°metro de lanzamiento -B asigna el puerto serie ‚ÄúGPS‚Äù de ArduPilot (SERIAL3, predeterminado 57600) con Uart2 BBBlue (UART, vagamente marcado como 'GPS' en la placa).  Por ejemplo, tengo un U-blox NEO-M8P conectado a UART2. <br><br>  Hay otras posibilidades: hay otras opciones de inicio, con velocidades de puerto predefinidas y los puertos mismos: <br><br><pre> <code class="bash hljs">Switch -A --&gt; <span class="hljs-string"><span class="hljs-string">"Console"</span></span>, SERIAL0, default 115200 Switch -B --&gt; <span class="hljs-string"><span class="hljs-string">"GPS"</span></span>, SERIAL3, default 57600 Switch -C --&gt; <span class="hljs-string"><span class="hljs-string">"Telem1"</span></span>, SERIAL1, default 57600 Switch -D --&gt; <span class="hljs-string"><span class="hljs-string">"Telem2"</span></span>, SERIAL2, default 38400 Switch -E --&gt; Unnamed, SERIAL4, default 38400 Switch -F --&gt; Unnamed, SERIAL5, default 57600</code> </pre><br>  Consulte la documentaci√≥n oficial de ArduPilot para obtener m√°s informaci√≥n sobre los diversos puertos seriales: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://ardupilot.org/plane/docs/parameters.html?highlight=parameters</a> <br><br>  A continuaci√≥n, crearemos los archivos de servicio systemdu de ArduPilot, uno para ArduCopter, /lib/systemd/system/arducopter.service: <br><br><pre> <code class="bash hljs">[Unit] Description=ArduCopter Service After=networking.service StartLimitIntervalSec=0 Conflicts=arduplane.service ardurover.service antennatracker.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/arducopter <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  Uno para ArduPlane, /lib/systemd/system/arduplane.service: <br><br><pre> <code class="bash hljs">[Unit] Description=ArduPlane Service After=networking.service StartLimitIntervalSec=0 Conflicts=arducopter.service ardurover.service antennatracker.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/arduplane <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  Uno para ArduRover, /lib/systemd/system/ardurover.service: <br><br><pre> <code class="bash hljs">[Unit] Description=ArduRover Service After=networking.service StartLimitIntervalSec=0 Conflicts=arducopter.service arduplane.service antennatracker.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/ardurover <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  ¬øQu√© tal AntennaTracker, tambi√©n?  Cree /lib/systemd/system/antennatracker.service: <br><br><pre> <code class="bash hljs">[Unit] Description=AntennaTracker Service After=networking.service StartLimitIntervalSec=0 Conflicts=arducopter.service arduplane.service ardurover.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/antennatracker <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  Vayamos a la carpeta sudo mkdir -p / usr / bin / ardupilot <br><br>  Cree un archivo de configuraci√≥n de hierro para ArduPilot, / usr / bin / ardupilot / aphw que se ejecuta antes de los archivos ejecutables. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # aphw # ArduPilot hardware configuration. /bin/echo 80 &gt;/sys/class/gpio/export /bin/echo out &gt;/sys/class/gpio/gpio80/direction /bin/echo 1 &gt;/sys/class/gpio/gpio80/value /bin/echo pruecapin_pu &gt;/sys/devices/platform/ocp/ocp:P8_15_pinmux/state</span></span></code> </pre><br>  Las l√≠neas 5-7 incluyen BBBlue + 5V servo power, es decir, cuando usa servos.  No es necesario para ESC. <br><br>  La l√≠nea 8 incluye la PRU. <br><br>  Use sudo chmod 0755 / usr / bin / ardupilot / aphw para establecer permisos para este archivo. <br><br>  Casi sucedi√≥!  Ahora deber√≠a obtener los archivos ejecutables ArduCopter, ArduPlane, etc. m√°s recientes creados espec√≠ficamente para la arquitectura Arm BBBlue, y colocarlos en el directorio / usr / bin / ardupilot.  Mirko Denecke los subi√≥ a su sitio web aqu√≠: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://bbbmini.org/download/blue/</a> <br><br>  Copie a este repositorio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/imfatant/test/blob/master/bin/</a> <br><br>  No olvide establecer los derechos: sudo chmod 0755 / usr / bin / ardupilot / a * <br><br>  Si encuentra que necesita compilar desde la fuente, no se asuste, no es tan dif√≠cil.  Adem√°s, esto significa que puede crear su propio software ArduPilot. <br><br>  Recolectarlos en el BBBlue tomar√° demasiado tiempo.  Patrick Poirier explica el proceso para BBBMINI (basado en el BeagleBone negro) en su sitio web.  Aqu√≠ est√° el procedimiento espec√≠fico de BBBlue, asumiendo que ha completado todos los pasos hasta ahora y est√° en el directorio / home / debian: <br><br><pre> <code class="bash hljs">sudo apt-get install g++ make pkg-config python python-dev python-lxml python-pip sudo pip install future git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/ArduPilot/ardupilot <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ardupilot git checkout Copter-3.6 <span class="hljs-comment"><span class="hljs-comment"># &lt;-- For ArduCopter. git submodule update --init --recursive ./waf configure --board=blue # &lt;-- BeagleBone Blue. ./waf sudo cp ./build/blue/bin/a* /usr/bin/ardupilot</span></span></code> </pre><br>  Patrick tambi√©n proporciona instrucciones para compilarlos en una PC de escritorio x64 relativamente potente en Ubuntu, que es mucho, mucho m√°s r√°pido. <br><br>  Dependiendo de la opci√≥n de software que necesite <br>  sudo systemctl enable arducopter.service <br>  o <br>  sudo systemctl enable arduplane.service <br>  o <br>  sudo systemctl enable ardurover.service <br>  o <br>  sudo systemctl enable antennatracker.service <br><br>  Despu√©s de reiniciar, su ArduPilot deber√≠a iniciarse autom√°ticamente.  ¬°Ver√°s un LED rojo parpadeante! <br><br>  Puede consultar systemctl ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.freedesktop.org/software/systemd/man/systemctl.html</a> ).  Algunos comandos de ejemplo √∫tiles: <br><br><pre> <code class="bash hljs">sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> ... sudo systemctl start ... sudo systemctl stop ...</code> </pre><br><h3>  Parte 3. Conexi√≥n de perif√©ricos </h3><br><img src="https://habrastorage.org/webt/fx/xo/ae/fxxoaey0otck_4ti6yl0p1dzbgu.jpeg" alt="imagen"><br><br>  Es probable que la configuraci√≥n m√≠nima b√°sica incluya: <br><br><ul><li>  Receptor R / C. </li><li>  Receptor GPS (con o sin br√∫jula integrada). </li><li>  Un m√≥dem de radio para un canal de datos bidireccional, especialmente a largas distancias. </li><li>  (El WiFi BBBlue incorporado es ideal para depurar y probar a corta distancia si hay 2,4 GHz disponibles, pero para algo m√°s interesante, se recomienda un canal de datos bidireccional dedicado. Tambi√©n tenga en cuenta el tipo y la ubicaci√≥n de las antenas que utilizan todos estos elementos. ) </li></ul><br>  Algunas palabras sobre los conectores, cables y herramientas que necesita.  Voy a dar algunas recomendaciones, de lo contrario, si eres un principiante, puedes gastar mucho tiempo, esfuerzo y dinero.  El tipo de conector m√°s utilizado es JST-SH 1.0 mm.  Debe comprar varios conectores hembra en tama√±os de 4 y 6 posiciones y contactos de crimpado.  Luego obtenga un par de metros de cables de diferentes colores. <br><br>  Entonces, volviendo a conectar perif√©ricos: <br><br><img src="https://habrastorage.org/webt/h4/mq/7k/h4mq7kn51qxgbc4orkk4ghmluoo.jpeg"><br><br>  Receptor R / C: se puede apagar en cualquier contacto + 5V y GND.  Todo lo que queda es conectar la salida SBUS del receptor, la salida DSM o la salida PPM a uno de los dos pines SBUS marcados en el diagrama.  Los siguientes receptores han sido probados y funcionan: <br><br>  FrSky ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.frsky-rc.com/</a> ): R-XSR, XR4SB, X6R, X8R, R9 Slim y R9 Mini (ambos firmwares EU LBT 868 MHz y Universal 915 MHz). <br><br>  Spektrum ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.spektrumrc.com/</a> ): AR7700 DSMX con PPM / SRXL / Remote Rx. <br><br>  TBS ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://team-blacksheep.com/</a> ): 'Full' Crossfire con Nano Rx (Rx configurado en modo SBUS). <br><br>  Por cierto, hablan mucho sobre el "SBUS invertido".  En realidad, SBUS es solo un protocolo de transferencia de datos en serie que invent√≥ Futaba y que FrSky copi√≥.  Est√° al rev√©s en comparaci√≥n con el UART "est√°ndar".  Afortunadamente, el Ardupilot Blue espera esta se√±al SBUS invertida, por lo que no hay necesidad de un inversor de se√±al. <br><br>  Receptor GPS: la mayor√≠a de las personas usan receptores u-blox, especialmente NEO-M8N y NEO-M8P.  NEO-M8N es barato y asequible de compa√±√≠as chinas como HobbyKing, generalmente en forma de disco.  Convenientemente, contienen el receptor en s√≠, una antena de parche de cer√°mica muy peque√±a, y a menudo incluyen una br√∫jula.  Si bien BBBlue ya tiene una br√∫jula incorporada (AKM AK8963), ArduPilot se puede configurar para usar esta br√∫jula "externa" en lugar de la suya propia, para evitar interferencias. <br><br>  Una alternativa (mucho) m√°s cara al NEO-M8N es NEO-M8P.  Este receptor admite un modo operativo conocido como "RTK", o cinem√°tico en tiempo real, que puede lograr una precisi√≥n de posicionamiento de unos pocos cent√≠metros en tiempo real.  Sin embargo, este tipo de presentaci√≥n tiene un precio aproximadamente 10 veces m√°s caro que el NEO-M8N, y esto no tiene una estaci√≥n base.  M√°s adelante en el manual dedicar√© una secci√≥n especial al M8P. <br><br>  Archivo de configuraci√≥n de I2C ArduPilot: /var/APM/{ArduCopter.stg,ArduPlane.stg,APMrover2.stg,AntennaTracker.stg} <br><br><pre> <code class="bash hljs">sudo apt-get install i2c-tools sudo i2cdetect -r -y 0 sudo i2cdetect -r -y 1 sudo i2cdetect -r -y 2</code> </pre><br><pre> <code class="bash hljs">$ sudo i2cdetect -r -y 2 0 1 2 3 4 5 6 7 8 9 abcdef 00: -- -- -- -- -- -- -- -- -- 0c -- -- -- 10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 60: -- -- -- -- -- -- -- -- 68 -- -- -- -- -- -- -- 70: -- -- -- -- -- -- 76 --</code> </pre><br>  68 = IMU InvenSense MPU-9250 (a bordo), 0c = br√∫jula AKM AK8963 (a bordo), 76 = bar√≥metro BMP280 de Bosch (a bordo). <br><br><pre> <code class="bash hljs">$ sudo i2cdetect -r -y 1 0 1 2 3 4 5 6 7 8 9 abcdef 00: -- -- -- -- -- -- -- -- -- -- -- -- -- 10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- 1e -- 20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 70: -- -- -- -- -- -- -- --</code> </pre><br>  1e = Br√∫jula Honeywell HMC5843 (externa): a menudo integrada en m√≥dulos GPS basados ‚Äã‚Äãen NEO-M8N u-blox. <br><br><h2>  Introducci√≥n al software de la estaci√≥n de control de tierra (GCS) </h2><br>  Descargue cualquier planificador de misiones (http://firmware.ardupilot.org/Tools/MissionPlanner/MissionPlanner-latest.msi) para Windows o QGroundControl (http://qgroundcontrol.com/) para Linux y Windows.  Ambos programas se conectar√°n a las secuencias de datos MAVLink que ingresan a trav√©s de la red (por ejemplo, a trav√©s del puerto UDP 14550) o a trav√©s de los puertos COM. <br><br><h2>  Opcional </h2><br>  Equipar su bbblue basado en drones con un altavoz Bluetooth puede ser divertido, siempre que las transmisiones RF de Bluetooth no interfieran con ning√∫n otro sistema.  Hay un mont√≥n de informaci√≥n sobre BlueZ / PulseAudio / ALSA, pero, afortunadamente, se trata de algo bastante simple. <br><br>  a) primero instale el software necesario (usando la consola o la imagen IoT): <br><br><pre> <code class="bash hljs"> sudo apt-get install -y bluetooth pulseaudio pulseaudio-module-bluetooth alsa-utils</code> </pre><br>  b) Habilitar Bluetooth (si est√° deshabilitado): sudo systemctl enable bb-wl18xx-bluetooth.service <br><br>  c) Editar /etc/pulse/default.pa: <br><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment">### Automatically suspend sinks/sources that become idle for too long # load-module module-suspend-on-idle</span></span></code> </pre><br>  d) Reiniciar: reinicio de sudo <br><br>  e) Despu√©s de cargar BBBlue, active la columna Bluetooth en modo de conexi√≥n: <br><br><pre> <code class="bash hljs"> bluetoothctl scan on agent on default-agent pair &lt;Bluetooth speaker<span class="hljs-string"><span class="hljs-string">'s MAC address&gt; # &lt;--- eg AB:58:EC:5C:0C:03 connect &lt;Bluetooth speaker'</span></span>s MAC address&gt; <span class="hljs-comment"><span class="hljs-comment"># &lt;--- Sometimes unnecessary. trust &lt;Bluetooth speaker's MAC address&gt; scan off exit</span></span></code> </pre><br>  f) Finalmente: <br><br><pre> <code class="bash hljs"> pulseaudio --start <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"connect &lt;Bluetooth speaker's MAC address&gt;"</span></span> | bluetoothctl pactl list <span class="hljs-comment"><span class="hljs-comment"># &lt;--- Use this to check that your Bluetooth speaker has been picked up by PulseAudio. pacmd set-card-profile 0 a2dp_sink aplay /usr/share/sounds/alsa/Front_Center.wav</span></span></code> </pre><br>  Eso es todo!  Por cierto, si vas a usar un sintetizador de voz, te recomiendo Festival. <br><br>  Si quieres ayudar, escr√≠beme en LAN o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">VK</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FB</a> . <br><br><img src="https://habrastorage.org/webt/mt/lh/91/mtlh91x8jag1t-ibt_np3uayuke.jpeg" alt="imagen">  <a href="">habrastorage.org/webt/mt/lh/91/mtlh91x8jag1t-ibt_np3uayuke.jpeg</a> <br><br>  Gracias por leer, preguntar y criticarnos por completo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es429510/">https://habr.com/ru/post/es429510/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es429500/index.html">"Tiempo para hacer negocios" finalmente vol√≥</a></li>
<li><a href="../es429502/index.html">¬øVale la pena desarrollar competencias cruzadas?</a></li>
<li><a href="../es429504/index.html">C√≥mo llamar a los m√©todos de audio vk</a></li>
<li><a href="../es429506/index.html">Miramos bajo el cap√≥ del nuevo Gmail</a></li>
<li><a href="../es429508/index.html">Resumen del informe "C√≥mo convertirse en un excelente especialista en bases de datos" (HL2018, Data Egret, Ilya Kosmodemyansky)</a></li>
<li><a href="../es429512/index.html">Eventos digitales en Mosc√∫ del 12 al 18 de noviembre.</a></li>
<li><a href="../es429514/index.html">Microsoft dijo c√≥mo resolver el problema de la seguridad de los datos en SSD con cifrado de hardware con fugas</a></li>
<li><a href="../es429522/index.html">Dise√±o de un robot de servicio. Planteamiento del problema, arquitectura de la soluci√≥n</a></li>
<li><a href="../es429524/index.html">La correcta API JSON o JSON RPC</a></li>
<li><a href="../es429528/index.html">El resumen de materiales frescos del mundo del front-end para la √∫ltima semana No. 338 (5 al 11 de noviembre de 2018)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>