<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤³ ğŸ‘¨ğŸ¾â€ğŸ¤ ğŸ–•ğŸ» å°†Mavené¡¹ç›®è½¬ç§»åˆ°Multi-Release Jarçš„ç»éªŒï¼šå·²ç»å¯ä»¥ï¼Œä½†ä»ç„¶å¾ˆå›°éš¾ ğŸ…ğŸ¾ ğŸ‘ŒğŸ¾ ğŸ‘ˆğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘æœ‰ä¸€ä¸ªå°çš„StreamExåº“ï¼Œå®ƒæ‰©å±•äº†Java 8 Stream APIã€‚ æˆ‘ä¼ ç»Ÿä¸Šæ˜¯é€šè¿‡Mavenæ”¶é›†å›¾ä¹¦é¦†çš„ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘å¯¹ä¸€åˆ‡éƒ½å¾ˆæ»¡æ„ã€‚ ä½†æ˜¯ï¼Œæˆ‘æƒ³å°è¯•ä¸€ä¸‹ã€‚ 


åº“ä¸­çš„æŸäº›å†…å®¹åœ¨ä¸åŒç‰ˆæœ¬çš„Javaä¸­åº”ä»¥ä¸åŒçš„æ–¹å¼å·¥ä½œã€‚ æœ€å¼•äººæ³¨ç›®çš„ç¤ºä¾‹æ˜¯ä»…åœ¨Java 9ä¸­å‡ºç°çš„æ–°Stream AP...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å°†Mavené¡¹ç›®è½¬ç§»åˆ°Multi-Release Jarçš„ç»éªŒï¼šå·²ç»å¯ä»¥ï¼Œä½†ä»ç„¶å¾ˆå›°éš¾</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472312/"><p>æˆ‘æœ‰ä¸€ä¸ªå°çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">StreamEx</a>åº“ï¼Œå®ƒæ‰©å±•äº†Java 8 Stream APIã€‚ æˆ‘ä¼ ç»Ÿä¸Šæ˜¯é€šè¿‡Mavenæ”¶é›†å›¾ä¹¦é¦†çš„ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘å¯¹ä¸€åˆ‡éƒ½å¾ˆæ»¡æ„ã€‚ ä½†æ˜¯ï¼Œæˆ‘æƒ³å°è¯•ä¸€ä¸‹ã€‚ </p><br><p>åº“ä¸­çš„æŸäº›å†…å®¹åœ¨ä¸åŒç‰ˆæœ¬çš„Javaä¸­åº”ä»¥ä¸åŒçš„æ–¹å¼å·¥ä½œã€‚ æœ€å¼•äººæ³¨ç›®çš„ç¤ºä¾‹æ˜¯ä»…åœ¨Java 9ä¸­å‡ºç°çš„æ–°Stream APIæ–¹æ³•ï¼Œä¾‹å¦‚<code>takeWhile</code> ã€‚æˆ‘çš„åº“ä¹Ÿæä¾›äº†Java 8ä¸­è¿™äº›æ–¹æ³•çš„å®ç°ï¼Œä½†æ˜¯å½“æ‚¨è‡ªå·±æ‰©å±•Stream APIæ—¶ï¼Œä¼šé‡åˆ°ä¸€äº›é™åˆ¶ï¼Œåœ¨è¿™é‡Œæˆ‘å°†ä¸èµ˜è¿°ã€‚ æˆ‘å¸Œæœ›Java 9+ç”¨æˆ·å¯ä»¥è®¿é—®æ ‡å‡†å®ç°ã€‚ </p><a name="habracut"></a><br><p> ä¸ºäº†ä½¿é¡¹ç›®ç»§ç»­ä½¿ç”¨Java 8è¿›è¡Œç¼–è¯‘ï¼Œé€šå¸¸ä½¿ç”¨åå°„å·¥å…·æ¥å®Œæˆï¼šæˆ‘ä»¬åœ¨æ ‡å‡†åº“ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ç›¸åº”çš„æ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è°ƒç”¨å®ƒï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ä½¿ç”¨å®ç°ã€‚ ä½†æ˜¯ï¼Œæˆ‘å†³å®šä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MethodHandle API</a> ï¼Œå› ä¸ºå®ƒå£°æ˜äº†æ›´å°‘çš„è°ƒç”¨å¼€é”€ã€‚ æ‚¨å¯ä»¥æå‰è·å–<code>MethodHandle</code>å¹¶å°†å…¶ä¿å­˜åœ¨é™æ€å­—æ®µä¸­ï¼š </p><br><pre> <code class="java hljs">MethodHandles.Lookup lookup = MethodHandles.publicLookup(); MethodType type = MethodType.methodType(Stream.class, Predicate.class); MethodHandle method = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { method = lookup.findVirtual(Stream.class, <span class="hljs-string"><span class="hljs-string">"takeWhile"</span></span>, type); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (NoSuchMethodException | IllegalAccessException e) { <span class="hljs-comment"><span class="hljs-comment">// ignore }</span></span></code> </pre> <br><p> ç„¶åä½¿ç”¨å®ƒï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (Stream&lt;T&gt;)method.invokeExact(stream, predicate); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Java 8 polyfill }</span></span></code> </pre> <br><p> ä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œä½†æ˜¯çœ‹èµ·æ¥å¾ˆä¸‘ã€‚ æœ€é‡è¦çš„æ˜¯ï¼Œåœ¨å¯èƒ½å®ç°çš„æ¯ä¸€ä¸ªç‚¹ä¸Šï¼Œæ‚¨éƒ½å¿…é¡»ç¼–å†™è¿™æ ·çš„æ¡ä»¶ã€‚ ä¸€ç§ç¨å¾®æ›¿ä»£çš„æ–¹æ³•æ˜¯å°†Java 8å’ŒJava 9çš„ç­–ç•¥åˆ†ç¦»ä¸ºåŒä¸€æ¥å£çš„å®ç°ã€‚ æˆ–è€…ï¼Œä¸ºäº†èŠ‚çœåº“çš„å¤§å°ï¼Œåªéœ€åœ¨å•ç‹¬çš„éæœ€ç»ˆç±»ä¸­å®ç°Java 8çš„æ‰€æœ‰åŠŸèƒ½ï¼Œç„¶åç”¨Java 9çš„ç»§æ‰¿è€…ä»£æ›¿ã€‚ è¿™æ ·åšæ˜¯è¿™æ ·çš„ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//    Internals static final VersionSpecific VER_SPEC = System.getProperty("java.version", "").compareTo("1.9") &gt; 0 ? new Java9Specific() : new VersionSpecific();</span></span></code> </pre> <br><p> ç„¶åï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°ç¼–å†™<code>return Internals.VER_SPEC.takeWhile(stream, predicate)</code> ã€‚ æ‰€æœ‰å¸¦æœ‰æ–¹æ³•å¥æŸ„çš„é­”æœ¯ç°åœ¨ä»…åœ¨<code>Java9Specific</code>ç±»ä¸­ã€‚ é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œè¿™ç§æ–¹æ³•ä¸ºä»¥å‰æ›¾æŠ±æ€¨å®ƒåœ¨åŸåˆ™ä¸Šä¸èµ·ä½œç”¨çš„Androidç”¨æˆ·ä¿å­˜äº†è¯¥åº“ã€‚  Androidè™šæ‹Ÿæœºä¸æ˜¯Javaï¼Œå®ƒç”šè‡³æ²¡æœ‰å®ç°Java 7è§„èŒƒï¼Œç‰¹åˆ«æ˜¯ï¼Œæ²¡æœ‰åƒ<code>invokeExact</code>è¿™æ ·çš„å…·æœ‰å¤šæ€ç­¾åçš„æ–¹æ³•ï¼Œè€Œå­—èŠ‚ç ä¸­æ­¤è°ƒç”¨çš„å­˜åœ¨å°±ç ´åäº†ä¸€åˆ‡ã€‚ ç°åœ¨ï¼Œè¿™äº›è°ƒç”¨è¢«æ”¾ç½®åœ¨ä»æœªåˆå§‹åŒ–çš„ç±»ä¸­ã€‚ </p><br><p> ä½†æ˜¯ï¼Œè¿™ä¸€åˆ‡ä»ç„¶å¾ˆä¸‘é™‹ã€‚ ä¸€ä¸ªä¸é”™çš„è§£å†³æ–¹æ¡ˆï¼ˆè‡³å°‘åœ¨ç†è®ºä¸Šæ¥è¯´ï¼‰æ˜¯ä½¿ç”¨Java 9ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JEP-238</a> ï¼‰é™„å¸¦çš„Multi Release Jarã€‚ ä¸ºæ­¤ï¼Œå¿…é¡»åœ¨Java 9ä¸‹ç¼–è¯‘éƒ¨åˆ†ç±»ï¼Œå¹¶å°†å·²ç¼–è¯‘çš„ç±»æ–‡ä»¶æ”¾åœ¨Jaræ–‡ä»¶ä¸­çš„<code>META-INF/versions/9</code> ã€‚ å¦å¤–ï¼Œæ‚¨éœ€è¦åœ¨æ¸…å•ä¸­æ·»åŠ â€œ <code>Multi-Release: true</code> â€è¡Œã€‚ è¿™æ ·ï¼ŒJava 8å°†æˆåŠŸå¿½ç•¥æ‰€æœ‰è¿™äº›ï¼Œè€ŒJava 9å’Œæ›´é«˜ç‰ˆæœ¬å°†åŠ è½½æ–°ç±»ï¼Œè€Œä¸æ˜¯é€šå¸¸ä½ç½®çš„å…·æœ‰ç›¸åŒåç§°çš„ç±»ã€‚ </p><br><p> æˆ‘æ˜¯ä¸¤å¹´å¤šå‰ç¬¬ä¸€æ¬¡å°è¯•è¿™æ ·åšï¼Œå°±åœ¨Java 9å‘è¡Œä¸ä¹…ä¹‹å‰ã€‚è¿™éå¸¸å›°éš¾ï¼Œæˆ‘é€€å‡ºäº†ã€‚ ç”šè‡³ä»…ä½¿é¡¹ç›®ä½¿ç”¨Java 9ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘éƒ½æ˜¯å›°éš¾çš„ï¼šè®¸å¤šMavenæ’ä»¶åªæ˜¯ç”±äºå†…éƒ¨APIæ›´æ”¹ï¼Œ <code>java.version</code>å­—ç¬¦ä¸²<code>java.version</code>æ›´æ”¹æˆ–å…¶ä»–åŸå› è€Œ<code>java.version</code> ã€‚ </p><br><p> ä»Šå¹´çš„æ–°å°è¯•æ›´åŠ æˆåŠŸã€‚ å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ’ä»¶å·²æ›´æ–°ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ–°Javaä¸­æ­£å¸¸è¿è¡Œã€‚ ç¬¬ä¸€æ­¥ï¼Œæˆ‘å°†æ•´ä¸ªç¨‹åºé›†è½¬æ¢ä¸ºJava11ã€‚ä¸ºæ­¤ï¼Œé™¤äº†æ›´æ–°æ’ä»¶ç‰ˆæœ¬å¤–ï¼Œæˆ‘è¿˜å¿…é¡»æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š </p><br><ul><li> å°†å½¢å¼ä¸º<code>&lt;a name="..."&gt;</code> JavaDoc <code>package-info.java</code>é“¾æ¥æ›´æ”¹ä¸º<code>&lt;a id="..."&gt;</code> ã€‚ å¦åˆ™ï¼ŒJavaDocä¼šæŠ±æ€¨ã€‚ </li><li> åœ¨maven-javadoc-pluginä¸­æŒ‡å®š<code>additionalOptions = --no-module-directories</code> ã€‚ å¦åˆ™ï¼ŒJavaDocæœç´¢åŠŸèƒ½ä¼šå‡ºç°å¥‡æ€ªçš„é”™è¯¯ï¼šä»æœªåˆ›å»ºå¸¦æœ‰æ¨¡å—çš„ç›®å½•ï¼Œä½†æ˜¯å½“åˆ‡æ¢åˆ°æœç´¢ç»“æœæ—¶ï¼Œ <code>/undefined/</code>æ·»åŠ åˆ°è·¯å¾„ï¼ˆhelloï¼ŒJavaScriptï¼‰ã€‚  Java 8æ ¹æœ¬æ²¡æœ‰æ­¤åŠŸèƒ½ï¼Œå› æ­¤æˆ‘çš„æ´»åŠ¨å·²ç»å¸¦æ¥äº†ä¸é”™çš„ç»“æœï¼šJavaDocå·²æˆä¸ºæœç´¢å¯¹è±¡ã€‚ </li><li> ä¿®å¤ç”¨äºåœ¨Coverallsä¸­å‘å¸ƒæµ‹è¯•è¦†ç›–ç‡ç»“æœçš„æ’ä»¶ï¼ˆ <code>coveralls-maven-plugin</code> ï¼‰ã€‚ å‡ºäºæŸç§åŸå› ï¼Œå®ƒè¢«æ”¾å¼ƒäº†ï¼Œè¿™å¾ˆå¥‡æ€ªï¼Œå› ä¸ºCoverallsè‡ªå·±ç”Ÿæ´»å¹¶æä¾›å•†ä¸šæœåŠ¡ã€‚ è¯¥æ’ä»¶ä½¿ç”¨çš„jaxb-apiæ¥è‡ªJava 11ã€‚ å¹¸è¿çš„æ˜¯ï¼Œä½¿ç”¨Mavenå·¥å…·è§£å†³è¯¥é—®é¢˜å¹¶ä¸å›°éš¾ï¼šåªéœ€åœ¨æ’ä»¶ä¸Šæ˜¾å¼æ³¨å†Œä¾èµ–é¡¹å³å¯ï¼š <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.eluder.coveralls<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>coveralls-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>4.3.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>javax.xml.bind<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jaxb-api<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.2.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </li></ul><br><p> ä¸‹ä¸€æ­¥æ˜¯æµ‹è¯•çš„æ”¹ç¼–ã€‚ ç”±äºåº“è¡Œä¸ºåœ¨Java 8å’ŒJava 9ä¸­æ˜æ˜¾ä¸åŒï¼Œå› æ­¤å¯¹ä¸¤ä¸ªç‰ˆæœ¬è¿è¡Œæµ‹è¯•éƒ½æ˜¯åˆä¹é€»è¾‘çš„ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨Java 11ä¸‹è¿è¡Œæ‰€æœ‰â€‹â€‹å†…å®¹ï¼Œå› æ­¤æœªæµ‹è¯•Java 8ç‰¹å®šçš„ä»£ç ã€‚ è¿™æ˜¯ä¸€ä¸ªç›¸å½“å¤§ä¸”ä¸å¹³å‡¡çš„ä»£ç ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åšäº†ä¸€ä¸ªäººé€ ç¬”ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> VersionSpecific VER_SPEC = System.getProperty(<span class="hljs-string"><span class="hljs-string">"java.version"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>).compareTo(<span class="hljs-string"><span class="hljs-string">"1.9"</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; !Boolean.getBoolean(<span class="hljs-string"><span class="hljs-string">"one.util.streamex.emulateJava8"</span></span>) ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Java9Specific() : <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VersionSpecific();</code> </pre> <br><p> ç°åœ¨ï¼Œåœ¨è¿è¡Œæµ‹è¯•æ—¶åªéœ€ä¼ é€’<code>-Done.util.streamex.emulateJava8=true</code> ï¼Œ <br> ä»¥æµ‹è¯•é€šå¸¸åœ¨Java 8ä¸­æ­£å¸¸è¿è¡Œçš„ä»£ç ã€‚ç°åœ¨ï¼Œä½¿ç”¨<code>argLine = -Done.util.streamex.emulateJava8=true</code>å°†æ–°çš„<code>&lt;execution&gt;</code>å—æ·»åŠ åˆ°<code>maven-surefire-plugin</code> <code>argLine = -Done.util.streamex.emulateJava8=true</code> <code>maven-surefire-plugin</code>é…ç½®ä¸­ï¼Œæµ‹è¯•å°†é€šè¿‡ä¸¤æ¬¡ã€‚ </p><br><p> ä½†æ˜¯ï¼Œæˆ‘æƒ³è€ƒè™‘ä¸€ä¸‹æ€»è¦†ç›–ç‡æµ‹è¯•ã€‚ æˆ‘ä½¿ç”¨çš„æ˜¯JaCoCoï¼Œå¦‚æœæ‚¨ä»€ä¹ˆéƒ½æ²¡å‘Šè¯‰ä»–ï¼Œé‚£ä¹ˆç¬¬äºŒè½®å°†ç®€å•åœ°è¦†ç›–ç¬¬ä¸€è½®çš„ç»“æœã€‚  JaCoCoå¦‚ä½•å·¥ä½œï¼Ÿ å®ƒé¦–å…ˆè¿è¡Œ<code>prepare-agent</code>ç›®æ ‡ï¼Œè¯¥ç›®æ ‡å°†è®¾ç½®argLine Mavenå±æ€§ï¼Œå¹¶åœ¨å…¶ä¸­ç­¾å<code>-javaagent:blah-blah/.m2/org/jacoco/org.jacoco.agent/0.8.4/org.jacoco.agent-0.8.4-runtime.jar=destfile=blah-blah/myproject/target/jacoco.exec</code> ã€‚ æˆ‘å¸Œæœ›å½¢æˆä¸¤ä¸ªä¸åŒçš„execæ–‡ä»¶ã€‚ æ‚¨å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œç ´è§£ã€‚ å°†<code>destFile=${project.build.directory}</code>æ·»åŠ <code>destFile=${project.build.directory}</code> <code>prepare-agent</code>é…ç½®ä¸­ã€‚ ç²—ç³™ä½†æœ‰æ•ˆã€‚ ç°åœ¨<code>argLine</code>å°†ä»¥<code>blah-blah/myproject/target</code>ç»“å°¾ã€‚ æ˜¯çš„ï¼Œè¿™æ ¹æœ¬ä¸æ˜¯æ–‡ä»¶ï¼Œè€Œæ˜¯ç›®å½•ã€‚ ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•å¼€å§‹æ—¶æ›¿æ¢æ–‡ä»¶åã€‚ æˆ‘ä»¬è¿”å›åˆ°<code>maven-surefire-plugin</code> <code>argLine = @{argLine}/jacoco_java8.exec -Done.util.streamex.emulateJava8=true</code> <code>maven-surefire-plugin</code>å¹¶ä¸ºJava 8è¿è¡Œè®¾ç½®<code>argLine = @{argLine}/jacoco_java8.exec -Done.util.streamex.emulateJava8=true</code> ï¼Œä¸ºJava 11è¿è¡Œè®¾ç½®<code>argLine = @{argLine}/jacoco_java11.exec</code> ã€‚ ç„¶åï¼Œä½¿ç”¨JaCoCoæ’ä»¶è¿˜æä¾›çš„<code>merge</code>ç›®æ ‡å³å¯è½»æ¾åœ°å°†è¿™ä¸¤ä¸ªæ–‡ä»¶<code>merge</code>åœ¨ä¸€èµ·ï¼Œä»è€Œè·å¾—äº†æ€»ä½“è¦†ç›–èŒƒå›´ã€‚ </p><br><p>  <strong>æ›´æ–°ï¼š</strong> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Godin</a>åœ¨è¯„è®ºä¸­è¯´è¿™æ˜¯ä¸å¿…è¦çš„ï¼Œæ‚¨å¯ä»¥å†™å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œå®ƒä¼šè‡ªåŠ¨å°†ç»“æœä¸å‰ä¸€ä¸ªæ–‡ä»¶ç²˜åˆåœ¨ä¸€èµ·ã€‚ ç°åœ¨ï¼Œæˆ‘ä¸ç¡®å®šä¸ºä»€ä¹ˆè¿™ç§æƒ…å†µæœ€åˆå¯¹æˆ‘ä¸èµ·ä½œç”¨ã€‚ </p><br><p> å¥½å§ï¼Œæˆ‘ä»¬å·²ç»å‡†å¤‡å¥½åˆ‡æ¢åˆ°å¤šç‰ˆæœ¬Jarã€‚ æˆ‘å‘ç°äº†ä¸€äº›æœ‰å…³å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œçš„å»ºè®®ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€ä¸ª</a>å»ºè®®ä½¿ç”¨å¤šæ¨¡å—Mavené¡¹ç›®ã€‚ æˆ‘ä¸æƒ³ï¼šè¿™æ˜¯é¡¹ç›®ç»“æ„çš„ä¸€ä¸ªå¾ˆå¤§çš„å¤æ‚æ€§ï¼šä¾‹å¦‚ï¼Œæœ‰äº”ä¸ªpom.xmlã€‚ ä¸ºäº†å‡ ä¸ªéœ€è¦åœ¨Java 9ä¸­ç¼–è¯‘çš„æ–‡ä»¶è€Œå››å¤„é€›é€›ä¼¼ä¹æ˜¯è¿‡å¤§çš„é€‰æ‹©ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¦ä¸€ä¸ª</a>å»ºè®®é€šè¿‡<code>maven-antrun-plugin</code>å¼€å§‹ç¼–è¯‘ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘å†³å®šä»…å°†å…¶ä½œä¸ºæœ€åçš„é€‰æ‹©ã€‚ æ˜¾ç„¶ï¼Œä½¿ç”¨Antå¯ä»¥è§£å†³Mavenä¸­çš„ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯è¿™æœ‰ç‚¹ç¬¨æ‹™ã€‚ æœ€ç»ˆï¼Œæˆ‘çœ‹åˆ°äº†ä½¿ç”¨ç¬¬ä¸‰æ–¹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">multi-release-jar-maven-pluginæ’ä»¶çš„å»ºè®®</a> ã€‚ å¬èµ·æ¥å·²ç»ä¸é”™äº†ã€‚ </p><br><p> è¯¥æ’ä»¶å»ºè®®å°†ç‰¹å®šäºJavaæ–°ç‰ˆæœ¬çš„æºä»£ç æ”¾åœ¨<code>src/main/java-mr/9</code>è¿™æ ·çš„ç›®å½•ä¸­ã€‚ æˆ‘ä»ç„¶å†³å®šæœ€å¤§ç¨‹åº¦åœ°é¿å…ç±»åå†²çªï¼Œå› æ­¤Java 8å’ŒJava 9ä¸­éƒ½å­˜åœ¨å”¯ä¸€çš„ç±»ï¼ˆç”šè‡³æ˜¯æ¥å£ï¼‰ï¼Œæˆ‘æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Java 8 package one.util.streamex; /* package */ interface VerSpec { VersionSpecific VER_SPEC = new VersionSpecific(); } // Java 9 package one.util.streamex; /* package */ interface VerSpec { VersionSpecific VER_SPEC = new Java9Specific(); }</span></span></code> </pre> <br><p> åŸæ¥çš„å¸¸æ•°ç§»åˆ°äº†æ–°çš„åœ°æ–¹ï¼Œä½†æ²¡æœ‰å…¶ä»–æ”¹å˜ã€‚ ç›´åˆ°ç°åœ¨ï¼Œ <code>Java9Specific</code>ç±»å˜å¾—æ›´åŠ ç®€å•ï¼šæ‰€æœ‰ä½¿ç”¨MethodHandleçš„è¹²åéƒ½å·²æˆåŠŸåœ°è¢«ç›´æ¥æ–¹æ³•è°ƒç”¨æ‰€å–ä»£ã€‚ </p><br><p> è¯¥æ’ä»¶æ‰¿è¯ºä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š </p><br><ul><li> æ›¿æ¢æ ‡å‡†çš„<code>maven-compiler-plugin</code>å¹¶ä½¿ç”¨ä¸åŒçš„ç›®æ ‡ç‰ˆæœ¬åˆ†ä¸¤æ­¥è¿›è¡Œç¼–è¯‘ã€‚ </li><li> æ›¿æ¢æ ‡å‡†çš„<code>maven-jar-plugin</code>å¹¶ä½¿ç”¨æ­£ç¡®çš„è·¯å¾„<code>maven-jar-plugin</code>ç¼–è¯‘ç»“æœã€‚ </li><li> å°†è¡Œ<code>Multi-Release: true</code>åˆ°<code>MANIFEST.MF</code> ã€‚ </li></ul><br><p> ä¸ºäº†ä½¿å…¶å·¥ä½œï¼Œå®ƒé‡‡å–äº†è®¸å¤šæ­¥éª¤ã€‚ </p><br><ol><li><p> å°†åŒ…è£…ä»<code>jar</code>æ›´æ”¹ä¸º<code>multi-release-jar</code> ã€‚ </p><br></li><li><p> æ·»åŠ æ„å»ºæ‰©å±•åï¼š </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>pw.krejci<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>multi-release-jar-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.1.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></li><li><p> ä»<code>maven-compiler-plugin</code>å¤åˆ¶é…ç½®ã€‚ æœ¬ç€<code>&lt;source&gt;1.8&lt;/source&gt;</code>å’Œ<code>&lt;arg&gt;-Xlint:all&lt;/arg&gt;</code>çš„ç²¾ç¥ï¼Œæˆ‘åªæœ‰é»˜è®¤ç‰ˆæœ¬ã€‚ </p><br></li><li><p> æˆ‘ä»¥ä¸ºç°åœ¨å¯ä»¥åˆ é™¤<code>maven-compiler-plugin</code> ï¼Œä½†æ˜¯äº‹å®è¯æ˜ï¼Œæ–°æ’ä»¶ä¸èƒ½ä»£æ›¿æµ‹è¯•çš„ç¼–è¯‘ï¼Œå› æ­¤å°†å…¶Javaç‰ˆæœ¬é‡ç½®ä¸ºé»˜è®¤å€¼ï¼ˆ1.5ï¼ï¼‰ï¼Œå¹¶ä¸”<code>-Xlint:all</code>å‚æ•°éƒ½æ¶ˆå¤±äº†ã€‚ æ‰€ä»¥æˆ‘ä¸å¾—ä¸ç¦»å¼€ã€‚ </p><br></li><li><p> ä¸ºäº†ä¸é‡å¤è¿™ä¸¤ä¸ªæ’ä»¶çš„æºå’Œç›®æ ‡ï¼Œæˆ‘å‘ç°å®ƒä»¬éƒ½å°Šé‡<code>maven.compiler.source</code>å’Œ<code>maven.compiler.target</code>çš„å±æ€§ã€‚ æˆ‘å®‰è£…äº†å®ƒä»¬ï¼Œå¹¶ä»æ’ä»¶è®¾ç½®ä¸­åˆ é™¤äº†ç‰ˆæœ¬ã€‚ ä½†æ˜¯ï¼Œçªç„¶å‘ç°<code>maven-javadoc-plugin</code>ä½¿ç”¨<code>maven-compiler-plugin</code>è®¾ç½®ä¸­çš„æºæ¥æŸ¥æ‰¾æ ‡å‡†JavaDocçš„URLï¼Œåœ¨å¼•ç”¨æ ‡å‡†æ–¹æ³•æ—¶å¿…é¡»å°†å…¶é“¾æ¥ã€‚ ç°åœ¨ä»–ä¸å°Šé‡<code>maven.compiler.source</code> ã€‚ å› æ­¤ï¼Œæˆ‘å¿…é¡»å°†<code>&lt;source&gt;${maven.compiler.source}&lt;/source&gt;</code>è¿”å›åˆ°<code>maven-compiler-plugin</code>è®¾ç½®ã€‚ å¹¸è¿çš„æ˜¯ï¼Œä¸éœ€è¦å…¶ä»–æ›´æ”¹å³å¯ç”ŸæˆJavaDocã€‚ å®ƒå¯ä»¥å¾ˆå¥½åœ°ä»Java 8æ¥æºç”Ÿæˆï¼Œå› ä¸ºå¸¦æœ‰ç‰ˆæœ¬çš„æ•´ä¸ªè½®æ’­ä¸ä¼šå½±å“åº“APIã€‚ </p><br></li><li><p>  <code>maven-bundle-plugin</code> ï¼Œè¿™ä½¿æˆ‘çš„åº“å˜æˆäº†OSGiå·¥ä»¶ã€‚ ä»–åªæ˜¯æ‹’ç»ä½¿ç”¨<code>packaging = multi-release-jar</code> ã€‚ åŸåˆ™ä¸Šï¼Œæˆ‘ä»ä¸å–œæ¬¢ä»–ã€‚ ä»–åœ¨æ¸…å•ä¸­æ·»åŠ äº†ä¸€ç»„é¢å¤–çš„è¡Œï¼ŒåŒæ—¶ç ´åäº†æ’åºé¡ºåºå¹¶æ·»åŠ äº†æ›´å¤šåƒåœ¾ã€‚ å¹¸è¿çš„æ˜¯ï¼Œäº‹å®è¯æ˜ï¼Œé€šè¿‡æ‰‹å·¥ç¼–å†™æ‰€éœ€çš„æ‰€æœ‰å†…å®¹æ¥æ‘†è„±å®ƒå¹¶ä¸éš¾ã€‚ å½“ç„¶ï¼Œä¸æ˜¯åœ¨<code>maven-jar-plugin</code> ï¼Œè€Œæ˜¯åœ¨æ–°çš„ä¸­ã€‚ æœ€ç»ˆï¼Œ <code>multi-release-jar</code>æ’ä»¶çš„æ•´ä¸ªé…ç½®å˜æˆäº†è¿™æ ·ï¼ˆæˆ‘è‡ªå·±å®šä¹‰äº†ä¸€äº›å±æ€§ï¼Œä¾‹å¦‚<code>project.package</code> ï¼‰ï¼š </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>pw.krejci<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>multi-release-jar-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.1.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">compilerArgs</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg</span></span></span><span class="hljs-tag">&gt;</span></span>-Xlint:all<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">arg</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">compilerArgs</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifestEntries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Automatic-Module-Name</span></span></span><span class="hljs-tag">&gt;</span></span>${project.package}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Automatic-Module-Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Name</span></span></span><span class="hljs-tag">&gt;</span></span>${project.name}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Description</span></span></span><span class="hljs-tag">&gt;</span></span>${project.description}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-License</span></span></span><span class="hljs-tag">&gt;</span></span>${license.url}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-License</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-ManifestVersion</span></span></span><span class="hljs-tag">&gt;</span></span>2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-ManifestVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-SymbolicName</span></span></span><span class="hljs-tag">&gt;</span></span>${project.package}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-SymbolicName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Version</span></span></span><span class="hljs-tag">&gt;</span></span>${project.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Bundle-Version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Export-Package</span></span></span><span class="hljs-tag">&gt;</span></span>${project.package};version="${project.version}"<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Export-Package</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifestEntries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></li><li><p> æµ‹è¯•ã€‚ æˆ‘ä»¬ä¸å†æ‹¥æœ‰<code>one.util.streamex.emulateJava8</code> ï¼Œä½†æ˜¯æ‚¨å¯ä»¥é€šè¿‡ä¿®æ”¹ç±»è·¯å¾„æµ‹è¯•æ¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœã€‚ ç°åœ¨æƒ…å†µæ­£å¥½ç›¸åï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥åº“ä»¥Java 8æ¨¡å¼è¿è¡Œï¼Œå¯¹äºJava 9ï¼Œæ‚¨éœ€è¦ç¼–å†™ï¼š </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">classesDirectory</span></span></span><span class="hljs-tag">&gt;</span></span>${basedir}/target/classes-9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">classesDirectory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">additionalClasspathElements</span></span></span><span class="hljs-tag">&gt;</span></span>${project.build.outputDirectory}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">additionalClasspathElements</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argLine</span></span></span><span class="hljs-tag">&gt;</span></span>@{argLine}/jacoco_java9.exec<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">argLine</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> é‡è¦çš„ä¸€ç‚¹ï¼š <code>classes-9</code>åº”è¯¥åœ¨æ™®é€šçš„ç±»æ–‡ä»¶ä¹‹å‰ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»å°†æ™®é€šçš„æ–‡ä»¶è½¬ç§»åˆ°AdditionalClasspathElementsï¼Œç„¶ååœ¨å…¶åæ·»åŠ ã€‚ </p><br></li><li><p> èµ„æ–™æ¥æºã€‚ æˆ‘å°†ä½¿ç”¨source-jarï¼Œå°†Java 9æºæ‰“åŒ…åˆ°å…¶ä¸­æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œä¾‹å¦‚ï¼ŒIDEä¸­çš„è°ƒè¯•å™¨å¯ä»¥æ­£ç¡®æ˜¾ç¤ºå®ƒä»¬ã€‚ æˆ‘ä¸å¤ªæ‹…å¿ƒé‡å¤çš„<code>VerSpec</code> ï¼Œå› ä¸ºåªæœ‰ä¸€è¡Œï¼Œä»…åœ¨åˆå§‹åŒ–æœŸé—´æ‰§è¡Œã€‚ æˆ‘å¯ä»¥åªä¿ç•™Java 8ä¸­çš„é€‰é¡¹ã€‚ä½†æ˜¯ï¼Œ <code>Java9Specific.java</code>ä¼šå¾ˆå¥½ã€‚ å¯ä»¥é€šè¿‡æ‰‹åŠ¨æ·»åŠ å…¶ä»–æºç›®å½•æ¥å®Œæˆï¼š </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.codehaus.mojo<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>build-helper-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>test<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>add-source<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">souâ€‹rces</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">souâ€‹rce</span></span></span><span class="hljs-tag">&gt;</span></span>src/main/java-mr/9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">souâ€‹rce</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">souâ€‹rces</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> æ”¶é›†äº†å·¥ä»¶ä¹‹åï¼Œæˆ‘å°†å…¶è¿æ¥åˆ°æµ‹è¯•é¡¹ç›®å¹¶åœ¨IntelliJ IDEAè°ƒè¯•å™¨ä¸­å¯¹å…¶è¿›è¡Œäº†æ£€æŸ¥ã€‚ ä¸€åˆ‡å·¥ä½œæ­£å¸¸ï¼šæ ¹æ®ç”¨äºè¿è¡Œæµ‹è¯•é¡¹ç›®çš„è™šæ‹Ÿæœºçš„ç‰ˆæœ¬ï¼Œè°ƒè¯•æ—¶æœ€ç»ˆä¼šè·å¾—ä¸åŒçš„èµ„æºã€‚ </p><br><p> å¯ä»¥é€šè¿‡multi-release-jaræ’ä»¶æœ¬èº«æ¥å®Œæˆæ­¤æ“ä½œï¼Œæ‰€ä»¥æˆ‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æå‡ºäº†</a>è¿™æ ·çš„å»ºè®®ã€‚ </p><br></li><li><p>  JaCoCoã€‚ äº‹å®è¯æ˜ï¼Œè¿™å¯¹ä»–æ¥è¯´æ˜¯æœ€å›°éš¾çš„ï¼Œæ²¡æœ‰å¤–ç•Œçš„å¸®åŠ©æˆ‘æ˜¯æ— æ³•åšåˆ°çš„ã€‚ äº‹å®æ˜¯ï¼Œä¸ºJava-8å’ŒJava-9æ’ä»¶å®Œç¾ç”Ÿæˆçš„execæ–‡ä»¶é€šå¸¸å°†å®ƒä»¬ç²˜åˆåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä½†æ˜¯ï¼Œå½“ä»¥XMLå’ŒHTMLç”ŸæˆæŠ¥å‘Šæ—¶ï¼Œä»–ä»¬å´é¡½å›ºåœ°å¿½ç•¥äº†Java-9çš„æ¥æºã€‚  <a href="">åœ¨æºä»£ç ä¸­</a>å›æƒ³ä¸€ä¸‹ï¼Œæˆ‘çœ‹åˆ°å®ƒåªä¸º<code>project.getBuild().getOutputDirectory()</code>æ‰¾åˆ°çš„ç±»æ–‡ä»¶ç”ŸæˆæŠ¥å‘Šã€‚ å½“ç„¶ï¼Œå¯ä»¥æ›¿æ¢æ­¤ç›®å½•ï¼Œä½†æ˜¯å®é™…ä¸Šæˆ‘æœ‰ä¸¤ä¸ªç›®å½•ï¼š <code>classes</code>å’Œ<code>classes-9</code> ã€‚ ä»ç†è®ºä¸Šè®²ï¼Œæ‚¨å¯ä»¥å°†æ‰€æœ‰ç±»å¤åˆ¶åˆ°ä¸€ä¸ªç›®å½•ä¸­ï¼Œæ›´æ”¹<code>outputDirectory</code>å¹¶å¯åŠ¨JaCoCoï¼Œç„¶åå†æ”¹å›<code>outputDirectory</code>ä»¥å…ç ´åJARç¨‹åºé›†ã€‚ ä½†è¿™å¬èµ·æ¥å¾ˆä¸‘ã€‚ é€šå¸¸ï¼Œæˆ‘å†³å®šåœ¨é¡¹ç›®ä¸­æ¨è¿Ÿè§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å†™ä¿¡ç»™</a> JaCoCoçš„äººè¯´ï¼Œèƒ½å¤Ÿä½¿ç”¨ç±»æ–‡ä»¶æŒ‡å®šå¤šä¸ªç›®å½•ä¼šå¾ˆå¥½ã€‚ </p><br><p> ä»¤æˆ‘æƒŠè®¶çš„æ˜¯ï¼Œå‡ ä¸ªå°æ—¶åï¼ŒJaCoCo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">godinçš„</a>ä¸€åå¼€å‘äººå‘˜æ¥åˆ°æˆ‘çš„é¡¹ç›®å¹¶æå‡ºäº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pull-request</a> ï¼Œå®ƒè§£å†³äº†é—®é¢˜ã€‚ å®ƒå¦‚ä½•å†³å®šï¼Ÿ å½“ç„¶ï¼Œä½¿ç”¨Antï¼ äº‹å®è¯æ˜ï¼ŒJaCoCoçš„Antæ’ä»¶æ›´é«˜çº§ï¼Œå¯ä»¥ä¸ºå¤šä¸ªæºç›®å½•å’Œç±»æ–‡ä»¶ç”Ÿæˆæ‘˜è¦æŠ¥å‘Šã€‚ ä»–ç”šè‡³ä¸éœ€è¦å•ç‹¬çš„<code>merge</code>æ­¥éª¤ï¼Œå› ä¸ºä»–å¯ä»¥ä¸€æ¬¡è¾“å…¥å¤šä¸ªexecæ–‡ä»¶ã€‚ æ€»çš„æ¥è¯´ï¼Œæ— æ³•é¿å…ä½¿ç”¨Antã€‚ æœ€æœ‰æ•ˆçš„æ–¹æ³•æ˜¯ï¼Œpom.xmlä»…å¢é•¿äº†å…­è¡Œã€‚ </p><br><p><img src="https://habrastorage.org/webt/-y/qd/q9/-yqdq9suyxlqtaw2d9dkjoc0rg8.png"></p><br><p> æˆ‘ä»€è‡³åœ¨æ¨ç‰¹ä¸Šå†™é“ï¼š </p><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1185422598810800129"></twitter-widget><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br></li></ol><br><p> å› æ­¤ï¼Œæˆ‘å¾—åˆ°äº†ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„é¡¹ç›®ï¼Œè¯¥é¡¹ç›®æ„å»ºäº†ä¸€ä¸ªæ¼‚äº®çš„Multi-Release Jarã€‚ åŒæ—¶ï¼Œè¦†ç›–èŒƒå›´çš„ç™¾åˆ†æ¯”ç”šè‡³å¢åŠ äº†ï¼Œå› ä¸ºæˆ‘åˆ é™¤äº†Java 9ä¸­æ— æ³•å®ç°çš„æ‰€æœ‰<code>catch (NoSuchMethodException | IllegalAccessException e)</code> ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒIntelliJ IDEAä¸æ”¯æŒæ­¤é¡¹ç›®ç»“æ„ï¼Œå› æ­¤æˆ‘ä¸å¾—ä¸æ”¾å¼ƒPOMå¯¼å…¥å¹¶åœ¨IDEä¸­æ‰‹åŠ¨é…ç½®é¡¹ç›®ã€‚ æˆ‘å¸Œæœ›å°†æ¥è¿˜ä¼šæœ‰ä¸€ä¸ªæ ‡å‡†è§£å†³æ–¹æ¡ˆï¼Œæ‰€æœ‰æ’ä»¶å’Œå·¥å…·éƒ½å°†è‡ªåŠ¨æ”¯æŒè¯¥è§£å†³æ–¹æ¡ˆã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN472312/">https://habr.com/ru/post/zh-CN472312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN472298/index.html">ä¸Šå‘¨ç¬¬385æœŸæ¥è‡ªå‰ç«¯ä¸–ç•Œçš„æ–°é²œææ–™æ‘˜è¦ï¼ˆ2019å¹´10æœˆ14æ—¥è‡³20æ—¥ï¼‰</a></li>
<li><a href="../zh-CN472300/index.html">äºŒå…ƒåˆ†ç±»é—®é¢˜ä¸­å¯¹æ•°æŸå¤±å‡½æ•°ï¼ˆLogLossï¼‰çš„éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰</a></li>
<li><a href="../zh-CN472304/index.html">ç¾å›½å®‡èˆªå±€è˜è¯·å·¥ç¨‹å¸ˆå¼€å‘ä¸‹ä¸€ä»£äººå½¢æœºå™¨äºº</a></li>
<li><a href="../zh-CN472306/index.html">PHPæ–‡æ‘˜166ï¼ˆ2019å¹´10æœˆ7æ—¥è‡³21æ—¥ï¼‰</a></li>
<li><a href="../zh-CN472310/index.html">æ²¡æœ‰å¯†ç å’ŒCookieçš„ç«™ç‚¹ä¸Šçš„å®¢æˆ·æ ‡è¯†ï¼šæ ‡å‡†ç”³è¯·</a></li>
<li><a href="../zh-CN472314/index.html">æˆ‘å–œæ¬¢ç¡¬çº¸æ¿çš„äºº</a></li>
<li><a href="../zh-CN472318/index.html">åˆ†å¸ƒäºè·Ÿè¸ªIstio</a></li>
<li><a href="../zh-CN472320/index.html">Zabbixè®¿è°ˆï¼š12ä¸ªå¦ç‡çš„ç­”æ¡ˆ</a></li>
<li><a href="../zh-CN472326/index.html">æˆ‘ä»¬çš„èˆªå¤©å·¥ä¸šâ€¦â€¦å¦‚æœæ‚¨ä»æå®¢çš„è§’åº¦çœ‹å¾…èˆªå¤©å·¥ä¸šçš„é—®é¢˜ï¼Ÿ</a></li>
<li><a href="../zh-CN472334/index.html">ä¼˜æƒ åˆ¸ç”Ÿæ´»æˆ–æˆ‘ä»¬å¦‚ä½•ä¼˜åŒ–ç¤¾ä¼šæœåŠ¡å·¥ä½œ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>