<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😕 🎫 🥈 Wie wir die Bestellung des Mittagessens im Büro verbessert haben (ohne Zugang zum Server) 👩🏾‍🤝‍👩🏼 🦁 ✋🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits. 

 Ich arbeite in einem Büro. Softwareentwickler. Und manchmal esse ich. Ja, jeden Tag. Der Arbeitgeber versorgt uns mit Mittagessen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie wir die Bestellung des Mittagessens im Büro verbessert haben (ohne Zugang zum Server)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475892/">  Hallo allerseits. <br><br>  Ich arbeite in einem Büro.  Softwareentwickler.  Und manchmal esse ich.  Ja, jeden Tag.  Der Arbeitgeber versorgt uns mit Mittagessen - die Arbeiter bestellen das Mittagessen für morgen, und der Lieferant von Mittagessen bringt, was die Angestellten bestellt haben.  Was bestellt und gebracht wurde, stimmt nicht immer überein, aber das ist nicht der Fall.  Das Mittagessen wird auf der Bestellseite für das Mittagessen bestellt.  Aber ... <br><a name="habracut"></a><br>  Zunächst aber zur Gestaltung der Mittagstisch-Bestellseite: Der Lieferant sendet eine Woche lang eine XLS-Datei mit einer Preisliste. <br><br><img src="https://habrastorage.org/webt/8b/zj/sw/8bzjswumny4twmbde-z_qlxhlx8.png" alt="Bild"><br>  <i>Beispielpreisliste vom Lieferanten gesendet</i> <br><br>  Die Person, die für das Abendessen verantwortlich ist, analysiert ein Dienstprogramm, das von jemandem in den Eingeweiden unseres Unternehmens entwickelt wurde, und übersetzt es in eine Form, die unser Unternehmensportal anzeigen kann.  Und er zeigt es ... <br><br><img src="https://habrastorage.org/webt/mj/xe/vm/mjxevmjk1xjpktpmhzsvfqv7-zu.png" alt="Bild"><br>  <i>Screenshot mit bestellten Abendessen</i> <br><br><img src="https://habrastorage.org/webt/g_/gv/ur/g_gvurzwytojpckxlvm9ttpk3vu.png" alt="Bild"><br>  <i>Screenshot der Bestellseite für das Mittagessen</i> <br><br>  Positionen sind unbequem in Kategorien unterteilt.  Informationen über den Namen und die Zusammensetzung sind im Volltext und es ist schwierig zu navigieren. <br><br>  Ich möchte verstehen, dass es besser ist, nicht zu bestellen und was Sie probieren können, weil es anderen gefällt.  Das heißt, ich möchte eine Bewertung.  Ich möchte auch meine Bestellung per Telegramm erhalten, damit ich mich nicht erinnere, was ich im Speisesaal bestellt habe. <br><br>  Die Ziele sind also klar.  Ich muss gleich sagen: Der Weg, den mein Kollege und ich gegangen sind, ist alles andere als richtig und rational.  Trotzdem: Es ist ein komplettes Spiel in Bezug auf Architektur / Sicherheit / Support / Fehlertoleranz.  Aber was gewachsen ist, ist gewachsen. <br><br>  Wir haben keinen Zugriff auf den Server, daher können Sie das Erscheinungsbild der Seite nur mit Benutzerskripten ändern.  Aber was ist mit der Bewertung?  Es gibt auch keinen Zugriff auf die Datenbank.  Nun, wir brauchen einen Server für die Auftragsabwicklung, Bewertung und Interaktion mit Telegram.  Diese Rolle wurde vom NodeJS-Server übernommen. <br><br><h4>  Serverseite </h4><br>  Ich kümmere mich um den Server, und ein Kollege kümmert sich um ein Benutzerskript, das der Seite Funktionen hinzufügt.  Wir nehmen den nodejs-Server, verbinden Express, fügen MySQL hinzu.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Setzen Sie Sequelize auf</a> .  Und wir werden mit Telegram über <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Node-Telegram-Bot-API</a> interagieren: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    const app = express(); // ... //   //    app.get("/dinners/user_menu", dinner.getUserMenu); //      app.get("/dinners/r/:id", dinner.getPersonalRatings); //   app.post("/dinners/r/:id", dinner.setRating); //      Telegram app.post("/dinners/resend/:id", dinner.resendMessage); //      app.post("/dinners/order", dinner.order); //  ,      app.post("/dinners/days", dinner.setDinnerDays);</span></span></code> </pre> <br>  Kurz zur Funktionalität: <br>  Das path <i>/ dinners / user_menu</i> gibt ein Benutzerskript zurück: <br><br><pre> <code class="javascript hljs">res.sendFile(__dirname + <span class="hljs-string"><span class="hljs-string">'/public_html/user_script.js'</span></span>);</code> </pre><br>  Dies geschieht, um Kollegen, die es verwenden, nicht durch die Installation einer neuen Version des Skripts abzulenken.  Korrigiert - auf den Server geworfen - alle aktualisiert. <br><br>  Ja, ich weiß, dass dies aus Sicherheitsgründen schlecht ist, aber die Funktionalität selbst ist nicht kritisch und wir werden den Server, auf dem das Skript gespeichert ist, als ziemlich sicher betrachten. <br><br>  Außerdem können Sie auf dem Pfad <i>/ dinners / r /: id</i> eine Bewertung für alle Positionen abrufen und die Bewertung speichern, dh für Gerichte stimmen. <br><br>  Der Pfad <i>/ dinners / resend /: id</i> dient dazu, eine Nachricht an Telegram zu senden.  Der Nachrichtentext wird auf dem Client generiert, nur die Interaktion mit Telegramm findet auf dem Server statt: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> parseMode: TelegramBot.SendMessageOptions = {<span class="hljs-attr"><span class="hljs-attr">parse_mode</span></span>: <span class="hljs-string"><span class="hljs-string">"HTML"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bot.sendMessage(telegramId, htmlMessage, {...options, ...parseMode});</code> </pre><br>  Danach sendet der Bot eine Nachricht mit der Bestellung. <br><br><img src="https://habrastorage.org/webt/wx/rb/uv/wxrbuv4-_nexpcmsavuenefuvwa.png" alt="Bild"><br><br>  Als nächstes wird entlang des Pfades <i>/ Abendessen / Bestellung</i> die <i>Bestellung</i> gespeichert.  Da die ursprüngliche Bestellanforderung schwer zu ermitteln ist (nach Klicken auf die Schaltfläche "Speichern" wird eine Warnmeldung mit der Schaltfläche "Bestellbestätigung" angezeigt), wird die Anforderung für den Server mit Bestellungen gesendet, wenn die Bestellseite geladen wird (und das gesamte Bestellsystem auf der Website ist in zwei Seiten unterteilt - Bestellseite und Menüseite - Auswahl der Gerichte für einen bestimmten Tag (dh die Bildung der Reihenfolge).  Es ist absolut nicht sinnvoll, Anfragen jedes Mal zu senden, wenn Sie die Bestellseite aufrufen, aber es gab keine bessere Option für einen Snap. <br><br>  Schließlich legt der Pfad <i>/ dinners / days</i> die Tage fest, an denen das Mittagessen bestellt werden soll.  Dieser Teil der Funktionalität wurde für die korrekte Ausführung von Erinnerungen an eine unfertige Bestellung angezeigt. Sie müssen wissen, wie viel Uhr der nächste Tag der Bestellung ist (es gibt Wochenenden und Feiertage in der Mitte der Woche).  Anstatt die Implementierung des Produktionskalenders zu übernehmen, analysiere ich einfach die Daten auf der Bestellseite, auf der die Arbeitstage und die arbeitsfreien Tage bereits markiert sind (Sie können keine Bestellung für einen arbeitsfreien Tag aufgeben).  Mit der isHoliday-Klasse werden arbeitsfreie Tage auf dem Portal gekennzeichnet: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     const trToday = $(".dinner_today")[0]; const tbodyAllDays = $(trToday).parent(); const dinnerDays = []; $(tbodyAllDays).children().each(async function() { if ($(this).hasClass("isHoliday")) { return; } const itemMenuDate = $(this).find("&gt; td:first-child").text().substring(0, 10); dinnerDays.push(itemMenuDate); // ... }); await sendRequest("POST", `https://****/dinners/days/`, {days: dinnerDays});</span></span></code> </pre><br>  Oh ja, benutze jQuery zum Pflücken.  Es ist sehr praktisch, in den Seitenbaum einzutauchen. <br><br><h4>  Telegramm Bot </h4><br>  Ein weiterer Teil des gesamten Add-Ons ist der Telegramm-Bot. <br><br><img src="https://habrastorage.org/webt/24/wf/ek/24wfekdwtsuscjixrrguvl55nam.png" alt="Bild"><br>  <i>Mit einer solchen Funktionalität</i> <br><br>  Das Erhalten eines Ausweises ist ein solches Identifikationssystem.  So ordnen Sie der Benutzer-ID im Telegramm ein Benutzerskript in einem bestimmten Browser zu. <br><br>  Sehen Sie sich die Bestellung für heute an, sehen Sie sich die Liste der Bestellungen an (die letzten 5) und legen Sie eine Erinnerung fest. <br>  Das Mittagessen wird automatisch jeden Tag zur gleichen Zeit an den Lieferanten gesendet. Daher ist es wichtig, eine Bestellung vor einer bestimmten Zeit, beispielsweise um 13:00 Uhr, aufzugeben. <br><br>  Danach ist die Bestellmöglichkeit gesperrt. <br><br>  Erinnerungen: <br><br><img src="https://habrastorage.org/webt/hr/v2/v5/hrv2v5mfkmx7v8ia6aff9ko9jvc.png" alt="Bild"><br>  <i>Der Bot bietet die Möglichkeit, eine Erinnerungszeit zu wählen: 9, 10 oder 11 Stunden.</i> <br><br>  Wenn Sie nach einer Erinnerung keine Bestellung aufgegeben haben, erinnert Sie der Bot alle 10 Minuten an die Bestellung, bis Sie sie bestellen oder die Bestellung blockiert wird. <br><br>  Dies erledigt die Cron-Task (mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Node-Schedule</a> ): <br><br><pre> <code class="javascript hljs">schedule.scheduleJob(<span class="hljs-string"><span class="hljs-string">'*/10 9-13 * * 1-5'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... });</span></span></code> </pre><br><h4>  Client-Teil.  Menü </h4><br>  Ich wiederhole, dass die aktuelle Oberfläche in Verbindung mit dem Text der Menüpunkte, die der Lieferant sendet, einfach schrecklich ist (siehe Bildschirm 2).  Und irgendwann hört man auf, irgendetwas in Tonnen von eintönigem festem und wenig nützlichem Text zu sehen. <br><br>  Nachdem wir das Internet durchsucht hatten, das uns helfen könnte, stießen wir auf ein ziemlich gutes Plugin für benutzerdefinierte Greasemonkey-Skripte, und sie entschieden sich, es zu verwenden. <br><br>  Zunächst erstellen wir ein Benutzerskript und erteilen das Recht zur Kommunikation mit dem Unternehmensportal und dem Server, auf dem die Bewertung und die Fähigkeit zum Senden von Anforderungen festgelegt sind <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// @include http://****.int/* // @include http://****/* // @grant GM.xmlHttpRequest</span></span></code> </pre><br>  <i>Um</i> die Lunch-Seite selbst zu ändern, haben wir jQuery verwendet und mit <i>// @require verbunden</i> <br><br>  Jetzt fangen wir an, die Mittagsseite zu schaufeln.  Nachdem wir uns den HTML-Code der Seite angesehen haben, finden wir den Bezeichner des Mittagstisches, holen den Tisch und ändern ihn. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> table = $(<span class="hljs-string"><span class="hljs-string">".dinner__innerData"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> categoryList = []; <span class="hljs-comment"><span class="hljs-comment">//      $(table).find(“tbody tr td:nth-child(2})”).each(function () { const text = $(this).text(); //           if (!categoryList.find(name =&gt; name === text)) { $(this).parent().before("&lt;tr&gt;&lt;th colspan='6'&gt;" + text + "&lt;/th&gt;&lt;th style='display:none'&gt;&lt;/th&gt;&lt;th style='display:none'&gt;&lt;/th&gt;&lt;th style='display:none'&gt;0&lt;/th&gt;&lt;th style='display:none'&gt;&lt;span class='dish__amount'&gt;0&lt;/span&gt;&lt;/th&gt;&lt;/tr&gt;"); categoryList.push(text); } }); //      $(table).find(“thead th:nth-child(2)”).remove(); $(table).find("tbody tr td:nth-child(2)”).remove(); //     $(table).find(“tbody tr td:nth-child(2)”).after("&lt;td&gt;&lt;/td&gt;"); $(table).find(“thead th:nth-child(2)”).after("&lt;th class='ui-state-default'&gt;&lt;/th&gt;");</span></span></code> </pre><br>  Ich möchte darauf hinweisen, dass bei der Berechnung des Bestellbetrags auf der Seite für die Mittagspause alle Zeilen der Tabelle berücksichtigt werden, wobei die Nummer des bestellten Artikels multipliziert mit dem Preis angegeben wird.  Aus diesen Gründen, wenn Sie eine Zeile mit dem Namen der Kategorie hinzufügen, wird alles kaputt gehen ... Ich musste für diese Zeile ausgeblendete Spalten mit einer Menge und einem Betrag von Null eingeben. <br><br>  Lassen Sie uns nun den Text bereinigen und Informationen zur Bewertung des Gerichts hinzufügen.  Zunächst einige Hilfsfunktionen.  Das Gericht in der Bewertung wird mit seinem Namen ohne Müll in Form von Gramm, Satzzeichen und Leerzeichen identifiziert.  Das heißt, ein Gericht namens „Hühnerbrühe mit Ei (Hühnerbrühe, Karotten, Zwiebeln, Eier, Gemüse).  In 100 g: Proteine-3,43;  Fette-2,86;  Kohlenhydrate-1,0;  en.value-43.39kcal (200gr) “wird als„ Brühquark “bezeichnet.  Dies liegt an der Tatsache, dass sich der Lieferant in zusätzliche Räume, Schilder und etwas anderes einschleichen kann.  Wie die Praxis gezeigt hat, war dies in 90% der Fälle ausreichend, um das Gericht genau zu identifizieren, und wir entschieden uns, keine Mühe zu machen und eine Volltextsuche durchzuführen. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** *         * @param items   * @param tdText    * @return   */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">items, tdText</span></span></span><span class="hljs-function">) </span></span>{ tdText = clearTrash(tdText, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items.find(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{clear_name}</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> clear_name.trim().toLowerCase() === tdText; }); } <span class="hljs-comment"><span class="hljs-comment">/** *     * @param text  * @param clearDescr       * @param clearGrams    * @return    */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearTrash</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text, clearDescr, clearGrams, clearSymbols</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,       }</span></span></code> </pre><br>  Und das ist die Bildung eines Ratings: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> table = $(<span class="hljs-string"><span class="hljs-string">".dinner__innerData"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nameTd = $(table).find(“tr td:nth-child(<span class="hljs-number"><span class="hljs-number">2</span></span>)”); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span>; index &lt;= nameTd.length; index++) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tdText = $(nameTd[index]).text(); <span class="hljs-comment"><span class="hljs-comment">//     const item = findByName(items, tdText); if (item) { let ratingTd = $(nameTd[index]).parent().find(“td:nth-child(2)”)[0]; //           let ratingText = "&lt;i&gt;&lt;/i&gt; " + parseFloat(item.avgrating).toFixed(1) + " (: " + item.orders + ", : " + item.ratingsCount + ")"; ratingText = item.persrating ? `&lt;b&gt;&lt;i&gt;&lt;/i&gt; ${parseFloat(item.persrating).toFixed(1)} (: ${item.perscount})&lt;/b&gt;&lt;br&gt;` + ratingText : ratingText; //   $(ratingTd).css({ // getColorRating       background: getColorRating(item.avgrating) }).html(ratingText); } //           //   ,      const grams = getGrams(tdText); //     $(nameTd[index]).html(clearTrash(tdText, false, true, false)); //      ,       $(nameTd[index]).append("&lt;br/&gt;&lt;span&gt;&lt;/span&gt;") .find("span") .append(grams) .css({"font-size": 10}); }</span></span></code> </pre><br>  Und genau das ist passiert. <br><br><img src="https://habrastorage.org/webt/2p/hh/i5/2phhi5w3iumlfgvezwl7uqvb-2k.png" alt="Bild"><br>  <i>Stimmen Sie zu, viel schöner und bequemer?</i> <br><br><h4>  Client-Teil.  Abstimmung </h4><br>  Als Nächstes werden wir die Möglichkeit hinzufügen, für die bestellten Gerichte abzustimmen und eine Nachricht mit der Bestellung zum Telegramm zu senden. <br><br><img src="https://habrastorage.org/webt/mj/xe/vm/mjxevmjk1xjpktpmhzsvfqv7-zu.png" alt="Bild"><br>  <i>Seite mit Bestellungen ohne Skript</i> <br><br>  Fügen Sie auf der Seite der bestellten Gerichte die Bewertung hinzu: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addRatingForm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> table = $(<span class="hljs-string"><span class="hljs-string">".dinner__innerData"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nameTd = $(table).find(<span class="hljs-string"><span class="hljs-string">"tr td:nth-child(1)"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   for (let index = 0; index &lt;= nameTd.length; index++) { const tdText = $(nameTd[index]).text(); $(nameTd[index]).html(clearTrash(tdText, false, true, false)); } //       Telegram $(table).append("&lt;tfoot&gt;&lt;tr&gt;&lt;th colspan='6' class='rating-buttons btn-group margT0' style='display: table-cell;'&gt;&lt;/tr&gt;&lt;/tfoot&gt;"); $(".rating-buttons").prepend(`&lt;input type="submit" value="" class="btn_primary rating-button"&gt;`); $(".rating-buttons").prepend(`&lt;input type="submit" value=" Telegram" class="btn_primary send-button"&gt;`); //      await diableButtonByDate(); //      for (let index = 0; index &lt;= table.length; index++) { $(table[index]).find("tbody tr td:nth-child(4)").after("&lt;td class='ratingInputTd'&gt;&lt;input id='horizontal-spinner' class='ui-spinner-input' style='width:20px;'&gt;&lt;/td&gt;"); $(table[index]).find("thead th:nth-child(4)").after("&lt;th class='ui-state-default'&gt;&lt;/th&gt;"); } $(".ui-spinner-input").spinner({ max: 10, min: 1 }); //   $(".rating-button").click(sendRating); $(".send-button").click(sendTelegram); } /** *      ,    */ async function diableButtonByDate() { //             . //              const buttons = $(".rating-button"); for (let index = 0; index &lt;= buttons.length; index++) { const button = $(buttons[index]); const date = button.parent().parent().parent().parent().parent().parent().find("&gt; td:nth-child(1)").text().substring(0, 10); if (await GM.getValue(date)) { button.attr({disabled: "disabled"}); } } } /** *  */ async function sendRating(event) { event.preventDefault(); const items = []; //         $(this).parent().parent().parent().parent().find("tr").each(function () { const tdList = $(this).find("td"); const ratingInput = $(tdList[4]).find("input"); if (!ratingInput.length) { return; } items.push({ count: $(tdList[2]).text(), price: $(tdList[1]).text(), name: $(tdList[0]).text(), rating: ratingInput.val(), }); }); await sendRequest("POST", `https://****/dinners/r/${telegramId}`, items); const menuDate = $(this).parent().parent().parent().parent().parent().parent().find("&gt; td:nth-child(1)").text().substring(0, 10); await GM.setValue(menuDate, true); location.reload(); }</span></span></code> </pre><br>  Und hier ist, was wir am Ausgang haben: <br><br><img src="https://habrastorage.org/webt/1k/uq/ef/1kuqefnumbp3k_qu3ugottb5sd0.png" alt="Bild"><br><br>  Ja - der Code ist schrecklich.  Ja - nicht optimiert.  Und ja - an manchen Stellen unlogisch.  Der Zeitaufwand war jedoch minimal, und die Funktionalität und der Komfort nahmen erheblich zu. <br><br>  Das Ziel war es, die Bestellung des Abendessens für mich und meine Kameraden angenehmer zu gestalten, und dieses Ziel wurde meiner Meinung nach erreicht. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de475892/">https://habr.com/ru/post/de475892/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de475880/index.html">7 kostenlose Kurse für Microsoft Solution Architects</a></li>
<li><a href="../de475882/index.html">JavaFX Tutorial: Grundlegende Layouts</a></li>
<li><a href="../de475884/index.html">Lösen des Problems von gezackten Linien in Verläufen</a></li>
<li><a href="../de475886/index.html">Mit Amazon AI ist es ganz einfach, von Nutzern obszöne Inhalte zu verarbeiten</a></li>
<li><a href="../de475888/index.html">Vorteile der Wolkengesichtserkennung</a></li>
<li><a href="../de475894/index.html">Drei-Pass-Protokolle</a></li>
<li><a href="../de475896/index.html">Voller I / O-Naked-C-Reaktor</a></li>
<li><a href="../de475900/index.html">Die 6 neuesten Azure-Kurse</a></li>
<li><a href="../de475902/index.html">Workflow Core - eine Business Process Engine für .Net Core</a></li>
<li><a href="../de475904/index.html">5 Notizen für den neuen Manager</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>