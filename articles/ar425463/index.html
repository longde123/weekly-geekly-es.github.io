<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ด ๐ง๐ฟ ุฎุฑุงุฆุท Unity Hexagon: ุงูููุงู ูุงููุนุงูู ูุฌุฏุฑุงู ุงูููุนุฉ ๐ ๐บ ๐จ๐ผโ๐ค</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงูุฃุฌุฒุงุก 1-3: ุงูุดุจูุฉ ูุงูุฃููุงู ูุงุฑุชูุงุนุงุช ุงูุฎููุฉ 

 ุงูุฃุฌุฒุงุก 4-7: ุงููุทุจุงุช ูุงูุฃููุงุฑ ูุงูุทุฑู 

 ุงูุฃุฌุฒุงุก 8-11: ุงููุงุก ูุงูุฃุดูุงู ุงูุฃุฑุถูุฉ ูุงูุฃุณูุงุฑ 

 ุงูุฃุฌุฒุงุก 12-1...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฎุฑุงุฆุท Unity Hexagon: ุงูููุงู ูุงููุนุงูู ูุฌุฏุฑุงู ุงูููุนุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/425463/" style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฃุฌุฒุงุก 1-3: ุงูุดุจูุฉ ูุงูุฃููุงู ูุงุฑุชูุงุนุงุช ุงูุฎููุฉ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฃุฌุฒุงุก 4-7: ุงููุทุจุงุช ูุงูุฃููุงุฑ ูุงูุทุฑู</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฃุฌุฒุงุก 8-11: ุงููุงุก ูุงูุฃุดูุงู ุงูุฃุฑุถูุฉ ูุงูุฃุณูุงุฑ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฃุฌุฒุงุก 12-15: ุงูุญูุธ ูุงูุชุญููู ุ ุงูููุงู ุ ุงููุณุงูุงุช</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฃุฌุฒุงุก 16-19: ุฅูุฌุงุฏ ุงูุทุฑูู ููุฑู ุงููุงุนุจูู ูุงูุฑุณูู ุงููุชุญุฑูุฉ</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฃุฌุฒุงุก 20-23: ุถุจุงุจ ุงูุญุฑุจ ุ ุจุญุซ ุงูุฎุฑุงุฆุท ุ ุงูุฌูู ุงูุฅุฌุฑุงุฆู</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฃุฌุฒุงุก 24-27: ุฏูุฑุฉ ุงููุงุก ุ ุงูุชุขูู ุ ุงูููุงุทู ุงูุฃุญูุงุฆูุฉ ุ ุงูุฎุฑูุทุฉ ุงูุฃุณุทูุงููุฉ</a> <br><br><h1 style=";text-align:right;direction:rtl">  ุงูุฌุฒุก ุงูุซุงูู: ุงููุงุก </h1><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฃุถู ุงููุงุก ุฅูู ุงูุฎูุงูุง. </li><li style=";text-align:right;direction:rtl">  ุชุซููุซ ุณุทุญ ุงููุงุก. </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ุชุตูุญ ูุน ุงูุฑุบูุฉ. </li><li style=";text-align:right;direction:rtl">  ุงุฌูุน ุจูู ุงูููุงู ูุงูุฃููุงุฑ. </li></ul><br>  ููุฏ ุฃุถููุง ุจุงููุนู ุฏุนู ุงูููุฑ ุ ููู ูุฐุง ุงูุฌุฒุก ุณูุบูุฑ ุงูุฎูุงูุง ูู ุงููุงุก ุชูุงููุง. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/2a9/73c/b6e/2a973cb6eb97eba7d04a325f3ac89a3e.jpg"></div><br>  <i>ุงููุงุก ูุงุฏู.</i> <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  ูุณุชูู ุงููุงุก </h2><br>  ุฃุณูู ุทุฑููุฉ ูู ุชูููุฐ ุฏุนู ุงูููุงู ุนู ุทุฑูู ุชุนูููู ุนูู ููุณ ุงููุณุชูู.  ุฌููุน ุงูุฎูุงูุง ุงูุชู ููู ุงุฑุชูุงุนูุง ุนู ูุฐุง ุงููุณุชูู ูุบููุฑุฉ ูู ุงููุงุก.  ูููู ุงูุทุฑููุฉ ุงูุฃูุซุฑ ูุฑููุฉ ูู ุงูุญูุงุธ ุนูู ุงูููุงู ุนูู ุงุฑุชูุงุนุงุช ูุฎุชููุฉ ุ ูุฐูู ุฏุนููุง ูุฌุนู ูุณุชูู ุงูููุงู ูุชุบูุฑูุง.  ููุฐุง ุ ูุญุชุงุฌ <code>HexCell</code> ุฅูู ูุฑุงูุจุฉ ูุณุชูู ุงููุงุก. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> WaterLevel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> waterLevel; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (waterLevel == <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } waterLevel = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Refresh(); } } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> waterLevel;</code> </pre> <br>  ุฅุฐุง ุฑุบุจุช ูู ุฐูู ุ ููููู ุงูุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ููุฒุงุช ูุนููุฉ ููุชุฎููู ุชุญุช ุงููุงุก.  ููู ูู ุงูููุช ุงูุญุงูู ูู ุฃูุนู ุฐูู.  ุฃุดูุงุก ูุซู ุงูุทุฑู ุชุญุช ุงููุงุก ุชูุงุณุจูู.  ูููู ุงุนุชุจุงุฑูุง ููุงุทู ุบูุฑุชูุง ุงูููุงู ูุคุฎุฑูุง. <br><br><h3 style=";text-align:right;direction:rtl">  ุฎูุงูุง ุงูููุถุงู </h3><br>  ุงูุขู ุจุนุฏ ุฃู ูุตููุง ุฅูู ูุณุชููุงุช ุงูููุงู ุ ูุฅู ุงูุณุคุงู ุงูุฃูุซุฑ ุฃูููุฉ ูู ูุง ุฅุฐุง ูุงูุช ุงูุฎูุงูุง ุชุญุช ุงููุงุก.  ุงูุฎููุฉ ุชุญุช ุงููุงุก ุฅุฐุง ูุงู ูุณุชูู ุงููุงุก ููู ุงุฑุชูุงุนูุง.  ููุญุตูู ุนูู ูุฐู ุงููุนูููุงุช ุ ุณูุถูู ุฎุงุตูุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsUnderwater { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> waterLevel &gt; elevation; } }</code> </pre> <br>  ูุฐุง ูุนูู ุฃูู ุนูุฏูุง ูููู ูุณุชูู ุงููุงุก ูุงุฑุชูุงุนู ูุชุณุงูููู ุ ุชุฑุชูุน ุงูุฎููุฉ ููู ุงููุงุก.  ุฃู ุฃู ุงูุณุทุญ ุงูุญูููู ูููุงุก ุฃูู ูู ูุฐุง ุงูุงุฑุชูุงุน.  ููุง ูู ุงูุญุงู ูุน ุฃุณุทุญ ุงูุฃููุงุฑ ุ ุฏุนูุง ูุถูู ููุณ ุงูุฅุฒุงุญุฉ - <code>HexMetrics.riverSurfaceElevationOffset</code> .  ูู ุจุชุบููุฑ ุงุณูู ุฅูู ุงุณู ุฃูุซุฑ ุนููููุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// public const float riverSurfaceElevationOffset = -0.5f; public const float waterElevationOffset = -0.5f;</span></span></code> </pre> <br>  ูู ุจุชุบููุฑ <code>HexCell.RiverSurfaceY</code> ุจุญูุซ ูุณุชุฎุฏู ุงูุงุณู ุงูุฌุฏูุฏ.  ุซู ูุถูู ุฎุงุตูุฉ ูุดุงุจูุฉ ูุณุทุญ ุงููุงุก ููุฎููุฉ ุงููุบููุฑุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> RiverSurfaceY { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (elevation + HexMetrics.waterElevationOffset) * HexMetrics.elevationStep; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> WaterSurfaceY { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (waterLevel + HexMetrics.waterElevationOffset) * HexMetrics.elevationStep; } }</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  ุชุญุฑูุฑ ุงููุงุก </h3><br>  ุชุนุฏูู ูุณุชูู ุงููุงุก ูุดุงุจู ูุชุบููุฑ ุงูุงุฑุชูุงุน.  ูุฐูู ุ ูุฌุจ ุนูู <code>HexMapEditor</code> ูุฑุงูุจุฉ ูุณุชูู ุงููุงุก ุงููุดุท ููุง ุฅุฐุง ูุงู ูุฌุจ ุชุทุจููู ุนูู ุงูุฎูุงูุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeElevation; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeWaterLevel; โฆ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyElevation = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyWaterLevel = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</code> </pre><br>  ุฃุถู ุทุฑููุง ูุฑุจุท ูุฐู ุงููุนููุงุช ุจูุงุฌูุฉ ุงููุณุชุฎุฏู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplyWaterLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applyWaterLevel = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetWaterLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { activeWaterLevel = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)level; }</code> </pre> <br>  ูุฃุถู ูุณุชูู ุงููุงุก ุฅูู <code>EditCell</code> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyElevation) { cell.Elevation = activeElevation; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyWaterLevel) { cell.WaterLevel = activeWaterLevel; } โฆ } }</code> </pre> <br>  ูุฅุถุงูุฉ ูุณุชูู ููุงู ุฅูู ูุงุฌูุฉ ุงููุณุชุฎุฏู ุ ูู ุจุชูุฑุงุฑ ุงูุชุณููุฉ ูุดุฑูุท ุชูุฑูุฑ ุงูุงุฑุชูุงุน ุ ุซู ูู ุจุชุบููุฑูุง.  ุชุฐูุฑ ุฅุฑูุงู ุฃุญุฏุงุซูู ุจุงูุทุฑู ุงูููุงุณุจุฉ. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/42b/a13/de4/42ba13de4120b43e460628021c77d99f.png"></div><br>  <i>ููุฒูู ูุณุชูู ุงูููุงู.</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุญุฒูุฉ ุงููุญุฏุฉ</a> <br><br><h2 style=";text-align:right;direction:rtl">  ุชุซููุซ ุงููุงุก </h2><br>  ูุชุซููุซ ุงูููุงู ุ ูุญุชุงุฌ ุฅูู ุดุจูุฉ ุฌุฏูุฏุฉ ุจููุงุฏ ุฌุฏูุฏุฉ.  ุฃููุงู ุ ูู ุจุฅูุดุงุก ุชุธููู <em>ุงูููุงู</em> ุ ููุฑุฑุฉ ุชุธููู <em>ุงูููุฑ</em> .  ูู ุจุชุบููุฑู ุจุญูุซ ูุณุชุฎุฏู ุฎุงุตูุฉ ุงูููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">Shader "Custom/Water" { Properties { _Color ("Color", Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex ("Albedo (RGB)", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Glossiness ("Smoothness", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.5</span></span> _Metallic ("Metallic", Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.0</span></span> } SubShader { Tags { "RenderType"="Transparent" "Queue"="Transparent" } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> CGPROGRAM #pragma surface surf Standard alpha #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> sampler2D _MainTex; struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; }; half _Glossiness; half _Metallic; fixed4 _Color; <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { fixed4 c = _Color; o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; } ENDCG } FallBack "Diffuse" }</code> </pre> <br>  ูู ุจุฅูุดุงุก ูุงุฏุฉ ุฌุฏูุฏุฉ ุจุงุณุชุฎุฏุงู ูุฐุง ุงูุชุธููู ุนู ุทุฑูู ูุถุงุนูุฉ ูุงุฏุฉ <em>ุงููุงุก</em> ูุงุณุชุจุฏุงููุง ุจุธู.  ุงุชุฑู ูุณูุฌ ุงูุถุฌูุฌ ุ ูุฃููุง ุณูุณุชุฎุฏูู ูุงุญููุง. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/fd9/238/283/fd9238283d92bacd26a3ff5dce73b17b.png"></div><br>  <i>ููุงุฏ ูุงุฆูุฉ.</i> <br><br>  ุฃุถู ุทูููุง ุฌุฏูุฏูุง ุฅูู ุงูุจุงุฏุฆุฉ ูู ุฎูุงู ุชูุฑุงุฑ ุทูู <em>ุงูุฃููุงุฑ</em> .  ูุง ูุญุชุงุฌ ุฅูู ุฅุญุฏุงุซูุงุช ููุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ ุ ููุฌุจ ุนููู ุงุณุชุฎุฏุงู <em>ุงููุงุก</em> .  ูุงูุนุงุฏุฉ ุ ุณููุนู ุฐูู ุนู ุทุฑูู ุฅูุดุงุก ูุซูู ูู ุงูุฌุงูุฒุฉ ุ ูุชุบููุฑู ุ ุซู ุชุทุจูู ุงูุชุบููุฑุงุช ุนูู ุงูุฌุงูุฒุฉ.  ุจุนุฏ ุฐูู ุ ุชุฎูุต ูู ุงููุซุงู. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/6ec/6e6/82f/6ec6e682f16c604d75c0e5b835d5b03e.png"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/7c5/3f3/eeb/7c53f3eeb282e533f9f0b8a20e813091.png"></div><br>  <i>ูุงุฆู ูุงุฆู ูุงุฆู.</i> <br><br>  ุจุนุฏ ุฐูู ุ ุฃุถู ุฏุนู ุดุจูุฉ ุงูููุงู ุฅูู <code>HexGridChunk</code> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain, rivers, roads, water; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); roads.Clear(); water.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); roads.Apply(); water.Apply(); }</code> </pre> <br>  ูุฑุจุทูุง ุจุงูุทูู ุงูุฌุงูุฒ. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b4d/19a/76a/b4d19a76a745d550314b277fd2c0e13c.png"></div><br>  <i>ุชู ุชูุตูู ูุงุฆู ุงููุงุก.</i> <br><br><h3 style=";text-align:right;direction:rtl">  ูุณุฏุณ ุงููุงุก </h3><br>  ุจูุง ุฃู ุงููุงุก ูุดูู ุทุจูุฉ ุซุงููุฉ ุ ูููููุญู ุทุฑููุฉ ุงูุชุซููุซ ุงูุฎุงุตุฉ ุจูุง ููู ุงุชุฌุงู.  ูุญุชุงุฌ ุฅูู ุชุณููุชูุง ููุท ุนูุฏูุง ุชููู ุงูุฎููุฉ ูุบููุฑุฉ ูู ุงููุงุก. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsUnderwater) { TriangulateWater(direction, cell, center); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br>  ููุง ูู ุงูุญุงู ูุน ุงูุฃููุงุฑ ุ ูุง ูุฎุชูู ุงุฑุชูุงุน ุณุทุญ ุงููุงุก ูุซูุฑูุง ูู ุงูุฎูุงูุง ุจููุณ ูุณุชูู ุงููุงุก.  ูุฐูู ุ ูุง ูุจุฏู ุฃููุง ุจุญุงุฌุฉ ุฅูู ุงูุฃุถูุงุน ุงููุนูุฏุฉ.  ุณูููู ูุซูุซ ุจุณูุท ูุงูููุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { center.y = cell.WaterSurfaceY; Vector3 c1 = center + HexMetrics.GetFirstSolidCorner(direction); Vector3 c2 = center + HexMetrics.GetSecondSolidCorner(direction); water.AddTriangle(center, c1, c2); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/a51/72b/99b/a5172b99ba382c6e79abff653e4b7fb2.png"></div><br>  <i>ูุณุฏุณ ุงููุงุก.</i> <br><br><h3 style=";text-align:right;direction:rtl">  ูุฑูุจุงุช ุงููุงุก </h3><br>  ูููููุง ุฑุจุท ุงูุฎูุงูุง ุงููุฌุงูุฑุฉ ุจุงููุงุก ุจุฑุจุน ูุงุญุฏ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> water.AddTriangle(center, c1, c2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { HexCell neighbor = cell.GetNeighbor(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || !neighbor.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Vector3 bridge = HexMetrics.GetBridge(direction); Vector3 e1 = c1 + bridge; Vector3 e2 = c2 + bridge; water.AddQuad(c1, c2, e1, e2); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/0a6/3af/949/0a63af9496da925e966b008f41f808a8.png"></div><br>  <i>ูุตูุงุช ุญูุงู ุงููุงุก.</i> <br><br>  ูุงููุฃ ุงูุฒูุงูุง ุจูุซูุซ ูุงุญุฏ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE) { โฆ water.AddQuad(c1, c2, e1, e2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E) { HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || !nextNeighbor.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } water.AddTriangle( c2, e2, c2 + HexMetrics.GetBridge(direction.Next()) ); } }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c32/37e/5b4/c3237e5b4e492f9a1c334f90aaa88ee4.png"></div><br>  <i>ููุงุตู ุฒูุงูุง ุงูููุงู.</i> <br><br>  ุงูุขู ูุฏููุง ุฎูุงูุง ูุงุฆูุฉ ูุชุตูุฉ ุนูุฏูุง ุชููู ูุฑูุจุฉ.  ูุชุฑููู ูุฌูุฉ ุจูููู ูุจูู ุงูุฎูุงูุง ุงูุฌุงูุฉ ุจุงุฑุชูุงุน ุฃุนูู ุ ููููุง ุณูุชุฑู ูุฐุง ูููุช ูุงุญู. <br><br><h3 style=";text-align:right;direction:rtl">  ููุณู ูุณุชููุงุช ุงูููุงู </h3><br>  ุงูุชุฑุถูุง ุฃู ุงูุฎูุงูุง ุชุญุช ุงููุงุก ุงููุฌุงูุฑุฉ ููุง ููุณ ูุณุชูู ุงููุงุก.  ุฅุฐุง ูุงู ุงูุฃูุฑ ูุฐูู ุ ูุฅู ูู ุดูุก ูุจุฏู ุฌูุฏูุง ุ ูููู ุฅุฐุง ุชู ุงูุชูุงู ูุฐุง ุงูุงูุชุฑุงุถ ุ ุชุญุฏุซ ุฃุฎุทุงุก. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/fcf/a8b/b4f/fcfa8bb4fb960ddc788d358e60f9023f.png"></div><br>  <i>ูุณุชููุงุช ููุงู ุบูุฑ ูุชูุงุณูุฉ.</i> <br><br>  ูููููุง ุฃู ูุฌุนู ุงููุงุก ูุจูู ุนูู ููุณ ุงููุณุชูู.  ุนูู ุณุจูู ุงููุซุงู ุ ุนูุฏูุง ูุชุบูุฑ ูุณุชูู ุงูููุงู ูุฎููุฉ ูุบููุฑุฉ ุ ูููููุง ูุดุฑ ุงูุชุบููุฑุงุช ุนูู ุงูุฎูุงูุง ุงููุฌุงูุฑุฉ ูู ุฃุฌู ุงูุญูุงุธ ุนูู ุชุฒุงูู ุงููุณุชููุงุช.  ููุน ุฐูู ุ ูุฌุจ ุฃู ุชุณุชูุฑ ูุฐู ุงูุนูููุฉ ุญุชู ุชูุงุฌู ุฎูุงูุง ุบูุฑ ูุบููุฑุฉ ูู ุงููุงุก.  ุชุญุฏุฏ ูุฐู ุงูุฎูุงูุง ุญุฏูุฏ ูุชูุฉ ุงููุงุก. <br><br>  ุฎุทุฑ ูุฐุง ุงูููุฌ ูู ุฃูู ูููู ุฃู ูุฎุฑุฌ ุนู ุงูุณูุทุฑุฉ ุจุณุฑุนุฉ.  ุฅุฐุง ูุงู ุงูุชุญุฑูุฑ ุบูุฑ ูุงุฌุญ ุ ูููู ุฃู ูุบุทู ุงููุงุก ุงูุฎุฑูุทุฉ ุจุฃููููุง.  ุซู ูุฌุจ ุฃู ูุชู ุชุซููุซ ุฌููุน ุงูุฃุฌุฒุงุก ูู ููุช ูุงุญุฏ ุ ููุง ุณูุคุฏู ุฅูู ููุฒุฉ ูุจูุฑุฉ ูู ุงูุชุฃุฎูุฑ. <br><br>  ูุฐูู ุฏุนููุง ูุง ููุนู ุฐูู ุจุนุฏ.  ูููู ุฅุถุงูุฉ ูุฐู ุงูููุฒุฉ ูู ูุญุฑุฑ ุฃูุซุฑ ุชุนููุฏูุง.  ุจูููุง ุงุชุณุงู ูุณุชููุงุช ุงูููุงู ุ ูุชุฑู ุถููุฑ ุงููุณุชุฎุฏู. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">ุญุฒูุฉ ุงููุญุฏุฉ</a> <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุฑุณูู ุงููุชุญุฑูุฉ ุงููุงุฆูุฉ </h2><br>  ุจุฏูุงู ูู ููู ููุญุฏ ุ ุณูุฎูู ุดูุฆูุง ูุดุจู ุงูููุฌุงุช.  ููุง ูู ุงูุญุงู ูู ุฃุฌูุฒุฉ ุชุธููู ุฃุฎุฑู ุ ูู ุงูููุช ุงูุญุงูู ูู ูุณุนู ุฌุงูุฏูู ููุญุตูู ุนูู ุฑุณููุงุช ุฌูููุฉ ุ ูุญุชุงุฌ ููุท ุฅูู ุชุนููู ุงูุฃููุงุฌ. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ca1/a2f/1f9/ca1a2f1f978cd2f2993a96b44440227b.png"></div><br>  <i>ุงููุงุก ุงููุณุทุญ ุชูุงูุง.</i> <br><br>  ุฏุนููุง ููุนู ูุง ูุนููุงู ูุน ุงูุฃููุงุฑ.  ูุญู ูุฎุชุจุฑ ุงูุถูุถุงุก ูุน ูููุน ุงูุนุงูู ููุถููู ุฅูู ููู ููุญุฏ.  ูุชุญุฑูู ุงูุณุทุญ ุ ุฃุถู ุงูููุช ุฅูู ุฅุญุฏุงุซูุงุช V. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float3 worldPos; }; โฆ <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { float2 uv = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz; uv.y += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, uv * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> waves = noise.z; fixed4 c = saturate(_Color + waves); o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>ุงูุชูุฑูุฑ ุงูููุงู ุ ุงูููุช ร 10.</i> <br><br><h3 style=";text-align:right;direction:rtl">  ุงุชุฌุงูุงู </h3><br>  ุญุชู ุงูุขู ูุฐุง ููุณ ูุซู ุงูููุฌุงุช ุนูู ุงูุฅุทูุงู.  ุฏุนููุง ูุนูุฏ ุงูุตูุฑุฉ ุจุฅุถุงูุฉ ุนููุฉ ุถูุถุงุก ุซุงููุฉ <br>  ููุฐู ุงููุฑุฉ ุจุฅุถุงูุฉ ุฅุญุฏุงุซูุงุช U. ูุณุชุฎุฏู ููุงุฉ ุถูุถุงุก ูุฎุชููุฉ ููุญุตูู ุนูู ููุทูู ูุฎุชูููู ูุชูุฌุฉ ูุฐูู.  ุณุชููู ุงูููุฌุงุช ุงูููุงุฆูุฉ ูุฐู ุงูุนูููุชูู ููุฏุณุชูู ูุนูุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> float2 uv1 = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz; uv1.y += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise1 = tex2D(_MainTex, uv1 * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); float2 uv2 = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz; uv2.x += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise2 = tex2D(_MainTex, uv2 * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> waves = noise1.z + noise2.x;</code> </pre> <br>  ุนูุฏ ุฌูุน ููุชุง ุงูุนูููุชูู ุ ูุญุตู ุนูู ูุชุงุฆุฌ ูู ุงููุชุฑุฉ ูู 0 ุฅูู 2 ุ ูุฐุง ูุญุชุงุฌ ุฅูู ุชุบููุฑ ุญุฌููุง ุฅูู 0-1.  ุจุฏูุงู ูู ุชูุณูู ุงูุฃููุงุฌ ุฅูู ูุตููู ุจุจุณุงุทุฉ ุ ูููููุง ุงุณุชุฎุฏุงู ูุธููุฉ <code>smoothstep</code> ููุญุตูู ุนูู ูุชูุฌุฉ ุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู.  ูุถุน ยพ - 2 ุนูู 0โ1 ุญุชู ูุง ุชููู ููุงู ููุฌุงุช ูุฑุฆูุฉ ุนูู ุณุทุญ ุงููุงุก. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs mel"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> waves = noise1.z + noise2.x; waves = <span class="hljs-keyword"><span class="hljs-keyword">smoothstep</span></span>(<span class="hljs-number"><span class="hljs-number">0.75</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, waves);</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>ุงุชุฌุงููู ุ ุงูููุช ร 10.</i> <br><br><h3 style=";text-align:right;direction:rtl">  ููุฌุงุช ุงูุฎูุท </h3><br>  ูุง ูุฒุงู ูู ุงูููุงุญุธ ุฃู ูุฏููุง ููุทู ุถูุถุงุก ูุชุญุฑููู ูุง ูุชุบูุฑุงู ูู ุงููุงูุน.  ุณูููู ูู ุงููุนููู ุฃูุซุฑ ุฅุฐุง ุชุบูุฑุช ุงูุฃููุงุท.  ูููููุง ุชุญููู ุฐูู ูู ุฎูุงู ุงูุงุณุชููุงู ุจูู ุงููููุงุช ุงููุฎุชููุฉ ูุนููุงุช ุงูุถูุถุงุก.  ูููู ูุง ูููู ุงูููุงู ุจุฐูู ุจููุณ ุงูุทุฑููุฉ ุ ูุฅูุง ุณูุชุบูุฑ ุณุทุญ ุงููุงุก ุจุฃูููู ูู ููุช ูุงุญุฏ ุ ููุฐุง ููุญูุธ ุฌุฏูุง.  ุจุฏูุงู ูู ุฐูู ุ ุณูุฎูู ููุฌุฉ ูู ุงูุงุฑุชุจุงู. <br><br>  ุณูููู ุจุฅูุดุงุก ููุฌุฉ ุฎูุท ุจูุณุงุนุฏุฉ ุงูุฌูุจ ุงูุฌูุจู ุ ุงูุฐู ูุชุญุฑู ูุทุฑููุง ุนูู ุทูู ุณุทุญ ุงููุงุก.  ุณูููู ุจุฐูู ุนู ุทุฑูู ุฅุถุงูุฉ ุฅุญุฏุงุซูุงุช ุงูุนุงูู X ู Z ูุงุณุชุฎุฏุงู ุงููุฌููุน ููุฏุฎู ูุฏุงูุฉ <code>sin</code> .  ูู ุจุงูุชุตุบูุฑ ููุญุตูู ุนูู ูุฑู ูุจูุฑุฉ ุจูุง ูููู.  ูุจุงูุทุจุน ุ ุฏุนูุง ูุถูู ููุณ ุงููููุฉ ูุชุญุฑูููุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> blendWave = sin((<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.x + <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.z) * <span class="hljs-number"><span class="hljs-number">0.1</span></span> + _Time.y);</code> </pre> <br>  ุชุชุฑุงูุญ ููุฌุงุช ุงูุฌูุจ ุจูู -1 ู 1 ุ ููุญุชุงุฌ ุฅูู ูุงุตู 0-1.  ููููู ุงูุญุตูู ุนูููุง ุนู ุทุฑูู ุชุฑุจูุน ุงูููุฌุฉ.  ูุฑุคูุฉ ูุชูุฌุฉ ูุนุฒููุฉ ุ ุงุณุชุฎุฏููุง ุจุฏูุงู ูู ุงูููู ุงููุชุบูุฑ ููููุฉ ุงูุฅุฎุฑุงุฌ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> sin((<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.x + <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.z) * <span class="hljs-number"><span class="hljs-number">0.1</span></span> + _Time.y); blendWave *= blendWave; <span class="hljs-type"><span class="hljs-type">float</span></span> waves = noise1.z + noise2.x; waves = smoothstep(<span class="hljs-number"><span class="hljs-number">0.75</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, waves); fixed4 c = blendWave; //saturate(_Color + waves);</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/aa3/3d9/d70/aa33d9d70a022df57a0348423181b258.png"></div><br>  <i>ููุฌุงุช ุงูุฎูุท.</i> <br><br>  ูุฌุนู ููุฌุงุช ุงูุฎูุท ุฃูู ูุถูุญูุง ุ ุฃุถู ุจุนุถ ุงูุถูุถุงุก ูู ููุชุง ุงูุนูููุชูู ุฅูููุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> blendWave = sin( (<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.x + <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.z) * <span class="hljs-number"><span class="hljs-number">0.1</span></span> + (noise1.y + noise2.z) + _Time.y ); blendWave *= blendWave;</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/618/c8f/697/618c8f697cd2e463d7349030277d1a82.png"></div><br>  <i>ููุฌุงุช ุงูุฎูุท ุงููุดููุฉ.</i> <br><br>  ุฃุฎูุฑูุง ุ ูุณุชุฎุฏู ููุฌุฉ ุฎูุท ูุชูุฑูุจ ุจูู ููุงุชู ุนููุงุช ุงูุถูุถุงุก.  ูุฃูุตู ูุฏุฑ ูู ุงูุงุฎุชูุงู ุ ุฎุฐ ุฃุฑุจุน ูููุงุช ูุฎุชููุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs lisp"> float waves = lerp(<span class="hljs-name"><span class="hljs-name">noise1</span></span>.z, noise1.w, blendWave) + lerp(<span class="hljs-name"><span class="hljs-name">noise2</span></span>.x, noise2.y, blendWave)<span class="hljs-comment"><span class="hljs-comment">; waves = smoothstep(0.75, 2, waves); fixed4 c = saturate(_Color + waves);</span></span></code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>ุฃููุงุฌ ุงูุฎูุท ุ ุงูุฒูู ร 2.</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">ุญุฒูุฉ ุงููุญุฏุฉ</a> <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุณุงุญู </h2><br>  ููุฏ ุงูุชูููุง ูู ุงูููุงู ุงูููุชูุญุฉ ุ ููููุง ุงูุขู ุจุญุงุฌุฉ ูููุก ุงููุฌูุฉ ูู ุงูููุงู ุนูู ุทูู ุงูุณุงุญู.  ูุธุฑูุง ูุฃููุง ูุฌุจ ุฃู ูุชูุงูู ูุน ูุนุงูู ุงูุฃุฑุถ ุ ูุฅู ุงูููุงู ุงูุณุงุญููุฉ ุชุชุทูุจ ููุฌูุง ูุฎุชูููุง.  ุฏุนููุง ููุณู <code>TriangulateWater</code> ุฅูู ุทุฑููุชูู - ูุงุญุฏุฉ ููููุงู ุงูููุชูุญุฉ ูุงูุฃุฎุฑู ููุณุงุญู.  ูููู ุนูุฏูุง ูุนูู ูุน ุงูุณุงุญู ุ ูุญุชุงุฌ ุฅูู ุงููุธุฑ ูู ุงูุฎููุฉ ุงููุฌุงูุฑุฉ.  ุฃู ุฃูู ูู <code>TriangulateWater</code> ุณูุญุตู ุนูู ุฌุงุฑ.  ุฅุฐุง ูุงู ููุงู ุฌุงุฑ ูููุณ ุชุญุช ุงููุงุก ุ ููุญู ูุชุนุงูู ูุน ุงูุณุงุญู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { center.y = cell.WaterSurfaceY; HexCell neighbor = cell.GetNeighbor(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (neighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; !neighbor.IsUnderwater) { TriangulateWaterShore(direction, cell, neighbor, center); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateOpenWater(direction, cell, neighbor, center); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateOpenWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { Vector3 c1 = center + HexMetrics.GetFirstSolidCorner(direction); Vector3 c2 = center + HexMetrics.GetSecondSolidCorner(direction); water.AddTriangle(center, c1, c2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE &amp;&amp; neighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// HexCell neighbor = cell.GetNeighbor(direction); // if (neighbor == null || !neighbor.IsUnderwater) { // return; // } Vector3 bridge = HexMetrics.GetBridge(direction); โฆ } } void TriangulateWaterShore ( HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center ) { }</span></span></code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/f04/799/441/f0479944178dcb5646bbf935700a798e.png"></div><br>  <i>ูุง ููุฌุฏ ุชุซููุซ ุนูู ุทูู ุงูุณุงุญู.</i> <br><br>  ุจูุง ุฃู ุงูุณุงุญู ูุดูู ุ ูุฌุจ ุฃู ูุญุฑู ูุซูุซุงุช ุงููุงุก ุนูู ุทูู ุงูุณุงุญู.  ูุฐูู ุ ูุญุชุงุฌ ุฅูู ููู ุงูุญูุงู ููุฑูุญุฉ ุงููุซูุซุงุช. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices e1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( center + HexMetrics.GetFirstSolidCorner(direction), center + HexMetrics.GetSecondSolidCorner(direction) ); water.AddTriangle(center, e1.v1, e1.v2); water.AddTriangle(center, e1.v2, e1.v3); water.AddTriangle(center, e1.v3, e1.v4); water.AddTriangle(center, e1.v4, e1.v5); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/761/283/bbd76128386859bb388e6e2d3f105ff0.png"></div><br>  <i>ูุฑุงูุญ ูุซูุซุงุช ุนูู ุทูู ุงูุณุงุญู.</i> <br><br>  ุงูุชุงูู ูู ุดุฑูุท ูู ุงูุฃุถูุงุน ุ ููุง ูู ุงูุญุงู ูู ุงูุฑุงุญุฉ ุงูุทุจูุนูุฉ.  ููุน ุฐูู ุ ูุง ูุชุนูู ุนูููุง ุฃู ููุตุฑ ุฃููุณูุง ุนูู ููุงุทู ูุนููุฉ ููุท ุ ูุฃููุง ูุฏุนู <code>TriangulateWaterShore</code> ููุท ุนูุฏูุง ููุชูู ุจุงูุณุงุญู ุ ูุงูุฐู ูุญุชุงุฌ ุฅููู ุงูุดุฑูุท ุฏุงุฆููุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> water.AddTriangle(center, e1.v4, e1.v5); Vector3 bridge = HexMetrics.GetBridge(direction); EdgeVertices e2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( e1.v1 + bridge, e1.v5 + bridge ); water.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); water.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); water.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); water.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5);</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/7da/fbc/aa9/7dafbcaa95a4b48509ab68fbf111c703.png"></div><br>  <i>ุฎุทูุท ุงูุฃุถูุงุน ุนูู ุทูู ุงูุณุงุญู.</i> <br><br>  ูุจุงููุซู ุ ูุฌุจ ุฃูุถูุง ุฅุถุงูุฉ ูุซูุซ ุฒุงูู ูู ูู ูุฑุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> water.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { water.AddTriangle( e1.v5, e2.v5, e1.v5 + HexMetrics.GetBridge(direction.Next()) ); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/064/18f/8b1/06418f8b10cc0fc0a4e2276b86375385.png"></div><br>  <i>ุฒูุงูุง ุงูุฃุถูุงุน ุนูู ุทูู ุงูุณุงุญู.</i> <br><br>  ุงูุขู ูุฏููุง ููุงู ุฌุงูุฒุฉ ููุณุงุญู.  ุฌุฒุก ููู ุฏุงุฆููุง ุฃุณูู ุดุจูุฉ ุงูุฅุบุงุซุฉ ุ ูุฐูู ูุง ุชูุฌุฏ ุซููุจ. <br><br><h3 style=";text-align:right;direction:rtl">  ุณุงุญู ููู ุงูุจููุณุฌูุฉ </h3><br>  ูููููุง ุชุฑู ูู ุดูุก ููุง ูู ุ ูููู ุณูููู ูู ุงููุซูุฑ ููุงูุชูุงู ุฅุฐุง ูุงู ููููุงู ุงูุณุงุญููุฉ ุฌุฏูููุง ุงูุฎุงุต.  ุนูู ุณุจูู ุงููุซุงู ุ ุชุฃุซูุฑ ุงูุฑุบูุฉ ุ ุงูุชู ุชุตุจุญ ุฃูุจุฑ ุนูุฏ ุงูุงูุชุฑุงุจ ูู ุงูุณุงุญู.  ูุชูููุฐู ุ ูุฌุจ ุฃู ูุนุฑู ุงูุชุธููู ูุฏู ูุฑุจ ุงูุฌุฒุก ูู ุงูุณุงุญู.  ูููููุง ููู ูุฐู ุงููุนูููุงุช ูู ุฎูุงู ุฅุญุฏุงุซูุงุช ุงูุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ. <br><br>  ุงูููุงู ุงูููุชูุญุฉ ููุณ ููุง ุฅุญุฏุงุซูุงุช ููุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ ุ ููุง ุชุญุชุงุฌ ุฅูู ุฑุบูุฉ.  ููุงู ุญุงุฌุฉ ููุท ููููุงู ุจุงููุฑุจ ูู ุงูุณุงุญู.  ูุฐูู ุ ุชุฎุชูู ูุชุทูุจุงุช ููุง ุงูููุนูู ูู ุงูููุงู ุชูุงููุง.  ุณูููู ูู ุงูููุทูู ุฅูุดุงุก ุดุจูุชู ุงูุฎุงุตุฉ ููู ููุน.  ูุฐูู ุ ูุถูู ุฏุนููุง ููุงุฆู ุดุจูุฉ ุขุฎุฑ ุฅูู HexGridChunk. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain, rivers, roads, water, waterShore; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); roads.Clear(); water.Clear(); waterShore.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); roads.Apply(); water.Apply(); waterShore.Apply(); }</code> </pre> <br>  ุณุชุณุชุฎุฏู ูุฐู ุงูุดุจูุฉ ุงูุฌุฏูุฏุฉ <code>TriangulateWaterShore</code> . <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { โฆ waterShore.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); waterShore.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); waterShore.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); waterShore.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { waterShore.AddTriangle( e1.v5, e2.v5, e1.v5 + HexMetrics.GetBridge(direction.Next()) ); } }</code> </pre> <br>  ูู ุจูุณุฎ ุงูุนูุตุฑ ุงููุงุฆู ุ ููู ุจุชูุตููู ุจุงูุจูุงุก ุงููุณุจู ููู ุจุชุนูููู ุจุญูุซ ูุณุชุฎุฏู ุฅุญุฏุงุซูุงุช ุงูุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ.  ูุญู ุฃูุถูุง ูุตูุน ุชุธููููุง ููุงุฏุฉ ููููุงู ุงูุณุงุญููุฉ ุ ููุถุงุนู ุงูุชุธููู ุงูุญุงูู ูุงูููุงุฏ ุงููุงุฆูุฉ. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/561/77e/e73/56177ee7331ce092a859a058645f0364.png"></div><br>  <i>ูุฑูู ุงูุดุงุทุฆ ุงููุงุฆู ูููุงุฏ ุงูุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ.</i> <br><br>  ูู ุจุชุบููุฑ ุชุธููู <em>Water Shore</em> ุจุญูุซ ูุนุฑุถ ุฅุญุฏุงุซูุงุช UV ุจุฏูุงู ูู ุงููุงุก. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs lisp"> fixed4 c = fixed4(<span class="hljs-name"><span class="hljs-name">IN</span></span>.uv_MainTex, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br>  ูุธุฑูุง ูุนุฏู ุชุนููู ุฃู ุฅุญุฏุงุซูุงุช ุญุชู ุงูุขู ุ ูุณูุนุฑุถ ููููุง ุตูุจูุง.  ุจูุถู ูุฐุง ุ ูู ุงูุณูู ุฃู ูุฑู ุฃู ุงูุณุงุญู ูุณุชุฎุฏู ุจุงููุนู ุดุจูุฉ ูููุตูุฉ ูุน ุงูููุงุฏ. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/630/45c/ec0/63045cec0f1f367bfee191f69cfa11ad.png"></div><br>  <i>ุดุจูุฉ ูููุตูุฉ ููุณุงุญู.</i> <br><br>  ุฏุนูุง ูุถุน ูุนูููุงุช ุงูุณุงุญู ูู ุงูุฅุญุฏุงุซูุงุช V. ุนูู ุฌุงูุจ ุงููุงุก ุ ูู ุจุชุนููููุง ูููุฉ 0 ุ ุนูู ุฌุงูุจ ุงูุฃุฑุถ - ุงููููุฉ 1. ูุธุฑูุง ูุฃููุง ูุง ูุญุชุงุฌ ุฅูู ุฅุฑุณุงู ุฃู ุดูุก ุขุฎุฑ ุ ูุฅู ุฌููุน ุฅุญุฏุงุซูุงุช U ุณุชููู ุจุจุณุงุทุฉ 0. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> waterShore.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); waterShore.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); waterShore.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); waterShore.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { waterShore.AddTriangle( e1.v5, e2.v5, e1.v5 + HexMetrics.GetBridge(direction.Next()) ); waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/8f4/3fa/f86/8f43faf864c259e21c2ce731d08f43f6.png"></div><br>  <i>ุงูุงูุชูุงู ุฅูู ุงูุณูุงุญู ุฎุงุทุฆ.</i> <br><br>  ูุนูู ุงูุฑูุฒ ุฃุนูุงู ูุน ุงูุญูุงู ุ ููููู ุฎุงุทุฆ ูู ุจุนุถ ุงูุฒูุงูุง.  ุฅุฐุง ูุงู ุงูุฌุงุฑ ุงูุชุงูู ุชุญุช ุงููุงุก ุ ูุณูููู ูุฐุง ุงูููุฌ ุตุญูุญูุง.  ูููู ุนูุฏูุง ูุง ูููู ุงูุฌุงุฑ ุงูุชุงูู ุชุญุช ุงููุงุก ุ ุณุชููู ุงูููุฉ ุงูุซุงูุซุฉ ูููุซูุซ ุชุญุช ุงูุฃุฑุถ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, nextNeighbor.IsUnderwater ? <span class="hljs-number"><span class="hljs-number">0f</span></span> : <span class="hljs-number"><span class="hljs-number">1f</span></span>) );</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c2e/9e9/6e6/c2e9e96e63c161d0f71f81e31742af89.png"></div><br>  <i>ุงูุชุญููุงุช ุฅูู ุงูุณูุงุญู ุตุญูุญุฉ.</i> <br><br><h3 style=";text-align:right;direction:rtl">  ุฑุบูุฉ ุนูู ุงูุณุงุญู </h3><br>  ุงูุขู ุจุนุฏ ุฃู ุชู ุชูููุฐ ุงูุชุญููุงุช ุฅูู ุงูุณุงุญู ุจุดูู ุตุญูุญ ุ ููููู ุงุณุชุฎุฏุงููุง ูุฅูุดุงุก ุชุฃุซูุฑ ุงูุฑุบูุฉ.  ุฃุณูู ุทุฑููุฉ ูู ุฅุถุงูุฉ ูููุฉ ุงูุณุงุญู ุฅูู ููู ููุญุฏ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; <span class="hljs-type"><span class="hljs-type">float</span></span> foam = shore; fixed4 c = saturate(_Color + foam); o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ef5/502/a56/ef5502a56ab665732312be25a6961817.png"></div><br>  <i>ุฑุบูุฉ ุฎุทูุฉ.</i> <br><br>  ูุฌุนู ุงูุฑุบูุฉ ุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ุ ุงุถุฑุจูุง ูู ูุฑุจุน ุงูุฌูุจ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> foam = sin(shore * <span class="hljs-number"><span class="hljs-number">10</span></span>); foam *= foam * shore;</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c2e/acf/6d8/c2eacf6d83e9f7c1298cdd7a05e551d0.png"></div><br>  <i>ูุชูุงุดู ุงูุฑุบูุฉ ุงูุฌูุจูุฉ ุงููุฑุจุนุฉ.</i> <br><br>  ุฏุนููุง ูุฌุนู ุงูุฌุจูุฉ ุงูุฑุบููุฉ ุฃูุจุฑ ุนูุฏ ุงูุงูุชุฑุงุจ ูู ุงูุดุงุทุฆ.  ูููู ุงูููุงู ุจุฐูู ุนู ุทุฑูู ุฃุฎุฐ ุงูุฌุฐุฑ ุงูุชุฑุจูุนู ูุจู ุงุณุชุฎุฏุงู ูููุฉ ุงูุณุงุญู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; shore = sqrt(shore);</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/762/675/e98/762675e987d119034cd5b643c86ca672.png"></div><br>  <i>ุชุตุจุญ ุงูุฑุบูุฉ ุฃูุซุฑ ุณูููุง ุจุงููุฑุจ ูู ุงูุดุงุทุฆ.</i> <br><br>  ุฃุถู ุชุดูููุง ูุฌุนููุง ุชุจุฏู ุฃูุซุฑ ุทุจูุนูุฉ.  ุฏุนููุง ูุฌุนู ุงูุชุดููู ุฃุถุนู ุนูุฏ ุงูุงูุชุฑุงุจ ูู ุงูุณุงุญู.  ูุฐุง ุณูููู ูู ุงูุฃูุถู ุฃู ุชุจุทู ุงูุณุงุญู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> float2 noiseUV = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, noiseUV * <span class="hljs-number"><span class="hljs-number">0.015</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> distortion = noise.x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-type"><span class="hljs-type">float</span></span> foam = sin((shore + distortion) * <span class="hljs-number"><span class="hljs-number">10</span></span>); foam *= foam * shore;</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/31a/7fd/59a/31a7fd59ad215b200571133543f1406b.png"></div><br>  <i>ุฑุบูุฉ ูุน ุชุดููู.</i> <br><br>  ูุจุงูุทุจุน ุ ูุญู ูุญูู ูู ูุฐุง: ูู ูู ุงูุฌูุจ ูุงูุชุดููุงุช. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> float2 noiseUV = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz + _Time.y * <span class="hljs-number"><span class="hljs-number">0.25</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(_MainTex, noiseUV * <span class="hljs-number"><span class="hljs-number">0.015</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> distortion = noise.x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-type"><span class="hljs-type">float</span></span> foam = sin((shore + distortion) * <span class="hljs-number"><span class="hljs-number">10</span></span> - _Time.y); foam *= foam * shore;</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>ุฑุบูุฉ ูุชุญุฑูุฉ.</i> <br><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุงูุฑุบูุฉ ุงููุงุฑุฏุฉ ุ ููุงู ุฃูุถูุง ุฑุบูุฉ ูุชุฑุงุฌุนุฉ.  ุฏุนูุง ูุถูู ุฌูุจูุง ุซุงูููุง ุ ูุชุญุฑู ูู ุงูุงุชุฌุงู ุงููุนุงูุณ ุ ููุญุงูุงุฉ ุฐูู.  ุงุฌุนูู ุฃุถุนู ูุฃุถู ููุชูุง.  ุณุชููู ุงูุฑุบูุฉ ุงูููุงุฆูุฉ ุงูุญุฏ ุงูุฃูุตู ููุฐูู ุงูุฌููุจ ุงูุฃูููุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs mel"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distortion1 = <span class="hljs-keyword"><span class="hljs-keyword">noise</span></span>.x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> foam1 = <span class="hljs-keyword"><span class="hljs-keyword">sin</span></span>((shore + distortion1) * <span class="hljs-number"><span class="hljs-number">10</span></span> - _Time.y); foam1 *= foam1; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distortion2 = <span class="hljs-keyword"><span class="hljs-keyword">noise</span></span>.y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> foam2 = <span class="hljs-keyword"><span class="hljs-keyword">sin</span></span>((shore + distortion2) * <span class="hljs-number"><span class="hljs-number">10</span></span> + _Time.y + <span class="hljs-number"><span class="hljs-number">2</span></span>); foam2 *= foam2 * <span class="hljs-number"><span class="hljs-number">0.7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> foam = <span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(foam1, foam2) * shore;</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>ุงูุฑุบูุฉ ุงููุงุฑุฏุฉ ูุงูุชุฑุงุฌุน.</i> <br><br><h3 style=";text-align:right;direction:rtl">  ูุฒูุฌ ูู ุงูุฃููุงุฌ ูุงูุฑุบูุฉ </h3><br>  ููุงู ุงูุชูุงู ุญุงุฏ ุจูู ุงูููุงู ุงูููุชูุญุฉ ูุงูุณุงุญููุฉ ูุฃู ููุฌุงุช ุงูููุงู ุงูููุชูุญุฉ ุบูุฑ ูุฏุฑุฌุฉ ูู ุงูููุงู ุงูุณุงุญููุฉ.  ูุฅุตูุงุญ ุฐูู ุ ูุญุชุงุฌ ุฅูู ุชุถููู ูุฐู ุงูููุฌุงุช ูู ุชุธููู <em>Water Shore</em> . <br><br>  ุจุฏูุงู ูู ูุณุฎ ุฑูุฒ ุงูููุฌุฉ ุ ุฏุนูุง <em>ููุตูู ูู</em> ููู ุชุถููู <em>Water.cginc</em> .  ูู ุงููุงูุน ุ ูููู ุจุฅุฏุฑุงุฌ ุฑูุฒ ููู ููู ูู ุงูุฑุบูุฉ ูุงูููุฌุงุช ุ ูู ููุธููุฉ ูููุตูุฉ. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููู ูุนูู ุชุธููู ุงููููุงุชุ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl">  ูุชู ุชุบุทูุฉ ุฅูุดุงุก ูููุงุช ุงูุชุธููู ุงูุฎุงุตุฉ ุจู ูู ุงูุจุฑูุงูุฌ ุงูุชุนูููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Rendering 5 ุ ูุตุงุจูุญ ูุชุนุฏุฏุฉ</a> . </div></div><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float</span></span> Foam (<span class="hljs-type"><span class="hljs-type">float</span></span> shore, float2 worldXZ, sampler2D noiseTex) { // <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; shore = sqrt(shore); float2 noiseUV = worldXZ + _Time.y * <span class="hljs-number"><span class="hljs-number">0.25</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(noiseTex, noiseUV * <span class="hljs-number"><span class="hljs-number">0.015</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> distortion1 = noise.x * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-type"><span class="hljs-type">float</span></span> foam1 = sin((shore + distortion1) * <span class="hljs-number"><span class="hljs-number">10</span></span> - _Time.y); foam1 *= foam1; <span class="hljs-type"><span class="hljs-type">float</span></span> distortion2 = noise.y * (<span class="hljs-number"><span class="hljs-number">1</span></span> - shore); <span class="hljs-type"><span class="hljs-type">float</span></span> foam2 = sin((shore + distortion2) * <span class="hljs-number"><span class="hljs-number">10</span></span> + _Time.y + <span class="hljs-number"><span class="hljs-number">2</span></span>); foam2 *= foam2 * <span class="hljs-number"><span class="hljs-number">0.7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> max(foam1, foam2) * shore; } <span class="hljs-type"><span class="hljs-type">float</span></span> Waves (float2 worldXZ, sampler2D noiseTex) { float2 uv1 = worldXZ; uv1.y += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise1 = tex2D(noiseTex, uv1 * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); float2 uv2 = worldXZ; uv2.x += _Time.y; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise2 = tex2D(noiseTex, uv2 * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); <span class="hljs-type"><span class="hljs-type">float</span></span> blendWave = sin( (worldXZ.x + worldXZ.y) * <span class="hljs-number"><span class="hljs-number">0.1</span></span> + (noise1.y + noise2.z) + _Time.y ); blendWave *= blendWave; <span class="hljs-type"><span class="hljs-type">float</span></span> waves = lerp(noise1.z, noise1.w, blendWave) + lerp(noise2.x, noise2.y, blendWave); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> smoothstep(<span class="hljs-number"><span class="hljs-number">0.75</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, waves); }</code> </pre> <br>  ูู ุจุชุบููุฑ ุชุธููู <em>ุงููุงุก</em> ุจุญูุซ ูุณุชุฎุฏู ููู ุงูุชุถููู ุงูุฌุฏูุฏ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" sampler2D _MainTex; โฆ <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> waves = Waves(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); fixed4 c = saturate(_Color + waves); o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br>  ูู ุชุธููู <em>Water Shore</em> ุ ูุชู ุญุณุงุจ ุงูููู ููู ูู ุงูุฑุบูุฉ ูุงูููุฌุงุช.  ุซู ูููู ุจูุชู ุงูุฃููุงุฌ ููุญู ููุชุฑุจ ูู ุงูุดุงุทุฆ.  ุณุชููู ุงููุชูุฌุฉ ุงูููุงุฆูุฉ ูู ุงูุญุฏ ุงูุฃูุตู ููุฑุบูุฉ ูุงูููุฌุงุช. <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" sampler2D _MainTex; โฆ <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; <span class="hljs-type"><span class="hljs-type">float</span></span> foam = Foam(shore, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); <span class="hljs-type"><span class="hljs-type">float</span></span> waves = Waves(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); waves *= <span class="hljs-number"><span class="hljs-number">1</span></span> - shore; fixed4 c = saturate(_Color + max(foam, waves)); o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = ca; }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>ูุฒูุฌ ูู ุงูุฑุบูุฉ ูุงูุฃููุงุฌ.</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">ุญุฒูุฉ ุงููุญุฏุฉ</a> <br><br><h2 style=";text-align:right;direction:rtl">  ูุฑุฉ ุฃุฎุฑู ุนู ุงูููุงู ุงูุณุงุญููุฉ </h2><br>  ุชู ุฅุฎูุงุก ุฌุฒุก ูู ุดุจูุฉ ุงูุณุงุญู ุชุญุช ุดุจูุฉ ุงูุฅุบุงุซุฉ.  ูุฐุง ุฃูุฑ ุทุจูุนู ุ ูููู ูุชู ุฅุฎูุงุก ุฌุฒุก ุตุบูุฑ ููุท.  ูุณูุก ุงูุญุธ ุ ุชุฎูู ุงูููุญุฏุฑุงุช ุงูุญุงุฏุฉ ูุนุธู ุงูููุงู ุงูุณุงุญููุฉ ุ ูุจุงูุชุงูู ุงูุฑุบูุฉ. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/dea/adf/7e3/deaadf7e3290f93b28ed6177c713bbaa.png"></div><br>  <i>ุงูููุงู ุงูุณุงุญููุฉ ุงูุฎููุฉ ุชูุฑูุจุง.</i> <br><br>  ูููููุง ูุนุงูุฌุฉ ุฐูู ุนู ุทุฑูู ุฒูุงุฏุฉ ุญุฌู ุดุฑูุท ุงูุณุงุญู.  ูููู ุงูููุงู ุจุฐูู ุนู ุทุฑูู ุชูููู ูุตู ูุทุฑ ุณุฏุงุณู ุงููุงุก.  ููุฐุง ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุนุงูู ุงููุฒุงูุฉ ุ ูุญุชุงุฌ ุฅูู ูุนุงูู ูุงุก <code>HexMetrics</code> ุ ุจุงูุฅุถุงูุฉ ุฅูู ุทุฑู ููุญุตูู ุนูู ุฒูุงูุง ุงููุงุก. <br><br>  ูุนุงูู ุงููุฒุงูุฉ 0.8.  ููุถุงุนูุฉ ุญุฌู ูุฑูุจุงุช ุงูููุงู ุ ูุญุชุงุฌ ุฅูู ุถุจุท ูุนุงูู ุงููุงุก ุนูู 0.6. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> waterFactor = <span class="hljs-number"><span class="hljs-number">0.6f</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFirstWaterCorner</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] * waterFactor; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSecondWaterCorner</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction + <span class="hljs-number"><span class="hljs-number">1</span></span>] * waterFactor; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุณุชุฎุฏู ูุฐู ุงูุทุฑู ุงูุฌุฏูุฏุฉ </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅูุฌุงุฏ ุฒูุงูุง ุงููุงุก.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateOpenWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { Vector3 c1 = center + HexMetrics.GetFirstWaterCorner(direction); Vector3 c2 = center + HexMetrics.GetSecondWaterCorner(direction); โฆ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { EdgeVertices e1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EdgeVertices( center + HexMetrics.GetFirstWaterCorner(direction), center + HexMetrics.GetSecondWaterCorner(direction) ); โฆ }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/123/b85/fcf/123b85fcffde7ae313f177f76f882ef5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุณุชุฎุฏุงู ุฒูุงูุง ุงููุงุก. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุถุงุนูุช ุงููุณุงูุฉ ุจูู ุณุฏุงุณูุงุช ุงููุงุก ูู ุงููุงูุน. </font><font style="vertical-align: inherit;">ุงูุขู </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุจ ุฃู ูููู ูุฏููุง ุฃูุถูุง ุทุฑููุฉ ูุฅูุดุงุก ุฌุณูุฑ ูู ุงููุงุก.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> waterBlendFactor = <span class="hljs-number"><span class="hljs-number">1f</span></span> - waterFactor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetWaterBridge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] + corners[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction + <span class="hljs-number"><span class="hljs-number">1</span></span>]) * waterBlendFactor; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุบููุฑ </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุญูุซ ูุณุชุฎุฏู ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateOpenWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.SE &amp;&amp; neighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Vector3 bridge = HexMetrics.GetWaterBridge(direction); โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E) { โฆ water.AddTriangle( c2, e2, c2 + HexMetrics.GetWaterBridge(direction.Next()) ); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { โฆ Vector3 bridge = HexMetrics.GetWaterBridge(direction); โฆ HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { waterShore.AddTriangle( e1.v5, e2.v5, e1.v5 + HexMetrics.GetWaterBridge(direction.Next()) ); โฆ } }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/99b/756/1fa/99b7561fad8556733ea1f10b2dcdd233.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฌุณูุฑ ุทูููุฉ ูู ุงููุงุก.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจูู ุถููุน ุงููุงุก ูุงูุฃุฑุถ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุงูุฑุบู ูู ุฃู ูุฐุง ูููุญูุง ูุณุงุญุฉ ุฃูุจุฑ ููุฑุบูุฉ ุ ุฅูุง ุฃู ุงููุฒูุฏ ูููุง ูุฎูู ุชุญุช ุงูุฅุบุงุซุฉ. </font><font style="vertical-align: inherit;">ูู ุงููุงุญูุฉ ุงููุซุงููุฉ ุ ุณูููู ูุงุฏุฑูู ุนูู ุงุณุชุฎุฏุงู ุถูุน ุงููุงุก ุนูู ุฌุงูุจ ุงููุงุก ุ ูุถูุน ุฃุฑุถ ุนูู ุฌุงูุจ ุงูุฃุฑุถ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูููููุง ุงุณุชุฎุฏุงู ุฌุณุฑ ุจุณูุท ููุนุซูุฑ ุนูู ุงูุญุงูุฉ ุงูููุงุจูุฉ ููุฃุฑุถ ุ ุฅุฐุง ุจุฏุฃูุง ูู ุฒูุงูุง ุงููุงุก. </font><font style="vertical-align: inherit;">ุจุฏูุงู ูู ุฐูู ุ ูููููุง ุงูุฐูุงุจ ูู ุงูุงุชุฌุงู ุงููุนุงูุณ ุ ูู ูุณุท ุงูุฌุงุฑ. </font><font style="vertical-align: inherit;">ุงูุชุบููุฑ </font></font><code>TriangulateWaterShore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุณุชุฎุฏุงู ูุฐุง ุงูููุฌ ุงูุฌุฏูุฏ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Vector3 bridge = HexMetrics.GetWaterBridge(direction); Vector3 center2 = neighbor.Position; center2.y = center.y; EdgeVertices e2 = new EdgeVertices( center2 + HexMetrics.GetSecondSolidCorner(direction.Opposite()), center2 + HexMetrics.GetFirstSolidCorner(direction.Opposite()) ); โฆ HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); if (nextNeighbor != null) { Vector3 center3 = nextNeighbor.Position; center3.y = center.y; waterShore.AddTriangle( e1.v5, e2.v5, center3 + HexMetrics.GetFirstSolidCorner(direction.Previous()) ); โฆ }</span></span></code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b29/3f2/01f/b293f201f065b7921f1098484e3b725d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฒูุงูุง ุญูุงู ุฎุงุทุฆุฉ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุญ ุฐูู ุ ุงูุขู ููุท ูุญุชุงุฌ ูุฑุฉ ุฃุฎุฑู ุฅูู ุงููุธุฑ ูู ุญุงูุชูู ูููุซูุซุงุช ุงูุฒุงููุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// Vector3 center3 = nextNeighbor.Position; // center3.y = center.y; Vector3 v3 = nextNeighbor.Position + (nextNeighbor.IsUnderwater ? HexMetrics.GetFirstWaterCorner(direction.Previous()) : HexMetrics.GetFirstSolidCorner(direction.Previous())); v3.y = center.y; waterShore.AddTriangle(e1.v5, e2.v5, v3); waterShore.AddTriangleUV( new Vector2(0f, 0f), new Vector2(0f, 1f), new Vector2(0f, nextNeighbor.IsUnderwater ? 0f : 1f) ); }</span></span></code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/4e1/f64/db1/4e1f64db1a34a8e6cff0f402f5fc6bd8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฒูุงูุง ุงูุตุญูุญุฉ ููุญูุงู. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุญ ูุฐุง ุจุดูู ุฌูุฏ ุ ูููู ุงูุขู ุจุนุฏ ุธููุฑ ูุนุธู ุงูุฑุบูุฉ ุ ุฃุตุจุญุช ูุงุถุญุฉ ุชูุงููุง. </font><font style="vertical-align: inherit;">ููุชุนููุถ ุนู ุฐูู ุ ุณูุฌุนู ุงูุชุฃุซูุฑ ุฃุถุนู ููููุงู ูู ุฎูุงู ุชูููู ุญุฌู ูููุฉ ุงูุณุงุญู ูู ุงูุชุธููู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs lisp"> shore = sqrt(<span class="hljs-name"><span class="hljs-name">shore</span></span>) * <span class="hljs-number"><span class="hljs-number">0.9</span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุบูุฉ ุฌุงูุฒุฉ. </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃููุงุฑ ุชุญุช ุงููุงุก </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชูู ุจูุง ุงููุทุงู ุจุงููุงุก ุ ุนูู ุงูุฃูู ูู ุชูู ุงูุฃูุงูู ุงูุชู ูุง ุชุชุฏูู ูููุง ุฃููุงุฑ. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุงููุงุก ูุงูุฃููุงุฑ ูุง ุชูุงุญุธุงู ุจุนุถููุง ุงูุจุนุถ ุจุนุฏ ุ ุณุชุชุฏูู ุงูุฃููุงุฑ ุนุจุฑ ูุชุญุช ุงููุงุก.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/051/1ee/bc5/0511eebc5420c9203475b65ce5c478b3.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฃููุงุฑ ุชุชุฏูู ูู ุงููุงุก. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนุชูุฏ ุงูุชุฑุชูุจ ุงูุฐู ูุชู ุจู ุชูุฏูู ุงูุฃุดูุงุก ุงูุดูุงูุฉ ุนูู ุจุนุฏูุง ุนู ุงููุงููุฑุง. </font><font style="vertical-align: inherit;">ูุชู ุชูุฏูู ุฃูุฑุจ ุงููุงุฆูุงุช ูู ุงูููุงูุฉ ุ ูุฐุง ููู ูู ุงูุฃุนูู. </font><font style="vertical-align: inherit;">ุนูุฏ ุชุญุฑูู ุงููุงููุฑุง ุ ุณูุนูู ุฐูู ุฃูู ูู ุจุนุถ ุงูุฃุญูุงู ุณุชุธูุฑ ุงูุฃููุงุฑ ูุฃุญูุงููุง ุงูููุงู ููู ุจุนุถูุง ุงูุจุนุถ. </font><font style="vertical-align: inherit;">ููุจุฏุฃ ุจุฌุนู ุฃูุฑ ุงูุนุฑุถ ุซุงุจุชูุง. </font><font style="vertical-align: inherit;">ูุฌุจ ุฑุณู ุงูุฃููุงุฑ ููู ุงููุงุก ุจุญูุซ ูุชู ุนุฑุถ ุงูุดูุงูุงุช ุจุดูู ุตุญูุญ. </font><font style="vertical-align: inherit;">ูููููุง ุชูููุฐ ุฐูู ุนู ุทุฑูู ุชุบููุฑ ูุงุฆูุฉ ุงูุชุธุงุฑ Shader </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุฑ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs objectivec"> Tags { <span class="hljs-string"><span class="hljs-string">"RenderType"</span></span>=<span class="hljs-string"><span class="hljs-string">"Transparent"</span></span> <span class="hljs-string"><span class="hljs-string">"Queue"</span></span>=<span class="hljs-string"><span class="hljs-string">"Transparent+1"</span></span> }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/4bc/74e/d91/4bc74ed9179598f5b9e82c3ff0cde851.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฑุณู ุงูุฃููุงุฑ ุงูุฃุฎูุฑุฉ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฎุชุจุฆ ููุฑ ุชุญุช ุงููุงุก </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุงูุฑุบู ูู ุฃู ูุงุน ุงูููุฑ ูุฏ ูููู ุชุญุช ุงููุงุก ุ ููููู ุฃู ูุชุฏูู ุงููุงุก ูู ุฎูุงูู ุ ุฅูุง ุฃูู ูุง ููุจุบู ุฃู ูุฑู ูุฐู ุงูููุงู. </font><font style="vertical-align: inherit;">ูุงูุฃูุซุฑ ูู ุฐูู ุ ูุง ูุฌุจ ุฃู ูุชู ุนุฑุถู ุนูู ุณุทุญ ูุงุก ุญูููู. </font><font style="vertical-align: inherit;">ูููููุง ุงูุชุฎูุต ูู ููุงู ุงูุฃููุงุฑ ุงููุบููุฑุฉ ุจุฅุถุงูุฉ ุฃุฌุฒุงุก ุงูููุฑ ููุท ุนูุฏูุง ูุง ุชููู ุงูุฎููุฉ ุงูุญุงููุฉ ุชุญุช ุงููุงุก.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiverBeginOrEnd</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reversed = cell.HasIncomingRiver; โฆ } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWithRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> reversed = cell.IncomingRiver == direction; โฆ } }</code> </pre> <br><font style="vertical-align: inherit;"></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงุฏุฆ </font><font style="vertical-align: inherit;">ุฐู </font><font style="vertical-align: inherit;">ุจุฏุก ุ ุณูุถูู ููุทุน ููุฑ ุนูุฏูุง ูุง ุชููู ุงูุฎููุฉ ุงูุญุงููุฉ ููุง ุงูุฎููุฉ ุงููุฌุงูุฑุฉ ุชุญุช ุงููุงุก.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { e2.v3.y = neighbor.StreamBedY; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !neighbor.IsUnderwater) { TriangulateRiverQuad( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, cell.HasIncomingRiver &amp;&amp; cell.IncomingRiver == direction ); } }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/899/0c7/cf6/8990c7cf6af7bf25596b4ffc05204817.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูุฒูุฏ ูู ุงูุฃููุงุฑ ุชุญุช ุงููุงุก.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุดูุงูุงุช </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุนุฏ ููุงู ุฃููุงุฑ ุชุญุช ุงููุงุก ุ ูููู ูุฏููุง ุงูุขู ุซููุจ ูู ุชูู ุงูุฃูุงูู ูู ุงูุฃููุงุฑ ุญูุซ ุชูุชูู ูุน ุณุทุญ ุงููุงุก. ุงูุฃููุงุฑ ุนูู ููุณ ูุณุชูู ุงููุงุก ุชุฎูู ุซููุจูุง ุฃู ุทุจูุงุช. ููู ุฃูุซุฑ ูุง ููุงุญุธ ูู ุงูุดูุงูุงุช ุงูููููุฏุฉ ููุฃููุงุฑ ุงูุชู ุชุชุฏูู ูู ุงุฑุชูุงุน ุฃูุจุฑ. ุฏุนูุง ูุนุชูู ุจูู ุฃููุงู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฌุฒุก ูู ุงูููุฑ ูุน ุดูุงู ูุณุชุฎุฏู ูููุฑูุฑ ุนุจุฑ ุณุทุญ ุงููุงุก. ููุชูุฌุฉ ูุฐูู ุ ูุฌุฏ ููุณู ุฌุฒุฆููุง ููู ุ ูุฌุฒุฆููุง ุชุญุช ุงููุงุก. ูุญู ุจุญุงุฌุฉ ุฅูู ุงูุงุญุชูุงุธ ุจุฌุฒุก ููู ูุณุชูู ุงูููุงู ุ ูุน ุงูุชุฎูุต ูู ูู ุดูุก ุขุฎุฑ. ุณูููู ุนููู ุงูุนูู ุจุฌุฏ ูู ุฃุฌู ุฐูู ุ ูุฐุง ูู ุจุฅูุดุงุก ุทุฑููุฉ ูููุตูุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุชุทูุจ ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ ุฃุฑุจุนุฉ ููู ุ ููุณุชูููู ูู ุงูุฃููุงุฑ ููุณุชูู ูู ุงูููุงู. ุณูุถุนูุง ุจุญูุซ ููุธุฑ ูู ุงุชุฌุงู ุงูุชูุงุฑ ุ ุฃุณูู ุงูุดูุงู. ูุฐูู ุ ูุฅู ุงูููุชูู ุงูุฃููููู ูุงูุฌุงูุจูู ุงูุฃูุณุฑ ูุงูุฃููู ุณููููุงู ูู ุงูููุฉ ุ ูุณูุชุจุนููุง ุงูุฌุฒุก ุงูุณููู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterfallInWater</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> waterY </span></span></span><span class="hljs-function">)</span></span> { v1.y = v2.y = y1; v3.y = v4.y = y2; rivers.AddQuad(v1, v2, v3, v4); rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุทูู ุนูู ูุฐู ุงูุทุฑููุฉ </font></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏูุง ูููู ุงูุฌุงุฑ ุชุญุช ุงููุงุก ูููุดุฆ ุดูุงููุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!neighbor.IsUnderwater) { TriangulateRiverQuad( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, cell.HasIncomingRiver &amp;&amp; cell.IncomingRiver == direction ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.Elevation &gt; neighbor.WaterLevel) { TriangulateWaterfallInWater( e1.v2, e1.v4, e2.v2, e2.v4, cell.RiverSurfaceY, neighbor.RiverSurfaceY, neighbor.WaterSurfaceY ); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุญุชุงุฌ ุฃูุถูุง ุฅูู ูุนุงูุฌุฉ ุงูุดูุงูุงุช ูู ุงูุงุชุฌุงู ุงููุนุงูุณ ุ ุนูุฏูุง ุชููู ุงูุฎููุฉ ุงูุญุงููุฉ ุชุญุช ุงููุงุก ุ ูุงูุฎููุฉ ุงูุชุงููุฉ ููุณุช ูุฐูู. </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { โฆ } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !neighbor.IsUnderwater &amp;&amp; neighbor.Elevation &gt; cell.WaterLevel ) { TriangulateWaterfallInWater( e2.v4, e2.v2, e1.v4, e1.v2, neighbor.RiverSurfaceY, cell.RiverSurfaceY, cell.WaterSurfaceY ); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฑุฉ ุฃุฎุฑู ูุญุตู ุนูู ุฑุจุงุน ุงูููุฑ ุงูุฃุตูู. </font><font style="vertical-align: inherit;">ุจุนุฏ ุฐูู ุ ูุญุชุงุฌ ุฅูู ุงูุชุบููุฑ </font></font><code>TriangulateWaterfallInWater</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุญูุซ ูุฑูุน ุงูููู ุงูุณูููุฉ ุฅูู ูุณุชูู ุงููุงุก. </font><font style="vertical-align: inherit;">ูุณูุก ุงูุญุธ ุ ูู ูููู ุชุบููุฑ ุฅุญุฏุงุซูุงุช ุต ููุท. </font><font style="vertical-align: inherit;">ูุฐุง ูููู ุฃู ูุฏูุน ุงูุดูุงู ูู ุงูุฌุฑู ุ ูุงูุฐู ูุฏ ูุดูู ุซููุจูุง. </font><font style="vertical-align: inherit;">ุจุฏูุงู ูู ุฐูู ุ ุนููู ุชุญุฑูู ุงูููู ุงูุณูููุฉ ุฅูู ุงูุฃุนูู ุจุงุณุชุฎุฏุงู ุงูุงุณุชููุงุก.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/942/11b/250/94211b250d95b614a5d6be6ff52c9e9e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุณุชููุงุก. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุญุฑูู ุงูููู ุงูุณูููุฉ ูุฃุนูู ุ ูู ุจุชูุณูู ุงููุณุงูุฉ ุชุญุช ุณุทุญ ุงููุงุก ุนูู ุงุฑุชูุงุน ุงูุดูุงู. </font><font style="vertical-align: inherit;">ูุฐุง ุณูุนุทููุง ูููุฉ interpolator.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> v1.y = v2.y = y1; v3.y = v4.y = y2; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t = (waterY - y2) / (y1 - y2); v3 = Vector3.Lerp(v3, v1, t); v4 = Vector3.Lerp(v4, v2, t); rivers.AddQuad(v1, v2, v3, v4); rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชูุฌุฉ ูุฐูู ุ ูุญุตู ุนูู ุดูุงู ูุตูุฑ ูู ููุณ ุงูุงุชุฌุงู. </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ุจูุง ุฃู ููุงุถุน ุงูููู ุงูุณูููุฉ ูุฏ ุชุบูุฑุช ุ ููู ูุชู ุชุดููููุง ูุซู ุงูููู ุงูุฃุตููุฉ. </font><font style="vertical-align: inherit;">ููุฐุง ูุนูู ุฃู ุงููุชูุฌุฉ ุงูููุงุฆูุฉ ูู ุชุชุฒุงูู ูุน ุงูุดูุงู ุงูุฃุตูู. </font><font style="vertical-align: inherit;">ูุญู ูุฐู ุงููุดููุฉ ุ ูุญุชุงุฌ ุฅูู ุชุดููู ุงูููู ูุฏูููุง ูุจู ุงูุงุณุชููุงุก ุ ุซู ุฅุถุงูุฉ ุฑุจุงุนูุฉ ุบูุฑ ูุดููุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> v1.y = v2.y = y1; v3.y = v4.y = y2; v1 = HexMetrics.Perturb(v1); v2 = HexMetrics.Perturb(v2); v3 = HexMetrics.Perturb(v3); v4 = HexMetrics.Perturb(v4); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> t = (waterY - y2) / (y1 - y2); v3 = Vector3.Lerp(v3, v1, t); v4 = Vector3.Lerp(v4, v2, t); rivers.AddQuadUnperturbed(v1, v2, v3, v4); rivers.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ูุฏููุง ุจุงููุนู ุทุฑููุฉ ูุฅุถุงูุฉ ูุซูุซุงุช ุบูุฑ ูุดููุฉ ุ ููุญู ูุง ูุญุชุงุฌ ุญููุง ุฅูู ุฅูุดุงุก ูุงุญุฏุฉ ููููุงุฏ. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูุถูู ุงูุทุฑููุฉ ุงููุงุฒูุฉ </font></font><code>HexMesh.AddQuadUnperturbed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadUnperturbed</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 v1, Vector3 v2, Vector3 v3, Vector3 v4 </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vertexIndex = vertices.Count; vertices.Add(v1); vertices.Add(v2); vertices.Add(v3); vertices.Add(v4); triangles.Add(vertexIndex); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">2</span></span>); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">2</span></span>); triangles.Add(vertexIndex + <span class="hljs-number"><span class="hljs-number">3</span></span>); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/dc4/605/bdd/dc4605bdd24ed9460b0ca3a310a11fb5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุดูุงูุงุช ุชูุชูู ุนูู ุณุทุญ ุงููุงุก. </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุตุจุงุช ุงูุฃููุงุฑ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏูุง ุชุชุฏูู ุงูุฃููุงุฑ ุนูู ููุณ ุงุฑุชูุงุน ุณุทุญ ุงููุงุก ุ ุชูุงูุณ ุดุจูุฉ ุงูููุฑ ุงูุดุจูุฉ ุงูุณุงุญููุฉ. ุฅุฐุง ูุงู ููุฑูุง ูุชุฏูู ูู ุงูุจุญุฑ ุฃู ูู ุงููุญูุท ุ ูุณูููู ููุงู ุชูุงุฑ ูู ุงูููุฑ ููุชูู ูุน ุงูุฃููุงุฌ. ูุฐูู ุ ุณูู ูุณูู ูุซู ูุฐู ุงูููุงุทู ูุตุจุงุช ุงูุฃููุงุฑ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ddd/27b/efa/ddd27befa12ec543e2969505365b0d91.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชูู ุงูููุฑ ูุน ุงูุณุงุญู ุฏูู ุชุดููู ุงูููู.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุขู ูุฏููุง ูุดููุชุงู ูุน ุงูุฃููุงู. ุฃููุงู ุ ุชุฑุจุท ุงูุฃููุงุฑ ุงูุฑุจุงุนูุฉ ุงูููุฉ ุงูุซุงููุฉ ูุงูุฑุงุจุนุฉ ูู ุงูุฃุถูุงุน ุ ูุชุฎุทูุฉ ุงูุซุงูุซ. ุจูุง ุฃู ุณุงุญู ุงููุงุก ูุง ูุณุชุฎุฏู ุงูุฐุฑูุฉ ุงูุซุงูุซุฉ ุ ูููู ุฃู ูุฎูู ุญูุฑุฉ ุฃู ุชุฏุงุฎู. ูููููุง ุญู ูุฐู ุงููุดููุฉ ุนู ุทุฑูู ุชุบููุฑ ููุฏุณุฉ ุงูุฃููุงู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุดููุฉ ุงูุซุงููุฉ ูู ุฃู ููุงู ุงูุชูุงููุง ุญุงุฏูุง ุจูู ุงูุฑุบูุฉ ูุงูููุงุฏ ุงูููุฑูุฉ. ูุญููุง ุ ูุญุชุงุฌ ุฅูู ูุงุฏุฉ ุฃุฎุฑู ุชููู ุจุฎูุท ุชุฃุซูุฑุงุช ุงูููุฑ ูุงููุงุก. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐุง ูุนูู ุฃู ุงูุฃููุงู ุชุชุทูุจ ููุฌูุง ุฎุงุตูุง ุ ูุฐูู ุฏุนููุง ููุดุฆ ุทุฑููุฉ ูููุตูุฉ ููู. ูุฌุจ ุงุณุชุฏุนุงุคู </font></font><code>TriangulateWaterShore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏูุง ูููู ููุงู ููุฑ ูุชุญุฑู ูู ุงูุงุชุฌุงู ุงูุญุงูู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateWaterShore</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, HexCell neighbor, Vector3 center </span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { TriangulateEstuary(e1, e2); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { waterShore.AddQuad(e1.v1, e1.v2, e2.v1, e2.v2); waterShore.AddQuad(e1.v2, e1.v3, e2.v2, e2.v3); waterShore.AddQuad(e1.v3, e1.v4, e2.v3, e2.v4); waterShore.AddQuad(e1.v4, e1.v5, e2.v4, e2.v5); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); waterShore.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); } โฆ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EdgeVertices e1, EdgeVertices e2</span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุทูุฉ ุฎูุท ููุง ุงูุชุฃุซูุฑูู ุบูุฑ ูุทููุจุฉ ูููุก ุงูุดุฑูุท ุจุฃูููู. </font><font style="vertical-align: inherit;">ุณูููู ููุง ุงูุดูู ุดุจู ุงูููุญุฑู. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูููููุง ุงุณุชุฎุฏุงู ูุซูุซูู ุณุงุญูููู ุนูู ุงูุฌุงูุจูู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EdgeVertices e1, EdgeVertices e2</span></span></span><span class="hljs-function">)</span></span> { waterShore.AddTriangle(e2.v1, e1.v2, e1.v1); waterShore.AddTriangle(e2.v5, e1.v5, e1.v4); waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); waterShore.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ece/ca1/fc9/ececa1fc9852f7350a54e00fa71df0b3.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุซูุจ ุดุจู ููุญุฑู ูููุทูุฉ ุงูุฎูุท.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุญุฏุงุซูุงุช UV2 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅูุดุงุก ุชุฃุซูุฑ ููุฑ ุ ูุญุชุงุฌ ุฅูู ุฅุญุฏุงุซูุงุช ููุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ. </font><font style="vertical-align: inherit;">ูููู ูุฅูุดุงุก ุชุฃุซูุฑ ุฑุบูู ุ ุชุญุชุงุฌ ุฃูุถูุง ุฅูู ุฅุญุฏุงุซูุงุช ููุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ. </font><font style="vertical-align: inherit;">ุฃู ุ ุนูุฏ ูุฒุฌูุง ุ ูุญุชุงุฌ ุฅูู ูุฌููุนุชูู ูู ุฅุญุฏุงุซูุงุช ุงูุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ. </font><font style="vertical-align: inherit;">ูุญุณู ุงูุญุธ ุ ูููู ุฃู ุชุฏุนู ุดุจูุงุช ูุญุฑู ุงููุญุฏุฉ ูุง ูุตู ุฅูู ุฃุฑุจุน ูุฌููุนุงุช ููุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ. </font><font style="vertical-align: inherit;">ูุญุชุงุฌ ููุท ุฅูู ุฅุถุงูุฉ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏุนู ุงููุฌููุนุฉ ุงูุซุงููุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> useCollider, useColors, useUVCoordinates, useUV2Coordinates; [NonSerialized] List&lt;Vector2&gt; uvs, uv2s; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUVCoordinates) { uvs = ListPool&lt;Vector2&gt;.Get(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUV2Coordinates) { uv2s = ListPool&lt;Vector2&gt;.Get(); } triangles = ListPool&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.Get(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUVCoordinates) { hexMesh.SetUVs(<span class="hljs-number"><span class="hljs-number">0</span></span>, uvs); ListPool&lt;Vector2&gt;.Add(uvs); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useUV2Coordinates) { hexMesh.SetUVs(<span class="hljs-number"><span class="hljs-number">1</span></span>, uv2s); ListPool&lt;Vector2&gt;.Add(uv2s); } โฆ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฅุถุงูุฉ ูุฌููุนุฉ ุซุงููุฉ ูู ุงูุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ ุ ูููู ุจุชูุฑุงุฑ ุทุฑู ุงูุนูู ูุน ุงูุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ ูุชุบููุฑ ุงูุทุฑููุฉ ุงูุชู ูุญุชุงุฌูุง. </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddTriangleUV2</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 uv1, Vector2 uv2, Vector3 uv3</span></span></span><span class="hljs-function">)</span></span> { uv2s.Add(uv1); uv2s.Add(uv2); uv2s.Add(uv3); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadUV2</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector2 uv1, Vector2 uv2, Vector3 uv3, Vector3 uv4</span></span></span><span class="hljs-function">)</span></span> { uv2s.Add(uv1); uv2s.Add(uv2); uv2s.Add(uv3); uv2s.Add(uv4); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddQuadUV2</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uMin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uMax, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vMin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vMax</span></span></span><span class="hljs-function">)</span></span> { uv2s.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMin, vMin)); uv2s.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMax, vMin)); uv2s.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMin, vMax)); uv2s.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(uMax, vMax)); }</code> </pre> <br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุธููุฉ ููุฑ ุดุงุฏุฑ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฃููุง ุณูู ูุชู ุงุณุชุฎุฏุงู ุชุฃุซูุฑ ุงูููุฑ ูู ุงุซููู ูู ุชุธูููุ ููู ุฑูุฒ ููุชุธููู </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฑ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ุงูุฌุฏูุฏุฉ ูุธููุฉ ุชุดูู ููู </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุงู ุงูููุงู</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">float</span></span> River (float2 riverUV, sampler2D noiseTex) { float2 uv = riverUV; uv.x = uv.x * <span class="hljs-number"><span class="hljs-number">0.0625</span></span> + _Time.y * <span class="hljs-number"><span class="hljs-number">0.005</span></span>; uv.y -= _Time.y * <span class="hljs-number"><span class="hljs-number">0.25</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise = tex2D(noiseTex, uv); float2 uv2 = riverUV; uv2.x = uv2.x * <span class="hljs-number"><span class="hljs-number">0.0625</span></span> - _Time.y * <span class="hljs-number"><span class="hljs-number">0.0052</span></span>; uv2.y -= _Time.y * <span class="hljs-number"><span class="hljs-number">0.23</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> noise2 = tex2D(noiseTex, uv2); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> noise.x * noise2.w; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุจุชุบููุฑ ุชุธููู </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุฑ</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุงุณุชุฎุฏุงู ูุฐู ุงูููุฒุฉ ุงูุฌุฏูุฏุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "Water.cginc" sampler2D _MainTex; โฆ <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> river = River(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex, _MainTex); fixed4 c = saturate(_Color + river); โฆ }</code> </pre> <br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุงุฆูุงุช ุงููู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุถู </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุง ูุฏุนู ูุงุฆู ุงูุดุจูุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh terrain, rivers, roads, water, waterShore, estuaries; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); roads.Clear(); water.Clear(); waterShore.Clear(); estuaries.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); roads.Apply(); water.Apply(); waterShore.Apply(); estuaries.Apply(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูุดุงุก ุชุธููู ุ ูุงุฏุฉ ูุฌุณู ูู ุงููู ุ ูุชูุฑุงุฑ ุงูุณุงุญู ูุชุบููุฑู. </font><font style="vertical-align: inherit;">ูู ุจุชูุตูููุง ุจุงูุฌุฒุก ุ ูุงุฌุนููุง ุชุณุชุฎุฏู ุฅุญุฏุงุซูุงุช UV ู UV2.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/540/77a/7fc/54077a7fc8653228cd723ca855330fed.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estuarties ุงููุงุฆู.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุซููุซ ุงููู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููููุง ุญู ูุดููุฉ ุงูุซูุจ ุฃู ุงูุชุฏุงุฎู ุจูุถุน ูุซูุซ ุจูู ููุงูุฉ ุงูููุฑ ููุณุท ุญุงูุฉ ุงููุงุก. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุชุธููู ุงููู ูุฏููุง ูู ูุณุฎุฉ ููุฑุฑุฉ ูู ุชุธููู ุงูุณุงุญู ุ ูููุง ุจุชุนููู ุฅุญุฏุงุซูุงุช ุงูุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ ูุชุชูุงุณุจ ูุน ุชุฃุซูุฑ ุงูุฑุบูุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EdgeVertices e1, EdgeVertices e2</span></span></span><span class="hljs-function">)</span></span> { โฆ estuaries.AddTriangle(e1.v3, e2.v2, e2.v4); estuaries.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/f02/bb6/f76/f02bb6f768f915d39c05296055cc0b83.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุซูุซ ุงูุฃูุณุท. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููููุง ููุก ุดุจู ุงูููุญุฑู ุจุงููุงูู ุนู ุทุฑูู ุฅุถุงูุฉ ุฑุจุงุนู ุนูู ุฌุงูุจู ุงููุซูุซ ุงูุฃูุณุท.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> estuaries.AddQuad(e1.v2, e1.v3, e2.v1, e2.v2); estuaries.AddTriangle(e1.v3, e2.v2, e2.v4); estuaries.AddQuad(e1.v3, e1.v4, e2.v4, e2.v5); estuaries.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); estuaries.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); estuaries.AddQuadUV(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>);</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ef2/672/e7e/ef2672e7e62b9d66463e4fc44dc43b7a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดุจู ููุญุฑู ุฌุงูุฒ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุนููุง ูุญูู ุงูุงุชุฌุงู ุงูุฑุจุงุนู ุฅูู ุงููุณุงุฑ ุจุญูุซ ูููู ูู ุงุชุตุงู ูุทุฑู ุฃูุตุฑ ุ ููุชูุฌุฉ ูุฐูู ูุญุตู ุนูู ููุฏุณุฉ ูุชูุงุธุฑุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> estuaries.AddQuad(e2.v1, e1.v2, e2.v2, e1.v3); estuaries.AddTriangle(e1.v3, e2.v2, e2.v4); estuaries.AddQuad(e1.v3, e1.v4, e2.v4, e2.v5); estuaries.AddQuadUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); <span class="hljs-comment"><span class="hljs-comment">// estuaries.AddQuadUV(0f, 0f, 0f, 1f);</span></span></code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/cd5/dd0/7d1/cd5dd07d1b9f1fb8126e6a5a7c1bc29b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุจุงุนู ูุณุชุฏูุฑ ุ ููุฏุณุฉ ูุชูุงุธุฑุฉ</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุฏูู ุงูููุฑ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏุนู ุชุฃุซูุฑ ุงูููุฑ ุ ูุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุฅุญุฏุงุซูุงุช UV2. </font><font style="vertical-align: inherit;">ููุน ุงูุฌุฒุก ุงูุณููู ูู ุงููุซูุซ ุงูุฃูุณุท ูู ููุชุตู ุงูููุฑ ุ ูุฐุง ูุฌุจ ุฃู ูููู ุฅุญุฏุงุซูุงุชู โโU ูุณุงููุฉ ูู 0.5. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุงูููุฑ ูุชุฏูู ูู ุงุชุฌุงู ุงููุงุก ุ ุชุชููู ุงูููุทุฉ ุงููุณุฑู ุฅุญุฏุงุซูุงุช U ุชุณุงูู 1 ุ ูุชุชููู ุงูููุทุฉ ุงููููู ุฅุญุฏุงุซูุงุช U ุจูููุฉ 0. ูููู ุจุชุนููู ุงูุฅุญุฏุงุซูุงุช Y ุฅูู 0 ู 1 ุ ุงูููุงุจูุฉ ูุงุชุฌุงู ุงูุชูุงุฑ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุจ ุฃู ุชุชุฒุงูู ุงูุฒูุงูุง ุงูุฑุจุงุนูุฉ ุนูู ุฌุงูุจู ุงููุซูุซ ูุน ูุฐุง ุงูุงุชุฌุงู. </font><font style="vertical-align: inherit;">ูุญุงูุธ ุนูู ููุณ ุฅุญุฏุงุซูุงุช U ููููุงุท ุงูุชู ุชุชุฌุงูุฒ ุนุฑุถ ุงูููุฑ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) );</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/a98/475/d50/a98475d50fe84d16eeeff5397f6aa43f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดุจู ููุญุฑู UV2. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชุฃูุฏ ูู ุชุนููู ุฅุญุฏุงุซูุงุช UV2 ุจุดูู ุตุญูุญ ุ ุงุฌุนู ุฃุฏุงุฉ ุชุธููู </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estuary</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุฌุนููุง. </font><font style="vertical-align: inherit;">ูููููุง ุงููุตูู ุฅูู ูุฐู ุงูุฅุญุฏุงุซูุงุช ุนู ุทุฑูู ุงูุฅุถุงูุฉ ุฅูู ูููู ุงูุฅุฏุฎุงู </font></font><code>float2 uv2_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float2 uv2_MainTex; float3 worldPos; }; โฆ <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { <span class="hljs-type"><span class="hljs-type">float</span></span> shore = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.y; <span class="hljs-type"><span class="hljs-type">float</span></span> foam = Foam(shore, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); <span class="hljs-type"><span class="hljs-type">float</span></span> waves = Waves(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPos.xz, _MainTex); waves *= <span class="hljs-number"><span class="hljs-number">1</span></span> - shore; fixed4 c = fixed4(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv2_MainTex, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); โฆ }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/efd/416/d95/efd416d95c7827f264f2f0e8360e6fde.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅุญุฏุงุซูุงุช UV2. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุดูุก ูุจุฏู ุฌูุฏูุง ุ ููููู ุงุณุชุฎุฏุงู ุชุธููู ูุฎูู ุชุฃุซูุฑ ุงูููุฑ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { โฆ <span class="hljs-type"><span class="hljs-type">float</span></span> river = River(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv2_MainTex, _MainTex); fixed4 c = saturate(_Color + river); โฆ }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/0e3/2c9/fda/0e32c9fda58b356534c2070d0b74adae.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุณุชุฎุฏู UV2 ูุฅูุดุงุก ุชุฃุซูุฑ ููุฑ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฏ ุฃูุดุฃูุง ุงูุฃููุงุฑ ุจุทุฑููุฉ ุชุฌุนููุง ุนูุฏ ุชุซููุซ ุงูุงุชุตุงูุงุช ุจูู ุงูุฎูุงูุง ุ ุชุชุบูุฑ ุฅุญุฏุงุซูุงุช ููุฑ V ูู 0.8 ุฅูู 1. ูุฐูู ุ ูุฌุจ ููุง ุฃูุถูุง ุงุณุชุฎุฏุงู ูุฐุง ุงููุงุตู ุงูุฒููู ุ ูููุณ ูู 0 ุฅูู 1. ููุน ุฐูู ุ ูุฅู ุงูุงุชุตุงู ุงูุณุงุญูู ูุฒูุฏ ุจูุณุจุฉ 50 ูช ุนู ุงุชุตุงูุงุช ุงูุฎูุงูุง ุงูุนุงุฏูุฉ . </font><font style="vertical-align: inherit;">ูุฐูู ุ ูู ุฃุฌู ุฃู ูุชูุงุณุจ ูุน ูุฌุฑู ุงูููุฑ ุ ูุฌุจ ุนูููุง ุชุบููุฑ ุงูููู ูู 0.8 ุฅูู 1.1.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) );</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/27d/beb/7c6/27dbeb7c67553163422fd560e64ddb03.png"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b0c/4d9/2e3/b0c4d92e3797274e2534a6921334d184.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุฏูู ุงููุชุฒุงูู ููููุฑ ููุตุจ ุงูููุฑ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุนุฏุงุฏ ุงูุชุฏูู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจูููุง ูุชุญุฑู ุงูููุฑ ูู ุฎุท ูุณุชููู. </font><font style="vertical-align: inherit;">ูููู ุนูุฏูุง ุชุชุฏูู ุงูููุงู ุฅูู ูุณุงุญุฉ ุฃูุจุฑ ุ ูุชูุฏุฏ. </font><font style="vertical-align: inherit;">ุงูุชูุงุฑ ููุญูู. </font><font style="vertical-align: inherit;">ูููููุง ูุญุงูุงุฉ ุฐูู ุนู ุทุฑูู ุทู ุฅุญุฏุงุซูุงุช UV2. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏููุง ูู ุงูุญูุงุธ ุนูู ุฅุญุฏุงุซูุงุช U ุงูุนููุง ุซุงุจุชุฉ ุฎุงุฑุฌ ุนุฑุถ ุงูููุฑ ุ ูู ุจุชุญุฑูููุง ุจููุฏุงุฑ 0.5. </font><font style="vertical-align: inherit;">ุฃูุตู ุงููุณุงุฑ 1.5 ุ ุฃูุตู ุงููุณุงุฑ โ0.5. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูููุช ููุณู ุ ูููู ุจุชูุณูุน ุงูุชุฏูู ุนู ุทุฑูู ุชุญุฑูู ุฅุญุฏุงุซูุงุช U ููููุงุท ุงูุณูููุฉ ุงููุณุฑู ูุงููููู. </font><font style="vertical-align: inherit;">ูู ุจุชุบููุฑ ุงููุณุงุฑ ูู 1 ุฅูู 0.7 ุ ูุงููููู ูู 0 ุฅูู 0.3.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.7f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>) ); โฆ estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) );</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/850/99d/976/85099d97610434a630621e9e06f885ad.png"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/0c1/567/f72/0c1567f72c979734719b298c7850b59e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุณูุน ุงูููุฑ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅููุงู ุชุฃุซูุฑ ุงูุงูุญูุงุก ุ ูู ุจุชุบููุฑ ุฅุญุฏุงุซูุงุช V ูููุณ ุงูููุงุท ุงูุฃุฑุจุน. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุงูููุงู ุชุชุฏูู ุจุนูุฏูุง ุนู ููุงูุฉ ุงูููุฑ ุ ูุณูู ูุฒูุฏ ุฅุญุฏุงุซูุงุช ุงูููุงุท ุงูุนููุง V ุฅูู 1. ููุฅูุดุงุก ููุญูู ุฃูุถู ุ ุณูุฒูุฏ ุฅุญุฏุงุซูุงุช V ููููุทุชูู ุงูุณูููุชูู ุฅูู 1.15.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.7f</span></span>, <span class="hljs-number"><span class="hljs-number">1.15f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">1.15f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) );</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/1fa/86d/320/1fa86d32037da7fab579ce9a195d1e71.png"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b07/edb/dfe/b07edbdfeb3615b1a597712a6bda5c8e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุฑู ุงูููุฑ ุงูููุญูู.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฒูุฌ ุงูููุฑ ูุงูุณุงุญู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุง ุชุจูู ููุง ูู ูุฒุฌ ุขุซุงุฑ ุงูุณุงุญู ูุงูููุฑ. </font><font style="vertical-align: inherit;">ููููุงู ุจุฐูู ุ ูุณุชุฎุฏู ุงูุงุณุชููุงุก ุงูุฎุทู ุ ูุน ุงูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ูููุฉ ุงูุณุงุญู ูููุญู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> <span class="hljs-type"><span class="hljs-type">float</span></span> shoreWater = max(foam, waves); <span class="hljs-type"><span class="hljs-type">float</span></span> river = River(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv2_MainTex, _MainTex); <span class="hljs-type"><span class="hljs-type">float</span></span> water = lerp(shoreWater, river, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.uv_MainTex.x); fixed4 c = saturate(_Color + water);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุงูุฑุบู ูู ุฃู ูุฐุง ูุฌุจ ุฃู ูุนูู ุ ููุฏ ุชุญุตู ุนูู ุฎุทุฃ ูู ุงูุชุฑุฌูุฉ. </font><font style="vertical-align: inherit;">ุงููุชุฑุฌู ูุดูู ูู ุฅุนุงุฏุฉ ุงูุชุนุฑูู </font></font><code>_MainTex_ST</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุงูุณุจุจ ูู ุฎุทุฃ ุฏุงุฎู ูุฌูุน ุชุธููู ุณุทุญ ุงููุญุฏุฉ ุจุณุจุจ ุงูุงุณุชุฎุฏุงู ุงููุชุฒุงูู ูู </font></font><code>uv_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>uv2_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุญู ุจุญุงุฌุฉ ุฅูู ุฅูุฌุงุฏ ุญู ุจุฏูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏูุงู ูู ุงุณุชุฎุฏุงูู </font></font><code>uv2_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุณูุชุนูู ุนูููุง ููู ุฅุญุฏุงุซูุงุช ุงูุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ ุงูุซุงูููุฉ ูุฏูููุง. </font><font style="vertical-align: inherit;">ููููุงู ุจุฐููุ ุฅุนุงุฏุฉ ุชุณููุฉ </font></font><code>uv2_MainTex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู </font></font><code>riverUV</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุซู ูู ุจุฅุถุงูุฉ ูุธููุฉ ููุฉ ุงูุฑุฃุณ ุฅูู ุฌูุงุฒ ุชุธููู ุ ูุงูุชู ุชููู ุจุชุนููู ุฅุญุฏุงุซูุงุช ููุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql"> #pragma surface surf Standard alpha vertex:vert โฆ struct <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> { float2 uv_MainTex; float2 riverUV; float3 worldPos; }; โฆ <span class="hljs-type"><span class="hljs-type">void</span></span> vert (<span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> appdata_full v, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> o) { UNITY_INITIALIZE_OUTPUT(<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>, o); o.riverUV = v.texcoord1.xy; } <span class="hljs-type"><span class="hljs-type">void</span></span> surf (<span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> SurfaceOutputStandard o) { โฆ <span class="hljs-type"><span class="hljs-type">float</span></span> river = River(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.riverUV, _MainTex); โฆ }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/904/b40/c98/904b40c98323b2e9f32bd16513344181.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุงุณุชููุงุก ุนูู ุฃุณุงุณ ูููุฉ ุงูุณุงุญู. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนูู ุงูุงุณุชููุงุก ุ ุจุงุณุชุซูุงุก ุงูููู ุงููุณุฑู ูุงููููู ูู ุงูุฃุนูู. </font><font style="vertical-align: inherit;">ุนูุฏ ูุฐู ุงูููุงุท ูุฌุจ ุฃู ูุฎุชูู ุงูููุฑ. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูุง ูููููุง ุงุณุชุฎุฏุงู ูููุฉ ุงูุณุงุญู. </font><font style="vertical-align: inherit;">ุณูุชุนูู ุนูููุง ุงุณุชุฎุฏุงู ูููุฉ ูุฎุชููุฉ ุ ูุงูุชู ุชููู ูู ูุฐูู ุงูุฑุฃุณูู ุตูุฑูุง. ูุญุณู ุงูุญุธ ุ ูุง ูุฒุงู ูุฏููุง ุฅุญุฏุงุซูุงุช U ููุฌููุนุฉ ุงูุฃุดุนุฉ ููู ุงูุจููุณุฌูุฉ ุงูุฃููู ุ ุญุชู ูุชููู ูู ุชุฎุฒูู ูุฐู ุงููููุฉ ููุงู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> estuaries.AddQuadUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); estuaries.AddTriangleUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); estuaries.AddQuadUV( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); <span class="hljs-comment"><span class="hljs-comment">// estuaries.AddQuadUV(0f, 0f, 0f, 1f);</span></span></code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b34/e93/432/b34e93432248fb7be818b53aca4d8b20.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุฒูุฌ ุงูุตุญูุญ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ุชุญุชูู ุงูุฃููุงู ุนูู ูุฒูุฌ ุฌูุฏ ุจูู ุงูููุฑ ุงููุชูุณุน ูุงูููุงู ุงูุณุงุญููุฉ ูุงูุฑุบูุฉ. </font><font style="vertical-align: inherit;">ุนูู ุงูุฑุบู ูู ุฃู ูุฐุง ูุง ูุฎูู ุชุทุงุจููุง ุชุงููุง ูุน ุงูุดูุงูุงุช ุ ูุฅู ูุฐุง ุงูุชุฃุซูุฑ ูุจุฏู ุฃูุถูุง ุฌูุฏูุง ูุน ุงูุดูุงูุงุช.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"></font></i> <font style="vertical-align: inherit;"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ูุตุจุงุช ุงูุฃููุงุฑ </font></a><i><font style="vertical-align: inherit;">ูู </font></i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;">ูุญุฏุฉ </font></a><i><font style="vertical-align: inherit;">ุงูุนูู</font></i></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฃููุงุฑ ุงููุชุฏููุฉ ูู ุงููุณุทุญุงุช ุงููุงุฆูุฉ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏููุง ุจุงููุนู ุฃููุงุฑ ุชุชุฏูู ุฅูู ุงููุณุทุญุงุช ุงููุงุฆูุฉ ุ ูููู ูุง ููุฌุฏ ุฏุนู ููุฃููุงุฑ ุงูุชู ุชุชุฏูู ูู ุงุชุฌุงู ูุฎุชูู. </font><font style="vertical-align: inherit;">ููุงู ุจุญูุฑุงุช ุชุชุฏูู ูููุง ุงูุฃููุงุฑ ุ ูุฐุง ูุญุชุงุฌ ุฅูู ุฅุถุงูุชูุง ุฃูุถูุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏูุง ูุชุฏูู ููุฑ ูู ุฌุณู ูุงุฆู ุ ูุฅูู ูุชุฏูู ูู ุงููุงูุน ูุญู ุงุฑุชูุงุน ุฃุนูู. </font><font style="vertical-align: inherit;">ูุฐุง ุบูุฑ ูููู ุญุงููุง. </font><font style="vertical-align: inherit;">ูุญู ุจุญุงุฌุฉ ุฅูู ุฅุฌุฑุงุก ุงุณุชุซูุงุก ูุงูุณูุงุญ ุจูุฐุง ุงููุถุน ุฅุฐุง ูุงู ูุณุชูู ุงููุงุก ูุชูุงูู ูุน ุงุฑุชูุงุน ููุทุฉ ุงููุฏู. </font><font style="vertical-align: inherit;">ุฏุนูุง ูุถูู ุฅูู </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุทุฑููุฉ ุฎุงุตุฉ ุชุชุญูู ููููุง ููุนูุงุฑูุง ุงูุฌุฏูุฏ ูุง ุฅุฐุง ูุงู ุงูุฌุงุฑ ูู ููุทุฉ ุงููุฏู ุงูุตุญูุญุฉ ููููุฑ ุงูุตุงุฏุฑ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValidRiverDestination</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell neighbor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> neighbor &amp;&amp; ( elevation &gt;= neighbor.elevation || waterLevel == neighbor.elevation ); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุณูุณุชุฎุฏู ุทุฑููุชูุง ุงูุฌุฏูุฏุฉ ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ูู ุงููููู ุฅูุดุงุก ููุฑ ุตุงุฏุฑ. </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasOutgoingRiver &amp;&amp; outgoingRiver == direction) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } HexCell neighbor = GetNeighbor(direction); <span class="hljs-comment"><span class="hljs-comment">// if (!neighbor || elevation &lt; neighbor.elevation) { if (!IsValidRiverDestination(neighbor)) { return; } RemoveOutgoingRiver(); โฆ }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃูุถุง ุ ููุงู ุญุงุฌุฉ ููุชุญูู ูู ุงูููุฑ ุนูุฏ ุชุบููุฑ ุงุฑุชูุงุน ุงูุฎููุฉ ุฃู ููุณูุจ ุงูููุงู. </font><font style="vertical-align: inherit;">ูููู ุจุฅูุดุงุก ุทุฑููุฉ ุฎุงุตุฉ ููููุงู ุจูุฐู ุงููููุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ValidateRivers</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( hasOutgoingRiver &amp;&amp; !IsValidRiverDestination(GetNeighbor(outgoingRiver)) ) { RemoveOutgoingRiver(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( hasIncomingRiver &amp;&amp; !GetNeighbor(incomingRiver).IsValidRiverDestination(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) ) { RemoveIncomingRiver(); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุนููุง ูุณุชุฎุฏู ูุฐุง ุงูุฃุณููุจ ุงูุฌุฏูุฏ ูู ุฎุตุงุฆุต </font></font><code>Elevation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>WaterLevel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Elevation { โฆ <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { โฆ <span class="hljs-comment"><span class="hljs-comment">// if ( // hasOutgoingRiver &amp;&amp; // elevation &lt; GetNeighbor(outgoingRiver).elevation // ) { // RemoveOutgoingRiver(); // } // if ( // hasIncomingRiver &amp;&amp; // elevation &gt; GetNeighbor(incomingRiver).elevation // ) { // RemoveIncomingRiver(); // } ValidateRivers(); โฆ } } public int WaterLevel { โฆ set { if (waterLevel == value) { return; } waterLevel = value; ValidateRivers(); Refresh(); } }</span></span></code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/c04/ca4/b49/c04ca4b49ccff20e71dba70dc1a2bea7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุญูุฑุงุช ุงูููุฑ ุงูููุชููุฉ ููุงูุชู.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงููุจ ุงููุฏ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃูุดุฃูุง </font></font><code>HexGridChunk.TriangulateEstuary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ููุง ููุญู ุจุฃู ุงูุฃููุงุฑ ูููู ุฃู ุชุชุฏูู ููุท ูู ุงููุณุทุญุงุช ุงููุงุฆูุฉ. </font><font style="vertical-align: inherit;">ูุฐูู ุ ููุชูุฌุฉ ูุฐูู ุ ูุชุญุฑู ูุฌุฑู ุงูููุฑ ุฏุงุฆููุง ูู ุงุชุฌุงู ูุงุญุฏ. </font><font style="vertical-align: inherit;">ูุญู ุจุญุงุฌุฉ ุฅูู ุนูุณ ุงูุชุฏูู ุนูุฏ ุงูุชุนุงูู ูุน ููุฑ ูุชุฏูู ูู ุฌุณู ูุงุฆู. </font><font style="vertical-align: inherit;">ููููุงู ุจุฐูู ุ ุชุญุชุงุฌ ุฅูู </font></font><code>TriangulateEstuary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนุฑูุฉ ุงุชุฌุงู ุงูุชุฏูู. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูููุญู ูุนููุฉ ููุทููุฉ ุชุญุฏุฏ ูุง ุฅุฐุง ููุง ูุชุนุงูู ูุน ููุฑ ูุงุฑุฏ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, EdgeVertices e2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> incomingRiver </span></span></span><span class="hljs-function">)</span></span> { โฆ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูููู ุจุชูุฑูุฑ ูุฐู ุงููุนูููุงุช ุนูุฏ ุงุณุชุฏุนุงุก ูุฐู ุงูุทุฑููุฉ ูู </font></font><code>TriangulateWaterShore</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiverThroughEdge(direction)) { TriangulateEstuary(e1, e2, cell.IncomingRiver == direction); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ูุญู ุจุญุงุฌุฉ ุฅูู ุชูุณูุน ุชุฏูู ุงูููุฑ ุนู ุทุฑูู ุชุบููุฑ ุฅุญุฏุงุซูุงุช UV2. </font><font style="vertical-align: inherit;">ุชุญุชุงุฌ ุงูุฅุญุฏุงุซูุงุช U ููุฃููุงุฑ ุงูุตุงุฏุฑุฉ ุฅูู ุนูุณูุง: becomes0.5 ูุตุจุญ 1.5 ุ 0 ูุตุจุญ 1 ุ 1 ูุตุจุญ 0 ุ 1.5 ูุตุจุญ โ0.5. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุน ุฅุญุฏุงุซูุงุช V ุ ุชุตุจุญ ุงูุฃููุฑ ุฃูุซุฑ ุชุนููุฏูุง. </font><font style="vertical-align: inherit;">ุฅุฐุง ูุธุฑุช ุฅูู ููููุฉ ุนูููุง ูุน ุงููุตูุงุช ุงูููุฑูุฉ ุงููุนููุณุฉ ุ ููุฌุจ ุฃู ูููู 0.8 0 ุ ู 1 ูุฌุจ ุฃู ูููู โ0.2. </font><font style="vertical-align: inherit;">ูุฐุง ูุนูู ุฃู 1.1 ุชุตุจุญ โ0.3 ุ ู 1.15 ุชุตุจุญ โ0.35. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุฅุญุฏุงุซูุงุช UV2 ูุฎุชููุฉ ุชูุงููุง ูู ูู ุญุงูุฉ ุ ููููุชุจ ุฑูุฒูุง ูููุตูุงู ููู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateEstuary</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices e1, EdgeVertices e2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> incomingRiver </span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (incomingRiver) { estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.7f</span></span>, <span class="hljs-number"><span class="hljs-number">1.15f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1.1f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">1.15f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>) ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">-0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.2f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.35f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.3f</span></span>) ); estuaries.AddTriangleUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.3f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>) ); estuaries.AddQuadUV2( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.3f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0.7f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.35f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">1.5f</span></span>, <span class="hljs-number"><span class="hljs-number">-0.2f</span></span>) ); } }</code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุณุงุฑ ุงูุตุญูุญ ููุฃููุงุฑ. </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h1 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฌุฒุก 9: ููุฒุงุช ุงูุฅุบุงุซุฉ </font></font></h1><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃุถู ุงูุฃุดูุงุก ุฅูู ุงูุฑุงุญุฉ. </font></font></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูููู ุจุฅูุดุงุก ุฏุนู ููุณุชููุงุช ูุซุงูุฉ ุงููุงุฆูุงุช. </font></font></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุณุชุฎุฏู ูุงุฆูุงุช ูุฎุชููุฉ ูู ุงููุณุชูู. </font></font></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฒุฌ ุซูุงุซุฉ ุฃููุงุน ูุฎุชููุฉ ูู ุงููุงุฆูุงุช. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุชุญุฏุซ ูู ูุฐุง ุงูุฌุฒุก ุนู ุฅุถุงูุฉ ูุงุฆูุงุช ุฅูู ุงูุชุถุงุฑูุณ. </font><font style="vertical-align: inherit;">ุณูููู ุจุฅูุดุงุก ูุงุฆูุงุช ูุซู ุงููุจุงูู ูุงูุฃุดุฌุงุฑ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b8b/1ec/f84/b8b1ecf8496a03d50c881bbd47c262ad.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุตุฑุงุน ุจูู ุงูุบุงุจุงุช ูุงูุฃุฑุงุถู ุงูุฒุฑุงุนูุฉ ูุงูุชุญุถุฑ.</font></font></i> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุถุงูุฉ ุฏุนู ูููุงุฆูุงุช </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุงูุฑุบู ูู ุฃู ุดูู ุงูุฅุบุงุซุฉ ูู ุงุฎุชูุงูุงุช ุ ุญุชู ุงูุขู ูุง ูุญุฏุซ ุดูุก ุนููู. </font><font style="vertical-align: inherit;">ูุฐู ุฃุฑุถ ุจูุง ุญูุงุฉ. </font><font style="vertical-align: inherit;">ูุชููุณ ุงูุญูุงุฉ ููู ุ ุชุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ูุซู ูุฐู ุงูุฃุดูุงุก. </font><font style="vertical-align: inherit;">ูุซู ุงูุฃุดุฌุงุฑ ูุงูููุงุฒู. </font><font style="vertical-align: inherit;">ูุฐู ุงูุฃุดูุงุก ููุณุช ุฌุฒุกูุง ูู ุดุจูุฉ ุงูุชุตุฑูู ุ ูููููุง ุณุชููู ูุงุฆูุงุช ูููุตูุฉ. </font><font style="vertical-align: inherit;">ููู ูุฐุง ูุง ูููุนูุง ูู ุฅุถุงูุชูู ุนูุฏ ุชุซููุซ ุงูุชุถุงุฑูุณ. </font></font><br><br> <code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุชูุชู ุจููููุฉ ุนูู ุงูุดุจูุฉ. </font><font style="vertical-align: inherit;">ูุฃูุฑ ุจุจุณุงุทุฉ ุฃุญุฏ ุฃุทูุงูู </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฅุถุงูุฉ ูุซูุซ ุฃู ุฑุจุงุนู. </font><font style="vertical-align: inherit;">ูุจุงููุซู ุ ูููู ุฃู ูุญุชูู ุนูู ุนูุตุฑ ุชุงุจุน ูุชุนุงูู ูุน ูุถุน ุงูุฃุดูุงุก ุนูููุง.</font></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุฏุงุฑุฉ ุงููุงุฆูุงุช </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุนูุง ููุดุฆ ูููููุง </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนุชูู ุจุงูุฃุดูุงุก ุฏุงุฎู ุฌุฒุก ูุงุญุฏ. </font><font style="vertical-align: inherit;">ูุณุชุฎุฏู ููุณ ุงููุฎุทุท ููุง ูู </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ูุนุทูู ุงูุฃุณุงููุจ </font></font><code>Clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ </font></font><code>Apply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุงููุงุฆู ูุญุชุงุฌ ุฅูู ูุถุนู ูู ููุงู ูุง ุ ูุฅู ุงูุทุฑููุฉ </font></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุชููู ูุนููุฉ ุงูููุถุน. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุจุฏุฃ ุจุชุทุจูู ูุงุฑุบ ูู ููุนู ุดูุฆูุง ูู ุงูููุช ุงูุญุงูู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HexFeatureManager</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> {} }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ูููููุง ุฅุถุงูุฉ ุฑุงุจุท ููุซู ูุฐุง ุงููููู ูู </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุซู ููููู ุชุถููููุง ูู ุนูููุฉ ุงูุชุซููุซ ุ ูุซู ุฌููุน ุงูุนูุงุตุฑ ุงููุฑุนูุฉ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexFeatureManager features; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { terrain.Clear(); rivers.Clear(); roads.Clear(); water.Clear(); waterShore.Clear(); estuaries.Clear(); features.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; cells.Length; i++) { Triangulate(cells[i]); } terrain.Apply(); rivers.Apply(); roads.Apply(); water.Apply(); waterShore.Apply(); estuaries.Apply(); features.Apply(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุจุฏุฃ ุจูุถุน ูุงุฆู ูุงุญุฏ ูู ูุณุท ูู ุฎููุฉ </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { Triangulate(d, cell); } features.AddFeature(cell.Position); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ูุญู ุจุญุงุฌุฉ ุฅูู ูุฏูุฑ ูุงุฆู ุญูููู. </font><font style="vertical-align: inherit;">ุฅุถุงูุฉ </font><font style="vertical-align: inherit;">ุทูู ุขุฎุฑ ุฅูู </font><font style="vertical-align: inherit;">ุงูุฌุงูุฒุฉ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hex Grid Chunk</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฅุนุทุงุฆู ูููู </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุซู ููููู ุชูุตูู ุฌุฒุก ุจู.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/eeb/1f4/626/eeb1f462652650c6dfe5e3cb34a2ec12.png"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/51b/7ec/8f2/51b7ec8f20b4a79589fd2b464744230b.png"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/620/c6f/8cd/620c6f8cd7c54c52597fcc289b160c57.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุช ุฅุถุงูุฉ ูุฏูุฑ ูุงุฆู ุฅูู ุงูุฅุนุฏุงุฏ ุงููุณุจู ููุฌุฒุก.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุงุฆูุงุช ุงูุฌุงูุฒุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูุงุฆู ุงูุชุถุงุฑูุณ ุงูุฐู ุณูููู ุจุฅูุดุงุฆูุ </font><font style="vertical-align: inherit;">ููุงุฎุชุจุงุฑ ุงูุฃูู ุ ุงูููุนุจ ููุงุณุจ ุชูุงููุง. </font><font style="vertical-align: inherit;">ุฏุนูุง ููุดุฆ ููุนุจูุง ูุจูุฑูุง ุจูุง ููู ุงูููุงูุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ุจูููุงุณ (3 ุ 3 ุ 3) ุ ููุญููู ุฅูู ุงูุฌุงูุฒุฉ. </font><font style="vertical-align: inherit;">ุฃูุถุง ุฎูู ุงูููุงุฏ ูู. </font><font style="vertical-align: inherit;">ุงุณุชุฎุฏูุช ุงููุงุฏุฉ ุงูุงูุชุฑุงุถูุฉ ุจุงูููู ุงูุฃุญูุฑ. </font><font style="vertical-align: inherit;">ูููุฒูู ุงููุตุงุฏู ูุฃููุง ูุณูุง ุจุญุงุฌุฉ ุฅููู.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/a7a/1b1/315/a7a1b1315e7f2756ac2940dac661f95a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุนุจ ุงูุฌุงูุฒุฉ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุญุชุงุฌ ูุฏูุฑู ุงููุงุฆูุงุช ุฅูู ุฑุงุจุท ููุฐุง ุงูุฅุนุฏุงุฏ ุงููุณุจู ุ ูุฐุง ูู ุจุฅุถุงูุชู ุฅูู </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุซู ูู ุจุชูุตูููู. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุงููุตูู ุฅูู ูููู ุงูุชุญููู ูุทููุจ ููุถุน ุงููุงุฆู ุ ูุฅููุง ูุณุชุฎุฏูู ูููุน ุงูุงุฑุชุจุงุท.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform featurePrefab;</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/cfc/34d/e84/cfc34de84fbc12ac5fde17d7d1d09b58.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏูุฑ ุงููุงุฆู ูุน ุงูุฌุงูุฒุฉ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅูุดุงุก ูุซููุงุช ุงููุงุฆู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููููู ุฌุงูุฒ ุ ููููููุง ุงูุจุฏุก ูู ุฅุถุงูุฉ ููุฒุงุช ุงูุชุถุงุฑูุณ! </font><font style="vertical-align: inherit;">ูุง ุนููู ุณูู ุฅูุดุงุก ูุซูู ูู </font></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฅุนุฏุงุฏ </font><font style="vertical-align: inherit;">ุงููุณุจู </font><font style="vertical-align: inherit;">ูุชุนููู ููุถุนู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(featurePrefab); instance.localPosition = position; }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/dd8/59c/ae5/dd859cae56fa9439e91d0ccb5d659f62.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุซููุงุช ููุฒุงุช ุงูุชุถุงุฑูุณ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุขู ูุตุงุนุฏุง ุ ุณูุชู ููุก ุงูุชุถุงุฑูุณ ุจุงูููุนุจุงุช. </font><font style="vertical-align: inherit;">ุนูู ุงูุฃูู ูุตููู ูู ุงูููุนุจุงุช ุ ูุฃู ุงูุฃุตู ุงููุญูู ูุดุจูุฉ ุงูููุนุจ ูู ุงููุญุฏุฉ ููุน ูู ูุณุท ุงูููุนุจ ุ ูุงูุฌุฒุก ุงูุณููู ุชุญุช ุณุทุญ ุงูููุด. </font><font style="vertical-align: inherit;">ููุถุน ุงูููุนุจุงุช ุนูู ุงูุชุถุงุฑูุณ ุ ูุญุชุงุฌ ุฅูู ุชุญุฑูููุง ูุฃุนูู ูุตู ุงุฑุชูุงุนูุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = position; }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/bb0/6be/89b/bb06be89b647d5ff29f1894bfdcf199b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุนุจุงุช ุนูู ุณุทุญ ุงูุฅุบุงุซุฉ.</font></font></i> <br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฐุง ูู ุงุณุชุฎุฏููุง ุดุจูุฉ ุฃุฎุฑูุ</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl">       .     ,      ,        .       . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงูุทุจุน ุ ุฎูุงูุงูุง ูุดููุฉ ุ ูุฐุง ูุญุชุงุฌ ุฅูู ุชุดููู ููุถุน ุงูุฃุดูุงุก. </font><font style="vertical-align: inherit;">ูุฐูู ูุชุฎูุต ูู ุงูุชูุฑุงุฑ ุงููุซุงูู ููุดุจูุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> instance.localPosition = HexMetrics.Perturb(position);</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/9e5/7ec/a43/9e57eca43cf9127691cb5eb11bc6a11a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุงูู ุงูุฃุดูุงุก ุงููุดููุฉ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุฏููุฑ ููุงุฏ ุงูุฅุบุงุซุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูู ูุฑุฉ ูุชู ูููุง ุชุญุฏูุซ ุฌุฒุก ุ ูููู ุจุฅูุดุงุก ูุงุฆูุงุช ุฅุบุงุซุฉ ุฌุฏูุฏุฉ. </font><font style="vertical-align: inherit;">ูุฐุง ูุนูู ุฃูู ุจูููุง ูููู ุจุฅูุดุงุก ุงููุฒูุฏ ูุงููุฒูุฏ ูู ุงูุฃุดูุงุก ูู ููุณ ุงูููุงูู. </font><font style="vertical-align: inherit;">ูุชุฌูุจ ุงูุชูุฑุงุฑุงุช ุ ูุญุชุงุฌ ุฅูู ุงูุชุฎูุต ูู ุงูุฃุดูุงุก ุงููุฏููุฉ ุนูุฏ ุชูุธูู ุฌุฒุก. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุณุฑุน ุทุฑููุฉ ููููุงู ุจุฐูู ูู ุนู ุทุฑูู ุฅูุดุงุก ูุงุฆู ุญุงููุฉ ุงููุนุจุฉ ูุชุญููู ุฌููุน ูุงุฆูุงุช ุงูุฅุบุงุซุฉ ุฅูู ุฃุทูุงููุง. </font><font style="vertical-align: inherit;">ุซู ุ ุนูุฏูุง </font></font><code>Clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุทูุจ </font><font style="vertical-align: inherit;">ุ </font><font style="vertical-align: inherit;">ุณูู ูุฏูุฑ ูุฐู ุงูุญุงููุฉ ูููุดุฆ ุญุงููุฉ ุฌุฏูุฏุฉ. </font><font style="vertical-align: inherit;">ุงูุญุงููุฉ ููุณูุง ุณุชููู ุชุงุจุนุฉ ููุฏูุฑูุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> Transform container; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (container) { Destroy(container.gameObject); } container = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GameObject(<span class="hljs-string"><span class="hljs-string">"Features Container"</span></span>).transform; container.SetParent(transform, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } โฆ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุจูุง ุ ูู ุบูุฑ ุงููุนุงู ุฅูุดุงุก ูุชุฏููุฑ ุฃุฌุณุงู ุงูุฅุบุงุซุฉ ูู ูู ูุฑุฉ.</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl"> , ,   .       .      .   ,  ,      ,    .          <code>HexFeatureManager.Apply</code> .      .  ,    ,       . </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุถุน ุฃุดูุงุก ุงูุฅุบุงุซุฉ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจูููุง ูุถุน ุงูุฃุดูุงุก ูู ูุณุท ูู ุฎููุฉ. </font><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ููุฎูุงูุง ุงููุงุฑุบุฉ ุ ูุจุฏู ูุฐุง ุทุจูุนููุง ุ ูููู ุนูู ุงูุฎูุงูุง ุงูุชู ุชุญุชูู ุนูู ุงูุฃููุงุฑ ูุงูุทุฑู ุ ููุฐูู ุงููุบููุฑุฉ ุจุงููุงุก ุ ูุจุฏู ุงูุฃูุฑ ุบุฑูุจูุง.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/01d/e88/ab8/01de88ab8777d38afeb4ca374571a2f1.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุงุฆูุงุช ูู ูู ููุงู. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐูู ุ ุฏุนูุง ูุชุญูู ูุจู ูุถุน ุงููุงุฆู </font></font><code>HexGridChunk.Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุฅุฐุง ูุงูุช ุงูุฎููุฉ ูุงุฑุบุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell.Position); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/5db/b98/75f/5dbb9875f8510c7f9224f8ba10465ae4.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูู ูุญุฏูุฏ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุงุฆู ูุงุญุฏ ููู ุงุชุฌุงู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฆู ูุงุญุฏ ููุท ููู ุฎููุฉ ููุณ ูุซูุฑูุง. </font><font style="vertical-align: inherit;">ูุง ูุฒุงู ููุงู ูุณุงุญุฉ ูุจูุฑุฉ ููุฌููุนุฉ ูู ุงูุฃุดูุงุก. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูุถูู ูุงุฆููุง ุฅุถุงูููุง ุฅูู ูุฑูุฒ ูู ูู ุงููุซูุซุงุช ุงูุณุชุฉ ููุฎููุฉ ุ ุฃู ูุงุญุฏ ููู ุงุชุฌุงู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณููุนู ุฐูู ุจุทุฑููุฉ ุฃุฎุฑู </font></font><code>Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ุนูุฏูุง ูุนูู ุฃูู ูุง ููุฌุฏ ููุฑ ูู ุงูุฎููุฉ. </font><font style="vertical-align: inherit;">ูุง ุฒููุง ุจุญุงุฌุฉ ุฅูู ุงูุชุญูู ููุง ุฅุฐุง ููุง ุชุญุช ุงููุงุก ููุง ุฅุฐุง ูุงู ููุงู ุทุฑูู ูู ุงูุฒูุฒุงูุฉ. </font><font style="vertical-align: inherit;">ูููู ูู ูุฐู ุงูุญุงูุฉ ุ ูุญู ููุชููู ููุท ุจุงูุทุฑู ุงูุชู ุชุณูุฑ ูู ุงูุงุชุฌุงู ุงูุญุงูู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.HasRiver) { โฆ } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateWithoutRiver(direction, cell, center, e); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRoadThroughEdge(direction)) { features.AddFeature((center + e.v1 + e.v5) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>)); } } โฆ }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/7e7/b60/d4b/7e7b60d4b54d2f9a7b3119e78554507a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุนุฏูุฏ ูู ุงููุฑุงูู ุ ูููู ููุณ ุจุงููุฑุจ ูู ุงูุฃููุงุฑ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐุง ูุฎูู ุงููุซูุฑ ูู ุงูุฃุดูุงุก! </font><font style="vertical-align: inherit;">ุชุธูุฑ ุจุงููุฑุจ ูู ุงูุทุฑู ุ ููููุง ูุง ุชุฒุงู ุชุชุฌูุจ ุงูุฃููุงุฑ. </font><font style="vertical-align: inherit;">ููุถุน ุงูุฃุดูุงุก ุนูู ุทูู ุงูุฃููุงุฑ ุ ูููููุง ุฃูุถูุง ุฅุถุงูุชูุง ุฅูู ุงูุฏุงุฎู </font></font><code>TriangulateAdjacentToRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูููู ูุฑุฉ ุฃุฎุฑู ููุท ุนูุฏูุง ูุง ูููู ุงููุซูุซ ุชุญุช ุงููุงุก ููุง ููุฌุฏ ุทุฑูู ุนููู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRoadThroughEdge(direction)) { features.AddFeature((center + e.v1 + e.v5) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>)); } }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/30c/90a/f9f/30c90af9ffb31cec360ea027fc4f1815.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุธูุฑุช ุงูุฃุดูุงุก ุจุฌุงูุจ ุงูุฃููุงุฑ.</font></font></i> <br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูู ุงููููู ุชูุฏูู ุฃุดูุงุก ูุซูุฑุฉุ</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl">       ,    dynamic batching  Unity.    ,       .         batch.     ยซ ยป,       .    instancing,          dynamic batching. </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฌููุนุฉ ูุชููุนุฉ ูู ุงูุฃุดูุงุก </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฌููุน ุฃุฏูุงุช ุงูุฅุบุงุซุฉ ูุฏููุง ููุง ููุณ ุงูุงุชุฌุงู ุ ูุงูุฐู ูุจุฏู ุบูุฑ ุทุจูุนู ุชูุงููุง. </font><font style="vertical-align: inherit;">ุฏุนููุง ูุนุทู ูู ูุงุญุฏ ููุณุฉ ุนุดูุงุฆูุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b42/8bd/0bc/b428bd0bcb9b27676853f7bb1e491165.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุญูู ุนุดูุงุฆู. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐูู ุชุตุจุญ ุงููุชูุฌุฉ ุฃูุซุฑ ุชููุนูุง. </font><font style="vertical-align: inherit;">ูุณูุก ุงูุญุธ ุ ูู ูู ูุฑุฉ ูุชู ุชุญุฏูุซ ุฌุฒุก ุ ุชุชููู ุงููุงุฆูุงุช ุฏูุฑุงู ุนุดูุงุฆู ุฌุฏูุฏ. </font><font style="vertical-align: inherit;">ุชุญุฑูุฑ ุงูุฎูุงูุง ูุง ูุฌุจ ุฃู ูุบูุฑ ุงูุฃุดูุงุก ูู ุงูุญู ุ ูุฐูู ูุญู ุจุญุงุฌุฉ ุฅูู ููุฌ ูุฎุชูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏููุง ูุณูุฌ ุถุฌูุฌ ูู ููุณู ุฏุงุฆููุง. </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ูุญุชูู ูุฐุง ุงููููุณ ุนูู ุถูุถุงุก ุงูุชุฏุฑุฌ ูู Perlin ุ ููู ูุชุณู ูุญูููุง. </font><font style="vertical-align: inherit;">ูุฐุง ูู ุจุงูุถุจุท ูุง ูุญุชุงุฌู ุนูุฏ ุชุดููู ููุงูุน ุงูููู ูู ุงูุฎูุงูุง. </font><font style="vertical-align: inherit;">ููู ูุง ูุฌุจ ุฃู ุชููู ุงูุฃุฏูุงุฑ ูุชุณูุฉ. </font><font style="vertical-align: inherit;">ูุฌุจ ุฃู ุชููู ุฌููุน ุงูุฃุฏูุงุฑ ูุญุชููุฉ ููุฎุชูุทุฉ. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูุญุชุงุฌ ุฅูู ูุณูุฌ ุจููู ุนุดูุงุฆูุฉ ุบูุฑ ูุชุฏุฑุฌุฉ ุ ูุงูุชู ูููู ุฃุฎุฐ ุนููุงุช ูููุง ุจุฏูู ุชุตููุฉ ุซูุงุฆูุฉ. </font><font style="vertical-align: inherit;">ุจุดูู ุฃุณุงุณู ุ ูุฐู ุดุจูุฉ ุชุฌุฒุฆุฉ ุชุดูู ุฃุณุงุณ ุถุฌูุฌ ุงูุชุฏุฑุฌ.</font></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅูุดุงุก ุฌุฏูู ุชุฌุฒุฆุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููููุง ุฅูุดุงุก ุฌุฏูู ุชุฌุฒุฆุฉ ูู ูุตูููุฉ ูู ุงูููู ุงูุนุงุฆูุฉ ูุชุนุจุฆุชู ูุฑุฉ ูุงุญุฏุฉ ุจููู ุนุดูุงุฆูุฉ. </font><font style="vertical-align: inherit;">ุจูุถู ูุฐุง ุ ูุง ูุญุชุงุฌ ุฅูู ูุณูุฌ ุนูู ุงูุฅุทูุงู. </font><font style="vertical-align: inherit;">ุฏุนูุง ูุถููู ุฅูู </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุญุฌู 256 ร 256 ูููู ููุชููุน ุงููุงูู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hashGridSize = <span class="hljs-number"><span class="hljs-number">256</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] hashGrid; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { hashGrid = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[hashGridSize * hashGridSize]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashGrid.Length; i++) { hashGrid[i] = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชู ุฅูุดุงุก ุงูููู ุงูุนุดูุงุฆูุฉ ุจูุงุณุทุฉ ุตูุบุฉ ุฑูุงุถูุฉ ุชุนุทู ุฏุงุฆููุง ููุณ ุงููุชุงุฆุฌ. </font><font style="vertical-align: inherit;">ูุนุชูุฏ ุงูุชุณูุณู ุงููุงุชุฌ ุนูู ุนุฏุฏ ุงูุจุฐูุฑ ุ ูุงูุชู ุชุณุงูู ุงูุชุฑุงุถููุง ุงููููุฉ ุงูุญุงููุฉ ููููุช. </font><font style="vertical-align: inherit;">ูุฐุง ูู ุงูุณุจุจ ูู ุฃููุง ูู ูู ุฌูุณุฉ ูุนุจุฉ ุณูู ูุญุตู ุนูู ูุชุงุฆุฌ ูุฎุชููุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุถูุงู ุฅุนุงุฏุฉ ุฅูุดุงุก ูุงุฆูุงุช ูุชุทุงุจูุฉ ุฏุงุฆููุง ุ ูุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ูุนููุฉ ุงูุจุฐูุฑ ุฅูู ุทุฑููุฉ ุงูุชููุฆุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> seed</span></span></span><span class="hljs-function">)</span></span> { hashGrid = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[hashGridSize * hashGridSize]; Random.InitState(seed); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashGrid.Length; i++) { hashGrid[i] = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ุจุนุฏ ุฃู ูููุง ุจุชููุฆุฉ ุฏูู ุงูุฃุฑูุงู ุงูุนุดูุงุฆูุฉ ุ ุณูุญุตู ุฏุงุฆููุง ุนูู ููุณ ุงูุชุณูุณู ููู. </font><font style="vertical-align: inherit;">ูุฐูู ุ ุณุชููู ุงูุฃุญุฏุงุซ ุงูุชู ุชุจุฏู ุนุดูุงุฆูุฉ ุจุนุฏ ุฅูุดุงุก ุงูุฎุฑูุทุฉ ูู ููุณูุง ุฏุงุฆููุง. </font><font style="vertical-align: inherit;">ูููููุง ุชุฌูุจ ุฐูู ุนู ุทุฑูู ุชุฎุฒูู ุญุงูุฉ ูููุฏ ุงูุฃุฑูุงู ุงูุนุดูุงุฆูุฉ ูุจู ุชููุฆุชู. </font><font style="vertical-align: inherit;">ุจุนุฏ ุงูุงูุชูุงุก ูู ุงูุนูู ุ ูููููุง ุฃู ูุทูุจ ููู ุงูุฏููุฉ ุงููุฏููุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> Random.State currentState = Random.state; Random.InitState(seed); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashGrid.Length; i++) { hashGrid[i] = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } Random.state = currentState;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุชู ุชููุฆุฉ ุฌุฏูู ุงูุชุฌุฒุฆุฉ </font></font><code>HexGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ููุณ ุงูููุช ุงูุฐู ูุนูู ููู ูุณูุฌ ุงูุถูุถุงุก. </font><font style="vertical-align: inherit;">ูุฐุง ูู ุ ูู ุงูุฃุณุงููุจ </font></font><code>HexGrid.Start</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>HexGrid.Awake</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุตูุนูุง ุจุญูุซ ูุง ูุชู ุชูููุฏ ุงูููู ุฃูุซุฑ ูู ุงููุงุฒู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> seed; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexMetrics.noiseSource = noiseSource; HexMetrics.InitializeHashGrid(seed); โฆ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!HexMetrics.noiseSource) { HexMetrics.noiseSource = noiseSource; HexMetrics.InitializeHashGrid(seed); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณูุญ ููุง ูุชุบูุฑ ุงูุจุฐูุฑ ุงูุนุงู ุจุชุญุฏูุฏ ูููุฉ ุงูุจุฐูุฑ ููุฎุฑูุทุฉ. </font><font style="vertical-align: inherit;">ุณุชูุนู ุฃู ูููุฉ. </font><font style="vertical-align: inherit;">ุงุฎุชุฑุช 1234.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/60c/8b3/5a3/60c8b35a3b6a92b61165ed3a00473076.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุฎุชูุงุฑ ุงูุจุฐูุฑ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจุงุณุชุฎุฏุงู ุฌุฏูู ุงูุชุฌุฒุฆุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุณุชุฎุฏุงู ุฌุฏูู ุงูุชุฌุฒุฆุฉ ุ ุฃุถู ุฅูู </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุทุฑููุฉ ุฃุฎุฐ ุงูุนููุงุช. </font><font style="vertical-align: inherit;">ูุซู </font></font><code>SampleNoise</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูุณุชุฎุฏู ุฅุญุฏุงุซูุงุช ููุถุน XZ ููุญุตูู ุนูู ุงููููุฉ. </font><font style="vertical-align: inherit;">ุชู ุงูุนุซูุฑ ุนูู ููุฑุณ ุงูุชุฌุฒุฆุฉ ุนู ุทุฑูู ูุตุฑ ุงูุฅุญุฏุงุซูุงุช ุนูู ุงูููู ุงูุตุญูุญุฉ ุ ุซู ุงูุญุตูู ุนูู ูุง ุชุจูู ูู ุงููุณูุฉ ุงูุตุญูุญุฉ ุญุณุจ ุญุฌู ุงูุฌุฏูู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)position.x % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)position.z % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hashGrid[x + z * hashGridSize]; }</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฐุง ุชูุนููชุ</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl">   ,     ,    โ  . ,  โ4, โ3, โ2, โ1, 0, 1, 2, 3, 4 modulo 3   โ1, 0, โ2, โ1, 0, 1, 2, 0, 1. </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐุง ูุนูู ููุฅุญุฏุงุซูุงุช ุงูุฅูุฌุงุจูุฉ ุ ูููู ููุณ ููุฅุญุฏุงุซูุงุช ุงูุณูุจูุฉ ุ ูุฃู ูุซู ูุฐู ุงูุฃุฑูุงู ุณูููู ุงูุจุงูู ุณุงูุจูุง. </font><font style="vertical-align: inherit;">ูููููุง ุฅุตูุงุญ ุฐูู ุนู ุทุฑูู ุฅุถุงูุฉ ุญุฌู ุงูุฌุฏูู ุฅูู ุงููุชุงุฆุฌ ุงูุณูุจูุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)position.x % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { x += hashGridSize; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)position.z % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (z &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { z += hashGridSize; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ููู ูุญุฏุฉ ูุฑุจุนุฉ ูุฎูู ูููุชูุง ุงูุฎุงุตุฉ. </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ูู ุงููุงูุน ุ ูุง ูุญุชุงุฌ ุฅูู ูุซุงูุฉ ุงูุฌุฏูู ูุฐู. </font><font style="vertical-align: inherit;">ุงููุงุฆูุงุช ูุชุจุงุนุฏุฉ ุนู ุจุนุถูุง ุงูุจุนุถ. </font><font style="vertical-align: inherit;">ูููููุง ุชูุฏูุฏ ุงูุฌุฏูู ุนู ุทุฑูู ุชูููู ูููุงุณ ุงูููุถุน ูุจู ุญุณุงุจ ุงููุคุดุฑ. </font><font style="vertical-align: inherit;">ูููุฉ ูุฑูุฏุฉ ูุงุญุฏุฉ ููุฑุจุน 4 ร 4 ุณุชููู ูุงููุฉ ุจุงููุณุจุฉ ููุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> hashGridScale = <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(position.x * hashGridScale) % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { x += hashGridSize; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(position.z * hashGridScale) % hashGridSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (z &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { z += hashGridSize; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hashGrid[x + z * hashGridSize]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุนูุง ูุนูุฏ ุฅูู </font></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุณุชุฎุฏู ุฌุฏูู ุงูุชุฌุฒุฆุฉ ุงูุฌุฏูุฏ ููุญุตูู ุนูู ุงููููุฉ. </font><font style="vertical-align: inherit;">ุจุนุฏ ุชุทุจููู ูุชุญุฏูุฏ ุงูุฏูุฑุงู ุ ุณุชุธู ุงููุงุฆูุงุช ุซุงุจุชุฉ ุนูุฏ ุชุญุฑูุฑ ุงูุชุถุงุฑูุณ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> hash = HexMetrics.SampleHashGrid(position); Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนุชุจุฉ ุงูุชูุณูุจ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุงูุฑุบู ูู ุฃู ุงููุงุฆูุงุช ููุง ุฏูุฑุงู ูุฎุชูู ุ ุฅูุง ุฃู ุงูููุท ูุง ูุฒุงู ููุญูุธูุง ูู ููุถุนู. </font><font style="vertical-align: inherit;">ุชุญุชูู ูู ุฎููุฉ ุนูู ุณุจุนุฉ ุฃุดูุงุก. </font><font style="vertical-align: inherit;">ูููููุง ุฅุถุงูุฉ ููุถู ุฅูู ูุฐุง ุงููุฎุทุท ุ ุชุฎุทู ุจุนุถ ุงููุงุฆูุงุช ุจุดูู ุชุนุณูู. </font><font style="vertical-align: inherit;">ููู ููุฑุฑ ูุง ุฅุฐุง ูุงู ูุฌุจ ุฅุถุงูุฉ ูุงุฆู ุฃู ูุงุ </font><font style="vertical-align: inherit;">ุจุงูุทุจุน ุ ุชุญูู ูู ูููุฉ ุนุดูุงุฆูุฉ ุฃุฎุฑู! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃู ุงูุขู ุ ุจุฏูุงู ูู ูููุฉ ุชุฌุฒุฆุฉ ูุงุญุฏุฉ ุ ูุญุชุงุฌ ุฅูู ุงุซูุชูู. </font><font style="vertical-align: inherit;">ูููู ุฅุถุงูุฉ ุฏุนููู ุจุงุณุชุฎุฏุงู ุงูุชุฌุฒุฆุฉ ุจุฏูุงู ูู </font></font><code>float</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุบูุฑ </font><font style="vertical-align: inherit;">ูููุน ุตููู ุงูุฌุฏูู </font></font><code>Vector2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ููู ุนูููุงุช ูุงููุงุช ูุง ูุนูู ูููู ุงูุชุฌุฒุฆุฉ ุ ูุฐูู ุฏุนููุง ุฅูุดุงุก ุจููุฉ ุฎุงุตุฉ ููุฐุง ุงูุบุฑุถ. </font><font style="vertical-align: inherit;">ุณุชุญุชุงุฌ ููุท ุฅูู ูููุชูู ุนุงุฆูุชูู. </font><font style="vertical-align: inherit;">ูุฏุนูุง ูุถูู ุทุฑููุฉ ุซุงุจุชุฉ ูุฅูุดุงุก ุฒูุฌ ูู ุงูููู ุงูุนุดูุงุฆูุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> HexHash { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a, b; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexHash hash; hash.a = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; hash.b = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash; } }</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃูุง ุชุญุชุงุฌ ุฅูู ุฅุฌุฑุงุก ุชุณูุณูุ</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl">        ,  ,        Unity. ,     . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุจุชุบููุฑู </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุญูุซ ูุณุชุฎุฏู ุงููููู ุงูุฌุฏูุฏ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> HexHash[] hashGrid; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> seed</span></span></span><span class="hljs-function">)</span></span> { hashGrid = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HexHash[hashGridSize * hashGridSize]; Random.State currentState = Random.state; Random.InitState(seed); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashGrid.Length; i++) { hashGrid[i] = HexHash.Create(); } Random.state = currentState; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleHashGrid</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { โฆ }</code> </pre> <br><font style="vertical-align: inherit;"></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏูู </font><font style="vertical-align: inherit;">ุงูุขู </font><font style="vertical-align: inherit;">ุญู ุงููุตูู ุฅูู ูููุชู ุงูุชุฌุฒุฆุฉ. </font><font style="vertical-align: inherit;">ุฏุนูุง ูุณุชุฎุฏู ุงูุฃูู ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุณูุชู ุฅุถุงูุฉ ูุงุฆู ุฃู ุชุฎุทูู. </font><font style="vertical-align: inherit;">ุฅุฐุง ูุงูุช ุงููููุฉ ุชุณุงูู 0.5 ุฃู ุฃูุจุฑ ูููุง ุ ููู ุจุงูุชุฎุทู. </font><font style="vertical-align: inherit;">ูู ุฎูุงู ุฐูู ุ ุณูุชุฎูุต ูู ุญูุงูู ูุตู ุงูุฃุดูุงุก. </font><font style="vertical-align: inherit;">ุณูุชู ุงุณุชุฎุฏุงู ุงููููุฉ ุงูุซุงููุฉ ูุงููุนุชุงุฏ ูุชุญุฏูุฏ ุงูุฏูุฑุงู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash.a &gt;= <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Transform instance = Instantiate(featurePrefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash.b, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/e89/e69/761/e89e697613f8eef3d149b07720e8a26a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชู ุชูููู ูุซุงูุฉ ุงูุฃุดูุงุก ุจูุณุจุฉ 50ูช. </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฑุณู ุงููุงุฆูุงุช </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏูุงู ูู ูุถุน ุงูุฃุดูุงุก ูู ูู ููุงู ุ ุฏุนูุง ูุฌุนููุง ูุงุจูุฉ ููุชุญุฑูุฑ. </font><font style="vertical-align: inherit;">ููููุง ูู ูุฑุณู ูุงุฆูุงุช ูููุตูุฉ ุ ูููู ูุถูู ูุณุชูู ุงููุงุฆูุงุช ุฅูู ูู ุฎููุฉ. </font><font style="vertical-align: inherit;">ุณูุชุญูู ูุฐุง ุงููุณุชูู ูู ุงุญุชูุงููุฉ ุธููุฑ ุงูุฃุดูุงุก ูู ุงูุฎููุฉ. </font><font style="vertical-align: inherit;">ุจุดูู ุงูุชุฑุงุถู ุ ุงููููุฉ ูู ุตูุฑ ุ ุฃู ุฃู ุงููุงุฆูุงุช ุณุชููู ุบูุฑ ููุฌูุฏุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุงูููุนุจุงุช ุงูุญูุฑุงุก ุนูู ุชุถุงุฑูุณูุง ูุง ุชุจุฏู ูุงุฆูุงุช ุทุจูุนูุฉ ุ ูููุทูู ุนูููุง ุงุณู ุงููุจุงูู. </font><font style="vertical-align: inherit;">ุณูู ููุซููู ุงูุชุญุถุฑ. </font><font style="vertical-align: inherit;">ุฏุนููุง ูุถูู ุฅูู </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณุชูู ุงูุชุญุถุฑ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> UrbanLevel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> urbanLevel; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (urbanLevel != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { urbanLevel = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> urbanLevel;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููููุง ุฃู ูุฌุนู ูุณุชูู ุงูุชุญุถุฑ ูุฎููุฉ ุชุญุช ุงููุงุก ูุณุงูู ุงูุตูุฑ ุ ููู ูุฐุง ููุณ ุถุฑูุฑููุง ุ ูุชุฎุทู ุฅูุดุงุก ูุงุฆูุงุช ุชุญุช ุงููุงุก ุนูู ุฃู ุญุงู. </font><font style="vertical-align: inherit;">ูุฑุจูุง ุณูุถูู ูู ูุฑุญูุฉ ูุง ุงููุณุทุญุงุช ุงููุงุฆูุฉ ููุชุญุถุฑ ุ ูุซู ุงูุฃุฑุตูุฉ ูุงูููุงูู ุชุญุช ุงููุงุก.</font></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุฒูู ุงููุซุงูุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุบููุฑ ูุณุชูู ุงูุชุญุถุฑ ุ ูุถูู </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุดุฑูุท ุชูุฑูุฑ </font><font style="vertical-align: inherit;">ุฅุถุงูู </font><font style="vertical-align: inherit;">ููุฏุนู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeUrbanLevel; โฆ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyUrbanLevel; โฆ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplyUrbanLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applyUrbanLevel = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetUrbanLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { activeUrbanLevel = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)level; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyWaterLevel) { cell.WaterLevel = activeWaterLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyUrbanLevel) { cell.UrbanLevel = activeUrbanLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (riverMode == OptionalToggle.No) { cell.RemoveRiver(); } โฆ } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุถู ููุฒูููุง ุขุฎุฑ ุฅูู ูุงุฌูุฉ ุงููุณุชุฎุฏู ูุงุฏูุฌู ุจุงูุทุฑู ุงูููุงุณุจุฉ. </font><font style="vertical-align: inherit;">ุณุฃุถุน ููุญุฉ ุฌุฏูุฏุฉ ุนูู ุงูุฌุงูุจ ุงูุฃููู ูู ุงูุดุงุดุฉ ูุชุฌูุจ ุชุฌุงูุฒ ุงูููุญุฉ ุงููุณุฑู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุนุฏุฏ ุงููุณุชููุงุช ุงูุชู ูุญุชุงุฌูุงุ </font><font style="vertical-align: inherit;">ุฏุนูุง ูุชุญุฏุซ ุนู ุฃุฑุจุนุฉ ุ ุชุดูุฑ ุฅูู ุงูุตูุฑ ุ ุงููุซุงูุฉ ุงูููุฎูุถุฉ ูุงููุชูุณุทุฉ ูุงูุนุงููุฉ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/02f/e64/996/02fe649968954603df834d2a3b5f633b.png"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/95e/9e4/6f5/95e9e46f5ff83a9b7d713e85db86d67a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฒูู ุงูุชุญุถุฑ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุบููุฑ ุงูุนุชุจุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ุจุนุฏ ุฃู ุฃุตุจุญ ูุฏููุง ูุณุชูู ุงูุชุญุถุฑ ุ ูุญุชุงุฌ ุฅูู ุงุณุชุฎุฏุงูู ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุณูุชู ูุถุน ุงูุฃุดูุงุก. </font><font style="vertical-align: inherit;">ููููุงู ุจุฐูู ุ ูุญู ุจุญุงุฌุฉ ุฅูู ุฅุถุงูุฉ ูุณุชูู ุงูุชุญุถุฑ ููุนููุฉ ุฅุถุงููุฉ ู </font></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ููุฃุฎุฐ ุฎุทูุฉ ุฃุฎุฑู ููููู ุงูุฎููุฉ ููุณูุง ููุท. </font><font style="vertical-align: inherit;">ูู ุงููุณุชูุจู ุ ุณูููู ุฃูุซุฑ ููุงุกูุฉ ุจุงููุณุจุฉ ููุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅู ุฃุณุฑุน ุทุฑููุฉ ูุงุณุชุฎุฏุงู ูุณุชูู ุงูุชุญุถุฑ ูู ุถุฑุจูุง ูู 0.25 ูุงุณุชุฎุฏุงู ุงููููุฉ ูุญุฏ ุฌุฏูุฏ ูุชุฎุทู ุงููุงุฆูุงุช. </font><font style="vertical-align: inherit;">ููุชูุฌุฉ ูุฐูู ุ ุณูุฒุฏุงุฏ ุงุญุชูุงู ุธููุฑ ุงููุงุฆู ูุน ูู ูุณุชูู ุจูุณุจุฉ 25ูช.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash.a &gt;= cell.UrbanLevel * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } โฆ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ููุฌุญ ูุฐุง ุ ุฏุนูุง ููุฑุฑ ุงูุฎูุงูุง ุฅูู </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell, cell.Position); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction, HexCell cell</span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRoadThroughEdge(direction)) { features.AddFeature(cell, (center + e.v1 + e.v5) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>)); } โฆ } โฆ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRoadThroughEdge(direction)) { features.AddFeature(cell, (center + e.v1 + e.v5) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>)); } }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/fd8/7e9/de5/fd87e9de5b6b6ea4b4b490549ae5cbf5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฑุณู ูุณุชููุงุช ูุซุงูุฉ ุงูุชุญุถุฑ. </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุนุฏูุฏ ูู ุงููุจุงูู ุงูุฌุงูุฒุฉ ูุฃุดูุงุก ุงูุฅุบุงุซุฉ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุชููู ุงูุงุฎุชูุงูุงุช ูู ุงุญุชูุงููุฉ ุธููุฑ ุงูุฃุดูุงุก ูุฅุญุฏุงุซ ูุตู ูุงุถุญ ุจูู ุงููุณุชููุงุช ุงูููุฎูุถุฉ ูุงูุนุงููุฉ ููุชุญุถุฑ. ูู ุจุนุถ ุงูุฎูุงูุง ุ ุณูููู ููุงู ุจุจุณุงุทุฉ ุฃูุซุฑ ุฃู ุฃูู ูู ุงูุนุฏุฏ ุงููุชููุน ูููุจุงูู. ูููููุง ุฃู ูุฌุนู ุงููุฑู ุฃูุซุฑ ูุถูุญูุง ุจุงุณุชุฎุฏุงู ุงูุจุงุฏุฆุฉ ุงูุฎุงุตุฉ ุจูุง ููู ูุณุชูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูู ูุชุฎูุต ูู ุงูุญูู </font></font><code>featurePrefab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุณุชุจุฏุงูู ุจูุฌููุนุฉ ูู ุงููุจุงูู ุงูุฌุงูุฒุฉ ููุชุญุถุฑ. ููุญุตูู ุนูู ุงูุจุงุฏุฆุฉ ุงูููุงุณุจุฉ ุ ุณูุทุฑุญ ูุงุญุฏูุง ูู ูุณุชูู ุงูุชุญุถุฑ ููุณุชุฎุฏู ุงููููุฉ ููุคุดุฑ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs">&lt;del&gt;<span class="hljs-comment"><span class="hljs-comment">// public Transform featurePrefab;&lt;/del&gt; public Transform[] urbanPrefabs; public void AddFeature (HexCell cell, Vector3 position) { โฆ Transform instance = Instantiate(urbanPrefabs[cell.UrbanLevel - 1]); โฆ }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูุดุงุก ูุณุฎุชูู ููุฑุฑุฉ ูู ุงููุงุฆู ุ ูุฅุนุงุฏุฉ ุชุณููุชูุง ูุชุบููุฑูุง ุจุญูุซ ุชุดูุฑ ุฅูู ุซูุงุซุฉ ูุณุชููุงุช ูุฎุชููุฉ ูู ุงูุชุญุถุฑ. </font><font style="vertical-align: inherit;">ุงููุณุชูู 1 ุฐู ูุซุงูุฉ ููุฎูุถุฉ ุ ูุฐูู ูุณุชุฎุฏู ููุนุจูุง ุจุทูู ูุญุฏุฉ ูู ุงูุญุงูุฉ ุ ููุฏูุงูุฉ ุนูู ููุฎ. </font><font style="vertical-align: inherit;">ุณุฃููู ุจููุงุณ ุงููุณุชูู 2 ุงูุฌุงูุฒ ุฅูู (1.5 ุ 2 ุ 1.5) ุจุญูุซ ูุจุฏู ููุฃูู ูุจูู ูู ุทุงุจููู. </font><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ูููุจุงูู ุนุงููุฉ ุงููุณุชูู 3 ุ ุงุณุชุฎุฏูุช ุงููููุงุณ (2 ุ 5 ุ 2).</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b83/4ad/cb6/b834adcb61a34d1e30cdec28925f066f.png"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/d4f/41d/552/d4f41d5529d4716924345520ffc36280.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุณุชุฎุฏุงู ุงููุจุงูู ุงูุฌุงูุฒุฉ ุงููุฎุชููุฉ ููู ูุณุชูู ูู ุงูุชุญุถุฑ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฒูุฌ ุงูุฌุงูุฒุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณูุง ูุทุงูุจูู ุจุงูุญุฏ ูู ุงููุตู ุงูุฏููู ุจูู ุฃููุงุน ุงููุจุงูู. ููููู ูุฒุฌูุง ููููุงู ุ ููุง ูุญุฏุซ ูู ุงูุนุงูู ุงูุญูููู. ุจุฏูุงู ูู ุนุชุจุฉ ูุงุญุฏุฉ ููู ูุณุชูู ุ ุฏุนูุง ูุณุชุฎุฏู ุซูุงุซุฉ ุ ูุงุญุฏ ููู ููุน ูู ุงููุจุงูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงููุณุชูู 1 ูุณุชุฎุฏู ูุถุน ุงูุฃููุงุฎ ูู 40ูช ูู ุงูุญุงูุงุช. ูู ูููู ููุงู ูุจุงูู ุฃุฎุฑู ููุง ุนูู ุงูุฅุทูุงู. ุจุงููุณุจุฉ ูููุณุชูู ุ ูุณุชุฎุฏู ุงูููู ุงูุซูุงุซ (0.4 ุ 0 ุ 0). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงููุณุชูู 2 ุ ุงุณุชุจุฏู ุงูุฃููุงุฎ ุจูุจุงูู ุฃูุจุฑ ุ ูุฃุถู ูุฑุตุฉ 20ูช ููุฃููุงุฎ ุงูุฅุถุงููุฉ. ูู ูููู ุจุงููุจุงูู ุงูุนุงููุฉ. ุฃู ุฃููุง ูุณุชุฎุฏู ุงูููู ุงูุซูุงุซ ุงูุนุชุจุฉ (0.2 ุ 0.4 ุ 0). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงููุณุชูู 3 ุ ูุณุชุจุฏู ุงููุจุงูู ุงููุชูุณุทุฉ ุจุฃุฎุฑู ุทูููุฉ ุ ููุณุชุจุฏู ุงูุฃููุงุฎ ูุฑุฉ ุฃุฎุฑู ุ ููุถูู ูุฑุตุฉ 20ูช ุฃุฎุฑู ููุฃููุงุฎ. ุณุชููู ููู ุงูุนุชุจุฉ ุชุณุงูู (0.2 ุ 0.2 ุ 0.4).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃู ุ ุงูููุฑุฉ ูู ุฃูู ูุน ุฒูุงุฏุฉ ูุณุชูู ุงูุชุญุถุฑ ุ ุณูููู ุจุชุฑููุฉ ุงููุจุงูู ุงููุงุฆูุฉ ูุฅุถุงูุฉ ูุจุงูู ุฌุฏูุฏุฉ ุฅูู ุงูุฃูุงูู ุงููุงุฑุบุฉ. ูุฅุฒุงูุฉ ูุจูู ููุฌูุฏ ุ ูุญุชุงุฌ ุฅูู ุงุณุชุฎุฏุงู ููุณ ููุงุตู ูููุฉ ุงูุชุฌุฒุฆุฉ. ุฅุฐุง ูุงูุช ุงูุชุฌุฒุฆุฉ ุจูู 0 ู 0.4 ูู ุงููุณุชูู 1 ุนุจุงุฑุฉ ุนู ุฃููุงุฎ ุ ูุนูุฏ ุงููุณุชูู 3 ุณูุฎูู ููุณ ุงููุงุตู ุงููุจุงูู ุงูุดุงููุฉ. ูู ุงููุณุชูู 3 ุ ูุฌุจ ุฅูุดุงุก ุงููุจุงูู ุงูุดุงููุฉ ุจุงุณุชุฎุฏุงู ุงูุชุฌุฒุฆุฉ ูู ุงููุทุงู ูู 0 ุฅูู 0.4 ุ ูุงููุจุงูู ุงูููููุฉ ูู ุทุงุจููู ูู ุงููุทุงู ูู 0.4 ุฅูู 0.6 ุ ูุงูุฃููุงุฎ ูู ุงููุทุงู ูู 0.6 ุฅูู 0.8. ุฅุฐุง ููุช ุจุชุฏููููุง ูู ุงูุฃูุจุฑ ุฅูู ุงูุฃุตุบุฑ ุ ููููู ุงูููุงู ุจุฐูู ุจุงุณุชุฎุฏุงู ุซูุงุซูุฉ ุงูุนุชุจุงุช (0.4 ุ 0.6 ุ 0.8). ุนูุฏุฆุฐู ุชุตุจุญ ุนุชุจุงุช ุงููุณุชูู 2 (0 ุ 0.4 ุ 0.6) ุ ูุณุชุตุจุญ ุนุชุจุงุช ุงููุณุชูู 1 (0 ุ 0 ุ 0.4). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุนููุง ุญูุธ ูุฐู ุงูุนุชุจุงุช</font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฌููุนุฉ ูู ุงููุตูููุงุช ูุน ุทุฑููุฉ ุชุณูุญ ูู ุจุงูุญุตูู ุนูู ุนุชุจุงุช ููุณุชูู ูุนูู. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃููุง ููุชููู ููุท ุจูุณุชููุงุช ุงููุงุฆูุงุช ุ ูุฅููุง ูุชุฌุงูู ุงููุณุชูู 0.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[][] featureThresholds = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] {<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>}, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] {<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.4f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>}, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] {<span class="hljs-number"><span class="hljs-number">0.4f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>, <span class="hljs-number"><span class="hljs-number">0.8f</span></span>} }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFeatureThresholds</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> featureThresholds[level]; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ุฐูู ุ ุฃุถู ุฅูู </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุทุฑููุฉ ุงูุชู ุชุณุชุฎุฏู ูุณุชูู ุงูุชุฌุฒุฆุฉ ูุงููููุฉ ูุชุญุฏูุฏ ุงูุฅุนุฏุงุฏ ุงููุณุจู. </font><font style="vertical-align: inherit;">ุฅุฐุง ูุงู ุงููุณุชูู ุฃูุจุฑ ูู ุงูุตูุฑ ุ ูุฅููุง ูุญุตู ุนูู ุนุชุจุงุช ุจุงุณุชุฎุฏุงู ูุณุชูู ูุฎูุถ ุจููุฏุงุฑ ูุงุญุฏ. </font><font style="vertical-align: inherit;">ุซู ููุชูู ุนุจุฑ ุงูุนุชุจุงุช ุญุชู ูุชุฌุงูุฒ ุฃุญุฏูุง ูููุฉ ุงูุชุฌุฒุฆุฉ. </font><font style="vertical-align: inherit;">ูุฐุง ุณูุนูู ุฃููุง ูุฌุฏูุง ูุณุจูุฉ. </font><font style="vertical-align: inherit;">ุฅุฐุง ูู ูุฌุฏ ุ ุซู ุฅุฑุฌุงุน ูุงุฑุบุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Transform </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PickPrefab</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hash</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (level &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] thresholds = HexMetrics.GetFeatureThresholds(level - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; thresholds.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash &lt; thresholds[i]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> urbanPrefabs[i]; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุชุทูุจ ูุฐุง ุงูููุฌ ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงูุฑูุงุจุท ุฅูู ุงููุจุงูู ุงูุฌุงูุฒุฉ ุจุญูุซ ุชูุชูู ูู ูุซุงูุฉ ุนุงููุฉ ุฅูู ููุฎูุถุฉ. </font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/4dc/eb5/80e/4dceb580e2410400a003b2ecad72d5c5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฑุชูุจ ูุณุจู ููููุจ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุณุชุฎุฏู ุทุฑููุชูุง ุงูุฌุฏูุฏุฉ ูู </font></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงุฎุชูุงุฑ ุงูุฌุงูุฒุฉ. </font><font style="vertical-align: inherit;">ุฅุฐุง ูู ูุชูููุง ุ ูุฅููุง ูุชุฎุทู ุงููุงุฆู. </font><font style="vertical-align: inherit;">ุฎูุงู ุฐูู ุ ูู ุจุฅูุดุงุก ูุณุฎุฉ ููู ูุงุณุชูุฑ ููุง ูุงู ูู ูุจู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); <span class="hljs-comment"><span class="hljs-comment">// if (hash.a &gt;= cell.UrbanLevel * 0.25f) { // return; // } // Transform instance = Instantiate(urbanPrefabs[cell.UrbanLevel - 1]); Transform prefab = PickPrefab(cell.UrbanLevel, hash.a); if (!prefab) { return; } Transform instance = Instantiate(prefab); position.y += instance.localScale.y * 0.5f; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(0f, 360f * hash.b, 0f); instance.SetParent(container, false); }</span></span></code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/d33/6f0/fcb/d336f0fcbf85285b38bb9c3de27ad77f.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฒุฌ ุงูุฌุงูุฒุฉ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงุฎุชูุงูุงุช ุงููุณุชูู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏููุง ุงูุขู ูุจุงูู ูุฎุชูุทุฉ ุฌูุฏูุง ุ ูููู ุญุชู ุงูุขู ูุง ููุฌุฏ ุณูู ุซูุงุซุฉ ูุจุงูู. </font><font style="vertical-align: inherit;">ูููููุง ุฒูุงุฏุฉ ุงูุชุจุงูู ูู ุฎูุงู ุฑุจุท ูุฌููุนุฉ ูู ุงููุจุงูู ุงูุฌุงูุฒุฉ ุจูู ูุณุชูู ูู ูุณุชููุงุช ุงูุชุญุถุฑ. </font><font style="vertical-align: inherit;">ุจุนุฏ ุฐูู ุ ุณูููู ูู ุงููููู ุงุฎุชูุงุฑ ูุงุญุฏ ูููู ุจุดูู ุนุดูุงุฆู. </font><font style="vertical-align: inherit;">ุณูุชุทูุจ ูุฐุง ูููุฉ ุนุดูุงุฆูุฉ ุฌุฏูุฏุฉ ุ ูุฐุง ุฃุถู ูููุฉ ุซุงูุซุฉ ุฌ </font></font><code>HexHash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a, b, c; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexHash hash; hash.a = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; hash.b = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; hash.c = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุนูุง ูุญูููุง </font></font><code>HexFeatureManager.urbanPrefabs</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูู ูุตูููุฉ ูู ุงูุตูุงุฆู ุ ููุถูู </font></font><code>PickPrefab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนููุฉ </font><font style="vertical-align: inherit;">ุฅูู ุงูุทุฑููุฉ </font></font><code>choice</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุณุชุฎุฏูู ูุงุฎุชูุงุฑ ููุฑุณ ุงููุตูููุฉ ุงููุฏูุฌุฉ ุ ูุถุฑุจู ูู ุทูู ุงููุตูููุฉ ูุชุญูููู ุฅูู ุนุฏุฏ ุตุญูุญ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform[][] urbanPrefabs; โฆ <span class="hljs-function"><span class="hljs-function">Transform </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PickPrefab</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hash, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> choice</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (level &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] thresholds = HexMetrics.GetFeatureThresholds(level - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; thresholds.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash &lt; thresholds[i]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> urbanPrefabs[i][(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(choice * urbanPrefabs[i].Length)]; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุนูุง ูุจุฑุฑ ุงุฎุชูุงุฑูุง ุนูู ูููุฉ ุงูุชุฌุฒุฆุฉ ุงูุซุงููุฉ (B). </font><font style="vertical-align: inherit;">ุซู ุชุญุชุงุฌ ุฅูู ุงูุชุญูู ูู B ุฅูู C.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); Transform prefab = PickPrefab(cell.UrbanLevel, hash.a, hash.b); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!prefab) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Transform instance = Instantiate(prefab); position.y += instance.localScale.y * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.localPosition = HexMetrics.Perturb(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash.c, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุจู ุงููุชุงุจุนุฉ ุ ูุญุชุงุฌ ุฅูู ุงููุธุฑ ูู ูุง </font></font><code>Random.value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏ ููุฑุฌุน ูููุฉ 1. ูุจุณุจุจ ูุฐุง ุ ูุฏ ูุชุฌุงูุฒ ููุฑุณ ุงููุตูููุฉ. </font><font style="vertical-align: inherit;">ูููุน ุญุฏูุซ ุฐูู ุ ุฏุนูุง ูููุณ ููู ุงูุชุฌุฒุฆุฉ ููููุงู. </font><font style="vertical-align: inherit;">ูุญู ุจุจุณุงุทุฉ ูููุณูู ุฌููุนูุง ุญุชู ูุง ุชููู ุจุดุฃู ุงูุชูุงุตูู ุงูุชู ูุณุชุฎุฏููุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexHash hash; hash.a = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.b = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.c = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณูุก ุงูุญุธ ุ ูุง ูุนุฑุถ ุงูููุชุด ุตูุงุฆู ูู ุงูุตูุงุฆู. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูุง ูููููุง ุชูููููุง. </font><font style="vertical-align: inherit;">ููุชุบูุจ ุนูู ูุฐุง ุงูููุฏ ุ ูู ุจุฅูุดุงุก ุจููุฉ ูุงุจูุฉ ููุชุณูุณู ูุชุบููู ุงููุตูููุฉ ุงููุฏูุฌุฉ. </font><font style="vertical-align: inherit;">ุฏุนูุง ูุนุทููุง ุทุฑููุฉ ุชุชุญูู ูู ุงูุงุฎุชูุงุฑ ุฅูู ููุฑุณ ุงูุตููู ูุฅุฑุฌุงุน ุงูุจุงุฏุฆุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> HexFeatureCollection { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform[] prefabs; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Transform </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pick</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> choice</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prefabs[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(choice * prefabs.Length)]; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณุชุฎุฏู </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏูุงู ูู ุงููุตูููุงุช ุงููุฏูุฌุฉ ูุฌููุนุฉ ูู ูุฐู ุงููุฌููุนุงุช.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// public Transform[][] urbanPrefabs; public HexFeatureCollection[] urbanCollections; โฆ Transform PickPrefab (int level, float hash, float choice) { if (level &gt; 0) { float[] thresholds = HexMetrics.GetFeatureThresholds(level - 1); for (int i = 0; i &lt; thresholds.Length; i++) { if (hash &lt; thresholds[i]) { return urbanCollections[i].Pick(choice); } } } return null; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ูููููุง ุชุนููู ุงูุนุฏูุฏ ูู ุงููุจุงูู ููู ูุณุชูู ูุซุงูุฉ. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃููุง ูุณุชููุฉ ุ ูุง ูุชุนูู ุนูููุง ุงุณุชุฎุฏุงู ููุณ ุงููุจูุบ ููู ูุณุชูู. </font><font style="vertical-align: inherit;">ููุฏ ุงุณุชุฎุฏูุช ููุชู ุฎูุงุฑูู ููู ูุณุชูู ุ ูุน ุฅุถุงูุฉ ุฎูุงุฑ ุฃูู ููู ููููุง. </font><font style="vertical-align: inherit;">ุงุฎุชุฑุช ุงูููุงููุณ ููู (3.5 ุ 3 ุ 2) ุ (2.75 ุ 1.5 ุ 1.5) ู (1.75 ุ 1 ุ 1).</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b71/a6e/c9f/b71a6ec9f2c379c223e007dda071c94b.png"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/a72/618/81d/a7261881d23703b54aaf22ba59942d2a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุนุงู ูู ุงููุจุงูู ููู ูุณุชูู ูุซุงูุฉ. </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุนุฏุฉ ุฃููุงุน ูู ุงูุฃุดูุงุก </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงููุฎุทุท ุงูุญุงูู ุ ูููููุง ุฅูุดุงุก ููุงูู ุญุถุฑูุฉ ุฌุฏูุฑุฉ ุจุงูุงูุชูุงู. </font><font style="vertical-align: inherit;">ููู ุงูุฅุบุงุซุฉ ูุฏ ูุง ุชุญุชูู ููุท ุนูู ุงููุจุงูู. </font><font style="vertical-align: inherit;">ูุงุฐุง ุนู ุงููุฒุงุฑุน ุฃู ุงููุจุงุชุงุชุ </font><font style="vertical-align: inherit;">ุฏุนููุง ูุถูู ุฅูู </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุณุชููุงุช ููู ุฃุฌููู. </font><font style="vertical-align: inherit;">ููู ููุณุช ูุชูุงูุฑุฉ ููููู ุฃู ุชุฎุชูุท.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> FarmLevel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> farmLevel; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (farmLevel != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { farmLevel = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PlantLevel { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> plantLevel; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (plantLevel != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { plantLevel = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> urbanLevel, farmLevel, plantLevel;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงูุทุจุน ุ ูุฐุง ูุชุทูุจ ุงูุฏุนู ูู </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฒูููู ุฅุถุงูููู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeUrbanLevel, activeFarmLevel, activePlantLevel; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyUrbanLevel, applyFarmLevel, applyPlantLevel; โฆ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplyFarmLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applyFarmLevel = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetFarmLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { activeFarmLevel = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)level; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplyPlantLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applyPlantLevel = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPlantLevel</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level</span></span></span><span class="hljs-function">)</span></span> { activePlantLevel = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)level; } โฆ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyUrbanLevel) { cell.UrbanLevel = activeUrbanLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyFarmLevel) { cell.FarmLevel = activeFarmLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyPlantLevel) { cell.PlantLevel = activePlantLevel; } โฆ } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃุถููุง ุฅูู ูุงุฌูุฉ ุงููุณุชุฎุฏู. </font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/956/70b/f35/95670bf35594faa69fe46201b78080f7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุซูุงุซ ุณูุงูุฏุฑ.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃูุถุง ุ ุณุชููู ููุงู ุญุงุฌุฉ ุฅูู ูุฌููุนุงุช ุฅุถุงููุฉ </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexFeatureCollection[] urbanCollections, farmCollections, plantCollections;</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/f5d/001/cec/f5d001cecb2bee3c60a0dad637de7dc9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุซูุงุซ ูุฌููุนุงุช ูู ููุงุฏ ุงูุฅุบุงุซุฉ.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุฏ ุตูุนุช ููู ูู ุงููุฒุงุฑุน ูุงููุจุงุชุงุช ุงุซููู ูู ุงููุจุงูู ุงูุฌุงูุฒุฉ ููู ูุณุชูู ูุซุงูุฉ ุ ููุฐูู ูุจูุงุก ูุฌููุนุงุช. ุจุงููุณุจุฉ ููู ุฌููุนุง ุ ุงุณุชุฎุฏูุช ุงูููุนุจุงุช. ุชุญุชูู ุงููุฒุงุฑุน ุนูู ูุงุฏุฉ ุฎุถุฑุงุก ูุงุชุญุฉ ุ ุจูููุง ุชุญุชูู ุงููุจุงุชุงุช ุนูู ูุงุฏุฉ ุฎุถุฑุงุก ุฏุงููุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฏ ุตูุนุช ููุนุจุงุช ุงููุฒุฑุนุฉ ุจุงุฑุชูุงุน 0.1 ูุญุฏุฉ ููุฅุดุงุฑุฉ ุฅูู ุชุฎุตูุตุงุช ูุฑุจุนุฉ ูู ุงูุฃุฑุงุถู ุงูุฒุฑุงุนูุฉ. ูููุงููุณ ุนุงููุฉ ุงููุซุงูุฉ ุ ุงุฎุชุฑุช (2.5 ุ 0.1 ุ 2.5) ู (3.5 ุ 0.1 ุ 2). ูู ุงููุชูุณุท โโุ ุชุจูุบ ูุณุงุญุฉ ุงูููุงูุน 1.75 ูุญุฌู 2.5 ร 1.25. ุชู ุงูุญุตูู ุนูู ูุณุชูู ููุฎูุถ ูู ุงููุซุงูุฉ ูู ุงูููุทูุฉ 1 ูุญุฌู 1.5 ุจูุณุจุฉ 0.75. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุดูุฑ ุงููุจุงุชุงุช ุงูุฌุงูุฒุฉ ุฅูู ุงูุฃุดุฌุงุฑ ุงูุนุงููุฉ ูุงูุดุฌูุฑุงุช ุงููุจูุฑุฉ. ุชุนุชุจุฑ ุงููุจุงูู ุงูุฌุงูุฒุฉ ุนุงููุฉ ุงููุซุงูุฉ ูู ุงูุฃูุจุฑ (1.25 ุ 4.5 ุ 1.25) ู (1.5 ุ 3 ุ 1.5). ุงูููุงููุณ ุงููุชูุณุทุฉ ูู (0.75 ุ 3 ุ 0.75) ู (1 ุ 1.5 ุ 1). ุฃุตุบุฑ ุงููุจุงุชุงุช ููุง ุฃุญุฌุงู (0.5 ุ 1.5 ุ 0.5) ู (0.75 ุ 1 ุ 0.75).</font></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงุฎุชูุงุฑ ููุฒุงุช ุงูุฅุบุงุซุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุจ ุฃู ูุชููู ูู ููุน ูู ุงูุนูุงุตุฑ ูููุฉ ุงูุชุฌุฒุฆุฉ ุงูุฎุงุตุฉ ุจู ุจุญูุซ ูููู ููุง ุฃููุงุท ุฅูุดุงุก ูุฎุชููุฉ ูููููู ูุฒุฌูุง. </font><font style="vertical-align: inherit;">ุฃุถู </font></font><code>HexHash</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุชูู ุฅุถุงููุชูู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a, b, c, d, e; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HexHash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { HexHash hash; hash.a = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.b = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.c = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.d = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; hash.e = Random.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> * <span class="hljs-number"><span class="hljs-number">0.999f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hash; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ุนููู </font></font><code>HexFeatureManager.PickPrefab</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุนูู ูุน ูุฌููุนุงุช ูุฎุชููุฉ. </font><font style="vertical-align: inherit;">ุฃุถู ูุนููุฉ ูุชุจุณูุท ุงูุนูููุฉ. </font><font style="vertical-align: inherit;">ุฃูุถุง ุ ูู ุจุชุบููุฑ ุงูุชุฌุฒุฆุฉ ุงูุชู ุงุณุชุฎุฏููุง ูุชุบูุฑ ุงูุฅุนุฏุงุฏ ุงููุณุจู ุงููุญุฏุฏ ุฅูู D ุ ูุงูุชุฌุฒุฆุฉ ููุชุฏููุฑ ุฅูู E.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">Transform </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PickPrefab</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexFeatureCollection[] collection, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hash, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> choice </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (level &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] thresholds = HexMetrics.GetFeatureThresholds(level - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; thresholds.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hash &lt; thresholds[i]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> collection[i].Pick(choice); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { HexHash hash = HexMetrics.SampleHashGrid(position); Transform prefab = PickPrefab( urbanCollections, cell.UrbanLevel, hash.a, hash.d ); โฆ instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash.e, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฎุชุงุฑ </font><font style="vertical-align: inherit;">ุญุงููุง </font><font style="vertical-align: inherit;">ุงูุชุญุถุฑ ุงูุฌุงูุฒุฉ. </font><font style="vertical-align: inherit;">ูุฐุง ุทุจูุนู ุ ูุญู ุจุญุงุฌุฉ ุฅูู ุงููุฒูุฏ ูู ุงูุฎูุงุฑุงุช. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูุถูู ูุณุจูุฉ ุฃุฎุฑู ูู ุงููุฒุงุฑุน. </font><font style="vertical-align: inherit;">ููููุฉ ุชุฌุฒุฆุฉ ุ ุงุณุชุฎุฏู B. ุณูููู ุฎูุงุฑ ุงูุฎูุงุฑ ูู D.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> Transform prefab = PickPrefab( urbanCollections, cell.UrbanLevel, hash.a, hash.d ); Transform otherPrefab = PickPrefab( farmCollections, cell.FarmLevel, hash.b, hash.d ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!prefab) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ููุน ุงููุซูู ุงูุฌุงูุฒ ุงูุฐู ุณููุดุฆู ูุชูุฌุฉ ูุฐููุ </font><font style="vertical-align: inherit;">ุฅุฐุง ุชุจูู ุฃู ุฃุญุฏูุง ูุงุฑุบ ุ ูุฅู ุงูุงุฎุชูุงุฑ ูุงุถุญ. </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ุฅุฐุง ูุงู ููุงููุง ููุฌูุฏูุง ุ ูุนูููุง ุงุชุฎุงุฐ ูุฑุงุฑ. </font><font style="vertical-align: inherit;">ุฏุนูุง ููุท ูุถูู ุงูุฌุงูุฒุฉ ุจุฃูู ูููุฉ ุชุฌุฒุฆุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> Transform otherPrefab = PickPrefab( farmCollections, cell.FarmLevel, hash.b, hash.d ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.b &lt; hash.a) { prefab = otherPrefab; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/baf/369/d71/baf369d71420a1ded309880b38d94c53.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฒูุฌ ูู ุงูุฃุดูุงุก ุงูุญุถุฑูุฉ ูุงูุฑูููุฉ. </font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ุฐูู ุ ุงูุนู ููุณ ุงูุดูุก ูุน ุงููุจุงุชุงุช ุจุงุณุชุฎุฏุงู ูููุฉ ุงูุชุฌุฒุฆุฉ C.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.b &lt; hash.a) { prefab = otherPrefab; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; } otherPrefab = PickPrefab( plantCollections, cell.PlantLevel, hash.c, hash.d ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.c &lt; hash.a) { prefab = otherPrefab; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุน ุฐูู ุ ูุง ูููููุง ููุท ูุณุฎ ุงูุฑูุฒ. </font><font style="vertical-align: inherit;">ุนูุฏูุง ูุฎุชุงุฑ ุงูุฑูู ุจุฏูุงู ูู ุงููุงุฆู ุงูุญุถุฑู ุ ูุญุชุงุฌ ุฅูู ููุงุฑูุฉ ุชุฌุฒุฆุฉ ุงููุจุงุชุงุช ูุน ุชุฌุฒุฆุฉ ุงููุฒุงุฑุน ุ ูููุณ ุจุงูููุทุน ุงูุญุถุฑู. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูุญุชุงุฌ ุฅูู ุชุชุจุน ุงูุชุฌุฒุฆุฉ ุงูุชู ูุฑุฑูุง ุงุฎุชูุงุฑูุง ูุงูููุงุฑูุฉ ูุนูุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> usedHash = hash.a; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.b &lt; hash.a) { prefab = otherPrefab; usedHash = hash.b; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; usedHash = hash.b; } otherPrefab = PickPrefab( plantCollections, cell.PlantLevel, hash.c, hash.d ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prefab) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab &amp;&amp; hash.c &lt; usedHash) { prefab = otherPrefab; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (otherPrefab) { prefab = otherPrefab; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/8eb/2e2/215/8eb2e2215e6219b08e8bc42612b31493.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฒูุฌ ูู ุงูุฃุดูุงุก ุงูุญุถุฑูุฉ ูุงูุฑูููุฉ ูุงููุจุงุชูุฉ. </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h1 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฌุฒุก 10: ุงูุฌุฏุฑุงู </font></font></h1><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุญูุท ุงูุฎูุงูุง. </font></font></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุญู ูุจูู ุงูุฌุฏุฑุงู ุนูู ุทูู ุญูุงู ุงูุฎูุงูุง. </font></font></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฏุนูุง ูุฐูุจ ุนุจุฑ ุงูุฃููุงุฑ ูุงูุทุฑู. </font></font></li><li style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุฌูุจ ุงููุงุก ูุงุชุตู ุจุงูููุญุฏุฑุงุช. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูู ูุฐุง ุงูุฌุฒุก ุณูู ูุถูู ุจูู ุฎูุงูุง ุงูุฌุฏุงุฑ. </font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/924/d07/0cd/924d070cd67c3baccf02a0284ef9cdc4.jpg"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ููุฌุฏ ุดูุก ุฃูุซุฑ ุฌุงุฐุจูุฉ ูู ุงูุฌุฏุงุฑ ุงูุนุงูู.</font></font></i> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุญุฑูุฑ ุงูุฌุฏุงุฑ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏุนู ุงูุฌุฏุฑุงู ุ ูุญุชุงุฌ ุฅูู ูุนุฑูุฉ ููุงู ูุถุนูุง. </font><font style="vertical-align: inherit;">ุณูุถุนูุง ุจูู ุงูุฎูุงูุง ุนูู ุทูู ุงูุญูุงู ุงูุชู ุชุฑุจุทูุง. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุงูุฃุดูุงุก ุงูููุฌูุฏุฉ ุจุงููุนู ููุฌูุฏุฉ ูู ุงูุฌุฒุก ุงููุฑูุฒู ูู ุงูุฎูุงูุง ุ ููุง ุฏุงุนู ููููู ูู ุฃู ุงูุฌุฏุฑุงู ุณุชูุฑ ุนุจุฑูุง.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/7a1/bbb/c11/7a1bbbc1158301bb0091638858fa79fd.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุฑุงู ุนูู ุทูู ุงูุญูุงู. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุฑุงู ูุงุฆูุงุช ุชุถุงุฑูุณ ุ ุนูู ุงูุฑุบู ูู ุฃููุง ูุจูุฑุฉ. </font><font style="vertical-align: inherit;">ูุซู ุงููุงุฆูุงุช ุงูุฃุฎุฑู ุ ูู ูููู ุจุชุญุฑูุฑูุง ูุจุงุดุฑุฉ. </font><font style="vertical-align: inherit;">ุจุฏูุงู ูู ุฐูู ุ ุณูููู ุจุชุบููุฑ ุงูุฎูุงูุง. </font><font style="vertical-align: inherit;">ูู ูููู ูุฏููุง ุฃุฌุฒุงุก ูููุตูุฉ ูู ุงูุฌุฏุฑุงู ุ ูููููุง ุณูุดุงุฑู ูู ุฅุญุงุทุฉ ุงูุฎูุงูุง ููู.</font></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูููููุฉ ุงููุณูุฑุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏุนู ุงูุฎูุงูุง ุงููุณูุฌุฉ ุ ุฃุถู ุฅูู </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุชููุงุช </font></font><code>Walled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุฐุง ููุชุงุญ ุจุณูุท. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุงูุฌุฏุฑุงู ุชูุน ุจูู ุงูุฎูุงูุง ุ ููุญู ุจุญุงุฌุฉ ุฅูู ุชุญุฏูุซ ูู ูู ุงูุฎูุงูุง ุงููุญุฑุฑุฉ ูุฌูุฑุงููุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Walled { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> walled; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (walled != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { walled = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Refresh(); } } } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> walled;</code> </pre> <br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุชุงุญ ุงููุญุฑุฑ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุจุฏูู ุงูุญุงูุฉ "ุงููุณูุฌุฉ" ููุฎูุงูุง ุ ูุญุชุงุฌ ุฅูู ุฅุถุงูุฉ </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุนู ูููุญูู. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูููู ุจุฅุถุงูุฉ ุญูู ุขุฎุฑ </font></font><code>OptionalToggle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุทุฑููุฉ ูุถุจุทู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> OptionalToggle riverMode, roadMode, walledMode; โฆ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetWalledMode</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mode</span></span></span><span class="hljs-function">)</span></span> { walledMode = (OptionalToggle)mode; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุนูุณ ุงูุฃููุงุฑ ูุงูุทุฑู ุ ูุง ุชูุชูู ุงูุฌุฏุฑุงู ูู ุฎููุฉ ุฅูู ุฃุฎุฑู ุ ูููููุง ุจููููุง. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูุณูุง ุจุญุงุฌุฉ ููุชูููุฑ ูู ุงูุณุญุจ ูุงูุฅุณูุงุท. </font><font style="vertical-align: inherit;">ุนูุฏูุง ูููู ููุชุงุญ ุงูุฌุฏุงุฑ ูุดุทูุง ุ ูููู ุจุจุณุงุทุฉ ุจุชุนููู ุงูุญุงูุฉ ุงููุณูุฌุฉ ููุฎููุฉ ุงูุญุงููุฉ ุจูุงุกู ุนูู ุญุงูุฉ ูุฐุง ุงูููุชุงุญ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (roadMode == OptionalToggle.No) { cell.RemoveRoads(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (walledMode != OptionalToggle.Ignore) { cell.Walled = walledMode == OptionalToggle.Yes; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isDrag) { โฆ } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฑุฑ ุฃุญุฏ ุงูุนูุงุตุฑ ุงูุณุงุจูุฉ ููุจุฏูุงุช ูุงุฌูุฉ ุงููุณุชุฎุฏู ููุบูุฑูุง ุจุญูุซ ุชุชุญูู ูู ุญุงูุฉ "ุงููุจุงุฑุฒุฉ". </font><font style="vertical-align: inherit;">ุณุฃุถุนูุง ูู ููุญุฉ ูุงุฌูุฉ ุงููุณุชุฎุฏู ูุน ุงููุงุฆูุงุช ุงูุฃุฎุฑู.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/0ac/f7f/0ca/0acf7f0caaaae171e31d42141fa75947.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชุงุญ "ุงููุจุงุฑุฒุฉ". </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅูุดุงุก ุงูุฌุฏุฑุงู </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุงูุฌุฏุฑุงู ุชุชุจุน ุฎุทูุท ุงูุฎูุงูุง ุ ููุง ูุฌุจ ุฃู ูููู ููุง ุดูู ุซุงุจุช. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูุง ูููููุง ุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏ ุงููุณุจู ููู ููุท ุ ููุง ูุนููุง ูุน ููุฒุงุช ุงูุชุถุงุฑูุณ ุงูุฃุฎุฑู. </font><font style="vertical-align: inherit;">ุจุฏูุงู ูู ุฐูู ุ ูุญุชุงุฌ ุฅูู ุจูุงุก ุดุจูุฉ ุ ููุง ูุนููุง ูุน ุงูุงุฑุชูุงุญ. </font><font style="vertical-align: inherit;">ูุฐุง ูุนูู ุฃู ุงูุฌุฒุก ุงูุฌุงูุฒ ูุฏููุง ูุญุชุงุฌ ุฅูู ุนูุตุฑ ุชุงุจุน ุขุฎุฑ </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุถุงุนู ุฅุญุฏู ุงูุดุจูุงุช ุงููุฑุนูุฉ ุงูุฃุฎุฑู ูุงุฌุนู ูุงุฆูุงุช </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุฑุงู</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฌุฏูุฏุฉ </font><font style="vertical-align: inherit;">ุชููู ุจุธูุงููุง. </font><font style="vertical-align: inherit;">ูุง ูุญุชุงุฌูู ุฅูู ุฃู ุดูุก ุจุงุณุชุซูุงุก ุงูููู ูุงููุซูุซุงุช ุ ูุฐุง </font></font><code>HexMesh</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุจ ุชุนุทูู </font><font style="vertical-align: inherit;">ุฌููุน ุงูุฎูุงุฑุงุช </font><font style="vertical-align: inherit;">.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/615/387/31d/61538731d2eed271c9348c4da2f5d844.png"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/2bf/c6e/af5/2bfc6eaf5ff31f5467ab252c00b7bcce.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุฑุงู ุงูุฌุงูุฒุฉ ุงูุชุงุจุนุฉ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูููู ูู ุงูููุทูู ุฃู ุงูุฌุฏุฑุงู ูู ูุงุฆู ุญุถุฑู ุ ูุฐูู ุงุณุชุฎุฏูุช ููู ุงูููุงุฏ ุงูุญูุฑุงุก ูููุจุงูู.</font></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุฏุงุฑุฉ ุงูุฌุฏุงุฑ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจูุง ุฃู ุงูุฌุฏุฑุงู ูู ุฃุดูุงุก ุฑุงุญุฉ ุ ูุฌุจ ุฃู ุชุชุนุงูู ูุนูุง </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ููุฐููุ ูุฅู ูุฏูุฑ ุชูุฏูู ุงูุฅุบุงุซุฉ ูุฑุฌุน ูุงุฆู ุฅูู ูุงุฆู </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุฑุงู</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุ ูุงูุชุฃูุฏ ูู ุงุณุชุฏุนุงุก ุงูุฃุณุงููุจ </font></font><code>Clear</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ู </font></font><code>Apply</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> HexMesh walls; โฆ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Clear</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { โฆ walls.Clear(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { walls.Apply(); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/31d/8f9/0f3/31d8f90f315c7aa43910c67aab6b73cb.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุฑุงู ูุชุตูุฉ ุจูุฏูุฑ ุงูุทุจูุบุฑุงููุง.</font></font></i> <br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃูุง ูุฌุจ ุฃู ุชููู ุงูุฌุฏุฑุงู ุทูููุง ูู ุงูููุฒุงุชุ</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl">       ,   .             ,    <em>Walls</em>    <em>Hex Grid Chunk</em> . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ูุญู ุจุญุงุฌุฉ ุฅูู ุฅุถุงูุฉ ุทุฑููุฉ ุฅูู ุงููุฏูุฑ ุชุณูุญ ููุง ุจุฅุถุงูุฉ ุงูุฌุฏุฑุงู ุฅูููุง. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุงูุฌุฏุฑุงู ุนูู ุทูู ุงูุญูุงู ุจูู ุงูุฎูุงูุง ุ ูุฅูู ูุญุชุงุฌ ุฅูู ูุนุฑูุฉ ุงูููู ุงูููุงุจูุฉ ููุญูุงู ูุงูุฎูุงูุง. </font></font><code>HexGridChunk</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุณุจุจ ุฐูู </font></font><code>TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูู ููุช ุชุซููุซ ุงูุฎููุฉ ูุฃุญุฏ ุฌูุฑุงููุง. </font><font style="vertical-align: inherit;">ูู ูุฌูุฉ ุงููุธุฑ ูุฐู ุ ุชูุฌุฏ ุงูุฎููุฉ ุงูุญุงููุฉ ุนูู ุงูุฌุงูุจ ุงููุฑูุจ ูู ุงูุฌุฏุงุฑ ุ ูุงูุฃุฎุฑู ุนูู ุงูุฌุงูุจ ุงูุจุนูุฏ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูู ูุทูู ุนูู ูุฐู ุงูุทุฑููุฉ ุงูุฌุฏูุฏุฉ </font></font><code>HexGridChunk.TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ุงูุงูุชูุงุก ูู ุฌููุน ุฃุนูุงู ุงูุฑุจุท ุงูุฃุฎุฑู ููุจู ุงูุงูุชูุงู ูุจุงุดุฑุฉ ุฅูู ุงููุซูุซ ุงูุฒุงูู. </font><font style="vertical-align: inherit;">ุณูู ูุณูุญ ููุฏูุฑ ุนูุงุตุฑ ุงูุฅุบุงุซุฉ ุฃู ููุฑุฑ ุจููุณู ููุงู ุงูุฌุฏุงุฑ ูุนูููุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, EdgeVertices e1 </span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.GetEdgeType(direction) == HexEdgeType.Slope) { โฆ } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { โฆ } features.AddWall(e1, cell, e2, neighbor); HexCell nextNeighbor = cell.GetNeighbor(direction.Next()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction &lt;= HexDirection.E &amp;&amp; nextNeighbor != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { โฆ } }</code> </pre> <br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจูุงุก ุฌุฒุก ุงูุฌุฏุงุฑ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุชุนุฑุฌ ุงูุฌุฏุงุฑ ุจุฃูููู ูู ุฎูุงู ุนุฏุฉ ุญูุงู ููุฎูุงูุง. </font><font style="vertical-align: inherit;">ุชุญุชูู ูู ุญุงูุฉ ุนูู ุนูุตุฑ ุฌุฏุงุฑ ูุงุญุฏ ููุท. </font><font style="vertical-align: inherit;">ูู ูุฌูุฉ ูุธุฑ ุงูุฎููุฉ ุงููุฑูุจุฉ ุ ูุจุฏุฃ ุงูููุทุน ุนูู ุงูุฌุงูุจ ุงูุฃูุณุฑ ูู ุงูุถูุน ูููุชูู ุนูู ุงููููู. </font><font style="vertical-align: inherit;">ุฏุนูุง ูุถูู ุฅูู </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุทุฑููุฉ ูููุตูุฉ ุชุณุชุฎุฏู ุฃุฑุจุนุฉ ุฑุคูุณ ุนูุฏ ุฒูุงูุง ุงูุญุงูุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/f32/2a0/d7b/f322a0d7bc325b13f65c62cfb76b2d0c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌูุงูุจ ุงููุฑูุจุฉ ูุงูุจุนูุฏุฉ. </font></font></i> <br><br> <code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุงุณุชุฏุนุงุก ูุฐู ุงูุทุฑููุฉ ูุน ุงูุญูุงู ุงูุฃููู ูุงูุฃุฎูุฑุฉ ูู ุงูุญูุงู. </font><font style="vertical-align: inherit;">ููู ูุฌุจ ุฅุถุงูุฉ ุงูุฌุฏุฑุงู ููุท ุนูุฏูุง ูููู ูุฏููุง ุงุชุตุงู ุจูู ุฎููุฉ ูุณูุฌุฉ ูุฎููุฉ ุบูุฑ ูุณูุฌุฉ. </font><font style="vertical-align: inherit;">ูุง ููู ุฃู ูู ุงูุฎูุงูุง ูู ุงูุฏุงุฎู ูุฃููุง ูู ุงูุฎุงุฑุฌ ุ ููุท ุงูุงุฎุชูุงู ูู ุญุงูุงุชูุง ูุชู ุฃุฎุฐู ูู ุงูุงุนุชุจุงุฑ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nearCell.Walled != farCell.Walled) { AddWallSegment(near.v1, far.v1, near.v5, far.v5); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุจุณุท ุฌุฒุก ูู ุงูุฌุฏุงุฑ ูู ุฑุจุงุนู ูุงุญุฏ ุ ููู ูู ููุชุตู ุงูุถูุน. </font><font style="vertical-align: inherit;">ุณูุฌุฏ ููููุง ุงูุฏููุง ุ ูุญุฑููุง ูู ุงูููุชุตู ูู ุงูุฃูุฑุจ ุฅูู ุงูุฃุจุนุฏ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { Vector3 left = Vector3.Lerp(nearLeft, farLeft, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 right = Vector3.Lerp(nearRight, farRight, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุจูุบ ุทูู ุงูุฌุฏุงุฑุ </font><font style="vertical-align: inherit;">ุฏุนููุง ูุถุน ุงุฑุชูุงุนู ุนูู </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ููุฏ ุตูุนุชูุง ุจุญุฌู ูุณุชูู ุงุฑุชูุงุน ุฎููุฉ ูุงุญุฏุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallHeight = <span class="hljs-number"><span class="hljs-number">3f</span></span>;</code> </pre> <br> <code>HexFeatureManager.AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุงุณุชุฎุฏุงู ูุฐุง ุงูุงุฑุชูุงุน ููุถุน ุงูุฐุฑูุชูู ุงูุซุงูุซุฉ ูุงูุฑุงุจุนุฉ ููุฑุจุงุนูุฉ ุ ูุฅุถุงูุชู ุฃูุถูุง ุฅูู ุงูุดุจูุฉ </font></font><code>walls</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> Vector3 left = Vector3.Lerp(nearLeft, farLeft, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 right = Vector3.Lerp(nearRight, farRight, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 v1, v2, v3, v4; v1 = v3 = left; v2 = v4 = right; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v1, v2, v3, v4);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ูููููุง ุชุนุฏูู ุงูุฌุฏุฑุงู ูุณูุชู ุนุฑุถูุง ูุฎุทูุท ุฑุจุงุนูุฉ. </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ูู ูุฑู ุฌุฏุงุฑูุง ูุณุชูุฑูุง. </font><font style="vertical-align: inherit;">ูู ุฑุจุงุน ูุฑุฆู ุนูู ุฌุงูุจ ูุงุญุฏ ููุท. </font><font style="vertical-align: inherit;">ูุฌูู ููุฌู ูุญู ุงูุฎููุฉ ุงูุชู ุฃูุถูู ูููุง.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/e5a/2f0/442/e5a2f0442a2d1812b73dd2977d80d565.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุฑุงู ุงูุฑุจุงุนูุฉ ุฃุญุงุฏูุฉ ุงูุฌุงูุจ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููููุง ุญู ูุฐู ุงููุดููุฉ ุจุณุฑุนุฉ ุนู ุทุฑูู ุฅุถุงูุฉ ุฑุจุงุนูุฉ ุฃุฎุฑู ุชูุงุฌู ุงูุทุฑูู ุงูุขุฎุฑ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> walls.AddQuad(v1, v2, v3, v4); walls.AddQuad(v2, v1, v4, v3);</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/302/e53/129/302e53129e87c3432848772688e9d896.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุฑุงู ุงูุซูุงุฆูุฉ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ุฌููุน ุงูุฌุฏุฑุงู ูุฑุฆูุฉ ุจุงููุงูู ุ ูููู ูุง ุชุฒุงู ููุงู ุซููุจ ูู ุฒูุงูุง ุงูุฎูุงูุง ุญูุซ ุชูุชูู ุงูุฎูุงูุง ุงูุซูุงุซ. </font><font style="vertical-align: inherit;">ุณูููุฃูุง ูุงุญููุง.</font></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฌุฏุฑุงู ุณูููุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุงูุฑุบู ูู ุฃู ุงูุฌุฏุฑุงู ูุฑุฆูุฉ ุจุงููุนู ุนูู ููุง ุงูุฌุงูุจูู ุ ุฅูุง ุฃููุง ูุง ุชุญุชูู ุนูู ุณูู. </font><font style="vertical-align: inherit;">ูู ุงููุงูุน ุ ุงูุฌุฏุฑุงู ุฑูููุฉ ุ ูุซู ุงููุฑู ุ ูุบูุฑ ูุฑุฆูุฉ ุชูุฑูุจูุง ุจุฒุงููุฉ ูุนููุฉ. </font><font style="vertical-align: inherit;">ูุฐูู ุฏุนููุง ูุฌุนููุง ูุงููุฉ ุจุฅุถุงูุฉ ุณูู. </font><font style="vertical-align: inherit;">ุถุจุท ุณูููุง </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุงุฎุชุฑุช ูููุฉ 0.75 ูุญุฏุฉ ุ ุจุฏุง ูู ููุงุณุจูุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallThickness = <span class="hljs-number"><span class="hljs-number">0.75f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุนู ุฌุฏุงุฑูู ุณููููู ุ ุชุญุชุงุฌ ุฅูู ุฌุฒุก ูู ููุงุฏ ุฅูู ุงูุฌุงูุจูู. </font><font style="vertical-align: inherit;">ูุฌุจ ุฃู ูุชุญุฑููุง ูู ุงุชุฌุงููู ูุชุนุงูุณูู. </font><font style="vertical-align: inherit;">ูุฌุจ ุฃู ูุชุญุฑู ุฃุญุฏ ุงูุฌุงูุจูู ูุญู ุงูุญุงูุฉ ุงููุฑูุจุฉ ุ ูุงูุขุฎุฑ ูุญู ุงูุญุงูุฉ ุงูุจุนูุฏุฉ. </font><font style="vertical-align: inherit;">ูุชุฌู ุงูุฅุฒุงุญุฉ ููุฐุง ูุชุณุงูู </font></font><code>far - near</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูููู ูุชุฑู ุงูุฌุฒุก ุงูุนููู ูู ุงูุฌุฏุงุฑ ูุณุทุญูุง ุ ูุญุชุงุฌ ุฅูู ุชุนููู ุงููููู Y ุฅูู 0. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃูู ูุฌุจ ุงูููุงู ุจุฐูู ููู ูู ุงูุฌุงูุจูู ุงูุฃูุณุฑ ูุงูุฃููู ูู ููุทุน ุงูุฌุฏุงุฑ ุ </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุถูู ูุชุฌู ุฅุฒุงุญุฉ </font><font style="vertical-align: inherit;">ุฅูู </font><font style="vertical-align: inherit;">ุงูุทุฑููุฉ ูุญุณุงุจ ูุฐุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WallThicknessOffset</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far</span></span></span><span class="hljs-function">)</span></span> { Vector3 offset; offset.x = far.x - near.x; offset.y = <span class="hljs-number"><span class="hljs-number">0f</span></span>; offset.z = far.z - near.z; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> offset; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุฃุฌู ุฃู ูุจูู ุงูุฌุฏุงุฑ ูู ูุณุท ุงูุถูุน ุ ูุฌุจ ุฃู ุชููู ุงููุณุงูุฉ ุงูุญููููุฉ ููุญุฑูุฉ ุนูู ุทูู ูุฐุง ุงููุงูู ูุณุงููุฉ ููุตู ุณูู ูู ุฌุงูุจ. </font><font style="vertical-align: inherit;">ูููุชุฃูุฏ ูู ุชุญุฑููุง ูููุณุงูุฉ ุงูุตุญูุญุฉ ุ ูููู ุจุชุทุจูุน ูุงูู ุงูุฅุฒุงุญุฉ ูุจู ููุงุณู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> offset.normalized * (wallThickness * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุณุชุฎุฏู ูุฐู ุงูุทุฑููุฉ </font></font><code>HexFeatureManager.AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุบููุฑ ูููู ุงูููุงุฏ. </font><font style="vertical-align: inherit;">ุจูุง ุฃู ูุงูู ุงูุฅุฒุงุญุฉ ููุชูู ูู ุงูุฃูุฑุจ ุฅูู ุงูุฎููุฉ ุงูุจุนูุฏุฉ ุ ุงุทุฑุญูุง ูู ุงูุฑุจุงุนู ุงููุฑูุจ ูุฃุถู ุฅูู ุงูุจุนูุฏุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> Vector3 left = Vector3.Lerp(nearLeft, farLeft, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 right = Vector3.Lerp(nearRight, farRight, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); Vector3 leftThicknessOffset = HexMetrics.WallThicknessOffset(nearLeft, farLeft); Vector3 rightThicknessOffset = HexMetrics.WallThicknessOffset(nearRight, farRight); Vector3 v1, v2, v3, v4; v1 = v3 = left - leftThicknessOffset; v2 = v4 = right - rightThicknessOffset; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v1, v2, v3, v4); v1 = v3 = left + leftThicknessOffset; v2 = v4 = right + rightThicknessOffset; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v2, v1, v4, v3);</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/df7/746/08b/df774608b2b06114b4afbc6ec2904e61.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฌุฏุฑุงู ูุน ุชุนููุถุงุช. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููุงุฏ ุงูุขู ููุญุงุฒุฉ ุ ุนูู ุงูุฑุบู ูู ุฃู ูุฐุง ููุณ ููุญูุธูุง ุชูุงููุง.</font></font><br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุณูู ุงูุฌุฏุงุฑ ูู ููุณูุ</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl">    ,      ยซ-ยป     .      ,    .       .       ,   .    ,    .  , -      ,     .      . </div></div><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููู ุงูุฌุฏุฑุงู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุนู ุณูู ุงูุฌุฏุงุฑ ูุฑุฆููุง ูู ุงูุฃุนูู ุ ูุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุฑุจุงุนูุฉ ุฅูู ุฃุนูู ุงูุฌุฏุงุฑ. </font><font style="vertical-align: inherit;">ุฃุณูู ุทุฑููุฉ ููููุงู ุจุฐูู ูู ุจุชุฐูุฑ ุงูุฐุฑูุชูู ุงูุนูููุชูู ููุฑุจุงุนูุฉ ุงูุฃููู ูุฑุจุทููุง ุจุงูุฐุฑูุชูู ุงูุนูููุชูู ููุฑุจุงุนูุฉ ุงูุซุงููุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> Vector3 v1, v2, v3, v4; v1 = v3 = left - leftThicknessOffset; v2 = v4 = right - rightThicknessOffset; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v1, v2, v3, v4); Vector3 t1 = v3, t2 = v4; v1 = v3 = left + leftThicknessOffset; v2 = v4 = right + rightThicknessOffset; v3.y = v4.y = left.y + HexMetrics.wallHeight; walls.AddQuad(v2, v1, v4, v3); walls.AddQuad(t1, t2, v3, v4);</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/1d7/15d/627/1d715d627770a9e7a17bf135a461833d.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุฑุงู ุฐุงุช ุงูููู.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูููุนุทูุงุช </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุชุฒุงู ูุฏููุง ุซููุจ ูู ุฒูุงูุง ุงูุฎูุงูุง. </font><font style="vertical-align: inherit;">ูููุฆูุง ุ ูุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุฌุฒุก ุฅูู ุงูููุทูุฉ ุงููุซูุซูุฉ ุจูู ุงูุฎูุงูุง. </font><font style="vertical-align: inherit;">ูุฑุจุท ูู ุฒุงููุฉ ุซูุงุซ ุฎูุงูุง. </font><font style="vertical-align: inherit;">ูุฏ ูููู ุฃู ูุง ูููู ููู ุฎููุฉ ุฌุฏุงุฑ. </font><font style="vertical-align: inherit;">ุฃู ุ ุซูุงููุฉ ุชููููุงุช ููููุฉ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ed9/277/8ee/ed92778ee39106d3a448892a124d366c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชููููุงุช ุงูุฒุงููุฉ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุถุน ุงูุฌุฏุฑุงู ููุท ุจูู ุงูุฎูุงูุง ุฐุงุช ุงูุญุงูุงุช ุงููุณูุฌุฉ ุงููุฎุชููุฉ. </font><font style="vertical-align: inherit;">ูุฐุง ูููู ูู ุนุฏุฏ ุงูุชููููุงุช ุฅูู ุณุชุฉ. </font><font style="vertical-align: inherit;">ูู ูู ูููุง ุ ุชูุฌุฏ ุฅุญุฏู ุงูุฎูุงูุง ุฏุงุฎู ููุญูู ุงูุฌุฏุฑุงู. </font><font style="vertical-align: inherit;">ุฏุนููุง ูุนุชุจุฑ ูุฐู ุงูุฎููุฉ ูููุทุฉ ูุฑุฌุนูุฉ ุญูู ุงูุฌุฏุงุฑ ุงูููุญูู. </font><font style="vertical-align: inherit;">ูู ูุฌูุฉ ูุธุฑ ูุฐู ุงูุฎููุฉ ุ ูุจุฏุฃ ุงูุฌุฏุงุฑ ุจุญุงูุฉ ูุดุชุฑูุฉ ูุน ุงูุฎููุฉ ุงููุณุฑู ูููุชูู ุจุญุงูุฉ ูุดุชุฑูุฉ ูุน ุงูุฎููุฉ ุงููููู.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/48e/f68/19a/48ef6819a839339a17d1513f7ca546b5.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุฏูุงุฑ ุงูุฎููุฉ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃู ุฃููุง ุจุญุงุฌุฉ ุฅูู ุฅูุดุงุก ุทุฑููุฉ </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชููู ูุนููุงุชูุง ุซูุงุซุฉ ุฑุคูุณ ูู ุงูุฒุงููุฉ. </font><font style="vertical-align: inherit;">ุนูู ุงูุฑุบู ูู ุฃูู ูููููุง ูุชุงุจุฉ ุฑูุฒ ูุชุซููุซ ูุฐุง ุงูููุทุน ุ ุฅูุง ุฃูู ูู ุงููุงูุน ุญุงูุฉ ุฎุงุตุฉ ููุทุฑููุฉ </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุชูุนุจ ููุทุฉ ุงูุฅุฑุณุงุก ุฏูุฑ ุงููุฑูู ุงููุฑูุจุชูู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 pivot, HexCell pivotCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { AddWallSegment(pivot, left, pivot, right); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุนุฏ ุฐูู ุ ูู ุจุฅูุดุงุก ูุชุบูุฑ ููุทุฑููุฉ </font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููู ุงูุซูุงุซุฉ ููุฒุงููุฉ ูุฎูุงูุงูู. </font><font style="vertical-align: inherit;">ุงููุฏู ูู ูุฐู ุงูุทุฑููุฉ ูู ุชุญุฏูุฏ ุงูุฒุงููุฉ ุ ููู ุงูููุทุฉ ุงููุฑุฌุนูุฉ ุ ุฅุฐุง ูุงูุช ููุฌูุฏุฉ. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูุฌุจ ุนููู ุงููุธุฑ ูู ุฌููุน ุงูุชููููุงุช ุงูุซูุงููุฉ ุงูููููุฉ ูุงูุฏุนูุฉ </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฅูู ุณุชุฉ ูููุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 c1, HexCell cell1, Vector3 c2, HexCell cell2, Vector3 c3, HexCell cell3 </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell1.Walled) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell2.Walled) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell3.Walled) { AddWallSegment(c3, cell3, c1, cell1, c2, cell2); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell3.Walled) { AddWallSegment(c2, cell2, c3, cell3, c1, cell1); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallSegment(c1, cell1, c2, cell2, c3, cell3); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell2.Walled) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell3.Walled) { AddWallSegment(c1, cell1, c2, cell2, c3, cell3); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallSegment(c2, cell2, c3, cell3, c1, cell1); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell3.Walled) { AddWallSegment(c3, cell3, c1, cell1, c2, cell2); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅุถุงูุฉ ุดุฑุงุฆุญ ุงูุฒุงููุฉ ุ ุงุชุตู ุจูุฐู ุงูุทุฑููุฉ ูู ุงูููุงูุฉ </font></font><code>HexGridChunk.TriangulateCorner</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateCorner</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 bottom, HexCell bottomCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { โฆ features.AddWall(bottom, bottomCell, left, leftCell, right, rightCell); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/a8e/e63/304/a8ee63304fce04d4db9dcdf46076b3a9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุฑุงู ุฐุงุช ุงูุฒูุงูุง ุ ูููู ูุง ุชุฒุงู ููุงู ุซููุจ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃุบูู ุงูุซููุจ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ุชุฒุงู ููุงู ุซููุจ ูู ุงูุฌุฏุฑุงู ูุฃู ุงุฑุชูุงุน ุฃุฌุฒุงุก ุงูุฌุฏุงุฑ ูุชุบูุฑ. ูู ุญูู ุฃู ุงูุฃุฌุฒุงุก ุนูู ุทูู ุงูุญูุงู ุฐุงุช ุงุฑุชูุงุน ุซุงุจุช ุ ูุฅู ุฃุฌุฒุงุก ุงูุฒุงููุฉ ุชูุน ุจูู ุญุงูุชูู ูุฎุชููุชูู. ูุธุฑูุง ูุฃู ูู ุญุงูุฉ ูููู ุฃู ูููู ููุง ุงุฑุชูุงุนูุง ุงูุฎุงุต ุ ุชุธูุฑ ุซููุจ ูู ุงูุฒูุงูุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅุตูุงุญ ุฐูู ุ ูู ุจุชุบููุฑู </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุญูุซ ูุฎุฒู ุฅุญุฏุงุซูุงุช Y ููููุชูู ุงูุนูููุฉ ุงููููู ูุงููุณุฑู ุจุดูู ูููุตู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> leftTop = left.y + HexMetrics.wallHeight; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rightTop = right.y + HexMetrics.wallHeight; Vector3 v1, v2, v3, v4; v1 = v3 = left - leftThicknessOffset; v2 = v4 = right - rightThicknessOffset; v3.y = leftTop; v4.y = rightTop; walls.AddQuad(v1, v2, v3, v4); Vector3 t1 = v3, t2 = v4; v1 = v3 = left + leftThicknessOffset; v2 = v4 = right + rightThicknessOffset; v3.y = leftTop; v4.y = rightTop; walls.AddQuad(v2, v1, v4, v3);</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/9cd/f1d/a88/9cdf1da889ce427e1d519a284532d6a8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฌุฏุฑุงู ูุบููุฉ.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฌุฏุฑุงู ูุบููุฉ ุงูุขู ุ ูููู ุฑุจูุง ูุง ุชุฒุงู ุชุฑู ุซููุจูุง ูู ุธูุงู ุงูุฌุฏุงุฑ. ูุญุฏุซ ูุฐุง ุจุณุจุจ ูุนููุฉ </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชุญูุฒ ุงูุนุงุฏู</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฅุนุฏุงุฏ ุงูุธู ุงูุงุชุฌุงูู. ุนูุฏูุง ุชููู ุฃูุจุฑ ูู ุงูุตูุฑ ุ ุชุชุญุฑู ูุซูุซุงุช ุงูุฃุฌุณุงู ุงูุชู ุชููู ุจุธูุงููุง ุนูู ุทูู ุงูุนุงุฏู ุฅูู ุงูุณุทุญ. ูุฐุง ูุชุฌูุจ ุงูุชุธููู ุงูุฐุงุชู ุ ูููู ูู ููุณ ุงูููุช ูุฎูู ุซููุจูุง ูู ุงูุญุงูุงุช ุงูุชู ุชุจุฏู ูููุง ุงููุซูุซุงุช ูู ุงุชุฌุงูุงุช ูุฎุชููุฉ. ูู ูุฐู ุงูุญุงูุฉ ุ ูููู ุฅูุดุงุก ุซููุจ ูู ุธูุงู ุงูููุฏุณุฉ ุงูุฏูููุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุซู ุฌุฏุฑุงููุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููู ุงูุชุฎูุต ูู ุขุซุงุฑ ุงูุธู ูุฐู ุนู ุทุฑูู ุฎูุถ ุงูุชุญูุฒ ุงูุนุงุฏู ุฅูู ุงูุตูุฑ. ุฃู ูู ุจุชุบููุฑ ูุถุน </font><font style="vertical-align: inherit;">ุฌุฏุงุฑ ุงูุนุฑุถ ุงูุดุจูู </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cast Shadows</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅูู </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Two Sided</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . ุณูุคุฏู ุฐูู ุฅูู ุฌุนู ูุงุฆู ุงูุธู ุงููุตุจูุจ ูุฌุนู ุฌุงูุจู ูู ูุซูุซ ุญุงุฆุท ููุนุฑุถ ุ ููุง ุณูุคุฏู ุฅูู ุฅุบูุงู ุฌููุน ุงูุซููุจ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b14/9d5/d0b/b149d5d0bb36f049faa5ca9d49261618.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุชุนุฏ ููุงู ุซููุจ ูู ุงูุธูุงู. </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฌุฏุงุฑ ูุฏุฌ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุชู ุงูุขู ุ ุฌุฏุฑุงููุง ูุณุชูููุฉ ุจูุง ููู ุงูููุงูุฉ. </font><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ููุชุถุงุฑูุณ ุงููุณุทุญุฉ ุ ูุฐุง ููุณ ุณูุฆูุง ุนูู ุงูุฅุทูุงู ุ ูููู ูุจุฏู ุบุฑูุจูุง ุนูุฏูุง ุชุชุฒุงูู ุงูุฌุฏุฑุงู ูุน ุงูุญูุงู. </font><font style="vertical-align: inherit;">ูุญุฏุซ ูุฐุง ุนูุฏูุง ูููู ููุงู ุงุฎุชูุงู ูู ูุณุชูู ุงุฑุชูุงุน ูุงุญุฏ ุจูู ุงูุฎูุงูุง ุนูู ุฌุงูุจู ุงูุฌุฏุงุฑ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/065/481/c1a/065481c1a0859ced22d0ae6568acbe86.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฌุฏุฑุงู ูุณุชูููุฉ ุนูู ุงูุญูุงู.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงุชุจุน ุงูุญุงูุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏูุงู ูู ุฅูุดุงุก ุฌุฒุก ูุงุญุฏ ููุญุงูุฉ ุจุฃููููุง ุ ุณูููู ุจุฅูุดุงุก ุฌุฒุก ููู ุฌุฒุก ูู ุดุฑูุท ุงูุญุงูุฉ. </font><font style="vertical-align: inherit;">ูููููุง ุงูููุงู ุจุฐูู ุนู ุทุฑูู ุงูุงุชุตุงู ุฃุฑุจุน ูุฑุงุช </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุฅุตุฏุงุฑ </font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุญุงูุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nearCell.Walled != farCell.Walled) { AddWallSegment(near.v1, far.v1, near.v2, far.v2); AddWallSegment(near.v2, far.v2, near.v3, far.v3); AddWallSegment(near.v3, far.v3, near.v4, far.v4); AddWallSegment(near.v4, far.v4, near.v5, far.v5); } }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/a96/8aa/0f9/a968aa0f984b31e81dc9edb12e8d31bb.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูููุณ ุงูุฌุฏุฑุงู. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุฑุฑ ุงูุฌุฏุฑุงู ุงูุขู ุดูู ุงูุญูุงู ุงููุดููุฉ. </font><font style="vertical-align: inherit;">ูู ุชุฑููุจุฉ ูุน ุงูุญูุงู ุ ุชุจุฏู ุฃูุถู ุจูุซูุฑ. </font><font style="vertical-align: inherit;">ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุฅูู ูุฎูู ุฌุฏุฑุงููุง ุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ุนูู ุดูู ูุณุทุญ.</font></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุถุน ุงูุฌุฏุฑุงู ุนูู ุงูุฃุฑุถ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงููุธุฑ ุฅูู ุงูุฌุฏุฑุงู ุนูู ุงูุญูุงู ุ ููููู ุงูุนุซูุฑ ุนูู ูุดููุฉ. ุงูุฌุฏุฑุงู ูุนููุฉ ุนูู ุงูุฃุฑุถ! ูุฐุง ููุทุจู ุนูู ุงูุญูุงู ุงููุณุทุญุฉ ุงููุงุฆูุฉ ุ ูููู ุนุงุฏุฉ ูุง ูููู ููุญูุธูุง.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/039/8f0/a59/0398f0a59aca756824e162c3fba5a891.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฌุฏุฑุงู ูุนููุฉ ูู ุงูููุงุก.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุญู ุงููุดููุฉ ุ ูุญุชุงุฌ ุฅูู ุฎูุถ ุงูุฌุฏุฑุงู. ุฃุณูู ุทุฑููุฉ ูู ุฎูุถ ุงูุญุงุฆุท ุจุงููุงูู ุจุญูุซ ูุธู ุณุทุญู ูุณุทุญูุง. ูู ุงูููุช ููุณู ุ ุณููุฎูุถ โโุฌุฒุก ูู ุงูุฌุฏุงุฑ ุนูู ุงูุฌุงูุจ ุงูุนููู ููููุงู ุฅูู ุงูุงุฑุชูุงุญ ุ ูููู ูุฐุง ุณูู ููุงุณุจูุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฎูุถ ุงูุฌุฏุงุฑ ุ ูุญุชุงุฌ ุฅูู ุชุญุฏูุฏ ุฃู ุฌุงูุจ ุฃูู - ูุฑูุจ ุฃู ุจุนูุฏ. ูููููุง ููุท ุงุณุชุฎุฏุงู ุงุฑุชูุงุน ุงูุฌุงูุจ ุงูุณููู ุ ููููุง ูุณูุง ุจุญุงุฌุฉ ุฅูู ุงูุงูุฎูุงุถ ุฅูู ูุฐุง ุงูุญุฏ. ููููู ุงุณุชููุงู ุงูุฅุญุฏุงุซูุงุช Y ูู ุงูุฃุฏูู ุฅูู ุงูุฃุนูู ูุน ุฅุฒุงุญุฉ ุฃูู ุจูููู ูู 0.5. ูุธุฑูุง ูุฃู ุงูุฌุฏุฑุงู ุชุตุจุญ ุฃุญูุงููุง ุฃุนูู ูู ุงูุฎุทูุฉ ุงูุณูููุฉ ููุญุงูุฉ ููุท ุ ูููููุง ุงุณุชุฎุฏุงู ุงูุฎุทูุฉ ุงูุฑุฃุณูุฉ ููุญุงูุฉ ูุฅุฒุงุญุฉ. ูุฏ ูุชุทูุจ ุณูู ุฌุฏุงุฑ ูุฎุชูู ูุชูููู ุงูุญุงูุฉ ุฅุฒุงุญุฉ ูุฎุชููุฉ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/960/61c/817/96061c817bfdc69db9682e0799ba3751.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุงุฑ ุงูุณููู. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุนูุง ูุถูู ุฅูู </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุทุฑููุฉ </font></font><code>WallLerp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชู ุชุชุนุงูู ูุน ูุฐุง ุงูุงุณุชููุงุก ุ ุจุงูุฅุถุงูุฉ ุฅูู ุญุณุงุจ ูุชูุณุท โโุฅุญุฏุงุซูุงุช X ู Z ููููุชูู ุงููุฑูุจุฉ ูุงูุจุนูุฏุฉ. </font><font style="vertical-align: inherit;">ูููู ุนูู ุทุฑููุฉ </font></font><code>TerraceLerp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallElevationOffset = verticalTerraceStepSize; โฆ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WallLerp</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far</span></span></span><span class="hljs-function">)</span></span> { near.x += (far.x - near.x) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; near.z += (far.z - near.z) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> v = near.y &lt; far.y ? wallElevationOffset : (<span class="hljs-number"><span class="hljs-number">1f</span></span> - wallElevationOffset); near.y += (far.y - near.y) * v; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> near; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฑุถ </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฐู ุงูุทุฑููุฉ ูุชุญุฏูุฏ ุงูุฐุฑูุงุช ุงููุณุฑู ูุงููููู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { Vector3 left = HexMetrics.WallLerp(nearLeft, farLeft); Vector3 right = HexMetrics.WallLerp(nearRight, farRight); โฆ }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/957/a4c/b49/957a4cb498eb8a712064a0b99a4041be.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุฑุงู ูุงููุฉ ุนูู ุงูุฃุฑุถ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุบููุฑ ุชุดููู ุงูุฌุฏุงุฑ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ุฌุฏุฑุงููุง ูู ุงุชูุงู ุฌูุฏ ูุน ุงุฎุชูุงูุงุช ูู ุงูุงุฑุชูุงุน. ููููุง ูุง ุชุฒุงู ูุง ุชุชูุงูู ุชูุงููุง ูุน ุงูุญูุงู ุงููุดููุฉ ุ ุนูู ุงูุฑุบู ูู ุฃููุง ูุฑูุจุฉ ูููุง. ุญุฏุซ ูุฐุง ูุฃููุง ุญุฏุฏูุง ุฃููุงู ููู ุงูุฌุฏุฑุงู ุ ุซู ูููุง ุจุชุดููููุง. ุจูุง ุฃู ูุฐู ุงูููู ูู ููุงู ูุง ุจูู ุฑุคูุณ ุงูุญูุงู ุงููุฑูุจุฉ ูุงูุจุนูุฏุฉ ุ ูุฅู ุชุดูููุง ุณูููู ูุฎุชูููุง ููููุงู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญูููุฉ ุฃู ุงูุฌุฏุฑุงู ุชุชุจุน ุงูุฃุถูุงุน ุจุดูู ุบูุฑ ุฏููู ููุณุช ูุดููุฉ. ููุน ุฐูู ุ ูุฅู ุชุดููู ููู ุงูุฌุฏุงุฑ ูุชุบูุฑ ุจุณูุงูุฉ ููุญุฏุฉ ูุณุจููุง. ุฅุฐุง ูููุง ุจุชุฑุชูุจ ุงูุฌุฏุฑุงู ุจูุงุกู ุนูู ุงูููู ุงููุดููุฉ ุ ุซู ุฃุถููุง ุฃุฑุจุงุนูุง ุบูุฑ ูุดููุฉ ุ ูุฌุจ ุฃูุง ูุฎุชูู ุณูููุง ูุซูุฑูุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { nearLeft = HexMetrics.Perturb(nearLeft); farLeft = HexMetrics.Perturb(farLeft); nearRight = HexMetrics.Perturb(nearRight); farRight = HexMetrics.Perturb(farRight); โฆ walls.AddQuadUnperturbed(v1, v2, v3, v4); โฆ walls.AddQuadUnperturbed(v2, v1, v4, v3); walls.AddQuadUnperturbed(t1, t2, v3, v4); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b10/fa3/03d/b10fa303dc91a50665bf92b47feed5e7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูููู ุบูุฑ ุงููุดููุฉ ููุฌุฏุฑุงู. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจูุถู ูุฐุง ุงูููุฌ ุ ูู ุชุชุจุน ุงูุฌุฏุฑุงู ุงูุญูุงู ุจุฏูุฉ ููุง ูุงูุช ูู ูุจู. </font><font style="vertical-align: inherit;">ูููู ูู ุงูููุงุจู ุณูุตุจุญูู ุฃูู ูุณุฑูุง ูุณูููู ููู ุณูู ุฃูุซุฑ ุซุจุงุชูุง.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/d38/7f6/b6f/d387f6b6f1c4fed424d2582a8ef5c12c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูู ุงูุฌุฏุงุฑ ุฃูุซุฑ ุงุชุณุงูุง. </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุซููุจ ูู ุงูุฌุฏุฑุงู </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฏ ุชุฌุงูููุง ุญุชู ุงูุขู ุฅููุงููุฉ ุนุจูุฑ ููุฑ ุฃู ุทุฑูู. </font><font style="vertical-align: inherit;">ุนูุฏูุง ูุญุฏุซ ูุฐุง ุ ูุฌุจ ุนูููุง ุนูู ุซูุจ ูู ุงูุฌุฏุงุฑ ูููู ุฃู ููุฑ ูู ุฎูุงูู ููุฑ ุฃู ุทุฑูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููููุงู ุจุฐูู ุ ุฃุถู </font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนููุชูู ููุทููุชูู ููุฅุดุงุฑุฉ ุฅูู ูุง ุฅุฐุง ูุงู ููุฑ ุฃู ุทุฑูู ููุฑ ุนุจุฑ ุญุงูุฉ. </font><font style="vertical-align: inherit;">ุนูู ุงูุฑุบู ูู ุฃูู ูููููุง ุงูุชุนุงูู ูุนูุง ุจุดูู ูุฎุชูู ุ ููููู ููุท ุจุฅุฒุงูุฉ ุงูุฌุฒุกูู ุงูุฃูุณุทูู ูู ููุชุง ุงูุญุงูุชูู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRiver, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nearCell.Walled != farCell.Walled) { AddWallSegment(near.v1, far.v1, near.v2, far.v2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRiver || hasRoad) { <span class="hljs-comment"><span class="hljs-comment">// Leave a gap. } else { AddWallSegment(near.v2, far.v2, near.v3, far.v3); AddWallSegment(near.v3, far.v3, near.v4, far.v4); } AddWallSegment(near.v4, far.v4, near.v5, far.v5); } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู </font></font><code>HexGridChunk.TriangulateConnection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุจ ุฃู ุชููุฑ ุงูุจูุงูุงุช ุงููุงุฒูุฉ. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃูู ูุงู ุจุญุงุฌุฉ ุจุงููุนู ุฅูู ููุณ ุงููุนูููุงุช ุ ูููุฎุฒููุง ูุคูุชูุง ูู ูุชุบูุฑุงุช Boolean ูุชุณุฌูู ุงูููุงููุงุช ุจุงูุทุฑู ุงูููุงุจูุฉ ูุฑุฉ ูุงุญุฏุฉ ููุท.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateConnection</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, EdgeVertices e1 </span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRiver = cell.HasRiverThroughEdge(direction); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRoad = cell.HasRoadThroughEdge(direction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRiver) { โฆ } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.GetEdgeType(direction) == HexEdgeType.Slope) { TriangulateEdgeTerraces(e1, cell, e2, neighbor, hasRoad); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { TriangulateEdgeStrip(e1, cell.Color, e2, neighbor.Color, hasRoad); } features.AddWall(e1, cell, e2, neighbor, hasRiver, hasRoad); โฆ }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/64c/d05/425/64cd0542540b5d9347a071d727fe2fa4.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุซููุจ ูู ุงูุฌุฏุฑุงู ููุฑูุฑ ุงูุฃููุงุฑ ูุงูุทุฑู.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุญู ูุบุทู ุงูุฌุฏุฑุงู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฎูู ูุฐู ุงููุชุญุงุช ุงูุฌุฏูุฏุฉ ุฃูุงูู ูุฅููุงู ุงูุฌุฏุฑุงู. </font><font style="vertical-align: inherit;">ูุญุชุงุฌ ุฅูู ุฅุบูุงู ููุงุท ุงูููุงูุฉ ูุฐู ุจุงูููุงุฏ ุญุชู ูุง ูุชููู ูู ุงููุธุฑ ุนุจุฑ ุฌูุงูุจ ุงูุฌุฏุฑุงู. </font><font style="vertical-align: inherit;">ุฏุนููุง ููุดุฆ </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุทุฑููุฉ </font><font style="vertical-align: inherit;">ููุฐุง ุงูุบุฑุถ </font></font><code>AddWallCap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุนูู ูุซู </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุ ูููู ูุญุชุงุฌ ููุท ุฅูู ุฒูุฌ ูุงุญุฏ ูู ุงูููู ุงููุฑูุจุฉ. </font><font style="vertical-align: inherit;">ุงุฌุนูู ูุถูู ุฑุจุงุนููุง ุ ูู ูุฑูุจ ุฅูู ุฃูุตู ุฌุงูุจ ูู ุงูุฌุฏุงุฑ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallCap</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far</span></span></span><span class="hljs-function">)</span></span> { near = HexMetrics.Perturb(near); far = HexMetrics.Perturb(far); Vector3 center = HexMetrics.WallLerp(near, far); Vector3 thickness = HexMetrics.WallThicknessOffset(near, far); Vector3 v1, v2, v3, v4; v1 = v3 = center - thickness; v2 = v4 = center + thickness; v3.y = v4.y = center.y + HexMetrics.wallHeight; walls.AddQuadUnperturbed(v1, v2, v3, v4); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏูุง </font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชุดู ุฃููุง ุจุญุงุฌุฉ ุฅูู ุซูุจ ุ ูุถูู ุบุทุงุกูุง ุจูู ุงูุฒูุฌูู ุงูุซุงูู ูุงูุฑุงุจุน ูู ุญูุงู ุงูุญูุงู. </font><font style="vertical-align: inherit;">ููุฒูุฌ ุงูุฑุงุจุน ูู ุงูููู ุ ุชุญุชุงุฌ ุฅูู ุชุจุฏูู ุงูุงุชุฌุงู ุ ูุฅูุง ุณูุจุฏู ุงููุฌู ุงูุฑุจุงุนู ููุฏุงุฎู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRiver, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nearCell.Walled != farCell.Walled) { AddWallSegment(near.v1, far.v1, near.v2, far.v2); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRiver || hasRoad) { AddWallCap(near.v2, far.v2); AddWallCap(far.v4, near.v4); } โฆ } }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/413/98c/828/41398c82892a2c1f706ca85c9230813a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุซููุจ ูุบููุฉ ูู ุงูุญูุงุฆุท.</font></font></i> <br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฐุง ุนู ุงูุซููุจ ุญูู ุญูุงู ุงูุฎุฑูุทุฉุ</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl">   ,     .        .    ,        . </div></div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุฌูุจ ุงูููุญุฏุฑุงุช ูุงูููุงู </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุฎูุฑูุง ุ ูููู ูุธุฑุฉ ุนูู ุงูุญูุงู ุงูุชู ุชุญุชูู ุนูู ุงูููุญุฏุฑุงุช ุฃู ุงููุงุก. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุงูููุญุฏุฑุงุช ูู ุฌุฏุฑุงู ูุจูุฑุฉ ูู ุงูุฃุณุงุณ ุ ูุณูููู ูู ุบูุฑ ุงูููุทูู ูุถุน ุฌุฏุงุฑ ุฅุถุงูู ุนูููุง. </font><font style="vertical-align: inherit;">ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุณูุจุฏู ุณูุฆูุง. </font><font style="vertical-align: inherit;">ููุง ุฃู ุงูุฌุฏุฑุงู ุชุญุช ุงููุงุก ุบูุฑ ููุทููุฉ ุชูุงููุง ุ ูุซู ุงููููุฏ ุงูุชู ุชูุฑุถูุง ุฌุฏุฑุงู ุงูุณุงุญู.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/45a/94e/027/45a94e027094c6ebdae0763663d6eb8e.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุฑุงู ุนูู ุงูููุญุฏุฑุงุช ููู ุงููุงุก. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููููุง ุฅุฒุงูุฉ ุงูุฌุฏุฑุงู ูู ูุฐู ุงูุญูุงู ุบูุฑ ุงูุถุฑูุฑูุฉ ูุน ุชุณุฌููุงุช ุฅุถุงููุฉ </font></font><code>AddWall</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุง ูููู ุฃู ูููู ุงูุฌุฏุงุฑ ุชุญุช ุงููุงุก ุ ููุง ูููู ุฃู ูููู ุงูุถูุน ุงููุดุชุฑู ูุนู ููุญุฏุฑูุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWall</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> EdgeVertices near, HexCell nearCell, EdgeVertices far, HexCell farCell, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRiver, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hasRoad </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( nearCell.Walled != farCell.Walled &amp;&amp; !nearCell.IsUnderwater &amp;&amp; !farCell.IsUnderwater &amp;&amp; nearCell.GetEdgeType(farCell) != HexEdgeType.Cliff ) { โฆ } }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/128/baf/75a/128baf75ace7d0cf4ed5f12ef380eec8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุช ุฅุฒุงูุฉ ุงูุฌุฏุฑุงู ุงููุนููุฉ ุนูู ุทูู ุงูุฃุถูุงุน ุ ููู ุงูุฒูุงูุง ุจููุช ูู ููุงููุง.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุฒุงูุฉ ุฒูุงูุง ุงูุฌุฏุงุฑ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุชุทูุจ ุฅุฒุงูุฉ ุดุฑุงุฆุญ ุงูุฒุงููุฉ ุบูุฑ ุงูุถุฑูุฑูุฉ ูุฒูุฏูุง ูู ุงูุฌูุฏ. </font><font style="vertical-align: inherit;">ุงูุญุงูุฉ ุงูุฃุจุณุท ูู ุนูุฏูุง ุชููู ุฎููุฉ ุงูุฏุนู ุชุญุช ุงููุงุก. </font><font style="vertical-align: inherit;">ูุฐุง ูุถูู ุนุฏู ูุฌูุฏ ุฃุฌุฒุงุก ุฌุฏุงุฑ ูุฑูุจุฉ ูููู ุชูุตูููุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 pivot, HexCell pivotCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pivotCell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } AddWallSegment(pivot, left, pivot, right); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ecc/475/9f3/ecc4759f38ced7802ad8743626f91d51.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุชุนุฏ ููุงู ุฎูุงูุง ุฏุนู ุชุญุช ุงููุงุก. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ูุญู ุจุญุงุฌุฉ ุฅูู ุงููุธุฑ ูู ุฎููุชูู ุฃุฎุฑููู. </font><font style="vertical-align: inherit;">ุฅุฐุง ูุงู ุฃุญุฏูู ุชุญุช ุงููุงุก ุฃู ูุชุตููุง ุจุฎููุฉ ุงูุฏุนู ุนู ุทุฑูู ุงุณุชุฑุงุญุฉ ุ ููุง ููุฌุฏ ุฌุฏุงุฑ ุนูู ุทูู ูุฐุง ุงูุถูุน. </font><font style="vertical-align: inherit;">ุฅุฐุง ูุงู ูุฐุง ููุทุจู ุนูู ุฌุงูุจ ูุงุญุฏ ุนูู ุงูุฃูู ุ ููุง ูุฌุจ ุฃู ูููู ููุงู ุฌุฒุก ูู ุงูุฌุฏุงุฑ ูู ูุฐุง ุงูุฑูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญุฏุฏ ุจุดูู ูุฑุฏู ูุง ุฅุฐุง ูุงู ููุงู ุฌุฏุงุฑ ูุณุงุฑ ุฃู ูููู. </font><font style="vertical-align: inherit;">ูุถุน ุงููุชุงุฆุฌ ูู ูุชุบูุฑุงุช ููุทููุฉ ูุชุณููู ุงูุนูู ูุนูุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pivotCell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasLeftWall = !leftCell.IsUnderwater &amp;&amp; pivotCell.GetEdgeType(leftCell) != HexEdgeType.Cliff; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasRighWall = !rightCell.IsUnderwater &amp;&amp; pivotCell.GetEdgeType(rightCell) != HexEdgeType.Cliff; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasLeftWall &amp;&amp; hasRighWall) { AddWallSegment(pivot, left, pivot, right); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/8cd/f17/82d/8cdf1782d522d5b9e19e461ee5253436.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชูุช ุฅุฒุงูุฉ ุฌููุน ุงูุฒูุงูุง ุงููุณุจุจุฉ ููุชุฏุงุฎู.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃุบูู ุงูุฒูุงูุง </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏูุง ูุง ูููู ููุงู ุฌุฏุงุฑ ุนูู ุงูุญุงูุฉ ุงููุณุฑู ุฃู ุงููููู ุ ููุชูู ุงูุนูู. </font><font style="vertical-align: inherit;">ูููู ุฅุฐุง ูุงู ุงูุฌุฏุงุฑ ูู ุงุชุฌุงู ูุงุญุฏ ููุท ุ ููุฐุง ูุนูู ูุฌูุฏ ุซูุจ ุขุฎุฑ ูู ุงูุฌุฏุงุฑ. </font><font style="vertical-align: inherit;">ูุฐูู ุ ุชุญุชุงุฌ ุฅูู ุฅุบูุงูู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasLeftWall) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRighWall) { AddWallSegment(pivot, left, pivot, right); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallCap(pivot, left); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRighWall) { AddWallCap(right, pivot); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/20e/c4d/176/20ec4d17689500d123fc5fd41d447e88.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญู ูุบูู ุงูุฌุฏุฑุงู.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฑุจุท ุงูุฌุฏุฑุงู ุจุงูููุญุฏุฑุงุช </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุฃุญุฏ ุงูููุงูู ุ ุชุจุฏู ุงูุฌุฏุฑุงู ุบูุฑ ูุงููุฉ. </font><font style="vertical-align: inherit;">ุนูุฏูุง ูุตู ุงูุฌุฏุงุฑ ุฅูู ูุงุน ุงูุฌุฑู ุ ููุชูู. </font><font style="vertical-align: inherit;">ูููู ูุธุฑูุง ูุฃู ุงูููุญุฏุฑุงุช ููุณุช ุฑุฃุณูุฉ ุชูุงููุง ุ ูุชู ุฅูุดุงุก ุซูุจ ุถูู ุจูู ุงูุฌุฏุงุฑ ูุญุงูุฉ ุงูููุญุฏุฑ. </font><font style="vertical-align: inherit;">ูู ุงูุฌุฒุก ุงูุนููู ูู ุงูุฌุฑู ุ ูุง ุชูุดุฃ ูุซู ูุฐู ุงููุดููุฉ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/633/5c6/9a7/6335c69a7f45dcd1c2a0609503b2504a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุซููุจ ุจูู ุงูุฌุฏุฑุงู ููุฌูู ุงูููุญุฏุฑุงุช. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูููู ูู ุงูุฃูุถู ุจูุซูุฑ ุฅุฐุง ุงุณุชูุฑ ุงูุฌุฏุงุฑ ุญุชู ุญุงูุฉ ุงูุฌุฑู. </font><font style="vertical-align: inherit;">ูููููุง ุงูููุงู ุจุฐูู ุนู ุทุฑูู ุฅุถุงูุฉ ุฌุฒุก ุขุฎุฑ ูู ุงูุฌุฏุงุฑ ุจูู ุงูุทุฑู ุงูุญุงูู ููุฌุฏุงุฑ ูุงูุฌุฒุก ุงูุนููู ูู ุงูููุญุฏุฑ. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ูุนุธู ูุฐุง ุงูุฌุฒุก ุณูููู ูุฎูููุง ุฏุงุฎู ุงูุฌุฑู ุ ูููููุง ุงูุงุณุชุบูุงุก ุนู ุชูููู ุณูู ุงูุฌุฏุงุฑ ุฏุงุฎู ุงูุฌุฑู ุฅูู ุงูุตูุฑ. </font><font style="vertical-align: inherit;">ูุจุงูุชุงูู ุ ูููู ุจุงููุณุจุฉ ููุง ุฅูุดุงุก ุฅุณููู: ุงุซูุงู ููุงุฏ ูุฐูุจุงู ุฅูู ุงูููุทุฉ ููุซูุซ ูููููุง. </font><font style="vertical-align: inherit;">ุฏุนููุง ููุดุฆ ุทุฑููุฉ ููุฐุง ุงูุบุฑุถ </font></font><code>AddWallWedge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูููู ุงูููุงู ุจุฐูู ุนู ุทุฑูู ูุณุฎ </font></font><code>AddWallCap</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅุถุงูุฉ ููุทุฉ ุฅุณููู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallWedge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far, Vector3 point</span></span></span><span class="hljs-function">)</span></span> { near = HexMetrics.Perturb(near); far = HexMetrics.Perturb(far); point = HexMetrics.Perturb(point); Vector3 center = HexMetrics.WallLerp(near, far); Vector3 thickness = HexMetrics.WallThicknessOffset(near, far); Vector3 v1, v2, v3, v4; Vector3 pointTop = point; point.y = center.y; v1 = v3 = center - thickness; v2 = v4 = center + thickness; v3.y = v4.y = pointTop.y = center.y + HexMetrics.wallHeight; <span class="hljs-comment"><span class="hljs-comment">// walls.AddQuadUnperturbed(v1, v2, v3, v4); walls.AddQuadUnperturbed(v1, point, v3, pointTop); walls.AddQuadUnperturbed(point, v2, pointTop, v4); walls.AddTriangleUnperturbed(pointTop, v3, v4); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฒูุงูุง ุ ุณูู ูุณูู ูุฐู ุงูุทุฑููุฉ ุนูุฏูุง ูุณูุฑ ุงูุฌุฏุงุฑ ูู ุงุชุฌุงู ูุงุญุฏ ููุท ููููู ูุฐุง ุงูุฌุฏุงุฑ ุนูู ุงุฑุชูุงุน ุฃูู ูู ุงูุฌุงูุจ ุงูุขุฎุฑ. </font><font style="vertical-align: inherit;">ูู ุธู ูุฐู ุงูุธุฑูู ููุงุฌู ุญุงูุฉ ุงููุงููุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasLeftWall) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRighWall) { AddWallSegment(pivot, left, pivot, right); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (leftCell.Elevation &lt; rightCell.Elevation) { AddWallWedge(pivot, left, right); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallCap(pivot, left); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasRighWall) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rightCell.Elevation &lt; leftCell.Elevation) { AddWallWedge(right, pivot, left); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AddWallCap(right, pivot); } }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b5c/30f/33a/b5c30f33ac93582e2ce319996d9ed1ac.png"></div><br> <i> ,   .</i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow">unitypackage</a> <br><br><h1 style=";text-align:right;direction:rtl">  11:    </h1><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">    . </li><li style=";text-align:right;direction:rtl">     . </li><li style=";text-align:right;direction:rtl">     . </li></ul><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ef5/a07/5ea/ef5a075ea4c14c810825388be274f817.jpg"></div><br> <i>  .</i> <br><br><h2 style=";text-align:right;direction:rtl">    </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงูุฌุฒุก ุงูุณุงุจู ุ ุฃุถููุง ุฏุนู ุงูุฌุฏุงุฑ. ูุฐู ุฃุฌุฒุงุก ุจุณูุทุฉ ูู ุงูุฌุฏุงุฑ ุงููุณุชููู ูุน ุนุฏู ูุฌูุฏ ูุฑูู ูุงุถุญุฉ. ุงูุขู ุณูุฌุนู ุงูุฌุฏุฑุงู ุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ุจุฅุถุงูุฉ ุฃุจุฑุงุฌ ุฅูููุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฌุจ ุฅูุดุงุก ููุงุทุน ุงูุฌุฏุงุฑ ุฅุฌุฑุงุฆูุง ูุชุชูุงุณุจ ูุน ุงูุฅุบุงุซุฉ. ูุฐุง ุบูุฑ ูุทููุจ ููุฃุจุฑุงุฌ ุ ูููููุง ุงุณุชุฎุฏุงู ุงูุฌุงูุฒุฉ ุงููุนุชุงุฏุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููููุง ุฅูุดุงุก ุจุฑุฌ ุจุณูุท ูู ููุนุจูู ุจููุงุฏ ุญูุฑุงุก. ูุจูุบ ุญุฌู ูุงุนุฏุฉ ุงูุจุฑุฌ 2 ร 2 ูุงุฑุชูุงุน 4 ูุญุฏุงุช ุ ุฃู ุฃููุง ุฃูุซุฑ ุณูููุง ูุฃุนูู ูู ุงูุฌุฏุงุฑ. ููู ูุฐุง ุงูููุนุจ ุณูุถุน ูุญุฏุฉ ููุนุจ ุชุดูุฑ ุฅูู ุงูุฌุฒุก ุงูุนููู ูู ุงูุจุฑุฌ. ูุซู ุฌููุน ุงููุจุงูู ุงูุฌุงูุฒุฉ ุงูุฃุฎุฑู ุ ูุง ุชุชุทูุจ ูุฐู ุงูููุนุจุงุช ูุตุงุฏูุงุช.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจูุง ุฃู ูููุฐุฌ ุงูุจุฑุฌ ูุชููู ูู ุนุฏุฉ ูุงุฆูุงุช ุ ูุฅููุง ูุฌุนููู ุฃุทูุงููุง ููุงุฆู ุงูุฌุฐุฑ. </font><font style="vertical-align: inherit;">ุถุนูุง ุจุญูุซ ูููู ุงูุฃุตู ุงููุญูู ููุฌุฐุฑ ูู ูุงุนุฏุฉ ุงูุจุฑุฌ. </font><font style="vertical-align: inherit;">ุจูุถู ูุฐุง ุ ูููููุง ูุถุน ุงูุฃุจุฑุงุฌ ุฏูู ุงูููู ุจุดุฃู ุงุฑุชูุงุนูุง.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/2f1/a54/335/2f1a54335d81a6682707e740107362c6.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฑุฌ ุงูุฌุงูุฒุฉ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุถู ุฑุงุจุทูุง ุฅูู ูุฐุง ุงูุฅุนุฏุงุฏ ุงููุณุจู </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ุจุชูุตููู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform wallTower;</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/f76/df1/c7e/f76df1c7e5b1c808d2ae636f7e823487.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุตู ุฅูู ุจุฑุฌ ุงูุฌุงูุฒุฉ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃุจุฑุงุฌ ุงูุจูุงุก </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุจุฏุฃ ุจูุถุน ุงูุฃุจุฑุงุฌ ูู ููุชุตู ูู ุฌุฒุก ูู ุงูุฌุฏุงุฑ. </font><font style="vertical-align: inherit;">ููููุงู ุจุฐูู ุ ุณูููู ุจุฅูุดุงุก ุจุฑุฌ ูู ููุงูุฉ ุงูุทุฑููุฉ </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุณูููู ูููุนูุง ูู ูุชูุณุท โโุงูููุงุท ุงููุณุฑู ูุงููููู ูู ุงูููุทุน.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight </span></span></span><span class="hljs-function">)</span></span> { โฆ Transform towerInstance = Instantiate(wallTower); towerInstance.transform.localPosition = (left + right) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; towerInstance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/559/541/487/559541487b79dd6877b4456dbdf010b1.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฑุฌ ูุงุญุฏ ููู ูุทุนุฉ ุญุงุฆุท. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุตููุง ุนูู ุงูุนุฏูุฏ ูู ุงูุฃุจุฑุงุฌ ุนูู ุทูู ุงูุฌุฏุงุฑ ุ ููู ุงุชุฌุงููุง ูุง ูุชุบูุฑ. </font><font style="vertical-align: inherit;">ูุญู ุจุญุงุฌุฉ ุฅูู ุชุบููุฑ ุฏูุฑุงููุง ุจุญูุซ ุชุชูุงุดู ูุน ุงูุฌุฏุงุฑ. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ูุฏููุง ุงูููุงุท ุงููููู ูุงููุณุฑู ูู ุงูุฌุฏุงุฑ ุ ูุฅููุง ูุนูู ุงูุงุชุฌุงู ุงูุตุญูุญ. </font><font style="vertical-align: inherit;">ูููููุง ุงุณุชุฎุฏุงู ูุฐู ุงููุนุฑูุฉ ูุชุญุฏูุฏ ุงุชุฌุงู ุฌุฒุก ุงูุฌุฏุงุฑ ุ ูุจุงูุชุงูู ุงูุจุฑุฌ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏูุงู ูู ุญุณุงุจ ุงูุฏูุฑุงู ุจุฃููุณูุง ุ ูููู ุจุจุณุงุทุฉ ุจุชุนููู </font></font><code>Transform.right</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุฌู </font><font style="vertical-align: inherit;">ููููููุฉ </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุณูุบูุฑ ุฑูุฒ ุงููุญุฏุฉ ุฏูุฑุงู ุงููุงุฆู ุจุญูุซ ูุชูุงูู ุญู ุงุชุฌุงูู ุงููุญูู ูุน ุงููุงูู ุงููุฑุณูู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> Transform towerInstance = Instantiate(wallTower); towerInstance.transform.localPosition = (left + right) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; Vector3 rightDirection = right - left; rightDirection.y = <span class="hljs-number"><span class="hljs-number">0f</span></span>; towerInstance.transform.right = rightDirection; towerInstance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/5d3/2c3/777/5d32c3777d5b63db90ddf9f8fbbf1dee.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชู ูุญุงุฐุงุฉ ุงูุฃุจุฑุงุฌ ูุน ุงูุฌุฏุงุฑ.</font></font></i> <br><br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ุชุนูู ุงููููุฉ Transform.rightุ</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl">     <code>Quaternion.FromToRotation</code>   .   . <br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 right { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rotation * Vector3.right; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { rotation = Quaternion.FromToRotation(Vector3.right, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } }</code> </pre> </div></div><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููู ุนุฏุฏ ุงูุฃุจุฑุงุฌ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฑุฌ ูุงุญุฏ ููู ุฌุฒุก ูู ุงูุฌุฏุงุฑ ุฃูุซุฑ ูู ุงููุงุฒู. </font><font style="vertical-align: inherit;">ุฏุนููุง ูุฌุนู ุฅุถุงูุฉ ุงูุจุฑุฌ ุงุฎุชูุงุฑููุง ุจุฅุถุงูุฉ </font></font><code>AddWallSegment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุนููุฉ </font><font style="vertical-align: inherit;">ุฅูู </font><font style="vertical-align: inherit;">ุงูููุทููุฉ. </font><font style="vertical-align: inherit;">ูู ุจุชุนูููู ุฅูู ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูู ูุฐู ุงูุญุงูุฉ ุ ุณุชุฎุชูู ุฌููุน ุงูุฃุจุฑุงุฌ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 nearLeft, Vector3 farLeft, Vector3 nearRight, Vector3 farRight, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> addTower = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (addTower) { Transform towerInstance = Instantiate(wallTower); towerInstance.transform.localPosition = (left + right) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; Vector3 rightDirection = right - left; rightDirection.y = <span class="hljs-number"><span class="hljs-number">0f</span></span>; towerInstance.transform.right = rightDirection; towerInstance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุนูุง ูุถุน ุงูุฃุจุฑุงุฌ ููุท ูู ุฒูุงูุง ุงูุฎูุงูุง. </font><font style="vertical-align: inherit;">ููุชูุฌุฉ ูุฐูู ุ ูุญุตู ุนูู ุนุฏุฏ ุฃูู ูู ุงูุฃุจุฑุงุฌ ุจูุณุงูุงุช ุซุงุจุชุฉ ุฅูู ุญุฏ ูุง ุจููููุง.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWallSegment</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Vector3 pivot, HexCell pivotCell, Vector3 left, HexCell leftCell, Vector3 right, HexCell rightCell </span></span></span><span class="hljs-function">)</span></span> { โฆ AddWallSegment(pivot, left, pivot, right, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); โฆ }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/d60/823/d7b/d60823d7b381eccaf5916bf2bc636061.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฃุจุฑุงุฌ ููุท ูู ุงูุฒูุงูุง. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุจุฏู ุฌูุฏูุง ุจูุง ููู ุงูููุงูุฉ ุ ูููู ูุฏ ูุญุชุงุฌ ุฅูู ูุถุน ุฏูุฑู ุฃูู ููุฃุจุฑุงุฌ. </font><font style="vertical-align: inherit;">ููุง ูู ุงูุญุงู ูุน ููุฒุงุช ุงูุชุถุงุฑูุณ ุงูุฃุฎุฑู ุ ูููููุง ุงุณุชุฎุฏุงู ุทุงููุฉ ุงูุชุฌุฒุฆุฉ ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงู ุณูุชู ูุถุน ุงูุจุฑุฌ ูู ุฒุงููุฉ. </font><font style="vertical-align: inherit;">ููููุงู ุจุฐูู ุ ูุณุชุฎุฏู ูุฑูุฒ ุงูุฒุงููุฉ ูุฃุฎุฐ ุนููุฉ ูู ุงูุฌุฏูู ุ ุซู ุณูููู ุจููุงุฑูุฉ ุฅุญุฏู ููู ุงูุชุฌุฒุฆุฉ ูุน ูููุฉ ุนุชุจุฉ ุงูุฃุจุฑุงุฌ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> HexHash hash = HexMetrics.SampleHashGrid( (pivot + left + right) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasTower = hash.e &lt; HexMetrics.wallTowerThreshold; AddWallSegment(pivot, left, pivot, right, hasTower);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุดูุฑ ูููุฉ ุงูุนุชุจุฉ ุฅูู </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ุจูููุฉ 0.5 ุ ุณูุชู ุฅูุดุงุก ุงูุฃุจุฑุงุฌ ูู ูุตู ุงูุญุงูุงุช ุ ูููู ูููููุง ุฅูุดุงุก ุฌุฏุฑุงู ุจูุง ุงูุนุฏูุฏ ูู ุงูุฃุจุฑุงุฌ ุฃู ุจุฏูููุง ุนูู ุงูุฅุทูุงู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallTowerThreshold = <span class="hljs-number"><span class="hljs-number">0.5f</span></span>;</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b54/40c/f0f/b5440cf0ffa4f615f2dcbf37532bbb0a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุจุฑุงุฌ ุนุดูุงุฆูุฉ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุฒูู ุงูุฃุจุฑุงุฌ ูู ุงูููุญุฏุฑุงุช </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ูุถุน ุงูุฃุจุฑุงุฌ ุจุบุถ ุงููุธุฑ ุนู ุดูู ุงูุชุถุงุฑูุณ. </font><font style="vertical-align: inherit;">ููุน ุฐูู ุ ุนูู ููุญุฏุฑุงุช ุงูุจุฑุฌ ุชุจุฏู ุบูุฑ ููุทููุฉ. </font><font style="vertical-align: inherit;">ููุง ุชุฐูุจ ุงูุฌุฏุฑุงู ุจุฒุงููุฉ ููููู ุฃู ุชูุทุน ุฃุนูู ุงูุจุฑุฌ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/24c/c5e/2dd/24cc5e2ddb97b83d14e0826bc64e3f20.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุจุฑุงุฌ ุนูู ุงูููุญุฏุฑุงุช. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุฌูุจ ุงูููุญุฏุฑุงุช ุ ุณูู ูุชุญูู ููุง ุฅุฐุง ูุงูุช ุฎูุงูุง ุงูุฒุงููุฉ ุงููููู ูุงููุณุฑู ูู ููุณ ุงูุงุฑุชูุงุน. </font><font style="vertical-align: inherit;">ููุท ูู ูุฐู ุงูุญุงูุฉ ูู ุงููููู ูุถุน ุจุฑุฌ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> hasTower = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (leftCell.Elevation == rightCell.Elevation) { HexHash hash = HexMetrics.SampleHashGrid( (pivot + left + right) * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / <span class="hljs-number"><span class="hljs-number">3f</span></span>) ); hasTower = hash.e &lt; HexMetrics.wallTowerThreshold; } AddWallSegment(pivot, left, pivot, right, hasTower);</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/770/1b4/fd9/7701b4fd9d0a4952fce2a9e00bbb4571.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุชุนุฏ ููุงู ุฃุจุฑุงุฌ ุนูู ุฌุฏุฑุงู ุงูููุญุฏุฑุงุช.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุถุน ุงูุฌุฏุฑุงู ูุงูุฃุจุฑุงุฌ ุนูู ุงูุฃุฑุถ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุงูุฑุบู ูู ุฃููุง ูุชุฌูุจ ุงูุฌุฏุฑุงู ุนูู ุงูููุญุฏุฑุงุช ุ ุฅูุง ุฃู ุงูุฅุบุงุซุฉ ุนูู ุฌุงูุจู ุงูุฌุฏุงุฑ ูููู ุฃู ูููู ููุง ุงุฑุชูุงุนุงุช ูุฎุชููุฉ. </font><font style="vertical-align: inherit;">ูููู ุฃู ุชุนูู ุงูุฌุฏุฑุงู ุนูู ุทูู ุงูุญูุงู ุ ููููู ุฃู ูููู ููุฎูุงูุง ุงูุชู ููุง ููุณ ุงูุงุฑุชูุงุน ููุงุถุน ุฑุฃุณูุฉ ูุฎุชููุฉ. </font><font style="vertical-align: inherit;">ูุจุณุจุจ ูุฐุง ุ ูุฏ ุชููู ูุงุนุฏุฉ ุงูุจุฑุฌ ูู ุงูููุงุก.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/cd2/4d8/b10/cd24d8b1012804af5d073c3901c874ad.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุจุฑุงุฌ ูู ุงูููุงุก. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ุงููุงูุน ุ ูููู ุฃูุถูุง ุชุนููู ุงูุฌุฏุฑุงู ุนูู ุงูููุญุฏุฑุงุช ูู ุงูููุงุก ุ ูููู ูุฐุง ููุณ ููุญูุธูุง ูุซู ุงูุฃุจุฑุงุฌ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/8b6/ae3/d24/8b6ae3d2489f253ae1a78593af0abd6c.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุฑุงู ูู ุงูููุงุก. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุฅุตูุงุญ ุฐูู ุนู ุทุฑูู ุชูุฏูุฏ ูุงุนุฏุฉ ุงูุฌุฏุฑุงู ูุงูุฃุจุฑุงุฌ ุนูู ุงูุฃุฑุถ. </font><font style="vertical-align: inherit;">ููููุงู ุจุฐูู ุ ุฃุถู ุฅุฒุงุญุฉ Y ููุฌุฏุฑุงู </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุญุฏุฉ ูุงุญุฏุฉ ูุฃุณูู ุณุชููู ูุงููุฉ. </font><font style="vertical-align: inherit;">ุฒูุงุฏุฉ ุงุฑุชูุงุน ุงูุฃุจุฑุงุฌ ุจููุณ ุงูููุฏุงุฑ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallHeight = <span class="hljs-number"><span class="hljs-number">4f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> wallYOffset = <span class="hljs-number"><span class="hljs-number">-1f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุจุชุบููุฑู </font></font><code>HexMetrics.WallLerp</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุญูุซ ูุฃุฎุฐ ุงูุฅุฒุงุญุฉ ุงูุฌุฏูุฏุฉ ูู ุงูุงุนุชุจุงุฑ ุนูุฏ ุชุญุฏูุฏ ุฅุญุฏุงุซูุงุช ุต.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WallLerp</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 near, Vector3 far</span></span></span><span class="hljs-function">)</span></span> { near.x += (far.x - near.x) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; near.z += (far.z - near.z) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> v = near.y &lt; far.y ? wallElevationOffset : (<span class="hljs-number"><span class="hljs-number">1f</span></span> - wallElevationOffset); near.y += (far.y - near.y) * v + wallYOffset; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> near; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญุชุงุฌ ุฃูุถูุง ุฅูู ุชุบููุฑ ุงูุจุฑุฌ ุงูุฌุงูุฒ ุ ุญูุซ ุณุชููู ุงููุงุนุฏุฉ ุงูุขู ูุญุฏุฉ ูุงุญุฏุฉ ุชุญุช ุงูุฃุฑุถ. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูููู ุจุฒูุงุฏุฉ ุงุฑุชูุงุน ุงูููุนุจ ุงูุฃุณุงุณู ุจููุฏุงุฑ ูุญุฏุฉ ูุงุญุฏุฉ ูุจุงูุชุงูู ูุบูุฑ ุงูููุถุน ุงููุญูู ููููุนุจุงุช.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/f2d/e4e/503/f2de4e50398fbae4ee296737dbe3a922.png"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ecd/5d7/0eb/ecd5d70ebb620e3bae84f17aedb4a2a9.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุฏุฑุงู ูุงูุฃุจุฑุงุฌ ุนูู ุงูุฃุฑุถ. </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl">  ุงูุฌุณูุฑ </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุฐู ุงููุฑุญูุฉ ุ ูุฏููุง ุฃููุงุฑ ูุทุฑู ุ ูููู ูุง ูููู ููุทุฑู ุนุจูุฑ ุงูุฃููุงุฑ ุจุฃู ุดูู ูู ุงูุฃุดูุงู. </font><font style="vertical-align: inherit;">ุฅูู ุงูููุช ุงูููุงุณุจ ูุฅุถุงูุฉ ุงูุฌุณูุฑ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุจุฏุฃ ุจููุนุจ ุตุบูุฑ ุงูุญุฌู ููุนุจ ุฏูุฑ ุงูุฌุณุฑ ุงูุฌุงูุฒ. </font><font style="vertical-align: inherit;">ูุฎุชูู ุนุฑุถ ุงูุฃููุงุฑ ุ ูููู ููุงู ูุง ููุฑุจ ูู ุณุจุน ูุญุฏุงุช ูุณุงูุฉ ุจูู ูุฑุงูุฒ ุงูุทุฑู ุนูู ููุง ุงูุฌุงูุจูู. </font><font style="vertical-align: inherit;">ูุฐูู ุ ูุนุทููุง ูููุงุณูุง ุชูุฑูุจููุง (3 ุ 1 ุ 7). </font><font style="vertical-align: inherit;">ุฅุถุงูุฉ ุงูููุงุฏ ุงูุญุถุฑูุฉ ุงูุญูุฑุงุก ุงูุฌุงูุฒุฉ ูุงูุชุฎูุต ูู ูุตุงุฏููุง. </font><font style="vertical-align: inherit;">ููุง ูู ุงูุญุงู ูุน ุงูุฃุจุฑุงุฌ ุ ุถุน ุงูููุนุจ ุฏุงุฎู ุงููุงุฆู ุงูุฌุฐุฑ ุจููุณ ุงููููุงุณ. </font><font style="vertical-align: inherit;">ููุชูุฌุฉ ูุฐูู ุ ูู ุชููู ููุฏุณุฉ ุงูุฌุณุฑ ูููุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุถู ุฑุงุจุทูุง ุฅูู ุงูุฌุณุฑ ุงูุฌุงูุฒ </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููู ุจุชุนูููู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform wallTower, bridge;</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/808/ac6/dc5/808ac6dc523d16d2005da48dcf4d1f65.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุณุฑ ุงููุณุจู ุงููุนูู.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุถุน ุงูุฌุณูุฑ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุถุน ุงูุฌุณุฑ ุ ูุญุชุงุฌ ุฅูู ุทุฑููุฉ </font></font><code>HexFeatureManager.AddBridge</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุฌุจ ุฃู ููุน ุงูุฌุณุฑ ุจูู ูุฑูุฒ ุงูููุฑ ูุฃุญุฏ ุฌุงูุจู ุงูููุฑ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddBridge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 roadCenter1, Vector3 roadCenter2</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(bridge); instance.localPosition = (roadCenter1 + roadCenter2) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุณูููู ูุฑุงูุฒ ุงูุทุฑู ุบูุฑ ุงููุดููุฉ ุ ูุฐุง ุณูุชุนูู ุนูููุง ุชุดููููุง ูุจู ูุถุน ุงูุฌุณุฑ. </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> roadCenter1 = HexMetrics.Perturb(roadCenter1); roadCenter2 = HexMetrics.Perturb(roadCenter2); Transform instance = Instantiate(bridge);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุญุงุฐุงุฉ ุงูุฌุณุฑ ุจุดูู ุตุญูุญ ุ ูููููุง ุงุณุชุฎุฏุงู ููุณ ุงูููุฌ ุนูุฏ ุชุฏููุฑ ุงูุฃุจุฑุงุฌ. </font><font style="vertical-align: inherit;">ูู ูุฐู ุงูุญุงูุฉ ุ ุชุญุฏุฏ ูุฑุงูุฒ ุงูุทุฑู ุงููุชุฌู ุงูุฃูุงูู ููุฌุณุฑ. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃููุง ูุง ุฒููุง ุฏุงุฎู ููุณ ุงูุฎููุฉ ุ ูุฅู ูุฐุง ุงููุงูู ุณูููู ุจุงูุชุฃููุฏ ุฃููููุง ุ ูุฐูู ูุง ูุญุชุงุฌ ุฅูู ุตูุฑ ููููู Y.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> Transform instance = Instantiate(bridge); instance.localPosition = (roadCenter1 + roadCenter2) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.forward = roadCenter2 - roadCenter1; instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre> <br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุญู ูุจูู ุงูุฌุณูุฑ ุนุจุฑ ุงูุฃููุงุฑ ุงููุณุชูููุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุชููููุงุช ุงูููุฑูุฉ ุงููุญูุฏุฉ ุงูุชู ุชุชุทูุจ ุงูุฌุณูุฑ ูุณุชูููุฉ ูููุญููุฉ. ูููู ุฃู ุชูุฑ ุงูุทุฑู ุนุจุฑ ููุงุท ุงูููุงูุฉ ุ ูุนูุฏ ุงูุทุฑู ุงููุชุนุฑุฌุฉ ูุง ูููู ุฅุบูุงููุง ุฅูุง. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุจุฏุก ุ ุฏุนูุง ููุชุดู ุฃููุงุฑูุง ูุณุชูููุฉ. ูู ุงูุฏุงุฎู ุ </font><font style="vertical-align: inherit;">ูููู </font></font><code>HexGridChunk.TriangulateRoadAdjacentToRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงููุดุบู ุงูุฃูู </font></font><code>else if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุชุฑุชูุจ ุงูุทุฑู ุจุงููุฑุจ ูู ูุฐู ุงูุฃููุงุฑ. ูุฐูู ุ ุณูุถูู ููุง ุงูุฌุณูุฑ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุญู ุนูู ุฌุงูุจ ูุงุญุฏ ูู ุงูููุฑ. ูุชุญุฑู ูุฑูุฒ ุงูุทุฑูู ูู ุงูููุฑ ุ ุซู ููุชูู ูุฑูุฒ ุงูุฎููุฉ. ููุนุซูุฑ ุนูู ูุฑูุฒ ุงูุทุฑูู ุนูู ุงูุฌุงูุจ ุงูุขุฎุฑ ุ ูุญุชุงุฌ ุฅูู ุชุญุฑูู ุงูุงุชุฌุงู ุงููุนุงูุณ ุจููุณ ุงูููุฏุงุฑ. ูุฌุจ ุงูููุงู ุจุฐูู ูุจู ุชุบููุฑ ุงููุฑูุฒ ููุณู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == cell.OutgoingRiver.Opposite()) { โฆ roadCenter += corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; features.AddBridge(roadCenter, center - corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); center += corner * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } โฆ }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/97c/c7f/420/97cc7f42004ba86c6cd0333af352f24b.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุณูุฑ ููู ุงูุฃููุงุฑ ุงููุณุชูููุฉ. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุธูุฑุช ุงูุฌุณูุฑ! </font><font style="vertical-align: inherit;">ูููู ูุฏููุง ุงูุขู ูุซุงู ูุงุญุฏ ูู ุงูุฌุณูุฑ ููู ุงุชุฌุงู ูุง ููุฑ ููู ุงูููุฑ. </font><font style="vertical-align: inherit;">ูุญุชุงุฌ ุฅูู ุงูุชุฃูุฏ ูู ุฅูุดุงุก ูุซูู ูุงุญุฏ ููุท ูู ุงูุฌุณุฑ ูู ุงูุฎููุฉ. </font><font style="vertical-align: inherit;">ูููู ุงูููุงู ุจุฐูู ุนู ุทุฑูู ุงุฎุชูุงุฑ ุงุชุฌุงู ูุงุญุฏ ุจุงููุณุจุฉ ููููุฑ ูุนูู ุฃุณุงุณู ูุฅูุดุงุก ุฌุณุฑ. </font><font style="vertical-align: inherit;">ููููู ุงุฎุชูุงุฑ ุฃู ุงุชุฌุงู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> roadCenter += corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == direction.Next()) { features.AddBridge(roadCenter, center - corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); } center += corner * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุงูุฉ ุนูู ุฐูู ุ ูุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุฌุณุฑ ููุท ุนูุฏูุง ูููู ููุงู ุทุฑูู ุนูู ุฌุงูุจู ุงูููุฑ. </font><font style="vertical-align: inherit;">ูู ุงูููุช ุงูุญุงูู ุ ูุญู ูุชุฃูุฏูู ุจุงููุนู ูู ูุฌูุฏ ุทุฑูู ุนูู ุงูุฌุงูุจ ุงูุญุงูู. </font><font style="vertical-align: inherit;">ูุฐูู ุ ุชุญุชุงุฌ ุฅูู ุงูุชุญูู ููุง ุฅุฐุง ูุงู ููุงู ุทุฑูู ุนูู ุงูุฌุงูุจ ุงูุขุฎุฑ ูู ุงูููุฑ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IncomingRiver == direction.Next() &amp;&amp; ( cell.HasRoadThroughEdge(direction.Next2()) || cell.HasRoadThroughEdge(direction.Opposite()) )) { features.AddBridge(roadCenter, center - corner * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/635/a47/978/635a4797816f9f35297f67224a0ec449.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฌุณูุฑ ุจูู ุงูุทุฑู ุนูู ุงูุฌุงูุจูู.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุงูุฌุณูุฑ ููู ุงูุฃููุงุฑ ุงูููุญููุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุนูู ุงูุฌุณูุฑ ููู ุงูุฃููุงุฑ ุงูููุญููุฉ ุจุดูู ูุดุงุจู ุ ูููู ุทูุจูููุฌูุชูุง ุชุฎุชูู ููููุงู. </font><font style="vertical-align: inherit;">ุณูุถูู ุฌุณุฑุง ุนูุฏูุง ูููู ุฎุงุฑุฌ ุงูููุญูู. </font><font style="vertical-align: inherit;">ูุญุฏุซ ูุฐุง ูู ุงููุชูุฉ ุงูุฃุฎูุฑุฉ </font></font><code>else</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุณุชุฎุฏู ุงูุงุชุฌุงู ุงูุฃูุณุท ูุชุนููุถ ูุฑูุฒ ุงูุทุฑูู. </font><font style="vertical-align: inherit;">ุณูุญุชุงุฌ ุฅูู ุงุณุชุฎุฏุงู ูุฐุง ุงูุฅุฒุงุญุฉ ูุฑุชูู ุจููุงููุณ ูุฎุชููุฉ ุ ูุฐุง ุงุญูุธู ูู ูุชุบูุฑ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TriangulateRoadAdjacentToRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> HexDirection direction, HexCell cell, Vector3 center, EdgeVertices e </span></span></span><span class="hljs-function">)</span></span> { โฆ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { HexDirection middle; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousHasRiver) { middle = direction.Next(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nextHasRiver) { middle = direction.Previous(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { middle = direction; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !cell.HasRoadThroughEdge(middle) &amp;&amp; !cell.HasRoadThroughEdge(middle.Previous()) &amp;&amp; !cell.HasRoadThroughEdge(middle.Next()) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Vector3 offset = HexMetrics.GetSolidEdgeMiddle(middle); roadCenter += offset * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; } โฆ }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุงุณ ุงูุฅุฒุงุญุฉ ูู ุฎุงุฑุฌ ุงูููุญูู ูู 0.25 ุ ูุฏุงุฎูู </font></font><code>HexMetrics.innerToOuter * 0.7f</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูุณุชุฎุฏูู ููุถุน ุงูุฌุณุฑ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> Vector3 offset = HexMetrics.GetSolidEdgeMiddle(middle); roadCenter += offset * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; features.AddBridge( roadCenter, center - offset * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.7f</span></span>) );</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/612/f9e/da9/612f9eda9f9e4cd31ba20dfe2db7687b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุณูุฑ ููู ุงูุฃููุงุฑ ุงูููุญููุฉ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุง ูุฑุฉ ุฃุฎุฑู ูุญุชุงุฌ ุฅูู ุชุฌูุจ ุงูุฌุณูุฑ ุงูููุฑุฑุฉ. </font><font style="vertical-align: inherit;">ูููููุง ุงูููุงู ุจุฐูู ุนู ุทุฑูู ุฅุถุงูุฉ ุงูุฌุณูุฑ ููุท ูู ุงูุงุชุฌุงู ุงูุฃูุณุท.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> Vector3 offset = HexMetrics.GetSolidEdgeMiddle(middle); roadCenter += offset * <span class="hljs-number"><span class="hljs-number">0.25f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction == middle) { features.AddBridge( roadCenter, center - offset * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.7f</span></span>) ); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ููุฑุฉ ุฃุฎุฑู ุ ุนููู ุงูุชุฃูุฏ ูู ุฃู ุงูุทุฑูู ุนูู ุงูุฌุงูุจ ุงูุขุฎุฑ. </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( direction == middle &amp;&amp; cell.HasRoadThroughEdge(direction.Opposite()) ) { features.AddBridge( roadCenter, center - offset * (HexMetrics.innerToOuter * <span class="hljs-number"><span class="hljs-number">0.7f</span></span>) ); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/744/33c/275/74433c2750e413c44d17139982ecff3b.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฌุณูุฑ ุจูู ุงูุทุฑู ุนูู ุงูุฌุงูุจูู.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุญุฌูู ุงูุฌุณุฑ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃููุง ูููู ุจุชุดููู ุงูุชุถุงุฑูุณ ุ ูุฅู ุงููุณุงูุฉ ุจูู ูุฑุงูุฒ ุงูุทุฑู ูุงูุฌูุงูุจ ุงูููุงุจูุฉ ููููุฑ ุชุฎุชูู. </font><font style="vertical-align: inherit;">ูู ุจุนุถ ุงูุฃุญูุงู ุชููู ุงูุฌุณูุฑ ูุตูุฑุฉ ุฌุฏูุง ูุฃุญูุงููุง ุทูููุฉ ุฌุฏูุง.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/770/f2c/e53/770f2ce537ab16628c799eceb6ca4ad7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฎุชูู ุงููุณุงูุงุช ูููู ุฃุทูุงู ุงูุฌุณุฑ ุซุงุจุชุฉ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูู ุงูุฑุบู ูู ุฃููุง ูููุง ุจุฅูุดุงุก ุฌุณุฑ ุจุทูู ุณุจุน ูุญุฏุงุช ุ ุฅูุง ุฃูู ููููู ุชูุณูุนู ููุชูุงุณุจ ูุน ุงููุณุงูุฉ ุงูุญููููุฉ ุจูู ูุฑุงูุฒ ุงูุทุฑู. </font><font style="vertical-align: inherit;">ูุฐุง ูุนูู ุฃู ูููุฐุฌ ุงูุฌุณุฑ ูุดูู. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุงููุณุงูุงุช ูุง ุชุฎุชูู ูุซูุฑูุง ุ ููุฏ ูููู ุงูุชุดูู ููุจูููุง ุฃูุซุฑ ูู ุงูุฌุณูุฑ ุบูุฑ ุงูููุงุณุจุฉ ููุทูู. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฅุฌุฑุงุก ุงูููุงุณ ุงูููุงุณุจ ูุญุชุงุฌ ุฅูู ูุนุฑูุฉ ุงูุทูู ุงูุฃููู ููุฌุณุฑ ุงูุฌุงูุฒ. </font><font style="vertical-align: inherit;">ุณูููู ุจุชุฎุฒูู ูุฐุง ุงูุทูู ูู </font></font><code>HexMetrics</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> bridgeDesignLength = <span class="hljs-number"><span class="hljs-number">7f</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููููุง ุงูุขู ุชุนููู ุงููููุงุณ ุจุทูู ูุซูู Z ููุฌุณุฑ ุฅูู ุงููุณุงูุฉ ุจูู ูุฑุงูุฒ ุงูุทุฑู ุ ููุณูููุง ุนูู ุงูุทูู ุงูุฃุตูู. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุฌุฐุฑ ุงูุฌุณุฑ ุงูุฌุงูุฒ ูู ููุณ ุงููููุงุณ ุ ูุณูุชูุฏุฏ ุงูุฌุณุฑ ุจุดูู ุตุญูุญ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddBridge</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Vector3 roadCenter1, Vector3 roadCenter2</span></span></span><span class="hljs-function">)</span></span> { roadCenter1 = HexMetrics.Perturb(roadCenter1); roadCenter2 = HexMetrics.Perturb(roadCenter2); Transform instance = Instantiate(bridge); instance.localPosition = (roadCenter1 + roadCenter2) * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; instance.forward = roadCenter2 - roadCenter1; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> length = Vector3.Distance(roadCenter1, roadCenter2); instance.localScale = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3( <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, length * (<span class="hljs-number"><span class="hljs-number">1f</span></span> / HexMetrics.bridgeDesignLength) ); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/21e/b73/49c/21eb7349c5e7ae6d5480b2e61d19e046.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุบููุฑ ุทูู ุงูุฌุณูุฑ. </font></font><br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุจูุงุก ุงูุฌุณุฑ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุฏูุงู ูู ุงูููุนุจ ุงูุจุณูุท ุ ูููููุง ุงุณุชุฎุฏุงู ูููุฐุฌ ุฌุณุฑ ุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู. </font><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู ุ ููููู ุฅูุดุงุก ุฌุณุฑ ูููุณ ุชูุฑูุจู ูุซูุงุซุฉ ููุนุจุงุช ุฐุงุช ุญุฌู ูุชุฏููุฑ. </font><font style="vertical-align: inherit;">ุจุงูุทุจุน ุ ููููู ุฅูุดุงุก ููุงุฐุฌ ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ ุฃูุซุฑ ุชุนููุฏูุง ุ ุจูุง ูู ุฐูู ุฃุฌุฒุงุก ูู ุงูุทุฑูู. </font><font style="vertical-align: inherit;">ููู ูุงุญุธ ุฃู ุงููุงุฆู ุจุฃูููู ุณูุชู ุถุบุทู ูุชูุฏุฏู ููููุงู.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/eee/83f/3b6/eee83f3b67cf879abe3114117614af08.png"></div><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/8a9/741/f7f/8a9741f7f024aa8914e29b12c1ae9d94.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฌุณูุฑ ูููุณุฉ ุฐุงุช ุฃุทูุงู ูุฎุชููุฉ. </font></font></i> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> <br><br><h2 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุงุฆูุงุช ุฎุงุตุฉ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุชู ุงูุขู ุ ูููู ุฃู ุชุญุชูู ุฎูุงูุงูุง ุนูู ุงูุฃุดูุงุก ุงูุญุถุฑูุฉ ูุงูุฑูููุฉ ูุงููุจุงุชูุฉ. ุนูู ุงูุฑุบู ูู ุฃู ูู ูุงุญุฏ ูููู ูุญุชูู ุนูู ุซูุงุซุฉ ูุณุชููุงุช ุ ูุฅู ุฌููุน ุงููุงุฆูุงุช ุตุบูุฑุฉ ุฌุฏูุง ููุงุฑูุฉ ุจุญุฌู ุงูุฎููุฉ. ูุงุฐุง ูู ุงุญุชุฌูุง ุฅูู ูุจูู ูุจูุฑ ูุซู ุงูููุนุฉุ </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฏุนูุง ูุถูู ููุนูุง ุฎุงุตูุง ูู ุงููุงุฆูุงุช ุฅูู ุงูุชุถุงุฑูุณ. ูุฐู ุงูุฃุดูุงุก ูุจูุฑุฉ ุฌุฏูุง ูุฏุฑุฌุฉ ุฃููุง ุชุดุบู ุงูุฎููุฉ ุจุฃููููุง. ูู ูู ูุฐู ุงูุฃุดูุงุก ูู ูุฑูุฏุฉ ูู ููุนูุง ูุชุญุชุงุฌ ุฅูู ุงูุฌุงูุฒุฉ ุงูุฎุงุตุฉ ุจูุง. ุนูู ุณุจูู ุงููุซุงู ุ ูููู ุฅูุดุงุก ููุนุฉ ุจุณูุทุฉ ูู ููุนุจ ูุฑูุฒู ูุงุญุฏ ุจุงูุฅุถุงูุฉ ุฅูู ุฃุฑุจุนุฉ ุฃุจุฑุงุฌ ุฒุงููุฉ. ุงููููุงุณ (6 ุ 4 ุ 6) ููููุนุจ ุงููุฑูุฒู ุณูุฎูู ููููุง ูุจูุฑูุง ุจูุง ููู ุงูููุงูุฉ ุ ูุงูุฐู ูุชูุงุณุจ ูุน ุฐูู ุญุชู ูู ุฎููุฉ ูุดููุฉ ุจุดุฏุฉ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/7e1/9bf/0dc/7e19bf0dc5f1568bf4b21ec467ba9063.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุฌุงูุฒุฉ ุงูููุนุฉ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุฃู ูููู ุงููุงุฆู ุงูุฎุงุต ุงูุขุฎุฑ ุฒููุฑุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูุจููุฉ ูู ุซูุงุซ ููุนุจุงุช ููุถูุนุฉ ููู ุจุนุถูุง ุงูุจุนุถ. </font><font style="vertical-align: inherit;">ุจุงููุณุจุฉ ููููุนุจ ุงูุณููู ุ ุงููููุงุณ (8 ุ 2.5 ุ 8) ููุงุณุจ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/1ad/7d3/291/1ad7d3291224358562b3472f528973a1.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฒููุฑุฉ ุจุฑููุงุจ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููู ุฃู ุชููู ุงูุฃุดูุงุก ุงูุฎุงุตุฉ ุฃู ุ ูููุณ ุจุงูุถุฑูุฑุฉ ูุนูุงุฑูุฉ. </font><font style="vertical-align: inherit;">ุนูู ุณุจูู ุงููุซุงู ุ ูููู ุฃู ุชุดูุฑ ูุฌููุนุฉ ูู ุงูุฃุดุฌุงุฑ ุงูุถุฎูุฉ ุงูุชู ูุตู ุงุฑุชูุงุนูุง ุฅูู ุนุดุฑ ูุญุฏุงุช ุฅูู ุฎููุฉ ูููุฆุฉ ุจุงููุจุงุชุงุช ุงูุถุฎูุฉ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/1bb/e91/907/1bbe91907deba70f6ab9d02cd13de795.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุบุง ูููุฑุง ุงูุฌุงูุฒุฉ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุถู ุฅูู </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุตููู ูุชุชุจุน ูุฐู ุงููุจุงูู ุงูุฌุงูุฒุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform[] special;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฃููุงู ุ ุฃุถู ููุนุฉ ุฅูู ุงูุตููู ุ ุซู ziggurat ุ ุซู megaflora. </font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/bbc/2e3/e94/bbc2e3e949b25efc800a8f2e799490c7.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุฎุตูุต ูุงุฆูุงุช ุฎุงุตุฉ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฌุนู ุงูุฎูุงูุง ุฎุงุตุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู </font></font><code>HexCell</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุทููุจ ููุฑุณ ุงููุงุฆูุงุช ุงูุฎุงุตุฉ ุ ูุงูุฐู ูุญุฏุฏ ููุน ูุงุฆู ุฎุงุต ุ ุฅุฐุง ูุงู ููุงู.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> specialIndex;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุซู ุฃุดูุงุก ุงูุฅุบุงุซุฉ ุงูุฃุฎุฑู ุ ุฏุนููุง ูุนุทููุง ุงููุฏุฑุฉ ุนูู ุชููู ูุชุนููู ูุฐู ุงููููุฉ. </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SpecialIndex { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> specialIndex; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (specialIndex != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { specialIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุดูู ุงูุชุฑุงุถู ุ ูุง ุชุญุชูู ุงูุฎููุฉ ุนูู ูุงุฆู ุฎุงุต. </font><font style="vertical-align: inherit;">ูุดูุฑ ุฅูู ุฐูู ูู ุฎูุงู ุงูููุฑุณ 0. ุฃุถู ุฎุงุตูุฉ ุชุณุชุฎุฏู ูุฐุง ุงูุฃุณููุจ ูุชุญุฏูุฏ ูุง ุฅุฐุง ูุงูุช ุงูุฎููุฉ ุฎุงุตุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsSpecial { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> specialIndex &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุชุญุฑูุฑ ุงูุฎูุงูุง ุ ุฃุถู ุฏุนููุง ูููุฑุณ ุงููุงุฆูุงุช ุงูุฎุงุตุฉ ูู </font></font><code>HexMapEditor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ููู ุชุนูู ุจุดูู ูุดุงุจู ููุณุชููุงุช ุงููุฑุงูู ุงูุญุถุฑูุฉ ูุงูุฑูููุฉ ูุงููุจุงุชูุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> activeUrbanLevel, activeFarmLevel, activePlantLevel, activeSpecialIndex; โฆ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> applyUrbanLevel, applyFarmLevel, applyPlantLevel, applySpecialIndex; โฆ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetApplySpecialIndex</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> toggle</span></span></span><span class="hljs-function">)</span></span> { applySpecialIndex = toggle; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetSpecialIndex</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index</span></span></span><span class="hljs-function">)</span></span> { activeSpecialIndex = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)index; } โฆ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditCell</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyColor) { cell.Color = activeColor; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyElevation) { cell.Elevation = activeElevation; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyWaterLevel) { cell.WaterLevel = activeWaterLevel; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applySpecialIndex) { cell.SpecialIndex = activeSpecialIndex; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (applyUrbanLevel) { cell.UrbanLevel = activeUrbanLevel; } โฆ } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุฃุถู ุดุฑูุท ุชูุฑูุฑ ุฅูู ูุงุฌูุฉ ุงููุณุชุฎุฏู ููุชุญูู ูู ุงููุงุฆู ุงูุฎุงุต. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ูุฏููุง ุซูุงุซุฉ ูุงุฆูุงุช ุ ูุฅููุง ูุณุชุฎุฏู ุงููุงุตู ุงูุฒููู 0-3 ูู ุดุฑูุท ุงูุชูุฑูุฑ. </font><font style="vertical-align: inherit;">ุงูุตูุฑ ูุนูู ุนุฏู ูุฌูุฏ ุดูุก ุ ูุงุญุฏ - ููุนุฉ ุ ูุงุซูุงู - ุฒููุฑุฉ ุ ูุซูุงุซ ููุฌุงูููุฑุง.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/ab4/2ea/9bf/ab42ea9bf68565a294f4ded5d2d7ebf0.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุฒูู ูููุงุฆูุงุช ุงูุฎุงุตุฉ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฅุถุงูุฉ ูุงุฆูุงุช ุฎุงุตุฉ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ูููููุง ุชุนููู ูุงุฆูุงุช ุฎุงุตุฉ ููุฎูุงูุง. </font><font style="vertical-align: inherit;">ููู ุชุธูุฑ ุ ูุญุชุงุฌ ุฅูู ุฅุถุงูุฉ </font></font><code>HexFeatureManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุทุฑููุฉ ุฃุฎุฑู. </font><font style="vertical-align: inherit;">ูููู ุจุจุณุงุทุฉ ุจุฅูุดุงุก ูุซูู ูููุงุฆู ุงูุฎุงุต ุงููุทููุจ ููุถุนู ูู ุงูููุถุน ุงููุทููุจ. </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ุงูุตูุฑ ูุดูุฑ ุฅูู ุนุฏู ูุฌูุฏ ูุงุฆู ุ ูุฌุจ ุฃู ูุทุฑุญ ุงููุญุฏุฉ ูู ููุฑุณ ุงููุงุฆูุงุช ุงูุฎุงุตุฉ ุจุงูุฎููุฉ ูุจู ุงููุตูู ุฅูู ูุฌููุนุฉ ูู ุงููุจุงูู ุงูุฌุงูุฒุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddSpecialFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(special[cell.SpecialIndex - <span class="hljs-number"><span class="hljs-number">1</span></span>]); instance.localPosition = HexMetrics.Perturb(position); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุฏุนููุง ูุนุทู ุงููุงุฆู ุฏูุฑุงููุง ุชุนุณูููุง ุจุงุณุชุฎุฏุงู ุฌุฏูู ุงูุชุฌุฒุฆุฉ. </font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddSpecialFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { Transform instance = Instantiate(special[cell.SpecialIndex - <span class="hljs-number"><span class="hljs-number">1</span></span>]); instance.localPosition = HexMetrics.Perturb(position); HexHash hash = HexMetrics.SampleHashGrid(position); instance.localRotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">360f</span></span> * hash.e, <span class="hljs-number"><span class="hljs-number">0f</span></span>); instance.SetParent(container, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุนูุฏ ุชุซููุซ ุฎููุฉ ุ </font></font><code>HexGridChunk.Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูุชุญูู ููุง ุฅุฐุง ูุงูุช ุงูุฎููุฉ ุชุญุชูู ุนูู ูุงุฆู ุฎุงุต. </font><font style="vertical-align: inherit;">ุฅุฐุง ูุงู ุงูุฃูุฑ ูุฐูู ุ ูุฅููุง ูุณูู ุทุฑููุชูุง ุงูุฌุฏูุฏุฉ ุ ุชูุงููุง ูุซู </font></font><code>AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { Triangulate(d, cell); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell, cell.Position); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsSpecial) { features.AddSpecialFeature(cell, cell.Position); } }</code> </pre> <br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b69/242/657/b692426576e292bbdc9ed0752624db51.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฆูุงุช ุฎุงุตุฉ. </font><font style="vertical-align: inherit;">ูู ุฃูุจุฑ ุจูุซูุฑ ูู ุงููุนุชุงุฏ.</font></font></i> <br><br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุฌูุจ ุงูุฃููุงุฑ </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุธุฑูุง ููุฌูุฏ ุฃุฌุณุงู ุฎุงุตุฉ ูู ูุณุท ุงูุฎูุงูุง ุ ูุฅููุง ูุง ุชุชุญุฏ ูุน ุงูุฃููุงุฑ ุ ูุฃููุง ุณุชุนูู ููููุง. </font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/a51/92f/cc2/a5192fcc2c5718f33bafc631f60a07a8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฆูุงุช ุนูู ุงูุฃููุงุฑ. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูููุน ุฅูุดุงุก ูุงุฆูุงุช ุฎุงุตุฉ ููู ุงูุฃููุงุฑ ุ ูููู ุจุชุบููุฑ ุงูุฎุงุตูุฉ </font></font><code>HexCell.SpecialIndex</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">ูู ูุบูุฑ ุงูููุฑุณ ุฅูุง ูู ุญุงูุฉ ุนุฏู ูุฌูุฏ ุฃููุงุฑ ูู ุงูุฎููุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SpecialIndex { โฆ <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (specialIndex != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &amp;&amp; !HasRiver) { specialIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RefreshSelfOnly(); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุนูุฏ ุฅุถุงูุฉ ููุฑ ุ ุณูุญุชุงุฌ ุฅูู ุงูุชุฎูุต ูู ุฌููุน ุงููุงุฆูุงุช ุงูุฎุงุตุฉ. </font><font style="vertical-align: inherit;">ูุฌุจ ุฃู ูุบุณููุง ุงูููุฑ. </font><font style="vertical-align: inherit;">ูููู ุงูููุงู ุจุฐูู ุนู ุทุฑูู </font></font><code>HexCell.SetOutgoingRiver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุชุนููู ููุฑุณ ุงููุงุฆูุงุช ุงูุฎุงุตุฉ ุฅูู 0 </font><font style="vertical-align: inherit;">ูู ุงูุทุฑููุฉ </font><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetOutgoingRiver</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { โฆ hasOutgoingRiver = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; outgoingRiver = direction; specialIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; neighbor.RemoveIncomingRiver(); neighbor.hasIncomingRiver = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; neighbor.incomingRiver = direction.Opposite(); neighbor.specialIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; SetRoad((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre> <br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ูุชุฌูุจ ุงูุทุฑู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุซู ุงูุฃููุงุฑ ุ ุชุณูุฑ ุงูุทุฑู ุจุดูู ุณูุก ูุน ุงูุฃุดูุงุก ุงูุฎุงุตุฉ ุ ูููู ููุณ ูู ุดูุก ูุธูุนูุง. </font><font style="vertical-align: inherit;">ููููู ุญุชู ูุบุงุฏุฑุฉ ุงูุทุฑู ููุง ูู. </font><font style="vertical-align: inherit;">ูุฏ ุชููู ุจุนุถ ุงููุฑุงูู ูุชูุงููุฉ ูุน ุงูุทุฑู ุ ูู ุญูู ุฃู ุงูุจุนุถ ุงูุขุฎุฑ ูุฏ ูุง ูููู ูุฐูู. </font><font style="vertical-align: inherit;">ูุฐูู ุ ููููู ุฌุนููุง ุชุนุชูุฏ ุนูู ุงููุงุฆู. </font><font style="vertical-align: inherit;">ููููุง ุณูุฌุนู ุงูุฃูุฑ ุฃุณูู.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/b3b/ebf/939/b3bebf9399ed016e8d79a4c1ee53ace8.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฆูุงุช ุนูู ุงูุทุฑูู. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุฐู ุงูุญุงูุฉ ุ ุฏุน ุงูุฃุดูุงุก ุงูุฎุงุตุฉ ุชูุฒู ุงูุทุฑูู. </font><font style="vertical-align: inherit;">ูุฐูู ุ ุนูุฏ ุชุบููุฑ ููุฑุณ ุงููุงุฆูุงุช ุงูุฎุงุตุฉ ุ ุณูููู ุฃูุถูุง ุจุฅุฒุงูุฉ ุฌููุน ุงูุทุฑู ูู ุงูุฎููุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SpecialIndex { โฆ <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (specialIndex != <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &amp;&amp; !HasRiver) { specialIndex = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; RemoveRoads(); RefreshSelfOnly(); } } }</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฐุง ูู ูููุง ุจุญุฐู ูุงุฆู ูุนููุ</font></font></b> <div class="spoiler_text" style=";text-align:right;direction:rtl">      0,   ,       .            . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุฐุง ูุนูู ุฃูู ุนูุฏ ุฅุถุงูุฉ ุงูุทุฑู ุ ุณูุชุนูู ุนูููุง ุฅุฌุฑุงุก ุนูููุงุช ูุญุต ุฅุถุงููุฉ. </font><font style="vertical-align: inherit;">ุณูุถูู ุงูุทุฑู ููุท ุนูุฏูุง ูุง ุชููู ุฃู ุฎููุฉ ุฎููุฉ ุฐุงุช ูุงุฆู ุฎุงุต.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddRoad</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexDirection direction</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !roads[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction] &amp;&amp; !HasRiverThroughEdge(direction) &amp;&amp; !IsSpecial &amp;&amp; !GetNeighbor(direction).IsSpecial &amp;&amp; GetElevationDifference(direction) &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ) { SetRoad((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)direction, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } }</code> </pre> <br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุฌูุจ ุงูุฃุดูุงุก ุงูุฃุฎุฑู </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุง ูููู ุฎูุท ุงููุงุฆูุงุช ุงูุฎุงุตุฉ ูุน ุฃููุงุน ุฃุฎุฑู ูู ุงููุงุฆูุงุช. </font><font style="vertical-align: inherit;">ุฅุฐุง ุชุฏุงุฎูุช ุ ูุณุชุจุฏู ุบูุฑ ูุฑุชุจุฉ. </font><font style="vertical-align: inherit;">ูุฏ ูุนุชูุฏ ุฃูุถูุง ุนูู ูุงุฆู ูุนูู ุ ูููููุง ุณูุณุชุฎุฏู ููุณ ุงูููุฌ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/03b/7f1/8fc/03b7f18fc9f9d7543bdb0d9c24a074e2.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฆู ูุชูุงุทุน ูุน ูุงุฆูุงุช ุฃุฎุฑู. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู ูุฐู ุงูุญุงูุฉ ุ ุณูููุน ุงูุฃุดูุงุก ุงูุตุบูุฑุฉ ุ ููุง ูู ูุงูุช ุชุญุช ุงููุงุก. </font><font style="vertical-align: inherit;">ูุฐู ุงููุฑุฉ ุณูู ูุชุญูู </font></font><code>HexFeatureManager.AddFeature</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddFeature</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell, Vector3 position</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsSpecial) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } โฆ }</code> </pre> <br><h3 style=";text-align:right;direction:rtl"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ุชุฌูุจ ุงููุงุก </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุฏููุง ุฃูุถูุง ูุดููุฉ ูู ุงููุงุก. </font><font style="vertical-align: inherit;">ูู ุณุชุณุชูุฑ ุงูููุฒุงุช ุงูุฎุงุตุฉ ุฃุซูุงุก ุงูููุถุงูุงุชุ </font><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃููุง ูุฏูุฑ ุงูุฃุดูุงุก ุงูุตุบูุฑุฉ ูู ุงูุฎูุงูุง ุงููุบููุฑุฉ ุ ููููุนู ุงูุดูุก ููุณู ูุน ุงููุงุฆูุงุช ุงูุฎุงุตุฉ.</font></font><br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/getpro/habr/post_images/8d9/479/e79/8d9479e79cb0555c81f562dc32937552.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุงุฆูุงุช ูู ุงููุงุก. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูู </font></font><code>HexGridChunk.Triangulate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุณูููู ุจููุณ ูุญุต ุงูููุถุงู ููู ูู ุงููุงุฆูุงุช ุงูุฎุงุตุฉ ูุงูุนุงุฏูุฉ.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { Triangulate(d, cell); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; !cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell, cell.Position); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater &amp;&amp; cell.IsSpecial) { features.AddSpecialFeature(cell, cell.Position); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ูุธุฑูุง ูุฃู ููุง ุงููุดุบููู ูุชุญููุงู </font></font><code>if</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุงูุขู ููุง ุฅุฐุง ูุงูุช ุงูุฎููุฉ ุชุญุช ุงููุงุก ุ ููููููุง ููู ุงูุงุฎุชุจุงุฑ ูุฅุฌุฑุงุกู ูุฑุฉ ูุงุญุฏุฉ ููุท.</font></font><br><br><pre style=";text-align:right;direction:rtl"> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Triangulate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HexCell cell</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (HexDirection d = HexDirection.NE; d &lt;= HexDirection.NW; d++) { Triangulate(d, cell); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.IsUnderwater) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cell.HasRiver &amp;&amp; !cell.HasRoads) { features.AddFeature(cell, cell.Position); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cell.IsSpecial) { features.AddSpecialFeature(cell, cell.Position); } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ููุชุฌุงุฑุจ ุ ุณูููู ูุซู ูุฐุง ุงูุนุฏุฏ ูู ุงูุฃุดูุงุก ูุงููุงู ุจุงููุณุจุฉ ููุง. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ุญุฒูุฉ ุงููุญุฏุฉ</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar425463/">https://habr.com/ru/post/ar425463/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar425449/index.html">ุชุญุฏูุซ ููุฌ ุงูุฅุนูุงู ุงูุณูุงูู: Yandex.Direct Turbo Pages</a></li>
<li><a href="../ar425453/index.html">ูู Space Invaders ุฅูู Half Life 2: The Story of Game Dzdoks</a></li>
<li><a href="../ar425457/index.html">ุนุดุฑูู ุงูุฃูุบุงุฒ (ูู ุงูููุฏุณุฉ ุงููุฌูููุฉ ูุงููุฐููุฉ)</a></li>
<li><a href="../ar425459/index.html">ุชุคุฏู ุงูุชุฑููุฉ ุฅูู Windows 1809 (ุฃุญูุงููุง) ุฅูู ุชุฏููุฑ ูู ุงููููุงุช ูู ููู ุชุนุฑูู</a></li>
<li><a href="../ar425461/index.html">Devops and Security: ููุงุจูุงุช ูุน ุณูุซ ูุงุฑุบู ูููุฒ ุฑุงูุณ</a></li>
<li><a href="../ar425465/index.html">ููู ูููู ูููุตูู ุฃู ููุณุจ ุฃูุซุฑ ุ ุฃุฏุงุฉ ูุซุงููุฉ ููุนูู ูุงูุจุญุซ ุนู ุงูุฃููุงุฑ</a></li>
<li><a href="../ar425467/index.html">ูุญุฑูุงุช ุฑููู D4F> B4D (ุงููููุจ SCe). ุชุบููุฑ ุงูุฃุฌูุงู. ูุธุฑุฉ ุณุงุฆู</a></li>
<li><a href="../ar425469/index.html">ูู ูุนุฏ ูุคูู Python ูููุฏ ุงูุชุทููุฑ. ูู ุณุชุฌุนู ุงููุบุฉ ุฃูุถู ุฃู ุฃุณูุฃุ</a></li>
<li><a href="../ar425471/index.html">ุงูุนูู ูุน ุงูุตูุฑ ูู Python</a></li>
<li><a href="../ar425473/index.html">ูุคุชูุฑ ุนู ุจุงูุซูู ูุนู ุงูุงุชุตุงู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>