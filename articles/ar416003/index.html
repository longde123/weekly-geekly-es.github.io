<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤵 🔇 💅 تقديم ملف HTML: فصل من كتاب ReactPHP للمبتدئين من Skyeng 🤙🏽 🍴 🎬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="يواصل سيرجي جوك مطور تطبيقات الجوال في Skyeng كتابة كتب جيدة. هذه المرة أصدر كتابًا باللغة الروسية لجمهور يتقن PHP. طلبت من Sergey مشاركة فصل مفيد من ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>تقديم ملف HTML: فصل من كتاب ReactPHP للمبتدئين من Skyeng</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/skyeng/blog/416003/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/6v/oi/xx/6voixx5vd9au0asabvgmnckfj90.png"></p><br><p style=";text-align:right;direction:rtl">  يواصل سيرجي جوك مطور تطبيقات الجوال في Skyeng كتابة كتب جيدة.  هذه المرة أصدر كتابًا باللغة الروسية لجمهور يتقن PHP.  طلبت من Sergey مشاركة فصل مفيد من الاكتفاء الذاتي من كتابه ، وإعطاء قراء Habra رمز خصم.  يوجد أدناه كلاهما. </p><a name="habracut"></a><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">أولاً ، دعنا نخبرك بما توقفنا في الفصول السابقة.</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> لقد كتبنا خادم HTTP البسيط في PHP.  لدينا ملف <code>index.php</code> الرئيسي - البرنامج النصي الذي يبدأ الخادم.  إليك رمز المستوى الأعلى: نقوم بإنشاء حلقة حدث ، وتكوين سلوك خادم HTTP وبدء الحلقة: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">React</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Server</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">ServerRequestInterface</span></span>; $loop = React\EventLoop\Factory::create(); $router = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Router(); $router-&gt;load(<span class="hljs-string"><span class="hljs-string">'routes.php'</span></span>); $server = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Server( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ServerRequestInterface $request)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($router)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $router($request); } ); $socket = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> React\Socket\Server(<span class="hljs-number"><span class="hljs-number">8080</span></span>, $loop); $server-&gt;listen($socket); $loop-&gt;run();</code> </pre> <br><p style=";text-align:right;direction:rtl">  لتوجيه الطلبات ، يستخدم الخادم جهاز توجيه: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// src/Router.php use Psr\Http\Message\ServerRequestInterface; use React\Http\Response; class Router { private $routes = []; public function __invoke(ServerRequestInterface $request) { $path = $request-&gt;getUri()-&gt;getPath(); echo "Request for: $path\n"; $handler = $this-&gt;routes[$path] ?? $this-&gt;notFound($path); return $handler($request); } public function load($filename) { $routes = require $filename; foreach ($routes as $path =&gt; $handler) { $this-&gt;add($path, $handler); } } public function add($path, callable $handler) { $this-&gt;routes[$path] = $handler; } private function notFound($path) { return function () use ($path) { return new Response( 404, ['Content-Type' =&gt; 'text/html; charset=UTF-8'], "No request handler found for $path" ); }; } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  يتم تحميل المسارات من ملف <code>routes.php</code> إلى <code>routes.php</code> .  تم الآن الإعلان عن مسارين فقط هنا: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">React</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Response</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">ServerRequestInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'/'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ServerRequestInterface $request)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response( <span class="hljs-number"><span class="hljs-number">200</span></span>, [<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>], <span class="hljs-string"><span class="hljs-string">'Main page'</span></span> ); }, <span class="hljs-string"><span class="hljs-string">'/upload'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ServerRequestInterface $request)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response( <span class="hljs-number"><span class="hljs-number">200</span></span>, [<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>], <span class="hljs-string"><span class="hljs-string">'Upload page'</span></span> ); }, ];</code> </pre> <br><p style=";text-align:right;direction:rtl">  حتى الآن ، كل شيء بسيط ، ويتوافق تطبيقنا غير المتزامن مع عدة ملفات. </p></div></div><br><p style=";text-align:right;direction:rtl">  ننتقل إلى أشياء أكثر "مفيدة".  إجابات بضع كلمات من نص عادي تعلمنا استخلاصه في الفصول السابقة لا تبدو جذابة للغاية.  نحتاج إلى إعادة شيء حقيقي ، مثل صفحة HTML. </p><br><p style=";text-align:right;direction:rtl">  لذا ، أين نضع هذا HTML؟  بالطبع ، يمكنك ترميز محتويات صفحة الويب مباشرة داخل ملف المسارات مباشرة: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// routes.php return [ '/' =&gt; function (ServerRequestInterface $request) { $html = &lt;&lt;&lt;HTML &lt;!DOCTYPE html&gt; &lt;html lang=”en”&gt; &lt;head&gt; &lt;meta charset=”UTF-8”&gt; &lt;title&gt;ReactPHP App&lt;/title&gt; &lt;/head&gt; &lt;body&gt; Hello, world &lt;/body&gt; &lt;/html&gt; HTML; return new Response( 200, ['Content-Type' =&gt; 'text/html'], $html ); }, '/upload' =&gt; function (ServerRequestInterface $request) { return new Response( 200, ['Content-Type' =&gt; 'text/plain'], 'Upload page' ); }, ];</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  لكن لا تفعل ذلك!  لا يمكنك مزج منطق الأعمال (التوجيه) مع العرض التقديمي (صفحة HTML).  لماذا؟  تخيل أنك بحاجة إلى تغيير شيء ما في رمز HTML ، على سبيل المثال ، لون الزر.  وأي ملف يجب تغييره؟  الملف مع <code>router.php</code> ؟  تبدو غريبة ، أليس كذلك؟  قم بإجراء تغييرات على التوجيه لتغيير لون الزر ... </p><br><p style=";text-align:right;direction:rtl">  لذلك ، سنترك المسارات وحدها ، وبالنسبة لصفحات HTML ، سننشئ دليلًا منفصلاً.  في جذر المشروع ، أضف دليلًا جديدًا يسمى الصفحات.  ثم ننشئ داخله ملف <code>index.html</code> .  ستكون هذه صفحتنا الرئيسية.  هنا محتوياته: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs">&lt;!DOCTYPE html&gt; &lt;html lang=<span class="hljs-string"><span class="hljs-string">"en"</span></span>&gt; &lt;head&gt; &lt;meta charset=<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>&gt; &lt;title&gt;ReactPHP App&lt;/title&gt; &lt;link rel=<span class="hljs-string"><span class="hljs-string">"stylesheet"</span></span> href=<span class="hljs-string"><span class="hljs-string">"https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"</span></span> &gt; &lt;/head&gt; &lt;body&gt; &lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">container</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">row</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">action</span></span></span><span class="hljs-class">="/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">upload</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">POST</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">justify</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">content</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">center</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">group</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">label</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">"&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Text</span></span></span><span class="hljs-class">&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">label</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">textarea</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">control</span></span></span><span class="hljs-class">"&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">submit</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">btn</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">btn</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">primary</span></span></span><span class="hljs-class">"&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Submit</span></span></span><span class="hljs-class">&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">body</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">html</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  الصفحة بسيطة للغاية ، وتحتوي على عنصر واحد فقط - النموذج.  يحتوي النموذج بداخله مربع نص وزر للإرسال.  أضفت أيضًا أنماط Bootstrap لجعل صفحتنا تبدو أجمل. </p><br><h4 id="chtenie-faylov-kak-ne-nado-delat" style=";text-align:right;direction:rtl">  قراءة الملفات.  كيف لا تفعل </h4><br><p style=";text-align:right;direction:rtl">  إن الطريقة الأكثر وضوحًا هي قراءة محتويات الملف داخل معالج الطلبات وإرجاع هذا المحتوى كنص استجابة.  شيء من هذا القبيل: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// routes.php return [ '/' =&gt; function (ServerRequestInterface $request) { return new Response( 200, ['Content-Type' =&gt; 'text/html'], file_get_contents('pages/index.html') ); }, // ... ];</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  وبالمناسبة ، ستعمل.  يمكنك تجربتها بنفسك: أعد تشغيل الخادم وأعد تحميل الصفحة <code>http://127.0.0.1:8080/</code> في متصفحك. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/zq/dc/91/zqdc91cvy7a971jkniyw8hpxgzi.png"></p><br><p style=";text-align:right;direction:rtl">  إذن ما هو الخطأ هنا؟  ولماذا لا تفعل ذلك؟  باختصار ، لأنه ستكون هناك مشاكل إذا بدأ نظام الملفات في التباطؤ. </p><br><h4 id="blokiruyuschie-i-neblokiruyuschie-vyzovy" style=";text-align:right;direction:rtl">  حظر المكالمات وعدم حظرها </h4><br><p style=";text-align:right;direction:rtl">  دعني أوضح لك ما أعنيه من خلال "حظر" المكالمات ، وما الذي يمكن أن يحدث عندما يحتوي أحد معالجات الطلب على رمز الحظر.  قبل إعادة كائن الاستجابة ، أضف مكالمة إلى وظيفة <code>sleep()</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// routes.php return [ '/' =&gt; function (ServerRequestInterface $request) { sleep(10); return new Response( 200, ['Content-Type' =&gt; 'text/html'], file_get_contents('pages/index.html') ); }, '/upload' =&gt; function (ServerRequestInterface $request) { return new Response( 200, ['Content-Type' =&gt; 'text/plain'], 'Upload page' ); }, ];</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  سيؤدي ذلك إلى تجميد معالج الطلب لمدة 10 ثوانٍ قبل أن يتمكن من إرجاع استجابة بمحتويات صفحة HTML.  يرجى ملاحظة أننا لم نلمس معالج العنوان <code>/upload</code> .  من خلال استدعاء وظيفة <code>sleep(10)</code> ، أقوم بمحاكاة تنفيذ نوع من عملية الحظر. </p><br><p style=";text-align:right;direction:rtl">  إذن ماذا لدينا؟  عندما يطلب المستعرض الصفحة <code>/</code> ، ينتظر المعالج 10 ثوانٍ ثم يعيد صفحة HTML.  عندما نفتح <code>/upload</code> العنوان ، يجب أن يقوم معالجه بإرجاع استجابة على الفور مع السلسلة "صفحة التحميل". </p><br><p style=";text-align:right;direction:rtl">  الآن دعونا نرى ما يحدث في الواقع.  كما هو الحال دائمًا ، نعيد تشغيل الخادم.  الآن ، يرجى فتح نافذة أخرى في متصفحك.  في شريط العنوان ، أدخل <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http://127.0.0.1:8080/upload</a> ، ولكن لا تفتح هذه الصفحة على الفور.  فقط اترك هذا العنوان في شريط العناوين في الوقت الحالي.  ثم انتقل إلى نافذة المتصفح الأولى وافتح الصفحة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http://127.0.0.1:8080/</a> فيه.  أثناء تحميل هذه الصفحة (تذكر أن الأمر سيستغرق 10 ثوانٍ للقيام بذلك) ، انتقل بسرعة إلى النافذة الثانية واضغط على "Enter" لتحميل العنوان الذي تم تركه في شريط العناوين ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">http://127.0.0.1:8080/upload</a> ) . </p><br><p style=";text-align:right;direction:rtl">  على ماذا حصلنا؟  نعم ، يستغرق العنوان / كما هو متوقع 10 ثوانٍ للتحميل.  ولكن ، من المدهش ، أن الصفحة الثانية استغرقت نفس الوقت للتحميل ، على الرغم من أننا لم نضيف أي مكالمات <code>sleep()</code> إليها.  أي فكرة لماذا حدث هذا؟ </p><br><p style=";text-align:right;direction:rtl">  ReactPHP يعمل في خيط واحد.  قد يبدو أنه في تطبيق غير متزامن ، يتم تنفيذ المهام بالتوازي ، ولكن هذا ليس كذلك في الواقع.  يتم إنشاء وهم التوازي من خلال دورة من الأحداث التي تنتقل باستمرار بين المهام المختلفة وتؤديها.  ولكن في وقت معين ، يتم دائمًا تنفيذ مهمة واحدة فقط.  هذا يعني أنه إذا استغرقت إحدى هذه المهام وقتًا طويلاً ، فستحجب حلقة الأحداث ، التي لن تتمكن من تسجيل الأحداث الجديدة واستدعاء معالجاتها.  وهذا يؤدي في النهاية إلى "تجميد" التطبيق بأكمله ، سيفقد ببساطة عدم التزامن. </p><br><p style=";text-align:right;direction:rtl">  حسنًا ، ولكن ما علاقة ذلك بالاتصال <code>file_get_contents('pages/index.h')</code> ؟  المشكلة هنا هي أننا ندخل إلى نظام الملفات مباشرة.  بالمقارنة مع العمليات الأخرى ، مثل العمل مع الذاكرة أو الحوسبة ، يمكن أن يكون العمل مع نظام الملفات بطيئًا للغاية.  على سبيل المثال ، إذا تبين أن الملف كبير جدًا ، أو إذا كان القرص بطيئًا ، فقد تستغرق قراءة الملف بعض الوقت ، ونتيجة لذلك ، حظر حلقة الحدث. </p><br><p style=";text-align:right;direction:rtl">  في النموذج المتزامن القياسي ، لا تعد استجابة الطلب مشكلة.  إذا طلب العميل ملفًا ثقيلًا للغاية ، فسوف ينتظر حتى يتم تنزيل هذا الملف.  لا يؤثر مثل هذا الطلب الثقيل على العملاء الآخرين.  لكن في حالتنا ، نحن نتعامل مع نموذج غير متزامن موجه نحو الحدث.  لقد أطلقنا خادم HTTP الذي يجب أن يعالج الطلبات الواردة باستمرار.  إذا استغرق طلب واحد الكثير من الوقت لإكماله ، فسيؤثر ذلك على جميع عملاء الخادم الآخرين. </p><br><p style=";text-align:right;direction:rtl">  كقاعدة ، تذكر: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  لا يمكنك أبدا منع حلقة الحدث. </li></ul><br><p style=";text-align:right;direction:rtl">  لذا ، كيف نقرأ الملف بعد ذلك بشكل غير متزامن؟  وهنا نصل إلى القاعدة الثانية: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  عندما لا يمكن تجنب عملية الحظر ، يجب أن تكون متشعبة في العملية الفرعية وتستمر في التنفيذ غير المتزامن في الخيط الرئيسي. </li></ul><br><p style=";text-align:right;direction:rtl">  لذا ، بعد أن تعلمنا كيفية عدم القيام بذلك ، دعنا نناقش الحل الصحيح غير المحظور. </p><br><h4 id="docherniy-process" style=";text-align:right;direction:rtl">  عملية الطفل </h4><br><p style=";text-align:right;direction:rtl">  يجب إجراء جميع الاتصالات بنظام الملفات في تطبيق غير متزامن في العمليات الفرعية.  لإدارة العمليات الفرعية في تطبيق ReactPHP ، نحتاج إلى تثبيت مكون آخر <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">"عملية</a> تابعة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">"</a> .  يتيح لك هذا المكون الوصول إلى وظائف نظام التشغيل لتشغيل أي أمر نظام داخل العملية التابعة.  لتثبيت هذا المكون ، افتح محطة طرفية في جذر المشروع وقم بتشغيل الأمر التالي: </p><br><p style=";text-align:right;direction:rtl"> <code>composer require react/child-process</code> </p> <br><h4 id="sovmestimost-s-windows" style=";text-align:right;direction:rtl">  <em>التوافق مع Windows</em> </h4><br><p style=";text-align:right;direction:rtl">  <em>في نظام تشغيل Windows ، يتم حظر سلاسل عمليات STDIN و STDOUT و STDERR ، مما يعني أن مكون العملية الفرعية لن يكون قادرًا على العمل بشكل صحيح.</em>  <em>لذلك ، تم تصميم هذا المكون بشكل أساسي للعمل فقط على أنظمة nix.</em>  <em>إذا حاولت إنشاء كائن من فئة العملية على نظام Windows ، فسيتم طرح استثناء.</em>  <em>لكن المكون يمكن أن يعمل تحت <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">نظام Windows الفرعي لنظام Linux (WSL)</a> .</em>  <em>إذا كنت تنوي استخدام هذا المكون ضمن Windows ، فستحتاج إلى تثبيت WSL.</em> </p><br><p style=";text-align:right;direction:rtl">  الآن يمكننا تنفيذ أي أمر shell داخل العملية التابعة.  افتح ملف <code>routes.php</code> ، ثم دعنا نغير معالج المسار.  أنشئ كائنًا من فئة <code>React\ChildProcess\Process</code> ، <code>React\ChildProcess\Process</code> ، مرر <code>ls</code> إليه للحصول على محتويات الدليل الحالي: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// routes.php use Psr\Http\Message\ServerRequestInterface; use React\ChildProcess\Process; use React\Http\Response; return [ '/' =&gt; function (ServerRequestInterface $request) { $childProcess = new Process('ls'); return new Response( 200, ['Content-Type' =&gt; 'text/html'], file_get_contents('pages/index.html') ); }, // ... ];</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ثم نحتاج إلى بدء العملية عن طريق استدعاء طريقة <code>start()</code> .  الصيد هو أن الأسلوب <code>start()</code> يحتاج إلى كائن حلقة حدث.  ولكن في ملف <code>routes.php</code> ليس لدينا هذا الكائن.  كيف نمرر حلقة الحدث من <code>index.php</code> إلى المسارات مباشرة إلى معالج الطلب؟  الحل لهذه المشكلة هو "حقن التبعية". </p><br><h4 id="inekciya-zavisimostey" style=";text-align:right;direction:rtl">  حقن التبعية </h4><br><p style=";text-align:right;direction:rtl">  لذا ، يحتاج أحد مساراتنا إلى حلقة حدث للعمل.  في تطبيقنا ، يعرف مكون واحد فقط عن وجود مسارات - فئة <code>Router</code> .  اتضح أنه من مسؤوليته توفير حلقة حدث للطرق.  بمعنى آخر ، يحتاج جهاز التوجيه إلى حلقة حدث ، أو يعتمد على حلقة الحدث.  كيف نعبر بوضوح عن هذا التبعية في الكود؟  كيف تجعل من المستحيل حتى إنشاء موجه بدون تمرير حلقة حدث إليه؟  بالطبع ، من خلال مُنشئ فئة <code>Router</code> .  افتح <code>Router.php</code> وأضف المُنشئ إلى فئة <code>Router</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Psr</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">ServerRequestInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">React</span></span>\<span class="hljs-title"><span class="hljs-title">EventLoop</span></span>\<span class="hljs-title"><span class="hljs-title">LoopInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">React</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Response</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Router</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $routes = []; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> LoopInterface */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $loop; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LoopInterface $loop)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loop = $loop; } <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  داخل المُنشئ ، احفظ حلقة الحدث التي تم تمريرها في الخاصية <code>$loop</code> الخاصة.  هذا هو حقن التبعية عندما نوفر للفصل الأشياء التي يحتاجها للعمل في الخارج. </p><br><p style=";text-align:right;direction:rtl">  الآن بعد أن أصبح لدينا هذا المنشئ الجديد ، نحتاج إلى تحديث إنشاء جهاز التوجيه.  افتح ملف <code>index.php</code> وقم بتصحيح الخط الذي ننشئ فيه كائن فئة <code>Router</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// index.php $loop = React\EventLoop\Factory::create(); $router = new Router($loop); $router-&gt;load('routes.php');</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  تم.  ارجع إلى <code>routes.php</code> .  كما توقعت بالفعل ، يمكننا هنا استخدام نفس الفكرة مع <strong>حقن التبعية</strong> وإضافة حلقة حدث كمعلمة ثانية لمعالجات الاستعلام الخاصة بنا.  قم بتغيير رد الاتصال الأول وإضافة الوسيطة الثانية: كائن يقوم بتطبيق <code>LoopInterface</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// routes.php use Psr\Http\Message\ServerRequestInterface; use React\EventLoop\LoopInterface; use React\ChildProcess\Process; use React\Http\Response; return [ '/' =&gt; function (ServerRequestInterface $request, LoopInterface $loop) { $childProcess = new Process('ls'); $childProcess-&gt;start($loop); return new Response( 200, ['Content-Type' =&gt; 'text/html'], file_get_contents('pages/index.html') ); }, '/upload' =&gt; function (ServerRequestInterface $request) { return new Response( 200, ['Content-Type' =&gt; 'text/plain'], 'Upload page' ); }, ];</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  بعد ذلك ، نحتاج إلى تمرير حلقة الحدث إلى طريقة <code>start()</code> للعملية الفرعية.  وأين يحصل المعالج على حلقة الحدث؟  وهي مخزنة بالفعل داخل جهاز التوجيه في خاصية <code>$loop</code> الخاصة.  نحتاج فقط إلى تمريره عندما يتم استدعاء المعالج. </p><br><p style=";text-align:right;direction:rtl">  <code>__invoke()</code> نفتح فئة <code>Router</code> <code>__invoke()</code> طريقة <code>__invoke()</code> ، بإضافة الوسيطة الثانية إلى استدعاء معالج الطلب: </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ServerRequestInterface $request)</span></span></span><span class="hljs-function"> </span></span>{ $path = $request-&gt;getUri()-&gt;getPath(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Request for: $path\n"</span></span>; $handler = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;routes[$path] ?? <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;notFound($path); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $handler($request, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;loop); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  هذا كل شيء!  من المحتمل أن يكون هذا <strong>حقنة تبعية</strong> كافية.  حدث رحلة كبيرة إلى حد ما لدورة الأحداث ، أليس كذلك؟  من ملف <code>index.php</code> إلى فئة <code>Router</code> ، ثم من فئة <code>Router</code> إلى ملف <code>routes.php</code> مباشرة داخل عمليات الاسترجاعات. </p><br><p style=";text-align:right;direction:rtl">  لذا ، لتأكيد أن العملية الفرعية ستقوم بسحرها غير المحظور ، دعنا نستبدل <code>ls</code> البسيط بـ <code>ping 8.8.8.8</code> الأثقل <code>ping 8.8.8.8</code> .  أعد تشغيل الخادم وحاول مرة أخرى لفتح صفحتين في نافذتين مختلفتين.  أولاً ، <code>http://127.0.0.1:8080/</code> ، ثم <code>/upload</code> .  يتم فتح كلا الصفحتين بسرعة ، دون أي تأخير ، على الرغم من تنفيذ الأمر <code>ping</code> في المعالج الأول في الخلفية.  هذا ، بالمناسبة ، يعني أنه يمكننا تفرع أي عملية مكلفة (على سبيل المثال ، معالجة الملفات الكبيرة) ، دون حظر التطبيق الرئيسي. </p><br><h4 id="svyazyvaem-docherniy-process-i-otvet-s-pomoschyu-potokov" style=";text-align:right;direction:rtl">  ربط العملية والاستجابة الفرعية باستخدام الخيوط </h4><br><p style=";text-align:right;direction:rtl">  دعنا نعود إلى تطبيقنا.  لذلك ، أنشأنا عملية فرعية ، بدأناها ، ولكن متصفحنا لا يعرض نتائج عملية متشعبة بأي شكل من الأشكال.  دعنا نصلحه. </p><br><p style=";text-align:right;direction:rtl">  كيف يمكننا التواصل مع عملية الطفل؟  في حالتنا ، لدينا أمر تشغيل <code>ls</code> يعرض محتويات الدليل الحالي.  كيف نحصل على هذا الاستنتاج ، ثم نرسله إلى نص الجواب؟  الجواب المختصر: خيوط. </p><br><p style=";text-align:right;direction:rtl">  لنتحدث قليلاً عن العمليات.  يحتوي أي أمر shell تقوم بتنفيذه على ثلاثة تدفقات للبيانات: STDIN و STDOUT و STDERR.  دفق إلى الإخراج والإدخال القياسي ، بالإضافة إلى دفق الأخطاء.  على سبيل المثال ، عندما نقوم بتنفيذ <code>ls</code> ، يتم إرسال نتيجة هذا الأمر مباشرة إلى STDOUT (على الشاشة الطرفية).  لذا ، إذا كنا بحاجة إلى الحصول على مخرجات العملية ، فإن الوصول إلى دفق الإخراج مطلوب.  الأمر بهذه البساطة.  في إنشاء عنصر الاستجابة ، <code>$childProcess-&gt;stdout</code> استدعاء <code>file_get_contents()</code> بـ <code>$childProcess-&gt;stdout</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response( <span class="hljs-number"><span class="hljs-number">200</span></span>, [<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>], $childProcess-&gt;stdout );</code> </pre> <br><p style=";text-align:right;direction:rtl">  جميع العمليات الفرعية لها ثلاث خصائص تتعلق <code>stdio</code> : <code>stdout</code> و <code>stdin</code> و <code>stderr</code> .  في حالتنا ، نريد عرض ناتج العملية على صفحة ويب.  بدلاً من سلسلة في مُنشئ فئة <code>Response</code> ، نقوم بتمرير دفق كوسيطة ثالثة.  فئة <code>Response</code> ذكية بما يكفي لإدراك أنها تلقت الدفق ومعالجته وفقًا لذلك. </p><br><p style=";text-align:right;direction:rtl">  لذا ، كالعادة ، نعيد تشغيل الخادم ونرى ما قمنا به.  دعونا نفتح الصفحة <code>http://127.0.0.1:8080/</code> في المتصفح: يجب أن تشاهد قائمة ملفات المجلد الجذر للمشروع. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/mm/ui/za/mmuizadmcw-fzg1cekm0d1jpz3e.png"></p><br><p style=";text-align:right;direction:rtl">  الخطوة الأخيرة هي استبدال <code>ls</code> بشيء أكثر فائدة.  بدأنا هذا الفصل عن طريق تقديم ملف <code>pages/index.html</code> باستخدام وظيفة <code>file_get_contents()</code> .  الآن ، يمكننا قراءة هذا الملف بشكل غير متزامن تمامًا ، دون القلق من أنه سيحظر تطبيقنا.  استبدل <code>ls</code> <code>cat pages/index.html</code> . </p><br><p style=";text-align:right;direction:rtl">  إذا لم تكن على دراية <code>cat</code> ، يتم استخدامه لربط الملفات وإخراجها.  في معظم الأحيان ، يتم استخدام هذا الأمر لقراءة ملف وإخراج محتوياته إلى الإخراج القياسي.  يقرأ الأمر <code>cat pages/index.html</code> ملف <code>cat pages/index.html</code> ويطبع محتوياته إلى STDOUT.  ونحن بالفعل نرسل <code>stdout</code> كهيئة استجابة.  فيما يلي النسخة النهائية من ملف <code>routes.php</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// routes.php use Psr\Http\Message\ServerRequestInterface; use React\EventLoop\LoopInterface; use React\ChildProcess\Process; use React\Http\Response; return [ '/' =&gt; function (ServerRequestInterface $request, LoopInterface $loop) { $childProcess = new Process('cat pages/index.html'); $childProcess-&gt;start($loop); return new Response( 200, ['Content-Type' =&gt; 'text/html'], $childProcess-&gt;stdout ); }, '/upload' =&gt; function (ServerRequestInterface $request) { return new Response( 200, ['Content-Type' =&gt; 'text/plain'], 'Upload page' ); }, ];</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  نتيجة لذلك ، كان كل هذا الرمز مطلوبًا فقط لاستبدال مكالمة واحدة بدالة <code>file_get_contents()</code> .  حقن التبعية ، تمرير كائن حلقة حدث ، إضافة العمليات التابعة والعمل مع مؤشرات الترابط.  كل هذا لمجرد استبدال استدعاء دالة واحدة.  هل كان يستحق ذلك؟  الجواب: نعم ، كان الأمر يستحق ذلك.  عندما يمكن لشيء ما أن يحجب حلقة الحدث ، ويمكن لنظام الملفات بالتأكيد ، تأكد من أنه سيتم حظره في نهاية المطاف ، وفي أكثر الأوقات غير المناسبة. </p><br><p style=";text-align:right;direction:rtl">  قد يبدو إنشاء عملية فرعية في كل مرة نحتاج فيها للوصول إلى نظام الملفات بمثابة حمل إضافي سيؤثر على سرعة وأداء تطبيقنا.  لسوء الحظ ، في PHP لا توجد طريقة أخرى للعمل مع نظام الملفات بشكل غير متزامن.  تستخدم جميع مكتبات PHP غير المتزامنة العمليات الفرعية (أو الامتدادات التي تجردها). </p><br><p style=";text-align:right;direction:rtl">  يمكن لقراء Habra شراء الكتاب بالكامل بخصم <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">على هذا الرابط</a> . </p><br><p style=";text-align:right;direction:rtl">  ونذكرك أننا نبحث دائمًا <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">عن مطورين رائعين</a> !  تعال ، نحن نستمتع! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar416003/">https://habr.com/ru/post/ar416003/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar415993/index.html">عن بعد ، أنت دقيق لا ترحم</a></li>
<li><a href="../ar415995/index.html">تطوير CROC من الداخل: الناس والبط والكثير من العمل</a></li>
<li><a href="../ar415997/index.html">برنامج تعلم الآلة Python</a></li>
<li><a href="../ar415999/index.html">ما هي منحة Apple الدراسية ولماذا هي أكثر من مجرد تذكرة WWDC</a></li>
<li><a href="../ar416001/index.html">رسائل من موقع في VK - بسيطة وفعالة - PHP + CUrl</a></li>
<li><a href="../ar416005/index.html">16 أدوات تفاعل لمطوري الواجهة</a></li>
<li><a href="../ar416007/index.html">فقط معقدة. بداية إنشاء "المنزل الذكي" اللاسلكي. يعتمد على تقنية Linux و Z-Wave وبرنامج MajorDoMo</a></li>
<li><a href="../ar416009/index.html">جرب فضلات الأرانب ، فهي قوية ، ستلتقط - مقتطفات في علم الصيدلة</a></li>
<li><a href="../ar416011/index.html">نمط BIF: كود أمامي نظيف وعمل مريح مع بيانات الخادم</a></li>
<li><a href="../ar416013/index.html">كيفية البدء في الاستثمار وتوفير المال: ذكر خبراء داو جونز الأخطاء الخمسة الرئيسية للمتداولين المبتدئين</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>