<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöº üíê ü§µüèª Tecnologia de √°udio sem fio Bluetooth: qual √© o melhor? üîé ‚òùÔ∏è ü§¥üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Com o desenvolvimento da tecnologia, os t√£o conhecidos fones de ouvido anal√≥gicos "tube" entram na hist√≥ria - eles s√£o cada vez mais substitu√≠dos por ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tecnologia de √°udio sem fio Bluetooth: qual √© o melhor?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433502/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/uz/_p/or/uz_por_7qlk9snfb7v_jg2x5iae.jpeg"></div><br>  Com o desenvolvimento da tecnologia, os t√£o conhecidos fones de ouvido anal√≥gicos "tube" entram na hist√≥ria - eles s√£o cada vez mais substitu√≠dos por parceiros sem fio Bluetooth. <br><br>  Os smartphones modernos s√£o privados do conector habitual por causa da prote√ß√£o contra umidade e poeira. <br><br>  Os desenvolvedores lan√ßam todas as novas vers√µes do protocolo Bluetooth e todas as novas vers√µes de codecs, prometendo "mais r√°pido, mais alto, mais forte" - menos atrasos na reprodu√ß√£o e melhor qualidade. <br><br>  Tudo √© t√£o bom?  Vamos ver <br><a name="habracut"></a><br><h2>  1. Introdu√ß√£o </h2><br>  N√£o vou me aprofundar na implementa√ß√£o t√©cnica dos protocolos, bem como nas especifica√ß√µes chatas.  Caro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">ValdikSS</a> , que em grande parte atuou como inspira√ß√£o e at√© consultor cient√≠fico neste artigo, est√° preparando material abrangente sobre codecs - e tudo ser√° apresentado l√° com muito mais detalhes e tecnicamente correto. <br><br>  Quero contar mais sobre a experi√™ncia pessoal.  Bem, um pouco de pr√°tica divertida (chata?). <br><br>  H√° um ano e meio, fiquei empolgado com a ideia do aptX.  Sim, li muitos coment√°rios como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">esse</a> e acreditei em todas essas reviravoltas t√©cnicas.  Nasceu uma crian√ßa - e eu realmente queria assistir a shows com fones de ouvido √† noite com minha esposa, sem fazer barulho e sem acordar ningu√©m em casa. <br><br>  Em que isso resultou? <br><br><h2>  Qualidade </h2><br>  Vamos come√ßar com n√∫meros e fatos (Ol√°, Wikipedia!) <br><br>  <b>O SBC</b> √© um bom codec antigo, em conformidade com o padr√£o A2DP.  O codec √© o resultado do trabalho de Frans de Bont <i>(F. de Bont, M. Groenewegen e W. Oomen, ‚ÄúUm sistema de codifica√ß√£o de √°udio de alta qualidade a 128 kb / s‚Äù, 98¬™ Conven√ß√£o AES, 25 a 28 de fevereiro de 1995)</i> e uso os algoritmos descritos na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">patente EP-0400755B1</a> .  Vale ressaltar que os autores da patente permitem o uso gratuito da SBC apenas no aplicativo Bluetooth, no entanto, a patente expirou em 2 de junho de 2010.  Como o padr√£o A2DP √© muito comum, √© extremamente dif√≠cil encontrar fones de ouvido ou alto-falantes que n√£o tenham suporte √† SBC. <br><br>  O codec fornece uma frequ√™ncia de amostragem de 16, 32, 44,1, 48 kHz com uma taxa de fluxo de 10-1500 kbit / s.  Sim, voc√™ ouviu direito.  At√© 1500 kbps.  Simplesmente n√£o h√° limite de taxa de bits no codec.  Mas mais sobre isso mais tarde. <br><br>  O codec <b>aptX foi</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">desenvolvido em 1988 na Queen's University Belfast</a> .  Sim, antes do Bluetooth ainda havia cerca de uma d√∫zia de anos, ent√£o o codec era usado em equipamentos de √°udio profissional.  Atualmente, a Qualcomm possui os direitos e, portanto, o uso requer licenciamento e royalties.  A partir de 2014, o custo √© aproximadamente o seguinte: um pagamento √∫nico de US $ 6.000 e ‚âà $ 1 para cada dispositivo liberado para partes de at√© 10.000 dispositivos.  Por esse motivo, muitos dispositivos com chips Snapdragon 835, 845, 821, 820, 810, 805, 801, 800, 650, 615, 410 s√£o bem poss√≠veis e suportam o aptX, mas n√£o √© ativado por l√°, porque a licen√ßa n√£o foi adquirida.  Sobre isso - tamb√©m abaixo. <br><br>  Com uma profundidade de 16 bits e uma frequ√™ncia de amostragem de 48 kHz, o codec pode fornecer uma taxa de bits de 384 kbit / s (canal duplo). <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lista de produtos oficialmente suportados pelo aptX</a> .  Voc√™ pode encontrar muitos sistemas desconhecidos com suporte ao aptX no Aliexpress, mas esteja preparado para o fato de que realmente haver√° o mesmo bom e antigo SBC - e n√£o mais. <br><br>  <b>aptX HD</b> - o mesmo codec, mas com um perfil de codifica√ß√£o diferente, tem uma velocidade de fluxo de 576 kbit / s, suporte para frequ√™ncias de amostragem de at√© 48 kHz e profundidade de bits de at√© 24 bits.  Algumas pessoas chamam isso de codec aptX Lossless - mas isso √© um absurdo completo, apenas porque no momento √© imposs√≠vel alcan√ßar o valor de um fluxo que possa transportar dados sem perda.  Uma vantagem particular desse codec √© um atraso de codifica√ß√£o ajust√°vel, que pode ser reduzido para 1 ms a uma frequ√™ncia de amostragem de 48 kHz.  Al√©m disso, o codec √© extremamente vantajoso do ponto de vista do carregamento do processador, o que expressa uma vantagem em compara√ß√£o ao MP3 e AAS. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lista de produtos oficialmente suportados pelo aptX HD</a> .  Ele √© pequeno o suficiente. <br><br>  <b>O lat√™ncia baixa do aptX</b> (ou LL) √© uma vers√£o especial do codec que permite reduzir o tempo de atraso do som para menos de 40 ms.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lista de produtos oficialmente suportados pelo aptX LL</a> . <br><br><img src="https://habrastorage.org/webt/oz/nd/5q/oznd5qcoovjbj8f4xdtfydbl_ym.png" alt="imagem"><br><br>  L√° est√° ela.  Foi essa foto que certa vez me comprou com crian√ßas.  Atrasos!  Afinal, quem quer ouvir o som de uma explos√£o em algum filme de a√ß√£o, o grito de um monstro em um filme de terror ou o rugido de uma multid√£o em uma partida de futebol quando tudo acaba? <br><br>  Mas tudo isso √© realmente assim? <br><br>  Infelizmente, n√£o. <br><br>  Como em qualquer material de marketing, os n√∫meros s√£o absurdos.  O atraso depende muito do buffer na implementa√ß√£o do sistema e do codec.  Portanto, o atraso com a SBC pode muito bem ser inferior a 40 ms, o que, considerando os padr√µes de transmiss√£o de televis√£o (+40 ms ... - 60 ms), √© perfeitamente aceit√°vel. <br><br>  <u>Em resumo:</u> <br><br><ol><li>  Nenhum codec existente pode ser melhor que a tecnologia com fio, j√° que nenhum codec pode alcan√ßar uma verdadeira compacta√ß√£o sem perdas. </li><li>  O codec mais popular √© o SBC.  Ele √© o mais flex√≠vel nas configura√ß√µes.  E apesar do fato de o aptX ter sido lan√ßado anteriormente, ele n√£o conseguiu superar a popularidade da SBC, aparentemente devido ao fato de o √∫ltimo ser gratuito. </li><li>  A qualidade do som depende extremamente da implementa√ß√£o do codec, bem como do desempenho do hardware dos fones de ouvido / alto-falantes em geral - se o alto-falante for fraco, a qualidade n√£o poder√° ser melhorada por nenhum codec.  Portanto, no futuro, comparando a qualidade, falaremos sobre a reprodu√ß√£o do mesmo conte√∫do da mesma fonte nos mesmos alto-falantes / fones de ouvido, mas com codecs diferentes. </li></ol><br><h2>  Resultados pr√°ticos e muito subjetivos </h2><br><img src="https://habrastorage.org/webt/fj/uf/kj/fjufkjmv-sxcezemnqcz3ztyue4.jpeg"><br><br>  As informa√ß√µes s√£o baseadas na experi√™ncia de um ano e meio j√° mencionada em opera√ß√£o, compara√ß√£o e atra√ß√£o de ouvintes externos. <br><br>  A experi√™ncia baseia-se em ouvir sem perdas no reprodutor SONY Walkman NWZ-A17, onde o codec pode ser selecionado, bem como assistir a v√°rios programas com sa√≠da de √°udio atrav√©s do Avantree Priva III. <br><br>  Havia tr√™s fones de ouvido: Sennheiser PMX 60, Koss Porta Pro e Koss UR-20. <br><br>  O Jabra BT3030 (SBC) e o Avantree Clipper Pro (aptX) foram utilizados como receptores de sinal sem fio. <br><br>  Tamb√©m foram utilizados um alto-falante Voombox Outdoor (SBC) e fones de ouvido para condu√ß√£o √≥ssea Aftershokz Trekz Titanium (aptX). <br><br>  Todos os equalizadores e aprimoradores foram desativados - e isso √© importante. <br><br>  <u>Total:</u> <br><br><ol><li>  A qualidade do som reproduzido com uma conex√£o com fio √© sempre melhor.  Isto √© sem d√∫vida. </li><li>  A diferen√ßa entre SBC e aptX √© extremamente dif√≠cil de ouvir - e apenas no caso de alguns tipos de m√∫sica.  Por exemplo, o autor do artigo ouviu claramente a diferen√ßa no violoncelo nas composi√ß√µes cl√°ssicas, enquanto no violino e nos instrumentos de baixa frequ√™ncia a diferen√ßa foi menos percept√≠vel.  Nos g√™neros modernos - pop, m√∫sica eletr√¥nica e rock - a diferen√ßa n√£o √© ouvida.  Em alguns casos, parecia subjetivamente que a SBC transmite som melhor que o aptX. </li><li>  O atraso entre o SBC e o aptX pode ser visto apenas se voc√™ se conectar √† mesma fonte e inserir diferentes receptores em diferentes ouvidos (bem, o canal esquerdo √© SBC e o canal direito √© o aptX, por exemplo).  √â quase imposs√≠vel ver o atraso com a imagem, mas porque a hist√≥ria de que o aptX se destina a cenas e conte√∫do din√¢micos √© um mito. </li><li>  A surpresa foi causada pela qualidade do som no Voombox Outdoor, bastante barato e "n√£o famoso".  Aparentemente, esta √© a implementa√ß√£o bem-sucedida do SBC, mencionada acima. </li><li>  A implementa√ß√£o do aptX em fones de ouvido com condu√ß√£o √≥ssea √© completamente incompreens√≠vel - a tecnologia √© muito espec√≠fica e, portanto, a perda de qualidade √© significativa devido √† pr√≥pria tecnologia.  Tendo em conta o pequeno alcance do "alcance" da opera√ß√£o do dispositivo, a implementa√ß√£o extremamente pobre do emparelhamento com dois dispositivos, posso dizer que a Aftershokz √© uma empresa que investe mais em marketing do que em desenvolvimento. </li></ol><br><br>  N√£o estou argumentando que, se voc√™ conectar todos os tipos de analisadores espectrais e assim por diante, poder√° e deve ver a diferen√ßa.  Mas o ouvido humano, e pior ainda - o ouvido humano m√©dio - n√£o √© um dispositivo espectral e, portanto, n√£o ouve todas essas nuances. <br><br><h2>  Pr√°tica: consertando o que pode ser consertado </h2><br><h3>  Parte 1. Ative o aptX </h3><br>  Como j√° mencionado, em alguns dispositivos o uso do aptX √© desativado, provavelmente para evitar processos de patentes. <br><br>  Esse problema pode ser resolvido simplesmente deslizando o dispositivo de biblioteca para implementar o codec e escrevendo a capacidade de trabalhar com esse codec no build.prop. <br><br>  Na Internet, h√° um grande n√∫mero de solu√ß√µes dessa natureza.  Tomei a liberdade de combin√°-los em um, enquanto realizava isso como um m√≥dulo para Magisk.  Sim, eu realmente gosto deste projeto e acho que implementar mudan√ßas no sistema na forma de m√≥dulos Magisk √© uma solu√ß√£o melhor e mais segura, com a capacidade de salvar o sistema na sua forma original e de uma maneira f√°cil de reverter. <br><br>  O m√≥dulo pode ser baixado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Sim, eu sei sobre o github.  E n√£o, at√© eu ter tempo de coloc√°-lo l√°. <br><br>  As entradas no build.prop, incluindo o aptX e, se poss√≠vel, o aptX HD, ser√£o emuladas automaticamente pelo m√≥dulo. <br><br><img src="https://habrastorage.org/webt/vg/lc/gu/vglcguyqsbbyxptonmhdw-5ta3y.png"><br><br><h3>  Parte 2. Aumente a taxa de bits da SBC </h3><br>  Conforme relatado anteriormente, o codec SBC basicamente n√£o possui restri√ß√µes de taxa de bits.  No entanto, os fabricantes geralmente estabelecem um limite de 342 kbit / s para mono e 345 kbit / s para est√©reo, a fim de garantir uma opera√ß√£o confi√°vel com todos os tipos de dispositivos receptores. <br><br>  Ao mesmo tempo, a especifica√ß√£o A2DP v1.2, que estava ativa de 2007 a 2015, exige que todos os dispositivos de decodifica√ß√£o funcionem corretamente com taxas de bits de at√© 320 kbit / s para mono e 512 kbit / s no caso de um sinal est√©reo. <br><br>  Na nova vers√£o da especifica√ß√£o, n√£o h√° limite de taxa de bits.  Sup√µe-se que os fones de ouvido modernos lan√ßados ap√≥s 2015 e com suporte ao EDR possam suportar taxas de bits de at√© 730 kbps. <br><br>  De fato, esse certamente n√£o √© o caso.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Em um extenso estudo</a> realizado pelo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">ValdikSS</a> , constatou-se que quase todos os dispositivos receptores funcionam de maneira confi√°vel com taxas de bits de 454 kbit / s, e um n√∫mero bastante grande com uma taxa de bits de 507 kbit / s. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Em sua pesquisa, o</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">ValdikSS</a> tamb√©m mostrou que, ao contr√°rio da cren√ßa popular sobre a qualidade do som do codec aptX, ele pode produzir resultados piores em alguns arquivos do que o SBC com uma taxa de bits padr√£o de 328 kbps, e a mudan√ßa para o SBC de alta taxa de bits produzir√° som que geralmente excede aptX, em qualquer fone de ouvido. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Com base</a> nesses dados, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">ValdikSS</a> enviou coment√°rios aos desenvolvedores do Lineage OS e do Google, mas at√© agora n√£o houve rea√ß√£o. <br><br>  Assim, s√≥ podemos fazer modifica√ß√µes manualmente na pilha Bluetooth. <br><br>  Precisamos de um IDA Pro com a capacidade de descompilar o ARM, qualquer editor HEX (usei o WinHEX) e o arquivo bluetooth.default.so do nosso dispositivo.  Normalmente, ele est√° localizado no caminho / system / lib / hw e com menos frequ√™ncia - tamb√©m no caminho / system / lib64 / hw (o acesso root √© definitivamente necess√°rio). <br><br>  Portanto, abra o arquivo bluetooth.default.so.As opera√ß√µes e modifica√ß√µes descritas abaixo se aplicam apenas √† pilha Android original (bluedroid).  Se voc√™ vir a linha ‚ÄúBiblioteca necess√°ria 'com.qualcomm.qti.bluetooth_audio@1.0.so'‚Äù ou similar no IDA Pro, com alta probabilidade, esta instru√ß√£o n√£o o ajudar√°. <br><br><img src="https://habrastorage.org/webt/cf/3l/jb/cf3ljbjgckew4pd9tbutsy-tyaw.png"><br><br>  Nossa primeira tarefa √© substituir o Joint Stereo pelo Dual Channel em uma configura√ß√£o padr√£o. <br><br>  Vamos trabalhar com a <a href="">fun√ß√£o bta_av_build_src_cfg</a> . <br><br>  Para encontrar esse procedimento no IDA, usaremos a <a href="">linha de</a> busca <a href="">por uma mensagem caracter√≠stica no log de depura√ß√£o "N√£o √© poss√≠vel analisar src cap ret =% d"</a> : <br><br><img src="https://habrastorage.org/webt/wh/dk/ex/whdkexvibrxijvj7pqb-buzb0z8.png"><br><br><img src="https://habrastorage.org/webt/ea/2h/nh/ea2hnhbszbtyieokldywuch2qvi.png"><br><br>  Como resultado, rapidamente encontramos a pr√≥pria fun√ß√£o na forma de c√≥digo: <br><br><img src="https://habrastorage.org/webt/mf/5_/_9/mf5__9yydhgwip0lvemgqwcwocw.png"><br><br>  Nossa tarefa √© substituir a estrutura original de cheques <br><br><pre><code class="plaintext hljs">if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_JOINT) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_JOINT; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_STEREO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_STEREO; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_MONO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_MONO;&lt;/code&gt;  &lt;code&gt; if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_STEREO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_STEREO; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_DUAL) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_DUAL; else if (src_cap.ch_mode &amp; A2D_SBC_IE_CH_MD_MONO) pref_cap.ch_mode = A2D_SBC_IE_CH_MD_MONO;</code> </pre> <br>  Existem v√°rias maneiras de fazer isso. <br><br>  A primeira √© a substitui√ß√£o das instru√ß√µes TST.W R0, # 1 por TST.W R0, # 4 e MOVS R0, # 1 por MOVS R0, # 4 na sequ√™ncia de verifica√ß√µes: <br><br><img src="https://habrastorage.org/webt/6e/zu/so/6ezusojttx0gavinlppmqeroet8.png"><br><br>  No bytecode, essa √© a substitui√ß√£o de x01 para x04.  √â importante observar a sequ√™ncia caracter√≠stica de bytes pela qual esse padr√£o pode ser encontrado.  Sem me aprofundar nos detalhes, direi que, em ess√™ncia, √© uma busca por sequ√™ncia <br><br><pre> <code class="plaintext hljs">10 20 8D F8 04 00 9D F8 0D 00 10 F0 01 0F ?? ?? 10 F0 02 0F ?? ?? 10 F0 04 0F ?? ?? 10 F0 08 0F ?? ?? 08 20 ?? ?? 01 20 ?? ?? 02 20 ?? ?? 04 20</code> </pre> <br>  e sua substitui√ß√£o por <br><br><pre> <code class="plaintext hljs">?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 04 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 04 ?? ?? ?? ?? ?? ?? ?? ?? ??</code> </pre> <br>  No entanto, este m√©todo tem desvantagens. <br><br>  V√°rios compiladores alteram a sequ√™ncia de execu√ß√£o de comandos, dependendo da otimiza√ß√£o.  E, nesse caso, n√£o √© poss√≠vel encontrar o padr√£o desejado e, √†s vezes, o mecanismo de verifica√ß√£o na estrutura √© geralmente introduzido no c√≥digo embutido.  Portanto, √© mais confi√°vel alterar a constante <a href="">btif_av_sbc_default_config</a> . <br><br>  Para iniciantes - encontre-a.  Ela est√° no come√ßo de nossa fun√ß√£o, porque <br><br><pre> <code class="plaintext hljs">void bta_av_build_src_cfg (UINT8 *p_pref_cfg, UINT8 *p_src_cap) { tA2D_SBC_CIE src_cap; tA2D_SBC_CIE pref_cap; UINT8 status = 0; /* initialize it to default SBC configuration */ A2D_BldSbcInfo(AVDT_MEDIA_AUDIO, (tA2D_SBC_CIE *) &amp;btif_av_sbc_default_config, p_pref_cfg); /* now try to build a preferred one */ /* parse configuration */ if ((status = A2D_ParsSbcInfo(&amp;src_cap, p_src_cap, TRUE)) != 0) { APPL_TRACE_DEBUG(" Cant parse src cap ret = %d", status);</code> </pre> <br>  E aqui est√° ela: <br><br><img src="https://habrastorage.org/webt/xi/j2/dt/xij2dtvma0evlnggxkxzqxkvdn4.png"><br><br><img src="https://habrastorage.org/webt/7a/z9/36/7az936re6naesontslfi1ogkd5c.png"><br><br>  Pode-se observar que o pr√≥prio btif_av_sbc_default_config √© uma sequ√™ncia de bytes 20 01 10 04 01 35 02, enquanto o primeiro byte codifica a frequ√™ncia de amostragem e pode ser 10 (48 kHz) e 20 (44 kHz) e, portanto, n√£o espec√≠fico.  Assim, nossa tarefa √© substituir a sequ√™ncia <br> <code>01 10 04 01 35 02</code> <br>  em <br> <code>04 ?? ?? ?? ?? ??</code> <br> <br>  Isso permitir√° que voc√™ altere a l√≥gica da estrutura de maneira semelhante, mas, ao mesmo tempo, otimizar o compilador n√£o causar√° problemas. <br><br>  Em alguns casos, os pr√≥prios fones de ouvido ou alto-falantes iniciam a conex√£o.  Nesse caso, o modo √© determinado pela fun√ß√£o <a href="">bta_av_co_audio_init</a> . <br><br>  A fun√ß√£o √© <a href="">caracterizada pela linha "bta_av_co_audio_init:% d"</a> e √© facilmente pesquisada no c√≥digo: <br><img src="https://habrastorage.org/webt/fi/5o/ku/fi5okug9tbn6gvleetxo93uk9qg.png"><br><br>  A enumera√ß√£o dos poss√≠veis modos de conex√£o √© realizada no seguinte comando: <br><br><pre> <code class="plaintext hljs"> switch (index) { case BTIF_SV_AV_AA_SBC_INDEX: /* Set up for SBC codec for SRC*/ *p_codec_type = BTA_AV_CODEC_SBC; /* This should not fail because we are using constants for parameters */ A2D_BldSbcInfo(AVDT_MEDIA_AUDIO, (tA2D_SBC_CIE *) &amp;bta_av_co_sbc_caps, p_codec_info); /* Codec is valid */ return TRUE;</code> </pre> <br>  a <a href="">constante bta_av_co_sbc_caps possui a seguinte estrutura</a> : <br><br><pre> <code class="plaintext hljs">const tA2D_SBC_CIE bta_av_co_sbc_caps = { (A2D_SBC_IE_SAMP_FREQ_44), /* samp_freq */ (A2D_SBC_IE_CH_MD_MONO | A2D_SBC_IE_CH_MD_STEREO | A2D_SBC_IE_CH_MD_JOINT | A2D_SBC_IE_CH_MD_DUAL), /* ch_mode */ (A2D_SBC_IE_BLOCKS_16 | A2D_SBC_IE_BLOCKS_12 | A2D_SBC_IE_BLOCKS_8 | A2D_SBC_IE_BLOCKS_4), /* block_len */ (A2D_SBC_IE_SUBBAND_4 | A2D_SBC_IE_SUBBAND_8), /* num_subbands */ (A2D_SBC_IE_ALLOC_MD_L | A2D_SBC_IE_ALLOC_MD_S), /* alloc_mthd */ BTA_AV_CO_SBC_MAX_BITPOOL, /* max_bitpool */ A2D_SBC_IE_MIN_BITPOOL /* min_bitpool */ };</code> </pre> <br>  A constante √© facilmente encontrada no c√≥digo, no meu caso √© 20 0F F0 0C 03 35 02: <br><br><img src="https://habrastorage.org/webt/kj/hw/oi/kjhwoibpuk8brwa3kzvxiuxgeba.png"><br><br>  Preste aten√ß√£o ao byte <b>0F</b> - ele permite a conex√£o com qualquer um dos modos v√°lidos, pois <br><br><pre> <code class="plaintext hljs">x0F = A2D_SBC_IE_CH_MD_MONO | A2D_SBC_IE_CH_MD_STEREO | A2D_SBC_IE_CH_MD_JOINT | A2D_SBC_IE_CH_MD_DUAL = x08 | x02 | x01 | x04</code> </pre> <br>  Nossa tarefa √© alterar esse valor da seguinte maneira: <br><br><pre> <code class="plaintext hljs">x0F = A2D_SBC_IE_CH_MD_DUAL = x04</code> </pre> <br>  Portanto, √© necess√°rio substituir <br><br> <code>?? 0F F0 0C 03 35 02</code> <br>  em <br> <code>?? 04 ?? ?? ?? ?? ??</code> <br> <br>  Portanto, for√ßamos a pilha a se conectar no modo Dual Channel, tanto no caso de iniciar uma conex√£o pelo dispositivo, quanto no caso de iniciar uma conex√£o pelo lado receptor do sinal. <br><br>  Agora voc√™ precisa remover as restri√ß√µes na taxa de bits ou aumentar seu limite superior. <br><br>  Precisa lidar com <a href="">btif_media_task_get_sbc_rate</a> .  Da mesma forma, para procurar a <a href="">linha de caracter√≠stica ‚Äúcoletor a2dp n√£o edr detectado, restringir a taxa para% d‚Äù,</a> procuramos a fun√ß√£o no c√≥digo: <br><img src="https://habrastorage.org/webt/kp/go/j2/kpgoj2xsq6vt8kbnexy81jy6j6s.png"><br><br>  O limite da taxa de bits √© expresso em uma sequ√™ncia <br>  Taxa UINT16 = DEFAULT_SBC_BITRATE (que por sua vez <a href="">√© de 328 kbps</a> ) <br><br>  No c√≥digo, √© assim: <br><br><img src="https://habrastorage.org/webt/tf/ba/bn/tfbabnrxfks3pejhzqzdegiwn04.png"><br><br>  Altere esse valor para 454 kbit / s - √© mais alto que o padr√£o e funciona com a grande maioria dos receptores.  Para fazer isso, substitua os bytes <br><br> <code>B1 4F F4 A4 74 ?? E0</code> <br>  em <br> <code>?? ?? ?? E3 ?? ?? ??</code> <br> <br>  Voc√™ tamb√©m deve procurar por padr√£o. <br><br> <code>E0 4F F4 A4 74 ?? E0</code> <br>  e substitua-o por <br> <code>?? ?? ?? E3 ?? ?? ??</code> <br>  - Isso √© necess√°rio para v√°rios dispositivos. <br><br>  O valor de E3 pode ser diferente dependendo da taxa de bits m√°xima desejada: <br><br><ul><li>  E3 - 454 kbps </li><li>  F1 - 482 kbps </li><li>  F3 - 486 kbps </li><li>  10 - 576 kbps </li><li>  48 - sem limite </li></ul><br>  Em geral, isso √© determinado pelo bytecode da opera√ß√£o MOV.W R4, XXX. <br><br>  Na pr√°tica, vale a pena experimentar e escolher o valor m√°ximo no qual todos os seus dispositivos receptores recebem uma recep√ß√£o est√°vel do sinal, sem rachaduras, interrup√ß√µes ou distor√ß√µes. <br><br>  Em todos os receptores do meu experimento (eu os indiquei acima), esse valor foi de 576 kbit / s, o telefone Xiaomi Redmi 4x MIUI10 Android 7.1 foi a fonte do sinal. <br><br>  Com base nas a√ß√µes descritas, foi criado um patch gen√©rico que encontra os padr√µes especificados em Bluetooth.default.so e os substitui?  incluindo o modo Dual Channel for√ßado e definindo o limite de taxa de bits para 454 kbps.  Se necess√°rio, o valor limite pode ser facilmente alterado com base na pesquisa e substitui√ß√£o do byte correspondente - um leitor atento far√° isso sem dificuldade. <br><br>  Enfatizo: o patch s√≥ funciona no caso da pilha bluedroid e provavelmente n√£o ser√° bem-sucedido no caso da pilha Fluoride e na vers√£o Android 8 e posterior. <br><br>  O patch pode ser baixado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  √â altamente recomend√°vel que voc√™ substitua o arquivo original como m√≥dulos Magisk, por mim mesmo fiz o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">seguinte</a> .  <b>Observe</b> : esses m√≥dulos foram feitos por mim para o telefone Xiaomi Redmi 4x 3/32 GB com o atual firmware MIUI 10. global est√°vel no momento da reda√ß√£o. No seu caso, o arquivo bluetooth.default.so precisar√° ser substitu√≠do pelo seu pr√≥prio, corrigido, conforme descrito acima.  Tamb√©m √© poss√≠vel que o arquivo precise ser duplicado no caminho / system / lib64 / hw - depende do modelo e da vers√£o do firmware do seu telefone. <br><br>  Essa abordagem usando os m√≥dulos Magisk facilita a altera√ß√£o da taxa de bits m√°xima e geralmente desabilita as altera√ß√µes se ocorrer que alguns dos dispositivos receptores n√£o suportam o canal duplo. <br><br><h2>  Conclus√£o </h2><br>  No momento, na busca de vendas, muitas empresas est√£o apresentando algumas inova√ß√µes tecnol√≥gicas como justificativa para um pre√ßo mais alto. <br><br>  Na pr√°tica, verifica-se que as tecnologias mais baratas existentes n√£o s√£o totalmente desenvolvidas e as inova√ß√µes tecnol√≥gicas n√£o s√£o totalmente implementadas, o que afeta significativamente a qualidade. <br><br>  Muitas vezes, os usu√°rios experimentam o ‚Äúefeito placebo‚Äù, convencendo-se da perfei√ß√£o de um produto apenas porque √© mais novo ou mais colorido apresentado.  De fato, essa qualidade √© imagin√°ria. <br><br>  Apesar da deteriora√ß√£o √≥bvia na qualidade da transmiss√£o de √°udio sem fio em compara√ß√£o com a vers√£o com fio, parece que os fabricantes modernos de dispositivos visam uma transi√ß√£o completa para as tecnologias sem fio.  Ao mesmo tempo, truques de marketing s√£o usados ‚Äã‚Äãpara justificar o aumento de pre√ßo: prote√ß√£o contra imers√£o do telefone na √°gua (como voc√™ pode falar debaixo d'√°gua? Por que deixar o dispositivo na √°gua?), Uso de codecs mais caros etc.  Ao mesmo tempo, o potencial do codec SBC popular existente n√£o √© totalmente utilizado. <br><br>  N√£o foi poss√≠vel obter esclarecimentos do Google sobre o limite de taxa de bits de 328 kbps, nem eliminar esse limite e adicionar a op√ß√£o de ativar o Dual Channel no menu Bluetooth dos desenvolvedores do Lineage OS. <br><br>  Obrigado a todos que leram at√© o fim! <br><br>  Alguma continua√ß√£o causada pela discuss√£o nos coment√°rios e um espa√ßo referente ao codec LDAC est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><img src="https://habrastorage.org/webt/ob/mr/cc/obmrccmcn21gzh8g1ca3g3ykfs4.jpeg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt433502/">https://habr.com/ru/post/pt433502/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt433490/index.html">Revis√£o da impressora 3D Creality CR-X</a></li>
<li><a href="../pt433494/index.html">10 idiomas ingleses que voc√™ nunca conhecer√°</a></li>
<li><a href="../pt433496/index.html">Empresas estatais obrigadas a mudar para software dom√©stico at√© 2022</a></li>
<li><a href="../pt433498/index.html">Sberbank - voc√™ tem um "pacote" para mim, mas eu n√£o aceito ...</a></li>
<li><a href="../pt433500/index.html">Rob√¥ de correio de Berkeley queimado devido √† falta de status do sistema de monitoramento</a></li>
<li><a href="../pt433504/index.html">Como parar de escrever firmware para microcontroladores e come√ßar a viver</a></li>
<li><a href="../pt433506/index.html">A UE procura o direito de reparar grandes aparelhos dom√©sticos</a></li>
<li><a href="../pt433508/index.html">O propriet√°rio da arquitetura MIPS pretende abrir seu conjunto de instru√ß√µes (ISA) em 2019</a></li>
<li><a href="../pt433510/index.html">Diferen√ßa transcultural nos jogos</a></li>
<li><a href="../pt433512/index.html">Teoria da felicidade. V√¥o vertiginoso de um sandu√≠che com manteiga</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>