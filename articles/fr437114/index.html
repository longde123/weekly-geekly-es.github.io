<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤧 🎏 🥣 Webinaire ouvert: «SSH / NC / Socat: trucs et astuces» 🤚🏾 🙍🏻 🤪</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonne journée à tous! 

 La semaine prochaine, nous lançons le prochain groupe Linux Administrator , dans le cadre duquel nous avons organisé un certa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Webinaire ouvert: «SSH / NC / Socat: trucs et astuces»</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/437114/">  Bonne journée à tous! <br><br>  La semaine prochaine, nous lançons le prochain <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">groupe Linux Administrator</a> , dans le cadre duquel nous avons organisé un certain nombre d'événements.  L'un d'eux est une leçon ouverte sur le sujet «SSH / NC / Socat: trucs et astuces».  Nous y avons rappelé ce qu'est ssh, son histoire et sa mission.  Nous avons examiné diverses options pour son utilisation: transfert de port local à distance, copie sécurisée, proxy de chaussettes, proxy inverse.  Nous avons en fait essayé les utilitaires nc et socat dans un laboratoire virtuel. <br><br>  Le webinaire a été organisé par l'administrateur système expérimenté <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vladimir Drozdetsky</a> , développeur d'infrastructure chez letundra.com, exposcan.ru, crispmessenger.com. <br><br>  Nous portons à votre attention une description détaillée de l'événement passé. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/n7jxFK9SMsk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  <b>Rappelez-vous ce qu'est SSH</b> <br><br>  SSH (Secure Shell) est un «shell sécurisé», un protocole réseau au niveau de l'application.  Il vous permet de contrôler à distance le système d'exploitation et de tunneler les connexions TCP (par exemple, pour transférer des fichiers).  Dans sa fonctionnalité, SSH est similaire aux protocoles Telnet et rlogin, cependant, il en diffère car il crypte tout le trafic, y compris les mots de passe transmis.  La spécification du protocole SSH-2 est contenue dans la RFC 4251. <br><br>  Examinons les diverses utilisations de SSH, à la fois standard et non standard.  Le stand suivant nous y aidera: <br><br><img src="https://habrastorage.org/webt/mi/d9/2a/mid92ankvqf8pgggjz7orphgps4.png"><br><br>  Le stand présente quatre machines virtuelles situées derrière le pare-feu.  Nous effectuerons toutes les actions de la machine Node-1. <br><br>  <b>Création d'une clé SSH</b> <b><br></b> <br>  Pour utiliser la clé SSH, vous devez d'abord la créer.  Pour cela, un utilitaire spécial convient, qui est absolument dans n'importe quelle distribution Linux: <br><br><pre><code class="plaintext hljs">ssh-keygen -t RSA -N otuslinux -f ~/.ssh/otus</code> </pre> <br><ul><li>  -t - quel algorithme de chiffrement utiliser; </li><li>  -N - clé de chiffrement (un argument pratique si vous avez besoin de créer une clé sans chiffrement et des réponses à diverses requêtes ssh-keygen); </li><li>  -f - dans quel fichier enregistrer la clé. </li></ul><br>  <b>Paramètres SSH ssh-server</b> <br><br>  Pour poursuivre le travail, vous devrez modifier le fichier / etc / ssh / sshd_config et redémarrer le serveur ssh.  Ici, vous devez faire attention aux options suivantes: <br><br>  <code>RSAAuthentication yes</code> (si l'authentification RSA est autorisée); <br>  <code>PubkeyAuthentication yes</code> (si l'authentification par clé est autorisée); <br>  <code>AuthorizedKeysFile %h/.ssh/authorized_keys</code> (chemin d'accès à la partie publique de la clé); <br>  <code>PasswordAuthentication yes</code> (si l'authentification est autorisée). <br><br>  Pour copier la clé sur le serveur, procédez comme suit: <br><br>  <code>ssh-copy-id -i /path/to/pub/key user@server</code> (copiez la partie publique de la clé sur le serveur distant, la clé publique sera copiée le long du chemin vers le fichier% h / .ssh / authorized_keys) <br><br>  Afin de ne pas saisir à nouveau la clé de cryptage lors de la connexion à un serveur distant, nous pouvons utiliser ssh-agent.  Pour ce faire: <br><br>  <code>eval $(ssh-agent -s)</code> (eval fait partie de POSIX. Son interface peut également être un shell. La clé de l'agent sera stockée sous forme déchiffrée). <br><br>  <code>ssh-add ~/.ssh/our_private_key</code> (Ajouter une clé privée). <br><br>  Dans ce cas: <br><br><ul><li>  -i - indique l'emplacement de la clé publique; </li><li>  utilisateur - nom d'utilisateur sur le serveur distant; </li><li>  serveur - ip ou dns du serveur cible. </li></ul><br>  Pour faciliter la connexion à un serveur distant, nous pouvons décrire les paramètres de connexion dans le fichier de configuration ssh, qui se trouve sur le chemin ~ / .ssh / config <br><br>  Ainsi, nous obtenons le fichier de configuration SSH suivant: <br><br><pre> <code class="bash hljs">Host myserver HostName ip/hostname Port 22/??? User username IdentityFile ~/.ssh/id_rsa</code> </pre> <br>  Ici, tout est simple: <br><br><ul><li>  Hôte - le nom de notre connexion; </li><li>  HostName - nom du serveur; </li><li>  Port - port ssh </li><li>  Utilisateur - nom d'utilisateur; </li><li>  IdentityFile - clé ssh. </li></ul><br>  <b>SSH SCP</b> <br><br>  Continuons.  La façon la plus simple d'utiliser SSH est de copier le fichier d'une machine vers la télécommande.  Pour ce faire, utilisez l'utilitaire SCP (Secure Copy Protocol).  En l'utilisant, vous pouvez copier un répertoire ou un fichier d'un serveur local vers un serveur distant, ou vice versa: <br><br>  <code>scp test.txt username@server:/some/directory</code> (Copie d'un fichier du serveur local vers le serveur distant). <br>  <code>scp username@server:test.txt /some/directory</code> (Copie d'un fichier d'un serveur distant vers un serveur local). <br>  <code>scp -r dir_name username@server:/some/directory</code> (Copie d'un dossier du serveur local vers la télécommande). <br><br>  Ici: <br><br><ul><li>  nom d'utilisateur - nom d'utilisateur; </li><li>  serveur - adresse du serveur; </li><li>  / certains / serveur - le répertoire où nous copions; </li><li>  dir_name - nom du dossier; </li><li>  -r - utiliser récursivement. </li></ul><br>  <b>Tunnel SSH, proxy</b> <br><br>  Examinons maintenant l'option de transfert d'un port avec une télécommande vers la machine locale.  Prenons l'exemple classique, c'est-à-dire un tas quand nous avons un «gardien de sécurité maléfique» et un serveur avec une application Web, les ports ssh et https regardent le monde et nous voulons vraiment nous connecter au serveur MySQL. <br><br>  Donc: <br><br>  <code>ssh -f -N -L 9906:127.0.0.1:3306 user@server</code> (Juste notre cas avec MySQL) <br><br>  En conséquence, nous pouvons nous connecter au port local 9906 avec le client mysql et accéder à notre serveur «de sécurité». <br><br>  <code>ssh -D 8080 -q -C -N -f servername</code> (proxy de trafic via SOCKS via le port 8080) <br><br>  Avec cette commande, nous créons un serveur proxy socks5 en utilisant ssh.  Pour vérifier ses performances, nous pouvons utiliser la commande suivante: <br><br><pre> <code class="plaintext hljs">curl -x socks5h://server-with-proxy:8080 https://test.domain</code> </pre><br>  Un exemple classique de redirection de port à l'aide de ssh est lorsque le serveur auquel vous souhaitez vous connecter se trouve derrière le nat.  La commande suivante nous aidera à nous connecter à un tel serveur: <br><br>  <code>ssh -f -N -R 2255:localhost:22 username@servername</code> (transfert d'un serveur distant vers un serveur local). <br><br>  Sur le serveur distant, le port 2255 s'ouvrira, qui sera redirigé vers le port 22 de notre serveur pour le nat.  Pour se connecter à un tel serveur, nous pouvons utiliser la commande: <br><br><pre> <code class="plaintext hljs">ssh -p 2255 username@localhost</code> </pre><br>  Veuillez noter que: <br><br><ul><li>  -f - envoie ssh en arrière-plan; </li><li>  -N - n'exécute pas la commande sur l'hôte distant; </li><li>  -L - transmettre le port local (port local: machine locale: port distant); </li><li>  -R - port sur la machine distante; </li><li>  -q - mode silencieux; </li><li>  -D - définit le routage dynamique local des ports de niveau application; </li><li>  -C - demande de compression de données. </li></ul><br>  <b>Netcat (nc)</b> <br><br>  Notre prochain arrêt est Netcat, un utilitaire Unix qui vous permet d'établir des connexions TCP et UDP, de recevoir des données à partir de là et de les transférer.  Malgré son utilité et sa simplicité, cet utilitaire n'est inclus dans aucune norme et n'est fourni avec aucun kit de distribution.  En conséquence, il doit être installé à la main. <br><br>  L'une des fonctionnalités intéressantes de Netcat (nc) est la possibilité de scanner les ports: <br><br>  <code>nc -vn ipaddress 22</code> (balayage à port unique); <br>  <code>nc -v ipaddress 10-55</code> (balayage de la plage de ports); <br>  <code>nc -l 4444</code> (ouvrir et écouter le port 4444); <br>  <code>nc servername 4444</code> (nous nous connectons au serveur sur le port souhaité). <br><br>  Après avoir ouvert le port et s'y être connecté, nous obtenons une petite salle de discussion réseau =). <br><br>  Ensuite, nous considérons la possibilité de transférer des fichiers à l'aide de l'utilitaire nc.  Pour ce faire, la commande suivante nous aidera: <br><br> <code>cat test_file | pv -b | nc -l 4444</code>  <code>cat test_file | pv -b | nc -l 4444</code> (ouvrez le port et transférez-y le fichier via le canal, l'utilitaire pv avec le commutateur -b est utilisé pour afficher la progression du transfert de fichier en octets). <br><br> <code>nc servername 4444 | pv -b &gt; filename</code>  <code>nc servername 4444 | pv -b &gt; filename</code> (nous nous connectons au serveur pour recevoir le fichier, pv -b est utilisé de la même manière). <br><br>  Nous pouvons compliquer notre pipe en ajoutant l'archivage de fichiers à la volée: <br><br> <code>tar -czf - /path/to/ | pv -b | nc -l 4444</code>  <code>tar -czf - /path/to/ | pv -b | nc -l 4444</code> (archivage des dossiers à la volée et envoi); <br>  n <code>c servername 4444 | pv -b &gt; file.tar.gz</code>  <code>c servername 4444 | pv -b &gt; file.tar.gz</code> (obtenez l'archive envoyée). <br><br>  Une caractéristique peu évidente de nc est de créer juste un serveur http. <br><br><pre> <code class="plaintext hljs">while true; do nc -lp 80 &lt; index.html; done</code> </pre> <br>  Veuillez noter que pour utiliser le port 80, vous devez disposer des privilèges root. <br><br>  Notez également que: <br><br><ul><li>  -l - indique le mode de fonctionnement de l'écoute; </li><li>  -n - n'utilise pas les requêtes DNS; </li><li>  -v - sortie détaillée. </li></ul><br>  <b>Socat</b> <br><br>  C'est également un utilitaire utile qui vous permet d'établir des connexions TCP entre machines, ports de transfert, etc. Il fonctionne sur le principe de Netcat: il ouvre deux connexions bidirectionnelles, il peut transférer des données, des flux, etc. Cependant, il a une caractéristique intéressante.  Par exemple, en utilisant Socat, nous pouvons mapper les ports COM aux ports TCP, etc. <br><br>  Exemples de travaux Socat: <br><br>  <code>socat -u FILE:file_name TCP-LISTEN:5778,reuseaddr</code> # send file; <br> <code>socat -u TCP:192.168.1.48:5778 STDOUT | pv -r &gt; file_name</code>  <code>socat -u TCP:192.168.1.48:5778 STDOUT | pv -r &gt; file_name</code> # get file; <br>  <code>socat TCP-LISTEN:80,fork TCP:ubuntunode-4:80</code> # redirige le port du serveur distant vers le port local; <br>  <code>socat TCP-LISTEN:1234,reuseaddr EXEC:/bin/bash</code> # Open remote shell =); <br>  <code>socat - TCP:server_with_remote_shell:1234</code> # Connectez-vous au shell distant du serveur distant. <br><br>  Petit déchiffrement: <br><br><ul><li>  -u - utilisation du mode unidirectionnel; </li><li>  FICHIER - indique que nous utilisons le fichier; </li><li>  TCP-LISTEN - écoute le port TCP; </li><li>  reuseaddr - permet à d'autres sockets de communiquer avec la même adresse, même si elle est utilisée; </li><li>  fork - une fois la connexion établie, le canal est traité dans le processus enfant; </li><li>  TCP est le type de connexion. </li></ul><br>  <b>Dois-je regarder la version vidéo maintenant?</b> <br><br>  Bien sûr, oui, car dans la description, tout est présenté de manière abstraite.  De plus, les sujets du webinaire sont décrits plus en détail, et certains d'entre eux fournissent des exemples supplémentaires et des options de mise en œuvre.  Ainsi, si vous êtes intéressé par ce sujet, regardez l'intégralité de la leçon ouverte et répétez toutes les étapes pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vladimir Drozdetsky</a> pour une assimilation maximale du matériel.  Et n'oubliez pas de laisser vos commentaires. <br><br>  À notre tour, nous ne disons pas au revoir et vous invitons au cours <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Administrateur Linux</a> ! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr437114/">https://habr.com/ru/post/fr437114/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr437104/index.html">Introscope: enfin, tests unitaires très paresseux</a></li>
<li><a href="../fr437106/index.html">IT dans la zone .it</a></li>
<li><a href="../fr437108/index.html">La plupart des textes sur Internet sont écrits par des fous.</a></li>
<li><a href="../fr437110/index.html">Les nanomatériaux changent notre monde et nous n'avons toujours pas de procédures pour vérifier leur sécurité</a></li>
<li><a href="../fr437112/index.html">DMA: mythes et réalité</a></li>
<li><a href="../fr437116/index.html">AWS, MongoDB et les réalités économiques de l'open source</a></li>
<li><a href="../fr437118/index.html">AI et 2048. Partie 1: Méthode Monte Carlo</a></li>
<li><a href="../fr437120/index.html">Chaise de bureau coréenne: sensations Harachair Miracle</a></li>
<li><a href="../fr437122/index.html">Nommer les choses</a></li>
<li><a href="../fr437124/index.html">Un moyen simple d'ajouter plusieurs langues à votre site</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>