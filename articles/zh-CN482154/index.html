<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍💼 😒 🎰 为什么用final限制继承？ 👩🏻‍🔬 🌼 💚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="您可能听过GoF的这句著名的话：“更喜欢类继承而不是类继承。” 然后，作为一个规则，人们长思了如何静态确定的继承与动态组成相比没有那么灵活 。 


灵活性当然是有用的设计功能。 但是，在选择体系结构时，我们主要对可维护性，可测试性，代码可读性，模块重用感兴趣。 因此，使用这些好的设计标准，继承也是...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>为什么用final限制继承？</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482154/"><p> 您可能听过GoF的这句著名的话：“更喜欢类继承而不是类继承。” 然后，作为一个规则，人们长思了如何静态确定的继承与动态组成相比没有那么<em>灵活</em> 。 </p><br><p>灵活性当然是有用的设计功能。 但是，在选择体系结构时，我们主要对可维护性，可测试性，代码可读性，模块重用感兴趣。 因此，使用这些好的设计标准，继承也是一个问题。  “现在，根本不使用继承吗？”-您问。 </p><br><p>让我们看看通过继承在类之间建立强大的依赖关系如何使您的系统体系结构过于僵化和脆弱。 以及为什么在<code>final</code>代码中使用最神秘和难以捉摸的关键字之一。 使用一个简单的横断面示例演示了提出的想法。 在本文的结尾，有一些技巧和工具可以方便地完成<code>final</code>课程。 </p><br><p><img src="https://habrastorage.org/webt/ub/8n/_e/ub8n_esvqmijrl-trdc_xtpqtfe.gif" alt="脆弱的基层问题"></p><br><p>  <em>脆弱的基层问题</em> </p><a name="habracut"></a><br><p> 良好体系结构的主要标准之一是<a href="https://en.wikipedia.org/wiki/Loose_coupling" rel="nofollow">松耦合</a> ，它表征了软件模块之间的互连程度。 参与度低是<a href="https://ru.wikipedia.org/wiki/GRASP" rel="nofollow">GRASP模式</a>列表的一部分<a href="https://ru.wikipedia.org/wiki/GRASP" rel="nofollow">，</a>它描述了在班级之间分担责任的基本原则，这并非毫无道理。 </p><br><p> 参与度低有很多优点。 </p><br><ul><li> 通过放松软件模块之间的依赖性，您可以通过创建更灵活的体系结构来促进系统的维护和支持。 </li><li> 有可能并行开发松耦合模块，而不会破坏其功能。 </li><li> 类的逻辑变得更加明显，正确使用该类及其预期目的变得更容易，并且很难使用它-错误。 </li></ul><br><p> 传统上，系统中的依赖关系主要被理解为所使用的对象（服务）和使用的对象（客户端）之间的连接。 当服务是客户端的“一部分”时，这种关系<a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25B3%25D1%2580%25D0%25B5%25D0%25B3%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)" rel="nofollow">对聚合</a>关系进行建模（ <a href="https://en.wikipedia.org/wiki/Has-a" rel="nofollow">具有关系</a> ），并且客户端将行为的责任转移到嵌入其中的服务。  <a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle" rel="nofollow">依赖关系反转原理</a> （ <em>DIP</em> ）在削弱客户端与服务之间的关系方面起着关键作用，它提出将模块之间的直接依赖关系转换为对通用抽象的对等依赖关系。 </p><br><p> 但是，您还可以通过放松<a href="https://en.wikipedia.org/wiki/Is-a" rel="nofollow">is-a关系</a>框架内的依赖关系来显着改善应用程序体系结构。 默认继承关系会创建<a href="https://en.wikipedia.org/wiki/Tight_coupling" rel="nofollow">紧密耦合</a> ，这在所有可能的依赖关系形式中最强，因此应非常谨慎地使用。 </p><br><p><img src="https://habrastorage.org/webt/mv/u8/u0/mvu8u0gs0chkxt4jly0h0defdpe.jpeg" alt="关于继承的紧密联系"></p><br><p>  <em>关于继承的紧密联系</em> </p><br><p> 父类和子类之间共享的代码量非常大。 当滥用继承概念时，这个问题开始特别明显地表现出来-仅将继承用于水平代码重用，而不是用于创建专门的子类。 因为继承是重用代码的最简单方法。 您只需要编写<code>extends ParentClass</code>就可以了！ 毕竟，它比聚合， <a href="https://en.wikipedia.org/wiki/Dependency_injection" rel="nofollow">依赖项注入</a> （DI）和接口分配要简单得多。 </p><br><p> 传统上，通过使用范围的限制修饰符（ <code>private</code> ， <code>protected</code> ）可以减少继承层次结构中类链接的数量。 甚至有人认为，类属性应仅使用<code>private</code>修饰符声明。 而且，应该非常谨慎地将<code>protected</code>修饰符应用于方法，因为 它鼓励父类和子类之间的依赖关系。 </p><br><p> 但是，继承的问题不仅在于隐藏属性和方法，而且还更深层次。 关于应用程序体系结构的许多文献，包括经典的<a href="https://ru.wikipedia.org/wiki/Design_Patterns" rel="nofollow">GoF书籍，都</a>对继承表示怀疑，并建议寻求更灵活的设计。 但这仅仅是灵活性吗？ 我在下面提出将继承问题系统化的方法，然后考虑如何避免它们。 </p><br><p> 让我们将最简单的带有内部注释数组的注释块作为“实验兔”。 在任何项目中都可以找到大量带有内部集合的类似类。 </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Comment[]   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $comments = []; }</code> </pre> <br><p> 下面的示例以<a href="https://en.wikipedia.org/wiki/KISS_principle" rel="nofollow">KISS</a>样式故意简化，以显示代码中提出的思想。 您可以从本文中找到代码示例，以及在<a href="https://github.com/parshikovpavel/final-keyword" rel="nofollow">此存储库中</a>使用它们的详细注释。 </p><br><h2 id="problemy-nasledovaniya"> 继承问题 </h2><br><p> 让我们从最明显的问题开始，该问题主要在有关建筑的文献中给出。 </p><br><h3 id="nasledovanie-narushaet-princip-sokrytiya"> 继承违反隐藏原则 </h3><br><blockquote> 由于子类可以访问父类的实现细节，因此通常说继承违反了封装。 <br><br>  <em>GoF，设计模式</em> </blockquote><p> 尽管经典著作《四人帮》涉及封装违规问题，但说<em>“继承违反了隐蔽性原则”</em>会更准确。 毕竟， <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D0%25BA%25D0%25B0%25D0%25BF%25D1%2581%25D1%2583%25D0%25BB%25D1%258F%25D1%2586%25D0%25B8%25D1%258F_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)" rel="nofollow">封装</a>是数据与为其处理而设计的方法的结合。 但是<a href="https://en.wikipedia.org/wiki/Information_hiding" rel="nofollow">隐藏</a>的<a href="https://en.wikipedia.org/wiki/Information_hiding" rel="nofollow">原理</a>仅确保将系统某些组件的访问限制为其他组件的实现细节。 </p><br><p> 遵循架构中的隐藏原理，可以确保模块通过稳定的接口接合。 并且，如果该类允许继承，那么它将自动提供以下类型的稳定接口： </p><br><ul><li> 此类所有客户端使用的<em>公共接口</em> ； </li><li> 所有子类使用的<em>受保护接口</em> 。 </li></ul><br><p> 即 子类比公共API提供的功能要大得多。 例如，它可以影响隐藏在其<code>protected</code>属性中的父类的内部状态。 </p><br><p> 通常，子类不需要访问继承框架中可用的父类的所有元素，但是，您不能为某些子类有选择地提供对<code>protected</code>类成员的访问。 子类开始依赖于父类的<em>受保护接口</em> 。 </p><br><p> 通常，类继承的主要原因是通过重用其实现来扩展父类的功能。 如果最初通过<em>受保护的接口</em>访问父类的<em>实现</em>没有带来问题，那么随着系统的发展，程序员将开始在子类的方法中使用此访问，并加强层次结构中的链接。 </p><br><p> 现在，父类不仅被迫维护<em>公共接口的</em>稳定性，而且还必须维护<em>受保护接口的</em>稳定性，因为对它的任何更改都将导致子类的工作出现问题。 但是，不可能拒绝使用<code>protected</code>类成员。 如果<em>受保护的接口</em>将完全匹配外部<em>公共接口</em> ，即 父类将仅使用<code>public</code>和<code>private</code>成员，那么继承通常没有任何意义。 </p><br><p> 实际上， <code>protected</code>关键字实际上不为类成员提供任何保护。 要获得此类成员的访问权，就可以从班级继承，并且在子班级的框架内，您将有一切机会违反隐瞒原则。 错误地使用类变得非常容易，这是体系结构不佳的最初标志之一。 </p><br><p><img src="https://habrastorage.org/webt/kz/lj/u2/kzlju2j0kqgao50qols46uwvz0e.gif" alt="通过受保护的接口使用类"></p><br><p>  <em>通过受保护的界面违反隐藏原则</em> </p><br><p> 更重要的是，封装的元素（常量，属性，方法）不仅可以在子类中读取和调用，而且可以被覆盖。 这样的机会充满了潜在的危险-由于这种变化，子类的对象的行为可能变得与父类的对象不兼容。 在这种情况下，在代码中父类对象的行为可能导致无法预料的后果的那些点上替换子类的对象。 </p><br><p> 例如，我们添加<code>CommentBlock</code>类的功能： </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Comment[]   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $comments = []; <span class="hljs-comment"><span class="hljs-comment">/**       `$comments` */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: ?</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Comment</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key] ?? <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre> <br><p> 我们将从中继承自<code>CustomCommentBlock</code>类<code>CustomCommentBlock</code> ，在其中我们利用了打破隐藏的所有可能性。 </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *    * *    (information hiding) *     `CommentBlock::$comments`, *     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $comments)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments = $comments; } <span class="hljs-comment"><span class="hljs-comment">/** *    ,   `Comment::getKey()` * *       */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: ?</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Comment</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $comment) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($comment-&gt;getKey() === $key) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $comment; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre><br><p> 常见的隐瞒违规情况如下： </p><br><ul><li> 子类的方法显示父类的状态，并提供对父类的隐藏成员的访问。 设计父类时可能不会预见到这种情况，这意味着可能会违反其方法的逻辑。 <br> 在示例中，子类提供<code>CustomCommentBlock::setComments()</code> setter方法，以修改隐藏在父类中的受保护<code>CommentBlock::$comments</code>属性。 </li><li> 覆盖子类中父类方法的行为。 有时，开发人员认为此功能是通过创建具有修改行为的子类来解决父类问题的方法。 <br> 在此示例中，父类中的<code>CommentBlock::getComment()</code>方法依赖于<code>CommentBlock::$comments</code>关联数组中的键。 在子类中-到注释本身的键，可通过<code>Comment::getKey()</code>方法访问。 </li></ul><br><h3 id="problema-banan-obezyana-dzhungli"> 香蕉猴丛林问题 </h3><br><blockquote> 面向对象语言的问题在于它们会拖延整个隐式环境。 您只想要一个香蕉，但结果得到了一只大猩猩，盛着这种香蕉，还有所有的丛林。 <br><br>  <em>乔·阿姆斯特朗（Erlang）的创建者</em> </blockquote><p> 依赖关系始终存在于系统体系结构中。 但是，继承带有许多复杂因素。 </p><br><p> 您可能会遇到这样的情况，随着软件产品的发展，类层次结构已经显着增长。 举个例子 </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Block</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Block</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PopularCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CachedPopularCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PopularCommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-comment"><span class="hljs-comment">/* .... */</span></span></code> </pre> <br><p> 您继承并继承，但是您无法决定要继承哪些成员。 您继承了所有事物，并继承了整个层次结构树中所有类的成员。 此外，您对父类的实现，父类的父类等等都有很强的依赖性。 而且这些依赖关系不能以任何方式减弱（与<em>DIP</em>完成的聚合相反）。 </p><br><p> 更不用说这样一个事实，即在如此深层次中的叶子类几乎肯定会违反<a href="https://en.wikipedia.org/wiki/Single_responsibility_principle" rel="nofollow">单一职责原则</a> （ <em>SRP</em> ），知道并且做得太多。 您从一个简单的<code>Block</code>类开始开发，然后向其添加功能以选择注释，然后按流行度排序功能，附加的缓存...结果，您得到了一个类，它承担着很多责任，此外， <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B2%25D1%258F%25D0%25B7%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)" rel="nofollow">它们之间的连接松散</a> （ <a href="https://en.wikipedia.org/wiki/Cohesion_(computer_science)" rel="nofollow">内聚性低</a> ） </p><br><p> 您只想得到一根香蕉（在层次结构中创建一个叶子对象），而不必关心它如何到达最近的超市（行为的实现方式，该结果就是该对象）。 但是，通过继承，您不得不从丛林本身开始进行整个层次结构的实现。 您应该牢记丛林的功能及其实现的细微差别，而您要专注于香蕉。 </p><br><p> 结果，您的类的状态分布在许多父类中。 您只能通过封装和隐藏限制外部环境（丛林）对您的类的影响来解决此问题。 但是，通过继承是不可能实现的，因为 继承违反了隐瞒原则。 </p><br><p> 由于子类的实现分散在父类中，现在该如何在层次结构树中某个较深的位置测试子类？ 为了进行测试，您将需要所有父类，并且不能以任何方式覆盖它们，因为 您参与的不是行为，而是实施。 由于无法轻松地隔离和测试您的类，因此您将继承很多问题-具有可维护性，可扩展性和重用性。 </p><br><h3 id="otkrytaya-rekursiya-po-umolchaniyu"> 默认打开递归 </h3><br><p> 但是，子类不仅依赖于父类的<em>受保护接口</em> 。 他还与他部分分享一种物理认识，依靠它并可以影响它。 这不仅违反了隐瞒原则，而且使儿童班级的行为特别令人困惑和不可预测。 </p><br><p> 面向对象的语言默认情况下提供开放递归。 在PHP中，使用伪变量<code>$this</code>实现开放递归。 通过<code>$this</code>方法调用在文献中称为<em>自调用</em> 。 </p><br><p>  <em>自调用</em>导致当前类中的方法调用，或者可以根据后期绑定在继承层次结构中向上或向下动态重定向。 以此为依据， <em>自我呼叫</em>分为： </p><br><ul><li>  <em>down-call-</em>对方法的调用，该方法的实现在层次结构较低的子类中被覆盖。 </li><li>  <em>up-call-</em>对方法的调用，该方法的实现是从上级继承的父类继承的。 您可以通过<code>parent::method()</code>构造显式地在PHP中进行<em>向上调用</em> 。 </li></ul><br><p> 在方法的实现中频繁使用<em>下调用</em>和<em>上调用</em> ，使钩子类更加紧密，从而使体系结构变得脆弱。 </p><br><p> 让我们举个例子。 我们在父<code>CommentBlock</code>类中实现<code>getComments()</code>方法，该类返回一个注释数组。 </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-comment"><span class="hljs-comment">/** *        `getComment()`. * *        `CustomCommentBlock`, * ..   `CommentBlock::getComment()`  * `CustomCommentBlock::getComment()` . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $comments = []; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $comments[] = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getComment($key); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $comments; } }</code> </pre><br><p> 该方法依赖<code>CommentBlock::getComment()</code>的逻辑，并通过关联数组<code>$comments</code>的键<code>CommentBlock::getComment()</code> <code>$comments</code> 。 在<code>CommentBlock::getComments()</code>方法的<code>CustomCommentBlock</code>类的上下文中，将执行<code>CustomCommentBlock</code> <code>CommentBlock::getComments()</code>方法的<em>下调用</em> 。 但是， <code>CustomCommentBlock::getComment()</code>方法的行为与父类中预期的行为不同。 作为参数，此方法期望注释本身的<code>key</code>属性。 </p><br><p> 结果，从父类自动继承的<code>CommentBlock::getComments()</code>在行为上与<code>CustomCommentBlock::getComment()</code>不兼容。 在<code>CustomCommentBlock</code>上下文中调用<code>getComments()</code>很可能会返回一个<code>null</code>值数组。 </p><br><p> 由于参与度很高，因此在更改班级时，您不能仅关注其行为。 您被迫考虑所有类的内部逻辑，上下层次。 必须知道并记录父类中的<em>向下调用</em>的列表和顺序，这实质上违反了隐藏的原则。  <em>实施细节</em>成为父类合同的一部分。 </p><br><h3 id="kontrol-pobochnyh-effektov"> 副作用控制 </h3><br><p> 在前面的示例中，由于父类和子类中的<code>getComment()</code>方法的逻辑差异，问题很明显。 但是，仅控制类层次结构中方法行为的相似性是不够的。 如果这些方法有副作用，可能会遇到问题。 </p><br><p> 具有<a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D0%25B1%25D0%25BE%25D1%2587%25D0%25BD%25D1%258B%25D0%25B9_%25D1%258D%25D1%2584%25D1%2584%25D0%25B5%25D0%25BA%25D1%2582_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)" rel="nofollow">副作用的</a>功能（具有<a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D0%25B1%25D0%25BE%25D1%2587%25D0%25BD%25D1%258B%25D0%25B9_%25D1%258D%25D1%2584%25D1%2584%25D0%25B5%25D0%25BA%25D1%2582_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)" rel="nofollow">副作用的</a>功能）除了主要作用外，还会更改系统的某些状态-将结果返回给调用点。 副作用示例： </p><br><ul><li> 更改方法外部的变量（例如，对象属性）； </li><li> 更改方法局部的静态变量； </li><li> 与外部服务的互动。 </li></ul><br><p> 因此，这些副作用也是实现的<em>一部分</em> ，也无法在继承过程中有效地隐藏它们。 </p><br><p> 想象一下， <code>CommentBlock</code>需要在<code>CommentBlock</code>类中包含<code>viewComment()</code>方法，以获取其中一个注释的文本表示形式。 </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Comment[]   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $comments = []; <span class="hljs-comment"><span class="hljs-comment">/**         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } }</code> </pre> <br><p> 向子类添加副作用并指定其用途。 我们实现了<code>CountingCommentBlock</code>类， <code>CommentBlock</code>补充<code>CommentBlock</code>能够对缓存中单个注释的视图进行计数。 让该类通过<code>CounterInterface</code>接口（但是<a href="https://github.com/php-fig/fig-standards/pull/847/" rel="nofollow">最终</a>从PSR-16中<a href="https://github.com/php-fig/fig-standards/pull/847/" rel="nofollow">排除</a> ）接受在构造<a href="https://en.wikipedia.org/wiki/Dependency_injection" rel="nofollow">函数中注入</a> <a href="https://www.php-fig.org/psr/psr-16/" rel="nofollow">PSR-16</a>兼容的缓存（ <a href="https://en.wikipedia.org/wiki/Dependency_injection" rel="nofollow">构造函数注入</a> ）。 我们将使用<code>increment()</code>方法以原子方式递增缓存中的计数器值。 </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> CounterInterface  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $cache; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CounterInterface $cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache = $cache; } <span class="hljs-comment"><span class="hljs-comment">/**        */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;increment($key); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::viewComment($key); } }</code> </pre> <br><p> 一切正常。 但是，在某个时候，决定添加<code>viewComments()</code>函数以形成该块中所有注释的文本表示。 将此方法添加到<code>CommentBlock</code>基类，并且一目了然，由所有子类继承此方法的实现看起来非常方便，并且避免在子类中编写其他代码。 </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**           */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= $comment-&gt;view(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre> <br><p> 但是，父类对子类的实现功能一无所知。     <code>viewComments()</code>    (responsibility)  <code>CountingCommentBlock</code> –      . </p><br><p>  : </p><br><pre> <code class="php hljs">$commentBlock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CountingCommentBlock(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SomeCache()); <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> $commentBlock-&gt;viewComments();</code> </pre> <br><p>      .      ,     . </p><br><p>         «  »          .   ,    <code>viewComments()</code>     (  ). </p><br><h3 id="hrupkost-bazovogo-klassa">    </h3><br><p>  ,        . ,   ,             ,     .        – « <a href="https://ru.wikipedia.org/wiki/%25D0%25A5%25D1%2580%25D1%2583%25D0%25BF%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25B1%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B9_%25D0%25BA%25D0%25BB%25D0%25B0%25D1%2581%25D1%2581" rel="nofollow">  </a> » (" <a href="https://en.wikipedia.org/wiki/Fragile_base_class" rel="nofollow">Fragile base class</a> ").       «- »   <a href="https://habr.com/ru/post/331732/">  </a> –  (fragility). </p><br><p>    ,    <em> </em>     ?   . ,      <code>CommentBlock</code> ,               . </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Comment[]   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $comments = []; <span class="hljs-comment"><span class="hljs-comment">/**         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } <span class="hljs-comment"><span class="hljs-comment">/**           */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= $comment-&gt;view(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre> <br><p>   <code>CountingCommentBlock</code>           . </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> CounterInterface  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $cache; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CounterInterface $cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache = $cache; } <span class="hljs-comment"><span class="hljs-comment">/**        */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;increment($key); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::viewComment($key); } <span class="hljs-comment"><span class="hljs-comment">/**        */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;increment($key); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::viewComments(); } }</code> </pre> <br><p>              <code>CommentBlock::viewComments()</code> : </p><br><pre> <code class="php hljs">$view .= $comment-&gt;view();</code> </pre> <br><p>      ,    <code>viewComment()</code> , –     .            .      <code>viewComment()</code>  <code>viewComments()</code> .      ,   <code>CommentBlock::viewComment()</code>  <code>CommentBlock::viewComments()</code> : </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;viewComment($key); <span class="hljs-comment"><span class="hljs-comment">//  `$comment-&gt;view()` } return $view; } }</span></span></code> </pre> <br><p>     <code>CommentBlock</code>   ,  ,    .      <code>CommentBlock</code> –   ,  «».        . </p><br><p>     ,    .        <code>CountingCommentBlock</code> .  : </p><br><pre> <code class="php hljs">$commentBlock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CountingCommentBlock(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SomeCache()); <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> $commentBlock-&gt;viewComments();</code> </pre> <br><p>    : </p><br><pre> <code class="php hljs">CountingCommentBlock::viewComments() -&gt; CommentBlock::viewComments() -&gt; (n ) CountingCommentBlock::viewComment()</code> </pre> <br><p>            :   <code>CountingCommentBlock::viewComments()</code>  <code>CountingCommentBlock::viewComment()</code> . 即      –        .       <code>CountingCommentBlock</code> ,    ,  ! </p><br><p>         ,    <em>protected </em>  .     ,       .      .          ,    . </p><br><p>       .        ,     .         ,           .         ,      ,    « <a href="https://en.wikipedia.org/wiki/Yo-yo_problem" rel="nofollow"> -</a> ». </p><br><p>     ,     .     ,            « <em>  </em> ».       « <em> </em> »  <code>$this</code> ,            <code>private</code> ,    . </p><br><p> ,        . ,               ,      .     PHP      ( <code>public</code> , <code>protected</code> , <code>private</code> )    <code>final</code> . </p><br><h2 id="klyuchevoe-slovo-final">   final </h2><br><p>     PHP          .     ,    , ..     ,          ,   ,  . ,           <code>final</code> . </p><br><blockquote> PHP 5    <code>final</code> ,      ,       .         ,      . <br><br>  #1. <br>  ... <br>  #2 <br>  ... <br><br> :        ,    . </blockquote><p> <em>  PHP, « <a href="https://www.php.net/manual/ru/language.oop5.final.php" rel="nofollow">  final</a> »</em> </p><br><p>      PHP     .                   .     <code>final</code>     ,       . </p><br><p> ,  <code>final</code> –        PHP,         .      ,     PHP      :   <em>typehints</em> ,      .. </p><br><p>   <code>final</code> ,     ,       <a href="https://en.wikipedia.org/wiki/Defensive_programming" rel="nofollow"> </a> . 即              ,  .     . </p><br><p>   ,            ,   <code>private</code> ,         .          ,     . </p><br><p> ,   ,       ,      API.       ,      «»   ,    .      «»     -    .     «»           ,       . </p><br><p>     API     «  ».   ,                  . </p><br><p>    ,              <code>final</code>          . </p><br><h2 id="primenenie-final-dlya-uluchsheniya-arhitektury">  final    </h2><br><h3 id="pattern-shablonnyy-metod">  « » </h3><br><p>          –   .        ,       <em>public</em>  <em>protected</em> . </p><br><p>   ,     ,      .     PHP (    -)          .        –   ,        ,  ,    . </p><br><p>    ,     ()           .       « <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BC%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_(%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)" rel="nofollow"> </a> » ( <a href="https://en.wikipedia.org/wiki/Template_method_pattern" rel="nofollow">Template method</a> ). </p><br><p>     ,        : </p><br><ul><li> <u>   </u> .   ,   () .   <em> </em>  .       <code>final</code> .          –       . </li><li> <u>   </u> .       .     ,          .     <em> ()  </em> . </li></ul><br><p>     <em>  </em>   ,      <em>abstract </em> ,    ,  <em>final </em> ,     .      ,  ,      .          , ..      <code>final</code> . </p><br><p>      .  ,     ,         .    ,              .        . .., ,   -   ,    , , .            : </p><br><ul><li>       <code>abstract</code>      ; </li><li>        <code>final</code> ,  ,   . </li></ul><br><p>      .         « »     <em>abstract</em>  <em>final </em> . </p><br><p>     <code>CommentBlock</code> . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $comments = []; <span class="hljs-comment"><span class="hljs-comment">/**         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/**           */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;viewComment($key); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre><br><p>         <code>SimpleCommentBlock</code> : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } }</code> </pre> <br><p>  ,  ,   : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $cache; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CounterInterface $cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache = $cache; } <span class="hljs-comment"><span class="hljs-comment">/**        */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;increment($key); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } }</code> </pre> <br><p>      «»,       <em>   </em> .            <em>final </em>  <em>final </em> . </p><br><p>              . ,   .  ,    « »   <em>down-call</em> ,       ,     .      . </p><br><p>     ,        ,         .  ,         . </p><br><h3 id="predpochitay-realizaciyu-interfeysa-nasledovaniyu">     </h3><br><p>            - ,         .            <code>extends</code> ,     <code>implements</code> . </p><br><p>            -   .     <code>CommentBlock</code> : </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/**           */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; }</code> </pre><br><p>        : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $comments = []; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;viewComment($key); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre> <br><p>       ,  : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $comments = []; <span class="hljs-comment"><span class="hljs-comment">/**  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $cache; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CounterInterface $cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache = $cache; } <span class="hljs-comment"><span class="hljs-comment">/**        */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;increment($key); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;viewComment($key); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre><br><p>          <code>implements</code>  - <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D1%2581%25D1%2581%25D0%25BE%25D1%2586%25D0%25B8%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F_(%25D0%25BE%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BD%25D0%25BE-%25D0%25BE%25D1%2580%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)" rel="nofollow"></a> ( <a href="https://en.wikipedia.org/wiki/Association_(object-oriented_programming)" rel="nofollow"><em>association</em></a> )   . </p><br><p> -,    <em>   </em> .            -  .    <code>final</code> ,         :   ,         .. </p><br><p>  .  <em></em>            .  ,      <em></em>     <code>public</code> .       <code>implements</code> ,    ()        , ,    <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B8%25D0%25BD%25D1%2586%25D0%25B8%25D0%25BF_%25D1%2580%25D0%25B0%25D0%25B7%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F_%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D1%2584%25D0%25B5%25D0%25B9%25D1%2581%25D0%25B0" rel="nofollow">  </a> ( <a href="https://en.wikipedia.org/wiki/Interface_segregation_principle" rel="nofollow">ISP</a> ).             ,      . </p><br><p>    <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B8%25D0%25BD%25D1%2586%25D0%25B8%25D0%25BF_%25D0%25BE%25D1%2582%25D0%25BA%25D1%2580%25D1%258B%25D1%2582%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8/%25D0%25B7%25D0%25B0%25D0%25BA%25D1%2580%25D1%258B%25D1%2582%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8" rel="nofollow"> /</a> ( <a href="https://en.wikipedia.org/wiki/Open%25E2%2580%2593closed_principle" rel="nofollow">OCP</a> )?     <code>final</code>  <code>implements</code> –     PHP    . </p><br><p>   , ,   ,    .    ,     <code>implements</code> ,     .          . </p><br><p>   <code>final</code>  ,         .     .     –        ,            <code>implements</code>       <code>final</code> . </p><br><p>        « »,    .   <code>implements</code>       ,    <code>final</code>       . </p><br><p>   ,     « »,      ,       .       –   <code>SimpleCommentBlock</code>  <code>CountingCommentBlock</code>      <code>viewComments()</code>         . </p><br><h3 id="predpochitay-agregaciyu-nasledovaniyu">    </h3><br><p> ,     <code>viewComments()</code>     ,       , , ,   .        ,      .        <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D0%25BA%25D0%25BE%25D1%2580%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580_(%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)" rel="nofollow"> </a> ( <a href="https://en.wikipedia.org/wiki/Decorator_pattern" rel="nofollow">decorator pattern</a> ).         ,   « », –    <code>final</code>    ,    <code>implements</code> . </p><br><p>     ,   <code>CommentBlock</code> ,      . </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCommentKeys</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/**         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/**           */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; }</code> </pre> <br><p>  ,      <code>getCommentKeys()</code>    .           .    ,        <em>protected </em> ,            <code>CommentBlock</code> . </p><br><p> <code>SimpleCommentBlock</code>      - «»  . ,    ,      <code>implements</code>       <code>final</code> . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $comments = []; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCommentKeys</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> array_keys(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;viewComment($key); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre><br><p> <code>CountingCommentBlock</code>  - «»             –     <abbr title="Open–closed principle">OCP</abbr> . <code>CountingCommentBlock</code>   :        <code>CommentBlock</code>      . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**  CommentBlock */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $commentBlock; <span class="hljs-comment"><span class="hljs-comment">/**  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $cache; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CommentBlock $commentBlock, CounterInterface $cache)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commentBlock = $commentBlock; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache = $cache; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCommentKeys</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commentBlock-&gt;getCommentKeys(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;increment($key); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commentBlock-&gt;viewComment($key); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $commentKeys = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getCommentKeys(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($commentKeys <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $commentKey) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cache-&gt;increment($commentKey); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commentBlock-&gt;viewComments(); } }</code> </pre> <br><p> - <code>CountingCommentBlock</code>           . ,  <code>viewComment()</code>       .      ( <em>forwarding methods</em> ). </p><br><p>          ,     « ».   <code>getCommentKeys()</code> .   ,  «»        ,         ,        . </p><br><p>         ,    .   ,    -       «»  .  ,      –         ( ,  SOLID)     ( ,  ,   ). </p><br><p>     .  <code>SimpleCommentBlock</code>  <code>CountingCommentBlock</code>    <code>CommentBlock</code> ,       .           -,     . </p><br><p> ,           <em> </em>  <em>  </em> ,    <code>final</code>        <em>   </em> ,       <code>CommentBlock</code> . </p><br><p>   <code>SimpleCommentBlock</code>  <code>CountingCommentBlock</code>    -  « »,            .   « »    ,     .            ,       « ».       –        . </p><br><p>     ,  <code>final</code>   ,   .     ,     «--»   –         .    <abbr title="Dependency inversion principle">DIP</abbr> ,       . </p><br><p>       : <code>SimpleCommentBlock</code> –     ;  <code>CountingCommentBlock</code> –   <code>SimpleCommentBlock</code> ,       (). 即      ,        –    <abbr title="Single responsibility principle">SRP</abbr> .     ,    ,     ( <em>cohesion</em> )          . </p><br><p>       «  » –      (, , ),    ,      .       ,                  . </p><br><p>   . </p><br><p>     <code>viewRandomComment()</code>    <code>SimpleCommentBlock</code>         - <code>CountingCommentBlock</code> .    ,                –   <code>viewRandomComment()</code>     .  <code>CountingCommentBlock::viewRandomComment()</code>      . </p><br><p>  ,    <code>viewComments()</code>    <code>SimpleCommentBlock</code>       . <code>CountingCommentBlock</code>         <code>SimpleCommentBlock</code> ,     . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewRandomComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $key = array_rand(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } <span class="hljs-comment"><span class="hljs-comment">/**      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { <span class="hljs-comment"><span class="hljs-comment">/*    `$this-&gt;viewComment()`      */</span></span> $view .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre> <br><h3 id="klass-dolzhen-byt-podgotovlen-k-nasledovaniyu">       </h3><br><p>       :    ,  ,       ,   ,   ,   ..           . </p><br><p>    PHP     ,  ,        <code>final</code> ,          .     , ,   ,    .          ,      .        .         –        ,     –         . </p><br><p>      ,            .     <a href="" rel="nofollow">PHPDoc</a>   ,           .     :           . </p><br><p>     ,         ,    (.. ,   <code>public</code>  <code>protected</code> ).  <a href="" rel="nofollow">PSR-19: PHPDoc tags</a> ,    ,        .         <em>PHPDoc</em> ,     «    -». </p><br><p>     <a href="https://en.wikipedia.org/wiki/Javadoc" rel="nofollow">JavaDoc</a>  <a href="https://openjdk.java.net/jeps/8068562" rel="nofollow">@implSpec</a> ,              .  , <em>PHPDoc</em>   <em>API</em>         , ..  <em>public </em> .  <code>@implSpec</code>     ,    <em>API</em> .        ,    <em>protected </em>     . </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-comment"><span class="hljs-comment">/** *         *       *  (,    ) * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@implSpec</span></span></span><span class="hljs-comment">      `$key` *    `$this-&gt;comments`      `view()` * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $key   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments[$key]-&gt;view(); } }</code> </pre><br><p>  <em>PHPDoc</em>    <code>@implSpec</code>     .        <code>$key</code>      .        –     <code>view()</code> . </p><br><p>        ,     <code>@implSpec</code> : </p><br><ul><li>         (   ,  ,    ,    ..). </li><li>              <code>parent::method()</code> . </li></ul><br><p>  ,   «»  .  ,  <em>self-call</em>  ( <code>$this</code> )  ,      ,  : </p><br><ul><li>        <code>$this</code> ; </li><li>    ; </li><li>    . </li></ul><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-comment"><span class="hljs-comment">/** *           * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@implSpec</span></span></span><span class="hljs-comment">    `$this-&gt;comments` *        `$this-&gt;viewComment()`. *       . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ $view = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;comments <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $comment) { $view .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;viewComment($key); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; } }</code> </pre><br><p>  ,   <code>viewComments()</code>   <code>final</code>       .       <code>viewComment()</code> ,        .        : </p><br><ul><li>    <code>viewComment()</code>   <code>viewComments()</code> ; </li><li>       <code>viewComments()</code>   <code>viewComment()</code> . </li></ul><br><p>     ,    .       ,      ,        .  «  »,     <code>CommentBlock</code>  <code>CountingCommentBlock</code> ,  .         <code>viewComment()</code>    <code>viewComments()</code> ,   ,      . </p><br><p>      ,   ,    .  <em>PHPDoc</em>     <em>API</em>        :       ,      ,    . </p><br><p>  ,     ,    ,    ,    ,            ,  «».       –   .  <em>PHPDoc</em>      ,         . </p><br><p> ,           ,            .   –          <code>final</code> ,        .        .          – «            ». </p><br><p>           : </p><br><ul><li>    .              ; </li><li>       <code>final</code> .  . </li></ul><br><p>  , ,   <code>final</code>      .      <code>final</code>     ,        .          ,       .         ,        ? </p><br><p>   <code>final</code>            .     ,      ,     .   ,       ,  <code>final</code>     ,   . </p><br><h3 id="final-zastavlyaet-zadumatsya-o-neobhodimosti-nasledovaniya"> final      </h3><br><p>      « »,    ,     , ,  ,    .  ,      <em>protected </em>   .   ,   <code>final</code> –     ,    ,     ,      <em>public </em> ,    . </p><br><p>       ,    ,      .  ,            ,   ,   .   –    <code>final</code> . </p><br><p>        ,           <code>final</code> ? 不行  -   ,      <em>Opensource</em> ,    ,    .              <em>IDE</em> .  ,           . </p><br><p> ,  ,     <code>final</code>      .      <code>final</code>  ,              .          . </p><br><p> <code>final</code>     ,           .          <em>public </em> ?           –     ,   ? </p><br><p>      ,           .   ,      <code>final</code> ,      ,   <em>protected </em>  . </p><br><p> <code>final</code>       ,              <em>code review</em> (    <em>code review</em> ? ;). , . </p><br><ul><li>      <code>final</code> ?    ? ? </li><li>      <code>final</code> ?             ?       ? </li></ul><br><p>            .        ,   ,    <em>code review</em>       .     . </p><br><p>    .   <code>final</code>        <em>PHP5</em> . ,  ,     ( ,   )        . </p><br><p>       ,             ,     .     « »      ,   . ,  <em>C#</em>          <code>virtual</code> ,    – <code>override</code> .     <em>PHP</em>  <code>final</code>    <code>extandable</code> ,    «       <code>final</code> »,              <code>extend</code>    . </p><br><h3 id="klass-dolzhen-byt-podgotovlen-k-agregacii">       </h3><br><p> ,      –    .     .          .               . </p><br><p>    . ,   .    ,        .     <code>final</code>    ,      ,    -.  ,     ,    <code>implements</code>      . </p><br><p>  ,        ,   <code>final</code>       . </p><br><ol><li><p>         <code>final</code>    : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCommentKeys</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } }</code> </pre> <br></li><li><p>         .   , <code>final</code>          .          ,      .            . </p><br><p>   ,      <code>public</code>      . ,               ,     . </p><br><p>        ,              . </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCommentKeys</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; }</code> </pre><br></li><li><p>     . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br></li><li><p>     -,          .   -    <code>CommentBlock</code>   .  -           . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $commentBlock; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CommentBlock $commentBlock </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/* ,... */</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commentBlock = $commentBlock; } <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br></li></ol><br><p>             ,     .  ,       <code>final</code>  ,    ,     -   .   ,         <code>final</code>   . </p><br><p>      <code>final</code> ,      .   ,             «».   ,          .         <code>final</code>      . </p><br><h3 id="ispolzovanie-final-klassov-v-testah">  final    </h3><br><p>         <code>final</code>       –     ( <em>PHPUnit, Mockery</em> )     <em> «»</em> ( <a href="https://en.wikipedia.org/wiki/Test_double" rel="nofollow">test doubles</a> ).       ,           . </p><br><p> ,  : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlockTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testCreatingTestDouble</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $mock = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createMock(SimpleCommentBlock::class); } }</code> </pre> <br><p>   : </p><br><pre> <code class="bash hljs">Class <span class="hljs-string"><span class="hljs-string">"SimpleCommentBlock"</span></span> is declared <span class="hljs-string"><span class="hljs-string">"final"</span></span> and cannot be mocked.</code> </pre> <br><p>   ,   « » <em>PHPUnit</em>    ,  : </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mock_SimpleCommentBlock_591bc3f3</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><p>      <em> «»</em> . -,           , ..   . , -,    ,   <em>PHPUnit</em>       . ,      . </p><br><p>   <code>final</code>               .         :   .   . </p><br><p> <strong> </strong> </p><br><p>    –     <em> «»</em>   . ,    ( <code>Post</code> , <code>Comment</code> )  - ( <a href="https://en.wikipedia.org/wiki/Value_object" rel="nofollow">value object</a> )   ( <em>stable</em> )      .       .    <a href="https://martinfowler.com/articles/mocksArentStubs.html" rel="nofollow">classical TDD</a> (  <a href="https://martinfowler.com/articles/mocksArentStubs.html" rel="nofollow">mockist TDD</a> ) </p><br><p>  ,      ( <em>volatile</em> )       .   ,  ,  <em> «»</em> –     ,   .   ,  <em> «»</em>        ,       .           ( <em>DIP</em> ),      ,  <em> «»</em>       . </p><br><p>  ,            . 即     : </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><p>     : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><p>      <em> «»</em> : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlockTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testCreatingTestDouble</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $mock = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createMock(CommentBlock::class); } }</code> </pre> <br><p>        <em> «»</em>    ,       .    : </p><br><ul><li>      <em> «»</em> ; </li><li>         ; </li><li> <em> «»</em>       , ..  <em>DIP</em>      . </li></ul><br><p> <strong> </strong> </p><br><p>   ,    «» –      ,     -. ,         (  ,  ).           ,    «   »  «    ». </p><br><p> ,          <code>final</code>   . </p><br><p>   –     -.          -. ,   -,       .         <a href="http://docs.mockery.io/en/latest/reference/final_methods_classes.html" rel="nofollow"> </a>   <a href="https://github.com/mockery/mockery" rel="nofollow">Mockery</a> . </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlockTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testCreatingProxyDouble</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> $simpleCommentBlock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SimpleCommentBlock(); <span class="hljs-comment"><span class="hljs-comment">/*  - */</span></span> $proxy = Mockery::mock($simpleCommentBlock); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> $proxy-&gt;shouldReceive(<span class="hljs-string"><span class="hljs-string">'viewComment'</span></span>) -&gt;andReturn(<span class="hljs-string"><span class="hljs-string">'text'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals(<span class="hljs-string"><span class="hljs-string">'text'</span></span>, $proxy-&gt;viewComment(<span class="hljs-string"><span class="hljs-string">'1'</span></span>)); <span class="hljs-comment"><span class="hljs-comment">/* `$proxy`     `SimpleCommentBlock`  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertNotInstanceOf(SimpleCommentBlock::class, $proxy); } }</code> </pre><br><p>     – -             .   ,      <code>instanceof</code> .      <a href="https://www.php.net/manual/ru/functions.arguments.php" rel="nofollow"> </a> ( <a href="https://www.php.net/manual/en/functions.arguments.php" rel="nofollow"><em>type declarations</em></a> ),  -     . </p><br><p>   « » –  PHP,        ,   .       <a href="https://github.com/dg/bypass-finals" rel="nofollow">Bypass Finals</a> ,             <code>final</code>   .     <em>composer</em>    <code>final</code>      : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testUsingBypassFinals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*   `final` */</span></span> BypassFinals::enable(); $mock = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createMock(SimpleCommentBlock::class); }</code> </pre> <br><h3 id="instrumenty-dlya-udobnoy-raboty-s-final-klassami">      final  </h3><br><p> ,  PHP       .      « »     ,      <code>final</code>  .  ,   <em>IDE</em>     <code>final</code>     . </p><br><p> <strong>PHPStorm   </strong> </p><br><p>  <em>PHPStorm</em>       .      <strong>File | Settings | Editor | File and Code Templates</strong>   <strong>Files</strong>    <strong>PHP Class</strong> .        <code>final</code> . </p><br><p> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/ss/ox/hd/ssoxhdbjwapvnacnr2yfxbbk5nk.png" alt="   `PHP Class`"></a> </p><br><p>      <strong>File | New | PHP Class</strong>     : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br><p> ,    .          .      –  . </p><br><p>    <em>PHPStorm</em>     <strong>Refactor | Extract | Interface</strong> .        ,   .           ( <strong>Replace class reference with interface where possible</strong> )   <em>PHPDoc</em>   ( <strong>Move PHPDoc</strong> ). </p><br><p>      : </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** PHPDoc */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; }</code> </pre> <br><p>       : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } }</code> </pre> <br><p>     <strong>File | New | PHP Class</strong>     -,  .             : </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> CommentBlock */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $commentBlock; }</code> </pre> <br><p>       <strong>Code | Generate | Constructor</strong> .         . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CommentBlock $commentBlock)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commentBlock = $commentBlock; } }</code> </pre><br><p>    –      .   <strong>Code | Generate | Implement Methods</strong> .  ,        .     <em>PHPStorm</em>      «»       ,       <em>IntelliJ IDEA</em>  <em>ReSharper</em> . </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CountingCommentBlock</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentBlock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritDoc</span></span></span><span class="hljs-comment"> */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $key)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Implement viewComment() method. } }</span></span></code> </pre> <br><p> PHPDoc     .     . </p><br><p> <strong>PHPStan    </strong> </p><br><p>        ,          . ,    , ,      <code>final</code>    .          ( <a href="https://habr.com/ru/company/badoo/blog/426605/">  </a> ). </p><br><p>      <a href="https://github.com/phpstan/phpstan" rel="nofollow">PHPStan</a> .  « »        .  <em>PHPStan</em>            .           . </p><br><p>        <a href="https://github.com/localheinz/phpstan-rules/blob/master/src/Classes/FinalRule.php" rel="nofollow"><code>FinalRule</code></a>    <a href="https://github.com/localheinz/phpstan-rules" rel="nofollow"><code>localheinz/phpstan-rules</code></a> .     <code>PHPStan\Rules\Rule</code>        <code>processNode()</code> . </p><br><p>      . ,   <code>FinalRule</code>         « »   <code>allowAbstractClasses</code> .   ,    ,     <code>classesNotRequiredToBeAbstractOrFinal</code> . </p><br><p>          ,    <em>composer</em> : </p><br><pre> <code class="bash hljs">composer require --dev phpstan/phpstan composer require --dev localheinz/phpstan-rules</code> </pre> <br><p>   <code>FinalRule</code>    <code>phpstan.neon</code>   : </p><br><pre> <code class="plaintext hljs">services: - class: Localheinz\PHPStan\Rules\Classes\FinalRule arguments: allowAbstractClasses: true classesNotRequiredToBeAbstractOrFinal: [] tags: - phpstan.rules.rule</code> </pre> <br><p>          ( <code>max</code> ): </p><br><pre> <code class="bash hljs">vendor/bin/phpstan -lmax analyse src</code> </pre> <br><p>     : </p><br><pre> <code class="plaintext hljs"> ------ ------------------------------------------------------------------------ Line CommentBlock.php ------ ------------------------------------------------------------------------ 10 Class CommentBlock is neither abstract nor final. ------ ------------------------------------------------------------------------</code> </pre> <br><p>     <em>JSON</em>      <em>Continuous Integration</em> . </p><br><h2 id="zaklyuchenie"> 结论 </h2><br><p> ,    :     <code>final</code>  !       IDE,    . </p><br><p> ,       ,        .      –    <em>SOLID</em>   .      ,         ,          . </p><br><p> ,           .   : </p><br><ul><li>              ; </li><li>   <code>final</code> , ,  ,    ; </li><li>            . </li></ul><br><p>     ,   -      - .             .           .  ,           , ,      ,         .   ,       .        ? </p><br><p>   ,      –    ,     .       <code>final</code>     .       <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B5%25D0%25BE%25D1%2580%25D0%25B8%25D1%258F_%25D0%25BA%25D0%25BE%25D0%25B3%25D0%25BD%25D0%25B8%25D1%2582%25D0%25B8%25D0%25B2%25D0%25BD%25D0%25BE%25D0%25B9_%25D0%25BD%25D0%25B0%25D0%25B3%25D1%2580%25D1%2583%25D0%25B7%25D0%25BA%25D0%25B8" rel="nofollow"> </a> ( <a href="https://en.wikipedia.org/wiki/Cognitive_load" rel="nofollow">cognitive load</a> ) –          .     –       . </p><br><p>         :        <code>final</code> .            .   –      .        .            .    ,      .  ,     . </p><br><p>   <code>final</code>        .    ( <em>SOLID</em> )     ( <em>fragile</em> ) .         ,      . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN482154/">https://habr.com/ru/post/zh-CN482154/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN482134/index.html">混合动力车的比较或罗马尼亚Meze耳机的所有者的期望价格为84990和239990卢布</a></li>
<li><a href="../zh-CN482140/index.html">适合4-10岁的年轻程序员的棋盘游戏。 2019年底在市场上可以找到什么</a></li>
<li><a href="../zh-CN482142/index.html">23分钟 机灵的理由</a></li>
<li><a href="../zh-CN482146/index.html">通过设计来保护隐私，或者如何创建应用程序以免从市场崩溃</a></li>
<li><a href="../zh-CN482152/index.html">实时操作系统中的漏洞</a></li>
<li><a href="../zh-CN482156/index.html">威尔·库尔特（Will Kurt）采访他的新书《贝叶斯统计-太好了》</a></li>
<li><a href="../zh-CN482162/index.html">数学家找到了一种模式，了解如何避免其出现</a></li>
<li><a href="../zh-CN482166/index.html">机场的狗狗训练服务：您已经被嗅探到</a></li>
<li><a href="../zh-CN482168/index.html">“时钟敲十二点。” 或浏览器中的花环</a></li>
<li><a href="../zh-CN482170/index.html">处理器大战。 蓝兔和红龟的故事</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>