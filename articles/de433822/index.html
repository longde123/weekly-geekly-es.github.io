<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🏫 🖐🏿 🤙🏾 Komplette CMake-Anleitung. Dritter Teil: Testen und Verpacken 👩🏾‍🎨 👶 🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einführung 


 Dieser Artikel beschreibt das Testen und Verpacken von Programmen mit CMake, einem flexiblen und vielseitigen Dienstprogramm zur Entwic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Komplette CMake-Anleitung. Dritter Teil: Testen und Verpacken</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433822/"><p><img src="https://habrastorage.org/webt/lf/se/70/lfse70sjifxiyddiuym73hdvcho.png"></p><br><h1 id="vvedenie">  Einführung </h1><br><p>  Dieser Artikel beschreibt das Testen und Verpacken von Programmen mit CMake, einem flexiblen und vielseitigen Dienstprogramm zur Entwicklung verschiedener Softwareprodukte.  Es wird dringend empfohlen, den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ersten</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zweiten</a> Teil des Handbuchs zu lesen, um Missverständnisse bei der Syntax und der Funktionsweise von CMake zu vermeiden. </p><a name="habracut"></a><br><h1 id="zapusk-cmake">  CMake-Start </h1><br><p>  Im Folgenden finden Sie Beispiele für die Verwendung der CMake-Sprache, die Sie üben sollten.  Experimentieren Sie mit dem Quellcode, indem Sie vorhandene Befehle ändern und neue hinzufügen.  Installieren Sie CMake von der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offiziellen Website</a> , um diese Beispiele auszuführen. </p><br><h1 id="primer-testirovaniya">  Testbeispiel </h1><br><p> Wie bereits erwähnt, unterstützt CMake das automatische Testen von Programmen.  Diese Funktion ist sehr einfach zu bedienen - schreiben Sie einfach ein paar Befehle in die übliche <code>CMakeLists.txt</code> und führen Sie die Tests dann mit <code>ctest</code> oder <code>make test</code> .  Zu Ihrer Verfügung stehen eine Überprüfung der Programmausgabe, eine dynamische Speicheranalyse und vieles mehr. </p><br><p>  Wir werden den Prozess des Testens des Programms anhand eines bestimmten Beispiels betrachten.  Die Quelldatei <code>Multiply.c</code> enthält den folgenden Code: </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #define ARG_COUNT 3 int main(const int argc, const char *argv[]) { if (argc != ARG_COUNT) { fprintf(stderr, "Error!\n"); return EXIT_FAILURE; } const int first = atoi(argv[1]); const int second = atoi(argv[2]); printf("The result is: %d\n", first * second); return EXIT_SUCCESS; }</span></span></span></span></code> </pre> <br><p>  Dieser Code zeigt das Ergebnis der Multiplikation zweier Argumente mit der Konsole an.  Bitte beachten Sie, dass eine Situation des Auftretens eines Fehlers auch dann möglich ist, wenn die tatsächliche Anzahl der Argumente nicht den Erwartungen entspricht: In diesem Fall wird der Fehler an den Fehlerstrom ausgegeben <code>Error!</code>  . </p><br><p>  Im selben Verzeichnis befindet sich die Datei <code>CMakeLists.txt</code> mit einer Beschreibung des Erstellungsprozesses, die den folgenden Code enthält: </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">cmake_minimum_required</span></span>(VERSION <span class="hljs-number"><span class="hljs-number">3.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">project</span></span>(MyProgram) <span class="hljs-keyword"><span class="hljs-keyword">add_executable</span></span>(Multiply Multiply.c) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(MULTIPLY_TIMEOUT <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">#   : enable_testing() #  : add_test(FirstTest Multiply 15 207) add_test(SecondTest Multiply -54 -785) add_test(ThirdTest Multiply 85234) #   : set_tests_properties(FirstTest SecondTest ThirdTest PROPERTIES TIMEOUT ${MULTIPLY_TIMEOUT}) set_tests_properties(FirstTest PROPERTIES PASS_REGULAR_EXPRESSION "The result is: 3105" FAIL_REGULAR_EXPRESSION "Error!") set_tests_properties(SecondTest PROPERTIES PASS_REGULAR_EXPRESSION "The result is: 42390" FAIL_REGULAR_EXPRESSION "Error!") set_tests_properties(ThirdTest PROPERTIES PASS_REGULAR_EXPRESSION "Error!")</span></span></code> </pre> <br><p>  Betrachten wir alles in Ordnung.  Die ersten vier Befehle sollten Ihnen aus dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherigen Artikel bekannt sein</a> , und der nächste Befehl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>enable_testing</code></a> wirft eine Reihe von Fragen auf.  Im Wesentlichen benachrichtigt dieser Befehl CMake nur über Ihre Absicht, das Programm zu testen, und generiert gleichzeitig einige Konfigurationsdateien, deren Existenz Sie nicht kennen müssen. </p><br><p>  Die folgenden drei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>add_test</code></a> fügen dem aktuellen Projekt Tests hinzu.  Die Kurzform dieses Befehls verwendet den Namen des Tests als erstes Argument, und die nachfolgenden Argumente bilden einen Shell-Befehl zum Ausführen des Tests. </p><br><p>  Eine Reihe von Befehlen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>set_tests_properties</code></a> legt das Verhalten einzelner Tests fest.  Nach der Liste der <code>PROPERTIES</code> folgt das Schlüsselwort <code>PROPERTIES</code> , das den Beginn der Liste der Eigenschaften mit der Form <code>&lt; &gt; &lt; &gt;</code> signalisiert und für die ausgewählten Tests festgelegt wird.  Eine vollständige Liste der verfügbaren Immobilien finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p><br><p>  Für alle Tests wird die maximale Ausführungszeit mit der Eigenschaft <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>TIMEOUT</code></a> auf eine Sekunde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>TIMEOUT</code></a> Für die nachfolgenden Tests wird die erwartete Ausgabe mit den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>FAIL_REGULAR_EXPRESSION</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>PASS_REGULAR_EXPRESSION</code></a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>FAIL_REGULAR_EXPRESSION</code></a> mit dem Ausdruck <code>Error!</code> stoppt <code>Error!</code> Test und gilt als fehlgeschlagen). </p><br><h1 id="sposoby-vklyucheniya-testirovaniya">  Möglichkeiten zum Testen </h1><br><p>  Es gibt ein Analogon zum <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>enable_testing</code></a> - dies ist die Einbeziehung des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>CTest</code></a> Moduls durch den Befehl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>include</code></a> .  Im Allgemeinen ist die Aufnahme eines Moduls universeller, aber es gibt immer noch einen Unterschied zwischen ihnen. </p><br><p>  Der Befehl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>enable_testing</code></a> ermöglicht das Testen des aktuellen Verzeichnisses sowie aller nachfolgenden Verzeichnisse.  Es sollte sich im Stammverzeichnis <code>CMakeLists.txt</code> , da CTest eine Testdatei im Stammverzeichnis der Assembly erwartet. </p><br><p>  Durch Aktivieren des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>CTest</code></a> Moduls wird das Projekt für das Testen mit CTest / CDash konfiguriert und automatisch die Option <code>BUILD_TESTING</code> ermittelt, die true akzeptiert, wenn das Testen möglich ist (standardmäßig - <code>ON</code> ).  Wenn Sie diesen Befehl verwenden, ist es daher sinnvoll, den Testprozess folgendermaßen zu beschreiben: </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(BUILD_TESTING) <span class="hljs-keyword"><span class="hljs-keyword">add_test</span></span>(FirstTest <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">add_test</span></span>(SecondTest <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">add_test</span></span>(ThirdTest <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  ... endif()</span></span></code> </pre> <br><h1 id="ispolnenie-testirovaniya">  Testausführung </h1><br><p>  Eine Reihe von <code>cmake . &amp;&amp; cmake --build . &amp;&amp; ctest .</code> Befehlen <code>cmake . &amp;&amp; cmake --build . &amp;&amp; ctest .</code> <code>cmake . &amp;&amp; cmake --build . &amp;&amp; ctest .</code>  Alle drei Tests werden ausgeführt.  Der <code>ctest -R &lt;RegularExpression&gt;</code> führt eine Reihe von Tests aus, die einem bestimmten regulären Ausdruck entsprechen.  Beispielsweise führt der <code>ctest -R ThirdTest</code> nur den dritten Test aus. </p><br><h1 id="primer-paketirovaniya">  Verpackungsbeispiel </h1><br><p>  Um ein Paket aus Quelldateien, Bibliotheken und ausführbaren Dateien zu erstellen, müssen Sie nur die Installation der erforderlichen Dateien mit dem Befehl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>install</code></a> und dann das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>CPack</code></a> Modul <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>CPack</code></a> dem Befehl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>CPack</code></a> aktivieren: </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "Multiply"   "bin": install(TARGETS Multiply DESTINATION bin) #    : set(CPACK_PACKAGE_NAME "Multiply") set(CPACK_PACKAGE_VENDOR "MyCompany") set(CPACK_PACKAGE_CONTACT "https://myprojectsite.org") set(CPACK_DEBIAN_PACKAGE_MAINTAINER "mycontacts@gmail.com") set(CPACK_PACKAGE_DESCRIPTION "The most stupid program ever written") #    : set(CPACK_GENERATOR "DEB") #    "CPack": include(CPack)</span></span></code> </pre> <br><p>  In diesem Fall benachrichtigt der Befehl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>install</code></a> Paketgenerator über das Installationsverzeichnis des Ziels <code>Multiply</code> .  Ohne das Schreiben von Installationsbefehlen ist keine Paketerzeugung möglich. </p><br><p>  Im Folgenden werden die Eigenschaften des Pakets aufgelistet, indem mehrere Variablen festgelegt werden.  Tatsächlich gibt es viele solcher Variablen, die Pakete richtig verpacken.  Die meisten von ihnen sind optional, aber einige Paketgeneratoren erfordern ihre Definition.  Eine Liste der Variablen, die allen Paketgeneratoren gemeinsam sind, finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . </p><br><p>  Die Definition der Variablen <code>CPACK_GENERATOR</code> ist <code>CPACK_GENERATOR</code> - es handelt sich um eine Liste von <code>cpack</code> die <code>cpack</code> Dienstprogramm <code>cpack</code> aufgerufen werden.  In diesem Fall nimmt es den Wert <code>DEB</code> , daher wird im Stammverzeichnis der Übersichtsanwendung ein Debian-Paket generiert. </p><br><p>  Schließlich wird das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>CPack</code></a> Modul <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>CPack</code></a> und das zukünftige Projektpaket mithilfe der zuvor definierten Variablen und des Installationsbefehls für die ausführbare Datei konfiguriert sowie zwei Assembly-Ziele hinzugefügt - <code>package</code> und <code>package_source</code> (binäre Assembly bzw. <code>package_source</code> ). </p><br><h1 id="ispolnenie-paketirovaniya">  Packing Execution </h1><br><p>  Eine Reihe von <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package</code> Befehlen <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package</code> <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package</code>  <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package</code> gestartet, um den ausgewählten Generator zum Erstellen eines Binärpakets und <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code> Befehle auszuführen <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code> <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code>  <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code> generiert ein <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code> direkt im Stammverzeichnis. </p><br><h1 id="zavershenie">  Fertigstellung </h1><br><p>  Zu diesem Zeitpunkt ist die vollständige CMake-Tutorialserie beendet.  Ich hoffe, dass Sie viel nützliches Material gelernt und Ihre Programmierkenntnisse verbessert haben.  Viel Glück <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de433822/">https://habr.com/ru/post/de433822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de433810/index.html">Ein problemorientierter Ansatz für Projekte im Internet-Marketing</a></li>
<li><a href="../de433814/index.html">So skalieren Sie Datenbanken in Yandex. Cloud ohne Ausfallzeiten. Beispiel mit drei Hosts</a></li>
<li><a href="../de433816/index.html">Wo kann die mobile Anwendung veröffentlicht werden?</a></li>
<li><a href="../de433818/index.html">Kompilieren und Ausführen von C # und Blazor in einem Browser</a></li>
<li><a href="../de433820/index.html">ECMAScript-Vorschlag: Array.prototype. {Flat, flatMap}</a></li>
<li><a href="../de433824/index.html">Habro Selbstmord. Warum 1C-Programmierer die Welt retten</a></li>
<li><a href="../de433826/index.html">Persimmon 2.0 Gebrauchsanweisung</a></li>
<li><a href="../de433828/index.html">Verwenden der QML-Karte zum Erstellen von Atemwegen - Teil 1</a></li>
<li><a href="../de433830/index.html">Neue LED-Diallampen</a></li>
<li><a href="../de433832/index.html">ClangFormat-Quellcode-Formatierung unter Linux: Probleme und Lösungen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>