<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî© üèê üïó Comment les machines communiquent - Protocole MQTT ü•ú üë®üèΩ‚Äç‚öñÔ∏è üéöÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans un article pr√©c√©dent, nous avons examin√© le protocole Modbus , qui est la norme industrielle de facto pour l'interaction M2M . D√©velopp√© en 1979,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment les machines communiquent - Protocole MQTT</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/advantech/blog/452904/"><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/nb/fv/om/nbfvom_zwqoyqg4e4bcxwl1ax7a.png"></div><br>  Dans un article pr√©c√©dent, nous avons examin√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le protocole Modbus</a> , qui est la norme industrielle de facto pour l'interaction <abbr title="Machine √† machine">M2M</abbr> .  D√©velopp√© en 1979, il pr√©sente un certain nombre d'inconv√©nients importants que MQTT r√©sout. <br><br>  Le protocole MQTT est assez jeune (normalis√© seulement en 2016), mais a d√©j√† r√©ussi √† √™tre largement utilis√© dans l'industrie et l'IoT.  Il a √©t√© sp√©cialement con√ßu pour √™tre aussi compact que possible, pour les canaux Internet instables et les appareils de faible puissance, et vous permet de garantir la livraison des messages en cas de perte et de d√©connexion de paquets. <br><br>  Caract√©ristiques cl√©s du protocole MQTT: <br><br><ul><li>  <b>Compact et l√©ger</b> - surcharge de transfert de donn√©es minimale pour √©conomiser le trafic. </li><li>  <b>R√©sistance aux pertes</b> - livraison garantie dans des conditions de connexions r√©seau instables. </li><li>  <b>Asynchrone</b> - vous permet de desservir un grand nombre d'appareils et ne d√©pend pas des retards du r√©seau. </li><li>  <b>Prise en charge de la qualit√© de service</b> - la capacit√© de contr√¥ler la priorit√© des messages et de garantir la livraison des messages au destinataire. </li><li>  <b>Configuration dynamique</b> - ne n√©cessite pas de coordination pr√©alable des champs et des formats de donn√©es, peut √™tre configur√© √† la vol√©e. </li><li>  <b>Fonctionne pour NAT</b> - les clients peuvent √™tre derri√®re NAT, seul le serveur (courtier) doit avoir une v√©ritable IP.  Vous permet de vous passer de VPN et de redirection de port. </li><li>  <b>Adressage pratique</b> - les champs de donn√©es ont des noms de texte compr√©hensibles par l'homme.  Pas besoin de se souvenir des adresses num√©riques et des d√©calages de bits. </li></ul><a name="habracut"></a><br>  Dans l'article, nous allons comparer MQTT et Modbus, analyser la structure du protocole, les concepts de base et essayer d'utiliser le courtier MQTT cloud comme exemple dans une connexion Internet instable. <br><br><h2>  Historique du protocole MQTT </h2><br>  MQTT a √©t√© d√©velopp√© par IBM en 1999 et a √©t√© initialement utilis√© en interne pour ses solutions. <br><br>  En novembre 2011, IBM et Eurotech ont annonc√© leur participation au groupe de travail Eclipse M2M et le transfert du code MQTT au projet Eclipse Paho. <br><br>  En 2013, le consortium <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OASIS</a> (Organisation pour l'avancement des normes d'information structur√©e) a entam√© le processus de normalisation du protocole MQTT.  Jusqu'√† pr√©sent, la sp√©cification du protocole a √©t√© publi√©e sous licence gratuite, et des soci√©t√©s comme Eurotech (anciennement Arcom) utilisent d√©j√† le protocole dans leurs produits. <br><br>  En octobre 2014, OASIS a publi√© la premi√®re norme officielle de protocole MQTT. <br><br>  En 2016, le protocole a √©t√© normalis√© par l'Organisation internationale de normalisation ISO et a re√ßu le num√©ro ISO / IEC 20922. <br><br>  Depuis 2014, l'int√©r√™t pour le protocole commence √† cro√Ætre rapidement et, √† en juger par le calendrier de Google Trends, il d√©passe aujourd'hui l'int√©r√™t pour Modbus. <br><br><img src="https://habrastorage.org/webt/ia/6q/cw/ia6qcwyvn9p6yi_10xrdgkwbcqu.png"><br>  <font color="999999">Benchmark Google Trends</font> <br><br><h2>  Concepts de base </h2><br>  MQTT a une architecture client-serveur.  La messagerie s'effectue via un serveur central appel√© courtier.  Dans des conditions normales, les clients ne peuvent pas communiquer directement entre eux et tous les √©changes de donn√©es ont lieu via un courtier. <br><br>  Les clients peuvent agir en tant que fournisseurs de donn√©es (√©diteur) et destinataires de donn√©es (abonn√©).  Dans une traduction russe, ces termes sont souvent traduits en tant qu'√©diteur et abonn√©, mais pour √©viter toute confusion, nous n'utiliserons que la terminologie d'origine. <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/webt/ex/ri/7r/exri7rw8067vln4jiqq5ma9dine.png"></div><br>  <font color="999999">Dans le protocole MQTT, les clients communiquent entre eux via un n≈ìud central</font> <br><br>  Au niveau de l'application, le protocole s'ex√©cute au-dessus de TCP / IP et peut facilement connecter des objets distants directement sur Internet, sans avoir besoin de tunnels VPN.  Il suffit au courtier d'avoir une v√©ritable adresse IP et tous les clients peuvent s'y connecter.  Dans ce cas, les clients peuvent se trouver derri√®re NAT.  √âtant donn√© que les clients √©tablissent la connexion dans le protocole MQTT, la redirection de port n'est pas requise pour √©tablir une connexion, tandis que dans Modbus / TCP, le serveur √©tablit une connexion (ma√Ætre), ce qui n√©cessite une accessibilit√© directe au r√©seau. <br><br>  Le port standard du courtier MQTT pour les connexions TCP entrantes est <b>1883</b> .  Lorsque vous utilisez une connexion SSL s√©curis√©e, le port <b>8883 est utilis√©</b> . <br><br><h4>  Courtier </h4><br>  Un courtier est le centre central MQTT pour l'interaction avec les clients.  L'√©change de donn√©es entre les clients se produit uniquement via un courtier.  Le courtier peut √™tre un logiciel serveur ou un contr√¥leur.  Ses t√¢ches comprennent la r√©ception de donn√©es de clients, le traitement et le stockage de donn√©es, la livraison de donn√©es aux clients et la surveillance de la livraison des messages. <br><br><h4>  √âditeur / abonn√© </h4><br>  Pour comprendre la diff√©rence entre Publisher et Subscriber, prenons un exemple simple: un capteur d'humidit√© mesure l'humidit√© dans une pi√®ce, et si elle descend en dessous d'un certain niveau, l'humidificateur s'allume. <br><br>  Dans ce cas, le capteur d'humidit√© agit comme un <b>√©diteur</b> : sa t√¢che consiste uniquement √† publier des donn√©es au courtier.  L'humidificateur agit en tant <b>qu'abonn√©</b> : il s'abonne aux mises √† jour des donn√©es d'humidit√© et re√ßoit les donn√©es actuelles du courtier, tandis que l'humidificateur peut d√©cider √† quel moment activer l'humidification. <br><br>  Dans ce sch√©ma, les clients MQTT, c'est-√†-dire le capteur et l'humidificateur, ne sont pas conscients de leur existence mutuelle et n'interagissent pas directement.  Le courtier peut recevoir des donn√©es de diverses sources, les manipuler, par exemple, calculer la valeur moyenne de plusieurs capteurs et renvoyer les donn√©es trait√©es √† l'abonn√©. <br><br><img src="https://habrastorage.org/webt/xc/pb/t8/xcpbt8th_jxzdzfglqwxt4wnpwo.png"><br>  <font color="9999999">L'√©diteur envoie des donn√©es au courtier, l'abonn√© s'abonne aux mises √† jour de ces donn√©es</font> <br><br>  Dans le m√™me temps, l'asynchronie du protocole MQTT pr√©voit que le capteur et l'humidificateur peuvent √™tre en ligne √† des moments diff√©rents, perdre des paquets et √™tre inaccessibles.  Le courtier se chargera de stocker en m√©moire les derni√®res donn√©es re√ßues du capteur et assurera leur remise √† l'humidificateur. <br><br><h4>  Sujet </h4><br>  MQTT utilise des sujets pour identifier les entit√©s, dans la traduction russe, ils sont √©galement appel√©s canaux.  Les rubriques sont constitu√©es de caract√®res UTF8 et ont une structure arborescente similaire √† un syst√®me de fichiers UNIX.  Il s'agit d'un m√©canisme pratique pour nommer des entit√©s sous une forme lisible par l'homme. <br><br>  Un exemple de sujets dans MQTT <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#     home/kitchen/temperature #     home/sleeping-room/temperature #     home/outdoor/light</span></span></code> </pre> <br>  Cette approche vous permet de voir visuellement quelles donn√©es sont transmises, et il est pratique de d√©velopper et de d√©boguer le code sans avoir √† m√©moriser l'adresse num√©rique du placement de donn√©es, comme cela se fait dans Modbus. <br><br>  Les sujets incluent √©galement la syntaxe g√©n√©rique, famili√®re √† ceux qui ont travaill√© avec le syst√®me de fichiers UNIX.  Le caract√®re g√©n√©rique peut √™tre √† un niveau et √† plusieurs niveaux. <br><br>  Un caract√®re g√©n√©rique √† un niveau est indiqu√© par un <b>+</b> . <br><br>  Par exemple, pour recevoir des donn√©es de capteurs de temp√©rature dans toutes les pi√®ces de la maison, l'abonn√© doit s'abonner √† un tel sujet: <br><br><pre> <code class="plaintext hljs">home/+/temperature</code> </pre><br>  En cons√©quence, il s'abonnera pour recevoir des donn√©es de ces capteurs: <br><br><pre> <code class="plaintext hljs">home/kitchen/temperature home/sleeping-room/temperature home/living-room/temperature home/outdoor/temperature</code> </pre><br>  Un caract√®re g√©n√©rique √† plusieurs niveaux est indiqu√© par le symbole " <b>#</b> ". <br>  Un exemple d'obtention de donn√©es de tous les capteurs dans toutes les pi√®ces de la maison: <br><br><pre> <code class="plaintext hljs">home/#</code> </pre><br>  L'abonnement √† un tel sujet vous permettra de recevoir des donn√©es de tels capteurs: <br><br><pre> <code class="plaintext hljs">home/kitchen/temperature home/kitchen/humidity home/kitchen/light home/sleeping-room/temperature home/sleeping-room/humidity home/sleeping-room/light ....</code> </pre><br><h3>  Identification du client </h3><br>  Pour le contr√¥le d'acc√®s, MQTT fournit une authentification client, contrairement au protocole Modbus, qui n'a pas une telle fonction.  Les champs suivants sont utilis√©s pour le contr√¥le d'acc√®s: <br><br>  <b>ClientId</b> - (champ obligatoire) identifiant unique du client.  Doit √™tre unique pour chaque client.  La version actuelle de la norme MQTT 3.1.1 vous permet d'utiliser le champ ClientId vide si vous n'avez pas besoin d'enregistrer l'√©tat de la connexion. <br><br>  <b>Nom d'utilisateur</b> - (champ facultatif) connexion pour l'authentification, au format UTF-8.  Peut ne pas √™tre unique.  Par exemple, un groupe de clients peut se connecter avec le m√™me nom d'utilisateur / mot de passe. <br><br>  <b>Mot de passe</b> - (champ facultatif) peut √™tre envoy√© uniquement avec le champ Nom d'utilisateur, tandis que le nom d'utilisateur peut √™tre transmis sans le champ Mot de passe.  65535 octets maximum.  Il est important de savoir que le nom et le mot de passe sont transmis en clair, par cons√©quent, si les donn√©es sont transmises sur des r√©seaux publics, vous devez utiliser SSL pour crypter la connexion. <br><br><h3>  Structure du package </h3><br>  Comme mentionn√© ci-dessus, dans le protocole MQTT, les clients √©tablissent toujours une connexion, qu'ils soient destinataires (abonn√©) ou fournisseurs (√©diteur) de donn√©es.  Nous analyserons le paquet avec la connexion qui a √©t√© intercept√©e √† l'aide du programme Wireshark. <br><br><img src="https://habrastorage.org/webt/ep/0t/hv/ep0thv6e3zsvyzgizw89gpxgytg.png"><br>  <font color="999999">Paquet MQTT transmis sur un canal non chiffr√©</font> <br><br>  L'en-t√™te TCP montre que le paquet a √©t√© envoy√© sur le port 1883, c'est-√†-dire que le chiffrement n'est pas utilis√©, ce qui signifie que toutes les donn√©es sont disponibles sous forme claire, y compris l'identifiant et le mot de passe. <br><br><h4>  Titre </h4><br>  <b>Le type de message</b> est Connect (commande 0x0001), √©tablissant une connexion avec le courtier.  √âquipes principales: connexion, d√©connexion, publication, abonnement, d√©sabonnement.  Il existe √©galement des commandes d'accus√© de r√©ception, garder en vie, etc. <br><br>  <b>Flag DUP</b> - signifie que le message est retransmis, il est utilis√© uniquement dans les types de message PUBLISH, SUBSCRIBE, UNSUBSCRIBE, PUBREL, pour les cas o√π le courtier n'a pas re√ßu de confirmation de la r√©ception du message pr√©c√©dent. <br>  <b>Niveau QoS</b> - indicateur de qualit√© de service.  Nous aborderons ce sujet plus en d√©tail ult√©rieurement. <br>  <b>Conserver</b> - les donn√©es publi√©es avec l'indicateur de conservation sont stock√©es sur le courtier.  Lors de la souscription ult√©rieure √† ce sujet, le courtier enverra imm√©diatement un message avec cet indicateur.  Utilis√© uniquement dans les messages de type Publier. <br><br><h2>  Utilisation pratique </h2><br><img width="100" src="https://habrastorage.org/webt/v9/m9/2k/v9m92kvqrkibu8zt9pfsdjkngg8.png"><br><br>  Maintenant, apr√®s nous √™tre familiaris√©s avec la th√©orie, essayons de travailler avec MQTT dans la pratique.  Pour cela, nous utiliserons le programme ouvert <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mosquitto</a> , qui peut fonctionner √† la fois en mode client et en mode serveur (courtier).  Il fonctionne sous Windows, macOS, Linux.  Le programme est tr√®s pratique pour le d√©bogage et l'√©tude du protocole MQTT, alors qu'il est √©galement largement utilis√© dans les op√©rations industrielles.  Nous l'utiliserons comme client pour envoyer et recevoir des donn√©es d'un courtier cloud distant. <br><br>  De nombreux fournisseurs de cloud fournissent des services de courtage MQTT, tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Microsoft Azure IoT Hub</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Amazon AWS IoT</a> et autres.  Dans cet exemple, nous utiliserons le service Cloudmqtt.com, car il a l'inscription la plus simple, et un tarif gratuit suffit pour la formation. <br><br>  Apr√®s l'enregistrement, les d√©tails de connexion √† un courtier sont disponibles dans votre compte.  Puisque nous nous connectons au serveur via des r√©seaux Internet publics, il est raisonnable d'utiliser un port SSL pour crypter le trafic. <br><br><img src="https://habrastorage.org/webt/gh/rq/t5/ghrqt5ady8x8twccmfrtngm-htu.png"><br>  <font color="999999">D√©tails d'acc√®s au courtier MQTT dans le compte personnel du fournisseur de cloud</font> <br><br>  La flexibilit√© du protocole MQTT permet au client de transf√©rer des donn√©es non d√©finies pr√©c√©demment sur le courtier.  En d'autres termes, il n'est pas n√©cessaire de pr√©-cr√©er les rubriques n√©cessaires dans lesquelles Publisher peut √©crire des donn√©es.  En utilisant les donn√©es re√ßues de votre compte personnel, nous essaierons de composer manuellement une demande de publication de donn√©es sur le sujet <i>habr / test / random</i> et lecture de celui-ci. <br><br>  <b>mosquitto_sub</b> - utilitaire client abonn√© <br>  <b>mosquitto_pub</b> - utilitaire client √©diteur <br><br>  Tout d'abord, connectez-vous au courtier en tant qu'abonn√© et abonnez-vous pour recevoir des donn√©es du sujet <br>  <i>habr / test / al√©atoire</i> . <br><br><pre> <code class="plaintext hljs">mosquitto_sub -d --capath /etc/ssl/certs/ --url mqtts://hwjspxxt:7oYugN7Fa5Aa@postman.cloudmqtt.com:27529/habr/test/random Client mosq/zEPZz0glUiR4aEipZA sending CONNECT Client mosq/zEPZz0glUiR4aEipZA received CONNACK (0) Client mosq/zEPZz0glUiR4aEipZA sending SUBSCRIBE (Mid: 1, Topic: habr/test/random, QoS: 0, Options: 0x00) Client mosq/zEPZz0glUiR4aEipZA received SUBACK</code> </pre><br>  On peut voir que la connexion a r√©ussi, et nous nous sommes abonn√©s au sujet <b>habr / test / random</b> , et maintenant nous attendons des donn√©es dans ce sujet du courtier. <br><blockquote>  Puisqu'une connexion SSL est utilis√©e, pour v√©rifier le certificat, vous devez sp√©cifier le chemin par lequel le programme recherchera les certificats de chiffrement racine.  √âtant donn√© que le service dans notre exemple utilise un certificat √©mis par une autorit√© de certification de confiance, nous indiquons le chemin d'acc√®s au magasin syst√®me pour les certificats racine: <i><b>--capath / etc / ssl / certs /</b></i> <br><br>  Dans le cas d'un certificat auto-sign√©, vous devez sp√©cifier le chemin d'acc√®s √† l'autorit√© de certification souhait√©e.  Il est √©galement important de prendre en compte la diff√©rence de format URI pour les connexions SSL - mqtt <b>s</b> : // et les connexions non chiffr√©es - mqtt: //.  En cas d'erreur de v√©rification de certificat, le programme se termine sans message d'erreur.  Pour une sortie plus d√©taill√©e, vous pouvez utiliser le commutateur --debug </blockquote>  Essayons maintenant de publier les donn√©es dans le sujet sans interrompre le premier programme. <br><br><pre> <code class="plaintext hljs">mosquitto_pub -d --capath /etc/ssl/certs/ --url mqtt://hwjspxxt:7oYugN7Fa5Aa@postman.cloudmqtt.com:27529/habr/test/random -m " !" Client mosq/sWjh9gf8DRASrRZjk6 sending CONNECT Client mosq/sWjh9gf8DRASrRZjk6 received CONNACK (0) Client mosq/sWjh9gf8DRASrRZjk6 sending PUBLISH (d0, q0, r0, m1, 'habr/test/random', ... (22 bytes)) Client mosq/sWjh9gf8DRASrRZjk6 sending DISCONNECT</code> </pre><br>  On peut voir que les donn√©es ont bien √©t√© re√ßues par le serveur et publi√©es dans la rubrique souhait√©e.  Dans le m√™me temps, dans la premi√®re fen√™tre dans laquelle le programme mosquitto_sub s'ex√©cute, nous voyons comment le message a √©t√© re√ßu, m√™me Unicode fonctionne, le message est en russe. <br><br><pre> <code class="plaintext hljs">Client mosq/zEPZz0glUiR4aEipZA received PUBLISH (d0, q0, r0, m0, 'habr/test/random', ... (22 bytes))  !</code> </pre><br><h2>  QoS et garantie de livraison </h2><br>  Cependant, l'envoi d'un message en temps r√©el ne surprendra personne, car la m√™me chose peut √™tre faite m√™me avec l'utilitaire banal <b>nc</b> .  Par cons√©quent, nous allons essayer de simuler une connexion instable entre l'abonn√© et l'exp√©diteur.  Imaginez que les deux clients fonctionnent via GPRS, avec une √©norme perte de paquets, et m√™me une connexion TCP r√©ussie est rare, et vous devez vous assurer que l'abonn√© est assur√© de recevoir un message d'exp√©diteur.  Dans ce cas, les options de QoS viennent √† la rescousse. <br><br>  Par d√©faut, l'indicateur <b>QoS</b> est d√©fini <b>sur 0</b> pour les messages, ce qui signifie ¬´D√©clenchez et oubliez¬ª: Publisher publie le message sur le courtier, mais n'exige pas que le message soit garanti pour √™tre remis √† l'abonn√©.  Cela convient aux donn√©es dont la perte n'est pas critique, par exemple pour les mesures r√©guli√®res d'humidit√© ou de temp√©rature. <br><br>  <b>QoS 1: au moins une fois - au moins une</b> .  Ce drapeau signifie que jusqu'√† ce que l'√©diteur re√ßoive une confirmation de livraison √† l'abonn√©, cette publication sera envoy√©e au courtier, puis √† l'abonn√©.  Ainsi, l'abonn√© doit recevoir ce message au moins une fois. <br><br>  <b>QoS 2: Exactement une fois - garantie</b> .  Le drapeau QoS, qui offre la plus haute garantie de livraison de messages gr√¢ce √† l'utilisation de proc√©dures suppl√©mentaires pour la confirmation et l'ach√®vement de la publication (PUBREC, PUBREL, PUBCOMP).  Applicable aux situations o√π il est n√©cessaire d'exclure toute perte et duplication de donn√©es des capteurs.  Par exemple, lorsqu'une alarme est d√©clench√©e √† partir d'un message re√ßu, un appel d'urgence est effectu√©. <br><br>  Pour simuler une mauvaise communication, d√©sactivez les deux clients et essayez d'envoyer un message avec la priorit√© QoS la plus √©lev√©e, et ajoutez √©galement l'option Conserver pour que le message envoy√© soit enregistr√© sur le courtier. <br><br><pre> <code class="plaintext hljs">mosquitto_pub --retain --qos 2 -d --capath /etc/ssl/certs/ --url mqtt://hwjspxxt:7oYugN7Fa5Aa@postman.cloudmqtt.com:27529/habr/test/random -m "  !" Client mosq/Xwhua3GAyyY9mMd05V sending CONNECT Client mosq/Xwhua3GAyyY9mMd05V received CONNACK (0) Client mosq/Xwhua3GAyyY9mMd05V sending PUBLISH (d0, q2, r1, m1, 'habr/test/random', ... (37 bytes)) Client mosq/Xwhua3GAyyY9mMd05V received PUBREC (Mid: 1) Client mosq/Xwhua3GAyyY9mMd05V sending PUBREL (m1) Client mosq/Xwhua3GAyyY9mMd05V received PUBCOMP (Mid: 1, RC:0) Client mosq/Xwhua3GAyyY9mMd05V sending DISCONNECT</code> </pre><br>  Maintenant, apr√®s un certain temps, notre destinataire a finalement pu √©tablir une connexion √† Internet et connect√© au courtier: <br><br><pre> <code class="plaintext hljs">mosquitto_sub -d --capath /etc/ssl/certs/ -d --url mqtts://hwjspxxt:7oYugN7Fa5Aa@postman.cloudmqtt.com:27529/habr/test/random Client mosq/VAzcLVMB1MiWhYxoJS sending CONNECT Client mosq/VAzcLVMB1MiWhYxoJS received CONNACK (0) Client mosq/VAzcLVMB1MiWhYxoJS sending SUBSCRIBE (Mid: 1, Topic: habr/test/random, QoS: 0, Options: 0x00) Client mosq/VAzcLVMB1MiWhYxoJS received SUBACK Subscribed (mid: 1): 0 Client mosq/r6UwPnDvx8aNInpPF6 received PUBLISH (d0, q0, r1, m0, 'habr/test/random', ... (37 bytes))   !</code> </pre><br><h2>  Conclusion </h2><br>  MQTT est un protocole moderne et avanc√©, d√©pourvu de nombreux inconv√©nients de ses pr√©d√©cesseurs.  Sa flexibilit√© vous permet d'ajouter des appareils clients sans configurer de courtier, ce qui permet de gagner beaucoup de temps.  Le seuil d'entr√©e pour comprendre et configurer le protocole est assez bas, et la pr√©sence de biblioth√®ques pour de nombreux langages de programmation vous permet de choisir n'importe quelle pile technologique pour le d√©veloppement.  La garantie de remise des messages distingue MQTT de ses pr√©d√©cesseurs et vous permet de ne pas perdre de temps √† d√©velopper inutilement vos propres m√©canismes de contr√¥le d'int√©grit√© au niveau du r√©seau. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr452904/">https://habr.com/ru/post/fr452904/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr452888/index.html">Pr√®s de Munich a commenc√© √† tester le tiltrotor cinq places pleine grandeur Lilium Jet</a></li>
<li><a href="../fr452890/index.html">23 mai, 18 h 30 - diffusion en direct de QIWI Kitchen</a></li>
<li><a href="../fr452892/index.html">Comment un non-programmeur peut-il d√©m√©nager aux √âtats-Unis: instructions √©tape par √©tape</a></li>
<li><a href="../fr452900/index.html">Index dans PostgreSQL - 9 (BRIN)</a></li>
<li><a href="../fr452902/index.html">Finissant 4 ans de formation de programmeur, je comprends que je suis loin d'√™tre programmeur</a></li>
<li><a href="../fr452906/index.html">Moteurs JavaScript: comment fonctionnent-ils? De la pile des appels aux promesses, (presque) tout ce que vous devez savoir</a></li>
<li><a href="../fr452908/index.html">Selenium WebDriver - Mesure de test en temps r√©el √† l'aide de Grafana et InfluxDB</a></li>
<li><a href="../fr452910/index.html">Bonjour, Habr! Bonjour Tercon</a></li>
<li><a href="../fr452914/index.html">ML sur Scala avec le sourire, pour ceux qui n'ont pas peur de l'exp√©rimentation</a></li>
<li><a href="../fr452916/index.html">Levez-vous et partez. Chirurgie vert√©brale: quand faire, ce qui est dangereux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>