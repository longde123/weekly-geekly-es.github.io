<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍴 👨🏻‍⚖️ 🧗🏿 Pengatur waktu dan pemicu CODESYS. Langkah Arduino lain menuju PLC klasik 🤟 👕 🙋🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ini terjadi pada pengontrol program (PLC) di lingkungan CODESYS. Setiap orang yang telah berurusan dengan sistem ini tahu bahwa dalam proyek apa pun a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengatur waktu dan pemicu CODESYS. Langkah Arduino lain menuju PLC klasik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/402315/"><div style="text-align:center;"><img src="https://habrastorage.org/files/269/7d4/587/2697d458734041e8ad9553eaa94aafda.png"></div><br>  Ini terjadi pada pengontrol program (PLC) di lingkungan CODESYS.  Setiap orang yang telah berurusan dengan sistem ini tahu bahwa dalam proyek apa pun ada pustaka Standard.lib, di mana pengatur waktu dasar, pemicu, penghitung, dan sejumlah fungsi dan blok fungsi lainnya diimplementasikan.  Banyak dari unit ini yang secara konstan digunakan dalam program PLC.  Dan perpustakaan itu sendiri, seperti bahasa pemrograman CODESYS, adalah perwujudan dari standar IEC 61131-3, yaitu  dirancang untuk membantu pemrograman tugas-tugas PLC klasik. <br><a name="habracut"></a><br>  Salah satu fitur dari program PLC adalah bahwa siklus utama dari program harus dijalankan tanpa penundaan yang signifikan, tidak boleh memiliki siklus internal dengan waktu keluar yang tidak ditentukan atau panggilan sinkron dari fungsi "bijaksana", terutama yang berkaitan dengan komunikasi melalui saluran lambat.  Gambar input dan output dari proses diperbarui hanya pada batas loop utama, dan semakin lama kita “duduk” di dalam satu iterasi dari loop, semakin sedikit kita akan tahu tentang keadaan sebenarnya dari objek kontrol, akhirnya pengawas dari loop overflow akan bekerja.  Banyak yang mungkin keberatan dengan saya, mengatakan bahwa PLC modern ambigu, ada dukungan untuk gangguan hardware.  Saya setuju, tetapi berbicara tentang sistem seperti itu tidak termasuk dalam rencana saya, tetapi saya ingin berbicara tentang (kuasi, pseudo-pilih) sebuah PLC dari implementasi tugas tunggal (tanpa gangguan) berdasarkan pada platform mikroprosesor Arduino, di mana hanya ada satu loop utama.  Ngomong-ngomong, tidak akan salah tempat untuk mengatakan bahwa artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CONTROLLINO PLC yang kompatibel dengan Arduino, bagian 1</a> tentang upaya untuk mengimplementasikan Arduino dalam perangkat keras mempromosikan saya untuk menulis catatan ini.  PLC <br><br>  Beberapa kata tentang Arduino.  Dari sudut pandang programmer PLC, Arduino adalah pengontrol tipikal dengan satu loop yang sangat cepat atau, sebaliknya, loop yang sangat lambat ().  Tidak ada batasan pada waktu pelaksanaan siklus, dan dapat bekerja baik satu dan beberapa kali - sesuai dengan rencana programmer.  Ketika program ini sederhana dan mengurangi untuk melakukan operasi berurutan, pengontrol, tanpa kejadian paralel, itu cukup untuk operasi bergantian dengan siklus pemeriksaan kondisi bersarang tak berujung dan keterlambatan sinkron dari jenis penundaan ().  Langkah-langkah berurutan dari program semacam itu akan dieksekusi secara harfiah baris demi baris, sederhana dan logis.  Tetapi, segera setelah kebutuhan untuk pemrograman operasi paralel, perlu untuk mengubah paradigma program. <br><br>  Dalam sistem tugas tunggal, paralelisme yang terlihat hanya dapat dicapai dengan pemindaian sekuensial status paralel yang sangat cepat, tanpa berlama-lama untuk setiap panggilan fungsi atau pemeriksaan kondisi.  Tidak ada masalah dengan input dan output fisik, fungsi bekerja cukup cepat, tetapi delay () menjadi rem yang tidak dapat dibenarkan.  Dan di sini timer non-blocking masuk, yang paling klasik dalam pemrograman PLC.  Intinya adalah bahwa mereka menggunakan penghitung waktu milidetik, dan semua tindakan terkait dengan nilai-nilai penghitung global ini. <br><br>  Dan sekarang mari kita ingat Standard.lib yang sama dari CODESYS.  Itu hanya menerapkan timer non-blocking IEC.  Saya menganggapnya sebagai dasar dan porting fungsi timer dan pemicu ke kode perpustakaan Arduino (C ++).  Yaitu  mencoba membawa Arduino lebih dekat ke PLC klasik. <br><br>  Di bawah ini saya akan memberikan deskripsi singkat tentang blok fungsi porting (FB) dari CODESYS dan analog mereka di perpustakaan <b>plcStandardLib</b> saya, semua diagram waktu tepat untuk perpustakaan Arduino baru.  Penjelasan lebih rinci tentang blok sumber dapat ditemukan, misalnya, dalam bantuan berbahasa Rusia di CODESYS. <br><br><h3>  TON - blok fungsi "timer dengan delay on" </h3><br><pre><code class="hljs lisp">TON(<span class="hljs-name"><span class="hljs-name">IN</span></span>, PT, Q, ET)</code> </pre> <br>  Input IN dan PT dari masing-masing tipe BOOL dan TIME.  Output Q dan ET mirip dengan tipe BOOL dan TIME.  Sementara IN adalah FALSE, output Q = FALSE, output ET = 0. Begitu IN menjadi BENAR, hitungan mundur (dalam milidetik) pada output ET dimulai dengan nilai yang sama dengan PT.  Selanjutnya, penghitung tidak bertambah.  Q BENAR ketika IN BENAR dan ET adalah PT, jika tidak SALAH.  Jadi <br>  dengan demikian, output Q diatur dengan penundaan PT dari tepi input IN. <br><br><h4>  Dalam Arduino IDE: </h4><br>  Opsi Iklan: <br><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-function">TON </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TON1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">TON </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TON1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> PT)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//     PT</span></span></code> </pre> <br>  Gunakan kasing: <br><br><pre> <code class="hljs pgsql">Q = TON1.Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>); //  "  " TON1.<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>; TON1.Run(); Q = TON1.Q;</code> </pre> <br>  Diagram Waktu Operasi TON: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/569/93b/33b/56993b33becf4b9fb1354ac095d573fa.png"></div><br><h3>  TOF - blok fungsi "timer dengan shutdown tertunda" </h3><br><pre> <code class="hljs lisp">TOF(<span class="hljs-name"><span class="hljs-name">IN</span></span>, PT, Q, ET)</code> </pre> <br>  Input IN dan PT dari masing-masing tipe BOOL dan TIME.  Output Q dan ET mirip dengan tipe BOOL dan TIME.  Jika IN adalah BENAR, maka outputnya adalah Q = BENAR dan outputnya adalah ET = 0. Begitu IN masuk ke FALSE, hitungan mundur (dalam milidetik) dari output ET dimulai.  Ketika durasi yang ditetapkan tercapai, hitungan mundur berhenti.  Output Q adalah FALSE jika IN adalah FALSE dan ET adalah PT, jika tidak BENAR.  Dengan demikian, output Q diatur ulang dengan penundaan PT dari penurunan input IN. <br><br><h4>  Dalam Arduino IDE: </h4><br>  Sangat mirip dengan TON, singkatnya: <br><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-function">TOF </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TOF1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> PT)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//     PT Q = TOF1.Run(boolean IN); //  "  "</span></span></code> </pre> <br>  Diagram waktu TOF: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b12/11d/56d/b1211d56da474524b72f53e5ecc8c5a8.png"></div><br><h3>  TP - blok fungsi impuls-waktu </h3><br><pre> <code class="hljs lisp">TP(<span class="hljs-name"><span class="hljs-name">IN</span></span>, PT, Q, ET)</code> </pre> <br>  Input IN dan PT dari masing-masing tipe BOOL dan TIME.  Output Q dan ET mirip dengan tipe BOOL dan TIME.  Ketika IN adalah FALSE, output Q = FALSE, output ET = 0. Ketika IN beralih ke TRUE, output Q diatur ke TRUE dan timer mulai menghitung (dalam milidetik) pada output ET sampai durasi yang ditentukan oleh PT tercapai.  Selanjutnya, penghitung tidak bertambah.  Dengan demikian, output Q menghasilkan pulsa berdurasi PT di sepanjang tepi input IN. <br><br><h4>  Dalam Arduino IDE: </h4><br>  Sangat mirip dengan TON, singkatnya: <br><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-function">TP </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TP1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> PT)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//     PT Q = TP1.Run(boolean IN); //  "  "</span></span></code> </pre> <br>  Bagan waktu operasi TP: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/03d/476/347/03d476347d6746f499a8f7829ade9d6a.png"></div><br><h3>  R_TRIG - blok fungsi "detektor depan" </h3><br>  Blok fungsi R_TRIG menghasilkan pulsa di tepi naik dari sinyal input.  Output Q FALSE selama input CLK FALSE.  Segera setelah CLK mendapatkan TRUE, Q diatur ke TRUE.  Kali berikutnya blok fungsi dipanggil, output di-reset ke FALSE.  Dengan demikian, blok memberikan impuls tunggal pada setiap transisi CLK dari FALSE ke TRUE. <br><br>  Contoh CODEDESYS di ST: <br><br><pre> <code class="hljs go">RTRIGInst : R_TRIG ; RTRIGInst(CLK:= VarBOOL1); VarBOOL2 := RTRIGInst.Q;</code> </pre> <br><h4>  Dalam Arduino IDE: </h4><br>  Pengumuman: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">R_TRIG</span></span> R_TRIG1;</code> </pre> <br>  Gunakan kasing: <br><br><pre> <code class="hljs objectivec">Q = R_TRIG1.Run(boolean <span class="hljs-built_in"><span class="hljs-built_in">CLK</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  "  " R_TRIG1.CLK = CLK; R_TRIG1.Run(); Q = R_TRIG1.Q;</span></span></code> </pre> <br><h3>  F_TRIG - unit fungsi "tolak detektor" </h3><br>  Blok fungsi F_TRIG menghasilkan pulsa di tepi trailing dari sinyal input. <br>  Output Q adalah SALAH sampai input CLK BENAR.  Segera setelah CLK diatur ke FALSE, Q diatur ke TRUE.  Kali berikutnya blok fungsi dipanggil, output di-reset ke FALSE.  Dengan demikian, blok memberikan impuls tunggal pada setiap transisi CLK dari TRUE ke FALSE. <br><br><h4>  Dalam Arduino IDE: </h4><br><pre> <code class="hljs objectivec">F_TRIG F_TRIG1; Q = F_TRIG1.Run(boolean <span class="hljs-built_in"><span class="hljs-built_in">CLK</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  "  "</span></span></code> </pre> <br><h3>  RS_TRIG - blok fungsi RS-trigger / SR_TRIG - blok fungsi SR-trigger </h3><br>  Beralih dengan sakelar dominan yang dimatikan, pemicu RS: <br><br><pre> <code class="hljs lisp">Q1 = RS (<span class="hljs-name"><span class="hljs-name">SET</span></span>, RESET1)</code> </pre> <br>  Beralih dengan dominan pada: <br><br><pre> <code class="hljs lisp">Q1 = SR (<span class="hljs-name"><span class="hljs-name">SET1</span></span>, RESET)</code> </pre> <br>  Variabel input SET dan RESET1 sama dengan variabel output Q1 dari tipe BOOL. <br><br><h4>  Dalam Arduino IDE: </h4><br><pre> <code class="hljs pgsql">RS_TRIG RS_TRIG1; Q = RS_TRIG1.Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>, <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>); //  "  "</code> </pre> <br><pre> <code class="hljs pgsql">SR_TRIG SR_TRIG1; Q = SR_TRIG1.Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>, <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>); //  "  "</code> </pre> <br><h2>  Kode Sumber dan Contoh </h2><br><div class="spoiler">  <b class="spoiler_title">plcStandardLib_1.h</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/* * plcStandardLib_1.h * * Created on: 01.01.2017 * Author: Admin */</span></span> #ifndef PLCSTANDARDLIB_1_H_ #define PLCSTANDARDLIB_1_H_ #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ARDUINO &gt;= <span class="hljs-number"><span class="hljs-number">100</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;Arduino.h&gt; #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;WProgram.h&gt; #endif <span class="hljs-comment"><span class="hljs-comment">/* ------------------- TON ------------------- */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TON { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: TON(); TON(unsigned long PT); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Q; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>; //   unsigned long PT; //   unsigned long ET; //   -    private: <span class="hljs-type"><span class="hljs-type">boolean</span></span> _M; //   unsigned long _StartTime; }; <span class="hljs-comment"><span class="hljs-comment">/* ------------------- TOF ------------------- */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TOF { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: TOF(); TOF(unsigned long PT); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Q; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>; //   unsigned long PT; //   unsigned long ET; //   -    private: <span class="hljs-type"><span class="hljs-type">boolean</span></span> _M; //   unsigned long _StartTime; }; <span class="hljs-comment"><span class="hljs-comment">/* ------------------- TP ------------------- */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TP { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: TP(); TP(unsigned long PT); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Q; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>; //   unsigned long PT; //   unsigned long ET; //   -    private: <span class="hljs-type"><span class="hljs-type">boolean</span></span> _M; //   unsigned long _StartTime; }; <span class="hljs-comment"><span class="hljs-comment">/* ------------------- R_TRIG ------------------- */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> R_TRIG //    { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: R_TRIG(); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> CLK); <span class="hljs-type"><span class="hljs-type">boolean</span></span> CLK; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> Q; //   private: <span class="hljs-type"><span class="hljs-type">boolean</span></span> _M; //   }; <span class="hljs-comment"><span class="hljs-comment">/* ------------------- F_TRIG ------------------- */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> F_TRIG //    { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: F_TRIG(); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> CLK); <span class="hljs-type"><span class="hljs-type">boolean</span></span> CLK; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> Q; //   private: <span class="hljs-type"><span class="hljs-type">boolean</span></span> _M; //   }; <span class="hljs-comment"><span class="hljs-comment">/* ------------------- RS_TRIG ------------------- */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> RS_TRIG //    { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: RS_TRIG(); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>, <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>); <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> Q; //   //private: }; <span class="hljs-comment"><span class="hljs-comment">/* ------------------- SR_TRIG ------------------- */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> SR_TRIG //    { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: SR_TRIG(); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(); <span class="hljs-type"><span class="hljs-type">boolean</span></span> Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>, <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>); <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>; //   <span class="hljs-type"><span class="hljs-type">boolean</span></span> Q; //   //private: }; #endif <span class="hljs-comment"><span class="hljs-comment">/* PLCSTANDARDLIB_H_ */</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">plcStandardLib_1.cpp</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/* * plcStandardLib_1.h * * Created on: 01.01.2017 * Author: Admin */</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "plcStandardLib_1.h" <span class="hljs-comment"><span class="hljs-comment">/* ------------------- TON ------------------- */</span></span> TON::TON() { <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; PT = <span class="hljs-number"><span class="hljs-number">0</span></span>; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _StartTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; } TON::TON(unsigned long PT) { <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; TON::PT = PT; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _StartTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> TON::Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { TON::<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!TON::<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_M) { _M = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; //    _StartTime = millis(); // ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; //  = <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Q) ET = millis() - _StartTime; //   } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ET &gt;= PT) Q = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } <span class="hljs-comment"><span class="hljs-comment">/* ------------------- TOF ------------------- */</span></span> TOF::TOF() { <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; PT = <span class="hljs-number"><span class="hljs-number">0</span></span>; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _StartTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; } TOF::TOF(unsigned long PT) { <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; TOF::PT = PT; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _StartTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> TOF::Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { TOF::<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TOF::<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { Q = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; _M = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_M) { _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; //    _StartTime = millis(); // ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; //  = <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Q) ET = millis() - _StartTime; //   } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ET &gt;= PT) Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } <span class="hljs-comment"><span class="hljs-comment">/* ------------------- TP ------------------- */</span></span> TP::TP() { <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; PT = <span class="hljs-number"><span class="hljs-number">0</span></span>; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _StartTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; } TP::TP(unsigned long PT) { <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; TP::PT = PT; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _StartTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> TP::Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { TP::<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_M) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TP::<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { _M = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; //    _StartTime = millis(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ET &lt; PT) Q = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Q) { ET = millis() - _StartTime; //   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ET &gt;= PT) Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!TP::<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) { _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; ET = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } <span class="hljs-comment"><span class="hljs-comment">/* ------------------- R_TRIG ------------------- */</span></span> R_TRIG::R_TRIG() { CLK = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _M = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> R_TRIG::Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> CLK) { R_TRIG::CLK = CLK; Q = R_TRIG::CLK &amp;&amp; !_M; _M = R_TRIG::CLK; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } F_TRIG::F_TRIG() { CLK = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; _M = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> F_TRIG::Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> CLK) { F_TRIG::CLK = CLK; Q = !F_TRIG::CLK &amp;&amp; !_M; _M = !F_TRIG::CLK; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } <span class="hljs-comment"><span class="hljs-comment">/* ------------------- RS_TRIG ------------------- */</span></span> RS_TRIG::RS_TRIG() { <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> RS_TRIG::Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>, <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>) { RS_TRIG::<span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>; RS_TRIG::<span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>; Q = !<span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Q); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> RS_TRIG::Run() { Q = !<span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> Q); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } <span class="hljs-comment"><span class="hljs-comment">/* ------------------- SR_TRIG ------------------- */</span></span> SR_TRIG::SR_TRIG() { <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> SR_TRIG::Run(<span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>, <span class="hljs-type"><span class="hljs-type">boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>) { SR_TRIG::<span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span>; SR_TRIG::<span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span>; Q = <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> Q); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; } <span class="hljs-type"><span class="hljs-type">boolean</span></span> SR_TRIG::Run() { Q = <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">RESET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> Q); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Q; }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">plcStandardLib_1_example.ino</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"plcStandardLib_1.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LED 13 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ButtonIn 7 TON TON1(500); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   , 500. TON TON2(1000); //   , 1000. TOF TOF1(500); //   , 500. TP TP1(300); //   , 300. TP TP2(200); //   , 200. R_TRIG R_TRIG1; //      void setup() { pinMode(ButtonIn, INPUT_PULLUP); pinMode(LED, OUTPUT); } void loop() { digitalWrite(LED, TP1.Run(R_TRIG1.Run(TON1.Run(digitalRead(ButtonIn))))); // TON1 -    // R_TRIG1 -    // TP1 -     digitalWrite(LED, TP2.Run(TON2.Run(!TON2.Q))); //     TON  TP // TON2.Run(!TON2.Q)) -    // TP2 -     digitalWrite(LED, TOF1.Run(TON1.Run(digitalRead(ButtonIn)))); //     }</span></span></span></span></code> </pre><br></div></div><br>  Misalnya, untuk memfilter obrolan kontak tombol (saat membuka juga!), Kode ini cukup: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">FiltredButtonIn</span></span> = TON1.Run(digitalRead(ButtonIn))</code> </pre> <br>  Kesimpulannya: ini adalah bagaimana CODESYS terlihat seperti generator pulsa berdasarkan rantai timer TON dan TP.  Pada awalnya, TON ditutupi oleh umpan balik dengan inversi, dan darinya generator pulsa tunggal dihasilkan, yang memulai operasi generator pulsa TP.  Dalam contoh Arduino saya, analog dari ini terlihat seperti ini: <br><br><pre> <code class="hljs lisp">digitalWrite(<span class="hljs-name"><span class="hljs-name">LED</span></span>, TP2.Run(<span class="hljs-name"><span class="hljs-name">TON2</span></span>.Run(!TON2.Q)))<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/XIjuetT1CvM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id402315/">https://habr.com/ru/post/id402315/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id402305/index.html">Bagaimana kami menguji koreksi gigitan dengan eliner pada direktur kami</a></li>
<li><a href="../id402307/index.html">Penyalahgunaan smartphone Meizu Pro 5 Ubuntu Edition</a></li>
<li><a href="../id402309/index.html">Setrika atau kapal hampir berbentuk segitiga</a></li>
<li><a href="../id402311/index.html">Robot akan membuat dunia bersih</a></li>
<li><a href="../id402313/index.html">Cara mengatur tidur: metode efek langsung pada aktivitas otak</a></li>
<li><a href="../id402317/index.html">Headset VR terbaik untuk pemilik ponsel</a></li>
<li><a href="../id402319/index.html">Universitas Jagiellonian mengembangkan aplikasi pelatih menggunakan kemampuan IBM Watson</a></li>
<li><a href="../id402321/index.html">Ulasan Livall: helm pintar dengan pengontrol, mikrofon, dan aplikasi asli</a></li>
<li><a href="../id402323/index.html">"Juga berhasil": Seni mendengarkan musik</a></li>
<li><a href="../id402325/index.html">"Dunia kurus." Bab 7</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>