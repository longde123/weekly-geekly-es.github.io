<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüöí ü§∏üèΩ üé∞ Appels vid√©o sous le capot: de millions par jour √† 100 participants dans une conf√©rence ‚ô†Ô∏è üßóüèΩ ü§±üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Maintenant, il semble impossible de trouver un messager sans la fonction d'appel. Ceci est pratique pour les utilisateurs, car toutes les communicatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Appels vid√©o sous le capot: de millions par jour √† 100 participants dans une conf√©rence</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/odnoklassniki/blog/479852/">  Maintenant, il semble impossible de trouver un messager sans la fonction d'appel.  Ceci est pratique pour les utilisateurs, car toutes les communications peuvent √™tre effectu√©es dans une seule application.  Si nous combinons toutes les statistiques disponibles dans les m√©dias, il s'av√®re que les gens parlent sur Internet pendant plus d'un milliard de minutes par jour.  Et avec le d√©veloppement de la technologie, la part de la communication vid√©o augmente, car la vid√©o transmet mieux les √©motions de l'interlocuteur et permet de cr√©er l'effet de pr√©sence. <br><br>  Un nouveau d√©fi pour le service d'appel vid√©o est de r√©unir √† la fois toute une famille ou un groupe d'amis situ√©s dans diff√©rentes parties du monde, ou des coll√®gues travaillant √† distance sur le m√™me projet, pour la planification. <br><img src="https://habrastorage.org/webt/mh/zl/8a/mhzl8ar7wkjk2akfni3vzzbiufi.jpeg"><br>  Le responsable du d√©veloppement des plates-formes vid√©o et bande, Alexander Tobol ( <a href="https://habr.com/ru/users/alatobol/" class="user_link">alatobol</a> ), montrera que sous le capot il y a un service d'appel vid√©o, quelles technologies et hacks utiliser pour cr√©er votre serveur de conf√©rence et comment transf√©rer la vid√©o correctement.  Venez sous la coupe et apprenez comment transf√©rer un service d'appel individuel √† des appels de groupe pour 100 personnes et pourquoi avez-vous besoin de soutien pour tant de participants. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/2z4XO3fyn3U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  L'article est bas√© sur un rapport sur <a href="https://www.highload.ru/">HighLoad ++ Siberia</a> , dans lequel Alexander Tobol tente de donner une image compl√®te.  Si vous connaissez d√©j√† d'autres documents sur le sujet (par exemple, <a href="https://habr.com/ru/company/oleg-bunin/blog/428217/">sur les fonctionnalit√©s de la transmission vid√©o</a> et <a href="https://habr.com/ru/company/oleg-bunin/blog/461829/">des protocoles r√©seau</a> ), vous pouvez ignorer la partie th√©orique et passer directement √† la <a href="https://habr.com/ru/company/odnoklassniki/blog/479852/">solution</a> . <br><br>  <strong>Le plan de l'article:</strong> <br><br><ul><li>  Historique et appels des appareils. </li><li>  <a href="https://habr.com/ru/company/odnoklassniki/blog/479852/">Transition des appels priv√©s aux appels de groupe.</a> </li><li>  <a href="https://habr.com/ru/company/odnoklassniki/blog/479852/">Service d'appel de groupe bricolage.</a> </li><li>  <a href="https://habr.com/ru/company/odnoklassniki/blog/479852/">Serveur de conf√©rence: explorez les concurrents et faites mieux.</a> </li></ul><br><h2>  Historique des appels </h2><br>  La premi√®re application bien connue pour les appels, et avec la vid√©o, √©tait Skype, elle est apparue en 2006.  √Ä Odnoklassniki, nous avons lanc√© des appels bas√©s sur une solution d'Adobe en 2010-2012 ... Il y a quelques ann√©es, nous l'avons enti√®rement refaite sur WebRTC (plus d'informations sur ce lancement <a href="https://habr.com/ru/company/oleg-bunin/blog/428217/">ici</a> ), l'ann√©e derni√®re, nous avons ajout√© des appels de groupe.  Cette transition sera discut√©e dans l'article. <br><img src="https://habrastorage.org/webt/5v/-d/9o/5v-d9oc0kvmij7u43f4q8dihyoa.jpeg"><br>  Pourquoi je pense que je peux vous dire comment faire cela?  Parce que notre audience mensuelle utilisant les appels d√©passe 10 millions de personnes, et <strong>nous avons plus de 2 millions d'appels par jour</strong> .  De plus, plus de la moiti√© d'entre eux se produisent via des plateformes mobiles. <br><br>  Les appels de groupe sont le service qui conna√Æt la croissance la plus rapide, et notre objectif est de 100 participants simultan√©s √† la conf√©rence.  Pourquoi tant?  Tout d'abord, vous voulez parfois partager un beau clich√© avec vos amis et camarades de classe ou organiser un s√©minaire.  Deuxi√®mement, m√™me si vous pensez que votre service n'a pas besoin de quelque chose, tout peut changer. <br><br>  Maintenant, il peut sembler que les vid√©oconf√©rences pour 100 participants ne sont pas n√©cessaires, et il y a cinq ans, ils m'ont demand√© pourquoi nous lan√ßions la vid√©o en 4K.  Maintenant, un t√©l√©viseur 4K est monnaie courante, et nous √©tions pr√™ts en 2014. <br><blockquote>  Le point n'est pas en avance.  Si vous voulez rendre un bon service, √©levez votre barre d'exigences plus haut. </blockquote>  Si vous pouvez faire des appels qui fonctionnent bien pour 50 √† 100 personnes, alors pour 6 √† 10 utilisateurs, tout fonctionnera tr√®s bien. <br><br>  Chaque service d'appel comprend 4 composants relativement ind√©pendants: <br><br><ul><li>  <strong>Signalisation</strong>  La t√¢che consiste √† appeler l'abonn√©, √† √©changer les donn√©es initiales, √† informer ce que chaque abonn√© peut faire, puis √† √©tablir un canal par lequel les donn√©es vid√©o peuvent √™tre transmises. </li><li>  <strong>Vid√©o / audio.</strong>  Les donn√©es vid√©o et audio sont compress√©es √† l'aide de codecs. </li><li>  <strong>R√©seau.</strong>  Il est n√©cessaire d'assurer le travail dans les mauvais r√©seaux, de mettre en ≈ìuvre la r√©cup√©ration de paquets, les connexions p2p, etc. </li><li>  <strong>Topologie</strong> - ajout√©e en cas d'appels de groupe. </li></ul><br>  Vous pouvez parler de chacune de ces parties s√©par√©ment.  Mais je veux donner une vue d'ensemble du fonctionnement des appels, je vais donc essayer de tout mettre dans une seule histoire. <br><br>  Avant de commencer √† travailler sur le service, vous devez identifier les <strong>exigences</strong> : <br><br><ul><li>  <strong>√âtablissez rapidement une connexion</strong> afin que la connexion soit √©tablie imm√©diatement apr√®s que l'interlocuteur a d√©croch√© le t√©l√©phone. </li><li>  <strong>Qualit√© d'appel √©lev√©e</strong> pour que la vid√©o ne s'effrite pas et ne g√®le pas. </li><li>  <strong>Le nombre de participants √† l'appel</strong> , afin que vous puissiez appeler dans des chats, dans lesquels jusqu'√† 100 participants. </li><li>  <strong>Faible latence entre les appelants.</strong>  Latence de 1,3 s car Polycom ne nous convient pas du tout. </li></ul><br>  Voici les significations sp√©cifiques dans lesquelles ces exigences pour les appels de groupe sont exprim√©es: d√©but d'un appel pas plus d'une seconde;  un r√©seau dans lequel la vid√©o √† 300 Kbps fonctionne de mani√®re stable;  latence de l'appelant √† l'auditeur pas plus de 0,5 seconde;  100 utilisateurs en un seul appel. <br><br><h2>  Qu'est-ce qui vous g√™ne? </h2><br>  Comme vous le savez, les donn√©es dans les r√©seaux sont transmises par paquets: il y a une socket, vous y envoyez un flux de donn√©es, tout s'envole, comme si dans une bo√Æte noire, il collecte et fonctionne. <br><img src="https://habrastorage.org/webt/e4/pa/vy/e4pavyyaikufar_cl4sqw1karxe.jpeg"><br>  Mais les r√©seaux sont diff√©rents.  La moiti√© des appels sont pass√©s via des r√©seaux mobiles et ne ressemblent pas toujours √† une autoroute. <br><img src="https://habrastorage.org/webt/ck/62/va/ck62vamogxhsgqdjuvvmoa1jlrq.jpeg"><br>  Les r√©seaux peuvent √™tre surcharg√©s, puis les donn√©es seront perdues et elles devront √™tre restaur√©es, ce qui chargera davantage le r√©seau.  Il existe des r√©seaux avec lesquels tout semble √™tre en ordre, mais les paquets disparaissent toujours - par exemple, du fait que le routeur Wi-Fi est situ√© derri√®re un mur en b√©ton arm√©. <br><br><h2>  Caract√©ristiques r√©seau </h2><br>  Nous analyserons les principales caract√©ristiques qui d√©crivent la qualit√© du r√©seau. <br><br><h3>  RTT </h3><br>  Temps d'aller-retour - le temps entre l'envoi par le serveur des donn√©es au client et la r√©ception de l'accus√© de r√©ception. <br><br>  Rappelez-vous, nous voulons √©tablir une connexion en 1 seconde.  Si le temps d'aller-retour est de 200 ms, alors avec la connexion √©tablie, par exemple, sur TCP, plus certains TLS, <strong>vous ne pouvez perdre 500 ms que lorsque la connexion est √©tablie</strong> .  Il ne restera que 500 ms, soit  quelques demandes suppl√©mentaires, apr√®s quoi la connexion doit √™tre √©tablie.  Par cons√©quent, avec des demandes suppl√©mentaires avec RTT, vous devez travailler tr√®s attentivement. <br><br>  Un exemple: <br><br><pre><code class="xml hljs">$ ping google.com 64 bytes from 173.194.73.139: icmp_seq=5 ttl=44 time=211.847 ms round-trip min/avg/max/stddev = 209.471/220.238/266.304/19.062 ms RTT = 220ms $ curl -o /dev/null -w "HTTP time taken: %{time_connect}\nHTTPS time taken: %{time_appconnect}\n" -s https://www.google.com HTTP time taken: 0.231 HTTPS time taken: 0.797 HTTP = 230ms HTTPS = 800ms</code> </pre> <br>  Avec RTT = 220 ms, la r√©ception d'une r√©ponse via https prend jusqu'√† 800 ms.  Par cons√©quent, si vous avez une connexion s√©curis√©e de socket Web, alors avec un tel ping, la seconde enti√®re dispara√Ætra. <br><img src="https://habrastorage.org/webt/h7/jz/fz/h7jzfzctyl9uto140qct-vu05um.jpeg"><br>  Le tableau montre les retards de prise de contact mesur√©s dans les r√©seaux mobiles (dans <a href="https://youtu.be/0xKAR0AHIdY">ce</a> rapport, plus de d√©tails sur le fonctionnement des applications dans les r√©seaux mobiles). <br><br><h3>  D√©bit </h3><br>  Vous pouvez envoyer des paquets au r√©seau comme vous le souhaitez: par lots ou imm√©diatement tout marteler dans le tampon, ils parviendront toujours au client de mani√®re uniforme.  Le nombre de paquets ou de donn√©es par seconde est la bande passante ou la bande passante. <br><br>  Le probl√®me est que la <strong>bande passante dans les r√©seaux mobiles est en constante √©volution</strong> .  S'il a fortement chut√© et que les donn√©es sont transmises avec le m√™me d√©bit, elles subiront √©videmment des pertes et l'appel de l'utilisateur "se bloquera".  Cela devra √©galement √™tre combattu. <br><br><h3>  Perte de paquets </h3><br>  Lors du transfert de donn√©es, le paquet peut √™tre perdu.  Dans ce cas, il y a un choix: soit ignorer une partie des paquets et obtenir des distorsions, soit essayer de retransmettre des paquets et obtenir un arr√™t sur image. <br><br><h3>  Jitter </h3><br>  Le fait est que les paquets n'arrivent pas uniform√©ment un √† la fois, mais en paquets group√©s √† un certain intervalle. <br><br><img src="https://habrastorage.org/webt/zs/hc/fu/zshcfujfcg6helcc8rnx8pyfor4.jpeg"><br>  La gigue est facile √† mesurer: <br><br><pre> <code class="xml hljs">PING highload.ru (178.248.233.16): 56 data bytes icmp_seq=11 ttl=43 time=117.177 ms icmp_seq=12 ttl=43 time=132.868 ms icmp_seq=13 ttl=43 time=176.413 ms icmp_seq=14 ttl=43 time=225.981 ms</code> </pre> <br>  Pinganuli highload.ru plusieurs fois (le ping est une valeur instable, il faut faire la moyenne), nous avons obtenu la gigue moyenne: <code>((132-117)+(176-132)+(225-176)) / 3 = (14 + 44 + 79) / 3 = 46 </code> . <br><img src="https://habrastorage.org/webt/zj/4n/wp/zj4nwpcfmrefzo989lg_ipmbffy.jpeg"><br>  Supposons que nous transmettions une vid√©o et qu'une trame soit un paquet r√©seau.  Plusieurs images sont jou√©es sans interruption, mais le troisi√®me oiseau est retard√© en raison de la gigue - nous obtenons une image fig√©e.  Donc, vous devez accumuler des packages quelque part et √©galiser cet effet. <br><br>  Autrement dit, pour caract√©riser les r√©seaux sans fil, il suffit de conna√Ætre les valeurs suivantes: RTT (temps aller-retour);  bande passante BW (bande passante);  pourcentage de perte de paquets;  gigue. <br><br><h2>  √Ä quoi ressemble l'utilisateur? </h2><br>  Avant de commencer √† optimiser le travail avec le r√©seau, vous devez savoir quel type d'Internet les utilisateurs ont - peut-√™tre que tout le monde a un r√©seau parfait, n'importe quelle solution fonctionnera. <br><br>  Dans 80% des cas, l'utilisateur final utilise une connexion sans fil: il s'agit soit d'un r√©seau mobile soit du Wi-Fi. <br><br><img src="https://habrastorage.org/webt/ub/_w/ep/ub_wepc3hzha5g1vmnbcuvu5758.jpeg"><br><br>  En Russie, en dehors de la r√©gion occidentale et des grandes villes, les caract√©ristiques moyennes du r√©seau sont: RTT - 200 ms, bande passante - 1,1 Mbps, perte de paquets - 0,6%, gigue - 5 ms. <br><br>  Nous avons divis√© ces valeurs par types de r√©seaux et nous avons r√©alis√© qu'il √©tait n√©cessaire d'apprendre √† travailler dessus. <br><br><img src="https://habrastorage.org/webt/vb/mk/6u/vbmk6ue1tjohnzk9dmybx7jgiq4.jpeg"><br><br><h2>  Fonctions de d√©veloppement d'appels </h2><br>  Beaucoup de gens oublient, mais le LTE et la 3G sont des canaux de communication asym√©triques: la liaison descendante est toujours plus que la liaison montante.  Selon le type de protocole, ce ratio peut varier de 15/85 √† 30/70.  Lors de la conception des appels, cela est important. <br><br>  Comment v√©rifier le canal de vos clients? <br><br><img src="https://habrastorage.org/webt/9y/kz/pj/9ykzpjasmaqko3glxox9ps6tkgs.jpeg"><br><br>  Vous pouvez regarder speedtest, quel est le rapport de vitesse dans le monde entre Internet mobile et Internet fixe.  Il s'est av√©r√© que dans le monde entier, l'Internet fixe est √©galement asym√©trique.  En Russie, heureusement, il s'est av√©r√© √™tre sym√©trique: le rapport de liaison montante / liaison descendante sur un Internet fixe via Wi-Fi en Russie est de 50/50.  Nous nous concentrerons sur ces valeurs. <br><br><img src="https://habrastorage.org/webt/al/6o/zb/al6ozb-zf_b_f8vecacwryr-gce.jpeg"><br><br>  <strong>Conclusion: les</strong> r√©seaux sans fil sont populaires et instables. <br><br><ul><li>  Plus de 80% des clients utilisent Internet sans fil. </li><li>  Les param√®tres sans fil changent dynamiquement. </li><li>  Les r√©seaux sans fil ont des taux √©lev√©s de perte de paquets, de gigue et de r√©organisation. </li><li>  Canal de liaison montante / liaison descendante asym√©trique dans un rapport de 30/70. </li></ul><br><h2>  Appels </h2><br>  Avec ce magasin de connaissances, revenons √† l'impl√©mentation des appels de groupe.  Consid√©rons un algorithme pour un appel de groupe simple, que nous affinons ensuite. <br><br>  <strong>√âtape 1.</strong> Alice veut appeler Boris et lui envoie une offre, dans laquelle elle rapporte tout ce qu'elle peut, qui prend en charge les protocoles, les param√®tres, etc. <br><img src="https://habrastorage.org/webt/k-/gr/xz/k-grxzwigzw4xaqgctisb27xalq.jpeg"><br>  <strong>√âtape 2.</strong> Boris r√©pond √† Alice, apr√®s quoi une connexion de transport est √©tablie. <br><img src="https://habrastorage.org/webt/qf/yp/my/qfypmyzwq5sjl8et0tg2ju6vddm.jpeg"><br>  <strong>√âtape 3.</strong> Apr√®s cela, l'√©change de donn√©es audio / vid√©o commence. <br><img src="https://habrastorage.org/webt/rb/7w/hh/rb7whhnevjv6s15l0nmvftyx2lq.jpeg"><br>  L'architecture de tous les appels ressemble au sch√©ma ci-dessous. <br><img src="https://habrastorage.org/webt/_n/6g/7o/_n6g7ohpbtl7wonvxjfrdcb8w2a.jpeg"><br>  Il y a toujours un serveur partag√©, mais lorsque la connexion est √©tablie, les utilisateurs peuvent d√©j√† transf√©rer des donn√©es p2p ou via des serveurs tiers. <br><br>  Les donn√©es sont captur√©es par une cam√©ra qui les encode sur l'appareil et les envoie √† la connexion socket.  Ils transitent par le r√©seau, sont lus de l'autre c√¥t√© par le codec et affich√©s √† l'√©cran. <br><br>  Consid√©rez toutes les √©tapes de l'algorithme en d√©tail et essayez de passer d'appels individuels √† des appels de groupe. <br><br><h2>  Signalisation </h2><br>  T√¢che: signaler un appel et √©tablir des connexions de donn√©es. <br><br>  Tout est assez simple: <br><br><ul><li>  Alice appelle, une notification est envoy√©e √† Boris sur un appareil mobile ou un navigateur. </li><li>  Une prise Web ou toute autre connexion est √©tablie. </li><li>  Apr√®s cela, la n√©gociation a lieu - Alice et Boris sont d'accord. </li><li>  Lorsque le combin√© est d√©croch√© sur un appareil, l'appel se termine automatiquement sur l'autre. </li></ul><br><img src="https://habrastorage.org/webt/x8/p8/4a/x8p84akywewgezvufnt64jqfmp8.jpeg"><br>  La plate-forme d'appel d'Odnoklassniki prend en charge divers clients et transports.  Ils sont tous proches d'une sorte de serveur, qui s'occupe d'un service d'appel et de transfert de messages. <br><img src="https://habrastorage.org/webt/on/3v/9s/on3v9swzgtmfub9c_ru18qwjl1m.jpeg"><br>  En cas de panne du serveur ou d'installation de mises √† jour, il existe un stockage persistant dans lequel tous les messages sont enregistr√©s.  En cas de perte de serveur, vous pouvez facilement passer √† un autre.  C'est ce que fait ZooKeeper. <br><br>  La seule difficult√© est <strong>exactement une fois</strong> .  Nous ne voulons pas appliquer deux fois certains messages.  Ce probl√®me est r√©solu simplement: tous les messages ont un num√©ro de s√©rie - deux fois, un seul message n'arrivera pas. <br><br>  De plus, vous devez √™tre prudent lors de la cr√©ation d'un appel.  Une personne peut cr√©er un appel, raccrocher et cr√©er un autre appel.  Ou il peut ne pas se bloquer, mais en cr√©er un autre.  Tous ces appels ne sont pas uniques - il n'est pas clair s'il s'agit d'un relais ou si l'utilisateur a double-cliqu√© sur le bouton d'appel.  Il est facile √† r√©parer: un identifiant unique est g√©n√©r√© sur le client, et la d√©duplication est effectu√©e sur celui-ci.  En principe, <strong>il n'y a pas de difficult√©s de signalisation</strong> . <br><br>  La signalisation p2p au groupe se termine facilement. <br><img src="https://habrastorage.org/webt/7q/y6/zh/7qy6zhw2z72nbjcazwlx681hrau.jpeg"><br>  Les m√™mes offres et r√©ponses qu'Alice envoie maintenant non seulement √† Boris, mais aussi √† Dima.  Ils les re√ßoivent, d'accord, des canaux d'√©change de donn√©es apparaissent entre eux. <br><br><h2>  Audio / vid√©o </h2><br>  Afin de faire face √† un appel de groupe et de comprendre quelles technologies sont n√©cessaires, nous devrons parler un peu de la vid√©o. <br><br>  La vid√©o est de 24 ou 60 images par seconde.  Afin de les compresser, des codecs sont utilis√©s.  L'essence principale des codecs est que, sur quelques images, il existe une image de r√©f√©rence (telle que JPEG), et les images interm√©diaires sont d√©termin√©es par des modifications. <br><img src="https://habrastorage.org/webt/yl/2d/fs/yl2dfs-nsm6cmuifnpaykbyhnkg.jpeg"><br>  Dans l'image ci-dessus, la premi√®re image avec la machine est la r√©f√©rence, et dans l'image suivante, seules les modifications (mouvement de la machine) sont cod√©es, et la prochaine fois, seules les modifications sont √©galement cod√©es. <br><br>  C'est ce qu'on appelle un groupe d'images - un ensemble ind√©pendant de trames interconnect√©es qui peuvent √™tre d√©cod√©es.  Le codec est un algorithme de transformation entre les trames.  Plus le codec est raide, mieux il compresse les donn√©es et plus il a besoin de ressources. <br><div class="scrollable-table"><table><tbody><tr><td>  La qualit√© </td><td>  Autorisation </td><td>  D√©bit minimal </td></tr><tr><td>  FullHD </td><td>  1920x1080 </td><td>  4 Mbps </td></tr><tr><td>  HD </td><td>  1280x720 </td><td>  1,5 Mbps </td></tr><tr><td>  faible </td><td>  640x360 </td><td>  600 kbps </td></tr><tr><td>  le plus bas </td><td>  426x240 </td><td>  300 kbps </td></tr></tbody></table></div>  √Ä propos du ratio de d√©bits de codec, il existe des r√®gles g√©n√©rales (voir <a href="https://youtu.be/e1JYFRwHzkQ">lien</a> ). <br><br>  Les codecs les plus populaires utilis√©s pour les appels sont <strong>H.264 et VP8</strong> .  Le H.264 est bon car il travaille partout dur et ne mange pas de batterie.  Mais g√©n√©ralement sur les t√©l√©phones, un encodeur (encodeur) et 4 d√©codeurs.  Pour tout le reste, vous avez besoin du logiciel VP8, qui consomme une bonne batterie.  Il vaut la peine de changer la priorit√© en H.264 pour les appels de groupe (voir le <a href="https://is.gd/5WaBAP">lien</a> sur la fa√ßon de proc√©der). <br><br>  Le codec peut coder avec une variable (d√©bit variable) ou un d√©bit constant (d√©bit constant).  De nombreux codecs sur les appareils ne prennent pas en charge un d√©bit binaire constant, vous devez donc vivre avec l'image de gauche. <br><img src="https://habrastorage.org/webt/6r/ej/mt/6rejmtldwpgvu2an6bbjwu7-xoq.jpeg"><br><br><h3>  Codecs audio </h3><br>  Il existe diff√©rents codecs h√©rit√©s pour l'audio, tels que le G711.  Le codec Opus est tr√®s populaire - il r√©sout le probl√®me d'encodage √† bas et √† haut d√©bit, car √† l'int√©rieur il contient SILK de Skype et le codec CELT pour la musique. <br><br>  Il vaut la peine de dire qu'Opus dispose d'un algorithme de correction d'erreur proactive de correction d'erreur directe (FEC).  Pour l'audio, cet algorithme fonctionne comme ceci: dans chaque paquet, il y a des donn√©es de haute qualit√© et des donn√©es des trames pr√©c√©dentes pendant un certain temps de faible qualit√©.  Par cons√©quent, si le package pr√©c√©dent est perdu, vous pouvez obtenir les donn√©es du package pr√©c√©dent en basse qualit√© et les perdre en quelque sorte.  En moyenne, cela se r√©v√®le plut√¥t bien. <br><br>  Lorsque vous travaillez avec des codecs audio, il est int√©ressant de regarder le graphique, qui montre le rapport entre la qualit√© du signal d'entr√©e et le d√©bit binaire. <br><img src="https://habrastorage.org/webt/_r/wd/em/_rwdemfrce5rw2njez4pge9wgr0.jpeg"><br>  On peut voir qu'Opus r√©sout presque tous les probl√®mes.  Il est int√©ressant de faire attention √† l'AAC, qui est utilis√© lors du codage vid√©o dans divers services d'h√©bergement, et √† l'ancien codec Speex, qui √©tait utilis√© exclusivement pour l'audio et fonctionne jusqu'√† 32 Kbps. <br><br><h3>  Donn√©es de pathologie des m√©dias </h3><br>  Afin de comprendre le fonctionnement des topologies, leurs fonctionnalit√©s, vous devez comprendre comment un codec vid√©o g√®re les pertes. <br><img src="https://habrastorage.org/webt/vt/dn/zm/vtdnzmfdmc8n8bxq_rmmfoscpls.jpeg"><br>  Dans le premier cas, rien n'a √©t√© perdu et nous voyons une bonne image.  Dans la deuxi√®me ligne, une image al√©atoire est perdue - il y a de petits artefacts dans l'image.  Dans le troisi√®me cas, le cadre de r√©f√©rence a disparu, par cons√©quent, jusqu'√† ce que le cadre de r√©f√©rence suivant, des modifications se chevauchant de mani√®re al√©atoire s'affichent. <br><br>  √âvidemment, la r√©alisation de r√©f√©rentiels est souvent co√ªteuse car le d√©bit augmente.  Par cons√©quent, presque tous les services d'appel prennent en charge la possibilit√© de demander une trame de r√©f√©rence en cas de perte.  Dans WebRTC, cela s'appelle une trame INTRA compl√®te. <br><br>  La topologie la plus simple consiste √† envoyer toutes vos vid√©os √† tous les autres participants √† la conf√©rence. <br><img src="https://habrastorage.org/webt/st/mt/bu/stmtbu09eze8vg6letvekimnosu.jpeg"><br>  Nous d√©marrons un codec et commen√ßons √† transf√©rer la vid√©o.  Alice allume la cam√©ra, le codec, envoie sa vid√©o √† Boris et Dima.  Mais si Dima a un mauvais Internet, Boris souffre, car vous devez r√©duire la qualit√© de la vid√©o enti√®re.  Et si Dima a perdu le coup et en a demand√© un de soutien, Boris l'obtiendra aussi, bien qu'il n'ait pas eu besoin de lui. <br><br>  D'autre part, vous pouvez coller toutes les vid√©os en un seul flux.  Cela n√©cessitera un √©quipement sp√©cial et, √©ventuellement, des retards suppl√©mentaires, mais une telle solution existe √©galement. <br><br><h3>  Transportez ou diffusez de la vid√©o et de l'audio avec un d√©lai minimal </h3><br>  Nous avons un choix de protocoles TCP ou UDP. <br><div class="scrollable-table"><table><tbody><tr><td>  TCP </td><td>  UDP </td></tr><tr><td>  Fiable </td><td>  Peu fiable </td></tr><tr><td>  Orient√© connexion </td><td>  Sans connexion </td></tr><tr><td>  Retransmission de segment et contr√¥le de flux par fen√™trage </td><td>  Pas de fen√™trage ni de retransmission </td></tr><tr><td>  S√©quen√ßage de segments </td><td>  Pas de s√©quen√ßage </td></tr><tr><td>  S√©quen√ßage d'accus√© de r√©ception </td><td>  Aucune reconnaissance </td></tr></tbody></table></div>  Tout le monde se souvient probablement que TCP est un protocole fiable qui, en cas de perte de paquets, les renvoie.  C'est pourquoi cet ordre d'images est possible, comme dans l'image ci-dessous. <br><img src="https://habrastorage.org/webt/si/qm/rc/siqmrcta6lzauazsdsbitbkifvo.jpeg"><br>  Si un paquet manque dans le paquet, vous pouvez ignorer librement l'une des 24 images de la vid√©o, mais TCP ne vous permettra pas de recevoir ce qui suit jusqu'√† ce que vous envoyiez celui perdu.  <strong>La livraison de vid√©o sur TCP est extr√™mement inefficace.</strong>  UDP est recommand√© pour de telles t√¢ches et tous les services d'appel l'utilisent. <br><br>  Cet <a href="https://habr.com/ru/company/oleg-bunin/blog/461829/">article</a> fournit toutes les fonctionnalit√©s des deux protocoles et explique pourquoi tout le streaming fonctionne sur UDP.  Dans le cadre du sujet d'aujourd'hui, il nous suffit de savoir que l'UDP n'est pas disponible partout, il ne fonctionne pas dans 3% des r√©seaux. <br><img src="https://habrastorage.org/webt/tv/ky/jz/tvkyjzwzytjo2pgxmfgek1afv_8.jpeg"><br>  En g√©n√©ral, les utilisateurs peuvent √©tablir des connexions P2P entre eux. <br><img src="https://habrastorage.org/webt/xe/nj/ew/xenjewfqamelio5eqywflbiyn54.jpeg"><br>  C'est le plus rentable, car si nous nous appelons √† Novossibirsk, il est pr√©f√©rable de communiquer directement et de ne pas utiliser un serveur suppl√©mentaire qui fournira un effet de levier. <br><br>  Mais le NAT existe, et plus de 97% des utilisateurs sont maintenant situ√©s derri√®re lui - peu ont des IP externes.  D'une part, ce probl√®me sera t√¥t ou tard r√©solu par IPv6.  Soit dit en passant, en Russie, MTS a √©t√© le premier √† le lancer.  Maintenant, ils prennent enti√®rement en charge IPv6, et tous leurs clients ont des adresses IP blanches. <br><br>  NAT peut percer, peut ne pas percer, et vous devrez alors utiliser le repli via le serveur.  Il y a aussi un <a href="https://habr.com/ru/company/oleg-bunin/blog/428217/">article sur la</a> fa√ßon de percer le NAT. <br><br><h3>  Tampon de gigue entre le transport et les trames </h3><br>  Nous continuons.  Maintenant, nous avons besoin d'un tampon de gigue pour niveler l'effet de la gigue <br><img src="https://habrastorage.org/webt/od/eb/m5/odebm5kla1eprghttikfis_tzm8.jpeg"><br>  Nous commen√ßons de fa√ßon proactive √† afficher les images avec un certain retard et en attendant, nous alignons les images au m√™me intervalle dans le tampon. <br><br>  Le tampon augmente dynamiquement. <br><img src="https://habrastorage.org/webt/_q/-s/o4/_q-so4lqgyenwyrlcbk2u141h2k.jpeg"><br>  Si la trame est perdue et que l'image est fig√©e, le tampon augmente, et nous travaillons d√©j√† avec un tampon de cette taille. <br><br>  Mais il peut y avoir une situation inverse lorsque vous devez r√©duire la m√©moire tampon.  Par exemple, le r√©seau s'est stabilis√© et il faut gagner du temps.  Si vous r√©duisez simplement le tampon, ce sera ridicule, les gens commenceront √† parler tr√®s rapidement avec la voix d'un gnome.  Par cons√©quent, il existe des algorithmes sp√©ciaux qui ajustent imperceptiblement la vitesse de l'audio: supprimez les pauses entre les mots ou r√©duisez les sons trop longs dans la parole. <br><br>  Si vous souhaitez transcoder une vid√©o et corriger quelque chose, vous devez d'abord avoir un tampon de gigue, et sa latence ne sera pas inf√©rieure √† la gigue de latence de ce r√©seau.  Autrement dit, cela augmente d√©finitivement la latence, et nous nous souvenons que nous voulons vraiment garder dans les 0,5 s. <br><img src="https://habrastorage.org/webt/um/vs/2i/umvs2isu-bjnd2sp4u7ke7sqyv4.jpeg"><br>  Expirez - la th√©orie est termin√©e! <br><br><h2><a name="ok-call"></a>  Appels √† OK </h2><br>  Avant les appels de groupe, nous avons eu des appels p2p, la biblioth√®que WebRTC a √©t√© utilis√©e, des clients Web et mobiles ont √©t√© collect√©s, la signalisation a √©t√© √©crite. <br><img src="https://habrastorage.org/webt/kj/sl/uo/kjsluoez0wxxhsya9ttbfaev--k.jpeg"><br><br><h3>  Analyse des concurrents </h3><br>  Lorsque vous ne savez pas quoi faire, regardez vos concurrents.  Pour r√©f√©rence, nous avons choisi un ensemble: Skype, WhatsApp, Hangouts, ICQ, Zoom.  Nous avons mesur√© le nombre maximum de participants √† un appel de groupe, la latence, la consommation de batterie et la qualit√©. <br><br>  La chose la plus int√©ressante est de d√©terminer le retard.  Nous proc√©dons de cette fa√ßon: allumez la minuterie, commencez √† filmer une vid√©o, passez un appel. <br><img src="https://habrastorage.org/webt/0k/_q/ct/0k_qctbyc9_eenat32mcm3zbz10.jpeg"><br>  100 ms - d√©lai de la cam√©ra √† partir du moment o√π la vid√©o a heurt√© l'objectif, avant qu'elle ne soit dessin√©e sur la matrice du t√©l√©phone.  Apr√®s cela, la vid√©o est envoy√©e au r√©seau et nous constatons d√©j√† un retard de 310 ms dans l'appel. <br><img src="https://habrastorage.org/webt/eg/oi/g5/egoig53tzrzn-1byodqkwmfcfsq.jpeg"><br>  N'oubliez pas de mesurer l'utilisation du processeur sur l'appareil.  √Ä partir d'iOS 12, il est devenu possible de le faire syst√©matiquement, mais nous utilisons un pyrom√®tre √† l'ancienne. <br><br>  A obtenu les r√©sultats suivants: <br><img src="https://habrastorage.org/webt/mk/tu/1s/mktu1se2wjoa_lwb842wsfkyouk.jpeg"><br>  WhatsApp et ICQ ont un maximum de 4 participants, Skype en a 25 (Skype Entreprise 250) et Hangouts et Zoom ont chacun 100 participants.  Hangouts comptait environ 35 membres, et maintenant il est pass√© √† la section 100+. <br><br>  Le zoom a un d√©lai l√©g√®rement plus long, mais Hangouts consomme plus de batterie.  Il m'a sembl√© que Zoom √©tait de meilleure qualit√©, mais il y a des articles qui disent le contraire - c'est une m√©trique subjective. <br><img src="https://habrastorage.org/webt/mu/sa/9b/musa9bet2chfnzj55svmkj5j9qk.jpeg"><br>  Certains services utilisent WebRTC ouvert, d'autres utilisent des protocoles propri√©taires.  Mais il est √©vident que le type de transport que vous utilisez ci-dessous n'affecte pas le nombre de participants √† l'appel.  Il existe des solutions avec 100 appels et avec leurs propres protocoles (Zoom), et avec WebRTC (Hangouts). <br><br><h3>  √âchelle de 2 √† N </h3><br>  Prenons un cas int√©ressant: il y a un client avec un canal asym√©trique, entr√©e 3 Mbit / s, sortie 1,5 Mbit / s, perte de paquets 0,6%, gigue 50 ms.  Il y a de la vid√©o en HD (1280x720) avec un d√©bit binaire de 1,5 Mbps et de la vid√©o avec une r√©solution de 640x360 (appelons LOW) √† 600 Kbps.  Nous voulons transmettre des vid√©os sympas. <br><br>  Dans le cas o√π deux personnes appellent p2p, alors tout est simple.  Ils ont suffisamment de r√©seau d'entr√©e, le r√©seau de sortie est assez serr√©, car le canal est asym√©trique, et il n'y a pas de probl√®me avec les codecs - tous les codecs sont gratuits. <br><br>  Lorsque nous commen√ßons √† faire des appels de groupe, nous devons reconnecter tout le monde.  La version la plus simple de la topologie est <strong>Mesh</strong> ou "all to all". <br><img src="https://habrastorage.org/webt/xt/zk/th/xtzkthwsqgph-xmvnpzufncfl6o.jpeg"><br>  C'est formidable que les serveurs interm√©diaires ne soient pas n√©cessaires, mais il devient probl√©matique de donner √† tout le monde votre vid√©o pour des clients avec de telles caract√©ristiques.  Et si le client ne peut pas distribuer la vid√©o √† quelqu'un seul, vous devez r√©duire la qualit√©, car le flux commun est cod√© pour tout le monde. <br><br>  Dans ce cas, pour 5 participants, ni 3 ni 4 Mbps ne suffisent pas. <br><img src="https://habrastorage.org/webt/ah/h5/rf/ahh5rfvgcjjkm70qhzv1ruduaws.jpeg"><br>  Par cons√©quent, dans WhatsApp dans un appel de groupe, il y a un maximum de 4 participants et ne sera plus aussi longtemps qu'ils utiliseront Mesh. <br><br>  Une autre option consiste <strong>√† collecter l'</strong> image enti√®re <strong>sur le serveur</strong> .  C'est le plus rentable pour le client: il a une connexion au serveur, le serveur recueille l'image, le client la r√©cup√®re. <br><img src="https://habrastorage.org/webt/bg/_3/qh/bg_3qhrgkt1izvjkwciy4pfegbm.jpeg"><br>  Mais supposons que nos utilisateurs de Petropavlovsk-Kamchatsky, Komsomolsk-on-Amur et Novosibirsk souhaitent discuter via un serveur de Moscou.  Naturellement, cela se passera tr√®s mal.  La pr√©sence de CDN aidera un peu, mais obtiendra toujours une grande quantit√© de tampons de gigue, ce qui au total apportera un ajout d√©cent √† la latence. <br><br>  La topologie suivante - <strong>Fin du mixage</strong> - sugg√®re de ne pas collecter une image g√©n√©rale sur le serveur pour √©viter ces retards, mais jette simplement des paquets. <br><img src="https://habrastorage.org/webt/1k/aj/cc/1kajccrtduezyvharoklxqwlv0e.jpeg"><br>  Autrement dit, le serveur de cette topologie est simplement un relais qui transf√®re des donn√©es. <br><br>  Tout va un peu mieux: l'utilisateur re√ßoit les flux de tous les autres participants √† l'appel et n'envoie le sien qu'une seule fois.  Mais encore une fois, il y a des probl√®mes: <br><br><ul><li>  <strong>Qualit√©.</strong>  Tous les destinataires de votre flux ont un r√©seau diff√©rent.  Si une personne est connect√©e √† un Internet m√©diocre, alors la vid√©o doit lui √™tre livr√©e en basse r√©solution et, en cons√©quence, l'image ira mal pour tout le monde. </li><li>  <strong>Cadres de r√©f√©rence Storm</strong> .  Si une personne mal connect√©e √† Internet demande constamment un cadre de r√©f√©rence, alors tout le monde commence √©galement √† recevoir des oporniks.  Il s'agit d'une utilisation inefficace du d√©bit binaire, la qualit√© diminue √† nouveau. </li></ul><br><img src="https://habrastorage.org/webt/26/wj/bv/26wjbvlg4tlfijnuif4dwzpfc8m.jpeg"><br>  Si un <strong>syst√®me centralis√© est utilis√©</strong> , c'est-√†-dire que toutes les vid√©os sont collect√©es sur le serveur.  Cela n√©cessite de nombreuses √©tapes de codage, qui ajoutent de la latence et n√©cessitent du mat√©riel suppl√©mentaire.  En fin de mixage, au contraire, tout est simple et rapide. <br><br>  <strong>Topologies des inconv√©nients:</strong> <br><br><ul><li>  Mesh - maximum 4 membres. </li><li>  Centralis√© - probl√®mes de transcodage et de gigue. </li><li>  Fin du m√©lange - limites de qualit√© et r√©f√©rentiels de temp√™te </li></ul><br>  Seuls ICQ et Skype fonctionnent sur la topologie Mesh, et tous les autres sont End mixage.  Mais, comme nous nous en souvenons, tous les services sont diff√©rents en termes de caract√©ristiques - ce qui signifie qu'il n'y a pas seulement le mixage final, mais autre chose. <br><br>  Hangouts a fait l'affaire avec le mixage de fin. <br><img src="https://habrastorage.org/webt/pm/uy/25/pmuy25cx0untfvn3gbk0qmcehay.jpeg"><br>  Deux encodeurs sont lanc√©s sur chaque client: H.264 en haute qualit√© et VP8 en basse qualit√©.  En cons√©quence, pour les utilisateurs disposant d'un bon Internet, le serveur transmet des vid√©os de haute qualit√©, pour ceux qui ont un mauvais Internet, c'est pire, et la mauvaise qualit√© s'adapte au pire r√©seau.  Deux qualit√©s sont bonnes, mais c'est un trafic suppl√©mentaire des clients et une consommation de batterie.  Mais il n'y a pas de tampon de gigue <br><br>  Le tableau montre qu'avec les Hangouts, le t√©l√©phone chauffe le plus, il pr√©sente des retards minimaux, mais la qualit√© en souffre, car la faible qualit√© ronge toujours le d√©bit binaire √©lev√©. <br><img src="https://habrastorage.org/webt/na/6n/2f/na6n2fs0u3ebkqez1jjntk3kel0.jpeg"><br>    ,    : -      ,  H.264,         (    )   End mixing   .      centralized-,    ,    ,       ,     . <br><img src="https://habrastorage.org/webt/db/15/pw/db15pwl1tkdxpxd4xpz8gp-sba4.jpeg"><br> ,      :      .   ,        , ,     ,   -     .    ,           . <br><br>        . <br><img src="https://habrastorage.org/webt/0o/9y/6b/0o9y6bt7zahjvydljkpnkvaxvyk.jpeg"><br> ,  ,    ,       latency     .    ,        , ,   ,       .                 centralized,    ,  ,   jitter-  .          ,            ,   . <br><br>        ¬´¬ª,   .          100,  50,   20   .           . <br><img src="https://habrastorage.org/webt/du/88/yt/du88ytnejvtsgryudgkdfntv7pg.jpeg"><br>         ‚Äî  ,       5 .      .    :  ,     ,      ,      ‚Äî      . <br><br>  ¬´¬ª      , ,    , ‚Äî  .       :   ,    - ,    fps.  ,          ‚Äî  .    - ,  .    ,     . <br><br><h2><a name="fin"></a>   </h2><br>    Mesh  3-4       latency,    ,         Mesh.      ,   HD   End mixing, a SD ‚Äî  centralized. <br><br>       Zoom. <br><img src="https://habrastorage.org/webt/h9/5q/2q/h95q2que4mihuktnf2mz18zsjua.jpeg"><br> ,    -    ,   Zoom  ,    WebRTC.   <strong>   WebRTC</strong> ,        . <br><br><h2>  </h2><br>      . <br><br> <strong>CPU   ,  .</strong>       ‚Äî ,    ,   ,   ,   CPU ,  .     ,       . <br><br>   :   ,    ,      . <br><br> <strong> screen sharing   .</strong>    screen sharing,       ,    .   screen sharing  .  ,   fps ‚Äî ,    ,    . <br><br> <strong>        .</strong>    ‚Äî     centralized,      ,       .    ,   . <br><img src="https://habrastorage.org/webt/kd/b4/zt/kdb4ztkg9daqyfjryhpzg4u7uac.jpeg"><br>  ,        ,    ,     .         ,    ,                 . <br><br><h2><a name="server"></a>   </h2><br> ,   ,  -     .               . <br><img src="https://habrastorage.org/webt/ga/ve/43/gave43pdwqyaly4pm7b1amurzxc.jpeg"><br><br><h3> Packet pacing </h3><br> -,  UDP-     .   UDP   pacing.    UDP-  ,     . <br><img src="https://habrastorage.org/webt/mc/mb/t3/mcmbt33ngipgrs1xlf3hvhbx6d8.jpeg"><br>   ,      UDP ,   21       100%.           ‚Äî     . <br><br>     pacing?    ,         (   <a href=""></a> ) ‚Äî   ,  .  ,         ,  , ,  ,     ,   -             . <br><br>   : <br><br><ul><li>  pacing,     . </li><li>   pacing, ,  ,   ,      . </li></ul><br>     :        ,  pacing ,    ‚Äî. <br><br>    packet pacing? <br><img src="https://habrastorage.org/webt/wp/y3/vx/wpy3vxtcvgzvn8lukrnrpm2sx2w.jpeg"><br>   ,   (    )      ,   ,  - .   (  ),     ,       ,     . <br><br>    ‚Äî packet loss ,   pacing. <br><br><h3> MTU </h3><br> TCP  ,       MTU.      UDP,     ,  MTU ‚Äî    ,      . <br><br>       MTU 1500,        MTU 1100,   . ,    ,        , , ,    (   ).       ,   MTU . <br><img src="https://habrastorage.org/webt/rc/r7/jv/rcr7jvrykz5mtbajkmskh-s9if0.jpeg"><br>  TCP  ,       .   ,   MTU:   -   ,    , ,    MTU.         ,   MTU,    ,  . <br><br>   . <br><img src="https://habrastorage.org/webt/mp/fx/ct/mpfxctwu5bck6fnp2_nr_lsmugc.jpeg"><br>   ,     :      ,  ,      .  98%          1350.    <strong>MTU = 1350</strong> ,    ,    2%    ‚Äî  ,  . <br><br><h3>   </h3><br> WebRTC  SACK, NACK, FEC.       . <br><br>   ,   1‚Äì3%     ‚Äî  ,      . <br><br>  WebRTC      negative acknowledgement (NACK). <br><img src="https://habrastorage.org/webt/n4/ik/zh/n4ikzhbxffmdjuf-a79snq2vaum.jpeg"><br>         ,  ,  -  ,  . <br><br>  , TCP   acknowledgement,     selective acknowledgement.  negative acknowledgement  ,        FEC (Forward Error Correction). <br><br>     ,   SACK, NACK, FEC,   <a href="https://youtu.be/e1JYFRwHzkQ"></a> . <br><br>  FEC ,   ,   .  :      ,   ,         .     , ,    ‚Äî   . <br><img src="https://habrastorage.org/webt/fo/dw/-s/fodw-s_sepjc4qkhonlbr_k-6pq.jpeg"><br>    FEC ‚Äî  XOR,      , ,  .       ,     -  . <br><br>  <a href="https://tools.ietf.org/html/draft-ietf-payload-flexible-fec-scheme-20"></a>   ,       .     ,        ,     ,     FEC-.  ,   ,         , ,          . <br><br> ,   , <strong>   </strong> .    , : <br><br><ul><li>  90%     500 /. </li><li>    ‚Äî 3-4,        Mesh  End mixing. </li><li>      ‚Äî  27  (,  ). </li></ul><br><h2> Check List </h2><br>          : <br><br><ul><li> Packet pacing. </li><li> MTU discovery. </li><li>  . </li><li> C    . </li></ul><br>    ,     signalling,   WebRTC,   ,   ,     - . <br><br>       ,     : <br><br><ul><li> <strong>Packet loss:</strong> , packet pacing, FEC,  MTU. </li><li> <strong>   :</strong>    back pressure  ,         FEC-. </li><li> <strong>Jitter</strong>     jitter buffer,     latency. </li><li> <strong>RTT:</strong>   ,      signaling. </li></ul><br><h1>      </h1><br> WebRTC ‚Äî    .  RTP,        ,    ,   .     WebRTC  . <br><br>    ,   Zoom, Skype  Line,    .      .         . ,    ,     <a href="https://habr.com/ru/company/oleg-bunin/blog/413479/"></a>   UDP- (      ,   WebRTC),   .   ,    ,    . ,    Google STADIA. <br><br> STADIA ‚Äî   ,       .    WebRTC,  ,     .  Google      WebRTC.     WebRTC     SRTP WebRTC  QUIC.  ,    ,    . <br><br>   QUIC,     .    Chrome  c Android   Google  YouTube,    TCP ‚Äî  QUIC  UDP  Google.     30%   QUIC/UDP. <br><br>     QUIC     20-30%,  TCP.    - QUIC    ,       . <br><br><h1>  Conclusions </h1><br>     ,           .  ,     : signaling; / ;   . ,     ,    . <br><br>     ? <br><br><ul><li>  ,     - ,    . </li><li>       ,    . </li></ul><br>      /     . <br><br>  ,    , ‚Äî <strong>   </strong> .        ,  latency,  . ,    !   -       :) <br><br><blockquote>    HighLoad++     . <a href="https://www.highload.ru/spb/2020"> </a> (      )   ,  <a href="https://conf.ontico.ru/lectures/propose%3Fconference%3Dhl2020-spb"> </a>   6-7  2020   .    ,   <a href="http://eepurl.com/VYVaf"></a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr479852/">https://habr.com/ru/post/fr479852/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr479836/index.html">La Douma d'Etat a adopt√© des amendements √† la loi sur l'√©lectricit√© en termes de micro-g√©n√©ration. Les alternatives seront-elles heureuses?</a></li>
<li><a href="../fr479842/index.html">L'Universit√© de Bata a cr√©√© un neurone analogique √©lectronique</a></li>
<li><a href="../fr479844/index.html">Rassemblez une √©quipe de designers UX et perdez 7 millions en raison d'erreurs d'embauche</a></li>
<li><a href="../fr479848/index.html">Le n√¥tre dans le quadrant 2019! Comment le rapport analytique de vid√©oconf√©rence de Gartner Meeting Solutions a chang√© sur cinq ans</a></li>
<li><a href="../fr479850/index.html">Installer Exchange 2019 sur Windows Server Core 2019</a></li>
<li><a href="../fr479854/index.html">Digeste Java du matin du 12 d√©cembre</a></li>
<li><a href="../fr479858/index.html">Recherche de LD_PRELOAD</a></li>
<li><a href="../fr479860/index.html">Une variation sur le th√®me de la mod√©lisation de la vie. 2e partie</a></li>
<li><a href="../fr479862/index.html">Comment √©conomiser 15 000 roubles lors de l'enregistrement du logiciel</a></li>
<li><a href="../fr479864/index.html">Jeu sur WinForms + C # en 16 ans (2 parties)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>