<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçå üë®üèæ‚Äçüîß üêÑ Mecanismo de control de versi√≥n de base de datos GIT (gesti√≥n de volcado de MySQL) ü§ó üë¶üèΩ üëãüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola, amantes de Habra! Hoy decid√≠ compartir mi versi√≥n de copia de seguridad de datos de MySql y hablar sobre c√≥mo se puede usar para el control de v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mecanismo de control de versi√≥n de base de datos GIT (gesti√≥n de volcado de MySQL)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/449868/"><p>  Hola, amantes de Habra!  Hoy decid√≠ compartir mi versi√≥n de copia de seguridad de datos de MySql y hablar sobre c√≥mo se puede usar para el control de versiones en Git.  Y si est√° interesado en saber c√≥mo puede monitorear el estado de la base de datos en todas las etapas de desarrollo, o simplemente hacer las copias de seguridad <strong>correctas</strong> de su base de datos del proyecto e implementarla en cualquier momento, ¬°l√©ala! <a name="habracut"></a></p><br><h3 id="chto-eto">  Que es esto </h3><br><p>  Este es un conjunto de scripts escritos en BASH, que les permite trabajar en casi cualquier m√°quina en la que funcione este shell, dise√±ado para facilitar la creaci√≥n y despliegue de copias de seguridad.  La idea original era que pod√≠a crear puntos de interrupci√≥n de la base de datos al escribir un proyecto por un equipo de desarrolladores y almacenarlo en un gita, s√© que hay cosas m√°s serias para este prop√≥sito, y esta soluci√≥n no pretende estar en su lugar. </p><br><h3 id="dlya-kogo">  Para quien </h3><br><p> Por ejemplo, prefiere desarrollar el sitio de inmediato en el alojamiento del cliente y controlar el progreso del desarrollo y los cambios en la base de datos.  O tiene poco dinero (o el sapo estrangula) para gastarlo en buenos productos de control de versiones de bases de datos.  Tambi√©n puede usar el proyecto como una copia de seguridad de datos para ciertas reglas, que pueden ser utilizadas por Crown.  Y, por supuesto, es √∫til si usted es un desarrollador novato y est√° comenzando a aprender los conceptos b√°sicos del desarrollo, y peri√≥dicamente tiene el n√∫mero 500 y no sabe por qu√©.  O est√° desarrollando un producto como un equipo y desea sincronizarlo autom√°ticamente con la producci√≥n al presionar al maestro para evaluar al cliente. </p><br><p>  Considere un ejemplo de desarrollo de sitio est√°ndar en el lado del host (la mayor√≠a de los casos): </p><br><ol><li>  Hay un servidor en el que gira el proyecto y lo m√°s probable es que sea una m√°quina local o un cliente que aloja el proyecto actual. </li><li>  Hay una computadora local para la que trabaja y, seg√∫n la tradici√≥n, almacena archivos e instant√°neas de los estados all√≠. </li><li>  Y Producci√≥n, aqu√≠ es donde se fusiona el producto final, pero tambi√©n puede ser el primer elemento, solo otra carpeta. </li></ol><br><h3 id="kak-s-etim-rabotat">  ¬øC√≥mo trabajar con eso? </h3><br><p>  Para cumplir con el control de versiones de la base de datos usando git, obviamente necesita obtener sus volcados en algunas etapas, d√≥nde almacenarlos en alg√∫n lugar y, al cambiar de sucursal, tenga en cuenta este punto.  Para esto, utilic√© git hooks, que son los archivos de los scripts correspondientes (deben instalarse en la computadora local donde se usa git).  Dependiendo de la configuraci√≥n del archivo de configuraci√≥n, el proceso de trabajo <strong>puede</strong> verse de la siguiente manera: </p><br><p>  Creamos una rama (la copia de seguridad se realiz√≥ autom√°ticamente) y cambiamos, trabajamos, agregamos archivos, creamos una confirmaci√≥n (la copia de seguridad se realiz√≥ autom√°ticamente) ... <br>  cambiado a verificaci√≥n maestra, la base de datos cambi√≥ al estado anterior ... <br>  volvi√≥ al desarrollo, fusion√≥ ramas, comenz√≥.  Es decir  las copias de seguridad se crean autom√°ticamente durante las confirmaciones, <br>  forzado antes de finalizar la compra, el comportamiento se configura en la configuraci√≥n.  Puede llamar manualmente a exportar o importar la base de datos en el servidor, desde su computadora local, ejecutando el script apropiado. </p><br><p>  Para cada script, puede obtener ayuda de la manera cl√°sica usando los argumentos -h o --help. </p><br><p> No recomiendo hacer una copia de seguridad de toda la base de datos, a git no le gustan los archivos grandes, y en la mayor√≠a de los casos esto no es necesario.  Por lo tanto, puede configurarlo f√°cilmente usando <code>config.ini</code> Dado que la configuraci√≥n se usa tanto en el lado del servidor (en el que se levanta mySql) como en el lado del cliente (computadora del desarrollador), el mismo archivo es responsable de la configuraci√≥n.  Y, por supuesto, puede ser la misma computadora si est√° desarrollando localmente. </p><br><h3 id="chto-mozhno-nastraivat-dlya-sozdaniya-dampa">  Qu√© se puede configurar para crear un volcado </h3><br><ul><li>  Configuraci√≥n de conexi√≥n de base de datos y rutas de almacenamiento de volcado </li><li>  Indicaci√≥n de un proveedor que podr√° no solo obtener datos de conexi√≥n de la base de datos, sino <br>  y borre correctamente el cach√© en el servidor al cambiar de sucursal. </li><li>  Exportar toda la base de datos </li><li>  Lista de tablas que se excluir√°n de la exportaci√≥n. </li><li>  O exportar tablas espec√≠ficas </li><li>  Guardar una estructura sin insertar datos en ciertas tablas </li><li>  Especificar campos para tablas cuyos valores no deben exportarse, y deben <br>  ser reemplazado con valores predeterminados. </li><li>  Separe los conjuntos de reglas en una configuraci√≥n, lo que le permitir√° hacer diferentes copias de seguridad por CRON </li></ul><br><p>  Para facilitar el proceso de creaci√≥n de vertederos.  Us√© proveedores de archivos.  Y configurado (hasta ahora el √∫nico) para la revoluci√≥n CMS MODX.  En base a esto, puede escribir el mismo proveedor para cualquier CMS. </p><br><h3 id="kratkie-shagi-k-nachalu-raboty">  Breves pasos para comenzar </h3><br><pre> <code class="plaintext hljs"> ,       .git,   ,     git [git clone ](https://github.com/Setest/.git-db-watcher)          chmod +x install.sh;   ./install.sh   ,     ./install.sh -nh</code> </pre> <br><p>  Ahora necesita hacer cambios en <code>config.ini</code> .  Por ejemplo, as√≠: </p><br><pre> <code class="plaintext hljs">;  [hooks] ; H_CHECK_DB_HASH_BEFORE_CHECKOUT=1 ;      checkout      ;           ;  git checkout -b new_branch_name H_CHECKOUT_FORCE=0 ;        H_CHECKOUT_EVERCOM=1 ;       H_CHECKOUT_CLEARCACHE=1 [common] ;       EXPORT_FILE="db.sql" ;           ;   ./export.sh [develop] ;  db_export.sh   CLI_DB_EXPORT="ssh host '/path/to/project/on/server/.git-db-watcher/db_export.sh'" CLI_DB_IMPORT="ssh host '/path/to/project/on/server/.git-db-watcher/db_import.sh'" ;   [server] PHP_PATH="/usr/local/bin/php" CONFIG_INC_PATH="/path/to/project/on/server/core/config/config.inc.php" PROVIDER=modx DB_TABLES_INCLUDE=site_content DB_TABLES_AUTOPREFIX=1 [server_full_site] PHP_PATH="/usr/local/bin/php" CONFIG_INC_PATH="/path/to/project/on/server/core/config/config.inc.php" ; '' -       DB_CONFIG_     ;  providers PROVIDER=modx ;          DB_CONFIG_HOST= DB_CONFIG_TYPE= DB_CONFIG_USER= DB_CONFIG_PASSWORD= DB_CONFIG_CONNECTION_CHARSET= DB_CONFIG_DBASE= DB_CONFIG_TABLE_PREFIX= DB_CONFIG_DATABASE_DSN= ;        ( ) ;     ; DB_TABLES_INCLUDE=manager_log register_messages user_attributes ; DB_TABLES_INCLUDE=site_content ;    ; DB_TABLES_EXCLUDE=session register_messages mse2_words ec_messages ; ,    ,    DB_TABLES_AUTOPREFIX=1 ;       INSERT DB_TABLES_REMOVE_INSERT="manager_log session register_messages" ; DB_TABLES_REMOVE_INSERT="manager_log" ;        ; DB_TABLES_DEFAULT=user_attributes users DB_TABLES_DEFAULT=user_attributes ;   ,     ;       ,     ;    DB_TABLES_DEFAULT_user_attributes=sessionid logincount lastlogin thislogin ; DB_TABLES_DEFAULT_users=session_stale ;  ,     [only_users] DB_TABLES_INCLUDE=user user_attributes EXPORT_FILE="users.sql" DB_TABLES_DEFAULT=user_attributes user DB_TABLES_DEFAULT_user_attributes=sessionid logincount lastlogin thislogin DB_TABLES_DEFAULT_users=session_stale</code> </pre> <br><p>  Si todo est√° configurado correctamente, puede ejecutar <code>./export.sh</code> y deber√≠a <br>  Aparecer√° un volcado de la base de datos en la computadora local y en el servidor. </p><br><h3 id="ostalnye-voprosy">  Otras preguntas </h3><br><blockquote>  Necesito guardar el resultado en el servidor en otro lugar: </blockquote><br><pre> <code class="plaintext hljs"> ./db_export.sh --output 1&gt;./xxx.sql</code> </pre> <br><blockquote>  Quiero exportar en el servidor usando los datos en mi secci√≥n del archivo de configuraci√≥n: </blockquote><br><pre> <code class="plaintext hljs"> ./db_export.sh -=only_users --output 1&gt;./users.sql</code> </pre> <br><blockquote>  Quiero importar un archivo de base de datos, pero no quiero hacerlo a trav√©s de interceptores GIT. </blockquote><br><pre> <code class="plaintext hljs"> ./import.sh ./import.sh EXPORT_FILE=site_name.sql ./import.sh DB_BACKUP_FILE=/.../../site_name.sql ./import.sh --config=site DB_BACKUP_FILE=./site_name.sql</code> </pre> <br><blockquote>  ¬øC√≥mo importar mientras se est√° en el servidor? </blockquote><br><pre> <code class="plaintext hljs"> ./db_import.sh &lt; db_backup/db.sql</code> </pre> <br><blockquote>  En diferentes proyectos, uso CMS xxx y estoy cansado de ingresar datos cada vez <br>  para la gesti√≥n de bases de datos, ¬øc√≥mo puedo simplificar el proceso? </blockquote><p>  Para hacer esto, debe escribir su archivo de proveedor por analog√≠a con los existentes. </p><br><blockquote>  Cre√© un trabajo y configuraci√≥n CRON usando el proveedor php, pero <br>  no se ejecuta o el cach√© del sitio CMS no se borra, ¬øcu√°l podr√≠a ser el problema? </blockquote><p>  Dependiendo de la configuraci√≥n del servidor y del trabajo en s√≠, los trabajos CRON pueden ejecutarse en un entorno completamente diferente, en el que la ruta al preprocesador php puede diferir y, como resultado, ejecutar una versi√≥n completamente diferente de php que no es compatible con la que est√° ejecutando su CMS. </p><br><h3 id="posleslovie">  Ep√≠logo </h3><br><p>  Nunca escrib√≠ scripts en BASH y, por lo tanto, probablemente <del>  nagovokodil </del>  , Estoy seguro de que hay personas competentes que, si est√°n interesadas, podr√°n agregar sus ediciones.  Desarrollar√© el proyecto como el inter√©s entrante y la identificaci√≥n de errores en el trabajo. </p><br><p>  Y no apestas de inmediato que nada funciona, tal vez no puedas descubrir c√≥mo configurarlo e instalarlo correctamente (especialmente si est√°s trabajando en Windows, aunque BASH es un entorno Linux). </p><br><p>  Las instrucciones de instalaci√≥n y uso est√°n en README.  Trat√© de escribir inmediatamente en ingl√©s, pero tambi√©n debido a mi nivel de aficionado, tal vez no todo est√© claro, en el futuro escribir√© en ruso.  Si desea realizar cambios en la traducci√≥n o el c√≥digo, ¬°bifurque para la salud!  Y si hay buenos consejos, comp√°rtalos. </p><br><p>  PD: si lees hasta el fondo, entonces se volvi√≥ interesante y ansioso por probar :-) </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬°Entonces ve m√°s audaz a esta referencia!</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/449868/">https://habr.com/ru/post/449868/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../449858/index.html">Transmisi√≥n de sonido por modulaci√≥n de amplitud de ultrasonido</a></li>
<li><a href="../449860/index.html">Taquilla en la nube, mi humilde experiencia</a></li>
<li><a href="../449862/index.html">El resumen de materiales interesantes para el desarrollador m√≥vil # 296 (del 22 al 26 de abril)</a></li>
<li><a href="../449864/index.html">ResNet50. Implementaci√≥n propia</a></li>
<li><a href="../449866/index.html">Posibles ataques a HTTPS y c√≥mo defenderse de ellos</a></li>
<li><a href="../449870/index.html">JSONDecoder gen√©rico</a></li>
<li><a href="../449872/index.html">Conceptos b√°sicos de RxVMS: RxCommand y GetIt</a></li>
<li><a href="../449876/index.html">Innovaci√≥n SSI-2001: la historia de una de las tarjetas de sonido m√°s raras para la PC IBM (y su r√©plica)</a></li>
<li><a href="../449878/index.html">Investigaci√≥n de patentes en TI. El curso del joven luchador. Parte I. C√≥mo comprender los requisitos del cliente y preparar una plantilla de informe</a></li>
<li><a href="../449880/index.html">Lite √°gil: especialmente contra el agotamiento</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>