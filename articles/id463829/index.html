<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëâüèΩ üòç ü§© FreePBX Mengkonfigurasi Asterisk untuk pemberitahuan e-mail tentang panggilan masuk yang terlewat dalam antrian ü•ì üëï üì™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="IP ATC Asterisk adalah prosesor telepon IP yang kuat. Dan antarmuka berbasis web FreePBX yang dibuat untuk Asterisk sangat menyederhanakan konfigurasi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>FreePBX Mengkonfigurasi Asterisk untuk pemberitahuan e-mail tentang panggilan masuk yang terlewat dalam antrian</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463829/"><img src="https://habrastorage.org/webt/ke/dl/08/kedl08qszm8sgw39uk2zteenbja.png" alt="gambar"><br>  IP ATC Asterisk adalah prosesor telepon IP yang kuat.  Dan antarmuka berbasis web FreePBX yang dibuat untuk Asterisk sangat menyederhanakan konfigurasi dan menurunkan ambang masuk. <br>  Jika Anda dapat menemukan beberapa jenis tugas yang berkaitan dengan IP telephony, maka hampir pasti itu dapat diimplementasikan dalam Asterisk.  Tetapi pastikan bahwa ketekunan dan ketahanan akan dituntut dari Anda. <br><br>  Kami menghadapi tugas mengatur notifikasi e-mail panggilan tidak terjawab.  Lebih tepatnya, untuk memberi tahu melalui email tentang kasus ketika panggilan masuk telah diantrikan, tetapi tidak ada seorang pun (dari agen) yang menjawab panggilan masuk ini. <br><br>  Anehnya, kami tidak menemukan alat biasa untuk menyelesaikan masalah ini di FreePBX.  Saya akan berbicara tentang bagaimana kami memecahkan masalah ini di bawah potongan. <br><a name="habracut"></a><br>  <b>Kata Pengantar</b> <br><br>  Sebelum menyelesaikan masalah "langsung", kami tentu mencari informasi di Internet, tetapi tidak menemukan solusi turnkey (mungkin mereka terlihat buruk, tetapi apa yang dapat Anda lakukan ...). <br><br>  Tidak ada banyak keterampilan kerja langsung di Asterisk seperti yang kita inginkan, sehingga solusi yang diusulkan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> tidak sepenuhnya dipahami dan dibuang. <br><br>  Saya menyukai solusi yang diusulkan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> , meskipun tidak berhasil.  Oleh karena itu, mereka menekankan bahwa bekerja di Asterisk diperlukan dalam konteks [antrian].  Dan karena kita bekerja di Freepbx, kita perlu bekerja di file konfigurasi ‚Äúextensions_override_freepbx.conf‚Äù.  Kami memperhatikan bahwa akan lebih mudah untuk "menangkap panggilan tidak terjawab" sebelum acara hangupcall (mengakhiri panggilan). <br>  Setelah membaca diskusi di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> , muncul ide bahwa kita perlu memfilter variabel "Disposisi" dalam CDR untuk semua agen dalam antrian.  Dan setelah membaca informasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ini</a> , langkah-langkah yang sangat spesifik dibentuk untuk menyelesaikan tugas. <br><br>  <b>Apa yang kita miliki:</b> <br><br>  Ada FreePBX 13.0.197 yang menggunakan Asterisk 13.12.1.  Versi OS SHMZ rilis 6.6 (Final).  Distribusi didasarkan pada CentOS. <br><br>  Asterisk dikonfigurasikan dengan IVR (menu suara) yang menghamburkan panggilan masuk ke Antrian (antrian) yang berbeda.  Agen (agen) ditugaskan untuk setiap antrian, yaitu agen. <br><br>  <b>Teori</b> <br><br>  <b>Apa yang terjadi di Asterisk</b> <br><br>  Ketika panggilan masuk tiba di Asterisk, panggilan itu masuk ke IVR.  Penelepon membuat pilihan dengan menekan nomor tertentu pada ponsel dan memasukkan antrian tertentu.  Setelah itu, semua agen bebas dari antrian secara bersamaan menerima panggilan. <br><br>  Untuk lebih memahami apa yang terjadi pada saat ini dan apa yang terjadi selanjutnya, kita beralih ke Laporan CDR (Gbr. 1). <br><br><img src="https://habrastorage.org/webt/sv/qg/86/svqg86ls1ot8x4lcl5syw7oq3w0.png" alt="gambar"><br>  <i>Fig. 1</i> <br><br>  Ketika panggilan masuk masuk ke antrian, untuk semua agen nilai dari variabel "Disposisi" menjadi sama dengan "NO JAWABAN" jika agen tidak sibuk pada saat itu.  Variabel "Disposisi" dapat mengambil nilai lain (lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://asterisk-pbx.ru/wiki/asterisk/cf/cdr</a> ), kecuali untuk nilai "JAWABAN".  Dan pada saat ketika salah satu agen menjawab panggilan masuk, nilai variabel "Disposisi" agen ini menjadi sama dengan "JAWABAN". <br>  Dari CDR Laporan, Anda dapat melihat bahwa ketika panggilan diantrekan (di kolom Aplikasi, nilainya menjadi "Antrian"), maka semua acara muncul dengan "uniqueid" yang sama (kolom Sistem). <br><br>  <b>CDR secara singkat</b> <br><br>  Penting untuk memahami apa itu CDR dan pada titik mana dalam CDR data yang kita amati dalam Laporan CDR dimasukkan.  CDR, relatif terhadap sistem operasi, adalah basis data tempat Asterisk mencatat laporan panggilan terperinci (lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://asterisk-pbx.ru/wiki/asterisk/cf/cdr</a> ).  Dalam kasus kami, ini adalah database yang disebut asteriskcdrdb, yang terletak di mysql.  Secara empiris, kami menemukan bahwa data tentang panggilan dengan "uniqueid" tertentu tidak dimasukkan ke dalam asteriskcdrdb segera setelah terjadinya suatu peristiwa, tetapi setelah acara hangupcall (akhir panggilan). <br><br>  <b>Prinsip solusi yang dibuat</b> <br><br>  Karena kita memiliki lebih banyak pengetahuan di bash daripada pengetahuan di Asterisk, ide utamanya adalah sebagai berikut.  Sebelum acara hangupcall, aktifkan skrip bash.  Lewati 3 parameter ke skrip ini.  Parameter pertama adalah "uniqueid", untuk memfilter data yang diterima dari CDR.  Parameter kedua adalah "CALLERID (num)" (nomor pemanggil) untuk mengetahui siapa yang harus dihubungi.  Parameter ketiga adalah "NODEST" (nomor antrian), di mana panggilan diterima, untuk mengetahui tentang masalah apa yang ada panggilan dan kepada siapa untuk mengirim pemberitahuan email dari panggilan tidak terjawab. <br>  Script bash harus terhubung ke database asteriskcdrdb di mysql dan mengambil semua nilai dari variabel "Disposisi" dengan "uniqueid" yang spesifik.  Dari data yang diperoleh, perlu untuk mengecualikan nilai-nilai: "NO JAWABAN", "SIBUK", "GAGAL", "TIDAK DIKETAHUI".  Akibatnya, "JAWABAN" akan tetap ada - mereka menjawab panggilan masuk, atau tidak sama sekali - panggilan tidak terjawab. <br><br>  Selanjutnya, jika panggilan tidak terjawab, skrip harus mengirim pemberitahuan email. <br>  Ke depan, saya perhatikan poin penting.  Asterisk mengeksekusi perintah secara berurutan, menunggu eksekusi (yang umumnya logis).  Dan kita akan memanggil skrip bash sebelum perintah hangupcall dieksekusi.  Dengan demikian, pada saat skrip dieksekusi langsung, informasi tentang keunikan yang kami cari belum dimasukkan ke dalam CDR.  Untuk mengatasi masalah ini, kami akan memanggil skrip bash dengan parameter "&amp;" sehingga Asterisk segera melanjutkan ke langkah berikutnya, yaitu hangupcall.  Dan di dalam skrip bash, di awal, kami akan menetapkan sedikit waktu tunda untuk memberi waktu bagi Asterisk untuk memasukkan data dengan "uniqueid" yang menarik bagi kami di CDR. <br><br>  <b>Berlatih</b> <br><br>  Sebelum melanjutkan untuk mengonfigurasi Asterisk dan membuat skrip bash, Anda perlu mengonfigurasi pengiriman pemberitahuan email.  Untuk ini, kita akan menggunakan utilitas postfix. <br><br>  <b>Pengaturan postfix</b> <br><br>  Kami memiliki domain email "lucky.ru" yang terletak di Yandex.  Kami akan mengonfigurasi postfix dalam mode smtp-client dan akan mengirim surat dari akun asterisk@lucky.ru. <br>  Solusinya diambil dari sini: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://www.dmosk.ru/miniinstruktions.php?mini=postfix-over-yandex</a> . <br><br>  Pertama instal / perbarui / periksa paket: <br><br><pre><code class="bash hljs">yum install postfix yum install mailx yum install cyrus-sasl cyrus-sasl-lib cyrus-sasl-plain</code> </pre> <br>  Kami tidak akan menimpa file konfigurasi postfix utama "/etc/postfix/main.cf", tetapi cadangkan: <br><br><pre> <code class="bash hljs">cp /etc/postfix/main.cf /etc/postfix/main.cf.sav</code> </pre> <br>  Kami mengedit file "/etc/postfix/main.cf" dan membawanya ke formulir berikut: <br><br><pre> <code class="bash hljs">nano /etc/postfix/main.cf <span class="hljs-comment"><span class="hljs-comment">##################### relayhost = smtp_sasl_auth_enable = yes smtp_sasl_password_maps = hash:/etc/postfix/private/sasl_passwd smtp_sasl_security_options = noanonymous smtp_sasl_type = cyrus smtp_sasl_mechanism_filter = login smtp_sender_dependent_authentication = yes sender_dependent_relayhost_maps = hash:/etc/postfix/private/sender_relay smtp_generic_maps = hash:/etc/postfix/generic smtp_tls_CAfile = /etc/postfix/ca.pem smtp_use_tls = yes smtputf8_autodetect_classes = all #####################</span></span></code> </pre> <br>  Tidak setiap baris di "/etc/postfix/main.cf" dapat dikomentari.  Komentar di beberapa baris tidak ditentukan oleh parser dan diteruskan ke pemrosesan, dan ini menyebabkan kesalahan.  Lebih baik menolak komentar di dalam file ini.  Anda dapat bereksperimen dengan ini dengan menjalankan "tail -f / var / log / messages" di jendela berikutnya. <br><br>  Saya akan menandai baris "smtputf8_autodetect_classes = all".  Entri ini mencakup utf-8 secara default, yang memungkinkan Anda untuk menggunakan alfabet Sirilik baik di tubuh surat maupun di baris subjek tanpa manipulasi tambahan (Lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http://www.postfix.org/SMTPUTF8_README.html</a> ). <br><br>  Buat direktori untuk file konfigurasi: <br><br><pre> <code class="bash hljs">mkdir /etc/postfix/private</code> </pre> <br>  Kami mengedit file "/ etc / postfix / private / sender_relay".  Di dalamnya, Anda perlu menentukan server smtp mana yang perlu Anda rujuk saat menggunakan domain email kami: <br><br><pre> <code class="bash hljs">nano /etc/postfix/private/sender_relay <span class="hljs-comment"><span class="hljs-comment">##################### @lucky.ru smtp.yandex.ru #####################</span></span></code> </pre> <br>  Kami mengedit file "/ etc / postfix / private / sasl_passwd".  Di dalamnya kami akan menunjukkan alamat email yang akan kami gunakan untuk mengirim surat, serta nama pengguna dan kata sandi untuk akun ini (kami menentukan nama pengguna dan kata sandi melalui titik dua): <br><br><pre> <code class="bash hljs">nano /etc/postfix/private/sasl_passwd <span class="hljs-comment"><span class="hljs-comment">##################### asterisk@lucky.ru asterisk@lucky.ru:password_asterisk #####################</span></span></code> </pre> <br>  Mengedit file / etc / postfix / generic.  Di dalamnya kita akan menuliskan aturan untuk mengganti alamat keluar (lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://wiki.merionet.ru/ip-telephoniya/30/postfix-nastrojka-otpravki-pochty-v-asterisk/</a> ): <br><br><pre> <code class="bash hljs">nano /etc/postfix/generic <span class="hljs-comment"><span class="hljs-comment">##################### root asterisk@lucky.ru root@localhost asterisk@lucky.ru root@localhost.localdomain asterisk@lucky.ru root@freepbx asterisk@lucky.ru root@freepbx.localdomain asterisk@lucky.ru root@asterisk asterisk@lucky.ru root@asterisk.localdomain asterisk@lucky.ru asterisk asterisk@lucky.ru asterisk@localhost asterisk@lucky.ru asterisk@localhost.localdomain asterisk@lucky.ru asterisk@freepbx asterisk@lucky.ru asterisk@freepbx.localdomain asterisk@lucky.ru asterisk@asterisk asterisk@lucky.ru asterisk@asterisk.localdomain asterisk@lucky.ru root@localdomain.localdomain asterisk@lucky.ru #####################</span></span></code> </pre> <br>  Alamat keluar awal tergantung pada konten "/ etc / hosts" dan "/ etc / hostname", serta pada nama pengguna yang akan mengirim surat.  Artinya, terlepas dari kenyataan bahwa kami menggunakan klien smtp dan mengirim surat dari asterisk@lucky.ru, bagaimanapun, postfix pada awalnya akan mengganti "sesuatu sendiri" ke alamat pengirim dan ini harus diperbaiki dengan aturan dari file konfigurasi ini. <br><br>  Saya akan mencantumkan konten file / etc / hosts saya: <br><br><pre> <code class="bash hljs">cat /etc/hosts <span class="hljs-comment"><span class="hljs-comment">##################### 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 asterisk.localdomain 127.0.0.1 localhost.localdomain localhost ::1 asterisk localhost localhost6 #####################</span></span></code> </pre> <br>  Adalah penting bahwa server memiliki domain apa pun (nilai setelah periode), karena utilitas surat "mencari" nama domain di "/ etc / hosts" dan jika tidak segera "menemukannya", server akan terus melakukan ini selama beberapa menit lagi dan baru kemudian mengirim surat.  Artinya, jika domain tidak terdaftar, maka surat itu akan pergi dengan penundaan selama beberapa menit. <br><br>  Saya akan mencantumkan konten file / etc / hostname saya: <br><br><pre> <code class="bash hljs">cat /etc/hostname <span class="hljs-comment"><span class="hljs-comment">##################### asterisk #####################</span></span></code> </pre> <br>  Selanjutnya, Anda perlu mentransfer file konfigurasi yang dibuat ke database yang diindeks, untuk melakukan ini, jalankan perintah berikut: <br><br><pre> <code class="bash hljs">postmap /etc/postfix/generic &amp;&amp; postmap /etc/postfix/private/{sasl_passwd,sender_relay}</code> </pre> <br>  Selanjutnya, kita perlu mengunduh dan menempatkan sertifikat smtp.yandex.ru di server, untuk melakukan ini, jalankan perintah berikut: <br><br><pre> <code class="bash hljs">openssl s_client -starttls smtp -crlf -connect smtp.yandex.ru:25 &gt; /etc/postfix/ca.pem</code> </pre> <br>  Tetapi setelah informasi teknis muncul di layar, tim akan "terus menggantung."  Tekan Ctrl + C untuk membatalkannya. <br><br>  Sekarang secara manual hapus semua sampah dari file yang dihasilkan dan hanya menyisakan sertifikat.  Anda harus mendapatkan sesuatu seperti ini: <br><br><pre> <code class="bash hljs">nano /etc/postfix/ca.pem <span class="hljs-comment"><span class="hljs-comment">##################### -----BEGIN CERTIFICATE----- MIIGazCCBVOgAwIBAgIQcUU9mJXW4OUs5Gf0JfLtsjANBgkqhkiG9w0BAQsFADBf ... nRG0DfdqYIuPGApFORYe -----END CERTIFICATE----- #####################</span></span></code> </pre> <br>  Terakhir, restart postfix: <br><br><pre> <code class="bash hljs">service postfix restart</code> </pre> <br>  Kami mengirim surat uji: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"  "</span></span> | mail -s <span class="hljs-string"><span class="hljs-string">" "</span></span> admin@lucky.ru</code> </pre> <br>  admin@lucky.ru - alamat tujuan <br><br>  Ini melengkapi konfigurasi posfix. <br><br>  <b>Menulis skrip bash</b> <br><br>  Buat direktori untuk menyimpan skrip bash (di sini seseorang suka di mana): <br><br><pre> <code class="bash hljs">mkdir /home/asterisk/scripts</code> </pre> <br>  Buat file skrip bash: <br><br><pre> <code class="bash hljs">touch /home/asterisk/scripts/noanswer.sh</code> </pre> <br>  Kami memberikan izin file skrip untuk dijalankan: <br><br><pre> <code class="bash hljs">chmod +x /home/asterisk/scripts/noanswer.sh</code> </pre> <br>  Jika ada keraguan tentang hak atas file, maka selama debugging Anda dapat memberikan akses penuh ke file tersebut.  Tapi itu "tidak aman." <br><br><pre> <code class="bash hljs">chmod 777 /home/asterisk/scripts/noanswer.sh</code> </pre> <br>  Teks skrip bash: <br><br><pre> <code class="bash hljs">nano /home/asterisk/scripts/noanswer.sh <span class="hljs-comment"><span class="hljs-comment">##################### #!/bin/bash sleep 7 res_sql="SELECT disposition FROM cdr WHERE uniqueid = '$1'" answer=`mysql -u freepbxuser -pPassword_freepbxuser -D asteriskcdrdb -B -N -e "$res_sql" | grep -E -v "NO ANSWER|BUSY|FAILED|UNKNOWN" | head -n 1` error_kod=0 if [ "$answer" != "ANSWERED" ] then case $3 in 68800) address="big_boss@lucky.ru" subject="  " ;; 63100) address="debian@lucky.ru" subject="  linux debian" ;; 63200) address="windows@lucky.ru" subject="  windows" ;; 63300) address="freebsd@lucky.ru" subject="  freebsd" ;; 63400) address="ubuntu@lucky.ru" subject="  linux ubuntu" ;; 63500) address="centos@lucky.ru" subject="  linux centos" ;; *) address="admin@lucky.ru" error_kod=1 ;; esac case $error_kod in 0) echo "    $2,  $subject." | mail -s "   $2" $address echo "   $address   $2,  $subject. uid=$1" | mail -s "   $2" admin@lucky.ru ;; 1) echo "   $2.  . uid=$1" | mail -s "   $2" admin@lucky.ru ;; esac fi #####################</span></span></code> </pre> <br>  Analisis singkat naskah: <br>  "Tidur 7": <br><br>  Ini adalah penundaan waktu yang sama yang saya tulis sebelumnya.  Kami memiliki penundaan 7 detik.  Meskipun, saya pikir, satu detik sudah cukup. <br><br><pre> <code class="sql hljs">¬´res_sql="<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> disposition <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> cdr <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> uniqueid = <span class="hljs-string"><span class="hljs-string">'$1'</span></span><span class="hljs-string"><span class="hljs-string">"¬ª:</span></span></code> </pre> <br>  Kueri di mysql kami masukkan ke dalam variabel terpisah untuk kenyamanan. <br><br>  Selanjutnya, kami membuat permintaan di mysql dan memfilter hasil yang dihasilkan.  Kami menghapus semua opsi kecuali "JAWABAN", jika ada.  Jika ada beberapa nilai "JAWABAN", maka hanya satu yang harus ditinggalkan.  Pada akhirnya, dalam variabel "jawaban" kita mendapatkan "JAWABAN" atau "". <br>  Jika nilai variabel jawaban tidak sama dengan JAWAB, maka ini adalah panggilan tidak terjawab.  Bergantung pada nomor antrian, menggunakan operator kasing, kami akan menetapkan alamat kepada siapa perlu mengirim pemberitahuan email, dan apa yang harus ditulis dalam pesan ini (bagian variabel dari pesan). <br><br>  Berikut ini adalah opsi ketika antrian diatur dalam Asterisk, tetapi tidak dijelaskan dalam skrip.  Dalam hal ini, admin@lucky.ru akan menerima surat yang menyatakan bahwa antrian tidak diketahui oleh skrip. <br><br>  Jika antrian dijelaskan, maka surat tujuan dan surat duplikat akan dikirim ke admin@lucky.ru yang menunjukkan "uniqueid", sehingga Anda dapat melacak acara pada panggilan ini, jika perlu. <br><br>  Ini mengakhiri skrip. <br><br>  Saya perhatikan bahwa untuk terhubung ke mysql kami menggunakan nama pengguna dan kata sandi yang kami kenali sebelumnya.  Di FreePBX, untuk mengetahui login pengguna Asterisk di mysql, jalankan perintah berikut: <br><br><pre> <code class="bash hljs">cat /etc/amportal.conf | grep AMPDBUSER</code> </pre> <br>  Dan untuk mengetahui kata sandi pengguna Asterisk di mysql, jalankan perintah berikut: <br><br><pre> <code class="bash hljs">cat /etc/amportal.conf | grep AMPDBPASS</code> </pre> <br>  <b>Konfigurasikan Asterisk</b> <br><br>  Kami menggunakan FreePBX.  FreePBX memiliki berbagai jenis file konfigurasi (lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://asterisk-pbx.ru/wiki/freepbx/files</a> ), beberapa dari mereka ditimpa oleh FreePBX saat reboot, dan beberapa tidak ditimpa (mereka disebut custom), karena mereka dirancang khusus) untuk pengguna. <br><br>  Kami akan bekerja dengan file konfigurasi "extensions_override_freepbx.conf", karena ini adalah tipe kustom. <br><br>  Pertama, pastikan bahwa file ‚Äúextensions_override_freepbx.conf‚Äù terhubung dalam file ‚Äú/etc/asterisk/extensions.conf‚Äù.  Untuk melakukan ini, jalankan perintah berikut: <br><br><pre> <code class="bash hljs">cat /etc/asterisk/extensions.conf | grep extensions_override_freepbx.conf <span class="hljs-comment"><span class="hljs-comment">##################### #include extensions_override_freepbx.conf #####################</span></span></code> </pre> <br>  Kami mengedit file "/etc/asterisk/extensions_override_freepbx.conf" dan membawanya ke formulir berikut: <br><br><pre> <code class="bash hljs">nano /etc/asterisk/extensions_override_freepbx.conf <span class="hljs-comment"><span class="hljs-comment">##################### [ext-queues] exten =&gt; h,1,System(/home/asterisk/scripts/noanswer.sh ${CDR(uniqueid)} ${CALLERID(num)} ${NODEST} &amp;) exten =&gt; h,2,Macro(hangupcall,) #####################</span></span></code> </pre> <br>  Seperti yang saya tulis sebelumnya, simbol "&amp;" di akhir diperlukan.  Karena kita akan bekerja dalam skrip bash dengan data CDR langsung dari database mysql, dan data ini dimasukkan dalam mysql hanya setelah mengeksekusi "exten =&gt; h, 2, Makro (hangupcall,)", kita tidak perlu menunggu selesainya skrip bash , dan lanjutkan ke langkah berikutnya di Asterisk.  Dan skrip bash itu sendiri harus mengandung penundaan waktu sebelum menjalankan bagian utamanya. <br><br>  Agar perubahan dalam file konfigurasi ‚Äú/etc/asterisk/extensions_override_freepbx.conf‚Äù untuk mulai berlaku, Anda perlu memulai kembali kernel Asterisk dengan perintah berikut: <br><br><pre> <code class="bash hljs">/usr/sbin/asterisk -rx <span class="hljs-string"><span class="hljs-string">"core restart now"</span></span></code> </pre> <br>  Ini perlu dilakukan setelah skrip bash dibuat. <br><br>  <b>Kesimpulan</b> <br><br>  Ini mungkin cara 1001 untuk "menangkap panggilan tidak terjawab" di Asterisk.  Bagikan komentar bagaimana Anda mengatasi masalah ini.  Dan apa, menurut Anda, dapat ditingkatkan / diperbaiki / dioptimalkan.  Kami akan berterima kasih atas ide-ide konstruktif. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id463829/">https://habr.com/ru/post/id463829/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id463817/index.html">20 manajer produk dan struktur matriks paling multi-dimensi dari semua. Percakapan dengan Skyeng</a></li>
<li><a href="../id463819/index.html">Kunci PostgreSQL: 2. Kunci string</a></li>
<li><a href="../id463821/index.html">AMO, Bitrix, 1C, dan lainnya: bagaimana memilih di mana untuk memulai?</a></li>
<li><a href="../id463823/index.html">Rilis Rust 1.37.0: Optimalisasi Terpandu Profil, konstanta tanpa nama dan vendor kargo</a></li>
<li><a href="../id463825/index.html">Alat Manajemen Proyek Google Sheets</a></li>
<li><a href="../id463831/index.html">Apa yang salah dengan pendidikan IT di Rusia</a></li>
<li><a href="../id463833/index.html">Sebuah survei kecil tentang blocker</a></li>
<li><a href="../id463835/index.html">IoT Berbahaya ini: Ancaman dan Solusi Bisnis</a></li>
<li><a href="../id463839/index.html">Museum DataArt. Kalkulator Lunolet dan Soviet</a></li>
<li><a href="../id463845/index.html">Telegram, siapa itu?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>