<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>#‚É£ üëáüèΩ üå∏ Desenvolvimento de uma aplica√ß√£o m√≥vel sem servidor üë®üèº‚Äçüîß üèåÔ∏è üíø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Muitas vezes, ao desenvolver aplicativos m√≥veis (talvez o mesmo problema com aplicativos da web), os desenvolvedores se v√™em em uma situa√ß√£o em que o ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desenvolvimento de uma aplica√ß√£o m√≥vel sem servidor</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/surfstudio/blog/477506/">  Muitas vezes, ao desenvolver aplicativos m√≥veis (talvez o mesmo problema com aplicativos da web), os desenvolvedores se v√™em em uma situa√ß√£o em que o back-end n√£o funciona ou n√£o fornece os m√©todos necess√°rios. <br><br>  Esta situa√ß√£o pode ocorrer por v√°rios motivos.  No entanto, na maioria das vezes no in√≠cio do desenvolvimento, o back-end simplesmente n√£o √© gravado e o cliente inicia sem ele.  Nesse caso, o in√≠cio do desenvolvimento est√° atrasado em 2-4 meses <br><br>  √Äs vezes, o servidor √© encerrado (falha), √†s vezes n√£o h√° tempo para implementar os m√©todos necess√°rios, √†s vezes h√° problemas de dados etc.  Todos esses problemas nos levaram a escrever um pequeno servi√ßo Mocker que permite substituir o back-end real. <br><br><img src="https://habrastorage.org/webt/xj/8e/it/xj8eitbqje5bpz5trubpbzav_qa.png"><br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Como cheguei a isso</b> <div class="spoiler_text"> Como cheguei a isso?  Meu primeiro ano na empresa estava terminando e eles me colocaram em um novo projeto de com√©rcio eletr√¥nico.  O gerente disse que o projeto precisa ser conclu√≠do em 4 meses, mas a equipe de back-end (do lado do cliente) come√ßar√° o desenvolvimento somente ap√≥s 1,5 meses.  E durante esse tempo, j√° temos que lan√ßar muitos recursos de interface do usu√°rio. <br><br>  Sugeri escrever um backend moch (antes de me tornar um desenvolvedor iOS, eu brincava com o .NET na uni).  A ideia de implementa√ß√£o era simples: de acordo com uma especifica√ß√£o especificada, era necess√°rio escrever m√©todos stub que usassem dados de arquivos JSON pr√©-preparados.  Eles decidiram isso. <br><br>  Ap√≥s duas semanas, sa√≠ de f√©rias e pensei: "Por que n√£o gero tudo isso automaticamente?"  Assim, durante duas semanas de f√©rias, escrevi uma apar√™ncia de um int√©rprete que pega a especifica√ß√£o APIBlueprint e gera o .NET Web App a partir dele (c√≥digo C #). <br><br>  Como resultado, a primeira vers√£o dessa coisa apareceu e n√≥s a vivemos por quase 2,5 meses.  N√£o posso dar n√∫meros reais, o quanto isso nos ajudou, mas lembro como eles disseram retrospectivamente que, se n√£o fosse esse sistema, n√£o haveria libera√ß√£o. <br><br>  Agora, depois de v√°rios anos, considerei os erros cometidos por mim (e havia muitos deles) e reescrevi completamente o instrumento. <br><br>  Aproveitando esta oportunidade - muito obrigado aos colegas que ajudaram com feedback e conselhos.  E tamb√©m aos l√≠deres que suportaram toda a minha "arbitrariedade de engenharia". <br></div></div><br><h3>  1. Introdu√ß√£o </h3><br>  Como regra, qualquer aplicativo cliente-servidor se parece com isso: <br><br><img src="https://habrastorage.org/webt/fs/bh/xa/fsbhxawsxnmbtygz0pxuc7-nbri.png"><br><br>  Cada tela possui pelo menos 1 consulta (e muitas vezes mais).  Indo mais fundo nas telas, precisamos fazer mais e mais solicita√ß√µes.  √Äs vezes, n√£o podemos fazer a transi√ß√£o at√© que o servidor nos diga "Mostrar o bot√£o".  Ou seja, o aplicativo m√≥vel est√° muito ligado ao servidor, n√£o apenas durante o trabalho imediato, mas tamb√©m no est√°gio de desenvolvimento.  Considere o ciclo de desenvolvimento do produto abstrato: <br><br><img src="https://habrastorage.org/webt/xc/o6/pm/xco6pm2ekp91qzev1lgowrriyle.png"><br><br><ol><li>  Primeiro n√≥s projetamos.  N√≥s decompomos, descrevemos e discutimos. </li><li>  Tendo recebido as tarefas e os requisitos, come√ßamos o desenvolvimento.  Escrevemos o c√≥digo, o texto digitado, etc. </li><li>  Depois de implementarmos algo, est√° sendo preparada uma montagem, que entra em teste manual, onde o aplicativo √© verificado para diferentes casos. </li><li>  Se tudo estiver bem conosco, e os testadores testarem a montagem, ela ser√° encaminhada ao cliente que realiza a aceita√ß√£o. </li></ol><br>  Cada um desses processos √© muito importante.  Especialmente o √∫ltimo, como o cliente deve entender em que est√°gio realmente somos e, √†s vezes, ele precisa relatar os resultados √† ger√™ncia ou aos investidores.  Como regra, esses relat√≥rios ocorrem, inclusive no formato de demonstra√ß√£o de um aplicativo m√≥vel.  Na minha pr√°tica, houve um caso em que um cliente demonstrou apenas metade do MVP, que funcionava apenas em mokas.  O aplicativo mok se parece com o presente e grasna como o presente.  Ent√£o √© real (: <br>  No entanto, este √© um sonho rosa.  Vejamos o que realmente acontece se n√£o tivermos um servidor. <br><br><img src="https://habrastorage.org/webt/v6/gp/vp/v6gpvpbngkjv_mk4mnalkbxulpe.png"><br><br><ol><li>  O processo de desenvolvimento ser√° mais lento e mais doloroso, j√° que n√£o podemos escrever servi√ßos normalmente, tamb√©m n√£o podemos verificar todos os casos, temos que escrever stubs que precisar√£o ser removidos posteriormente. </li><li>  Depois que fizemos a montagem ao meio com pesar, chega aos testadores que olham para ela e n√£o entendem o que fazer com ela.  Voc√™ n√£o pode verificar nada, metade n√£o funciona, porque n√£o h√° servidor.  Como resultado, eles perdem muitos bugs: l√≥gicos e visuais. </li><li>  Bem, depois de "como eles poderiam ter parecido", voc√™ precisa entregar a montagem ao cliente e, em seguida, come√ßa o mais desagrad√°vel.  O cliente n√£o pode realmente avaliar o trabalho, ele v√™ de um a dois casos poss√≠veis e certamente n√£o pode mostr√°-lo a seus investidores. </li></ol><br>  Em geral, tudo est√° indo ladeira abaixo.  E, infelizmente, essas situa√ß√µes acontecem quase sempre: √†s vezes n√£o h√° servidor por alguns meses, √†s vezes meio ano, √†s vezes apenas no processo em que o servidor est√° muito atrasado ou √© necess√°rio verificar rapidamente os casos de limite que podem ser reproduzidos usando manipula√ß√µes de dados em um servidor real. <br><br>  Por exemplo, queremos verificar como o aplicativo se comporta se o pagamento do usu√°rio for maior que a data de vencimento.  √â muito dif√≠cil (e longo) reproduzir essa situa√ß√£o no servidor e precisamos fazer isso artificialmente. <br><br>  Portanto, existem os seguintes problemas: <br><br><ol><li>  O servidor est√° completamente ausente.  Por isso, √© imposs√≠vel projetar, testar e apresentar. </li><li>  O servidor n√£o tem tempo, o que interfere no desenvolvimento e pode interferir nos testes. </li><li>  Queremos testar casos de fronteira, e o servidor n√£o pode permitir isso sem gestos longos. </li><li>  Afetar testes e apresenta√ß√µes amea√ßadoras. </li><li>  O servidor trava (uma vez, durante o desenvolvimento est√°vel, perdemos o servidor por 3,5 dias). </li></ol><br>  Para combater esses problemas, o Mocker foi criado. <br><br><h3>  Princ√≠pio de funcionamento </h3><br>  O Mocker √© um pequeno servi√ßo da Web hospedado em algum lugar, escuta o tr√°fego em uma porta espec√≠fica e pode responder com dados pr√©-preparados a solicita√ß√µes de rede espec√≠ficas. <br><br>  A sequ√™ncia √© a seguinte: <br><br>  1. O cliente envia uma solicita√ß√£o. <br>  2. Mocker recebe a solicita√ß√£o. <br>  3. Mocker encontra a simula√ß√£o desejada. <br>  4. Mocker retorna a simula√ß√£o desejada. <br><br>  Se tudo estiver claro nos pontos 1, 2 e 4, ent√£o 3 levanta quest√µes. <br><br>  Para entender como o servi√ßo encontra a simula√ß√£o necess√°ria para o cliente, primeiro consideramos a estrutura da simula√ß√£o. <br><br>  Mock √© um arquivo JSON no seguinte formato: <br><br><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"string"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-string"><span class="hljs-string">"number"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: <span class="hljs-string"><span class="hljs-string">"object"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: <span class="hljs-string"><span class="hljs-string">"object"</span></span> }</code> </pre> <br>  Vamos analisar cada campo separadamente. <br><br><h4>  url </h4><br>  Este par√¢metro √© usado para especificar a URL da solicita√ß√£o que o cliente acessa. <br><br>  Por exemplo, se um aplicativo m√≥vel fizer uma solicita√ß√£o para url <code>host.dom/path/to/endpoint</code> , no campo <code>url</code> , precisamos escrever <code>/path/to/endpoint</code> . <br>  Ou seja, esse campo armazena o <b>caminho relativo para o terminal</b> . <br><br>  Este campo deve ser formatado no formato de modelo de URL, ou seja, os seguintes formatos s√£o permitidos: <br><br><ol><li>  <code>/path/to/endpoint</code> - endere√ßo de URL normal.  Quando a solicita√ß√£o √© recebida, o servi√ßo compara as linhas caractere por caractere. </li><li>  <code>/path/to/endpoint/{number}</code> - URL com padr√£o de caminho.  Um mock com esse URL responder√° a qualquer solicita√ß√£o que corresponda a esse padr√£o. </li><li>  <code>/path/to/endpoint/data?param={value}</code> - URL com padr√£o de par√¢metro.  A simula√ß√£o com esse URL acionar√° uma solicita√ß√£o contendo os par√¢metros fornecidos.  Al√©m disso, se um dos par√¢metros n√£o estiver na solicita√ß√£o, ele n√£o corresponder√° ao modelo. </li></ol><br>  Assim, controlando os par√¢metros da URL, voc√™ pode determinar claramente que um determinado falso retornar√° a um URL espec√≠fico. <br><br><h4>  m√©todo </h4><br>  Este √© o m√©todo http esperado.  Por exemplo, <code>POST</code> ou <code>GET</code> . <br>  A sequ√™ncia deve conter apenas letras mai√∫sculas. <br><br><h4>  statusCode </h4><br>  Este √© o c√≥digo de status http para a resposta.  Ou seja, ao solicitar esta simula√ß√£o, o cliente receber√° uma resposta com o status registrado no campo statusCode. <br><br><h4>  resposta </h4><br>  Este campo cont√©m o objeto JSON que ser√° enviado ao cliente no corpo da resposta √† sua solicita√ß√£o. <br><br><h4>  pedido </h4><br>  Este √© o corpo da solicita√ß√£o que se espera que seja recebido do cliente, que ser√° usado para fornecer a resposta desejada, dependendo do corpo da solicita√ß√£o.  Por exemplo, se quisermos alterar as respostas, dependendo dos par√¢metros de solicita√ß√£o. <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"/auth"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"cbshbg52rebfzdghj123dsfsfasd"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"login"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tester"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"Valid"</span></span> } }</code> </pre><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"/auth"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bad credentials"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"login"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tester"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"Invalid"</span></span> } }</code> </pre><br>  Se o cliente enviar uma solicita√ß√£o com o corpo: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"login"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tester"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"Valid"</span></span> }</code> </pre><br>  Ent√£o, em resposta, ele receber√°: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"cbshbg52rebfzdghj123dsfsfasd"</span></span> }</code> </pre><br>  E caso desejemos verificar como o aplicativo funcionar√° se a senha for digitada incorretamente, uma solicita√ß√£o ser√° enviada com o corpo: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"login"</span></span>: <span class="hljs-string"><span class="hljs-string">"Tester"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"Invalid"</span></span> }</code> </pre><br>  Ent√£o, em resposta, ele receber√°: <br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bad credentials"</span></span> }</code> </pre><br>  E podemos verificar o caso com a senha errada.  E assim para todos os outros casos. <br><br>  E agora vamos descobrir como o agrupamento e a pesquisa do moq desejado funcionam. <br><br><img src="https://habrastorage.org/webt/3g/r4/yj/3gr4yj1z0c4pamlfipuvnoculhg.png"><br><br>  Para procurar r√°pida e facilmente o mok desejado, o servidor carrega todos os mokas na mem√≥ria e os agrupa da maneira correta.  A figura acima mostra um exemplo de agrupamento. <br><br>  O servidor combina diferentes mokas por <b>URL</b> e <b>m√©todo</b> .  Isso √© necess√°rio, entre outras coisas, para que possamos criar muitos moks diferentes em um URL. <br><br>  Por exemplo, queremos que, puxando constantemente a op√ß√£o Puxar para atualizar, surjam respostas diferentes e o estado da tela mude o tempo todo (para verificar todos os casos de limite). <br><br>  Em seguida, podemos criar muitos moks diferentes com o mesmo <b>m√©todo</b> e par√¢metros de <b>URL</b> , e o servidor os devolver√° iterativamente (por sua vez). <br>  Por exemplo, vamos ter tais mokas: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"product"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"currency"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span> } }</code> </pre><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"gdshfjshhkfhsdgfhshdjgfhjkshdjkfsfgbjsfgskdf"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"currency"</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">100000000000</span></span> } }</code> </pre><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusCode"</span></span>: <span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre><br>  Ent√£o, quando chamarmos o m√©todo GET / products pela primeira vez, obteremos a resposta: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"product"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"currency"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span> }</code> </pre><br>  Quando chamamos pela segunda vez, o ponteiro do iterador mudar√° para o pr√≥ximo elemento e retornar√° para n√≥s: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"gdshfjshhkfhsdgfhshdjgfhjkshdjkfsfgbjsfgskdf"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"currency"</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">100000000000</span></span> }</code> </pre><br>  E podemos verificar como o aplicativo se comporta se obtivermos alguns grandes valores.  E assim por diante <br><br>  Bem, e quando chegarmos ao √∫ltimo elemento e chamarmos o m√©todo novamente, o primeiro elemento retornar√° para n√≥s novamente, porque o iterador retornar√° ao primeiro elemento. <br><br><h3>  Proxy de armazenamento em cache </h3><br>  O Mocker pode funcionar no modo de proxy em cache.  Isso significa que, quando um servi√ßo recebe uma solicita√ß√£o de um cliente, ele pega o endere√ßo do host no qual o servidor real est√° localizado e o esquema (para determinar o protocolo).  Em seguida, ele pega a solicita√ß√£o recebida (com todos os cabe√ßalhos; portanto, se o m√©todo exigir autentica√ß√£o, tudo bem, sua <code>Authorization: Bearer ...</code> transferida) e corta as informa√ß√µes de servi√ßo (a mesma <code>host</code> e <code>scheme</code> ) e envia a solicita√ß√£o ao servidor real. <br><br>  Ap√≥s receber a resposta com o 200¬∫ c√≥digo, o Mocker salva a resposta no arquivo Mock (sim, voc√™ pode copi√°-lo ou alter√°-lo) e retorna ao cliente o que recebeu do servidor real.  Al√©m disso, ele n√£o salva apenas o arquivo em um local aleat√≥rio, mas organiza os arquivos para que voc√™ possa trabalhar com eles manualmente.Por exemplo, o Mocker envia uma solicita√ß√£o para o seguinte URL: <code>hostname.dom/main/products/loans/info</code> .  Em seguida, ele criar√° uma pasta <code>hostname.dom</code> , em seguida, dentro dela, criar√° uma pasta <code>main</code> , dentro dela, uma pasta de <code>products</code> ... <br><br>  Para evitar zombarias duplicadas, o nome √© formado com base no <b>m√©todo http</b> (GET, PUT ...) e um <b>hash do corpo de resposta do servidor real</b> .  Nesse caso, se j√° houver uma simula√ß√£o em uma resposta espec√≠fica, ela ser√° simplesmente substitu√≠da. <br><br>  Esse recurso pode ser ativado individualmente para cada solicita√ß√£o.  Para fazer isso, adicione tr√™s cabe√ßalhos √† solicita√ß√£o: <br><br><pre> <code class="plaintext hljs">X-Mocker-Redirect-Is-On: "true", X-Mocker-Redirect-Host: "hostaname.ex:1234", X-Mocker-Redirect-Scheme: "http"</code> </pre><br><h3>  Indica√ß√£o expl√≠cita do caminho para as zombarias </h3><br>  √Äs vezes, voc√™ deseja que o Mocker retorne apenas os mokas que queremos, e n√£o todos que est√£o no projeto. <br><br>  Especialmente relevante para testadores.  Seria conveniente que eles tivessem algum tipo de conjunto de mokas preparado para cada um dos casos de teste.  E, durante o teste, o controle de qualidade apenas seleciona a pasta de que precisa e trabalha silenciosamente, porque n√£o h√° mais ru√≠do nas zombarias de terceiros. <br><br>  Agora isso √© poss√≠vel.  Para habilitar esta fun√ß√£o, voc√™ precisa usar um cabe√ßalho especial: <br><br><pre> <code class="plaintext hljs">X-Mocker-Specific-Path: path</code> </pre><br>  Por exemplo, deixe o Mocker ter uma estrutura de pastas na raiz <br><br><pre> <code class="plaintext hljs">root/ block_card_test_case/ mocks.... main_test_case/ blocked_test_case/ mocks...</code> </pre><br>  Se voc√™ precisar executar um caso de teste sobre cart√µes bloqueados, <br> <b><code>X-Mocker-Specific-Path: block_card_test_case</code></b> <br>  Se voc√™ precisar executar um caso de teste associado ao bloqueio da tela principal, <br> <b><code>X-Mocker-Specific-Path: main_test_case/blocked_test_case</code></b> <br> <br><h3>  Interface </h3><br>  Inicialmente, trabalhamos com mokas diretamente via ssh, mas com um aumento no n√∫mero de mokas e usu√°rios, passamos para uma op√ß√£o mais conveniente.  Agora estamos usando o CloudCommander. <br>  No exemplo do docker-compose, ele se liga ao cont√™iner do Mocker. <br><br>  Parece algo como isto: <br><br><img src="https://habrastorage.org/webt/g8/ix/y2/g8ixy2mxaomzvo7zwknzhjf33jw.png"><br><br>  Bem, o b√¥nus √© um editor da web, que permite adicionar / alterar o moki diretamente do navegador. <br><br><img src="https://habrastorage.org/webt/2o/_d/ut/2o_dutkmga1j_dkuwor2isr4jxq.png"><br><br>  Essa tamb√©m √© uma solu√ß√£o tempor√°ria.  Nos planos de deixar de trabalhar com moks atrav√©s do sistema de arquivos para algum banco de dados.  E, consequentemente, ser√° poss√≠vel controlar os pr√≥prios mokas da GUI para esse banco de dados. <br><br><h3>  Implanta√ß√£o </h3><br>  A maneira mais f√°cil de implantar o Mocker √© usar o Docker.  Al√©m disso, a implanta√ß√£o do servi√ßo a partir do docker implementar√° automaticamente uma interface baseada na Web, atrav√©s da qual √© mais conveniente trabalhar com mokas.  Os arquivos necess√°rios para implanta√ß√£o atrav√©s do Docker est√£o no reposit√≥rio. <br><br>  No entanto, se essa op√ß√£o n√£o for adequada para voc√™, voc√™ poder√° montar o servi√ßo independentemente da origem.  O suficiente para isso: <br><br><pre> <code class="plaintext hljs">git clone https://github.com/LastSprint/mocker.git cd mocker go build .</code> </pre><br>  Ent√£o voc√™ precisa escrever um arquivo de configura√ß√£o ( <a href="">exemplo</a> ) e iniciar o servi√ßo: <br><br><pre> <code class="plaintext hljs">mocker config.json</code> </pre><br><h3>  Problemas conhecidos </h3><br><ul><li>  Ap√≥s cada novo arquivo, voc√™ precisa <code>curl mockerhost.dom/update_models</code> para que o servi√ßo leia os arquivos novamente.  N√£o encontrei uma maneira r√°pida e elegante de atualiz√°-lo. </li><li>  √Äs vezes, o CloudCommander falha (ou fiz algo errado) e n√£o permite editar moki que foram criados atrav√©s da interface da web.  √â tratado limpando o cache do navegador. </li><li>  O servi√ßo funciona apenas com <code>application/json</code> .  Os planos oferecem suporte <code>form-url-encoding</code> . </li></ul><br><h3>  Sum√°rio </h3><br>  O Mocker √© um servi√ßo da Web que resolve os problemas de desenvolvimento de aplicativos cliente-servidor quando o servidor n√£o est√° pronto por algum motivo. <br><br>  O servi√ßo permite criar muitas simula√ß√µes diferentes em uma √∫nica URL, permite conectar Solicita√ß√£o e Resposta entre si, especificando explicitamente par√¢metros no URL ou diretamente, configurando o corpo da solicita√ß√£o esperado.  O servi√ßo possui uma interface baseada na Web que simplifica bastante a vida dos usu√°rios. <br><br>  Cada usu√°rio do servi√ßo pode adicionar independentemente o terminal necess√°rio e a solicita√ß√£o de que ele precisa.  Nesse caso, no cliente, para alternar para um servidor real, basta substituir a constante pelo endere√ßo do host. <br><br>  Espero que este artigo ajude as pessoas que sofrem de problemas semelhantes e, talvez, trabalhemos juntos para desenvolver essa ferramenta. <br><br>  <a href="https://github.com/LastSprint/mocker">Reposit√≥rio do GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt477506/">https://habr.com/ru/post/pt477506/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt477496/index.html">M√°scara de vidro rachado - √© um PR planejado?</a></li>
<li><a href="../pt477498/index.html">Coletamos logs do Nginx usando o nginx-clickhouse, enviamos ao Clickhouse e exibimos no Grafana</a></li>
<li><a href="../pt477500/index.html">Modelo de Aplicativo (Avalanche - framework de aplicativos para Java)</a></li>
<li><a href="../pt477502/index.html">Trabalho remoto de um empregador saud√°vel</a></li>
<li><a href="../pt477504/index.html">Melhores pr√°ticas de desenvolvimento de aplicativos a seguir em 2020</a></li>
<li><a href="../pt477508/index.html">Detectores de radar: mais algumas palavras sobre √©tica e muitas sobre leis</a></li>
<li><a href="../pt477510/index.html">Backup e recupera√ß√£o autom√°ticos de listas de endere√ßos din√¢micas no Mikrotik</a></li>
<li><a href="../pt477512/index.html">Batalha de L2TP, RRAS vs SoftEther</a></li>
<li><a href="../pt477514/index.html">Automatiza√ß√£o de teste de hardware de sistemas embarcados</a></li>
<li><a href="../pt477518/index.html">Microarquitetura √≥ssea como base para materiais ultraleves e dur√°veis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>