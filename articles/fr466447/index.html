<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçüç≥ ü§¶üèº üíë Pourquoi devrions-nous construire un CDN? ‚åõÔ∏è üõ∏ üë©‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut Habr! Dans cet article, nous allons cr√©er notre propre CDN. Pourquoi ne pas utiliser des solutions toutes faites? Parce que le site de l'auteur ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pourquoi devrions-nous construire un CDN?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/466447/"> Salut Habr!  Dans cet article, nous allons cr√©er notre propre CDN.  Pourquoi ne pas utiliser des solutions toutes faites?  Parce que le site de l'auteur est compl√®tement statique, r√©alis√© sur Jekyll, avec de grandes images qui doivent √™tre donn√©es le plus rapidement possible.  Le serveur ne doit pas √™tre en cache, il doit stocker l'int√©gralit√© du site, prendre en charge HTTP / 2 et Brotli, et le m√™me certificat doit √™tre install√© sur tous les serveurs. <br><br>  Nous ferons √©galement tout cela sur IIS ex√©cut√© sur Windows Server 2019 Core. <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/jd/-8/bh/jd-8bhr2bkenojiyts1op3nxdr0.jpeg"></a> </div><a name="habracut"></a><br><h2>  <font color="#3AC1EF">En bref sur la mise en ≈ìuvre</font> </h2><br>  Aux n≈ìuds finaux, nous g√©rerons les moyens int√©gr√©s au syst√®me d'exploitation, nous aurons besoin: <br><br><ol><li>  Active Directory </li><li>  Dfs </li><li>  IIS </li><li>  Winacme </li><li>  RSAT </li></ol><br>  Facultatif, mais recommand√©: <br><br><ol><li>  Centre d'administration Windows </li></ol><br>  Sur les sites avec sites, seuls IIS et DFS sont n√©cessaires, Active Directory est requis, il est requis pour DFS, qui synchronisera le contenu du site entre les serveurs.  RSAT est n√©cessaire pour g√©rer les composants et Windows Admin Center est n√©cessaire pour modifier le registre.  Cela peut √©galement √™tre fait via Powershell, dont je discuterai √©galement. <br><br>  Le domaine de l'auteur s'appelle ***. ***. Wtf (veuillez ne pas avoir peur), et les serveurs sont nomm√©s d'apr√®s les centres de donn√©es et ont les noms de la forme cache-zur1, cahe-ru et ainsi de suite.  AD est d√©ploy√© et les serveurs y sont connect√©s.  Maintenant en ordre. <br><br><h2>  <font color="#3AC1EF">S√©lection de points</font> </h2><br>  RUVDS poss√®de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">8 centres de donn√©es</a> - 3 en Europe et 5 en Russie.  Mon choix s'est port√© sur Rucloud √† Moscou et LD8 (celui de Londres).  Rucloud parce qu'il n'est presque pas diff√©rent du M9, et √† travers Londres il y a un c√¢ble transcontinental vers les USA, donc en Europe c'est un must have.  Pour une distribution plus √©troite en Europe, vous pouvez choisir la Suisse ou l'Allemagne - cela, en g√©n√©ral, vous pouvez vous arr√™ter. <br><br><h2>  <font color="#3AC1EF">Choisir un DNS GeoIP</font> </h2><br>  Si le client frappe sur le site, alors comment comprendre quel serveur doit lui transmettre les donn√©es?  Utiliser le DNS bien s√ªr.  Autrement dit, en fonction de l'adresse IP de celui qui a adress√© le DNS, une r√©ponse pertinente sera donn√©e. <br><br>  Nous pouvons utiliser notre propre DNS (BIND avec un plugin pour Maxmind) ou une solution cl√© en main (Route53).  Un abonnement aux bases de donn√©es Maxmind GeoIP co√ªte 25 $ par mois et Route53 co√ªte 0,50 $ par zone de domaine, plus un sou si vous optez pour un million de demandes.  De plus, cr√©er un autre point de renforcement des attaques DDoS est la derni√®re chose, donc mon choix s'est port√© sur Route53. <br><br>  Cet article concerne le CDN pour l'Europe;  si vous avez besoin d'un CDN pour la Russie, le choix vers votre propre DNS est √©vident, car Route53 fournit un routage par pays, pas par ville. <br>  Microsoft propose des services similaires (Azure Traffic Manager). <br><br><h2>  <font color="#3AC1EF">1. Installez IIS</font> </h2><br>  <b>1.1.</b>  <b>Installation d'IIS</b> <br><br>  Nous installons les composants de base d'IIS, le composant de prise en charge des certificats centralis√©s, et sur le serveur principal une prise en charge suppl√©mentaire pour la gestion √† distance.  Ce composant n'est n√©cessaire que pour un serveur - vous ne pourrez pas g√©rer d'autres serveurs lors de l'activation des configurations partag√©es, m√™me si la gestion √† distance a √©t√© configur√©e. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f09/d98/c66/f09d98c6665d1e5106436c0fd9fc258d.png"><br><br>  Via Powershell: <br><br><pre><code class="plaintext hljs">Install-WindowsFeature Web-Server, Web-CertProvider</code> </pre> <br>  Sur le serveur principal, vous devez en outre installer: <br><br><pre> <code class="plaintext hljs">Install-WindowsFeature Web-Mgmt-Service</code> </pre> <br>  <b>1.1.1 Allumer la t√©l√©commande</b> <br><br>  Pour pouvoir g√©rer √† distance le serveur IIS, nous devons augmenter le service de gestion √† distance IIS.  Sur le serveur principal, d√©marrez le service: <br><br><pre> <code class="plaintext hljs">start-service WMSVC set-service -Name WMSVC -StartupType Automatic</code> </pre> <br>  Et maintenant, nous incluons la possibilit√© de g√©rer en tant que telle via le registre. <br><br><pre> <code class="plaintext hljs">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WebManagement\Server</code> </pre> <br>  La fa√ßon la plus simple de g√©rer le registre est bien s√ªr d'utiliser le Centre d'administration Windows. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8fd/9cb/7b1/8fd9cb7b19b7523283885d61564eb920.png"><br><br>  Mais cela peut √©galement √™tre fait via Powershell: <br><br><pre> <code class="plaintext hljs">Set-Itemproperty -path "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\WebManagement\Server" -Name "EnableRemoteManagement" -value "1"</code> </pre> <br>  Dans Windows Server 2012 et 2016, la r√®gle de pare-feu ne se l√®ve pas d'elle-m√™me; vous devez modifier le pare-feu. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c7/13e/d35/8c713ed356d5418549cdc602c62e3161.png"><br><br><pre> <code class="plaintext hljs">Set-NetFirewallRule -Name IIS-WebServerRole-WMSVC-In-TCP -Enabled True</code> </pre> <br>  V√©rifiez s'il a augment√©: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/929/121/aa3/929121aa33cdffa49494d791b583da7f.png"><br><br><pre> <code class="plaintext hljs">Test-NetConnection 8.8.8.8 -port 8172</code> </pre> <br>  Trois modifications √† trois endroits diff√©rents et maintenant nous pouvons nous connecter via le gestionnaire IIS √† notre serveur en utilisant un autre serveur avec un bureau.  C'√©tait uniquement pour la commodit√© de la gestion ult√©rieure. <br><br>  <b>1.2 Nous avons r√©duit la centralisation des configurations</b> <br><br>  Il n'y a pas de boutons pour installer des configurations et des certificats centralis√©s dans IIS Manager, ils ne se trouvent que dans le gestionnaire de serveur local, donc pour Server Core, vous devrez tout faire via Powershell. <br><br>  La centralisation des configurations et des certificats s'effectue via SMB.  Par cons√©quent, j'ai cr√©√© deux utilisateurs priv√©s de droits (s√©par√©ment pour les configurations et s√©par√©ment pour les certificats) qui n'ont acc√®s en lecture qu'√† leur dossier et les ai nomm√©s certadmin et configadmin. <br><br>  Il est conseill√© aux utilisateurs d'√™tre locaux sur le serveur principal - si votre contr√¥leur de domaine meurt, les applications qui s'accrochent √† la configuration et aux certificats via SMB au nom de l'utilisateur du domaine mourront.  L'utilisation d'utilisateurs locaux √©limine cette situation. <br><br>  <b>1.2.1 Cr√©er un dossier partag√©</b> <br><br>  Deux dossiers publics doivent √™tre stock√©s sur l'un des serveurs, d'o√π nous obtenons la configuration et les certificats.  Comme chemin d'acc√®s au dossier partag√©, nous prenons le chemin par d√©faut pour les configurations IIS: <br><br><pre> <code class="plaintext hljs">New-SmbShare -ReadAccess configadmin@**.**wtf -Path C:\windows\System32\Inetsrv\Config -Name sharedconfigs</code> </pre> <br>  Et pour les certificats, nous pouvons en choisir.  Je les mets dans un dossier avec IIS. <br><br><pre> <code class="plaintext hljs">New-SmbShare -Path C:\inetpub\centralizedcerts -Name sharedconfigs -ReadAccess configadmin</code> </pre> <br>  <b>1.2.2 Nous connectons les n≈ìuds aux configurations</b> <br><br>  Les param√®tres doivent √™tre d√©finis uniquement pour les serveurs qui liront cette configuration.  Mon serveur principal sous le nom cache-ru sera la t√™te, j'ai donc configur√© les deux autres. <br>  Entrez le mot de passe de l'utilisateur qui a acc√®s au dossier: <br><br><pre> <code class="plaintext hljs">$pass = Read-Host -AsSecureString Enable-IISSharedConfig -PhysicalPath \\cache-ru.**.**wtf\SharedConfig -UserName configadmin@**.**wtf -Password $pass -DontCopyRemoteKeys</code> </pre> <br>  Imm√©diatement apr√®s l'ouverture d'une nouvelle session devrait s'ouvrir.  Pour v√©rifier que tout a fonctionn√©, vous pouvez ouvrir RSAT ‚Üí Gestion de l'ordinateur ‚Üí Dossiers partag√©s ‚Üí Sessions.  Nous verrons les sessions utilisateur et l'adresse IP du serveur, qui sous cet utilisateur lit le dossier partag√©.  C√¥t√© client, il est v√©rifi√© par l'applet de commande: <br><br><pre> <code class="plaintext hljs">Get-IISSharedConfig</code> </pre> <br>  Voici √† quoi cela ressemblait pour moi: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/459/bc9/857/459bc9857540abe84a63229992b7d3dd.png"><br><br>  <b>1.2.2 Connecter les n≈ìuds aux certificats</b> <br><br>  La ligne suivante ne peut √™tre saisie que directement, ayant une connexion directe au bureau ex√©cutant le serveur avec une interface graphique, elle ne fonctionne pas sur Server Core. <br><br><pre> <code class="plaintext hljs">$pass = Read-Host -AsSecureString Enable-IISCentralCertProvider -CertStoreLocation \\cache-ru.**.**wtf\centralizedcerts -UserName certadmin@**.**wtf -Password $pass</code> </pre> <br>  Si vous essayez de le saisir via Winrm, vous verrez la sortie suivante: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/85f/e1b/c76/85fe1bc7691f4a7c4765560e4d62a2f8.png"><br><br>  Pour ce faire √† distance, vous devez modifier le registre.  Comme c'est pratique!  Nous volons dans: <br><br><pre> <code class="plaintext hljs">HKLM:\SOFTWARE\Microsoft\IIS\CentralCertProvider\</code> </pre> <br>  Cr√©ez un DWORD 32 bits ¬´activ√©¬ª avec le param√®tre ¬´1¬ª: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/06c/ba1/e1e/06cba1e1e6dd5af05cc7f9d0279e138f.png"><br><br><pre> <code class="plaintext hljs">Set-ItemProperty -Path HKLM:\SOFTWARE\Microsoft\IIS\CentralCertProvider\ -Name Enabled -Value 1</code> </pre> <br>  Ensuite, nous cr√©ons la valeur de cha√Æne CertStoreLocation avec le param√®tre \\ cache-ru. **. ** wtf \ centralizedcerts: <br><br><pre> <code class="plaintext hljs">Set-ItemProperty -Path HKLM:\SOFTWARE\Microsoft\IIS\CentralCertProvider\ -Name CertStoreLocation -Value &lt;a href="about:blank"&gt;\\cache-ru.**.**wtf\centralizedcerts&lt;/a&gt;</code> </pre> <br>  Pour v√©rifier si tout est en ordre, nous utilisons: <br><br><pre> <code class="plaintext hljs">Get-IISCentralCertProvider</code> </pre> <br>  La sortie devrait √™tre comme ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c8b/dd6/48d/c8bdd648d8d5f147c8bd28d1bad9cfc0.png"><br><br>  Et seulement apr√®s cela, nous entrons: <br><br><pre> <code class="plaintext hljs">$pass = Read-Host -AsSecureString Set-IISCentralCertProvider -UserName certadmin@**.**wtf -Password $pass</code> </pre> <br>  V√©rifiez √† nouveau: <br><br><pre> <code class="plaintext hljs">Get-IISCentralCertProvider</code> </pre> <br>  Tout ce qui est sorti de la bo√Æte est appel√©.  Contrairement aux configurations courantes, les certificats centralis√©s ne cr√©ent pas de session SMB active. <br><br>  <b>1.2.3 Brotli</b> <br><br>  Sur chaque serveur, t√©l√©chargez et ex√©cutez le fichier de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">compression IIS</a> <br><br><pre> <code class="plaintext hljs">Start-Process .\iiscompression_amd64.msi -ArgumentList /quiet</code> </pre> <br>  Nous avons d√©j√† partag√© les configurations, vous devez donc configurer quelque chose en un seul endroit.  En utilisant IIS Manager, nous allons dans l'√©diteur de configuration sur le serveur principal. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/489/874/4db/4898744dbe1eea52b6bfe3c92ea5a1ad.png"><br><br><pre> <code class="plaintext hljs">system.webServer/httpCompression</code> </pre> <br>  Et d√©finissez StaticCompressionLevel sur 11 pour Brotli et 9 pour Gzip, c'est le maximum qu'ils peuvent faire. <br><br>  <b>1.2.4 MIME et en-t√™tes</b> <br><br>  Hors de la bo√Æte, IIS ne transmet pas l'en-t√™te de codage, c'est pourquoi l'alphabet cyrillique se transforme en runes.  De plus, dans MIME, aucune entr√©e au format Webp ne doit √™tre ajout√©e. <br><br>  <b>1.</b> Acc√©dez au r√©partiteur ‚Üí MIME.  Recherchez .HTML et modifiez son type en: text / html;  charset = utf-8 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e4c/bef/017/e4cbef017ae044d8720535ff9bdea63a.png"><br><br>  <b>2.</b> N'oubliez pas Webp - vous devez ajouter ce MIME manuellement. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/07a/b62/aec/07ab62aecf03ee9b4a32ecd4044d7a42.png"><br><br><h2>  <font color="#3AC1EF">2. Nous d√©livrons un certificat</font> </h2><br>  Utilisation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Winacme</a> .  Tout d'abord, vous devez lier les domaines au site - cela peut √™tre fait via le gestionnaire IIS.  Lors de la cr√©ation d'un CDN, ne s√©lectionnez pas la v√©rification de l'h√¥te, car  les probl√®mes commencent imm√©diatement avec la confirmation de la propri√©t√© du domaine, notre choix est la v√©rification par enregistrement TXT.  Vous devrez conduire manuellement le chemin d'acc√®s au dossier contenant les certificats, ainsi que copier manuellement l'enregistrement du d√©fi.  Maintenant, mettez de l'air dans votre poitrine. <br><br>  Afin de ne pas tout imprimer manuellement, activez RDP sur Server Core avec la commande suivante: <br><br><pre> <code class="plaintext hljs">cscript C:\Windows\System32\Scregedit.wsf /ar 0</code> </pre> <br>  Voici √† quoi ressemble RDP sur Server Core: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/856/2ea/478/8562ea478872a08964c125a8b997eae6.png"><br><br>  Apr√®s le d√©fi, les certificats tombent dans le dossier sp√©cifi√© dans Winacme.  Winacme place la t√¢che dans le planificateur pour renouveler le certificat.  Install√© et oubli√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f20/8e3/d33/f208e3d33f61e407a19e1ff53e14ecde.png"><br><br>  Eh bien, comme nous avons termin√©, nous pouvons d√©sactiver RDP - nous avons install√© Server Core pour une bonne raison, nous avons d√©couvert tant de nuances. <br><br><pre> <code class="plaintext hljs">cscript C:\Windows\System32\Scregedit.wsf /ar 1</code> </pre> <br><h2>  <font color="#3AC1EF">3. Certificat Bindim aux n≈ìuds</font> </h2><br>  Vous devez maintenant configurer deux autres n≈ìuds pour que HTTPS fonctionne enfin.  √Ä l'heure actuelle, sur le serveur sur lequel les certificats sont stock√©s, HTTPS est d√©j√† en cours d'ex√©cution.  Pour que les autres commencent √† travailler sur HTTPS, eh bien, en g√©n√©ral, cela se fait via netsh. <br><br>  Comme d'habitude, nous nous connectons √† Windows Server Core via RDP pour ex√©cuter ce composant logiciel enfichable.  Ne regardez pas le site de Microsoft, en particulier dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce</a> guide.  Les √©tapes qu'il contient ne sont pas d√©crites correctement. <br><br>  En utilisant netsh http show sslcert, sur le n≈ìud ma√Ætre, vous devez obtenir l'appid, que nous entrons comme d√©crit ci-dessous: <br><br><pre> <code class="plaintext hljs">netsh http add sslcert ccs=443 appid= '{4dc3e181-e14b-4a21-b022-59fc669b0914}'</code> </pre> <br>  La valeur appid doit √™tre entre guillemets, sinon cela ne fonctionnera pas. <br><br><h2>  <font color="#3AC1EF">4. Installez DFS</font> </h2><br>  Ne synchronisez pas les certificats et les configurations via DFS, des outils sp√©cialis√©s ont √©t√© invent√©s pour une raison.  J'ai essay√© et cela s'est av√©r√© mal, pour une raison peu claire, les configurations sur les serveurs qui ont pris la config ont juste arr√™t√© de lire les modifications, bien que pour la premi√®re fois tout ait fonctionn√©.  Je n'ai pas trouv√© la cause de l'√©chec et j'ai d√©cid√© de le faire diff√©remment. <br><br>  La configuration suppl√©mentaire se fait exclusivement via RSAT, les applets de commande sp√©cifi√©es dans la documentation ne fonctionnent que sous Windows Server avec une interface graphique.  Le d√©ploiement de la r√©plication DFS √† l'aide de Server Core exclusivement n'est pas possible.  Vous avez besoin d'un autre serveur avec une interface graphique ou d'un ordinateur ex√©cutant Windows 10 Pro avec RSAT install√©, joint au domaine. <br><br>  <b>2.1.</b>  <b>Installer</b> <br><br>  Sur chaque serveur, vous devez installer la r√©plication DFS: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ebf/999/b17/ebf999b179089dd87a346406bfe6a09d.png"><br><br><pre> <code class="plaintext hljs">Install-WindowsFeature FS-DFS-Replication, FS-DFS-Namespace</code> </pre> <br>  <b>2.2.</b>  <b>Cr√©ation d'un nouveau groupe de r√©plication</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/53b/3e2/9d6/53b3e29d6aee1c0e9f9a6b4e8f5ea06e.png"><br><br>  Vous devez d'abord appeler notre groupe de r√©plication. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14d/7ce/a23/14d7cea23a3bd08b1aec745ed40c0fb3.png"><br><br>  Choisissez la topologie √† votre go√ªt.  Personnellement, il sera plus pratique pour moi d'ajouter du contenu √† un seul endroit, alors je choisis une √©toile. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2fb/a17/e99/2fba17e99d83b3bec4940c5517c2a690.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a2/6e4/508/7a26e4508dfe041bc25c5cf008120ec2.png"><br><br>  L'un des serveurs doit √™tre le principal, c'est √† partir de l√† que la r√©plication commence.  Si vous t√©l√©chargez des fichiers vers des √©couteurs, le fichier t√©l√©charg√© n'est pas r√©pliqu√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d36/298/12a/d3629812afb96964a66db8a1c7682513.png"><br><br>  En tant que dossier de r√©plication, j'ai choisi le dossier par d√©faut avec les sites: <br><br><pre> <code class="plaintext hljs">C:\inetpub\wwwroot</code> </pre> <br>  Ce dossier est le chemin d'acc√®s au r√©pertoire de ce premier serveur particulier.  Vous pouvez r√©pliquer le contenu de ce dossier n'importe o√π, quel que soit le chemin d'acc√®s. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d10/e94/f5e/d10e94f5e3e48d88ddcc3a5cb97ff5a4.png"><br><br>  Au sein d'un m√™me groupe, nous pouvons r√©pliquer plusieurs dossiers, et √† l'avenir, nous pouvons √©tendre leur liste si n√©cessaire. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ccc/ae9/649/cccae9649e5b0145fb38a6cd59d73490.png"><br><br>  Termin√©. <br><br><h2>  <font color="#3AC1EF">5. Tester les performances</font> </h2><br>  Pour comprendre combien de visiteurs sur le site ont r√©ellement gagn√©, vous devez prendre des mesures.  Ils seront men√©s √† partir de deux points.  PC d'auteur √† Moscou et serveur virtuel √† Francfort.  Les trois points seront test√©s s√©par√©ment.  Voici un r√©sum√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d26/12c/04a/d2612c04abedc5d8eb796cbeeaaf31f7.png"><br><br>  Nous allons dans Devtools et regardons la cascade.  En moyenne, dans un h√¥pital, un CDN r√©duira d'environ 200 millisecondes avant qu'un site ne soit compl√®tement charg√©.  L'image, le plus grand objet de la page, est charg√©e d√®s qu'elle entre dans la fen√™tre, faites donc attention √† la ligne verticale bleue.  CDN a acc√©l√©r√© les styles et scripts HTML + purs de 10 √† 15 millisecondes, et l'image charg√©e 220 millisecondes plus rapidement, c'est une diff√©rence tr√®s significative. <br><br><div class="spoiler">  <b class="spoiler_title">Moscou - Moscou:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/12b/5e5/8a9/12b5e58a9665f6901f073c0eba3f2678.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Londres - Moscou:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/03e/435/b93/03e435b93de7b098fbd98afdacc0c8f4.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Zurich - Moscou:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/1f2/474/cfb/1f2474cfba94d72d5482cb9a0ba0c679.png"></div></div><br>  J'ai √©galement mesur√© la vitesse de Jekyll sur un h√¥te local: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/514/976/285/514976285849bbf746909644173302ba.png"><br><br>  Nous nous tournons vers le phare et voyons des r√©sultats √©tranges: <br><br><div class="spoiler">  <b class="spoiler_title">Moscou - Moscou:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/f2b/516/abb/f2b516abbaeb5ea7ec29c39585719d38.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Londres - Moscou:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/9ab/9d8/38c/9ab9d838cd9c67792381c0741ef81a27.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Zurich - Moscou:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/12e/500/00b/12e50000b52c228beb3f08367fbbf00d.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Localhost - Jekyll:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/3eb/449/599/3eb449599c0eee7698301470b48ea67b.png"></div></div><br>  Dans ce synth√©tiques, un serveur qui terres lointaines contourne l'h√¥te local.  Mais pourquoi? <br>  Pour le plaisir, d√©barrassons-nous des polices Google et transf√©rons-les sur nos serveurs. <br><br><div class="spoiler">  <b class="spoiler_title">Moscou - Moscou:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/457/082/7cb/4570827cb685795120f645da992ebcf8.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Londres - Moscou:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/f90/fbd/2ad/f90fbd2ad39d80e6b246faf348fee577.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Zurich - Moscou:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/d45/2f0/530/d452f0530f2d1d914aba53649cff763d.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Localhost - Jekyll:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/bc2/6a1/f27/bc26a1f275f6d3626de02d96b436c186.png"></div></div><br>  Les r√©sultats entre les centres de donn√©es sont align√©s.  Mais cela n'explique toujours rien.  J'ai refait les tests plusieurs fois, les r√©sultats sont absolument irr√©prochables et reproductibles √† tout moment. <br><br>  Nous allons maintenant utiliser un VPS avec deux c≈ìurs et 4 gigaoctets de RAM situ√© √† Francfort et voir ce qu'il dit.  Cascades: <br><br><div class="spoiler">  <b class="spoiler_title">Moscou - Francfort:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/025/d40/dd7/025d40dd7962e7e312a6978cff91cabd.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Londres - Francfort:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/961/e9f/acf/961e9facf3d0a4654654f3541c7093a6.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Zurich - Francfort:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/d5a/81e/399/d5a81e399de00ca9f3a451d09379f6cd.png"></div></div><br>  Ici, avec le bon point, les gains de temps uniquement sur les styles et le HTML s'√©levaient √† 200 millisecondes.  Autrement dit, dans le cas d'un client de Francfort, le site sera simplement plus rapide de 200 millisecondes.  Cela se refl√®te √©galement dans le phare.  Dans de tels cas, CDN acc√©l√©rera non seulement la boutique en ligne, mais aussi un blog simple. <br><br><div class="spoiler">  <b class="spoiler_title">Moscou - Francfort:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/e4d/e88/785/e4de88785e56ed3102cef5ade05f8462.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Londres - Francfort:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/042/b1c/071/042b1c0716f7e44b2f2dfc0b3955a68f.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Zurich - Francfort:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/db1/ae1/de5/db1ae1de5ebfd5be8c3af5e6822a4376.png"></div></div><br>  Maintenant, activez Google Fonts et regardez √† nouveau le phare. <br><br><div class="spoiler">  <b class="spoiler_title">Moscou - Francfort:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/87d/ae6/281/87dae6281e2510fa35ee4aecd45079f0.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Londres - Francfort:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/025/ec2/d7d/025ec2d7d6982b39261551f927167ad2.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Zurich - Francfort:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/802/f0c/073/802f0c073e6fa0f445dda60d7823da00.png"></div></div><br>  Malheureusement, je n'ai plus de points sur lesquels effectuer des tests, donc je vais terminer. <br><br><h2>  <font color="#3AC1EF">Conclusions</font> </h2><br><ul><li>  Un CDN pour la sortie de toutes les statistiques est n√©cessaire, surtout quand il s'agit d'images lourdes ou de longs scripts. </li><li>  L'utilisation de Google Fonts est possible et n√©cessaire, dans les sc√©narios lourds, cela acc√©l√®re vraiment le site. </li><li>  Le serveur principal, si vous d√©cidez de faire tout cela sous Windows, il est conseill√© d'avoir une interface graphique. </li><li>  Les utilisateurs qui prendront les configurations depuis le serveur principal sont mieux rendus locaux - en cas de d√©faillance du contr√¥leur de domaine, les n≈ìuds peuvent perdre la connexion avec les configurations et les certificats, et le pool d'applications sera arr√™t√©, car  ne pourra pas lire une config. </li></ul><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/it/t5/3p/itt53pns2iucwylb3bwn1fmmtnu.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr466447/">https://habr.com/ru/post/fr466447/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr466437/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 43. Protocoles de routage Distance du vecteur et √©tat de la liaison</a></li>
<li><a href="../fr466439/index.html">V√©rifiez vous-m√™me: combien de questions pouvez-vous r√©pondre √† ChGK?</a></li>
<li><a href="../fr466441/index.html">Code buggy Python: 10 erreurs les plus courantes que les d√©veloppeurs font</a></li>
<li><a href="../fr466443/index.html">ShIoTiny et le monde: capteurs analogiques ou ADC pour les plus petits</a></li>
<li><a href="../fr466445/index.html">Attaques entre approbations entre domaines</a></li>
<li><a href="../fr466449/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 44. Introduction √† OSPF</a></li>
<li><a href="../fr466451/index.html">Read_You can't_throw</a></li>
<li><a href="../fr466453/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 45. Configuration d'OSPF</a></li>
<li><a href="../fr466455/index.html">Services, microservices et programmation orient√©e batch</a></li>
<li><a href="../fr466457/index.html">Agriculture et panneaux solaires - strat√©gie gagnant-gagnant pour les ing√©nieurs √©lectriciens et les agriculteurs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>