<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìú üì∏ üëï MySQL-Verbindung nach Fehler 1040: zu viele Verbindungen üé∂ üåΩ üëç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Und wieder FEHLER 1040 ... 


 Der technische Support erh√§lt viele Beschwerden √ºber diesen ber√ºchtigten Fehler: ERROR 1040: Too many connections - zu ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MySQL-Verbindung nach Fehler 1040: zu viele Verbindungen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/468757/"><h3 id="i-snova-error-1040">  Und wieder FEHLER 1040 ... </h3><br><p> Der technische Support erh√§lt viele Beschwerden √ºber diesen ber√ºchtigten Fehler: <code>ERROR 1040: Too many connections</code> - zu viele Verbindungen.  Das Problem liegt auf der Hand: Die Anwendung oder die Benutzer erstellen mehr Verbindungen, als der Server zul√§sst, <code>max_connections</code> die aktuelle Anzahl der Verbindungen √ºberschreitet den Wert der Variablen <code>max_connections</code> . </p><br><p><img src="https://habrastorage.org/webt/sl/15/fx/sl15fxlzehxs85_njkiq1xcq79y.jpeg"></p><br><p>  Die Situation selbst ist ein Problem f√ºr Endbenutzer. Wenn Sie jedoch immer noch keinen Zugriff auf den Server haben, um die Ursache zu diagnostizieren und zu beheben, wird alles sehr schlecht.  In der Regel m√ºssen Sie die Instanz abschlie√üen und neu starten, um sie wiederherzustellen. </p><a name="habracut"></a><br><h3 id="root-polzovatel-tozhe-ne-mozhet-podklyuchitsya-pochemu">  Der Root-Benutzer kann auch keine Verbindung herstellen!  Warum ?! </h3><br><p>  In einer ordnungsgem√§√ü konfigurierten Umgebung kann ein Benutzer mit der Berechtigung <code>SUPER</code> auf die Instanz zugreifen und die Fehlerursache 1040 diagnostizieren, aufgrund derer nicht gen√ºgend Verbindungen bestehen.  Dies ist im Handbuch beschrieben: </p><br><blockquote>  mysqld erlaubt <code>max_connections</code> + 1 Clientverbindungen.  Eine zus√§tzliche Verbindung ist f√ºr Konten mit <code>SUPER</code> Berechtigungen reserviert.  Wenn diese Berechtigungen Administratoren und nicht normalen Benutzern (die sie nicht ben√∂tigen) gew√§hrt werden, kann ein Administrator, der auch √ºber die Berechtigung <code>PROCESS</code> verf√ºgt, eine Verbindung zum Server herstellen und mithilfe von <code>SHOW PROCESSLIST</code> Probleme diagnostizieren, selbst wenn die maximale Anzahl von Clients ohne Berechtigungen verbunden ist. </blockquote><p>  Viele Benutzer gew√§hren ihren Benutzern der Anwendung oder des Skripts jedoch <code>SUPER</code> Berechtigungen - aufgrund der Anforderungen der Anwendung (gef√§hrlich!) Oder mangelnder Kenntnis der Konsequenzen, und dann belegt der normale Benutzer die reservierte Verbindung, und der Administrator (normalerweise <code>root</code> ) kann keine Verbindung herstellen. </p><br><h3 id="kak-garantirovat-dostup-k-ekzemplyaru">  So garantieren Sie den Zugriff auf eine Instanz </h3><br><p>  Sie k√∂nnen den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bekannten Hack mit GDB verwenden, den Aurimas vor</a> 100 Jahren f√ºr Fehler 1040 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">empfohlen</a> hat, aber jetzt gibt es bessere L√∂sungen.  Es stimmt, sie m√ºssen zuerst eingeschaltet werden. <br>  Mit Percona Server 5.5.29 und h√∂her und MySQL 8.0.14 und h√∂her k√∂nnen Sie einen anderen Port mit einer zus√§tzlichen Anzahl von Verbindungen konfigurieren.  Die Anwendung verwendet diese Schnittstellen nicht.  Sie sind nur f√ºr Datenbankadministratoren und Agenten zur √úberwachung und √úberpr√ºfung des Zustands vorgesehen (siehe Hinweis unten). </p><br><h3 id="nastroyka-percona-server">  Konfigurieren Sie Percona Server </h3><br><p>  Ab Percona Server 5.5.29 k√∂nnen Sie my.cnf einfach <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>extra_port</code></a> hinzuf√ºgen. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>extra_port</code></a> n√§chsten Neustart ist der Port verf√ºgbar und erwartet Daten auf derselben <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>bind_address</code></a> wie normale Verbindungen.  Wenn Sie die Variable <code>extra_port</code> nicht konfigurieren, gibt es standardm√§√üig keinen zus√§tzlichen Port. </p><br><p>  Sie k√∂nnen auch <code>extra_max_connections</code> definieren, um die Anzahl der Verbindungen anzugeben, die dieser Port verarbeiten wird.  Die Standardnummer ist 1. </p><br><p>  Zum Beispiel habe ich alle Verbindungen zum regul√§ren Benutzerport von der Instanz genommen, in der ich <code>extra_port</code> und <code>extra_max_connections</code> in <code>my.cnf</code> konfiguriert <code>my.cnf</code> : </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ergebnis</a> </p><br><p>  Extra_port wurde √ºbrigens in Percona Server 8.0.14 und h√∂her entfernt, da admin_port mit denselben Funktionen in MySQL Community implementiert ist.  Bearbeiten Sie also my.cnf beim Upgrade auf Percona Server 8.0.14 oder h√∂her, wenn Sie extra_port bereits definiert haben. </p><br><h3 id="nastroyka-v-mysql-community">  Optimieren in der MySQL Community </h3><br><p>  Wie gesagt, dies erfordert MySQL 8.0.14, wo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">WorkLog 12138 verwendet wird</a> . </p><br><p>  Um die Administratorschnittstelle zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aktivieren</a> , m√ºssen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">admin_addres</a> definieren. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dies</a> muss die einzige und eindeutige (ohne Platzhalter) IPv4-, IPv6-, IPv4-zugeordnete Adresse oder der Hostname sein, unter dem die Administratorschnittstelle auf die √úbertragung von Daten wartet.  Wenn diese Variable nicht definiert ist, ist die Schnittstelle nicht aktiviert. </p><br><p>  Sie k√∂nnen den Port weiterhin definieren, dies ist jedoch nicht erforderlich.  Standardm√§√üig ist dies Port <code>33062</code> .  Wenn dieser Port frei ist, muss dieser Wert nicht konfiguriert werden.  Wenn Sie konfigurieren, <code>[mysqld]</code> Sie beide Variablen in den Abschnitt <code>[mysqld]</code> in <code>my.cnf</code> . </p><br><p>  Schlie√ülich k√∂nnen Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>create_admin_listener_thread</code></a> (standardm√§√üig deaktiviert) konfigurieren, wodurch ein separater Thread f√ºr die Verarbeitung eingehender Verbindungen erstellt wird.  Dies kann in einigen Situationen n√ºtzlich sein. </p><br><p>  Ein weiterer Unterschied besteht darin, dass in der Oracle-Dokumentation Folgendes angegeben ist: </p><br><blockquote>  <em>Die Anzahl der administrativen Verbindungen ist unbegrenzt.</em> </blockquote><p>  (Und wir haben den Standardwert 1).  Ich bin mir nicht sicher, was das bedeutet, aber ich w√ºrde darauf achten, nicht versehentlich 1 Million Verbindungen herzustellen.  Sie sind nat√ºrlich nicht begrenzt, verbrauchen aber dennoch Ressourcen. </p><br><h3 id="ispolzovanie-dlya-monitoringa-i-proverok-rabotosposobnosti">  Verwendung zur √úberwachung und Gesundheitspr√ºfung </h3><br><p>  Praktischerweise k√∂nnen nicht nur Personen im Notfall eine zus√§tzliche Schnittstelle oder einen zus√§tzlichen Port verwenden, wenn wir <code>max_connections</code> erreicht <code>max_connections</code> .  Ein Proxy- / Load-Balancer- / Service-Discovery-√úberwachungssystem kann daran angeschlossen werden. </p><br><p>  √úberwachungsskripte k√∂nnen Daten f√ºr Diagramme abrufen, sodass Sie sp√§ter herausfinden, woher so viele Verbindungen stammen.  In den Skripts f√ºr die Integrit√§tspr√ºfung wird √ºber den sich verschlechternden Status des Servers berichtet, und bestimmter Code weist m√∂glicherweise darauf hin, dass viele Verbindungen bestehen, der Server jedoch verwaltet (das hei√üt, er kann dies herausfinden und es ist besser, etwas l√§nger zu warten, bis er ausf√§llt). </p><br><p>  Stellen Sie sicher, dass jeweils nur eine Verbindung f√ºr √úberwachung und Integrit√§tspr√ºfungen installiert wird, um extra_max_connections in Percona Server nicht zu verstopfen und nicht eine Million Threads in MySQL zu erstellen.  Das hei√üt, die Skripte sollten nicht erneut verbunden werden, wenn die vorherige Anforderung oder Verbindung zur Datenbank noch aktiv ist. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hier ist das gleiche Beispiel, aber mit MySQL</a> . </p><br><p>  <strong>F√ºr Percona Server 8.0.14 und h√∂her ist der Prozess der gleiche wie f√ºr MySQL Community.</strong> </p><br><h3 id="pomogite-mne-nuzhno-voyti-no-vse-porty-zanyaty">  Hilfe!  Ich muss hineingehen, aber alle Ports sind besetzt! </h3><br><p>  Wenn dies der Grund ist, warum Sie diesen Beitrag lesen, verwenden Sie einen verr√ºckten Hack mit GDB (keine Beleidigung, Aurimas, es sieht nur riskant aus :-D) oder beenden Sie die Instanz.  Gl√ºcklicherweise kann eine Instanz fast immer sauber mit <code>SIGTERM</code> (-15) anstelle von <code>SIGKILL</code> (-9) beendet werden.  Der Server stoppt also sauber und die Threads k√∂nnen normal heruntergefahren werden.  Folgen Sie einfach den Anweisungen: </p><br><p>  1) Holen Sie sich die PID: </p><br><pre> <code class="plaintext hljs">marcos.albe in ~/ pgrep -x mysqld; 650</code> </pre> <br><p>  2) Senden Sie SIGTERM an diese PID: </p><br><pre> <code class="plaintext hljs">marcos.albe in ~/ kill -15 650;</code> </pre> <br><p>  3) √úberpr√ºfen Sie im Fehlerprotokoll, wie das Herunterfahren durchgef√ºhrt wird.  Es wird ungef√§hr so ‚Äã‚Äãaussehen: </p><br><pre> <code class="plaintext hljs">2019-07-11T13:43:28.421244Z 0 [Note] Giving 0 client threads a chance to die gracefully 2019-07-11T13:43:28.521238Z 0 [Note] Shutting down slave threads 2019-07-11T13:43:28.521272Z 0 [Note] Forcefully disconnecting 0 remaining clients</code> </pre> <br><p>  Dies markiert den Beginn des Abschlussprozesses.  Die Instanz wird abgeschlossen, wenn Sie eine √§hnliche Zeile sehen: </p><br><pre> <code class="plaintext hljs">2019-07-11T13:43:31.292836Z 0 [Note] /opt/percona_server/5.7.26/bin/mysqld: Shutdown complete</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de468757/">https://habr.com/ru/post/de468757/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de468739/index.html">Bereitstellen von Speicherfailover</a></li>
<li><a href="../de468741/index.html">Internet in der Smart City</a></li>
<li><a href="../de468747/index.html">Wie ich den Sommer auf VK verbracht habe</a></li>
<li><a href="../de468749/index.html">Android LiveData-Ereignisse</a></li>
<li><a href="../de468753/index.html">Farbenblind - Freund des Menschen (Gesundheitsministerium ist nicht richtig)</a></li>
<li><a href="../de468759/index.html">√úber trivial_abi in Clang</a></li>
<li><a href="../de468761/index.html">Probleml√∂sung mit pwnable.kr 24 - einfaches Login. Stapelrahmen√ºberlagerung</a></li>
<li><a href="../de468765/index.html">Die Wichtigkeit der Best√§tigung von Steuerbefehlen am Beispiel von Delimobile</a></li>
<li><a href="../de468767/index.html">Holzspielzeug, Teil zwei - 1986-1988</a></li>
<li><a href="../de468769/index.html">Xavier Noria auf Rails 6, Beratung und mehr</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>