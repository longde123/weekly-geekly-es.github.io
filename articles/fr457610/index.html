<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüî¨ üèë üë®üèæ‚Äçü§ù‚Äçüë®üèΩ Analyse des vuln√©rabilit√©s de Evil Parcel üõéÔ∏è üçÉ üî°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©sentation 
 √Ä la mi-avril, nous avons publi√© des informations sur le cheval de Troie Android.InfectionAds.1 , qui exploitait plusieurs vuln√©rabilit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Analyse des vuln√©rabilit√©s de Evil Parcel</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/drweb/blog/457610/"><h3>  Pr√©sentation </h3><br>  √Ä la mi-avril, nous avons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">publi√© des informations</a> sur le cheval de Troie <b>Android.InfectionAds.1</b> , qui exploitait plusieurs vuln√©rabilit√©s critiques d'Android.  L'un d'eux, CVE-2017-13156 (√©galement connu sous le nom de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Janus</a> ), permet aux logiciels malveillants d'infecter les fichiers APK sans endommager la signature num√©rique.  L'autre est CVE-2017-13315.  Il donne au cheval de Troie des privil√®ges √©tendus, afin qu'il puisse installer et d√©sinstaller des applications ind√©pendamment de l'utilisateur.  Une analyse d√©taill√©e d' <b>Android.InfectionAds.1</b> est disponible dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notre biblioth√®que de virus</a> ;  pendant que nous sommes ici, nous allons aborder la vuln√©rabilit√© CVE-2017-13315 et voir ce qu'elle fait. <br><a name="habracut"></a><br>  CVE-2017-13315 appartient au groupe de vuln√©rabilit√©s baptis√© EvilParcel.  On les retrouve dans diff√©rentes classes de syst√®mes Android.  Des erreurs dans ces classes permettent de substituer des informations lors de l'√©change de donn√©es entre les applications et le syst√®me.  Les logiciels malveillants qui exploitent les vuln√©rabilit√©s EvilParcel se voient ainsi accorder des privil√®ges plus √©lev√©s et deviennent capables de ce qui suit: <br><br><ul><li>  installer et supprimer des applications avec toutes les autorisations sans confirmation des utilisateurs; </li><li>  infecter les logiciels install√©s sur l'appareil et remplacer les originaux propres par des copies infect√©es lorsqu'ils sont utilis√©s avec d'autres vuln√©rabilit√©s; </li><li>  r√©initialiser le code PIN de l'√©cran de verrouillage sur les appareils Android. </li></ul><br>  A ce jour, nous connaissons 7 vuln√©rabilit√©s de ce type: <br><ul><li>  CVE-2017-0806 (erreur dans la classe GateKeeperResponse), publi√©e en octobre 2017; </li><li>  CVE-2017-13286 (erreur dans la classe OutputConfiguration, publi√©e en avril 2018; </li><li>  CVE-2017-13287 (erreur dans la classe VerifyCredentialResponse), publi√©e en avril 2018; </li><li>  CVE-2017-13288 (erreur dans la classe PeriodicAdvertizingReport), publi√©e en avril 2018; </li><li>  CVE-2017-13289 (erreur dans la classe ParcelableRttResults), publi√©e en avril 2018; </li><li>  CVE-2017-13311 (erreur dans la classe SparseMappingTable), publi√©e en mai 2018; </li><li>  CVE-2017-13315 (erreur dans la classe DcParamObject), publi√© en mai 2018. </li></ul><br>  Tous constituent une menace pour les appareils ex√©cutant Android 5.0 - 8.1 sans mise √† jour de s√©curit√© de mai 2018 (ou ult√©rieure) install√©e. <br><br><h3>  Pr√©requis pour les vuln√©rabilit√©s EvilParcel </h3><br>  Voyons comment les vuln√©rabilit√©s EvilParcel peuvent appara√Ætre.  Tout d'abord, nous devons examiner certaines fonctionnalit√©s des applications Android.  Tous les programmes Android interagissent entre eux, ainsi qu'avec le syst√®me d'exploitation, en envoyant et en recevant des objets Intent.  Ces objets peuvent contenir un nombre arbitraire de paires cl√©-valeur √† l'int√©rieur d'un objet Bundle. <br><br>  Lors du transfert d'une intention, un objet Bundle est converti (s√©rialis√©) en un tableau d'octets envelopp√© dans Parcel, puis d√©s√©rialis√© automatiquement apr√®s avoir lu les cl√©s et les valeurs d'un bundle s√©rialis√©. <br><br>  Dans le bundle, la cl√© est la cha√Æne et la valeur peut √™tre presque n'importe quoi.  Par exemple, il peut s'agir d'un type primitif, d'une cha√Æne ou d'un conteneur avec des types ou cha√Ænes primitifs.  Il peut √©galement s'agir d'un objet Parcelable. <br><br>  Ainsi, le Bundle peut contenir un objet de tout type qui impl√©mente l'interface Parcelable.  Pour cela, nous devons impl√©menter les m√©thodes writeToParcel () et createFromParcel () pour s√©rialiser et d√©s√©rialiser l'objet. <br><br>  Pour illustrer notre propos, cr√©ons un bundle s√©rialis√© simple.  Nous allons √©crire un code qui met trois paires cl√©-valeur dans le bundle et le s√©rialise: <br><br><img src="https://habrastorage.org/webt/pf/-9/2j/pf-92jsexpyrb7p2dvi8oj3-vbs.png"><br>  Figure 1. Structure d'un objet bundle s√©rialis√© <br><br>  Notez les caract√©ristiques sp√©cifiques de la s√©rialisation de bundle: <br><br><ul><li>  toutes les paires cl√©-valeur sont √©crites s√©quentiellement; </li><li>  le type de valeur est indiqu√© avant chaque valeur (13 pour le tableau d'octets, 1 pour l'entier, 0 pour la cha√Æne, etc.); </li><li>  la taille des donn√©es de longueur variable est indiqu√©e avant les donn√©es (longueur pour la cha√Æne, nombre d'octets pour le tableau); </li><li>  toutes les valeurs sont align√©es sur 4 octets. </li></ul><br><br>  Toutes les cl√©s et valeurs sont √©crites dans le Bundle de mani√®re s√©quentielle de sorte que lors de l'acc√®s √† une cl√© ou une valeur d'un objet Bundle s√©rialis√©, ce dernier se d√©s√©rialise enti√®rement, initialisant √©galement tous les objets Parcelable contenus. <br><br>  Alors, quel pourrait √™tre le probl√®me?  Le probl√®me est que certaines classes syst√®me qui impl√©mentent Parcelable peuvent contenir des erreurs dans les m√©thodes createFromParcel () et writeToParcel ().  Dans ces classes, le nombre d'octets lus dans createFromParcel () sera diff√©rent du nombre d'octets √©crits dans writeToParcel ().  Si vous placez un objet de cette classe √† l'int√©rieur d'un bundle, les limites des objets √† l'int√©rieur du bundle changeront apr√®s la res√©rialisation.  Cela cr√©e les conditions pour exploiter une vuln√©rabilit√© EvilParcel. <br><br>  Voyons un exemple d'une classe qui contient cette erreur: <br><br><pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Demo</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parcelable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] data; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Demo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Demo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Parcel in)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> length = in.readInt(); data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[length]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { in.readByteArray(data); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Creator&lt;Demo&gt; CREATOR = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Creator&lt;Demo&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Demo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFromParcel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Parcel in)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Demo(in); } }; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeToParcel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Parcel parcel, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span><span class="hljs-function"> </span></span>{ parcel.writeInt(data.length); parcel.writeByteArray(data); } }</code> </pre> <br>  Si la taille du tableau de donn√©es est 0, lors de la cr√©ation d'un objet, un int (4 octets) sera lu dans createFromParcel () et deux int (8 octets) seront √©crits dans writeToParcel ().  Le premier int sera √©crit en appelant explicitement writeInt.  Le deuxi√®me entier sera √©crit lors de l'appel de writeByteArray (), car la longueur du tableau est toujours √©crite avant le tableau dans Parcel (voir la figure 1). <br><br>  Les situations o√π la taille du tableau de donn√©es est √©gale √† 0 sont assez rares.  Mais m√™me lorsque cela se produit, le programme continue de fonctionner, si vous ne transmettez qu'un seul objet s√©rialis√© √† la fois (dans notre exemple, l'objet Demo).  Par cons√©quent, de telles erreurs ont tendance √† passer inaper√ßues. <br><br>  Nous allons maintenant essayer de placer un objet Demo avec une longueur de tableau nulle dans le bundle: <br><br><img src="https://habrastorage.org/webt/2y/2v/i0/2y2vi0ftdkartg9i01cc-b858g0.png"><br>  Figure 2. R√©sultat de l'ajout d'un objet de d√©monstration de longueur nulle √† l'ensemble <br><br>  Nous s√©rialisons l'objet: <br><br><img src="https://habrastorage.org/webt/hv/tw/if/hvtwifj9curkc7ip6jplbdlk-yc.png"><br>  Figure 3. L'objet Bundle apr√®s la s√©rialisation <br><br>  Essayons maintenant de le d√©s√©rialiser: <br><br><img src="https://habrastorage.org/webt/_u/a1/k4/_ua1k4hp34wknsvnppv8zla0jei.png"><br>  Figure 4. L'objet Bundle apr√®s la d√©s√©rialisation <br><br>  Qu'obtenons-nous?  Jetons un coup d'≈ìil au fragment de parcelle: <br><br><img src="https://habrastorage.org/webt/tf/qa/fn/tfqafnxzmsfujmq2xyo-kwvbc2g.png"><br>  Figure 5. Structure des parcelles apr√®s d√©s√©rialisation du paquet <br><br>  Sur les figures 4 et 5, nous voyons qu'au lieu de deux int, un int a √©t√© lu dans la m√©thode createFromParcel pendant la d√©s√©rialisation.  Par cons√©quent, toutes les valeurs suivantes du bundle ont √©t√© lues incorrectement.  La valeur 0x0 √† 0x60 a √©t√© lue comme la longueur de la cl√© suivante.  La valeur 0x1 √† 0x64 a √©t√© lue comme une cl√©.  La valeur 0x31 √† 0x68 a √©t√© lue comme un type de valeur.  Parcel n'a aucune valeur avec le type 0x31, donc readFromParcel () signale minutieusement une exception. <br><br>  Comment cela peut-il √™tre utilis√© dans la vie r√©elle et devenir une vuln√©rabilit√©?  Voyons voir!  L'erreur ci-dessus dans les classes syst√®me Parcelable permet la cr√©ation d'ensembles qui peuvent diff√©rer lors de la premi√®re et des d√©s√©rialisations r√©p√©t√©es.  Pour le d√©montrer, nous allons modifier l'exemple pr√©c√©dent: <br><br><pre> <code class="java hljs">Parcel data = Parcel.obtain(); data.writeInt(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 3 entries data.writeString("vuln_class"); data.writeInt(4); // value is Parcelable data.writeString("com.drweb.testbundlemismatch.Demo"); data.writeInt(0); // data.length data.writeInt(1); // key length -&gt; key value data.writeInt(6); // key value -&gt; value is long data.writeInt(0xD); // value is bytearray -&gt; low(long) data.writeInt(-1); // bytearray length dummy -&gt; high(long) int startPos = data.dataPosition(); data.writeString("hidden"); // bytearray data -&gt; hidden key data.writeInt(0); // value is string data.writeString("Hi there"); // hidden value int endPos = data.dataPosition(); int triggerLen = endPos - startPos; data.setDataPosition(startPos - 4); data.writeInt(triggerLen); // overwrite dummy value with the real value data.setDataPosition(endPos); data.writeString("A padding"); data.writeInt(0); // value is string data.writeString("to match pair count"); int length = data.dataSize(); Parcel bndl = Parcel.obtain(); bndl.writeInt(length); bndl.writeInt(0x4C444E42); // bundle magic bndl.appendFrom(data, 0, length); bndl.setDataPosition(0);</span></span></code> </pre> <br>  Ce code cr√©e un bundle s√©rialis√© qui contient une classe vuln√©rable.  Voyons maintenant ce que nous obtenons apr√®s avoir ex√©cut√© ce code: <br><br><img src="https://habrastorage.org/webt/tc/ke/wf/tckewffnaop28wllxnrt7pagdvs.png"><br>  Figure 6. Cr√©ation d'un bundle avec une classe vuln√©rable <br><br>  Apr√®s la premi√®re d√©s√©rialisation, ce bundle contiendra les cl√©s suivantes: <br><br><img src="https://habrastorage.org/webt/cj/si/l0/cjsil0--g_jsoew8ht-oxely1u4.png"><br>  Figure 7. Apr√®s d√©s√©rialisation d'un bundle avec une classe vuln√©rable <br><br>  Maintenant, nous allons √† nouveau s√©rialiser le bundle, puis le d√©s√©rialiser √† nouveau et regarder la liste des cl√©s: <br><br><img src="https://habrastorage.org/webt/uw/e1/mj/uwe1mjdtywr59oyshaah2q1gkus.png"><br>  Figure 8. R√©sultat de la res√©rialisation et de la d√©s√©rialisation d'un bundle avec une classe vuln√©rable <br><br>  Que voyons-nous?  Le Bundle contient maintenant la cl√© cach√©e (avec la valeur de cha√Æne "Salut!"), Qui n'√©tait pas l√† auparavant.  Examinons le fragment de colis de ce bundle pour voir pourquoi cela s'est produit: <br><br><img src="https://habrastorage.org/webt/i8/up/j1/i8upj1jif-_d41drqii19gw2nce.png"><br>  Figure 9. Structure de parcelle d'un objet Bundle avec une classe vuln√©rable apr√®s deux cycles de s√©rialisation et de d√©s√©rialisation <br><br>  C'est l√† que nous pouvons voir tout l'int√©r√™t des vuln√©rabilit√©s EvilParcel.  Nous pouvons sp√©cifiquement cr√©er un Bundle qui contiendra une classe vuln√©rable.  Changer les limites de cette classe permettra de placer n'importe quel objet dans ce Bundle;  par exemple, une intention, qui n'appara√Ætra dans le bundle qu'apr√®s la deuxi√®me d√©s√©rialisation.  Cela permet de masquer une intention des m√©canismes de s√©curit√© du syst√®me d'exploitation. <br><br><h3>  Exploiter EvilParcel </h3><br>  <b>Android.InfectionAds.1 a</b> exploit√© CVE-2017-13315 pour installer et supprimer des logiciels ind√©pendamment des propri√©taires d'appareils.  Mais comment? <br><br>  En 2013, l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">erreur 7699048</a> , √©galement appel√©e Launch AnyWhere, a √©t√© d√©couverte.  Il a permis √† des applications tierces de d√©marrer des activit√©s arbitraires au nom d'un utilisateur syst√®me plus privil√©gi√©.  Voir le sch√©ma ci-dessous pour le m√©canisme d'action: <br><br><img src="https://habrastorage.org/webt/in/d8/-m/ind8-mnyp5urfsndbkycy3l42f8.png"><br>  Figure 10. Fonctionnement de l'erreur 7699048 <br><br>  Une application exploitante peut utiliser cette vuln√©rabilit√© pour impl√©menter le service Account Authenticator, con√ßu pour ajouter de nouveaux comptes au syst√®me d'exploitation.  L'erreur 7699048 aide les activit√©s de lancement d'exploit √† installer, supprimer, remplacer des applications, ainsi qu'√† r√©initialiser le code PIN ou le verrouillage de mod√®le et causer beaucoup plus de probl√®mes. <br><br>  Google Inc.  a √©limin√© cette violation en interdisant le lancement d'activit√©s arbitraires depuis AccountManager.  D√©sormais, AccountManager permet uniquement le lancement d'activit√©s provenant de la m√™me application.  √Ä cette fin, il v√©rifie et fait correspondre la signature num√©rique du logiciel qui a initi√© l'activit√© avec la signature de l'application o√π se trouve l'activit√©.  Cela ressemble √† ceci: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; (intent = result.getParcelable(AccountManager.KEY_INTENT)) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* * The Authenticator API allows third party authenticators to * supply arbitrary intents to other apps that they can run, * this can be very bad when those apps are in the system like * the System Settings. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> authenticatorUid = Binder.getCallingUid(); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> bid = Binder.clearCallingIdentity(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { PackageManager pm = mContext.getPackageManager(); ResolveInfo resolveInfo = pm.resolveActivityAsUser(intent, <span class="hljs-number"><span class="hljs-number">0</span></span>, mAccounts.userId); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> targetUid = resolveInfo.activityInfo.applicationInfo.uid; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (PackageManager.SIGNATURE_MATCH != pm.checkSignatures(authenticatorUid, targetUid)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SecurityException( <span class="hljs-string"><span class="hljs-string">"Activity to be started with KEY_INTENT must "</span></span> + <span class="hljs-string"><span class="hljs-string">"share Authenticator's signatures"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { Binder.restoreCallingIdentity(bid); } }</code> </pre><br>  Il semblerait que le probl√®me soit r√©solu, mais ce n'est pas aussi simple que cela.  Il s'est av√©r√© que la vuln√©rabilit√© bien connue, EvilParcel CVE-2017-13315, fournit une solution de contournement!  Comme nous le savons d√©j√†, apr√®s avoir corrig√© Launch AnyWhere, le syst√®me v√©rifie la signature num√©rique de l'application.  S'il est v√©rifi√© avec succ√®s, le bundle est transf√©r√© vers IAccountManagerResponse.onResult ().  Dans le m√™me temps, onResult () est appel√© via le m√©canisme IPC, de sorte que le bundle est √† nouveau s√©rialis√©.  Lors de l'impl√©mentation de onResult (), les √©v√©nements suivants se produisent: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** Handles the responses from the AccountManager */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Response</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IAccountManagerResponse</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Stub</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle bundle)</span></span></span><span class="hljs-function"> </span></span>{ Intent intent = bundle.getParcelable(KEY_INTENT); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (intent != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; mActivity != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// since the user provided an Activity we will silently start intents // that we see mActivity.startActivity(intent); // leave the Future running to wait for the real response to this request } //&lt;.....&gt; } //&lt;.....&gt; }</span></span></code> </pre><br>  Ensuite, le bundle extrait la cl√© d'intention et l'activit√© est lanc√©e sans aucune v√©rification. <br>  Ainsi, pour lancer une activit√© arbitraire avec des privil√®ges syst√®me, il vous suffit de cr√©er un Bundle avec le champ Intent cach√© lors de la premi√®re d√©s√©rialisation et apparaissant lors de la d√©s√©rialisation r√©p√©t√©e. <br>  Comme nous le savons d√©j√†, les vuln√©rabilit√©s EvilParcel peuvent r√©ellement effectuer cette t√¢che. <br><br>  √Ä l'heure actuelle, toutes les vuln√©rabilit√©s connues de ce type ont √©t√© corrig√©es au sein des classes Parcelable vuln√©rables.  Cependant, de nouvelles classes vuln√©rables pourraient appara√Ætre √† l'avenir.  La mise en ≈ìuvre du bundle et le m√©canisme d'ajout de nouveaux comptes sont toujours les m√™mes qu'auparavant.  Ils nous permettent toujours de cr√©er cet exploit exact lors de la d√©tection d'anciennes ou de nouvelles classes Parcelable vuln√©rables.  De plus, ces classes sont toujours impl√©ment√©es manuellement, et le programmeur doit s'assurer que la longueur de l'objet Parcelable s√©rialis√© reste la m√™me, ce qui est un facteur humain avec tout ce qu'il implique.  Cependant, nous esp√©rons qu'il y aura aussi peu d'erreurs que possible et que les vuln√©rabilit√©s EvilParcel ne constitueront pas une menace pour les utilisateurs d'Android. <br><br>  Vous pouvez v√©rifier votre appareil mobile pour les vuln√©rabilit√©s EvilParcel en utilisant notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">espace de s√©curit√© Dr.Web</a> pour Android.  L'auditeur de s√©curit√© int√©gr√© signalera les probl√®mes d√©tect√©s et recommandera des moyens de les √©liminer. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr457610/">https://habr.com/ru/post/fr457610/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr457596/index.html">OSDay 19 ou pourquoi le langage C est toujours vivant</a></li>
<li><a href="../fr457600/index.html">Pr√©sentation des casques Snom A150, Snom A100M et D</a></li>
<li><a href="../fr457602/index.html">Recherche des performances du SGBD MS SQL Server Developer 2016 et PostgreSQL 10.5 pour 1C</a></li>
<li><a href="../fr457606/index.html">Alan Kay: Ce que l'on peut appeler la chose la plus √©tonnante que les ordinateurs ont rendue possible</a></li>
<li><a href="../fr457608/index.html">Comment visualiser les donn√©es dans une histoire captivante</a></li>
<li><a href="../fr457612/index.html">Comment acc√©l√©rer la d√©compression LZ4 dans ClickHouse?</a></li>
<li><a href="../fr457614/index.html">Les secrets de la recherche d'un emploi √† l'√©tranger aupr√®s d'un chasseur de t√™tes en exercice</a></li>
<li><a href="../fr457616/index.html">Mon "Wow, je ne savais pas √ßa!" moments avec plaisanterie</a></li>
<li><a href="../fr457618/index.html">√ätre un d√©veloppeur full-stack moderne</a></li>
<li><a href="../fr457622/index.html">Mesurer les performances Qt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>