<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äç‚úàÔ∏è üö≠ üñçÔ∏è WG Contract API: Zoo der Dienstleistungen ‚öΩÔ∏è üëåüèº üö∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mit der Zunahme der Anzahl der Komponenten in einem Softwaresystem w√§chst normalerweise auch die Anzahl der Personen, die an seiner Entwicklung beteil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>WG Contract API: Zoo der Dienstleistungen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/wargaming/blog/441708/"><img src="https://habrastorage.org/webt/iz/gg/o8/izggo8dsjxgjso5tku-q65ezmwq.jpeg"><br><br>  Mit der Zunahme der Anzahl der Komponenten in einem Softwaresystem w√§chst normalerweise auch die Anzahl der Personen, die an seiner Entwicklung beteiligt sind.  Um das Entwicklungstempo und die Wartungsfreundlichkeit aufrechtzuerhalten, sollten daher Ans√§tze zur Organisation der API besonders ber√ºcksichtigt werden. <br><br>  Wenn Sie sich genauer ansehen m√∂chten, wie das Team der Wargaming Platform mit der Komplexit√§t eines Systems von mehr als hundert miteinander interagierenden Webdiensten umgeht, sind Sie bei cat willkommen. <br><a name="habracut"></a><br>  Hallo allerseits!  Mein Name ist Valentine und ich bin Ingenieur auf der Plattform bei Wargaming.  F√ºr diejenigen, die nicht wissen, was die Plattform ist und was sie tut, werde ich hier einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link</a> zur j√ºngsten Ver√∂ffentlichung eines meiner Kollegen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hinterlassen</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">max_posedon</a> <br><br>  Im Moment arbeite ich seit mehr als f√ºnf Jahren in der Firma und habe teilweise die Zeit des aktiven Wachstums von World of Tanks gefunden.  Um die in diesem Artikel angesprochenen Probleme aufzudecken, muss ich mit einem kurzen Exkurs in die Geschichte der Wargaming-Plattform beginnen. <br><br><h2>  Ein bisschen Geschichte </h2><br>  Die wachsende Beliebtheit von ‚ÄûPanzern‚Äú erwies sich als Lawinenart, und wie es in solchen F√§llen normalerweise der Fall ist, begann sich die Infrastruktur rund um das Spiel schnell zu entwickeln.  Infolgedessen wuchs das Spiel schnell mit verschiedenen Webdiensten √ºber, und zum Zeitpunkt meines Beitritts zum Team lag die Punktzahl bereits bei zehn (jetzt funktionieren √ºbrigens mehr als 100 Plattformkomponenten und kommen dem Unternehmen zugute). <br><br>  Mit der Zeit kamen neue Spiele heraus, und es war nicht mehr einfach, die Feinheiten der Integration zwischen Webdiensten zu verstehen.  Die Situation verschlechterte sich erst, als Teams aus anderen Wargaming-B√ºros an der Entwicklung der Plattform teilnahmen.  Die Entwicklung hat sich verteilt, mit allen Konsequenzen in Form von Entfernung, Zeitzonen und Sprachbarriere.  Und es gibt noch mehr Dienstleistungen.  Es ist nicht so einfach, eine Person zu finden, die versteht, wie die Plattform insgesamt funktioniert.  Informationen mussten oft in Teilen aus verschiedenen Quellen gesammelt werden. <br><br>  Die Schnittstellen verschiedener Webdienste k√∂nnen sich in der stilistischen Leistung stark unterscheiden, was den Integrationsprozess mit der Plattform noch schwieriger macht.  Direkte Abh√§ngigkeiten zwischen Komponenten reduzierten die Entwicklungsflexibilit√§t, indem sie die Zerlegung der Funktionalit√§t innerhalb der Plattform erschwerten.  Um die Sache noch schlimmer zu machen, kannten Spiele - Kunden der Plattform - unsere Topologie gut, da sie sich direkt in jeden Plattformdienst integrieren mussten.  Dies gab ihnen die M√∂glichkeit, √ºber horizontale Verbindungen f√ºr die Implementierung bestimmter Verbesserungen direkt in der Komponente einzutreten, in die sie integriert sind.  Dies f√ºhrte zum Auftreten doppelter Funktionen in verschiedenen Komponenten der Plattform sowie zur Unf√§higkeit, die vorhandenen Funktionen auf andere Spiele auszudehnen.  Es wurde klar, dass es eine Sackgasse der Entwicklung ist, weiterhin eine Plattform um jedes spezifische Spiel herum aufzubauen.  Wir brauchten technische und organisatorische √Ñnderungen, wodurch wir die wachsende Komplexit√§t eines schnell wachsenden Systems kontrollieren und alle Plattformfunktionen f√ºr jedes Spiel geeignet machen konnten. <br><br>  Damit m√∂chte ich die historische Exkursion beenden und schlie√ülich √ºber eine unserer technischen L√∂sungen sprechen, die dazu beitr√§gt, die Komplexit√§t zu kontrollieren, die durch die st√§ndig wachsende Anzahl von Diensten verursacht wird.  Dar√ºber hinaus werden die Kosten f√ºr die Entwicklung neuer Funktionen gesenkt und die Integration in die Plattform erheblich vereinfacht. <br><br><h2>  Treffen Sie die Vertrags-API </h2><br>  Innerhalb der Plattform nennen wir es die Vertrags-API.  Im Kern handelt es sich um ein Integrationsframework, das durch eine Reihe von Dokumentationen und Clientbibliotheken f√ºr jede Technologie aus unserem Stack (Erlang / Elixir, Java / Scala, Python) dargestellt wird.  Es wird zun√§chst entwickelt, um die Integration von Plattformkomponenten untereinander zu vereinfachen.  Zweitens, um uns bei der L√∂sung einer Reihe der folgenden Probleme zu helfen: <br><br><ul><li>  stilistische Unterschiede der Programmschnittstellen </li><li>  das Vorhandensein direkter Abh√§ngigkeiten zwischen Komponenten </li><li>  Dokumentation auf dem neuesten Stand halten </li><li>  Selbstbeobachtung und Debugging von End-to-End-Funktionen </li></ul><br>  Also, das Wichtigste zuerst. <br><br><h2>  Stilistische Unterschiede bei den Softwareschnittstellen </h2><br>  Meiner Meinung nach ist dieses Problem auf eine Kombination mehrerer Faktoren zur√ºckzuf√ºhren: <br><br><ul><li>  <b>Fehlen eines strengen Standards, wie die API aussehen sollte.</b>  Die Empfehlungen haben oft nicht den gew√ºnschten Effekt, die API ist immer noch anders.  Vor allem, wenn die Entwicklung von Teams aus verschiedenen B√ºros des Unternehmens durchgef√ºhrt wird.  Jedes Team hat seine eigenen Gewohnheiten und Praktiken.  Zusammengenommen sehen solche APIs oft nicht wie Teile eines Ganzen aus. </li><li>  <b>Fehlen eines einzigen Verzeichnisses mit den Namen und Formaten gesch√§ftsspezifischer Entit√§ten.</b>  In der Regel k√∂nnen Sie eine Entit√§t nicht aus dem Ergebnis einer API entnehmen und an die API eines anderen Dienstes √ºbergeben.  Dies erfordert eine Transformation. </li><li>  <b>Fehlen eines obligatorischen zentralen √úberpr√ºfungssystems f√ºr die API.</b>  Es gibt immer Fristen und es ist keine Zeit, Updates zu sammeln und dar√ºber hinaus √Ñnderungen an der API vorzunehmen, was sich tats√§chlich oft als bereits halb getestet herausstellt. </li></ul><br>  Das erste, was wir beim Entwerfen der Vertrags-API getan haben, war zu sagen, dass die API von nun an zur Plattform und nicht zu einer einzelnen Komponente geh√∂rt.  Dies f√ºhrte dazu, dass die Entwicklung neuer Funktionen mit einer Pull-Anforderung an eine zentralisierte Speicher-API beginnt.  Derzeit verwenden wir das GIT-Repository als Speicher.  Der Einfachheit halber haben wir die gesamte API in separate Gesch√§ftsfunktionen unterteilt, die Struktur dieser Funktion formalisiert und als Vertrag bezeichnet. <br><br>  Seitdem sollte jede neue Gesch√§ftsfunktion in unserer Vertrags-API in einem speziellen Format beschrieben werden und die Pull-Anfrage mit einer obligatorischen √úberpr√ºfung durchlaufen.  Es gibt keine andere M√∂glichkeit, eine neue API in der Vertrags-API zu ver√∂ffentlichen.  Im selben Repository haben wir ein Verzeichnis gesch√§ftsspezifischer Entit√§ten definiert und vorgeschlagen, dass Vertragsentwickler diese wiederverwenden, anstatt diese Entit√§ten selbst zu beschreiben. <br><br>  So haben wir eine konzeptionell integrierte Plattform-API erhalten, die wie ein einziges Produkt aussah, obwohl sie tats√§chlich auf vielen Plattformkomponenten mit verschiedenen technologischen Stacks implementiert wurde. <br><br><h2>  Das Vorhandensein direkter Abh√§ngigkeiten zwischen Komponenten </h2><br>  Unser Problem manifestierte sich in der Tatsache, dass jede Plattformkomponente wissen musste, wer speziell die von ihr ben√∂tigten Funktionen bedient. <br><br>  Und es war nicht einmal die Schwierigkeit, dieses Verzeichnis auf dem neuesten Stand zu halten, sondern die Tatsache, dass direkte Abh√§ngigkeiten die Migration der Gesch√§ftsfunktionalit√§t von einer Plattformkomponente zu einer anderen erheblich erschwerten.  Das Problem war besonders akut, als wir mit der Zersetzung unserer Monolithen in kleinere Komponenten begannen.  Es stellte sich heraus, dass es keine triviale Verwaltungsaufgabe ist, den Kunden davon zu √ºberzeugen, die Arbeitsintegration aus gesch√§ftlicher Sicht durch eine Funktionalit√§t zu ersetzen, die aus technischer Sicht eine andere ist.  Der Kunde sieht darin einfach keinen Sinn, da f√ºr ihn alles gut funktioniert.  Infolgedessen wurden schlecht riechende Schichten der Abw√§rtskompatibilit√§t geschrieben, die die Unterst√ºtzung der Plattform nur erschwerten und sich negativ auf die Servicequalit√§t auswirkten.  Und da wir die Plattform-API bereits standardisieren wollten, musste dieses Problem gleichzeitig gel√∂st werden. <br><br>  Wir hatten die Wahl zwischen mehreren Optionen.  Von diesen haben wir besonders sorgf√§ltig √ºberlegt: <br><br><ul><li>  Implementierung von <i>Service Discovery-</i> Protokollen f√ºr jede der Komponenten. </li><li>  Verwenden eines Mediators zum Umleiten von Clientanforderungen an die richtige Plattformkomponente. </li><li>  Verwenden eines <i>Nachrichtenbrokers</i> als Nachrichtenbus. </li></ul><br>  Aufgrund einiger √úberlegungen und Experimente fiel die Wahl auf den Nachrichtenbroker, obwohl er uns als potenziellen Single Point of Failure ansah und den Aufwand f√ºr den Betrieb der Plattform erh√∂hte.  Eine wichtige Rolle bei der Auswahl spielte die Tatsache, dass die Plattform zu diesem Zeitpunkt bereits √ºber Erfahrung in der Arbeit mit RabbitMQ verf√ºgte.  Der Broker selbst skalierte gut und verf√ºgte √ºber integrierte Mechanismen zur Gew√§hrleistung der Fehlertoleranz.  Als Bonus hatten wir die M√∂glichkeit, eine <i>ereignisgesteuerte Architektur</i> ( <i>ereignisgesteuerte Architektur</i> oder <i>EDA</i> ) ‚Äûunter der Haube‚Äú zu implementieren.  Dies er√∂ffnete uns sp√§ter weitere M√∂glichkeiten der dienststellen√ºbergreifenden Interaktion im Vergleich zur Punkt-zu-Punkt-Interaktion. <br><br>  Topologisch begann sich die Plattform von einem Graphen mit zuf√§lliger Konnektivit√§t in einen Stern zu verwandeln.  Und Plattformkomponenten haben ihre Abh√§ngigkeiten umgekehrt und die M√∂glichkeit erhalten, ausschlie√ülich √ºber Vertr√§ge, die in einem zentralen Repository registriert sind, miteinander zu interagieren, ohne wissen zu m√ºssen, wer einen bestimmten Vertrag speziell implementiert.  Mit anderen Worten, alle Komponenten innerhalb der Plattform konnten √ºber einen einzigen Integrationspunkt miteinander interagieren, was das Leben der Entwickler erheblich vereinfachte. <br><br><h2>  Dokumentation auf dem neuesten Stand halten </h2><br>  Probleme, die mit dem Mangel an Dokumentation oder dem Verlust ihrer Relevanz verbunden sind, treten fast immer auf.  Und je h√∂her das Entwicklungstempo, desto h√§ufiger manifestiert es sich.  Im Nachhinein ist es eine schwierige Aufgabe, alle API-Spezifikationen an einem einzigen Ort und in einem einzigen Format f√ºr mehr als hundert Services in einem verteilten und multinationalen Team zu sammeln. <br><br>  Bei der Entwicklung der Vertrags-API haben wir uns zum Ziel gesetzt, auch dieses Problem zu l√∂sen.  Und wir haben es geschafft.  Ein streng definiertes Format f√ºr die Beschreibung des Vertrags erm√∂glichte es uns, einen Prozess zu erstellen, nach dem unmittelbar nach dem Erscheinen eines neuen Vertrags die automatische Zusammenstellung der Dokumentation gestartet wird.  Dies gibt uns die Gewissheit, dass unsere API-Dokumentation immer auf dem neuesten Stand ist.  Dieser Prozess ist vollst√§ndig automatisiert und erfordert keinen Entwicklungs- oder Verwaltungsaufwand. <br><br><h2>  Introspektion und Debugging von End-to-End-Funktionen </h2><br>  Als wir unsere Monolithen in kleinere Komponenten aufteilten, traten nat√ºrlich Schwierigkeiten beim Debuggen der End-to-End-Funktionalit√§t auf.  Wenn der Service einer Gesch√§ftsfunktion auf mehrere Plattformkomponenten verteilt war, musste h√§ufig nach Vertretern der einzelnen Komponenten gesucht werden, um das Problem zu lokalisieren und zu debuggen.  Was manchmal schwierig zu erreichen war, angesichts des Zeitunterschieds von 11 Stunden bei einigen unserer Kollegen. <br><br>  Mit dem Aufkommen der Vertrags-API und insbesondere dank des zugrunde liegenden Nachrichtenbrokers erhielten wir die M√∂glichkeit, Kopien von Nachrichten zu erhalten, die an der Ausf√ºhrung einer Gesch√§ftsfunktion beteiligt sind, ohne Nebenwirkungen auf die Interaktionsteilnehmer.  Dazu muss nicht einmal bekannt sein, welche der Komponenten der Plattform f√ºr die Bearbeitung eines bestimmten Vertrags verantwortlich sind.  Und nach der Lokalisierung des Problems k√∂nnen wir die Kennung der defekten Komponente aus den Metadaten der Problemmeldung abrufen. <br><br><h2>  Was haben wir noch zus√§tzlich zur Vertrags-API entwickelt? </h2><br>  Zus√§tzlich zu ihrem Hauptzweck und der L√∂sung der oben genannten Probleme erm√∂glichte uns die Vertrags-API die Implementierung einer Reihe n√ºtzlicher Dienste. <br><br><h3>  Gateway f√ºr den Zugriff auf Plattformfunktionen </h3><br>  Die Standardisierung der API in Form von Vertr√§gen erm√∂glichte es uns, einen einzigen Zugangspunkt zur Plattformfunktionalit√§t √ºber HTTP zu entwickeln.  Dar√ºber hinaus m√ºssen wir mit dem Aufkommen neuer Funktionen (Vertr√§ge) diesen Zugangspunkt in keiner Weise √§ndern.  Es ist vorw√§rtskompatibel mit allen zuk√ºnftigen Vertr√§gen.  Auf diese Weise k√∂nnen Sie mit der Plattform als einzelnes Produkt √ºber die √ºbliche HTTP-Schnittstelle arbeiten. <br><br><h3>  Mass Operations Service </h3><br>  Jeder Vertrag kann als Teil einer Massenoperation gestartet werden, wobei der Status verfolgt und anschlie√üend ein Bericht √ºber die Ergebnisse dieser Operation erhalten werden kann.  Dieser Service ist wie der vorherige mit allen zuk√ºnftigen Vertr√§gen im Voraus kompatibel. <br><br><h3>  Einheitliche Plattformfehlerbehandlung </h3><br>  Das Vertrags-API-Protokoll standardisiert auch Fehler.  Auf diese Weise konnten wir einen Fehlerabfangj√§ger implementieren, der deren Schweregrad analysiert und das √úberwachungssystem √ºber m√∂gliche Probleme bei Plattformkomponenten informiert.  Und in Zukunft kann er unabh√§ngig √ºber die Entdeckung eines Fehlers in der Plattformkomponente entscheiden.  Der Fehlerabfangj√§ger f√§ngt sie direkt vom Nachrichtenbroker ab und wei√ü nichts √ºber den Zweck eines Vertrags oder eines Fehlers, da er nur auf der Grundlage von Metainformationen handelt.  Dies erm√∂glicht es ihm sowie allen in diesem Abschnitt beschriebenen Dienstleistungen, mit allen zuk√ºnftigen Vertr√§gen vorw√§rtskompatibel zu sein. <br><br><h3>  Benutzeroberfl√§chen automatisch generieren </h3><br>  Streng formalisierte Vertr√§ge erm√∂glichen es Ihnen, automatisch Komponenten der Benutzeroberfl√§che zu erstellen.  Wir haben einen Service entwickelt, mit dem Sie eine Verwaltungsschnittstelle basierend auf einer Sammlung von Vertr√§gen erstellen und diese Schnittstelle dann in eines unserer Plattformtools einbetten k√∂nnen.  Somit k√∂nnen die Administratoren, die wir zuvor mit unseren H√§nden geschrieben haben, jetzt (wenn auch nur teilweise) im automatischen Modus generiert werden. <br><br><h3>  Plattformprotokollierung </h3><br>  Diese Komponente wurde noch nicht implementiert und befindet sich in der Entwicklung.  In Zukunft wird es jedoch m√∂glich sein, die Protokollierung aller Gesch√§ftsfunktionen auf der Plattform im laufenden Betrieb ein- und auszuschalten und diese Informationen direkt aus dem Nachrichtenbroker zu extrahieren, ohne dass Nebenwirkungen auftreten, die sich negativ auf die interagierenden Komponenten auswirken. <br><br><h2>  Der Hauptzweck der Vertrags-API </h2><br>  Der Hauptzweck der Vertrags-API besteht jedoch darin, die Kosten f√ºr die Integration von Plattformkomponenten zu senken. <br><br>  Entwickler werden von Bibliotheken, die wir f√ºr jeden unserer Technologie-Stacks entwickelt haben, von der Transportebene abstrahiert.  Dies gibt uns einen gewissen Handlungsspielraum f√ºr den Fall, dass wir den Nachrichtenbroker √§ndern oder sogar zur Punkt-zu-Punkt-Interaktion wechseln m√ºssen.  Die externe Schnittstelle der Bibliothek bleibt unver√§ndert. <br><br>  Die Bibliothek unter der Haube generiert eine Nachricht nach bestimmten Regeln und sendet sie an den Broker. Nach dem Warten auf eine Antwortnachricht gibt sie das Ergebnis an den Entwickler zur√ºck.  Drau√üen sieht es aus wie eine regul√§re synchrone (oder asynchrone, implementierungsabh√§ngige) Anforderung.  Als Demonstration werde ich einige Beispiele geben. <br><br>  Beispiel f√ºr einen Python-Vertragsaufruf <br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> platform_client <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Client client = Client(contracts_path=CONTRACTS_PATH, url=AMQP_URL, app_id=<span class="hljs-string"><span class="hljs-string">'client'</span></span>) client.call(<span class="hljs-string"><span class="hljs-string">"ban-management.create-ban.v1"</span></span>, { <span class="hljs-string"><span class="hljs-string">"wgid"</span></span>: <span class="hljs-number"><span class="hljs-number">1234567890</span></span>, <span class="hljs-string"><span class="hljs-string">"reason"</span></span>: <span class="hljs-string"><span class="hljs-string">"Fraudulent activity"</span></span>, <span class="hljs-string"><span class="hljs-string">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"ru.wot"</span></span>, <span class="hljs-string"><span class="hljs-string">"component"</span></span>: <span class="hljs-string"><span class="hljs-string">"game"</span></span>, <span class="hljs-string"><span class="hljs-string">"bantype"</span></span>: <span class="hljs-string"><span class="hljs-string">"access_denied"</span></span>, <span class="hljs-string"><span class="hljs-string">"author_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"v_nikonovich"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_at"</span></span>: <span class="hljs-string"><span class="hljs-string">"2038-01-19 03:14:07Z"</span></span> }) { <span class="hljs-string"><span class="hljs-string">u'ban_id'</span></span>: <span class="hljs-number"><span class="hljs-number">31415926</span></span>, <span class="hljs-string"><span class="hljs-string">u'wgid'</span></span>: <span class="hljs-number"><span class="hljs-number">1234567890</span></span>, <span class="hljs-string"><span class="hljs-string">u'title'</span></span>: <span class="hljs-string"><span class="hljs-string">u'ru.wot'</span></span>, <span class="hljs-string"><span class="hljs-string">u'component'</span></span>: <span class="hljs-string"><span class="hljs-string">u'game'</span></span>, <span class="hljs-string"><span class="hljs-string">u'reason'</span></span>: <span class="hljs-string"><span class="hljs-string">u'Fraudulent activity'</span></span>, <span class="hljs-string"><span class="hljs-string">u'bantype'</span></span>: <span class="hljs-string"><span class="hljs-string">u'access_denied'</span></span>, <span class="hljs-string"><span class="hljs-string">u'status'</span></span>: <span class="hljs-string"><span class="hljs-string">u"active"</span></span>, <span class="hljs-string"><span class="hljs-string">u'started_at'</span></span>: <span class="hljs-string"><span class="hljs-string">u"2019-02-15T15:15:15Z"</span></span>, <span class="hljs-string"><span class="hljs-string">u'expires_at'</span></span>: <span class="hljs-string"><span class="hljs-string">u"2038-01-19 03:14:07Z"</span></span> }</code> </pre> <br>  Der gleiche Vertragsanruf, aber mit Elixir <br><pre> <code class="plaintext hljs">:platform_client.call("ban-management.create-ban.v1", %{ "wgid" =&gt; 1234567890, "reason" =&gt; "Fraudulent activity", "title" =&gt; "ru.wot", "component" =&gt; "game", "bantype" =&gt; "access_denied", "author_id" =&gt; "v_nikonovich", "expires_at" =&gt; "2038-01-19 03:14:07Z" }) {:ok, %{ "ban_id" =&gt; 31415926, "wgid" =&gt; 1234567890, "title" =&gt; "ru.wot", "conponent" =&gt; "game", "reason" =&gt; "Fraudulent activity", "bantype" =&gt; "access_denied", "status" =&gt; "active", "started_at" =&gt; "2019-02-15T15:15:15Z", "expires_at" =&gt; "2038-01-19 03:14:07Z" }}</code> </pre><br>  Anstelle des Vertrags "ban-management.create-ban.v1" kann es auch andere Plattformfunktionen geben, zum Beispiel: "account-management.rename-account.v1" oder "notification-center.create-sms-notification.v1".  Und all dies wird durch diesen einzigen Integrationspunkt in die Plattform verf√ºgbar sein. <br><br>  Die √úbersicht ist unvollst√§ndig, wenn Sie die Vertrags-API aus Sicht des Serverentwicklers nicht demonstrieren.  Stellen Sie sich eine Situation vor, in der ein Entwickler einen Handler f√ºr denselben Vertrag von ban-management.create-ban.v1 implementieren muss. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> platform_server <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BlockingServer, handler <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomServer</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BlockingServer)</span></span></span><span class="hljs-class">:</span></span> @handler(<span class="hljs-string"><span class="hljs-string">'ban-management.create-ban.v1'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_create_ban</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, params, context)</span></span></span><span class="hljs-function">:</span></span> response = do_some_usefull_job(params) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response d = CustomServer(app_id=<span class="hljs-string"><span class="hljs-string">"server"</span></span>, amqp_url=AMQP_URL, contracts_path=CONTRACTS_PATH) d.serve()</code> </pre><br>  Dieser Code reicht aus, um einen bestimmten Vertrag zu erf√ºllen.  Die Serverbibliothek entpackt und √ºberpr√ºft die Anforderungsparameter auf Richtigkeit und ruft dann den Vertragshandler mit den zur Verarbeitung bereitgestellten Anforderungsparametern auf.  Somit ist der Serverentwickler durch eine Bibliothek gesch√ºtzt, die bei Empfang falscher Anforderungsparameter selbst einen Validierungsfehler an den Client sendet und die Tatsache eines Problems registriert. <br><br>  Aufgrund der Tatsache, dass die Vertrags-API unter der Haube auf der Grundlage von Ereignissen implementiert wird, haben wir die M√∂glichkeit, √ºber den Umfang des Anforderungs- / Antwortskripts hinauszugehen und ein breiteres Spektrum dienst√ºbergreifender Interaktionen zu implementieren. <br><br>  Zum Beispiel: <br><br><ul><li>  eine Anfrage stellen und vergessen (ohne auf eine Antwort zu warten) </li><li>  Anfragen an mehrere Vertr√§ge gleichzeitig stellen (auch ohne Verwendung einer Ereignisschleife) </li><li>  Stellen Sie eine Anfrage und erhalten Sie Antworten von mehreren Handlern gleichzeitig (sofern im Integrationsskript vorgesehen). </li><li>  Registrieren eines Antwort-Handlers (ausgel√∂st, wenn der Vertrags-Handler den Abschluss gemeldet hat, das Ergebnis der Arbeit des Vertrags-Handlers akzeptiert, dh seine Antwort) </li></ul><br>  Und dies ist keine vollst√§ndige Liste von Szenarien, die durch ein Ereignismodell der Interaktion ausgedr√ºckt werden k√∂nnen.  Dies ist eine Liste derjenigen, die wir derzeit verwenden. <br><br><h2>  Anstelle einer Schlussfolgerung </h2><br>  Wir verwenden die Vertrags-API seit mehreren Jahren.  Daher ist es nicht m√∂glich, im Rahmen eines √úbersichtsartikels √ºber alle Szenarien seiner Verwendung zu sprechen.  Aus dem gleichen Grund habe ich den Artikel nicht mit technischen Details √ºberladen.  Sie war schon ziemlich volumin√∂s.  Stellen Sie Fragen, und ich werde versuchen, sie direkt in den Kommentaren zu beantworten.  Wenn ein Thema besonders interessant ist, kann es in einem separaten Artikel ausf√ºhrlicher behandelt werden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de441708/">https://habr.com/ru/post/de441708/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de441698/index.html">Verbindung trennen: Was passiert, wenn Sie sich von Facebook abmelden?</a></li>
<li><a href="../de441700/index.html">Wie ein Kinderpuzzle hilft, die Geheimnisse des Magnetismus zu enth√ºllen</a></li>
<li><a href="../de441702/index.html">√úber die Speicherung personenbezogener Daten, Roskomnadzor und Dating-Sites</a></li>
<li><a href="../de441704/index.html">Warum sollten Sie nicht auf moralische Manifestationen von Robomobilen warten?</a></li>
<li><a href="../de441706/index.html">Ein Dutzend f√ºhrender Unternehmen versuchen, ein leistungsstarkes und kosteng√ºnstiges Lidar zu schaffen</a></li>
<li><a href="../de441710/index.html">Browser-Handyspiele fordern Sie heraus</a></li>
<li><a href="../de441712/index.html">Mathematische L√∂sung von Relativit√§tsproblemen</a></li>
<li><a href="../de441714/index.html">Wie waren die Dampflokomotiven angeordnet?</a></li>
<li><a href="../de441716/index.html">Programmierung f√ºr Nicht-Programmierer. Juni Biographie</a></li>
<li><a href="../de441718/index.html">Sicherheitswoche 09: 19 Jahre Sicherheitsl√ºcke in WinRAR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>