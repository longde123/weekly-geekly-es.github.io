<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘³ğŸ¿ ğŸ‘¨â€ğŸš’ ğŸ•¦ GHIDRAï¼ŒPlaystation 1å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒFLIRTç­¾åå’ŒPsyQ ğŸ¤˜ ğŸ‰ ğŸ…</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ 





æˆ‘ä¸äº†è§£æ‚¨ï¼Œä½†æˆ‘ä¸€ç›´æƒ³é€†è½¬æ—§çš„ä¸»æœºæ¸¸æˆï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªåç¼–è¯‘å™¨ã€‚ è€Œç°åœ¨ï¼Œæˆ‘ç”Ÿå‘½ä¸­è¿™ä¸ªå¿«ä¹çš„æ—¶åˆ»å·²ç»æ¥åˆ°-GHIDRAå·²ç»å‡ºæ¥ã€‚ æˆ‘ä¸ä¼šå†™è¿™æ˜¯ä»€ä¹ˆï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°ç”¨Googleæœç´¢ã€‚ è€Œä¸”ï¼Œè¯„è®ºæ˜¯å¦‚æ­¤ä¸åŒï¼ˆå°¤å…¶æ˜¯é€†è¡Œï¼‰ï¼Œä»¥è‡³äºæ–°äººç”šè‡³éƒ½éš¾ä»¥å†³å®šè¦åˆ›é€ è¿™ä¸ªå¥‡è¿¹â€¦â€¦è¿™æ˜¯ç»™ä½ çš„ä¸€ä¸ªä¾‹å­ï¼šâ€œ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GHIDRAï¼ŒPlaystation 1å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒFLIRTç­¾åå’ŒPsyQ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448098/"><p> å¤§å®¶å¥½ </p><br><p><img src="https://habrastorage.org/webt/er/4d/30/er4d30mv0sfltitbawtcyvprbsq.jpeg"></p><br><p>æˆ‘ä¸äº†è§£æ‚¨ï¼Œä½†æˆ‘ä¸€ç›´æƒ³é€†è½¬æ—§çš„ä¸»æœºæ¸¸æˆï¼Œå¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªåç¼–è¯‘å™¨ã€‚ è€Œç°åœ¨ï¼Œæˆ‘ç”Ÿå‘½ä¸­è¿™ä¸ªå¿«ä¹çš„æ—¶åˆ»å·²ç»æ¥åˆ°<strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-GHIDRAå·²ç»</a></strong>å‡ºæ¥ã€‚ æˆ‘ä¸ä¼šå†™è¿™æ˜¯ä»€ä¹ˆï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°ç”¨Googleæœç´¢ã€‚ è€Œä¸”ï¼Œè¯„è®ºæ˜¯å¦‚æ­¤ä¸åŒï¼ˆå°¤å…¶æ˜¯é€†è¡Œï¼‰ï¼Œä»¥è‡³äºæ–°äººç”šè‡³éƒ½éš¾ä»¥å†³å®šè¦åˆ›é€ è¿™ä¸ªå¥‡è¿¹â€¦â€¦è¿™æ˜¯ç»™ä½ çš„ä¸€ä¸ªä¾‹å­ï¼šâ€œ <em>æˆ‘ä¸ºåˆ›æ„å·¥ä½œäº†20å¹´ï¼Œç”±äºNSAï¼Œæˆ‘éå¸¸ä¸ä¿¡ä»»åœ°çœ‹ç€ä½ çš„ä¹å¤´è›‡ï¼Œä½†æ˜¯å½“â€¦â€¦æˆ‘å°†è¿è¡Œå®ƒå¹¶åœ¨å®è·µä¸­è¿›è¡Œæ£€æŸ¥</em> ã€‚â€œ <a name="habracut"></a></p><br><p> ç®€è€Œè¨€ä¹‹-è¿è¡ŒHydraå¹¶ä¸å¯æ€•ã€‚ å‘è¡Œåæˆ‘ä»¬å°†è·å¾—çš„æ”¶ç›Šå°†æ¶ˆé™¤æ‚¨å¯¹æ— å¤„ä¸åœ¨çš„NSAä¹¦ç­¾å’Œåé—¨çš„ææƒ§ã€‚ </p><br><p> æ‰€ä»¥ï¼Œæˆ‘åœ¨è¯´ä»€ä¹ˆ...æœ‰è¿™æ ·çš„å‰ç¼€ï¼š <em>Sony Playstation 1</em> ï¼ˆ <em>PS1</em> ï¼Œ <em>PSX</em> ï¼Œ <em>å†°å£¶</em> ï¼‰ã€‚ ä¸ºæ­¤åˆ›é€ äº†è®¸å¤šå¾ˆé…·çš„æ¸¸æˆï¼Œå‡ºç°äº†è®¸å¤šç‰¹è®¸ç»è¥æƒï¼Œè¿™äº›ç‰¹è®¸æƒä»ç„¶å¾ˆå—æ¬¢è¿ã€‚ æœ‰ä¸€å¤©ï¼Œæˆ‘æƒ³å¼„æ¸…æ¥šå®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼šæœ‰ä»€ä¹ˆæ•°æ®æ ¼å¼ï¼Œæ˜¯å¦ä½¿ç”¨äº†èµ„æºå‹ç¼©ï¼Œè¯·å°è¯•å°†æŸäº›å†…å®¹ç¿»è¯‘æˆä¿„è¯­ï¼ˆæˆ‘ä¼šé©¬ä¸Šè¯´æˆ‘è¿˜æ²¡æœ‰ç¿»è¯‘ä»»ä½•æ¸¸æˆï¼‰ã€‚ </p><br><p>æˆ‘é¦–å…ˆç¼–å†™äº†ä¸€ä¸ªå¾ˆé…·çš„å®ç”¨ç¨‹åºï¼Œç”¨äºä¸<code>Delphi</code>ä¸Šçš„ä¸€ä¸ªæœ‹å‹ä¸€èµ·ä½¿ç”¨<code>TIM</code>æ ¼å¼ï¼ˆç±»ä¼¼äºPlaystationä¸–ç•Œä¸­çš„<code>BMP</code> ï¼‰ï¼š <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Tim2View</a></strong> ã€‚ ä¸€æ¬¡äº«å—æˆåŠŸï¼ˆä¹Ÿè®¸ç°åœ¨äº«å—ï¼‰ã€‚ ç„¶åæˆ‘æƒ³æ›´æ·±å…¥åœ°è¿›è¡Œå‹ç¼©ã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/95a/82d/ad5/95a82dad5e8cf1770315215ac1cb138e.png" alt="å›¾ç‰‡"></p><br><p> ç„¶åé—®é¢˜å¼€å§‹äº†ã€‚ é‚£æ—¶æˆ‘è¿˜ä¸ç†Ÿæ‚‰<code>MIPS</code> ã€‚ å­¦ä¹ äº†ã€‚ æˆ‘ä¹Ÿä¸ç†Ÿæ‚‰<code>IDA Pro</code> ï¼ˆæˆ‘åæ¥åœ¨<code>Playstation</code>åœ¨<code>Sega Mega Drive</code>ä¸Šç©åå‘æ¸¸æˆï¼‰ã€‚ ä½†æ˜¯ï¼Œç”±äºæœ‰äº†Internetï¼Œæˆ‘å‘ç°<code>IDA Pro</code>æ”¯æŒä¸‹è½½å’Œåˆ†æ<code>PS1</code> ï¼š <strong>PS-X EXEå¯æ‰§è¡Œæ–‡ä»¶</strong> ã€‚ æˆ‘è¯•å›¾ä¸Šä¼ ä¸€ä¸ªæ¸¸æˆæ–‡ä»¶ï¼ˆä¼¼ä¹æ˜¯<strong>Lemmings</strong> ï¼‰ï¼Œå…¶åç§°å’Œæ‰©å±•åå¾ˆå¥‡æ€ªï¼Œä¾‹å¦‚Idaçš„<code>SLUS_123.45</code> ï¼Œæˆ‘å¾—åˆ°äº†ä¸€å †æ±‡ç¼–ä»£ç ï¼ˆå¹¸è¿çš„æ˜¯ï¼Œç”±äºWindows exeé©±åŠ¨ç¨‹åºæ”¯æŒï¼Œæˆ‘å·²ç»çŸ¥é“äº†å®ƒçš„å«ä¹‰ï¼‰ x86ï¼‰ï¼Œå¹¶å¼€å§‹äº†è§£ã€‚ </p><br><p><img src="https://habrastorage.org/webt/d8/d5/81/d8d581oddbuzq95aw7nyebedpzw.png"></p><br><p> ç¬¬ä¸€ä¸ªéš¾ä»¥ç†è§£çš„åœ°æ–¹æ˜¯ç»„è£…çº¿ã€‚ ä¾‹å¦‚ï¼Œæ‚¨çœ‹åˆ°å¯¹æŸä¸ªå‡½æ•°çš„è°ƒç”¨ï¼Œå¹¶ä¸”åœ¨è¯¥å‡½æ•°åŠ è½½åˆ°å¯„å­˜å™¨åï¼Œç«‹å³åº”ä½¿ç”¨è¯¥å‡½æ•°ä¸­çš„å‚æ•°ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œåœ¨æ‰§è¡Œä»»ä½•è·³è½¬å’Œå‡½æ•°è°ƒç”¨ä¹‹å‰ï¼Œé¦–å…ˆæ‰§è¡Œè·³è½¬/è°ƒç”¨ä¹‹åçš„æŒ‡ä»¤ï¼Œç„¶åæ‰æ‰§è¡Œè°ƒç”¨æˆ–è·³è½¬æœ¬èº«ã€‚ </p><br><p> åœ¨ç»å†äº†æ‰€æœ‰å›°éš¾ä¹‹åï¼Œæˆ‘è®¾æ³•ç¼–å†™äº†ä¸€äº›æ¸¸æˆèµ„æºçš„æ‰“åŒ…ç¨‹åº/æ‹†åŒ…ç¨‹åºã€‚ ä½†æ˜¯æˆ‘ä»æ¥æ²¡æœ‰çœŸæ­£å­¦ä¹ è¿‡ä»£ç ã€‚ æ€ä¹ˆäº† å¥½å§ï¼Œä¸€åˆ‡éƒ½æ˜¯å¹³åº¸çš„ï¼šæœ‰å¾ˆå¤šä»£ç ï¼Œå‡ ä¹æ— æ³•ç†è§£çš„BIOSå’ŒåŠŸèƒ½è®¿é—®æƒé™ï¼ˆå®ƒä»¬æ˜¯åº“ï¼Œé‚£æ—¶æˆ‘æ²¡æœ‰ç”¨äºå·æ›²çš„SDKï¼‰ï¼ŒåŒæ—¶ä½¿ç”¨ä¸‰ä¸ªå¯„å­˜å™¨çš„æŒ‡ä»¤ï¼Œç¼ºå°‘åç¼–è¯‘å™¨ã€‚ </p><br><p> å› æ­¤ï¼Œç»è¿‡å¾ˆå¤šå¹´ï¼Œ <code>GHIDRA</code>è¯ç”Ÿ<code>GHIDRA</code> ã€‚ åç¼–è¯‘å™¨æ”¯æŒçš„å¹³å°åŒ…æ‹¬<code>MIPS</code> ã€‚ å“¦ï¼Œå¿«ä¹ï¼ è®©æˆ‘ä»¬å°è¯•å°½å¿«åç¼–è¯‘ï¼ ä½†æ˜¯...æˆ‘åœ¨ç­‰ä¸€ä¸ªæ— èµ–ã€‚  Hydraä¸æ”¯æŒ<code>PS-X EXE</code> ã€‚ æ²¡é—®é¢˜ï¼Œæˆ‘ä»¬ä¼šè‡ªå·±å†™çš„ï¼ </p><br><h2 id="sobstvenno-kod"> å®é™…ä¸Šæ˜¯ä»£ç  </h2><br><p> è¶³å¤Ÿçš„æŠ’æƒ…ç¦»é¢˜ï¼Œè®©æˆ‘ä»¬ç¼–å†™ä»£ç ã€‚ å¦‚ä½•ä¸º<code>Ghidra</code>åˆ›å»ºè‡ªå·±çš„ä¸‹è½½<code>Ghidra</code> ï¼Œæˆ‘å·²ç»å¯¹æˆ‘<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¹‹å‰å†™</a>çš„å†…å®¹æœ‰æ‰€äº†è§£ã€‚ å› æ­¤ï¼Œä»…éœ€æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå·å‘é’³çš„<em>å†…å­˜æ˜ å°„ï¼Œ</em>å¯„å­˜å™¨çš„åœ°å€ï¼Œå°±å¯ä»¥æ”¶é›†å’ŒåŠ è½½äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ è¨€å½’æ­£ä¼ ã€‚ </p><br><p> ä»£ç å·²å‡†å¤‡å°±ç»ªï¼Œå·²æ·»åŠ å¹¶è¯†åˆ«äº†å¯„å­˜å™¨å’ŒåŒºåŸŸï¼Œä½†æ˜¯åœ¨è°ƒç”¨åº“å‡½æ•°å’ŒBIOSå‡½æ•°çš„åœ°æ–¹ä»ç„¶å­˜åœ¨å¾ˆå¤§ç©ºç™½ã€‚ è€Œä¸”ï¼Œä¸å¹¸çš„æ˜¯ï¼ŒHydraæ²¡æœ‰<code>FLIRT</code>æ”¯æŒã€‚ å¦‚æœæ²¡æœ‰ï¼Œè®©æˆ‘ä»¬æ·»åŠ ã€‚ </p><br><p>  <code>FLIRT</code>ç­¾åçš„æ ¼å¼æ˜¯å·²çŸ¥çš„ï¼Œå¹¶åœ¨<code>pat.txt</code>æ–‡ä»¶ä¸­è¿›è¡Œäº†æè¿°ï¼Œè¯¥æ–‡ä»¶å¯åœ¨Ida SDKä¸­æ‰¾åˆ°ã€‚  Idaè¿˜å…·æœ‰ä¸“é—¨ç”¨äºä»<code>Playstation</code>åº“æ–‡ä»¶åˆ›å»ºè¿™äº›ç­¾åçš„å®ç”¨ç¨‹åºï¼Œç§°ä¸º<code>ppsx</code> ã€‚ æˆ‘ä¸‹è½½äº†åä¸º<code>PsyQ Playstation Development Kit</code>çš„<code>PsyQ Playstation Development Kit</code> SDKï¼Œåœ¨å…¶ä¸­æ‰¾åˆ°äº†<code>lib</code>æ–‡ä»¶ï¼Œå¹¶å°è¯•ä»ä¸­åˆ›å»ºè‡³å°‘ä¸€äº›ç­¾å-æˆåŠŸã€‚ ç»“æœæ˜¯ä¸€äº›å°æ–‡æœ¬ï¼Œå…¶ä¸­æ¯ä¸€è¡Œéƒ½æœ‰ç‰¹å®šçš„æ ¼å¼ã€‚ ä»ç„¶éœ€è¦ç¼–å†™å°†è§£æè¿™äº›è¡Œå¹¶å°†å…¶åº”ç”¨äºä»£ç çš„ä»£ç ã€‚ </p><br><p><img src="https://habrastorage.org/webt/kw/0a/kc/kw0akcnlzbiwjctarj1h4axq8ri.png"></p><br><h3 id="patparser"> å¸•å¸•ç‘Ÿ </h3><br><p> ç”±äºæ¯ä¸€è¡Œéƒ½æœ‰ç‰¹å®šçš„æ ¼å¼ï¼Œå› æ­¤ç¼–å†™æ­£åˆ™è¡¨è¾¾å¼æ˜¯åˆä¹é€»è¾‘çš„ã€‚ åŸæ¥æ˜¯è¿™æ ·çš„ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Pattern linePat = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"^((?:[0-9A-F\\.]{2})+) ([0-9A-F]{2}) ([0-9A-F]{4}) ([0-9A-F]{4}) ((?:[:\\^][0-9A-F]{4}@? [\\.\\w]+ )+)((?:[0-9A-F\\.]{2})+)?$"</span></span>);</code> </pre> <br><p> å¥½å§ï¼Œä¸ºäº†çªå‡ºæ˜¾ç¤ºæ¨¡å—åç§»é‡ï¼Œç±»å‹å’Œå‡½æ•°åç§°ï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªå•ç‹¬çš„regexpï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Pattern modulePat = Pattern.compile(<span class="hljs-string"><span class="hljs-string">"([:\\^][0-9A-F]{4}@?) ([\\.\\w]+) "</span></span>);</code> </pre> <br><p> ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ†åˆ«æµè§ˆæ¯ä¸ªç­¾åçš„ç»„ä»¶ï¼š </p><br><ol><li> é¦–å…ˆæ˜¯åå…­è¿›åˆ¶å­—èŠ‚åºåˆ—ï¼ˆ <em>0-9A-F</em> ï¼‰ï¼Œå…¶ä¸­ä¸€äº›å­—èŠ‚å¯ä»¥æ˜¯ä»»æ„å­—èŠ‚ï¼ˆç‚¹å­—ç¬¦â€œã€‚â€ï¼‰ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå°†å­˜å‚¨æ­¤ç±»åºåˆ—çš„ç±»ã€‚ æˆ‘ç§°å®ƒä¸º<code>MaskedBytes</code> ï¼š </li></ol><br><div class="spoiler">  <b class="spoiler_title">MaskedBytes.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> pat; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MaskedBytes</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] bytes, masks; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] getBytes() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bytes; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] getMasks() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> masks; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLength</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bytes.length; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MaskedBytes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] masks)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bytes = bytes; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.masks = masks; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> MaskedBytes </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">extend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MaskedBytes src, MaskedBytes add)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> extend(src, add.getBytes(), add.getMasks()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> MaskedBytes </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">extend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MaskedBytes src, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] addBytes, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] addMasks)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> length = src.getBytes().length; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] tmpBytes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[length + addBytes.length]; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] tmpMasks = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[length + addMasks.length]; System.arraycopy(src.getBytes(), <span class="hljs-number"><span class="hljs-number">0</span></span>, tmpBytes, <span class="hljs-number"><span class="hljs-number">0</span></span>, length); System.arraycopy(addBytes, <span class="hljs-number"><span class="hljs-number">0</span></span>, tmpBytes, length, addBytes.length); System.arraycopy(src.getMasks(), <span class="hljs-number"><span class="hljs-number">0</span></span>, tmpMasks, <span class="hljs-number"><span class="hljs-number">0</span></span>, length); System.arraycopy(addMasks, <span class="hljs-number"><span class="hljs-number">0</span></span>, tmpMasks, length, addMasks.length); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MaskedBytes(tmpBytes, tmpMasks); } }</code> </pre> </div></div><br><ol><li> ä»å…¶è®¡ç®—<code>CRC16</code>çš„å—çš„é•¿åº¦ã€‚ </li><li>  <code>CRC16</code> ï¼Œä½¿ç”¨è‡ªå·±çš„å¤šé¡¹å¼ï¼ˆ <code>0x8408</code> ï¼‰ï¼š </li></ol><br><div class="spoiler">  <b class="spoiler_title">è®¡æ•°ç CRC16</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkCrc16</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> resCrc)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( bytes.length == <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> crc = <span class="hljs-number"><span class="hljs-number">0xFFFF</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bytes.length; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = bytes[i]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>; ++x) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((crc ^ a) &amp; <span class="hljs-number"><span class="hljs-number">1</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { crc = (crc &gt;&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) ^ <span class="hljs-number"><span class="hljs-number">0x8408</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { crc &gt;&gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>; } a &gt;&gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>; } } crc = ~crc; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = crc; crc = (crc &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) | ((x &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xFF</span></span>); crc &amp;= <span class="hljs-number"><span class="hljs-number">0xFFFF</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">short</span></span>)crc == resCrc; }</code> </pre> </div></div><br><ol><li>  â€œæ¨¡å—â€çš„æ€»é•¿åº¦ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚ </li><li> å…¨å±€åç§°åˆ—è¡¨ï¼ˆæˆ‘ä»¬éœ€è¦ä»€ä¹ˆï¼‰ã€‚ </li><li> å…¶ä»–åç§°çš„é“¾æ¥åˆ—è¡¨ï¼ˆä¹Ÿéœ€è¦ï¼‰ã€‚ </li><li> å°¾å­—èŠ‚ã€‚ </li></ol><br><p> æ¨¡å—ä¸­çš„æ¯ä¸ªåç§°éƒ½æœ‰ç‰¹å®šçš„ç±»å‹å’Œç›¸å¯¹äºå¼€å¤´çš„åç§»é‡ã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹å­—ç¬¦ä¹‹ä¸€æ¥è¡¨ç¤ºç±»å‹ï¼šï¼šï¼Œ^ï¼Œ@ï¼Œå…·ä½“å–å†³äºç±»å‹ï¼š </p><br><ul><li>  â€œ <strong>ï¼šNAME</strong> â€ï¼šå…¨å±€åç§°ã€‚ å‡ºäºè¿™æ ·çš„åå­—ï¼Œæˆ‘å¼€å§‹äº†ä¸€åˆ‡ã€‚ </li><li>  â€œ <strong>ï¼šNAME @</strong> â€ï¼šæœ¬åœ°åç§°/æ ‡ç­¾ã€‚ å®ƒå¯èƒ½æ²¡æœ‰æ˜¾ç¤ºï¼Œä½†è¯·æ³¨æ„ï¼› </li><li>  â€œ <strong>^ NAME</strong> â€ï¼šé“¾æ¥åˆ°åç§°ã€‚ </li></ul><br><p> ä¸€æ–¹é¢ï¼Œä¸€åˆ‡éƒ½å¾ˆç®€å•ï¼Œä½†æ˜¯é“¾æ¥å¾ˆå®¹æ˜“ä¸æ˜¯å¯¹å‡½æ•°çš„å¼•ç”¨ï¼ˆå› æ­¤ï¼Œè·³è½¬æ˜¯ç›¸å¯¹çš„ï¼‰ï¼Œè€Œæ˜¯å¯¹å…¨å±€å˜é‡çš„å¼•ç”¨ã€‚ æ‚¨è¯´çš„æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Ÿ å°±æ˜¯åœ¨PSXä¸­ï¼Œæ‚¨æ— æ³•é€šè¿‡ä¸€æ¡æŒ‡ä»¤å°†æ•´ä¸ª<code>DWORD</code>æ¨é€åˆ°å¯„å­˜å™¨ä¸­ã€‚ ä¸ºæ­¤ï¼Œè¯·ä»¥ä¸¤åŠçš„å½¢å¼ä¸‹è½½ã€‚ äº‹å®æ˜¯ï¼Œåœ¨<code>MIPS</code>æŒ‡ä»¤å¤§å°é™åˆ¶ä¸ºå››ä¸ªå­—èŠ‚ã€‚ è€Œä¸”ï¼Œçœ‹æ¥ï¼Œæ‚¨åªéœ€è¦é¦–å…ˆä»ä¸€æ¡æŒ‡ä»¤ä¸­å‡å»ä¸€åŠï¼Œç„¶ååæ±‡ç¼–ä¸‹ä¸€æ¡å³å¯ï¼Œç„¶åå†è·å¾—å¦ä¸€åŠã€‚ ä½†ä¸æ˜¯é‚£ä¹ˆç®€å•ã€‚ å¯ä»¥å°†æŒ‡ä»¤5çš„å‰åŠéƒ¨åˆ†åŠ è½½å›å»ï¼Œå¹¶ä¸”ä»…åœ¨åŠ è½½ååŠéƒ¨åˆ†åæ‰èƒ½ç»™å‡ºæ¨¡å—ä¸­çš„é“¾æ¥ã€‚ æˆ‘ä¸å¾—ä¸ç¼–å†™ä¸€ä¸ªå¤æ‚çš„è§£æå™¨ï¼ˆå¯èƒ½å¯ä»¥ä¿®æ”¹ï¼‰ã€‚ </p><br><p> ç»“æœï¼Œæˆ‘ä»¬ä¸ºä¸‰ç§ç±»å‹çš„åç§°åˆ›å»º<code>enum</code> ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">ModuleType.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> pat; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> ModuleType { GLOBAL_NAME, LOCAL_NAME, REF_NAME; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isGlobal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == GLOBAL_NAME; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isLocal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == LOCAL_NAME; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isReference</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == REF_NAME; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isGlobal()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Global"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isLocal()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Local"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Reference"</span></span>; } } }</code> </pre> </div></div><br><p> è®©æˆ‘ä»¬å†™ä¸€ä¸ªä»£ç ï¼Œå°†æ–‡æœ¬åå…­è¿›åˆ¶åºåˆ—å’Œç‚¹è½¬æ¢ä¸º<code>MaskedBytes</code>ç±»å‹ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">hexStringToMaskedBytesArrayï¼ˆï¼‰</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> MaskedBytes </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hexStringToMaskedBytesArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s)</span></span></span><span class="hljs-function"> </span></span>{ MaskedBytes res = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> len = s.length(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] bytes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[len / <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] masks = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[len / <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; len; i += <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c1 = s.charAt(i); <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c2 = s.charAt(i + <span class="hljs-number"><span class="hljs-number">1</span></span>); masks[i / <span class="hljs-number"><span class="hljs-number">2</span></span>] = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) ( (((c1 == <span class="hljs-string"><span class="hljs-string">'.'</span></span>) ? <span class="hljs-number"><span class="hljs-number">0x0</span></span> : <span class="hljs-number"><span class="hljs-number">0xF</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) | (((c2 == <span class="hljs-string"><span class="hljs-string">'.'</span></span>) ? <span class="hljs-number"><span class="hljs-number">0x0</span></span> : <span class="hljs-number"><span class="hljs-number">0xF</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) ); bytes[i / <span class="hljs-number"><span class="hljs-number">2</span></span>] = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) ( (((c1 == <span class="hljs-string"><span class="hljs-string">'.'</span></span>) ? <span class="hljs-number"><span class="hljs-number">0x0</span></span> : Character.digit(c1, <span class="hljs-number"><span class="hljs-number">16</span></span>)) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) | (((c2 == <span class="hljs-string"><span class="hljs-string">'.'</span></span>) ? <span class="hljs-number"><span class="hljs-number">0x0</span></span> : Character.digit(c2, <span class="hljs-number"><span class="hljs-number">16</span></span>)) &lt;&lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) ); } res = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MaskedBytes(bytes, masks); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; }</code> </pre> </div></div><br><p> æ‚¨å·²ç»å¯ä»¥æƒ³åˆ°ä¸€ä¸ªç±»ï¼Œè¯¥ç±»å°†å­˜å‚¨æœ‰å…³æ¯ä¸ªå•ç‹¬å‡½æ•°çš„ä¿¡æ¯ï¼šå‡½æ•°åç§°ï¼Œæ¨¡å—ä¸­çš„åç§»é‡ä»¥åŠç±»å‹ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">ModuleData.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> pat; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModuleData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> offset; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ModuleType type; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ModuleData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset, String name, ModuleType type)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.offset = offset; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.type = type; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOffset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> offset; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> ModuleType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> type; } }</code> </pre> </div></div><br><p> æœ€åï¼Œä¸€ä¸ªç±»ï¼Œå®ƒå°†å­˜å‚¨<code>pat</code>æ–‡ä»¶æ¯ä¸€è¡Œä¸ŠæŒ‡ç¤ºçš„æ‰€æœ‰å†…å®¹ï¼Œå³ï¼šbytesï¼Œcrcï¼Œå¸¦æœ‰åç§»é‡çš„åç§°åˆ—è¡¨ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">SignatureData.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> pat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Arrays; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignatureData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> MaskedBytes templateBytes, tailBytes; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MaskedBytes fullBytes; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> crc16Length; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> crc16; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> moduleLength; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> List&lt;ModuleData&gt; modules; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SignatureData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MaskedBytes templateBytes, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> crc16Length, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> crc16, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> moduleLength, List&lt;ModuleData&gt; modules, MaskedBytes tailBytes)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.templateBytes = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fullBytes = templateBytes; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.crc16Length = crc16Length; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.crc16 = crc16; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.moduleLength = moduleLength; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.modules = modules; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tailBytes = tailBytes; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tailBytes != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> addLength = moduleLength - templateBytes.getLength() - tailBytes.getLength(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] addBytes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[addLength]; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] addMasks = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[addLength]; Arrays.fill(addBytes, (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0x00</span></span>); Arrays.fill(addMasks, (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)<span class="hljs-number"><span class="hljs-number">0x00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fullBytes = MaskedBytes.extend(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.templateBytes, addBytes, addMasks); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fullBytes = MaskedBytes.extend(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fullBytes, tailBytes); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MaskedBytes </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemplateBytes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> templateBytes; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MaskedBytes </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTailBytes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tailBytes; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MaskedBytes </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFullBytes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fullBytes; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCrc16Length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> crc16Length; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">short</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCrc16</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> crc16; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getModuleLength</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> moduleLength; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;ModuleData&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getModules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> modules; } }</code> </pre> </div></div><br><p> ç°åœ¨æœ€ä¸»è¦çš„æ˜¯ï¼šæˆ‘ä»¬ç¼–å†™ä»£ç æ¥åˆ›å»ºæ‰€æœ‰è¿™äº›ç±»ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">è§£æpatæ–‡ä»¶çš„ä¸€è¡Œ</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> List&lt;ModuleData&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseModuleData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s)</span></span></span><span class="hljs-function"> </span></span>{ List&lt;ModuleData&gt; res = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;ModuleData&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { Matcher m = modulePat.matcher(s); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (m.find()) { String __offset = m.group(<span class="hljs-number"><span class="hljs-number">1</span></span>); ModuleType type = __offset.startsWith(<span class="hljs-string"><span class="hljs-string">":"</span></span>) ? ModuleType.GLOBAL_NAME : ModuleType.REF_NAME; type = (type == ModuleType.GLOBAL_NAME &amp;&amp; __offset.endsWith(<span class="hljs-string"><span class="hljs-string">"@"</span></span>)) ? ModuleType.LOCAL_NAME : type; String _offset = __offset.replaceAll(<span class="hljs-string"><span class="hljs-string">"[:^@]"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> offset = Integer.parseInt(_offset, <span class="hljs-number"><span class="hljs-number">16</span></span>); String name = m.group(<span class="hljs-number"><span class="hljs-number">2</span></span>); res.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ModuleData(offset, name, type)); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">è§£ææ‰€æœ‰æ‹æ‹æ–‡ä»¶è¡Œ</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;String&gt; lines)</span></span></span><span class="hljs-function"> </span></span>{ modulesCount = <span class="hljs-number"><span class="hljs-number">0L</span></span>; signatures = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;SignatureData&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> linesCount = lines.size(); monitor.initialize(linesCount); monitor.setMessage(<span class="hljs-string"><span class="hljs-string">"Reading signatures..."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; linesCount; ++i) { String line = lines.get(i); Matcher m = linePat.matcher(line); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m.matches()) { MaskedBytes pp = hexStringToMaskedBytesArray(m.group(<span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ll = Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">16</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> ssss = (<span class="hljs-keyword"><span class="hljs-keyword">short</span></span>)Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-number"><span class="hljs-number">16</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> llll = Integer.parseInt(m.group(<span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-number"><span class="hljs-number">16</span></span>); List&lt;ModuleData&gt; modules = parseModuleData(m.group(<span class="hljs-number"><span class="hljs-number">5</span></span>)); MaskedBytes tail = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m.group(<span class="hljs-number"><span class="hljs-number">6</span></span>) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { tail = hexStringToMaskedBytesArray(m.group(<span class="hljs-number"><span class="hljs-number">6</span></span>)); } signatures.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SignatureData(pp, ll, ssss, llll, modules, tail)); modulesCount += modules.size(); } monitor.incrementProgress(<span class="hljs-number"><span class="hljs-number">1</span></span>); } }</code> </pre> </div></div><br><p> ç”¨äºåˆ›å»ºè¯†åˆ«ç­¾åä¹‹ä¸€çš„å‡½æ•°çš„ä»£ç ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">åŠŸèƒ½åˆ›é€ </b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disasmInstruction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Program program, Address address)</span></span></span><span class="hljs-function"> </span></span>{ DisassembleCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DisassembleCommand(address, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); cmd.applyTo(program, TaskMonitor.DUMMY); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setFunction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Program program, FlatProgramAPI fpa, Address address, String name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isFunction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isEntryPoint, MessageLog log)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fpa.getInstructionAt(address) == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) disasmInstruction(program, address); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isFunction) { fpa.createFunction(address, name); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isEntryPoint) { fpa.addEntryPoint(address); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isFunction &amp;&amp; program.getSymbolTable().hasSymbol(address)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } program.getSymbolTable().createLabel(address, name, SourceType.IMPORTED); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InvalidInputException e) { log.appendException(e); } }</code> </pre> </div></div><br><p> å¦‚å‰æ‰€è¿°ï¼Œæœ€å›°éš¾çš„åœ°æ–¹æ˜¯è®¡ç®—åˆ°å¦ä¸€ä¸ªåç§°/å˜é‡çš„é“¾æ¥ï¼ˆä¹Ÿè®¸ä»£ç éœ€è¦æ”¹è¿›ï¼‰ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">é“¾æ¥æ•°</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setInstrRefName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Program program, FlatProgramAPI fpa, PseudoDisassembler ps, Address address, String name, MessageLog log)</span></span></span><span class="hljs-function"> </span></span>{ ReferenceManager refsMgr = program.getReferenceManager(); Reference[] refs = refsMgr.getReferencesFrom(address); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (refs.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { disasmInstruction(program, address); refs = refsMgr.getReferencesFrom(address); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (refs.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { refs = refsMgr.getReferencesFrom(address.add(<span class="hljs-number"><span class="hljs-number">4</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (refs.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { refs = refsMgr.getFlowReferencesFrom(address.add(<span class="hljs-number"><span class="hljs-number">4</span></span>)); Instruction instr = program.getListing().getInstructionAt(address.add(<span class="hljs-number"><span class="hljs-number">4</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instr == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { disasmInstruction(program, address.add(<span class="hljs-number"><span class="hljs-number">4</span></span>)); instr = program.getListing().getInstructionAt(address.add(<span class="hljs-number"><span class="hljs-number">4</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instr == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } FlowType flowType = instr.getFlowType(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (refs.length == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; !(flowType.isJump() || flowType.isCall() || flowType.isTerminal())) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } refs = refsMgr.getReferencesFrom(address.add(<span class="hljs-number"><span class="hljs-number">8</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (refs.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { program.getSymbolTable().createLabel(refs[<span class="hljs-number"><span class="hljs-number">0</span></span>].getToAddress(), name, SourceType.IMPORTED); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InvalidInputException e) { log.appendException(e); } }</code> </pre> </div></div><br><p> å¹¶ä¸”ï¼Œæœ€åçš„ä¿®é¥°-åº”ç”¨ç­¾åï¼š </p><br><div class="spoiler">  <b class="spoiler_title">applySignaturesï¼ˆï¼‰</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">applySignatures</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ByteProvider provider, Program program, Address imageBase, Address startAddr, Address endAddr, MessageLog log)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ BinaryReader reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryReader(provider, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); PseudoDisassembler ps = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PseudoDisassembler(program); FlatProgramAPI fpa = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FlatProgramAPI(program); monitor.initialize(getAllModulesCount()); monitor.setMessage(<span class="hljs-string"><span class="hljs-string">"Applying signatures..."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (SignatureData sig : signatures) { MaskedBytes fullBytes = sig.getFullBytes(); MaskedBytes tmpl = sig.getTemplateBytes(); Address addr = program.getMemory().findBytes(startAddr, endAddr, fullBytes.getBytes(), fullBytes.getMasks(), <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, TaskMonitor.DUMMY); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (addr == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { monitor.incrementProgress(sig.getModules().size()); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } addr = addr.subtract(imageBase.getOffset()); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] nextBytes = reader.readByteArray(addr.getOffset() + tmpl.getLength(), sig.getCrc16Length()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!PatParser.checkCrc16(nextBytes, sig.getCrc16())) { monitor.incrementProgress(sig.getModules().size()); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } addr = addr.add(imageBase.getOffset()); List&lt;ModuleData&gt; modules = sig.getModules(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (ModuleData data : modules) { Address _addr = addr.add(data.getOffset()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data.getType().isGlobal()) { setFunction(program, fpa, _addr, data.getName(), data.getType().isGlobal(), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, log); } monitor.setMessage(String.format(<span class="hljs-string"><span class="hljs-string">"%s function %s at 0x%08X"</span></span>, data.getType(), data.getName(), _addr.getOffset())); monitor.incrementProgress(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (ModuleData data : modules) { Address _addr = addr.add(data.getOffset()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data.getType().isReference()) { setInstrRefName(program, fpa, ps, _addr, data.getName(), log); } monitor.setMessage(String.format(<span class="hljs-string"><span class="hljs-string">"%s function %s at 0x%08X"</span></span>, data.getType(), data.getName(), _addr.getOffset())); monitor.incrementProgress(<span class="hljs-number"><span class="hljs-number">1</span></span>); } } }</code> </pre> </div></div><br><p> åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥è®¨è®ºä¸€ä¸ªæœ‰è¶£çš„åŠŸèƒ½ï¼š <code>findBytes()</code> ã€‚ ä½¿ç”¨å®ƒï¼Œæ‚¨å¯ä»¥æœç´¢ç‰¹å®šçš„å­—èŠ‚åºåˆ—ï¼Œå¹¶ä¸ºæ¯ä¸ªå­—èŠ‚æŒ‡å®šä½æ©ç ã€‚ è¯¥æ–¹æ³•çš„è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š </p><br><pre> <code class="java hljs">Address addr = program.getMemory().findBytes(startAddr, endAddr, bytes, masks, forward, TaskMonitor.DUMMY);</code> </pre> <br><p> ç»“æœï¼Œè¿”å›ä»å…¶å¼€å§‹å­—èŠ‚çš„åœ°å€ï¼Œæˆ–è€…è¿”å›<code>null</code> ã€‚ </p><br><h2 id="pishem-analizator"> ç¼–å†™åˆ†æå™¨ </h2><br><p> è®©æˆ‘ä»¬åšçš„æ¼‚äº®ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³ä½¿ç”¨ç­¾åï¼Œè¯·è®©ç”¨æˆ·é€‰æ‹©æ­¤æ­¥éª¤ã€‚ ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦ç¼–å†™è‡ªå·±çš„ä»£ç åˆ†æå™¨ï¼ˆæ‚¨å¯ä»¥åœ¨æ­¤åˆ—è¡¨ä¸­çœ‹åˆ°å®ƒä»¬-å°±æ˜¯è¿™äº›ï¼Œæ˜¯çš„ï¼‰ï¼š </p><br><p><img src="https://habrastorage.org/webt/1o/wv/je/1owvjea6nuytmkwksxrhy9anyak.png"></p><br><p> å› æ­¤ï¼Œè¦è¿›å…¥æ­¤åˆ—è¡¨ï¼Œæ‚¨å°†éœ€è¦ç»§æ‰¿<code>AbstractAnalyzer</code>ç±»å¹¶é‡å†™ä¸€äº›æ–¹æ³•ï¼š </p><br><ol><li> æ„é€ å‡½æ•°ã€‚ å®ƒå°†å¿…é¡»ä½¿ç”¨åç§°ï¼Œåˆ†æå™¨çš„æè¿°åŠå…¶ç±»å‹æ¥è°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°ï¼ˆç¨åå°†å¯¹æ­¤è¿›è¡Œè¯¦ç»†ä»‹ç»ï¼‰ã€‚ åœ¨æˆ‘çœ‹æ¥æ˜¯è¿™æ ·çš„ï¼š </li></ol><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PsxAnalyzer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(<span class="hljs-string"><span class="hljs-string">"PSYQ Signatures"</span></span>, <span class="hljs-string"><span class="hljs-string">"PSX signatures applier"</span></span>, AnalyzerType.INSTRUCTION_ANALYZER); }</code> </pre> <br><ol><li>  <code>getDefaultEnablement()</code> ã€‚ ç¡®å®šæˆ‘ä»¬çš„åˆ†æä»ªæ˜¯å¦å§‹ç»ˆå¯ç”¨ï¼Œæˆ–è€…ä»…åœ¨æ»¡è¶³æŸäº›æ¡ä»¶ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨æˆ‘ä»¬çš„è£…è½½æœºï¼‰æ—¶æ‰å¯ç”¨ã€‚ </li><li>  <code>canAnalyze()</code> ã€‚ æ˜¯å¦å¯ä»¥åœ¨å¯ä¸‹è½½çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸Šä½¿ç”¨æ­¤åˆ†æä»ªï¼Ÿ <br> åŸåˆ™ä¸Šï¼Œç¬¬2å’Œç¬¬3æ¬¾å¯ä»¥é€šè¿‡ä¸€ä¸ªåŠŸèƒ½æ¥éªŒè¯ï¼š </li></ol><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPsxLoader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Program program)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> program.getExecutableFormat().equalsIgnoreCase(PsxLoader.PSX_LOADER); }</code> </pre> <br><p>  <code>PsxLoader.PSX_LOADER</code>åœ¨å…¶ä¸­å­˜å‚¨å¼•å¯¼åŠ è½½ç¨‹åºçš„åç§°ï¼Œå¹¶åœ¨å…¶ä¸­è¿›è¡Œäº†å®šä¹‰ã€‚ </p><br><p> æ€»è®¡ï¼Œæˆ‘ä»¬æœ‰ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefaultEnablement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Program program)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isPsxLoader(program); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canAnalyze</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Program program)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isPsxLoader(program); }</code> </pre> <br><ol><li>  <code>registerOptions()</code> ã€‚ å®Œå…¨æ²¡æœ‰å¿…è¦é‡æ–°å®šä¹‰æ­¤æ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦å‘ç”¨æˆ·è¯¢é—®ä¸€äº›ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œåˆ†æä¹‹å‰patæ–‡ä»¶çš„è·¯å¾„ï¼‰ï¼Œåˆ™æœ€å¥½åœ¨æ­¤æ–¹æ³•ä¸­æ‰§è¡Œæ­¤æ“ä½œã€‚ æˆ‘ä»¬å¾—åˆ°ï¼š </li></ol><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String OPTION_NAME = <span class="hljs-string"><span class="hljs-string">"PSYQ PAT-File Path"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> File file = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerOptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Options options, Program program)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { file = Application.getModuleDataFile(<span class="hljs-string"><span class="hljs-string">"psyq4_7.pat"</span></span>).getFile(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileNotFoundException e) { } options.registerOption(OPTION_NAME, OptionType.FILE_TYPE, file, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">"PAT-File (FLAIR) created from PSYQ library files"</span></span>); }</code> </pre> <br><p> è¿™é‡Œæœ‰å¿…è¦æ¾„æ¸…ã€‚  <code>Application</code>ç±»çš„é™æ€æ–¹æ³•<code>getModuleDataFile()</code>è¿”å›<code>data</code>ç›®å½•ä¸­æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ï¼Œè¯¥ç›®å½•ä½äºæˆ‘ä»¬æ¨¡å—çš„æ ‘ä¸­ï¼Œå¹¶ä¸”å¯ä»¥å­˜å‚¨ä»¥åè¦å¼•ç”¨çš„æ‰€æœ‰å¿…éœ€æ–‡ä»¶ã€‚ </p><br><p> å¥½äº†ï¼Œ <code>registerOption()</code>æ–¹æ³•<code>registerOption()</code>ä¸€ä¸ªé€‰é¡¹ï¼Œè¯¥é€‰é¡¹å…·æœ‰åœ¨<code>OPTION_NAME</code>æŒ‡å®šçš„åç§°ï¼Œç±»å‹<code>File</code> ï¼ˆå³ï¼Œç”¨æˆ·å°†èƒ½å¤Ÿé€šè¿‡å¸¸è§„å¯¹è¯æ¡†é€‰æ‹©æ–‡ä»¶ï¼‰ï¼Œé»˜è®¤å€¼å’Œæè¿°ã€‚ </p><br><p> ä¸‹ä¸€ä¸ª å› ä¸º æˆ‘ä»¬ä»¥åé€šå¸¸æ²¡æœ‰æœºä¼šå‚è€ƒå·²æ³¨å†Œçš„é€‰é¡¹ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°å®šä¹‰<code>optionsChanged()</code>æ–¹æ³•ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optionsChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Options options, Program program)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.optionsChanged(options, program); file = options.getFile(OPTION_NAME, file); }</code> </pre> <br><p> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä»…æ ¹æ®æ–°å€¼æ›´æ–°å…¨å±€å˜é‡ã€‚ </p><br><p>  <code>added()</code>æ–¹æ³•ã€‚ ç°åœ¨æœ€ä¸»è¦çš„æ˜¯ï¼šåˆ†æå™¨å¯åŠ¨æ—¶å°†è°ƒç”¨çš„æ–¹æ³•ã€‚ åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬å°†æ”¶åˆ°å¯ç”¨äºåˆ†æçš„åœ°å€åˆ—è¡¨ï¼Œä½†æˆ‘ä»¬åªéœ€è¦åŒ…å«ä»£ç çš„åœ°å€å³å¯ã€‚ å› æ­¤ï¼Œæ‚¨éœ€è¦è¿‡æ»¤ã€‚ æœ€ç»ˆä»£ç ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">å¢åŠ ï¼ˆï¼‰æ–¹æ³•</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">added</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Program program, AddressSetView set, TaskMonitor monitor, MessageLog log)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> CancelledException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } Memory memory = program.getMemory(); AddressRangeIterator it = memory.getLoadedAndInitializedAddressSet().getAddressRanges(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!monitor.isCancelled() &amp;&amp; it.hasNext()) { AddressRange range = it.next(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { MemoryBlock block = program.getMemory().getBlock(range.getMinAddress()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (block.isInitialized() &amp;&amp; block.isExecute() &amp;&amp; block.isLoaded()) { PatParser pat = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PatParser(file, monitor); RandomAccessByteProvider provider = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RandomAccessByteProvider(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(program.getExecutablePath())); pat.applySignatures(provider, program, block.getStart(), block.getStart(), block.getEnd(), log); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { log.appendException(e); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre> </div></div><br><p> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æµè§ˆäº†å¯æ‰§è¡Œåœ°å€çš„åˆ—è¡¨ï¼Œå¹¶å°è¯•åœ¨å…¶ä¸­åº”ç”¨ç­¾åã€‚ </p><br><p><img src="https://habrastorage.org/webt/-b/ro/8_/-bro8_sgvplezfb3qhiu5dfjyzm.png"></p><br><h2 id="vyvody-i-finalochka"> ç»“è®ºä¸ç»“å±€ </h2><br><p> åƒä¸€åˆ‡ã€‚ å®é™…ä¸Šï¼Œè¿™é‡Œæ²¡æœ‰ä»€ä¹ˆè¶…çº§å¤æ‚çš„ã€‚ æœ‰ä¾‹å­ï¼Œç¤¾åŒºæ˜¯æ´»è·ƒçš„ï¼Œæ‚¨å¯ä»¥æ”¾å¿ƒåœ°è¯¢é—®ç¼–å†™ä»£ç æ—¶ä¸æ¸…æ¥šçš„åœ°æ–¹ã€‚ åº•çº¿ï¼šé€‚ç”¨äº<code>Playstation 1</code>å¯æ‰§è¡Œæ–‡ä»¶çš„å¼•å¯¼åŠ è½½ç¨‹åºå’Œåˆ†æå™¨ã€‚ </p><br><p><img src="https://habrastorage.org/webt/c_/uw/ej/c_uwejjyu5edynkxyzlr6wboezw.png"></p><br><p> æ‰€æœ‰æºä»£ç éƒ½åœ¨è¿™é‡Œå¯ç”¨ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ghidra_psx_ldr</a> <br> åœ¨è¿™é‡Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‘å¸ƒ</a> ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‘å¸ƒ</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN448098/">https://habr.com/ru/post/zh-CN448098/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN448084/index.html">é»‘æ´çš„ç…§ç‰‡-ä¼šæœ‰ç”¨å—ï¼Ÿ</a></li>
<li><a href="../zh-CN448088/index.html">åœ¨ä¿„ç½—æ–¯ç”Ÿäº§ç­‰ç¦»å­å‘åŠ¨æœº</a></li>
<li><a href="../zh-CN448090/index.html">å‰ç«¯æ¯å‘¨æ‘˜è¦ï¼ˆ2019å¹´4æœˆ8æ—¥è‡³14æ—¥ï¼‰</a></li>
<li><a href="../zh-CN448094/index.html">Dockerï¼šå¦‚ä½•éƒ¨ç½²å…¨æ ˆåº”ç”¨ç¨‹åºä¸”ä¸ç°æ˜¾</a></li>
<li><a href="../zh-CN448096/index.html">æœ±è‰å¨…åœ¨ä¹³èƒ¶</a></li>
<li><a href="../zh-CN448100/index.html">ä¸Šå‘¨ç¬¬360æœŸï¼ˆ2019å¹´4æœˆ7æ—¥è‡³14æ—¥ï¼‰ä»å‰ç«¯ä¸–ç•Œä¸­æ‘˜å½•çš„æ–°é²œææ–™</a></li>
<li><a href="../zh-CN448102/index.html">ä¸€æ— æ‰€æœ‰çš„æ¢¦æƒ³å›¢é˜Ÿï¼šè˜è¯·ITä¸“ä¸šäººå‘˜</a></li>
<li><a href="../zh-CN448106/index.html">åŸ¹è®­å¼€å‘äººå‘˜1C-Bitrixï¼šåˆ†äº«æˆ‘ä»¬å¯¹äººå‘˜â€œå¢é•¿â€çš„æ–¹æ³•</a></li>
<li><a href="../zh-CN448108/index.html">å¦‚ä½•åœ¨15åˆ†é’Ÿå†…è®¾ç½®è‡ªå·±çš„VPNæœåŠ¡å™¨</a></li>
<li><a href="../zh-CN448110/index.html">ä¿¡æ¯å®‰å…¨ç¡¬ä»¶è§£å†³æ–¹æ¡ˆUSB over IP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>