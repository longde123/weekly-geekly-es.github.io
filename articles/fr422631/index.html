<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåØ üìü üë©üèª‚Äçüöí Terminaux QIWI. Comment tirer le meilleur parti des technologies simples ü§∑üèª üëºüèø üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="D√©but 2017, nous, l'√©quipe de d√©veloppement logiciel de QIWI Terminals, avons recueilli les souhaits des d√©partements de l'entreprise - nous avons app...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Terminaux QIWI. Comment tirer le meilleur parti des technologies simples</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/qiwi/blog/422631/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/e5/yt/wg/e5ytwgymlworvy2udox4piky1pw.png" align="left" width="200"></a>  D√©but 2017, nous, l'√©quipe de d√©veloppement logiciel de QIWI Terminals, avons recueilli les souhaits des d√©partements de l'entreprise - nous avons appris quelles t√¢ches globales nos coll√®gues aimeraient r√©soudre avec notre aide, afin que la vie devienne plus facile. <br><br>  J'ai √©t√© tr√®s satisfait de la demande du service client qui travaille avec les appels et les r√©clamations des payeurs: <br><br>  <i>¬´Il y a un probl√®me: le client effectue un paiement au terminal, mais il ne parvient toujours pas au traitement - soit le terminal pourrait se bloquer, soit Internet fonctionnant via le modem gsm est tomb√©.</i>  <i>Et il s'av√®re que le client a un ch√®que, mais il n'y a pas de paiement dans le syst√®me.</i>  <i>Ce serait bien dans de tels cas d'apprendre √† effectuer des paiements √† QIWI.</i> <i><br><br></i>  <i>Il y a aussi un groupe de clients inquiets qui, imm√©diatement apr√®s avoir effectu√© un paiement, composent un num√©ro de centre d'appels pour s'assurer que tout va bien avec lui.</i>  <i>Ce serait formidable de couper les os pour de tels appels. ¬ª</i> <br><br>  Nous avions donc une t√¢che complexe: apprendre √† cr√©er un paiement en cas d'√©chec de communication avec le terminal et r√©duire le nombre d'appels entrants des clients en inventant un outil en libre service pour v√©rifier l'√©tat du paiement.  L'affaire est claire.  Ils ont commenc√© √† chercher une solution qui soit pratique pour le client et sans risques pour la s√©curit√©. <br><a name="habracut"></a><br>  Le client, selon la tradition, a offert son option - d'imprimer sur le re√ßu une s√©quence de caract√®res que le payeur pourrait dire √† l'op√©rateur, et lui, √† son tour, pour comprendre s'il s'agit de notre paiement ou non, filtrer la fraude ou effectuer l'op√©ration manuellement. <br><br>  Le concept de l'id√©e √©tait clair, mais irr√©alisable, nous sommes donc all√©s un peu plus loin: nous avons d√©cid√© d'incorporer les donn√©es de paiement dans le code QR, de les imprimer sur le re√ßu et de dupliquer le terminal QIWI √† l'√©cran pour plus de pr√©cision.  En scannant le code QR avec la cam√©ra de son appareil, le client peut conna√Ætre l'√©tat de l'op√©ration.  Et en cas de non-paiement dans QIWI, le syst√®me le cr√©e automatiquement.  Ainsi, le client d√©couvre non seulement si l'argent est arriv√©, mais le conduit √©galement de mani√®re ind√©pendante, quel que soit l'√©tat du terminal. <br><br>  √Ä premi√®re vue, la solution √©tait √©vidente: prendre une demande existante avec paiement, l'envelopper dans un code QR, √©crire une page Web avec des informations sur les transactions et un microservice mandatant les demandes entre le terminal, le traitement et le Web.  Il a √©t√© suppos√© que le projet fonctionnera sur les m√©thodes existantes d'authentification des terminaux et utilisera les m√©thodes de paiement existantes dans le traitement. <br><br>  L'id√©e est venue tout de suite, r√©v√©lant le potentiel cr√©atif de l'√©quipe.  Nous avons commenc√© √† jaillir et √† lancer des options suppl√©mentaires jusqu'√† placer un logo, un slogan et m√™me de la publicit√© dans un code QR en plus des donn√©es de paiement: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/5p/vy/dl/5pvydljqfmwsttqvkleyotnskfw.png" width="400" height="400" alt="image"></div><br>  Un projet pour quelques sprints, pas plus.  √áa y √©tait. <br><br><h3>  Premi√®re frustration </h3><br>  Nous avons pris un paiement existant et y avons form√© un code QR: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yv/ti/pk/yvtipk6l6qkycshzycbfz8eyfu8.gif" alt="image" width="400" height="400"></div><br>  En cons√©quence, m√™me le dernier iPhone7 √† l'√©poque ne pouvait pas le lire.  Sur le ch√®que, le code QR, compos√© uniquement de donn√©es de paiement et de signature, tient √† peine sur la moiti√© de la feuille A4.  La ligne de demande de paiement √©tait trop longue.  Ce fut la premi√®re tristesse. <br><br>  Il fallait r√©soudre deux probl√®mes principaux: <br><br><ul><li>  r√©duire le nombre de caract√®res dans une demande de paiement, c'est-√†-dire  trouver une solution dans laquelle nous pouvons passer de la requ√™te xml existante √† une requ√™te plus compacte; </li><li>  choisissez un algorithme de chiffrement et une longueur de cl√© qui fourniront une force et une fiabilit√© cryptographiques √©lev√©es avec une taille de signature plus petite. </li></ul><br>  Le crit√®re pour √©valuer le nombre optimal de caract√®res pour le code QR √©tait un - il devrait √™tre lu par les cam√©ras de la plupart des t√©l√©phones mobiles. <br><br>  En quelques r√©unions de travail, une solution a n√©anmoins √©t√© trouv√©e: <br><br><ul><li>  au lieu de la requ√™te xml, nous avons d√©cid√© d'utiliser une requ√™te get avec des param√®tres de paiement et des s√©parateurs entre eux; </li><li>  construit une signature sur les courbes elliptiques pour raccourcir la longueur. </li></ul><br>  L'avantage d'utiliser la get-request √©tait que les cam√©ras des t√©l√©phones portables ou des programmes sp√©ciaux, en voyant le lien dans le code QR, l'ouvraient imm√©diatement dans le navigateur, ce qui permettait d'effectuer un paiement en une seule action.  Pour r√©duire la taille de la requ√™te get, nous avons d√ª remplacer le nom du param√®tre par des d√©limiteurs. <br><br>  √Ä la suite de l'ensemble des actions, la demande de paiement a √©t√© r√©duite d'environ 1 100 √† 200 caract√®res.  De plus, j'ai d√ª appliquer le niveau de correction d'erreur le plus bas du code QR - L. <br><br>  Pour la mise en ≈ìuvre, il a √©t√© n√©cessaire de d√©velopper des composants dans le syst√®me: <br><br><ul><li>  cr√©er une nouvelle api pour effectuer des paiements via un code QR; </li><li>  introduire un nouveau m√©canisme pour travailler avec des cl√©s cryptographiques entre le terminal et le traitement; </li><li>  mettre en ≈ìuvre un microservice sur lequel la fonctionnalit√© de proxy des demandes, la v√©rification de l'int√©grit√© des donn√©es re√ßues, ainsi que la fonction de blocage des demandes suspectes et de collecte des statistiques d'op√©ration seront suspendues; </li><li>  d√©velopper une page Web pour afficher les informations de paiement; </li><li>  D√©velopper un syst√®me de limites et de contr√¥les pour un nouveau canal de paiement. </li></ul><br>  Au plan de travail existant: <br><br><img src="https://habrastorage.org/webt/vh/wi/bf/vhwibfzt6s4hebqumpum7anrkv4.png" alt="image"><br><br>  Nous avions pr√©vu d'ajouter une alternative: <br><br><img src="https://habrastorage.org/webt/ze/75/au/ze75auougt6hzcrhryahnftqyca.png" alt="image"><br><br>  Au cours du projet, il semblerait, petit, mais n√©cessitant de r√©soudre des probl√®mes, ce qui en fait a pris beaucoup de temps, reportant la date de lancement. <br><br><h3>  UX-recherche, ou le travail est venu d'o√π ils n'ont pas attendu </h3><br>  Je voulais tout faire comme les gens, alors ils ont fait appel √† des sp√©cialistes UX pour mettre en ≈ìuvre le projet afin de r√©soudre les probl√®mes: <br><br><ul><li>  dans quelle partie de l'√©cran du terminal QIWI pour placer le code QR et comment expliquer son utilit√© au client? </li><li>  o√π placer le code QR sur le ch√®que et comment ins√©rer des explications similaires? </li><li>  Comment faire une mise en page d'une page web avec le statut de paiement, pour qu'elle soit claire sur les guides de l'entreprise? </li></ul><br>  De toute √©vidence, pour la partie avanc√©e des clients, des explications suppl√©mentaires sur le code QR ne sont pas n√©cessaires, il suffit d'indiquer le r√©sultat.  Mais nous voulions couvrir cette partie des clients pour lesquels le QR code est une abr√©viation magique ou simplement un ¬´carr√© noir¬ª.  Ce sont eux qui, en fait, rompent la ligne du centre d'appels. <br><br>  Pour le rendre beau et compr√©hensible, une interview a √©t√© r√©alis√©e au sein du focus group qui nous int√©resse avec des r√©sultats inattendus ... <br><br><h3>  La bri√®vet√© est comparable √† l'√©pargne </h3><br>  Cela s'est av√©r√© effrayant - le public dont nous avions besoin ne comprenait pas toujours le sens du mot ¬´Scan¬ª et ses d√©riv√©s.  Par cons√©quent, le libell√© original ¬´Scannez et d√©couvrez le statut¬ª a d√ª √™tre abandonn√©.  La solution √©tait la capacit√© technique d'envoyer une photo du code QR par e-mail.  Et il √©tait √©galement n√©cessaire de le dire bri√®vement et clairement, car le ruban de contr√¥le est le mat√©riel consommable des propri√©taires de terminaux et notre pr√©occupation pour les affaires de ces personnes est son √©conomie.  Par cons√©quent, le ch√®que ressemble maintenant √† ceci: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1o/dr/yz/1odryzcvlubmpip1uvcd61tuuwi.png" alt="image" width="400" height="400"></div><br>  Quant √† l'affichage du code QR sur l'√©cran du terminal, il a √©t√© plac√© sur la derni√®re page du paiement - le dernier du sc√©nario de paiement.  Il est affich√© au moment de l'impression du ch√®que et est essentiellement un duplicata √©lectronique du code QR imprim√©. <br><br><h3>  L'email est omnipr√©sent </h3><br>  Dans le cadre de l'√©mergence d'un nouveau canal de traitement des QR codes sous forme d'e-mail, il est devenu n√©cessaire de d√©velopper une m√©canique ayant pour fonction de reconna√Ætre les QR codes int√©gr√©s dans des lettres et de g√©n√©rer une r√©ponse avec le statut de paiement. <br><br>  La fonction de reconnaissance des codes QR a √©t√© supprim√©e dans le microservice.  Lors de la mise en ≈ìuvre initiale, le taux de reconnaissance √©tait d'environ 65% dans l'√©chantillon de photographies pr√©sent√©.  Nous avons essay√© de jouer avec la d√©coloration et l'augmentation du contraste - cela a donn√© environ + 20% de reconnaissance r√©ussie. <br><br>  La cerise sur le g√¢teau dans la t√¢che de reconnaissance des photos du code QR a √©t√© l'introduction de ¬´l'intelligence naturelle¬ª pour les cas difficiles et mal reconnus - la cr√©ation des applications et leur traitement ont commenc√© √† se faire en mode manuel: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/49/se/5g/49se5gbmtwhcusd4xolxybtfon8.png" alt="image" width="400" height="400"></div><br><h3>  La technique n'est pas des bagatelles </h3><br>  Les principaux d√©veloppements de ce projet ont bien s√ªr concern√© le microservice lui-m√™me et le logiciel du terminal. <br><br>  QIWI √©volue activement vers une architecture de microservices afin de ne pas toucher le moteur massif.  Le microservice vous permet d'apporter rapidement des modifications aux projets, d'effectuer des tests et de publier les versions.  Par cons√©quent, dans quelques mois, nous avons √©crit le n√¥tre.  Nous y avons accroch√© tous les nouveaux d√©veloppements majeurs qui ne pouvaient √™tre r√©alis√©s: <br><br><ul><li>  procuration des requ√™tes en analysant et en analysant les requ√™tes get entrantes, en les convertissant en xml pour le traitement, </li><li>  fonctionnalit√© pour limiter les demandes entrantes des terminaux, </li><li>  Fonctionnalit√© de reconnaissance de code QR, </li><li>  collecte de statistiques pour une analyse plus approfondie. </li></ul><br>  En plus de la mise en ≈ìuvre d'un nouveau m√©canisme pour travailler avec des cl√©s cryptographiques, les am√©liorations des terminaux ont touch√© l'application d'une nouvelle technologie pour l'impression des re√ßus. <br><br>  La fonctionnalit√© de leur formation a √©t√© retir√©e du noyau principal du programme dans le plugin.  Nous pouvions d√©sormais apporter rapidement des modifications √† la v√©rification, sans toucher √† l'op√©rabilit√© du terminal dans son ensemble.  L'impression d'un code QR, qui, √† premi√®re vue, semble assez simple et se r√©sume √† l'impression d'une photo sur un ch√®que, n'est pas vraiment telle. <br><br>  En effet, le r√©seau de nos propri√©taires de terminaux compte environ 20 mod√®les d'une grande vari√©t√© d'imprimantes et nous imprimons environ 40 types de re√ßus.  Lorsqu'ils ont commenc√© l'impl√©mentation, de nombreuses nuances sont apparues: soit les lignes et l'emplacement des objets dans le mod√®le de v√©rification ont commenc√© √† flotter lorsque l'image a √©t√© ajout√©e, puis certaines commandes se sont r√©v√©l√©es sensibles √† l'emplacement, puis le saut de ligne s'est transform√© en onglet. <br><br>  Nous avons commenc√© les tests, nous avons r√©alis√© la n√©cessit√© d'un compromis - certains mod√®les d'imprimantes ont d√ª √™tre exclus, car lors du test de toutes les configurations, un tr√®s grand nombre de cas sont sortis. <br><br>  Pour les tests, nous avons d√©cid√© de choisir 6 mod√®les principaux, qui couvraient 91% du r√©seau d'agents.  Et, bien s√ªr, au moment d'effectuer des tests al√©atoires dans un environnement de combat, il s'est av√©r√© que c'√©tait sur des imprimantes anciennes qui couvraient environ 5% du r√©seau d'agents que des probl√®mes d'impression de re√ßus ont √©t√© d√©couverts.  Les mod√®les √©taient si vieux que m√™me sur le march√©, ils ne pouvaient plus √™tre achet√©s.  J'ai d√ª chercher avec des partenaires.  D√©sormais, le projet couvre 96% du r√©seau.  D√©j√† un peu plus pr√®s de l'id√©al :) <br><br><h3>  Pas un seul ch√®que </h3><br>  Parall√®lement au placement des informations sur le code QR sur le ch√®que et la derni√®re page du paiement, une autre t√¢che a √©t√© √©voqu√©e - amener cette page √† un aspect universel pour tous les projets de terminaux: <br><br>  <i>¬´En termes de pages d'ach√®vement de paiement dans les terminaux QIWI, tout √©tait assez archa√Øque: publicit√©, banni√®res et envoi de re√ßus √©lectroniques.</i>  <i>√Ä partir de cinq pages, les gars en ont cr√©√© une, universelle pour tous les paiements. ¬ª</i>  - Programmeur leader de l'√©quipe. <br><br>  Maintenant, cette page universelle est utilis√©e dans diff√©rentes interpr√©tations, sans enfreindre la r√®gle de construction d'un script, fermant ainsi la dette karmique de l'√©quipe de d√©veloppement. <br><br>  Ainsi, le probl√®me d'il y a dix ans a √©t√© r√©solu, auquel les mains n'atteignaient pas √† chaque fois.  Il y avait plusieurs t√¢ches de longue haleine. <br><br><h3>  "O√π est l'argent, Zin?"  ou ce qui est en fin de compte </h3><br>  Le projet, con√ßu pour quelques sprints, a dur√© six mois, affectant les ressources de 10 salari√©s et la p√©riph√©rie de l'agence d'externalisation. <br><br>  En cons√©quence, apr√®s avoir mis en ≈ìuvre le projet sur 85% du r√©seau de terminaux, nous nous sommes surpris ainsi que le client - le service client.  Le troisi√®me jour du code QR, les coll√®gues pensaient qu'une erreur syst√®me s'√©tait gliss√©e dans eux - des statistiques sur le nombre d'appels au centre d'appels avec la question "O√π est mon paiement?"  d√©j√† baiss√© de 20%.  Les clients ont commenc√© √† scanner le code QR et √† envoyer des re√ßus photo par e-mail, en d√©couvrant le statut et en effectuant leur propre paiement.  Et donc pour le deuxi√®me mois.  Je dois dire que les clients ont commenc√© √† comprendre ce qu'est le ¬´carr√© noir¬ª et √† quoi il sert. <br><br>  Le projet avec un code QR a √©t√© appr√©ci√© par tous ceux qui en ont √©t√© inform√©s - c'√©tait une synergie d'int√©r√™ts: d'une part, ils ont simplifi√© la vie du client, et d'autre part, ils ont r√©solu un probl√®me technique non standard.  V√©rifier l'√©tat d'un paiement et le r√©aliser dans un morceau de papier en traitant simplement un code QR pour QIWI est quelque chose de nouveau.  C'√©tait formidable de prendre des technologies connues et simples √† partir desquelles faire un projet utile.  En g√©n√©ral, le projet a non seulement stimul√© les comp√©tences, mais √©galement am√©lior√© la communication au sein de l'√©quipe elle-m√™me.  Et c'est presque le principal avantage du karma. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr422631/">https://habr.com/ru/post/fr422631/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr422617/index.html">Toute la v√©rit√© sur RTOS. Article # 8. Nucleus SE: conception interne et d√©ploiement</a></li>
<li><a href="../fr422623/index.html">Comment s√©curiser C</a></li>
<li><a href="../fr422625/index.html">Nous avons parl√© avec Troy Miles - le programmeur de "Neuromancer"</a></li>
<li><a href="../fr422627/index.html">Recherche sur le march√© du travail MongoDB et IT</a></li>
<li><a href="../fr422629/index.html">Arr√™tez de nourrir les b√ªcherons! Donnez plus de modificateurs! Champs finaux statiques paresseux. Projet d'esquisse d'objet</a></li>
<li><a href="../fr422633/index.html">Comment nous avons automatis√© la surveillance du travail des employ√©s du r√©seau f√©d√©ral de stations-service</a></li>
<li><a href="../fr422635/index.html">Vous n‚Äôavez pas encore dit le mot ¬´bonjour¬ª, et nous savons d√©j√† qui vous √™tes</a></li>
<li><a href="../fr422637/index.html">Cadeau de geek: Protection Auto-Alkash</a></li>
<li><a href="../fr422641/index.html">Nuit polaire, pompage d'eau et coffre-fort intelligent: 5 projets √©tudiants dans le domaine de l'IoT</a></li>
<li><a href="../fr422643/index.html">Nouveaux appareils avec IFA 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>