<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï¥üèº ‚èÆÔ∏è üèΩ L'union d'Arduino et du processeur classique üå¥ üò¶ üïê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les r√©tro-ordinateurs sont disponibles √† des degr√©s divers. Certains se contentent d'√©mulation. D'autres pr√©f√®rent les FPGA, car il ne s'agit pas d'√©m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>L'union d'Arduino et du processeur classique</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446048/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ol/8r/yr/ol8ryrltwjene6e2frje_pacnti.jpeg"></div><br>  Les r√©tro-ordinateurs sont disponibles √† des degr√©s divers.  Certains se contentent d'√©mulation.  D'autres pr√©f√®rent les FPGA, car il ne s'agit pas d'√©mulation, mais de loisirs.  Enfin, servez le troisi√®me processeur. <br><br>  Mais le processeur a tellement besoin de fonctionner!  Encore une fois, le dilemme: prendre de vraies puces des m√™mes ann√©es, ou tout mettre dans le FPGA, laissant le processeur √† l'ext√©rieur?  Cependant, pourquoi le FPGA est-il n√©cessaire?  Vive l'union de l'Arduino et du processeur classique! <a name="habracut"></a><br><br>  Donnez √† votre Arduino un ¬´deuxi√®me cerveau¬ª et rendez-le plus intelligent. <br><br>  Un v√©ritable microprocesseur huit bits ex√©cute des programmes, tandis qu'un Arduino √©mule la ROM, la RAM et les simples p√©riph√©riques. <br><br>  Concevez des p√©riph√©riques virtuels dans l'IDE Arduino et ex√©cutez le code assembleur sur le microprocesseur.  Pas besoin d'assembler des circuits complexes et des m√©moires flash parall√®les flash. <br><br>  Microprocesseurs pris en charge: 6502, 6809 et Z80 (18581), d'autres sont en cours. <br><br>  Un blindage avec un microprocesseur n'interf√®re pas avec la connexion d'autres blindages: avec les √©crans LCD, les cartes m√©moire, etc. <br><br>  En plus du langage d'auto-assemblage, vous pouvez essayer d'ex√©cuter du code classique sur le microprocesseur. <br><br>  Certes, le microprocesseur fonctionnera √† une fr√©quence tr√®s basse - environ 95 kHz, sa valeur exacte d√©pend de l'optimisation du code d'√©mulation p√©riph√©rique. <br><br>  La distribution de l'espace d'adressage est d√©finie par programme dans une esquisse.  Le microprocesseur peut √™tre allou√© de 4 √† 6 Ko de 8 Ko de RAM disponibles sur l'Arduino Mega.  La ROM peut allouer plus de 200 Ko sur les 256 disponibles. <br><br>  Le port s√©rie Arduino Mega peut √©muler UART. <br><br>  Les circuits, dessins de planches, fichiers Gerber sont disponibles sous CC-BY-SA 4.0 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Dans le m√™me temps, il est n√©cessaire de joindre le fichier README.md, car il contient l'avertissement suivant: <br><blockquote>  Ne connectez pas le blindage tant que le croquis d'√©mulation p√©riph√©rique n'est pas t√©l√©charg√©!  Sinon, il est possible de court-circuiter les lignes de sortie du microprocesseur. </blockquote>  Oui, et dans l'esquisse elle-m√™me, quelque chose doit √™tre refait avec soin pour la m√™me raison. <br><br>  Le sch√©ma de l'appareil sur 6502: <br><br><img src="https://habrastorage.org/webt/e0/n8/6k/e0n86kpozlcttklifjihnl51quo.png"><br><br>  Diagramme de l'appareil sur 6809: <br><br><img src="https://habrastorage.org/webt/qf/yi/kx/qfyikx1tktdjuad0hocivlpsolw.png"><br><br>  Sch√©ma de l'appareil sur le Z80: <br><br><img src="https://habrastorage.org/webt/ct/uh/qs/ctuhqskjmmp1rvxrhs8abcoqvne.png"><br><br>  Vous pouvez d√©j√† ex√©cuter: <br><br>  Sur un appareil avec 6502 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Apple I, Woz Monitor + ROM avec BASIC</a> <br><br>  Sur un appareil avec 6809 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un analogue d'un ordinateur fait maison Simon6809 du m√™me d√©veloppeur, un moniteur de formation avec assembleur et d√©monteur</a> <br><br>  Sur un appareil avec Z80 - jusqu'√† pr√©sent, seulement un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">test d'√©cho du port s√©rie</a> , vous permettant de v√©rifier les performances du 8251 virtuel (KR580VV51A). <br><br>  Firmware pour √©muler des p√©riph√©riques - sous licence MIT. <br><br>  Br√®ve description du principe d'action: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vers l'appareil 6502</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vers l'appareil sur 6809</a> <br><br>  Pour l'appareil sur le Z80 - en pr√©paration. <br><br>  Le d√©veloppeur essaie de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vendre des</a> appareils, mais avec une livraison uniquement aux √âtats-Unis.  Il n'y a pas de raison particuli√®re d'acheter, car le sch√©ma est tr√®s simple, vous pouvez le r√©p√©ter sur un morceau de la planche √† pain en une heure. <br><br>  Il est pr√©vu de d√©velopper des cartes similaires sur RCA1802, 68008, 8085 (182185), 8088 (181088).  A propos de K1801BM1 n'est pas dit, mais vous pouvez lancer une telle id√©e √† l'auteur. <br><br>  Fichiers: <br><br>  Vers l'appareil sur 6502: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notice de montage</a> , <a href="">s√©rigraphie</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sch√©ma</a> <br><br>  Vers l'appareil sur 6809: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notice de montage</a> , <a href="">s√©rigraphie</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sch√©ma</a> <br><br>  Vers l'appareil sur Z80: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notice de montage</a> , <a href="">s√©rigraphie</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sch√©ma</a> <br><br>  Consid√©rez l'interaction d'un Arduino et d'un appareil 6502. L'Arduino change p√©riodiquement le niveau √† l'entr√©e d'un microprocesseur con√ßu pour fournir des impulsions d'horloge de z√©ro √† un et vice versa.  √Ä chaque cycle, il v√©rifie ce qui se passe sur les lignes de contr√¥le et le bus d'adresses et, selon la situation, lit les informations du bus de donn√©es ou les y envoie.  Arduino peut √©galement contr√¥ler les lignes IRQ et NMI, provoquant des interruptions.  La figure montre les types de donn√©es et les directions de leur transmission: <br><br><img src="https://habrastorage.org/webt/tr/in/je/trinjeibi9cwwrngfq628lm4yns.png"><br><br>  La correspondance des ports Arduino et des sorties du microprocesseur est configur√©e dans l'esquisse: <br><br><pre><code class="plaintext hljs">/* Digital Pin Assignments */ #define DATA_OUT PORTL #define DATA_IN PINL #define ADDR_H PINC #define ADDR_L PINA #define ADDR ((unsigned int) (ADDR_H &lt;&lt; 8 | ADDR_L)) #define uP_RESET_N 38 #define uP_RW_N 40 #define uP_RDY 39 #define uP_SO_N 41 #define uP_IRQ_N 50 #define uP_NMI_N 51 #define uP_E 52 #define uP_GPIO 53</code> </pre> <br>  Nous diviserons chaque mesure en √©v√©nements suivants: <br><br>  CLK change l'√©tat de un √† z√©ro (d√©clin) <br>  CLK est dans un √©tat de z√©ro <br>  CLK change d'√©tat de un √† z√©ro (augmentation) <br>  CLK est √† l'√©tat unitaire <br>  CLK change √† nouveau l'√©tat de un √† z√©ro ... <br><br>  Que se passe-t-il pendant les moments de transition d'√©tat? <br><br>  6502 re√ßoit des impulsions d'horloge √† l'entr√©e CLK0, les met en m√©moire tampon et les envoie √† deux sorties: CLK1 et CLK2.  Bien que tous les √©v√©nements du microprocesseur soient li√©s √† CLK1, nous supposons que le retard n'est pas important et qu'ils sont li√©s √† CLK0 - la ligne le long de laquelle le microprocesseur re√ßoit des impulsions d'horloge d'Arduino.  Et appelez le signal juste CLK. <br><br><img src="https://habrastorage.org/webt/9i/kq/hc/9ikqhcytwd4sjg6rwjnvmohgkvi.png"><br><br>  1. CLK change d'√©tat de un √† z√©ro. <br><br>  2. Le microprocesseur sort une nouvelle adresse sur le bus d'adresse et un signal de commutation entre la lecture et l'√©criture sur la sortie R / W.  Mais il n'est pas encore pr√™t pour l'√©change de donn√©es. <br><br>  3. CLK passe √† l'√©tat unitaire, ce qui signifie que l'√©change de donn√©es a commenc√©.  S'il s'agit d'une op√©ration de lecture, le microprocesseur transf√®re les sorties du bus de donn√©es √† l'√©tat d'entr√©e et re√ßoit des donn√©es, et si l'op√©ration d'√©criture, il les transf√®re √† l'√©tat de sortie et envoie des donn√©es.  Et le signal R / W fait passer le p√©riph√©rique externe en mode √©criture ou lecture, √† l'oppos√© de l'√©tat correspondant du microprocesseur. <br><br>  4. CLK passe √† z√©ro.  Maintenant, ni le microprocesseur ni les p√©riph√©riques d'entr√©e-sortie ne sortent quoi que ce soit sur le bus de donn√©es.  Le microprocesseur peut d√©finir la ligne de bus de donn√©es et la broche R / W dans un nouvel √©tat. <br><br>  Une explication simple, compr√©hensible pour l'enfant.  Qui ne pense jamais √† ces "intrigues en coulisses", s'il ne programme que des microcontr√¥leurs.  M√™me en assembleur. <br><br>  Si vous devez connecter votre p√©riph√©rique, il doit avoir le temps de pr√©parer les donn√©es avant que l'unit√© (temps de pr√©paration) n'apparaisse sur la ligne CLK, et pendant que l'unit√© est l√†, ne la changez pas.  Si le p√©riph√©rique n'a pas le temps de pr√©parer les donn√©es alors que CLK est nul, ou les change lorsque l'unit√© est l√†, vous vous demanderez longtemps pourquoi votre code ne fonctionne pas.  La fr√©quence d'horloge du microprocesseur √©tant dix √† quinze fois inf√©rieure √† la fr√©quence nominale, il est facile de se conformer √† cette exigence.  Mais c'est n√©cessaire. <br><br>  Ainsi, vous devez ¬´apprendre¬ª √† Arduino √† g√©n√©rer des impulsions d'horloge, √† v√©rifier en permanence ce qui se passe sur les lignes d'adresse et de lecture / √©criture et √† interagir avec le bus de donn√©es en cons√©quence.  Pour ce faire, l'esquisse utilise l'interruption de temporisation timer1, qui g√©n√®re des impulsions avec une fr√©quence de 95 kHz.  Arduino fonctionne beaucoup plus rapidement que le microprocesseur, et donc, entre ses horloges, il parvient √† tout lire et √† tout pr√©parer.  Il est important de s'assurer qu'apr√®s avoir modifi√© l'esquisse, cette condition continue d'√™tre remplie. <br><br>  Voici un extrait de l'esquisse, qui montre comment le CLK passe de z√©ro √† un, et ce qui se passe ensuite: <br><br><pre> <code class="plaintext hljs">//////////////////////////////////////////////////////////////////// // Processor Control Loop //////////////////////////////////////////////////////////////////// // This is where the action is. // it reads processor control signals and acts accordingly. // ISR(TIMER1_COMPA_vect) { // Drive CLK high CLK_E_HIGH; // Let's capture the ADDR bus uP_ADDR = ADDR; if (STATE_RW_N) ////////////////////////////////////////////////////////////////// // HIGH = READ transaction { // uP wants to read so Arduino to drive databus to uP: DATA_DIR = DIR_OUT; // Check what device uP_ADDR corresponds to: // ROM? if ( (ROM_START &lt;= uP_ADDR) &amp;&amp; (uP_ADDR &lt;= ROM_END) ) DATA_OUT = pgm_read_byte_near(rom_bin + (uP_ADDR - ROM_START)); else if ( (BASIC_START &lt;= uP_ADDR) &amp;&amp; (uP_ADDR &lt;= BASIC_END) ) DATA_OUT = pgm_read_byte_near(basic_bin + (uP_ADDR - BASIC_START)); else // RAM? if ( (uP_ADDR &lt;= RAM_END) &amp;&amp; (RAM_START &lt;= uP_ADDR) ) DATA_OUT = RAM[uP_ADDR - RAM_START]; else // 6821? if ( KBD &lt;=uP_ADDR &amp;&amp; uP_ADDR &lt;= DSPCR ) { // KBD? if (uP_ADDR == KBD) { ... // handle KBD register } else // KBDCR? if (uP_ADDR == KBDCR) { ... // handle KBDCR register } else // DSP? if (uP_ADDR == DSP) { ... // handle DSP register } else // DSPCR? if (uP_ADDR == DSPCR) { ... // handle DSPCR register } } } else ////////////////////////////////////////////////////////////////// // R/W = LOW = WRITE { // RAM? if ( (uP_ADDR &lt;= RAM_END) &amp;&amp; (RAM_START &lt;= uP_ADDR) ) RAM[uP_ADDR - RAM_START] = DATA_IN; else // 6821? if ( KBD &lt;=uP_ADDR &amp;&amp; uP_ADDR &lt;= DSPCR ) { // KBD? if (uP_ADDR == KBD) { ... // handle KBD register } else // KBDCR? if (uP_ADDR == KBDCR) { ... // handle KBDCR register } else // DSP? if (uP_ADDR == DSP) { ... // handle DSP register } else // DSPCR? if (uP_ADDR == DSPCR) { ... // handle DSPCR register } } } //////////////////////////////////////////////////////////////// // We are done with this cycle. // one full cycle complete clock_cycle_count ++; // start next cycle CLK_E_LOW; // If Arduino was driving the bus, no need anymore. // natural delay for DATA Hold time after CLK goes low (t_HR) DATA_DIR = DIR_IN; }</code> </pre> <br>  L'allocation de l'espace d'adressage peut √™tre effectu√©e comme vous le souhaitez, dans une esquisse non modifi√©e, c'est la m√™me chose que dans Apple 1 avec 256 octets de ROM, 8 kilo-octets de ROM pour BASIC, 4 kilo-octets de RAM et 6821 p√©riph√©rique d'entr√©e-sortie. <br><br><pre> <code class="plaintext hljs">// MEMORY LAYOUT // 4K MEMORY #define RAM_START 0x0000 #define RAM_END 0x0FFF byte RAM[RAM_END-RAM_START+1]; // ROMs (Monitor + Basic) #define ROM_START 0xFF00 #define ROM_END 0xFFFF #define BASIC_START 0xE000 #define BASIC_END 0xEFFF //////////////////////////////////////////////////////////////////// // Woz Monitor Code //////////////////////////////////////////////////////////////////// // PROGMEM const unsigned char rom_bin[] = { 0xd8, 0x58, 0xa0, 0x7f, 0x8c, 0x12, 0xd0, 0xa9, 0xa7, 0x8d, 0x11, 0xd0, ... 0x00, 0xff, 0x00, 0x00 }; // BASIC ROM starts at E000 PROGMEM const unsigned char basic_bin[] = { 0x4C, 0xB0, 0xE2, 0xAD, 0x11, 0xD0, 0x10, 0xFB, ... 0xE0, 0x80, 0xD0, 0x01, 0x88, 0x4C, 0x0C, 0xE0 };</code> </pre> <br>  La RAM est √©mul√©e par un tableau de RAM d'octets [RAM_END-RAM_START + 1].  Deux mots cl√©s PROGMEM sont n√©cessaires pour que le contenu des ROM √©mul√©es soit stock√© dans la m√©moire flash du microcontr√¥leur. <br><br>  6821 est suffisamment √©mul√© pour que le clavier virtuel et l'affichage fonctionnent via le ¬´terminal¬ª.  Woz Monitor et BASIC work, c'est ce que l'auteur recherchait. <br><br>  Pour √©muler n'importe quel p√©riph√©rique, vous devez lire attentivement sa fiche technique et savoir quels registres il a et √† quoi ils servent.  La commodit√© de l'√©mulation r√©side dans la flexibilit√© avec laquelle vous pouvez cr√©er des logiciels analogues de la p√©riph√©rie. <br><br>  Les p√©riph√©riques d'E / S sont situ√©s dans l'espace d'adressage du microprocesseur; ils sont accessibles de la m√™me mani√®re que les cellules de m√©moire.  Pour utiliser les p√©riph√©riques "de fer", tels qu'un √©cran LCD, une carte m√©moire, une sortie audio, vous devez allouer une place dans l'espace d'adressage. <br><br>  R√©f√©rences: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.6502.org</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.callapple.org/soft/ap1/emul.html</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">skilldrick.github.io/easy6502</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">searle.hostei.com/grant/6502/Simple6502.html</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wilsonminesco.com/6502primer</a> <br>  SB-Assembler: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.sbprojects.net/sbasm</a> <br><br>  Passez au 6809, il contient: <br><br>  Deux batteries A et B √† huit bits, qui peuvent √™tre combin√©es en une batterie √† six bits <br>  Deux index de pile 16 bits <br>  Adressage par rapport au compteur d'instructions <br>  Ajouter ou soustraire automatiquement 1 ou 2 <br>  Multiplication de deux nombres non sign√©s √† huit chiffres <br>  Arithm√©tique 16 bits <br>  Transfert et √©change de donn√©es entre tous les registres <br>  √âcrire et lire tous les registres et toute combinaison de ceux-ci <br><br>  Le microprocesseur 6809E (externe) a besoin d'une horloge externe, tandis que le 6809 en a une interne.  Pour Hitachi, ils sont appel√©s respectivement 6309E et 6309, ils diff√®rent des habituels en ce qu'ils fonctionnent sous forme 32 bits √† l'int√©rieur de l'op√©ration, mais il est possible de passer en mode de compatibilit√© avec la version classique. <br><br>  En fait, tout le projet RetroShield a commenc√© parce que l'auteur voulait mettre √† niveau son ordinateur fait maison Simon6809 et nommer le r√©sultat Simon6809 Turbo.  Mais il s'est av√©r√© que les puces logiques standard pour tout ce qu'il voulait y impl√©menter exigeaient beaucoup.  Par cons√©quent, l'auteur a formul√© l'id√©e de RetroShield pour la premi√®re fois en relation avec le 6809, et seulement alors il a pens√©: ¬´et si la m√™me chose avec d'autres processeurs faisait de m√™me?¬ª. <br><br>  L'appareil utilise bien s√ªr le 6809E, qui n√©cessite une horloge externe, afin de pouvoir synchroniser son travail de l'ext√©rieur.  Les lignes E et Q des deux processeurs sont nomm√©es de la m√™me mani√®re, seules 6809 ont des sorties et 6809E ont des entr√©es. <br><br>  Arduino interagit avec 6809 de la m√™me mani√®re qu'avec 6502, mais il a deux entr√©es d'horloge: E et Q, et trois entr√©es d'interruption: IRQ, FIRQ et NMI. <br><br><img src="https://habrastorage.org/webt/0i/uk/dn/0iukdn25vkrhbsvd8spjlhr-s3q.png"><br><br>  Cette fois, la correspondance entre les ports Arduino et les broches du microprocesseur est configur√©e comme suit: <br><br><pre> <code class="plaintext hljs">/* Digital Pin Assignments */ #define DATA_OUT PORTL #define DATA_IN PINL #define ADDR_H PINC #define ADDR_L PINA #define ADDR ((unsigned int) (ADDR_H &lt;&lt; 8 | ADDR_L)) #define uP_RESET_N 38 #define uP_E 52 #define uP_Q 53 #define uP_RW_N 40 #define uP_FIRQ_N 41 #define uP_IRQ_N 50 #define uP_NMI_N 51 #define uP_GPIO 39</code> </pre> <br>  Comme le montrent les graphiques, le signal Q est d√©cal√© par rapport √† E d'un quart de p√©riode: <br><br>  Nous ferons √† peine attention √† Q, car tous les √©v√©nements sont li√©s √† E. Et tout se passe comme ceci: <br><br><img src="https://habrastorage.org/webt/ao/hj/qv/aohjqvkk89mbouy7_njtjqbz3ku.png"><br><br><ol><li>  E passe √† z√©ro.  Le processeur d√©finit une nouvelle adresse sur le bus d'adresses et modifie l'√©tat de la ligne R / W. </li><li>  E passe √† un, le processeur est pr√™t pour l'√©change de donn√©es. </li><li>  Peu importe ce qui arrive au bus de donn√©es tant que E en est un, l'essentiel est que les donn√©es requises y soient pr√©sentes au moment o√π E revient √† z√©ro. </li><li>  Lors de la lecture des donn√©es, le p√©riph√©rique d'E / S doit fournir les donn√©es requises au bus de donn√©es avant que la ligne E ne passe de un √† z√©ro (le retard minimum est indiqu√© par le chiffre 17 dans le cercle). </li><li>  Lors de l'enregistrement, le p√©riph√©rique d'E / S doit fixer les donn√©es dans un registre sous la forme dans laquelle elles se trouvaient au moment o√π E est pass√© de un √† z√©ro.  Le processeur fournira ces donn√©es sur le bus encore plus t√¥t - au moment du passage de Q √† un (le nombre 20 dans le cercle). </li><li>  Apr√®s la transition de E √† z√©ro, tout se r√©p√®te. </li></ol><br>  Tout ce qui a √©t√© dit plus haut sur 6502 sur la n√©cessit√© d'un p√©riph√©rique (y compris un p√©riph√©rique virtuel) pour d√©velopper tous les signaux √† temps concerne 6809. <br><br>  G√©n√©ration des signaux E et Q, comme dans le cas du 6502, avec la seule diff√©rence qu'il y a deux signaux, et ils doivent √™tre commut√©s conform√©ment aux graphiques.  Et juste comme √ßa, un sous-programme appel√© interruption effectue une entr√©e ou une sortie de donn√©es aux moments requis. <br><br>  L'espace d'adressage dans l'esquisse non modifi√©e est distribu√© de la m√™me mani√®re que dans l'ordinateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Simon6809</a> fait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">maison</a> : <br><br><pre> <code class="plaintext hljs">// MEMORY #define RAM_START 0x0000 #define RAM_END 0x0FFF #define ROM_START 0xE000 #define ROM_END 0xFFFF byte RAM[RAM_END-RAM_START+1]; //////////////////////////////////////////////////////////////////// // Monitor Code //////////////////////////////////////////////////////////////////// // static const unsigned char PROGMEM const unsigned char simon09_bin[] = { 0x1a, 0xff, 0x4f, 0x1f, 0x8b, 0x0f, 0x36, 0x7f, 0x01, 0xa5, 0x10, 0xce, ... 0x00, 0x09, 0x00, 0x0c, 0x00, 0x0f, 0xe0, 0x00 };</code> </pre> <br>  La RAM et la ROM sont stock√©es dans des tableaux de la m√™me mani√®re que dans la variante 6502, √† la seule diff√©rence qu'il n'y a qu'un seul tableau avec des donn√©es ROM. <br><br>  Les p√©riph√©riques d'E / S se voient √©galement allouer des parties de l'espace d'adressage, et ils peuvent √™tre virtuels ou r√©els.  √âtant donn√© que Simon6809 est une machine moderne bas√©e sur une base √©l√©mentaire vintage, il √©change des donn√©es via FTDI depuis le PC sur lequel le ¬´terminal¬ª fonctionne.  Ici, il est √©mul√©. <br><br>  R√©f√©rences: <br><br>  Beaucoup d'informations sur 6809 sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">page Arto</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article Wikip√©dia sur 6809</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Syst√®mes SWTPc 6809</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article Wikipedia sur le syst√®me d'exploitation FLEX</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr446048/">https://habr.com/ru/post/fr446048/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr446036/index.html">Oracle Application Express. Applications et pages</a></li>
<li><a href="../fr446038/index.html">Un petit guide sur la cr√©ation d'oracles, de dieux de voiture et d'erreurs de second ordre</a></li>
<li><a href="../fr446040/index.html">Aveu complet: profession, religion, r√™ves</a></li>
<li><a href="../fr446042/index.html">DJI Mavic 2 Pro apr√®s six mois d'utilisation</a></li>
<li><a href="../fr446046/index.html">L'expansion de l'univers est la plus grande erreur de l'histoire des sciences</a></li>
<li><a href="../fr446050/index.html">Flutter. Cl√©s! √Ä quoi servent-ils?</a></li>
<li><a href="../fr446052/index.html">Cr√©er la voix et le ton de votre produit</a></li>
<li><a href="../fr446054/index.html">Pr√™t pour la sauvegarde: d√©truire les mythes des f√™tes</a></li>
<li><a href="../fr446056/index.html">Un moyen simple de parler √† votre site Web</a></li>
<li><a href="../fr446058/index.html">Comment cr√©er SDN - huit outils Open Source</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>