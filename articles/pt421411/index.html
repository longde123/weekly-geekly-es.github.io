<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéñÔ∏è üåª üèø Introdu√ß√£o aos m√≥dulos Go ‚úâÔ∏è üò§ üéç</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O pr√≥ximo lan√ßamento da vers√£o 1.11 da linguagem de programa√ß√£o Go trar√° suporte experimental para m√≥dulos - um novo sistema de gerenciamento de depen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Introdu√ß√£o aos m√≥dulos Go</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421411/"><p>  O pr√≥ximo lan√ßamento da vers√£o 1.11 da linguagem de programa√ß√£o Go trar√° suporte experimental para <em>m√≥dulos</em> - um novo sistema de gerenciamento de depend√™ncias para Go.  (tradu√ß√£o da nota: a <a href="">libera√ß√£o ocorreu</a> ) </p><br><p>  Recentemente, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">eu j√° escrevi um pequeno post sobre isso</a> .  Desde ent√£o, algo mudou um pouco, e nos aproximamos do lan√ßamento, ent√£o parece-me que chegou a hora de um novo artigo - vamos adicionar mais pr√°tica. </p><br><p>  Ent√£o, eis o que faremos: crie um novo pacote e fa√ßa alguns lan√ßamentos para ver como ele funciona. </p><a name="habracut"></a><br><h2 id="sozdanie-modulya">  Cria√ß√£o de m√≥dulo </h2><br><p> Primeiro, crie nosso pacote.  Vamos cham√°-lo de testmod.  Detalhe importante: <strong>o diret√≥rio do pacote deve ser colocado <em>fora do</em> seu <code>$GOPATH</code> , porque, dentro dele, o suporte ao m√≥dulo √© desativado por padr√£o</strong> .  Os m√≥dulos Go s√£o o primeiro passo para um abandono completo do <code>$GOPATH</code> no futuro. </p><br><pre> <code class="hljs dos">$ <span class="hljs-built_in"><span class="hljs-built_in">mkdir</span></span> testmod $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> testmod</code> </pre> <br><p>  Nosso pacote √© bastante simples: </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> testmod <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-comment"><span class="hljs-comment">// Hi returns a friendly greeting func Hi(name string) string { return fmt.Sprintf("Hi, %s", name) }</span></span></code> </pre> <br><p>  O pacote est√° pronto, mas ainda n√£o √© um <em>m√≥dulo</em> .  Vamos consertar. </p><br><pre> <code class="hljs go">$ <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> mod init github.com/robteix/testmod <span class="hljs-keyword"><span class="hljs-keyword">go</span></span>: creating <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">go</span></span>.mod: module github.com/robteix/testmod</code> </pre> <br><p>  Temos um novo arquivo chamado <code>go.mod</code> no diret√≥rio do pacote com o seguinte conte√∫do: </p><br><pre> <code class="hljs ruby"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">github</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">robteix</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">testmod</span></span></span></span></code> </pre> <br><p>  Um pouco, mas √© isso que transforma nosso pacote em um <em>m√≥dulo</em> . </p><br><p>  Agora podemos enviar esse c√≥digo para o reposit√≥rio: </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> git init <span class="hljs-variable"><span class="hljs-variable">$</span></span> git add * <span class="hljs-variable"><span class="hljs-variable">$</span></span> git commit <span class="hljs-literal"><span class="hljs-literal">-am</span></span> <span class="hljs-string"><span class="hljs-string">"First commit"</span></span> <span class="hljs-variable"><span class="hljs-variable">$</span></span> git push <span class="hljs-literal"><span class="hljs-literal">-u</span></span> origin master</code> </pre> <br><p>  At√© agora, quem quiser usar nosso pacote se candidatar√°, <code>go get</code> : </p><br><pre> <code class="hljs swift">$ go <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> github.com/robteix/testmod</code> </pre> <br><p>  E este comando traria o c√≥digo mais recente da ramifica√ß√£o <code>master</code> .  Essa op√ß√£o ainda funciona, mas seria melhor se n√£o o fizermos mais, porque agora "existe uma maneira melhor".  Receber c√≥digo diretamente da ramifica√ß√£o <code>master</code> √©, de fato, perigoso, pois nunca sabemos ao certo que os autores do pacote n√£o fizeram altera√ß√µes que ‚Äúquebrar√£o‚Äù nosso c√≥digo.  Para resolver esse problema, os m√≥dulos Go foram inventados. </p><br><h2 id="nebolshoe-otstuplenie-o-versionirovanii-moduley">  Uma pequena digress√£o sobre os m√≥dulos de vers√£o </h2><br><p>  Os m√≥dulos Go s√£o versionados, al√©m de haver alguma especificidade de vers√µes individuais.  Voc√™ precisar√° se familiarizar com os conceitos subjacentes ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">controle de vers√£o sem√¢ntico</a> . </p><br><p>  Al√©m disso, o Go usa tags de reposit√≥rio ao procurar vers√µes, e algumas vers√µes diferem das demais: por exemplo, as vers√µes 2 e mais devem ter um caminho de importa√ß√£o diferente do das vers√µes 0 e 1 (chegaremos a isso). </p><br><p>  Por padr√£o, o Go baixa a <em>vers√£o</em> mais <em>recente, que possui uma tag</em> dispon√≠vel no reposit√≥rio. <br>  Esse √© um recurso importante, pois pode ser usado ao trabalhar com a ramifica√ß√£o <code>master</code> . </p><br><p>  Para n√≥s agora, √© importante que, ao criar o lan√ßamento do nosso pacote, precisamos colocar um r√≥tulo com a vers√£o no reposit√≥rio. </p><br><p>  Vamos fazer isso. </p><br><h2 id="delaem-svoy-pervyy-reliz">  Fazendo seu primeiro lan√ßamento </h2><br><p>  Nosso pacote est√° pronto e podemos "lan√ß√°-lo" para o mundo inteiro.  Fazemos isso usando r√≥tulos com vers√£o.  Deixe o n√∫mero da vers√£o ser 1.0.0: </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> git tag v1.<span class="hljs-number"><span class="hljs-number">0.0</span></span> <span class="hljs-variable"><span class="hljs-variable">$</span></span> git push -<span class="hljs-literal"><span class="hljs-literal">-tags</span></span></code> </pre> <br><p>  Esses comandos criam uma tag no meu reposit√≥rio do Github que marca o commit atual como vers√£o 1.0.0. </p><br><p>  O Go n√£o insiste nisso, mas √© uma boa id√©ia criar uma nova ramifica√ß√£o adicional ("v1") para a qual possamos enviar patches. </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> git checkout <span class="hljs-literal"><span class="hljs-literal">-b</span></span> v1 <span class="hljs-variable"><span class="hljs-variable">$</span></span> git push <span class="hljs-literal"><span class="hljs-literal">-u</span></span> origin v1</code> </pre> <br><p>  Agora podemos trabalhar no ramo <code>master</code> sem nos preocuparmos com a possibilidade de quebrar nossa vers√£o. </p><br><h2 id="ispolzovanie-nashego-modulya">  Usando nosso m√≥dulo </h2><br><p>  Vamos usar o m√≥dulo criado.  Escreveremos um programa simples que importa nosso novo pacote: </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/robteix/testmod"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { fmt.Println(testmod.Hi(<span class="hljs-string"><span class="hljs-string">"roberto"</span></span>)) }</code> </pre> <br><p>  At√© agora, voc√™ deve <code>go get github.com/robteix/testmod</code> para baixar o pacote, mas com os m√≥dulos fica mais interessante.  Primeiro, precisamos ativar o suporte ao m√≥dulo em nosso novo programa. </p><br><pre> <code class="hljs matlab">$ go <span class="hljs-built_in"><span class="hljs-built_in">mod</span></span> init <span class="hljs-built_in"><span class="hljs-built_in">mod</span></span></code> </pre> <br><p>  Como voc√™ provavelmente esperava, com base no que leu anteriormente, um novo arquivo <code>go.mod</code> apareceu no diret√≥rio com o nome do m√≥dulo: </p><br><pre> <code class="hljs ruby"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mod</span></span></span></span></code> </pre> <br><p>  A situa√ß√£o se torna ainda mais interessante quando tentamos montar nosso programa: </p><br><pre> <code class="hljs go">$ <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> build <span class="hljs-keyword"><span class="hljs-keyword">go</span></span>: finding github.com/robteix/testmod v1<span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">go</span></span>: downloading github.com/robteix/testmod v1<span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span></code> </pre> <br><p>  Como voc√™ pode ver, o comando <code>go</code> encontrou e baixou automaticamente o pacote importado pelo nosso programa. <br>  Se verificarmos nosso arquivo <code>go.mod</code> , veremos que algo mudou: </p><br><pre> <code class="hljs lua">module <span class="hljs-built_in"><span class="hljs-built_in">mod</span></span> <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> github.com/robteix/testmod v1<span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span></code> </pre> <br><p>  E temos outro novo arquivo chamado <code>go.sum</code> , que cont√©m os hashes dos pacotes para verificar a vers√£o e os arquivos corretos. </p><br><pre> <code class="hljs matlab">github.com/robteix/testmod v1<span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> h1:<span class="hljs-number"><span class="hljs-number">9</span></span>EdH0EArQ/rkpss9Tj8gUnwx3w5p0jkzJrd5tRAhxnA= github.com/robteix/testmod v1<span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/go.<span class="hljs-built_in"><span class="hljs-built_in">mod</span></span> h1:UVhi5McON9ZLc5kl5iN2bTXlL6ylcxE9VInV71RrlO8=</code> </pre> <br><h2 id="delaem-reliz-reliz-s-ispravleniem-oshibki">  Fazendo um lan√ßamento de corre√ß√£o de bug </h2><br><p>  Agora, digamos que encontramos um problema em nosso pacote: n√£o h√° pontua√ß√£o na sauda√ß√£o! <br>  Algumas pessoas ficam furiosas, porque nossa sauda√ß√£o amig√°vel n√£o √© mais t√£o amig√°vel. <br>  Vamos corrigir isso e lan√ßar uma nova vers√£o: </p><br><pre> <code class="hljs pgsql">// Hi <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> a friendly greeting func Hi(<span class="hljs-type"><span class="hljs-type">name</span></span> string) string { - <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fmt.Sprintf("Hi, %s", <span class="hljs-type"><span class="hljs-type">name</span></span>) + <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fmt.Sprintf("Hi, %s!", <span class="hljs-type"><span class="hljs-type">name</span></span>) }</code> </pre> <br><p>  Fizemos essa altera√ß√£o diretamente na ramifica√ß√£o da <code>v1</code> , porque ela n√£o tem nada a ver com o que faremos a seguir na ramifica√ß√£o da <code>v2</code> , mas na vida real, talvez voc√™ deva fazer essas altera√ß√µes no <code>master</code> e depois suport√°-las na <code>v1</code> .  De qualquer forma, a corre√ß√£o deve estar na ramifica√ß√£o <code>v1</code> e precisamos marcar isso como uma nova vers√£o. </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> git commit <span class="hljs-literal"><span class="hljs-literal">-m</span></span> <span class="hljs-string"><span class="hljs-string">"Emphasize our friendliness"</span></span> testmod.go <span class="hljs-variable"><span class="hljs-variable">$</span></span> git tag v1.<span class="hljs-number"><span class="hljs-number">0.1</span></span> <span class="hljs-variable"><span class="hljs-variable">$</span></span> git push -<span class="hljs-literal"><span class="hljs-literal">-tags</span></span> origin v1</code> </pre> <br><h2 id="obnovlenie-moduley">  Atualiza√ß√£o de M√≥dulos </h2><br><p>  Por padr√£o, o Go n√£o atualiza os m√≥dulos sem demanda.  "E isso √© bom", j√° que todos n√≥s gostar√≠amos de previsibilidade em nossas constru√ß√µes.  Se os m√≥dulos Go forem atualizados automaticamente sempre que uma nova vers√£o for lan√ßada, retornaremos √† "idade das trevas antes do Go1.11".  Mas n√£o, precisamos <em>dizer</em> ao Go para atualizar os m√≥dulos para n√≥s. </p><br><p>  E faremos isso com a ajuda de nosso velho amigo - <code>go get</code> : </p><br><ul><li><p>  execute <code>go get -u</code> para usar a √∫ltima vers√£o <em>secund√°ria ou de patch menor</em> (ou seja, o comando ser√° atualizado da 1.0.0 para, digamos, 1.0.1 ou 1.1.0, se essa vers√£o estiver dispon√≠vel) </p><br></li><li><p>  execute <code>go get -u=patch</code> para usar a vers√£o mais recente do patch (ou seja, o pacote ser√° atualizado para 1.0.1, mas <em>n√£o</em> para 1.1.0) </p><br></li><li><p>  execute <code>go get package@version</code> para atualizar para uma vers√£o espec√≠fica (por exemplo, <code>github.com/robteix/testmod@v1.0.1</code> ) </p><br></li></ul><br><p>  N√£o h√° nenhuma maneira nesta lista para atualizar para a vers√£o <em>principal</em> mais recente.  H√° uma boa raz√£o para isso, como veremos em breve. </p><br><p>  Como nosso programa usou a vers√£o 1.0.0 do nosso pacote e acabamos de criar a vers√£o 1.0.1, <em>qualquer um</em> dos seguintes comandos nos atualizar√° para a 1.0.1: </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> go get <span class="hljs-literal"><span class="hljs-literal">-u</span></span> <span class="hljs-variable"><span class="hljs-variable">$</span></span> go get <span class="hljs-literal"><span class="hljs-literal">-u</span></span>=patch <span class="hljs-variable"><span class="hljs-variable">$</span></span> go get github.com/robteix/testmod@v1.<span class="hljs-number"><span class="hljs-number">0.1</span></span></code> </pre> <br><p>  Depois de iniciar (digamos, <code>go get -u</code> ), nosso <code>go.mod</code> mudou: </p><br><pre> <code class="hljs lua">module <span class="hljs-built_in"><span class="hljs-built_in">mod</span></span> <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> github.com/robteix/testmod v1<span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span></code> </pre> <br><h2 id="mazhornye-versii">  Vers√£o principal </h2><br><p>  De acordo com a especifica√ß√£o do controle de vers√£o sem√¢ntico, a vers√£o principal <em>difere</em> da vers√£o secund√°ria.  As vers√µes principais podem quebrar a compatibilidade com vers√µes anteriores.  Do ponto de vista dos m√≥dulos Go, a vers√£o principal √© um <em>pacote</em> completamente <em>diferente</em> . </p><br><p>  Pode parecer selvagem no come√ßo, mas faz sentido: duas vers√µes da biblioteca que s√£o incompat√≠veis entre si s√£o duas bibliotecas diferentes. </p><br><p>  Vamos fazer uma grande mudan√ßa em nosso pacote.  Suponha que, com o tempo, tenha ficado claro para n√≥s que nossa API √© muito simples, muito limitada para os casos de usu√°rios, portanto, precisamos alterar a fun√ß√£o <code>Hi()</code> para aceitar o idioma de boas-vindas como par√¢metro: </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> testmod <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"errors"</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> ) <span class="hljs-comment"><span class="hljs-comment">// Hi returns a friendly greeting in language lang func Hi(name, lang string) (string, error) { switch lang { case "en": return fmt.Sprintf("Hi, %s!", name), nil case "pt": return fmt.Sprintf("Oi, %s!", name), nil case "es": return fmt.Sprintf("¬°Hola, %s!", name), nil case "fr": return fmt.Sprintf("Bonjour, %s!", name), nil default: return "", errors.New("unknown language") } }</span></span></code> </pre> <br><p>  Os programas existentes que usam nossa API ser√£o interrompidos porque: a) n√£o passam o idioma como par√¢metro eb) n√£o esperam um retorno de erro.  Nossa nova API n√£o √© mais compat√≠vel com a vers√£o 1.x, portanto, conhe√ßa a vers√£o 2.0.0. </p><br><p>  Eu mencionei anteriormente que algumas vers√µes t√™m recursos, e agora esse √© o caso. <br>  <strong>A vers√£o 2 <em>ou posterior</em> deve alterar o caminho de importa√ß√£o.</strong>  Agora, essas s√£o bibliotecas diferentes. </p><br><p>  Faremos isso adicionando um novo <em>caminho</em> com <em>vers√£o</em> ao nome do nosso m√≥dulo. </p><br><pre> <code class="hljs ruby"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">github</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">robteix</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">testmod</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">v2</span></span></span></span></code> </pre> <br><p>  Tudo o resto √© o mesmo: empurre, coloque um r√≥tulo que seja v2.0.0 (e, opcionalmente, fa√ßa uma ramifica√ß√£o v2) </p><br><pre> <code class="hljs smalltalk"><span class="hljs-string"><span class="hljs-string">$ </span></span>git commit testmod.go -m <span class="hljs-comment"><span class="hljs-comment">"Change Hi to allow multilang"</span></span> <span class="hljs-string"><span class="hljs-string">$ </span></span>git checkout -b v2 # optional but recommended <span class="hljs-string"><span class="hljs-string">$ </span></span>echo <span class="hljs-comment"><span class="hljs-comment">"module github.com/robteix/testmod/v2"</span></span> &gt; go.mod <span class="hljs-string"><span class="hljs-string">$ </span></span>git commit go.mod -m <span class="hljs-comment"><span class="hljs-comment">"Bump version to v2"</span></span> <span class="hljs-string"><span class="hljs-string">$ </span></span>git tag v2<span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-string"><span class="hljs-string">$ </span></span>git push --tags origin v2 # or master if we don<span class="hljs-string"><span class="hljs-string">'t have a branch</span></span></code> </pre> <br><h2 id="obnovlenie-mazhornoy-versii">  Atualiza√ß√£o da vers√£o principal </h2><br><p>  Embora tenhamos lan√ßado uma nova vers√£o incompat√≠vel de nossa biblioteca, os programas existentes <em>n√£o foram interrompidos</em> porque continuam a usar a vers√£o 1.0.1. <br>  <code>go get -u</code> <em>n√£o far√° o</em> download da vers√£o 2.0.0. </p><br><p>  Mas, em algum momento, eu, como usu√°rio da biblioteca, talvez queira atualizar para a vers√£o 2.0.0, porque, por exemplo, sou um daqueles usu√°rios que precisam de suporte para v√°rios idiomas. </p><br><p>  Para atualizar, preciso alterar meu programa de acordo: </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/robteix/testmod/v2"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { g, err := testmod.Hi(<span class="hljs-string"><span class="hljs-string">"Roberto"</span></span>, <span class="hljs-string"><span class="hljs-string">"pt"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>(err) } fmt.Println(g) }</code> </pre> <br><p>  Agora, quando executo o <code>go build</code> , ele "fecha" e baixa a vers√£o 2.0.0 para mim.  Observe que, embora o caminho de importa√ß√£o agora termine em "v2", o Go ainda se refere ao m√≥dulo por seu nome real ("testmod"). </p><br><p>  Como eu disse, a vers√£o principal √©, sob todos os aspectos, um pacote diferente.  Esses dois m√≥dulos Go n√£o est√£o conectados de forma alguma.  Isso significa que podemos ter duas vers√µes incompat√≠veis em um bin√°rio: </p><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/robteix/testmod"</span></span> testmodML <span class="hljs-string"><span class="hljs-string">"github.com/robteix/testmod/v2"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { fmt.Println(testmod.Hi(<span class="hljs-string"><span class="hljs-string">"Roberto"</span></span>)) g, err := testmodML.Hi(<span class="hljs-string"><span class="hljs-string">"Roberto"</span></span>, <span class="hljs-string"><span class="hljs-string">"pt"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>(err) } fmt.Println(g) }</code> </pre> <br><p>  E isso elimina o problema comum com o gerenciamento de depend√™ncias quando as depend√™ncias dependem de vers√µes diferentes da mesma biblioteca. </p><br><h2 id="navodim-poryadok">  Colocamos as coisas em ordem </h2><br><p>  Vamos voltar √† vers√£o anterior, que usa apenas testmod 2.0.0 - se verificarmos o conte√∫do de <code>go.mod</code> , perceberemos algo: </p><br><pre> <code class="hljs lua">module <span class="hljs-built_in"><span class="hljs-built_in">mod</span></span> <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> github.com/robteix/testmod v1<span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> github.com/robteix/testmod/v2 v2<span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span></code> </pre> <br><p>  Por padr√£o, o Go n√£o remove depend√™ncias do <code>go.mod</code> at√© que voc√™ solicite.  Se voc√™ tiver depend√™ncias que n√£o s√£o mais necess√°rias e deseja limp√°-las, poder√° usar o novo comando <code>tidy</code> : </p><br><pre> <code class="hljs matlab">$ go <span class="hljs-built_in"><span class="hljs-built_in">mod</span></span> tidy</code> </pre> <br><p>  Agora s√≥ temos as depend√™ncias que realmente usamos. </p><br><h2 id="vendoring">  Vending </h2><br><p>  Por padr√£o, os m√≥dulos ignoram o <code>vendor/</code> diret√≥rio.  A id√©ia √© livrar-se gradualmente das vendas <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1</a></sup> .  Mas se ainda queremos adicionar as depend√™ncias "desanexadas" ao nosso controle de vers√£o, podemos fazer o seguinte: </p><br><pre> <code class="hljs matlab">$ go <span class="hljs-built_in"><span class="hljs-built_in">mod</span></span> vendor</code> </pre> <br><p>  A equipe criar√° o <code>vendor/</code> diret√≥rio na raiz do nosso projeto, contendo o c√≥digo fonte de todas as depend√™ncias. </p><br><p>  No entanto, a <code>go build</code> por padr√£o ainda ignora o conte√∫do deste diret√≥rio.  Se voc√™ deseja coletar depend√™ncias do <code>vendor/</code> diret√≥rio, solicite explicitamente. </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> go build <span class="hljs-literal"><span class="hljs-literal">-mod</span></span> vendor</code> </pre> <br><p>  Suponho que muitos desenvolvedores que desejam usar o vending executem <code>go build</code> , como de costume, em suas m√°quinas e usem <code>-mod vendor</code> em seu IC. </p><br><p>  Novamente, os m√≥dulos Go est√£o se afastando da ideia de vender para usar proxies para m√≥dulos para aqueles que n√£o desejam depender diretamente dos servi√ßos de controle de vers√£o upstream. </p><br><p>  Existem maneiras de garantir que <code>go</code> rede n√£o esteja dispon√≠vel (por exemplo, usando <code>GOPROXY=off</code> ), mas este √© o t√≥pico do pr√≥ximo artigo. </p><br><h2 id="zaklyuchenie">  Conclus√£o </h2><br><p>  O artigo pode parecer complicado para algu√©m, mas √© porque tentei explicar muito de uma vez.  A realidade √© que os m√≥dulos Go s√£o geralmente simples hoje - n√≥s, como sempre, importamos o pacote para o nosso c√≥digo, e a equipe <code>go</code> faz o resto por n√≥s.  As depend√™ncias s√£o carregadas automaticamente durante a montagem. </p><br><p>  Os m√≥dulos tamb√©m eliminam a necessidade de <code>$GOPATH</code> , que foi um obst√°culo para os novos desenvolvedores do Go que tiveram problemas para entender por que deveriam colocar algo em um diret√≥rio espec√≠fico. </p><br><p><del>  A venda (n√£o oficial) foi descontinuada em favor do uso de um proxy. </del>  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1</a></sup> <br>  Eu posso criar um artigo separado sobre proxies para os m√≥dulos Go. </p><br><p>  Notas: </p><br><p>  <sup>1</sup> Acho que essa √© uma express√£o muito alta e alguns podem ter a impress√£o de que as vendas est√£o sendo removidas agora.  Isto n√£o √© verdade.  A venda ainda est√° funcionando, embora um pouco diferente do que antes.  Aparentemente, h√° um desejo de substituir a venda por algo melhor, por exemplo, um proxy (n√£o um fato).  At√© agora, isso √© simplesmente a busca de uma solu√ß√£o melhor.  A venda n√£o desaparecer√° at√© que um bom substituto seja encontrado (se houver). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt421411/">https://habr.com/ru/post/pt421411/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt421399/index.html">An√°lise do Backdoor do Outlook do Cybergroup Turla</a></li>
<li><a href="../pt421401/index.html">Anatomia de sistemas de recomenda√ß√£o. Parte dois</a></li>
<li><a href="../pt421403/index.html">Semana de Seguran√ßa 32: Drama Fortnite-Android</a></li>
<li><a href="../pt421407/index.html">Reuni√£o t√©cnica em S√£o Petersburgo, 13 de setembro - Como fazer grandes altera√ß√µes no back-end</a></li>
<li><a href="../pt421409/index.html">Coisas de espi√£o: mantenha um segredo</a></li>
<li><a href="../pt421413/index.html">Acesso adequado aos m√©todos de interface padr√£o atrav√©s da reflex√£o em Java 8, 9, 10</a></li>
<li><a href="../pt421415/index.html">Salto m√°gico - lixo triste</a></li>
<li><a href="../pt421417/index.html">M√°quina de caf√© para viciados em caf√© ou m√°quina de caf√© m√≥vel Wacaco</a></li>
<li><a href="../pt421419/index.html">Ode ao n√≠quel ‚Äúespumado‚Äù, safiras inexistentes e ao vice-ministro sovi√©tico: o ic√¥nico OTTO SX-P1 no Jap√£o, nos EUA e na URSS</a></li>
<li><a href="../pt421421/index.html">LAppS: Meio milh√£o de mensagens de 1 KB-WebSocket por segundo com TLS em uma CPU</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>