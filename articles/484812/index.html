<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéØ üë®üèΩ‚Äçüíª ü§≤üèø Mi experiencia con Plesk üìê üßëüèø‚Äçü§ù‚Äçüßëüèº ü§üüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quiero compartir algunas impresiones sobre la necesidad o lo innecesario de algo como un panel de control para un proyecto web comercial de un solo se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mi experiencia con Plesk</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/484812/">  Quiero compartir algunas impresiones sobre la necesidad o lo innecesario de algo como un panel de control para un proyecto web comercial de un solo servidor con un administrador de tiempo parcial.  La historia comenz√≥ hace un par de a√±os cuando conocidos de conocidos me pidieron que acompa√±ara la compra de un negocio, un sitio de noticias, desde un punto de vista t√©cnico.  Era necesario obtener una peque√±a idea de lo que estaba funcionando, asegurarse de que todos los detalles necesarios se transfirieran en la forma y el volumen adecuados, y determinar estrat√©gicamente qu√© podr√≠a mejorarse. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/h_/nh/e1/h_nhe1ce2n1r02nwfk-v2coszz0.png"></div><br>  El trato tuvo lugar, el violinista ya no era necesario.  El final  En realidad no <br><a name="habracut"></a><br>  El sitio estaba girando en un VMk de 4 n√∫cleos de doble n√∫cleo en Linode, en algunos Debian5 cubiertos de musgo con un tiempo de actividad de 400 d√≠as y una lista de paquetes no actualizados.  Elemento web en Samopisny TsMSke, nginx, php5.3 FPM, mysql sintonizado Percona.  En principio, funcion√≥. <br><br>  Paralelamente a las conversaciones conmigo, el nuevo propietario estaba buscando un programador para llevar el proyecto a las expectativas.  Lo encontr√©  El programador evalu√≥ el tr√°fico y los vol√∫menes y decidi√≥ que pod√≠a optimizar y administrar los costos.  Migr√≥ todo el sitio a un alojamiento compartido de 700 rublos bajo el control de su IS **** er habitual.  Unos d√≠as m√°s tarde, nuevamente una llamada del propietario: "todo se est√° desacelerando y parece que est√°bamos rotos".  Trat√© de corregir la situaci√≥n a trav√©s del panel, pero despu√©s de un tiempo de intentos infructuosos de cambiar la versi√≥n del PCP o el controlador de fcgi a fpm, me di por vencido y me met√≠ en el caparaz√≥n.  All√≠ encontr√© la depuraci√≥n incluida, que brillaba en todo Internet con una contrase√±a de un m√∫sculo, 777 en algunas carpetas que, en ese momento, se estaban agrietando por una avalancha de malvari y un juego similar.  El propietario se dio cuenta y decidi√≥ que ahorrar en el alojamiento, el programador y el administrador, que mirar√≠an con un ojo c√≥mo iban las cosas, est√° mal. <br><br>  Vamos a RuVDS.  Un poco m√°s cerca que el Linode brit√°nico, y si de repente quieres almacenar datos personales y todo esto, no tienes que mudarte a ning√∫n otro lado.  Dado que el proyecto estaba planeado para expandirse, tomaron el VMKU "para crecer": 4 n√∫cleos, 8 conciertos de memoria, 80 GB de disco.  No es que no sepa c√≥mo usar las configuraciones de nginx con mis manos, simplemente no ten√≠a el entusiasmo de hacer este proyecto tan √≠ntimamente (ver arriba sobre tiempo parcial).  Porque, coloque Plesk (aqu√≠ omitir√© los detalles de instalaci√≥n, porque en general no est√°n all√≠: inici√© el instalador, configur√© la contrase√±a para el administrador, ingres√© la clave, todo), en ese momento era 17.0.  La configuraci√≥n b√°sica funciona razonablemente fuera de la caja, hay fail2ban y las √∫ltimas versiones disponibles de PHP, nginx. <br><br>  Probablemente valga la pena detenerse y explicar por qu√©.  Como rara vez hago esas cosas, y no tengo herramientas especiales y un conjunto de espacios en blanco para cada caso, estaba claro que se necesitaba alg√∫n tipo de automatizaci√≥n de las cosas b√°sicas, primero, r√°pido, segundo, seguro, tercero todas las mejores pr√°cticas alguien ya lo ha implementado. <br><br>  Entonces, listo.  Ahorr√≥ tiempo decentemente, reiniciando el sitio en el nuevo servidor result√≥ ser casi instant√°neo.  Quedaba por jugar con la configuraci√≥n muscular, d√°ndole la mitad de la memoria y aumentando el n√∫mero de agrupaciones de b√∫fer, y dando la mitad de los n√∫cleos a nginx (Splash no toca las configuraciones globales), y entra en el shell durante un par de d√≠as para ver las estad√≠sticas de mysqltuner.  S√≠, y compr√© un ImunifyAV pagado del cat√°logo de extensiones para deshacerme del malvari inundado.  Hab√≠a algo 11,000 archivos infectados.  La abominaci√≥n es que piezas de c√≥digo ofuscadas se vierten en las est√°ticas, y rozarlas con las manos ser√≠a completamente aburrido.  Al principio prob√© ClamAV, pero result√≥ que √©l no tom√≥ esas cosas, pero ImunifyAV s√≠ pudo.  Adem√°s, los archivos curados permanecen en condiciones de funcionamiento, solo se elimina una pieza con el malware. <br><br>  La aritm√©tica es simple: $ 50 por mes para VMKu, $ 10 por Splash (en realidad menos, porque lo compraste inmediatamente por un a√±o con un descuento de dos meses) y $ 3 por un antivirus.  O muchas maletas de dinero para mi tiempo, que gastar√≠a en el servidor al principio, rastrillando estos establos manualmente.  El propietario est√° bastante contento con esta alineaci√≥n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bed/f5c/257/bedf5c257f2211a4c9a20db4f3662354.png"></div><br>  Mientras tanto, encontraron un nuevo programador.  Acordamos con √©l la distribuci√≥n de la responsabilidad, creamos un subdominio para la versi√≥n de prueba y se comenz√≥ a trabajar.  Vio una nueva versi√≥n del sitio en Laravel, y mir√© a fail2ban%). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/567/ed3/0eb/567ed30eba271841e9ba2ca1628c908c.png"></div><br>  Curiosamente, el flujo de curiosos no se detiene, y siempre hay alrededor de un centenar de direcciones en la lista de las prohibidas.  El efecto es interesante: en particular, por lo general, cuando voy al shell, veo unos 20000-30000 intentos fallidos de ingresar a trav√©s de SSH en el saludo.  Con fail2ban activado, alrededor de 70. Esfuerzo invertido: 0. Desafortunadamente, hubo una ca√≠da de alquitr√°n.  Por defecto, WAF (modsecurity) estaba "semi-habilitado": en modo descubrimiento.  Es decir, escribi√≥ actividad sospechosa en el registro, pero en realidad no tom√≥ ninguna medida.  Y fail2ban ley√≥ indiscriminadamente todos los registros, de acuerdo con las c√°rceles incluidas, y empap√≥ todo lo que se mov√≠a.  Por lo tanto, prohibimos la mitad del personal editorial: D.  Tuve que deshabilitar esta c√°rcel y poner las direcciones IP necesarias en la lista blanca para mayor confiabilidad.  El esfuerzo est√° invertido: pinchar dos veces con el mouse y ense√±ar a los editores a decir su direcci√≥n IP. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e2a/59f/5d9/e2a59f5d93ccd9a0345d82631cfed146.png"></div><br>  Lo que al programador le gust√≥ de inmediato fue la capacidad de cargar bases de datos directamente en el panel y el acceso r√°pido a phpMyAdmin <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cca/0ef/a51/cca0efa516535e771efaa46456b891b9.png"></div><br>  Lo que me gust√≥: registros y copias de seguridad.  Los registros se escriben y se giran fuera de la caja;  Las copias de seguridad se configuran de manera muy simple.  En el momento m√°s lento, se realiza una copia de seguridad completa, en alg√∫n lugar de 10 conciertos, y luego todos los d√≠as en incremental, 200 megabytes, durante una semana.  Recuperaci√≥n granular a un archivo o base de datos espec√≠ficos.  Si necesita restaurar desde incremental, entonces no necesita retorcerse primero con el completo y el restaurador de toda la cadena, Splash hace todo por s√≠ mismo.  Puede cargar copias de seguridad en cualquier lugar: en ftp, en dropbox, s3 bucket, google drive y m√°s. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f1/46d/d83/9f146dd83e49e565596513bb1b32bea2.png"></div><br>  D√≠a F: el programador finalmente termin√≥ el nuevo motor, lo vertimos en el producto, importamos los datos antiguos y nos sentamos a elegir el color de su futuro Maserati.  Todav√≠a estamos eligiendo. <br><br>  Los primeros problemas comenzaron.  Se esperaba que el nuevo sitio fuera m√°s pesado que el anterior, pero el rastrillo real era que Yandex.Zen se usaba, entre otras cosas, para atraer tr√°fico, que atrap√≥ a los visitantes en lotes.  El sitio se dobl√≥ a 150 conexiones simult√°neas (no estoy hablando de RPS, porque no lo med√≠).  Comenzamos a tocar botones y girar perillas en el √°rea de configuraci√≥n de php_fpm: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c0/f96/3b3/8c0f963b3771a9452e8dee1ea82ac6cc.png"></div><br>  Op, ya tiene 500 conexiones.  A medida que la tarjeta de cr√©dito se aplica a los medios de promoci√≥n, las olas de tr√°fico se hacen m√°s grandes.  El pr√≥ximo hito son 1000 conexiones concurrentes.  Aqu√≠ tuve que abstenerme del c√≥digo y mirar el m√∫sculo de mi alma.  El chapoteo no ayud√≥, pero realmente no lo esperaban.  Activaron el registro lento de consultas, colgaron √≠ndices en la base de datos, eliminaron consultas innecesarias del c√≥digo, peinaron la configuraci√≥n de mysql una vez m√°s siguiendo el consejo de mysqltuner. <br><br>  Nuevo desaf√≠o: 2000 conexiones.  Acabo de lanzar la versi√≥n Plesk 17.8, en la que, entre otras cosas, atornillamos el almacenamiento en cach√© de nginx.  Actualizado (sorprendentemente f√°cil).  Lo intentamos  Funciona!  Y luego entraron suavemente, la alimentaci√≥n Yandex.Zen dej√≥ de funcionar.  El sitio funciona, el feed no funciona.  La alimentaci√≥n no funciona, no hay tr√°fico.  El ambiente se est√° calentando.  Bajo la presi√≥n de las circunstancias y la falta de imaginaci√≥n, inmediatamente sub√≠ a nginx y encontr√© lo que estaba buscando.  Resulta que en alg√∫n momento, el est√∫pido nginx almacen√≥ en cach√© el error 500 sobre la marcha como respuesta al Yandex get feed.xml.  Corregido agregando excepciones a la configuraci√≥n de cach√©: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c5/168/69b/8c516869b5e3fdb0ef6c79774d829940.png"></div><br>  Est√° claro que el propietario necesita TODAV√çA, las olas est√°n aumentando lentamente.  Mientras estamos lidiando con eso, pero comenzamos a experimentar con memcached por adelantado, ya que Laravel lo admite casi desde el primer momento.  De alguna manera no quer√≠a poner memcached con mis manos para "jugar", as√≠ que instal√© la imagen del acoplador.  Directamente desde el panel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07e/083/342/07e083342590e63f033747c7dfe7f013.png"></div><br>  Bueno, estoy mintiendo, tuve que ir al shell y poner el m√≥dulo a trav√©s de pecl.  Directamente de acuerdo con las <a href="https://support.plesk.com/hc/en-us/articles/115001544133-Unable-to-install-memcached-PHP-module-memcached-support-requires-libmemcached">instrucciones</a> .  No hay nada que decir sobre el aumento en el rendimiento, no hubo suficientes flujos de entrada grandes.  El motor del sitio recogido en localhost: 11211, se muestran las estad√≠sticas, la memoria se est√° comiendo.  Si te gusta, veamos qu√© hacer a continuaci√≥n.  O d√©jalo as√≠ o pon lo "real" en el Eje.  O prueba redis de la misma manera <br><br>  Luego necesitaba adjuntar una lista de correo.  Sin rel√©s, solo autenticaci√≥n SMTP.  Obtuve una direcci√≥n de correo, a trav√©s de sus detalles a trav√©s de PHP hacemos el bolet√≠n. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/107/53e/269/10753e269e8ea0736ba771a506e04c28.png"></div><br>  No hace mucho tiempo, sali√≥ Plesk Obsidian (18.0), actualizado seg√∫n la experiencia pasada sin temor.  Todo sali√≥ muy bien, no hay nada de qu√© hablar.  De lo agradable: la interfaz ha mejorado mucho en calidad, se ha modernizado y se ha vuelto m√°s conveniente en algunos lugares.  Genial pieza Advanced Monitoring en Grafana. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/921/e9d/230/921e9d230ede253edc7e479a3a435c94.png"></div><br>  Todav√≠a no lo he descubierto, pero puede, por ejemplo, configurar alertas para cualquier par√°metro en el correo.  Para el due√±o, jajaja. <br><br>  Como estoy hablando de la interfaz, es adaptativa y funciona muy bien en el tel√©fono.  En las primeras etapas, mientras est√°bamos tratando de encontrar la configuraci√≥n √≥ptima de PHP y otras cosas, ayud√≥ mucho.  Y especialmente cuando un programador en un ataque de entusiasmo por el trabajo hace algo a las 23 en punto, y bebo vodka en un ba√±o en un ataque de entusiasmo por el trabajo, y URGENTEMENTE necesito cambiar algo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/865/dbc/dd9/865dbcdd9b452936c3450cae4067bbc9.png"></div><br>  Ah por cierto.  En la imagen, apareci√≥ PHP Composer.  Todav√≠a no hemos jugado con √©l, pero, digamos, para el mismo Laravel, puede guardar un par de inicios de sesi√≥n en el shell y algo de tiempo para instalar dependencias.  El mismo sistema existe para Node.JS y Ruby. <br><br>  Con SSL, todo es simple.  Si el dominio se resuelve donde deber√≠a estar, Let's Encrypt se realiza con un solo clic y se actualiza a√∫n m√°s por s√≠ mismo, tanto en el dominio como en los subdominios, e incluso en los servicios de correo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ffe/e59/c84/ffee59c848d2cdc814028a527fbeeda7.png"></div><br>  Plesk, como software, es actualmente bastante agradable y estable.  Se actualiza a s√≠ mismo y el Eje es silencioso, consume pocos recursos, funciona sin problemas.  Ni siquiera recuerdo que en alg√∫n lugar pis√© algo, lo que ser√≠a un defecto claro en el producto.  Por supuesto, hubo problemas, pero se debieron a la imperfecci√≥n de la configuraci√≥n o en alg√∫n lugar de la uni√≥n, por lo que no hab√≠a nada de qu√© quejarse.  Las impresiones de trabajar con Splash son generalmente agradables.  Lo que falta en √©l, y uno debe entender esto, es cualquier (cualquier) agrupamiento.  Ni LB ni HA.  Puede intentarlo, pero habr√° tanto esfuerzo invertido que es mejor hacer algo diferente inicialmente. <br><br>  Creo que puedes resumir.  Para el caso en que no hay administrador, o no es suficiente, cuando el precio de alojamiento y los sitios que se ejecutan en este excede, bueno, digamos 100u.e. vale la pena elegir contratar a un administrador a tiempo parcial, o comprar un software y obtener un administrador por "medio golpe", o no iniciarlo en absoluto, definitivamente tiene sentido.  Desde el punto de vista del administrador remoto, lo mismo.  10 $ por mes, ahorra tiempo y brinda flexibilidad en el trabajo por una cantidad muy grande.  Si, por ejemplo, me piden encarecidamente que tome un proyecto similar bajo el ala, insistir√© en el transporte a Plesk. <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a href="https://habr.com/ru/post/484812/">https://habr.com/ru/post/484812/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../484798/index.html">¬øPor qu√© la clasificaci√≥n r√°pida es realmente lenta? Nuevo m√©todo de ordenaci√≥n de matriz</a></li>
<li><a href="../484800/index.html">Analizador de c√≥digo fuente de Microsoft Application Inspector</a></li>
<li><a href="../484802/index.html">Modo de autodestrucci√≥n: descomposici√≥n de la c√°psula endosc√≥pica debido a la luz.</a></li>
<li><a href="../484804/index.html">¬øQu√© cifrar en un sistema corporativo? ¬øY por qu√© haces esto?</a></li>
<li><a href="../484806/index.html">Diferencia entre cPanel y obsidiana Plesk</a></li>
<li><a href="../484814/index.html">6. Fortinet Getting Started v6.0. Filtrado web y control de aplicaciones</a></li>
<li><a href="../484816/index.html">Uso de enlaces de operaciones para hacer copias de seguridad de archivos en macOS sobre la marcha</a></li>
<li><a href="../484818/index.html">El libro "C ++. La pr√°ctica de la programaci√≥n multiproceso "</a></li>
<li><a href="../484820/index.html">FAQ.Net: un programa gratuito para tomar notas para Windows con un dise√±o actualizado</a></li>
<li><a href="../484822/index.html">Blazor: c√≥mo evitar que un componente se enferme o dos enfoques para separar el c√≥digo del marcado</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>