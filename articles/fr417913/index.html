<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>„äóÔ∏è ‚úîÔ∏è üë≤üèº Optimisation du rendu d'une sc√®ne du dessin anim√© Disney "Moana". 3e partie ü§úüèª üíó üëµüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, nous allons examiner deux autres endroits o√π pbrt passe beaucoup de temps √† analyser des sc√®nes du dessin anim√© Disney "Moana" . Voyons v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Optimisation du rendu d'une sc√®ne du dessin anim√© Disney "Moana". 3e partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417913/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0d7/025/729/0d7025729325723a1c454f795c17af39.jpg" alt="image"></div><br>  Aujourd'hui, nous allons examiner deux autres endroits o√π pbrt passe beaucoup de temps √† analyser des sc√®nes du dessin anim√© Disney <em>"Moana"</em> .  Voyons voir s'il sera possible d'am√©liorer la productivit√© ici.  Cela se termine par ce qu'il est prudent de faire dans pbrt-v3.  Dans un autre article, je traiterai de la mesure dans laquelle nous pouvons aller si nous abandonnons l'interdiction des changements.  Dans ce cas, le code source sera trop diff√©rent du syst√®me d√©crit dans le livre <em>Physically Based Rendering</em> . <br><br><h2>  Optimisation de l'analyseur </h2><br>  Apr√®s les am√©liorations de performances introduites dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> , la proportion de temps pass√© dans l'analyseur pbrt, et si importante d√®s le d√©but, a naturellement augment√© encore plus.  Actuellement, l'analyseur au d√©marrage est utilis√© la plupart du temps. <br><br>  J'ai finalement rassembl√© mes forces et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mis en ≈ìuvre un tokenizer et un analyseur √©crits manuellement</a> pour les sc√®nes pbrt.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le format des fichiers de sc√®ne pbrt est</a> assez simple √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">analyser</a> : si vous ne prenez pas en compte les lignes entre guillemets, les jetons sont s√©par√©s par des espaces, et la grammaire est tr√®s simple (il n'est jamais n√©cessaire de regarder plus d'un jeton vers l'avant), mais votre propre analyseur est toujours un millier de lignes de code dont vous avez besoin √©crire et d√©boguer.  Cela m'a aid√© √† pouvoir le tester sur de nombreuses sc√®nes;  apr√®s avoir corrig√© des probl√®mes √©vidents, j'ai continu√© √† travailler jusqu'√† ce que je parvienne √† rendre exactement les m√™mes images qu'auparavant: il ne devrait pas y avoir de diff√©rences de pixels en raison du remplacement de l'analyseur.  √Ä ce stade, j'√©tais absolument s√ªr que tout avait √©t√© fait correctement. <br><a name="habracut"></a><br>  J'ai essay√© de rendre la nouvelle version aussi efficace que possible, en soumettant les fichiers d'entr√©e √† <code>mmap()</code> autant que possible et en utilisant la nouvelle impl√©mentation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>std::string_view</code></a> de C ++ 17 pour minimiser la cr√©ation de copies de cha√Ænes √† partir du contenu du fichier.  De plus, comme <code>strtod()</code> pris beaucoup de temps dans les traces pr√©c√©dentes, j'ai √©crit <a href=""><code> parseNumber()</code></a> avec un soin particulier: les entiers √† un chiffre et les entiers r√©guliers sont trait√©s s√©par√©ment, et dans le cas standard lorsque pbrt est compil√© pour utiliser des flottants 32 bits , a utilis√© <code>strtof()</code> au lieu de <code>strtod()</code> <sup>1</sup> . <br><br>  Dans le processus de cr√©ation d'une impl√©mentation du nouvel analyseur, j'avais un peu peur que l'ancien analyseur soit plus rapide: au final, flex et bison ont √©t√© d√©velopp√©s et optimis√©s depuis de nombreuses ann√©es.  Je ne pouvais pas savoir √† l'avance si tout le temps que j'√©crirais une nouvelle version serait gaspill√© jusqu'√† ce que je la termine et la fasse fonctionner correctement. <br><br>  √Ä ma grande joie, notre propre analyseur s'est av√©r√© √™tre une √©norme victoire: la g√©n√©ralisation du flex et du bison a tellement r√©duit les performances que la nouvelle version les a facilement d√©pass√©es.  Gr√¢ce au nouvel analyseur, le temps de lancement a diminu√© √† 13 min 21 s, c'est-√†-dire qu'il a acc√©l√©r√© encore 1,5 fois!  Un bonus suppl√©mentaire √©tait qu'il √©tait d√©sormais possible de supprimer tout le support flex et bison du syst√®me de construction pbrt.  Cela a toujours √©t√© un casse-t√™te, en particulier sous Windows, o√π la plupart des gens ne l'ont pas install√© par d√©faut. <br><br><h2>  Gestion de l'√©tat des graphiques </h2><br>  Apr√®s avoir consid√©rablement acc√©l√©r√© l'analyseur, un nouveau d√©tail ennuyeux est apparu: √† ce stade, environ 10% du temps de configuration a √©t√© consacr√© aux fonctions <code>pbrtAttributeBegin()</code> et <code>pbrtAttributeEnd()</code> , et la plupart de ce temps a √©t√© allou√© et lib√©r√© de la m√©moire dynamique.  Lors de la premi√®re ex√©cution, qui a dur√© 35 minutes, ces fonctions ne prenaient qu'environ 3% du temps d'ex√©cution, de sorte qu'elles pouvaient √™tre ignor√©es.  Mais avec l'optimisation, c'est toujours comme √ßa: lorsque vous commencez √† vous d√©barrasser des gros probl√®mes, les petits deviennent plus importants. <br><br>  La description de la sc√®ne pbrt est bas√©e sur l'√©tat hi√©rarchique du graphique, qui indique la transformation actuelle, le mat√©riau actuel, etc.  Vous pouvez y cr√©er des instantan√©s de l'√©tat actuel ( <code>pbrtAttributeBegin()</code> ), y apporter des modifications avant d'ajouter une nouvelle g√©om√©trie √† la sc√®ne, puis revenir √† l'√©tat d'origine ( <code>pbrtAttributeEnd()</code> ). <br><br>  L'√©tat graphique est stock√© dans une structure avec un nom inattendu ... <code>GraphicsState</code> .  Pour stocker des copies des objets <code>GraphicsState</code> dans la pile des √©tats graphiques enregistr√©s, <code>std::vector</code> .  En regardant les membres <code>GraphicsState</code> , nous pouvons supposer la source des probl√®mes - trois <code>std::map</code> , des noms aux instances de textures et de mat√©riaux: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GraphicsState</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">// ... std::map&lt;std::string, std::shared_ptr&lt;Texture&lt;Float&gt;&gt;&gt; floatTextures; std::map&lt;std::string, std::shared_ptr&lt;Texture&lt;Spectrum&gt;&gt;&gt; spectrumTextures; std::map&lt;std::string, std::shared_ptr&lt;MaterialInstance&gt;&gt; namedMaterials; };</span></span></code> </pre> <br>  En examinant ces fichiers de sc√®ne, j'ai constat√© que la plupart des cas d'enregistrement et de restauration de l'√©tat graphique sont effectu√©s dans ces lignes: <br><br><pre> <code class="cpp hljs">AttributeBegin ConcatTransform [<span class="hljs-number"><span class="hljs-number">0.981262</span></span> <span class="hljs-number"><span class="hljs-number">0.133695</span></span> <span class="hljs-number"><span class="hljs-number">-0.138749</span></span> <span class="hljs-number"><span class="hljs-number">0.000000</span></span> <span class="hljs-number"><span class="hljs-number">-0.067901</span></span> <span class="hljs-number"><span class="hljs-number">0.913846</span></span> <span class="hljs-number"><span class="hljs-number">0.400343</span></span> <span class="hljs-number"><span class="hljs-number">0.000000</span></span> <span class="hljs-number"><span class="hljs-number">0.180319</span></span> <span class="hljs-number"><span class="hljs-number">-0.383420</span></span> <span class="hljs-number"><span class="hljs-number">0.905800</span></span> <span class="hljs-number"><span class="hljs-number">0.000000</span></span> <span class="hljs-number"><span class="hljs-number">11.095301</span></span> <span class="hljs-number"><span class="hljs-number">18.852249</span></span> <span class="hljs-number"><span class="hljs-number">9.481399</span></span> <span class="hljs-number"><span class="hljs-number">1.000000</span></span>] ObjectInstance <span class="hljs-string"><span class="hljs-string">"archivebaycedar0001_mod"</span></span> AttributeEnd</code> </pre> <br>  En d'autres termes, il met √† jour la transformation actuelle et instancie l'objet;  aucune modification n'est apport√©e au contenu de ces <code>std::map</code> .  En cr√©er une copie compl√®te - allouer des n≈ìuds d'arbre rouge-noir, augmenter le nombre de r√©f√©rences pour les pointeurs communs, allouer de l'espace et copier des cha√Ænes - est presque toujours une perte de temps.  Tout cela est lib√©r√© lors de la restauration de l'√©tat pr√©c√©dent des graphiques. <br><br>  J'ai remplac√© chacune de ces cartes par le pointeur <code>std::shared_ptr</code> pour mapper et mis en ≈ìuvre l'approche de copie sur √©criture, dans laquelle la copie √† l'int√©rieur du bloc de d√©but / fin d'un attribut ne se produit que lorsque son contenu doit √™tre modifi√©.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le changement</a> n'a pas √©t√© particuli√®rement difficile, mais il a r√©duit le temps de lancement de plus d'une minute, ce qui nous a donn√© 12 min 20 s de traitement avant le d√©but du rendu - encore une fois une acc√©l√©ration de 1,08 fois. <br><br><h2>  Et le temps de rendu? </h2><br>  Un lecteur attentif remarquera que jusqu'√† pr√©sent je n'ai rien dit sur le temps de rendu.  √Ä ma grande surprise, cela s'est av√©r√© tout √† fait tol√©rable m√™me hors de la bo√Æte: pbrt peut restituer des images de sc√®nes de qualit√© cin√©matographique avec plusieurs centaines d'√©chantillons par pixel sur douze c≈ìurs de processeur pendant une p√©riode de deux √† trois heures.  Par exemple, cette image, l'une des plus lentes, rendue en 2 heures 51 minutes 36 secondes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0d7/025/729/0d7025729325723a1c454f795c17af39.jpg"></div><br>  <i>Dunes de Moana rendues par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pbrt-v3</a> avec une r√©solution de 2048x858 √† 256 √©chantillons par pixel.</i>  <i>Le temps de rendu total sur une instance de Google Compute Engine avec 12 c≈ìurs / 24 threads avec une fr√©quence de 2 GHz et la derni√®re version de pbrt-v3 √©tait de 2 heures 51 minutes 36 secondes.</i> <br><br>  √Ä mon avis, cela semble √™tre un indicateur √©tonnamment raisonnable.  Je suis s√ªr que des am√©liorations sont encore possibles, et une √©tude attentive des endroits o√π la plupart du temps est pass√© r√©v√®lera beaucoup de choses ¬´int√©ressantes¬ª, mais jusqu'√† pr√©sent, il n'y a pas de raisons particuli√®res pour cela. <br><br>  Lors du profilage, il s'est av√©r√© qu'environ 60% du temps de rendu a √©t√© pass√© √† l'intersection des rayons avec des objets (la plupart des op√©rations ont √©t√© effectu√©es en contournant BVH), et 25% a √©t√© consacr√© √† la recherche de textures ptex.  Ces ratios sont similaires aux indicateurs de sc√®nes plus simples, donc √† premi√®re vue il n'y a rien de bien √©vident ici.  (Cependant, je suis s√ªr qu'Embree sera capable de retracer ces rayons en un peu moins de temps.) <br><br>  Malheureusement, l'√©volutivit√© parall√®le n'est pas si bonne.  Je constate g√©n√©ralement que 1400% des ressources CPU sont consacr√©es au rendu, par rapport √† l'id√©al de 2400% (sur 24 CPU virtuels dans Google Compute Engine).  Il semble que le probl√®me soit li√© aux conflits lors des verrous dans ptex, mais je ne l'ai pas encore √©tudi√© plus en d√©tail.  Il est tr√®s probable que pbrt-v3 ne calcule pas la diff√©rence de rayons pour les rayons indirects dans le traceur de rayons;  √† leur tour, ces faisceaux ont toujours acc√®s au niveau MIP le plus d√©taill√© des textures, ce qui n'est pas tr√®s utile pour la mise en cache des textures. <br><br><h2>  Conclusion (pour pbrt-v3) </h2><br>  Apr√®s avoir corrig√© la gestion de l'√©tat des graphiques, je suis tomb√© sur une limite, apr√®s quoi de nouveaux progr√®s sans apporter de modifications importantes au syst√®me sont devenus √©vidents;  tout le reste a pris beaucoup de temps et n'avait pas grand-chose √† voir avec l'optimisation.  Par cons√©quent, je m'attarderai l√†-dessus, au moins en ce qui concerne pbrt-v3. <br><br>  En g√©n√©ral, la progression √©tait s√©rieuse: le temps de lancement avant rendu est pass√© de 35 minutes √† 12 minutes 20 secondes, c'est-√†-dire que l'acc√©l√©ration totale √©tait de 2,83 fois.  De plus, gr√¢ce √† un travail intelligent avec le cache de conversion, l'utilisation de la m√©moire est pass√©e de 80 Go √† 69 Go.  Toutes ces modifications sont disponibles maintenant si vous vous synchronisez avec la derni√®re version de pbrt-v3 (ou si vous l'avez fait au cours des derniers mois). Et nous arrivons √† comprendre √† quel point la m√©moire <code>Primitive</code> est encombrante pour cette sc√®ne;  nous avons compris comment √©conomiser encore 18 Go de m√©moire, mais ne l'avons pas impl√©ment√© dans pbrt-v3. <br><br>  Voici √† quoi ces 12 min 20 s sont consacr√©es apr√®s toutes nos optimisations: <br><br><table><thead><tr><th>  Fonction / fonctionnement </th><th>  Pourcentage de dur√©e d'ex√©cution </th></tr></thead><tbody><tr><td>  Build BVH </td><td>  34% </td></tr><tr><td>  Analyse (sauf <code>strtof()</code> ) </td><td>  21% </td></tr><tr><td> <code>strtof()</code> </td> <td>  20% </td></tr><tr><td>  Cache de conversion </td><td>  7% </td></tr><tr><td>  Lecture de fichiers PLY </td><td>  6% </td></tr><tr><td>  Allocation dynamique de m√©moire </td><td>  5% </td></tr><tr><td>  Inversion de conversion </td><td>  2% </td></tr><tr><td>  Gestion de l'√©tat des graphiques </td><td>  2% </td></tr><tr><td>  Autre </td><td>  3% </td></tr></tbody></table><br>  √Ä l'avenir, la meilleure option pour am√©liorer les performances sera un multithreading encore plus important de la phase de lancement: presque tout pendant l'analyse de la sc√®ne est monothread;  notre premier objectif le plus naturel est de construire un BVH.  Il sera √©galement int√©ressant d'analyser des choses telles que la lecture de fichiers PLY et la g√©n√©ration de BVH pour des instances individuelles d'objets et leur ex√©cution asynchrone en arri√®re-plan, tandis que l'analyse sera effectu√©e dans le thread principal. <br><br>  √Ä un moment donn√©, je verrai s'il existe des impl√©mentations plus rapides de <code>strtof()</code> ;  pbrt utilise uniquement ce que le syst√®me fournit.  Cependant, vous devez √™tre prudent avec le choix des remplacements qui ne sont pas test√©s de mani√®re tr√®s approfondie: l'analyse des valeurs flottantes est l'un de ces aspects dont le programmeur doit √™tre compl√®tement s√ªr. <br><br>  Il semble √©galement int√©ressant de r√©duire davantage la charge de l'analyseur: nous avons encore 17 Go de fichiers d'entr√©e de texte pour l'analyse.  Nous pouvons ajouter un support d'encodage binaire pour les fichiers d'entr√©e pbrt (peut-√™tre similaire √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l'approche RenderMan</a> ), mais j'ai des sentiments mitig√©s sur cette id√©e;  La possibilit√© d'ouvrir et de modifier des fichiers de description de sc√®ne dans un √©diteur de texte est tr√®s utile, et je crains que le codage binaire ne perturbe parfois les √©l√®ves utilisant pbrt dans le processus d'apprentissage.  C'est l'un de ces cas o√π la bonne solution pour pbrt peut diff√©rer des solutions pour un rendu commercial d'un niveau de production. <br><br>  C'√©tait tr√®s int√©ressant de garder une trace de toutes ces optimisations et de mieux comprendre les diff√©rentes solutions.  Il s'est av√©r√© que pbrt a des hypoth√®ses inattendues qui interf√®rent avec la sc√®ne de ce niveau de complexit√©.  Tout cela est un excellent exemple de l'importance pour une large communaut√© de chercheurs en rendu d'avoir acc√®s √† des sc√®nes de production r√©elles avec un haut degr√© de complexit√©;  Je remercie encore une fois Disney pour le temps pass√© √† traiter cette sc√®ne et √† la mettre dans le domaine public. <br><br>  Dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prochain article</a> , nous examinerons les aspects qui peuvent encore am√©liorer les performances si nous permettons √† pbrt d'apporter des modifications plus radicales. <br><br><h2>  Remarque </h2><br><ol><li>  Sur le syst√®me Linux sur <code>strtof()</code> je <code>strtof()</code> , <code>strtof()</code> pas plus rapide que <code>strtod()</code> .  Il est √† noter que sous OS X, <code>strtod()</code> environ deux fois plus rapide, ce qui est compl√®tement illogique.  Pour des raisons pratiques, j'ai continu√© √† utiliser <code>strtof()</code> . </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr417913/">https://habr.com/ru/post/fr417913/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr417901/index.html">Comment nous avons commenc√© √† faire de longues r√©unions impressionnantes, et pourquoi ce n'est plus un mal universel</a></li>
<li><a href="../fr417903/index.html">Cas de r√©vision de code 1</a></li>
<li><a href="../fr417905/index.html">11 fa√ßons (de ne pas) devenir victime de piratage √† Kubernetes</a></li>
<li><a href="../fr417909/index.html">Pourquoi avez-vous besoin de Splunk? Analyse d'application</a></li>
<li><a href="../fr417911/index.html">Conception continue en d√©veloppement: m√©thodologie et principe</a></li>
<li><a href="../fr417915/index.html">Comment jouer √† un colocataire</a></li>
<li><a href="../fr417917/index.html">ASC'18: Pers√©v√©rance et entra√Ænement r√©gulier comme moyen d'atteindre l'objectif</a></li>
<li><a href="../fr417919/index.html">Mod√©lisation des vibrations et du bruit dans une bo√Æte de vitesses de voiture</a></li>
<li><a href="../fr417927/index.html">Cyber ‚Äã‚ÄãBattle les PHDays, ou comment pirater une infrastructure urbaine en 30 heures</a></li>
<li><a href="../fr417929/index.html">Extrait du livre ¬´Un jour dans la vie du cerveau. Neurobiologie de la conscience de l'aube au cr√©puscule ¬ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>