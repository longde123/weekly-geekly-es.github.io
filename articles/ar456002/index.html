<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤ŸğŸ» ğŸŒ‰ ğŸŒ± Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¯ Ù…Ø®ØµØµØ© ÙˆØ§Ù„ØªØ¯Ø®Ù„ OOM Ø§Ù„Ù‚Ø§ØªÙ„ ğŸ³ ğŸš¨ ğŸ˜®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ù…Ø±Ø­Ø¨Ø§ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰! ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ø®ØµÙŠØµÙ‹Ø§ Ù„Ø·Ù„Ø§Ø¨ Ø¯ÙˆØ±Ø© Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© Ù„Ù…Ù†ØµØ© Kubernetes ØŒ ÙˆØ§Ù„ØªÙŠ ØªØ¨Ø¯Ø£ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±. 



 ÙÙŠ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø®ÙŠØ±Ø© ØŒ ØªØ­Ø·Ù…Øª ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¯ Ù…Ø®ØµØµØ© ÙˆØ§Ù„ØªØ¯Ø®Ù„ OOM Ø§Ù„Ù‚Ø§ØªÙ„</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/456002/" style=";text-align:right;direction:rtl">  Ù…Ø±Ø­Ø¨Ø§ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!  ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ø®ØµÙŠØµÙ‹Ø§ Ù„Ø·Ù„Ø§Ø¨ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Ø¯ÙˆØ±Ø© Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© Ù„Ù…Ù†ØµØ© Kubernetes</a> ØŒ ÙˆØ§Ù„ØªÙŠ ØªØ¨Ø¯Ø£ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±. <br><br><img src="https://habrastorage.org/webt/uv/io/fj/uviofjoh-y_arqntutialytzgcs.png"><br><br>  ÙÙŠ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø®ÙŠØ±Ø© ØŒ ØªØ­Ø·Ù…Øª Ø¨Ø¹Ø¶ Ø§Ù„Ù‚Ø±ÙˆÙ† Ø¨Ø§Ø³ØªÙ…Ø±Ø§Ø± ØŒ Ù…Ù…Ø§ ØªØ±Ùƒ Ø³Ø¬Ù„Ø§Ù‹ ÙÙŠ Ø³Ø¬Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø°ÙŠ Ù‚Ø§Ù… OOM Killer Ø¨ØªØ¯Ù…ÙŠØ± Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø§ÙˆÙŠØ©.  Ù‚Ø±Ø±Øª Ø£Ù† Ø£Ø¹Ø±Ù Ù„Ù…Ø§Ø°Ø§ ÙŠØ­Ø¯Ø« Ù‡Ø°Ø§. <a name="habracut"></a><br><br><h2 style=";text-align:right;direction:rtl">  Ù†Ø³Ù…Ø¹ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø°Ø§ÙƒØ±Ø© ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø© cgroup </h2><br>  Ø¯Ø¹ÙˆÙ†Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ù„Ù‰ ØªÙˆØ²ÙŠØ¹ K3s.  Ù†Ø®Ù„Ù‚ ØªØ­Øª Ù…Ø¹ Ø­Ø¯ Ø°Ø§ÙƒØ±Ø© Ù…Ù…ÙŠØ²Ø© Ù…Ù† 123 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª (123 Ù…ÙŠÙ„). <br><br><pre style=";text-align:right;direction:rtl"><code class="go hljs">kubectl run --restart=Never --rm -it --image=ubuntu --limits=<span class="hljs-string"><span class="hljs-string">'memory=123Mi'</span></span> -- sh If you don<span class="hljs-string"><span class="hljs-string">'t see a command prompt, try pressing enter. root@sh:/#</span></span></code> </pre> <br>  ÙÙŠ ÙˆØ­Ø¯Ø© ØªØ­ÙƒÙ… Ø£Ø®Ø±Ù‰ ØŒ ØªØ¹Ø±Ù Ø¹Ù„Ù‰ <code>uid</code> Ø§Ù„Ù…ÙˆÙ‚Ø¯. <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">kubectl get pods sh -o yaml | grep uid uid: bc001ffa<span class="hljs-number"><span class="hljs-number">-68f</span></span>c<span class="hljs-number"><span class="hljs-number">-11e9</span></span><span class="hljs-number"><span class="hljs-number">-92d</span></span>7<span class="hljs-number"><span class="hljs-number">-5</span></span>ef9efd9374c</code> </pre> <br>  Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø°ÙŠ ÙŠØ¹Ù…Ù„ Ø¹Ù„ÙŠÙ‡ ØŒ <code>cgroup</code> Ù…Ø¹Ù„Ù…Ø§Øª <code>cgroup</code> Ø®Ù„Ø§Ù„ ØªØ­Ø¯ÙŠØ¯ <code>cgroup</code> Ø§Ù„Ø®Ø§Øµ <code>cgroup</code> Ø§Ù„Ù…Ø·Ù„ÙˆØ¨. <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">cd /sys/fs/cgroup/memory/kubepods/burstable/podbc001ffa<span class="hljs-number"><span class="hljs-number">-68f</span></span>c<span class="hljs-number"><span class="hljs-number">-11e9</span></span><span class="hljs-number"><span class="hljs-number">-92d</span></span>7<span class="hljs-number"><span class="hljs-number">-5</span></span>ef9efd9374c cat memory.limit_in_bytes <span class="hljs-number"><span class="hljs-number">128974848</span></span></code> </pre> <br>  128974848 Ù‡Ùˆ Ø¨Ø§Ù„Ø¶Ø¨Ø· 123 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª (123 * 1024 * 1024).  Ø§Ù„ÙˆØ¶Ø¹ Ù‡Ùˆ ØªÙˆØ¶ÙŠØ­.  Ø§ØªØ¶Ø­ Ø£Ù†Ù‡ ÙÙŠ Kubernetes ØŒ ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ø­Ø¯ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ù…Ù† Ø®Ù„Ø§Ù„ cgroup.  Ø¨Ù…Ø¬Ø±Ø¯ Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø®ØµØµØ© ØŒ ÙŠØ¨Ø¯Ø£ cgroup Ø¨ØªØ¯Ù…ÙŠØ± Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø§ÙˆÙŠØ©. <br><br><h2 style=";text-align:right;direction:rtl">  Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯ </h2><br>  Ø¯Ø¹ÙˆÙ†Ø§ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯ Ø§Ù„Ù…ÙˆÙ‚Ø¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ø¬Ù„Ø³Ø© ÙˆØ­Ø¯Ø© ØªØ­ÙƒÙ… Ù‚ÙŠØ§Ø¯Ø© Ù…ÙØªÙˆØ­Ø©. <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">root@sh:/# apt update; apt install -y stress</code> </pre> <br>  ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ù†ÙØ³Ù‡ ØŒ Ø³Ù†ØªØ¹Ù‚Ø¨ Ø¥Ø¯Ø®Ø§Ù„Ø§Øª Ø³Ø¬Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… <code>dmesg -Tw</code> . <br><br>  Ø£ÙˆÙ„Ø§Ù‹ ØŒ Ù‚Ù… Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£Ø¯Ø§Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯ ØŒ Ù…Ø¹ ØªØ®ØµÙŠØµ 100 Ù…ÙŠØºØ§Ø¨Ø§ÙŠØª ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©.  Ø¨Ø¯Ø£Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­. <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">root@sh:/# stress --vm <span class="hljs-number"><span class="hljs-number">1</span></span> --vm-bytes <span class="hljs-number"><span class="hljs-number">100</span></span>M &amp; [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-number"><span class="hljs-number">271</span></span> root@sh:/# stress: info: [<span class="hljs-number"><span class="hljs-number">271</span></span>] dispatching hogs: <span class="hljs-number"><span class="hljs-number">0</span></span> cpu, <span class="hljs-number"><span class="hljs-number">0</span></span> io, <span class="hljs-number"><span class="hljs-number">1</span></span> vm, <span class="hljs-number"><span class="hljs-number">0</span></span> hdd</code> </pre> <br>  Ø§Ù„Ø¢Ù† Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">root@sh:/# stress --vm <span class="hljs-number"><span class="hljs-number">1</span></span> --vm-bytes <span class="hljs-number"><span class="hljs-number">50</span></span>M stress: info: [<span class="hljs-number"><span class="hljs-number">273</span></span>] dispatching hogs: <span class="hljs-number"><span class="hljs-number">0</span></span> cpu, <span class="hljs-number"><span class="hljs-number">0</span></span> io, <span class="hljs-number"><span class="hljs-number">1</span></span> vm, <span class="hljs-number"><span class="hljs-number">0</span></span> hdd stress: FAIL: [<span class="hljs-number"><span class="hljs-number">271</span></span>] (<span class="hljs-number"><span class="hljs-number">415</span></span>) &lt;-- worker <span class="hljs-number"><span class="hljs-number">272</span></span> got signal <span class="hljs-number"><span class="hljs-number">9</span></span> stress: WARN: [<span class="hljs-number"><span class="hljs-number">271</span></span>] (<span class="hljs-number"><span class="hljs-number">417</span></span>) now reaping child worker processes stress: FAIL: [<span class="hljs-number"><span class="hljs-number">271</span></span>] (<span class="hljs-number"><span class="hljs-number">451</span></span>) failed run completed in <span class="hljs-number"><span class="hljs-number">7s</span></span></code> </pre> <br>  Ø£Ø¯Ù‰ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ Ø¥Ù„Ù‰ Ø§Ù„ØªØ¯Ù…ÙŠØ± Ø§Ù„ÙÙˆØ±ÙŠ Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¬Ù‡Ø§Ø¯ Ø§Ù„Ø£ÙˆÙ„ (PID 271) ÙÙŠ Ø§Ù„Ø¥Ø´Ø§Ø±Ø© 9. <br><br>  ÙˆÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ù†ÙØ³Ù‡ ØŒ Ø¸Ù‡Ø±Øª Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…: <br><br> <code>[Sat Apr 27 22:56:09 2019] stress invoked oom-killer: gfp_mask=0x14000c0(GFP_KERNEL), nodemask=(null), order=0, oom_score_adj=939 <br> [Sat Apr 27 22:56:09 2019] stress cpuset=a2ed67c63e828da3849bf9f506ae2b36b4dac5b402a57f2981c9bdc07b23e672 mems_allowed=0 <br> [Sat Apr 27 22:56:09 2019] CPU: 0 PID: 32332 Comm: stress Not tainted 4.15.0-46-generic #49-Ubuntu <br> [Sat Apr 27 22:56:09 2019] Hardware name: BHYVE, BIOS 1.00 03/14/2014 <br> [Sat Apr 27 22:56:09 2019] Call Trace: <br> [Sat Apr 27 22:56:09 2019] dump_stack+0x63/0x8b <br> [Sat Apr 27 22:56:09 2019] dump_header+0x71/0x285 <br> [Sat Apr 27 22:56:09 2019] oom_kill_process+0x220/0x440 <br> [Sat Apr 27 22:56:09 2019] out_of_memory+0x2d1/0x4f0 <br> [Sat Apr 27 22:56:09 2019] mem_cgroup_out_of_memory+0x4b/0x80 <br> [Sat Apr 27 22:56:09 2019] mem_cgroup_oom_synchronize+0x2e8/0x320 <br> [Sat Apr 27 22:56:09 2019] ? mem_cgroup_css_online+0x40/0x40 <br> [Sat Apr 27 22:56:09 2019] pagefault_out_of_memory+0x36/0x7b <br> [Sat Apr 27 22:56:09 2019] mm_fault_error+0x90/0x180 <br> [Sat Apr 27 22:56:09 2019] __do_page_fault+0x4a5/0x4d0 <br> [Sat Apr 27 22:56:09 2019] do_page_fault+0x2e/0xe0 <br> [Sat Apr 27 22:56:09 2019] ? page_fault+0x2f/0x50 <br> [Sat Apr 27 22:56:09 2019] page_fault+0x45/0x50 <br> [Sat Apr 27 22:56:09 2019] RIP: 0033:0x558182259cf0 <br> [Sat Apr 27 22:56:09 2019] RSP: 002b:00007fff01a47940 EFLAGS: 00010206 <br> [Sat Apr 27 22:56:09 2019] RAX: 00007fdc18cdf010 RBX: 00007fdc1763a010 RCX: 00007fdc1763a010 <br> [Sat Apr 27 22:56:09 2019] RDX: 00000000016a5000 RSI: 0000000003201000 RDI: 0000000000000000 <br> [Sat Apr 27 22:56:09 2019] RBP: 0000000003200000 R08: 00000000ffffffff R09: 0000000000000000 <br> [Sat Apr 27 22:56:09 2019] R10: 0000000000000022 R11: 0000000000000246 R12: ffffffffffffffff <br> [Sat Apr 27 22:56:09 2019] R13: 0000000000000002 R14: fffffffffffff000 R15: 0000000000001000 <br> [Sat Apr 27 22:56:09 2019] Task in /kubepods/burstable/podbc001ffa-68fc-11e9-92d7-5ef9efd9374c/a2ed67c63e828da3849bf9f506ae2b36b4dac5b402a57f2981c9bdc07b23e672 killed as a result of limit of /kubepods/burstable/podbc001ffa-68fc-11e9-92d7-5ef9efd9374c <br> [Sat Apr 27 22:56:09 2019] memory: usage 125952kB, limit 125952kB, failcnt 3632 <br> [Sat Apr 27 22:56:09 2019] memory+swap: usage 0kB, limit 9007199254740988kB, failcnt 0 <br> [Sat Apr 27 22:56:09 2019] kmem: usage 2352kB, limit 9007199254740988kB, failcnt 0 <br> [Sat Apr 27 22:56:09 2019] Memory cgroup stats for /kubepods/burstable/podbc001ffa-68fc-11e9-92d7-5ef9efd9374c: cache:0KB rss:0KB rss_huge:0KB shmem:0KB mapped_file:0KB dirty:0KB writeback:0KB inactive_anon:0KB active_anon:0KB inactive_file:0KB active_file:0KB unevictable:0KB <br> [Sat Apr 27 22:56:09 2019] Memory cgroup stats for /kubepods/burstable/podbc001ffa-68fc-11e9-92d7-5ef9efd9374c/79fae7c2724ea1b19caa343fed8da3ea84bbe5eb370e5af8a6a94a090d9e4ac2: cache:0KB rss:48KB rss_huge:0KB shmem:0KB mapped_file:0KB dirty:0KB writeback:0KB inactive_anon:0KB active_anon:48KB inactive_file:0KB active_file:0KB unevictable:0KB <br> [Sat Apr 27 22:56:09 2019] Memory cgroup stats for /kubepods/burstable/podbc001ffa-68fc-11e9-92d7-5ef9efd9374c/a2ed67c63e828da3849bf9f506ae2b36b4dac5b402a57f2981c9bdc07b23e672: cache:0KB rss:123552KB rss_huge:0KB shmem:0KB mapped_file:0KB dirty:0KB writeback:0KB inactive_anon:0KB active_anon:123548KB inactive_file:0KB active_file:0KB unevictable:0KB <br> [Sat Apr 27 22:56:09 2019] [ pid ] uid tgid total_vm rss pgtables_bytes swapents oom_score_adj name <br> [Sat Apr 27 22:56:09 2019] [25160] 0 25160 256 1 28672 0 -998 pause <br> [Sat Apr 27 22:56:09 2019] [25218] 0 25218 4627 872 77824 0 939 bash <br> [Sat Apr 27 22:56:09 2019] [32307] 0 32307 2060 275 57344 0 939 stress <br> [Sat Apr 27 22:56:09 2019] [32308] 0 32308 27661 24953 253952 0 939 stress <br> [Sat Apr 27 22:56:09 2019] [32331] 0 32331 2060 304 53248 0 939 stress <br> [Sat Apr 27 22:56:09 2019] [32332] 0 32332 14861 5829 102400 0 939 stress <br> [Sat Apr 27 22:56:09 2019] Memory cgroup out of memory: Kill process 32308 (stress) score 1718 or sacrifice child <br> [Sat Apr 27 22:56:09 2019] Killed process 32308 (stress) total-vm:110644kB, anon-rss:99620kB, file-rss:192kB, shmem-rss:0kB <br> [Sat Apr 27 22:56:09 2019] oom_reaper: reaped process 32308 (stress), now anon-rss:0kB, file-rss:0kB, shmem-rss:0kB</code> <br> <br>  ØªÙ… ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ø¹ PID 32308 Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¶ÙŠÙ Ø¨Ø³Ø¨Ø¨ Ù†ÙØ§Ø¯ Ø§Ù„Ø°Ø§ÙƒØ±Ø© (OOM).  ÙˆÙ„ÙƒÙ† Ø§Ù„Ø´ÙŠØ¡ Ø§Ù„Ø£ÙƒØ«Ø± Ø¥Ø«Ø§Ø±Ø© Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ù…Ø®ÙÙŠ ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø¥Ø¯Ø®Ø§Ù„Ø§Øª Ø¯ÙØªØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©: <br><br><img src="https://habrastorage.org/webt/fz/dn/pb/fzdnpbniemrgqc8qvmkxvttose0.png"><br><br>  ÙÙŠÙ…Ø§ ÙŠÙ„ÙŠ Ø¹Ù…Ù„ÙŠØ§Øª Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¯ Ø§Ù„ØªÙŠ ØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡Ø§ ÙƒÙ…Ø±Ø´Ø­ÙŠÙ† Ù„Ù„ØªØ¯Ù…ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ÙƒÙˆÙ† OOM Killer.  ØªÙ„Ù‚Øª Ø¹Ù…Ù„ÙŠØ© <code>pause</code> Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ØŒ Ø§Ù„ØªÙŠ ØªØ®Ø²Ù† Ù…Ø³Ø§Ø­Ø§Øª Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø´Ø¨ÙƒØ§Øª ØŒ ØªØµÙ†ÙŠÙ <code>-998</code> ØŒ Ù…Ù…Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± Ù…Ø¶Ù…ÙˆÙ†Ø© Ù„Ù„ØªØ¯Ù…ÙŠØ±.  ØªÙ„Ù‚Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© ÙÙŠ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø¯Ø±Ø¬Ø© <code>oom_score_adj</code> Ù…Ù† <code>939</code> .  ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØµÙŠØºØ© Ù…Ù† ÙˆØ«Ø§Ø¦Ù‚ Kubernetes Ø£Ø¯Ù†Ø§Ù‡: <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">min(max(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span> - (<span class="hljs-number"><span class="hljs-number">1000</span></span> * memoryRequestBytes) / machineMemoryCapacityBytes), <span class="hljs-number"><span class="hljs-number">999</span></span>)</code> </pre> <br>  Ù†ÙƒØªØ´Ù Ù…Ù‚Ø¯Ø§Ø± Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¹Ù‚Ø¯Ø©: <br><br><pre style=";text-align:right;direction:rtl"> <code class="go hljs">kubectl describe nodes k3s | grep Allocatable -A <span class="hljs-number"><span class="hljs-number">5</span></span> Allocatable: cpu: <span class="hljs-number"><span class="hljs-number">1</span></span> ephemeral-storage: <span class="hljs-number"><span class="hljs-number">49255941901</span></span> hugepages<span class="hljs-number"><span class="hljs-number">-1</span></span>Gi: <span class="hljs-number"><span class="hljs-number">0</span></span> hugepages<span class="hljs-number"><span class="hljs-number">-2</span></span>Mi: <span class="hljs-number"><span class="hljs-number">0</span></span> memory: <span class="hljs-number"><span class="hljs-number">2041888</span></span>Ki</code> </pre> <br>  Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø­Ø¬Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ØŒ ÙØ³ÙŠÙƒÙˆÙ† Ù…Ø³Ø§ÙˆÙŠØ§Ù‹ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰.  Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù‚ÙŠÙ… ØŒ Ù†Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù‚ÙŠÙ…Ø© <code>oom_score_adj</code> Ø§Ù„ØªØ§Ù„ÙŠØ©: <code>1000â€“123*1024/2041888=938.32</code> ØŒ ÙˆÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø© Ø¬Ø¯Ù‹Ø§ Ù…Ù† Ø§Ù„Ù‚ÙŠÙ…Ø© <code>939</code> Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙŠ Ø³Ø¬Ù„ Ø§Ù„Ù†Ø¸Ø§Ù….  (Ù„Ø§ Ø£Ø¹Ø±Ù ÙƒÙŠÙ ØªØ­ØµÙ„ OOM Killer Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© 939.) <br><br>  Ù„Ø°Ù„Ùƒ ØŒ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙÙŠ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ù„Ù‡Ø§ Ù†ÙØ³ Ø§Ù„Ù‚ÙŠÙ…Ø© oom_score_adj.  ÙŠÙ‚ÙˆÙ… Ù…ÙƒÙˆÙ† OOM Killer Ø¨Ø­Ø³Ø§Ø¨ Ù‚ÙŠÙ…Ø© OOM Ø§Ø³ØªÙ†Ø§Ø¯Ù‹Ø§ Ø¥Ù„Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø© ÙˆØ¶Ø¨Ø· Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ø³ØªÙ†Ø§Ø¯Ù‹Ø§ Ø¥Ù„Ù‰ Ø¯Ø±Ø¬Ø© oom_score_adj.  ÙˆÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ØŒ ÙŠØ¯Ù…Ø± Ø¹Ù…Ù„ÙŠØ© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù…Ù„ Ø§Ù„Ø£ÙˆÙ„ ØŒ Ø§Ù„Ø°ÙŠ Ø£ÙƒÙ„ Ù…Ø¹Ø¸Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø© ØŒ 100 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª ØŒ ÙˆØ§Ù„Ø°ÙŠ ÙŠØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„ØªÙ‚Ø¯ÙŠØ± oom_score = 1718. <br><br><h2 style=";text-align:right;direction:rtl">  Ø§Ø³ØªÙ†ØªØ§Ø¬ </h2><br>  ÙŠØªØ­ÙƒÙ… Kubernetes ÙÙŠ Ø­Ø¯ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ù…ÙƒÙˆÙ†Ø§Øª cgroup Ùˆ OOM Killer.  Ù…Ù† Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø¹Ù†Ø§ÙŠØ© Ø¨ÙŠÙ† Ø´Ø±ÙˆØ· Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„ OOM ÙˆÙ…ÙˆÙ‚Ø¯ OOM. <br><br>  ÙƒÙŠÙ ØªØ­Ø¨ Ø§Ù„Ù…ÙˆØ§Ø¯ØŸ  ØªØªÙ… Ø¯Ø¹ÙˆØ© ÙƒÙ„ Ù…Ù† ÙŠØ±ÙŠØ¯ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ø­ÙˆÙ„ Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ© Ø¥Ù„Ù‰ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Ù†Ø¯ÙˆØ© Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ù…Ø¬Ø§Ù†Ù‹Ø§</a> ÙÙŠ 17 ÙŠÙˆÙ†ÙŠÙˆ ØŒ Ø­ÙŠØ« Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø¯Ø±Ø§Ø³Ø© Ù‚Ø¯Ø±Ø§Øª Kubernetes Ù„ØªÙ†Ø¸ÙŠÙ… Ù…Ù…Ø§Ø±Ø³Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù…Ø³ØªÙ…Ø± (CI / CD) ÙˆØ§Ù„Ù…Ù†Ø§Ù‡Ø¬ Ù„ÙØ±ÙŠÙ‚ ØµØºÙŠØ± Ù…Ø¹ Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª ØŒ ÙˆÙƒØ°Ù„Ùƒ Ù„Ù…Ù†Ø¸Ù…Ø© ÙƒØ¨ÙŠØ±Ø© Ù…Ø¹ Ø¹Ø¯Ø¯ ÙƒØ¨ÙŠØ± Ù…Ù† Ø§Ù„Ø£Ù†Ø¸Ù…Ø©. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar456002/">https://habr.com/ru/post/ar456002/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar455986/index.html">Ù„Ù…Ø§Ø°Ø§ ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ ÙÙ†ÙŠ ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø®ØŸ</a></li>
<li><a href="../ar455988/index.html">Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¨Ù„Ø§Ø²Ù…Ø§ Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© Blockchain</a></li>
<li><a href="../ar455990/index.html">CTT ÙÙŠ Ø­Ù„ÙˆÙ„ Ø§Ù„Ø®Ø§Ø¯Ù… - ÙƒÙŠÙ ØªØ¨Ø¯ÙˆØŸ</a></li>
<li><a href="../ar455996/index.html">Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù„Ù„Ø¥Ø¹Ù„Ø§Ù† ÙÙŠ Ø´Ø¨ÙƒØ© Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„ØªØ¬Ø²Ø¦Ø©. Ù…ØªØ§Ø¨Ø¹Ø© Ø®Ø·ÙˆØ§Øª ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙŠ Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø§Ù„ØªØ¬Ø²Ø¦Ø©</a></li>
<li><a href="../ar456000/index.html">Ø¥Ù†Ø´Ø§Ø¡ Ù„Ø¹Ø¨Ø© Tic-Tac-Toe Ù…Ø¹ TypeScript Ùˆ React Ùˆ Mocha</a></li>
<li><a href="../ar456004/index.html">Ù†Ø¯Ø¹ÙˆÙƒ Ù„Ø­Ø¶ÙˆØ± Ø§Ø¬ØªÙ…Ø§Ø¹ ØªØ·ÙˆÙŠØ± Ø£Ù…Ø§Ù…ÙŠ ÙÙŠ Ø®Ø¯Ù…Ø§Øª Ù…Ø­Ù…Ù„Ø© Ø¨Ø´ÙƒÙ„ ÙƒØ¨ÙŠØ±</a></li>
<li><a href="../ar456006/index.html">Ø²ÙŠØ§Ø¯Ø© Ø¥ÙŠØ±Ø§Ø¯Ø§ØªÙƒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</a></li>
<li><a href="../ar456008/index.html">ØªØ·ÙˆÙŠØ± Ø¨Ø±Ø§Ù…Ø¬ Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ Redd Ø¹Ù„Ù‰ Ø³Ø¨ÙŠÙ„ Ø§Ù„Ù…Ø«Ø§Ù„ Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ FPGA</a></li>
<li><a href="../ar456014/index.html">Ø­ÙˆÙ„ ØªÙˆØ·ÙŠÙ† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª. Ø§Ù„Ø¬Ø²Ø¡ 2: ÙƒÙŠÙ ÙŠØªÙ… ØªØ´ÙƒÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±ØŸ</a></li>
<li><a href="../ar456016/index.html">Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨ÙŠÙ† iframe ÙˆØ§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>