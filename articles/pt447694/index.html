<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ó üôèüèø üë®‚Äçüåæ Configura√ß√£o do sistema distribu√≠do compilado üë®üèΩ‚Äçüé§ üì≤ üõ∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Gostaria de dizer um mecanismo interessante para trabalhar com uma configura√ß√£o de sistema distribu√≠do. A configura√ß√£o √© apresentada diretamente em um...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Configura√ß√£o do sistema distribu√≠do compilado</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/primetalk/blog/447694/"><p>  Gostaria de dizer um mecanismo interessante para trabalhar com uma configura√ß√£o de sistema distribu√≠do.  A configura√ß√£o √© apresentada diretamente em uma linguagem compilada (Scala) usando tipos seguros.  Neste post, um exemplo dessa configura√ß√£o √© analisado e v√°rios aspectos da introdu√ß√£o de uma configura√ß√£o compilada no processo geral de desenvolvimento s√£o considerados. </p><br><p><img src="https://habrastorage.org/webt/71/bl/ax/71blaxtldz-ia4yftyebaxbam7c.png" alt="Ciclo de vida da configura√ß√£o"></p><br><p>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ingl√™s</a> ) </p><a name="habracut"></a><br><h3 id="vvedenie">  1. Introdu√ß√£o </h3><br><p>  Construir um sistema distribu√≠do confi√°vel implica que todos os n√≥s usem a configura√ß√£o correta, sincronizada com outros n√≥s.  Normalmente, as tecnologias DevOps (terraform, ansible ou algo parecido) s√£o usadas para gerar automaticamente arquivos de configura√ß√£o (geralmente exclusivos para cada n√≥).  Tamb√©m gostar√≠amos de ter certeza de que todos os n√≥s em intera√ß√£o usam protocolos id√™nticos (incluindo a mesma vers√£o).  Caso contr√°rio, a incompatibilidade ser√° incorporada ao nosso sistema distribu√≠do.  No mundo da JVM, uma conseq√º√™ncia desse requisito √© a necessidade de usar a mesma vers√£o de uma biblioteca contendo mensagens de protocolo em todos os lugares. </p><br><p>  E o teste do sistema distribu√≠do?  Obviamente, assumimos que os testes de unidade s√£o fornecidos para todos os componentes antes de passarmos para o teste de integra√ß√£o.  (Para extrapolar os resultados do teste para o tempo de execu√ß√£o, tamb√©m devemos fornecer um conjunto id√™ntico de bibliotecas no est√°gio de teste e no tempo de execu√ß√£o.) </p><br><p>  Ao trabalhar com testes de integra√ß√£o, geralmente √© mais f√°cil em qualquer lugar usar um √∫nico caminho de classe em todos os n√≥s.  N√≥s apenas teremos que garantir que o mesmo caminho de classe esteja envolvido no tempo de execu√ß√£o.  (Apesar de ser poss√≠vel executar n√≥s diferentes com caminhos de classe diferentes, isso leva a complica√ß√µes de toda a configura√ß√£o e dificuldades nos testes de implanta√ß√£o e integra√ß√£o.) Como parte desta postagem, assumimos que o mesmo caminho de classe ser√° usado em todos os n√≥s. </p><br><p>  A configura√ß√£o evolui com o aplicativo.  Para identificar os v√°rios est√°gios da evolu√ß√£o dos programas, usamos vers√µes.  Parece l√≥gico tamb√©m identificar vers√µes diferentes das configura√ß√µes.  E a pr√≥pria configura√ß√£o deve ser colocada no sistema de controle de vers√£o.  Se houver apenas uma configura√ß√£o em produ√ß√£o, podemos usar apenas o n√∫mero da vers√£o.  Se muitas inst√¢ncias de produ√ß√£o s√£o usadas, precisamos de v√°rias <br>  ramifica√ß√µes de configura√ß√£o e um r√≥tulo adicional al√©m da vers√£o (por exemplo, o nome da ramifica√ß√£o).  Assim, podemos identificar exclusivamente a configura√ß√£o exata.  Cada identificador de configura√ß√£o corresponde exclusivamente a uma certa combina√ß√£o de n√≥s distribu√≠dos, portas, recursos externos e vers√µes da biblioteca.  Na estrutura deste post, procederemos do fato de haver apenas um ramo e podemos identificar a configura√ß√£o da maneira usual usando tr√™s n√∫meros separados por um ponto (1.2.3). </p><br><p>  Em ambientes modernos, os arquivos de configura√ß√£o s√£o criados manualmente muito raramente.  Com mais freq√º√™ncia, eles s√£o gerados durante a implanta√ß√£o e n√£o s√£o mais tocados (para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√£o quebrar nada</a> ).  Surge uma pergunta l√≥gica: por que ainda estamos usando um formato de texto para armazenar a configura√ß√£o?  Uma alternativa completamente vi√°vel √© a capacidade de usar c√≥digo regular para configura√ß√£o e obter benef√≠cios das verifica√ß√µes em tempo de compila√ß√£o. </p><br><p>  Neste post, estamos apenas explorando a ideia de representar uma configura√ß√£o dentro de um artefato compilado. </p><br><h3 id="kompiliruemaya-konfiguraciya">  Configura√ß√£o compilada </h3><br><p>  Esta se√ß√£o descreve um exemplo de uma configura√ß√£o compilada est√°tica.  Dois servi√ßos simples s√£o implementados - o servi√ßo de eco e o servi√ßo de eco do cliente.  Com base nesses dois servi√ßos, duas vers√µes do sistema s√£o montadas.  Em uma modalidade, ambos os servi√ßos est√£o localizados no mesmo n√≥, em outra modalidade, em n√≥s diferentes. </p><br><p> Normalmente, um sistema distribu√≠do cont√©m v√°rios n√≥s.  Os n√≥s podem ser identificados usando valores de algum tipo <code>NodeId</code> : </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Backend</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Frontend</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span></span></code> </pre> <br><p>  ou </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">hostName: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p>  ou mesmo </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singleton</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Singleton</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span></code> </pre> <br><p>  Os n√≥s desempenham v√°rias fun√ß√µes, os servi√ßos s√£o iniciados neles e as comunica√ß√µes TCP / HTTP podem ser estabelecidas entre eles. </p><br><p>  Para descrever as comunica√ß√µes TCP, precisamos de pelo menos um n√∫mero de porta.  Tamb√©m gostar√≠amos de refletir o protocolo suportado nessa porta para garantir que o cliente e o servidor usem o mesmo protocolo.  Vamos descrever a conex√£o usando esta classe: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TcpEndPoint</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Protocol</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">node: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">NodeId</span></span></span></span><span class="hljs-class"><span class="hljs-params">, port: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Port</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Protocol</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p>  em que <code>Port</code> √© apenas um n√∫mero inteiro <code>Int</code> com um intervalo de valores v√°lidos: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PortNumber</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Refined</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Closed</span></span>[_0, <span class="hljs-type"><span class="hljs-type">W</span></span>.`<span class="hljs-number"><span class="hljs-number">65535</span></span>`.<span class="hljs-type"><span class="hljs-type">T</span></span>]]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Tipos refinados</b> <div class="spoiler_text"><p>  Veja biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">refinada</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">meu</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">relat√≥rio</a> .  Em resumo, a biblioteca permite adicionar restri√ß√µes que s√£o verificadas no momento da compila√ß√£o aos tipos.  Nesse caso, os valores v√°lidos do n√∫mero da porta s√£o n√∫meros inteiros de 16 bits.  Para uma configura√ß√£o compilada, o uso da biblioteca refinada √© opcional, mas pode melhorar a capacidade do compilador de verificar a configura√ß√£o. </p></div></div><br><p>  Para protocolos HTTP (REST), al√©m do n√∫mero da porta, tamb√©m podemos precisar de um caminho para o servi√ßo: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UrlPathPrefix</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Refined</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>, <span class="hljs-type"><span class="hljs-type">MatchesRegex</span></span>[<span class="hljs-type"><span class="hljs-type">W</span></span>.`<span class="hljs-string"><span class="hljs-string">"[a-zA-Z_0-9/]*"</span></span>`.<span class="hljs-type"><span class="hljs-type">T</span></span>]] <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PortWithPrefix</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Protocol</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">portNumber: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PortNumber</span></span></span></span><span class="hljs-class"><span class="hljs-params">, pathPrefix: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">UrlPathPrefix</span></span></span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Tipos fantasmas</b> <div class="spoiler_text"><p>  Para identificar o protocolo no est√°gio de compila√ß√£o, usamos um par√¢metro de tipo que n√£o √© usado dentro da classe.  Essa decis√£o se deve ao fato de que no tempo de execu√ß√£o n√£o usamos uma inst√¢ncia de protocolo, mas gostar√≠amos que o compilador verifique a compatibilidade do protocolo.  Gra√ßas ao protocolo, n√£o poderemos transferir o servi√ßo inadequado como uma depend√™ncia. </p></div></div><br><p>  Um protocolo comum √© a API REST com serializa√ß√£o Json: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonHttpRestProtocol</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RequestMessage</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ResponseMessage</span></span></span><span class="hljs-class">]</span></span></code> </pre> <br><p>  onde <code>RequestMessage</code> √© o tipo de solicita√ß√£o, <code>ResponseMessage</code> √© o tipo de resposta. <br>  Obviamente, voc√™ pode usar outras descri√ß√µes de protocolo que fornecem a precis√£o necess√°ria. </p><br><p>  Para os fins deste post, usaremos uma vers√£o simplificada do protocolo: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleHttpGetRest</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RequestMessage</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ResponseMessage</span></span></span><span class="hljs-class">]</span></span></code> </pre> <br><p>  Aqui, a solicita√ß√£o √© uma sequ√™ncia adicionada ao URL e a resposta √© a sequ√™ncia retornada no corpo da resposta HTTP. </p><br><p>  A configura√ß√£o do servi√ßo √© descrita pelo nome, portas e depend√™ncias do servi√ßo.  Esses elementos podem ser representados no Scala de v√°rias maneiras (por exemplo, <code>HList</code> , tipos de dados alg√©bricos).  Para os prop√≥sitos deste post, usaremos o Cake Pattern e representamos os m√≥dulos usando as <code>trait</code> .  (O padr√£o de bolo n√£o √© um elemento necess√°rio da abordagem descrita. √â apenas uma das implementa√ß√µes poss√≠veis.) </p><br><p>  Depend√™ncias entre servi√ßos podem ser representadas como m√©todos que retornam <code>EndPoint</code> portas <code>EndPoint</code> de outros n√≥s: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoProtocol</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">] </span></span>= <span class="hljs-type"><span class="hljs-type">SimpleHttpGetRest</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>, <span class="hljs-type"><span class="hljs-type">A</span></span>] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">portNumber</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortNumber</span></span> = <span class="hljs-number"><span class="hljs-number">8081</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoPort</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortWithPrefix</span></span>[<span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]] = <span class="hljs-type"><span class="hljs-type">PortWithPrefix</span></span>[<span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]](portNumber, <span class="hljs-string"><span class="hljs-string">"echo"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoService</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">HttpSimpleGetEndPoint</span></span>[<span class="hljs-type"><span class="hljs-type">NodeId</span></span>, <span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]] = providedSimpleService(echoPort) }</code> </pre> <br><p>  Para criar um servi√ßo de eco, apenas um n√∫mero de porta e uma indica√ß√£o de que essa porta suporta o protocolo de eco s√£o suficientes.  N√£o foi poss√≠vel indicar uma porta espec√≠fica, porque  As caracter√≠sticas permitem declarar m√©todos sem implementa√ß√£o (m√©todos abstratos).  Nesse caso, ao criar uma configura√ß√£o espec√≠fica, o compilador exigiria uma implementa√ß√£o de m√©todo abstrato e um n√∫mero de porta.  Como implementamos o m√©todo, ao criar uma configura√ß√£o espec√≠fica, n√£o podemos especificar outra porta.  O valor padr√£o ser√° usado. </p><br><p>  Na configura√ß√£o do cliente, declaramos uma depend√™ncia no servi√ßo de eco: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testMessage</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">"test"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pollInterval</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">FiniteDuration</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoServiceDependency</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">HttpSimpleGetEndPoint</span></span>[_, <span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]] }</code> </pre> <br><p>  A depend√™ncia √© do mesmo tipo que o servi√ßo exportado <code>echoService</code> .  Em particular, no cliente de eco, exigimos o mesmo protocolo.  Portanto, ao conectar os dois servi√ßos, podemos ter certeza de que tudo funcionar√° corretamente. </p><br><div class="spoiler">  <b class="spoiler_title">Implementa√ß√£o de servi√ßo</b> <div class="spoiler_text"><p>  Para iniciar e parar o servi√ßo, √© necess√°ria uma fun√ß√£o.  (A capacidade de interromper o servi√ßo √© essencial para o teste.) Novamente, existem v√°rias op√ß√µes para implementar essa fun√ß√£o (por exemplo, poder√≠amos usar classes de tipo com base no tipo de configura√ß√£o).  Para os fins deste post, usaremos o Cake Pattern.  Representaremos o servi√ßo usando a classe <code>cats.Resource</code> , porque  Nesta classe, os meios de libera√ß√£o segura garantida de recursos em caso de problemas j√° s√£o fornecidos.  Para obter o recurso, precisamos fornecer uma configura√ß√£o e um contexto de tempo de execu√ß√£o pronto.  A fun√ß√£o para iniciar o servi√ßo pode ter o seguinte formato: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceReader</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">] </span></span>= <span class="hljs-type"><span class="hljs-type">Reader</span></span>[<span class="hljs-type"><span class="hljs-type">Config</span></span>, <span class="hljs-type"><span class="hljs-type">Resource</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">A</span></span>]] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_]] </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">resource</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> implicit resolver: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">AddressResolver</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">], timer: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Timer</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">], contextShift: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ContextShift</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">], ec: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ExecutionContext</span></span></span></span><span class="hljs-class"><span class="hljs-params">, applicative: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Applicative</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">] </span></span></span><span class="hljs-class">)</span></span>: <span class="hljs-type"><span class="hljs-type">ResourceReader</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">Config</span></span>, <span class="hljs-type"><span class="hljs-type">Unit</span></span>] }</code> </pre> <br><p>  onde </p><br><ul><li>  <code>Config</code> - tipo de configura√ß√£o para este servi√ßo </li><li>  <code>AddressResolver</code> - um objeto de tempo de execu√ß√£o que permite descobrir os endere√ßos de outros n√≥s (veja abaixo) </li></ul><br><p>  e outros tipos da biblioteca de <code>cats</code> : </p><br><ul><li>  <code>F[_]</code> - tipo de efeito (no caso mais simples, <code>F[A]</code> pode ser apenas uma fun√ß√£o <code>() =&gt; A</code> Neste post, usaremos <code>cats.IO</code> ) </li><li>  <code>Reader[A,B]</code> - mais ou menos sin√¥nimo da fun√ß√£o <code>A =&gt; B</code> </li><li>  <code>cats.Resource</code> - um recurso que pode ser obtido e liberado </li><li>  <code>Timer</code> - temporizador (permite adormecer por um tempo e medir intervalos de tempo) </li><li>  <code>ContextShift</code> - an√°logo de <code>ExecutionContext</code> </li><li>  <code>Applicative</code> - uma classe de tipo de efeito que permite combinar efeitos individuais (quase uma m√¥nada).  Em aplicativos mais complexos, parece melhor usar o <code>Monad</code> / <code>ConcurrentEffect</code> . </li></ul><br><p>  Usando esta assinatura de fun√ß√£o, podemos implementar v√°rios servi√ßos.  Por exemplo, um servi√ßo que n√£o faz nada: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_]] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">&lt;</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Any</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resource</span></span></span></span>(...): <span class="hljs-type"><span class="hljs-type">ResourceReader</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">Config</span></span>, <span class="hljs-type"><span class="hljs-type">Unit</span></span>] = <span class="hljs-type"><span class="hljs-type">Reader</span></span>(_ =&gt; <span class="hljs-type"><span class="hljs-type">Resource</span></span>.pure[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">Unit</span></span>](())) }</code> </pre> </div></div><br><p>  (Consulte o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">c√≥digo-fonte</a> para outros servi√ßos - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">servi√ßo de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">eco</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cliente de eco</a> <br>  e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">controladores vital√≠cios</a> .) </p><br><p>  Um n√≥ √© um objeto que pode iniciar v√°rios servi√ßos (o lan√ßamento da cadeia de recursos √© garantido pelo Cake Pattern): </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleNodeImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IO</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoServiceService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleServiceImpl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">EchoConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">EchoClientConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">FiniteDurationLifecycleConfig</span></span> }</code> </pre> <br><p>  Observe que indicamos o tipo exato de configura√ß√£o necess√°ria para este n√≥.  Se esquecermos de especificar um dos tipos de configura√ß√£o exigidos por um servi√ßo separado, haver√° um erro de compila√ß√£o.  Al√©m disso, n√£o poderemos iniciar o n√≥ se n√£o fornecermos algum objeto do tipo apropriado com todos os dados necess√°rios. </p><br><div class="spoiler">  <b class="spoiler_title">Resolu√ß√£o de nome de host</b> <div class="spoiler_text"><p>  Para se conectar a um host remoto, precisamos de um endere√ßo IP real.  √â poss√≠vel que o endere√ßo seja conhecido depois do restante da configura√ß√£o.  Portanto, precisamos de uma fun√ß√£o que mapeie o identificador do n√≥ para o endere√ßo: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeAddress</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NodeId</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">host: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Uri</span></span></span></span><span class="hljs-class"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Host</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddressResolver</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_]] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">NodeId</span></span>](nodeId: <span class="hljs-type"><span class="hljs-type">NodeId</span></span>): <span class="hljs-type"><span class="hljs-type">F</span></span>[<span class="hljs-type"><span class="hljs-type">NodeAddress</span></span>[<span class="hljs-type"><span class="hljs-type">NodeId</span></span>]] }</code> </pre> <br><p>  Voc√™ pode oferecer v√°rias maneiras de implementar essa fun√ß√£o: </p><br><ol><li>  Se os endere√ßos forem conhecidos antes da implanta√ß√£o, podemos gerar um c√≥digo Scala com <br>  endere√ßos e inicie a montagem.  Isso ir√° compilar e executar os testes. <br>  Nesse caso, a fun√ß√£o ser√° conhecida estaticamente e pode ser representada no c√≥digo como uma exibi√ß√£o de mapa <code>Map[NodeId, NodeAddress]</code> . </li><li>  Em alguns casos, um endere√ßo v√°lido s√≥ √© conhecido ap√≥s o in√≠cio do n√≥. <br>  Nesse caso, podemos implementar um "servi√ßo de descoberta" (descoberta), que √© executado antes que os outros n√≥s e todos os n√≥s se registrem nesse servi√ßo e solicitem os endere√ßos de outros n√≥s. </li><li>  Se podemos modificar o <code>/etc/hosts</code> , podemos usar nomes de host predefinidos (como <code>my-project-main-node</code> e <code>echo-backend</code> ) e apenas vincular esses nomes <br>  com endere√ßos IP durante a implanta√ß√£o. </li></ol><br><p>  No quadro deste post, n√£o consideraremos esses casos com mais detalhes.  Para o nosso <br>  Em um exemplo de brinquedo, todos os n√≥s ter√£o um endere√ßo IP - <code>127.0.0.1</code> . </p></div></div><br><p>  Em seguida, consideramos duas op√ß√µes para um sistema distribu√≠do: </p><br><ol><li>  Coloca√ß√£o de todos os servi√ßos em um n√≥. </li><li>  E a coloca√ß√£o do servi√ßo de eco e do cliente de eco em diferentes n√≥s. </li></ol><br><p>  Configura√ß√£o para um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√∫nico n√≥</a> : </p><br><div class="spoiler">  <b class="spoiler_title">Configura√ß√£o de n√≥ √∫nico</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleNodeConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singleton</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">//</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">identifier</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">the</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">single</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">node</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">//</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">configuration</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Singleton</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nodeId</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">Singleton</span></span> <span class="hljs-comment"><span class="hljs-comment">/** Type safe service port specification. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">portNumber</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortNumber</span></span> = <span class="hljs-number"><span class="hljs-number">8088</span></span> <span class="hljs-comment"><span class="hljs-comment">// configuration of client /** We'll use the service provided by the same host. */ def echoServiceDependency = echoService override def testMessage: UrlPathElement = "hello" def pollInterval: FiniteDuration = 1.second // lifecycle controller configuration def lifetime: FiniteDuration = 10500.milliseconds // additional 0.5 seconds so that there are 10 requests, not 9. }</span></span></code> </pre> </div></div><br><p>  O objeto implementa a configura√ß√£o do cliente e do servidor.  A configura√ß√£o da vida √∫til tamb√©m √© usada para finalizar o programa ap√≥s uma <code>lifetime</code> .  (Ctrl-C tamb√©m funciona e libera todos os recursos corretamente.) </p><br><p>  O mesmo conjunto de caracter√≠sticas e implementa√ß√µes de configura√ß√£o pode ser usado para criar um sistema que consiste em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dois n√≥s separados</a> : </p><br><div class="spoiler">  <b class="spoiler_title">Configura√ß√£o para dois n√≥s</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeServerConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SigTermLifecycleConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">NodeIdImpl</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nodeId</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">NodeServer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">portNumber</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortNumber</span></span> = <span class="hljs-number"><span class="hljs-number">8080</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeClientConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// NB! dependency specification def echoServiceDependency = NodeServerConfig.echoService def pollInterval: FiniteDuration = 1.second def lifetime: FiniteDuration = 10500.milliseconds // additional 0.5 seconds so that there are 10 request, not 9. def testMessage: String = "dolly" }</span></span></code> </pre> </div></div><br><p>  Importante!  Observe como a liga√ß√£o do servi√ßo √© executada.  Indicamos o servi√ßo implementado por um n√≥ como a implementa√ß√£o do m√©todo de depend√™ncia de outro n√≥.  O tipo de depend√™ncia √© verificado pelo compilador, porque  cont√©m o tipo de protocolo.  Quando iniciada, a depend√™ncia conter√° o identificador correto do n√≥ de destino.  Gra√ßas a esse esquema, indicamos o n√∫mero da porta exatamente uma vez e sempre garantimos a refer√™ncia √† porta correta. </p><br><div class="spoiler">  <b class="spoiler_title">Implementa√ß√£o de dois n√≥s do sistema</b> <div class="spoiler_text"><p>  Para esta configura√ß√£o, usamos a mesma implementa√ß√£o de servi√ßo sem altera√ß√µes.  A √∫nica diferen√ßa √© que agora temos dois objetos que implementam conjuntos diferentes de servi√ßos: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TwoJvmNodeServerImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IO</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoServiceService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SigIntLifecycleServiceImpl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">EchoConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">SigTermLifecycleConfig</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TwoJvmNodeClientImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IO</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleServiceImpl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">EchoClientConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">FiniteDurationLifecycleConfig</span></span> }</code> </pre> <br><p>  O primeiro n√≥ implementa o servidor e precisa apenas da configura√ß√£o do servidor.  O segundo n√≥ √© implementado pelo cliente e usa outra parte da configura√ß√£o.  Ambos os n√≥s tamb√©m precisam gerenciar o tempo de vida.  O n√≥ do servidor √© executado indefinidamente at√© ser parado pelo <code>SIGTERM</code> e o n√≥ do cliente termina ap√≥s algum tempo.  Veja o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aplicativo de inicializa√ß√£o</a> . </p></div></div><br><h4 id="obschiy-process-razrabotki">  Processo geral de desenvolvimento </h4><br><p>  Vamos ver como essa abordagem de configura√ß√£o afeta o processo geral de desenvolvimento. </p><br><p>  A configura√ß√£o ser√° compilada junto com o restante do c√≥digo e um artefato (.jar) ser√° gerado.  Aparentemente, faz sentido colocar a configura√ß√£o em um artefato separado.  Isso se deve ao fato de podermos ter muitas configura√ß√µes baseadas no mesmo c√≥digo.  Novamente, voc√™ pode gerar artefatos que correspondem a diferentes ramifica√ß√µes de configura√ß√£o.  Juntamente com a configura√ß√£o, as depend√™ncias de vers√µes espec√≠ficas das bibliotecas s√£o preservadas e essas vers√µes s√£o preservadas para sempre, sempre que decidirmos implantar essa vers√£o da configura√ß√£o. </p><br><p>  Qualquer altera√ß√£o na configura√ß√£o se transforma em uma altera√ß√£o no c√≥digo.  E, portanto, cada um desses <br>  A mudan√ßa ser√° coberta pelo processo usual de garantia de qualidade: </p><br><p>  Um ticket no bugtracker -&gt; PR -&gt; review -&gt; mesclar com os ramos correspondentes -&gt; <br>  integra√ß√£o -&gt; implanta√ß√£o </p><br><p>  As principais conseq√º√™ncias da implementa√ß√£o de uma configura√ß√£o compilada: </p><br><ol><li><p>  A configura√ß√£o ser√° coordenada em todos os n√≥s do sistema distribu√≠do.  Devido ao fato de que todos os n√≥s recebem a mesma configura√ß√£o de uma √∫nica fonte. </p><br></li><li><p>  √â problem√°tico alterar a configura√ß√£o em apenas um dos n√≥s.  Portanto, ‚Äúdesvio de configura√ß√£o‚Äù √© improv√°vel. </p><br></li><li><p>  Torna-se mais dif√≠cil fazer pequenas altera√ß√µes na configura√ß√£o. </p><br></li><li><p>  A maioria das altera√ß√µes na configura√ß√£o ocorrer√° como parte do processo geral de desenvolvimento e ser√° revisada. </p><br></li></ol><br><p>  Preciso de um reposit√≥rio separado para armazenar a configura√ß√£o de produ√ß√£o?  Essa configura√ß√£o pode conter senhas e outras informa√ß√µes secretas, acesso ao qual gostar√≠amos de restringir.  Com base nisso, parece fazer sentido armazenar a configura√ß√£o final em um reposit√≥rio separado.  Voc√™ pode dividir a configura√ß√£o em duas partes - uma contendo as defini√ß√µes de configura√ß√£o p√∫blica e a outra contendo as configura√ß√µes de acesso restrito.  Isso permitir√° que a maioria dos desenvolvedores tenha acesso a par√¢metros comuns.  √â f√°cil conseguir essa separa√ß√£o usando caracter√≠sticas intermedi√°rias que cont√™m valores padr√£o. </p><br><h3 id="vozmozhnye-variacii">  Poss√≠veis varia√ß√µes </h3><br><p>  Vamos tentar comparar a configura√ß√£o compilada com algumas alternativas comuns: </p><br><ol><li>  Um arquivo de texto na m√°quina de destino. </li><li>  Armazenamento centralizado de valor-chave ( <code>etcd</code> / <code>zookeeper</code> ). </li><li>  Componentes do processo que podem ser reconfigurados / reiniciados sem reiniciar o processo. </li><li>  Armazenamento da configura√ß√£o fora do artefato e controle de vers√£o. </li></ol><br><p>  Os arquivos de texto fornecem flexibilidade significativa em termos de pequenas altera√ß√µes.  O administrador do sistema pode ir para o n√≥ remoto, fazer altera√ß√µes nos arquivos correspondentes e reiniciar o servi√ßo.  Para sistemas grandes, no entanto, essa flexibilidade pode ser indesej√°vel.  Das altera√ß√µes feitas, n√£o h√° vest√≠gios em outros sistemas.  Ningu√©m analisa as altera√ß√µes.  √â dif√≠cil estabelecer quem fez as altera√ß√µes e por que motivo.  As altera√ß√µes n√£o s√£o testadas.  Se o sistema for distribu√≠do, o administrador poder√° esquecer de fazer a altera√ß√£o correspondente em outros n√≥s. </p><br><p>  (Observe tamb√©m que o uso de uma configura√ß√£o compilada n√£o bloqueia a possibilidade de usar arquivos de texto no futuro. Ser√° suficiente adicionar um analisador e validador que d√™ o mesmo tipo de <code>Config</code> que uma sa√≠da e voc√™ poder√° usar arquivos de texto. Imediatamente, a complexidade do sistema com a configura√ß√£o compilada √© um pouco menor que a complexidade de um sistema que usa arquivos de texto, porque os arquivos de texto requerem c√≥digo adicional.) </p><br><p>  O armazenamento centralizado de valores-chave √© um bom mecanismo para distribuir meta-par√¢metros de um aplicativo distribu√≠do.  Devemos decidir quais s√£o os par√¢metros de configura√ß√£o e o que s√£o apenas dados.  Suponha que tenhamos uma fun√ß√£o <code>C =&gt; A =&gt; B</code> , com os par√¢metros <code>C</code> raramente mudando e os dados <code>A</code> frequ√™ncia.  Nesse caso, podemos dizer que <code>C</code> s√£o os par√¢metros de configura√ß√£o e <code>A</code> s√£o os dados.  Parece que os par√¢metros de configura√ß√£o diferem dos dados, pois geralmente mudam com menos frequ√™ncia do que os dados.  Al√©m disso, os dados geralmente v√™m de uma fonte (do usu√°rio) e os par√¢metros de configura√ß√£o de outra (do administrador do sistema). </p><br><p>  Se raramente √© necess√°rio atualizar os par√¢metros que precisam ser alterados sem reiniciar o programa, isso geralmente pode levar a uma complica√ß√£o do programa, porque precisaremos fornecer os par√¢metros de alguma forma, armazenar, analisar e verificar, processar valores incorretos.  Portanto, do ponto de vista da redu√ß√£o da complexidade do programa, faz sentido reduzir o n√∫mero de par√¢metros que podem ser alterados durante o programa (ou n√£o oferecer suporte a esses par√¢metros). </p><br><p>  Do ponto de vista deste post, distinguiremos entre par√¢metros est√°ticos e din√¢micos.  Se a l√≥gica do servi√ßo exigir altera√ß√£o de par√¢metros durante o programa, chamaremos esses par√¢metros de din√¢micos.  Caso contr√°rio, os par√¢metros s√£o est√°ticos e podem ser configurados usando uma configura√ß√£o compilada.  Para reconfigura√ß√£o din√¢mica, podemos precisar de um mecanismo para reiniciar partes do programa com novos par√¢metros, semelhante √† maneira como os processos do sistema operacional s√£o reiniciados.  (Em nossa opini√£o, √© aconselh√°vel evitar a reconfigura√ß√£o em tempo real, pois a complexidade do sistema aumenta. Se poss√≠vel, √© melhor usar os recursos padr√£o do sistema operacional para reiniciar os processos.) </p><br><p>  Um aspecto importante do uso de uma configura√ß√£o est√°tica que for√ßa as pessoas a considerar a reconfigura√ß√£o din√¢mica √© o tempo que o sistema leva para reiniciar ap√≥s uma atualiza√ß√£o de configura√ß√£o (tempo de inatividade).  De fato, se precisarmos fazer altera√ß√µes na configura√ß√£o est√°tica, teremos que reiniciar o sistema para que os novos valores entrem em vigor.  O problema do tempo de inatividade tem uma gravidade diferente para diferentes sistemas.  Em alguns casos, voc√™ pode agendar uma reinicializa√ß√£o no momento em que a carga for m√≠nima.  Se voc√™ deseja fornecer servi√ßo cont√≠nuo, pode implementar as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"conex√µes de drenagem" (drenagem da conex√£o do AWS ELB)</a> .  Ao mesmo tempo, quando precisamos reiniciar o sistema, lan√ßamos uma inst√¢ncia paralela desse sistema, mudamos o balanceador para ele e aguardamos at√© que as conex√µes antigas sejam conclu√≠das.  Depois que todas as conex√µes antigas forem conclu√≠das, desativamos a inst√¢ncia antiga do sistema. </p><br><p>  Vamos agora considerar a quest√£o de armazenar a configura√ß√£o dentro ou fora do artefato.  Se armazenarmos a configura√ß√£o dentro do artefato, pelo menos tivemos a oportunidade durante a montagem do artefato para garantir que a configura√ß√£o esteja correta.  Se a configura√ß√£o estiver fora do artefato controlado, ser√° dif√≠cil rastrear quem e por que fez altera√ß√µes nesse arquivo.  Qu√£o importante √© isso?  Em nossa opini√£o, para muitos sistemas de produ√ß√£o, √© importante ter uma configura√ß√£o est√°vel e de alta qualidade. </p><br><p>  A vers√£o do artefato permite determinar quando ele foi criado, quais valores ele cont√©m, quais fun√ß√µes est√£o ativadas / desativadas, quem √© respons√°vel por qualquer altera√ß√£o na configura√ß√£o.  Obviamente, armazenar a configura√ß√£o dentro do artefato requer algum esfor√ßo, portanto, √© necess√°rio tomar uma decis√£o informada. </p><br><h3 id="za-i-protiv">  Os pr√≥s e contras </h3><br><p>  Gostaria de me debru√ßar sobre os pr√≥s e contras da tecnologia proposta. </p><br><h4 id="preimuschestva">  Os benef√≠cios </h4><br><p>  A seguir, √© apresentada uma lista dos principais recursos de uma configura√ß√£o de sistema distribu√≠do compilado: </p><br><ol><li>  Verifica√ß√£o de configura√ß√£o est√°tica.  Permite que voc√™ tenha certeza de que <br>  A configura√ß√£o est√° correta. </li><li>   .         .   Scala      ,   . ,    <br> trait'    ,     ,    val',    (DRY)    .        ( <code>Seq</code> , <code>Map</code> ,  ). </li><li> DSL.  Scala    ,   DSL.        ,         , ,           .  , ,     . </li><li>     .    ,           ,       ,    ,   .        ,          .       ,       . </li><li>    .    ,    ,        . </li><li>   .          ,     . </li><li>  .     ,      .     . (  ,     ,     ,     ,     -.)       ‚Äî    .  , ,    ,       ,    . </li><li>  .          ,         .   , ,        .                .        .       ,       production'. </li><li> .    ,            .  ,           ,    ‚Äî   .      production- . </li><li>  Teste.     mock-,     ,   . </li><li>  .                  .  , , ,     . </li></ol><br><h4 id="nedostatki-i-ogranicheniya">    </h4><br><p>               .    : </p><br><ol><li>  .       production',    .        .          .           . </li><li>  .  ,      ,        . </li><li> .      ,     ,    .    /      . </li><li>   .   DevOps    .             . </li><li>    .               (CI/CD).      . </li></ol><br><p>       ,      : </p><br><ol><li>      ,    ,        .    ,    Cake Pattern'     , , <code>HList</code>     (case class')   . </li><li>     ,     : ( <code>package</code> , <code>import</code> ,  ; <code>override def</code> '  ,    ).    ,    DSL.  ,    (, XML),       . </li><li>            . </li></ol><br><h3 id="zaklyuchenie">  Conclus√£o </h3><br><p>                  Scala.                 xml-   .   ,      Scala,          (  Kotlin, C#, Swift, ...).         , ,  ,    ,    ,   . </p><br><p> ,      .       . </p><br><p>     : </p><br><ol><li>         . </li><li>   DSL        . </li><li>         . ,       ,  (1)      ; (2)       . </li></ol><br><h3 id="blagodarnosti">  </h3><br><p>     ,          . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt447694/">https://habr.com/ru/post/pt447694/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt447682/index.html">Data Center Espacial: 24 horas antes do lan√ßamento</a></li>
<li><a href="../pt447684/index.html">Como mostrar os valores da empresa em um escrit√≥rio (sem p√¥steres e slogans)</a></li>
<li><a href="../pt447686/index.html">Um par√¢metro muito importante das l√¢mpadas LED, que poucas pessoas conhecem</a></li>
<li><a href="../pt447688/index.html">Para a pergunta sobre bitset</a></li>
<li><a href="../pt447690/index.html">Configura√ß√£o compil√°vel de um sistema distribu√≠do</a></li>
<li><a href="../pt447696/index.html">Por que as cidades se op√µem ao Amazon Go, as primeiras lojas que n√£o s√£o de caixa</a></li>
<li><a href="../pt447698/index.html">Red Hogwarts: acad√™mico sem diploma</a></li>
<li><a href="../pt447700/index.html">A flexibilidade emocional √© a chave para o crescimento pessoal.</a></li>
<li><a href="../pt447702/index.html">O c√≠rculo matem√°tico ideal n√£o existe</a></li>
<li><a href="../pt447704/index.html">Escalada Elbrus - Reconhecimento em batalha. Parte t√©cnica 1. Registros, pilhas e outros detalhes t√©cnicos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>