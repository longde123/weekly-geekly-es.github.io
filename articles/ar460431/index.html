<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍪 🙆🏿 🎠 بناء خط أنابيب اختبار الآلي على Azure DevOps ⛳️ 💲 🎽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="في الآونة الأخيرة ، صادفت وحشًا غير مشهور في عالم DevOps ، خطوط أنابيب Azure DevOps. شعرت على الفور بعدم وجود أي تعليمات أو مقالات واضحة حول هذا الموض...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>بناء خط أنابيب اختبار الآلي على Azure DevOps</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460431/" style=";text-align:right;direction:rtl">  في الآونة الأخيرة ، صادفت وحشًا غير مشهور في عالم DevOps ، خطوط أنابيب Azure DevOps.  شعرت على الفور بعدم وجود أي تعليمات أو مقالات واضحة حول هذا الموضوع ، لا أعرف ما هو متصل به ، لكن من الواضح أن لدى Microsoft شيء تعمل عليه من حيث تعميم الأداة.  اليوم سنقوم ببناء خط أنابيب للاختبار الآلي داخل سحابة أزور. <a name="habracut"></a><br><br>  لذلك ، المهمة: <br>  هناك برنامج يبني بنفس Azure DevOps ، ويتم تجميعه من مشروع على WIX.  إذا كان هناك اهتمام ، سأكتب عن هذه الأداة.  في الواقع ، هذه طريقة أكثر آلية لإنشاء أدوات تثبيت Windows ، والتي تحل محل InstallShield القياسي.  لذلك ، يقوم برنامجنا بنجاح بإنشاء وتوليد قطعة أثرية ، ملف setup.exe معين ، يضع التطبيق على نظام Windows.  من الضروري وضع هذا التطبيق في جهاز افتراضي مشابه للمنتج ، ونسخ الاختبارات الآلية التي أعدها فريق الاختبار هناك ، وتشغيلها وجمع النتائج من أجل اعتبار الفرع جيدًا أو سيئًا قبل الدمج.  كل شيء مثل في GitLab ، <s>إلا من خلال ث ....</s> <br><br>  كبيئة افتراضية حيث سنجري اختباراتنا ، من الواضح أننا نستخدم Azure DevTest Labs ، كيان في اشتراكات Azure ، والذي تم إنشاؤه لتحريف كل أنواع هراء الاختبار فيه مقابل أموال مقبولة. <br><br><h1 style=";text-align:right;direction:rtl">  1. سحابة تكامل الجانب </h1><br>  أولاً ، نحتاج إلى دمج DevTest Labs الخاصة بنا مع Azure DevOps ، والتي نحتاج إلى بعض مدير الخدمة لها ، بشكل أساسي حساب خدمة يتيح لك الانتقال إلى خطوط الأنابيب في السحابة وإنشاء / حذف الموارد هناك لأنفسنا. <br><br>  انتقل إلى الاشتراك وابحث عن خدمة Azure Active Directory <br><br><img src="https://habrastorage.org/webt/cf/fn/bq/cffnbqsgvtmscikoypqdftkarpg.jpeg"><br><br>  نجد تسجيلات التطبيقات وانقر على تسجيل جديد ، سيؤدي ذلك إلى إنشاء مدير خدمتنا.  لن أتعرف على الإعدادات التي سأختارها عند الإنشاء ، فقد يختلف هذا بالنسبة لاشتراكات مختلفة. <br><br><img src="https://habrastorage.org/webt/ns/4a/jq/ns4ajqbtui4oz51gruhl84gejac.jpeg"><br><br>  الآن نحن بحاجة إلى منح حقوق لمدير الخدمة لدينا.  للقيام بذلك ، انتقل إلى رمز الاشتراك باستخدام مفتاح.  اختر اشتراكنا <br><br><img src="https://habrastorage.org/webt/-p/tj/te/-ptjtehk7ftpdtlf4op0dwlqj9g.jpeg"><br><br>  بعد ذلك ، في التحكم في الوصول ، انقر فوق تعيين الأدوار وابحث عن هذا الحساب في البحث بالاسم الذي أنشأته للتو.  نحن نعطي دور المساهم ، هذا يكفي. <br><br><img src="https://habrastorage.org/webt/pr/nq/s_/prnqs_0culpmj9xrudzptpv4mc0.jpeg"><br><br>  بعد ذلك ، ارجع إلى مدير خدمتنا في Azure AD وافتح خصائصه.  في وقت لاحق ، سوف نحتاج إلى جميع بطاقات الهوية الموجودة ، ونحن نوفرها. <br><br>  هذا هو المكان الذي تنتهي فيه إعدادات البوابة الخاصة بنا ونذهب إلى Azure DevOps. <br><br><h1 style=";text-align:right;direction:rtl">  2. التكامل على جانب Azure DevOps </h1><br>  بادئ ذي بدء ، نذهب إلى إعدادات المشروع وتحديد اتصالات الخدمة.  إنشاء عنصر جديد من نوع Azure Resource Manager. <br><br><img src="https://habrastorage.org/webt/ct/hc/7c/cthc7c3qagkfuyxa3_6fyod5k90.jpeg"><br><br>  نحتاج الآن إلى جميع بطاقات الهوية التي سجلناها.  انقر فوق استخدام الإصدار الكامل من مربع حوار اتصال الخدمة.  وأدخل جميع البيانات التي تلقيناها من مدير الخدمة.  انقر فوق تحقق ، وإذا كان كل شيء على ما يرام ، فاستمر في الاتصال.  الآن يمكن أن تستخدم خطوط أنابيبنا للاتصال بالسحابة. <br><br><img src="https://habrastorage.org/webt/it/7s/as/it7sas1cjqbrwt58uncazzfp4ee.jpeg"><br><br><h1 style=";text-align:right;direction:rtl">  3. إنشاء خط أنابيب </h1><br>  الآن ننتقل إلى الأكثر إثارة للاهتمام ، بناء خط الأنابيب نفسه.  افتح قائمة Pipelines-Builds <br><br><img src="https://habrastorage.org/webt/et/wd/h5/etwdh5romudzssphyz-hmliq2bw.jpeg"><br><br>  يتم الترحيب بنا من خلال قائمة لإنشاء بنية جديدة ، والتي ستحاول بشكل افتراضي إنشاء ملف YAML لنا بتكوين مناسب.  نحن نرفض هذا بأدب واختيار الإصدار الكلاسيكي.  إن رغبة Microsoft في فعل كل شيء مثل الأشخاص وإتاحة الفرصة لتعظيم تخصيص خطوط الأنابيب عبر YAML أمر مفهوم ، ولكن الوثائق البائسة وعدم القدرة العملية العملية للعديد من الوحدات النمطية تخبرنا أنه من المبكر جدًا استخدام هذه الوظيفة. <br><br><img src="https://habrastorage.org/webt/it/at/gu/itatgu_alr1efjbtvlr6rin5e9i.jpeg"><br><br>  من مجموعة متنوعة من القوالب ، نحتاج إلى خط أنابيب فارغ بسيط.  بعد إنشائها ، يتم الترحيب بنا من خلال نافذة تحرير فارغة ، حيث سنقضي الكثير من الوقت فيها. <br><br><img src="https://habrastorage.org/webt/0t/g0/0h/0tg00hw3ojp3plkvochf9-skdac.jpeg"><br><br>  لذلك ، انقر فوق + والدخول إلى متجر وحدة معينة ، حيث سنحتاج إلى المكونات التالية من القائمة. <br><br><img src="https://habrastorage.org/webt/9q/2l/ud/9q2ludjenipcm_m8oteqerfseoe.jpeg"><br><br>  قبل متابعة تكوين مهمة خط الأنابيب ، نحتاج إلى إنشاء العديد من الملفات ووضعها في المشروع.  ستكون هذه هي قالب ARM الخاص بجهازنا الافتراضي ، والذي سننشئه في Azure DevTest Labs ، البرنامج النصي للحصول على جهاز IP بعد إنشائه ، وإذا لزم الأمر ، البرامج النصية لاختباراتنا أو ما نريد تشغيله على المضيف. <br><br><h1 style=";text-align:right;direction:rtl">  4. جيل قالب أرمينيا </h1><br>  لإنشاء جهاز ظاهري ، سنحتاج أولاً إلى إنشاء قالب خاص به ، ملف json ، نضعه في رمز المشروع بحيث يمكن قراءته من هناك عبر خط الأنابيب. <br><br>  نذهب إلى مختبرنا والعثور على قائمة الصيغ (قواعد قابلة لإعادة الاستخدام) ، انقر لإنشاء واحدة جديدة. <br><br><img src="https://habrastorage.org/webt/8w/rc/-l/8wrc-lfvdcettljp5-j7iclsz1u.jpeg"><br><br>  سيتم الترحيب بنا من خلال قائمة طويلة من الصور كقاعدة ، واختيار حجم الجهاز ، كما هو الحال عند إنشاء جهاز افتراضي.  في هذه المرحلة ، لن نتوقف ، سننتقل فورًا إلى العنصر الأخير من خصائص الآلة ، وهي القطع الأثرية.  يمكنك استخدام أي تكوينات ضرورية لبيئتك.  على سبيل المثال ، أقوم بإضافة جهاز إلى المجال وأضف حساب خدمة إليه كمسؤول بحيث يمكن لخط الأنابيب الوصول إلى هذا الجهاز بعد ذلك ضمن هذا الحساب.  قد يختلف كل هذا ، ولكن بالنسبة للاختبار الناجح للرمز ، نحتاج إلى قطعة أثرية واحدة ، والتي سنناقشها بمزيد من التفصيل.  لوضع أحدث إصدار من البرنامج الذي اختبرناه على أجهزتنا ، سنستخدم أداة تنزيل Azure Pipelines Artifact و Run Script.  تذكر في البداية قلت أنه في مكان ما هناك بنية تسير مع مثبّت التطبيق؟  الآن نحن بحاجة إلى إخبار الجهاز الظاهري ، أو بالأحرى القالب ، حتى يذهب ويأخذ هذا المصنّع.  ولم أقم فقط باستلامه ، ولكنني قمت أيضًا بتعيينه ، حيث نملأ الحقول الخاصة التي تشير إلى المشروع واسم المشروع والمفتاح السري.  المفتاح السري ، كما هو الحال في جميع الأنظمة من هذا النوع ، يتم إنشاؤه في الحساب ، في هذه الحالة في Azure DevOps وتخزينه في الأسرار في مختبرك.  يوجد هنا تحذير صغير ، في Secrets سنحفظه ، لكن هذا القالب ليس باردًا ولا حارًا ، وسيتم إطلاقه من مستخدم آخر كجزء من خط الأنابيب ، وبالتالي سنحتاج إلى إدخال المفتاح السري يدويًا في القالب مرة أخرى. <br><br>  قطعة أثرية أخرى يجب تضمينها هي "تكوين WinRM" ، وسنحتاجها للوصول اللاحق إلى الجهاز.  لا يوجد سوى معلمة واحدة ، اسم المضيف.  نظرًا لأننا لا نعرفها مقدمًا ، فسنستخدم المتغير٪ COMPUTERNAME٪. <br><br><img src="https://habrastorage.org/webt/ve/46/ps/ve46psila9wlzhoh9hiiwatcvxe.jpeg"><br><br>  لذلك قمنا بإضافة جميع القطع الأثرية اللازمة ، وسوف ننتقل إلى سبب وصولنا إلى هنا على الإطلاق.  نحصل على قالب ARM الذي تم إنشاؤه في علامة التبويب "خيارات متقدمة" في نفس نافذة إنشاء الصيغة. <br><br><img src="https://habrastorage.org/webt/bj/ly/ae/bjlyaelkb2okdk8cvk3xvtjhrm0.jpeg"><br><br>  انسخ محتويات الصفحة إلى ملف VMtemplate.json ووضعها في جذر المشروع.  لم نعد بحاجة إلى السحابة ، لقد عدنا إلى خط الأنابيب. <br><br><h1 style=";text-align:right;direction:rtl">  5. تكوين خط أنابيب </h1><br>  لنبدأ بالأكثر أهمية وإثارة للاهتمام ، إنشاء جهاز افتراضي ، من أجل هذا قمنا بكل عمليات الدمج هذه والقوالب.  في اشتراك Azure RM ، نختار اتصال الخدمة الخاص بنا ، والذي قمنا بتكوينه في الفقرة 2. وبعد ذلك ، ستظهر بيئة المعمل المتوفرة.  ثم نختار json الذي أنشأناه ونحدد بعض المتغيرات الإلزامية.  يمكن تعيين اسم المستخدم وكلمة المرور للسيارة إما مباشرة أو عن طريق المتغيرات ، لكنني لست متأكداً على الإطلاق من أنها تعمل ، بغض النظر عن ما أكتب هناك ، ثم لم أستطع الوصول إلى السيارة بموجب هذه الائتمانات ، الشيء الرئيسي هو تعيين اسم السيارة بحيث يكون ذلك ممكنًا دائمًا فريدة من نوعها.  لهذا ، أنا استخدم متغير بيئة البناء. <br><br><img src="https://habrastorage.org/webt/cx/nw/gv/cxnwgvb73r6yougop6htozc6g3c.jpeg"><br><br>  بعد ذلك ، أنشأنا نقطة مهمة أخرى.  بعد إقلاع السيارة ، نحتاج أيضًا إلى معرفة معالمها بطريقة أو بأخرى ، ومن الأفضل ألا نعلمها بل إلى قائمة الرواتب.  للقيام بذلك ، نقوم بعمل نص ، على سبيل المثال GetLabVMParams.ps1 ونضعه في المشروع.  أخذت نص البرنامج النصي على موقع Microsoft على الويب ، لكنني قمت بتصحيحه قليلاً لبيئي ، لأنه  أخذ آلات PublicIP و FQDN.  ليس لدي أي منهما ، لكن هناك PrivateIP الذي ليس من السهل الحصول عليه ، لذا أضفت قطعة. <br><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">Param( [string] $labVmId) $labVmComputeId = (Get-AzureRmResource -Id $labVmId).Properties.ComputeId # Get lab VM resource group name $labVmRgName = (Get-AzureRmResource -Id $labVmComputeId).ResourceGroupName # Get the lab VM Name $labVmName = (Get-AzureRmResource -Id $labVmId).Name # Get lab VM public IP address # $labVMIpAddress = (Get-AzureRmPublicIpAddress -ResourceGroupName $labVmRgName -Name $labVmName).IpAddress # Get lab VM FQDN # $labVMFqdn = (Get-AzureRmPublicIpAddress -ResourceGroupName $labVmRgName -Name $labVmName).DnsSettings.Fqdn # Get lab VM private IP address $VmNetworkdetails= (((Get-AzureRmVM -ResourceGroupName $labVmRgName -Name $labVmName).NetworkProfile).NetworkInterfaces).Id $nicname = $VmNetworkdetails.substring($VmNetworkdetails.LastIndexOf("/")+1) $labVMnetwork = (Get-AzureRmNetworkInterface -Name $nicname -ResourceGroupName $labVmRgName)|Select-Object -ExpandProperty IPConfigurations $labVMIpAddress = $labVMnetwork.PrivateIpAddress # Set a variable labVmRgName to store the lab VM resource group name Write-Host "##vso[task.setvariable variable=labVmRgName;]$labVmRgName" # Set a variable labVMIpAddress to store the lab VM Ip address Write-Host "##vso[task.setvariable variable=labVMIpAddress;]$labVMIpAddress" # Set a variable labVMFqdn to store the lab VM FQDN name Write-Host "##vso[task.setvariable variable=labVMFqdn;]$labVMFqdn" Write-Output $labVMIpAddress Set-Item wsman:\localhost\client\trustedhosts * -Force</code> </pre> <br>  من بين كل ما يقرأه البرنامج النصي ، نحتاج فقط إلى labVMIpAddress المتغير.  حسنًا ، هذا بالنسبة لي ، ربما تحتاج إلى شيء آخر ، ولهذا لم أحذف أي شيء وعلقت للتو على الفائض. <br><br>  سأشرح أيضًا السطر الأخير من البرنامج النصي ، فهو يسمح بوصول آلة البناء الخاصة بنا إلى أي مضيف عبر WinRM. <br><br>  الخطوة التالية ، نحن ندير نصنا الرائع.  سيحتاج إلى نفس الاتصال بالسحابة ، متغير الإدخال بمعرف الجهاز ، والذي بحلول ذلك الوقت سيكون معروفًا بالفعل من الخطوة السابقة.  كيف؟  هنا لا بد من ذكر شيء رائع مثل متغيرات الإخراج.  يمكن أن تحتوي كل خطوة على قائمة بالمتغيرات التي يتم تمريرها إلى خطوات خط الأنابيب التالية.  وفقًا لذلك ، بالنسبة لبرنامجنا النصي الفائق ، فإن هذا المتغير سيكون labVMIpAddress ، ولا تنس الإشارة إلى هذا. <br><br><img src="https://habrastorage.org/webt/yu/va/m7/yuvam7x2ikxspc7ucohyp5oivq4.jpeg"><br><br>  علاوة على ذلك ، أفعل أشياء بسيطة إلى حد ما ، والتي ، بالإضافة إلى ذلك ، يمكن أن تختلف من حالة إلى أخرى.  أقوم بتنفيذ برنامج نصي عن بُعد من خلال إنشاء الكرات ، والتي سأقوم بعدها بتحميل البرامج النصية الخاصة بي. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">New-Item “C:\test" –type directory New-SMBShare –Name “test” –Path “C:\test” –FullAccess everyone</code> </pre> <br>  من اسم الملفوف ، من الواضح أننا نقوم بعد ذلك بنسخ بعض نماذج النصوص إلى الجهاز وتنفيذها في خطوة واحدة أخرى.  كعنوان للجهاز البعيد ، يكون متغيرنا $ (labVMIpAddress) مفيدًا لنا.  بعد ذلك ، نستخدم المهمة "التقاط قطعة أثرية من الكرات" ونسخ نتائج البرنامج النصي إلى بيئة البناء الخاصة بنا ، ثم نقوم بحفظ هذه الملفات في قطعة أثرية البناء بنفس المهمة القياسية.  بعد أن لم نعد بحاجة إلى السيارة ، فإننا نقتلها في الخطوة الأخيرة.  تكمن الصعوبة الرئيسية ، كما يتضح في حجم المقالة ، في الاندماج مع السحابة وإقامة اتصال مع الجهاز الظاهري الذي قمت بإنشائه ، ثم يمكنك الاستمتاع بالفعل بالقدر اللازم. <br><br>  هذا هو مقالي الأول ، لذلك لا نحكم بدقة ، والتعليقات هي موضع ترحيب. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar460431/">https://habr.com/ru/post/ar460431/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar460415/index.html">Apple Watch 4 (44 mm، 2019) vs Pebble Steel Classic (2014)</a></li>
<li><a href="../ar460419/index.html">استعادة حرارة غاز المداخن: صديقة للبيئة</a></li>
<li><a href="../ar460421/index.html">TP-Link T2600G-28SQ التبديل البصري لمقدمي الخدمات: مراجعة مفصلة</a></li>
<li><a href="../ar460423/index.html">ول في بوستجرس: 3. نقطة تفتيش</a></li>
<li><a href="../ar460425/index.html">البرد الجهنمية والإرتفاع والبلازما: في الماضي والحاضر والمستقبل من الموصلية الفائقة</a></li>
<li><a href="../ar460433/index.html">المخاطر والتهديدات على شبكة الإنترنت من الأشياء</a></li>
<li><a href="../ar460435/index.html">متعة صغيرة تافهة # 8: متع صغيرتي للعمل مع قاعدة البيانات</a></li>
<li><a href="../ar460437/index.html">كيف اخماد دراجة الدعم الفني</a></li>
<li><a href="../ar460439/index.html">لغة البرمجة P4</a></li>
<li><a href="../ar460441/index.html">جليب نيتسمان: "لقد وجدت نهاية حقبة لم يطارد فيها الناس بعد الذهب الموجود في عناصر الراديو"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>