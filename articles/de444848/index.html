<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤜🏾 🤳🏽 👨🏽‍🍳 Wie einfach es ist, eine Bestellung zu liefern, wenn man die Kundenadresse kennt (nicht sehr) 🕺🏿 🛌🏼 👍🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! Mein Name ist Denis Girko, ich bin der Systemarchitekt der E-Commerce-Plattform in Lamoda. Letztes Jahr habe ich auf der DevConf-Kon...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie einfach es ist, eine Bestellung zu liefern, wenn man die Kundenadresse kennt (nicht sehr)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lamoda/blog/444848/"><p>  Hallo allerseits!  Mein Name ist Denis Girko, ich bin der Systemarchitekt der E-Commerce-Plattform in Lamoda.  Letztes Jahr habe ich auf der DevConf-Konferenz mit einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bericht gesprochen</a> , den ich mit Ihnen teilen möchte. </p><br><p> Dies ist ein Überprüfungsbericht über die Schwierigkeiten, auf die ein großer Online-Shop bei der Lieferung von Bestellungen stößt, und darüber, welche technischen Lösungen dazu beitragen können, diese zu überwinden (am Beispiel der von Lamoda getesteten Lösungen). </p><br><p><img src="https://habrastorage.org/webt/vc/1p/24/vc1p24p8id79oozynnspkyikg0k.jpeg" alt="Bild"></p><br><p>  Worum geht es?  Ich sage dir: </p><br><ul><li>  Über den Lieferprozess und identifizieren Sie Probleme; </li><li>  wie Liefergebiete effektiv in der Datenbank gespeichert werden können; </li><li>  wie man die Qualität der Daten verbessert, die wir vom Kunden erhalten; </li><li>  So suchen Sie den Adressaten in der Adressdatenbank, um genauere Ergebnisse zu erhalten. </li></ul><a name="habracut"></a><br><h3 id="obschaya-shema-dostavki-zakaza-lamoda">  Allgemeines Lamoda Order Delivery Scheme </h3><br><p>  Lamoda ist ein Online-Shop mit vier Lieferländern: Russland, Ukraine, Kasachstan, Weißrussland.  Wir liefern Waren bereits am nächsten Tag, da wir einen eigenen Lieferservice und ein Dutzend Partner haben, deren Dienstleistungen wir nutzen.  Die Lieferung ist ein großer Teil unseres Geschäfts. </p><br><p>  Lamoda nimmt die Bestellung an, fragt den Kunden zum Zeitpunkt der Registrierung nach der Adresse und leitet sie an den Kurierdienst weiter. </p><br><p><img src="https://habrastorage.org/webt/ng/2d/i1/ng2di1movib3pmlisotbmwq-ffq.png" alt="Bild"></p><cut></cut><br><p>  Was ist, wenn wir nicht einen Kurierdienst haben, sondern mehrere?  Dann wird der nächste Schritt hinzugefügt - um zu bestimmen, welcher Lieferservice die Bestellung entgegennimmt. </p><br><p><img src="https://habrastorage.org/webt/1v/6z/7c/1v6z7ceacbfmk5kctkqh1ss1jeg.png" alt="Bild"></p><br><p>  Möglicherweise gibt es einige Kriterien für die Unternehmensauswahl.  Als Erstes muss jedoch darüber nachgedacht werden, ob dieser Kurierdienst in die vom Kunden ausgewählte Stadt geliefert wird oder nicht.  Daher besteht der erste Schritt bei der Integration eines Kurierunternehmens in unser System darin, den Versorgungsbereich zu ermitteln. <br><img src="https://habrastorage.org/webt/_n/xx/wv/_nxxwvl8qncwmm8vhqhgd2g_qo4.png" alt="Bild"><br>  Als Nächstes müssen Sie lernen, wie Sie überprüfen können, ob die Adresse des Kunden in dieses Gebiet fällt oder nicht. </p><br><p>  Das allgemeine Schema wird verbessert und sieht folgendermaßen aus: </p><br><ul><li>  nach einer Adresse fragen; </li><li>  Finden Sie heraus, welche Kurierdienste es liefern können. </li><li>  Wählen Sie aus den verfügbaren die gewünschte aus. </li></ul><br><p><img src="https://habrastorage.org/webt/7r/av/xo/7ravxognqcj0njydxoauolhxsbk.png" alt="Bild"></p><br><p>  Nun etwas mehr zu diesen Schritten. </p><br><h3 id="sprashivaem-u-klienta-adres">  Wir fragen den Kunden nach der Adresse </h3><br><p>  Wie kann ich ihn fragen? </p><br><ol><li>  Bitten Sie darum, ein großes Feld auszufüllen.  Der Kunde hämmert seine Adresse ein, was keine kniffligen Manipulationen erfordert.  Die Adresse kann auf ein Blatt Papier gedruckt werden, das dem Kurier zu Fuß gegeben wird, der es dann selbst herausfindet. </li><li>  Die zweite Option ist komplizierter.  Wir bitten den Kunden, jede Komponente der Adresse in seinem Feld auszufüllen.  Hier kann man schon was machen.  Vergleichen Sie beispielsweise die Stadt Moskau mit einer bestimmten Liste von Städten.  Aber es wird schlecht funktionieren, weil die Stadt Moskau auf viele Arten geschrieben werden kann: „g.  Moskau “,„ Moskauer Stadt “,„ Moskauer Stadt “ohne Leerzeichen und so weiter. </li><li>  Daher gibt es eine noch erweiterte Option.  Da die Liste der Städte, die wir haben, endlich ist, können Sie eine Liste der Städte vorab zusammenstellen und dem Kunden vorschlagen, die gewünschte Stadt auszuwählen.  Der Bonus ist, dass wir jedem Element einer solchen Liste hier bereits eine Kennung zuordnen können.  Wir Entwickler lieben es, nicht mit Zeichenfolgen zu arbeiten, sondern mit Bezeichnern, die in allen unseren Systemen als Äquivalent zur ausgewählten Stadt verwendet werden können.  Ich habe einen zentralen Postindex auf der Folie als Kennung. <br><img src="https://habrastorage.org/webt/cz/q9/sy/czq9syl4hieoqj8h88c7trupbim.png" alt="Bild"></li></ol><br><h3 id="kakoy-sluzhboy-dostavki-vezem">  Welchen Lieferservice transportieren wir? </h3><br><p>  Da wir einen Bezeichner (Index) haben, lassen Sie das in unserer Datenbank gespeicherte Gebiet durch eine Liste von Indizes dargestellt werden.  In diesem Fall ist der Algorithmus zur Überprüfung des Eintritts der Stadt in das Gebiet sehr einfach.  Also lasst es uns tun: Wir werden die von Kurierdiensten erhaltenen Liefergebiete in Form von Indizes in die Datenbank aufnehmen. </p><br><p>  Indizes haben ihre Vor- und Nachteile.  Ich werde im Voraus sagen, dass Lamoda zu Beginn genau das getan hat: Das Ergebnis der Auswahl eines Stadtkunden war ein Index, und unsere Indizes wurden in der Datenbank gespeichert.  Warum ein Plus?  Wie gesagt, ein Index ist eine Sache, die jeder versteht.  Jeder Manager, der gerade zur Arbeit gekommen ist, weiß, was ein Index ist.  Er kann von der Kurierfirma der Stadt empfangen, sie irgendwie in Indizes umwandeln und verwenden.  Der Nachteil ist, dass der Index die Kennung der Post der russischen Post ist.  Und nahe gelegene Siedlungen können denselben Index haben. </p><br><h3 id="pochemu-perestalo-hvatat-indeksov">  Warum fehlen die Indizes? </h3><br><p>  Ein einfaches Beispiel: Lyubertsie.  In der Nähe liegt das Dorf Marusino.  Marusino hat kein Postamt, ihre Korrespondenz kommt zu einem der Postämter von Lyubertsy.  Wenn wir die Lieferung zu Lyubertsy hinzufügen wollten, aber nicht zu Marusino, weil dies für uns möglicherweise nicht finanziell rentabel ist, könnten wir dies nicht nur nach Index tun. <br><img src="https://habrastorage.org/webt/xy/5d/am/xy5damiwrmj4accagb5uckr8bma.png" alt="Bild"></p><br><p>  Ein weiteres Beispiel ist die Erweiterung und Eröffnung eines zweiten Transitlagers in Moskau durch Lamoda.  Es war notwendig, Moskau in die nördliche und südliche Hälfte zu teilen.  Und bereits zum Zeitpunkt der Bestellung wissen Sie, von welchem ​​Transitlager die Lieferung ausgeführt wird.  In diesem Fall würde ein Index pro Stadt nicht ausreichen. </p><br><p>  Wir haben uns entschieden, Geokoordinaten zusammen mit Indizes zu verwenden.  Wir nehmen die Adresse des Kunden und führen sie durch den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Yandex-Geocoder</a> .  Am Ausgang erhalten wir nicht nur den Index, sondern auch die Koordinaten.  Wir verwenden Indizes in Fällen, in denen Details nicht wichtig sind.  Und die Koordinaten geben die Fälle an, in denen Sie eine dünne Aufteilung des Gebiets vornehmen müssen. </p><br><p>  Sie haben in ihrem Setup-Programm eine Schnittstelle für Logistiker bereitgestellt, über die Sie ein Polygon über der Karte zeichnen können.  Es ist ganz einfach: Der Punkt fällt auf die Mülldeponie - es gibt Lieferung, fällt nicht - nein. <br><img src="https://habrastorage.org/webt/_2/t3/pk/_2t3pkebkcck78k3imgkk6w8cdi.png" alt="Bild"><br>  <em>Schnittstelle zur Erstellung von Polygonzonen</em> </p><br><p>  Der Bonus, den wir für jede Bestellung mit Geokoordinaten haben, war die Möglichkeit, die Schnittstelle zu verbessern, über die Logistiker Routen für Vertriebsmitarbeiter erstellen.  Die Benutzeroberfläche zeigt eine Karte an, auf der Kundenaufträge markiert sind.  Der Logistiker verwendet das Lasso-Tool, das die benachbarten Aufträge zu einer Route zusammenfasst.  Außerdem führt diese Route zu einem Vertriebsmitarbeiter, dh eine Person muss tagsüber nicht von einem Ende der Stadt zum anderen Ende gehen, um alle ihre Bestellungen entgegenzunehmen - sie sind alle geografisch nahe beieinander. <br><img src="https://habrastorage.org/webt/4d/aq/ar/4daqar6z4vmutjh3mdumdwn-6ma.png" alt="Bild"><br>  <em>Routing-Schnittstelle</em> </p><br><p>  Die vom Kunden eingegebene Adresse wird in Koordinaten umgewandelt.  Die Wahrscheinlichkeit, dass wir die Koordinaten für eine bestimmte Adresse direkt erhalten, hängt von der Qualität der vom Kunden eingegebenen Adresse ab.  Daher haben wir uns als erstes Gedanken darüber gemacht, wie wir die Anzahl der bekannten Adressen erhöhen können.  Daher müssen Sie dem Kunden helfen, die richtige Adresse einzugeben. </p><br><p>  Tatsache ist, dass Kunden häufig nicht den von uns für sie bereitgestellten Szenarien folgen. Daher haben wir Adressdatenbanken für jedes der vier Länder erworben, in die wir Bestellungen liefern.  Und sie machten nicht nur für die Stadt, sondern auch für die Straße und sogar für die Hausnummer ein Sajest.  Um eine Liste der Häuser zu erstellen, haben wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die</a> offenen Daten von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">openstreetmap.org</a> analysiert. <br><img src="https://habrastorage.org/webt/bb/4n/bd/bb4nbdspyc75buacqdxmmi3jibk.png" alt="Bild"><br>  <em>Das Checkout-Formular bietet Tipps zur Formalisierung von Adressdaten</em> </p><br><h3 id="adresnaya-baza">  Adressbasis </h3><br><p>  Um ein Sujest an der Adressbasis zu machen, müssen Sie es zu Hause behalten.  Woher haben wir alle Adressbasen für unsere vier Länder?  In Russland ist es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FIAS</a> , die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Adressbasis</a> , die von unserem Steuerdienst erstellt und verwaltet wird.  Es ist ziemlich vollständig, wenn auch nicht ohne Mängel.  Unsere Lieferpartner haben uns in anderen Ländern geholfen. <br><img src="https://habrastorage.org/webt/tp/bi/_m/tpbi_m-s0oxwiiddhd_i5rrw-l8.png" alt="Bild"></p><br><p>  Wir haben auch eine Reihe von PHP-Skripten, die das Format annehmen, mit dem die Adressbasis zu uns kommt, und sie auf ungefähr die gleiche Weise zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PostgreSQL</a> hinzufügen.  Warum in der gleichen Form?  Denn eine der Aufgaben besteht darin, diese Datenbanken regelmäßig aus denselben Quellen zu aktualisieren.  Dies bedeutet, dass die Konvertierung bei jeder Aktualisierung wiederholt werden müsste. Daher werden die Daten an PostgreSQL gesendet und von dort in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Apache Solr</a> konvertiert und gespeichert.  Mit Solr können Sie schnell nach ihnen suchen und sajest machen.  Ein kleiner PHP-Webserver kann Anforderungen in Solr erstellen. Entsprechend ihren Ergebnissen wird eine Liste für den Client auf der Site für einen Vorschlag erstellt. </p><br><div class="spoiler">  <b class="spoiler_title">Lebendes Beispiel</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ko/s4/cz/kos4czfszfi2egrtx2mnwxcaqwo.png" alt="Bild"></p></div></div><br><p><img src="https://habrastorage.org/webt/py/z_/pw/pyz_pw_qs26ypndty6qpowgilsi.png" alt="Bild"></p><br><p>  Wir laden Daten aus der Quelle in ungefähr derselben Form herunter, in der sie zu uns gekommen sind.  Das heißt, mit demselben Satz von Feldern, mit denselben Spaltentypen und so weiter.  Fügen Sie sie so hinzu, wie sie sind.  Wir haben von Anfang an versucht, die Daten in dieser Form zu verwenden, und um sie in die Strukturen umzuwandeln, mit denen wir arbeiten können, haben wir mehrere Ansichten geschrieben.  Da wir 4 Länder haben, wurde dies alles mit 4 multipliziert, und die Unterstützung war sehr schwierig und teuer.  Daher war es notwendig, etwas dagegen zu unternehmen. </p><br><p>  Das erste, was wir losgeworden sind, ist die unstrukturierte oder vielmehr <em>spezifische Strukturiertheit</em> in einem frühen Stadium.  Das heißt, sobald die Rohdaten hochgeladen wurden, transformieren wir sie mithilfe von Ansichten in ein einheitliches Format, mit dem alle anderen Transformationen weiter konfiguriert werden.  Dies hat uns davor bewahrt, mit 4 zu multiplizieren. In diesem Moment vergessen wir die Struktur, in der die Daten zu uns kamen, und arbeiten nur mit dem, was wir für uns selbst erfunden haben. <br><img src="https://habrastorage.org/webt/1s/zp/rn/1szprnn0rmejrvuop8uawdzwvaa.png" alt="Bild"></p><br><p>  Wenn Sie zwei Quellen benötigen - bitte herunterladen.  Die Hauptsache ist, dass das Format dieser Datenausgabe nach der Konvertierung in Ansichten dasselbe ist. <br><img src="https://habrastorage.org/webt/we/ru/dm/werudmivgvezc6ytbrgpmdr0ojm.png" alt="Bild"></p><br><p>  Eine weitere Anforderung für geladene Adressdatenbanken war, dass Punktkorrekturen daran vorgenommen werden mussten.  Ein einfaches Beispiel: In FIAS heißt die Tschuwaschische Republik "Tschuwaschische Republik".  "Tschuwaschien."  Nun, wir wollen nur die Tschuwaschische Republik.  Warum brauchen wir diesen Strich?  Gleichzeitig können wir regelmäßige Aktualisierungen aus Quellen immer noch nicht vermeiden. </p><br><p>  Hier sind die folgenden Ebenen, die wir in PostgreSQL haben. <br><img src="https://habrastorage.org/webt/gf/is/a2/gfisa2hm2svx2gkehzy5raekpim.png" alt="Bild"></p><br><p>  Die Tabellen links sind Rohdaten, die von der Quelle heruntergeladen wurden. </p><br><p>  Dahinter befinden sich Ansichten, die Daten in ein Standardformat konvertieren. </p><br><p>  <em>Lokale Überschreibungen</em> sind unsere Tabellen, die einige Attribute der geladenen Adressdaten punktuell neu definieren.  Wir haben hier zum Beispiel aufgenommen, dass ein Datensatz mit einer solchen Kennung anstelle von „Chuvash rep.  - Tschuwaschien “ist unser gewählter Name. </p><br><p> <em>Die Zuordnungstabelle</em> ist unser Repository für Bezeichner, die wir selbst den heruntergeladenen Adressobjekten zugewiesen haben. Dadurch konnten wir unsere Systeme von der Quelle, von den in der Quelle verwendeten Bezeichnern abstrahieren und nicht nur eine Quelle, sondern sogar mehrere - unter einer ID verbergen Ich werde es etwas später erzählen.  All dies zusammen wird kombiniert und in einer materialisierten Ansicht fixiert.  Somit erhalten wir fast das Äquivalent der endgültigen Tabelle, die durch Ausführen eines SQL-Befehls <code>REFRESH MATERIALIZED VIEW</code> aktualisiert werden kann. </p><br><p>  <em>Adressobjekte</em> - gebildete Adressbasis mit allen Korrekturen und Ergänzungen. </p><br><p>  Am Ausgang haben wir also bereits Adressobjekte korrigiert, bereits mit neuen Namen und unseren Bezeichnern.  All dies wird transformiert und denormalisiert, wie es für die Suche bequem ist, und in Solr addiert. </p><br><p>  Da wir jetzt Adressdatenbanken haben, wäre es cool, diese nicht nur zu verwenden, um ein Sujest für das Bestellformular zu erstellen, sondern auch um eine Suche durchzuführen.  Wo kann eine Suche nützlich sein?  Es stellt sich viel heraus, wo.  Dieselben Zustellgebiete, die wir von Kurierdiensten erhalten, werden sehr oft einfach durch eine Liste von Städten dargestellt.  Und die Liste der Städte ist mit den gleichen Problemen behaftet wie bei Benutzereingaben: Städte können unterschiedliche Interpretationen, unterschiedliche Namen und mehr haben. </p><br><p>  Ich habe hier eine spezielle Folie, eine solche Horrorgeschichte - was müssten wir tun, wenn wir alles manuell nehmen würden, um es in PHP umzuwandeln: Tschetschenien, die Tschetschenische Republik und so für jede Datenquelle - Hölle ist Hölle. </p><br><p><img src="https://habrastorage.org/webt/7t/p4/eo/7tp4eoy0jtxnevev1-0pgdk_axi.png" alt="Bild"></p><br><blockquote>  Ergänzung: Auf dem Bildschirm - ein Stück echten Codes aus dem Dienst, der nur aufgrund der beschriebenen Lösungen unnötig wurde. </blockquote><p>  Wir haben diese Probleme klassifiziert. </p><br><p>  1) Äquivalente Namen derselben Objekte.  Zum Beispiel solche gebräuchlichen Synonyme wie Tschuwaschien und die Tschuwaschische Republik. </p><br><p>  2) Umbenannte Städte.  Die Ukraine befindet sich derzeit in der aktiven Phase, um die kommunistische Vergangenheit loszuwerden, weshalb sie buchstäblich jeden Tag Änderungen an den Namen ihrer Siedlungen vornimmt.  Aus diesem Grund kann sich herausstellen, dass wir in einer Datenbank alte und in einer anderen Datenbank neue Namen haben. </p><br><p>  3) Viele Fehler.  Oft falsch im Status von Siedlungen.  Es gibt ein Dorf, hier ist ein Dorf oder hier ist ein Dorf, es gibt einen Bauernhof. </p><br><p>  4) Transliterierte Fremdwörter ins Russische, oft wird der gleiche Name auf unterschiedliche Weise transliteriert. </p><br><p>  5) Es gibt viele Fehler in der Hierarchie: Zelenograd gehört aus Gewohnheit zur Region Moskau, obwohl es formal auch in Moskau als FIAS aufgeführt ist.  Schreiben Sie richtig "Stadt Moskau, Zelenograd". </p><br><p>  Wie sind wir darauf gekommen? </p><br><p>  Als erstes trennen wir alle unbedeutenden Komponenten der Adresse von den Namen.  Wir werfen sie nicht weg, sie nehmen an der Suche teil, sondern getrennt von den wesentlichen Teilen. <br><img src="https://habrastorage.org/webt/pj/l-/hm/pjl-hmgtn30iryqakbsqjrll6qy.png" alt="Bild"></p><br><p>  Als nächstes haben wir eine kurze Liste gängiger Synonyme und Abkürzungen erstellt, die in den Namen verwendet werden.  Wo es die Quelle erlaubte, haben wir alle Namen in Solr geladen und eingefügt.  Nicht nur die relevantesten, sondern auch mögliche Synonyme und historische Namen. </p><br><p>  Zur besseren Suche werfen wir alle Buchstaben aus, die zu Unstimmigkeiten führen können.  Dies gilt für die russische Sprache und die Sprachen, mit denen wir uns noch befassen müssen. </p><br><p>  Wir korrigieren Tippfehler und korrigieren das Layout. </p><br><p>  Schließlich haben wir uns Phantomeltern ausgedacht - dies sind Eltern, die Objekten zugeordnet sind.  Sie sind für die Suche relevant, nehmen jedoch nicht am Suchergebnis teil.  Für Zelenograd haben wir beispielsweise die Region Moskau hinzugefügt.  Jetzt können Sie nach „Moskau, Zelenograd“ suchen und das gewünschte Objekt finden, aber in den Suchergebnissen ist es immer noch das richtige „Moskau, Zelenograd“. </p><br><p><img src="https://habrastorage.org/webt/rw/kh/qm/rwkhqme_rixhx9dz1du34m0hrqy.png" alt="Bild"></p><br><p>  Abhängig von den Geschäftsanforderungen ist eine unterschiedliche Abstufung der Suchgenauigkeit erforderlich.  Daher haben wir 4 Grad, von denen jeder ein Ergebnis mit einer höheren Wahrscheinlichkeit liefert, aber mit einer niedrigeren Wahrscheinlichkeit ist es genau das Ergebnis, das gesucht wird. <br><img src="https://habrastorage.org/webt/hn/hw/lh/hnhwlh7kyr55fbn5b-eqqqlsxtc.png" alt="Bild"></p><br><p>  Und wo haben wir eine solche Suchanwendung gefunden? </p><br><ul><li>  Wir führen erneut die vom Kunden eingegebene Adresse durch eine solche Suche aus.  Wenn er unsere Tipps auf der Checkout-Seite nicht verwendet hat, haben wir noch eine Chance, die von ihm eingegebenen Zeilen in Bezeichner umzuwandeln.  Wir bekommen eine formalisierte Adresse. </li><li>  Wir durchlaufen diese Suche alles, was uns Kurierdienste senden - wir erkennen die Städte, die sie uns übermitteln.  Auf diese Weise konnten wir nur 10 Stück pro Tag auf den Markt bringen. Dies ist für B2B relevant. Lamoda liefert an Drittunternehmen, sodass pro Zeiteinheit viele neue Kurierdienste verbunden sind. </li><li>  Dies ermöglichte es uns, verschiedene nützliche Informationen in unsere Bezeichner in Adressdatenbanken einzutragen.  Zum Beispiel haben wir Zeitzonen und IP-Adressen heruntergeladen, um nach Städten anhand der IP-Adressen von Kunden zu suchen. </li><li>  Wir haben jetzt die Möglichkeit, die Adressbasis aus zwei Quellen mit einer unserer Kennungen zu verbergen.  Das heißt, es wurde ermöglicht, Duplikate zu vermeiden und dieselben Adressobjekte in beiden Basen abzugleichen. </li></ul><br><p>  Wir hören nicht auf.  Dies ist ein Prozess, den wir noch verbessern können. </p><br><p>  Erstens arbeitet Lamoda an Indizes.  Das heißt, unsere Bezeichner sind Indizes, deren Minuspunkte wir kennen.  Fast alle unsere Systeme haben auf die neue API umgestellt, sie arbeiten nicht mit Indizes, sondern mit genau den Kennungen, die wir selbst unseren Adressobjekten zugewiesen haben.  Das Plus ist, dass die Suche nach einer Stadt im Gebiet so einfach ist wie bei Indizes.  Es gibt jedoch kein Minus in der Tatsache, dass sich mehrere Siedlungen hinter einer ID verstecken können. </p><br><blockquote>  Ergänzung: Die Zeit ist seit dem Moment meiner Rede vergangen, und jetzt bin ich froh, mich zu korrigieren: Unsere Verzeichnisse bleiben nur für den Fall erhalten, dass der Kurier uns ihr Territorium in Form einer Liste von ihnen, zum Beispiel der Russischen Post, gibt.  In anderen Fällen wurden die Indizes durch unsere internen Adresskennungen ersetzt. </blockquote><p>  Auf der Folie befindet sich ein Teil der Benutzeroberfläche, mit der Sie das Gebiet manuell konfigurieren können. Tatsächlich wird jedoch alles aus stapelweise geladenen Listen von Adressobjekten in Form von Zeichenfolgen konfiguriert. <br><img src="https://habrastorage.org/webt/n9/-1/rn/n9-1rnlutwkmd8-tpnyfaxiwuxg.png" alt="Bild"></p><br><p>  Wir haben Geokoordinaten von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">openstreetmap.org</a> für <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Privathaushalte</a> heruntergeladen.  In einem großen Prozentsatz der Fälle müssen wir jetzt nicht mehr zu einem externen Dienst gehen, um den Standort herauszufinden.  Dies reduzierte uns zehnmal irgendwo nach Yandex, was natürlich Geld sparte. </p><br><p>  Wir werden PHP in der Suchkette für Adressdaten los.  Wir haben den Code, der auf Solr auf Lua zugegriffen hat, neu geschrieben.  Ersetzt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nginx</a> durch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Openresty</a> , jetzt ist alles sehr schnell und hält schweren Belastungen stand.  95% der Antworten unseres Suchdienstes passen in 10 Millisekunden, was für uns mehr als ausreichend ist. </p><br><p><img src="https://habrastorage.org/webt/6b/th/wm/6bthwmdw9aq79khamwrwrqfgbqc.png" alt="Bild"></p><br><blockquote>  Ergänzung: Die Verwendung von Openresty und Lua, die durch ihre Leistung angezogen wurden, war eine Art Experiment, das sich ausgezahlt hat: Der Service funktioniert schnell, ist unter Last stabil und leicht zu warten.  Aber seitdem hat Lamoda Golang, das die gleichen Eigenschaften hat, als eine der Programmiersprachen für das geladene Backend übernommen.  Wenn die Entscheidung zur Entwicklung des Dienstes jetzt getroffen würde, würden wir es vorziehen. </blockquote><br><h3 id="vyvod">  Fazit </h3><br><p>  Meine persönliche Moral bei all der geleisteten Arbeit ist, dass Adressdaten ein Bereich sind, in dem Sie keine ideale Datenqualität erwarten können.  Das wird niemals passieren.  Wir werden niemals perfekte Daten von einem Kunden oder von externen Quellen erhalten.  Daher müssen Sie das Maximum aus dem herausdrücken, was ist. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de444848/">https://habr.com/ru/post/de444848/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de444838/index.html">OWASP Russia Meetup</a></li>
<li><a href="../de444840/index.html">3. Check Point Erste Schritte R80.20. Layoutvorbereitung</a></li>
<li><a href="../de444842/index.html">Der erste DNA-programmierbare Computer</a></li>
<li><a href="../de444844/index.html">Gibt es eine Marke zu registrieren? oder Wie wir gezwungen waren, den Namen der Anwendung zu ändern</a></li>
<li><a href="../de444846/index.html">ML.NET 0.11 - Maschinelles Lernen für .Net</a></li>
<li><a href="../de444850/index.html">Quantenmechanik: Das Ende des Interpretationskrieges</a></li>
<li><a href="../de444852/index.html">Smart Home - Umdenken</a></li>
<li><a href="../de444854/index.html">Programmgesteuertes Erstellen von Schnittstellenelementen mit PureLayout (Teil 1)</a></li>
<li><a href="../de444858/index.html">Auf der Suche nach dem besten Mittel</a></li>
<li><a href="../de444860/index.html">OFFZONE 2.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>