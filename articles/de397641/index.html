<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♒️ 👓 🐈 Arbeiten mit Hall-Effekt-Stromsensoren: ACS758 👨🏿‍🍳 💝 🛌🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! 
 
 Vielleicht lohnt es sich, sich ein wenig vorzustellen - ich bin ein regelmäßiger Schaltungsingenieur, der sich auch für Programm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arbeiten mit Hall-Effekt-Stromsensoren: ACS758</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/397641/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hallo allerseits! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vielleicht lohnt es sich, sich ein wenig vorzustellen - ich bin ein regelmäßiger Schaltungsingenieur, der sich auch für Programmierung und einige andere Bereiche der Elektronik interessiert: DSP, FPGA, Funkkommunikation und einige andere. Kürzlich stürzte ich mich kopfüber in SDR-Empfänger. Zuerst wollte ich meinen ersten Artikel (ich hoffe nicht den letzten) einem ernsteren Thema widmen, aber für viele wird es nur eine Lesesache und bringt keinen Nutzen. Daher wurde das Thema hochspezialisiert ausgewählt und ausschließlich angewendet. Ich möchte auch darauf hinweisen, dass wahrscheinlich alle Artikel und Fragen darin eher von der Seite des Schaltungsdesigners und nicht vom Programmierer oder sonst jemandem betrachtet werden. Nun - lass uns gehen!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vor nicht allzu langer Zeit habe ich den Entwurf des "Energieüberwachungssystems für ein Wohngebäude" bestellt. Der Kunde ist mit dem Bau von Vorstadthäusern beschäftigt, sodass einige von Ihnen mein Gerät möglicherweise bereits gesehen haben. Dieses Gerät maß die Verbrauchsströme an jeder Eingangsphase und Spannung und sendete gleichzeitig Daten über den Funkkanal an das bereits installierte Smart Home-System. + Er konnte den Anlasser am Eingang des Hauses abschalten. Im heutigen Gespräch geht es jedoch nicht um ihn, sondern um seine kleine, aber sehr wichtige Komponente - den aktuellen Sensor. Und wie Sie bereits aus dem Titel des Artikels verstanden haben, handelt es sich hierbei um berührungslose Stromsensoren von Allegro - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACS758-100</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ________________________________________________________________________________________________________________________</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Datenblatt, über das ich über den Sensor sprechen werde, finden Sie </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hier</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wie Sie sich vorstellen können, ist die Zahl „100“ am Ende der Markierung der maximale Strom, den der Sensor messen kann. Ehrlich gesagt - ich habe Zweifel daran, es scheint mir, dass die Schlussfolgerungen 200 A für eine lange Zeit einfach nicht standhalten können, obwohl es für die Messung des Einschaltstroms durchaus geeignet ist. In meinem Gerät durchläuft ein 100A-Sensor ohne Probleme ständig mindestens 35A + es gibt Verbrauchsspitzen von bis zu 60A. </font></font><br>
<br>
<img src="http://s018.radikal.ru/i524/1609/71/d94191a601ce.jpg" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 1 - Aussehen des Sensors ACS758-100 (50/200)</font></font></i><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bevor Sie zum Hauptteil des Artikels übergehen, sollten Sie sich mit zwei Quellen vertraut machen. Wenn Sie Grundkenntnisse in Elektronik haben, sind diese überflüssig und können diesen Absatz überspringen. Ich rate dem Rest, sich mit der allgemeinen Entwicklung und dem Verständnis zu befassen: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Hall-Effekt. Phänomen und Funktionsprinzip</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
2) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moderne Stromsensoren</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
________________________________________________________________________________________________________________________ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, beginnen wir mit dem wichtigsten, nämlich der Markierung. Ich kaufe Komponenten in 90% der Fälle unter </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www.digikey.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Komponenten kommen in 5-6 Tagen in Russland an, es gibt wahrscheinlich alles auf der Website und auch eine sehr bequeme parametrische Suche und Dokumentation. Eine vollständige Liste der Sensoren der Familie finden Sie dort auf Anfrage " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACS758</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". Meine Sensoren wurden dort gekauft - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACS758LCB-100B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Datenblatt ist alles gemäß der Markierung markiert, aber ich werde immer noch auf den Schlüsselpunkt " </font><b><font style="vertical-align: inherit;">100 </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " </font><b><font style="vertical-align: inherit;">achten</font></b><font style="vertical-align: inherit;"> : </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ist die Messgrenze in Ampere, </font><b><font style="vertical-align: inherit;">dh</font></b><font style="vertical-align: inherit;"> mein Sensor kann bis zu </font><b><font style="vertical-align: inherit;">100 A</font></b><font style="vertical-align: inherit;"> messen; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " - Dieser Buchstabe ist besondere Aufmerksamkeit wert. An </font><font style="vertical-align: inherit;">seiner Stelle </font><font style="vertical-align: inherit;">kann sich auch der Buchstabe " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">U</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " befinden. Sensor mit Buchstabe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wechselstrom messen können und dementsprechend direkt. </font><font style="vertical-align: inherit;">Ein Sensor mit dem Buchstaben </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">U</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> kann nur Gleichstrom messen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ebenfalls am Anfang des Datenblattes befindet sich eine hervorragende Tafel zu diesem Thema: </font></font><br>
<img src="http://s017.radikal.ru/i441/1609/bd/3a7f9f45575c.jpg" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 2 - Arten von Stromsensoren der ACS758-Familie</font></font></i><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Einer der wichtigsten Gründe für die Verwendung eines solchen Sensors war auch die </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">galvanische Trennung</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Die Leistungsklemmen 4 und 5 sind nicht elektrisch mit den Klemmen 1, 2, 3 verbunden. </font><font style="vertical-align: inherit;">Bei diesem Sensor erfolgt die Kommunikation nur in Form eines induzierten Feldes.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ein weiterer wichtiger Parameter ist in dieser Tabelle aufgeführt - die Abhängigkeit der Ausgangsspannung vom Strom. Das Schöne an diesem Sensortyp ist, dass er einen Spannungsausgang hat, keinen Strom, wie bei klassischen Stromwandlern, was sehr praktisch ist. Beispielsweise kann der Sensorausgang direkt mit dem ADC-Eingang des Mikrocontrollers verbunden werden und Messwerte erfassen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mein Sensor ist </font><font style="vertical-align: inherit;">dieser Wert </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20 mV / A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Dies bedeutet, dass, wenn Strom 1A durch die Klemmen 4-5 des Sensors fließt, die Spannung an seinem Ausgang um </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20 mV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ansteigt </font><font style="vertical-align: inherit;">. Ich denke, die Logik ist klar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie hoch wird im nächsten Moment die Ausgangsspannung sein? Da das Lebensmittel „menschlich“, dh unipolar ist, sollte es bei der Messung von Wechselstrom einen „Bezugspunkt“ geben. In diesem Sensor ist dieser Referenzpunkt 1/2 Stromversorgung (Vcc). Eine solche Lösung kommt häufig vor und ist praktisch. Wenn der Strom in eine Richtung fließt, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beträgt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> der Ausgang " </font><b><font style="vertical-align: inherit;">1/2 Vcc + I * 0,02 V</font></b><font style="vertical-align: inherit;"> ", in der anderen Halbwelle, wenn der Strom in die entgegengesetzte Richtung fließt, beträgt die Ausgangsspannung " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1/2 Vcc - I * 0,02 V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". Am Ausgang erhalten wir eine Sinuswelle, wobei "Null" </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 / 2Vcc ist</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wenn wir Gleichstrom messen, ist der Ausgang " </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1/2 Vcc + I * 0,02 V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". Bei der Verarbeitung von Daten auf dem ADC subtrahieren wir einfach die konstante Komponente </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1/2 Vcc</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und die </font><font style="vertical-align: inherit;">Arbeit mit den realen Daten, die mit dem Rest </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I * 0,02V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt ist es Zeit, in der Praxis zu testen, was ich oben beschrieben oder vielmehr im Datenblatt abgezogen habe. Um mit dem Sensor zu arbeiten und seine Funktionen zu überprüfen, habe ich diesen „Mini-Stand“ gebaut: </font></font><br>
<br>
<img src="http://s017.radikal.ru/i439/1609/64/ef807894e531.jpg" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 3 - Ort zum Testen des aktuellen Sensors</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Zunächst habe ich beschlossen, den Sensor mit Strom zu versorgen und seine Leistung zu messen, um sicherzustellen, dass er „Null“ ist. er hat </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1/2 Vcc genommen</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Das Anschlussdiagramm kann dem Datenblatt entnommen werden, aber um mich kennenzulernen, habe ich keine Zeit verschwendet und den Filterkondensator für das Power + RC-Tiefpassfilter am Vout-Pin geformt. In einem realen Gerät nirgendwo ohne sie! </font></font><br>
<br>
<img src="http://s020.radikal.ru/i710/1609/34/567057bda04a.jpg" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Am</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ende habe ich folgendes Bild erhalten: </font><i><font style="vertical-align: inherit;">Abbildung 4 - Das Ergebnis der Messung von "Null"</font></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
bei angelegter Stromversorgung</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> von meinem </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STM32VL-Discovery-Schal habe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ich diese Ergebnisse gesehen - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,38V</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Die erste Frage, die sich stellte: „ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Warum 2,38 und nicht 2,5, die im Datenblatt beschrieben sind?</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> “ Die Frage verschwand fast augenblicklich - ich habe den Leistungsbus zum Debuggen gemessen und dort waren es 4,76-4,77 V. Aber die Sache ist, dass die Stromversorgung von USB kommt, es gibt bereits 5V, nach USB gibt es einen linearen Stabilisator LM7805, und dies ist eindeutig kein LDO mit einem Abfall von 40 mV. Hier drauf sind es ungefähr 250 mV. Okay, das ist nicht kritisch. Die Hauptsache ist, dass „Null“ 2,38 V ist. Es ist diese Konstante, die ich bei der Verarbeitung von Daten vom ADC subtrahieren werde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und jetzt machen wir die erste Messung, bisher nur mit Hilfe eines Oszilloskops. Ich werde </font><b><font style="vertical-align: inherit;">den</font></b><font style="vertical-align: inherit;"> Kurzschlussstrom meines einstellbaren Netzteils </font><b><font style="vertical-align: inherit;">messen</font></b><font style="vertical-align: inherit;"> , er beträgt </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3,06A</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dies und die eingebauten Amperemeter-Shows und Fluka ergaben das gleiche Ergebnis. Nun, verbinden die Stromversorgungsausgänge an den Schenkeln 4 und 5 des Sensors (im Bild I vituha cast) und sehen , </font><font style="vertical-align: inherit;">was passiert: </font></font><br>
<br>
<img src="http://s019.radikal.ru/i626/1609/40/ea87d3cbf889.jpg" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 5 - Strommessung PSU Kurzschluss</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Wie wir sehen können, ist </font><font style="vertical-align: inherit;">die Spannung </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vout</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erhöht </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">von 2.38V bis 2.44V</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Wenn Sie sich die obige Abhängigkeit ansehen, sollten wir </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,38 V + 3,06 A * 0,02 V / A erhalten</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , was einem Wert von 2,44 V entspricht. Das Ergebnis entspricht den Erwartungen. Bei einem Strom von 3A haben wir einen Anstieg auf "Null" von </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">60 mV</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Fazit - der Sensor funktioniert, Sie können bereits mit Hilfe von MK damit arbeiten.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt müssen Sie den Stromsensor mit einem der ADC-Pins am STM32F100RBT6-Mikrocontroller verbinden. Der Kiesel selbst ist sehr mittelmäßig, die Systemfrequenz beträgt nur 24 MHz, aber dieser Schal hat viel überlebt und sich bewährt. Ich besitze es wahrscheinlich schon seit ungefähr 5 Jahren, weil es zu dem Zeitpunkt, als ST sie rechts und links verteilte, kostenlos empfangen wurde.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zunächst wollte ich aus Gewohnheit einen Operationsverstärker mit einem Koeffizienten nach dem Sensor setzen. gewinnen Sie "1", aber als ich das Strukturdiagramm betrachtete, stellte ich fest, dass er bereits drinnen stand. Das einzige, was zu berücksichtigen ist, ist, dass bei maximalem Strom die Ausgangsleistung gleich der Stromversorgung des Vcc-Sensors ist, dh etwa 5 V, und das STM von 0 bis 3,3 V messen kann. In diesem Fall muss daher ein ohmscher Spannungsteiler eingesetzt werden, z. B. 1: 1,5 oder 1: 2. Meine Strömung ist spärlich, deshalb habe ich diesen Moment bisher vernachlässigt. Mein Testgerät sieht ungefähr so ​​aus: </font></font><br>
<br>
<img src="http://s017.radikal.ru/i401/1609/33/3efd82b449cd.jpg" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 6 - Einsetzen unseres „Amperemeter“</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Ergebnisse zu visualisieren, habe ich das chinesische Display auf den ILI9341-Controller geschraubt. Der Vorteil lag in der Hand, aber meine Hände erreichten ihn überhaupt nicht. </font><font style="vertical-align: inherit;">Um eine vollständige Bibliothek für ihn zu schreiben, tötete er ein paar Stunden und eine Tasse Kaffee. Der Nutzen des Datenblattes war überraschend informativ, was für das Handwerk der Söhne von Jackie Chan selten ist. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt müssen Sie eine Funktion zum Messen von Vout mit dem ADC des Mikrocontrollers schreiben. </font><font style="vertical-align: inherit;">Ich werde nicht im Detail sagen, laut STM32 gibt es bereits ein Meer von Informationen und Lektionen. </font><font style="vertical-align: inherit;">Also schau einfach:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> get_adc_value()<font></font>
    {<font></font>
    ADC_SoftwareStartConvCmd(ADC1, ENABLE);<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(ADC_GetFlagStatus(ADC1, ADC_FLAG_EOC) == RESET);
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ADC_GetConversionValue(ADC1);<font></font>
    }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um die Ergebnisse der Messung des ADC im ausführbaren Code des Hauptteils oder Interrupts zu erhalten, müssen Sie Folgendes schreiben:</font></font><br>
<br>
<pre><code class="cpp hljs"> data_adc = get_adc_value();
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie zuvor die Variable data_adc deklariert haben:</font></font><br>
<br>
<pre><code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> data_adc;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als Ergebnis erhalten wir die Variable data_adc, die einen Wert von 0 bis 4095 annimmt, weil Der ADC im STM32 ist 12 Bit. Als nächstes müssen wir das Ergebnis „bei Papageien“ in eine für uns vertraute Form umwandeln, dh in Ampere. Daher müssen Sie zuerst den Teilungspreis berechnen. Nach dem Stabilisator am 3,3-V-Bus zeigte mein Oszilloskop 3,17 V an, ich verstand nicht, womit es verbunden war. Wenn wir also 3,17 V durch 4095 dividieren, erhalten wir den Wert 0,000774 V - dies ist der Preis für die Division. Das heißt, wenn ich das Ergebnis vom ADC, zum Beispiel 2711, erhalte, multipliziere ich es einfach mit 0,000774 V und erhalte 2,09 V. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In unserer Aufgabe ist Spannung nur ein "Vermittler", wir müssen sie immer noch in Ampere umwandeln. Dazu müssen wir 2,38B vom Ergebnis abziehen und den Rest durch 0,02 [B / A] dividieren. Das Ergebnis ist diese Formel:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> I_out = ((((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)data_adc * presc)<span class="hljs-number"><span class="hljs-number">-2.38</span></span>)/<span class="hljs-number"><span class="hljs-number">0.02</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, es ist Zeit, die Firmware in den Mikrocontroller einzutragen und die Ergebnisse zu sehen: </font></font><br>
<br>
<img src="http://s012.radikal.ru/i320/1609/81/192ff0ef3f85.jpg" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 7 - Messergebnisse der Sensordaten und deren Verarbeitung Ich habe</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
meinen eigenen Stromkreisverbrauch gemessen, da 230 mA sichtbar sind. Nachdem das gleiche mit dem verifizierten Zufall gemessen wurde, stellte sich heraus, dass der Verbrauch 201 mA beträgt. Nun - Genauigkeit mit einer Dezimalstelle ist schon sehr cool. Ich werde erklären, warum ... Der Bereich des gemessenen Stroms beträgt 0..100A, dh eine Genauigkeit von bis zu 1A beträgt 1% und eine Genauigkeit von bis zu Zehntel Ampere beträgt bereits </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,1%!</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und bitte beachten Sie, dass dies ohne Schaltungslösungen ist. Ich war sogar zu faul, um Filterkondore für Essen aufzuhängen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jetzt müssen Sie den Kurzschlussstrom (Kurzschluss) meiner Stromquelle messen. Ich drehe den Griff bis zum Maximum und erhalte das folgende Bild: </font><i><font style="vertical-align: inherit;">Abbildung 8 -</font></i><font style="vertical-align: inherit;"> Kurzschlussstrommessungen</font></font><br>
<br>
<img src="http://s011.radikal.ru/i318/1609/4e/1d975e3d764f.jpg" alt="Bild"><br>
<i><font style="vertical-align: inherit;"></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, tatsächlich die Messwerte auf der Quelle selbst mit einem eigenen Amperemeter: </font></font><br>
<br>
<img src="http://s014.radikal.ru/i328/1609/17/0a3330682a48.jpg" alt="Bild"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abbildung 9 - Wert auf der BP-Skala</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Tatsächlich zeigte es 3,09 A, aber während ich fotografierte, wurde das Vitukha erhitzt und sein Widerstand erhöht, und der Strom fiel dementsprechend ab, aber dies fiel nicht so beängstigend. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zusammenfassend weiß ich nicht einmal, was ich sagen soll. </font><font style="vertical-align: inherit;">Ich hoffe, dass mein Artikel unerfahrenen Funkamateuren auf ihre harte Weise helfen wird. </font><font style="vertical-align: inherit;">Vielleicht wird jemandem meine Form der Präsentation des Materials gefallen, dann kann ich weiterhin regelmäßig über die Arbeit mit verschiedenen Komponenten schreiben. </font><font style="vertical-align: inherit;">Sie können Ihre Wünsche zum Thema in den Kommentaren äußern, ich werde versuchen, dies zu berücksichtigen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und natürlich </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">füge</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ich </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">den Quellcode für das Programm hinzu</font></a><font style="vertical-align: inherit;"> . Sie sehen, wer eine Bibliothek benötigt, um mit dem Display oder dem ADC zu arbeiten. </font><font style="vertical-align: inherit;">Das Projekt selbst in Keil 5.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de397641/">https://habr.com/ru/post/de397641/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de397631/index.html">Dysons Sphäre - wofür ist sie? Teil III: Anwendung des Dyson-Rings und einzelner Elemente</a></li>
<li><a href="../de397633/index.html">Microsoft bringt Biologen und Krebsprogrammierer zusammen</a></li>
<li><a href="../de397635/index.html">Hi-Fi-Barren: Cowon PLENUE S Audio Player</a></li>
<li><a href="../de397637/index.html">Колхозим мониторинг ИБП с протоколом Megatec в Zabbix</a></li>
<li><a href="../de397639/index.html">Notfall-Strahlenmedikamente</a></li>
<li><a href="../de397643/index.html">Ein weiteres Smart Home in mehreren Teilen. Dekorative Beleuchtung</a></li>
<li><a href="../de397647/index.html">EQ-Radio: Ein System zur Bestimmung menschlicher Emotionen mithilfe eines Funksignals</a></li>
<li><a href="../de397649/index.html">Start der chinesischen Raumstation Tiangong-2 [Textübersetzung abgeschlossen]</a></li>
<li><a href="../de397653/index.html">Für die Theorie der Entstehung des Mordor-Flecks am Nordpol von Charon veröffentlichte Berechnungen</a></li>
<li><a href="../de397655/index.html">Der ursprüngliche Kern als Vorbote der Elemente des Lebens</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>