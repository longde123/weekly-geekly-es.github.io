<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¥ ğŸš ğŸ¼ è·³å…¥äº‘ç«¯ã€‚ åœ¨NodeMCU + Azure IoTä¸­å¿ƒä¸Šæ„å»ºé¢„ç®—IoTè§£å†³æ–¹æ¡ˆ ğŸ‘¥ ğŸ•š âš’ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç‰©è”ç½‘è®¾å¤‡æœ€å—æ¬¢è¿çš„ç›®çš„åœ°æ˜¯é¥æµ‹æ”¶é›†ã€‚ è¿„ä»Šä¸ºæ­¢ï¼Œäº‘ç‰©è”ç½‘æœåŠ¡çš„ä»·æ ¼å·²ç»ä¸‹é™äº†å¾ˆå¤šï¼Œç”šè‡³æ™®é€šæ™®é€šç”¨æˆ·ä¹Ÿè´Ÿæ‹…ä¸èµ·ä½¿ç”¨å®ƒä»¬çš„è´¹ç”¨ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•ä½¿ç”¨Luaè¯­è¨€ä»NodeMCUæ¿å‘äº‘å‘é€æ•°æ®ã€‚ 





 æ³¨æ„ï¼šæˆ‘ä»¬å°†ç»§ç»­é˜…è¯»Hackeræ‚å¿—çš„æ–‡ç« çš„å®Œæ•´ç‰ˆæœ¬ç³»åˆ—ã€‚ ä½œè€…çš„æ‹¼å†™å’Œæ ‡ç‚¹ç¬¦å·å¾—ä»¥ä¿å­˜ã€‚...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>è·³å…¥äº‘ç«¯ã€‚ åœ¨NodeMCU + Azure IoTä¸­å¿ƒä¸Šæ„å»ºé¢„ç®—IoTè§£å†³æ–¹æ¡ˆ</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/421847/"><p> ç‰©è”ç½‘è®¾å¤‡æœ€å—æ¬¢è¿çš„ç›®çš„åœ°æ˜¯é¥æµ‹æ”¶é›†ã€‚ è¿„ä»Šä¸ºæ­¢ï¼Œäº‘ç‰©è”ç½‘æœåŠ¡çš„ä»·æ ¼å·²ç»ä¸‹é™äº†å¾ˆå¤šï¼Œç”šè‡³æ™®é€šæ™®é€šç”¨æˆ·ä¹Ÿè´Ÿæ‹…ä¸èµ·ä½¿ç”¨å®ƒä»¬çš„è´¹ç”¨ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•ä½¿ç”¨Luaè¯­è¨€ä»NodeMCUæ¿å‘äº‘å‘é€æ•°æ®ã€‚ </p><br><p><img src="https://habrastorage.org/webt/k3/f5/nx/k3f5nxom4hfjshqqwpgl43ppjwo.jpeg"><a name="habracut"></a></p><br><p>  <em>æ³¨æ„ï¼šæˆ‘ä»¬å°†ç»§ç»­é˜…è¯»Hackeræ‚å¿—çš„æ–‡ç« çš„å®Œæ•´ç‰ˆæœ¬ç³»åˆ—ã€‚</em>  <em>ä½œè€…çš„æ‹¼å†™å’Œæ ‡ç‚¹ç¬¦å·å¾—ä»¥ä¿å­˜ã€‚</em> </p><br><p> æˆ‘è¯·ä½œè€…å‘è¨€ã€‚ </p><br><p> ç”±äºæˆ‘åœ¨MicrosoftæŠ€æœ¯å †æ ˆä¸­å·¥ä½œï¼Œå› æ­¤æˆ‘ä½¿ç”¨AzureåŠŸèƒ½å’Œè¡¨å­˜å‚¨æ¥åˆ›å»ºIoTè§£å†³æ–¹æ¡ˆçš„äº‘éƒ¨åˆ†ï¼Œä½†æ˜¯æˆ‘çš„NodeMCUå’ŒLuaçš„PoCä¹Ÿå¯ä»¥ä¸å…¶ä»–IoTè§£å†³æ–¹æ¡ˆçš„äº‘æä¾›å•†ä¸€èµ·ä½¿ç”¨ã€‚ </p><br><h1> èµ„è®¯ </h1><br><p>  Expressif NodeMCUæ˜¯æœ€ä¾¿å®œçš„ä¸»æ¿ä¹‹ä¸€ï¼Œå¸¦æœ‰Wi-Fiï¼Œå¾®å‹USBå’Œæ¿è½½ç¼–ç¨‹å™¨ã€‚ å®ƒåŸºäºESP8266æ¨¡å—ã€‚ ç¬¬äºŒä»£æ¿çš„ä»·æ ¼çº¦ä¸º6-7ç¾å…ƒã€‚ æ‚¨å¯ä»¥é€šè¿‡Arduino IDEä½¿ç”¨è¯¥æ¿ã€‚ æ­¤å¤–ï¼Œè¯¥æ¿è¿˜æ”¯æŒä¸€ç§ç§°ä¸ºLuaçš„è„šæœ¬è¯­è¨€ï¼ˆä»è‘¡è„ç‰™è¯­ç¿»è¯‘ä¸ºâ€œ Moonâ€ï¼‰ã€‚ </p><br><h2> è¿æ¥å¹¶é…ç½®è®¾å¤‡ </h2><br><p> ä¸ºäº†åœ¨Windowsä¸‹è¯†åˆ«è®¾å¤‡ï¼Œæ‚¨éœ€è¦ä»ä»¥ä¸‹é“¾æ¥ä¸‹è½½é©±åŠ¨ç¨‹åºï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CP210x USBè‡³UART Bridge VCPé©±åŠ¨ç¨‹åº</a> </p><br><p> NodeMCUçš„æ ‡å‡†ä¸²è¡Œç«¯å£é€Ÿåº¦ä¸º115'200bpsã€‚ æ‚¨å¯ä»¥è®¾ç½®ä¸åŒçš„é€Ÿåº¦ï¼Œåœ¨ç¬¬ä¸€æ¬¡é‡ç½®è®¾å¤‡æ—¶ï¼Œå®ƒå°†è¿”å›åˆ°115200ã€‚ <br> å°†é©±åŠ¨ç¨‹åºè®¾ç½®ä¸ºå®Œå…¨ç›¸åŒçš„é€Ÿåº¦éå¸¸é‡è¦ï¼š </p><br><p><img src="https://habrastorage.org/webt/ce/sq/y5/cesqy5kslu5pos-rrdqsxvch-vo.png"></p><br><h2> éŸ§ä½“ </h2><br><p> åˆå§‹å›ºä»¶å¾ˆå¯èƒ½ä¼šé—æ¼æŸäº›ä¸œè¥¿ï¼Œå› æ­¤ç†æƒ³æƒ…å†µä¸‹è¯·è‡ªå·±åˆ·æ–°è®¾å¤‡ã€‚ æœ‰å‡ ç§æ„å»ºå›ºä»¶æ˜ åƒçš„æ–¹æ³•ã€‚ ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº‘æœåŠ¡</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Dockeræ˜ åƒ</a>æˆ–ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Linuxçš„è¯´æ˜</a> ã€‚ æˆ‘ä½¿ç”¨äº‘æœåŠ¡æ”¶é›†äº†ã€‚ æˆ‘ä¹Ÿå»ºè®®æ‚¨ä½¿ç”¨æ­¤é€‰é¡¹ã€‚ </p><br><p> å¦‚æœéœ€è¦å°†æ•°æ®å‘é€åˆ°äº‘ï¼Œåˆ™é€‰æ‹©æ‰€éœ€çš„åŠŸèƒ½æ˜¯SNTPï¼ŒMQTTï¼ŒHTTPï¼ˆé»˜è®¤æƒ…å†µä¸‹å·²é€‰æ‹©WiFiï¼Œè®¡æ—¶å™¨ï¼Œæ–‡ä»¶ï¼ŒGPIOï¼Œç½‘ç»œï¼ŒèŠ‚ç‚¹ï¼ŒUARTï¼‰ã€‚ è¿˜éœ€è¦åœ¨å…¶ä»–é€‰é¡¹ä¸­æ ‡è®°ä¸ºå¿…éœ€çš„TLS / SSLæ”¯æŒ <br> å¸¦æœ‰binæ–‡ä»¶çš„é“¾æ¥åŒ…å«åœ¨é‚®ä»¶ä¸­ã€‚ æ›´å‡†ç¡®åœ°è¯´ï¼Œå³ä½¿æœ‰2ä¸ªé“¾æ¥ä¹Ÿä¼šç«‹å³å‡ºç°ã€‚ ä¸€ä¸ªå¸¦æœ‰æ”¯æŒæµ®ç‚¹è¿ç®—çš„æ˜ åƒï¼Œç¬¬äºŒä¸ªå¸¦æœ‰ä¸æ”¯æŒæµ®ç‚¹è¿ç®—çš„æ˜ åƒã€‚ </p><br><p> åˆ·æ–°ESP8266ä¹‹å‰ï¼Œå¿…é¡»å°†å…¶ç½®äºç‰¹æ®Šæ¨¡å¼ã€‚ æ¿ä¸Šæœ‰ä¸€ä¸ªå•ç‹¬çš„FLASHæŒ‰é’®ã€‚ åœ¨åŠ ç”µæœŸé—´æŒ‰å®ƒæˆ–æŒ‰å¤ä½ä¼šä½¿è®¾å¤‡è¿›å…¥å¼•å¯¼åŠ è½½ç¨‹åºæ¨¡å¼ã€‚ å¦‚æœæ‚¨çš„ç”µè·¯æ¿ä¿®æ”¹æ²¡æœ‰è¿™æ ·çš„æŒ‰é’®ï¼Œåˆ™åœ¨é—ªçƒä¹‹å‰ï¼Œæ‚¨éœ€è¦å°†GPIO0è¿æ¥è‡³GNDå¹¶æŒ‰resetï¼ˆæ­¤æ–¹æ³•é€‚ç”¨äºESP-12ï¼‰ã€‚ </p><br><p> å¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PyFlasher</a>å®ç”¨ç¨‹åºæ¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ·æ–°</a>å›ºä»¶ã€‚ åç§°ä¸­çš„Pyè¡¨ç¤ºåº”ç”¨ç¨‹åºæ˜¯ç”¨Pythonç¼–å†™çš„ã€‚ ä¹Ÿæœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">nodemcu-flasher</a> ï¼Œä½†æ˜¯å¾ˆé•¿ä¸€æ®µæ—¶é—´æ²¡æœ‰æ›´æ–°ã€‚ æˆ‘æ²¡æœ‰å°è¯•è¿‡ã€‚ </p><br><p>  PyFlasherçª—å£å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><p><img src="https://habrastorage.org/webt/1a/ns/rh/1ansrh_oc-zpqvaif8eujfvetvg.png"></p><br><p> æ ¹æ®ä½¿ç”¨çš„æ¿å¡é€‰æ‹©é—ªå…‰æ¨¡å¼ã€‚ å¤§å¤šæ•°åŸºäºESP8266 ESP-12å’ŒESP32æ¨¡å—çš„ç°ä»£ä¸»æ¿éƒ½ä½¿ç”¨DIOæ¨¡å¼ã€‚  ESP8266 01åˆ°07é€‚åˆæ›´å¿«çš„QIOæ¨¡å¼ã€‚  ESP8285ä½¿ç”¨DOUTã€‚ </p><br><h2>  IDEè®¾ç½® </h2><br><p> ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ESPlorer</a>é“¾æ¥ä¸‹è½½å…è´¹çš„IDEã€‚ å¦å¤–ï¼Œè¿˜æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ZeroBrane Studio</a> ã€‚ æˆ‘æœ€å–œæ¬¢ESPlorerï¼Œå› æ­¤æˆ‘å°†ä¸¾ä¸€ä¸ªä½¿ç”¨å®ƒçš„ç¤ºä¾‹ã€‚  ESPlorerç”¨JAVAç¼–å†™ã€‚ åº”ç”¨ç¨‹åºç•Œé¢æ˜¯ </p><br><p><img src="https://habrastorage.org/webt/gi/lj/vs/giljvs_zxesytj7k52d_nlka_u8.png"></p><br><p> å·¦ä¾§æ˜¯ä»£ç ï¼Œè®¾ç½®å’Œå…¶ä»–ä¸€äº›ç±»ä¼¼çš„åŠŸèƒ½ã€‚ å³ä¾§æ˜¯ç›‘è§†çª—å£å’Œè®¾å¤‡ç®¡ç†å‘½ä»¤ã€‚ æ‰“å¼€åº”ç”¨ç¨‹åºï¼Œé€‰æ‹©ç«¯å£ã€‚ è®¾ç½®äº¤æ¢å‘ç”Ÿçš„é€Ÿåº¦ï¼ˆæœ€æœ‰å¯èƒ½æ˜¯115200ï¼‰ï¼Œç„¶åå•å‡»â€œæ‰“å¼€â€ã€‚ </p><br><p><img src="https://habrastorage.org/webt/1p/iq/xr/1piqxr933-f-nwkk6wagwtw42ea.png"></p><br><p> è¦é¢„çƒ­ï¼Œæ‚¨å¯ä»¥è¿è¡Œä¸€ä¸ªç®€å•çš„è„šæœ¬ï¼Œè¯¥è„šæœ¬ä»¥å†…ç½®çš„LEDé—ªçƒï¼š </p><br><pre><code class="hljs powershell">LED = <span class="hljs-number"><span class="hljs-number">0</span></span> gpio.mode(LED, gpio.OUTPUT) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flash_led</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gpio</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LED, gpio.LOW)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmr</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delay</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(500000)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gpio</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LED, gpio.HIGH)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmr</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alarm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1, 1000, tmr.ALARM_AUTO, flash_led)</span></span></span></span></code> </pre> <br><p> å¦‚æœæ‚¨çš„æ¿ä¸Šæ²¡æœ‰å†…ç½®LEDï¼ˆæˆ–è€…æ‚¨å®Œå…¨åŒå€¦äº†LED =é—ªçƒçš„ç¤ºä¾‹ï¼‰ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å°è¯•æ‰§è¡Œä¸€ä¸ªæ›´ç®€å•çš„è„šæœ¬æ¥æ˜¾ç¤ºè¯¥è¡Œï¼š </p><br><pre> <code class="hljs swift"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello from Lua!"</span></span>)</code> </pre> <br><p> åˆ›å»º.luaæ–‡ä»¶ï¼ˆä¾‹å¦‚test.luaï¼‰åï¼Œå‘å…¶ä¸­æ·»åŠ ä»£ç å¹¶å°†å…¶ä¿å­˜åˆ°ç£ç›˜ï¼Œç„¶åå¯ä»¥å°†å…¶ä¸‹è½½åˆ°è®¾å¤‡ä¸­ã€‚ ä¸ºæ­¤ï¼Œè¯·æ‰“å¼€æœªæ‰“å¼€çš„ç«¯å£ï¼ˆâ€œæ‰“å¼€â€æŒ‰é’®ï¼‰ï¼Œç„¶åå•å‡»â€œä¸Šè½½â€æŒ‰é’®ã€‚ æ‚¨å¯ä»¥åœ¨ä»£ç ä¸‹æ–¹çš„æŒ‰é’®ï¼ˆå·¦ä¾§ï¼‰ä¸­æ‰¾åˆ°å®ƒã€‚ </p><br><p> ä¸‹è½½æ–‡ä»¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡å‘é€ä»¥ä¸‹å‘½ä»¤æ¥æ‰§è¡Œè¯¥æ–‡ä»¶ï¼š </p><br><pre> <code class="hljs lisp">dofile(<span class="hljs-string"><span class="hljs-string">"test.lua"</span></span>)</code> </pre> <br><p> å¯ä»¥åœ¨æ˜¾ç¤ºå™¨å³ä¸‹æ–¹çš„ä¸‹éƒ¨å­—æ®µä¸­æ‰‹åŠ¨è¾“å…¥å‘½ä»¤ã€‚ æˆ–è€…ï¼Œå¦‚æœæ‚¨ä¸æƒ³è¾“å…¥ä»»ä½•æ–‡æœ¬ï¼Œåˆ™å¯ä»¥å•å‡»â€œé‡æ–°åŠ è½½â€æŒ‰é’®ï¼ˆå³ä¾§æœ€å³è¾¹çš„æŒ‰é’®ï¼‰ã€‚ å•å‡»æ­¤æŒ‰é’®åï¼Œæ‚¨å°†æ”¶åˆ°ä¸€ä¸ªæŒ‰é’®åˆ—è¡¨ï¼Œå…¶ä¸­åœ¨æ¿ä¸ŠåŠ è½½äº†.luaæ–‡ä»¶ã€‚ å•å‡»å¸¦æœ‰æ–‡ä»¶åçš„æŒ‰é’®å°†å¯åŠ¨è¯¥æ–‡ä»¶ä»¥æ‰§è¡Œã€‚ </p><br><p> å¦‚æœè¦åœ¨æ‰“å¼€ä¸»æ¿åç«‹å³å¯åŠ¨æ–‡ä»¶ï¼Œè¯·åˆ›å»ºä¸€ä¸ªåä¸ºinit.luaçš„æ–‡ä»¶ã€‚ </p><br><h2> é…ç½®äº‘éƒ¨åˆ†ä»¥ä½¿ç”¨è®¾å¤‡ </h2><br><p> è®©æˆ‘ä»¬ç¦»å¼€è®¾å¤‡ä¸€æ®µæ—¶é—´ï¼Œç„¶ååœ¨äº‘ä¸­åˆ›å»ºå®ƒçš„ä¸¤å€ã€‚ æœ€è¿‘ï¼Œå¯ä»¥ä½¿ç”¨æ–°åŠŸèƒ½åœ¨Azureé—¨æˆ·ä¸Šç›´æ¥åˆ›å»ºåŒè®¾å¤‡ã€‚ åœ¨åä¸ºâ€œèµ„æºç®¡ç†å™¨â€çš„IoTä¸­å¿ƒè®¾ç½®ç»„ä¸­ï¼Œæ‚¨éœ€è¦é€‰æ‹©IoTè®¾å¤‡å¹¶å•å‡»â€œ +æ·»åŠ â€ </p><br><p> è¦å°†è®¾å¤‡è¿æ¥åˆ°IoTä¸­å¿ƒï¼Œæˆ‘ä»¬éœ€è¦ç”ŸæˆSASï¼ˆå…±äº«è®¿é—®ç­¾åï¼‰ã€‚ ä¸ºäº†ç”ŸæˆSASï¼Œä½¿ç”¨äº†è®¾å¤‡åŒé”®ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›è¾…åŠ©å®ç”¨ç¨‹åºï¼ˆè®¾å¤‡èµ„æºç®¡ç†å™¨ï¼Œiothub-explorerï¼Œç”¨äºAzure CLI 2.0çš„IoTæ‰©å±•ï¼‰æ¥è·å¾—å®ƒã€‚ ä½†æ˜¯æœ€ç®€å•çš„æ–¹æ³•æ˜¯ï¼Œé€šè¿‡è½¬åˆ°IoTä¸­å¿ƒ-&gt; IoTè®¾å¤‡ï¼Œåœ¨Azureé—¨æˆ·ä¸Šçš„åŒä¸€ä½ç½®è·å–å¯†é’¥ã€‚ </p><br><p><img src="https://habrastorage.org/webt/gu/fn/jz/gufnjz89qukktzouxgsoauw01ww.png"></p><br><p>  SASå¯ä»¥åœ¨è®¾å¤‡ä¸Šç”Ÿæˆï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»»ä½•åœ¨çº¿æœåŠ¡ç”Ÿæˆã€‚ å¦‚æœæ‚¨ä½¿ç”¨SDKï¼Œåˆ™å®ƒå¯ä»¥è‡ªåŠ¨ä¸ºæ‚¨ç”ŸæˆSASï¼ˆè¶³ä»¥åœ¨ä»£ç ä¸­æŒ‡å®šè®¾å¤‡çš„åŒé”®ï¼‰ã€‚ </p><br><p><img src="https://habrastorage.org/webt/ob/gs/v1/obgsv1ag1bhj7rrcjejvonpvs3u.png"></p><br><p> åœ¨ç‰¹å®šçš„æœ‰é™æ—¶é—´å†…ç”±WebæœåŠ¡ç”ŸæˆSASä»¤ç‰Œçš„æ–¹å¼ç¨å¾®æ›´å®‰å…¨ã€‚ è™½ç„¶æœ‰ä¸€å®šçš„ç»†å¾®å·®åˆ«ã€‚ å¦‚æœä»…å°†è®¾å¤‡åç§°å‘é€åˆ°æœåŠ¡ï¼Œåˆ™æœ‰äººå¯ä»¥æœç´¢åç§°ä»¥è·å–å…¶ä»–è®¾å¤‡çš„ä»¤ç‰Œã€‚ å› æ­¤ï¼Œä¸ºäº†ä½¿è¿‡ç¨‹æ›´åŠ å®‰å…¨ï¼Œæˆ‘å»ºè®®é‡‡ç”¨ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼šè®©æˆ‘ä»¬å°†è®¾å¤‡åŒé”®çš„Azureå“ˆå¸Œä¿å­˜åœ¨è®¾å¤‡ä¸Šã€‚ åœ¨æœåŠ¡ä»£ç ä¸­ï¼Œåœ¨ç”ŸæˆSASä¹‹å‰ï¼Œæˆ‘ä»¬å°†æ£€æŸ¥å“ˆå¸Œå€¼æ˜¯å¦ä¸è®¾å¤‡å¯†é’¥çš„å“ˆå¸Œå€¼åŒ¹é…ã€‚ å› æ­¤ï¼Œæœ‰å¯èƒ½ä»…çŸ¥é“è®¾å¤‡åç§°å’Œå…¶å¯†é’¥çš„å“ˆå¸Œæ¥è·å¾—SASã€‚ </p><br><p> åœ¨è®¾å¤‡ä¸Šç”ŸæˆSASçš„ç¬¬ä¸€ç§æ–¹æ³•æ›´ç®€å•ï¼Œæ›´æ–¹ä¾¿ï¼Œä½†å®‰å…¨æ€§ç¨å·®ã€‚ ç”±äºåœ¨è·å¾—å¯¹è®¾å¤‡çš„è®¿é—®æƒé™ä¹‹åï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿè·å–å¯†é’¥å¹¶è‡ªè¡Œç”ŸæˆSASè®¾å¤‡ã€‚ åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œè®¿é—®è®¾å¤‡åï¼Œç ´è§£è€…å°†åªèƒ½æ¥æ”¶å¯¿å‘½æœ‰é™çš„SASä»¤ç‰Œã€‚ </p><br><p> äº‹å®è¯æ˜ï¼Œå¦‚æœé»‘å®¢å¯ä»¥è®¿é—®è®¾å¤‡ï¼Œé‚£ä¹ˆè¿™ä¸¤ç§æ–¹æ³•åŸºæœ¬ä¸Šéƒ½ä¸ç†æƒ³ã€‚ å³ä½¿ä½¿ç”¨VPNä¿æŠ¤è¿æ¥ä¹Ÿæ— æµäºäº‹ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¼ è¾“é€šé“å°†å—åˆ°ä¿æŠ¤ï¼Œä½†æ˜¯å°†è®¾å¤‡æ‹¿åˆ°æ‰‹ä¸­çš„äººå°†å¯ä»¥è®¿é—®è¯¥é€šé“ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œåœ¨NodeMCUï¼ŒArduinoç­‰è®¾å¤‡ä¸Š æ— æ³•å°†å¯†é’¥/å¯†ç å­˜å‚¨åœ¨ä»»ä½•å®‰å…¨å­˜å‚¨ä¸­ã€‚ ä½æˆæœ¬ç‰©è”ç½‘è®¾å¤‡å¸‚åœºå¯èƒ½éœ€è¦æ–°çš„ç¡¬ä»¶åŠŸèƒ½ã€‚ </p><br><h2> ä¸ºSASç”Ÿæˆåˆ›å»ºAzureåŠŸèƒ½ </h2><br><p> ä½œä¸ºä¸€é¡¹åœ¨çº¿æœåŠ¡ï¼Œæœ€å®¹æ˜“ä½¿ç”¨AzureåŠŸèƒ½ã€‚ è¿™äº›ç‹¬ç‰¹çš„ç‰‡æ®µå¯ä»¥ç«‹å³åœ¨æµè§ˆå™¨çš„Azureé—¨æˆ·ä¸­ç¼–å†™ã€‚ å¼€ä¸ªç©ç¬‘ï¼Œä½†æ‚¨ç”šè‡³å¯ä»¥é€šè¿‡æ™ºèƒ½æ‰‹æœºè¿›è¡Œç¼–ç¨‹ã€‚ å½“ç„¶ï¼Œæ²¡æœ‰äººç¦æ­¢ä»Visual Studioåˆ›å»ºå’Œè°ƒè¯•å®ƒä»¬ï¼Œç„¶åæ‰ä»¥ç¼–è¯‘å½¢å¼å°†å…¶å‘å¸ƒåˆ°Azureã€‚ </p><br><p> è¯¥åŠŸèƒ½çš„ä»»åŠ¡æ˜¯æ‰§è¡Œä¸€äº›é€šå¸¸ä¸æ˜¯å¾ˆå¤æ‚çš„æ“ä½œã€‚ æ ¹æ®å¾®æœåŠ¡çš„æƒ³æ³•ï¼Œæ¯ä¸ªåŠŸèƒ½éƒ½å¯ä»¥åšä¸€ä»¶äº‹ï¼Œä½†è¿™éå¸¸å¥½ï¼ˆå•è´£ä»»åŸåˆ™ï¼‰ã€‚ </p><br><p> æ‚¨å¯ä»¥é€šè¿‡å¡«å†™ç®€çŸ­çš„è¡¨æ ¼åœ¨é—¨æˆ·ä¸Šåˆ›å»ºä¸€ä¸ªAzure Functionåº”ç”¨ </p><br><p><img src="https://habrastorage.org/webt/hd/ec/cu/hdeccuzb_kfv3cz7ggi1x5cnwe4.png"></p><br><p> æ¶ˆè´¹è®¡åˆ’ä»…å…è®¸æ‚¨ä¸ºå·²è½å®çš„é‚£äº›åŠŸèƒ½è°ƒç”¨ä»˜è´¹ã€‚ è¿™æ˜¯æœ€ä¾¿å®œçš„é€‰æ‹©ã€‚ ç›®å‰ï¼Œæœ‰100ä¸‡ä¸ªå…è´¹çš„åŠŸèƒ½è°ƒç”¨ã€‚ </p><br><p> è¯·æ³¨æ„ï¼Œéšç€åŠŸèƒ½çš„åˆ›å»ºï¼Œè¿˜å°†åˆ›å»ºè¾…åŠ©æ•°æ®å­˜å‚¨ï¼ˆå­˜å‚¨ï¼‰ã€‚ </p><br><p> åˆ›å»ºåŠŸèƒ½åº”ç”¨ç¨‹åºåï¼Œæ‚¨å¯ä»¥åˆ›å»ºåŠŸèƒ½æœ¬èº«ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åƒWebhook + APIè¿™æ ·çš„å‡½æ•°ã€‚ è¯¥åŠŸèƒ½å¯èƒ½å¯¹æ‰€æœ‰äººå¼€æ”¾ï¼ˆåŒ¿åè®¿é—®ï¼‰ï¼Œå¹¶ä¸”å¯èƒ½ä»…å¯¹ç‰¹æ®Šä»£ç çš„æ‰€æœ‰è€…å¯ç”¨ã€‚ é€šè¿‡å•å‡»&lt;/&gt;è·å–å‡½æ•°URLé“¾æ¥ï¼Œå¯ä»¥ä»å¸¦æœ‰å‡½æ•°çš„çª—å£ä¸­è·å–ä»£ç ï¼š </p><br><p><img src="https://habrastorage.org/webt/fl/mi/4w/flmi4wk8td66jpkudkozeqaec_o.png"></p><br><p> å‡½æ•°å¯ä»¥ç”¨å¤šç§è¯­è¨€ç¼–å†™ã€‚ æˆ‘æ›´å–œæ¬¢Cï¼ƒã€‚ </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Net; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Azure.Devices; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Azure.Devices.Common.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Globalization; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static async Task&lt;HttpResponseMessage&gt; Run(HttpRequestMessage req, TraceWriter <span class="hljs-keyword"><span class="hljs-keyword">log</span></span>) { string deviceid = req.GetQueryNameValuePairs() .FirstOrDefault(q =&gt; string.Compare(q.Key, "deviceid", <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, CultureInfo.InvariantCulture) == <span class="hljs-number"><span class="hljs-number">0</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; string hash = req.GetQueryNameValuePairs() .FirstOrDefault(q =&gt; string.Compare(q.Key, "hash", <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, CultureInfo.InvariantCulture) == <span class="hljs-number"><span class="hljs-number">0</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (String.IsNullOrEmpty(deviceid)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> req.CreateResponse(HttpStatusCode.BadRequest, "device id missing"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (String.IsNullOrEmpty(hash)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> req.CreateResponse(HttpStatusCode.BadRequest, "hash missing"); var resourceUri ="ArduinoDemoHub.azure-devices.net/devices/"+deviceid; // taken <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> IoT Hub <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Connect</span></span> devices rights (<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Device Explorer) var connectionString = "HostName=ArduinoDemoHub.azure-devices.net;SharedAccessKeyName=iothubowner;SharedAccessKey=cuYBKc42lfJr4oSRGQGQ8IiKWxGQkLre7rprZDZ/ths="; var registryManager = RegistryManager.CreateFromConnectionString(connectionString); var device = await registryManager.GetDeviceAsync(deviceid); var key = device.Authentication.SymmetricKey.PrimaryKey; HMACSHA256 hmac = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HMACSHA256(<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.UTF8.GetBytes("somerandomkeyKJBWyfy4gski")); var hashedkey = Convert.ToBase64String(hmac.ComputeHash(<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.UTF8.GetBytes(key))); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hashedkey!=hash) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> req.CreateResponse(HttpStatusCode.BadRequest, "wrong hash"); SharedAccessSignatureBuilder sasBuilder = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SharedAccessSignatureBuilder() { Key = key, Target = resourceUri, TimeToLive = TimeSpan.FromDays(Convert.ToDouble(<span class="hljs-number"><span class="hljs-number">7</span></span>)) }; var SAS = sasBuilder.ToSignature(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> req.CreateResponse(HttpStatusCode.OK, SAS); }</code> </pre> <br><p> æˆ‘ä»¬åˆ›å»ºproject.jsonæ–‡ä»¶ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"frameworks"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"net46"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"dependencies"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"Microsoft.Azure.Devices"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.4.1"</span></span> } } } }</code> </pre> <br><p> è¯¥ä»£ç ä½¿ç”¨åˆ°IoTä¸­å¿ƒçš„è¿æ¥å­—ç¬¦ä¸²ã€‚ å¯ä»¥å°†å…¶ä¸è®¾å¤‡çš„è¿æ¥å­—ç¬¦ä¸²æ··æ·†ã€‚ ä¸ºäº†è®©æ‚¨ä¸ä¼šæ„Ÿåˆ°å›°æƒ‘ï¼Œè®©æˆ‘æé†’æ‚¨åœ¨å“ªé‡Œå¾—åˆ°å®ƒï¼š </p><br><p><img src="https://habrastorage.org/webt/7v/i9/jd/7vi9jdnq12-lsf2gwv82pbbhge0.png"></p><br><p> å¿…é¡»ä»å…·æœ‰è®¾å¤‡è¿æ¥æƒé™çš„æŸäº›ç­–ç•¥ä¸­è·å–è¿æ¥å­—ç¬¦ä¸²ã€‚ <br> æœ€å¥½ä¸è¦åƒæˆ‘é‚£æ ·åœ¨ä»£ç ä¸­æŒ‡å®šè¿æ¥å­—ç¬¦ä¸²æœ¬èº«ã€‚ æˆ‘è¿™æ ·åšä»…ä»…æ˜¯ä¸ºäº†ä¸¾ä¾‹ã€‚ æœ€å¥½è¿›å…¥â€œåº”ç”¨ç¨‹åºè®¾ç½®â€åŠŸèƒ½ã€‚ </p><br><p><img src="https://habrastorage.org/webt/u2/e_/uc/u2e_uchy0i1np_d6ikqjpbtpflw.png"></p><br><p> å¹¶åœ¨é‚£é‡ŒæŒ‡å®šè¿æ¥å­—ç¬¦ä¸²ã€‚ ä¹‹åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä»å®‰å…¨å­˜å‚¨ä¸­â€œè·å–â€å®ƒï¼š </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">ConfigurationManager</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ConnectionStrings</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">["___"]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ConnectionString</span></span></code> </pre> <br><p> åœ¨è®¾å¤‡ä¸Šï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜å“ˆå¸Œé”®ã€‚ ä½†æ˜¯é¦–å…ˆï¼Œæ‚¨éœ€è¦å¯¹å­—ç¬¦è¿›è¡Œç¼–ç ã€‚  System.Webç©ºé—´ä¸­çš„HttpUtility.UrlEncodeå°†å¸®åŠ©æˆ‘ä»¬è§£å†³æ­¤é—®é¢˜ã€‚ </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">hashedkey</span></span> = HttpUtility.UrlEncode(hashedkey);</code> </pre> <br><p> æˆ‘ä»¬å°†ä½¿ç”¨Getå‘é€è¯·æ±‚ï¼Œä½†å¹¶éæ‰€æœ‰å­—ç¬¦éƒ½å¯ä»¥ä½œä¸ºå‚æ•°å€¼ä¼ é€’ã€‚ </p><br><h2> ç¼–å†™ä»£ç ä»¥å°†æ•°æ®å‘é€åˆ°äº‘ </h2><br><p> æˆ‘åœ¨Luaä¸Šç¼–å†™äº†ä¸€äº›ä»£ç ï¼Œå°†æ•°æ®å‘é€åˆ°äº‘ã€‚ ç»“æœæ˜¯ä¸€ç§PoCã€‚ æ‚¨å¯ä»¥ä½¿ç”¨å®ƒï¼Œå¹¶æ ¹æ®éœ€è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚ <br> åˆ›å»º2ä¸ªinit.luaå’ŒSendDataToCloud.luaæ–‡ä»¶ <br> ç¬¬ä¸€ä¸ªå†…å®¹ï¼š </p><br><pre> <code class="hljs php">--    <span class="hljs-keyword"><span class="hljs-keyword">print</span></span>(<span class="hljs-string"><span class="hljs-string">'init.lua ver 1.2'</span></span>) wifi.setmode(wifi.STATION) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span>(<span class="hljs-string"><span class="hljs-string">'set mode=STATION (mode='</span></span>..wifi.getmode()..<span class="hljs-string"><span class="hljs-string">')'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span>(<span class="hljs-string"><span class="hljs-string">'MAC: '</span></span>..wifi.sta.getmac()) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span>(<span class="hljs-string"><span class="hljs-string">'chip: '</span></span>..node.chipid()) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span>(<span class="hljs-string"><span class="hljs-string">'heap: '</span></span>..node.heap()) --  Wifi station_cfg={} station_cfg.ssid=<span class="hljs-string"><span class="hljs-string">"_SSID"</span></span> station_cfg.pwd=<span class="hljs-string"><span class="hljs-string">"___"</span></span> station_cfg.save=<span class="hljs-keyword"><span class="hljs-keyword">false</span></span> wifi.sta.config(station_cfg) wifi_status_codes = { [<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-string"><span class="hljs-string">"Idle"</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">"Connecting"</span></span>, [<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-string"><span class="hljs-string">"Wrong Password"</span></span>, [<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-string"><span class="hljs-string">"No AP Found"</span></span>, [<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-string"><span class="hljs-string">"Connection Failed"</span></span>, [<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-string"><span class="hljs-string">"Got IP"</span></span> } sntp_connect_status_codes = { [<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">"DNS lookup failed"</span></span>, [<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-string"><span class="hljs-string">"Memory allocation failure"</span></span>, [<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-string"><span class="hljs-string">"UDP send failed"</span></span>, [<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-string"><span class="hljs-string">"Timeout, no NTP response received"</span></span> } --    Wi-fi (   ) tmr.alarm(<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wifi</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sta</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getip</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">==</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nil</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">then</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Waiting for IP address! (Status: "</span></span></span></span><span class="hljs-function"><span class="hljs-params">..wifi_status_codes[wifi.sta.status</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">]..</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">")"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"New IP address is "</span></span></span></span><span class="hljs-function"><span class="hljs-params">..wifi.sta.getip</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmr</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">6</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> --    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NTP</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sntp</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">({</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'pool.ntp.org'</span></span></span></span><span class="hljs-function"><span class="hljs-params">}, function</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(sec, usec, server)</span></span></span></span><span class="hljs-function"><span class="hljs-params"> print</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-string">"Clock Synced: "</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">..sec..</span></span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-string">", "</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">..usec..</span></span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-string">", "</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">..server)</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tls.cert.verify</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(false)</span></span></span></span><span class="hljs-function"><span class="hljs-params"> --    dofile</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-string">'SendDataToCloud.lua'</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end, function</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(error_code)</span></span></span></span><span class="hljs-function"><span class="hljs-params"> print</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-string">"Clock Sync Failed: "</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">..sntp_connect_status_codes[error_code])</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params"> --      )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> )</span></span></code> </pre> <br><p> å¦‚æœè¿æ¥æˆåŠŸï¼Œæ­¤æ–‡ä»¶å°†è¿æ¥åˆ°ç½‘ç»œå¹¶æ‰§è¡ŒSendDataToCloud.luaæ–‡ä»¶ä¸­çš„ä»£ç ã€‚ </p><br><p> æ‚¨å¿…é¡»å°†Wi-Fiæ¥å…¥ç‚¹çš„æ•°æ®æŒ‡å®šä¸ºstation_cfg.ssidå’Œstation_cfg.pwdçš„å€¼ã€‚ </p><br><p> åœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­ï¼Œæ‚¨éœ€è¦æ›´æ”¹è®¾å¤‡çš„åç§°å’Œé›†çº¿å™¨çš„IoTï¼ˆDEVICEå’ŒIOTHUBå˜é‡ï¼‰ã€‚  funcurlå˜é‡åŒ…å«SASç”Ÿæˆå‡½æ•°çš„åœ°å€å’Œè®¾å¤‡å¯†é’¥çš„å“ˆå¸Œï¼ˆæˆ‘ä»¬ä¹‹å‰ä½¿ç”¨HttpUtility.UrlEncodeå¯¹å…¶è¿›è¡Œç¼–ç ï¼‰ä½œä¸ºå“ˆå¸Œå‚æ•°çš„å€¼ </p><br><pre> <code class="hljs powershell">--  DEVICE = <span class="hljs-string"><span class="hljs-string">"LuaDevice"</span></span> IOTHUB = <span class="hljs-string"><span class="hljs-string">"ArduinoDemoHub.azure-devices.net"</span></span> PORT = <span class="hljs-number"><span class="hljs-number">8883</span></span> USER = <span class="hljs-string"><span class="hljs-string">"ArduinoDemoHub.azure-devices.net/"</span></span>..DEVICE..<span class="hljs-string"><span class="hljs-string">"/api-version=2016-11-14"</span></span> telemetry_topic=<span class="hljs-string"><span class="hljs-string">"devices/"</span></span>..DEVICE..<span class="hljs-string"><span class="hljs-string">"/messages/events/"</span></span> connected = false local headers = <span class="hljs-string"><span class="hljs-string">'Content-Type: application/x-www-form-urlencoded\r\n'</span></span>.. <span class="hljs-string"><span class="hljs-string">'Accept: */*\r\n'</span></span>.. <span class="hljs-string"><span class="hljs-string">'User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0'</span></span> funcurl = <span class="hljs-string"><span class="hljs-string">"https://arduinofunction.azurewebsites.net/api/GenerateSASFunction?code=Jn7j54PbR31BSRa0UZrDwp4ZEltjmWHmblG9zLo0Ne0tyGM7w/wQ7w=="</span></span> funcurl = funcurl..<span class="hljs-string"><span class="hljs-string">"&amp;hash=oJzykimyQsTPtzgJxYq90Xfqmw1rZTPTCH%2bJ5sSurKI%3d"</span></span> funcurl = funcurl..<span class="hljs-string"><span class="hljs-string">"&amp;deviceid="</span></span>..DEVICE tmr.alarm(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">5000</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, function() http.get(funcurl, headers, function(code, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>, header) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (code &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) then print(<span class="hljs-string"><span class="hljs-string">"HTTP request failed"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> sas = true print(code, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> string.match(<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>, <span class="hljs-string"><span class="hljs-string">"Shared"</span></span>) then tmr.stop(<span class="hljs-number"><span class="hljs-number">1</span></span>) SAS = string.sub(<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,string.len(<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>)<span class="hljs-literal"><span class="hljs-literal">-1</span></span>) print(SAS) connect(SAS) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SAS)</span></span></span><span class="hljs-function"> --   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MQTT</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">client</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mqtt</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Client</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DEVICE, 240, USER, SAS)</span></span></span><span class="hljs-function"> --   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IoTHub</span></span></span><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MQTT</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("Connecting to MQTT broker. Please wait...")</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmr</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alarm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2,1000, 1, function()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">client</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IOTHUB, PORT, 1, -- Callback     function(client)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmr</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("Connected to MQTT: "..IOTHUB..":"..PORT.." as "..DEVICE)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connected</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">true</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">senddata</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function">, -- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Callback</span></span></span><span class="hljs-function">    </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(client, reason)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("Error Connecting: "..reason)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> ) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">senddata</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randomseed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmr</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alarm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(3, 1000, tmr.ALARM_AUTO, publish_data)</span></span></span><span class="hljs-function"> --   ,     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callback</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">client</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("offline", function(client)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("MQTT Disconnected.")</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connected</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">false</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> --      </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publish_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connected</span></span></span><span class="hljs-function"> == </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">true</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">then</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">somedata</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">math</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1,100)</span></span></span><span class="hljs-function"> --     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">payload</span></span></span><span class="hljs-function"> = "</span></span>{ \<span class="hljs-string"><span class="hljs-string">"deviceId\"</span></span> : \<span class="hljs-string"><span class="hljs-string">""</span></span>..DEVICE..<span class="hljs-string"><span class="hljs-string">"\"</span></span>,<span class="hljs-string"><span class="hljs-string">".. "</span></span>\<span class="hljs-string"><span class="hljs-string">"iotdata\"</span></span> :<span class="hljs-string"><span class="hljs-string">"..somedata.."</span></span>}<span class="hljs-string"><span class="hljs-string">" --   client:publish(telemetry_topic, payload, 1, 0, function(client) print("</span></span><span class="hljs-keyword"><span class="hljs-keyword">Data</span></span> published successfully.<span class="hljs-string"><span class="hljs-string">") end) end end</span></span></code> </pre> <br><p> æ— éœ€ä½¿ç”¨Azure SDKå³å¯å‘é€æ•°æ®ï¼Œå› æ­¤æ‚¨ä¸ä»…å¯ä»¥ä½¿ç”¨æ­¤ä»£ç å°†æ•°æ®å‘é€åˆ°Azureã€‚ æœ‰å¾ˆå¤šé€‰æ‹©ï¼šAWSï¼ŒGoogle Cloud IoTï¼ŒIBM Watson IoT Platformã€‚ </p><br><p> è¯¥ç¤ºä¾‹ä½¿ç”¨MQTTï¼ˆæ¶ˆæ¯é˜Ÿåˆ—é¥æµ‹ä¼ è¾“ï¼‰åè®®ã€‚ è¿™æ˜¯ä¸“é—¨ä¸ºç‰©è”ç½‘è®¾å¤‡è®¾è®¡çš„å¼€æ”¾åè®®ã€‚ æ•°æ®ä»¥JSONæ ¼å¼å‘é€ã€‚ åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä»ä¼ æ„Ÿå™¨è·å–æ•°æ®çš„åœ°æ–¹ï¼Œåœ¨ç¤ºä¾‹ä¸­ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°ã€‚ </p><br><p> åœ¨è®¾å¤‡ä¸IoTä¸­å¿ƒä¹‹é—´çš„æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘é€å…¶è¯ä¹¦ï¼Œä¹Ÿå¯ä»¥è¯·æ±‚è®¾å¤‡è¯ä¹¦ã€‚ å¦‚æœæ‚¨è¿˜è®°å¾—çš„è¯ï¼Œè¿™<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ˜¯æˆ‘ä»¬ä¸Šä¸€æ¬¡</a>ä½¿ç”¨Arduinoè®¾å¤‡æ—¶ï¼Œæˆ‘ä»¬ç”¨è¯ä¹¦å¯¹å…¶è¿›è¡Œäº†åˆ·æ–°ã€‚ ç°åœ¨ï¼Œä¸€ä¸ªä»£ç æ¥æ”¶å™¨å°±è¶³å¤Ÿäº†ï¼š </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">tls</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.cert</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.verify</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">false</span></span>)</code> </pre> <br><p> æˆ‘ä»¬ä»…é™äºæœåŠ¡å™¨å°†å‘é€ç»™æˆ‘ä»¬çš„è¯ä¹¦ã€‚ </p><br><h2> èµ„è®¯ </h2><br><p> ä½¿ç”¨ä»¥ä¸‹OpenSSLå‘½ä»¤ï¼Œæ‚¨å¯èƒ½å¯¹é›†çº¿å™¨çš„è¯ä¹¦å†…å®¹æ„Ÿå…´è¶£ã€‚ </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">s_client</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-showcerts</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-connect</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ArduinoDemoHub</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.azure-devices</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.net</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8883</span></span></code> </pre> <br><p> ä¸ºäº†å‡†å¤‡ææ–™ï¼Œä½¿ç”¨äº†å®éªŒå®¤ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹é“¾æ¥è·å¾—è¿™äº›å®éªŒå®¤ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‘é€è®¾å¤‡åˆ°äº‘ï¼ˆD2Cï¼‰æ¶ˆæ¯</a> <br> è¯¥ä»£ç ä¸æ˜¯æœ€æ–°çš„ï¼Œæˆ‘ä¸å¾—ä¸å¯¹å…¶è¿›è¡Œä¸€äº›æ›´æ–°ï¼Œä½†æ˜¯æ€»çš„æ¥è¯´ï¼Œè¯¥é“¾æ¥å¯èƒ½æœ‰ç”¨ã€‚ </p><br><h2> ä»Arduino IDEä½¿ç”¨NodeMCU </h2><br><p> æˆ‘ä¸èƒ½å¿½ç•¥ä½¿ç”¨SDKçš„ä¸»é¢˜ã€‚ æ‚¨çš„è§£å†³æ–¹æ¡ˆå¾ˆå¥½ï¼Œä½†æ˜¯SDKæ˜¯å·²ç»è°ƒè¯•ï¼Œç®€åŒ–å¹¶ä¸”å¯ä»¥ä½¿ç”¨çš„ç›¸åŒä»£ç ã€‚ å…³äºå¦‚ä½•é…ç½®å’Œä½¿ç”¨Arduino IDEä¸NodeMCUä¸€èµ·ä½¿ç”¨çš„å‡ å¥è¯ã€‚ </p><br><p> å®‰è£…Arduino IDEä¹‹åï¼Œæ‚¨éœ€è¦è½¬åˆ°æ–‡ä»¶-é¦–é€‰é¡¹èœå• </p><br><p><img src="https://habrastorage.org/webt/ea/u_/fq/eau_fqwxsvtujmn50otjftkgwvi.png"></p><br><p> å¹¶æ·»åŠ æŒ‡å‘å…¶ä»–è‘£äº‹ä¼šç»ç†çš„é“¾æ¥-åœ¨â€œå…¶ä»–è‘£äº‹ä¼šç»ç†URLâ€å­—æ®µä¸­è¾“å…¥ä»¥ä¸‹åœ°å€ï¼š <a href="">http</a> : <a href="">//arduino.esp8266.com/versions/2.4.0/package_esp8266com_index.json</a> </p><br><p> ç„¶åè½¬åˆ°å·¥å…·-è‘£äº‹ä¼šxxx-Boardx Managerèœå•å¹¶å®‰è£…ESP8266 <br> å®‰è£…åº“AzureIoTHubï¼ŒAzureIoTUtilityï¼ŒAzureIoTProtocol_MQTTã€‚ åœ¨ç¤ºä¾‹ï¼ˆæ–‡ä»¶èœå•-ç¤ºä¾‹-AzureIoTProtocol_MQTTï¼‰ä¸­å®‰è£…æœ€åä¸€ä¸ªåº“åï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ESP8266çš„ç¤ºä¾‹simplesample_mqttã€‚ </p><br><p> è¯¥ç¤ºä¾‹å·²å‡†å¤‡å°±ç»ªã€‚ åªéœ€åœ¨iot_configs.hæ–‡ä»¶ä¸­å¡«å†™å˜é‡å€¼ <br> æˆ‘æåˆ°ä¸€ä¸ªå°å‡å·ã€‚ ä¸Luaç›¸æ¯”ï¼Œç¼–è¯‘é¡¹ç›®å¹¶ä¸‹è½½åˆ°å¼€å‘æ¿éœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´ã€‚ </p><br><h2> åœ¨Azureäº‘ä¸­ä¿å­˜æ•°æ® </h2><br><p> é€šè¿‡æ•°æ®å‘é€ï¼Œä¸€åˆ‡éƒ½å˜å¾—æ¸…æ™°äº†ï¼Œä½†æ˜¯å°†æ•°æ®ä¿å­˜åˆ°äº‘ä¸­çš„æˆæœ¬å´ä¸é«˜ã€‚ <br> å°†æ•°æ®ä»IoTä¸­å¿ƒå‘é€åˆ°æ•°æ®åº“çš„æœ€ä¾¿å®œçš„æ–¹æ³•æ˜¯Azure Functionsã€‚ æœ€ä¾¿å®œçš„æ•°æ®å­˜å‚¨æ˜¯Azureè¡¨å­˜å‚¨ã€‚ </p><br><p> æœ‰è¶£çš„æ˜¯ï¼Œå½“æ‚¨åˆ›å»ºFunction Appæ—¶ï¼Œä¹Ÿä¼šè‡ªåŠ¨åˆ›å»ºStorageï¼Œè€Œè¯¥åŠŸèƒ½æœ¬èº«éœ€è¦ä½¿ç”¨ã€‚ å¦‚æœåˆ›å»ºå•ç‹¬çš„å­˜å‚¨åº“ï¼Œåˆ™å»ºè®®è¿›è¡Œå¦‚ä¸‹åŸºæœ¬è®¾ç½®ï¼š </p><br><p><img src="https://habrastorage.org/webt/zg/va/sz/zgvaszlilbyzjh6srxdmrq3cjyi.png"></p><br><p>  LSRå¤åˆ¶æ˜¯å½“å‰æœ€ä¾¿å®œçš„é€‰æ‹©ã€‚ è‡ªåŠ¨åˆ›å»ºç»‘å®šåˆ°åŠŸèƒ½çš„å­˜å‚¨åº“æ—¶ï¼Œå°†é€‰æ‹©è¯¥é€‰é¡¹ã€‚ <br> ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä»IoTä¸­å¿ƒæ¥æ”¶æ•°æ®å¹¶å°†å…¶å†™å…¥å­˜å‚¨ã€‚ å¯¹äºè¿™ç§æƒ…å†µï¼Œåœ¨åˆ›å»ºåŠŸèƒ½æ—¶ï¼Œâ€œå¿«é€Ÿå…¥é—¨â€çª—å£å°†æ— æ³•ä¸ºæˆ‘ä»¬æä¾›æ‰€éœ€çš„é€‰é¡¹ã€‚ </p><br><p><img src="https://habrastorage.org/webt/x5/vw/6i/x5vw6ia4ubsfidgvpqmlrretqru.png"></p><br><p> å› æ­¤ï¼Œå•å‡»ä½äºåº•éƒ¨çš„è‡ªå®šä¹‰åŠŸèƒ½é“¾æ¥ï¼Œç„¶åé€‰æ‹©IoTä¸­å¿ƒï¼ˆäº‹ä»¶ä¸­å¿ƒï¼‰é€‰é¡¹ã€‚ <br> è¯¥çª—å£å°†ä¸ºæˆ‘ä»¬æ‰“å¼€ï¼š </p><br><p><img src="https://habrastorage.org/webt/gu/t6/ry/gut6ryx8peg_aq2mqfv0dr62agk.jpeg"></p><br><p> åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•çš„é€‰æ‹©ï¼ˆå•å‡»â€œæ–°å»ºâ€ï¼‰æ¥å¡«å†™â€œäº‹ä»¶ä¸­å¿ƒâ€è¿æ¥å­—æ®µã€‚ ä½†æ˜¯è¦æŒ‡ç¤ºäº‹ä»¶ä¸­å¿ƒåç§°ï¼Œæ‚¨éœ€è¦è½¬åˆ°IoTä¸­å¿ƒã€‚ åœ¨é›†çº¿å™¨ä¸­ï¼Œæ‚¨éœ€è¦è½¬åˆ°ç«¯ç‚¹ï¼ˆç«¯ç‚¹ï¼‰å¹¶ä»é‚£é‡Œè·å–ä¸äº‹ä»¶ä¸­å¿ƒå…¼å®¹çš„åç§° </p><br><p><img src="https://habrastorage.org/webt/dl/tk/lb/dltklbv7hubhxdhe07nioe7ckgu.png"></p><br><p> è®©æˆ‘ä»¬ç»§ç»­è¿›è¡ŒåŠŸèƒ½ä»£ç ã€‚ ä»¥ä¸‹ä»£ç æ®µä»IoTä¸­å¿ƒæ¥æ”¶æ•°æ®å¹¶å°†å…¶å­˜å‚¨åœ¨è¡¨å­˜å‚¨ä¸­ï¼š </p><br><pre> <code class="hljs lua">#r <span class="hljs-string"><span class="hljs-string">"Microsoft.WindowsAzure.Storage"</span></span> #r <span class="hljs-string"><span class="hljs-string">"Newtonsoft.Json"</span></span> using Microsoft.Azure; // Namespace <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> CloudConfigurationManager using Microsoft.WindowsAzure.Storage; // Namespace <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> CloudStorageAccount using Microsoft.WindowsAzure.Storage.Table; // Namespace <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Table storage types using Newtonsoft.Json; public static void Run(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> myIoTHubMessage, TraceWriter <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>) { var e = JsonConvert.DeserializeObject&lt;EventDataEntity&gt;(myIoTHubMessage); <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>.Info($<span class="hljs-string"><span class="hljs-string">"C# IoT Hub trigger function processed a message: {myIoTHubMessage}"</span></span>); CloudStorageAccount storageAccount = CloudStorageAccount.Parse (<span class="hljs-string"><span class="hljs-string">"DefaultEndpointsProtocol=https;AccountName=iotdatademostorage;AccountKey=JgStNcJvlQYeNsVCmpkHQUkWlZiQ7tJwAm6OCL34+lGx3XrR+0CPiY9RoxIDA6VSvMKlOEUrVWL+KWP0qLMLrw==;EndpointSuffix=core.windows.net"</span></span>); CloudTableClient tableClient = storageAccount.CreateCloudTableClient(); CloudTable <span class="hljs-built_in"><span class="hljs-built_in">table</span></span> = tableClient.GetTableReference(<span class="hljs-string"><span class="hljs-string">"iottable"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">table</span></span>.CreateIfNotExists(); EventDataEntity edata = new EventDataEntity(<span class="hljs-string"><span class="hljs-string">"IOTpartition"</span></span>, Guid.NewGuid().ToString()); edata.DeviceId = e.DeviceId; edata.IotData = e.IotData; TableOperation insertOperation = TableOperation.Insert(edata); <span class="hljs-built_in"><span class="hljs-built_in">table</span></span>.Execute(insertOperation); } public class EventDataEntity : TableEntity { public EventDataEntity(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> pkey, <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> rkey) { this.PartitionKey = pkey; this.RowKey = rkey; } public EventDataEntity() { } public <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> DeviceId { get; set; } public int IotData { get; set; } }</code> </pre> <br><p> å¦‚æœè¦åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨æ­¤ä»£ç ï¼Œè¯·ä¸è¦å¿˜è®°å°†è¿æ¥å­—ç¬¦ä¸²æ”¾åœ¨æ›´å®‰å…¨çš„ä½ç½®-åœ¨â€œåº”ç”¨ç¨‹åºâ€è®¾ç½®ä¸­ï¼ˆä¸ç¬¬ä¸€ä¸ªåŠŸèƒ½çš„è¿æ¥å­—ç¬¦ä¸²å®Œå…¨ç›¸åŒï¼‰ã€‚ </p><br><p> è¿æ¥å­—ç¬¦ä¸²æœ¬èº«å¯ä»¥åœ¨åä¸ºè®¿é—®é”®çš„è®¾ç½®é¡¹ä¸­è·å–ï¼š </p><br><p><img src="https://habrastorage.org/webt/ot/z9/pb/otz9pbjqyflhjivwztvvsmkjms4.png"></p><br><p> ä½¿ç”¨å…è´¹çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Azure Storage Explorer</a>å®ç”¨ç¨‹åºæŸ¥çœ‹è¡¨å†…å®¹ </p><br><p> ç”±äºAzureè¡¨å­˜å‚¨çš„æˆæœ¬éå¸¸ä½ï¼Œå¹¶ä¸”AzureåŠŸèƒ½å’ŒIoTä¸­å¿ƒæ¯æœˆå…è´¹æä¾›æŸäº›èµ„æºï¼Œå› æ­¤æ¯æœˆæ•´ä¸ªè§£å†³æ–¹æ¡ˆçš„æˆæœ¬å¯ä»¥ä½äº1ç¾å…ƒã€‚ å½“ç„¶ï¼Œè¿™å–å†³äºæ•°æ®é‡ã€‚ ä¸ºè‡ªå·±è®¡æ•°ã€‚ å¦‚ä»Šï¼Œ1 GBçš„æ•°æ®æ¯æœˆèŠ±è´¹7ç¾åˆ†ï¼Œæ¯ç™¾ä¸‡ç¬”äº¤æ˜“æ‚¨åªéœ€æ”¯ä»˜4ç¾åˆ†ã€‚ </p><br><h2> èµ„è®¯ </h2><br><p> ä½¿ç”¨ä»»ä½•æä¾›å•†çš„äº‘æœåŠ¡æ—¶ï¼Œæˆ‘å§‹ç»ˆå»ºè®®æ‚¨å°†é‡‘é¢æœ€å°‘çš„ä¿¡ç”¨å¡é“¾æ¥åˆ°æ‚¨çš„å¸æˆ·ã€‚ é€šè¿‡é€‰æ‹©æŸç§é”™è¯¯çš„è®¾ç½®ï¼Œæ‚¨ä»˜å‡ºçš„é’±æ¯”é¢„æœŸçš„è¦å¤šå¾—å¤šï¼Œè¿™æ˜¯å¾ˆå¶ç„¶çš„ã€‚ </p><br><p> æˆ‘ä»¬æé†’æ‚¨ï¼Œè¿™æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ã€Šé»‘å®¢ã€‹æ‚å¿—ä¸Šæ–‡ç« </a>çš„å®Œæ•´ç‰ˆã€‚ å®ƒçš„ä½œè€…æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Alexey Sommer</a> ã€‚ </p><br><h2> æœ‰ç”¨çš„ææ–™ </h2><br><h4> äº‘åº”ç”¨æ¶æ„æŒ‡å— </h4><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img width="200" align="left" src="https://habrastorage.org/webt/zk/ns/pq/zknspqark8ose3vto4iom_kbdaq.jpeg"></a> é‡‡ç”¨ç»“æ„åŒ–æ–¹æ³•å¼€å‘äº‘åº”ç”¨ç¨‹åºã€‚ è¿™æœ¬å…³äºäº‘è®¡ç®—ä½“ç³»ç»“æ„çš„300é¡µç”µå­ä¹¦è®¨è®ºäº†æ— è®ºé€‰æ‹©å“ªç§äº‘å¹³å°éƒ½é€‚ç”¨çš„ä½“ç³»ç»“æ„ï¼Œå¼€å‘å’Œå®æ–½æŒ‡å—ã€‚ æœ¬æŒ‡å—åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š </p><br><ul><li> ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæˆ–è§£å†³æ–¹æ¡ˆé€‰æ‹©æ­£ç¡®çš„äº‘åº”ç”¨ç¨‹åºæ¶æ„æ ·å¼ï¼› </li><li> é€‰æ‹©é€‚å½“çš„è®¡ç®—å’Œæ•°æ®å­˜å‚¨æŠ€æœ¯ï¼› </li><li> å®æ–½10æ¡å¼€å‘åŸåˆ™ä»¥åˆ›å»ºå¯ä¼¸ç¼©ï¼Œæœ‰å¼¹æ€§ä¸”å¯ç®¡ç†çš„åº”ç”¨ç¨‹åºï¼› </li><li> éµå¾ªåˆ›å»ºä¿è¯æ‚¨çš„äº‘åº”ç”¨ç¨‹åºæˆåŠŸçš„ä¼˜è´¨è½¯ä»¶çš„äº”é¡¹åŸåˆ™ï¼› </li><li> ä½¿ç”¨é’ˆå¯¹æ‚¨è¦è§£å†³çš„é—®é¢˜è®¾è®¡çš„è®¾è®¡æ¨¡å¼ã€‚ </li></ul><br><p>  â†’ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b>ä¸‹è½½</b></a> </p><br><h4>  Azureå¼€å‘äººå‘˜æŒ‡å— </h4><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img width="200" align="right" src="https://habrastorage.org/webt/ik/2g/ot/ik2gotwyadnbqcjeusitbjdk550.png"></a> </p><br><p> åœ¨ã€Š Azureå¼€å‘äººå‘˜æŒ‡å—ã€‹çš„æ­¤æ›´æ–°ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°Azureè½¯ä»¶å¹³å°çš„æ•´å¥—æœåŠ¡å¦‚ä½•æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚ åœ¨è¿™é‡Œï¼Œæ‚¨å°†æ‰¾åˆ°æœ‰å…³æ¶æ„æ–¹æ³•ä»¥åŠåˆ›å»ºäº‘åº”ç”¨ç¨‹åºæ—¶å‡ºç°çš„æœ€å¸¸è§æƒ…å†µçš„ä¿¡æ¯ã€‚ </p><br><p>  â†’ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b>ä¸‹è½½</b></a> </p><br><h4>  Microsoft AzureåŸºç¡€ </h4><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img width="200" align="left" src="https://habrastorage.org/webt/w1/pe/sj/w1pesji9lrslkdggsjzwdkya2la.png"></a> æœ¬ä¹¦ä¸ºäº‘è®¡ç®—æ–°æ‰‹å¼€å‘äººå‘˜å’ŒITä¸“ä¸šäººå‘˜æä¾›äº†å¯¹å…³é”®AzureæœåŠ¡çš„é‡è¦è§è§£ã€‚ åŒ…å«åˆ†æ­¥æ¼”ç¤ºï¼Œä»¥å¸®åŠ©è¯»è€…äº†è§£å¦‚ä½•å¼€å§‹ä½¿ç”¨æ¯ä¸ªå…³é”®æœåŠ¡ã€‚ æ¯ç« éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸éœ€è¦ä¸ºäº†ç†è§£ä»»ä½•ç‰¹å®šç« èŠ‚è€Œè¿›è¡Œå‰å‡ ç« çš„å®é™…æ¼”ç¤ºã€‚ </p><br><p> æœ¬ä¹¦æ¶µç›–ä»¥ä¸‹ä¸»é¢˜ï¼š </p><br><ul><li>  Azureå…¥é—¨ï¼› </li><li>  Azureåº”ç”¨ç¨‹åºæœåŠ¡å’ŒWebåº”ç”¨ç¨‹åºï¼› </li><li> è™šæ‹Ÿæœºï¼› </li><li> ä»“å‚¨æœåŠ¡ï¼› </li><li> èµ„æ–™åº“ </li><li> å…¶ä»–AzureæœåŠ¡ã€‚ </li></ul><br><p>  â†’ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b>ä¸‹è½½</b></a> </p><br><h2> æœ‰ç”¨çš„é“¾æ¥ </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">IoTä¸­å¿ƒçš„ä¿„è¯­æ–‡æ¡£</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Csharpï¼ˆ.NETï¼‰çš„Azure IoTç¤ºä¾‹</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN421847/">https://habr.com/ru/post/zh-CN421847/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN421835/index.html">æœºæ„é—´å§”å‘˜ä¼šå¼€å‘æ–°æŠ€æœ¯æ¥é˜»æ­¢ç”µæŠ¥</a></li>
<li><a href="../zh-CN421837/index.html">ä¸ºZX-Spectrumåˆ›å»º1kç®€ä»‹æ··æ²Œ</a></li>
<li><a href="../zh-CN421839/index.html">ä½¿ç”¨Vavrè¿›è¡ŒåŠŸèƒ½æ€§Javaç¼–ç¨‹</a></li>
<li><a href="../zh-CN421841/index.html">Robotaxi Waymoå°šæœªå‡†å¤‡å¥½è¿›å…¥å…¬å…±é“è·¯</a></li>
<li><a href="../zh-CN421845/index.html">æ•°æ®åˆ†æå¸ˆå®é™…ä¸Šåœ¨åšä»€ä¹ˆï¼Ÿ 35æ¬¡è®¿è°ˆçš„å‘ç°</a></li>
<li><a href="../zh-CN421849/index.html">2018å¹´9æœˆITäººåŠ›èµ„æºå¤§äº‹è®°ï¼šMy Circle Digest</a></li>
<li><a href="../zh-CN421851/index.html">çŒ«å¤´é¹°å’Œå…¨çƒé—®é¢˜ï¼šè¿æ¥å…·æœ‰ç›¸åŒåç§°ç©ºé—´å’Œç±»åç§°çš„ä¸¤ä¸ªç¨‹åºé›†</a></li>
<li><a href="../zh-CN421855/index.html">å®¶ç”¨æŠ•å½±æœºï¼šæœ€ä½³â€œæŒ‰ç‰ˆæœ¬â€ï¼Œè¶…çŸ­ç„¦è·ï¼Œäº®åº¦å’Œé€Ÿåº¦å† å†›</a></li>
<li><a href="../zh-CN421857/index.html">ToFoIn v 1.åœ¨FreeBSDä¸­ä¿ç•™ç½‘å…³å¹¶åœ¨å¤–éƒ¨é€šé“ä¹‹é—´åˆ‡æ¢</a></li>
<li><a href="../zh-CN421859/index.html">ç‰©è”ç½‘æä¾›å•†çš„è¯´æ˜ã€‚ è®¾å¤‡å’Œå‡ºä»·</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>