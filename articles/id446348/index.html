<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎒 🅾️ 👨🏼‍🤝‍👨🏻 API sederhana seperti JSON-RPC di PHP 🏅 ⛈️ 🥋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Entri 
 Apa itu API JSON-RPC? Ini hanya salah satu jenis API, tetapi juga standar yang jelas, yang mungkin tidak ada dalam artikel ini (ya, akan ada s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>API sederhana seperti JSON-RPC di PHP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446348/"><h3>  Entri </h3><br>  Apa itu API JSON-RPC?  Ini hanya salah satu jenis API, tetapi juga standar yang jelas, yang mungkin tidak ada dalam artikel ini (ya, akan ada samopis). <br><br>  Setelah saya mengutak-atik API RESTful untuk sementara waktu dan menjadi sangat marah karenanya, karena betapa sederhananya di luar dan bisa dilipat di dalam, saya pergi ke google untuk mencari pengganti. <br><br>  Dan saya menemukan artikel tentang API JSON-RPC, dan saya sangat tertarik dengan konsepnya, sehingga saya memutuskan untuk mengimplementasikan sepeda motor saya yang paling sederhana. <br><a name="habracut"></a><br>  <b>Konsep API JSON-RPC</b> <br><br>  Gagasan utama standar ini adalah pendekatan berorientasi objek tertentu. <br><br>  Secara semantik, kueri terlihat seperti ini: <br><br><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"api version"</span></span>: <span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"object.method"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"user id"</span></span>: <span class="hljs-number"><span class="hljs-number">1234</span></span> } }</code> </pre> <br>  Dan ini hanya satu permintaan, daya tarik hebat dari API semacam itu adalah mereka dapat digabungkan dengan indah, dan ini memberi kita kesempatan untuk menggunakannya untuk permintaan batch (memuat sesuatu di bagian-bagian). <br><br>  Artinya, permintaan lengkap mungkin terlihat seperti ini. <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"api_v"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"reqs"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"my_important_request"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"user.kick_out"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"1234"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"when"</span></span>: <span class="hljs-string"><span class="hljs-string">"now"</span></span>, ... } }, ... ] }</code> </pre><br>  Di sini api_v adalah versi API, dan reqs adalah array permintaan.  Yang penting, setiap permintaan memiliki metode (class.method), parameter dan nama.  Nama memainkan peran besar di sini.  Saat Anda menerima respons dari server, Anda dapat merujuk ke hasil kueri dengan namanya.  Contoh: Permintaan dengan metode penambahan pengguna harus disebut "user_creating", tetapi ini terserah Anda;) <br><br><h3>  Mari mulai menulis </h3><br>  Hal pertama yang perlu dilakukan adalah kelas API, dalam kasus saya bahkan lebih sedikit dari yang seharusnya.  Beberapa proses terpisah dari saya, tetapi ini tidak mengubah esensi. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// @package 'api_0.1.php' // API  0.1 class API { private $last_resp; //    private $resp = []; //   public function __call( $method, $params ) { //  ,     $object = substr($method, 0, strpos($method, '.')); $method_name = substr($method, strpos($method, '.')+1); //   include_once __DIR__.'/source/'.$object.'.methods.php'; //      $resp = $object::$method_name($params); if(!empty($resp)) $this-&gt;last_resp = $resp; else $this-&gt;last_resp = null; } //          - pulbic function add_resp($req_name){ if($this-&gt;last_resp === null) return false; $req = $this-&gt;last_resp; $this-&gt;resp[$req_name] = $req; } //  ,    public function response(){ exit ( json_encode($this-&gt;resp) ); } }</span></span></code> </pre><br>  Ada komentar dalam kode, tetapi ini adalah penyimpangan singkat ... Kami menyebut API fungsi yang tidak diketahui, gunakan fungsi __call ajaib untuk tujuan ini.  Yaitu, dengan memanggil fungsi "Object.method" dari API ($ api -&gt; {"Object.method"}), ia secara otomatis membagi string menjadi sepasang objek-metode dan menyebutnya.  Setelah itu, hasil semua kueri ditambahkan ke satu array dan dikirim kembali dalam format json.  Semuanya sederhana. <br><br><h4>  Kelas </h4><br>  Ini sangat penting - di sini kelas disimpan di folder sumber dan beginilah tampilan kelas <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">method</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($params)</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } }</code> </pre><br>  Nama kelas harus cocok dengan apa yang diminta dalam permintaan, sama dengan nama metode.  Segala sesuatu yang lain tidak masalah.  Suatu metode dapat melakukan apa saja dan mengembalikan apa pun. <br><br>  Tetapi kita juga membutuhkan skrip kontrol.  Ini adalah skrip yang sama yang akan dipanggil berdasarkan permintaan. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// @package api.php header('Content-Type: application/json'); //     json $api_v = $_POST['api_v']; // $path = __DIR__.'/APIs/api_'.$api_v.'.php'; //       ,    if(!file_exists($path)) exit; //       include_once __DIR__.'/APIs/api_'.$api_v.'.php'; //  API $api = new API(); $reqs = $_POST['reqs']; $reqs = @json_decode($reqs, true); //  json  php  () //    ,          API foreach ($reqs as $req) { $method = $req['method']; $params = $req['params']; $req_name = $req['name']; $api-&gt;$method($params); $api-&gt;add_resp($req_name); } //    $api-&gt;response();</span></span></code> </pre><br>  Apa yang sedang terjadi di sini?  Kami mengaktifkan API kami tergantung pada versi yang ditentukan dalam permintaan.  Kami memecahkan kode permintaan json dan melalui masing-masing.  Kami memanggil metode API ketik "object.method" dan menyimpan hasilnya di bawah nama permintaan ini (ditulis di atas bahwa setiap permintaan memiliki namanya sendiri).  Setelah mengeksekusi semua permintaan, kami mengembalikan json array hasil ... Dan, pada dasarnya, itu saja. <br><cut></cut><br><h4>  Js kecil </h4><br>  Berikut adalah contoh kecil dari fungsi di js yang akan membuat permintaan API jenis ini.  Ini ditulis menggunakan jQuery, dan saya dengan liar meminta maaf kepada Anda untuk ini, tetapi lebih mudah untuk menunjukkan esensinya tanpa terlalu banyak. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">api_call</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">reqs, callback</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  (  ,    ,     )   json var json = JSON.stringify( (Array.isArray(reqs) ? reqs : [reqs]) ); //  POST  $.post({ url: '/api/api.php', //    api.php dataType: 'json', //   json,     data: ({ api_v: '0.1', reqs: json }), //   API   ( json ) success: function(res){ //         window,      .     for(var key in res){ window.loaded[key] = res[key]; } //      callback(res); } }); }</span></span></code> </pre><br>  Berikut ini adalah permintaan POST sederhana, dan hampir tidak ada yang istimewa, kecuali bahwa dimungkinkan untuk menentukan hanya satu permintaan, bukan array, dan saya juga menyimpan semua respons dalam array yang dimuat, hanya saja, untuk kenyamanan, itu sama sekali tidak diperlukan. <br><br>  Saya harap ide utamanya jelas bagi Anda.  Saya ingin membuat API yang sederhana dan intuitif - saya lakukan.  Sebagian besar, saya ingin menunjukkan pendekatan sederhana untuk membuat API multifungsi. <br><br>  Sampai ketemu lagi ... </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id446348/">https://habr.com/ru/post/id446348/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id446338/index.html">SVG 3D: Buat, Putar, dan Hidupkan</a></li>
<li><a href="../id446340/index.html">Sistem Operasi: Tiga Potongan Mudah. Bagian 1: Intro (terjemahan)</a></li>
<li><a href="../id446342/index.html">Dampak Halaman Besar Transparan pada Kinerja Sistem</a></li>
<li><a href="../id446344/index.html">Blok bangunan aplikasi terdistribusi. Perkiraan kedua</a></li>
<li><a href="../id446346/index.html">Mengembangkan aplikasi untuk Android seperti menjadi (demonetisasi) YouTube</a></li>
<li><a href="../id446350/index.html">Apa yang akhirnya membunuh AirPower</a></li>
<li><a href="../id446352/index.html">Perlindungan tanpa perlindungan</a></li>
<li><a href="../id446360/index.html">Pameran "Subsoil-2019. Ruang belajar. Kecerdasan Penambangan</a></li>
<li><a href="../id446362/index.html">3 Kualitas Utama untuk Manajer Produk yang Sukses: Dmitry Orlov, Manajer Produk Senior</a></li>
<li><a href="../id446364/index.html">Lelucon dan referensi dari The Simpsons dalam Bahasa Inggris ke Explain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>