<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶Å üçæ üöô Otorisasi di Apple Pay untuk yang terkecil üßëüèΩ‚Äçü§ù‚Äçüßëüèª üëÅÔ∏è üê®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Perhatian akan dibayarkan ke titik tertentu - ini mendapatkan kriptogram dari Apple setelah pembeli lulus dari TouchID atau FaceID. Bahasa backend ada...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Otorisasi di Apple Pay untuk yang terkecil</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460273/"><p><img src="https://habrastorage.org/webt/bz/t4/3y/bzt43yzshlceegatavdaabfi-qw.jpeg" alt="Otorisasi di Apple Pay untuk yang terkecil"></p><br><p>  Perhatian akan dibayarkan ke titik tertentu - ini mendapatkan kriptogram dari Apple setelah pembeli lulus dari TouchID atau FaceID.  Bahasa backend adalah PHP. </p><br><p>  Nama saya Alexander, saya seorang programmer PHP junior di Moguta, dan saya harus menghadapi integrasi Apple Pay di Moguta.CMS kami dalam perjalanan.  Hari ini saya akan memberi tahu Anda cara mengotorisasi diri melalui Apple Pay untuk melakukan pembayaran tanpa mempelajari materi koneksi dan sertifikat yang aman, karena pada awal perjalanan saya, saya tidak memiliki materi seperti itu. </p><a name="habracut"></a><br><h2 id="vvedenie">  Pendahuluan </h2><br><p>  Saya tidak akan melukis di sini seluruh lembar untuk memperkenalkan Apple Pay ke situs saya.  Petunjuk tentang cara mendaftarkan akun pengembang Apple, tempat membuat sertifikat Pemrosesan Pembayaran, tempat mengirim jawaban yang diterima, lengkap di RuNet, tanyakan pada Google ‚Äúintegrasi pembayaran apel di situs‚Äù dan pilih pengumpul pembayaran yang Anda sukai, yang akan merinci semua langkah yang diperlukan tindakan. </p><br><h2 id="kratkiy-obzor">  Ulasan singkat </h2><br><p>  Persyaratan minimum untuk instruksi ini adalah keberadaan MacOS untuk bekerja dengan kunci, karena bekerja dengan sertifikat pada OS lain sudah merupakan materi terpisah, yang saya tidak akan memperhatikan di sini. </p><br><p>  Mari kita cari tahu di mana tempat permusuhan kita nantinya.  Algoritma adalah sebagai berikut: </p><br><ol><li>  Pengguna memulai proses pembayaran melalui Apple Pay di toko online; </li><li>  Toko online mengirimkan informasi pembayaran ke Apple; </li><li>  Apple merespons dengan tautan ke data penjual; </li><li>  Toko online mengirimkan data penjual melalui tautan melalui TLS Dua Arah; </li><li>  Apple mengirimkan data yang mengandung PaymentData; </li><li>  Toko online mengalihkan PaymentData ke gateway pembayaran dan memproses respons; </li></ol><br><p>  Kami tertarik pada poin ke-4, karena permintaan CURL yang biasa tidak cukup. </p><br><h2 id="obzavodimsya-sertifikatami">  Kami mendapatkan sertifikat </h2><br><p>  Agar Apple percaya bahwa itu berkaitan secara pribadi dengan kami, Anda harus terlebih dahulu mendapatkan sertifikat Identifikasi Pedagang (agar tidak bingung dengan Pemrosesan Pembayaran, diperlukan untuk gateway pembayaran).  Pertama, kami akan merumuskan permintaan sertifikat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sesuai dengan instruksi resmi</a> .  File yang dihasilkan dilampirkan ke Apple Identity Merchant Certificate of Merchant ID Anda. </p><br><p><img src="https://habrastorage.org/webt/pe/pj/so/pepjso37jcxxdxddagtemehjsjq.png" alt="Buat sertifikat"></p><br><p>  Sebagai tanggapan, kami mendapatkan merchant_id.cer, yang kami tambahkan ke banyak.  Berdasarkan kunci privatnya, kami membuat file .p12.  Untuk melakukan ini, panggil menu konteks kunci pribadi dan pilih "Ekspor ..." </p><br><p><img src="https://habrastorage.org/webt/3n/t3/6j/3nt36jsf4x3br0wn9bgo9mxs1t0.png" alt="Ekspor Ke hal"></p><br><p>  Kami mengeluarkan kunci dengan perintah berikut (kata sandi yang akan diminta oleh terminal akan menjadi kata sandi untuk kunci tersebut, kami akan membutuhkannya saat menghubungkan ke Apple) </p><br><pre><code class="bash hljs">openssl pkcs12 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;  &gt;.p12 -out ApplePay.key.pem -nocerts -nodes</code> </pre> <br><p>  dan menyusul sertifikat kami di pem </p><br><pre> <code class="bash hljs"> openssl x509 -inform der -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> merchant_id.cer -out merchant_id.pem</code> </pre> <br><p>  Sekarang kita memiliki semua file yang diperlukan yang akan kita buktikan ke server apple bahwa kita adalah siapa yang kita klaim. </p><br><h2 id="otpravlyaem-zapros">  Kirim permintaan </h2><br><p>  Kami mengabaikan saat menerima tautan ke validasi ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">baca lebih lanjut di artikel lain tentang Habr</a> ), kami lewati saat ketika skrip JS di Safari mengirim server kami permintaan otorisasi di Apple. </p><br><p>  Untuk ini kami menggunakan PHP dengan cURL.  Contoh kode: </p><br><pre> <code class="php hljs">$ch = curl_init(); $data = <span class="hljs-string"><span class="hljs-string">'{"merchantIdentifier":"&lt;,      Merchan ID&gt;", "domainName":"&lt; -&gt;", "displayName":"&lt; -,       TouchID/FaceID&gt;"}'</span></span>; curl_setopt($ch, CURLOPT_URL, <span class="hljs-string"><span class="hljs-string">'&lt;  Apple,   validationURL&gt;'</span></span>); curl_setopt($ch, CURLOPT_POST, <span class="hljs-number"><span class="hljs-number">1</span></span>); curl_setopt($ch, CURLOPT_POSTFIELDS, $data); curl_setopt($ch, CURLOPT_CERTINFO, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); curl_setopt($ch, CURLOPT_VERBOSE, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); curl_setopt($ch, CURLOPT_SSLVERSION, CURL_SSLVERSION_TLSv1_2); curl_setopt($ch, CURLOPT_SSLCERT, <span class="hljs-string"><span class="hljs-string">'&lt;  &gt;.pem'</span></span>); curl_setopt($ch, CURLOPT_SSLKEY, <span class="hljs-string"><span class="hljs-string">'&lt;  &gt;.pem'</span></span>&gt;); curl_setopt($ch, CURLOPT_SSLKEYPASSWD, <span class="hljs-string"><span class="hljs-string">'&lt;  &gt;'</span></span>); curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="hljs-number"><span class="hljs-number">2</span></span>); curl_setopt($ch, CURLOPT_HTTPHEADER, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span>)); curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-number"><span class="hljs-number">1</span></span>); $res = curl_exec($ch); curl_close($ch); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($res);</code> </pre> <br><p>  Kami menarik data pembayaran dari respons yang diterima dan mengirimkannya ke gateway pembayaran kami.  Selamat, otorisasi dilewatkan, Anda dapat mendayung uang. </p><br><h2 id="primechanie">  Catatan </h2><br><p>  Nasib tidak membiarkan saya bersukacita atas koneksi yang telah dibuat untuk waktu yang lama, dan Apple memberi saya jawaban berikut: </p><br><pre> <code class="bash hljs">Payment Services Exception merchantId=&lt; &gt; unauthorized to service on behalf of merchantId=&lt;  &gt; reason=\<span class="hljs-string"><span class="hljs-string">"The latter is not registered for Apple Pay on the web\""</span></span></code> </pre> <br><p>  Teks pesannya tidak cukup jelas, seperti yang kita inginkan.  Informasi di jaringan, sekali lagi, tidak.  Ternyata, kemungkinan besar ini berarti Anda cukup memasukkan nilai yang salah di bidang merchantIdentifier. </p><br><h2 id="itog">  Ringkasan </h2><br><p>  Saya akan senang mendengar saran, tip atau kritik dalam komentar. </p><br><p>  Saya berharap artikel ini akan bermanfaat bagi jiwa yang hilang sama seperti saya. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id460273/">https://habr.com/ru/post/id460273/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id460257/index.html">Halo Dunia! Perendaman dalam di Terminal</a></li>
<li><a href="../id460259/index.html">Apa itu desain UI dan UX? Apa yang umum dan berbeda?</a></li>
<li><a href="../id460261/index.html">Amazon: 25 Tahun Sukses E-commerce</a></li>
<li><a href="../id460263/index.html">Membuat pencarian yang benar-benar cerdas: panduan langkah demi langkah</a></li>
<li><a href="../id460265/index.html">Buat template proyek Xcode</a></li>
<li><a href="../id460275/index.html">Mengapa Anda tidak membutuhkan solusi yang tepat</a></li>
<li><a href="../id460279/index.html">10 milyar kontrak: siapa yang akan berurusan dengan cloud untuk Pentagon</a></li>
<li><a href="../id460281/index.html">Bagaimana UX Writer Membantu Meningkatkan Produk</a></li>
<li><a href="../id460283/index.html">Bahasa pemrograman do-it-yourself baru</a></li>
<li><a href="../id460285/index.html">Kami sedang menyiapkan PHP. Bagaimana sementara, foreach, array_walk dan beberapa kata menakutkan lainnya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>