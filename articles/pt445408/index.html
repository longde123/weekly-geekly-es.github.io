<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤙🏻 🚲 👨🏽‍🚒 Postagens cruzadas do Instagram para o VK público em Python 🏂🏻 👏🏻 🙆🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prefácio 
 Decidi entrar em um novo mercado, principalmente porque o público-alvo da minha loja on-line, que não possui contas no Instagram, há muito ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Postagens cruzadas do Instagram para o VK público em Python</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445408/"><img src="https://habrastorage.org/webt/t1/fh/v8/t1fhv8ufbe6zavfrsecrvlk67ls.jpeg"><br><br><h4>  Prefácio </h4><br>  Decidi entrar em um novo mercado, principalmente porque o público-alvo da minha loja on-line, que não possui contas no Instagram, há muito tempo se interessa pela aparência de uma duplicata na VK.  A ideia é boa, mas existem centenas de postagens na página, respectivamente, eu não queria trabalhar <i>ctrl + c ctrl + v</i> manualmente, além de outras perspectivas para o trabalho com macacos não serem impressionantes. <br><br>  Confiante em que a Internet está cheia de soluções gratuitas, comecei a pesquisar no Google.  Naturalmente, as primeiras páginas dos resultados da pesquisa estão cheias de serviços pagos, com funcionalidades bastante abrangentes.  Mas para mim, apenas para tudo, tive que transferir todas as postagens da página do Instagram para o VK público e, posteriormente, reabastecê-la simultaneamente. <br><br>  Não encontrando nada adequado, <s>talvez ele estivesse parecendo mal</s> , foi decidido <s>estrangular o sapo</s> para escrever o roteiro.  Escolha a linguagem python.  Simples, conveniente, sem frescuras desnecessárias, e a velocidade não é importante nesta questão. <br><br>  A documentação na API do Instagram e no VK é bastante detalhada e a tarefa não parece complicada.  Tendo me libertado algumas noites, comecei a trabalhar.  O primeiro passo foi obter tokens no Instagram e no VK.  Não houve problemas com isso, ambos foram recebidos em alguns minutos. <br><br>  Então a primeira armadilha me esperava ... <br><a name="habracut"></a><br><h4>  Cruzando os primeiros 20 posts </h4><br>  Para minha surpresa, descobri que, após alterações na política do Instagram, foi possível obter um dicionário json (links para fotos, descrição da postagem, data de publicação ...) apenas nas últimas 20 postagens da página.  Isso me serviu para a segunda tarefa - atualizar o público com novas postagens de tempos em tempos.  Como novas publicações não aparecem com tanta frequência comigo e 20 postagens são bastante convenientes.  Decidiu-se assumir essa tarefa primeiro. <br><br>  Nós obtemos a sessão VK e declaramos as variáveis ​​necessárias: <br><br><pre><code class="python hljs">session = vk.Session( access_token=<span class="hljs-string"><span class="hljs-string">'123abc'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  123abc   vk_api = vk.API(session, v='5.85') groupID = '12345678' #id  vk upload_url = vk_api.photos.getWallUploadServer(group_id=groupID)['upload_url'] #  vk   data = [] photo_id = 0 attachments = [] direct = 'C:/Users/jo/PycharmProjects/repost/foto' #     d = date(2019, 3, 21) # ,      data_parsing = int(time.mktime(d.timetuple())) #    unix </span></span></code> </pre> <br>  Em seguida, escrevemos a função principal.  Para começar, obtemos uma matriz de dados com a qual trabalharemos: <br><br><pre> <code class="python hljs">answer = get( <span class="hljs-string"><span class="hljs-string">'https://api.instagram.com/v1/users/[id_inst]/media/recent?access_token=[access_token]'</span></span>, verify=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>).json()</code> </pre> <br>  Na solicitação, você deve inserir seus dados em vez de colchetes.  Você pode encontrar o ID da página por nome de usuário, por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br>  Se algo nos for devolvido, vá em frente: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> answer: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> answer[<span class="hljs-string"><span class="hljs-string">'data'</span></span>]: <span class="hljs-comment"><span class="hljs-comment">#     json  global photo_id #     photo_id = 0 global attachments attachments = [] global data data = [] date_create = x['created_time'] # date_create    Unix if int(date_create) &gt; data_parsing: n = 0 #     if not os.path.isdir(direct + '/' + date_create): #     os.makedirs(direct + '/' + date_create) if 'carousel_media' in x: #      for a in x['carousel_media']: li = list(a.keys()) #      if li.count('videos') == 0: #    ,      req.urlretrieve(a['images']['standard_resolution']['url'], "foto/" + date_create + "/" + str(n) + ".jpg") #       if x['caption'] is not None: #   text = str(x['caption']['text']) else: text = ' ' n = n + 1 post_foto(date_create, text) else: #      req.urlretrieve(x['images']['standard_resolution']['url'], "foto/" + date_create + "/0.jpg") if x['caption'] is not None: #   text = str(x['caption']['text']) else: text = ' ' post_foto(date_create, text)</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Me arrependo</b> <div class="spoiler_text">  Eu sei que trabalhar com variáveis ​​globais é ruim, mas o tamanho do script permite que você não mergulhe na complexidade <br></div></div><br>  Portanto, se a data de publicação da postagem for maior que a data definida, crie uma pasta cujo nome (tautologia da atenção, especialmente sensível à falta) na data de sua publicação.  A seguir, são verificados o número de fotos e vídeos.  Certamente você pode anexá-lo, eu simplesmente não preciso disso.  Faça o upload de fotos para a pasta criada.  Pegamos a descrição da postagem usando a tecla <i>legenda</i> e vamos para a função <i>post_foto</i> : <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">post_foto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(date_create, text)</span></span></span><span class="hljs-function">:</span></span> quantity_foto = len([name <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.listdir(direct + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + date_create) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.path.isfile(os.path.join(direct + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + date_create, name))]) <span class="hljs-comment"><span class="hljs-comment">#     append_attach(quantity_foto, date_create) params = {'attachments': attachments, 'message': text, 'owner_id': '-' + groupID, 'from_group': '1'} vk_api.wall.post(**params) #    VK   </span></span></code> </pre><br>  Determinamos o número de fotos na pasta, as carregamos no servidor VK, adicionamos aos parâmetros de publicação e publicamos em público.  A adição de parâmetros é feita usando a função <i>append_attach</i> : <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append_attach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, directory)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     for t in range(x): upload_foto(t, directory) global photo_id photo_id = data[t][0]['id'] global attachments attachments.append('photo' + str(data[t][0]['owner_id']) + '_' + str(photo_id)) #  id    </span></span></code> </pre><br>  E o upload direto de fotos para o servidor VK é realizado pela função <i>upload_foto</i> : <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">upload_foto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num_foto, directory)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#     request = requests.post(upload_url, files={'photo': open("foto/" + directory + "/" + str(num_foto) + ".jpg", "rb")}) params = {'server': request.json()['server'], 'photo': request.json()['photo'], 'hash': request.json()['hash'], 'group_id': groupID} global data data.append(vk_api.photos.saveWallPhoto(**params))</span></span></code> </pre><br>  Nós resolvemos a segunda tarefa.  O script pode ser executado sozinho ou dentro do cronograma (por exemplo, no <i>cron</i> , uma vez a cada 15 minutos).  E agora como transferir todas as outras centenas de postagens? <br><br><h4>  Quebrar a página inteira </h4><br>  Parte do script já está pronta, a responsável pelas próprias publicações em VK.  Resta encontrar uma maneira de esvaziar todas as fotos e descrições para eles.  Não me preocupei em analisar os códigos-fonte das páginas do Instagram e tomei uma solução pronta.  Na verdade, tenho certeza de que existem muitos desses programas, usei o primeiro gratuito ( <i>4K Stogram</i> ).  A interface intuitiva permite que você lide rapidamente com o download de todas as fotos da página.  O menu também possui uma exportação de todas as descrições para postagens.  Precisamos de um formato " <i>* .txt</i> ".  Resta apenas colocar todas as fotos em pastas (uma postagem - uma pasta) e analisar as descrições das postagens do livro pela expressão regular. <br><br>  O código a seguir nos ajudará a decompor as fotos em pastas: <br><br><pre> <code class="python hljs">i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> top, dirs, files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(os.getcwd()+<span class="hljs-string"><span class="hljs-string">"\\res\\"</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> nm <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> re.findall(<span class="hljs-string"><span class="hljs-string">r'\d\d\.\d\d\.\d\d'</span></span>, nm): old_file = os.path.join(top, nm) frq = re.findall(<span class="hljs-string"><span class="hljs-string">r'\d\d\d\d-\d\d-\d\d \d\d\.\d\d\.\d\d'</span></span>, str(nm)) frq = str(frq[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> os.path.exists(os.getcwd()+<span class="hljs-string"><span class="hljs-string">"\\res\\"</span></span> + frq): i = <span class="hljs-number"><span class="hljs-number">0</span></span> os.makedirs(os.getcwd() + <span class="hljs-string"><span class="hljs-string">"\\res\\"</span></span> + frq) new_file = os.path.join(os.getcwd() + <span class="hljs-string"><span class="hljs-string">"\\res\\"</span></span> + frq, str(i)+<span class="hljs-string"><span class="hljs-string">'.jpg'</span></span>) os.rename(old_file, new_file) i = i+<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: new_file = os.path.join(os.getcwd() + <span class="hljs-string"><span class="hljs-string">"\\res\\"</span></span> + frq, str(i)+<span class="hljs-string"><span class="hljs-string">'.jpg'</span></span>) os.rename(old_file, new_file) i = i+<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  Aqui, o ponto principal é o tempo de publicação, que combina várias fotos em uma pasta. <br><br>  Bem, então tudo é simples.  Abrimos cada pasta, carregamos todas as fotos para o servidor, anexamos a descrição e publicamos.  Não se esqueça da restrição VK: não mais que 50 posts por dia: <br><br><pre> <code class="python hljs">f = open(os.getcwd() + <span class="hljs-string"><span class="hljs-string">"\input_opis\\gusi.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"rt"</span></span>, errors=<span class="hljs-string"><span class="hljs-string">"ignore"</span></span>, encoding=<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#     data = f.read() #  ,      result = re.findall(r'"([^\"]*)"', data, re.S) new_x = [el for el, _ in groupby(result)] #     dlina = new_x.__len__() i = 1 f.close() for top, dirs, files in os.walk(os.getcwd() + "\\res\\"): #   for nm in dirs: attachments = [] photo_id = 0 data = [] DIR = 'C:/Users/jo/PycharmProjects/repost/res/' + nm #     quantity_foto = len([name for name in os.listdir(DIR) if os.path.isfile(os.path.join(DIR, name))]) post_foto(quantity_foto, nm) attachments.reverse() #   params = {'attachments': attachments, 'message': new_x[dlina - i], 'owner_id': '-' + groupID, 'from_group': '1'} vk_api.wall.post(**params) i = i + 1</span></span></code> </pre> <br>  Talvez ele não tenha seguido o caminho mais fácil e rápido, mas o resultado foi alcançado.  Obrigado a todos pela atenção, <s>estou</s> pronto para responder a todas as perguntas e comentários críticos no meu script <s>govnokod</s> . <br><br>  Todos os 3 scripts em sua totalidade: <br><br><div class="spoiler">  <b class="spoiler_title">Cruzando os primeiros 20 posts</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> urllib.request <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> req <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> date session = vk.Session( access_token=<span class="hljs-string"><span class="hljs-string">'123abc'</span></span>) vk_api = vk.API(session, v=<span class="hljs-string"><span class="hljs-string">'5.85'</span></span>) groupID = <span class="hljs-string"><span class="hljs-string">'12345678'</span></span> <span class="hljs-comment"><span class="hljs-comment">#id  vk upload_url = vk_api.photos.getWallUploadServer(group_id=groupID)['upload_url'] #  vk   data = [] photo_id = 0 attachments = [] direct = 'C:/Users/jo/PycharmProjects/repost/foto' #     d = date(2019, 3, 21) # ,      data_parsing = int(time.mktime(d.timetuple())) #    unix  def upload_foto(num_foto, directory): #     request = requests.post(upload_url, files={'photo': open("foto/" + directory + "/" + str(num_foto) + ".jpg", "rb")}) params = {'server': request.json()['server'], 'photo': request.json()['photo'], 'hash': request.json()['hash'], 'group_id': groupID} global data data.append(vk_api.photos.saveWallPhoto(**params)) def append_attach(x, directory): #             for t in range(x): upload_foto(t, directory) global photo_id photo_id = data[t][0]['id'] global attachments attachments.append('photo' + str(data[t][0]['owner_id']) + '_' + str(photo_id)) #  id     def post_foto(date_create, text): quantity_foto = len([name for name in os.listdir(direct + "/" + date_create) if os.path.isfile(os.path.join(direct + "/" + date_create, name))]) #     append_attach(quantity_foto, date_create) params = {'attachments': attachments, 'message': text, 'owner_id': '-' + groupID, 'from_group': '1'} vk_api.wall.post(**params) #    VK    def get_all(): answer = get( 'https://api.instagram.com/v1/users/12345678/media/recent?access_token=123abc', verify=True).json() #     instagram if answer: for x in answer['data']: #     json  global photo_id #     photo_id = 0 global attachments attachments = [] global data data = [] date_create = x['created_time'] # date_create    Unix if int(date_create) &gt; data_parsing: n = 0 #     if not os.path.isdir(direct + '/' + date_create): #     os.makedirs(direct + '/' + date_create) if 'carousel_media' in x: #      for a in x['carousel_media']: li = list(a.keys()) #      if li.count('videos') == 0: #    ,      req.urlretrieve(a['images']['standard_resolution']['url'], "foto/" + date_create + "/" + str(n) + ".jpg") #       if x['caption'] is not None: #   text = str(x['caption']['text']) else: text = ' ' n = n + 1 post_foto(date_create, text) else: #      req.urlretrieve(x['images']['standard_resolution']['url'], "foto/" + date_create + "/0.jpg") if x['caption'] is not None: #   text = str(x['caption']['text']) else: text = ' ' post_foto(date_create, text) get_all()</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Classificar fotos por pastas</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> top, dirs, files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(os.getcwd()+<span class="hljs-string"><span class="hljs-string">"\\res\\"</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> nm <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> re.findall(<span class="hljs-string"><span class="hljs-string">r'\d\d\.\d\d\.\d\d'</span></span>, nm): old_file = os.path.join(top, nm) frq = re.findall(<span class="hljs-string"><span class="hljs-string">r'\d\d\d\d-\d\d-\d\d \d\d\.\d\d\.\d\d'</span></span>, str(nm)) frq = str(frq[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> os.path.exists(os.getcwd()+<span class="hljs-string"><span class="hljs-string">"\\res\\"</span></span> + frq): i = <span class="hljs-number"><span class="hljs-number">0</span></span> os.makedirs(os.getcwd() + <span class="hljs-string"><span class="hljs-string">"\\res\\"</span></span> + frq) new_file = os.path.join(os.getcwd() + <span class="hljs-string"><span class="hljs-string">"\\res\\"</span></span> + frq, str(i)+<span class="hljs-string"><span class="hljs-string">'.jpg'</span></span>) os.rename(old_file, new_file) i = i+<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: new_file = os.path.join(os.getcwd() + <span class="hljs-string"><span class="hljs-string">"\\res\\"</span></span> + frq, str(i)+<span class="hljs-string"><span class="hljs-string">'.jpg'</span></span>) os.rename(old_file, new_file) i = i+<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Postando em VK todas as publicações</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> itertools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groupby session = vk.Session( access_token=<span class="hljs-string"><span class="hljs-string">'123abc'</span></span>) vk_api = vk.API(session, v=<span class="hljs-string"><span class="hljs-string">'5.85'</span></span>) groupID = <span class="hljs-string"><span class="hljs-string">'12345678'</span></span> upload_url = vk_api.photos.getWallUploadServer(group_id=groupID)[<span class="hljs-string"><span class="hljs-string">'upload_url'</span></span>] data = [] photo_id = <span class="hljs-number"><span class="hljs-number">0</span></span> attachments = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">upload_foto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num_foto, direc)</span></span></span><span class="hljs-function">:</span></span> request = requests.post(upload_url, files={<span class="hljs-string"><span class="hljs-string">'photo'</span></span>: open(<span class="hljs-string"><span class="hljs-string">'res/'</span></span> + direc + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + str(num_foto) + <span class="hljs-string"><span class="hljs-string">".jpg"</span></span>, <span class="hljs-string"><span class="hljs-string">"rb"</span></span>)}) params = {<span class="hljs-string"><span class="hljs-string">'server'</span></span>: request.json()[<span class="hljs-string"><span class="hljs-string">'server'</span></span>], <span class="hljs-string"><span class="hljs-string">'photo'</span></span>: request.json()[<span class="hljs-string"><span class="hljs-string">'photo'</span></span>], <span class="hljs-string"><span class="hljs-string">'hash'</span></span>: request.json()[<span class="hljs-string"><span class="hljs-string">'hash'</span></span>], <span class="hljs-string"><span class="hljs-string">'group_id'</span></span>: groupID} <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> data data.append(vk_api.photos.saveWallPhoto(**params)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">post_foto</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, direc)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(x): upload_foto(i, direc) <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> photo_id photo_id = data[i][<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> attachments attachments.append(<span class="hljs-string"><span class="hljs-string">'photo'</span></span> + str(data[i][<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'owner_id'</span></span>]) + <span class="hljs-string"><span class="hljs-string">'_'</span></span> + str(photo_id)) f = open(os.getcwd() + <span class="hljs-string"><span class="hljs-string">"\input_opis\\gusi.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"rt"</span></span>, errors=<span class="hljs-string"><span class="hljs-string">"ignore"</span></span>, encoding=<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#     data = f.read() #  ,      result = re.findall(r'"([^\"]*)"', data, re.S) new_x = [el for el, _ in groupby(result)] #     dlina = new_x.__len__() i = 1 f.close() for top, dirs, files in os.walk(os.getcwd() + "\\res\\"): #   for nm in dirs: attachments = [] photo_id = 0 data = [] DIR = 'C:/Users/jo/PycharmProjects/repost/res/' + nm #     quantity_foto = len([name for name in os.listdir(DIR) if os.path.isfile(os.path.join(DIR, name))]) post_foto(quantity_foto, nm) attachments.reverse() #   params = {'attachments': attachments, 'message': new_x[dlina - i], 'owner_id': '-' + groupID, 'from_group': '1'} vk_api.wall.post(**params) i = i + 1</span></span></code> </pre><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt445408/">https://habr.com/ru/post/pt445408/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt445392/index.html">Remarketing dinâmico MyTarget: recomendações não pessoais de produtos</a></li>
<li><a href="../pt445394/index.html">Alterações no protocolo seguro 3D: conheça o 3-D Secure 2.0</a></li>
<li><a href="../pt445398/index.html">Gugology (isto não é um erro de digitação) para programadores</a></li>
<li><a href="../pt445402/index.html">Disparar à noite ou Por que carregar o produto - não é assustador</a></li>
<li><a href="../pt445406/index.html">Visão geral do programa C ++ Rússia 2019. Qual é o próximo dia para nós?</a></li>
<li><a href="../pt445410/index.html">Sonhe grande e torne-se global: concurso internacional de startups na conferência EMERGE</a></li>
<li><a href="../pt445414/index.html">Como os livros de ciência soviéticos se tornaram um artefato entre físicos e engenheiros na Índia</a></li>
<li><a href="../pt445416/index.html">Por que os discos de vinil sobrevivem à era digital</a></li>
<li><a href="../pt445418/index.html">Homo sapiens? Já não</a></li>
<li><a href="../pt445420/index.html">Existem 17 bilhões de computadores no córtex do seu cérebro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>