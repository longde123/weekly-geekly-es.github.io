<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÑ üöµ üìÑ LoJax: el primer rootkit UEFI conocido utilizado en una campa√±a maliciosa üëÉüèΩ üë®üèº‚Äçüè≠ ‚úíÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sednit Cybergroup, tambi√©n conocido como ART28, Strontium y Fancy Bear, ha estado operando desde al menos 2004. Se cree que el grupo est√° detr√°s de un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>LoJax: el primer rootkit UEFI conocido utilizado en una campa√±a maliciosa</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/eset/blog/425251/">  Sednit Cybergroup, tambi√©n conocido como ART28, Strontium y Fancy Bear, ha estado operando desde al menos 2004.  Se cree que el grupo est√° detr√°s de una serie de ciberataques resonantes.  Algunas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">empresas del IB</a> y el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Departamento de Justicia de EE. UU. Han</a> llamado a Sednit responsable de piratear el Comit√© Nacional Dem√≥crata antes de las elecciones estadounidenses de 2016.  Al grupo se le atribuye el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pirateo de la</a> red de televisi√≥n global TV5Monde, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">filtraci√≥n de</a> correos electr√≥nicos de la Agencia Mundial Antidopaje (AMA) y otros incidentes.  Sednit tiene muchos objetivos y una amplia gama de herramientas, algunas de las cuales ya hemos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentado</a> anteriormente, pero por primera vez en este trabajo describiremos en detalle el uso del rootkit UEFI. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ai/yf/nq/aiyfnqxa7dzic4myqh6eircpapo.jpeg"></div><br><a name="habracut"></a><h2>  Breve rese√±a </h2><br>  Descubrimos que, al menos desde principios de 2017, Sednit ha estado utilizando una versi√≥n troyanizada del antiguo agente de usuario del programa para proteger los dispositivos contra el robo por parte del desarrollador de Absolute Software - LoJack.  La herramienta atrajo la atenci√≥n de los profesionales de seguridad de la informaci√≥n debido al uso del m√≥dulo UEFI / BIOS como mecanismo para garantizar la persistencia.  Llamamos a la versi√≥n trojanizada de este programa <b>LoJax</b> . <br><br>  La presencia de herramientas Sednit bien conocidas en sistemas infectados junto con muestras de LoJax, as√≠ como el hecho de que algunos servidores de comando utilizados por agentes trojanizados anteriormente formaban parte de la infraestructura de Sednit, nos permiten asociar el rootkit UEFI con este grupo con gran confianza. <br><br>  Junto con los agentes de LoJax, se encontraron herramientas para leer el firmware del sistema UEFI, y en uno de los casos esta herramienta podr√≠a volcar, parchear y reescribir parte de la memoria flash SPI del sistema.  El objetivo final de la herramienta es instalar un m√≥dulo UEFI malicioso en un sistema cuya protecci√≥n SPI flash es vulnerable o est√° configurada incorrectamente. <br><br>  El m√≥dulo UEFI es responsable de implementar el agente LoJax en el sistema; este es el primer rootkit identificado por UEFI del grupo Sednit.  Como est√° en el firmware del sistema, puede sobrevivir reinstalando Windows y reemplazando el disco duro. <br><br>  Hubo al menos un caso cuando este rootkit se instal√≥ correctamente en la memoria flash SPI del sistema.  Seg√∫n nuestra informaci√≥n, este es el primer rootkit UEFI descubierto en la naturaleza. <br><br><h2>  Introduccion </h2><br>  Sednit utiliza una serie de familias de malware.  Una descripci√≥n detallada de las herramientas grupales de uso frecuente que proporcionamos en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">informe</a> . <br><br>  Hemos estado siguiendo la actividad de Sednit durante varios a√±os y hemos publicado muchos informes sobre el trabajo del grupo, desde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">descripciones de</a> vulnerabilidades de d√≠a cero hasta programas personalizados como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Zebrocy</a> .  Los componentes descritos en este informe forman un grupo separado. <br><br>  Los rootkits UEFI han sido descritos en informes de compa√±√≠as de seguridad de la informaci√≥n anteriormente.  Por ejemplo, se conoce rkloader, que apareci√≥ en una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">presentaci√≥n</a> sobre la fuga de datos en el Equipo de Hacking, y DerStarke, un implante en la descarga <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">macFI</a> EFI / UEFI, de documentos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vault7</a> .  Somos conscientes de la existencia de estas herramientas, sin embargo, los rootkits no han emitido informes de compromiso UEFI. <br><br>  Ahora no solo probamos el uso del firmware in-the-wild con el m√≥dulo malicioso LoJax UEFI, sino que tambi√©n encontramos toda la gama de herramientas que probablemente se usaron para instalarlo.  Es interesante observar que Sednit usa el kit de arranque DownDelph, que se us√≥ en 2013 y 2014 para mantener Downdelph, una de las puertas traseras Sednit de la primera etapa.  La idea es similar, pero en la nueva versi√≥n de UEFI, el uso de bootkits ya no es posible.  Por lo tanto, estos dos componentes difieren significativamente en el comportamiento. <br><br>  Este trabajo se divide en tres secciones.  En el primero, analizaremos los primeros estudios sobre la seguridad de LoJack / Computrace y el potencial uso malicioso del programa.  La segunda secci√≥n est√° dedicada al proceso de investigaci√≥n, que finalmente nos llev√≥ al rootkit UEFI.  Finalmente, en la tercera secci√≥n, describimos en detalle los diversos componentes de LoJax y c√≥mo proporcionan persistencia en el sistema incluso despu√©s de reinstalar Windows y reemplazar el disco duro. <br><br><h4>  Atribuci√≥n </h4><br>  Si bien muchos proveedores ya han hecho declaraciones sobre el grupo Sednit en el pasado, ESET de ninguna manera determina su afiliaci√≥n geopol√≠tica.  Desde la publicaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">del estudio de</a> 2016, nuestra posici√≥n no ha cambiado.  Determinar la fuente de un ciberataque basado en un enfoque cient√≠fico es una tarea compleja que est√° m√°s all√° del alcance de las competencias de los especialistas de ESET.  Lo que llamamos el "grupo Sednit" es solo un conjunto de software y una infraestructura de red asociada que no podemos asociar con autoridad con ninguna organizaci√≥n en particular. <br><br><h4>  Objetivos </h4><br>  Durante el estudio, encontramos una peque√±a cantidad de diferentes im√°genes de LoJax.  Seg√∫n nuestros datos de telemetr√≠a y un estudio de otros programas de Sednit descubiertos en la naturaleza, estamos seguros de que este m√≥dulo en particular rara vez se us√≥ en comparaci√≥n con otras herramientas.  Los objetivos, principalmente, eran organizaciones estatales ubicadas en los Balcanes, en Europa Central y Oriental. <br><br><h2>  Early Computertrace / LoJack Research </h2><br>  LoJack: software para proteger las computadoras del robo y la p√©rdida, desarrollado por Absolute Software Corporation.  Las primeras versiones del agente se conocen como Computrace.  Como lo indica el nombre anterior, despu√©s de activar el servicio, la computadora puede acceder a su servidor de comandos: se notificar√° al propietario sobre la ubicaci√≥n del dispositivo en caso de p√©rdida o robo. <br><br>  La siguiente secci√≥n describe la arquitectura anterior de LoJack.  Solo la versi√≥n anterior del software fue troyada por ciberdelincuentes, por lo que nos centraremos en ello.  Adem√°s, Absolute Software lanz√≥ en mayo de 2018 una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">declaraci√≥n</a> que indica que las vulnerabilidades descritas a continuaci√≥n no afectan el funcionamiento de las √∫ltimas versiones de sus agentes. <br><br>  El programa Computrace atrajo la atenci√≥n de los profesionales de seguridad de la informaci√≥n porque utilizaba un m√©todo inusual para garantizar la persistencia.  Su prop√≥sito es proteger contra el robo, por lo tanto, es importante que sea resistente a reinstalar el sistema operativo y reemplazar el disco duro; todo esto se implementa en el m√≥dulo UEFI / BIOS que puede sobrevivir despu√©s de estas acciones.  La soluci√≥n est√° preinstalada en el firmware de una parte importante de las computadoras port√°tiles de diferentes fabricantes, el usuario solo necesita activar esta funci√≥n.  La activaci√≥n se puede hacer en el BIOS, como se muestra en la figura a continuaci√≥n. <br><br><img src="https://habrastorage.org/webt/rf/vx/i_/rfvxi_hexr1f29e0hqddhak97ag.png"><br>  <i>Figura 1. Activando Computrace en el BIOS</i> <br><br>  Uno de los primeros informes de implementaci√≥n de LoJack / Computrace se public√≥ en 2009.  Se revel√≥ la arquitectura global del producto, el vaciado del m√≥dulo UEFI / BIOS del agente de usuario en el disco y la forma en que el agente se comunica con un servidor web controlado por Absolute Software.  El diagrama se puede entender a partir de la figura a continuaci√≥n. <br><br><img src="https://habrastorage.org/webt/mh/5a/u2/mh5au2bhmrriy8sn8dtsd1g1avw.png"><br>  <i>Figura 2. Mecanismo de persistencia LoJack (aproximadamente 2008)</i> <br><br>  La siguiente es una descripci√≥n de los pasos enumerados anteriormente: <br><br>  1. Si est√° activado, el m√≥dulo UEFI / BIOS se ejecuta en el momento del arranque.  √âl est√° tratando de encontrar la partici√≥n FAT / FAT32 / NTFS.  Luego, utilizando el controlador NTFS, crea una copia de seguridad del archivo <code>autochk.exe</code> y sobrescribe su contenido con el cuentagotas, que es responsable de instalar el componente de agente de usuario.  El archivo <code>autochk.exe</code> es un archivo ejecutable de Windows que se inicia en una etapa temprana del arranque del sistema para verificar posibles da√±os en el disco duro. <br><br>  2. Cuando se inicia el <code>autochk.exe</code> modificado, su objetivo principal es implementar el mini agente <code>rpcnetp.exe</code> y agregarlo como un servicio para que se inicie cada vez que se reinicie.  El √∫ltimo paso en este componente es restaurar la versi√≥n original de <code>autochk.exe</code> . <br><br>  3. Mini-agente <code>rpcnetp.exe</code> : un peque√±o archivo ejecutable cuyo prop√≥sito es garantizar el funcionamiento del agente principal.  Si el agente primario no funciona, <code>rpcnetp.exe</code> intenta conectarse al servidor de comandos de Absolute Software C&amp;C para descargarlo y ejecutarlo.  Primero, el mini agente har√° una copia de s√≠ mismo, luego realizar√° cambios en el encabezado PE para convertirlo a un archivo DLL.  Esta biblioteca se carga en la memoria, llama al proceso <code>svchost.exe</code> e inyecta la DLL all√≠.  A continuaci√≥n, se inicia el proceso <code>iexplore.exe</code> Internet Explorer y se inyecta el archivo DLL.  Este √∫ltimo proceso se utilizar√° para la comunicaci√≥n a trav√©s de Internet.  La inyecci√≥n de miniagente de Computrace en procesos de terceros a menudo se encuentra en malware y rara vez se asocia con software leg√≠timo. <br><br>  4. Ahora se est√° ejecutando un agente completamente funcional en el sistema y puede usar las funciones de Computrace para el seguimiento y la recuperaci√≥n. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">En</a> 2014 se public√≥ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">una descripci√≥n de</a> este proceso y el protocolo de red involucrado entre el mini agente y el servidor C&amp;C.  Debido a la falta de un mecanismo de autenticaci√≥n, si los atacantes controlan el servidor con el que se comunica el mini agente, pueden obligarlo a descargar c√≥digo arbitrario.  Existen varios mecanismos que permiten a los atacantes contactar al mini agente directamente.  El m√°s importante para nosotros utiliza el m√©todo de obtenci√≥n de la direcci√≥n del servidor C&amp;C por parte del mini agente.  De hecho, esta informaci√≥n se almacena en el archivo de configuraci√≥n en el archivo ejecutable. <br><br><img src="https://habrastorage.org/webt/qc/ww/es/qcwwesoicwoyw1aghae1smpgnao.png"><br>  <i>Figura 3. Archivo de configuraci√≥n de descifrado parcial LoJack cifrado a la derecha</i> <br><br>  La figura muestra el archivo de configuraci√≥n del mini agente LoJack.  El m√©todo de "cifrado" utilizado es un XOR simple con una clave de un solo byte.  La tecla 0xB5 es la misma para todos los mini agentes estudiados.  Como se puede ver en la figura, el dominio C&amp;C se especifica en el archivo.  Los cuatro bytes anteriores contienen la direcci√≥n IP del servidor C&amp;C.  En ausencia de validaci√≥n en el contenido del archivo de configuraci√≥n, los atacantes con permisos de escritura en <code>%WINDIR%</code> pueden cambiar su contenido para que el mini agente se comunique con su servidor de comandos, en lugar de ser leg√≠timo.  Al comprender el protocolo de red, puede hacer que el mini agente descargue y ejecute c√≥digo arbitrario.  Estos riesgos se conocen desde hace mucho tiempo, pero hasta hace poco, el mecanismo no se usaba en la pr√°ctica. <br><br><h4>  LoJack se convierte en LoJax </h4><br>  En mayo de 2018, las muestras de Trobor del mini agente LoJack, rpcnetp.exe, se describieron <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en el blog de</a> Arbor Network.  Su configuraci√≥n de red codificada se cambi√≥ para que las muestras maliciosas establecieran una conexi√≥n con el servidor C&amp;C del atacante en lugar del servidor leg√≠timo Absolute Software.  Algunos de los dominios encontrados en las muestras troyanizadas se conocieron antes; se usaron a fines de 2017 como dominios de servidor C&amp;C para SedUploader, la puerta trasera de la primera etapa del cibergrupo Sednit.  La figura a continuaci√≥n muestra un ejemplo de una configuraci√≥n modificada en uno de los mini agentes LoJax. <br><br><img src="https://habrastorage.org/webt/om/ts/md/omtsmdgqzbkn-fbqrpjd59abp7a.png"><br>  <i>Figura 4. A la izquierda hay un archivo de configuraci√≥n leg√≠timo, a la derecha hay un archivo modificado.</i> <br><br>  Las diferencias entre agentes leg√≠timos y troyanizados son extremadamente peque√±as, casi todas se mencionan anteriormente.  Las muestras de miniagente de LoJax que pudimos encontrar son versiones troyanizadas de la misma muestra de <code>rpcnetp.exe</code> Computrace, <code>rpcnetp.exe</code> .  Todos tienen marcas de tiempo de compilaci√≥n id√©nticas y solo unas pocas docenas de bytes difieren del original.  Adem√°s de los cambios en el archivo de configuraci√≥n, existen diferencias en las variables del temporizador que determinan los intervalos entre las conexiones al servidor C&amp;C. <br><br>  En el momento de la publicaci√≥n, descubrimos varios mini-agentes LoJax utilizados en ataques contra varias organizaciones en los Balcanes, en Europa Central y Oriental, pero no ten√≠amos ideas sobre c√≥mo instalarlos.  Una explicaci√≥n obvia ser√≠a instalar usando una de las famosas puertas traseras de Sednit.  No olvide que LoJack, como herramienta bien establecida, ha sido incluido en la lista blanca por muchos proveedores de antivirus.  Por lo tanto, incluso si en esta campa√±a solo se utiliz√≥ un mini agente que no sobrevivi√≥ despu√©s de reinstalar Windows, todav√≠a ten√≠a una ventaja: era menos probable que se detectara como malware.  Pero, ¬øqu√© pasar√≠a si el compromiso fuera a√∫n m√°s profundo y los atacantes intentaran copiar LoJack para acceder al firmware del sistema? <br><br><h2>  Caza para el componente de nivel inferior </h2><br>  Grabamos ataques LoJax dirigidos a varias organizaciones en los Balcanes, en Europa Central y Oriental.  En todos ellos, logramos encontrar rastros de malware Sednit, que incluyen: <br><br><ul><li>  SedUploader, puerta trasera de primera etapa </li><li>  XAgent, la puerta trasera insignia de Sednit </li><li>  Xtunnel, una herramienta de proxy de red que puede transferir cualquier tr√°fico de red entre un servidor C&amp;C en Internet y una computadora de destino en una red local </li></ul><br>  Encontramos rastros de herramientas Sednit en la mayor√≠a de los sistemas estudiados que se convirtieron en objetivos LoJax, as√≠ como en un par de sistemas donde solo estaba presente LoJax.  Se puede suponer que en algunos casos LoJax se us√≥ como una herramienta separada, probablemente como una puerta trasera adicional para restaurar el acceso de los operadores de Sednit a la red. <br><br>  La puerta trasera de XAgent generalmente coloca m√≥dulos adicionales en un sistema comprometido, por lo que inmediatamente viene a la mente que las muestras de LoJax se entregaron de la misma manera, sin ning√∫n otro mecanismo.  Se podr√≠a suponer que Sednit tom√≥ prestado solo un mini agente de la soluci√≥n LoJack.  Sin embargo, poco despu√©s del inicio del an√°lisis, encontramos varias pruebas que indican que la fuente de inspiraci√≥n era algo m√°s extensa. <br><br><h4>  Controlador RWEverything (RwDrv) e info_efi.exe </h4><br>  La primera evidencia se encontr√≥ gracias a una herramienta personalizada de ciberdelincuentes, quienes, cuando se ejecutaron, descargaron informaci√≥n sobre la configuraci√≥n del sistema de nivel inferior en un archivo de texto.  La herramienta fue descubierta junto con algunas muestras de LoJax.  La siguiente figura muestra un fragmento del archivo de <code>info_efi.exe</code> de esta herramienta con el nombre l√≥gico <code>info_efi.exe</code> . <br><br><img src="https://habrastorage.org/webt/8j/9x/kc/8j9xkcnbmste_xynugnkenaar6g.png"><br>  <i>Figura 5. Extracto de los registros de archivos generados por info_efi .exe</i> <br><br>  Para leer este tipo de informaci√≥n, la herramienta incluye un controlador llamado <code>RwDrv.sys</code> .  El controlador del kernel viene con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RWEverything</a> , una utilidad gratuita disponible en la red que se puede usar para leer informaci√≥n en casi todas las configuraciones de nivel inferior, incluida la interfaz PCI Express, memoria, ROM de opciones PCI, etc.  El controlador del n√∫cleo es un software leg√≠timo y est√° firmado con un certificado v√°lido. <br><br><img src="https://habrastorage.org/webt/2u/o-/mb/2uo-mbk6so15sdz9iusnxzl15qq.png"><br>  <i>Figura 6. Certificado de firma de c√≥digo RwDrv.sys</i> <br><br>  RWEverything viene con una interfaz gr√°fica de usuario que le permite acceder a toda esta informaci√≥n. <br><br><img src="https://habrastorage.org/webt/if/yp/dp/ifypdpu-hnounvupxelxhcp5el4.png"><br>  <i>Figura 7. Captura de pantalla de la interfaz RWEverything</i> <br><br>  El descubrimiento de la herramienta <code>info_efi</code> fue la primera se√±al de que podr√≠a existir un m√≥dulo UEFI LoJax.  Al intentar actualizar el firmware del sistema, es importante tener informaci√≥n sobre su proveedor, versi√≥n, etc.  Dadas las vulnerabilidades que permiten que los procesos del usuario accedan y modifiquen el contenido de la memoria flash SPI donde se almacenan los m√≥dulos UEFI, la obtenci√≥n de datos de firmware del sistema es el primer paso para un ataque exitoso. <br><br>  La pista final que nos permiti√≥ encontrar el primer rootkit UEFI del grupo Sednit fueron dos herramientas: descargar la memoria flash SPI y escribir en ella. <br><br><h4>  Volcar SPI Flash </h4><br>  La primera pieza del rompecabezas fue un archivo llamado <code>ReWriter_read.exe</code> .  Conten√≠a todo el c√≥digo requerido para volcar el flash SPI del sistema utilizando el controlador <code>RwDrv.sys</code> , <code>RwDrv.sys</code> .  Para que el controlador del dispositivo realice las operaciones necesarias, la herramienta de volcado debe enviar los c√≥digos de control de E / S (IOCTL) correctos.  Si bien <code>RwDrv.sys</code> admite muchos c√≥digos IOCTL diferentes, la herramienta de volcado y la herramienta de <code>RwDrv.sys</code> descritas en esta y en la siguiente secci√≥n usan solo cuatro de ellas. <br><br>  RwDrv.sys: c√≥digos IOCTL admitidos: <br><br>  <i>0x22280c</i> : escribe en el √°rea de memoria asignada para E / S <br>  <i>0x222808</i> : lee el √°rea de memoria asignada para entrada-salida <br>  <i>0x222840</i> : lee dword del registro de configuraci√≥n PCI especificado <br>  <i>0x222834</i> : escribe un byte en el registro de configuraci√≥n PCI especificado <br><br>  <code>ReWriter_read</code> primero crea un servicio con el <code>RwDrv.sys</code> kernel <code>RwDrv.sys</code> y escribe la informaci√≥n de configuraci√≥n UEFI / BIOS, los valores correspondientes de los tres campos contenidos en el registro de administraci√≥n del BIOS (BIOS_CNTL): BIOS Lock Enable (BLE), BIOS Write Enable (BIOSWE) y SMM BIOS Protecci√≥n contra escritura deshabilitada (SMM_BWP).  Aunque <code>ReWrite_read</code> no utiliza estos valores, en las siguientes secciones explicaremos por qu√© estos campos son de inter√©s para esta herramienta. <br><br>  La siguiente tarea de la herramienta es obtener la direcci√≥n base del √°rea de memoria del BIOS en SPI y su tama√±o.  Esta informaci√≥n est√° contenida en el registro de la interfaz SPI principal como BIOS Flash Primary Region.  Todos los registros se muestran en la memoria en el Root Complex Register Block (RCRB), cuya direcci√≥n base se puede obtener leyendo el registro de configuraci√≥n PCI deseado.  <code>ReWriter_read</code> obtiene esta direcci√≥n utilizando RwDrv IOCTL 0x22840 y leyendo la sangr√≠a correcta (en nuestro caso, 0xF0).  Tan pronto como se conoce la direcci√≥n base del √°rea del BIOS y su tama√±o, la herramienta de volcado lee el contenido correspondiente de la memoria flash SPI y lo escribe en un archivo en el disco.  El proceso de lectura de la memoria flash SPI se ilustra en la siguiente figura.  Las definiciones de abreviaturas se dan en el glosario a continuaci√≥n. <br><br><img src="https://habrastorage.org/webt/mw/wm/tb/mwwmtbzbrwmm18l1w7-2iugvpxc.png"><br>  <i>Figura 8. La secuencia de lectura de la memoria flash SPI</i> <br><br>  Adem√°s de los dos primeros pasos, ejecutados solo una vez, las operaciones se repiten en un ciclo hasta que se hayan le√≠do todos los datos de la memoria flash SPI.  El proceso tambi√©n est√° bien descrito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Luego <code>ReWriter_read</code> valida el tama√±o de la imagen fusionada.  Analiza el descriptor de memoria de imagen para obtener una variedad de √°reas de BIOS, Gigabit Ethernet (GbE) y Management Engine (ME).  Agregar las dimensiones de estas tres √°reas permite que la herramienta de volcado calcule todo el contenido del SPI flash.  Si el tama√±o coincide con el tama√±o obtenido al leer el √°rea de registro del BIOS primario Flash, la imagen se considera correcta. <br><br><h4>  Parche de firmware UEFI </h4><br>  La segunda pieza del rompecabezas era un archivo llamado <code>ReWriter_binary.exe</code> .  Este archivo contiene evidencia de que Sednit lleg√≥ al firmware.  El archivo contiene c√≥digo para aplicar el parche de la imagen UEFI descargada y volver a escribir la versi√≥n trojanizada en la memoria flash SPI.  En esta secci√≥n, describimos c√≥mo est√° estructurado este archivo binario. <br><br>  Una vez que la herramienta anterior descarga y verifica el contenido de la memoria flash, se agrega un m√≥dulo UEFI malicioso a la imagen.  Para hacer esto, la imagen UEFI debe analizarse para resaltar la informaci√≥n necesaria. <br><br>  Los datos almacenados en la imagen UEFI se descomponen en vol√∫menes a trav√©s del sistema de archivos (FFS).  Como su nombre lo indica, este es un sistema de archivos especial para almacenar im√°genes de firmware.  Los vol√∫menes contienen archivos con GUID.  Cada archivo generalmente consta de muchas secciones, una de las cuales contiene el PE / COFF ejecutable real, que es una imagen UEFI.  A continuaci√≥n se muestra una captura de pantalla de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UEFITool</a> , un proyecto de c√≥digo abierto para trabajar con im√°genes de firmware UEFI, para una comprensi√≥n m√°s simple del circuito. <br><br><img src="https://habrastorage.org/webt/s6/th/mp/s6thmpgjnornwankifoul8d9zlk.png"><br>  <i>Figura 9. Ejemplo de una imagen de firmware UEFI cargada en UEFITool</i> <br><br>  ReWriter_binary analiza todos los vol√∫menes de firmware encontrados en el √°rea BIOS SPI de la memoria flash y busca archivos espec√≠ficos: <br><br><ul><li>  IP4Dxe (8f92960f-2880-4659-b857-915a8901bdc8) </li><li>  NtfsDxe (768bedfd-7b4b-4c9f-b2ff-6377e3387243) </li><li>  SmiFlash (bc327dbd-b982-4f55-9f79-056ad7e987c5) </li><li>  N√∫cleo Dxe </li></ul><br><img src="https://habrastorage.org/webt/zt/ou/kc/ztoukch8w0mdyv-whzpkaibpc9u.png"><br>  <i>Figura 10. El resultado del uso del descompilador Hex-Rays en los vol√∫menes de firmware</i> <br><br>  Ip4Dxe y NtfsDxe son controladores DXE.  En el firmware UEFI, los controladores DXE son im√°genes PE / COFF creadas para abstracci√≥n de hardware o para organizar servicios para su uso por otros controladores DXE o aplicaciones UEFI.  DXE Foundation detecta y descarga dichos controladores a trav√©s del Administrador de DXE (n√∫cleo DXE) en una etapa temprana del proceso de arranque.  Despu√©s de completar esta fase, todos los servicios, como el cargador del sistema operativo, est√°n disponibles para trabajar con aplicaciones UEFI.  Por lo general, los controladores DXE se almacenan en el mismo volumen.  Sin embargo, el despachador DXE puede estar separado. <br><br>  <code>ReWriter_binary</code> busca Ip4Dxe solo para averiguar si un volumen dado contiene controladores DXE.  Como describimos m√°s adelante, este volumen se convierte en candidato para instalar el controlador DXE malicioso.  Tambi√©n busca el n√∫cleo DXE y agrega el volumen en el que se encuentra como otro candidato para un lugar donde registrar un rootkit.  El espacio libre disponible en cada uno de estos vol√∫menes se almacena y luego se utiliza para verificar la suficiencia para agregar un controlador malicioso. <br><br>  NtfsDxe: controlador AMI NTFS DXE.  Si est√° presente en el volumen del firmware, su ubicaci√≥n se guarda y luego se utiliza para eliminar este archivo del volumen.  En la secci√≥n UEFI rootkit, veremos por qu√© elimina este archivo. <br><br>  En cuanto a la imagen SmiFlash, la informaci√≥n relacionada con ella se almacena, pero no se usa en ning√∫n lugar de Malvari.  Curiosamente, la imagen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">es vulnerable</a> .  Por lo tanto, creemos que los operadores de Sednit pueden trabajar para explotar estas vulnerabilidades.  Esto puede permitirles escribir incluso sistemas configurados correctamente en la memoria flash SPI.  Como diremos m√°s adelante, en su forma actual, la herramienta solo puede escribir en el √°rea de BIOS de sistemas configurados incorrectamente o bastante antiguos (en placas base con conjuntos de chips m√°s antiguos que el Platform Controller Hub, introducido alrededor de 2008). <br><br>  Despu√©s de asignar los metadatos necesarios, <code>ReWriter_binary</code> parchea el volcado de la imagen UEFI y agrega el controlador DXE malicioso.  Primero, crea el encabezado del archivo (EFI_FFS_FILE_HEADER).  Luego selecciona el volumen de destino en funci√≥n de la ubicaci√≥n de Ip4Dxe y el n√∫cleo DXE, as√≠ como el espacio libre disponible en estos vol√∫menes.  <code>ReWriter_binary</code> incorpora una secci√≥n comprimida que contiene una imagen PE y una secci√≥n de interfaz de usuario que define un nombre de archivo legible para humanos: SecDxe.  La secci√≥n comprimida se agrega al encabezado del archivo y se escribe al final del volumen, en el espacio libre.  La siguiente figura muestra la estructura, su visualizaci√≥n en UEFITool. <br><br><img src="https://habrastorage.org/webt/g6/9-/-a/g69--aub7xrb5b1iinzwrtpxyo8.png"><br>  <i>Figura 11. Vista del archivo SecDxe en UEFITool</i> <br><br>  Finalmente, si el controlador NtfsDxe est√° presente en la imagen, se eliminar√°.  El sistema de archivos de firmware almacena los archivos y su contenido secuencialmente, por lo que el proceso es bastante simple: <br><br><ul><li>  sangr√≠a a un espacio libre al final del volumen </li><li>  0xFF bytes escritos encima de la imagen NtfsDxe </li><li>  se copia la siguiente parte del volumen del firmware, comenzando con la sangr√≠a donde se encontraba NtfsDxe </li><li>  el resto del sistema de archivos est√° lleno de bytes 0xFF, es decir, espacio libre </li></ul><br><h4>  Escribir firmware parcheado en la memoria flash SPI </h4><br>  Despu√©s de realizar con √©xito los cambios en la imagen del firmware, el siguiente paso es volver a escribirla en la memoria flash SPI.  Antes de sumergirnos en este proceso, debemos caracterizar algunas de las protecciones de escritura del BIOS que son importantes en este caso.  Otros mecanismos existentes, como el BIOS Range Protection Protection, permanecen distantes porque ReWriter_binary no los verifica. <br><br>  La plataforma utiliza varios mecanismos de seguridad para bloquear los intentos no autorizados de escribir en el √°rea del BIOS.  Debo decir que estos mecanismos no est√°n habilitados por defecto.  El firmware es responsable de su configuraci√≥n correcta.  Estas configuraciones se presentan en el registro de control del BIOS (BIOS_CNTL).  Contiene el bit de habilitaci√≥n de escritura de BIOS (BIOSWE), que debe cambiarse a "1" para escribir en el √°rea de BIOS de la memoria flash SPI.  Dado que la plataforma no debe permitir ning√∫n intento de escribir en el √°rea de BIOS, hay un bit m√°s en BIOS_CNTL para proteger BIOSWE: esto es BIOS Lock Enable (BLE).  Cuando se establece, el mecanismo debe bloquear el bit BIOSWE y dejar el valor igual a "0".  Sin embargo, la soluci√≥n tiene una vulnerabilidad.  Cuando la solicitud llega a cambiar el bit BIOSWE a "1", el bit BIOSWE a "1", y solo despu√©s de que la plataforma interrumpe la tarea mediante la interrupci√≥n de administraci√≥n del sistema (SMI), el c√≥digo para este SMI cambia el bit BIOSWE a "0". <br><br>  Hay muchos problemas en esta versi√≥n de la soluci√≥n.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En primer lugar, el procesador SMI se deja para los desarrolladores de firmware. Por lo tanto, si este c√≥digo no se implementa en el firmware, el bit BLE es in√∫til, ya que el bit BIOSWE no se volver√° a establecer en "0". En segundo lugar, en este caso, tenemos una " </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vulnerabilidad de condici√≥n de carrera</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " que nos permite eludir completamente este mecanismo, incluso si el controlador SMI se implementa correctamente. Para aprovechar esta vulnerabilidad, un atacante debe ejecutar un subproceso que establece continuamente el BIOSWE en "1", mientras que otro subproceso debe escribir datos en la memoria flash SPI. Seg√∫n el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trabajo de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kallenberg y Wojtchuk, este ataque funciona en procesadores multin√∫cleo y tambi√©n se puede utilizar con √©xito en procesadores de un solo n√∫cleo con tecnolog√≠a Hyper-Threading habilitada.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para resolver este problema, se agreg√≥ a la plataforma un nuevo mecanismo de protecci√≥n configurado a trav√©s de BIOS_CNTL. Se introduce en la familia de conjuntos de chips del Intel Platform Controller Hub (PCH). Si se establece el bit de configuraci√≥n, el SMM BIOS Write Protect Disable (SMM_BWP) solo permitir√° escribir en el √°rea del BIOS si todos los n√∫cleos est√°n en Modo de administraci√≥n del sistema (SMM) y el BIOSWE est√° configurado en "1". Esto protege eficazmente el sistema de la "vulnerabilidad de condici√≥n de carrera" descrita anteriormente. Sin embargo, como en el caso de BLE, SMM_BWP debe activarse desde el lado del firmware. Por lo tanto, el firmware en el que estos mecanismos est√°n configurados incorrectamente deja al sistema en riesgo de otorgar derechos de escritura no autorizados al √°rea del BIOS. </font></font><br><br> <code>ReWriter_binary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lee el contenido del registro de control del BIOS para seleccionar la ruta correcta.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primero verifica si BIOSWE est√° configurado. Si es as√≠, entra en la fase de grabaci√≥n. Si BIOSWE est√° deshabilitado, verifica el valor del bit BLE. Si no est√° instalado, cambia el valor del bit BIOSWE y comienza a grabar el firmware parcheado. Si se establece el bit BLE, comprueba el estado deshabilitado SMM_BWP y aplica la "vulnerabilidad de condici√≥n de carrera" descrita anteriormente. Si se establece el bit SMM_BWP, la operaci√≥n falla. La siguiente figura ilustra el proceso. </font></font><br><br><img src="https://habrastorage.org/webt/db/3t/n5/db3tn5tpff0bgjciq9ciiy3a6p4.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 12. El √°rbol de decisi√≥n durante el proceso de grabaci√≥n</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Suponiendo que el archivo analizado en particular se </font></font><code>ReWriter_binary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utiliz√≥ para implementar el rootkit UEFI, podemos concluir que el firmware configur√≥ incorrectamente la protecci√≥n de escritura del BIOS o que el conjunto de chips de la m√°quina v√≠ctima es m√°s antiguo que el Hub del controlador de plataforma.</font></font><br><br> <code>ReWriter_binary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No pude reemplazar el firmware UEFI en un sistema moderno bien ajustado. Sin embargo, al buscar una imagen vulnerable de SmiFlash UEFI, analizar los vol√∫menes de firmware UEFI sugiere que los atacantes tambi√©n podr√≠an trabajar con t√©cnicas de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protecci√≥n de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> omisi√≥n de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">escritura de BIOS</font></a><font style="vertical-align: inherit;"> m√°s avanzadas </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De manera muy similar al procedimiento de lectura, se escribe en la memoria flash SPI: </font></font><br><br><img src="https://habrastorage.org/webt/ct/wi/v3/ctwiv38relsl9rpveltd8imrpjy.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 13. Secuencia de escritura en la memoria flash SPI</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adem√°s de los dos primeros pasos, que se realizan solo una vez, estas operaciones se repiten en un ciclo hasta que toda la informaci√≥n se escriba en la memoria flash SPI . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cuando se completa el proceso de grabaci√≥n, los contenidos de la memoria flash SPI se descargan nuevamente a un archivo </font></font><code>image.bin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La misma verificaci√≥n de integridad que se realiz√≥</font></font><code>ReWriter_read</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, se ejecuta en una nueva imagen combinada. </font><font style="vertical-align: inherit;">Luego, la imagen le√≠da de la memoria flash SPI se compara con la imagen parcheada en la memoria. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si alguno de los bytes es diferente, su direcci√≥n se escribe en el registro. </font><font style="vertical-align: inherit;">La presencia o ausencia de diferencias no afecta el progreso del malware. </font><font style="vertical-align: inherit;">Esta informaci√≥n solo se registra para que los operadores entiendan lo que est√° sucediendo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la etapa final, la clave de registro se establece en: </font></font><br><br> <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\BootExecute = ‚Äúautocheck autochk *‚Äù</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Luego, el servicio RwDrv se detiene y se elimina. </font><font style="vertical-align: inherit;">Es importante que el valor de esta l√≠nea se asigne a la clave de registro de Windows, ya que el rootkit UEFI est√° buscando exactamente esta l√≠nea para cambiarla y ejecutar su componente durante el inicio de Windows. </font><font style="vertical-align: inherit;">Hablaremos de esto con m√°s detalle cuando describamos el rootkit UEFI y sus componentes.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> An√°lisis T√©cnico LoJax </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La herramienta para descargar, parchar y escribir en la memoria flash SPI est√° personalizada para una imagen de firmware espec√≠fica y no se puede usar en ning√∫n sistema. En este caso, se puede distinguir el m√≥dulo UEFI completo. Lo primero que hicimos despu√©s de recibir este m√≥dulo fue estudiar los datos de telemetr√≠a para averiguar si se hab√≠an visto antes. En esto, tuvimos que confiar en el nuevo esc√°ner UEFI, que puede escanear el firmware del sistema. Descubrimos que el m√≥dulo UEFI del grupo Sednit se instal√≥ al menos una vez en el sistema, lo que significa que este rootkit se usa realmente en la naturaleza.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todav√≠a no se ha establecido c√≥mo se entregaron herramientas maliciosas a los sistemas comprometidos. Lo m√°s probable es que se hayan utilizado otros programas para esto, por ejemplo, XAgent. Las herramientas de volcado y grabaci√≥n se encontraron en el mismo sistema, pero en diferentes momentos, probablemente, los operadores trabajaron en varias etapas. Primero, descargaron el firmware en la m√°quina de destino, se aseguraron de que la herramienta para realizar ajustes en el programa funcionara sin fallas, y luego lo volvieron a cargar y ya parchearon el firmware. Encontramos solo una versi√≥n de la herramienta para volcar y grabar, pero existe la posibilidad de que existan otras versiones para otro firmware con vulnerabilidades que puedan encontrar.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La figura siguiente proporciona una descripci√≥n general del funcionamiento del rootkit UEFI hasta que se inicia el sistema operativo. </font><font style="vertical-align: inherit;">Primero, el DXE Manager carga el controlador SecDxe DXE. </font><font style="vertical-align: inherit;">De esta forma, se configura la funci√≥n de notificaci√≥n para el grupo de eventos </font></font><code>EFI_EVENT_GROUP_READY_TO_BOOT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cuando el firmware est√° listo para seleccionar el dispositivo de arranque e iniciar el cargador de arranque, se llama a la funci√≥n de notificaci√≥n. </font><font style="vertical-align: inherit;">Ella realiza tres acciones:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> carga el controlador NTFS DXE incorporado para proporcionar acceso y capacidad de escritura a particiones NTFS </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> escribe dos archivos en la partici√≥n NTFS de Windows: rpcnetp.exe y autoche.exe </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cambia la clave de registro 'HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Control \ Session Manager \ BootExecute': a: 'autocheck autochk *'; </font><font style="vertical-align: inherit;">despu√©s: 'autocheck autoche *'.</font></font></li></ul><br><img src="https://habrastorage.org/webt/at/qy/ec/atqyecti3adwerrfljy0ccirxgy.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 14. Proceso de arranque de un sistema infectado con un rootkit UEFI</font></font></i> <br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SecDxe: controlador malicioso DXE </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En esta secci√≥n, revelaremos la secuencia de eventos que ocurren en un sistema comprometido. Comenzamos con una descripci√≥n del rootkit, y luego seguimos la cadena de eventos hasta que los componentes finales se implementan a nivel del sistema operativo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El rootkit UEFI de Sednit es un controlador DXE con un GUID </font></font><code>682894B5-6B70-4EBA-9E90-A607E5676297</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No est√° firmado, por lo que no se puede ejecutar en un sistema con la protecci√≥n de arranque seguro habilitada. Despu√©s de implementar en uno de los vol√∫menes de firmware, DXE Foundation lo descarga cada vez que se inicia el sistema. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SecDxe es un peque√±o controlador DXE que b√°sicamente hace dos cosas. Configura un protocolo espec√≠fico de GUID.</font></font><code>832d9b4d-d8d5-425f-bd52-5c5afb2c85dc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que nunca se usa Luego crea un evento asociado con la funci√≥n de notificaci√≥n. La funci√≥n de notificaci√≥n est√° configurada para invocar una se√±al por grupo </font></font><code>EFI_EVENT_GROUP_READY_TO_BOOT</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. La se√±al a este grupo de eventos proviene del administrador de arranque cuando est√° listo para seleccionar el dispositivo a arrancar. </font></font><br><br><img src="https://habrastorage.org/webt/sj/ff/6o/sjff6ohskqe2ewtsv8xnyis3oss.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 15. El resultado del descompilador Hex-Rays que pasa por el proceso de creaci√≥n de eventos</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La funci√≥n de notificaci√≥n explota el comportamiento malicioso del rootkit UEFI Sednit. Ella escribe componentes en el sistema de archivos NTFS de Windows. Como regla general, el firmware UEFI solo funciona con la partici√≥n del sistema EFI, por lo que el controlador NTFS generalmente no est√° incluido. Solo los sistemas de archivos FAT son compatibles como particiones para descargar. Por lo tanto, el firmware UEFI no necesariamente viene con controladores NTFS. Por esta raz√≥n, SecDxe tiene su propio controlador NTFS incorporado. Este controlador se inicia primero y se conecta al dispositivo de disco. Es decir, se instala </font></font><code>EFI_SIMPLE_FILE_SYSTEM_PROTOCOL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en dispositivos de disco con particiones NTFS, lo que incluye el acceso a los archivos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ahora que todo est√° listo para escribir archivos en particiones de Windows, SecDxe se reinicia </font></font><code>rpcnetp.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font><code>autoche.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Luego se </font></font><code>rpcnetp.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instala </font></font><code>%WINDIR%\SysWOW64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en versiones de 64 bits de Windows o</font></font><code>%WINDIR%\System32</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en versiones de 32 bits. </font><font style="vertical-align: inherit;">A se </font></font><code>autoche.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">establece en </font></font><code>%WINDIR%\SysWOW64</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La siguiente figura muestra el proceso responsable de escribir estos archivos en el disco. </font></font><br><br><img src="https://habrastorage.org/webt/si/jo/pn/sijopnar5xrablwh02xdrv5e37a.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 16. El resultado del descompilador Hex-Rays que pasa por el proceso de escribir archivos en el disco.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Luego SecDxe abre un </font></font><code>%WINDIR%\System32\config\SYSTEM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">archivo con una copia de seguridad de un conjunto de claves de registro </font></font><code>HKLM\SYSTEM</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Se analiza el archivo hasta que encuentra </font></font><code>'autocheck autochk *'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y reemplaza </font></font><code>'k'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en </font></font><code>'autochk'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el </font></font><code>'e'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Como resultado, </font></font><code>'HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\ BootExecute'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cambia a </font></font><code>'autocheck autoche *'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">La pr√≥xima vez que arranque Windows, se ejecutar√° autoche.exe en su lugar </font></font><code>autochk.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hacking Team NTFS Driver </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como se discuti√≥ anteriormente, el controlador NTFS est√° integrado en el m√≥dulo SecDxe. Existe una fuerte evidencia de que los operadores de Sednit no escribieron su propio controlador, sino que compilaron una copia del anunciado controlador NTFS DXE del Equipo de Hacking. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Su controlador NTFS utiliza el proyecto ntfs-3g como n√∫cleo. Esto es solo un contenedor para que funcione como un controlador UEFI DXE. El archivo INF del ensamblaje del controlador del Equipo de Hacking enumera los nombres de archivo de proyecto ntfs-3g. Las l√≠neas de c√≥digo del controlador SecDxe NTFS tambi√©n enumeran muchos de estos nombres de archivo: </font><font style="vertical-align: inherit;">Es interesante observar que la ruta del proyecto es la misma que se encuentra en vector-edk, el proyecto de desarrollo EFI del Hacking Team. Hay un subproyecto en vector-edk</font></font><br><br> <code>- c:\edk2\NtfsPkg\NtfsDxe\ntfs\inode.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\volume.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\bootsect.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\unistr.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\attrib.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\mft.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\index.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\cache.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\misc.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\dir.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\runlist.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\logfile.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\uefi_io.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\ntfsinternal.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\mst.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\lcnalloc.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\compress.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\bitmap.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\collate.c <br> - c:\edk2\NtfsPkg\NtfsDxe\ntfs\security.c</code> <br> <br><font style="vertical-align: inherit;"></font><code>NtfsPkg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con un dise√±o de directorio absolutamente id√©ntico. Los archivos fuente del proyecto ntfs-3g se encuentran en la misma ruta de direcci√≥n. Y aunque los caminos en s√≠ no son notables, creemos que esto no es una mera coincidencia. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al comparar el c√≥digo fuente filtrado a la red con lo que obtuvimos en la salida del descompilador Hex-Rays, resulta obvio que este es el mismo proyecto. La siguiente figura muestra un ejemplo de una comparaci√≥n de una funci√≥n </font></font><code>NtfsDriverBindingStart</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tomada de </font></font><code>vector-edk/NtfsPkg/NtfsDxe/Ntfs.c</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Los comentarios del c√≥digo HT original se eliminan para una mejor percepci√≥n. La l√≥gica y la secuencia de las llamadas a funciones son las mismas. Ambos proyectos incluso usan una variable (LockedByMe) para guardar un estado bloqueado. </font></font><br><br><img src="https://habrastorage.org/webt/qn/-k/ut/qn-kutvxgtnyuqkcvvo8zwfglya.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 17. Comparaci√≥n de los resultados a la salida del descompilador Hex-Rays NTFS controlador Sednit (izquierda) y controlador NTFS HT (derecha)</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El c√≥digo anterior muestra a los desarrolladores del Hacking Team, que no est√° en el c√≥digo abierto ntfs-3g. Como se menciona en la secci√≥n </font></font><code>ReWriter_binary</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, durante el an√°lisis del sistema de archivos de firmware, el archivo ejecutable intenta eliminar el controlador AMI NTFS. Quer√≠amos descubrir por qu√© se est√° eliminando en lugar de usarse.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analizamos el controlador y descubrimos que solo puede realizar operaciones de lectura. Dado que la escritura en el sistema de archivos no est√° disponible, los desarrolladores no pudieron usarla para sus propios fines. Tambi√©n es probable que los operadores de Sednit encuentren dificultades debido al hecho de que ya hay otro controlador NTFS en el firmware, por lo que decidieron simplemente eliminarlo. Adem√°s de implementar capacidades de lectura y escritura, el controlador del Equipo de Hacking no respeta los permisos de archivo. Por ejemplo, puede sobrescribir un archivo de solo lectura sin causar ning√∫n error.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En este punto, ya hemos descrito varias operaciones de compromiso del sistema realizadas por el rootkit UEFI. </font><font style="vertical-align: inherit;">Tambi√©n discutimos las razones por las cuales los operadores de Sednit usaron el c√≥digo fuente edk del vector de Hacking Team para desarrollar su controlador NTFS para escribir archivos en particiones NTFS en Windows. </font><font style="vertical-align: inherit;">M√°s adelante en este documento, presentaremos un an√°lisis de los componentes entregados por SecDxe.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">autoche.exe vs. </font><font style="vertical-align: inherit;">autochk.exe</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Malicioso se </font></font><code>autoche.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utiliza para garantizar la persistencia del mini agente </font></font><code>rpcnetp.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Como puede ver en la siguiente figura, utiliza llamadas nativas a la API de Windows para crear un servicio. </font></font><br><br><img src="https://habrastorage.org/webt/wc/dk/fv/wcdkfvfmcoog14t1orjmryouwd4.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 18. Autoche .exe malicioso configura la persistencia de rpcnetp.exe.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Debe tenerse en cuenta que el nombre del servicio es el mismo que el utilizado por el agente leg√≠timo de Computrace. Despu√©s de crear el servicio, restaura el valor de la clave de registro anterior </font></font><code>BootExecute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><img src="https://habrastorage.org/webt/yz/wc/lj/yzwclj1loxeconb728wvsxqvyse.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 19. El archivo malicioso autoche.exe restaura el valor original de la clave de registro BootExecute.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dado que el proceso ocurre durante el inicio de Windows, es poco probable que el usuario note un cambio en el valor de la clave.</font></font><code>BootExecute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Cabe se√±alar que en autoche .exe algunas similitudes con el m√≥dulo autochk.exe en Computrace son notables, por ejemplo, las llamadas API aplicadas y el registro de servicios, pero el resto es bastante diferente. </font><font style="vertical-align: inherit;">El m√≥dulo Computrace es m√°s grande y restaura el archivo ejecutable original en </font></font><code>autochk.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lugar de cambiar la clave del registro. </font><font style="vertical-align: inherit;">Tambi√©n es responsable de implementar el mini agente en el disco, mientras que LoJax lo hace con el rootkit UEFI.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rpcnetp.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si bien el mini agente </font></font><code>rpcnetp.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puede ser implementado por el rootkit UEFI, es probable que en la mayor√≠a de los casos cuando encontramos una versi√≥n troyanada de LoJack, el mini agente no haya utilizado este componente. Es probable que procedieran de consideraciones oportunistas e instalaran el rootkit UEFI solo cuando ten√≠an esa oportunidad, y en las organizaciones que m√°s les interesaban. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Durante la investigaci√≥n, descubrimos varias versiones del mini agente LoJax. La lista de indicadores de compromiso muestra sus valores hash y los dominios / direcciones IP correspondientes. Como ya dijimos, todas las muestras encontradas eran una versi√≥n troyanizada del mismo antiguo agente de Computrace, compilada en 2008.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nunca hemos visto a un agente de LoJax descargar e instalar m√≥dulos adicionales, pero sabemos que dicha funcionalidad existe. </font><font style="vertical-align: inherit;">Dado que las mejores cualidades de LoJax son el sigilo y la persistencia, definitivamente se puede usar para proporcionar acceso a recursos clave.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prevenci√≥n de ataques y recuperaci√≥n </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para evitar un ataque, se necesita un ecosistema complejo que consta de muchos componentes activos. </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El primer mecanismo de seguridad que podr√≠a bloquear dicho ataque es el arranque seguro. Cuando el arranque seguro est√° habilitado, cada componente del firmware descargado a pedido del firmware debe estar correctamente firmado, asegurando as√≠ su integridad.</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recomendamos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que habilite la funci√≥n de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arranque seguro, esta es la protecci√≥n b√°sica contra ataques en el firmware UEFI. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al igual que con el software, el firmware UEFI siempre debe actualizarse de manera oportuna. Visite el sitio web del fabricante de la placa base para asegurarse de tener la √∫ltima versi√≥n disponible.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n debe asegurarse de que todos sus sistemas est√©n equipados con modernos conjuntos de chips con el Hub de controlador de plataforma (comenzando con los conjuntos de chips Intel Serie 5 y posteriores). Esto asegurar√° que los mecanismos de seguridad funcionen contra la "vulnerabilidad de condici√≥n de carrera", que, como </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indicamos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , est√° presente en la plataforma. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otra parte de la seguridad del firmware est√° en manos de los proveedores de UEFI / BIOS. Los mecanismos de seguridad proporcionados por la plataforma deben estar configurados correctamente por el firmware del sistema para garantizar realmente su protecci√≥n. Por lo tanto, el firmware debe construirse inicialmente con una comprensi√≥n de las medidas de seguridad. Afortunadamente, cada vez m√°s investigadores de seguridad est√°n prestando atenci√≥n a la seguridad del firmware, atrayendo la atenci√≥n de los proveedores. Tambi√©n vale la pena mencionar es </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CHIPSEC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, un marco de c√≥digo abierto que realiza una evaluaci√≥n de seguridad de bajo nivel para determinar si la plataforma est√° configurada correctamente. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eliminar las consecuencias del compromiso a trav√©s del firmware UEFI es una tarea dif√≠cil. No hay formas f√°ciles de limpiar el sistema de tales amenazas, y no hay productos de seguridad especiales que puedan arreglarlo todo. En el caso descrito aqu√≠, para eliminar el rootkit, es necesario volver a actualizar la memoria flash SPI. Esta es una tarea no trivial; no es adecuada para el usuario promedio. La actualizaci√≥n del firmware UEFI puede eliminar el rootkit si se reescribe toda el √°rea SPI de la memoria flash. Si el flasheo UEFI no es posible, la √∫nica soluci√≥n es reemplazar la placa base del sistema infectado.</font></font><br><br><h2>  Conclusiones </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El rootkit UEFI es una de las herramientas m√°s peligrosas y poderosas de los ciberdelincuentes debido a su alta persistencia e inmunidad para reinstalar el sistema operativo y reemplazar un disco duro, as√≠ como la dificultad excepcional de detecci√≥n y eliminaci√≥n. Aunque la imagen UEFI del sistema es dif√≠cil de cambiar, pocas soluciones le permiten escanear m√≥dulos UEFI e identificar entre ellos los maliciosos. Adem√°s, limpiar el firmware UEFI significa flashearlo, lo cual no es una operaci√≥n normal que un usuario normal no podr√° realizar. Estos beneficios explican por qu√© los cibergrupos con recursos ilimitados continuar√°n atacando los sistemas UEFI. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para cualquier pregunta sobre este trabajo, comun√≠quese con hazardintel@eset.com. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Queremos expresar nuestro agradecimiento a quienes est√°n trabajando en el proyecto opensecuritytraining.info. Curso</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La introducci√≥n a BIOS y SMM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> realmente nos ayud√≥ cuando analizamos las interacciones con el chip flash SPI.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Glosario </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Consulte las especificaciones de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para obtener una descripci√≥n m√°s detallada de las abreviaturas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- BIOS_CNTL: Registro de control de BIOS </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- BIOSWE: Escritura de BIOS habilitada </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- BLE: Bloqueo de BIOS habilitado </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- FADDR: Direcci√≥n de flash </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- FDATAX: Datos de Flash de FDATA0 a FDATAN </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- FDBC: Conteo de bytes de datos de Flash </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- FGO: Flash Cycle Go </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- HSFC: Secuencia de hardware Control de flash </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- HSFS: Secuencia de hardware Estado de flash </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- IOCTL: Control de entrada / salida </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- PCH: Hub de controlador de plataforma </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- RCBA: Registro de direcci√≥n de base compleja de ra√≠z </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- RCRB: Bloque de registro de complejo de ra√≠z </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SCIP: Ciclo de SPI en curso </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SMI: Interrupci√≥n de administraci√≥n del sistema </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SMM: Modo de gesti√≥n del sistema</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SMM_BWP: SMM BIOS Write Protect Disable </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- SPI: interfaz de perif√©ricos en serie</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Indicadores de compromiso </font></font></h2><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ReWriter_read.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detecci√≥n ESET </font></font><br> <code>Win32/SPIFlash.A</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>ea728abe26bac161e110970051e1561fd51db93b</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ReWriter_binary.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detecci√≥n ESET </font></font><br> <code>Win32/SPIFlash.A</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>cc217342373967d1916cb20eca5ccb29caaf7c1b</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Secdexe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detecci√≥n ESET </font></font><br> <code>EFI/LoJax.A</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>f2be778971ad9df2082a266bd04ab657bd287413</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> info_efi.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detecci√≥n ESET </font></font><br> <code>Win32/Agent.ZXZ</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>4b9e71615b37aea1eaeb5b1cfa0eee048118ff72</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> autoche.exe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detecci√≥n ESET </font></font><br> <code>Win32/LoJax.A</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>700d7e763f59e706b4f05c69911319690f85432e</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agente Mini EXE </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detecci√≥n ESET </font><font style="vertical-align: inherit;">SHA-1</font></font><br> <code>Win32/Agent.ZQE <br> Win32/Agent.ZTU</code> <br><font style="vertical-align: inherit;"></font><br> <code>1771e435ba25f9cdfa77168899490d87681f2029 <br> ddaa06a4021baf980a08caea899f2904609410b9 <br> 10d571d66d3ab7b9ddf6a850cb9b8e38b07623c0 <br> 2529f6eda28d54490119d2123d22da56783c704f <br> e923ac79046ffa06f67d3f4c567e84a82dd7ff1b <br> 8e138eecea8e9937a83bffe100d842d6381b6bb1 <br> ef860dca7d7c928b68c4218007fb9069c6e654e9 <br> e8f07caafb23eff83020406c21645d8ed0005ca6 <br> 09d2e2c26247a4a908952fee36b56b360561984f <br> f90ccf57e75923812c2c1da9f56166b36d1482be</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nombres de dominio del servidor de comandos </font></font></h4><br> <code>secao[.]org <br> ikmtrust[.]com <br> sysanalyticweb[.]com <br> lxwo[.]org <br> jflynci[.]com <br> remotepx[.]net <br> rdsnets[.]com <br> rpcnetconnect[.]com <br> webstp[.]com <br> elaxo[.]org</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Direcciones IP del servidor de comandos </font></font></h4><br> <code>185.77.129[.]106 <br> 185.144.82[.]239 <br> 93.113.131[.]103 <br> 185.86.149[.]54 <br> 185.86.151[.]104 <br> 103.41.177[.]43 <br> 185.86.148[.]184 <br> 185.94.191[.]65 <br> 86.106.131[.]54</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agente mini DLL </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detecci√≥n ESET </font></font><br> <code>Win32/Agent.ZQE</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1 </font></font><br> <code>397d97e278110a48bd2cb11bb5632b99a9100dbd</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Servidor de comandos Nombres de dominio </font></font><br> <code>elaxo.org</code> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Direcciones de IP del </font><font style="vertical-align: inherit;">servidor de comandos</font></font><br> <code>86.106.131[.]54</code> </div> </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es425251/">https://habr.com/ru/post/es425251/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es425241/index.html">Desarrollador 20 a√±os despu√©s: Vasily Lebedev sobre ICRE, educaci√≥n, su libro y programaci√≥n.</a></li>
<li><a href="../es425243/index.html">El manual de john willis</a></li>
<li><a href="../es425245/index.html">Anuncio de RamblerFront & # 6</a></li>
<li><a href="../es425247/index.html">Crowdsourcing en pruebas</a></li>
<li><a href="../es425249/index.html">¬øC√≥mo es el conocimiento de LLP en la Universidad ITMO: el curso "Programaci√≥n de bajo nivel"?</a></li>
<li><a href="../es425253/index.html">Estamos haciendo un proyecto de aprendizaje autom√°tico en Python. Parte 1</a></li>
<li><a href="../es425255/index.html">Broo algoritmo de compresi√≥n sin p√©rdida y codificaci√≥n delta, comparaci√≥n con Xdelta3. Desarrollo de proyectos en casa</a></li>
<li><a href="../es425259/index.html">Copia de seguridad de su sitio usando git y Makefile</a></li>
<li><a href="../es425261/index.html">Los certificados EV est√°n muertos</a></li>
<li><a href="../es425263/index.html">El festival iFEST se llevar√° a cabo en Nizhny Novgorod</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>