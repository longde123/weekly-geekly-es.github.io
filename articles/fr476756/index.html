<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêô üëÄ üç† Transformer FunC en FunCtional avec Haskell: comment Serokell a remport√© la comp√©tition de blockchain de Telegram ‚ô£Ô∏è üöä üôÜüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vous avez probablement entendu dire que Telegram allait lancer la plateforme de blockchain Ton . Mais vous auriez pu manquer la nouvelle qu'il n'y a p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Transformer FunC en FunCtional avec Haskell: comment Serokell a remport√© la comp√©tition de blockchain de Telegram</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476756/"><p>  Vous avez probablement entendu dire que Telegram <a href="https://vc.ru/finance/88457-telegram-predlozhil-investoram-podozhdat-zapuska-ton-do-aprelya-2020-goda-ili-vernut-77-ot-summy-vlozheniy-v-proekt">allait lancer la plateforme de blockchain Ton</a> .  Mais vous auriez pu manquer la nouvelle qu'il n'y a pas si longtemps, Telegram a <a href="https://habr.com/ru/news/t/468755/">annonc√© un concours</a> pour la mise en ≈ìuvre d'un ou plusieurs contrats intelligents pour cette plateforme. </p><br><p>  L'√©quipe Serokell avec une riche exp√©rience dans le d√©veloppement de grands projets de blockchain ne pouvait pas rester √† l'√©cart.  Nous avons d√©l√©gu√© cinq employ√©s au concours, et deux semaines plus tard, ils ont pris la premi√®re place sous le surnom al√©atoire (un) modeste Sexy Chameleon.  Dans cet article, je parlerai de la fa√ßon dont ils ont r√©ussi.  Nous esp√©rons qu'au cours des dix prochaines minutes, vous lirez au moins une histoire int√©ressante et, au maximum, vous y trouverez quelque chose d'utile que vous pourrez appliquer dans votre travail. </p><br><p>  Mais commen√ßons par un petit plongeon dans le contexte. </p><a name="habracut"></a><br><h2 id="konkurs-i-ego-usloviya">  La concurrence et ses conditions </h2><br><p>  Ainsi, les principales t√¢ches des participants √©taient la mise en ≈ìuvre d'un ou plusieurs des contrats intelligents propos√©s, ainsi que la formulation de propositions pour am√©liorer l'√©cosyst√®me TON.  Le concours s'est d√©roul√© du 24 septembre au 15 octobre et les r√©sultats n'ont √©t√© annonc√©s que le 15 novembre.  Pendant longtemps, √©tant donn√© que pendant ce temps, Telegram a r√©ussi √† mener et √† annoncer les r√©sultats de concours sur la conception et le d√©veloppement d'applications en C ++ pour tester et √©valuer la qualit√© des appels VoIP dans Telegram. </p><br><p>  Nous avons s√©lectionn√© deux smart contrats dans la liste propos√©e par les organisateurs.  Pour l'un d'entre eux, nous avons utilis√© des outils distribu√©s avec TON, et le second nous l'avons impl√©ment√© dans un nouveau langage d√©velopp√© par nos ing√©nieurs sp√©cifiquement pour TON et int√©gr√© √† Haskell. </p><br><p>  Le choix d'un langage de programmation fonctionnel n'est pas accidentel.  Dans notre <a href="https://serokell.io/blog">blog d'entreprise,</a> nous expliquons souvent pourquoi nous consid√©rons la complexit√© des langages fonctionnels comme une grande exag√©ration et pourquoi nous pr√©f√©rons g√©n√©ralement qu'ils soient orient√©s objet.  √Ä propos, il contient √©galement l' <a href="https://serokell.io/blog/ton-blockchain-competition">original de cet article</a> . </p><br><h2 id="pochemu-my-voobsche-reshili-uchastvovat">  Pourquoi avons-nous d√©cid√© de participer </h2><br><p>  En bref, parce que notre sp√©cialisation est des projets non standard et complexes qui n√©cessitent des comp√©tences particuli√®res et sont souvent d'une valeur scientifique pour la communaut√© informatique.  Nous soutenons chaleureusement le d√©veloppement open-source et nous sommes engag√©s dans sa vulgarisation, ainsi que coop√©rons avec les principales universit√©s en Russie dans le domaine de l'informatique et des math√©matiques. </p><br><p>  Les t√¢ches int√©ressantes du concours et la participation au projet Telegram, que nous aimions tant, √©taient en elles-m√™mes une excellente motivation, mais le prix √©tait devenu une incitation suppl√©mentaire.  :) </p><br><h2 id="issledovanie-blokcheyna-ton">  TON Blockchain Research </h2><br><p>  Nous suivons de pr√®s les nouveaux d√©veloppements dans la blockchain, l'intelligence artificielle et l'apprentissage automatique et essayons de ne pas manquer une seule version significative dans chacun des domaines dans lesquels nous travaillons.  Par cons√©quent, au d√©but du concours, notre √©quipe connaissait d√©j√† les id√©es du <a href="https://test.ton.org/ton.pdf">livre blanc</a> de <a href="https://test.ton.org/ton.pdf">TON</a> .  Cependant, avant de commencer √† travailler avec TON, nous n'avons pas analys√© la documentation technique et le code source r√©el de la plate-forme, donc la premi√®re √©tape √©tait assez √©vidente - une √©tude approfondie de la documentation officielle sur le <a href="https://test.ton.org/">site</a> et dans <a href="https://github.com/ton-blockchain/ton/tree/master/doc">le r√©f√©rentiel du projet</a> . </p><br><p>  Au d√©but du concours, le code avait d√©j√† √©t√© publi√©, donc pour gagner du temps, nous avons d√©cid√© de chercher un guide ou une compression √©crite par les <em>utilisateurs</em> .  Malheureusement, cela n'a pas donn√© de r√©sultat - √† part les instructions pour construire la plate-forme sur Ubuntu, nous n'avons pas trouv√© d'autres mat√©riaux. </p><br><p>  La documentation elle-m√™me a √©t√© soigneusement d√©velopp√©e, mais il a √©t√© difficile de la lire √† certains moments.  Tr√®s souvent, nous avons d√ª revenir sur certains points et passer des descriptions de haut niveau des id√©es abstraites aux d√©tails de mise en ≈ìuvre de bas niveau. </p><br><p>  Ce serait plus facile si la sp√©cification n'avait pas du tout de description d√©taill√©e de l'impl√©mentation.  Les informations sur la fa√ßon dont la machine virtuelle pr√©sente sa pile sont plus distrayantes pour les d√©veloppeurs qui cr√©ent des contrats intelligents pour la plateforme TON que pour les aider. </p><br><h2 id="nix-sobiraem-proekt">  Nix: construire un projet </h2><br><p>  Chez Serokell, nous sommes de grands fans de <a href="https://nixos.org/nix">Nix</a> .  Nous collectons nos projets pour eux et les <a href="https://nixos.org/nixops">d√©ployons √† l'</a> aide de <a href="https://nixos.org/nixops">NixOps</a> , et <a href="https://nixos.org/">NixOS est</a> install√© sur tous nos serveurs.  Gr√¢ce √† cela, toutes nos versions sont reproductibles et fonctionnent sous n'importe quel syst√®me d'exploitation sur lequel Nix peut √™tre install√©. </p><br><p>  Nous avons donc commenc√© par cr√©er une <a href="">superposition Nix avec une expression pour construire TON</a> .  Son utilisation pour compiler TON est aussi simple que possible: </p><br><pre><code class="plaintext hljs">$ cd ~/.config/nixpkgs/overlays &amp;&amp; git clone https://github.com/serokell/ton.nix $ cd /path/to/ton/repo &amp;&amp; nix-shell [nix-shell]$ cmakeConfigurePhase &amp;&amp; make</code> </pre> <br><p>  Notez que vous n'avez pas besoin d'installer de d√©pendances.  Par magie, Nix fera tout pour vous, que vous utilisiez NixOS, Ubuntu ou macOS. </p><br><h2 id="programmirovanie-dlya-ton">  Programmation pour TON </h2><br><p>  Le code de contrat intelligent TON Network est ex√©cut√© sur la machine virtuelle TON (TVM).  TVM est plus compliqu√© que la plupart des autres machines virtuelles et poss√®de une fonctionnalit√© tr√®s int√©ressante, par exemple, il peut fonctionner avec des <em>continuations</em> et des <em>liens vers des donn√©es</em> . </p><br><p>  De plus, les gars de TON ont cr√©√© trois nouveaux langages de programmation: </p><br><p>  <strong>Fift</strong> est un langage de programmation de pile universel qui rappelle <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BE%25D1%2580%25D1%2582_(%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">Forth</a> .  Sa super capacit√© est la capacit√© d'interagir avec TVM. </p><br><p>  <strong>FunC</strong> est un langage de programmation de contrat intelligent qui est similaire √† <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8_(%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">C</a> et compil√© dans un autre langage - Fift Assembler. </p><br><p>  <strong>Fift Assembler</strong> - Biblioth√®que Fift pour g√©n√©rer du code ex√©cutable binaire pour TVM.  Fift Assembler n'a pas de compilateur.  Il s'agit d'un <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B5%25D0%25B4%25D0%25BC%25D0%25B5%25D1%2582%25D0%25BD%25D0%25BE-%25D0%25BE%25D1%2580%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA">langage embarqu√© sp√©cifique au domaine (eDSL)</a> . </p><br><h2 id="nashi-konkursnye-raboty">  Nos travaux comp√©titifs </h2><br><p>  Enfin, il est temps de regarder les r√©sultats de nos efforts. </p><br><h3 id="asinhronnyy-platezhnyy-kanal">  <strong>Canal de paiement asynchrone</strong> </h3><br><p>  Canal de paiement - un contrat intelligent qui permet √† deux utilisateurs d'envoyer des paiements en dehors de la blockchain.  En cons√©quence, non seulement de l'argent est √©conomis√© (il n'y a pas de commission), mais aussi du temps (vous n'avez pas √† attendre que le prochain bloc soit trait√©).  Les paiements peuvent √™tre arbitrairement petits et se produire aussi souvent que n√©cessaire.  Dans le m√™me temps, les parties n'ont pas besoin de se faire confiance, car l'√©quit√© du r√®glement final est garantie par un contrat intelligent. </p><br><p>  Nous avons trouv√© une solution assez simple au probl√®me.  Deux parties peuvent √©changer des messages sign√©s, chacun contenant deux num√©ros - le montant total pay√© par chacun des participants.  Ces deux nombres fonctionnent comme <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580%25D0%25BD%25D1%258B%25D0%25B5_%25D1%2587%25D0%25B0%25D1%2581%25D1%258B">des horloges vectorielles</a> dans les syst√®mes distribu√©s traditionnels et d√©finissent l'ordre ¬´arriv√© avant¬ª sur les transactions.  En utilisant ces donn√©es, le contrat sera en mesure de r√©soudre tout conflit possible. </p><br><p>  En fait, pour mettre en ≈ìuvre cette id√©e, un nombre suffit, mais nous avons laiss√© les deux, car nous avons pu cr√©er une interface utilisateur plus pratique.  De plus, nous avons d√©cid√© d'inclure un montant de paiement dans chaque message.  Sans cela, si le message est perdu pour une raison quelconque, bien que tous les montants et le calcul final soient corrects, l'utilisateur peut ne pas remarquer la perte. </p><br><p>  Pour tester notre id√©e, nous avons cherch√© des exemples d'utilisation d'un protocole de canal de paiement aussi simple et concis.  √âtonnamment, nous n'en avons trouv√© que deux: </p><br><ol><li>  <a href="https://medium.com/%40matthewdif/ethereum-payment-channel-in-50-lines-of-code-a94fad2704bc">Description d'une</a> approche similaire, uniquement pour le cas d'un canal unidirectionnel. </li><li>  <a href="https://programtheblockchain.com/posts/2018/02/23/writing-a-simple-payment-channel/">Un tutoriel</a> qui d√©crit la m√™me id√©e que la n√¥tre, mais sans expliquer de nombreux d√©tails importants, tels que l'exactitude g√©n√©rale et la proc√©dure de r√©solution des conflits. </li></ol><br><p>  Il est devenu clair qu'il est logique de d√©crire notre protocole en d√©tail, en accordant une attention particuli√®re √† son exactitude.  Apr√®s plusieurs it√©rations, la sp√©cification √©tait pr√™te, et maintenant vous aussi pouvez la regarder. </p><br><p>  Nous avons impl√©ment√© un contrat pour FunC, et nous avons √©crit l'utilitaire de ligne de commande pour interagir avec notre contrat dans Fift, comme recommand√© par les organisateurs.  Nous pouvions choisir n'importe quelle autre langue pour notre CLI, mais c'√©tait int√©ressant pour nous d'essayer Fift pour voir comment elle se montrait en action. </p><br><p>  Honn√™tement, apr√®s avoir travaill√© avec Fift, nous n'avons vu aucune bonne raison de pr√©f√©rer cette langue aux langues populaires et activement utilis√©es avec des outils et des biblioth√®ques d√©velopp√©s.  La programmation dans le langage de pile est plut√¥t d√©sagr√©able, car vous devez constamment garder √† l'esprit ce qui se trouve sur la pile, et le compilateur n'aide pas. </p><br><p>  Par cons√©quent, la seule justification, √† notre avis, de l'existence de Fift est son r√¥le en tant que langue h√¥te du Fift Assembler.  Mais ne serait-il pas pr√©f√©rable d'incorporer l'assembleur TVM dans un langage existant, et de ne pas en proposer un nouveau pour cela, essentiellement le seul but? </p><br><h3 id="tvm-haskell-edsl">  <strong>TVM Haskell eDSL</strong> </h3><br><p>  Il est maintenant temps de parler de notre deuxi√®me contrat intelligent.  Nous avons d√©cid√© de d√©velopper un portefeuille multi-signatures, mais √©crire un autre contrat intelligent sur FunC serait trop ennuyeux.  Nous voulions ajouter un peu de zeste, et c'est devenu notre propre langage d'assemblage pour TVM. </p><br><p>  Comme Fift Assembler, notre nouveau langage est int√©grable, mais au lieu de Fift, nous avons choisi Haskell comme h√¥te, ce qui nous a permis d'utiliser pleinement son syst√®me de type avanc√©.  Lorsque vous travaillez avec des contrats intelligents, o√π le prix d'une petite erreur peut √™tre tr√®s √©lev√©, le typage statique, √† notre avis, est un gros avantage. </p><br><p>  Pour montrer √† quoi ressemble l'assembleur TVM int√©gr√© √† Haskell, nous avons impl√©ment√© un portefeuille standard dessus.  Voici quelques points √† surveiller: </p><br><ul><li>  Ce contrat comprend une fonction, mais vous pouvez en utiliser autant que vous le souhaitez.  Lorsque vous d√©finissez une nouvelle fonction dans le langage h√¥te (c'est-√†-dire dans Haskell), notre eDSL vous permet de choisir si vous souhaitez qu'elle devienne un sous-programme distinct dans TVM ou soit simplement int√©gr√©e au lieu de l'appel. </li><li>  Comme Haskell, les fonctions ont des types qui sont v√©rifi√©s au moment de la compilation.  Dans notre eDSL, le type d'entr√©e de fonction est le type de pile que la fonction attend et le type de r√©sultat est le type de pile qui sera obtenu apr√®s l'appel. </li><li>  Le code a des annotations de type de pile qui d√©crivent le type de pile attendu au niveau du pair de num√©rotation.  Dans le contrat de portefeuille d'origine, il ne s'agissait que de commentaires, mais dans notre eDSL, ils font en fait partie du code et sont v√©rifi√©s au moment de la compilation.  Ils peuvent servir de documentation ou d'instructions qui aident le d√©veloppeur √† trouver le probl√®me si le type de pile change √† mesure que le code change.  Bien entendu, ces annotations n'affectent pas les performances d'ex√©cution, car aucun code TVM n'est g√©n√©r√© pour elles. </li><li>  Il s'agit toujours d'un prototype √©crit en deux semaines, il reste donc beaucoup de travail √† faire sur le projet.  Par exemple, toutes les instances de classe que vous voyez dans le code ci-dessous doivent √™tre g√©n√©r√©es automatiquement. </li></ul><br><p>  Voici √† quoi ressemble l'impl√©mentation du portefeuille multisig sur notre eDSL: </p><br><pre> <code class="haskell hljs"><span class="hljs-title"><span class="hljs-title">main</span></span> :: <span class="hljs-type"><span class="hljs-type">IO</span></span> () main = putText $ pretty $ declProgram procedures methods <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> procedures = [ (<span class="hljs-string"><span class="hljs-string">"recv_external"</span></span>, decl recvExternal) , (<span class="hljs-string"><span class="hljs-string">"recv_internal"</span></span>, decl recvInternal) ] methods = [ (<span class="hljs-string"><span class="hljs-string">"seqno"</span></span>, declMethod getSeqno) ] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Storage</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Storage</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sCnt</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Word32</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sPubKey</span></span></span><span class="hljs-class"> :: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PublicKey</span></span></span><span class="hljs-class"> } instance </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DecodeSlice</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Storage</span></span></span><span class="hljs-class"> where </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DecodeSliceFields</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Storage</span></span></span><span class="hljs-class"> = [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PublicKey</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Word32</span></span></span><span class="hljs-class">] decodeFromSliceImpl = do decodeFromSliceImpl @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Word32</span></span></span><span class="hljs-class"> decodeFromSliceImpl @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PublicKey</span></span></span><span class="hljs-class"> instance </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EncodeBuilder</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Storage</span></span></span><span class="hljs-class"> where encodeToBuilder = do encodeToBuilder @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Word32</span></span></span><span class="hljs-class"> encodeToBuilder @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PublicKey</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WalletError</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SeqNoMismatch</span></span></span><span class="hljs-class"> | </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SignatureMismatch</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">deriving</span></span></span><span class="hljs-class"> (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Eq</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Ord</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Show</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Generic</span></span></span><span class="hljs-class">) instance </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Exception</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WalletError</span></span></span><span class="hljs-class"> instance </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Enum</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">WalletError</span></span></span><span class="hljs-class"> where toEnum 33 = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SeqNoMismatch</span></span></span><span class="hljs-class"> toEnum 34 = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SignatureMismatch</span></span></span><span class="hljs-class"> toEnum _ = error "</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Uknown</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MultiSigError</span></span></span><span class="hljs-class"> id" fromEnum </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SeqNoMismatch</span></span></span><span class="hljs-class"> = 33 fromEnum </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SignatureMismatch</span></span></span><span class="hljs-class"> = 34 recvInternal :: '[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Slice</span></span></span><span class="hljs-class">] :-&gt; '[] recvInternal = drop recvExternal :: '[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Slice</span></span></span><span class="hljs-class">] :-&gt; '[] recvExternal = do decodeFromSlice @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Signature</span></span></span><span class="hljs-class"> dup preloadFromSlice @</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Word32</span></span></span><span class="hljs-class"> stacktype @[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Word32</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Slice</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Signature</span></span></span><span class="hljs-class">] </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">-- cnt cs sign pushRoot decodeFromCell @Storage stacktype @[PublicKey, Word32, Word32, Slice, Signature] -- pk cnt' cnt cs sign xcpu @1 @2 stacktype @[Word32, Word32, PublicKey, Word32, Slice, Signature] -- cnt cnt' pk cnt cs sign equalInt &gt;&gt; throwIfNot SeqNoMismatch push @2 sliceHash stacktype @[Hash Slice, PublicKey, Word32, Slice, Signature] -- hash pk cnt cs sign xc2pu @0 @4 @4 stacktype @[PublicKey, Signature, Hash Slice, Word32, Slice, PublicKey] -- pubk sign hash cnt cs pubk chkSignU stacktype @[Bool, Word32, Slice, PublicKey] -- ? cnt cs pubk throwIfNot SignatureMismatch accept swap decodeFromSlice @Word32 nip dup srefs @Word8 pushInt 0 if IsEq then ignore else do decodeFromSlice @Word8 decodeFromSlice @(Cell MessageObject) stacktype @[Slice, Cell MessageObject, Word8, Word32, PublicKey] xchg @2 sendRawMsg stacktype @[Slice, Word32, PublicKey] endS inc encodeToCell @Storage popRoot getSeqno :: '[] :-&gt; '[Word32] getSeqno = do pushRoot cToS preloadFromSlice @Word32</span></span></span></span></code> </pre> <br><p>  Le code source complet de notre eDSL et le contrat de portefeuille multi-signatures se trouvent dans <a href="https://github.com/serokell/fift-asm-dsl">ce r√©f√©rentiel.</a>  Et plus en <a href="https://serokell.io/blog/parsing-typed-edsl">d√©tail,</a> notre coll√®gue George Agapov a <a href="https://serokell.io/blog/parsing-typed-edsl">parl√©</a> des langues int√©gr√©es. </p><br><h2 id="vyvody-o-konkurse-i-ton">  Conclusions du concours et TON </h2><br><p>  Au total, notre travail a dur√© 380 heures (avec la connaissance de la documentation, des r√©unions et du d√©veloppement lui-m√™me).  Cinq d√©veloppeurs ont particip√© au concours: STO, chef d'√©quipe, sp√©cialistes de la plateforme blockchain et d√©veloppeurs de logiciels Haskell. </p><br><p>  Nous avons trouv√© les ressources pour participer au concours sans difficult√©, car l'esprit du hackathon, le travail d'√©quipe rapproch√©, la n√©cessit√© d'une immersion rapide dans les aspects des nouvelles technologies sont toujours passionnants.  Quelques nuits blanches afin d'obtenir des r√©sultats maximaux dans des conditions de ressources limit√©es sont compens√©es par une exp√©rience inestimable et d'excellents souvenirs.  De plus, le travail sur de telles t√¢ches est toujours un bon test des processus de l'entreprise, car il est extr√™mement difficile d'obtenir des r√©sultats vraiment d√©cents sans une interaction interne parfaitement r√©gl√©e. </p><br><p>  Mis √† part les paroles: nous avons √©t√© impressionn√©s par la quantit√© de travail effectu√©e par l'√©quipe TON.  Ils ont r√©ussi √† construire un syst√®me complexe, beau et, surtout, fonctionnant.  TON s'est av√©r√© √™tre une plateforme √† fort potentiel.  Cependant, pour que cet √©cosyst√®me se d√©veloppe, il reste encore beaucoup √† faire, tant en termes d'utilisation dans les projets de blockchain qu'en termes d'am√©lioration des outils de d√©veloppement.  Nous sommes fiers de faire partie de ce processus maintenant. </p><br><p>  Si apr√®s avoir lu cet article, vous avez encore des questions ou des id√©es sur la fa√ßon d'appliquer TON pour r√©soudre vos probl√®mes, <a href="https://serokell.io/">√©crivez-nous</a> - nous serons heureux de partager notre exp√©rience. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr476756/">https://habr.com/ru/post/fr476756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr476740/index.html">Explorez l'activit√© des cybergroupes de l'√©quipe Donot</a></li>
<li><a href="../fr476742/index.html">Comment nous avons chang√© l'√©tat de ¬´toujours en contact¬ª pour √©viter l'√©puisement professionnel</a></li>
<li><a href="../fr476748/index.html">technologie approximative: QATOK</a></li>
<li><a href="../fr476752/index.html">Comment le futur paysage informatique contribuera √† connecter les consommateurs, les fournisseurs informatiques et T&D ensemble</a></li>
<li><a href="../fr476754/index.html">Comment pousser un compte pour utiliser les services API Yandex Maps vers un voisin, ou pourquoi un g√©ant informatique a-t-il besoin d'un contr√¥le de qualit√©</a></li>
<li><a href="../fr476758/index.html">Comment choisir le bon filament d'impression 3D?</a></li>
<li><a href="../fr476760/index.html">Quelques mots sur les bienfaits de la lecture</a></li>
<li><a href="../fr476770/index.html">"Oriole 2.0" - le train sur lequel vous voyagerez le long du WDC</a></li>
<li><a href="../fr476772/index.html">DeepPavlov pour les d√©veloppeurs: configuration et d√©ploiement # 2</a></li>
<li><a href="../fr476774/index.html">Playme TAU DVR Review: Support magn√©tique, pas cher</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>