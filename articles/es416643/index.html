<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧒🏿 💆🏾 🐆 Implementación de Elasticsearch en AWS con Kubernetes en 10 pasos 👏 🥕 🏴󠁧󠁢󠁳󠁣󠁴󠁿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kubernetes, también conocido como k8s es un sistema de código abierto para automatizar la implementación, el escalado y la administración de aplicacio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implementación de Elasticsearch en AWS con Kubernetes en 10 pasos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/416643/"><p><img src="https://habrastorage.org/webt/rt/no/ud/rtnouda08zlh-unwdbcvqlb8fts.jpeg"></p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kubernetes,</a> también <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conocido</a> como <code>k8s</code> es un sistema de código abierto para automatizar la implementación, el escalado y la administración de aplicaciones en contenedores.  En este artículo, le mostraré cómo configurar un clúster de Kubernetes e implementar un clúster Elasticsearch en AWS en él.  Esta configuración también funciona en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GCE</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Azure</a> . </p><a name="habracut"></a><br><h3 id="konfigurirovanie-kubernetes-na-aws">  Configurar Kubernetes en AWS </h3><br><p>  Para comenzar, obtenga acceso administrativo a los siguientes servicios de AWS: <strong>S3, EC2, Route53, IAM</strong> y <strong>VPC</strong> . </p><br><p>  <strong>1. Instalación:</strong> mostraré la instalación de la CLI para Linux.  Si tiene un sistema operativo diferente, siga los enlaces a continuación para obtener instrucciones de instalación para su sistema operativo. </p><br><p>  Primero, configure la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AWS CLI</a> para acceder a AWS a través de la CLI.  Si ya tiene Python y pip, ejecute el comando: </p><br><pre> <code class="plaintext hljs">pip install awscli --upgrade --user</code> </pre> <br><p>  Luego usamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kops</a> , una herramienta de línea de comandos que nos lleva a través de la configuración del clúster de nivel de producción K8S. <br>  Instale los binarios de <strong>Kops</strong> directamente desde github. </p><br><pre> <code class="plaintext hljs">wget -O kops https://github.com/kubernetes/kops/releases/download/$(curl -s https://api.github.com/repos/kubernetes/kops/releases/latest | grep tag_name | cut -d '"' -f 4)/kops-linux-amd64 chmod +x ./kops sudo mv ./kops /usr/local/bin/</code> </pre> <br><p>  Finalmente, usamos el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">kubectl</a> - CLI para administrar el clúster K8S (si usó docker, esto es similar a la CLI de <strong>docker</strong> ).  La última versión se instala mediante el comando: </p><br><pre> <code class="plaintext hljs">wget -O kubectl https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl chmod +x ./kubectl sudo mv ./kubectl /usr/local/bin/kubectl</code> </pre> <br><p>  <strong>Nota:</strong> puede iniciar el clúster de Kubernetes y seguir las instrucciones de este artículo en una máquina doméstica con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">minikube</a> . </p><br><p>  <strong>2.Cree usuarios de IAM:</strong> para crear clústeres en AWS, crearemos un usuario de IAM separado para <code>kops</code> .  Para <code>kops</code> necesitas una cuenta API.  Cree un usuario y configure una cuenta a través de la interfaz de usuario de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">consola de AWS</a> .  El usuario <code>kops</code> necesitará el siguiente permiso de IAM: </p><br><ul><li>  AmazonEC2FullAccess </li><li>  AmazonRoute53FullAccess </li><li>  AmazonS3FullAccess </li><li>  IAMFullAccess </li><li>  AmazonVPCFullAccess </li></ul><br><p><img src="https://habrastorage.org/webt/93/ll/zh/93llzhkqarlmyjtluwo3xiqpjwa.jpeg"></p><br><p>  Alternativamente, puede hacer lo mismo desde la CLI aplicando los siguientes comandos: </p><br><pre> <code class="plaintext hljs">aws iam create-group --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonEC2FullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonRoute53FullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/IAMFullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonVPCFullAccess --group-name kops aws iam create-user --user-name kops aws iam add-user-to-group --user-name kops --group-name kops aws iam create-access-key --user-name kops</code> </pre> <br><p>  Tenga en cuenta las <code>AccessKeyID</code> <code>SecretAccessKey</code> y <code>AccessKeyID</code> en <code>kops</code> . </p><br><p>  Configure la AWS CLI para usar su cuenta con <code>aws configure</code> . </p><br><p>  Asegúrese de que el usuario que creó esté en la <code>aws iam list-users</code> . </p><br><p>  Exportamos la cuenta de AWS como las siguientes variables de entorno para que la CLI <code>kops</code> pueda usarlas. </p><br><pre> <code class="plaintext hljs">export AWS_ACCESS_KEY_ID=$(aws configure get aws_access_key_id) export AWS_SECRET_ACCESS_KEY=$(aws configure get aws_secret_access_key)</code> </pre> <br><blockquote>  <em>Si está utilizando Kops 1.6.2 o posterior, la configuración de un DNS es opcional.</em>  <em>Puedes crear un grupo de chismes.</em>  <em>El único requisito: el nombre del clúster debe terminar en <code>.k8s.local</code> .</em> </blockquote><br><h3 id="nastroyka-dns">  Configuración de DNS </h3><br><p>  Si ya ha alojado su dominio a través de AWS y planea usarlo, no necesita hacer nada.  Otra opción: si desea utilizar un subdominio de su dominio, cree una segunda zona de alojamiento público para este subdominio.  En este manual, trabajaremos con una zona de alojamiento privada.  Establezca la zona bajo cualquier nombre.  Use este nombre para crear grupos de Kubernetes.  <a href="">Lea más</a> sobre cómo configurar DNS <a href="">aquí</a> . </p><br><p>  <strong>3. Crear un depósito S3:</strong> para guardar el estado y la apariencia de nuestro clúster K8S, debe crear un depósito S3 separado para <code>kops</code> .  Este depósito se convertirá en una fuente de datos confiables para el clúster de configuración. </p><br><pre> <code class="plaintext hljs">aws s3api create-bucket \ --bucket &lt;your-unique-bucket-name&gt; \ --region us-east-1</code> </pre> <br><p>  <strong>Nota:</strong> si pone su cubo en funcionamiento en un área que no sea <code>us-east-1</code> , además de establecer <code>- region</code> cambie al área deseada y agregue <code>LocationConstraint</code> a la misma área.  A continuación se muestra el comando de construcción de depósito en la región <code>us-west-1</code> . </p><br><pre> <code class="plaintext hljs">aws s3api create-bucket \ --bucket &lt;your-unique-bucket-name&gt; \ --region us-west-1 \ --create-bucket-configuration LocationConstraint=us-west-1</code> </pre> <br><p>  Para configurar el almacenamiento para las versiones de cubo S3 para la recuperación, use el siguiente comando: </p><br><pre> <code class="plaintext hljs">aws s3api put-bucket-versioning \ --bucket &lt;your-unique-bucket-name&gt; \ --versioning-configuration Status=Enabled</code> </pre> <br><p>  <strong>4. Creando el primer cluster de Kubernetes: ¡</strong> Entonces, estás listo para crear tu primer cluster!  Primero, configure las variables de entorno para simplificar el proceso.  Si omitió la configuración de DNS (después del paso 2), agregue <code>.k8s.local</code> al valor <code>NAME</code> . </p><br><pre> <code class="plaintext hljs">export NAME=myfirstcluster.example.com export KOPS_STATE_STORE=s3://your-bucket-name</code> </pre> <br><p>  No olvide hacer un seguimiento de qué zonas regionales están disponibles para usted.  En este ejemplo, implementaremos un clúster en la región <strong>us-east-2</strong> . </p><br><pre> <code class="plaintext hljs">aws ec2 describe-availability-zones --region us-east-2</code> </pre> <br><p>  Si está utilizando una zona de alojamiento público, cree un clúster con el siguiente comando: </p><br><pre> <code class="plaintext hljs">kops create cluster \ --zones us-east-2c \ --node-count 3 \ ${NAME}</code> </pre> <br><p>  Si usa una zona de alojamiento privado, haga lo siguiente: </p><br><pre> <code class="plaintext hljs">kops create cluster \ --zones us-east-2c \ --node-count 3 \ --dns private ${NAME}</code> </pre> <br><p>  Este comando le proporcionará el registro de configuración del clúster K8S.  El clúster tarda en iniciarse, ya que crea nuevas máquinas EC2 para los nodos maestros minion. </p><br><pre> <code class="plaintext hljs">[ec2-user@ip-172-31-35-145 test]$ kops create cluster \ &gt; --dns private \ &gt; --zones us-east-2c \ &gt; --node-count 3 \ &gt; ${NAME} --yes I0306 09:45:29.636834 20628 create_cluster.go:439] Inferred --cloud=aws from zone "us-east-2c" I0306 09:45:29.637030 20628 create_cluster.go:971] Using SSH public key: /home/ec2-user/.ssh/id_rsa.pub I0306 09:45:29.850021 20628 subnets.go:184] Assigned CIDR 172.20.32.0/19 to subnet us-east-2c I0306 09:45:31.118837 20628 dns.go:92] Private DNS: skipping DNS validation I0306 09:45:46.986963 20628 executor.go:91] Tasks: 73 done / 73 total; 0 can run I0306 09:45:46.987101 20628 dns.go:153] Pre-creating DNS records I0306 09:45:47.668392 20628 update_cluster.go:248] Exporting kubecfg for cluster kops has set your kubectl context to k8s.appbase Cluster is starting. It should be ready in a few minutes.</code> </pre> <br><p>  Voila!  El clúster K8s ya debería estar funcionando. </p><br><p>  <strong>5. Verificación de clúster:</strong> todas las instancias creadas por <code>kops</code> están en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ASG (Grupos de Auto Scaling)</a> .  En caso de falla, las instancias ASG son verificadas y reconstruidas automáticamente. </p><br><p>  Para cambiar la configuración del clúster, ejecute el siguiente comando: </p><br><pre> <code class="plaintext hljs">kops edit cluster ${NAME}</code> </pre> <br><p>  Cada vez que cambie la configuración del clúster, deberá crear un clúster ejecutando el siguiente comando: </p><br><pre> <code class="plaintext hljs">kops update cluster ${NAME} --yes</code> </pre> <br><p>  Verás algo como esto. </p><br><pre> <code class="plaintext hljs">[ec2-user@ip-172-31-35-145 examples]$ kops update cluster --yes Using cluster from kubectl context: k8s.appbase I0216 05:09:06.074467 2158 dns.go:92] Private DNS: skipping DNS validation I0216 05:09:07.699380 2158 executor.go:91] Tasks: 73 done / 73 total; 0 can run I0216 05:09:07.699486 2158 dns.go:153] Pre-creating DNS records I0216 05:09:07.961703 2158 update_cluster.go:248] Exporting kubecfg for cluster kops has set your kubectl context to k8s.appbase Cluster changes have been applied to the cloud.</code> </pre> <br><p>  Verifica el clúster. </p><br><pre> <code class="plaintext hljs">kops validate cluster</code> </pre> <br><p>  Asegúrese de que el clúster esté en funcionamiento. </p><br><pre> <code class="plaintext hljs">Using cluster from kubectl context: k8s.appbase Validating cluster k8s.appbase INSTANCE GROUPS NAME ROLE MACHINETYPE MIN MAX SUBNETS master-us-east-2c Master t2.large 1 1 us-east-2c nodes Node t2.medium 3 3 us-east-2c NODE STATUS NAME ROLE READY ip-172-20-44-33.us-east-2.compute.internal master True ip-172-20-52-48.us-east-2.compute.internal node True ip-172-20-62-30.us-east-2.compute.internal node True ip-172-20-64-53.us-east-2.compute.internal node True Your cluster k8s.appbase is ready</code> </pre> <br><p>  <strong>¡Mira tus nuevos k8!</strong> </p><br><p>  Con una simple llamada a la API de Kubernetes, puede verificar si la API está en línea y escuchando.  Use <code>kubectl</code> para verificar los nodos. </p><br><pre> <code class="plaintext hljs">kubectl get nodes</code> </pre> <br><p>  Esto le dará información sobre sus nodos y su estado actual. </p><br><pre> <code class="plaintext hljs">[ec2-user@ip-172-31-35-145 elasticsearch]$ kubectl get nodes NAME STATUS ROLES AGE VERSION ip-172-20-44-33.us-east-2.compute.internal Ready master 1m v1.8.6 ip-172-20-52-48.us-east-2.compute.internal Ready node 3m v1.8.6 ip-172-20-62-30.us-east-2.compute.internal Ready node 2m v1.8.6 ip-172-20-64-53.us-east-2.compute.internal Ready node 4m v1.8.6</code> </pre> <br><p>  Un sub Kubernetes es una abstracción que representa un grupo de uno o más contenedores de aplicaciones (como Docker) y varios recursos compartidos para estos contenedores.  Under se despliega en el nodo.  Si necesita escalar la aplicación, agregue nodos al K8S implementado. </p><br><p>  Para conocer los pods disponibles: </p><br><pre> <code class="plaintext hljs">kubectl get pods</code> </pre> <br><p>  Este comando enumerará los hogares disponibles en el clúster. </p><br><pre> <code class="plaintext hljs">[ec2-user@ip-172-31-35-145 ~]$ kubectl get pods NAME READY STATUS RESTARTS AGE es-5967f5d99c-5vcpb 1/1 Running 0 3h es-5967f5d99c-cqk88 1/1 Running 0 3h es-5967f5d99c-lp789 1/1 Running 0 3h</code> </pre> <br><h3 id="razvertyvanie-elasticsearch-v-klastere-k8s">  Implementación de Elasticsearch en el clúster K8S </h3><br><p><img src="https://habrastorage.org/webt/ot/1m/he/ot1mhep0o9nltuo2ueq0puexg7g.png"></p><br><p>  Si no está familiarizado con Kubernetes, le recomiendo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la capacitación en línea de k8s</a> . </p><br><p>  Por el momento, hemos creado en el clúster K8S: el nodo principal y dos nodos de agente.  La función del nodo principal es transferir los comandos de implementación a las aplicaciones que se ejecutan en los pods de los agentes de nodo. </p><br><p>  Las implementaciones de aplicaciones K8S son declarativas y se configuran a través de archivos JSON / YAML.  Elija un controlador basado en el tipo de aplicación o sistema que está implementando.  Como Elasticsearch es una aplicación con estado, utilizaremos el controlador StatefulSet. </p><br><p>  <strong>6. Implementación a través de StatefulSet.</strong>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>StatefulSet</strong></a> gestiona pods según la especificación de contenedores idénticos.  Gestiona el despliegue y la escala del conjunto de hogares y garantiza el orden y la unicidad de estos hogares.  El controlador <strong>StatefulSet</strong> también facilita la asociación de la aplicación con el volumen persistente, lo cual es importante para Elasticsearch. </p><br><p>  Cree un archivo llamado <code>es-stateful set. yaml</code> .  Contendrá la especificación Elasticsearch.  Siéntase libre de cambiar la configuración.  Para obtener una lista de variables de entorno que se pueden pasar a su imagen de Elasticsearch, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">consulte aquí</a> . </p><br><p>  <strong>7. Servicios:</strong> <code>Service</code> Kubernetes: una abstracción que define un conjunto lógico de <code></code> y acceso a ellos.  Esto ayuda a que la aplicación contenedor identifique otra aplicación contenedor o su propia instancia en un hogar diferente. </p><br><p><img src="https://habrastorage.org/webt/di/wn/yq/diwnyqsurqxa0813hatxpfhfgco.png"></p><br><p>  <code>LoadBalancer</code> es un tipo especial de servicio que proporciona pods a redes externas y distribuye la carga.  Lo usaremos para crear una dirección IP externa a través de la cual cualquiera puede contactar al clúster Elasticsearch.  Utilizaremos este servicio para los nodos ES como una forma de descubrirnos. </p><br><p>  Cree un archivo llamado <code>es-svc.yaml</code> .  Edítelo y especifique el servicio de equilibrador de carga. </p><br><pre> <code class="plaintext hljs">apiVersion: v1 #API Version of the resource kind: Service #Type of resource metadata: #Contains metadata of this resource. name: elasticsearch #Name of this resource labels: #Additional identifier to put on pods component: elasticsearch #puts component = elasticsearch spec: #Specifications of this resource type: LoadBalancer #type of service selector: #will distribute load on pods which component: elasticsearch #have label `component = elasticsearch` ports: #Port on which LoadBalancer will listen - name: http #Name given to port port: 9200 #Port number protocol: TCP #Protocol supported - name: transport #Name given to port port: 9300 #Port number protocol: TCP #Protocol supported</code> </pre> <br><p>  <strong>8. Crear una aplicación:</strong> eso es todo lo que necesitamos.  Implemente nuestro clúster Elasticsearch en K8S utilizando los siguientes comandos. </p><br><pre> <code class="plaintext hljs">kubectl create -f es-statefulset.yaml kubectl create -f es-svc.yaml</code> </pre> <br><p>  'Crear' es un comando universal para crear cualquier recurso en K8S. </p><br><p>  Nuestro clúster Elasticsearch de 3 nodos (¿recuerda <code>replicas = 3</code> en la configuración StatefulSet?) Se lanzará instantáneamente. </p><br><p>  Podemos verificar los pods de Elasticsearch con este comando: </p><br><pre> <code class="plaintext hljs">kubectl get pods</code> </pre> <br><pre> <code class="plaintext hljs">[ec2-user@ip-172-31-35-145 test]$ kubectl get pods,svc,deployment NAME READY STATUS RESTARTS AGE es-0 1/1 Running 0 23m es-1 1/1 Running 0 17m es-2 1/1 Running 0 23m</code> </pre> <br><p>  <strong>9. Prueba del clúster Elasticsearch:</strong> verifique si Elasticsearch está configurado correctamente y funciona.  Obtenga la dirección IP externa para conectarse a Elasticsearch.  Se ubicará en el servicio <strong>LoadBalancer que</strong> creamos.  Use el siguiente comando para describir <strong>LoadBalancer</strong> : </p><br><pre> <code class="plaintext hljs">kubectl describe service elasticsearch</code> </pre> <br><pre> <code class="plaintext hljs">[ec2-user@ip-172-31-35-145 examples]$ kubectl describe service elasticsearch Name: elasticsearch Namespace: default Labels: component=elasticsearch Annotations: &lt;none&gt; Selector: component=elasticsearch Type: LoadBalancer IP: 100.70.114.146 LoadBalancer Ingress: http://a4d0c157d212811e898430af47d23da1-952261901.us-east-2.elb.amazonaws.com Port: http 9200/TCP TargetPort: 9200/TCP NodePort: http 31358/TCP Endpoints: 100.96.4.28:9200 Port: transport 9300/TCP TargetPort: 9300/TCP NodePort: transport 31767/TCP Endpoints: 100.96.4.28:9300 Session Affinity: None External Traffic Policy: Cluster Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal EnsuringLoadBalancer 1m service-controller Ensuring load balancer Normal EnsuredLoadBalancer 1m service-controller Ensured load balancer [ec2-user@ip-172-31-35-145 examples]$</code> </pre> <br><p>  Tenga en cuenta el valor de <code>LoadBalancer Ingress</code> .  Abra un navegador con un URI y número de sufijo del puerto externo Elasticsearch: <code>9200</code> .  Verás esto: </p><br><p><img src="https://habrastorage.org/webt/el/b_/zl/elb_zlrvyocf5b7phv5pd9zubri.jpeg"></p><br><p>  Puede verificar la funcionalidad de los nodos <code>9200/_cluster /health?pretty</code> agregando: <code>9200/_cluster /health?pretty</code> a la dirección IP externa. </p><br><p><img src="https://habrastorage.org/webt/hh/ye/aa/hhyeaabyci4yvxnwqjkxacghek4.jpeg"></p><br><p>  <strong>10. Prueba de curación de Kubernetes:</strong> StatefulSets tiene la <strong>capacidad de</strong> almacenar el número especificado de réplicas.  De esa manera, si un sub cae, StatefulSet comenzará un nuevo sub. </p><br><p>  Lo probaremos simulando una falla (eliminando todos los pods en los que se ejecutan nuestras instancias de ES) para ver si nuestro clúster de ES puede realizar copias de seguridad automáticamente con datos intactos. </p><br><p><img src="https://habrastorage.org/webt/l1/vh/nb/l1vhnbrmqhhumqzqi1c7uczvdaa.gif"></p><br><p>  Como StatefulSet ejecuta un hogar a la vez, lleva tiempo restaurar todos los contenedores. </p><br><p>  Vemos que después de la recuperación de los hogares, un registro indexado está disponible para nosotros en el estado anterior a la falla de ES. </p><br><h3 id="rekomenduem-sleduyuschie-shagi">  Próximos pasos recomendados </h3><br><p>  Antes de usar esta configuración en producción, tenga en cuenta: </p><br><ol><li>  Configurar copias de seguridad.  Ayuda a recuperar datos perdidos.  Este proceso se automatiza mejor. </li><li>  Configuración de autorización.  Queremos proteger el clúster Elasticsearch.  Configurar la autenticación o autorización básica basada en un token de medios proporcionará seguridad. </li><li>  Certificados TLS.  Configure LetsEncrypt / otros proveedores TLS de certificados de mapeo de dominios personales para nuestro clúster ES y proteja todas las solicitudes que se le envíen. </li></ol><br><p>  Aunque el artículo no trata sobre eso, sepa: Kubernetes puede hacer todo esto. </p><br><p>  Original: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">despliegue Elasticsearch con Kubernetes en AWS en 10 pasos</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es416643/">https://habr.com/ru/post/es416643/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es416633/index.html">QUIC, TLS 1.3, DNS sobre HTTPS, luego en todas partes</a></li>
<li><a href="../es416635/index.html">De derecha a izquierda. Cómo activar la interfaz del sitio bajo RTL</a></li>
<li><a href="../es416637/index.html">Música de papel y cartón: una breve historia del variófono y el "sonido dibujado"</a></li>
<li><a href="../es416639/index.html">Entrevista con un pionero del rejuvenecimiento.</a></li>
<li><a href="../es416641/index.html">8 etapas del proceso de desarrollo de una interfaz de aplicación móvil</a></li>
<li><a href="../es416645/index.html">MIS Patrones de investigación</a></li>
<li><a href="../es416647/index.html">¿Las agencias gubernamentales sueñan con riesgos eléctricos?</a></li>
<li><a href="../es416651/index.html">1M HTTP rps en 1 núcleo de CPU. DPDK en lugar de nginx + linux kernel TCP / IP</a></li>
<li><a href="../es416653/index.html">Ordenación de la biblioteca</a></li>
<li><a href="../es416657/index.html">Dos tercios de las tarjetas de memoria usadas contienen datos personales de propietarios anteriores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>