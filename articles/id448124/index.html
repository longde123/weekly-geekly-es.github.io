<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçø üëäüèº üçö Mikrotik. Kontrol SMS menggunakan server WEB üó≥Ô∏è üöÉ üßú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hari baik untuk semua! 

 Kali ini saya memutuskan untuk mendeskripsikan situasinya, yang sepertinya tidak dijelaskan secara khusus di Internet, walau...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mikrotik. Kontrol SMS menggunakan server WEB</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448124/"> Hari baik untuk semua! <br><br>  Kali ini saya memutuskan untuk mendeskripsikan situasinya, yang sepertinya tidak dijelaskan secara khusus di Internet, walaupun ada beberapa petunjuk tentang hal itu, tetapi sebagian besar hanya berupa penggalian panjang metodis kode dan wiki Mikrotik itu sendiri. <br><br>  Sebenarnya tugas: untuk mengimplementasikan menggunakan kontrol SMS dari beberapa perangkat, pada contoh menghidupkan dan mematikan port. <br><a name="habracut"></a><br>  Ada: <br><br><ol><li>  Router Kecil CRS317-1G-16S + </li><li>  Titik Akses Mikrotik NETMETAL 5 </li><li>  Modem LTE R11e-LTE </li></ol><br>  Pertama-tama, jalur akses Netmetal 5 yang luar biasa memiliki konektor yang disolder untuk kartu SIM dan port untuk memasang modem LTE.  Karena itu, untuk titik ini, pada kenyataannya, modem terbaik dibeli dari apa yang tersedia dan didukung oleh sistem operasi dari titik itu sendiri, yaitu R11e-LTE.  Intinya dibongkar, semuanya sudah terpasang (walaupun Anda perlu tahu bahwa kartu SIM terletak di bawah modem dan tidak mungkin mendapatkannya tanpa melepas papan utama), jadi periksa kartu SIM untuk beroperasi, jika tidak, Anda harus membongkar titik akses beberapa kali. <br><br>  Kemudian kami mengebor beberapa lubang di case, memasang 2 kuncir dan memperbaiki ujungnya ke modem.  Sayangnya, foto prosesnya tidak tersimpan.  Di sisi lain, antena universal dengan basis magnet melekat pada kuncir. <br><br>  Langkah-langkah konfigurasi utama dijelaskan di Internet dengan cukup baik, kecuali untuk tiang-tiang kecil interaksi.  Sebagai contoh, modem berhenti menerima pesan SMS ketika 5 buah berasal dan mereka menggantung di Kotak Masuk, menghapus pesan, memulai ulang modem tidak selalu menyelesaikan masalah.  Tetapi dalam versi 6.44.1, penerimaan bekerja lebih stabil.  Kotak masuk menampilkan 4 sms terakhir, sisanya dihapus secara otomatis dan kehidupan tidak terganggu. <br><br>  Tujuan utama percobaan adalah untuk memadamkan dan meningkatkan antarmuka pada dua router dalam satu jaringan fisik.  Kesulitan utama adalah bahwa Mikrotik tidak mendukung manajemen melalui SNMP, tetapi hanya memungkinkan nilai pembacaan.  Karena itu, saya harus menggali ke arah lain, yaitu API Mikrotik. <br><br>  Tidak ada dokumentasi yang jelas tentang cara mengelola, jadi saya harus bereksperimen dan instruksi ini dibuat untuk upaya di masa mendatang. <br><br>  Untuk mengelola beberapa perangkat, Anda memerlukan server WEB yang dapat diakses dan berfungsi di jaringan lokal, perlu untuk mengelolanya menggunakan perintah Mikrotik. <br><br>  1. Pada Netmetal 5, Anda masing-masing perlu membuat beberapa skrip untuk menghidupkan dan mematikan <br><br><pre><code class="plaintext hljs">system script add dont-require-permissions=no name=disableiface owner=admin policy=\ ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source=\ "/tool fetch http://WEB_SERVER_IP/di.php " add dont-require-permissions=no name=enableiface owner=admin policy=\ ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source=\ "/tool fetch http://WEB_SERVER_IP/en.php "</code> </pre> <br>  2. Buat 2 skrip di server web (tentu saja, php harus diinstal pada sistem dalam kasus ini): <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment"># file en.php enable interfaces require('/usr/lib/zabbix/alertscripts/routeros_api.class.php'); $API = new RouterosAPI(); $API-&gt;debug=true; if ($API-&gt;connect('IP  Mikrotik', ' ', ' ')) { $API-&gt;comm("/interface/ethernet/enable", array( "numbers"=&gt;"sfp-sfpplus16",)); } $API-&gt;disconnect(); ?&gt;</span></span></code> </pre><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">#file di.php disable interfaces require('/usr/lib/zabbix/alertscripts/routeros_api.class.php'); $API = new RouterosAPI(); $API-&gt;debug=true; if ($API-&gt;connect('IP  Mikrotik', ' ', ' ')) { $API-&gt;comm("/interface/ethernet/disable", array( "numbers"=&gt;"sfp-sfpplus16",)); } $API-&gt;disconnect(); ?&gt;</span></span></code> </pre><br>  3. Unduh dari forum Mikrotik routeros_api.class.php dan letakkan di direktori yang dapat diakses di server. <br><br>  alih-alih sfp-sfpplus16 Anda perlu menentukan nama antarmuka yang terputus / disertakan. <br><br>  Sekarang ketika mengirim pesan ke nomor dalam formulir <br><br><pre> <code class="plaintext hljs">:cmd  script enableiface  :cmd  script disableiface</code> </pre><br>  NETMETAL akan menjalankan skrip yang sesuai, dan pada gilirannya akan menjalankan perintah pada server WEB. <br><br>  Kecepatan operasi ketika menerima fraksi SMS per detik.  Ini bekerja dengan stabil. <br><br>  Selain itu, ada fungsi mengirim SMS ke telepon oleh sistem pemantauan Zabbix dan pembukaan koneksi Internet cadangan saat optiknya jatuh.  Mungkin ini di luar ruang lingkup artikel ini, tetapi saya akan segera mengatakan bahwa ketika mengirim SMS panjangnya harus sesuai dengan ukuran standar satu pesan, karena  Mikrotik tidak membaginya menjadi beberapa bagian, dan ketika sebuah pesan panjang tiba, itu tidak akan mengirimnya, selain itu, Anda perlu memfilter karakter yang dikirim ke pesan, jika tidak SMS tidak akan dikirim. <br><br>  PS Saya sekarang melengkapi tentang tiang tembok pada versi RouterOS sebelumnya yang dan bagaimana menghadapinya. <br>  1. Panjang maksimum pesan dan karakter yang digunakan dalam pesan terbatas, jadi saya harus bertarung di tingkat Zabbix, yaitu, untuk memperbaiki templat pengiriman pesan, sehingga secara singkat, jelas tentang pesan itu. <br>  Pengaturan - Tindakan - Laporkan ke sms - Operasi - Subjek: Masalah: {HOST.NAME} {TRIGGER.NAME} <br>  Dan saat pemulihan Laporkan ke sms - Operasi pemulihan Subjek: Diselesaikan: {HOST.NAME} {TRIGGER.NAME} <br><br>  2. Selain itu, skrip itu sendiri, yang mengirim data ke modem, juga memotong panjang maksimum pesan yang dikirim, karena  jika terlalu panjang, maka pesan tidak akan dikirim. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash strz=$1 $2 $3 php /usr/lib/zabbix/alertscripts/ro.php "8926" "${strz:0:150}" echo ${strz:0:150}\" &gt;&gt; /var/log/sendsms.history</span></span></code> </pre><br><br>  Script php mengirim data <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-string"><span class="hljs-string">'/usr/lib/zabbix/alertscripts/routeros_api.class.php'</span></span>); $API = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RouterosAPI(); $API-&gt;debug=<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($API-&gt;connect(<span class="hljs-string"><span class="hljs-string">'IP '</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>)) { $API-&gt;comm(<span class="hljs-string"><span class="hljs-string">"/tool/sms/send"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">"port"</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">"lte1"</span></span>, <span class="hljs-string"><span class="hljs-string">"phone-number"</span></span>=&gt;$argv[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-string"><span class="hljs-string">"message"</span></span>=&gt;$argv[<span class="hljs-number"><span class="hljs-number">2</span></span>],)); } $API-&gt;disconnect(); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $argv[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $argv[<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  3. Membersihkan Kotak Masuk untuk RouterOS &lt;6.44 <br>  Penjadwal sistem <br> <code>/system scheduler <br> add disabled=yes interval=1m name=removeSMS on-event="/system script run 7" \ <br> policy=ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon \ <br> start-date=nov/01/2018 start-time=19:32:00 <br></code> <br><br>  Jika skrip di bawah ini Anda akan memiliki nomor seri yang berbeda, maka dalam penjadwal, Anda harus mengubah run 7 ke nomor yang sesuai <br><br>  Skrip sistem <br> <code>/system script <br> add dont-require-permissions=no name=removeSMS owner=admin policy=\ <br> ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source="/\ <br> tool sms inbox remove 0\r\ <br> \n/delay 1\r\ <br> \n/tool sms inbox remove 0\r\ <br> \n/delay 1\r\ <br> \n/tool sms inbox remove 0\r\ <br> \n/delay 1\r\ <br> \n/tool sms inbox remove 0\r\ <br> \n/delay 1\r\ <br> \n/tool sms inbox remove 0\r\ <br> \n/delay 1\r\ <br> \n/tool sms inbox remove 0\r\ <br> \n/delay 1\r\ <br> \n/tool sms inbox remove 0\r\ <br> \n/delay 1\r\ <br> \n/tool sms inbox remove 0\r\ <br> \n/delay 1\r\ <br> \n" <br></code> <br>  Script dengan nomor seri 7 <br><br>  4. Pada versi di bawah 6.38, ini membantu reboot modem juga dengan skrip bawaan dan penjadwal <br> <code>/system script <br> add dont-require-permissions=no name=rebootLTE owner=admin policy=\ <br> ftp,reboot,read,write,policy,test,password,sniff,sensitive,romon source="/\ <br> interface lte disable 0\r\ <br> \ndelay 10\r\ <br> \n/interface lte enable 0\r\ <br> \n/tool sms set receive-enabled=false\r\ <br> \ndelay 10\r\ <br> \n/tool sms set receive-enabled=true\r\ <br> \n" <br></code> <br><br>  5. Dan sedikit tentang penambahan tim.  Untuk mengirim SMS, diperbolehkan mengatakan pada host dengan Zabbix untuk membuat file RSC, dan kemudian mengirimnya ke ftp di Mikrotik dengan skrip, lalu di modem itu sendiri, dengan skrip di penjadwal, jalankan file yang diperlukan, perintah dijalankan, tetapi bagi saya lebih nyaman menggunakan mekanisme di atas. <br>  Dalam hal pengiriman seperti itu, kode yang dihasilkan cukup sederhana. <br> <code>/tool sms send lte1 +7926xxxxxxx message "Problem: High ICMP ping response time Problem started at 17:08:04 on 2018.07.10 Problem name: High ICMP ping response time Host: Netgear7212 Severity: Warning Original problem ID: 5403803" <br></code> <br>  Dalam contoh ini, karakter tambahan sudah dihapus, dan panjangnya tidak terbatas.  Script yang memproses peluncuran sesuai dengan metode ini setelah bekerja harus menyalin file RSC kosong di dalam file Mikrotik yang ada. <br>  Saya tidak suka metode ini, karena pada prinsipnya tidak ada perlindungan terhadap gangguan dan pesan yang tidak terkirim yang tidak mungkin adalah mungkin. <br><br>  Dalam versi RouterOS 6.44.1, masalah limpahan yang masuk telah dihilangkan, sehingga Anda tidak dapat menggunakan metode pembersihan pertanian kolektif </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id448124/">https://habr.com/ru/post/id448124/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id448114/index.html">8. Titik Periksa Memulai R80.20. NAT</a></li>
<li><a href="../id448116/index.html">Intel Optane Memory H10 Hybrid Drive - Spesifikasi Fitur</a></li>
<li><a href="../id448118/index.html">SEO dan iklan kontekstual - mengarah untuk 175 ribu rubel sehari di Izhevsk</a></li>
<li><a href="../id448120/index.html">Tentang kedekatan puncak</a></li>
<li><a href="../id448122/index.html">Bagaimana ReactJS Bekerja Paket Bereaksi</a></li>
<li><a href="../id448126/index.html">Rahasia API perangkat Android. Laporan Yandex</a></li>
<li><a href="../id448128/index.html">9 tips untuk menggunakan perpustakaan Kucing di Scala</a></li>
<li><a href="../id448130/index.html">Desain deckbuilding video game</a></li>
<li><a href="../id448136/index.html">Instruksi: cara menguji peran yang dimungkinkan dan mencari tahu tentang masalah sebelum produksi</a></li>
<li><a href="../id448140/index.html">SNA Hackathon 2019 - hasil</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>