<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👩‍👧‍👦 👆🏿 🐖 Wie ich mein Online-Spiel erstellt habe. Teil 1: Vernetzung ✊ 🎏 🎾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo an alle! Ich hatte vor kurzem Urlaub und es war Zeit, meine Heimprojekte ruhig zu programmieren. Ich wollte deshalb mein einfaches Online-Spiel ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie ich mein Online-Spiel erstellt habe. Teil 1: Vernetzung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435384/"><img src="https://habrastorage.org/webt/xt/sd/nh/xtsdnhuveu_gvoczdjrneieyzlg.jpeg"><br><br>  Hallo an alle!  Ich hatte vor kurzem Urlaub und es war Zeit, meine Heimprojekte ruhig zu programmieren.  Ich wollte deshalb mein einfaches Online-Spiel auf Rust machen.  Genauer gesagt, ein einfacher 2D-Shooter.  Ich habe mich entschlossen, das Netzwerk zuerst zu teilen, und dort wird bereits gesehen, was und wie.  Da das Genre Aktionen in allen Bereichen umfasst, habe ich mich für das UDP-Protokoll entschieden.  Er begann die Architektur des Netzwerkteils zu entwerfen.  Mir wurde klar, dass Sie alles in einer separaten Bibliothek ablegen können.  Ich habe die resultierende Bibliothek auch unter der MIT-Lizenz auf crates.io hochgeladen, weil: a) es für mich dann bequemer ist, sie von dort aus mit meinen Projekten zu verbinden.  b) Vielleicht ist es für jemand anderen nützlich und bringt Vorteile.  Für Details willkommen bei Katze. <a name="habracut"></a><br><br><h2>  Referenzen </h2><br>  -&gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quellen</a> <br>  -&gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bibliothek bei crates.io</a> <br>  -&gt; <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> <br><br><h2>  Anwendungsbeispiel </h2><br><h3>  Kunde </h3><br><pre><code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">//   use victorem; fn main() -&gt; Result&lt;(), victorem::Exception&gt; { // ,    11111      127.0.0.1:22222 let mut socket = victorem::ClientSocket::new("11111", "127.0.0.1:22222")?; loop { //    socket.send(b"Client!".to_vec()); //    .             socket.recv().map(|v| String::from_utf8(v).map(|s| println!("{}",s))); } }</span></span></code> </pre> <br><h3>  Server </h3><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">//   use victorem; use std::time::Duration; use std::net::SocketAddr; //,  .            . struct ClientServerGame; //     Game,         impl victorem::Game for ClientServerGame { //,     .       false,   . fn handle_command(&amp;mut self, delta_time: Duration, commands: Vec&lt;Vec&lt;u8&gt;&gt;, from: SocketAddr) -&gt; bool { for command in commands { String::from_utf8(command).map(|s| println!("{}",s)); } true } //     30 .     ,     .      ,     . fn draw(&amp;mut self, delta_time: Duration) -&gt; Vec&lt;u8&gt; { b"Server!".to_vec() } } fn main() -&gt; Result&lt;(), victorem::Exception&gt; { // ,      ClientServerGame     22222 let mut server = victorem::GameServer::new(ClientServerGame, "22222")?; //       . server.run(); Ok(()) }</span></span></code> </pre><br><h2>  Internes Gerät </h2><br>  Wenn ich für den Netzwerkteil von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Laminar unformatierte</a> UDP-Sockets anstelle von unformatierten UDP-Sockets verwendet habe, könnte der Code im Allgemeinen um den Faktor 100 reduziert werden, und ich verwende den in dieser Artikelserie - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Netzwerkprogrammierung für Spieleentwickler</a> - beschriebenen Algorithmus. <br>  Die Architektur des Servers umfasst das Empfangen von Befehlen von Clients (z. B. Drücken einer Maustaste oder einer Taste auf der Tastatur) und das Senden eines Status (z. B. die aktuelle Position der Einheiten und die Blickrichtung), mit dem der Client dem Player ein Bild anzeigen kann. <br><br><h3>  Auf dem Server </h3><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">//         u32     ,  0 -  , 1 -   ,      . pub fn get_lost(&amp;self) -&gt; (u32, u32) { let mut sequence: u32 = 0; let mut x = 0; let mut y = self.last_received_packet_id; while x &lt; 32 &amp;&amp; y &gt; 1 { y -= 1; if !self.received.contains(&amp;y) { let mask = 1u32 &lt;&lt; x; sequence |= mask; } x += 1; } (sequence, self.last_received_packet_id) }</span></span></code> </pre> <br><h3>  Auf dem Client </h3><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">//      (max_id)         (sequence)  .           fn get_lost(&amp;mut self, max_id: u32, sequence: u32) -&gt; Vec&lt;CommandPacket&gt; { let mut x = max_id; let mut y = 0; let mut ids = Vec::&lt;u32&gt;::new(); //      , ,     ,      . let max_cached = self.cache.get_max_id(); if max_cached != max_id { ids.push(max_cached); } while x &gt; 0 &amp;&amp; y &lt; 32 { x -= 1; let mask = 1u32 &lt;&lt; y; y += 1; let res = sequence &amp; mask; if res &gt; 0 { ids.push(x); } } self.cache.get_range(&amp;ids) }</span></span></code> </pre> <br><h2>  Nachwort </h2><br>  Tatsächlich war es einfacher, einen Befehlsübermittlungsalgorithmus zu erstellen.  Akzeptieren Sie auf dem Server nur das Paket, mit dem mehr als das zuletzt von +1 empfangene Paket erreicht wird, und verwerfen Sie den Rest.  Senden Sie dem Client das zuletzt empfangene Paket.  Bewahren Sie auf dem Client einen Cache aller Befehle auf, die der Benutzer an den Server senden wollte.  Jedes Mal, wenn ein neuer Status vom Server mit der ID eingeht, das letzte vom Server empfangene Paket, löschen Sie es aus dem Cache und alle Pakete mit einer ID, die kleiner als diese ist.  Alle verbleibenden Pakete werden erneut an den Server gesendet. <br>  Wenn ich das Spiel selbst mache, werde ich im Verlauf des Gebrauchs die Bibliothek weiter verbessern und optimieren.  Vielleicht finde ich noch mehr Fehler. <br><br>  Ich habe hier ein Game-Server-Projekt in C # - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Networker</a> + auf Rust gefunden. Es gibt ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Blatt,</a> ähnlich einem Analogon eines Game-Servers auf Go-Leaf.  Nur die Entwicklung ist im Gange. <br><br>  PS Lieber Freund, wenn Sie ein Anfänger sind und beschlossen haben, meinen Code für dieses Projekt zu lesen und die Tests zu sehen, die ich dort geschrieben habe.  Hier ist mein Rat an Sie - tun Sie nicht so wie ich.  Ich habe in Tests alles auf einem Haufen gemischt und bin nicht der „AAA“ -Vorlage gefolgt (google was es ist).  Sie müssen dies nicht in der Produktion tun.  Ein normaler Test sollte eine Sache überprüfen, nicht mehrere Bedingungen gleichzeitig, und sollte aus den folgenden Schritten bestehen: <br><br><ol><li>  Sie setzen Ihre Variablen; </li><li>  Sie führen die Aktion aus, die Sie testen möchten. </li><li>  Sie vergleichen das Ergebnis mit dem erwarteten. </li></ol><br>  Zum Beispiel <br><br><pre> <code class="rust hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_one</span></span></span></span>(x:<span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span> { x+<span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-meta"><span class="hljs-meta">#[test]</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_one_fn_should_add_one_to_it_argument</span></span></span></span>(){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> x = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> expected = x+<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">///////////////////////// let result = add_one(x); ////////////////////////////////// assert_eq!(expected,result); }</span></span></code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de435384/">https://habr.com/ru/post/de435384/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de435368/index.html">Pathologische Anatomie am Arbeitsplatz</a></li>
<li><a href="../de435372/index.html">Ein paar Worte zu FastPath und FastTrack bei MikroTik</a></li>
<li><a href="../de435374/index.html">Mathe in Gamedev ist einfach. Triangulation und Triangle.Net in Unity</a></li>
<li><a href="../de435376/index.html">Weltraum 2019: bemannte Schiffe, neue Raketen und Mondsonden</a></li>
<li><a href="../de435380/index.html">Kostenlose Konten auf GitHub können [fast] ohne Einschränkungen mit privaten Repositories arbeiten</a></li>
<li><a href="../de435386/index.html">So teilen Sie Architektur und Implementierung ohne Streit</a></li>
<li><a href="../de435390/index.html">3D-Engine in SQL-Abfrage</a></li>
<li><a href="../de435394/index.html">Körperliche Ergebnisse des Jahres</a></li>
<li><a href="../de435398/index.html">Metaspiele: Meine Erfahrung bei der Erstellung von Wettbewerben für Vertriebsleiter</a></li>
<li><a href="../de435400/index.html">1 Million US-Dollar Belohnung für WhatsApp- und iMessage-Hack-Informationen angekündigt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>