<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘ğŸ¼ ğŸšš ğŸ‘¨â€âœˆï¸ å¦‚ä½•åœ¨VDSçš„Go for Gitlabä¸Šè®¾ç½®Webåº”ç”¨ç¨‹åºéƒ¨ç½² ğŸ˜™ ğŸ“ ğŸ¹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å‰è¨€ 
 æœ¬æ–‡æ˜¯ä¸ºæœŸä¸€å‘¨çš„æœç´¢ç»“æœçš„ç»“æœï¼Œè¿™äº›ä¿¡æ¯éå¸¸åˆ†æ•£ï¼Œæœ‰å…³å¦‚ä½•åœ¨Goä¸Šé…ç½®WebæœåŠ¡éƒ¨ç½²ã€‚ ä¸æ˜¯åœ¨Herokuï¼Œä¸æ˜¯åœ¨Dockerï¼Œä¸æ˜¯åœ¨Digital Oceanï¼Œè€Œæ˜¯åœ¨å¸¦æœ‰CentOS 7x64çš„è€å¼VDSä¸Šã€‚ ç”±äºæŸç§åŸå› ï¼Œç½‘ç»œæ²¡æœ‰æ­¤ä¿¡æ¯ï¼Œå› æ­¤å¤§å¤šæ•°æ•™ç¨‹éƒ½ä»å¦‚ä½•è®¾ç½®æ„å»ºå¼€å§‹ï¼Œåˆ°æµ‹è¯•å¯åŠ¨ç»“...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å¦‚ä½•åœ¨VDSçš„Go for Gitlabä¸Šè®¾ç½®Webåº”ç”¨ç¨‹åºéƒ¨ç½²</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421087/"><img src="https://habrastorage.org/webt/zh/lr/-6/zhlr-6qj-lfoigcrtfp4b0_nbwi.jpeg"><br><h2> å‰è¨€ </h2><br> æœ¬æ–‡æ˜¯ä¸ºæœŸä¸€å‘¨çš„æœç´¢ç»“æœçš„ç»“æœï¼Œè¿™äº›ä¿¡æ¯éå¸¸åˆ†æ•£ï¼Œæœ‰å…³å¦‚ä½•åœ¨Goä¸Šé…ç½®WebæœåŠ¡éƒ¨ç½²ã€‚ ä¸æ˜¯åœ¨Herokuï¼Œä¸æ˜¯åœ¨Dockerï¼Œä¸æ˜¯åœ¨Digital Oceanï¼Œè€Œæ˜¯åœ¨å¸¦æœ‰CentOS 7x64çš„è€å¼VDSä¸Šã€‚ ç”±äºæŸç§åŸå› ï¼Œç½‘ç»œæ²¡æœ‰æ­¤ä¿¡æ¯ï¼Œå› æ­¤å¤§å¤šæ•°æ•™ç¨‹éƒ½ä»å¦‚ä½•è®¾ç½®æ„å»ºå¼€å§‹ï¼Œåˆ°æµ‹è¯•å¯åŠ¨ç»“æŸã€‚ <br><br> æˆ‘ä¼šç«‹å³è­¦å‘Šæ‚¨ï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡è®¾ç½®CI / CDæµç¨‹ï¼Œå› æ­¤æœ¬æ–‡æ˜¯ä»åˆå­¦è€…åˆ°åˆå­¦è€…çš„ã€‚ <br><a name="habracut"></a><br> å½“ç„¶ï¼Œè¿™é‡Œå¯ä»¥çº æ­£å¾ˆå¤šé—®é¢˜ï¼Œå› æ­¤æˆ‘ä¼šä¹äºæ¥å—è¯„è®ºä¸­çš„ä»»ä½•è¯„è®ºï¼Œå¹¶å°è¯•å°½å¿«æ›´æ–°æ›´æ”¹ã€‚ è¿™æ ·çš„æ–‡ç« ä¹Ÿå¯èƒ½å·²ç»å­˜åœ¨ï¼Œè€Œæˆ‘åªæ˜¯å¯æ€•åœ°ä½¿ç”¨æœç´¢å¼•æ“ã€‚ ç„¶åï¼Œè¯·æä¾›ä¸€ä¸ªé“¾æ¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å°†åˆ é™¤è¯¥æ–‡ç« ï¼Œç„¶åå°†ç°çƒ¬æ´’åœ¨æˆ‘çš„å¤´ä¸Šã€‚ <br><br><h4> æºæ•°æ® </h4><br><ul><li>  VDSæœåŠ¡å™¨ </li><li> ä½œä¸šç³»ç»Ÿï¼šCentOS 7x64 </li><li> è½¬åˆ°å…·æœ‰ä»¥ä¸‹ç»“æ„çš„é¡¹ç›®ï¼š </li></ul><br><pre><code class="bash hljs">src/ public/ index.html main.go</code> </pre> <br><h4> æœåŠ¡å™¨è®¾ç½®ï¼šåˆ›å»ºæœåŠ¡ </h4><br> é¦–å…ˆï¼Œä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåˆ›å»ºæœåŠ¡ã€‚ åœ¨CentOS 7ä¸­ï¼Œè¿™éå¸¸ç®€å•ã€‚ æ‚¨éœ€è¦åœ¨åä¸ºserviceName.serviceçš„æ–‡ä»¶ä¸­ç¼–å†™è¿™æ ·çš„è„šæœ¬ï¼š <br><br><pre> <code class="bash hljs">[Unit] <span class="hljs-comment"><span class="hljs-comment">#   Description=Service Description After=network.target [Service] Type=simple #  ,       User=username #    ExecStart=/username/service/binaryFile Restart=on-abort [Install] WantedBy=multi-user.target</span></span></code> </pre> <br> è„šæœ¬æœ¬èº«å¿…é¡»æ”¾åœ¨æ–‡ä»¶å¤¹etc / systemd / system / <br><br><h4>  SSHè®¾ç½® </h4><br> åœ¨æœåŠ¡å™¨ä¸Šï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š <br><br><pre> <code class="bash hljs">ssh-keygen -f /etc/ssh/hmp.key</code> </pre> <br> æ ¹æ®è¦æ±‚ <blockquote> è¾“å…¥å¯†ç ï¼ˆæ— å¯†ç æ—¶ä¸ºç©ºï¼‰ </blockquote> ä¸è¦è¾“å…¥å¯†ç ï¼Œåªéœ€æŒ‰Enterã€‚ <br><br> åœ¨/ etc / ssh /æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼š <br><br><ol><li>  hmp.key-ç§é’¥ </li><li>  hmp.key.pub-å…¬é’¥ </li></ol><br> æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç§é’¥ã€‚ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å…¶å†…å®¹ï¼š <br><br><pre> <code class="bash hljs">cat /etc/ssh/hmp.key</code> </pre> <br> å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><pre> <code class="bash hljs">-----BEGIN RSA PRIVATE KEY----- {    } -----END RSA PRIVATE KEY-----</code> </pre> <br> å…¨éƒ¨å…¨éƒ¨å¤åˆ¶åˆ°å‰ªè´´æ¿ <br><br>  <b>æ³¨æ„ï¼</b>  -ä¸ä»…å¯†é’¥æœ¬èº«ï¼Œè€Œä¸” <br>  -----å¼€å§‹RSAç§é’¥-----å’Œ-----ç»“æŸRSAç§é’¥----- <br><br><h3>  Gitlabè®¾ç½® </h3><br> é¦–å…ˆï¼Œå¡«å†™å¯¹ä»“åº“é‡è¦çš„æ•°æ®ï¼ˆç”¨æˆ·åï¼Œå¯†ç ç­‰ï¼‰ã€‚ <br> å³ä½¿æ‚¨çš„å­˜å‚¨åº“æ˜¯å…¬å…±çš„ï¼Œå®ƒä»¬ä¹Ÿå°†ä¿æŒå…³é—­çŠ¶æ€ã€‚ <br><br> åœ¨å­˜å‚¨åº“ä¸­çš„Gitlabä¸­ï¼Œè½¬åˆ°è®¾ç½®-&gt; CI / CD-&gt;å˜é‡ã€‚ æˆ‘ä»¬åœ¨æ­¤å¤„åˆ›å»ºä»¥ä¸‹å˜é‡ï¼š <br><br><ul><li>  SSH_PRIVATE_KEY-å°†åœ¨ä¸Šä¸€æ®µä¸­å¤åˆ¶çš„å€¼ç²˜è´´åˆ°æ­¤å¤„ </li><li>  USER_PASS-ä»ä¸­å¯åŠ¨åº”ç”¨ç¨‹åºçš„ç”¨æˆ·å¯†ç  </li><li>  USER-ä»ä¸­å¯åŠ¨åº”ç”¨ç¨‹åºçš„ç”¨æˆ·å </li><li> ä¸»æœº-æ‚¨çš„VDSåœ°å€ </li><li>  TARGET_DIR_ON_HOST-åœ¨æˆ‘çš„ç¤ºä¾‹ä¸­ï¼Œæ‚¨çš„æœåŠ¡å°†ä½äºçš„ç›®æ ‡æ–‡ä»¶å¤¹æ˜¯/ç”¨æˆ·å/æœåŠ¡/ </li><li>  SERVICE_NAME-æœåŠ¡åç§° </li><li>  GROUP_NAMEæ˜¯æ‚¨çš„Gitlabç”¨æˆ·å </li><li>  REPOSITORY_NAME-æ‚¨çš„å­˜å‚¨åº“åç§° </li></ul><br> å°†.gitlab-ci.ymlæ–‡ä»¶æ·»åŠ åˆ°å…·æœ‰ä»¥ä¸‹å†…å®¹çš„å­˜å‚¨åº“ä¸­ï¼š <br><br><pre> <code class="bash hljs">image: golang:latest before_script: <span class="hljs-comment"><span class="hljs-comment">#     sshpass - apt-get update -qq &amp;&amp; apt-get install -y -qq sshpass #  ,    .   govendor,      - go get github.com/gorilla/mux - go get github.com/gorilla/websocket #  SSH - 'which ssh-agent || ( apt-get update -y &amp;&amp; apt-get install openssh-client -y )' - eval $(ssh-agent -s) - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add - &gt; /dev/null - mkdir -p ~/.ssh - chmod 700 ~/.ssh - echo -e "Host *\n\tStrictHostKeyChecking no\n\n" &gt; ~/.ssh/config #     - mkdir -p /go/src/gitlab.com/$GROUP_NAME #     - git clone git@gitlab.com:$GROUP_NAME/$REPOSITORY_NAME.git /go/src/gitlab.com/$GROUP_NAME/$REPOSITORY_NAME #      - mkdir -p $CI_PROJECT_DIR/build/ #        (, HTML- ..)  . #       src/public - cp -r $CI_PROJECT_DIR/src/public $CI_PROJECT_DIR/build stages: - build - deploy compile: stage: build script: #     Go  - cd /go/src/gitlab.com/$GROUP_NAME/$REPOSITORY_NAME/src #    . ,        build       main - go build -race -ldflags "-extldflags '-static'" -o $CI_PROJECT_DIR/build/main artifacts: paths: - $CI_PROJECT_DIR/build/main deploy: stage: deploy script: #      ()      public - cd $CI_PROJECT_DIR/build #   sshpass      VDS - sshpass -V - export SSHPASS=$USER_PASS #   - sshpass -e ssh -o stricthostkeychecking=no $USER@$HOST systemctl stop $SERVICE_NAME #    - sshpass -e scp -o stricthostkeychecking=no -r . $USER@$HOST:$TARGET_DIR_ON_HOST #   - sshpass -e ssh -o stricthostkeychecking=no $USER@$HOST systemctl restart $SERVICE_NAME</span></span></code> </pre><br> è°ƒæ•´åï¼Œæˆ‘ä»¬å°†æ­¤è„šæœ¬æ¨é€åˆ°å­˜å‚¨åº“ä¸­ï¼Œå¹¶å·²å‡†å¤‡å¥½ç»„è£…å¹¶éƒ¨ç½²ã€‚ ä»…æ­¤è€Œå·²ï¼ <br><br> å¸Œæœ›æœ¬æ–‡å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ã€‚ å¯¹äºä»»ä½•é—®é¢˜å’Œè¯„è®ºï¼Œæˆ‘å°†å¾ˆä¹æ„åœ¨è¯„è®ºä¸­å›ç­”ï¼ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN421087/">https://habr.com/ru/post/zh-CN421087/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN421077/index.html">åœ¨å…‹éº¦ç½—æ²ƒï¼Œæ¯å¹´å››å­£æ¢å­£</a></li>
<li><a href="../zh-CN421079/index.html">å‘ç°äº†ä¸€ç§ç”¨äºåˆ†ç±»å¤æ‚ä¿¡æ¯çš„é€šç”¨æ–¹æ³•</a></li>
<li><a href="../zh-CN421081/index.html">å¾ˆå°‘æœ‰äººå…³æ³¨è¿™ç§ç»æµè¶‹åŠ¿ã€‚</a></li>
<li><a href="../zh-CN421083/index.html">è£…é¥°æ˜¾å¡åŒ…è£…çš„è¢«é—å¿˜çš„è‰ºæœ¯</a></li>
<li><a href="../zh-CN421085/index.html">é©¬æ–¯å…‹ä¸æ˜¯æœªæ¥</a></li>
<li><a href="../zh-CN421089/index.html">ä¿„ç½—æ–¯ä¾›åº”å•†å·²ç»å¼„æ¸…æ¥šäº†å¦‚ä½•å°†â€œæ˜¥å­£é…å¥—â€çš„éƒ¨åˆ†è´¹ç”¨è½¬ç§»ç»™Google</a></li>
<li><a href="../zh-CN421091/index.html">æˆ‘ä»¬å¦‚ä½•é€šè¿‡åˆ‡æ¢åˆ°Pythonæ¥å‡å°‘äº”æ¬¡å¼€å‘è¯„åˆ†æ¨¡å‹çš„æ—¶é—´</a></li>
<li><a href="../zh-CN421093/index.html">æˆ‘å¦‚ä½•å­¦ä¹ Springæ¡†æ¶-ç¬¬2éƒ¨åˆ†ï¼ˆå¯¹åˆå­¦è€…çš„å¸®åŠ©-åˆå­¦è€…è‡ªå·±çš„å·¥ä½œï¼‰</a></li>
<li><a href="../zh-CN421095/index.html">æ ¹æ®æ–°çš„å…³äºé˜»æ­¢é¢„å®¡çš„æ³•æ¡ˆï¼Œå¯èƒ½ä¼šå‡å°‘1900ä¸‡ä¸ªç½‘ç«™</a></li>
<li><a href="../zh-CN421097/index.html">UIViewControllersçš„ç»„æˆä»¥åŠå®ƒä»¬ä¹‹é—´çš„å¯¼èˆªï¼ˆä¸ä»…å¦‚æ­¤ï¼‰</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>