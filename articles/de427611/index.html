<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÄ üìí üîª Die Geschichte, wie ich Yandex MapKit auf iOS oder Karten aktualisiert habe, Geld, 2 Mappits üì± ü•Ö üóæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vorwort 

 Hallo Freunde , am Anfang werde ich sofort den Zweck des Artikels skizzieren: Sparen Sie Zeit, wenn Sie Yandex-Karten aktualisieren oder in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Die Geschichte, wie ich Yandex MapKit auf iOS oder Karten aktualisiert habe, Geld, 2 Mappits</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427611/"><h3>  Vorwort </h3><br><br>  <b>Hallo Freunde</b> , am Anfang werde ich sofort den Zweck des Artikels skizzieren: <b>Sparen Sie Zeit,</b> wenn Sie <b>Yandex-Karten aktualisieren oder</b> in Ihren mobilen iOS-Client <b>einbetten m√ºssen</b> , sowie den Wunsch, Ihre Erfahrungen zu teilen. <br><br>  Wir haben einmal die YandexMapkit-Anwendung (ungef√§hr im Oktober 2017) anstelle von E-Mail-Karten (nichts Pers√∂nliches - nur Gesch√§ftliches) eingebaut.  Nach ungef√§hr 3 Monaten, an einem sch√∂nen Wintertag, war die Androyd-Version der Karten am zweiten Tag wegen der Schl√ºssel au√üer Betrieb. Die Karte wurde einfach zu einem K√ºrbis.) Was ist der Tipp aus dem Handbuch: "Auf dem Android waren die Karten kaputt, sie wissen nicht, wie sie repariert werden sollen." Als iOS-Client hatte dies keine Auswirkungen.  Arme Jungs auf dem Android ... diesmal hatten die Jungs nichts damit zu tun.  In jenen Tagen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fielen viele Lodges</a> : der Posten Russlands, der Schnabeltier, vielleicht erinnert ihr euch? <br><br><img src="https://habrastorage.org/webt/ny/sl/uk/nysluk1xq_j6lfzmv2tmusk_gci.png"><br><br>  Das hei√üt, wenn Ihre Anwendung an Dienste von Drittanbietern gebunden ist, w√§re es sch√∂n, einen Plan ‚ÄûB‚Äú f√ºr diesen Fall zu haben. Wechseln Sie beispielsweise zur vorherigen Version der Karten von Apple und ersetzen Sie keine durch eine andere ... <br><br>  Nach weiteren 3 Monaten, irgendwo im M√§rz, kam ein Brief von Yandex, dass sie sdk endlich aktualisiert hatten (sehr wenig Zeit ist vergangen, 4-5 Jahre nach dem vorherigen Update): <br>  "-Update, schalten Sie die alte in einem Jahr aus", kurz gesagt.  Vorher gab es einfach eine alte Version 1.0 <br><br><img src="https://habrastorage.org/webt/mk/bn/el/mkbnelhsho-0yzuynyrwg8fw6by.png"><br><a name="habracut"></a><br>  Nun, nat√ºrlich haben wir nach einer solchen Warnung nicht gezogen und sofort mit dem √úbergang begonnen ... nach 3 Monaten)) im August. <br><br><h2>  Phase des "Kommentierens"! (Deaktivieren der Funktionalit√§t) </h2><br>  Du sagst, ha ... was dort aktualisiert wird, Pod aktualisiert, ein paar Stellen korrigiert und das ist alles.  Also nein, Leute, die neue Karten-API ist absolut nicht kompatibel mit der alten, und au√üerdem gibt es, wie sich sp√§ter herausstellte, sogar viele wichtige Notwendigkeiten, die in der alten Version und anderen Kartenbibliotheken sofort verf√ºgbar sind! <br><br>  Also, Mapkit 3.0 (beim Schreiben einer Artikelversion 3.1 wurde ver√∂ffentlicht), ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Link zur Dokumentation</a> . <br><br>  Und warum au√üer einer Warnung von Yandex?  In einer Beta-Version von Xcode 10 wird ein Projekt mit einem alten Wal nicht dumm zusammengestellt, da C ++ irgendwo im Inneren verwendet wird, was in der neuen Version nicht der Fall ist.  Es ist notwendig, es in der Unterliste umzubenennen, sogar dort zu aktualisieren usw. Kurz gesagt, ich habe dies nicht getan, weil ich am Ende noch aktualisieren muss <br><br>  1) Wir aktualisieren sdk anstelle von Version 1.0 sofort 3.0, nat√ºrlich hat sich die API ge√§ndert, aber so viel .... <br><br>  Das alte YMKAnnotation-Protokoll fehlt also einfach <br><br><img src="https://habrastorage.org/webt/0y/ma/2j/0yma2jg0ol_cmlsv5iawysjcq4c.png"><br><br><br>  In K√ºrze sieht es aus wie ein erzwungener geschmiedeter Strig (: das summt nicht, und dann tragen Sie ein "!" - Zeichen f√ºr sich ... Beispiel f√ºr die Protokollimplementierung: <br><br><img src="https://habrastorage.org/webt/6_/7u/uw/6_7uuw9qsz5xa0xydgf5rqeturk.png"><br><br>  Nun, schreiben wir noch einmal) unsere eigene, nur anstelle der Koordinatenmethode () werden wir die Eigenschaften erstellen. Alles ist einfach, die Methode ist redundant.  title! () wird durch einen nicht geformten title () ersetzt. Andererseits k√∂nnen Sie eine Eigenschaft erstellen. Nun, es gibt eine Menge, in denen Sie das Projekt √§ndern m√ºssen, also habe ich gerade das Ausrufezeichen entfernt. <br><br>  In unserem Projekt war es notwendig, 3 Controller mehrmals zu ersetzen und CoreLocation in einen anderen zu importieren, da es jetzt in keinem der Yandex MapPocket-Header importiert wird. <br><br>  Um den vertrauten YMKMapCoordinate (alter Wal) w√§hrend des gesamten Projekts nicht umzubenennen, wurden Typealias f√ºr YMKPoint (neuer Wal) erstellt. <br><br><img src="https://habrastorage.org/webt/bk/xi/iv/bkxiivvenzq6k_yulfn8thesay8.png"><br><br>  2) Lassen Sie uns auch einige Eigenschaften deklarieren, die wir in Zukunft ben√∂tigen werden, um mit der Karte zu arbeiten, haupts√§chlich Getter: <br><br><img src="https://habrastorage.org/webt/wx/15/zu/wx15zujdm2ylkpok3cujwbagzog.png"><br><br>  3) Das erste, was erstellt werden muss, ist YMKMapView (alles ist in Ordnung, ein solches Objekt ist noch verf√ºgbar).  Fr√ºher habe ich es sofort initialisiert. Jetzt k√∂nnen Sie dies nicht mehr tun. Es st√ºrzt ab, da Sie zuerst den Schl√ºssel eingeben m√ºssen.  Der aktuelle Schl√ºssel funktioniert nicht und Sie m√ºssen nach einem neuen fragen.  F√ºgen Sie AppDelegate gem√§√ü der Dokumentation hinzu.  Erst nach dem Festlegen des Schl√ºssels k√∂nnen wir YMKMapView erstellen und so konfigurieren, wie es in der setupMap () -Methode erforderlich ist <br><br><img src="https://habrastorage.org/webt/ab/fp/8b/abfp8ba-jefubna2qmqsmsxpg7q.png"><br><br>  Was hier passiert, werden wir sp√§ter im Verlauf des Bedarfs an geeigneten Einstellungen detailliert analysieren <br><br>  4) Wie geht es weiter? Und dann hatten wir den urspr√ºnglichen Speicherort von CLLocation. Um ihn jetzt verwenden zu k√∂nnen, m√ºssen Sie das CoreLocation-Framework manuell hinzuf√ºgen oder ... oder es durch YMKPoint aus dem Yandex-Mapkit ersetzen <br><br><img src="https://habrastorage.org/webt/jw/eo/hj/jweohjs_xdkhqdjhg5ludux4qsi.png"><br><br>  5) Ferner wurde die Karte mit einer sehr einfachen Methode auf diese Koordinate zentriert, aber jetzt gibt es keine einfache <br><br><img src="https://habrastorage.org/webt/db/w_/sf/dbw_sf_pf_7nqkfk4wil_mlt8kw.png"><br><br>  Aber das Kartenobjekt ist etwas komplizierter und etwas tiefer) ... mapView.mapWindow.map! .Move.  Hier erfahren wir etwas √ºber die Existenz eines Objekts wie YMKCameraPosition. <br><br><img src="https://habrastorage.org/webt/6y/hd/lt/6yhdltmfe8hap6p06qzpyk7clj8.png"><br><br>  6) Als n√§chstes kommentieren wir die Kartenkonfiguration, da es keine solchen APIs / Eigenschaften gibt.  Jetzt lassen wir es einfach weg, um zumindest minimal zu beginnen. <br><br>  Wir kommentieren das Hinzuf√ºgen von Anmerkungen (ich werde darauf achten, dass dies eine Standardfunktionalit√§t ist) und die Anzeige der n√§chstgelegenen Punkte (dies ist bereits eine Art unserer Funktionalit√§t). <br><br>  Und das gesamte YMKMapViewDelegate ist auch ein Kommentar, den ich im neuen Framework nicht gefunden habe, und ein √§hnliches Analogon. <br><br><img src="https://habrastorage.org/webt/ug/jg/ix/ugjgixhzbdvdjtqnyz3g-vawas8.png"><br><br>  Ich habe die Implementierung weggelassen, nur die Methoden selbst: <br><br>  - ob der Standort des Benutzers angezeigt werden soll, <br>  - welche Ansichten f√ºr Pins verwendet werden sollen, <br>  - Reaktion auf das Klicken auf die Anmerkung, <br>  - welche Beschriftungen f√ºr Anmerkungen, <br>  - Die Reaktion auf das Klicken auf Callout, das ist alles, was wir normalerweise verwenden.  Am Ende gab es eine Art unserer Methode, bei der auch eine bestimmte API-Karte verwendet wurde. <br><br>  <b>ALLES</b> mit MapVC herausgefunden - dies ist die Hauptklasse, in der das Mapkit verwendet wurde <br><br>  7) Ein kleiner Kommentar zum benutzerdefinierten Callout, es wird YMKCalloutView nicht mehr erben, der neue Wal ist nicht mehr vorhanden. <br><br>  Hurra, jetzt hat sich das Projekt versammelt, ich konnte alles starten und ... das Notizbuch in der Box sehen, denn nach dem Start m√ºssen Sie Zeit zum ‚ÄûAufw√§rmen‚Äú geben))), aber ich wusste nichts davon und dachte, dass etwas nicht stimmt Also, obwohl ich vorgeschlagen habe, dass es einige Zeit dauert, um den Schl√ºssel zu aktivieren.  Es stellt sich heraus, dass die Annahme richtig war.  Sie m√ºssen ungef√§hr eine Stunde warten (vielleicht hat sich jetzt etwas ge√§ndert). <br><br>  Bei einem weiteren Versuch, die alte API auf eine neue Weise zu √§ndern, wurde die Karte angezeigt. <br><br><h2>  Stufe zwei - "Suche" (wie man die alte Funktionalit√§t auf eine neue Weise implementiert) </h2><br>  Beginnen wir mit der Wiederherstellung der verlorenen Funktionalit√§t.  Sie m√ºssen also die Benutzersperre anzeigen, aber auf die alte Weise kann das √Ñndern der Eigenschaft und das Festlegen des Delegaten nicht durchgef√ºhrt werden. <br><br>  Dies erfolgt nun √ºber die Ebene, siehe Punkt 3 der setupMap () -Methode. <br><br><img src="https://habrastorage.org/webt/cs/w5/c8/csw5c8t0hyasi5x87xzmgeffs60.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wir werden uns</a> das Beispiel in der Demo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ansehen</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Download von Yandex Github</a> ), da es dort ist.  √úbrigens m√ºssen Sie auf setAnchorWith achten.  Sp√§ter werde ich sagen warum, es ist mit Zoom verbunden.  Ok Ort funktioniert. <br><br>  2) Was kommt als n√§chstes, nat√ºrlich Anmerkungen.  Sie k√∂nnen nicht auf die alte Art hinzuf√ºgen, wir schauen uns die Demo noch einmal an.  Dort gibt es eine Klasse - MapObjectsViewController.  In der neuen Version wird der Delegat nicht ben√∂tigt, um der Karte Stifte hinzuzuf√ºgen. Dazu m√ºssen Sie auf die Eigenschaft mapObjects zugreifen, die Methode addPlacemark f√ºr das Objekt aufrufen und die Koordinate dort √ºbergeben (es gibt noch andere √úberladungen). Beispiel: <br><br><img src="https://habrastorage.org/webt/-c/au/s4/-caus4cx0bkkkniwy66g8mpqi6k.png"><br><br>  Wir durchlaufen die Sammlung von Anmerkungen (z. B. nach dem Empfang vom Server) und f√ºgen der Karte eine hinzu.  Die Methode gibt √ºbrigens "placeMark" (Ortsbezeichnung) zur√ºck, mit dem Sie zus√§tzliche Einstellungen vornehmen k√∂nnen, z. B. die Anzeigereihenfolge √ºber die Eigenschaft zIndex √§ndern k√∂nnen. <br><br>  Hier habe ich jedoch den Punkt √ºbersehen, dass ich zuvor in die Suche nach einem Delegierten eingestiegen bin und ihn nicht sicher und √ºberhaupt keinen einzigen Delegierten gefunden habe (tats√§chlich wurden sie einfach anders genannt, jetzt sind sie Zuh√∂rer).  Ich wei√ü aus fr√ºheren Erfahrungen mit dem Apfelwal und dem alten Yandex-Wal, dass Anmerkungen wie bei Zellen wiederverwendet werden, aber die Demo enth√§lt nur addPlacemark.  Auf die Frage nach Yandex-Karten f√ºhren (ein kleiner pers√∂nlicher Bekannter half hier): "- Wie kann man die Speichernutzung optimieren, Objekte wiederverwenden?"  Antwort: "Warum, also funktioniert es gut" ... na ja, irgendwie funktioniert es. <br><br>  Hinweis: 1) Es ist wichtig zu beachten, dass Yandex.Maps ein Mapkit verwendet und es nicht entwickelt.  Dies wird vom Mapkit-Team durchgef√ºhrt (Nikolais Spitzname auf dem Hub - likhogrud @). <br><br>  2) Erkl√§rung, warum Objekte nicht wiederverwendet werden: <br><br>  Im alten Wal waren AnnotationViews Ansichten, sie wurden vom Benutzer erstellt, und nat√ºrlich m√ºssen die Ansichten wiederverwendet werden, da das Erstellen nicht billig ist.  Beim neuen Wal werden Ortsmarken vom Mapkit direkt im offenen GL erstellt.  Und vielleicht werden sie dort wiederverwendet, aber das ist ungenau.  In jedem Fall ist dies viel effizienter als das Erstellen einer Ansicht. <br><br>  3) Ab dem neuen gibt es √ºbrigens die M√∂glichkeit, das Anmerkungssymbol f√ºr den Benutzer zu √§ndern.  Implementiert wie folgt: Sie m√ºssen einen Listener hinzuf√ºgen (analog zum Delegaten), das entsprechende Protokoll implementieren - 1 von 3 Methoden, 2 einfach leer lassen. <br><br>  Laden Sie gleichzeitig die Ortsmarke mit unseren Symbolen neu. <br><br><img src="https://habrastorage.org/webt/yq/2t/cv/yq2tcvkmlgp6mxfh5hpppwqgmk4.png"><br><br>  Ich mache Sie auch auf die Eigenschaft des Ankers aufmerksam.  Nachdem die Standorttaste des Benutzers auf der Karte gedr√ºckt wurde, verschiebt die Kamera den Fokus in die Mitte des Standorts.  Das Problem ist jedoch, dass ein erneutes Dr√ºcken der Aktion nicht erzeugt.  Was?  Wir kommentieren die Ankermethode und alles funktioniert. <br><br>  4) Jetzt m√ºssen Sie jeweils eine Beschriftung anzeigen, um den Klick zu berechnen.  Es gibt verschiedene Methoden in den Schnittstellen, die richtige ist YMKMapObjectTapListener.  Es gibt eine wichtige interessante Methode, mit der ich mich sp√§ter qu√§len musste. Sie gibt true zur√ºck, um nicht weiter zu integrieren, wenn ein Abonnent gefunden wird.  Ich mache Sie auf sich aufmerksam, Sie m√ºssen sich zuerst anmelden, mapObjects wird abonniert (Zeile 149). <br><br><img src="https://habrastorage.org/webt/ar/2j/gp/ar2jgphtrvt_or_szwtibdupw74.png"><br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  Klicks erf√ºllen also.  <b>Hurra</b> .  Es gab jedoch Versuche, Stifte nur in der sichtbaren Zone anzuzeigen. Dies ist √ºberfl√ºssig. Zeigen Sie alles auf einmal an. Lassen Sie es also (nur weil es nicht langsamer wird.) <br><br>  5) Dann wollte ich die Tasten der Einfachheit halber vergr√∂√üern / verkleinern.  Ein wenig Kopieren, Einf√ºgen und Bearbeiten in Analogie zur Positionstaste, und fertig. <br><br>  Da wir √ºber die Kamera Bescheid wissen, verwenden Sie die Verschiebungsmethode und dementsprechend den aktuellen Zoom + - 1 oder 0,5, je nach Bedarf.  Hier ist alles in Ordnung. <br><br><img src="https://habrastorage.org/webt/ar/_s/-p/ar_s-pit7r4wjzzbrbgyiylgm00.png"><br><br>  6) Wir wenden uns dem Hauptfunktions-Callout zu (dies ist ein solches Rechteck mit zus√§tzlichen Informationen, mit einem Dreieck am unteren Rand).  Es stellt sich heraus, dass es keine API gibt (‚Äûberauschend im Sommer‚Äú - Yandex erkannte meine Rede, als ich Notizen aus einer Brosch√ºre las, um diesen Artikel nicht manuell einzugeben). <br><br><img src="https://habrastorage.org/webt/ck/b3/ew/ckb3ewygj9uy3itbzrlq63wqtfk.png"><br><br>  Wie geht es euch?  100 500 Anwendungen verwenden ein Callout. <br><br>  Ich finde heraus, dass wir im ‚Äûtechnischen Support‚Äú (Kolya) gut schreiben, wie man das manuell macht.  Welche M√∂glichkeiten haben Sie? <br><br>  <s>Konvertieren Sie die Ansicht in ein Bild, da Sie eine Ansicht nicht direkt hinzuf√ºgen k√∂nnen</s> (eine Datei in 3.1 hinzugef√ºgt), √§ndern Sie das Symbol ... <br><br><img src="https://habrastorage.org/webt/tz/w2/qd/tzw2qdppbx86whmrgmqqzmhysge.png"><br><br>  Diese Kr√ºcken werden auf einer Ebene erhalten, es schien Platz. <br>  In der Tat nat√ºrlich keine Kr√ºcken, sondern einfach die Abwesenheit, die ich als Grundfunktionalit√§t betrachte <br><br>  7) Okay, f√ºgen wir zuerst ein Test-Callout hinzu, als solches verwenden wir ein rotes Quadrat.  Wenn Sie also auf unsere PIN klicken, wird die Delegate / Listener-Methode aufgerufen, bei der der Klickpunkt und das Objekt √ºbertragen werden.  Ohne einen Trick zu erwarten, nehmen wir "Punkt" als den Punkt, an dem Sie das Callout hinzuf√ºgen m√∂chten.  (Achtung, ist alles richtig gemacht: "Sie haben geklickt, den Punkt genommen, ihn gebunden?" Ungef√§hr 80% haben richtig geantwortet, 20% - nein) <br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  Rufen Sie die showCallout-Hilfsmethode im Methodenk√∂rper auf: <br><br><img src="https://habrastorage.org/webt/sq/aa/8w/sqaa8wmstqdunxobdbyr0xa0jg4.png"><br><br>  Zeile 544 <br>  Erstellen Sie im Inneren eine Testansicht von Rot, vierzig mal vierzig, konvertieren Sie sie in ein Bild, deklarieren Sie eine Konstante x mit einem Wert von 0,5. Sie wird verwendet, um das Dreieck der Beschriftung in der Mitte des Punkts zu positionieren.  Er lehnte die Idee ab, seine Position zu √§ndern, und zog es sp√§ter vor, die Kamera so zu bewegen, dass das ausgew√§hlte Callout in der Mitte des Telefonbildschirms angezeigt wird <br><br>  Als n√§chstes deklarieren wir den Push-Bereich von tappableArea. Es gibt eine solche Eigenschaft im Symbolstil f√ºr den Pin.  Na ja, Sie k√∂nnen die Klickzone begrenzen, und wir werden es tun.  Die Zone reicht von 0,0 bis 1,1.  Wir brauchen den unteren Teil, wo es angeblich einen Knopf gibt, der zuvor in ein Bild verwandelt wurde (denken Sie daran).  Okay, das bedeutet die Zone (0,0,5 - 1,1), da sich die Schaltfl√§che unten befindet. <br>  Zonenbeschr√§nkung funktioniert, aber es gibt eine Nuance, die alles negiert.  Wenn sich unter dem nicht gepressten Bereich ein weiterer Stift befindet, funktioniert das Dr√ºcken darauf.  Die Bedeutung dieses Bereichs?  W√ºrden sie eine Flagge machen oder so, damit der Klick nicht vorbei geht?  Okay ... <br><br>  550 Linie <br>  Lassen Sie uns einen Stil f√ºr das Symbol erstellen. Sie k√∂nnen die Ankerposition sofort im ersten Parameter angeben, z. B. unten in Zeile 557.  Position y ist 1,05, um das Dreieck wieder vertikal √ºber den Stift zu heben <br><br>  559 Linie <br>  Erstellen Sie unser benutzerdefiniertes Callout einer bestimmten Gr√∂√üe. <br>  Wir konfigurieren die Felder, die wir ben√∂tigen, anhand der Informationen aus der ausgew√§hlten Annotation selectedAnnotation, insbesondere des Titels und des Untertitels sowie der Beschriftung auf der Schaltfl√§che f√ºr dieses Callout.  Dann k√∂nnen Sie selbst tun, was Sie wollen.  Die ausgew√§hlte Anmerkung wird fr√ºher im Delegaten definiert.  F√ºgen Sie jedoch zun√§chst das zuvor erstellte rote Quadrat hinzu <br>  F√ºgen Sie als N√§chstes einen Pin zur mapObjects-Auflistung hinzu. Die Methode gibt die hinzugef√ºgte Ortsmarke an uns zur√ºck. Speichern Sie sie in einer Variablen. <br>  Durch Klicken auf das Callout selbst wird ein detaillierter Controller ge√∂ffnet. Wenn also eine andere PIN unter dem Popup eingegeben wird, funktioniert der Delegat wieder. Daher m√ºssen Sie hier die Reihenfolge in der Hierarchie √ºber zIndex √§ndern.  Stellen Sie die Sichtbarkeit ein und verschieben Sie unser Callout in die Mitte der Zeile 564 <br><br>  <b>Nuancen</b> : Die variable Ortsmarke ist ein Zeiger auf das Callout. <br>  Zuerst haben wir es nicht, nachdem wir auf den Pin geklickt haben, erscheint es, nachdem wir auf den n√§chsten Pin geklickt haben, m√ºssen wir unser erstes Callout l√∂schen und ein neues hinzuf√ºgen.  Wenn daher die Variable placemark! = Nil ist, m√ºssen Sie das alte Callout aus der mapObjects-Auflistung entfernen. <br><br><img src="https://habrastorage.org/webt/3r/fo/dg/3rfodg0siuahk0tsvk1qzyvydae.png"><br><br>  Bei Tapas auf der Karte m√ºssen Sie das Callout ausblenden. Bei der Delegate-Methode weisen wir eine Ortsmarke zu, der Beobachter arbeitet, das Callout wird gel√∂scht und die ausgew√§hlte Anmerkung wird gel√∂scht <br><br>  Daf√ºr haben wir uns fr√ºher f√ºr YMKMapInputListener angemeldet <br><br><img src="https://habrastorage.org/webt/ew/f-/a2/ewf-a2uvc7khz8okkxw-s6etxds.png"><br><br>  <s>Das Verfahren zum Konvertieren von Ansichten ist wiederum wie folgt.</s>  (In Version 3.1 wurde die M√∂glichkeit hinzugef√ºgt, der Karte Ansichten hinzuzuf√ºgen.) <br>  Ich beschreibe nicht, wie die Ansicht erstellt wird. Wenn jedoch viele Probleme damit auftreten (dies ist mit einem Dreieck m√∂glich), schreibe ich, f√ºge ich diese Phase hinzu <br><br><img src="https://habrastorage.org/webt/v1/mx/nk/v1mxnkmtkahrp5j6umoevtwadlc.png"><br><br>  Die zur H√∂he hinzugef√ºgte Magie 20 wird f√ºr einen Platz unter dem Dreieck darunter ben√∂tigt, den Sie zeichnen m√ºssen <br><br>  Wir m√∂chten auch, dass das Popup an einer bestimmten Stelle (links, rechts, in der Mitte) am Pin angezeigt wird (angeh√§ngt wird). Daf√ºr gibt es eine Ankereigenschaft.  Wie folgt definiert: <br>  Wir teilen den sichtbaren Bereich der Karte in 3 vertikale Zonen auf und bestimmen, in welcher wir uns befinden. Abh√§ngig davon √§ndern wir die Position der Bindung.  Im Codebeispiel pr√ºfen wir, ob wir uns auf der linken Seite befinden, analog dazu f√ºr die Mitte, wenn nicht f√ºr die linke bzw. nicht f√ºr die Mitte, ist der Punkt auf der rechten Seite <br><br><img src="https://habrastorage.org/webt/o-/xq/ii/o-xqiijbnowv2clav2ny2tl5drc.png"><br><br>  Eine Hilfsfunktion zum √úberpr√ºfen, ob ein Punkt in eine Region f√§llt: <br><br><img src="https://habrastorage.org/webt/dr/os/5e/dros5emmil06hsac_h-rdbwk_jq.png"><br><br>  Starten Sie.  Es funktioniert.  Aber es gibt eine Nuance, es scheint, dass wir versuchen zu zoomen, eins, zwei, drei, und das Callout fliegt von der Stecknadel weg.  Was?  Wie? <br><br><img src="https://habrastorage.org/webt/9v/il/7f/9vil7fru-hbitdlkvqtu6oeyhnw.gif"><br><br>  7) Wir beginnen mit dem Debuggen, die Koordinaten sind gleich <br><br><img src="https://habrastorage.org/webt/tt/t1/u1/ttt1u1jgezg-_ld3n_ksj-e_m90.png"><br><br>  Dann gab es Versuche zu verstehen, was passiert und wie es funktioniert, eine weitere R√ºckkehr zur Demo, eine noch aufmerksamere Suche nach Unterschieden ... <br><br><img src="https://habrastorage.org/webt/oc/nb/d_/ocnbd_n89jitplbg4_dtukbnvlo.jpeg"><br><br>  Ich stelle fest, dass die Koordinaten direkt √ºbertragen werden und nicht die, die vom Fass ist!  Aber ich habe mich entt√§uscht, es ist klar, dass die Koordinaten gleich sind, das hei√üt, der Kreis und das Quadrat haben die gleiche Koordinate. <br>  Deshalb habe ich bei der Methode nicht sofort auf das Objekt zugegriffen, sondern den Punkt √ºbergeben, was falsch ist. <br><br><img src="https://habrastorage.org/webt/9f/rw/zi/9frwzi06e8ur4pyrga4jhv7cyua.png"><br><br>  Aber m√ºssen Sie ein Objekt umwandeln, eine Eigenschaft √ºbernehmen (√ºberall wird alles anders genannt, dann koordinieren, dann zeigen, hier jetzt Geometrie), ist das so kreativ oder was)?  493 Zeilen <br><br><img src="https://habrastorage.org/webt/_u/oo/5h/_uoo5hjrg5okyoodbijb7s0rzzo.png"><br><br>  Da wir zwei Druckoptionen verarbeiten m√ºssen: die erste zum Anheften, die zweite zum Aufrufen und keine Klicks, wenn wir erneut auf denselben Pin geklickt haben, m√ºssen wir <b>zuerst</b> den Pin finden, auf den wir in der Pin-Sammlung geklickt haben, und ihn vergleichen Koordinaten 495 Linie, andernfalls true zur√ºckgeben, wodurch gesagt wird, dass wir den Klick verarbeitet haben und nicht weiter in der Hierarchie gehen m√ºssen <br><br>  <b>Zweitens</b> : Wir bestimmen es durch Klicken auf die Stecknadel oder auf die Beschriftung. Wir vergleichen auch die Koordinaten der 499 Linienbeschriftungen.  Gleichstellungstest: <br><br><img src="https://habrastorage.org/webt/xd/z5/lk/xdz5lkm2g-zehkggfea6rqdxkfa.png"><br><br>  Wenn dies ein Hinweis ist und wir auf einen Klick auf eine Schaltfl√§che (oder eine Simulation, da es sich jetzt um ein Bild handelt) und nicht auf den gesamten Bereich reagieren m√∂chten, m√ºssen wir einige Berechnungen mit Stiften durchf√ºhren :) <br><br><ol><li>  Konvertieren Sie die Weltkoordinate in die Linie 501 des Bildschirms <br>  Wir betrachten uns selbst: Wir konvertieren die Kartenkoordinaten in Bildschirm, wir wissen, wo wir uns befinden, und durch Hinzuf√ºgen der Breite und H√∂he der Ansicht erhalten wir die Eckpunkte, aber aus irgendeinem Grund stimmen sie nicht √ºberein, und ich multipliziere sie manuell mit drei, in meinem Fall f√ºr das 10. iPhone)).  Wie sich sp√§ter herausstellte, habe ich die Anzahl der Pixel pro Punkt vergessen und nicht ber√ºcksichtigt.  Was wir haben k√∂nnen 1x, (ein Punkt 1 Pixel), 2x, 3x ein Punkt ist drei Pixel. </li><li>  Berechnen wir die H√∂he der Schaltfl√§che - die H√∂he der Beschriftung + die H√∂he des Dreiecks multipliziert mit der Skala, Informationen zur Skala (Zeile 498).  Als n√§chstes teilen wir dies alles in zwei Teile, da die H√∂he der Schaltfl√§che die H√§lfte der H√∂he des Callouts betr√§gt </li><li>  Dann berechnen wir die Koordinaten der Winkel basierend auf der Tatsache, dass der Anker (x: 0,5, y: 1) angesichts des Ma√üstabs und der Fl√§che des Dreiecks)). </li><li>  Konvertieren Sie dann diese Bildschirmkoordinaten in Welt </li><li>  Erstellen Sie einen sichtbaren Bereich basierend auf ihnen, ist eine Schaltfl√§chenzone </li><li>  Und wir pr√ºfen, ob wir die Knopfzone erreicht haben oder nicht.  Wenn Sie auf klicken, √ºberpr√ºfen Sie die Art der Anmerkung, abh√§ngig von der Art, die wir f√ºr einige unserer Methoden nennen: Gehen Sie zum Detailbildschirm oder w√§hlen Sie diesen Speicher f√ºr die Zustellung in F√§llen mit StorePoint aus </li></ol><br>  Andernfalls ist es ein Klick auf die Stecknadel und wir m√ºssen ein Callout hinzuf√ºgen, was wir oben tats√§chlich getan haben. <br><br>  Das ist alles, nachdem diese erste Bekanntschaft mit dem neuen Wal vorbei ist. <br><br>  <s>Was ich sonst noch sagen m√∂chte, in der aktuellen Implementierung von Mapkit-Maps enth√§lt es viele Funktionen, die nicht verwendet werden. Dies wirkt sich auch auf die Gr√∂√üe der resultierenden Bin√§rdatei aus.</s>  <s>Sind Sie bereit f√ºr solche Opfer, in Zukunft sollten die Jungs doch in Module zerlegt werden</s> .  Ich habe auch von Kollegen auf dem Android aus dem Workshop geh√∂rt, dass es Probleme mit der Kompatibilit√§t mit Kotlin gibt. <br><br>  P.S.  W√§hrend ich mich entschied und anfing, einen Artikel zu schreiben, kam Update 3.1 heraus, wo die oben genannten Probleme gel√∂st und implementiert wurden: <br><br>  Hinzugef√ºgt <br><br>  F√ºr Android wurden arm64- und x86-Builds angezeigt. <br>  <b>Sie k√∂nnen der Karte ein beliebiges Ansichtsobjekt hinzuf√ºgen.</b> <b><br></b>  Fahrradrouting ist erschienen. <br>  Nullable Annotations f√ºr Android hinzugef√ºgt. <br><br>  Ge√§ndert <br><br>  <b>MapKit ist in Teile unterteilt:</b> <b><br></b>  MapKit - nur eine Karte; <br>  MapKit-Wegbeschreibung - Fahrzeugrouting; <br>  MapKit Transport - Fu√üg√§ngerroute, Routen f√ºr √∂ffentliche Verkehrsmittel und Fahrradrouten; <br>  MapKit Search - Suche und Geokodierung; <br>  MapKit-Orte - Panoramen. <br>  F√ºr iOS sind nullf√§hige Anmerkungen strenger geworden. <br><br>  Behoben <br><br>  Eine Reihe von Fehlern wurde behoben. <br>  Verbesserte Leistung. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tech.yandex.ru/maps/doc/mapkit/3.x/concepts/versions-docpage</a> <br><br>  <b>Schreiben Sie Ihre Kommentare, Fragen.</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de427611/">https://habr.com/ru/post/de427611/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de427601/index.html">5 + 1 Fall, in dem die REST-API-Spezifikation eine gro√üe Rolle spielt</a></li>
<li><a href="../de427603/index.html">Wie man endlich anf√§ngt, Tests zu schreiben und es nicht bereut</a></li>
<li><a href="../de427605/index.html">Wie die Crowdsourcing-Plattform von Yandex Drohnen trainiert und die Servicequalit√§t bewertet</a></li>
<li><a href="../de427607/index.html">Rechenzentrum in der Schweiz: wie am Schn√ºrchen arbeiten</a></li>
<li><a href="../de427609/index.html">L√∂sen der Gleichung mit ganzzahliger Division ohne rohe Gewalt</a></li>
<li><a href="../de427613/index.html">10 n√ºtzliche Blogs f√ºr Programmierer in Englisch</a></li>
<li><a href="../de427615/index.html">H√∂ren Sie auf, endlose Bildlaufseiten zu erstellen</a></li>
<li><a href="../de427617/index.html">Eisenbahnwagenentwicklung</a></li>
<li><a href="../de427623/index.html">3 B√ºcher √ºber C ++ 17 (auf Englisch)</a></li>
<li><a href="../de427625/index.html">So schreiben Sie einen Schwachstellenscanner und verdienen Geld mit Exploits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>