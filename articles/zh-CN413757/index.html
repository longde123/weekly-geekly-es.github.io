<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👩‍👧‍👦 ☘️ 🕳️ 商业项目中的数据库：怎么办？ 🤓 🙅🏾 🏅</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="所有的假期都结束了！...有些人会说这恭喜。 但是，可以肯定的是，许多人很快就会放假，所以多花点时间。 好吧，我们并没有失去动力，在这个温暖的日子里，我们分享了合作伙伴的经验。 这将与优化数据库工作有关。 削减更多细节！ 



 我请作者发言。 

 哈勃的读者，我们欢迎您！ 我们是WaveAcc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>商业项目中的数据库：怎么办？</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/413757/"> 所有的假期都结束了！...有些人会说这恭喜。 但是，可以肯定的是，许多人很快就会放假，所以多花点时间。 好吧，我们并没有失去动力，在这个温暖的日子里，我们分享了合作伙伴的经验。 这将与优化数据库工作有关。 削减更多细节！ <br><br><img src="https://habrastorage.org/webt/ea/ms/5v/eams5vve4rwkpzitmhnv4bl0-ki.jpeg"><a name="habracut"></a><br><br>  <i>我请作者发言。</i> <br><br> 哈勃的读者，我们欢迎您！ 我们是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">WaveAccess</a>团队，在本文中，我们将与您分享在商业项目中使用Azure Cosmos DB数据库服务（DB）的经验。 我们将告诉您为什么要使用数据库，以及开发过程中必须面对的细微差别。 <br><br><h2> 什么是Azure Cosmos DB </h2><br>  Azure Cosmos DB是作为PaaS解决方案提供的具有多模型范例的商业性，全球分布式数据库服务。 她是下一代Azure DocumentDB。 <br><br> 该数据库由Microsoft在2017年开发，由计算机科学博士学位的Leslie Lamport参与（2013年因对分布式系统理论做出了重要贡献的图灵奖获得者，LaTex开发人员，TLA +规范的创建者）。 <br><br>  Azure Cosmos DB的主要特征是： <br><br><ul><li> 非关系数据库； </li><li> 其中的文档以JSON格式存储； </li><li> 水平缩放并选择地理区域； <br><br><img src="https://habrastorage.org/webt/nl/dy/3g/nldy3g3u0sgafl2hucspvk5bcdc.jpeg"><br><br></li><li> 多模型数据范例：键值，文档，图形，列族； </li><li>  99％的请求具有低延迟：读操作少于10毫秒，（索引）写操作少于15毫秒； </li><li> 专为高吞吐量而设计； </li><li> 它以99.999％的SLA级别保证可用性，数据一致性和延迟。 </li><li> 可配置的带宽 </li><li> 自动复制（主从）； </li><li> 自动索引数据； </li><li> 可定制的数据一致性级别。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5个不同级别</a> （强，有界的陈旧性，会话，一致的前缀，最终）； </li></ul><br> 在图形上，您可以看到各种一致性级别对数据可用性，性能和一致性的依赖性。 <br><br><img src="https://habrastorage.org/webt/aj/mn/3a/ajmn3abjqxczqnngqpexk7hrdfu.jpeg"><br><br><ul><li> 为了方便地从其数据库过渡到Cosmos DB，有许多用于访问数据的API：SQL，JavaScript，Gremlin，MongoDB，Cassandra，Azure Blob； </li><li> 可定制的防火墙； </li><li> 自定义数据库大小。 </li></ul><br><h2> 我们解决的任务 </h2><br> 每隔N秒钟，全世界有成千上万的传感器发送信息（以下称为通知）。 这些通知必须存储在数据库中，然后搜索它们并将其显示在系统操作员的UI中。 <br><br> 客户要求： <br><br><ul><li> 使用Microsoft技术堆栈，包括Azure云； </li><li> 每秒处理100个请求的吞吐量； </li><li> 通知的结构不明确，可能会进一步扩展； </li><li> 对于紧急通知，处理速度很重要； </li><li> 高系统弹性。 </li></ul><br> 根据客户需求，理想情况下是使用非关系，全球分布，可靠的商业数据库来访问我们。 <br><br><img src="https://habrastorage.org/webt/x8/fe/no/x8fenovzxodrhh7fvpxqvpjtrcg.jpeg"><br><br> 如果我们查看与Cosmos DB类似的数据库，我们可以回想起Amazon DynamoDB，Google Cloud Spanner。 但是Amazon DynamoDB并不是全球分布的，并且Google Cloud Spanner的一致性和数据模型类型（仅表格形式，关系形式）的级别较低。 <br><br> 由于这些原因，我们选择了Azure Cosmos DB。 为了与数据库进行交互，我们<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用了.NET的Azure Cosmos DB SDK</a> ，因为后端是用.NET编写的。 <br><br><h2> 我们遇到的细微差别 </h2><br>  <b>1.数据库管理</b> <br><br> 为了开始使用数据库，首先，您需要选择一种工具来管理它。 我们在Azure门户和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DocumentDbExplorer中</a>使用了Azure Cosmos DB Data Explorer。 还有一个Azure Storage Explorer实用程序。 <br><br><img src="https://habrastorage.org/webt/rc/pv/wo/rcpvwozefe9cykihsulmvtmmxgs.jpeg"><br><br>  <b>2.设置数据库集合</b> <br><br> 在Cosmos DB中，每个数据库都由集合和文档组成。 <br><br> 可定制的收集功能，请注意： <br><br><ul><li> 集合大小：固定或无限； </li><li> 带宽，以请求单位每秒RU / s（从400RU / s起）； <br><br><img src="https://habrastorage.org/webt/i3/pk/xt/i3pkxtag0v2kvwtjyuclvhzoojk.jpeg"><br><br></li><li> 索引策略（包括或不包括往返索引的文档和路径，设置各种类型的索引，设置索引更新模式）。 </li></ul><br> 典型索引示例 <br><br><pre><code class="cs hljs">{ <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"datas"</span></span>, <span class="hljs-string"><span class="hljs-string">"indexingPolicy"</span></span>: { <span class="hljs-string"><span class="hljs-string">"indexingMode"</span></span>: <span class="hljs-string"><span class="hljs-string">"consistent"</span></span>, <span class="hljs-string"><span class="hljs-string">"automatic"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"includedPaths"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"/*"</span></span>, <span class="hljs-string"><span class="hljs-string">"indexes"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"Range"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>: <span class="hljs-string"><span class="hljs-string">"Number"</span></span>, <span class="hljs-string"><span class="hljs-string">"precision"</span></span>: <span class="hljs-number"><span class="hljs-number">-1</span></span> }, { <span class="hljs-string"><span class="hljs-string">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hash"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>: <span class="hljs-string"><span class="hljs-string">"String"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"Spatial"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataType"</span></span>: <span class="hljs-string"><span class="hljs-string">"Point"</span></span> } ] } ], <span class="hljs-string"><span class="hljs-string">"excludedPaths"</span></span>: [] } }</code> </pre> <br> 为了使子字符串搜索有效，对于字符串字段，您需要使用哈希索引（“ kind”：“ Hash”）。 <br><br>  <b>3.数据库事务</b> <br><br> 事务是在数据库中以存储过程级别实现的（执行存储过程是原子操作）。  JavaScript存储过程 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> helloWorldStoredProc = { id: <span class="hljs-string"><span class="hljs-string">"helloWorld"</span></span>, body: function () { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> context = getContext(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = context.getResponse(); response.setBody(<span class="hljs-string"><span class="hljs-string">"Hello, World"</span></span>); } }</code> </pre> <br>  <b>4.数据库变更渠道</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">更改Feed</a>侦听集合中的更改。 更改收集文档时，数据库将向该频道的所有订户引发有关更改的事件。 <br><br> 我们使用Change Feed来跟踪集合更改。 创建通道时，必须首先创建一个辅助<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">AUX</a>集合，该集合可协调多个工作角色对更改通道的处理。 <br><br>  <b>5.数据库限制：</b> <br><br><ul><li> 缺乏批量操作（用于<a href="">批量删除</a> ，更新文档的存储过程）； </li><li> 缺乏文件的部分更新； </li><li> 没有跳过操作（实现分页的复杂性）。 为了在通知请求中实现分页，我们使用了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RequestContinuation</a> （作为发出结果链接到最后一个元素）和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MaxItemCount</a> （从数据库返回的元素数）。 默认情况下，结果将分批返回（每个程序包中不超过100个项目，并且不超过1 MB）。 可以使用MaxItemCount参数将返回的项目数增加到1000。 </li></ul><br>  <b>6.处理第429个数据库错误</b> <br><br> 当收集带宽达到最大时，数据库开始生成“ 429 Too Many Request”错误。 要对其进行处理，可以使用SDK中的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RetryOptions</a>设置，其中MaxRetryAttemptsOnThrottledRequests是完成请求的尝试次数，而MaxRetryWaitTimeInSeconds是连接尝试的总时间。 <br><br>  <b>7.预测使用数据库的成本</b> <br><br> 为了预测使用数据库的成本，我们使用了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在线计算器</a> RU / s。 在基本计划中，一个1 KB元素的请求单元通过指向其自身或该元素标识符的链接对应于一个简单的GET命令。 <br><br><h2> 结论 </h2><br>  Azure Cosmos DB易于使用，可通过Azure门户轻松灵活地进行配置。 许多数据访问API使得迁移到Cosmos DB变得很容易。 无需聘请数据库管理员来维护数据库。  SLA财务担保，全球水平扩展使该数据库在市场上非常具有吸引力。 它适用于对容错和带宽有高要求的企业和全球应用。 我们在WaveAccess继续在我们的项目中使用Cosmos DB。 <br><br><h2> 关于作者 </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">WaveAccess</a>团队为世界各地的公司创建了技术先进，负载高，容错的软件。  WaveAccess软件开发高级副总裁<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Alexander</a> Azarov表示： <br><br><blockquote> 乍一看，困难的任务可以通过相对简单的方法解决。 重要的是不仅要学习新工具，而且还要完善熟悉技术的知识。 </blockquote><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">公司博客</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN413757/">https://habr.com/ru/post/zh-CN413757/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN413745/index.html">一次为人体所有电子设备开发了无线电源系统</a></li>
<li><a href="../zh-CN413747/index.html">通过NULL</a></li>
<li><a href="../zh-CN413749/index.html">真实项目中的B +树</a></li>
<li><a href="../zh-CN413751/index.html">Ruslan Cheremin和Maxim Gramin-在jug.msk.ru上与环境合作</a></li>
<li><a href="../zh-CN413753/index.html">天上的眼睛：巡逻无人机，可识别人群和公共场所的暴力行为</a></li>
<li><a href="../zh-CN413759/index.html">好奇心在数十亿年前的火星上发现了有机物</a></li>
<li><a href="../zh-CN413761/index.html">如何防止Windows 10更新后重新启动</a></li>
<li><a href="../zh-CN413763/index.html">我们五月份的阅读内容：Ivy评论，Nest 5版本以及其他对Angular开发人员有用的文字</a></li>
<li><a href="../zh-CN413765/index.html">C ++可变参数模板中的责任链</a></li>
<li><a href="../zh-CN413767/index.html">加拿大PRNG专家批评当局使用古老的Excel算法绘制签证</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>