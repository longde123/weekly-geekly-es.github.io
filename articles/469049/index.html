<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôá üêó üëπ ¬øPor qu√© escribimos l√≥gica empresarial en Lua? üë©‚Äçüëß üî† üßõüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr En esta publicaci√≥n queremos hablar sobre c√≥mo y por qu√© usamos un lenguaje de programaci√≥n con el hermoso nombre Lua en IPONWEB. 

 Lua es ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬øPor qu√© escribimos l√≥gica empresarial en Lua?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iponweb/blog/469049/">  Hola Habr  En esta publicaci√≥n queremos hablar sobre c√≥mo y por qu√© usamos un lenguaje de programaci√≥n con el hermoso nombre Lua en IPONWEB. <br><br>  Lua es un lenguaje de programaci√≥n integrado basado en script con un int√©rprete gratuito y c√≥digo abierto en C. Fue desarrollado en 1993 en Brasil, en la divisi√≥n Tecgraf de la Universidad Cat√≥lica de R√≠o de Janeiro, y sus progenitores fueron DEL (Lenguaje de entrada de datos) y SOL (Simple Object Language) desarrollado all√≠ antes.  Uno de los antepasados, el idioma SOL, particip√≥ indirectamente en el "bautismo" del reci√©n nacido: "Sol" se traduce del portugu√©s como "sol", y el nuevo idioma se llam√≥ "Lua", "luna". <br><br>  La facilidad para integrar Lua en motores escritos en lenguajes de "sistema" lo ha convertido en un lenguaje de script popular para videojuegos.  Por ejemplo, los guiones est√°n escritos en Lua en Grim Fandango y Baldur's Gate.  Aquellos que juegan a World of Warcraft probablemente tambi√©n hayan escuchado sobre Lua m√°s de una o dos veces: en √©l se escriben los complementos para el juego que facilitan la vida de los jugadores hardcore, fan√°ticos casuales, fan√°ticos para medir su efectividad y otros habitantes del mundo del juego.  Fuera de gamedev, Lua se utiliza como lenguaje de programaci√≥n de sistemas integrados (televisores, impresoras, paneles de autom√≥viles), as√≠ como aplicaciones, por ejemplo, el VLC Media Player.  Lua utiliza herramientas como Tarantool, Redis y OpenResty como lenguaje incorporado.  Lua tambi√©n se us√≥ como un lenguaje de extensi√≥n para los c√≥digos computacionales de Fortran que simulan el comportamiento termomec√°nico del combustible nuclear. <br><br><h3>  ¬øPor qu√© lua? </h3><br><a name="habracut"></a>  IPONWEB es un desarrollador de plataformas altamente cargadas para empresas que trabajan en el campo de la publicidad en l√≠nea: DSP, SSP, agencias de publicidad y anunciantes.  Hablamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en</a> detalle sobre nuestro trabajo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en este art√≠culo</a> .  Al principio, desarrollamos la l√≥gica de negocios de nuestras plataformas en C ++, pero r√°pidamente nos dimos cuenta de que esta no era la mejor opci√≥n.  Para minimizar los costos, el rendimiento de la plataforma es importante, as√≠ como la velocidad de desarrollo, y el desarrollo de C ++ result√≥ ser demasiado lento para nosotros, y la complejidad de agregar funcionalidad tambi√©n se vio afectada.  Decidimos aislar la interpretaci√≥n de la l√≥gica empresarial del c√≥digo del servidor de bajo nivel, comenzamos a buscar un lenguaje adecuado para esto y nos decidimos por Lua.  Fue en 2008, las implementaciones de JavaScript que eran adecuadas para nosotros todav√≠a no exist√≠an, Perl, Python y Ruby eran demasiado lentas y no f√°ciles de integrar.  Y estaba el lenguaje Lua, no muy famoso, pero popular en el desarrollo de juegos, y lo que quer√≠amos era similar a las necesidades de los desarrolladores de juegos: necesit√°bamos un motor r√°pido para operaciones de bajo nivel y un lenguaje r√°pido f√°cil de construir para la l√≥gica empresarial. <br><br>  Lua es realmente un lenguaje muy r√°pido.  Se puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lograr</a> un aumento adicional de la velocidad utilizando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LuaJIT</a> , el entorno de tiempo de ejecuci√≥n para Lua 5.1, que incluye un compilador JIT de seguimiento (utilizamos nuestro propio fork, sobre el que ya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">escribimos</a> ).  Dado que escribimos l√≥gica de negocios para sistemas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RTB</a> , la velocidad es cr√≠tica para nosotros: en RTB, en promedio, hay 120 milisegundos para procesar cada solicitud entrante.  Al mismo tiempo, solo se asignan de 10 a 15 milisegundos para la ejecuci√≥n del c√≥digo, y el resto del tiempo est√° esperando una respuesta de otros servicios.  Si, por ejemplo, el usuario ni siquiera nota un retraso de medio segundo al cargar un sitio en la red, entonces para RTB estos 500 milisegundos son un per√≠odo de tiempo enorme.  La respuesta a la pregunta de qu√© tan r√°pido es el lenguaje Lua: es lo suficientemente r√°pido como para que podamos escribir l√≥gica de negocios en √©l durante muchos a√±os y permanecer en el negocio RTB.  Si el idioma que elegimos no fuera lo suficientemente r√°pido, no tendr√≠amos a nadie para quien escribir la plataforma.  ¬øEsto significa que RTB no se puede escribir en otros idiomas?  No significa  Pero escribimos RTB en Lua y hacemos frente con √©xito a nuestras tareas comerciales y las de los clientes.  Un buen ejemplo de la velocidad de Lua en el servidor es este punto de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">referencia</a> OpenResty. <br><br>  Lua como lenguaje incorporado tiene muchas ventajas: es minimalista, compacto, con una biblioteca est√°ndar muy peque√±a.  Su funcionalidad est√° completamente duplicada en C, lo que proporciona una interacci√≥n f√°cil y "fluida" entre Lua y C. Lua tiene un umbral de inicio de sesi√≥n bastante bajo en comparaci√≥n con muchos otros lenguajes: la mayor√≠a de los programadores que vienen a trabajar en IPONWEB nunca han escrito en Lua antes, pero tienen suficiente varios d√≠as para participar plenamente en el trabajo. <br><br>  Aqu√≠ hay un ejemplo simple de apuntar a una audiencia publicitaria. <br><br><pre><code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">-- deal: ,  ,      --     ( ,    ..) -- imp:   (impression opportunity),  --       local function can_be_shown(deal, imp) local targeting = deal.targeting --    if not targeting then return true end --         -- (,    ,   ): if targeting.media_type then if not passes_targeting(targeting.media_type, imp.details.media_type) then return false end end --        : if targeting.size then if not passes_targeting(targeting.size, imp.details.sizes) then return false end end return true end</span></span></code> </pre> <br>  Y as√≠ es como se ve un controlador simple (controlador de eventos). <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> adm_cache = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'modules.adm_cache'</span></span> <span class="hljs-comment"><span class="hljs-comment">-- adm = "ad markup" local config = require 'modules.config' local util = require 'modules.util' local AbstractHandler = require 'handlers.abstract' local ImpRenderHandler = AbstractHandler:new({is_server_request = false}) local IMP_RENDER_TEMPLATE = config.get('imp_render_template') local IMP_RENDER_BILLING = {name = 'free', type = 'in'} --   ,  . --   ( ,   ) . --          . function ImpRenderHandler:handle(params) local user_id = self.uuid local cache_id = get_param('id') if not cache_id or cache_id == '' then return self:process_bad_request({reason = '"id" parameter is expected', user_id = user_id}) end local adm = adm_cache.get(cache_id) if not adm then return self:process_bad_request({reason = 'No adm in cache', user_id = user_id}) end update_billing(IMP_RENDER_BILLING) self:log_request('imp_render', {adm = adm, user_id = user_id, cache_id = cache_id}) local content = util.expand_macro(IMP_RENDER_TEMPLATE, {ADM = adm}) return {200, content = content} end return ImpRenderHandler</span></span></code> </pre> <br>  La simplicidad de Lua no solo proporciona un desarrollo r√°pido, sino que tambi√©n le permite hacer mucho trabajo con poco esfuerzo.  La plataforma IPONWEB es una soluci√≥n general que se adapta a las necesidades de un cliente en particular, mientras que un desarrollador y un gerente pueden llevar a cabo el proyecto.  Leer el c√≥digo en Lua puede no solo a los propios desarrolladores, sino tambi√©n a los gerentes de proyectos y, a veces, a los clientes.  Juntos, descubrimos r√°pidamente el problema, encontramos su causa y soluci√≥n.  A menudo, el gerente del proyecto informa al desarrollador sobre el problema e inmediatamente sugiere una forma de resolverlo. <br><br>  Al mismo tiempo, la simplicidad de Lua puede ser enga√±osa, mientras que el minimalismo y la compacidad tienen un inconveniente.  Si el c√≥digo est√° escrito, por ejemplo, en Perl o Python, el desarrollador tiene a su disposici√≥n enormes repositorios de m√≥dulos listos para usar, Ruby tiene RubyGems y muchos otros idiomas tienen repositorios ricos.  Y Lua tiene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LuaRocks</a> y los tres mil m√≥dulos que yacen all√≠.  Adem√°s, incluso si LuaRocks tiene el m√≥dulo correcto, es muy probable que tenga que trabajar duro para usarlo en una empresa en particular.  Lua proporciona buenas herramientas para crear un entorno seguro para ejecutar c√≥digo (sandboxes), y cuando se trabaja en sandboxes, algunas funciones se pueden deshabilitar.  Esto significa que los m√≥dulos LuaRocks pueden no funcionar si usan funciones que est√°n bloqueadas por el entorno seguro de la compa√±√≠a.  Este es el precio de la compacidad y la capacidad de integraci√≥n, pero vale la pena: los lenguajes con bater√≠as, como, por ejemplo, Python, se construyen de una manera no m√°s complicada que Lua. <br><br><h3>  Como funciona </h3><br>  La base de nuestra plataforma es un servidor HTTP personalizable con una API conveniente y extensible que proporciona un conjunto de funciones para el desarrollador de Lua y se adapta a las tareas del mercado publicitario.  Este servidor procesa cientos de millones de solicitudes y escribe terabytes de registros por d√≠a.  Las solicitudes entrantes se distribuyen uniformemente entre los hilos del sistema, y ‚Äã‚Äãdentro de los hilos del sistema hay cajas de arena. <br><br><img src="https://habrastorage.org/webt/ee/bx/sn/eebxsntveokgzzaz2ffyplaconc.png" alt="imagen"><br><br>  Cuando llega una solicitud al servidor, se crea una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rutina</a> dentro del entorno limitado en el que cay√≥ esta solicitud, que procesa la solicitud.  Las rutinas funcionan independientemente unas de otras, cada una de las que se est√° creando se pone en cola para su ejecuci√≥n.  La vida √∫til de cada rutina (el tiempo de procesamiento total de la solicitud, teniendo en cuenta la respuesta esperada de los servicios involucrados: base de datos, m√©tricas, servidor de presupuesto) no debe exceder los 120 milisegundos. <br><br><img src="https://habrastorage.org/webt/cz/sk/d3/czskd3si2n2k2mott6inf7f9qtk.png"><br><br>  En resumen, el proceso de procesamiento de solicitudes se puede describir de la siguiente manera: <br><br><ol><li>  Cada solicitud recibida se analiza y pasa un chequeo est√°ndar para su correcci√≥n. </li><li>  Se lanza Corutin, que se encarga de procesar esta solicitud.  Dentro de cada caja de arena, hay muchas corutinas en diferentes estados. </li><li>  Comienza el procesamiento de solicitudes, que puede tener dos resultados: <br><ul><li>  Procesamiento completado con √©xito. </li><li>  Corutin transfiere el control al servidor.  Esto generalmente ocurre cuando la rutina est√° esperando una respuesta de otros servicios.  En tales casos, el trabajo de la corutina se suspende hasta que llegue una respuesta o expire el tiempo de espera.  Al transferir el control, el servidor comienza a procesar la siguiente solicitud.  Puede ser una nueva solicitud o una solicitud que recibe una respuesta de todos los servicios involucrados y est√° lista para continuar ejecutando el c√≥digo.  El orden de procesamiento de las solicitudes est√° determinado por los requisitos de la l√≥gica empresarial. </li></ul></li></ol><br><img src="https://habrastorage.org/webt/bp/jv/gg/bpjvgg7pkb_394aojxgg2ykskqg.png"><br>  El uso de corutina es otro tema interesante que merece una discusi√≥n detallada.  Por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este art√≠culo</a> detalla c√≥mo se pueden utilizar las corutinas para crear escenas en videojuegos.  Y las rutinas en el servidor de aplicaciones deber√≠an dedicar un art√≠culo separado, y quiz√°s en el futuro lo hagamos. <br><br><h3>  Que sigue </h3><br>  Y luego, quiz√°s, se ampliar√° el uso de Lua en IPONWEB.  Tenemos ideas sobre c√≥mo puede seguir utilizando Lua en nuestro negocio, y cuando se implementen estas ideas, definitivamente compartiremos nuevas experiencias.  La conveniencia y las capacidades de Lua como lenguaje de script integrado pueden ayudarnos, en particular, a acelerar el procesamiento de los datos del cliente.  Pero esto todav√≠a es del campo de los planes y las perspectivas. <br><br>  En resumen, podemos decir que nuestra elecci√≥n del lenguaje de la l√≥gica empresarial, realizada hace 11 a√±os, contin√∫a justific√°ndose, permiti√©ndonos hacer frente con √©xito a nuestras propias tareas comerciales y ayudarnos a resolver los problemas de nuestros clientes.  F√°cil de leer, f√°cil de integrar, r√°pido y f√°cil de aprender, Lua ha sido y sigue siendo uno de los mejores lenguajes de secuencias de comandos, cuyo alcance no se limita en modo alguno al desarrollo de juegos.  La l√≥gica empresarial de IPONWEB escrita en √©l es solo un ejemplo de esto. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/469049/">https://habr.com/ru/post/469049/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../469037/index.html">Controlador industrial. Sistema de recolecci√≥n de datos. ACS</a></li>
<li><a href="../469039/index.html">M√°s que un juego: dominar Mahjong con IA y aprendizaje autom√°tico</a></li>
<li><a href="../469041/index.html">¬øC√≥mo proteger su sistema ERP?</a></li>
<li><a href="../469043/index.html">C / C ++ de Python (C API)</a></li>
<li><a href="../469045/index.html">Python en Visual Studio Code - Versi√≥n de septiembre de 2019</a></li>
<li><a href="../469051/index.html">El conector de Azure Cloud Shell en el terminal de Windows</a></li>
<li><a href="../469053/index.html">Una nueva serie de videos para principiantes para aprender programaci√≥n Python</a></li>
<li><a href="../469055/index.html">Practica zen en espacios abiertos</a></li>
<li><a href="../469059/index.html">¬øQu√© hay de nuevo en ML.NET y Model Builder?</a></li>
<li><a href="../469061/index.html">Versi√≥n Rust 1.38.0: compilaci√≥n canalizada, # [en desuso] para macros y std :: any :: type_name</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>