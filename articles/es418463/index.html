<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👍 🤰🏽 🐦 Trabajando con datos en Angular 🏼 🤞🏻 🤰🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos, mi nombre es Sergey y soy desarrollador web. Perdóname Dmitry Karlovsky por la introducción prestada, pero fueron sus publicaciones las ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Trabajando con datos en Angular</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418463/"><p>  Hola a todos, mi nombre es Sergey y soy desarrollador web.  Perdóname <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dmitry Karlovsky</a> por la introducción prestada, pero fueron sus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">publicaciones las</a> que me inspiraron a escribir este artículo. </p><br><p>  Hoy me gustaría hablar sobre trabajar con datos en aplicaciones <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">angulares</a> en general y modelos de dominio en particular. </p><a name="habracut"></a><br><p>  Supongamos que tenemos una lista de usuarios que recibimos del servidor en el formulario </p><br><pre><code class="hljs json">[ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"first_name"</span></span>: <span class="hljs-string"><span class="hljs-string">"James"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"last_name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Hetfield"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"position"</span></span>: <span class="hljs-string"><span class="hljs-string">"Web developer"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">"first_name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Elvis"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"last_name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"position"</span></span>: <span class="hljs-string"><span class="hljs-string">"Project manager"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"first_name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Steve"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"last_name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Vai"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"position"</span></span>: <span class="hljs-string"><span class="hljs-string">"QA engineer"</span></span> } ]</code> </pre> <br><p>  y necesitas mostrarlo como en la imagen </p><br><p><img src="https://habrastorage.org/webt/k9/ck/_2/k9ck_2oagut_woosbkn9zzar4ku.png" alt="Lista de usuarios"></p><br><p>  Parece fácil, intentémoslo.  Por supuesto, para obtener esta lista, tendremos un servicio de <code>UserService</code> siguiente.  Tenga en cuenta que el enlace al avatar del usuario no aparece inmediatamente en la respuesta, sino que se forma en función de la <code>id</code> usuario. </p><br><pre> <code class="hljs pgsql">// UserService <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Injectable} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {HttpClient} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/common/http'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Observable} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {UserServerResponse} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./user-server-response.interface'</span></span>; @Injectable() export <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> UserService { constructor(private http: HttpClient) { } getUsers(): Observable&lt;UserServerResponse[]&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> this.http.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>&lt;UserServerResponse[]&gt;(<span class="hljs-string"><span class="hljs-string">'/users'</span></span>); } getUserAvatar(userId: number): string { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> `/users/${userId}/avatar`; } }</code> </pre> <br><p>  El componente <code>UserListComponent</code> será responsable de mostrar la lista de usuarios. </p><br><pre> <code class="hljs django"><span class="xml"><span class="xml">// UserListComponent import {Component} from '@angular/core'; import {UserService} from '../services/user.service'; @Component({ selector: 'app-user-list', template: ` </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> *</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ngFor</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"let user of users | async"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">img</span></span></span></span><span class="xml"><span class="hljs-tag"> [</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">]=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"userService.getUserAvatar(user.id)"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">b</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{user.first_name}}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{user.last_name}}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">b</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{user.position}}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ` }) export class UserListComponent { users = this.userService.getUsers(); constructor(public userService: UserService) { } }</span></span></code> </pre> <br><p>  Y aquí ya teníamos un <strong>problema definido</strong> .  Presta atención a la respuesta del servidor.  El campo <code>last_name</code> puede estar vacío y si dejamos el componente en este formulario, recibiremos espacios no deseados antes de la coma.  ¿Cuáles son las opciones de solución? </p><br><ol><li><p>  Puede corregir ligeramente la plantilla de visualización </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>{{[user.first_name, user.last_name].filter(el =&gt; !!el).join(' ')}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>, {{user.position}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Pero de esta manera, sobrecargamos la plantilla con lógica, y se vuelve poco legible incluso para una tarea tan simple.  Pero la aplicación todavía tiene que crecer y crecer ... </p><br></li><li><p>  Extraiga el código de una plantilla a una clase de componente agregando un método de tipo </p><br><pre> <code class="hljs pgsql">getUserFullName(<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>: UserServerResponse): string { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.first_name, <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.last_name].<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>(el =&gt; !!el).<span class="hljs-keyword"><span class="hljs-keyword">join</span></span>(<span class="hljs-string"><span class="hljs-string">' '</span></span>); }</code> </pre> <br><p>  Ya es mejor, pero lo más probable es que el nombre de usuario completo no se muestre en un lugar de la aplicación, y tendremos que duplicar este código.  Puede llevar este método del componente al servicio.  De esta manera, eliminaremos la posible duplicación de código, pero tampoco me gusta esta opción.  Y no me gusta porque resulta que alguna entidad más general ( <code>UserService</code> ) debería saber sobre la estructura de la entidad de <code>User</code> más pequeña que se le pasa.  No es su nivel de responsabilidad, me parece. </p><br></li></ol><br><p>  En mi opinión, el problema surge principalmente del hecho de que tratamos la respuesta del servidor únicamente como un conjunto de datos.  Aunque, de hecho, es una lista de entidades del área temática de nuestra aplicación, una lista de usuarios.  Y si estamos hablando de trabajar con entidades, entonces vale la pena usar las herramientas más adecuadas para esto: los métodos de programación orientada a objetos. </p><br><p>  Comencemos creando la clase Usuario </p><br><pre> <code class="hljs powershell">// User export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span></span> { readonly id; readonly firstName; readonly lastName; readonly position; constructor(userData: UserServerResponse) { this.id = userData.id; this.firstName = userData.first_name; this.lastName = userData.last_name; this.position = userData.position; } fullName(): string { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-type"><span class="hljs-type">this.firstName</span></span>, <span class="hljs-type"><span class="hljs-type">this.lastName</span></span>].filter(el =&gt; !!el).join(<span class="hljs-string"><span class="hljs-string">' '</span></span>); } avatar(): string { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> `/users/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{this.id}/avatar`; } }</code> </pre> <br><p>  El constructor de la clase es un deserializador de respuesta del servidor.  La lógica para determinar el nombre de usuario completo se convierte naturalmente en un método de un objeto de la clase <code>User</code> , así como la lógica para obtener un avatar.  Ahora <code>UserService</code> el <code>UserService</code> para que nos devuelva objetos de la clase <code>User</code> como resultado del procesamiento de la respuesta del servidor </p><br><pre> <code class="hljs pgsql">// UserService <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Injectable} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {HttpClient} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/common/http'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {map} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/operators'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {UserServerResponse} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./user-server-response.interface'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./user.model'</span></span>; @Injectable() export <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> UserService { constructor(private http: HttpClient) { } getUsers(): Observable&lt;<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>[]&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> this.http.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>&lt;UserServerResponse[]&gt;(<span class="hljs-string"><span class="hljs-string">'/users'</span></span>) .pipe(map(listOfUsers =&gt; listOfUsers.map(singleUser =&gt; <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>(singleUser)))); } }</code> </pre> <br><p>  Como resultado, el código de nuestro componente se vuelve mucho más limpio y más legible.  Todo lo que se puede llamar lógica de negocios está encapsulado en modelos y es completamente reutilizable. </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Component} from <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {UserService} from <span class="hljs-string"><span class="hljs-string">'../services/user.service'</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Component({ selector: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'app-user-list'</span></span></span><span class="hljs-meta">, template: ` &lt;div *ngFor=</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"let user of users | async"</span></span></span><span class="hljs-meta">&gt; &lt;img [src]=</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"user.avatar()"</span></span></span><span class="hljs-meta">&gt; &lt;p&gt;&lt;b&gt;{{user.fullName()</span></span>}}&lt;/b&gt;, {{user.position}}&lt;/p&gt; &lt;/div&gt; ` }) export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserListComponent</span></span></span><span class="hljs-class"> </span></span>{ users = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userService.getUsers(); <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> userService: UserService) { } }</code> </pre> <br><p>  Expandamos ahora las capacidades de nuestro modelo.  En teoría (en este contexto, me gusta la analogía con el patrón <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>ActiveRecord</code></a> ), los objetos del modelo de usuario deben ser responsables no solo de obtener datos sobre sí mismos, sino también de cambiarlos.  Por ejemplo, podemos cambiar la imagen de perfil del usuario.  ¿Cómo se verá el modelo de usuario ampliado con tal funcionalidad? </p><br><pre> <code class="hljs powershell">// User export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span></span> { // ... constructor(userData: UserServerResponse, private http: HttpClient, private storage: StorageService, private auth: AuthService) { // ... } // ... updateAvatar(file: Blob) { const <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = new FormData(); data.append(<span class="hljs-string"><span class="hljs-string">'avatar'</span></span>, file); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> this.http.put(`/users/<span class="hljs-variable"><span class="hljs-variable">$</span></span>{this.id}/avatar`, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>); } }</code> </pre> <br><p>  Se ve bien, pero el modelo de <code>User</code> ahora usa el servicio <code>HttpClient</code> y, en términos generales, puede conectarse y usar varios otros servicios, en este caso, <code>AuthService</code> y <code>AuthService</code> (no se usan, sino que se agregan solo, por ejemplo).  Resulta que si queremos usar el modelo de <code>User</code> en algún otro servicio o componente, tendremos que conectar todos los servicios asociados con él para crear objetos de este modelo.  Parece muy inconveniente ... Puede usar el servicio de <code>Injector</code> (por supuesto, también tendrá que implementarse, pero se garantizará que sea solo uno) o incluso crear una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://stackoverflow.com/questions/49507928/how-to-inject-">entidad de inyector externo</a> que no tenga que implementar, pero veo la forma más correcta de delegar la creación de objetos de clase de <code>User</code> al servicio <code>UserService</code> servicio de <code>UserService</code> misma manera él es responsable de obtener la lista de usuarios. </p><br><pre> <code class="hljs pgsql">// UserService <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Injectable} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {HttpClient} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/common/http'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Observable} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {map} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/operators'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {UserServerResponse} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./user-server-response.interface'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./user.model'</span></span>; @Injectable() export <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> UserService { constructor(private http: HttpClient, private <span class="hljs-keyword"><span class="hljs-keyword">storage</span></span>: StorageService, private auth: AuthService) { } createUser(userData: UserServerResponse) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>(userData, this.http, this.<span class="hljs-keyword"><span class="hljs-keyword">storage</span></span>, this.auth); } getUsers(): Observable&lt;<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>[]&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> this.http.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>&lt;UserServerResponse[]&gt;(<span class="hljs-string"><span class="hljs-string">'/users'</span></span>) .pipe(map(listOfUsers =&gt; listOfUsers.map(singleUser =&gt; this.createUser(singleUser)))); } }</code> </pre> <br><p>  Por lo tanto, trasladamos el método de creación de usuarios a <code>UserService</code> , que ahora es más apropiado para llamar a la fábrica, y cambiamos todo el trabajo de implementar dependencias a los hombros de Angular: solo necesitamos conectar el <code>UserService</code> en el constructor. </p><br><p>  Al final, eliminemos la duplicación de los nombres de los métodos e introduzcamos convenciones para los nombres de las dependencias inyectadas.  La versión final del servicio en mi visión debería verse así. </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Injectable} from <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {HttpClient} from <span class="hljs-string"><span class="hljs-string">'@angular/common/http'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Observable} from <span class="hljs-string"><span class="hljs-string">'rxjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {map} from <span class="hljs-string"><span class="hljs-string">'rxjs/operators'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {UserServerResponse} from <span class="hljs-string"><span class="hljs-string">'./user-server-response.interface'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {User} from <span class="hljs-string"><span class="hljs-string">'./user.model'</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Injectable()</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> http: HttpClient, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> storage: StorageService, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> auth: AuthService) { } create(userData: UserServerResponse) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> new User(userData, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.http, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.storage, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.auth); } list(): Observable&lt;User[]&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.http.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>&lt;UserServerResponse[]&gt;(<span class="hljs-string"><span class="hljs-string">'/users'</span></span>) .pipe(map(listOfUsers =&gt; listOfUsers.map(singleUser =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.create(singleUser)))); } }</code> </pre> <br><p>  Y se propone implementar <code>UserFactory</code> bajo el nombre de <code>User</code> </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {HttpClient} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/common/http'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {UserFactory} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./services/user.service'</span></span>; @Component({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">'app-root'</span></span>, <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'./app.component.html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">styleUrls</span></span>: [<span class="hljs-string"><span class="hljs-string">'./app.component.css'</span></span>] }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppComponent</span></span></span><span class="hljs-class"> </span></span>{ title = <span class="hljs-string"><span class="hljs-string">'app'</span></span>; users = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.User.list(); <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private User: UserFactory) { } }</code> </pre> <br><p>  En este caso, un objeto de la clase <code>UserFactory</code> parece a una clase <code>User</code> con métodos estáticos para obtener una lista de usuarios y un método especial para crear nuevas entidades, y sus objetos contienen todos los métodos de lógica de negocios necesarios asociados con una entidad en particular. </p><br><p>  Sobre esto, le dije todo lo que quería.  Espero discutir en los comentarios. </p><br><h3 id="update">  Actualización </h3><br><p>  Quería expresar mi gratitud a todos los que comentan.  Usted notó correctamente que para resolver el problema de mostrar el nombre, valdría la pena usar <code>Pipe</code> .  Estoy completamente de acuerdo y me sorprende que no haya tomado esta decisión.  Sin embargo, el objetivo principal del artículo es mostrar un ejemplo de creación de un modelo de dominio (en este caso, <code>User</code> ), que podría encapsular convenientemente toda la lógica de negocios asociada con su esencia.  Paralelamente, traté de resolver el problema que lo acompaña con la inyección de dependencia. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es418463/">https://habr.com/ru/post/es418463/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es418451/index.html">Lecciones de impresión 3D. Soporte efectivo y cambio de altura de capa en la práctica desde 3Dtool</a></li>
<li><a href="../es418453/index.html">Las observaciones de GRAVEDAD validan aún más la relatividad general</a></li>
<li><a href="../es418455/index.html">Webinar abierto "Especialista en el timón: primera experiencia y errores"</a></li>
<li><a href="../es418457/index.html">Mensaje de agradecimiento: día del administrador del sistema</a></li>
<li><a href="../es418459/index.html">Desarrollo de escalador LVDS con dos interfaces DisplayPort</a></li>
<li><a href="../es418465/index.html">Descubrió una nueva opción de ataque Spectre con la capacidad de recibir datos de forma remota a través de la red</a></li>
<li><a href="../es418467/index.html">Clasificación de los desarrolladores de artes marciales.</a></li>
<li><a href="../es418469/index.html">Cuándo no usar algoritmos STL. Poner ejemplo</a></li>
<li><a href="../es418475/index.html">Windows 10 utiliza tecnología de aprendizaje automático para determinar si es posible la actualización</a></li>
<li><a href="../es418477/index.html">Conferencia DEFCON 23. Cómo perdí mi segundo ojo, o más investigación sobre la destrucción de datos. Parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>