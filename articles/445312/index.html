<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ざ   Asignaci贸n de memoria JVM 锔  </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! Queremos coincidir la traducci贸n del material de hoy con el lanzamiento de un nuevo hilo en el curso Java Developer , que comienza ma帽an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Asignaci贸n de memoria JVM</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/445312/"> Hola a todos!  Queremos coincidir la traducci贸n del material de hoy con el lanzamiento de un nuevo hilo en el curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Java Developer</a> , que comienza ma帽ana.  Bueno, empecemos. <br><br>  JVM puede ser una bestia compleja.  Afortunadamente, la mayor parte de esta complejidad est谩 oculta bajo el cap贸, y nosotros, como desarrolladores de aplicaciones y responsables de la implementaci贸n, a menudo no tenemos que preocuparnos mucho por eso.  Aunque debido a la creciente popularidad de la tecnolog铆a para implementar aplicaciones en contenedores, vale la pena prestar atenci贸n a la asignaci贸n de memoria en la JVM. <br><br><img src="https://habrastorage.org/webt/ju/oj/ek/juojekjvyfc9pflhqawoxksp-pe.png"><br><br>  <b>Dos tipos de memoria</b> <br><br>  La JVM divide la memoria en dos categor铆as principales: heap y no heap.  Un mont贸n es una pieza de memoria JVM con la que los desarrolladores est谩n m谩s familiarizados.  Los objetos creados por la aplicaci贸n se almacenan aqu铆.  Permanecen all铆 hasta que el recolector de basura los retire.  Por lo general, el tama帽o de almacenamiento din谩mico que usa la aplicaci贸n var铆a seg煤n la carga actual. <br><a name="habracut"></a><br>  La memoria fuera del mont贸n se divide en varias 谩reas.  En HotSpot, puede usar el mecanismo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">seguimiento de memoria nativa (NMT)</a> para explorar las 谩reas de esta memoria.  Tenga en cuenta que aunque NMT no rastrea el uso de toda la memoria nativa ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">por ejemplo, no rastrea la asignaci贸n de memoria nativa por c贸digo de terceros</a> ), sus capacidades son suficientes para la mayor铆a de las aplicaciones t铆picas de Spring.  Para usar NMT, ejecute la aplicaci贸n con la <code>-XX:NativeMemoryTracking=summary</code> y usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">jcmd VM.native_memory summary ver informaci贸n sobre la memoria utilizada.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><br><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Veamos el uso de NMT como ejemplo de nuestro viejo amigo Petclinic</a> .  El siguiente diagrama muestra el uso de la memoria JVM de acuerdo con los datos de NMT (menos su propia sobrecarga de NMT) al iniciar Petclinic con un tama帽o de <code>-Xmx48M</code> din谩mico m谩ximo de 48 MB ( <code>-Xmx48M</code> ): <br><br><img src="https://habrastorage.org/webt/m8/nk/be/m8nkberjczog7bolri8lwoglbbm.png"><br><br>  Como puede ver, la memoria fuera del mont贸n representa la mayor parte de la memoria JVM utilizada, y la memoria del mont贸n es solo una sexta parte del total.  En este caso, son aproximadamente 44 MB (de los cuales 33 MB se usaron inmediatamente despu茅s de la recolecci贸n de basura).  El uso de memoria fuera del mont贸n totaliz贸 223 MB. <br><br>  <b>reas de memoria nativa</b> <br><br>  <b>Espacio de clase comprimido</b> : se utiliza para almacenar informaci贸n sobre clases cargadas.  Limitado al par谩metro <code>MaxMetaspaceSize</code> .  Una funci贸n del n煤mero de clases que se han cargado. <br><br>  <i>Nota del traductor</i> <br><br><blockquote>  Por alguna raz贸n, el autor escribe sobre el espacio de clase comprimido, y no sobre el 谩rea de clase completa.  El 谩rea de espacio de clase comprimido es parte del 谩rea de clase, y el par谩metro <code>MaxMetaspaceSize</code> limita el tama帽o del 谩rea de clase completa, no solo el espacio de clase comprimido.  Para limitar el "espacio de clase comprimido", se utiliza el par谩metro <code>CompressedClassSpaceSize</code> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Desde aqu铆</a> : <br>  Si <code>UseCompressedOops</code> est谩 activado y se usa <code>UseCompressedClassesPointers</code> , entonces se usan dos 谩reas l贸gicamente diferentes de memoria nativa para los metadatos de la clase ... <br>  Se asigna una regi贸n para estos punteros de clase comprimidos (los desplazamientos de 32 bits).  El tama帽o de la regi贸n se puede establecer con <code>CompressedClassSpaceSize</code> y es de 1 gigabyte (GB) de forma predeterminada ... <br>  <code>MaxMetaspaceSize</code> aplica a la suma del espacio de clase comprimido comprometido y el espacio para los metadatos de la otra clase <br><br>  Si el par谩metro <code>UseCompressedOops</code> est谩 <code>UseCompressedOops</code> y <code>UseCompressedOops</code> usa <code>UseCompressedOops</code> , entonces <code>UseCompressedOops</code> usan dos 谩reas l贸gicamente diferentes de memoria nativa para los metadatos de la clase ... <br><br>  Para punteros comprimidos, se asigna un 谩rea de memoria (compensaciones de 32 bits).  <code>CompressedClassSpaceSize</code> puede establecer el tama帽o de esta 谩rea y, de forma predeterminada, es de 1 GB ... <br>  El par谩metro <code>MaxMetaspaceSize</code> se refiere a la suma del 谩rea del puntero comprimido y el 谩rea para otros metadatos de clase. </blockquote><br><br><ul><li>  Subproceso: la memoria utilizada por subprocesos en la JVM.  La funci贸n del n煤mero de subprocesos en ejecuci贸n. </li><li>  Cach茅 de c贸digo: la memoria utilizada por JIT para ejecutarlo.  Una funci贸n del n煤mero de clases que se han cargado.  Limitado a <code>ReservedCodeCacheSize</code> .  Puede reducir la configuraci贸n de JIT, por ejemplo, deshabilitando la compilaci贸n escalonada. </li><li>  GC (recolector de basura): almacena los datos utilizados por el recolector de basura.  Depende del recolector de basura utilizado. </li><li>  S铆mbolo: almacena caracteres como nombres de campo, firmas de m茅todos y cadenas internados.  El uso excesivo de la memoria de caracteres puede indicar que las l铆neas est谩n demasiado internados. </li><li>  Interno: almacena otros datos internos que no est谩n incluidos en ninguna de las otras 谩reas. </li></ul><br>  <b>Las diferencias</b> <br><br>  En comparaci贸n con un mont贸n, la memoria fuera del mont贸n cambia menos bajo carga.  Una vez que la aplicaci贸n haya cargado todas las clases que se utilizar谩n y el JIT est茅 completamente calentado, todo pasar谩 a un estado estable.  Para ver una disminuci贸n en el uso del <i>espacio de clases comprimido</i> , el recolector de basura debe eliminar el cargador de clases que carg贸 las clases.  Esto era com煤n en el pasado cuando las aplicaciones se implementaban en contenedores de servlets o servidores de aplicaciones (el recolector de basura elimin贸 el cargador de clases de aplicaciones cuando la aplicaci贸n se elimin贸 del servidor de aplicaciones), pero esto rara vez ocurre con los enfoques modernos para la implementaci贸n de aplicaciones. <br><br>  <b>Configurar JVM</b> <br><br>  Configurar la JVM para usar eficientemente la RAM disponible no es f谩cil.  Si ejecuta la JVM con el par谩metro <code>-Xmx16M</code> y no espera <code>-Xmx16M</code> m谩s de 16 MB de memoria, obtendr谩 una sorpresa desagradable. <br><br>  Un 谩rea interesante de la memoria JVM es el cach茅 de c贸digo JIT.  Por defecto, HotSpot JVM usar谩 hasta 240 MB.  Si el cach茅 de c贸digo es demasiado peque帽o, el JIT puede no tener suficiente espacio para almacenar sus datos y, como resultado, se reducir谩 el rendimiento.  Si el cach茅 es demasiado grande, entonces la memoria puede desperdiciarse.  Al determinar el tama帽o de un cach茅, es importante tener en cuenta su efecto tanto en el uso de la memoria como en el rendimiento. <br><br>  Cuando se ejecuta en un contenedor Docker, las 煤ltimas versiones de Java <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ahora</a> son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">conscientes</a> de las limitaciones de memoria del contenedor y est谩n tratando de cambiar el tama帽o de la memoria JVM en consecuencia.  Desafortunadamente, a menudo se asigna mucha memoria fuera del mont贸n y no hay suficiente en el mont贸n.  Supongamos que tiene una aplicaci贸n ejecut谩ndose en un contenedor con 2 procesadores y 512 MB de memoria disponible.  Desea manejar m谩s carga de trabajo y aumentar el n煤mero de procesadores a 4 y la memoria a 1 GB.  Como discutimos anteriormente, el tama帽o del almacenamiento din谩mico generalmente var铆a con la carga, y la memoria fuera del almacenamiento din谩mico cambia significativamente menos.  Por lo tanto, esperamos que la mayor铆a de los 512 MB adicionales se asignen al mont贸n para manejar el aumento de carga.  Desafortunadamente, por defecto, la JVM no har谩 esto y distribuir谩 memoria adicional de manera m谩s o menos uniforme entre la memoria en el mont贸n y fuera del mont贸n. <br><br>  Afortunadamente, el equipo de CloudFoundry tiene un amplio conocimiento de la asignaci贸n de memoria en la JVM.  Si descarga aplicaciones a CloudFoundry, el paquete de compilaci贸n le aplicar谩 autom谩ticamente este conocimiento.  Si no est谩 utilizando CloudFoudry o desea obtener m谩s informaci贸n sobre c贸mo configurar JVM, se recomienda leer la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">descripci贸n de la</a> tercera versi贸n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la calculadora de memoria</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Java buildpack</a> . <br><br>  <b>驴Qu茅 significa esto para la primavera?</b> <br><br>  El equipo de Spring pasa mucho tiempo pensando en el rendimiento y el uso de la memoria, considerando la posibilidad de usar la memoria tanto en el mont贸n como fuera del mismo.  Una forma de limitar el uso de memoria fuera del mont贸n es hacer que las partes del marco sean lo m谩s vers谩tiles posible.  Un ejemplo de esto es usar Reflection para crear e inyectar dependencias en los beans de su aplicaci贸n.  Mediante el uso de Reflection, la cantidad de c贸digo marco que usa permanece constante, independientemente de la cantidad de beans en su aplicaci贸n.  Para optimizar el tiempo de inicio, utilizamos el cach茅 en el mont贸n, borrando este cach茅 despu茅s de que se complete el inicio.  El recolector de basura puede limpiar f谩cilmente la memoria del mont贸n para proporcionar m谩s memoria disponible para su aplicaci贸n. <br><br>  Tradicionalmente, esperamos sus comentarios sobre el material. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/445312/">https://habr.com/ru/post/445312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445300/index.html">Noticias de la industria del juego (11-25 de marzo de 2019)</a></li>
<li><a href="../445302/index.html">"Juego de Tronos, sigue adelante". Lo que Apple mostr贸 hoy en su evento Show Time</a></li>
<li><a href="../445304/index.html">Programaci贸n LibreOffice Base. Parte 2</a></li>
<li><a href="../445308/index.html">Caracter铆sticas de las pruebas de hip贸tesis para aplicaciones m贸viles.</a></li>
<li><a href="../445310/index.html">El soberano Runet subi贸 de precio a billion30 mil millones</a></li>
<li><a href="../445314/index.html">驴Por qu茅 es dif铆cil extraer asteroides?</a></li>
<li><a href="../445316/index.html">DevDay Administrar TI. Grabaci贸n de rendimiento</a></li>
<li><a href="../445318/index.html">Trampa (lona) para conexiones SSH entrantes</a></li>
<li><a href="../445320/index.html">Los discos ruedan y ruedan</a></li>
<li><a href="../445322/index.html">Amplia selecci贸n de recursos 煤tiles para gerentes de producto.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>