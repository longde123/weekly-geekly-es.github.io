<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë©‚Äçüëß‚Äçüëß üîß üë®üèº‚Äçü§ù‚Äçüë®üèª O que voc√™ √©, fechamentos em JavaScript? üê∑ üñïüèø üôãüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, tentarei analisar em detalhes o mecanismo para implementar fechamentos em JavaScript. Para isso, usarei o navegador Chrome. 

 Vamos com...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O que voc√™ √©, fechamentos em JavaScript?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459166/">  Neste artigo, tentarei analisar em detalhes o mecanismo para implementar fechamentos em JavaScript.  Para isso, usarei o navegador Chrome. <br><br>  Vamos come√ßar com a defini√ß√£o: <br><blockquote>  <b>Encerramentos</b> s√£o fun√ß√µes que referenciam vari√°veis ‚Äã‚Äãindependentes (livres).  Em outras palavras, a fun√ß√£o definida no fechamento 'lembra' o ambiente em que foi criada. </blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MDN</a> <br><br>  Se algo n√£o estiver claro para voc√™ nesta defini√ß√£o, n√£o ser√° assustador.  Apenas continue a ler. <br><br>  Estou profundamente convencido de que entender algo √© mais f√°cil e r√°pido com exemplos espec√≠ficos. <br><br>  Portanto, sugiro pegar um peda√ßo de c√≥digo e acompanh√°-lo com o int√©rprete do come√ßo ao fim em etapas e resolver o que est√° acontecendo. <br><br>  Ent√£o, vamos come√ßar: <br><br><img src="https://habrastorage.org/webt/o_/pi/wo/o_piwoknty0bjixs4sv8ohsw9am.png"><br>  <i>Figura 1</i> <br><a name="habracut"></a><br>  Estamos no contexto global da chamada, √© Global (tamb√©m conhecida como Janela no navegador) e vemos que a fun√ß√£o principal j√° est√° no contexto atual e est√° pronta para funcionar. <br><br><img src="https://habrastorage.org/webt/-i/2i/vv/-i2ivvoyp8qo-f0hq0xf1oezoqu.png"><br>  <i>Figura 2</i> <br><br>  Isso acontece porque todas as Declara√ß√µes de Fun√ß√£o (doravante denominadas DF) sempre s√£o exibidas em qualquer contexto, s√£o imediatamente inicializadas e prontas para o trabalho.  O mesmo acontece com as vari√°veis ‚Äã‚Äãdeclaradas via var, apenas seus valores s√£o inicializados como indefinidos. <br><br>  Tamb√©m √© importante entender que o JavaScript tamb√©m "aumenta" as vari√°veis ‚Äã‚Äãdeclaradas via let e const.  A √∫nica diferen√ßa √© que n√£o os inicializa como var ou como FD.  Portanto, quando tentamos acess√°-los antes da inicializa√ß√£o, obtemos um erro de refer√™ncia. <br><br>  Al√©m disso, em geral, vemos uma propriedade oculta internamente <b>[[Scopes]]</b> - esta √© uma lista de contextos externos aos quais a principal tem acesso.  No nosso caso, Global est√° l√°, pois main √© lan√ßado em um contexto global. <br><br>  O fato de que em JavaScript a inicializa√ß√£o de refer√™ncias ao ambiente externo ocorre no momento em que a fun√ß√£o foi criada, e n√£o no momento da execu√ß√£o, sugere que JS √© uma linguagem com escopo est√°tico.  E isso √© importante. <br><br>  V√° em frente: <br><br><img src="https://habrastorage.org/webt/_h/0w/qx/_h0wqxn3kdigr1j-mry8pvdt2fm.png"><br>  <i>Figura 3</i> <br><cut></cut><br>  Entramos na fun√ß√£o principal e a primeira coisa que chama sua aten√ß√£o √© o objeto Local (na especifica√ß√£o - localEnv).  A√≠ vemos <b>a</b> , <b>uma</b> vez que essa vari√°vel √© declarada via <b>var</b> e 'apareceu', bem, e por tradi√ß√£o vemos todos os 3 FDs (foo, bar, baz).  Agora vamos descobrir de onde tudo veio. <br><br>  Quando qualquer contexto √© iniciado, √© iniciada a opera√ß√£o abstrata <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NewDeclarativeEnvironment</a> , que permite inicializar o <b>LexicalEnvironment</b> (daqui em diante LE) e o <b>VariableEnvironment</b> .  Al√©m disso, <b>NewDeclarativeEnvironment</b> usa 1 argumento - o LE externo, a fim de criar os [[Scopes]] dos quais falamos acima.  LE √© uma API que permite definir o relacionamento entre identificadores e vari√°veis ‚Äã‚Äãindividuais, fun√ß√µes.  LE consiste em 2 componentes: <br><br><ol><li>  <b>Record Environment</b> - um registro de ambiente que permite determinar o relacionamento entre identificadores e o que est√° dispon√≠vel para n√≥s no contexto de chamada atual </li><li>  Link para LE externo.  Cada fun√ß√£o possui uma propriedade <b>[[Scopes]]</b> interna quando √© criada <b>.</b> </li></ol><br>  Ambiente vari√°vel - na maioria das vezes √© o mesmo que LE.  A diferen√ßa entre os dois √© que o valor de VariableEnvironment nunca muda e o LE pode mudar durante a execu√ß√£o do c√≥digo.  Para simplificar o entendimento, proponho combinar esses componentes em um - LE. <br><br>  Tamb√©m no local atual, isso ocorre devido ao fato de que <b>ThisBinding foi chamado</b> - este tamb√©m √© um m√©todo abstrato que inicializa isso no contexto atual. <br><br>  Obviamente, cada DF recebeu imediatamente [[Scopes]]: <br><br><img src="https://habrastorage.org/webt/nz/_t/ap/nz_tapg-wc5fulmh7wtsviyxus8.png"><br><a name="pic4"></a>  <i>Figura 4</i> <br><br>  Vemos que todos os DFs receberam em [[Scopes]] uma matriz de [Closure main, Global], o que √© l√≥gico. <br><cut></cut><br>  Tamb√©m na figura, vemos a <b>pilha de chamadas</b> - essa √© uma estrutura de dados que funciona com o princ√≠pio do LIFO - a √∫ltima a entrar.  Como o JavaScript √© de thread √∫nico, apenas um contexto pode ser executado por vez.  No nosso caso, este √© o contexto da fun√ß√£o principal.  Cada nova chamada de fun√ß√£o cria um novo contexto, que √© empilhado. <br><br>  No topo da pilha est√° sempre o contexto de execu√ß√£o atual.  Depois que a fun√ß√£o conclui sua execu√ß√£o e o int√©rprete sai dela, o contexto de chamada √© removido da pilha.  √â tudo o que precisamos saber sobre a Pilha de chamadas neste artigo :) <br><br>  Resumimos o que aconteceu no contexto atual: <br><br><ul><li>  No momento da cria√ß√£o, o principal recebeu [[Scopes]] com links para o ambiente externo </li><li>  O int√©rprete entrou no corpo da fun√ß√£o principal </li><li>  A pilha de chamadas obteve o contexto de execu√ß√£o principal </li><li>  Isso inicializou </li><li>  LE inicializado </li></ul><br>  De fato, a parte mais dif√≠cil acabou.  Prosseguimos para a pr√≥xima etapa no c√≥digo: <br><br>  Agora precisamos chamar baz para obter o resultado. <br><br><img src="https://habrastorage.org/webt/m4/0x/-i/m40x-if0h9mshfrsqxqv27wgbaw.png"><br><a name="pic5"></a>  <i>Figura 5</i> <br><br>  Um novo contexto de chamada baz foi adicionado √† pilha de chamadas.  Vemos que um novo objeto Closure apareceu.  Aqui temos o que est√° dispon√≠vel para n√≥s em [[Scopes]].  Ent√£o chegamos ao ponto.  Este √© o encerramento.  Como voc√™ v√™ na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Figura 4, o</a> Closure (principal) vai primeiro na lista de contextos de 'backup' no baz.  Mais uma vez n√£o h√° m√°gica. <br><br>  Vamos chamar foo: <br><br><img src="https://habrastorage.org/webt/ln/nd/yg/lnndygmqufofzebonalpko5ro3s.png"><br>  <i>Figura 6</i> <br><br>  √â importante saber que, n√£o importa onde chamemos foo, ele sempre seguir√° os identificadores indefinidos em sua cadeia [[Scopes]].  Ou seja, em main e depois em Global, se n√£o for encontrado em main. <br><br>  Depois de executar foo, ela retornou o valor e seu contexto saltou da pilha de chamadas. <br>  Passamos para a chamada para a fun√ß√£o bar.  No contexto da execu√ß√£o de barras, h√° uma vari√°vel com o mesmo nome que a vari√°vel no LE foo - <b>a</b> .  Mas, como voc√™ j√° adivinhou, isso n√£o afeta nada.  foo ainda ter√° o valor de seus [[Scopes]]. <br><blockquote>  O local da chamada n√£o afeta o escopo, apenas o local de cria√ß√£o </blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">logachyova</a> <br><br><img src="https://habrastorage.org/webt/lx/oe/er/lxoeer85v0udg9ivlztvi6qr8yw.png"><br>  <i>Figura 7</i> <br><br>  Como resultado, o baz retornar√° 300 e ser√° jogado para fora da pilha de chamadas.  Ent√£o o mesmo acontecer√° com o contexto principal, nosso fragmento de c√≥digo terminar√° de executar. <br><br>  Resumimos: <br><br><ul><li>  Durante a cria√ß√£o da fun√ß√£o, <b>[[Scopes]] √© definido</b> .  Isso √© muito importante para entender os fechamentos, pois o int√©rprete segue imediatamente esses links ao procurar valores </li><li>  Em seguida, quando essa fun√ß√£o √© chamada, um contexto de execu√ß√£o ativo √© criado, colocado na pilha de chamadas </li><li>  ThisBinding √© executado e est√° definido para o contexto atual </li><li>  O LE √© inicializado e todos os argumentos das fun√ß√µes, vari√°veis ‚Äã‚Äãdeclaradas por meio de var e FD, ficam dispon√≠veis.  Al√©m disso, se houver vari√°veis ‚Äã‚Äãdeclaradas via let ou const, elas tamb√©m ser√£o adicionadas ao LE </li><li>  Se o int√©rprete n√£o encontrar nenhum identificador no contexto atual, ent√£o <b>[[Scopes]]</b> ser√° usado para pesquisas adicionais, que ser√£o ordenadas sucessivamente.  Se o valor for encontrado, o link para ele cai no objeto Closure especial.  Ao mesmo tempo, para cada contexto em que o atual √© fechado, um <b>encerramento</b> separado √© criado com as vari√°veis ‚Äã‚Äãnecess√°rias </li><li>  Se o valor n√£o for encontrado em nenhum escopo, incluindo Global, um ReferenceError ser√° retornado. </li></ul><br>  Isso √© tudo! <br><br>  Espero que este artigo tenha sido √∫til para voc√™ e agora voc√™ entenda como o mecanismo de bloqueio no JavaScript funciona. <br><br>  Tchau :) E at√© breve.  Curta e assine o meu canal :) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt459166/">https://habr.com/ru/post/pt459166/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt459154/index.html">Rede para pequenas empresas usando equipamentos Cisco. Parte 1</a></li>
<li><a href="../pt459156/index.html">VNIITE do planeta como um todo: como na URSS eles criaram o sistema de ‚Äúcasa inteligente‚Äù</a></li>
<li><a href="../pt459158/index.html">Como o artefato se torna a maior falha da v√°lvula</a></li>
<li><a href="../pt459160/index.html">Como voc√™ escolhe produtos nas lojas?</a></li>
<li><a href="../pt459162/index.html">"Para vencer o campeonato, a equipe deve respirar em un√≠ssono." Entrevista com o Workshops de Moscou, instrutor do ICPC</a></li>
<li><a href="../pt459168/index.html">Navegando pelo Windows Defender de maneira barata e divertida: sess√£o de meterpreter via python</a></li>
<li><a href="../pt459172/index.html">As 13 principais bibliotecas da Scala para an√°lise de dados</a></li>
<li><a href="../pt459174/index.html">Refer√™ncia da fonte de eventos Rx</a></li>
<li><a href="../pt459176/index.html">Fonte de alimenta√ß√£o est√°vel de alta tens√£o para PMT</a></li>
<li><a href="../pt459180/index.html">TheOutloud - D√™ voz e compartilhe seus artigos e hist√≥rias favoritas. Parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>