<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👦‍👦 ⛹🏻 📄 Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo] ↩️ 🍂 👨‍🎨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Monitorar regularmente a velocidade de download de dezenas ou centenas de URLs? Deseja analisar a velocidade de download de sites no setor ou página p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/promopult/blog/471270/"><p>  Monitorar regularmente a velocidade de download de dezenas ou centenas de URLs?  Deseja analisar a velocidade de download de sites no setor ou página por página em seu site?  A inserção de URLs sempre no PageSpeed ​​Insights e a transferência de dados para o Excel são demoradas. </p><br><p>  Encontramos uma solução simples - ela permite que você obtenha métricas do PageSpeed ​​Insights em um cronograma e em uma máquina completa.  A instalação levará de 5 a 10 minutos, mas você economizará horas. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/54/av/h6/54avh6zwawbdvbmcjp_p1q6uejw.png" alt="Automatize o recebimento de dados sobre a velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><a name="habracut"></a><br><p>  Quando estávamos preparando um estudo sobre a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">velocidade de carregamento de sites no comércio eletrônico</a> , ficamos seriamente intrigados com a automação de obter dados do PageSpeed ​​Insights.  Abra todos os URLs no serviço, execute análises, transfira métricas - tudo isso consome muito tempo. </p><br><p>  No <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> James_McNulty para MOZ, encontramos uma solução.  Este artigo apresenta o modelo do Planilhas Google, que usa a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">API</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PageSpeed ​​Insights V5 para</a> calcular os dados da área de trabalho em cinco métricas.  Modificamos o modelo - agora, com sua ajuda, você pode obter dados em oito métricas (não apenas para computadores, mas também para dispositivos móveis). </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nk/vz/zq/nkvzzq0hcrohkbhr_am50r3lqpo.png" alt="Automatize o recebimento de dados sobre a velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><h2>  Por que monitorar a velocidade de carregamento da página </h2><br><p>  Os dados de velocidade de carregamento da página são úteis para otimizadores e desenvolvedores em vários casos: </p><br><ul><li>  Para auditar a velocidade do download no contexto de páginas específicas do site - você pode determinar quais delas atrasam o download; </li><li>  monitorar a velocidade como resultado de alterações no site - para entender como essas ou outras alterações afetaram a velocidade de carregamento da página; </li><li>  para comparação com concorrentes - você entenderá a rapidez com que o site é carregado em comparação com os concorrentes e decide se precisa acelerá-lo ou pode deixá-lo como está por enquanto. </li></ul><br><h2>  Como usar o modelo </h2><br><p>  Primeiro, crie uma cópia do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">modelo da Ferramenta de API do Automated PageSpeed ​​Insights</a> . </p><br><p>  Existem três guias no arquivo (não altere os nomes das guias!): </p><br><ul><li>  Configurações - a chave da API e o cronograma de coleta de dados são indicados aqui. </li><li> Resultados - esta é a planilha na qual os dados são coletados no URL especificado (os dados da planilha são atualizados após cada execução de script). </li><li>  Registro - os dados coletados (inclusive para períodos anteriores) são transferidos para esta planilha. </li></ul><br><h3>  Preparação preliminar do modelo </h3><br><p>  Para uma operação correta, você precisa de: </p><br><ul><li>  obtenha a chave da API, </li><li>  ative a API PageSpeed. </li></ul><br><p>  Para obter uma chave de API, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">vá</a> para a seção "Credenciais" do serviço de APIs do Google e clique no botão "Criar credenciais". </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uf/4v/cw/uf4vcwxoc-dficfqeju_kyclqtg.png" alt="Automatize o recebimento de dados sobre a velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><p>  Na lista suspensa, selecione "Chave da API". </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/d6/ds/ua/d6dsuabwj6cwfkqpevjwhcxqipw.png" alt="Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><p>  Copie a chave gerada. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/en/ao/jz/enaojzeklud0igpwh3i-qzniydo.png" alt="Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><p>  Insira-o no modelo na folha "Configurações". </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nj/su/sw/njsuswhtbe2mdl5mexeesckdy7y.png" alt="Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><p>  Mas o modelo de chave não é suficiente para que a chave funcione - você ainda precisa ativar a API PageSpeed.  Para fazer isso, vá para a página da <a href="">API PageSpeed ​​API</a> e clique no botão "Ativar". </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8u/pk/w3/8upkw3vwsnoym4fg5mnltsal8ji.png" alt="Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><p>  Importante!  Se você não ativar a API PageSpeed, o script no modelo não funcionará e você verá erros na tabela. </p><br><blockquote><p>  Contexto em nível profissional e sem agência - no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sistema PromoPult</a> .  Seleção automática de palavras, geração automática de anúncios, gerenciamento de lances "inteligente".  Soluções prontas para o setor.  Estatísticas em tempo real. </p></blockquote><br><h2>  Recuperando dados do PageSpeed ​​Insights </h2><br><p>  Clique na guia Resultados e insira uma lista de URLs.  Abra o menu Velocidade da página e pressione Relatório de envio manual.  Imediatamente após isso, o script começará a ser executado e, após algum tempo, você receberá os dados. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ts/lj/zv/tsljzvauwdjamarwjmpg8ezmei4.png" alt="Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><p>  As seguintes métricas são coletadas no modelo: </p><br><ul><li>  Tempo de Download da Interação (TTI) </li><li>  FCP (primeiro tempo de carregamento de conteúdo); </li><li>  tempo de carregamento para uma parte suficiente do conteúdo (FMP); </li><li>  tempo de carregamento do primeiro byte (velocidade de resposta do servidor); </li><li>  índice de velocidade de download (índice de velocidade); </li><li>  Hora de término da CPU </li><li>  atraso na primeira entrada; </li><li>  avaliação de desempenho. </li></ul><br><p>  A conclusão bem-sucedida da coleta de dados é indicada pelo status "complete" na linha com o URL. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/li/h0/jj/lih0jj-r80c5_0m3cgbm7o7vqxe.png" alt="Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><h3>  Como alterar o tipo de dispositivo </h3><br><p>  Por padrão, o modelo coleta dados de velocidade ao simular downloads de um dispositivo móvel. </p><br><p>  Se você precisar de dados da área de trabalho, vá para a seção "Ferramentas" / "Editor de scripts" do Planilhas Google, encontre a função runCheck e altere o valor do parâmetro "estratégia" de "móvel" para "área de trabalho" na variável serviceUrl (linha 587).  Salve as alterações. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nn/gy/jd/nngyjdblndwdxtwcxuqazpq4uvg.png" alt="Automatize o recebimento de dados sobre a velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><p>  Agora, o modelo coletará dados para os mesmos URLs, mas para desktops. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8e/bs/lo/8ebslosq5pojwopgfn_c4fmhpvm.png" alt="Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><p>  Se você precisar monitorar regularmente as versões móvel e de desktop, será mais conveniente criar duas cópias do modelo - não altere nada em uma e defina “strategy = desktop” na segunda. </p><br><h2>  Agendar recuperação de dados do PageSpeed ​​Insights </h2><br><p>  Na guia Configurações, especifique em qual dia e a que horas começar a coletar dados (altere apenas os dados na primeira linha).  Por exemplo, indicamos quinta-feira às 8h (a hora é definida de acordo com a hora local especificada na sua conta do Google). </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mq/xv/9g/mqxv9gv4voonqnunaapcr4zgf_e.png" alt="Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><p>  Depois de definir o dia da semana e a hora no modelo, o horário da coleta de dados é atribuído adicionalmente às 9, 10 e 11 da manhã.  Isso é necessário para contornar as limitações definidas pela API PageSpeed. </p><br><h3>  Restrições de coleta de dados da API </h3><br><p>  O modelo do Planilhas Google usa o script do Google Apps para coletar dados do PageSpeed ​​Insights.  Sempre que um relatório é executado, o Google Apps Scripts define um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">limite de tempo de execução de 6 minutos</a> (para usuários comuns). </p><br><p>  Este tempo será suficiente para analisar pelo menos 30 URLs.  Após esse período (se você tiver definido mais URLs), você receberá uma mensagem: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yb/pb/is/ybpbisi12njgilbkgd8pdljbsog.png" alt="Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><p>  Para continuar coletando dados, basta executar novamente o script.  É por isso que a programação indica as horas em que o relatório é reiniciado.  Dessa forma, você coletará dados de pelo menos 120 URLs. </p><br><p>  Mas aqui estamos diante de outro obstáculo - agora do lado do Planilhas Google.  O script no modelo é acionado de acordo com um determinado agendamento devido a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">acionadores</a> . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yc/2q/z2/yc2qz2vyqdxiqd-zp8yyfj1zyao.png" alt="Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><p>  O problema é que o uso de gatilhos mais de quatro vezes seguidas causa um erro - “Serviço que consome muito tempo do computador por um dia”.  Isso significa que o script do Google Apps excedeu o tempo total de execução permitido em um dia. </p><br><p>  A solução é executar o script manualmente. </p><br><p>  Se você tiver mais de 120 URLs para verificar, basta executar o script no “Menu Velocidade da página” (“Relatório de envio manual”).  Nesse caso, não haverá limite para o número de gatilhos acionados e você pode verificar quantos URLs precisar. </p><br><h2>  Agendar upload de dados </h2><br><p>  Na guia "Configurações", no campo "Resultados do registro a cada", especifique o dia da semana e a hora do upload.  Lembre-se da programação de coleta de dados.  Por exemplo, se você definir a coleta de dados na quinta-feira às 8h, é melhor carregá-lo antes de 12 dias - para que eles provavelmente sejam coletados. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v3/h3/sv/v3h3svg1edwpsnmuoil0auhnuaa.png" alt="Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><p>  Depois de configurar um agendamento para a coleta e o upload de dados, não deixe de ir para o “Menu Velocidade da página” e clique em “Definir agendamento de relatórios e registros”.  Esta ação ativa a agenda. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ia/_q/sl/ia_qsl4c4f3gg6wnsrcwzd4nba4.png" alt="Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><p>  Se você deseja cancelar o upload agendado, clique em "Redefinir agendamento". </p><br><p>  Após o tempo indicado nas abordagens do cronograma, o script transferirá os dados da planilha "Resultados" para a planilha "Log".  Nesse caso, os dados na planilha "Resultados" desaparecerão (exceto o URL), e na planilha "Log" serão acumulados todas as vezes após o descarregamento.  Assim, você terá um histórico de alterações na velocidade de download. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mt/u-/tc/mtu-tcgktjre27baucvvkghrv7y.png" alt="Automatizamos o recebimento de dados na velocidade de carregamento de um site do Google PageSpeed ​​Insights [modelo]"></div><br><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A API V5 do PageSpeed ​​Insights</a> permite fazer o upload de todos os dados apresentados nas auditorias do Lighthouse.  Ou seja, se necessário, você pode complementar o script e obter mais dados usando o modelo. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt471270/">https://habr.com/ru/post/pt471270/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt471260/index.html">Kali Linux NetHunter no Android Parte 2: ataques a redes sem fio</a></li>
<li><a href="../pt471262/index.html">Holivar. História do Runet. Parte 5. Trolls: Aprenda, impressora frenética, Cobre</a></li>
<li><a href="../pt471264/index.html">Escolhendo uma alternativa ao Mailchimp: por que mudar e qual produto escolher</a></li>
<li><a href="../pt471266/index.html">O futuro está aqui ou codificado diretamente no navegador</a></li>
<li><a href="../pt471268/index.html">Entendendo os Corretores de Mensagens. Aprendendo a mecânica das mensagens através do ActiveMQ e Kafka. Capítulo 2. ActiveMQ</a></li>
<li><a href="../pt471272/index.html">Os benefícios da digitação forte em C ++: experiência prática</a></li>
<li><a href="../pt471278/index.html">Geração de texto em russo por modelos</a></li>
<li><a href="../pt471282/index.html">À procura de pneumonia em raios-x com Fast.ai</a></li>
<li><a href="../pt471288/index.html">Criando o rosto de um personagem para o jogo "OnAir"</a></li>
<li><a href="../pt471294/index.html">Poemas sobre Haskell, C ++ e programadores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>