<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìâ ‚ö™Ô∏è ‚úã Bot Telegram pour une s√©lection personnalis√©e d'articles de Habr üï§ üëá ü§ß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pour des questions dans le style "pourquoi?" Il y a un article plus ancien - Natural Geektimes - rendant l'espace plus propre . 


 De nombreux articl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bot Telegram pour une s√©lection personnalis√©e d'articles de Habr</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475450/"><p>  Pour des questions dans le style "pourquoi?"  Il y a un article plus ancien - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Natural Geektimes - rendant l'espace plus propre</a> . </p><br><p>  De nombreux articles, pour des raisons subjectives, certains n'aiment pas, et certains, au contraire, c'est dommage de les manquer.  Je souhaite optimiser ce processus et gagner du temps. </p><br><p>  L'article ci-dessus sugg√®re une approche avec des scripts dans le navigateur, mais je ne l'aimais pas vraiment (m√™me si je l'ai d√©j√† utilis√©) pour les raisons suivantes: </p><br><ul><li>  Pour diff√©rents navigateurs sur votre ordinateur / t√©l√©phone, vous devez le configurer √† nouveau, si possible. </li><li>  Le filtrage brutal par les auteurs n'est pas toujours pratique. </li><li>  Le probl√®me des auteurs dont les articles ne veulent pas √™tre manqu√©s, m√™me s'ils sont publi√©s une fois par an, n'est pas r√©solu. </li></ul><br><p>  Le filtrage par note d'article int√©gr√©e au site n'est pas toujours pratique, car les articles hautement sp√©cialis√©s, pour toute leur valeur, peuvent recevoir une note plut√¥t modeste. </p><br><p>  Au d√©part, je voulais g√©n√©rer du flux rss (ou m√™me certains), ne laissant l√† que l'int√©ressant.  Mais au final, il s'est av√©r√© que la lecture de rss ne semblait pas tr√®s pratique: en tout cas, pour commenter / voter sur un article / l'ajouter aux favoris, il faut passer par le navigateur.  Par cons√©quent, j'ai √©crit un bot pour un t√©l√©gramme qui me lance des articles int√©ressants dans PM.  Le t√©l√©gramme lui-m√™me en fait de beaux aper√ßus, qui en combinaison avec des informations sur l'auteur / la note / les vues semblent assez informatifs. </p><br><p><img src="https://habrastorage.org/webt/uk/e7/hr/uke7hrnmcthxqqzubouampuvlrw.png"></p><br><p>  Sous la coupe, des d√©tails comme les caract√©ristiques du travail, le processus d'√©criture et les solutions techniques. </p><a name="habracut"></a><br><h2 id="kratko-o-bote">  En bref sur le bot </h2><br><p>  R√©f√©rentiel: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/Kright/habrahabr_reader</a> </p><br><p>  Bot t√©l√©gramme: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://t.me/HabraFilterBot</a> </p><br><p>  L'utilisateur d√©finit une note suppl√©mentaire pour les balises et les auteurs.  Apr√®s cela, un filtre est appliqu√© aux articles - la note de l'article sur Habr√©, la note utilisateur de l'auteur et la moyenne des notes utilisateur par tags sont ajout√©es.  Si le montant est sup√©rieur √† la valeur seuil d√©finie par l'utilisateur, l'article passe le filtre. </p><br><p>  Un objectif secondaire de l'√©criture d'un bot √©tait de s'amuser et de vivre de l'exp√©rience.  De plus, je me rappelais r√©guli√®rement que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">je n'√©tais pas Google</a> , et donc beaucoup de choses √©taient faites aussi simples et m√™me primitives que possible.  Cependant, cela n'a pas emp√™ch√© le processus d'√©criture du bot de s'√©tirer pendant trois mois. </p><br><h2 id="za-oknom-bylo-leto">  √Ä l'ext√©rieur de la fen√™tre √©tait l'√©t√© </h2><br><p>  Juillet s'est termin√© et j'ai d√©cid√© d'√©crire un bot.  Et pas seul, mais avec un ami qui ma√Ætrise la scala et qui veut √©crire quelque chose dessus.  Le d√©but semblait prometteur - le code sera sci√© "en √©quipe", la t√¢che semblait facile et je pensais que dans quelques semaines ou un mois le bot serait pr√™t. </p><br><p>  Malgr√© le fait que j'√©crive moi-m√™me du code sur la roche depuis quelques ann√©es, g√©n√©ralement personne ne voit ou ne regarde ce code: projets pour animaux de compagnie, v√©rification d'id√©es, pr√©traitement des donn√©es, ma√Ætrise de certains concepts du FP.  J'√©tais vraiment int√©ress√© par l'apparence du code dans l'√©quipe, car le code sur le rocher peut √™tre √©crit de mani√®res tr√®s diff√©rentes. </p><br><p>  Qu'est-ce qui aurait pu se passer <strong>ainsi</strong> ?  Cependant, nous ne pr√©cipiterons pas les choses. <br>  Tout ce qui se passe peut √™tre suivi par l'historique des commits. </p><br><p>  Un ami a cr√©√© le r√©f√©rentiel le 27 juillet, mais n'a rien fait d'autre, alors j'ai commenc√© √† √©crire du code. </p><br><h3 id="30-iyulya">  30 juillet </h3><br><p>  En bref: j'ai √©crit l'analyse des flux rss de Habr. </p><br><ul><li> <code>com.github.pureconfig</code> pour lire les fichiers de configuration typesafe directement dans les classes de cas (cela s'est av√©r√© tr√®s pratique) </li><li>  <code>scala-xml</code> pour lire le xml: comme je voulais √† l'origine √©crire mon impl√©mentation pour la bande rss et la bande rss au format xml, j'ai utilis√© cette biblioth√®que pour l'analyse.  En fait, l'analyse rss est √©galement apparue. </li><li>  <code>scalatest</code> pour les tests.  M√™me pour les petits projets, l'√©criture de tests permet de gagner du temps - par exemple, lors du d√©bogage de l'analyse XML, il est beaucoup plus facile de le t√©l√©charger dans un fichier, d'√©crire des tests et de corriger les erreurs.  Lorsqu'un bogue est apparu plus tard avec l'analyse d'un √©trange code html avec des caract√®res utf-8 invalides, il s'est av√©r√© encore plus pratique de le mettre dans un fichier et d'ajouter un test. </li><li>  acteurs d'Akka.  Objectivement, ils n'√©taient pas du tout n√©cessaires, mais le projet a √©t√© √©crit pour le plaisir, je voulais les essayer.  En cons√©quence, je suis pr√™t √† dire que j‚Äôai aim√©.  On peut regarder l'id√©e de la POO de l'autre c√¥t√© - il y a des acteurs qui √©changent des messages.  Ce qui est plus int√©ressant - il est possible (et n√©cessaire) d'√©crire du code de mani√®re √† ce que le message ne parvienne pas ou ne puisse pas √™tre trait√© (g√©n√©ralement, lorsque le compte s'ex√©cute sur un seul ordinateur, les messages ne doivent pas √™tre perdus).  Au d√©but, je me creusais la t√™te et il y avait une poubelle dans le code avec des acteurs qui s'abonnaient les uns aux autres, mais √† la fin j'ai r√©ussi √† trouver une architecture plut√¥t simple et √©l√©gante.  Le code √† l'int√©rieur de chaque acteur peut √™tre consid√©r√© comme un seul thread, lorsque l'acteur se bloque, l'Akka le red√©marre - un syst√®me plut√¥t tol√©rant aux pannes est obtenu. </li></ul><br><h3 id="9-avgusta">  9 ao√ªt </h3><br><p>  J'ai ajout√© le projet <code>scala-scrapper</code> pour analyser les pages html du Habr (pour extraire des informations telles que la note de l'article, le nombre de signets, etc.). </p><br><p>  Et les chats.  Ceux qui sont dans la roche. </p><br><p><img src="https://habrastorage.org/webt/52/t8/4v/52t84v4u6vw7z6prsq8iqpmn0d8.png"></p><br><p>  J'ai ensuite lu un livre sur les bases de donn√©es distribu√©es, j'ai aim√© l'id√©e de CRDT (Conflict-free replicated data type, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr</a> ), alors j'ai film√© la classe de type du semi-groupe commutatif pour informations sur l'article sur Habr√©. </p><br><p>  En fait, l'id√©e est tr√®s simple - nous avons des compteurs qui changent de fa√ßon monotone.  Le nombre de promoteurs augmente r√©guli√®rement, le nombre d'avantages aussi (cependant, ainsi que le nombre d'inconv√©nients).  Si j'ai deux versions d'informations sur un article, vous pouvez ¬´les fusionner en une seule¬ª - consid√©rez l'√©tat du compteur qui est le plus pertinent. </p><br><p>  Un semi-groupe signifie que deux objets contenant des informations sur un article peuvent √™tre fusionn√©s en un seul.  Commutative signifie que vous pouvez fusionner A + B et B + A, le r√©sultat ne d√©pend pas de l'ordre, par cons√©quent, la version la plus r√©cente reste.  Soit dit en passant, l'associativit√© est √©galement l√†. </p><br><p>  Par exemple, par conception, rss apr√®s l'analyse a donn√© des informations l√©g√®rement att√©nu√©es sur l'article - sans m√©triques telles que le nombre de vues.  Un acteur sp√©cial a ensuite pris des informations sur les articles et a couru vers les pages html pour le mettre √† jour et fusionner avec l'ancienne version. </p><br><p>  D'une mani√®re g√©n√©rale, comme akka, cela n'√©tait pas n√©cessaire, il √©tait possible de simplement stocker la date de mise √† jour de l'article et d'en prendre une plus r√©cente sans aucune fusion, mais le chemin de l'aventure m'a conduit. </p><br><h2 id="12-avgusta">  12 ao√ªt </h2><br><p>  J'ai commenc√© √† me sentir plus libre et, par int√©r√™t, j'ai fait de chaque conversation un acteur distinct.  Th√©oriquement, un acteur √† lui seul p√®se environ 300 octets et peut √™tre cr√©√© au moins par millions, c'est donc une approche tout √† fait normale.  Il s'est av√©r√©, il me semble, une solution assez int√©ressante: </p><br><p>  Un acteur √©tait le pont entre le serveur de t√©l√©gramme et le syst√®me de messagerie √† Akka.  Il a simplement re√ßu des messages et les a envoy√©s √† l'acteur de chat souhait√©.  Le chat d'acteur en r√©ponse pourrait renvoyer quelque chose - et il a √©t√© renvoy√© aux t√©l√©grammes.  Ce qui √©tait tr√®s pratique - cet acteur s'est av√©r√© √™tre aussi simple que possible et ne contenait que la logique de la r√©ponse aux messages.  Soit dit en passant, des informations sur les nouveaux articles sont venues √† chaque discussion, mais encore une fois, je ne vois aucun probl√®me. </p><br><p>  En g√©n√©ral, le bot fonctionnait d√©j√†, r√©pondait aux messages, gardait une liste d'articles envoy√©s √† l'utilisateur, et je pensais d√©j√† que le bot √©tait presque pr√™t.  J'ai lentement fini de petites puces comme normaliser les noms des auteurs et des balises (en rempla√ßant "sd f" par "s_d_f"). </p><br><p>  Il n'y avait qu'une <em>petite mais</em> - l'√âtat n'a persist√© nulle part. </p><br><h2 id="vsyo-poshlo-ne-tak">  Tout s'est mal pass√© </h2><br><p>  Vous avez peut-√™tre remarqu√© que j'ai √©crit le bot principalement seul.  Ainsi, le deuxi√®me participant s'est joint au d√©veloppement et les modifications suivantes sont apparues dans le code: </p><br><ul><li>  Pour stocker l'√©tat est apparu mongoDB.  Dans le m√™me temps, les journaux se sont cass√©s dans le projet, car pour une raison quelconque, la monga a commenc√© √† les spammer et certaines personnes les ont simplement d√©sactiv√©s √† l'√©chelle mondiale. </li><li>  Le pont des acteurs dans le t√©l√©gramme a √©t√© transform√© au-del√† de la reconnaissance et a commenc√© √† analyser les messages lui-m√™me. </li><li>  Les acteurs pour les chats √©taient ivres sans piti√©, au lieu d'eux apparaissait un acteur qui cachait en lui toutes les informations sur tous les chats √† la fois.  Pour chaque √©ternuement, cet acteur montait en mongu.  Eh bien, oui, il est difficile de l'envoyer √† tous les acteurs du chat lors de la mise √† jour des informations sur un article (nous sommes comme Google, des millions d'utilisateurs attendent un million d'articles dans un chat pour tout le monde), mais il est normal d'entrer dans un monga chaque fois que vous mettez √† jour un chat.  Comme je l'ai compris beaucoup plus tard, la logique de travail des chats a √©galement √©t√© compl√®tement coup√©e et quelque chose d'inop√©rant est apparu. </li><li>  Il ne reste aucune trace des classes. </li><li>  Une logique malsaine est apparue chez les acteurs avec leurs abonnements les uns aux autres, conduisant √† une condition de race. </li><li>  Structures de donn√©es avec des champs de type <code>Option[Int]</code> transform√©es en Int avec des valeurs magiques par d√©faut de type -1.  Plus tard, j'ai r√©alis√© que mongoDB stocke json et qu'il n'y a rien de mal √† y stocker <code>Option</code> ou au moins √† analyser -1 comme None, mais √† ce moment-l√†, je ne le savais pas et j'ai cru le mot "c'est n√©cessaire".  Ce code n'a pas √©t√© √©crit par moi et je n'ai pas pris la peine de le changer pour le moment. </li><li>  J'ai d√©couvert que mon adresse IP publique a la propri√©t√© de changer, et chaque fois que je devais l'ajouter √† la langue de la liste blanche.  J'ai d√©marr√© le bot localement, la monga √©tait quelque part sur les serveurs monga en tant qu'entreprise. </li><li>  Soudain, la normalisation des balises et le formatage des messages pour un t√©l√©gramme ont disparu.  (Hmm, pourquoi √ßa?) </li><li>  J'ai aim√© que l'√©tat du bot soit stock√© dans une base de donn√©es externe, et au red√©marrage, il continue de fonctionner comme si de rien n'√©tait.  Cependant, c'√©tait le seul avantage. </li></ul><br><p>  La deuxi√®me personne n'√©tait pas press√©e, et tous ces changements sont apparus en un seul gros tas d√©j√† d√©but septembre.  Je n'ai pas imm√©diatement appr√©ci√© l'ampleur des d√©g√¢ts et j'ai commenc√© √† comprendre le travail de la base de donn√©es, car  n'avait jamais trait√© avec eux auparavant.  Ce n'est qu'alors que j'ai r√©alis√© combien de code de travail a √©t√© coup√© et combien de bogues ont √©t√© ajout√©s en retour. </p><br><h2 id="sentyabr">  Septembre </h2><br><p>  Au d√©but, je pensais qu'il serait utile de ma√Ætriser Mongu et de bien faire tout.  Puis j'ai lentement commenc√© √† comprendre que l'organisation de la communication avec la base de donn√©es est aussi un art dans lequel on peut faire des courses et juste des erreurs.  Par exemple, si deux messages de type <code>/subscribe</code> arrivent de l'utilisateur, et en r√©ponse √† chacun, nous cr√©erons une entr√©e dans la plaque, car au moment du traitement de ces messages, l'utilisateur n'est pas sign√©.  Je soup√ßonnais que la communication avec la monga sous la forme existante n'√©tait pas √©crite de la meilleure fa√ßon.  Par exemple, les param√®tres utilisateur ont √©t√© cr√©√©s au moment de son inscription.  S'il essayait de les changer avant le fait de l'abonnement ... le bot n'a pas r√©pondu, car le code de l'acteur est mont√© dans la base de donn√©es pour les param√®tres, n'a pas pu trouver et s'est √©cras√©.  √Ä la question - pourquoi ne pas cr√©er les param√®tres selon les besoins, j'ai d√©couvert qu'il n'y avait rien pour les changer si l'utilisateur n'√©tait pas abonn√© ... Le syst√®me de filtrage des messages a √©t√© en quelque sorte rendu √©vident, et m√™me apr√®s un examen attentif du code, je ne pouvais pas comprendre s'il avait √©t√© con√ßu √† l'origine ou il y a une erreur. </p><br><p>  Aucune liste d'articles n'a √©t√© envoy√©e pour chatter, mais il a √©t√© sugg√©r√© de les √©crire moi-m√™me.  Cela m'a surpris - en g√©n√©ral, je n'√©tais pas oppos√© √† faire glisser toutes sortes de pi√®ces dans le projet, mais il serait logique de tirer ces choses et de les visser.  Mais non, le deuxi√®me participant semble avoir tout oubli√©, mais a d√©clar√© que la liste √† l'int√©rieur du chat √©tait cens√©e √™tre une mauvaise d√©cision, et vous devez faire une plaque avec des √©v√©nements comme "l'article x a √©t√© envoy√© √† l'utilisateur x".  Ensuite, si l'utilisateur demandait d'envoyer de nouveaux articles, il √©tait n√©cessaire d'envoyer une demande √† la base de donn√©es, lequel des √©v√©nements s√©lectionnerait les √©v√©nements li√©s √† l'utilisateur, obtiendrait toujours une liste de nouveaux articles, les filtrerait, les enverrait √† l'utilisateur et renverrait des √©v√©nements √† ce sujet dans la base de donn√©es. </p><br><p>  Le deuxi√®me participant a quelque part souffert dans le sens des abstractions, lorsque le bot ne recevra pas seulement des articles de Habr et n'enverra pas seulement aux t√©l√©grammes. </p><br><p>  J'ai en quelque sorte mis en ≈ìuvre les √©v√©nements sous la forme d'une tablette s√©par√©e d'ici la seconde moiti√© de septembre.  Pas optimal, mais le bot a au moins fonctionn√© et a recommenc√© √† m'envoyer des articles, et j'ai lentement compris ce qui se passait dans le code. </p><br><p>  Maintenant, vous pouvez d'abord revenir en arri√®re et vous rappeler que le r√©f√©rentiel n'a pas √©t√© cr√©√© par moi √† l'origine.  Qu'est-ce qui aurait pu se passer ainsi?  Ma demande de pool a √©t√© rejet√©e.  Il s'est av√©r√© que j'avais un shortcode, que je ne savais pas comment travailler en √©quipe et que je devais √©diter des bugs dans la courbe d'impl√©mentation actuelle, et ne pas le modifier dans un √©tat utilisable. </p><br><p>  J'√©tais boulevers√©, j'ai regard√© l'historique des commits, la quantit√© de code √©crit.  J'ai regard√© les moments qui √©taient bien √©crits √† l'origine, puis je me suis cass√© ... </p><br><h2 id="frk-it">  F * rk it </h2><br><p>  Je me suis souvenu de l'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">You Are Not Google</a> . </p><br><p>  Je pensais que personne n'avait vraiment besoin d'une id√©e sans mise en ≈ìuvre.  Je pensais que je voulais avoir un bot qui fonctionnerait en une seule copie sur un seul ordinateur comme un simple programme java.  Je sais que mon bot fonctionnera pendant des mois sans red√©marrage, car dans le pass√©, j'√©crivais de tels bots.  S'il tombe soudainement et n'envoie pas le prochain article √† l'utilisateur, le ciel ne tombera pas sur la terre et rien de catastrophique ne se produira. </p><br><p>  Pourquoi ai-je besoin d'un docker, d'un mongoDB et d'un autre logiciel cargo "s√©rieux", si le code ne fonctionne pas b√™tement ou fonctionne de mani√®re tordue? </p><br><p>  J'ai bifurqu√© le projet et fait tout ce que je voulais. </p><br><p><img src="https://habrastorage.org/webt/ns/gh/ze/nsghzekle4yfth_aqyivbx17wxy.jpeg"></p><br><p>  Vers la m√™me √©poque, j'ai chang√© d'emploi et le temps libre manquait cruellement.  Le matin, je me suis r√©veill√© exactement dans le train, je suis rentr√© tard dans la soir√©e et je ne voulais plus rien faire.  Je n'ai rien fait pendant un moment, puis j'ai surmont√© le d√©sir de terminer le bot, et j'ai commenc√© √† r√©√©crire lentement le code en conduisant au travail le matin.  Je ne peux pas dire que c'√©tait productif: s'asseoir dans un train tremblant avec un ordinateur portable sur vos genoux et jeter un ≈ìil au d√©bordement de la pile de votre t√©l√©phone n'est pas tr√®s pratique.  Cependant, le temps pass√© √† √©crire le code est pass√© compl√®tement inaper√ßu et le projet a commenc√© √† passer lentement √† un √©tat de fonctionnement. </p><br><p>  Quelque part au fond, il y avait un ver de doute que mongoDB voulait utiliser, mais je pensais qu'il y avait des inconv√©nients notables en plus des avantages du stockage d'√©tat ¬´fiable¬ª: </p><br><ul><li>  La base de donn√©es devient un autre point de d√©faillance. </li><li>  Le code devient plus difficile et je l'√©crirai plus longtemps. </li><li>  Le code devient lent et inefficace; au lieu de changer l'objet en m√©moire, les modifications sont envoy√©es √† la base de donn√©es et retir√©es si n√©cessaire. </li><li>  Il existe des restrictions sur le type de stockage des √©v√©nements dans une plaque distincte, qui sont associ√©s aux fonctionnalit√©s de la base de donn√©es. </li><li>  Dans la version d'essai de monga, il existe certaines restrictions, et si vous les rencontrez, vous devrez d√©marrer et configurer le mongu pour quelque chose. </li></ul><br><p>  J'ai bu Mongu, maintenant l'√©tat du bot est simplement stock√© dans la m√©moire du programme et de temps en temps il est enregistr√© dans un fichier sous forme de json.  Peut-√™tre que dans les commentaires, ils √©criront que je me trompe, car c'est l√† que vous devriez l'utiliser, etc.  Mais c'est mon projet, l'approche avec le fichier est aussi simple que possible et cela fonctionne de mani√®re transparente. </p><br><p>  J'ai jet√© des valeurs magiques comme -1 et suis revenu √† l' <code>Option</code> normale, j'ai ajout√© le stockage d'une plaque de hachage avec les articles envoy√©s √† l'objet avec des informations de chat.  Ajout de la suppression des informations sur les articles de plus de cinq jours, afin de ne pas tout stocker de suite.  Il a mis la journalisation en √©tat de fonctionnement - des journaux en quantit√©s raisonnables sont √©crits √† la fois dans le fichier et dans la console.  Ajout de plusieurs commandes d'administration telles que l'enregistrement de l'√©tat ou l'obtention de statistiques comme le nombre d'utilisateurs et d'articles. </p><br><p>  J'ai corrig√© un tas de petites choses: par exemple, les articles indiquent maintenant le nombre de vues, de go√ªts, d'aversions et de commentaires au moment o√π le filtre utilisateur a √©t√© pass√©.  En g√©n√©ral, il est √©tonnant de voir combien de petites choses ont d√ª √™tre r√©par√©es.  J'en ai gard√© une liste, y ai not√© toutes les ¬´rugosit√©s¬ª et les ai corrig√©es autant que possible. </p><br><p>  Par exemple, j'ai ajout√© la possibilit√© de d√©finir tous les param√®tres directement dans un message: </p><br><pre> <code class="plaintext hljs">/subscribe /rating +20 /author a -30 /author s -20 /author p +9000 /tag scala 20 /tag akka 50</code> </pre> <br><p>  Et la commande <code>/settings</code> affiche sous cette forme, vous pouvez en prendre du texte et envoyer tous les param√®tres √† un ami. <br>  Cela semble √™tre une bagatelle, mais il existe des dizaines de nuances similaires. </p><br><p>  Filtrage des articles mis en ≈ìuvre sous la forme d'un mod√®le lin√©aire simple - l'utilisateur peut d√©finir une note suppl√©mentaire pour les auteurs et les balises, ainsi qu'une valeur de seuil.  Si la somme de la note de l'auteur, de la note moyenne des tags et de la note r√©elle de l'article est sup√©rieure √† la valeur seuil, l'article est pr√©sent√© √† l'utilisateur.  Vous pouvez soit demander au bot des articles avec la commande / new, soit vous abonner au bot et il lancera des articles dans PM √† tout moment de la journ√©e. </p><br><p>  De mani√®re g√©n√©rale, j'ai eu une id√©e pour chaque article de dessiner plus de signes (hubs, le nombre de commentaires, les signets, la dynamique des changements de notation, la quantit√© de texte, les images et le code dans l'article, les mots-cl√©s), et l'utilisateur de montrer le vote ok / not ok sous chacun article et pour chaque utilisateur de former le mod√®le, mais je suis devenu trop paresseux. </p><br><p>  De plus, la logique du travail ne sera pas aussi √©vidente.  Maintenant, je peux mettre manuellement une note de +9000 pour patientZero et avec une note seuil de +20, je serai assur√© de recevoir tous ses articles (sauf, bien s√ªr, je mets -100500 pour toutes les balises). </p><br><p>  L'architecture r√©sultante √©tait assez simple: </p><br><ol><li>  Un acteur qui stocke l'√©tat de tous les chats et articles.  Il charge son √©tat √† partir d'un fichier sur le disque et le sauvegarde de temps en temps, √† chaque fois dans un nouveau fichier. </li><li>  Un acteur qui rencontre occasionnellement le flux rss apprend les nouveaux articles, examine les liens, analyse et envoie ces articles au premier acteur.  De plus, il demande parfois au premier acteur une liste d'articles, s√©lectionne ceux d'entre eux qui n'ont pas plus de trois jours, mais qui n'ont pas √©t√© mis √† jour depuis longtemps, et les met √† jour. </li><li>  Un acteur qui communique avec un t√©l√©gramme.  J'ai toujours pris l'analyse des messages ici.  Dans le bon sens, je veux le diviser en deux - afin que l'un analyse les messages entrants et que le second traite des probl√®mes de transport tels que le transfert des messages non envoy√©s.  Maintenant, il n'y a pas de r√©-envoi, et le message qui n'a pas atteint en raison d'une erreur sera simplement perdu (sauf qu'il sera marqu√© dans les journaux), mais jusqu'√† pr√©sent, cela ne pose aucun probl√®me.  Peut-√™tre que des probl√®mes surviendront si un groupe de personnes s'abonne au bot et que j'atteins la limite d'envoi de messages). </li></ol><br><p>  Ce que j'ai aim√© - gr√¢ce √† akka, la chute des acteurs 2 et 3 en g√©n√©ral n'affecte pas les performances du bot.  Peut-√™tre que certains articles ne sont pas mis √† jour √† temps ou que certains messages n'atteignent pas le t√©l√©gramme, mais Akka red√©marre l'acteur et tout continue de fonctionner.  J'enregistre les informations selon lesquelles l'article est montr√© √† l'utilisateur uniquement lorsque l'acteur de t√©l√©gramme r√©pond qu'il a bien livr√© le message.  La pire chose qui me menace est d'envoyer un message plusieurs fois (s'il est d√©livr√©, mais la confirmation est perdue d'une mani√®re inconnue).  En principe, si le premier acteur ne gardait pas l'√âtat en lui-m√™me, mais communiquait avec une sorte de base de donn√©es, il pouvait √©galement tomber tranquillement et reprendre vie.  Je pourrais aussi essayer akka persistance pour restaurer l'√©tat des acteurs, mais l'impl√©mentation actuelle me convient par sa simplicit√©.  Non pas que mon code se bloque souvent - au contraire, j'ai mis beaucoup d'efforts pour rendre cela impossible.  Mais la merde arrive, et la possibilit√© de diviser le programme en morceaux isol√©s-acteurs me semblait vraiment pratique et pratique. </p><br><p>  Circle-ci ajout√© afin de le savoir imm√©diatement lorsque le code casse.  Au moins que le code a cess√© de compiler.  Au d√©part, je voulais ajouter des travis, mais cela ne montrait que mes projets sans ceux fourchus.  En g√©n√©ral, ces deux √©l√©ments peuvent √™tre librement utilis√©s sur des r√©f√©rentiels ouverts. </p><br><h2 id="itogi">  R√©sum√© </h2><br><p>  C'est d√©j√† novembre.  Le bot est √©crit, je l'ai utilis√© depuis deux semaines et j'ai bien aim√©.  Si vous avez des id√©es d'am√©lioration - √©crivez.  Je ne vois pas l'int√©r√™t de le mon√©tiser - laissez-le fonctionner et envoyez des articles int√©ressants. </p><br><p>  Lien vers le bot: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://t.me/HabraFilterBot</a> <br>  Github: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/Kright/habrahabr_reader</a> </p><br><p>  Petites conclusions: </p><br><ul><li>  M√™me un petit projet peut prendre beaucoup de temps. </li><li>  Vous n'√™tes pas Google.  Cela n'a aucun sens de tirer un moineau avec un canon.  Une solution simple peut tout aussi bien fonctionner. </li><li>  Les projets pour animaux de compagnie sont tr√®s bien adapt√©s pour exp√©rimenter de nouvelles technologies. </li><li>  Les robots t√©l√©grammes sont √©crits tout simplement.  Sans le ¬´travail d'√©quipe¬ª et les exp√©riences avec les technologies, le bot aurait √©t√© √©crit en une semaine ou deux. </li><li>  Le mod√®le d'acteur est une chose int√©ressante qui va bien avec le multithread et la r√©silience du code. </li><li>  Il me semble que la communaut√© open source aime les fourches. </li><li>  Les bases de donn√©es sont bonnes en ce que l'√©tat de l'application ne d√©pend plus des pannes / red√©marrages de l'application, mais travailler avec la base de donn√©es complique le code et impose des restrictions sur la structure des donn√©es. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr475450/">https://habr.com/ru/post/fr475450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr475438/index.html">Ekaterinbourg, 19 novembre - Atlassian User Group MeetUp</a></li>
<li><a href="../fr475440/index.html">Interfaces pour surveiller les performances des bases de donn√©es populaires dans Foglight for Databases</a></li>
<li><a href="../fr475442/index.html">Visite du si√®ge de Google - Conditions g√©n√©rales</a></li>
<li><a href="../fr475444/index.html">R√©acteurs industriels uranium-graphite pour la production de plutonium</a></li>
<li><a href="../fr475448/index.html">Dans une voiture moderne, il y a plus de lignes de code que ...</a></li>
<li><a href="../fr475452/index.html">S√©lection: 5 livres marketing √† lire pour un fondateur de startup</a></li>
<li><a href="../fr475458/index.html">T√©l√©commande avec d√©clencheur externe pour cam√©ras SONY HDR sur ESP8266</a></li>
<li><a href="../fr475462/index.html">Comment localiser un jeu mobile pour le march√© asiatique</a></li>
<li><a href="../fr475464/index.html">La voie de l'architecte: certification et immersion de produit</a></li>
<li><a href="../fr475466/index.html">Intel Xeon E-2200. C≈ìurs de serveur, budget</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>