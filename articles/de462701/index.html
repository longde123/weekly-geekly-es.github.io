<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåø üíµ üÖ±Ô∏è Assembler-Codegenerator-Bibliothek f√ºr AVR-Mikrocontroller. Teil 2 üé¶ üë©‚Äçüîß ‚òÅÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚Üê Teil 1. Erste Bekanntschaft 


 Teil 3. Indirekte Adressierung und Flusskontrolle ‚Üí 
 Assembler Code Generator Library f√ºr AVR-Mikrocontroller 
 Tei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Assembler-Codegenerator-Bibliothek f√ºr AVR-Mikrocontroller. Teil 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462701/"><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚Üê Teil 1. Erste Bekanntschaft</a> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 3. Indirekte Adressierung und Flusskontrolle ‚Üí</a> </p><br><h2 id="biblioteka-generatora-assemblernogo-koda-dlya-mikrokontrollerov-avr">  Assembler Code Generator Library f√ºr AVR-Mikrocontroller </h2><br><h3 id="chast-2-nachalo-raboty">  Teil 2. Erste Schritte </h3><br><p>  Wie geplant werden wir in diesem Teil die Funktionen der Programmierung mit der NanoRTOS-Bibliothek genauer betrachten.  Diejenigen, die mit dem Lesen dieses Beitrags begonnen haben, k√∂nnen sich mit der allgemeinen Beschreibung und den Funktionen der Bibliothek im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherigen Artikel</a> vertraut machen.  Aufgrund des begrenzten Umfangs der geplanten Ver√∂ffentlichung wird davon ausgegangen, dass ein angesehener Leser mit der C # -Programmierung zumindest minimal vertraut ist und auch die Architektur und Programmierung in Assemblersprache f√ºr AVR-Controller der Mega-Serie versteht. </p><a name="habracut"></a><br><p>  Das Studium einer Technologie l√§sst sich am besten mit der Ausf√ºhrung von Beispielen kombinieren. Ich empfehle daher, die Bibliothek selbst von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://drive.google.com/open?id=1FfBBpxlJkWC027ikYpn6NXbOGp7DS-5B</a> herunterzuladen und zu versuchen, sie mit dem Konsolenanwendungsprojekt zu verbinden.  Bei Erfolg k√∂nnen Sie sicher weitermachen.  Sie k√∂nnen jede C # -Anwendung oder jedes UnitTest-Projekt als Shell zum Ausf√ºhren von Beispielen verwenden.  Letzteres gef√§llt mir pers√∂nlich besser, da Sie so mehrere verschiedene Beispiele an einem Ort speichern und nach Bedarf ausf√ºhren k√∂nnen.  In jedem Fall wird aus Platzgr√ºnden nur der Text des Beispiels in die Auflistung aufgenommen. </p><br><p>  Die Arbeit mit der Bibliothek sollte immer mit einer Ansage wie einem Mikrocontroller beginnen.  Da die Parameter und der Satz von Peripherieger√§ten vom Controller-Typ abh√§ngen, wirkt sich die Auswahl eines bestimmten Controllers auf die Bildung von Assembler-Code aus.  Die Deklarationszeile der Steuerung, f√ºr die das Programm geschrieben wurde, lautet wie folgt </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328();</code> </pre> <br><p>  Ferner k√∂nnen zus√§tzliche Einstellungen des Mikrocontrollers folgen, wie beispielsweise Taktparameter oder die Zuweisung von Systemfunktionen f√ºr Ausg√§nge.  Wenn Sie beispielsweise die Berechtigung zum Zur√ºcksetzen der Hardware verwenden, wird die Verwendung der Ausgabe als Port vermieden.  Alle Controller-Parameter haben Standardwerte, und in den Beispielen werden sie weggelassen, au√üer wenn dies wichtig ist. In realen Projekten empfehle ich Ihnen jedoch, sie immer zu installieren.  Beispielsweise k√∂nnte eine Uhreinstellung so aussehen </p><br><pre> <code class="cs hljs"> m.FCLK = <span class="hljs-number"><span class="hljs-number">16000000</span></span>; m.CKDIV8 = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre> <br><p>  Diese Einstellung bedeutet, dass der Mikrocontroller von einem Quarzresonator oder einer externen Quelle mit einer Frequenz von 16 MHz getaktet wird und der Frequenzteiler f√ºr Peripherieger√§te ausgeschaltet wird. <br>  Die <em>Textfunktion der</em> statischen Klasse <em>AVRASM</em> ist f√ºr die Ausgabe der Arbeit verantwortlich.  Diese Funktion wird immer am Ende des Codes aufgerufen, um das Ergebnis in Assembler-Form auszugeben.  Die zuvor zugewiesene Instanz der Controller-Klasse empf√§ngt die Funktion als Parameter.  Der einfachste Rahmen des Programms f√ºr die Arbeit mit der Bibliothek hat daher die folgende Form </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-comment"><span class="hljs-comment">//     //      //          var t = AVRASM.Text(m); //    t</span></span></code> </pre> <br><p>  Wenn wir versuchen, das Programm auszuf√ºhren, sollte es erfolgreich sein, aber es wird kein Code generiert.  Trotz der Sinnlosigkeit des Ergebnisses l√§sst dies dennoch den Schluss zu, dass die Bibliothek keinen Wrapping-Code generiert. </p><br><p>  Wir haben bereits gelernt, wie man ein leeres Programm erstellt.  Versuchen wir nun, Code darin zu erstellen.  Beginnen wir mit dem primitivsten.  Mal sehen, wie wir das Inkrementproblem einer 8-Bit-Variablen in einer beliebigen ROZ-Zelle l√∂sen k√∂nnen.  Aus Assembler-Sicht ist dies der Befehl <em>inc [register]</em> .  F√ºgen Sie die folgenden Zeilen in den Hauptteil des Programms unserer Beschaffung ein </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = m.REG(); r++;</code> </pre> <br><p>  Der Zweck der Teams liegt auf der Hand.  Der erste Befehl ordnet die Variable <em>r</em> einem der Prozessorregister zu.  Der zweite Befehl spricht √ºber die Notwendigkeit, diese Variable zu erh√∂hen.  Nach der Ausf√ºhrung erhalten wir das erste Ergebnis der Codeausf√ºhrung. </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r20</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inc</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span></span></code> </pre> <br><p>  Schauen wir uns genauer an, was als Ergebnis passiert ist.  Die ersten vier Befehle sind die Initialisierung des Stapelzeigers.  Als n√§chstes folgt die Definition des Variablennamens.  Und schlie√ülich unsere <em>Inc</em> , f√ºr die alles gestartet wurde.  Es wurde nichts extra angezeigt, au√üer der Initialisierung des Stapels.  Die Frage, die sich beim Betrachten dieses Codes stellen kann, ist, welche <em>Art von R0000</em> ?  Wir haben eine Variable namens <em>r</em> ?  In einem C # -Programm kann ein Programmierer unter Verwendung des G√ºltigkeitsbereichs ganz bewusst und legal dieselben Namen verwenden.  Aus Assembler-Sicht m√ºssen alle Beschriftungen und Definitionen eindeutig sein.  Um den Programmierer nicht zu zwingen, die Eindeutigkeit von Namen zu √ºberwachen, werden die Namen standardm√§√üig vom System generiert.  Es gibt jedoch eine Situation, in der Sie zu Debugging-Zwecken den bewussten Namen weiterhin vom Programm in den Ausgabecode √ºbertragen m√∂chten, damit er leicht gefunden werden kann.  Nicht be√§ngstigend.  <em>Ersetzen Sie m.REG ()</em> durch <em>m.REG (‚Äùr‚Äù)</em> und f√ºhren Sie den Code erneut aus.  Als Ergebnis werden wir Folgendes sehen </p><br><pre> <code class="cs hljs">RESET: ldi r16, high(RAMEND) <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> SPH,r16 ldi r16, low(RAMEND) <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> SPL,r16 .DEF r = r20 inc r .DSEG</code> </pre> <br><p>  Also, mit der Benennung der Register aussortiert.  Nun wollen wir sehen, warum pl√∂tzlich Register ab 20 und nicht ab 0 zugewiesen wurden.  Um diese Frage zu beantworten, erinnern wir uns, dass Register ab 16 eine gro√üartige Gelegenheit haben, sie mit Konstanten zu initialisieren.  Und da diese Funktion sehr gefragt ist, beginnen wir die Verteilung ab der oberen H√§lfte, um die Optimierungsm√∂glichkeiten zu erh√∂hen.  Dann ist es trotzdem nicht klar - warum c20 und nicht 16?  Der Grund ist, dass die √úbersetzung einer Reihe von Befehlen in Assembler-Code ohne die Verwendung tempor√§rer Speicherzellen nicht m√∂glich ist.  F√ºr diese Zwecke haben wir 4 Zellen von 16 bis 19 zugewiesen. Dies bedeutet nicht, dass sie f√ºr den Programmierer v√∂llig unzug√§nglich geworden sind.  Es ist nur so, dass der Zugriff auf sie etwas anders organisiert ist, so dass der Programmierer sich der m√∂glichen Einschr√§nkungen ihrer Verwendung bewusst ist und bewusst handelt.  Wir entfernen die Definition des Registers <em>r</em> aus dem Code und ersetzen die darauf folgende Zeile durch <br>  <em>m.TempL ++;</em> <br>  Schauen wir uns das Ergebnis an </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inc</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TempL</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span></span></code> </pre> <br><p>  Hierbei ist anscheinend zu beachten, dass der Ausgabe-Assembler f√ºr die korrekte Interpretation der Verbindungsdatei mit Definitionen und Makros Common.inc aus dem Entwicklungspaket ben√∂tigt.  Es enth√§lt tats√§chlich alle erforderlichen Makros und Definitionen, einschlie√ülich der Namens√ºbereinstimmung f√ºr tempor√§re Speicherzellen.  TempL = r16, TempH = r17, TempQL = r18, TempQH = r19.  In diesem Fall haben wir keinen einzigen Befehl verwendet, der tempor√§re Speicherzellen zum Arbeiten verwenden w√ºrde. Daher ist unsere Entscheidung, ihn im TempL-Vorgang zu verwenden, durchaus akzeptabel.  Und was sollen wir tun, wenn wir absolut sicher sind, dass keine Zuordnung von Konstanten zu unserer Variablen nicht leuchtet und wir keine wertvollen Zellen der oberen H√§lfte daf√ºr ausgeben wollen?  <em>Geben</em> Sie unsere Definition in den Quellcode zur√ºck, indem Sie sie in <em>var r = m.REGL ("r") √§ndern.</em>  und bewerten Sie das Ergebnis der Arbeit </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r4</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inc</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span></span></code> </pre> <br><p>  Das Ziel ist erreicht.  Wir haben es geschafft, der Bibliothek zu erkl√§ren, wo sich die Variable unserer Meinung nach befinden sollte.  Gehen wir weiter.  Mal sehen, was passiert, wenn mehrere Variablen gleichzeitig deklariert werden.  Wir kopieren unsere Definition und Aktionen noch ein paar Mal.  Zur Abwechslung setzen wir eine neue Variable zur√ºck und reduzieren den Wert der anderen um 1. Das Ergebnis sollte ungef√§hr so ‚Äã‚Äãsein. </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = m.REGL(<span class="hljs-string"><span class="hljs-string">"r"</span></span>); r++; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr = m.REGL(<span class="hljs-string"><span class="hljs-string">"rr"</span></span>); rr--; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rrr = m.REGL(<span class="hljs-string"><span class="hljs-string">"rrr"</span></span>); rrr.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);  . RESET: ldi r16, high(RAMEND) <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> SPH,r16 ldi r16, low(RAMEND) <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> SPL,r16 .DEF r = r4 inc r .DEF rr = r5 dec rr .DEF rrr = r6 clr rrr .DSEG</code> </pre> <br><p>  Gro√üartig  Das wurde verlangt.  Nun wollen wir sehen, wie wir das Register f√ºr andere Zwecke freigeben k√∂nnen, wenn wir es nicht mehr ben√∂tigen.  Hier ist leider bisher alles von Hand.  C # -Regeln f√ºr Sichtbarkeitsgrenzen und die automatische Freigabe von Variablen im Ausland f√ºr den Codegenerierungsmodus funktionieren noch nicht.  Mal sehen, wie Sie die Zelle bei Bedarf noch freigeben k√∂nnen.  F√ºgen Sie unserem Programm nur eine Zeile hinzu und sehen Sie sich das Ergebnis an. </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = m.REGL(<span class="hljs-string"><span class="hljs-string">"r"</span></span>); r++; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr = m.REGL(<span class="hljs-string"><span class="hljs-string">"rr"</span></span>); rr--; r.Dispose(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rrr = m.REGL(<span class="hljs-string"><span class="hljs-string">"rrr"</span></span>); rrr.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r4</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inc</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rr</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r5</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dec</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rr</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UNDEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rrr</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r4</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rrr</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span></span></code> </pre> <br><p>  Es ist leicht zu erkennen, dass das vierte von uns freigegebene Register wieder zur Verwendung verf√ºgbar wurde.  Unter Ber√ºcksichtigung der Tatsache, dass jede neue Variablendeklaration das Register erfasst, k√∂nnen wir den Schluss ziehen, dass Sie beim Kompilieren des Programms die Register rechtzeitig freigeben m√ºssen, wenn Sie nicht auf eine Situation sto√üen m√∂chten, in der sie knapp werden. </p><br><p>  Bei der Analyse der Beispiele haben wir bereits gezeigt, wie Unicast-Operationen an Registern ausgef√ºhrt werden.  Nun wollen wir sehen, wie es mit Multicast l√§uft.  Die Prozessorarchitektur erlaubt maximal zwei Adressenbefehle (f√ºr besonders korrosive, mit Ausnahme von zwei Befehlen, f√ºr die das Ergebnis in festen Registern abgelegt wird).  Dies sollte so verstanden werden, dass der erste Operand in der Operation nach ihrer Ausf√ºhrung das Ergebnis enth√§lt.  F√ºr diese Art von Operation wird die spezielle Syntax <em>[register1] [operation] = [register2]</em> bereitgestellt.  Mal sehen, wie es in der Praxis aussieht.  Versuchen wir, zwei Registervariablen zu deklarieren und hinzuzuf√ºgen. </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> op1 = m.REG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> op2 = m.REG(); op1 += op2; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  Als Ergebnis werden wir sehen </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r20</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r21</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span></span></code> </pre> <br><p>  Ich habe bekommen, was sie erwartet hatten.  Sie k√∂nnen selbst mit den Operationen experimentieren -, &amp;, |  und stellen Sie sicher, dass das Ergebnis nicht schlechter ist. <br>  Bisher reicht all dies eindeutig nicht aus, um selbst das einfachste Programm zu schreiben.  Tatsache ist, dass wir die Initialisierung der Register selbst noch nicht angesprochen haben.  Die Architektur des Mikrocontrollers erm√∂glicht es Ihnen, die Register mit einer Konstanten, dem Wert eines anderen Registers, dem Wert der RAM-Speicherzelle an einer bestimmten Adresse, dem Wert der RAM-Speicherzelle am Zeiger in einem speziellen Registerpaar, dem Wert der Eingabe- / Ausgabezelle an einer bestimmten Adresse sowie dem Wert der Programmspeicherzelle am Zeiger zu initialisieren in ein spezielles Registerpaar gelegt.  Wir werden uns sp√§ter mit der indirekten Adressierung befassen, aber im Moment werden wir einfachere F√§lle betrachten.  Wir werden das folgende Testprogramm schreiben und ausf√ºhren. </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> op1 = m.REG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> op2 = m.REG(); op1.Load(<span class="hljs-number"><span class="hljs-number">0x10</span></span>); op2.Load(<span class="hljs-string"><span class="hljs-string">'s'</span></span>); op1.Load(op2); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  Hier haben wir zwei Variablen mit der Nummer und dem Symbol deklariert und initialisiert und dann den Wert der Variablen op2 in die Zelle op1 kopiert.  Offensichtlich muss die Zahl im Bereich von 0 bis 255 liegen, damit kein Fehler auftritt.  Das Ergebnis wird sein </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r20</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r21</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,16 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function">,'</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function">' </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span></span></code> </pre> <br><p>  Aus dem Beispiel ist ersichtlich, dass f√ºr alle aufgelisteten Operationen eine Funktion verwendet wird und die Bibliothek selbst den richtigen Satz von Assembler-Befehlen generiert.  Wie schon oft erw√§hnt, ist das direkte Laden von Daten in das Register mit dem Befehl ldi nur f√ºr die obere H√§lfte der Register verf√ºgbar.  Machen wir unsere Bibliothek komplizierter, indem wir das Programm so √§ndern, dass es Register f√ºr Variablen aus der unteren H√§lfte zuweist. </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> op1 = m.REGL(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> op2 = m.REGL(); op1.Load(<span class="hljs-number"><span class="hljs-number">0x10</span></span>); op2.Load(<span class="hljs-string"><span class="hljs-string">'s'</span></span>); op1.Load(op2); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  Wir bekommen </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r4</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r5</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TempL</span></span></span><span class="hljs-function">,16 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TempL</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TempL</span></span></span><span class="hljs-function">,'</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function">' </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TempL</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span></span></code> </pre> <br><p>  Die Bibliothek hat diese Aufgabe gemeistert und gleichzeitig die minimal m√∂gliche Anzahl von Teams ausgegeben.  Gleichzeitig haben wir gesehen, warum wir tempor√§re Speicherregister zuweisen m√ºssen.  Nun, zum Schluss wollen wir sehen, wie Mathematik f√ºr die Arbeit mit Konstanten implementiert wird.  Wir wissen um die Existenz des Subi-Assembler-Befehls, um die Konstante vom Register zu subtrahieren, und jetzt werden wir versuchen, sie anhand der Bibliothek zu beschreiben. </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> op1 = m.REG(); op1.Load(<span class="hljs-number"><span class="hljs-number">0x10</span></span>); op1 -= <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  Das Ergebnis wird sein </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r20</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,16 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x0A</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span></span></code> </pre> <br><p>  Es stellte sich heraus.  Und wie verh√§lt sich die Bibliothek, wenn es keinen Assembler-Befehl gibt, der die erforderliche Operation ausf√ºhren kann?  Zum Beispiel, wenn wir nicht subtrahieren, sondern eine Konstante hinzuf√ºgen wollen.  Lass uns versuchen zu sehen </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> op1 = m.REG(); op1.Load(<span class="hljs-number"><span class="hljs-number">0x10</span></span>); op1 += <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r20</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,16 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xF6</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span></span></code> </pre> <br><p>  Die Bibliothek wurde durch Subtrahieren eines negativen Werts verlassen.  Mal sehen, wie es mit der Schicht l√§uft.  Verschieben Sie den Wert des Registers um 5 nach rechts. </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> op1 = m.REG(); op1.Load(<span class="hljs-number"><span class="hljs-number">0x10</span></span>); op1 &gt;&gt;= <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  Das Ergebnis wird sein </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r20</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,16 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">swap</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">andi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,15 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lsr</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span></span></code> </pre> <br><p>  Hier ist nicht alles offensichtlich, aber es laufen 2 Teams schneller als wenn eine Frontall√∂sung von f√ºnf Schichtteams verwendet w√ºrde. </p><br><p>  In diesem Artikel haben wir die Verwendung der Bibliothek f√ºr die Arbeit mit Registerarithmetik untersucht.  Im n√§chsten Artikel werden wir weiterhin beschreiben, wie die Bibliothek mit Zeigern arbeitet, und Methoden zur Steuerung des Ablaufs der Befehlsausf√ºhrung (Schleifen, √úberg√§nge usw.) betrachten. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de462701/">https://habr.com/ru/post/de462701/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de462691/index.html">So migrieren Sie von AD zu LDAP, wenn Sie Zimbra verwenden</a></li>
<li><a href="../de462693/index.html">Auf dem Weg zu dauerhaften Anwendungen am Beispiel des statischen PSKOV-Standortgenerators</a></li>
<li><a href="../de462695/index.html">Material als WebComponents</a></li>
<li><a href="../de462697/index.html">uWSGI zur Unterst√ºtzung von Metriken. Yandex-Bericht</a></li>
<li><a href="../de462699/index.html">Servicegitter, "Datenebene" und "Steuerebene" (Service-Mesh-Datenebene vs. Steuerebene)</a></li>
<li><a href="../de462703/index.html">Das ‚Äûbilligste‚Äú Drehkreuz in Russland, das √ºber ein Smartphone gesteuert wird</a></li>
<li><a href="../de462705/index.html">Top 5 Fehler in meinen ReactJS-Anwendungen</a></li>
<li><a href="../de462707/index.html">Kubernetes Starten Sie Application Developer Tools</a></li>
<li><a href="../de462709/index.html">Mutationstests in PHP: eine qualitative Messung der Codeabdeckung</a></li>
<li><a href="../de462717/index.html">Das Durcheinander von zwei Yokozun</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>