<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêû üë©üèΩ‚Äçüè´ üìò Travailler avec la protection des informations cryptographiques et les supports de cl√©s mat√©rielles sous Linux ü§æüèΩ üë©üèø‚Äçüíª üéÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le stockage des cl√©s sur les jetons et les cartes √† puce offre une protection suppl√©mentaire contre les intrus externes et internes, y compris ceux ay...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Travailler avec la protection des informations cryptographiques et les supports de cl√©s mat√©rielles sous Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/alfa/blog/441212/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/6t/xz/yg/6txzyg12acxsce8jlw0nl-ukdqa.png" width="80%" height="80%"></div><br>  Le stockage des cl√©s sur les jetons et les cartes √† puce offre une protection suppl√©mentaire contre les intrus externes et internes, y compris ceux ayant un certain niveau d'acc√®s au syst√®me d'information et aux √©quipements. <br><br>  Aujourd'hui, je vais vous expliquer comment nous prot√©geons les cl√©s de chiffrement et les signatures √©lectroniques dans nos syst√®mes d'information, et je le ferai dans un guide d√©taill√© et bien illustr√© pour configurer SUSE Linux Enterprise Server 12 SP3 pour travailler avec le jeton PKI Aladdin JaCarta et CryptoPro CSP KC2 4.0.9944. <br><br>  Il y avait plusieurs raisons pour publier ce guide: <br><a name="habracut"></a><br><h4>  Raison 1 </h4><br>  La documentation officielle sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Aladdin-RD JaCarta est</a> plus adapt√©e aux syst√®mes d'exploitation Astra Linux et ALT Linux, certifi√©s par le minist√®re de la D√©fense, le FSTEC et le FSB comme moyen de prot√©ger les informations. <br><br><h4>  Raison 2 </h4><br>  La meilleure instruction sur la configuration de l'interaction avec les supports mat√©riels sous Linux, qui a √©t√© trouv√©e, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">provenait</a> √©galement de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki.astralinux.ru - Travailler avec CryptoPro CSP</a> <br><br><h4>  Raison 3 </h4><br>  <b>UPD 16/04/2019:</b> Lors de la configuration de l'environnement et des √©quipements, il s'est av√©r√© que le premier op√©rateur disponible n'√©tait pas du tout JaCarta PKI Nano, comme pr√©vu, mais un appareil fonctionnant en mode SafeNet Authentication Client eToken PRO. <br><br>  <b>UPD 16/04/2019:</b> Une fois que la Banque avait besoin d'un appareil qui pouvait fonctionner dans la m√™me infrastructure qu'eToken PRO (Java).  En tant que tel appareil, la soci√©t√© ¬´ZAO Aladdin R.D.¬ª  a offert un jeton JaCarta PRO, qui a √©t√© s√©lectionn√© par la banque.  Cependant, au stade de la constitution de l'article et des documents d'exp√©dition, un employ√© de l'entreprise a commis une erreur.  Au lieu du mod√®le JaCarta PRO, JaCarta PKI a √©t√© accidentellement entr√©e dans l'article et les documents d'exp√©dition. <br><br>  <b>UPD 16/04/2019: Je</b> remercie la soci√©t√© Aladdin R.D. pour avoir aid√© √† comprendre et √† √©tablir la v√©rit√©. <br><br><blockquote>  Il n'y a aucune signification politique et cach√©e dans cette erreur, mais seulement une erreur technique d'un employ√© dans la pr√©paration des documents.  Token JaCarta PRO est un produit de la soci√©t√© Aladdin R.D.  L'applet r√©alisant la partie fonctionnelle a √©t√© d√©velopp√©e par la soci√©t√© "ZAO Aladdin R.D." </blockquote><br><br>  Cet eToken PRO √©tait destin√© √† une f√™te publi√©e avant le 1er d√©cembre 2017. <br>  Apr√®s cette date, la soci√©t√© "Aladdin R.D."  Arr√™t de la vente des appareils eToken PRO (Java). <br><br>  Un peu en avance, je dois dire que le travail avec lui a √©t√© configur√© via les pilotes appropri√©s - <b>SafenetAuthenticationClient-10.0.32-0.x86_64</b> , qui ne peuvent √™tre obtenus qu'√† l'appui d'Aladdin R.D.  sur une demande en ligne distincte. <br><br>  Dans CryptoPro CSP, pour travailler avec ce jeton, il √©tait n√©cessaire d'installer le <b>package cprocsp-rdr-emv-64 |</b>  <b>Module de support EMV / Gemalto</b> . <br><br>  Ce jeton a √©t√© d√©termin√© et a r√©pondu.  En utilisant l'utilitaire <b>SACTools du</b> package <b>SafenetAuthenticationClient</b> , il a √©t√© possible de l'initialiser.  Mais en travaillant avec la protection des informations cryptographiques, il s'est comport√© de fa√ßon extr√™mement √©trange et impr√©visible. <br><br>  Il a √©t√© montr√© comme suit, sur la commande: <br><br><pre><code class="plaintext hljs">csptest -keyset -cont '\\.\Aladdin RD JaCarta [SCR Interface] (205D325E5842) 00 00\alfa_shark' -check</code> </pre> <br>  La r√©ponse √©tait que tout allait bien: <br><br><pre> <code class="plaintext hljs">[ErrorCode: 0x00000000]</code> </pre> <br>  Mais imm√©diatement apr√®s avoir essay√© de lire les cl√©s par programme, la m√™me v√©rification a commenc√© √† produire une erreur: <br><br><pre> <code class="plaintext hljs">[ErrorCode: 0x8009001a]</code> </pre> <br>  Selon la liste des codes d'erreur du mod√®le d'objet des composants de Microsoft <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">COM Error Codes (Security and Setup)</a> <br><br><pre> <code class="plaintext hljs">NTE_KEYSET_ENTRY_BAD 0x8009001A Keyset as registered is invalid.</code> </pre> <br>  ¬´Jeu de cl√©s invalide¬ª - la raison d'un tel message peut r√©sider soit dans l'ancienne puce, le micrologiciel et l'applet Gemalto, soit dans leurs pilotes pour le syst√®me d'exploitation qui ne prend pas en charge les nouvelles normes de g√©n√©ration ES et les fonctions de hachage GOST R 34.10-2012 et GOST R 34.11- 2012. <br><br>  Dans cet √©tat, le jeton a √©t√© bloqu√©.  L'index de protection des informations cryptographiques a commenc√© √† montrer l'√©tat non pertinent du lecteur et du conteneur de cl√©s.  Le <b>red√©marrage du</b> service de fournisseur de chiffrement <b>cprocsp</b> , des <b>services de jeton pcscd</b> et de carte √† puce et de l'ensemble du syst√®me d'exploitation n'a pas aid√©, seulement la r√©initialisation. <br><br>  Pour √™tre honn√™te, il convient de noter que SafeNet eToken PRO fonctionnait correctement avec les cl√©s GOST R 34.10-2001 dans les syst√®mes d'exploitation Windows 7 et 10. <br><br>  Vous pouvez essayer d'installer le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CryptoPro CSP 4.0 FCN (Gemalto)</a> , mais l'objectif est de prot√©ger nos cl√©s ES et de chiffrement avec les produits FSB et FSTEC certifi√©s par la famille JaCarta qui prennent en charge les nouvelles normes. <br><br>  Le probl√®me a √©t√© r√©solu en prenant le vrai jeton PKI JaCarta dans le bo√Ætier (XL) normal. <br><br>  Mais beaucoup de temps a √©t√© consacr√© √† essayer de faire fonctionner Safenet eToken PRO.  Je voulais attirer l'attention sur cela et, peut-√™tre, prot√©ger quelqu'un de cela. <br><br><h4>  Raison 4 </h4><br>  Parfois, vous devez vous-m√™me revenir √† d'anciens articles et instructions.  Ceci est pratique lorsque les informations sont plac√©es dans une source externe.  Merci donc √† Habr pour l'opportunit√©. <br><br><h2>  Guide d'installation </h2><br>  Apr√®s avoir install√© le jeton JaCarta PKI dans le port USB du serveur et d√©marr√© le syst√®me, nous v√©rifions que le nouveau p√©riph√©rique est d√©tect√© et appara√Æt dans la liste: <br><br> <code>lsusb</code> <br> <br><img src="https://habrastorage.org/webt/ge/fs/tu/gefstux3tlhb7j0pag8r_fa-ose.png"><br><br>  Dans notre cas, il s'agit du <i>bus 004 p√©riph√©rique 003: ID 24dc: 0101</i> <br><br>  Pour diagnostiquer les lecteurs, vous pouvez utiliser l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilitaire pcsc-tools du projet security: chipcard (software.opensuse.org)</a> . <br><br>  Il est lanc√© par la commande: <br><br> <code>pcsc_scan</code> <br> <br><img src="https://habrastorage.org/webt/rm/v3/ki/rmv3kikfuuwmh8c9mijm3it-ieq.png"><br><br>  Jusqu'√† ce que tous les packages n√©cessaires soient install√©s, les informations sur le jeton ne seront pas affich√©es. <br><br><h3>  Installation de pilotes et de logiciels pour travailler avec JaCarta PKI </h3><br>  Sur la page Support du site "Aladdin R.D."  Nous t√©l√©chargeons la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation et les logiciels pour qu'ils fonctionnent uniquement avec JaCarta PKI</a> <br><br>  Selon le Guide d'impl√©mentation de JaCarta pour Linux, clause 4.2., La premi√®re √©tape consiste √† installer <b>pcsc-lite</b> , <b>ccid</b> et <b>libusb</b> . <br><blockquote>  Pour que l'utilitaire de gestion JaCarta fonctionne, les composants suivants doivent √™tre install√©s: <br><br><ul><li>  PC / SC Lite - une couche interm√©diaire pour fournir un acc√®s aux cartes √† puce selon la norme PC / SC, paquet pcsc-lite. </li><li>  Biblioth√®ques Ccid et libusb pour travailler avec des cl√©s USB, des cartes √† puce et des lecteurs de cartes √† puce. </li></ul></blockquote>  Nous v√©rifions la disponibilit√© de ces packages et installons: <br><br> <code>zypper search pcsc-lite</code> <br> <br><img src="https://habrastorage.org/webt/ez/0m/n_/ez0mn_o8-hmwibwiiltr5jk34xi.jpeg"><br><br> <code>zypper search libusb</code> <br> <br><img src="https://habrastorage.org/webt/ba/jn/zt/bajnztgbtt_fsbfp0tanzfvv7hk.png"><br><br> <code>zypper install pcsc-lite</code> <br> <br><img src="https://habrastorage.org/webt/qe/6i/pl/qe6ipldd5fimbo_m7j4yrmvtibw.jpeg"><br><br><img src="https://habrastorage.org/webt/1m/bo/mc/1mbomc3je9v8e82whld_0tqheje.png"><br><br> <code>zypper search CCID</code> <br> <br><img src="https://habrastorage.org/webt/mq/f4/8x/mqf48xewg61la3nuv_kumzsaxkq.png"><br><br> <code>zypper install pcsc-ccid</code> <br> <br><img src="https://habrastorage.org/webt/lx/yv/ng/lxyvngqgd1d_rdkh7tw2lofepjs.png"><br><br> <code>zypper search CCID</code> <br> <br><img src="https://habrastorage.org/webt/kq/az/ly/kqazlyxzmdusuprtyyfjhkkjick.jpeg"><br><br> <code>zypper install libusb</code> <br> <br><img src="https://habrastorage.org/webt/1f/ul/bk/1fulbklde9aj87m_ur21u8xvms0.png"><br><br>  En cons√©quence, le paquet pcsc-lite a √©t√© mis √† jour, CCID a √©t√© install√©, libusb aucune action n'a √©t√© requise. <br><br>  Les deux commandes suivantes installent le package avec les pilotes et les logiciels directement pour travailler avec JaCarta PKI: <br><br> <code>zypper install idprotectclientlib-637.03-0.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/ux/ep/1u/uxep1uijp_2kvyix-yn6qkg5ing.jpeg"><br><br> <code>zypper install idprotectclient-637.03-0.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/xy/32/hq/xy32hqxgtmgwpn-pocygfs-rn3q.jpeg"><br><br>  V√©rifiez que les pilotes et les logiciels pour JaCarta PKI sont install√©s: <br><br> <code>zypper search idprotectclient</code> <br> <br><img src="https://habrastorage.org/webt/7k/os/nk/7kosnk44-yewdh9i7odevcdzqdc.jpeg"><br><br>  En essayant de faire fonctionner SafeNet eToken PRO, j'ai trouv√© des informations selon lesquelles le <b>package openct - Library for Smart Card Readers</b> pr√©install√© dans SLES peut entrer en conflit avec <b>pcsc-lite - PCSC Smart Cards Library</b> , dont l'installation n√©cessite Aladdin R.D. <br><br> <code>zypper search openct</code> <br> <br><img src="https://habrastorage.org/webt/g8/ja/mr/g8jamrjqjkxybghgrj8rnbfuuaw.png"><br><br>  Par cons√©quent, nous supprimons le package openct: <br><br> <code>rpm -e openct</code> <br> <br>  Maintenant, tous les pilotes et logiciels n√©cessaires pour travailler avec le jeton sont install√©s. <br><br>  <b>Nous effectuons des</b> diagnostics √† l'aide de l' <b>utilitaire pcsc-tools</b> et nous assurons que JaCarta est d√©tect√© dans le syst√®me d'exploitation: <br><br> <code>pcsc_scan</code> <br> <br><img src="https://habrastorage.org/webt/t_/5s/ga/t_5sgar9ugi-z-mx2isjhpxfzj8.jpeg"><br><br><h3>  Installation des packages CryptoPro CSP </h3><br>  Lors de l'installation de CryptoPro CSP par d√©faut, les packages n√©cessaires pour travailler avec des jetons et des cartes √† puce sont manquants. <br><br> <code>zypper search cprocsp</code> <br> <br><img src="https://habrastorage.org/webt/kq/g7/sc/kqg7scnpbnxlbxiicva_gjejk8k.png"><br><br>  Installation des <b>composants JaCarta pour le composant de prise en</b> charge <b>CryptoPro CSP dans le CSP</b> <br><br> <code>zypper install cprocsp-rdr-jacarta-64-3.6.408.683-4.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/9d/uu/3e/9duu3e1vs9wu3qotu6dsllot9km.jpeg"><br><br>  Certains composants ont des d√©pendances.  Ainsi, par exemple, si vous essayez d'installer le package de support SafeNet eToken PRO <b>cprocsp-rdr-emv-64-4.0.9944-5.x86_64.rpm - module de support EMV / Gemalto</b> , nous recevrons un message sur la n√©cessit√© d'installer d'abord le composant de base du support de lecteur CSP <b>cprocsp -rdr-pcsc-64-4.0.9944-5.x86_64.rpm - Composants PC / SC pour lecteurs CryptoPro CSP</b> : <br><br><pre> <code class="plaintext hljs">zypper install cprocsp-rdr-emv-64-4.0.9944-5.x86_64.rpm Loading repository data... Reading installed packages... Resolving package dependencies... Problem: nothing provides cprocsp-rdr-pcsc-64 &gt;= 4.0 needed by cprocsp-rdr-emv-64-4.0.9944-5.x86_64 Solution 1: do not install cprocsp-rdr-emv-64-4.0.9944-5.x86_64 Solution 2: break cprocsp-rdr-emv-64-4.0.9944-5.x86_64 by ignoring some of its dependencies Choose from above solutions by number or cancel [1/2/c] (c): c</code> </pre><br>  Installez les packages de support de base pour les lecteurs et les supports cl√©s: <br><br> <code>zypper install cprocsp-rdr-pcsc-64-4.0.9944-5.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/ku/al/eh/kualehuiobnjcc6sxcfgzlzedcu.png"><br><br> <code>zypper install lsb-cprocsp-pkcs11-64-4.0.9944-5.x86_64.rpm</code> <br> <br>  Vous pouvez maintenant installer des modules pour travailler avec d'autres types de m√©dias et de composants GUI: <br><br> <code>zypper install cprocsp-rdr-emv-64-4.0.9944-5.x86_64.rpm</code> <br> <br><img src="https://habrastorage.org/webt/b1/ka/hy/b1kahy9lzptzyp6gclxtou5775y.png"><br><br><pre> <code class="plaintext hljs">zypper install cprocsp-rdr-novacard-64-4.0.9944-5.x86_64.rpm zypper install cprocsp-rdr-mskey-64-4.0.9944-5.x86_64.rpm zypper install cprocsp-rdr-gui-gtk-64-4.0.9944-5.x86_64.rpm</code> </pre><br><img src="https://habrastorage.org/webt/gn/rs/s-/gnrss-ht0-vovsebsgfdvdioxhc.png"><br><br>  V√©rifiez la configuration finale de CryptoPro CSP: <br><br><pre> <code class="plaintext hljs">zypper search cprocsp Loading repository data... Reading installed packages...</code> </pre><br><br> <code>S | Name | Summary | Type <br> ---+-----------------------------+----------------------------------------------------+-------- <br> i+ | cprocsp-curl-64 | CryptoPro Curl shared library and binaris. Build 9944. | package <br> i+ | cprocsp-rdr-emv-64 | EMV/Gemalto support module | package <br> i+ | cprocsp-rdr-gui-gtk-64 | GUI components for CryptoPro CSP readers. Build 9944. | package <br> i+ | cprocsp-rdr-jacarta-64 | JaCarta components for CryptoPro CSP. Build 683. | package <br> i+ | cprocsp-rdr-mskey-64 | Mskey support module | package <br> i+ | cprocsp-rdr-novacard-64 | Novacard support module | package <br> i+ | cprocsp-rdr-pcsc-64 | PC/SC components for CryptoPro CSP readers. Build 9944.| package <br> i+ | lsb-cprocsp-base | CryptoPro CSP directories and scripts. Build 9944. | package <br> i+ | lsb-cprocsp-ca-certs | CA certificates. Build 9944. | package <br> i+ | lsb-cprocsp-capilite-64 | CryptoAPI lite. Build 9944. | package <br> i+ | lsb-cprocsp-kc2-64 | CryptoPro CSP KC2. Build 9944. | package <br> i+ | lsb-cprocsp-pkcs11-64 | CryptoPro PKCS11. Build 9944. | package <br> i+ | lsb-cprocsp-rdr-64 | CryptoPro CSP readers. Build 9944. | package <br></code> <br><br><img src="https://habrastorage.org/webt/f-/rc/ad/f-rcadtwgu68ba6ad5wde2zke-m.jpeg"><br><br>  Pour appliquer les modifications, nous red√©marrons le service du fournisseur de cryptographie et v√©rifions son √©tat: <br><br><pre> <code class="plaintext hljs">/etc/init.d/cprocsp restart /etc/init.d/cprocsp status</code> </pre><br><img src="https://habrastorage.org/webt/vd/1a/th/vd1athcps5p7fe9cjp_ipmvvq-a.jpeg"><br><br><h3>  Configuration et diagnostics CryptoPro CSP </h3><br>  V√©rifiez si le fournisseur de chiffrement voit notre jeton et d'autres types de m√©dias disponibles avec les commandes suivantes: <br><br> <code>/opt/cprocsp/bin/amd64/csptest -card -enum -v ‚Äìv</code> <br> <br><img src="https://habrastorage.org/webt/2m/z1/d4/2mz1d4m5oyvg9nknwbnci24wcre.jpeg"><br><br> <code>/opt/cprocsp/bin/amd64/csptest -enum -info -type PP_ENUMREADERS | iconv -f cp1251</code> <br> <br><img src="https://habrastorage.org/webt/i0/xw/ro/i0xwroly12wmu3ejps9udt4tvxs.png"><br><br> <code>/opt/cprocsp/sbin/amd64/cpconfig -hardware reader -view -f cp1251</code> <br> <br><img src="https://habrastorage.org/webt/id/qu/rm/idqurmsxvepldfelr_w9vakfbwu.jpeg"><br><br>  <b>Aladdin RD JaCarta [Interface SCR] (000000000000) 00 00</b> est notre support. <br><br>  En suivant les instructions de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CryptoPro CSP pour Linux.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configurer</a> , effectuer son enregistrement dans le fournisseur cryptographique: <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/sbin/amd64/cpconfig -hardware reader -add "Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00"</code> </pre> <br><img src="https://habrastorage.org/webt/1v/xj/z_/1vxjz_h0nppdftdaeylhhobwt-a.png"><br><br>  √Ä la suite de l'ex√©cution dans le fichier de configuration <b>/etc/opt/cprocsp/config64.ini</b> <br>  une entr√©e sera ajout√©e √† la section [KeyDevices \ PCSC]: <br><br> <code>[KeyDevices\PCSC\"Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00"\Default] <br></code> <br><br>  Afin de se conformer aux exigences du formulaire CryptoPro CSP, des conditions d'utilisation et du guide de l'administrateur de la s√©curit√©: <br><blockquote>  L'utilisation de CryptoPro CSP CIP version 4.0 avec le mode de contr√¥le de cl√© am√©lior√© d√©sactiv√© n'est pas autoris√©e.  L'inclusion de ce mode est d√©crite dans les documents ZHTYA.00087-01 91 02. Guide de l'administrateur de la s√©curit√©. </blockquote>  Il est n√©cessaire d'activer un contr√¥le am√©lior√© de l'utilisation des cl√©s: <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/sbin/amd64/cpconfig -ini '\config\parameters' -add long StrengthenedKeyUsageControl 1</code> </pre> <br>  V√©rifiez que le mode est activ√©: <br><br> <code>cat /etc/opt/cprocsp/config64.ini | grep StrengthenedKeyUsageControl</code> <br> <br><img src="https://habrastorage.org/webt/lg/hn/mm/lghnmmk1d5g9xhmxgmyqjcsrddo.jpeg"><br><br>  Nous red√©marrons le service du fournisseur cryptographique: <br><br><pre> <code class="plaintext hljs">/etc/init.d/cprocsp restart /etc/init.d/cprocsp status</code> </pre><br>  Apr√®s le red√©marrage, nous v√©rifions qu'il n'y a pas d'erreur dans le travail du fournisseur avec les principaux transporteurs: <br><br> <code>/opt/cprocsp/bin/amd64/csptest -keyset ‚Äìverifycontext</code> <br> <br><img src="https://habrastorage.org/webt/qo/5x/v7/qo5xv7ayjfqa1ssyuds6dl-f-ue.jpeg"><br><br> <code>/opt/cprocsp/bin/amd64/csptest -keyset -verifycontext -enum ‚Äìunique</code> <br> <br><pre> <code class="plaintext hljs">CSP (Type:80) v4.0.9017 KC2 Release Ver:4.0.9944 OS:Linux CPU:AMD64 FastCode:REA AcquireContext: OK. HCRYPTPROV: 16052291 alfa_shark1 |SCARD\JACARTA_4E3900154029304C\CC00\E9F6 OK. Total: SYS: 0.000 sec USR: 0.000 sec UTC: 4.560 sec [ErrorCode: 0x00000000]</code> </pre><br><h3>  Travailler avec JaCarta PKI Token </h3><br>  Ex√©cutons le programme Xming (transfert X11) sur notre station afin de pouvoir ouvrir et travailler avec les interfaces graphiques des utilitaires n√©cessaires via SSH. <br><br><img src="https://habrastorage.org/webt/-s/8j/r9/-s8jr9lfz0xkjurnsrgvwx71pfy.png"><br><br>  Apr√®s avoir install√© <b>IDProtectClient</b> - logiciel pour travailler avec JaCarta PKI, deux fichiers sont apparus sur le serveur dans le dossier <b>/ usr / share / applications</b> : <br><br>  Athena-IDProtectClient.desktop <br>  Athena-IDProtectManager.desktop <br><br>  Ce sont des raccourcis o√π vous pouvez voir les options de d√©marrage des utilitaires <i>Exec = / usr / bin / SACTools</i> <br><br>  Ex√©cutez l'utilitaire <b>IDProtectPINTool</b> . <br><br>  √Ä l'aide de celui-ci, les codes d'acc√®s PIN pour le jeton sont d√©finis et modifi√©s. <br><br> <code>/usr/bin/IDProtectPINTool</code> <br> <br><img src="https://habrastorage.org/webt/wx/nf/-j/wxnf-jyonzkwr2hs2cnfy1wzxie.png"><br><br>  Lors de l'initialisation du token pour la premi√®re fois, un lien contenant les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">codes PIN (mots de passe) des principaux porteurs par d√©faut</a> sera utile <br><br>  Le programme <b>IDProtect_Manager vous</b> permet d'afficher des informations sur le jeton et le conteneur avec des cl√©s et un certificat: <br><br> <code>/usr/bin/IDProtect_Manager</code> <br> <br><img src="https://habrastorage.org/webt/nb/xb/ex/nbxbexx9njsuvpxawxszgs3lr8s.png"><br><br>  Pour acc√©der au conteneur avec les cl√©s, vous devez saisir le mot de passe: <br><br><img src="https://habrastorage.org/webt/oh/pp/l_/ohppl_roac1knnwejckvd8afypy.png"><br><br><img src="https://habrastorage.org/webt/to/bh/vb/tobhvb23ey_zq2cdwp166-qrs5m.png"><br><br>  Pour fonctionner avec <b>SafeNet Authentication Client eToken PRO,</b> il existe des programmes similaires - <b>SafeNet Authentication Client Monitor</b> et <b>SafeNet Authentication Client Tools</b> , qui fonctionnent comme suit: <br><br><pre> <code class="plaintext hljs">/usr/bin/SACMonitor /usr/bin/SACTools</code> </pre><br><img src="https://habrastorage.org/webt/ox/kl/by/oxklbysagi4vqp8crlzbzpmbuv8.jpeg"><br><br>  Il est plus pratique d'effectuer des op√©rations directement avec des conteneurs de cl√©s dans l'interface du fournisseur cryptographique CryptoPro JavaCSP: <br><br> <code>/jdk1.8.0_181/jre/bin/java ru.CryptoPro.JCP.ControlPane.MainControlPane <br></code> <br><br><img src="https://habrastorage.org/webt/yj/fi/je/yjfije_eiqqx49g1s7lvwbcwtlc.jpeg"><br><br>  Pour afficher des informations sur le contenu du conteneur avec les cl√©s, vous pouvez ex√©cuter la commande: <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/bin/amd64/csptest -keyset -cont '\\.\Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00\alfa_shark1' -info</code> </pre> <br>  Pour diagnostiquer le conteneur, utilisez la m√™me commande avec le commutateur ‚Äìcheck <br><br><pre> <code class="plaintext hljs">/opt/cprocsp/bin/amd64/csptest -keyset -cont '\\.\Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00\alfa_shark' ‚Äìcheck</code> </pre> <br>  Vous devrez saisir le mot de passe du conteneur: <br><br><img src="https://habrastorage.org/webt/m1/n4/cv/m1n4cvq78kcuqrfn1c7oxm9y3o4.png"><br><br><img src="https://habrastorage.org/webt/jr/vi/ga/jrvigahwffdkjcmfuwnwij4pdds.jpeg"><br><br><h3>  R√©cup√©ration de cl√© logicielle </h3><br>  En g√©n√©ral, un exemple de r√©cup√©ration d'une cl√© priv√©e et d'un certificat de cl√© publique √† partir d'un conteneur sur un jeton √† l'aide de CryptoPro Java CSP est le suivant: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ru.CryptoPro.JCP.KeyStore.JCPPrivateKeyEntry; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ru.CryptoPro.JCP.params.JCPProtectionParameter; KeyStore keyStore = KeyStore.getInstance(<span class="hljs-string"><span class="hljs-string">"Aladdin RD JaCarta [SCR Interface] (000000000000) 00 00"</span></span>, <span class="hljs-string"><span class="hljs-string">"JCSP"</span></span>); keyStore.load(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); JCPPrivateKeyEntry entry = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; X509Certificate certificate = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; PrivateKey privateKey = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { entry = (JCPPrivateKeyEntry) keyStore.getEntry(keyAlias, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JCPProtectionParameter(pwd)); certificate = (X509Certificate) entry.getCertificate(); privateKey = entry.getPrivateKey(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnrecoverableEntryException | NullPointerException e) { LOGGER.log(Level.WARNING, PRIVATE_KEY_NOT_FOUND + keyAlias + ExceptionUtils.getFullStackTrace(e)); }</code> </pre><br><br>  Si vous agissez comme ceci: <br><br><pre> <code class="java hljs">Key key = keyStore.getKey(keyAlias, pwd);</code> </pre><br>  le fournisseur de cryptographie essaiera alors d'afficher une demande pour entrer le mot de passe du conteneur via la console ou la fen√™tre GUI. <br><br><h3>  R√©sultats </h3><br>  Le jeton de support de cl√© de jeton est install√© dans le port USB interne du serveur. <br><br>  Le mat√©riel du serveur lui-m√™me est scell√© et plac√© dans une pi√®ce √† acc√®s limit√©. <br><br>  De telles mesures peuvent augmenter le niveau de protection de nos syst√®mes d'information contre le vol et la compromission des cl√©s de signature √©lectronique ou de chiffrement, √† distance sur le r√©seau et physiquement. <br><br><h3>  Liens utiles </h3><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Documentation d'Aladdin-RD JaCarta</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">wiki.astralinux.ru - Travailler avec CryptoPro CSP</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La liste des codes d'erreur du mod√®le d'objet des composants des codes d'erreur Microsoft COM (s√©curit√© et configuration)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CryptoPro CSP 4.0 CSP 4.0 FCN (Gemalto)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Utilitaire de diagnostic du lecteur PCSC-Tools de la s√©curit√©: projet de carte √† puce (software.opensuse.org)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CryptoPro CSP pour Linux.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Personnalisation.</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NIP de porte-cl√©s par d√©faut Aladdin-RD (mots de passe)</a> <br></li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr441212/">https://habr.com/ru/post/fr441212/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr441202/index.html">Les soci√©t√©s de services r√™vent-elles de leurs produits? Conversation avec Maxilect</a></li>
<li><a href="../fr441204/index.html">Une approche avanc√©e pour d√©tecter les limites en utilisant les parois des vaisseaux comme exemple</a></li>
<li><a href="../fr441206/index.html">Wolfensteiny 3D - reverse engineering 251 octets de JavaScript</a></li>
<li><a href="../fr441208/index.html">Comment nous avons r√©duit l'√©mission de pr√™ts √† 2 clics</a></li>
<li><a href="../fr441210/index.html">Pacemaker de stockage en cluster + DRBD (double primaire) + samba</a></li>
<li><a href="../fr441214/index.html">Guide de l'utilisateur Kibana. Visualisation. Partie 1</a></li>
<li><a href="../fr441216/index.html">Miroir noir ou pub Picooc?</a></li>
<li><a href="../fr441218/index.html">OpenAI Gym + ROS + Gazebo: entra√Ænez un robot autonome √† la maison. Partie 1</a></li>
<li><a href="../fr441220/index.html">Analyse des r√©centes attaques de masse avec capture DNS</a></li>
<li><a href="../fr441222/index.html">Pourquoi Kubernetes est-il si compliqu√© avec les r√©f√©rentiels?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>