<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÖüèΩ üëÜüèø ‚öúÔ∏è Balance de escritura y lectura de bases de datos üêß ü¶ã ‚òÇÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En un art√≠culo anterior , describ√≠ el concepto y la implementaci√≥n de una base de datos construida sobre la base de funciones, no tablas y campos como...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Balance de escritura y lectura de bases de datos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lsfusion/blog/459066/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/0w/wi/gl/0wwiglioocbaxcpjodrzg5x1ocs.jpeg" alt="imagen"></div><br>  En un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> anterior <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">,</a> describ√≠ el concepto y la implementaci√≥n de una base de datos construida sobre la base de funciones, no tablas y campos como en las bases de datos relacionales.  Dio muchos ejemplos que muestran las ventajas de este enfoque sobre el cl√°sico.  Muchos los encontraron no lo suficientemente convincentes. <br><br>  En este art√≠culo, mostrar√© c√≥mo este concepto le permite equilibrar r√°pida y convenientemente la escritura y la lectura en la base de datos sin ning√∫n cambio en la l√≥gica del trabajo.  Intentaron implementar una funcionalidad similar en DBMS comerciales modernos (en particular, Oracle y Microsoft SQL Server).  Al final del art√≠culo, mostrar√© lo que les sucedi√≥, por decirlo suavemente, no muy. <br><a name="habracut"></a><br><h3>  Descripci√≥n </h3><br>  Como antes, para una mejor comprensi√≥n, comenzar√© la descripci√≥n con ejemplos.  Supongamos que necesitamos implementar una l√≥gica que devuelva una lista de departamentos con el n√∫mero de empleados en ellos y su salario total. <br><br>  En una base de datos funcional, se ver√° as√≠: <br><div class="scrollable-table"><table><tbody><tr><td><code><font color="#a626a4">CLASS</font> Department ''; <br> name '' = <font color="#a626a4">DATA</font> <font color="#a626a4">STRING</font> [ <font color="#986801">100</font> ] (Department); <br> <br> <font color="#a626a4">CLASS</font> Employee ''; <br> department '' = <font color="#a626a4">DATA</font> Department (Employee); <br> salary '' = <font color="#a626a4">DATA</font> <font color="#a626a4">NUMERIC</font> [ <font color="#986801">10</font> , <font color="#986801">2</font> ] (Employee); <br> <br> countEmployees '- ' (Department d) = <br> <font color="#a626a4">GROUP</font> <font color="#a626a4">SUM</font> <font color="#986801">1</font> <font color="#a626a4">IF</font> department(Employee e) = d; <br> salarySum ' ' (Department d) = <br> <font color="#a626a4">GROUP</font> <font color="#a626a4">SUM</font> salary(Employee e) <font color="#a626a4">IF</font> department(e) = d; <br> <br> SELECT name(Department d), countEmployees(d), salarySum(d); <br></code> </td></tr></tbody></table></div>  La complejidad de ejecutar esta consulta en cualquier DBMS ser√° equivalente a <i>O (n√∫mero de empleados)</i> , ya que para este c√°lculo debe escanear toda la tabla de empleados y luego agruparlos por departamento.  Tambi√©n habr√° una peque√±a adici√≥n (creemos que hay muchos m√°s empleados que departamentos) dependiendo del plan elegido <i>O (n√∫mero de registro de empleados)</i> u <i>O (n√∫mero de departamentos)</i> para la agrupaci√≥n, etc. <br><br>  Est√° claro que la sobrecarga para la ejecuci√≥n puede ser diferente en diferentes DBMS, pero la complejidad no cambiar√° de ninguna manera. <br><br>  En la implementaci√≥n propuesta, el DBMS funcional formar√° una subconsulta, que calcular√° los valores necesarios para el departamento y luego se unir√° a la tabla del departamento para obtener el nombre.  Sin embargo, para cada funci√≥n, al declarar, es posible especificar un marcador MATERIALIZADO especial.  El sistema crear√° autom√°ticamente un campo apropiado para cada funci√≥n.  Cuando cambia el valor de una funci√≥n, el valor del campo cambiar√° en la misma transacci√≥n.  Al acceder a esta funci√≥n, ya se realizar√° una apelaci√≥n al campo calculado. <br><br>  En particular, si configura MATERIALIZADO para las funciones <i>countEmployees</i> y <i>salarrySum</i> , en la tabla con la lista de departamentos se agregar√°n dos campos en los que se almacenar√° el n√∫mero de empleados y su salario total.  Con cualquier cambio en los empleados, sus salarios o afiliaci√≥n con los departamentos, el sistema cambiar√° autom√°ticamente los valores de estos campos.  La consulta anterior comenzar√° a acceder a estos campos directamente y se ejecutar√° para <i>O (n√∫mero de departamentos)</i> . <br><br>  ¬øCu√°les son las limitaciones?  Solo una cosa: dicha funci√≥n debe tener un n√∫mero finito de valores de entrada para los que se define su valor.  De lo contrario, ser√° imposible construir una tabla que almacene todos sus valores, ya que no puede haber una tabla con un n√∫mero infinito de filas. <br><br>  Un ejemplo: <br><div class="scrollable-table"><table><tbody><tr><td> <code>employeesCount '    &gt; N' (Department d, <font color="#a626a4">NUMERIC</font> [ <font color="#986801">10</font> , <font color="#986801">2</font> ] N) = <br> <font color="#a626a4">GROUP</font> <font color="#a626a4">SUM</font> salary(Employee e) <font color="#a626a4">IF</font> department(e) = d <font color="#a626a4">AND</font> salary(e) &gt; N; <br></code> </td></tr></tbody></table></div>  Esta funci√≥n se define para un n√∫mero infinito de valores del n√∫mero N (por ejemplo, cualquier valor negativo es adecuado).  Por lo tanto, no se puede poner MATERIALIZADO.  Por lo tanto, esta es una limitaci√≥n l√≥gica y no t√©cnica (es decir, no porque no hayamos podido implementar esto).  De lo contrario, no hay restricciones.  Puede usar la agrupaci√≥n, la clasificaci√≥n, AND y OR, PARTITION, recursi√≥n, etc. <br><br>  Por ejemplo, en la tarea 2.2 del art√≠culo anterior, puede poner MATERIALIZADO en ambas funciones: <br><div class="scrollable-table"><table><tbody><tr><td> <code>bought <font color="#50a14f">''</font> (Customer c, Product p, <font color="#a626a4">INTEGER</font> y) = <br> <font color="#a626a4">GROUP</font> <font color="#a626a4">SUM</font> sum(Detail d) <font color="#a626a4">IF</font> <br> customer(order(d)) = c <font color="#a626a4">AND</font> <br> product(d) = p <font color="#a626a4">AND</font> <br> extractYear(date(order(d))) = y <font color="#a626a4">MATERIALIZED</font> ; <br> rating <font color="#50a14f">''</font> (Customer c, Product p, <font color="#a626a4">INTEGER</font> y) = <br> <font color="#a626a4">PARTITION</font> <font color="#a626a4">SUM</font> <font color="#986801">1</font> <font color="#a626a4">ORDER</font> <font color="#a626a4">DESC</font> bought(c, p, y), p <font color="#a626a4">BY</font> c, y <font color="#a626a4">MATERIALIZED</font> ; <br> SELECT contactName(Customer c), name(Product p) <font color="#a626a4">WHERE</font> rating(c, p, <font color="#986801">1997</font> ) &lt; <font color="#986801">3</font> ; <br></code> </td></tr></tbody></table></div>  El propio sistema crear√° una tabla con claves de los tipos <i>Cliente</i> , <i>Producto</i> e <i>INTEGER</i> , le agregar√° dos campos y actualizar√° los valores de los campos en ellos con cualquier cambio.  Tras nuevas llamadas a estas funciones, no se calcular√°n, pero se leer√°n los valores de los campos correspondientes. <br><br>  Con este mecanismo, puede, por ejemplo, deshacerse de la recursividad (CTE) en las consultas.  En particular, considere los grupos que forman el √°rbol usando la relaci√≥n hijo / padre (cada grupo tiene un enlace a su padre): <br><div class="scrollable-table"><table><tbody><tr><td> <code>parent = <font color="#a626a4">DATA</font> Group (Group); <br></code> </td></tr></tbody></table></div>  En una base de datos funcional, la l√≥gica de recursi√≥n se puede definir de la siguiente manera: <br><div class="scrollable-table"><table><tbody><tr><td> <code>level (Group child, Group parent) = <font color="#a626a4">RECURSION</font> <font color="#986801">1l</font> <font color="#a626a4">IF</font> child <font color="#a626a4">IS</font> Group <font color="#a626a4">AND</font> parent == child <br> <font color="#a626a4">STEP</font> <font color="#986801">2l</font> <font color="#a626a4">IF</font> parent == parent($parent); <br> isParent (Group child, Group parent) = <font color="#a626a4">TRUE</font> <font color="#a626a4">IF</font> level(child, parent) <font color="#a626a4">MATERIALIZED</font> ; <br></code> </td></tr></tbody></table></div>  Dado que MATERIALIZED est√° fijado para la funci√≥n <i>isParent</i> , se <i>crear√°</i> una tabla con dos claves (grupos), en la que el campo <i>isParent</i> ser√° verdadero solo si la primera clave es descendiente de la segunda.  El n√∫mero de entradas en esta tabla ser√° igual al n√∫mero de grupos multiplicado por la profundidad promedio del √°rbol.  Si es necesario, por ejemplo, calcular el n√∫mero de descendientes de un determinado grupo, puede acceder a esta funci√≥n: <br><div class="scrollable-table"><table><tbody><tr><td> <code>childrenCount (Group g) = <font color="#a626a4">GROUP</font> <font color="#a626a4">SUM</font> <font color="#986801">1</font> <font color="#a626a4">IF</font> isParent(Group child, g); <br></code> </td></tr></tbody></table></div>  No habr√° CTE en la consulta SQL.  En cambio, habr√° un simple GROUP BY. <br><br>  Con este mecanismo, tambi√©n puede desnormalizar f√°cilmente la base de datos si es necesario: <br><div class="scrollable-table"><table><tbody><tr><td> <code><font color="#a626a4">CLASS</font> Order <font color="#50a14f">''</font> ; <br> date <font color="#50a14f">''</font> = <font color="#a626a4">DATA</font> <font color="#a626a4">DATE</font> (Order); <br> <br> <font color="#a626a4">CLASS</font> OrderDetail <font color="#50a14f">' '</font> ; <br> order <font color="#50a14f">''</font> = <font color="#a626a4">DATA</font> Order (OrderDetail); <br> date <font color="#50a14f">''</font> (OrderDetail d) = date(order(d)) <font color="#a626a4">MATERIALIZED</font> <font color="#a626a4">INDEXED</font> ; <br></code> </td></tr></tbody></table></div>  Cuando llame a la funci√≥n de <i>fecha</i> para la l√≠nea de orden, la lectura ser√° de la tabla con l√≠neas de orden del campo para el que hay un √≠ndice.  Al cambiar la fecha del pedido, el propio sistema recalcular√° autom√°ticamente la fecha desnormalizada en la l√≠nea. <br><br><h3>  Los beneficios </h3><br>  ¬øPor qu√© se necesita todo este mecanismo?  En los DBMS cl√°sicos, sin reescribir consultas, un desarrollador o un DBA solo pueden cambiar √≠ndices, determinar estad√≠sticas y decirle al planificador de consultas c√≥mo ejecutarlos (adem√°s, las SUGERENCIAS est√°n disponibles solo en DBMS comerciales).  No importa cu√°nto lo intenten, no podr√°n cumplir la primera solicitud del art√≠culo para <i>O (n√∫mero de departamentos)</i> sin cambiar las solicitudes y agregar desencadenantes.  En el esquema propuesto, en la etapa de desarrollo, no tiene que pensar en la estructura del almacenamiento de datos y qu√© agregaciones usar.  Todo esto se puede cambiar f√°cilmente sobre la marcha, directamente en funcionamiento. <br><br>  En la pr√°ctica, esto es lo siguiente.  Algunas personas desarrollan l√≥gica directamente basada en la tarea.  No est√°n versados ‚Äã‚Äãen algoritmos y su complejidad, ni en planes de ejecuci√≥n, ni en tipos de join'ov, ni en ning√∫n otro componente t√©cnico.  Estas personas son m√°s analistas de negocios que desarrolladores.  Luego, todo entra en pruebas u operaci√≥n.  El registro de consultas largas est√° habilitado.  Cuando se detecta una solicitud larga, otras personas (m√°s t√©cnicas, de hecho DBA) deciden incluir MATERIALIZADO en alguna funci√≥n intermedia.  De este modo, la grabaci√≥n se ralentiza un poco (ya que se requiere actualizar un campo adicional en una transacci√≥n).  Sin embargo, no solo esta solicitud se acelera significativamente, sino tambi√©n todas las dem√°s que usan esta funci√≥n.  Al mismo tiempo, tomar una decisi√≥n sobre qu√© funci√≥n particular materializar es relativamente simple.  Dos par√°metros principales: el n√∫mero de posibles valores de entrada (exactamente cu√°ntos registros habr√° en la tabla correspondiente) y con qu√© frecuencia se usa en otras funciones. <br><br><h3>  An√°logos </h3><br>  Los DBMS comerciales modernos tienen mecanismos similares: VISTA MATERIALIZADA con FAST REFRESH (Oracle) e INDEXED VIEW (Microsoft SQL Server).  En PostgreSQL MATERIALIZED VIEW no se puede actualizar en una transacci√≥n, sino solo a pedido (e incluso con restricciones muy estrictas), por lo que no lo consideramos.  Pero tienen varios problemas, lo que limita en gran medida su uso. <br><br>  Primero, puede habilitar la materializaci√≥n solo si ya ha creado una VISTA normal.  De lo contrario, tendr√° que volver a escribir las solicitudes restantes para acceder a la vista reci√©n creada para poder utilizar esta materializaci√≥n.  O d√©jelo como est√°, pero ser√° al menos ineficaz si hay ciertos datos ya calculados, pero muchas consultas no siempre los usan, sino que los calcula de nuevo. <br><br>  En segundo lugar, tienen una gran cantidad de restricciones: <br><br><div class="spoiler">  <b class="spoiler_title">Or√°culo</b> <div class="spoiler_text"><blockquote><h5>  5.3.8.4 Restricciones generales sobre la actualizaci√≥n r√°pida </h5><br>  La consulta de definici√≥n de la vista materializada est√° restringida de la siguiente manera: <br><ul><li>  La vista materializada no debe contener referencias a expresiones no repetitivas como <code>SYSDATE</code> y <code>ROWNUM</code> . </li><li>  La vista materializada no debe contener referencias a tipos de datos <code>RAW</code> o <code>LONG</code> <code>RAW</code> . </li><li>  No puede contener una subconsulta de lista <code>SELECT</code> . </li><li>  No puede contener funciones anal√≠ticas (por ejemplo, <code>RANK</code> ) en la cl√°usula <code>SELECT</code> . </li><li>  No puede hacer referencia a una tabla en la que se define un √≠ndice <code>XMLIndex</code> . </li><li>  No puede contener una cl√°usula <code>MODEL</code> . </li><li>  No puede contener una cl√°usula <code>HAVING</code> con una subconsulta. </li><li>  No puede contener consultas anidadas que tengan <code>ANY</code> , <code>ALL</code> o <code>NOT</code> <code>EXISTS</code> . </li><li>  No puede contener una cl√°usula <code>[START WITH ‚Ä¶] CONNECT BY</code> . </li><li>  No puede contener varias tablas de detalles en diferentes sitios. </li><li>  <code>ON</code> <code>COMMIT</code> las vistas materializadas no pueden tener tablas de detalles remotas. </li><li>  Las vistas materializadas anidadas deben tener una uni√≥n o agregado. </li><li>  Las vistas de uni√≥n materializadas y las vistas agregadas materializadas con una cl√°usula <code>GROUP</code> <code>BY</code> no se pueden seleccionar de una tabla organizada por √≠ndice. </li></ul><br><h5>  5.3.8.5 Restricciones a la actualizaci√≥n r√°pida en vistas materializadas con combinaciones solamente </h5><br>  La definici√≥n de consultas para vistas materializadas solo con combinaciones y sin agregados tiene las siguientes restricciones para la actualizaci√≥n r√°pida: <br><ul><li>  Todas las restricciones de " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Restricciones generales sobre la actualizaci√≥n r√°pida</a> ". </li><li>  No pueden tener cl√°usulas o agregados <code>GROUP</code> <code>BY</code> . </li><li>  Los Rowids de todas las tablas en la lista <code>FROM</code> deben aparecer en la lista <code>SELECT</code> de la consulta. </li><li>  Los registros de vista materializada deben existir con rowids para todas las tablas base en la lista <code>FROM</code> de la consulta. </li><li>  No puede crear una vista materializada r√°pida y actualizable desde varias tablas con combinaciones simples que incluyen una columna de tipo de objeto en la instrucci√≥n <code>SELECT</code> . </li></ul><br>  Adem√°s, el m√©todo de actualizaci√≥n que elija no ser√° √≥ptimamente eficiente si: <br><ul><li>  La consulta de definici√≥n utiliza una combinaci√≥n externa que se comporta como una combinaci√≥n interna.  Si la consulta de definici√≥n contiene dicha uni√≥n, considere reescribir la consulta de definici√≥n para que contenga una uni√≥n interna. </li><li>  La lista <code>SELECT</code> de la vista materializada contiene expresiones en columnas de varias tablas. </li></ul><br><h5>  5.3.8.6 Restricciones a la actualizaci√≥n r√°pida en vistas materializadas con agregados </h5><br>  La definici√≥n de consultas para vistas materializadas con agregados o combinaciones tiene las siguientes restricciones en la actualizaci√≥n r√°pida: <br><ul><li>  Todas las restricciones de " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Restricciones generales sobre la actualizaci√≥n r√°pida</a> ". </li></ul><br>  La actualizaci√≥n r√°pida es compatible con las vistas materializadas <code>ON</code> <code>COMMIT</code> y <code>ON</code> <code>DEMAND</code> , sin embargo, se aplican las siguientes restricciones: <br><ul><li>  Todas las tablas en la vista materializada deben tener registros de vista materializados, y los registros de vista materializada deben: <br><ul><li>  Contiene todas las columnas de la tabla referenciada en la vista materializada. </li><li>  Especifique con <code>ROWID</code> e <code>INCLUDING</code> <code>NEW</code> <code>VALUES</code> . </li><li>  Especifique la cl√°usula <code>SEQUENCE</code> si se espera que la tabla tenga una combinaci√≥n de inserciones / cargas directas, eliminaciones y actualizaciones. </li></ul><br></li><li>  Solo <code>SUM</code> , <code>COUNT</code> , <code>AVG</code> , <code>VARIANCE</code> , <code>VARIANCE</code> , <code>MIN</code> y <code>MAX</code> son compatibles para una actualizaci√≥n r√°pida. </li><li>  <code>COUNT(*)</code> debe especificarse. </li><li>  Las funciones agregadas deben aparecer solo como la parte m√°s externa de la expresi√≥n.  Es decir, los agregados como <code>AVG(AVG(x))</code> o <code>AVG(x)</code> + <code>AVG(x)</code> no est√°n permitidos. </li><li>  Para cada agregado como <code>AVG(expr)</code> , el <code>COUNT(expr)</code> correspondiente <code>COUNT(expr)</code> debe estar presente.  Oracle recomienda que se especifique <code>SUM(expr)</code> . </li><li>  Si se especifica <code>STDDEV(expr</code> <code>VARIANCE(expr)</code> o <code>STDDEV(expr</code> ), <code>COUNT(expr)</code> y <code>SUM(expr)</code> deben especificarse.  Oracle recomienda que se especifique <code>SUM(expr *expr)</code> . </li><li>  La columna <code>SELECT</code> en la consulta de definici√≥n no puede ser una expresi√≥n compleja con columnas de varias tablas base.  Una posible soluci√≥n a esto es usar una vista materializada anidada. </li><li>  La lista <code>SELECT</code> debe contener todas las columnas <code>GROUP</code> <code>BY</code> . </li><li>  La vista materializada no se basa en una o m√°s tablas remotas. </li><li>  Si usa un tipo de datos <code>CHAR</code> en las columnas de filtro de un registro de vista materializada, los juegos de caracteres del sitio maestro y la vista materializada deben ser los mismos. </li><li>  Si la vista materializada tiene uno de los siguientes, la actualizaci√≥n r√°pida solo es compatible con inserciones DML convencionales y cargas directas. <br><ul><li>  Vistas materializadas con agregados <code>MIN</code> o <code>MAX</code> </li><li>  Vistas materializadas que tienen <code>SUM(expr)</code> pero no <code>COUNT(expr)</code> </li><li>  Vistas materializadas sin <code>COUNT(*)</code> </li></ul><br>  Dicha vista materializada se denomina vista materializada de solo inserci√≥n. </li><li>  Una vista materializada con <code>MAX</code> o <code>MIN</code> se puede actualizar r√°pidamente despu√©s de eliminar o mezclar sentencias DML si no tiene una cl√°usula <code>WHERE</code> . <br>  La actualizaci√≥n r√°pida m√°xima / m√≠nima despu√©s de eliminar o mezclar DML no tiene el mismo comportamiento que el caso de solo inserci√≥n.  Elimina y vuelve a calcular los valores m√°ximos / m√≠nimos para los grupos afectados.  Debe ser consciente de su impacto en el rendimiento. </li><li>  Las vistas materializadas con vistas con nombre o subconsultas en la cl√°usula <code>FROM</code> se pueden actualizar r√°pidamente siempre que las vistas se puedan combinar por completo.  Para obtener informaci√≥n sobre qu√© vistas se combinar√°n, consulte la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Referencia del lenguaje SQL de la base de datos Oracle</a> . </li><li>  Si no hay combinaciones externas, puede tener selecciones arbitrarias y combinaciones en la cl√°usula <code>WHERE</code> . </li><li>  Las vistas agregadas materializadas con uniones externas se pueden actualizar r√°pidamente despu√©s de DML convencional y cargas directas, siempre que solo se haya modificado la tabla externa.  Adem√°s, deben existir restricciones √∫nicas en las columnas de uni√≥n de la tabla de uni√≥n interna.  Si hay uniones externas, todas las uniones deben estar conectadas por <code>AND</code> sy deben usar el operador de igualdad ( <code>=</code> ). </li><li>  Para las vistas materializadas con <code>CUBE</code> , <code>ROLLUP</code> , conjuntos de agrupaci√≥n o concatenaci√≥n de ellas, se aplican las siguientes restricciones: <br><ul><li>  La lista <code>SELECT</code> debe contener un distintivo de agrupaci√≥n que puede ser una funci√≥n <code>GROUPING_ID</code> en todas las expresiones <code>GROUP</code> <code>BY</code> o funciones <code>GROUPING</code> una para cada expresi√≥n <code>GROUP</code> <code>BY</code> .  Por ejemplo, si la cl√°usula <code>GROUP</code> <code>BY</code> de la vista materializada es " <code>GROUP</code> <code>BY</code> <code>CUBE(a, b)</code> ", la lista <code>SELECT</code> debe contener " <code>GROUPING_ID(a, b)</code> " o " <code>GROUPING(a)</code> <code>AND</code> <code>GROUPING(b)</code> "para que la vista materializada se actualice r√°pidamente. </li><li>  <code>GROUP</code> <code>BY</code> no debe dar lugar a agrupaciones duplicadas.  Por ejemplo, " <code>GROUP BY a, ROLLUP(a, b)</code> " no se puede actualizar r√°pidamente porque da como resultado agrupaciones duplicadas " <code>(a), (a, b), AND (a)</code> ". </li></ul></li></ul><br><h5>  5.3.8.7 Restricciones a la actualizaci√≥n r√°pida en vistas materializadas con UNION ALL </h5><br>  Las vistas materializadas con el operador conjunto <code>UNION</code> <code>ALL</code> admiten la opci√≥n <code>REFRESH</code> <code>FAST</code> si se cumplen las siguientes condiciones: <br><ul><li>  La consulta de definici√≥n debe tener el operador <code>UNION</code> <code>ALL</code> en el nivel superior. <br><br>  El operador <code>UNION</code> <code>ALL</code> no se puede incrustar dentro de una subconsulta, con una excepci√≥n: <code>UNION</code> <code>ALL</code> puede estar en una subconsulta en la cl√°usula <code>FROM</code> siempre que la consulta de definici√≥n tenga la forma <code>SELECT * FROM</code> (vista o subconsulta con <code>UNION</code> <code>ALL</code> ) como en el siguiente ejemplo: <br><pre>  CREAR VISTA view_with_unionall AS
 (SELECCIONE c.rowid crid, c.cust_id, 2 umarker
  DE clientes c DONDE c.cust_last_name = 'Smith'
  UNI√ìN TODO
  SELECCIONE c.rowid crid, c.cust_id, 3 umarker
  DE clientes c DONDE c.cust_last_name = 'Jones');<font></font>
<font></font>
 CREAR VISTA MATERIALIZADA unionall_inside_view_mv
 ACTUALIZACI√ìN R√ÅPIDA EN LA DEMANDA
 SELECCIONAR * DESDE view_with_unionall;
</pre>  Tenga en cuenta que la vista <code>view_with_unionall</code> cumple los requisitos para una actualizaci√≥n r√°pida. </li><li>  Cada bloque de consulta en la consulta <code>UNION</code> <code>ALL</code> debe cumplir los requisitos de una vista materializada r√°pida y actualizable con agregados o una vista materializada r√°pida y renovable con uniones. <br><br>  Los registros de vista materializada apropiados se deben crear en las tablas seg√∫n sea necesario para el tipo correspondiente de vista materializada r√°pida y actualizable. <br>  Tenga en cuenta que la base de datos Oracle tambi√©n permite el caso especial de una vista materializada de una sola tabla con combinaciones solo si la columna <code>ROWID</code> se ha incluido en la lista <code>SELECT</code> y en el registro de vista materializada.  Esto se muestra en la consulta de definici√≥n de la vista <code>view_with_unionall</code> . </li><li>  La lista <code>SELECT</code> de cada consulta debe incluir un marcador <code>UNION</code> <code>ALL</code> , y la columna <code>UNION</code> <code>ALL</code> debe tener un valor num√©rico o de cadena constante diferente en cada rama <code>UNION</code> <code>ALL</code> .  Adem√°s, la columna de marcador debe aparecer en la misma posici√≥n ordinal en la lista <code>SELECT</code> de cada bloque de consulta.  Consulte " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Marcador de UNION ALL y reescritura de consultas</a> " para obtener m√°s informaci√≥n sobre los marcadores <code>UNION</code> <code>ALL</code> . </li><li>  Algunas funciones, como las uniones externas, las consultas de vistas materializadas agregadas de solo inserci√≥n y las tablas remotas no son compatibles con las vistas materializadas con <code>UNION</code> <code>ALL</code> .  Sin embargo, tenga en cuenta que las vistas materializadas utilizadas en la replicaci√≥n, que no contienen uniones o agregados, pueden actualizarse r√°pidamente cuando se utilizan <code>UNION</code> <code>ALL</code> o tablas remotas. </li><li>  El par√°metro de inicializaci√≥n de compatibilidad debe establecerse en 9.2.0 o superior para crear una vista materializada r√°pida y actualizable con <code>UNION</code> <code>ALL</code> . </li></ul></blockquote></div></div><br>  No quiero ofender a los fan√°ticos de Oracle, pero a juzgar por su lista de limitaciones, parece que este mecanismo no se escribi√≥ en el caso general utilizando alg√∫n tipo de modelo, sino miles de indios, donde a todos se les permiti√≥ escribir su propio hilo, y cada uno de ellos pudo y lo hizo  Usar este mecanismo para una l√≥gica real es como caminar en un campo minado.  En cualquier momento, puede obtener una mina, golpeando una de las limitaciones no obvias.  C√≥mo funciona esto tambi√©n es un tema aparte, pero est√° fuera del alcance de este art√≠culo. <br><br><div class="spoiler">  <b class="spoiler_title">Microsoft SQL Server</b> <div class="spoiler_text"><blockquote><h3>  Requerimientos Adicionales </h3><br>  Adem√°s de las opciones SET y los requisitos de la funci√≥n determinista, se deben cumplir los siguientes requisitos: <br><ul><li>  El usuario que ejecuta <code>CREATE INDEX</code> debe ser el propietario de la vista. </li><li>  Cuando crea el √≠ndice, la opci√≥n <code>IGNORE_DUP_KEY</code> debe establecerse en OFF (la configuraci√≥n predeterminada). </li><li>  Las tablas deben estar referenciadas por nombres de dos partes, <em>esquema</em> <strong>.</strong>  <em>nombre de tabla</em> en la definici√≥n de vista. </li><li>  Las funciones definidas por el usuario a las que se hace referencia en la vista deben crearse utilizando la opci√≥n <code>WITH SCHEMABINDING</code> . </li><li>  Cualquier funci√≥n definida por el usuario a la que se haga referencia en la vista debe estar referenciada por nombres de dos partes, <em>&lt;schema&gt;</em> <strong>.</strong>  <em>&lt;funci√≥n&gt;</em> . </li><li>  La propiedad de acceso a datos de una funci√≥n definida por el usuario debe ser <code>NO SQL</code> , y la propiedad de acceso externo debe ser <code>NO</code> . </li><li>  Las funciones de Common Language Runtime (CLR) pueden aparecer en la lista de selecci√≥n de la vista, pero no pueden ser parte de la definici√≥n de la clave de √≠ndice agrupada.  Las funciones CLR no pueden aparecer en la cl√°usula WHERE de la vista o en la cl√°usula ON de una operaci√≥n JOIN en la vista. </li><li>  Las funciones y m√©todos CLR de los tipos definidos por el usuario CLR utilizados en la definici√≥n de vista deben tener las propiedades establecidas como se muestra en la siguiente tabla. <br><div class="scrollable-table"><table><thead><tr><th>  Propiedad </th><th>  Nota </th></tr></thead><tbody><tr><td>  DETERMINISTICA = VERDADERO </td><td>  Debe declararse expl√≠citamente como un atributo del m√©todo Microsoft .NET Framework. </td></tr><tr><td>  PRECISO = VERDADERO </td><td>  Debe declararse expl√≠citamente como un atributo del m√©todo .NET Framework. </td></tr><tr><td>  ACCESO A DATOS = NO SQL </td><td>  Determinado estableciendo el atributo DataAccess en DataAccessKind.None y el atributo SystemDataAccess en SystemDataAccessKind.None. </td></tr><tr><td>  ACCESO EXTERNO = NO </td><td>  Esta propiedad por defecto es NO para las rutinas CLR. </td></tr><tr><td></td><td></td></tr></tbody></table></div></li><li>  La vista debe crearse utilizando la opci√≥n <code>WITH SCHEMABINDING</code> . </li><li>  La vista debe hacer referencia solo a las tablas base que est√°n en la misma base de datos que la vista.  La vista no puede hacer referencia a otras vistas. </li><li>  La instrucci√≥n SELECT en la definici√≥n de vista no debe contener los siguientes elementos de Transact-SQL: <br><div class="scrollable-table"><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td> <code>COUNT</code> </td> <td>  Funciones de ROWSET ( <code>OPENDATASOURCE</code> , <code>OPENQUERY</code> , <code>OPENROWSET</code> Y <code>OPENXML</code> ) </td><td>  <code>OUTER</code> une ( <code>LEFT</code> , <code>RIGHT</code> o <code>FULL</code> ) </td></tr><tr><td>  Tabla derivada (definida al especificar una instrucci√≥n <code>SELECT</code> en la cl√°usula <code>FROM</code> ) </td><td>  Autouniones </td><td>  Especificar columnas usando <code>SELECT *</code> o <code>SELECT &lt;table_name&gt;.*</code> </td></tr><tr><td> <code>DISTINCT</code> </td> <td>  <code>STDEV</code> , <code>STDEVP</code> , <code>VAR</code> , <code>VARP</code> o <code>AVG</code> </td><td>  Expresi√≥n de tabla com√∫n (CTE) </td></tr><tr><td>  <strong>flotante</strong> <sup>1</sup> , <strong>texto</strong> , <strong>ntext</strong> , <strong>imagen</strong> , <strong>XML</strong> o columnas de <strong>flujo de archivos</strong> </td><td>  Subconsulta </td><td>  Cl√°usula <code>OVER</code> , que incluye funciones de clasificaci√≥n o ventana agregada </td></tr><tr><td>  Predicados de texto completo ( <code>CONTAINS</code> , <code>FREETEXT</code> ) </td><td>  Funci√≥n <code>SUM</code> que hace referencia a una expresi√≥n anulable </td><td> <code>ORDER BY</code> </td> </tr><tr><td>  Funci√≥n agregada definida por el usuario CLR </td><td> <code>TOP</code> </td> <td>  <code>ROLLUP</code> <code>CUBE</code> , <code>ROLLUP</code> o <code>ROLLUP</code> <code>GROUPING SETS</code> </td></tr><tr><td>  <code>MIN</code> , <code>MAX</code> </td><td>  Operadores <code>UNION</code> , <code>EXCEPT</code> o <code>INTERSECT</code> </td><td> <code>TABLESAMPLE</code> </td> </tr><tr><td>  Variables de la tabla </td><td>  <code>OUTER APPLY</code> o <code>CROSS APPLY</code> </td><td>  <code>PIVOT</code> , <code>UNPIVOT</code> </td></tr><tr><td>  Conjuntos de columnas dispersas </td><td>  Funciones en l√≠nea (TVF) o con valores de tabla de varias instrucciones (MSTVF) </td><td> <code>OFFSET</code> </td> </tr><tr><td> <code>CHECKSUM_AGG</code> </td> <td></td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table></div><br>  <sup>1</sup> La vista indizada puede contener columnas <strong>flotantes</strong> ;  sin embargo, tales columnas no se pueden incluir en la clave de √≠ndice agrupado. </li><li>  Si <code>GROUP BY</code> est√° presente, la definici√≥n VIEW debe contener <code>COUNT_BIG(*)</code> y no debe contener <code>HAVING</code> .  Estas restricciones de <code>GROUP BY</code> son aplicables solo a la definici√≥n de vista indizada.  Una consulta puede usar una vista indizada en su plan de ejecuci√≥n incluso si no cumple con estas restricciones <code>GROUP BY</code> . </li><li>  Si la definici√≥n de vista contiene una cl√°usula <code>GROUP BY</code> , la clave del √≠ndice agrupado √∫nico puede hacer referencia solo a las columnas especificadas en la cl√°usula <code>GROUP BY</code> . </li></ul></blockquote></div></div><br>  Aqu√≠ puede ver que los indios no se sintieron atra√≠dos, ya que decidieron hacerlo de acuerdo con el esquema "haremos poco, pero bien".  Es decir, tienen m√°s minas en el campo, pero su ubicaci√≥n es m√°s transparente.  Lo m√°s angustiante es esta limitaci√≥n: <br><blockquote>  La vista debe hacer referencia solo a las tablas base que est√°n en la misma base de datos que la vista.  La vista no puede hacer referencia a otras vistas. </blockquote><br>  En nuestra terminolog√≠a, esto significa que una funci√≥n no puede acceder a otra funci√≥n materializada.  Corta toda la ideolog√≠a de ra√≠z. <br>  Adem√°s, esta limitaci√≥n (y m√°s adelante en el texto) reduce en gran medida los casos de uso: <br><blockquote>  La instrucci√≥n SELECT en la definici√≥n de vista no debe contener los siguientes elementos de Transact-SQL: <br><div class="scrollable-table"><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td> <code>COUNT</code> </td> <td>  Funciones de ROWSET ( <code>OPENDATASOURCE</code> , <code>OPENQUERY</code> , <code>OPENROWSET</code> Y <code>OPENXML</code> ) </td><td>  <code>OUTER</code> une ( <code>LEFT</code> , <code>RIGHT</code> o <code>FULL</code> ) </td></tr><tr><td>  Tabla derivada (definida al especificar una instrucci√≥n <code>SELECT</code> en la cl√°usula <code>FROM</code> ) </td><td>  Autouniones </td><td>  Especificar columnas usando <code>SELECT *</code> o <code>SELECT &lt;table_name&gt;.*</code> </td></tr><tr><td> <code>DISTINCT</code> </td> <td>  <code>STDEV</code> , <code>STDEVP</code> , <code>VAR</code> , <code>VARP</code> o <code>AVG</code> </td><td>  Expresi√≥n de tabla com√∫n (CTE) </td></tr><tr><td>  <strong>flotante</strong> <sup>1</sup> , <strong>texto</strong> , <strong>ntext</strong> , <strong>imagen</strong> , <strong>XML</strong> o columnas de <strong>flujo de archivos</strong> </td><td>  Subconsulta </td><td>  Cl√°usula <code>OVER</code> , que incluye funciones de clasificaci√≥n o ventana agregada </td></tr><tr><td>  Predicados de texto completo ( <code>CONTAINS</code> , <code>FREETEXT</code> ) </td><td>  Funci√≥n <code>SUM</code> que hace referencia a una expresi√≥n anulable </td><td> <code>ORDER BY</code> </td> </tr><tr><td>  Funci√≥n agregada definida por el usuario CLR </td><td> <code>TOP</code> </td> <td>  <code>ROLLUP</code> <code>CUBE</code> , <code>ROLLUP</code> o <code>ROLLUP</code> <code>GROUPING SETS</code> </td></tr><tr><td>  <code>MIN</code> , <code>MAX</code> </td><td>  Operadores <code>UNION</code> , <code>EXCEPT</code> o <code>INTERSECT</code> </td><td> <code>TABLESAMPLE</code> </td> </tr><tr><td>  Variables de la tabla </td><td>  <code>OUTER APPLY</code> o <code>CROSS APPLY</code> </td><td>  <code>PIVOT</code> , <code>UNPIVOT</code> </td></tr><tr><td>  Conjuntos de columnas dispersas </td><td>  Funciones en l√≠nea (TVF) o con valores de tabla de varias instrucciones (MSTVF) </td><td> <code>OFFSET</code> </td> </tr><tr><td> <code>CHECKSUM_AGG</code> </td> <td></td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table></div></blockquote><br>  OUTER JOINS, UNION, ORDER BY y otros est√°n prohibidos.  Quiz√°s fue m√°s f√°cil indicar qu√© se puede usar que qu√© no.  La lista probablemente ser√≠a mucho m√°s peque√±a. <br><br>  Para resumir: un gran conjunto de restricciones en cada DBMS (noto comercial) versus ninguno (con la excepci√≥n de uno l√≥gico en lugar de t√©cnico) en la tecnolog√≠a LGPL.  Sin embargo, debe tenerse en cuenta que implementar este mecanismo en la l√≥gica relacional es algo m√°s complicado que en el funcional descrito. <br><br><h3>  Implementaci√≥n </h3><br>  Como funciona  PostgreSQL se utiliza como una "m√°quina virtual".  En el interior hay un algoritmo complejo que genera consultas.  Aqu√≠ est√° el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">c√≥digo fuente</a> .  Y no solo hay un gran conjunto de heur√≠sticas con un mont√≥n de ifs.  Entonces, si tiene un par de meses para estudiar, puede intentar comprender la arquitectura. <br><br>  ¬øFunciona de manera eficiente?  Efectivamente suficiente.  Desafortunadamente, probar esto es dif√≠cil.  Solo puedo decir que si considera las miles de solicitudes que se encuentran en aplicaciones grandes, en promedio son m√°s efectivas que un buen desarrollador.  Un excelente programador de SQL puede escribir cualquier consulta de manera m√°s eficiente, pero con mil consultas, simplemente no tendr√° la motivaci√≥n ni el tiempo para hacerlo.  Lo √∫nico que puedo dar ahora como evidencia de efectividad es que, sobre la base de la plataforma construida en este DBMS, varios proyectos del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sistema ERP</a> funcionan en los que hay miles de funciones MATERIALIZADAS diferentes, con miles de usuarios y bases de datos de terrabyte con cientos de millones de registros funcionando en un servidor de doble procesador normal.  Sin embargo, cualquiera puede probar / refutar la efectividad descargando la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">plataforma</a> y PostgreSQL, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">permitiendo el</a> registro de consultas SQL e intentando cambiar la l√≥gica y los datos all√≠. <br><br>  En los siguientes art√≠culos, tambi√©n hablar√© sobre c√≥mo puede colgar restricciones en las funciones, trabajar con sesiones de cambio y mucho m√°s. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/459066/">https://habr.com/ru/post/459066/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459046/index.html">C√≥mo implementar independientemente (Prueba de existencia) en 2 pasos</a></li>
<li><a href="../459050/index.html">Potente m√≥dulo de escritura Vuex</a></li>
<li><a href="../459052/index.html">C√≥mo comparar: "coche incre√≠ble" y "choza fea", en una encuesta de marketing y en Big Data</a></li>
<li><a href="../459054/index.html">Mapa de calor de clics: c√≥mo se comportan los usuarios en el sitio</a></li>
<li><a href="../459062/index.html">El resumen de materiales interesantes para el desarrollador m√≥vil # 305 (del 1 al 7 de julio)</a></li>
<li><a href="../459068/index.html">Windows Server 2008 R2 - El rey est√° muerto, viva el rey</a></li>
<li><a href="../459070/index.html">Creaci√≥n de defensa de la torre en la unidad: torres y enemigos que disparan</a></li>
<li><a href="../459074/index.html">Petty little joy # 7: tres por el precio de uno: animaci√≥n de consola, algoritmos y depuraci√≥n</a></li>
<li><a href="../459078/index.html">CERN cambia a software de c√≥digo abierto, ¬øpor qu√©?</a></li>
<li><a href="../459080/index.html">Caracter√≠sticas HttpUrlConnection de java.net</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>