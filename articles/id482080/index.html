<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ»â€âš–ï¸ ğŸ”ƒ ğŸ•¥ Gateway untuk UDP antara Wi-Fi dan LoRa ğŸ§‘ ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ» ğŸ§“ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kami membuat gateway antara Wi-Fi dan LoRa untuk UDP 





 Saya memiliki mimpi masa kecil - untuk memberi setiap rumah tangga perangkat "bebas Wi-Fi"...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gateway untuk UDP antara Wi-Fi dan LoRa</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482080/"><h1 id="delaem-shlyuz-mezhdu-wi-fi-i-lora-dlya-udp">  Kami membuat gateway antara Wi-Fi dan LoRa untuk UDP </h1><br><p><img src="https://habrastorage.org/webt/7r/6w/qs/7r6wqsteous5ebxb2pjrlplmqbm.png"></p><br><p>  Saya memiliki mimpi masa kecil - untuk memberi setiap rumah tangga perangkat "bebas Wi-Fi" tiket jaringan, yaitu, alamat IP dan porta.  Setelah beberapa waktu, saya menyadari bahwa saya seharusnya tidak menundanya.  Kita harus mengambil dan melakukannya. </p><br><h2 id="tehnicheskoe-zadanie">  Kerangka Acuan </h2><br><p>  Jadikan sebagai gateway M5Stack dengan Modul LoRa terpasang (Gambar 1).  Gateway akan terhubung ke jaringan Wi-Fi untuk mendapatkan alamat IP lokal melalui DHCP.  Gateway akan menyiarkan namanya di LoRa-ether dengan frekuensi tertentu (analog SSID untuk Wi-Fi) dan rentang port yang dapat diterima, sehingga perangkat lain tahu bahwa ada jaringan yang dapat Anda sambungkan dan di mana Anda dapat memilih port gratis.  Karena ini akan menjadi prototipe, otentikasi tidak kali ini.  Perangkat klien baru akan menemukan jaringan LoRa yang tersedia dan mengirimkan port yang dipilih ke sana.  Setelah gateway menerima port dari klien baru, ia memeriksa apakah itu gratis, jika demikian, ia mendaftarkan klien baru dan mulai mendengarkan port ini di server UDP asinkronnya sendiri.  Setelah pendaftaran, klien akan menerima persetujuan atau penolakan untuk menggunakan port yang dinyatakan.  Prosedur operasi ditunjukkan pada tabel 1. </p><br><p><img src="https://habrastorage.org/webt/cz/am/ab/czamabsepozwcixjn0rdwe7hmw8.png"><br>  Gambar 1 </p><br><p>  Tabel 1 </p><br><div class="scrollable-table"><table><thead><tr><th>  sisi </th><th>  arah dan data </th><th>  sisi </th><th>  sesi </th></tr></thead><tbody><tr><td>  [pelanggan] </td><td>  &lt;- sinyal suar - </td><td>  [gerbang] </td><td>  0xA1 </td></tr><tr><td>  [pelanggan] </td><td>  - port yang dipilih -&gt; </td><td>  [gerbang] </td><td>  0xB1 </td></tr><tr><td>  [pelanggan] </td><td>  &lt;- persetujuan atau penolakan - </td><td>  [gerbang] </td><td>  0xA2 </td></tr><tr><td>  [pelanggan] </td><td>  - Paket UPD -&gt; </td><td>  [gerbang] </td><td>  0xB2 </td></tr><tr><td>  [pelanggan] </td><td>  &lt;- Paket UPD - </td><td>  [gerbang] </td><td>  0xA3 </td></tr><tr><td>  [jaringan] </td><td>  &lt;- Paket UPD - </td><td>  [gerbang] </td><td>  0xC1 </td></tr></tbody></table></div><br><p>  Sebelum saya di meja ada segala macam Modul untuk M5Stack dan bosan.  Mari kita ambil LoR <del>  dan bersenang-senang dengannya </del>  .  Konsep modul itu sendiri sangat indah!  Apa yang bisa saya katakan?  Tapi, modul revisi pertama saya, di mana antena built-in yang mengerikan, dibuat pada papan sirkuit cetak yang fleksibel dan direkatkan ke dinding samping case.  Saya pernah melakukan tes lapangan untuk modul-modul tersebut (Anda dapat menontonnya di saluran berbahasa Rusia di YouTube): </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/2mWAu6X_v-U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Secara alami, saya harus menghapus rudiments ini dan menyolder antena heliks standar yang datang dengan Ra-01.  Setelah penyesuaian seperti itu, jangkauan komunikasi meningkat secara nyata, tetapi muncul titik samping - antena memiliki diameter lebih besar dari jarak yang diperbolehkan antara modul.  Saya harus meninggalkan modul Final selama durasi proyek. </p><a name="habracut"></a><br><h2 id="pervye-trudnosti-ot-sihronnoy-tugosti">  Kesulitan pertama <del>  dari sesak sinkronis </del></h2><br><p>  Tampaknya mengambil perpustakaan <strong>WiFiUdp.h</strong> , di mana semuanya untuk keberadaan nyaman server UDP, tidak.  Perpustakaan dirancang untuk mengangkat server sinkron, yang, sayangnya, tidak dapat melayani beberapa koneksi secara bersamaan.  Perpustakaan seperti itu tidak cocok untuk tugas saat ini.  Saya harus minum banyak cangkir teh dan mencari perpustakaan yang memungkinkan kami untuk meningkatkan server UDP asinkron yang mampu mendukung banyak koneksi secara bersamaan.  Perpustakaan seperti itu ditemukan - <strong>AsyncUDP.h</strong> .  Apa perbedaan antara server yang sinkron dan yang tidak sinkron?  Mari kita lihat enam episode pada Gambar 2, di mana opsi operasi socket ditampilkan secara sepele. </p><br><p><img src="https://habrastorage.org/webt/fa/ay/fv/faayfvfxtqvi8nu5s_ks4ssbava.jpeg"></p><br><p>  Gambar 2 </p><br><p>  Dibintangi: </p><br><p>  <strong>Seorang pria</strong> dalam peran <strong>soket</strong> ; </p><br><p>  <strong>Dove</strong> dalam peran <strong>Compound</strong> ; </p><br><p>  <strong>Pismo</strong> sebagai <strong>Data</strong> . </p><br><h3 id="epizod-a-sinhronnyy-soket-bez-taymauta">  Episode A. Soket Sinkron tanpa Batas Waktu </h3><br><p>  Seseorang akan berdiri sampai Merpati membawakannya Surat. </p><br><h3 id="epizod-b-sinhronnyy-soket-s-taymautom">  Episode B. Socket Sinkron dengan Timeout </h3><br><p>  Seorang pria menunggu waktu yang disepakati dengan Merpati, dan jika dia tidak tiba tepat waktu, maka Pria itu akan pergi. </p><br><h3 id="epizod-c-sinhronnyy-soket-s-mnogopotochnostyu">  Episode C. Soket Multithreading Sinkron </h3><br><p>  Seorang pria duduk dan menonton ketika Merpati mengirimkan Surat sendiri. </p><br><h3 id="epizod-d-asinhronnyy-soket-kogda-nechego-eschyo-poluchat">  Episode D. Soket asinkron (ketika tidak ada lagi yang menerima) </h3><br><p>  Seorang pria melakukan hal-hal favoritnya, tetapi tidak melupakan Merpati. </p><br><h3 id="epizod-e-asinhronnyy-soket-kogda-est-chto-poluchit">  Episode E. Soket asinkron (ketika ada sesuatu untuk diterima) </h3><br><p>  Pria itu sejenak mengalihkan perhatiannya dari urusannya untuk menerima surat dari Dove. </p><br><h3 id="epizod-f-asinhronnyy-soket-s-mnogopotochnostyu">  Episode F. Socket Multithreading Asynchronous </h3><br><p>  Seorang lelaki menjalankan bisnisnya dan mengawasi Merpati mengirimkan Surat sendiri. </p><br><p>  Jika Anda berhati-hati, Anda mungkin harus memperhatikan bahwa kerah pada Merpati di setiap episode memiliki warna tertentu.  Dan ini bukan kecelakaan.  Dalam episode A dan B, hanya satu soket yang berfungsi di server dan hanya itu.  Episode C sudah memiliki dua soket.  Episode D, E, dan F sudah memiliki tiga soket.  "Kenapa ada dua, tapi di sini ada tiga?"  - kamu bertanya.  Ini kondisional 2 dan 3, pada kenyataannya, bukannya 2 bisa 20, dan bukannya tiga 200. Tugasnya adalah untuk menunjukkan bahwa soket asinkron tidak membakar besi sebanyak yang sinkron. </p><br><h2 id="kuda-skolko-chego-vmeschaetsya">  Dimana yang cocok? </h2><br><p>  Mari kita lihat tabel 1, yang menunjukkan struktur paket UDP dan berpikir tentang apa yang dapat Anda lakukan. </p><br><p>  Tabel 1. Struktur paket UDP </p><br><div class="scrollable-table"><table><thead><tr><th>  Bits </th><th>  0 - 15 </th><th>  16 - 31 </th></tr></thead><tbody><tr><td>  0-31 </td><td>  Port sumber </td><td>  Pelabuhan tujuan </td></tr><tr><td>  32-63 </td><td>  Panjang Datagram </td><td>  Checksum </td></tr><tr><td>  64 -... </td><td>  Data </td><td></td></tr></tbody></table></div><br><p>  Tambahkan bidang <strong>Sesi</strong> lain (1 Byte) ke bagian paling awal tabel ini.  Ini cukup untuk proyek ini.  Berdasarkan Sesi, perangkat akan tahu apa yang harus dilakukan dengan paket selanjutnya.  Sekarang kita akan membuat kode untuk sesi dan menuliskannya di tabel 2. </p><br><p>  Tabel 2. Deskripsi Sesi </p><br><div class="scrollable-table"><table><thead><tr><th>  Kode </th><th>  Judul </th><th>  Penjelasan </th></tr></thead><tbody><tr><td>  0xA1 </td><td>  Mercusuar </td><td>  Gateway menyiarkan nama jaringan LoRa dan kisaran port yang diizinkan dengan frekuensi tertentu.  Ini diperlukan agar klien baru melihat jaringan yang tersedia, dan klien saat ini, ketika tidak ada transmisi, dapat menentukan level sinyal. </td></tr><tr><td>  0xB1 </td><td>  Aplikasi </td><td>  Ketika klien menemukan jaringan, ia mengirim port yang disukai. </td></tr><tr><td>  0xA2 </td><td>  Persetujuan atau Penolakan </td><td>  Jika port yang diminta oleh klien gratis, maka server merespons dengan persetujuan, dan sebaliknya dengan penolakan. </td></tr><tr><td>  0xB2 </td><td>  Tautan ke atas </td><td>  Ketika klien mengirim paket UDP ke gateway. </td></tr><tr><td>  0xA3 </td><td>  Tautan bawah </td><td>  Ketika gateway mengirim paket UDP ke klien. </td></tr><tr><td>  0xC1 </td><td>  Lanjutan Tautan-Atas </td><td>  Ketika gateway mengirim paket UDP ke jaringan lokal. </td></tr></tbody></table></div><br><p>  Bagus  Sekarang mari kita bahas komposisi sesi pada tabel 3. </p><br><p>  Tabel 3. Sesi </p><br><div class="scrollable-table"><table><thead><tr><th>  Nama Sesi </th><th>  Komposisi </th></tr></thead><tbody><tr><td>  Mercusuar </td><td>  Kode sesi (1 Byte) + Nama jaringan LoRa (4 Bytes) + Start port (2 Bytes) + End port (2 Bytes) </td></tr><tr><td>  Aplikasi </td><td>  Kode Transfer (1 Byte) + Nama Jaringan LoRa (4 Bytes) + Preferred Port (2 Bytes) </td></tr><tr><td>  Persetujuan atau Penolakan </td><td>  Kode transmisi (1 Byte) + Nama jaringan LoRa (4 Bytes) + Port pilihan (2 Bytes) + Hasil (1 Byte) </td></tr><tr><td>  Tautan ke atas </td><td>  Kode transmisi (1 Byte) + Nama jaringan LoRa (4 Bytes) + Alamat IP jarak jauh (4 Bytes) + Port jarak jauh (2 Bytes) + Alamat IP lokal (4 Bytes) + Port lokal (2 Bytes) + Ukuran data (2 Bytes) + Data </td></tr><tr><td>  Tautan bawah </td><td>  Kode transmisi (1 Byte) + Nama jaringan LoRa (4 Bytes) + Alamat IP jarak jauh (4 Bytes) + Port jarak jauh (2 Bytes) + Alamat IP lokal (4 Bytes) + Port lokal (2 Bytes) + Ukuran data (2 Bytes) + Data </td></tr><tr><td>  Lanjutan Tautan-Atas </td><td>  Alamat IP jarak jauh (4 Bytes) + Remote Port (2 Bytes) + Ukuran Data (2 Bytes) + Data </td></tr></tbody></table></div><br><p>  Menulis dua klien untuk Arduino dan untuk M5Stack.  Anda dapat melihat cara kerjanya di <a href="https://youtu.be/g4aHpgWcJnY" rel="nofollow">video</a> .  Tidak ada masalah di dalam apartemen, saya belum melakukan tes lapangan. </p><br><p>  Kode sumber tersedia di GitHub di </p><br><p>  Pelajari lebih lanjut tentang M5Stack Base Unit dan beli di <a href="http://ru.m5stack.com/%3Fsearch%3D%25D0%25BA%25D0%25BB%25D0%25B0%25D1%2581%25D1%2581%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9" rel="nofollow">sini.</a> </p><br><p>  Anda dapat memilih modul nirkabel LoRa untuk Unit Dasar <a href="http://ru.m5stack.com/%3Fsearch%3Dlora" rel="nofollow">di sini</a> </p><br><p>  <strong>Saya akan senang jika proyek ini bermanfaat bagi Anda.</strong>  <strong>Terima kasih banyak atas waktu Anda!</strong> </p><br><p>  Referensi dan (atau) sumber: </p><br><ul><li>  <a href="https://qna.habr.com/q/388343" rel="nofollow">Habr T&amp;J "Apa itu soket asinkron?"</a> </li><li>  <a href="https://ru.wikipedia.org/wiki/UDP" rel="nofollow">Wikipedia "UDP"</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id482080/">https://habr.com/ru/post/id482080/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id482058/index.html">Predator atau mangsa? Siapa yang akan melindungi otoritas sertifikasi</a></li>
<li><a href="../id482060/index.html">Model Mandat Akses Kontrol (MAC): Tinjauan Umum dan Aplikasi Aplikasi</a></li>
<li><a href="../id482064/index.html">Kemudahan mengembangkan situs multibahasa di CMS Umbraco 8</a></li>
<li><a href="../id482068/index.html">Apakah saya perlu membuat array RAID dari SSD dan pengontrol apa yang diperlukan untuk ini?</a></li>
<li><a href="../id482070/index.html">Lima kebiasaan yang membantu menjaga kinerja otak</a></li>
<li><a href="../id482084/index.html">Apa yang harus dibaca pada hari libur</a></li>
<li><a href="../id482086/index.html">Analisis Bootkit</a></li>
<li><a href="../id482088/index.html">Memeluk pengembang, atau bagaimana saya pergi ke KotlinConf</a></li>
<li><a href="../id482092/index.html">Apa yang dibutuhkan orang buta? Ulasan ahli buta tuli, Sergei Fleitin</a></li>
<li><a href="../id482094/index.html">Arsitek Perangkat Lunak: mengapa diperlukan dan apa kutukannya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>