<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👏🏽 🤚🏽 🖖🏽 Redux integrierte Alternative mit React Context und Hooks 💃🏾 🤸🏿 🕜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vom Übersetzer: 

 Ich präsentiere eine kostenlose Übersetzung eines Artikels darüber, wie eine effektive Lösung implementiert werden kann, um Redux d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Redux integrierte Alternative mit React Context und Hooks</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463607/"> Vom Übersetzer: <br><br>  Ich präsentiere eine kostenlose Übersetzung eines Artikels darüber, wie eine effektive Lösung implementiert werden kann, um Redux durch React-Kontext und Hooks zu ersetzen.  Die Angabe von Fehlern in der Übersetzung oder im Text ist willkommen.  Viel Spaß beim Betrachten. <br><br><hr><br>  Seit der Veröffentlichung der neuen Kontext-API in React 16.3.0 haben sich viele Leute gefragt, ob die neue API gut genug ist, um sie als Ersatz für Redux zu betrachten.  Ich habe das Gleiche gedacht, aber ich habe es auch nach der Veröffentlichung von Version 16.8.0 mit Hooks nicht vollständig verstanden.  Ich versuche, gängige Technologien zu verwenden. Der Weg besteht nicht immer darin, die gesamte Bandbreite der Probleme zu verstehen, die sie lösen. Daher bin ich zu sehr an Redux gewöhnt. <br><br>  Und so kam es, dass ich mich für <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den</a> Newsletter von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kent C. Dodds</a> anmeldete und einige E-Mails zum Thema Kontext- und Zustandsmanagement entdeckte.  Ich fing an zu lesen ....  und lesen ... und nach 5 Blog-Posts hat etwas geklickt. <br><br>  Um alle grundlegenden Konzepte dahinter zu verstehen, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erstellen</a> wir eine Schaltfläche, indem wir darauf klicken, dass wir Witze mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">icanhazdadjoke erhalten</a> und sie anzeigen.  Dies ist ein kleines, aber ausreichendes Beispiel. <br><a name="habracut"></a><br>  Beginnen wir zur Vorbereitung mit zwei scheinbar zufälligen Tipps. <br><br>  Lassen Sie mich zunächst meinen Freund <code>console.count</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.count(<span class="hljs-string"><span class="hljs-string">'Button'</span></span>) <span class="hljs-comment"><span class="hljs-comment">// Button: 1 console.count('Button') // Button: 2 console.count('App') // App: 1 console.count('Button') // Button: 3</span></span></code> </pre><br>  Wir werden jeder Komponente einen Aufruf von <code>console.count</code> hinzufügen, um zu sehen, wie oft sie gerendert wird.  Ziemlich cool, oder? <br><br>  Zweitens wird beim erneuten Rendern einer React-Komponente der als untergeordnete Element übergebene Inhalt <b>nicht</b> erneut gerendert. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Parent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ children }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = React.useState(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.count(<span class="hljs-string"><span class="hljs-string">'Parent'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;div&gt; &lt;button type=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"button"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> onClick={(</span></span></span><span class="hljs-function">) =&gt;</span></span> { setCount(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">count</span></span></span><span class="hljs-function"> =&gt;</span></span> count + <span class="hljs-number"><span class="hljs-number">1</span></span>) }}&gt; Force re-render &lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt; {children} &lt;/</span></span>div&gt; ) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Child</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.count(<span class="hljs-string"><span class="hljs-string">'Child'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> } function App() { return ( </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Parent</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Child</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Parent</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ) }</span></span></code> </pre> <br>  Nach ein paar Klicks auf die Schaltfläche sollte der folgende Inhalt in der Konsole angezeigt werden: <br><br><pre> <code class="javascript hljs">Parent: <span class="hljs-number"><span class="hljs-number">1</span></span> Child: <span class="hljs-number"><span class="hljs-number">1</span></span> Parent: <span class="hljs-number"><span class="hljs-number">2</span></span> Parent: <span class="hljs-number"><span class="hljs-number">3</span></span> Parent: <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre> <br>  Beachten Sie, dass dies ein häufig übersehener Weg ist, um die Leistung Ihrer Anwendung zu verbessern. <br><br>  Nachdem wir fertig sind, erstellen wir das Grundgerüst unserer Anwendung: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.count(<span class="hljs-string"><span class="hljs-string">'Button'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Fetch dad joke </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DadJoke</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.count(<span class="hljs-string"><span class="hljs-string">'DadJoke'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Fetched dad joke</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">App</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.count(<span class="hljs-string"><span class="hljs-string">'App'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">DadJoke</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> App</code> </pre><br>  <code>Button</code> sollte einen Aktionsgenerator erhalten (ca. Aktionsersteller. Die Übersetzung stammt aus der <a href="">Redux-Dokumentation in russischer Sprache</a> ), der einen Witz erhält.  <code>DadJoke</code> sollte den Status erhalten und die <code>App</code> beide Komponenten im Provider-Kontext anzeigen. <br><br>  Erstellen Sie nun eine benutzerdefinierte Komponente und nennen Sie sie <code>DadJokeProvider</code> , der den Status verwaltet und die <code>DadJokeProvider</code> Komponenten in den Kontextanbieter einbindet.  Denken Sie daran, dass durch das Aktualisieren des Status aufgrund der oben genannten untergeordneten Optimierung in React nicht die gesamte Anwendung erneut gerendert wird. <br><br>  Erstellen Sie also eine Datei und nennen Sie sie <code>contexts/dad-joke.js</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DadJokeContext = React.createContext() <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DadJokeContextProvider</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ children }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> state = { <span class="hljs-attr"><span class="hljs-attr">dadJoke</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actions = { <span class="hljs-attr"><span class="hljs-attr">fetchDadJoke</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {}, } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">DadJokeContext.Provider</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">state</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">actions</span></span></span></span><span class="xml"><span class="hljs-tag"> }}&gt;</span></span></span><span class="xml"> {children} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">DadJokeContext.Provider</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ) }</span></span></code> </pre> <br>  Wir exportieren auch 2 Hooks, um den Wert aus dem Kontext zu erhalten. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useDadJokeState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> React.useContext(DadJokeContext).state } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useDadJokeActions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> React.useContext(DadJokeContext).actions }</code> </pre> <br>  Jetzt können wir dies implementieren: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { DadJokeProvider, useDadJokeState, useDadJokeActions, } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./contexts/dad-joke'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { fetchDadJoke } = useDadJokeActions() <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.count(<span class="hljs-string"><span class="hljs-string">'Button'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{fetchDadJoke}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Fetch dad joke </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DadJoke</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { dadJoke } = useDadJokeState() <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.count(<span class="hljs-string"><span class="hljs-string">'DadJoke'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{dadJoke}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">App</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.count(<span class="hljs-string"><span class="hljs-string">'App'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">DadJokeProvider</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">DadJoke</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">DadJokeProvider</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> App</code> </pre> <br>  Hier!  Dank der API haben wir die Hooks verwendet.  Wir werden während des gesamten Beitrags keine Änderungen mehr an dieser Datei vornehmen. <br><br>  Beginnen wir mit dem Hinzufügen von Funktionen zu unserer Kontextdatei, beginnend mit dem Status von <code>DadJokeProvider</code> .  Ja, wir könnten einfach den <code>useState</code> Hook verwenden, aber lassen Sie uns stattdessen unseren Status durch <code>reducer</code> indem wir uns einfach die bekannte und beliebte <code>Redux</code> Funktionalität hinzufügen. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'SET_DAD_JOKE'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">dadJoke</span></span>: action.payload, } <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(); } }</code> </pre> <br>  Jetzt können wir diesen Reduzierer an den <code>useReducer</code> Hook übergeben und mit der API Witze machen: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DadJokeProvider</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ children }</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, dispatch] = React.useReducer(reducer, { <span class="hljs-attr"><span class="hljs-attr">dadJoke</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchDadJoke</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetch(<span class="hljs-string"><span class="hljs-string">'https://icanhazdadjoke.com'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-attr"><span class="hljs-attr">accept</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, }, }) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.json() dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_DAD_JOKE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: data.joke, }) } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actions = { fetchDadJoke, } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">DadJokeContext.Provider</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">state</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">actions</span></span></span></span><span class="xml"><span class="hljs-tag"> }}&gt;</span></span></span><span class="xml"> {children} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">DadJokeContext.Provider</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ) }</span></span></code> </pre> <br>  Sollte funktionieren!  Klicken Sie auf die Schaltfläche, um Witze zu empfangen und anzuzeigen! <br><br>  Lassen Sie uns die Konsole überprüfen: <br><br><pre> <code class="javascript hljs">App: <span class="hljs-number"><span class="hljs-number">1</span></span> Button: <span class="hljs-number"><span class="hljs-number">1</span></span> DadJoke: <span class="hljs-number"><span class="hljs-number">1</span></span> Button: <span class="hljs-number"><span class="hljs-number">2</span></span> DadJoke: <span class="hljs-number"><span class="hljs-number">2</span></span> Button: <span class="hljs-number"><span class="hljs-number">3</span></span> DadJoke: <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br>  Beide Komponenten werden jedes Mal neu gerendert, wenn der Status aktualisiert wird, aber nur eine von ihnen verwendet ihn tatsächlich.  Stellen Sie sich eine reale Anwendung vor, in der Hunderte von Komponenten nur Aktionen verwenden.  Wäre es schön, wenn wir all diese optionalen Renderings bereitstellen könnten? <br><br>  Und hier betreten wir das Gebiet der relativen Gleichheit, also eine kleine Erinnerung: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> obj = {} <span class="hljs-comment"><span class="hljs-comment">//       console.log(obj === obj) // true //        //  2   console.log({} === {}) // false</span></span></code> </pre> <br>  Eine Komponente, die den Kontext verwendet, wird jedes Mal neu gerendert, wenn sich der Wert dieses Kontexts ändert.  Schauen wir uns die Bedeutung unseres Kontextanbieters an: <br><br><pre> <code class="javascript hljs">&lt;DadJokeContext.Provider value={{ state, actions }}&gt;</code> </pre> <br>  Hier erstellen wir bei jedem Renderer ein neues Objekt. Dies ist jedoch unvermeidlich, da jedes Mal, wenn wir eine Aktion ( <code>dispatch</code> ) ausführen, ein neues Objekt erstellt wird. <code>memoize</code> ist es einfach unmöglich, diesen Wert zwischenzuspeichern ( <code>memoize</code> zu <code>memoize</code> ). <br><br>  Und alles sieht aus wie das Ende der Geschichte, oder? <br><br>  Wenn wir uns die Funktion <code>fetchDadJoke</code> , wird vom externen Bereich nur der <code>dispatch</code> , oder?  Im Allgemeinen werde ich Ihnen ein kleines Geheimnis über die in <code>useReducer</code> und <code>useState</code> erstellten Funktionen <code>useState</code> .  Der Kürze <code>useState</code> werde ich <code>useState</code> als Beispiel verwenden: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> prevSetCount <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = React.useState() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> prevSetCount !== <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(setCount === prevSetCount) } prevSetCount = setCount <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;button type=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"button"</span></span></span></span><span class="hljs-function"><span class="hljs-params"> onClick={(</span></span></span><span class="hljs-function">) =&gt;</span></span> { setCount(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">count</span></span></span><span class="hljs-function"> =&gt;</span></span> count + <span class="hljs-number"><span class="hljs-number">1</span></span>) }}&gt; Increment &lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt; ) }</span></span></code> </pre> <br>  Klicken Sie mehrmals auf die Schaltfläche und sehen Sie sich die Konsole an: <br><br><pre> <code class="javascript hljs"><span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br>  Sie werden feststellen, dass <code>setCount</code> für jedes Rendern dieselbe Funktion hat.  Dies gilt auch für unsere <code>dispatch</code> . <br><br>  Dies bedeutet, dass unsere Funktion <code>fetchDadJoke</code> von nichts abhängt, was sich im Laufe der Zeit ändert, und nicht von anderen Aktionsgeneratoren. <code>fetchDadJoke</code> das <code>fetchDadJoke</code> beim ersten Rendern nur einmal erstellt werden: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actions = React.useMemo(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ fetchDadJoke, }), [])</code> </pre><br>  Können wir den Kontextwert optimieren, nachdem wir ein zwischengespeichertes Objekt mit Aktionen haben?  Nein, denn egal wie gut wir das Wertobjekt optimieren, wir müssen aufgrund von Statusänderungen jedes Mal ein neues erstellen.  Was ist jedoch, wenn wir ein Aktionsobjekt aus einem vorhandenen Kontext in einen neuen verschieben?  Wer hat gesagt, dass wir nur einen Kontext haben können? <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DadJokeStateContext = React.createContext() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DadJokeActionsContext = React.createContext()</code> </pre> <br>  Wir können beide Kontexte in unserem <code>DadJokeProvider</code> : <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;DadJokeStateContext.Provider value={state}&gt; &lt;DadJokeActionsContext.Provider value={actions}&gt; {children} &lt;/DadJokeActionsContext.Provider&gt; &lt;/DadJokeStateContext.Provider&gt; )</code> </pre> <br>  Und optimieren Sie unsere Haken: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useDadJokeState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> React.useContext(DadJokeStateContext) } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useDadJokeActions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> React.useContext(DadJokeActionsContext) }</code> </pre> <br>  Und wir sind fertig!  Im Ernst, laden Sie so viele Witze herunter, wie Sie möchten, und überzeugen Sie sich selbst. <br><br><pre> <code class="javascript hljs">App: <span class="hljs-number"><span class="hljs-number">1</span></span> Button: <span class="hljs-number"><span class="hljs-number">1</span></span> DadJoke: <span class="hljs-number"><span class="hljs-number">1</span></span> DadJoke: <span class="hljs-number"><span class="hljs-number">2</span></span> DadJoke: <span class="hljs-number"><span class="hljs-number">3</span></span> DadJoke: <span class="hljs-number"><span class="hljs-number">4</span></span> DadJoke: <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre> <br>  Sie haben also Ihre eigene optimierte Zustandsverwaltungslösung implementiert!  Mit dieser Vorlage mit zwei Kontexten können Sie verschiedene Anbieter erstellen, um Ihre Anwendung zu erstellen. Das ist jedoch noch nicht alles. Sie können dieselbe Anbieterkomponente auch mehrmals rendern!  Was ?!  Ja, probieren Sie das <code>DadJokeProvider</code> Rendering an mehreren Stellen aus und sehen Sie, wie sich Ihre Implementierung der <code>DadJokeProvider</code> problemlos <code>DadJokeProvider</code> lässt! <br><br>  Lassen Sie Ihrer Fantasie freien Lauf und überprüfen Sie, warum Sie <code>Redux</code> wirklich brauchen. <br><br>  Vielen Dank an Kent C. Dodds für Artikel zur Zwei-Kontext-Vorlage.  Ich habe ihn nirgendwo gesehen und es scheint mir, dass dies die Spielregeln ändert. <br><br>  Lesen Sie die folgenden Kent-Blog-Beiträge, um weitere Informationen zu den Konzepten zu erhalten, über die ich gesprochen habe: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wann verwenden Sie useMemo und useCallback?</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">So optimieren Sie den Kontextwert</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">So nutzen Sie React Context effektiv</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verwalten des Anwendungsstatus in React.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ein einfacher Trick, um Re-Renderings in React zu optimieren</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de463607/">https://habr.com/ru/post/de463607/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de463595/index.html">Wir steuern den Fokus oder eine Prise C # und STM32 für eine Webcam</a></li>
<li><a href="../de463597/index.html">Verwenden der Kontext-API in React zum Erstellen eines reaktionsschnellen Anwendungsdesigns</a></li>
<li><a href="../de463599/index.html">"Dies ist ein Albtraum": Astronauten teilen Meinungen darüber, welche Fehler Hollywood macht, wenn er Filme über den Weltraum dreht</a></li>
<li><a href="../de463601/index.html">Separate Methodenprotokollierung in Java / Logback</a></li>
<li><a href="../de463605/index.html">Die technische Intelligenz - aus dem Weltraum</a></li>
<li><a href="../de463609/index.html">Empfehlungssystem für Directum Club. Erster Teil, kollaborativ</a></li>
<li><a href="../de463611/index.html">Fantastische Plugins, vol. 2. Üben</a></li>
<li><a href="../de463613/index.html">Docker-Images können auch mit der üblichen Docker-Datei in werf erstellt werden</a></li>
<li><a href="../de463617/index.html">Funktionen zum Testen von mobilem MMO</a></li>
<li><a href="../de463619/index.html">Fernarbeit: unsere Erfahrung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>