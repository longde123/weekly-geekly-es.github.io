<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëù ü§ô üíÖ Cr√©ation du jeu 35MM. Apr√®s l'apocalypse en Russie üí™ üë®üèº‚Äç‚öñÔ∏è üí∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous, je m'appelle Sergey Noskov. Aujourd'hui, je voudrais parler de la cr√©ation de mon premier projet ind√©pendant √† part enti√®re appel√© 35M...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cr√©ation du jeu 35MM. Apr√®s l'apocalypse en Russie</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448340/"><img src="https://habrastorage.org/webt/nd/lc/7g/ndlc7ge6rk_kvh7uq0ysdei1sqi.jpeg"><br><br>  Bonjour √† tous, je m'appelle Sergey Noskov.  Aujourd'hui, je voudrais parler de la cr√©ation de mon premier projet ind√©pendant √† part enti√®re appel√© 35MM, sorti sur Steam en 2016.  L'histoire est bien s√ªr longue, et depuis lors, plusieurs articles et interviews sur le sujet du projet ont d√©j√† √©t√© publi√©s, cependant, il n'y avait pas de description d√©taill√©e du processus de d√©veloppement.  De plus, les aspects techniques de la mise en ≈ìuvre n'ont gu√®re √©t√© touch√©s.  En fait, nous en parlerons. <br><br>  Commen√ßons par un petit historique.  35MM est une aventure avec une vue √† la premi√®re personne dans le cadre d'une post-apocalypse en Russie.  Le peuple - un simulateur de marche.  Le jeu nous raconte l'histoire du voyage de deux errants √† travers les terres d√©sertes laiss√©es par la civilisation.  La majeure partie de la population s'est √©teinte apr√®s une terrible maladie, et maintenant la nature reprend ses points √† l'humanit√©.  Malheureusement, je ne me souviens pas exactement comment l‚Äôid√©e de ce projet est n√©e, mais je me souviens certainement qu‚Äô√† cette √©poque, j‚Äô√©tais un ardent fan du sujet du harceleur, des jeux Metro et, en g√©n√©ral, de ces environnements atmosph√©riques.  Les paysages des villes abandonn√©es, des zones industrielles et des villages ont toujours √©veill√© mon inqui√©tude et ma joie.  Je ne sais pas de quel type de maladie il s'agit et comment expliquer un tel amour, mais nous sommes nombreux.  En g√©n√©ral, une telle passion sur ce sujet √©tait suffisante pour commencer √† cr√©er votre propre monde du petit jeu. <br><a name="habracut"></a><br><br><img src="https://habrastorage.org/webt/ro/01/jj/ro01jjdr6mpcdqso8mzkghc4dv4.jpeg"><br><br>  Comme j'avais d√©j√† deux petits projets (Light et Train), ainsi qu'une exp√©rience dans le moteur Unity, j'ai commenc√© √† d√©velopper un nouveau jeu.  Si je ne me trompe pas, √† cette √©poque, la cinqui√®me version du moteur √©tait d√©j√† disponible, mais dans une certaine mesure, je suis un conservateur (pas mon meilleur trait professionnel), j'ai donc d√©cid√© de rester dans la version 4.7.  Pour une compr√©hension g√©n√©rale, il existe de nombreuses diff√©rences importantes entre les versions 4 et 5 du moteur, notamment en termes de rendu, d'√©clairage et de mat√©riaux.  Unity 5 a introduit des shaders physiquement pr√©cis qui peuvent refl√©ter correctement la lumi√®re et les r√©flexes d'affichage.  En termes simples - l'√©blouissement et les r√©flexions sur les mat√©riaux avec de tels shaders semblent plus naturels et attrayants.  Dans la version 4, les shaders de base √©taient beaucoup plus simples, cependant, l'√©criture de vos propres shaders pourrait am√©liorer consid√©rablement la qualit√© de l'image.  Nous en reparlerons un peu plus tard.  Il est clair que le d√©veloppement du jeu comprend de nombreux aspects, en plus de travailler dans le moteur lui-m√™me.  Pour que le moteur ait quelque chose √† entasser, du contenu est n√©cessaire: mod√®les, textures, sons, scripts, etc.  Tout cela au final on le voit sur le moniteur et on l'entend dans les colonnes.  Et bien s√ªr, chaque type de contenu n√©cessite son propre logiciel.  Pour cr√©er des mod√®les 3D, j'ai utilis√© 3D max, pour travailler avec des graphiques 2D et cr√©er des textures - Photoshop, pour travailler avec du son - Adobe Audition, j'ai √©crit le code dans le programme Monodevelop fourni avec Unity.  Je vous recommande particuli√®rement de fermer les yeux ou de passer au chapitre suivant - le jeu est √©crit en Javascript.  Seulement chut, ne le dis √† personne.  Je sais juste que pour certains c'est du mauvais go√ªt et personne n'√©crit sur Javascript.  En g√©n√©ral, les principaux outils sont s√©lectionn√©s et le flux de travail s'√©loigne lentement. <br><br><br><h4>  Comment tout a commenc√© </h4><br>  Dans certaines interviews, j'ai d√©j√† mentionn√© que je n'ai g√©n√©ralement pas de plan de d√©veloppement clair, mais seulement une vue d'ensemble.  Par cons√©quent, souvent, la cr√©ation de lieux se fait spontan√©ment et le design est pens√© en d√©placement.  Bien s√ªr, c'est plus un inconv√©nient qu'un avantage, mais il y a un c√¥t√© positif - c'est tr√®s amusant et on ne sait jamais exactement ce qui va se passer ensuite.  Il s'av√®re que le jeu vit dans une certaine mesure sa propre vie d√®s les premiers stades.  Le d√©veloppement de 35MM a commenc√© avec la cr√©ation du tout premier emplacement - une maison foresti√®re abandonn√©e et un terrain spacieux avec des champs et des for√™ts de conif√®res. <br><br><img src="https://habrastorage.org/webt/kr/sb/cn/krsbcnewlw_cvsut4sthf26gl1a.jpeg"><br><br>  Pour construire la surface de la terre utilis√©e terrane avec 5-6 textures d'herbe et de terre.  Le shader terrane standard peint la surface avec diff√©rentes textures en utilisant le masque RGBA, que nous cr√©ons avec une brosse dans le moteur lui-m√™me, et le r√©sultat semble souvent tr√®s flou, les transitions entre les textures sont trop lisses et ne semblent pas naturelles.  Pour affiner ce point, le shader de terrane a √©t√© modifi√© et un masque de d√©calage a √©t√© ajout√©.  La texture en noir et blanc a ¬´d√©plac√©¬ª le masque dessin√© dans la terrane et cr√©√© des bords d√©chir√©s et plus nets, ce qui a l√©g√®rement compliqu√© visuellement l'apparence de la surface. <br><br><img src="https://habrastorage.org/webt/ya/xj/ec/yaxjecb49aydjyn16wrezqwgtte.jpeg"><br><br><img src="https://habrastorage.org/webt/_q/yq/_b/_qyq_bril__wzoxhezidghk7sdo.jpeg"><br><br>  La surface de notre terre a √©t√© compl√©t√©e par plusieurs types d'herbe sous la forme de pl√©ins dispers√©s au hasard.  L'unit√© dispose √©galement d'un mode panneau d'affichage (lorsque les plaines herbeuses regardent toujours le joueur), mais il n'est pas tr√®s adapt√© pour jouer avec une vue √† la premi√®re personne, car il est trop perceptible de voir comment l'herbe ¬´regarde¬ª notre cam√©ra.  Vous devez toujours √™tre prudent avec l'herbe et l'ajouter dans des limites raisonnables, car ce plaisir lance beaucoup d'appels, ce qui affecte √† son tour les performances.  Plus il y a d'appels, plus la charge sur le syst√®me informatique est √©lev√©e.  Mais n'oubliez pas que non seulement les d√©fis augmentent la charge.  Il existe de nombreuses fa√ßons de tuer les performances dans le jeu.  En plus de l'herbe au sol, pour changer, des mailles avec des branches et des pierres √©taient √©parpill√©es, ainsi qu'une s√©rie de d√©calcomanies avec de la salet√© et des traces de roues de voiture. <br><br><img src="https://habrastorage.org/webt/8i/jp/u9/8ijpu9_rppnirhxukbnyfczgea0.jpeg"><br><br>  Apr√®s avoir cr√©√© la surface, allez √† la v√©g√©tation, aux arbres et aux buissons.  J'ai pr√©f√©r√© planter la partie principale de la for√™t (conif√®res) en utilisant les outils de la terrane elle-m√™me - c'est-√†-dire avec une brosse.  L'avantage de cette m√©thode est qu'elle se fait rapidement et facilement, de plus, √† grande distance, une telle for√™t se transforme de mailles en panneaux d'affichage, ce qui affecte tr√®s bien l'optimisation.  Cependant, pr√®s de la charge est consid√©rablement augment√©e, car, si je comprends bien, de tels arbres ne roulent pas.  Peut-√™tre que je me trompe, et quelqu'un me corrigera.  La gravure est un outil d'optimisation tr√®s important.  En gros, il s'agit d'une combinaison de mailles avec un mat√©riau dans un maillage commun, ce qui r√©duit consid√©rablement le nombre d'appels, respectivement, r√©duit la charge.  Un autre inconv√©nient de l'assise sur le terrain est la m√™me position des arbres, c'est-√†-dire qu'ils sont tous cr√©√©s au m√™me angle et cette similitude est frappante.  √Ä cet √©gard, j'ai install√© manuellement des pins, des √©pinettes et des feuillus √† diff√©rents angles et de diff√©rentes tailles, ce qui a ajout√© de la vari√©t√© au paysage.  Les buissons √©taient dispos√©s de la m√™me mani√®re. <br><br><img src="https://habrastorage.org/webt/yy/z-/vg/yyz-vgfhvbn27w1bi6enj3vpfoc.jpeg"><br><br><img src="https://habrastorage.org/webt/e1/rc/ew/e1rcewfivsfb3ob6gmhk7rjv-x4.jpeg"><br><br>  Pour √™tre complet, il reste √† faire face au ciel.  Pour cette t√¢che, un mat√©riau skybox ordinaire avec six textures a √©t√© utilis√©.  Il y a eu des tentatives de modification du shader pour que le ciel ait l'air dynamique, mais le r√©sultat ne s'est pas justifi√© et cette id√©e a d√ª √™tre abandonn√©e.  Une alternative √©tait l'utilisation d'un syst√®me de particules avec une texture de nuage et des panneaux d'affichage horizontaux avec des interpolations de mouvement.  Pour autant que je m'en souvienne, une option similaire a √©t√© utilis√©e dans le jeu Stalker, et en fait il y en a beaucoup plus ailleurs. <br><br><img src="https://habrastorage.org/webt/15/zs/co/15zsco7qze7gwo7mtz-qjagsxdm.jpeg"><br><br><h4>  Eclairage </h4><br>  Dans la 4√®me version du moteur Unity, il y avait un mode tr√®s pratique pour la cuisson de lightmaps - double lightmapping.  Il existe une option similaire dans les versions actuelles, mais je ne l'ai pas encore √©tudi√©e en d√©tail.  Le mode double nous a permis de dessiner des ombres et des reflets en temps r√©el √† courte distance, mais alors que nous nous √©loignions de la cam√©ra, tout cela s'est doucement transform√© en cartes lumineuses cuites, ce qui a grandement facilit√© la t√¢che de notre mat√©riel.  En g√©n√©ral, j'ai utilis√© cette m√©thode sur tous les emplacements du jeu.  En cons√©quence, pour chaque emplacement central, un ensemble d'environ 5 √† 10 lightmaps pour le plan proche a √©t√© cuit, et une quantit√© similaire pour le lointain (lightmaps dans le plan proche √©galement, mais uniquement avec la temp√©rature ambiante cuite au four). <br><br><img src="https://habrastorage.org/webt/rf/x1/mt/rfx1mtclxshah0ofoykqhftdj9a.jpeg"><br><br><img src="https://habrastorage.org/webt/fa/dt/vf/fadtvfm-928kih6ouhi3_axjpz8.jpeg"><br><br>  En g√©n√©ral, dans de nombreux domaines, j'ai essay√© d'utiliser une lumi√®re compl√®tement cuite, √† l'exception de la lumi√®re du soleil.  Des lumi√®res ponctuelles ont √©t√© plac√©es √† certains endroits pour souligner les accents et plus de lumi√®re.  Cela se faisait principalement dans des pi√®ces o√π peu de lumi√®re ext√©rieure p√©n√©trait.  Dans un certain nombre d'endroits, bien s√ªr, des lampes √† incandescence avec des ombres ont √©galement √©t√© utilis√©es: la lumi√®re d'un feu, une lampe de table, un plafonnier ou une applique.  Soit dit en passant, lorsque je travaillais avec l'√©clairage, j'ai d√ª faire face √† un gros probl√®me li√© aux lampes Point et aux ombres en temps r√©el.  Dans certaines zones, le regard de la cam√©ra sur une source ponctuelle de lumi√®re avec des ombres a produit des frises et des freins √©tranges.  Il n'est pas tout √† fait clair pourquoi la charge √©tait si √©lev√©e, mais le profileur √† ce moment-l√† a montr√© des appels hors √©chelle pendant une fraction de seconde.  Pour corriger la situation, l'utilisation de deux luminaires Spot dirig√©s dans des directions oppos√©es l'un √† l'autre a aid√©.  Cette option s'est av√©r√©e moins lourde. <br><br><img src="https://habrastorage.org/webt/cn/0n/dm/cn0ndmoy7smmzdn1aaib9f3te3s.jpeg"><br><br><h4>  Les mod√®les </h4><br>  La plupart des mod√®les 3D du jeu ont √©t√© cr√©√©s ind√©pendamment.  Quelque chose a √©t√© fait avec beaucoup de soin, avec des cartes normales et d'autres subtilit√©s, et quelque chose a √©t√© cr√©√© √† la h√¢te pour gagner du temps.  La plupart des objets ont √©t√© cr√©√©s en groupes et utilisaient une seule texture d'atlas.  Autrement dit, dans une texture, il y avait des sections, par exemple, pour un bloc de b√©ton, un panneau routier, des d√©bris de briques, une trappe d'√©gout, etc.  Cela a permis d'utiliser un seul mat√©riau pour tous ces objets et, par cons√©quent, a permis aux objets de s'entrechoquer.  Comme nous nous en souvenons, c'est plut√¥t bien.  Certains mod√®les ont √©t√© fid√®lement t√©l√©charg√©s par moi √† partir d'Internet, √† partir de biblioth√®ques gratuites.  Fondamentalement, ce sont de petits accessoires pour remplir les pi√®ces, cependant, j'ai essay√© de modifier un peu tous ces mod√®les afin que la similitude ne soit pas tr√®s √©vidente.  Souvent, j'ai remarqu√© des actifs identiques dans les jeux ind√©pendants, ce qui a quelque peu influenc√© ma perception pas de la meilleure fa√ßon.  Le plus probl√©matique en termes de cr√©ation a √©t√© le transport.  Mod√©liser des v√©hicules √† roues √† partir de z√©ro prend beaucoup de temps et prend beaucoup de temps.  Par cons√©quent, plusieurs exemplaires des voitures ont √©t√© achet√©s par moi dans Asset Store. <br><br><img src="https://habrastorage.org/webt/_f/s1/c5/_fs1c5qh9mrgi2u8wiysjevdrdw.jpeg"><br><br><img src="https://habrastorage.org/webt/ey/yk/51/eyyk510atgkm5d0wrzlpdetox9k.jpeg"><br><br><img src="https://habrastorage.org/webt/kc/g9/62/kcg962k7ikvrkueqcmeijk73kzi.jpeg"><br><br>  Une "chanson" distincte √©tait la cr√©ation de personnages.  C'est encore une exp√©rience.  Pour ceux qui n'ont pas une bonne id√©e de la quantit√© de travail n√©cessaire pour qu'un personnage apparaisse qui puisse en quelque sorte exister dans le jeu, je vais l'expliquer.  Un mod√®le high-poly est cr√©√© avec tous les d√©tails, boutons sur les manches, rides sur le visage, etc.  Un mod√®le low-poly du m√™me personnage est cr√©√© avec un scan de texture (dans mon jeu, le nombre de polygones par personnage √©tait en moyenne d'environ 5-8 mille).  En outre, une carte normale, une carte ambiante (ombrage doux) est supprim√©e du mod√®le √† poly √©lev√© pour le mod√®le √† faible poly par des manipulations astucieuses ou simples.  Habituellement, √† partir de l'ambiant, je cr√©e une carte diffuse dans Photoshop.  Dans la carte diffuse du canal alpha, cr√©ez une carte sp√©culaire pour cr√©er de la brillance. <br><br><img src="https://habrastorage.org/webt/xo/en/kn/xoenknestj0mo76ow0xco-yvyu4.jpeg"><br><br><img src="https://habrastorage.org/webt/9s/v1/sr/9sv1sre0wuc7oryy9ug-u8ynqpo.jpeg"><br><br>  Pour 2019, bien s√ªr, il est d√©j√† trop primitif, mais pendant 16 ans et pour le projet ind√©pendant, il √©tait tout √† fait appropri√©. <br><br>  De plus, notre persan doit √™tre flirt√© - pour y placer des os, gr√¢ce auxquels il peut bouger ses membres, bouger sa m√¢choire, plier et d√©plier ses doigts, etc.  Eh bien, au final, le tout doit √™tre anim√©.  Habituellement, un ensemble d'animations avec diff√©rents √©tats est cr√©√© pour le personnage: marche, course, position debout ou assise.  Mais des fragments uniques sont √©galement n√©cessaires, par exemple, dans mon cas, pour le partenaire de notre h√©ros Petrovich, un grand nombre de variations d'actions ont √©t√© n√©cessaires: ouvrir des portes, examiner une carte, se battre avec des bandits, lancer une bombe l√©g√®re au niveau Bor, etc.  Tout cela devait √™tre anim√© √† la main, ce qui, bien s√ªr, est tr√®s frappant dans sa maladresse.  En g√©n√©ral, l'animation manuelle des mouvements humains est une t√¢che tr√®s difficile et il est extr√™mement difficile d'obtenir un r√©sultat plausible.  Par cons√©quent, le bouchon de mouvement est la solution la plus appropri√©e pour cette t√¢che.  Pour autant que je sache, cette option est d√©sormais moins ch√®re et plus rapide que le travail de l'animateur, bien que les donn√©es re√ßues doivent √™tre trait√©es et "nettoy√©es" manuellement. <br><br><img src="https://habrastorage.org/webt/gv/b8/ir/gvb8irricyi1lcirwgwisjcjfkq.jpeg"><br><br><h4>  Shaders </h4><br>  Je pr√©cise tout de suite que je comprenais l'√©criture de shaders √† cette √©poque de mani√®re tr√®s superficielle.  Ma formation a √©t√© principalement dans l'analyse d'exemples pr√™ts √† l'emploi et leur raffinement.  J'ai pris diverses options du r√©seau, modifi√© des param√®tres, ajout√© de nouvelles ou supprim√© les anciennes et v√©rifi√© comment cela affecte le r√©sultat.  Il s'est av√©r√© que c'est une activit√© extr√™mement excitante.  Un int√©r√™t particulier pour moi √©tait la manipulation de diff√©rents canaux de texture comme un masque.  Dans certains cas, j'ai essay√© d'adapter la quantit√© maximale d'informations dans une texture et de l'utiliser.  Au d√©but de l'article, j'ai mentionn√© les diff√©rences entre la 4e et les versions ult√©rieures d'Unity, et en particulier, la pr√©sence d'un ombrage physiquement correct dans les derni√®res.  J'ai essay√© d'√©liminer cette lacune par moi-m√™me, et l'effet Fresnel a √©t√© ajout√© au shader standard avec une carte sp√©culaire, cubmap et normale.  C'est une telle caract√©ristique des mat√©riaux r√©fl√©chissants, dans lesquels les surfaces √† un angle par rapport √† notre vue refl√®tent l'environnement (ou cubmap dans ce cas) plus fortement et semblent g√©n√©ralement plus claires et plus contrast√©es.  Cela est tr√®s visible sur une boule brillante, dont les bords semblent plus brillants que le centre.  J'ai pu r√©p√©ter cet effet et ajouter la possibilit√© de peindre le cubmap dans le mat√©riau, ce que nous pouvons g√©n√©ralement voir sur des surfaces r√©fl√©chissantes mais rugueuses.  Ce shader me convenait parfaitement et √©tait appliqu√© √† la plupart des mat√©riaux du jeu. <br><br><img src="https://habrastorage.org/webt/kz/ka/kj/kzkakjqxlpr1izaz4ffc3h7kdac.jpeg"><br><br><img src="https://habrastorage.org/webt/qp/go/0m/qpgo0m9kwezqi0nraikd-lbxuro.jpeg"><br><br>  La deuxi√®me exp√©rience int√©ressante a √©t√© la cr√©ation d'un shader pour la peau des personnages.  La base √©tait un code trouv√© sur Internet qui vous permet d'utiliser une texture d√©grad√©e, qui est responsable de la force et de la couleur de l'√©clairage qui affecte le mod√®le.  Une texture similaire avec une teinte rouge√¢tre au milieu a permis d'imiter la peau humaine, qui, pour ainsi dire, est un peu translucide, c'est-√†-dire a sa propre √©paisseur, dans laquelle la lumi√®re est diffus√©e en douceur.  L'effet n'est pas parfait, mais il a l'air mieux que le sp√©culaire en plastique standard. <br><br><img src="https://habrastorage.org/webt/bd/x9/vq/bdx9vqxqwtq9mpfixc38u3bl0bi.jpeg"><br><br>  En plus des shaders ci-dessus, de nombreuses options secondaires avec des effets individuels ont √©t√© cr√©√©es dans le processus.  Par exemple, un shader de flaque avec un cubmap et une d√©formation de carte diffuse.  Puisqu'il est trop co√ªteux d'utiliser de vraies r√©flexions pour les flaques d'eau et que je ne voulais pas utiliser un rendu dans la texture (c'est lorsque le cadre est enregistr√© dans la texture et appliqu√© dans le mat√©riau, pendant lequel, par exemple, des distorsions d'air chaud peuvent √™tre faites), j'ai d√©cid√© de faire de simples distorsions de la texture de la terre, tendu sur une flaque d'eau.  L'effet √©tait assez agr√©able et n'a pas du tout tendu le fer.  Par ailleurs, un shader avec un rendu de texture a √©t√© utilis√© pour d√©former l'air des lampes √† p√©trole et d'un feu de joie.  Il semble qu'il y ait eu une distorsion thermique de l'actif du d√©tonateur.  De plus, pour simuler les rayons lumineux volum√©triques, un vertex shader a √©t√© cr√©√© avec l'effet Particule douce et l'effet de lumi√®re du bord (lorsque nous regardons les polygones sous un certain angle, le maillage passe en alpha).  Il s'agit d'un mode de mise en ≈ìuvre classique et d√©j√† barbu.  Maintenant, pour le nouveau Unity, il existe une option int√©ressante qui fonctionne sur la base du post-effet et vous permet de dessiner de vrais rayons de lumi√®re, m√™me en tenant compte des ombres. <br><br>  Il convient √©galement de noter l'ensemble de shaders qui a √©t√© con√ßu pour simuler des surfaces humides.  Le jeu a un √©pisode dans lequel √† un moment donn√© de fortes pluies commencent et certains mat√©riaux acqui√®rent en douceur un √©clat caract√©ristique.  L'effet principal a √©t√© appliqu√© au terrain sur lequel, comme dans le cas des flaques, la texture diffuse a commenc√© √† se d√©former.  Des fuites d'eau sont √©galement apparues sur les fen√™tres des maisons.  Eh bien, la puce la plus ¬´humide¬ª √©tait des gouttes tombant sur l'objectif.  Ici, en fait, j'√©tais tourment√© par des doutes, car le h√©ros n'avait ni lunettes ni casque, et la fa√ßon dont les gouttes se manifestent de mani√®re obsessionnelle √† l'√©cran n'√©tait pas claire.  Cependant, visuellement, j'aimais tellement l'effet que je ne pouvais tout simplement pas le refuser. <br><br><img src="https://habrastorage.org/webt/ei/-x/u2/ei-xu2rezxy8cw3icshvbrbqev0.jpeg"><br><br>  Nous passons donc en douceur aux post-effets.  En parlant de gouttes √† l'√©cran, tout est simple: quelques gouttes de la texture se multiplient et descendent √† diff√©rentes vitesses.  En parall√®le, les ondes (textures d√©grad√©es) descendent, qui sont multipli√©es, chacune par son propre groupe de gouttes.  Ensuite, le tout est r√©sum√©, l√©g√®rement affich√© dans la ¬´diffusion¬ª, pour ainsi dire, mais il est principalement utilis√© comme masque pour d√©placer les coordonn√©es.  En cons√©quence, notre image est d√©form√©e par la r√©fraction des gouttes d'eau.  Le principal ensemble de post-effets qui √©taient toujours ou facultatifs sur la cam√©ra (si le joueur les activait ou les d√©sactivait) est l'anticr√©nelage, SSAO, Bloom, Aberration, Vignette, Sun Shafts.  Ce sont tous des effets Unity standard, mais SSAO a √©t√© modifi√© pour que le rendu des ombres √† distance soit r√©duit √† z√©ro, car dans la distance dans le brouillard, les taches sombres des ombres semblaient √©tranges.  L'effet d'aberration a √©galement √©t√© modifi√© (il s'agit de la distorsion des couleurs de l'image lors de l'utilisation d'objectifs, quelque chose comme des contours de couleur sur les bords des objets) .L'effet standard d'Unity a peint les bords des objets vert bourgogne (une solution plut√¥t √©trange √† mon avis).  En fait, le plus souvent, les couleurs sont plus proches du jaune-rouge-bleu, ce que j'ai r√©alis√©.  Un autre effet permanent a √©t√© la correction des couleurs auto-r√©alis√©e.  L'effet Unity standard me semblait trop gourmand en ressources, donc son propre effet simplifi√© a √©t√© r√©alis√©.  Fondamentalement, il a cr√©√© l'effet du tonmapping et a l√©g√®rement chang√© le jeu de couleurs en un plus froid.  Le choix d'une palette de couleurs pour une image est toujours une t√¢che difficile, qui est difficile √† d√©terminer.  Il arrive que vous aimiez des options compl√®tement oppos√©es et qu'il soit extr√™mement difficile de prendre une d√©cision.  Dans ce projet, j'ai opt√© pour des couleurs ternes et froides.  Pour beaucoup, elle semblait trop fan√©e, mais, il me semble, elle transmet tr√®s pr√©cis√©ment l'humeur que j'ai essay√© de refl√©ter dans mon jeu, l'humeur de tristesse, de d√©couragement et de solitude. <br><br><img src="https://habrastorage.org/webt/qv/er/iv/qverivmj5x-rorvqc0vgmmsrtpo.jpeg"><br><br><img src="https://habrastorage.org/webt/4i/uz/2k/4iuz2kxafowra3gr_cckxkngpzq.jpeg"><br><br><h4>  Et le code? </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai mentionn√© √† plusieurs reprises dans une interview que j'√©tais toujours loin du sujet de la programmation et plus concentr√© sur la composante visuelle. J'ai commenc√© √† √©crire le premier code √† part enti√®re en travaillant sur le jeu "Train", donc au moment de d√©velopper 35MM, j'avais d√©j√† quelques comp√©tences. En g√©n√©ral, le genre de qu√™te me semblait tr√®s appropri√© pour comprendre la programmation √† mon niveau initial. La plupart des actions du jeu sont bas√©es sur des d√©clencheurs. Un objet entre dans le d√©clencheur (un cube avec un collisionneur) et quelque chose commence √† se produire, par exemple, une sc√®ne coup√©e commence. Dans le script, comme dans le script d'une repr√©sentation th√©√¢trale, il est d√©crit ligne par ligne quand et ce qui se passe - maintenant la cam√©ra du joueur s'√©teint, la cam√©ra de la sc√®ne coup√©e s'allume, le personnage appara√Æt dans le cadre, l'animation de la conversation d√©marre, etc. Je pense qu'il existe des outils qui facilitent tout ce processus (je croiscar il n‚Äôest pas all√© en profondeur), mais cette option me semble toujours la plus compr√©hensible, car vous contr√¥lez vous-m√™me tous les √©v√©nements.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le mouvement de notre partenaire dans le jeu a √©t√© mis en ≈ìuvre √† l'aide de d√©clencheurs, qui √©taient des points de contr√¥le de son itin√©raire. Si vous appuyez sur la g√¢chette, une nouvelle animation peut s'activer ou le personnage peut dire quelque chose. </font></font><br><br><img src="https://habrastorage.org/webt/ts/r9/rz/tsr9rz9e2jumsgryopdvzs_og4m.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette m√©thode a √©t√© utilis√©e √† tous les niveaux sauf le dernier. Au dernier endroit de la ville, si nous arrivions √† elle avec un partenaire, il ne nous conduisait plus le long du parcours, mais courait apr√®s nous. L√†, un contr√¥leur bas√© sur NavMesh (un syst√®me qui permet √† un objet de rechercher un chemin vers une cible et de s'y rendre) a d√©j√† √©t√© utilis√©.</font></font><br><br><img src="https://habrastorage.org/webt/cx/my/4i/cxmy4ix45uvqvn4auqkvlk0ykby.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les choses ont √©t√© plus difficiles avec l'ours au deuxi√®me endroit du match. Il a √©t√© utilis√© un contr√¥leur qui ne fonctionne qu'avec un corps rigide (corps physique), de sorte que la b√™te √©tait stupide et s'est souvent √©cras√©e sur des arbres et d'autres objets. Le mat√©riel physique sans friction nous a permis d'√©viter de graves confitures, et l'ours a finalement gliss√© et a continu√© √† nous poursuivre. Ici, et en g√©n√©ral dans les zones o√π vous pouvez mourir, j'ai rencontr√© le probl√®me le plus grave pour moi - le lancement de la mort et le red√©marrage. Au moment du d√©c√®s, il fallait tenir compte de tous les √©tats actuels du personnage: la lampe de poche est-elle allum√©e, la carte est-elle ouverte, le couteau est-il activ√©, etc. Il fallait aussi pr√©server les valeurs de sant√© et de toutes les ressources puis, tout ce qui √©tait activ√©, il fallait d√©sactiver et d√©marrer l'animation de la cam√©ra en train de tomber. Apr√®s avoir assombri l'√©cran, il a fallu tout retourner et lire les valeurs stock√©es.En fait, il n'y a pas de grandes difficult√©s avec l'approche appropri√©e, mais dans mon cas, beaucoup de bugs sont apparus: soit le couteau est rest√© dans mes mains devant mes yeux lorsque l'ours a attaqu√©, alors la carte n'a pas √©t√© retir√©e - tout comme √ßa. De plus, vous ne savez jamais comment un joueur peut se conduire en ce moment, o√π il va courir et dans quelles conditions un ours peut conduire, qui peut rester coinc√© quelque part ou, par exemple, nous attaquer √† travers le mur. En g√©n√©ral, il existe de nombreuses nuances que vous ne pr√©voirez pas imm√©diatement.nous attaquer √† travers le mur. En g√©n√©ral, il existe de nombreuses nuances que vous ne pr√©voirez pas imm√©diatement.nous attaquer √† travers le mur. En g√©n√©ral, il existe de nombreuses nuances que vous ne pr√©voirez pas imm√©diatement.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'interaction de notre personnage avec des objets a √©t√© r√©alis√©e √† l'aide du rayon Raycast. Tous les objets interactifs ont √©t√© √©tiquet√©s avec la balise Subject, et lorsque le faisceau les frappe, il active le r√©tro√©clairage (le maillage est un indicateur avec des bords surlign√©s) et comprend un script qui est d√©j√† responsable de l'action que nous pouvons entreprendre avec cet objet, par exemple, ramasser un objet, lire une note ou ouvrez la porte.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour l'interaction, il √©tait initialement pr√©vu de cr√©er des mains √† part enti√®re qui atteindraient des objets, cela cr√©erait un effet de pr√©sence plus √©vident. Mais cette option repr√©sentait pour moi la grande difficult√© de mise en ≈ìuvre et la perspective d'avoir un ensemble complet de bogues √† l'avenir, donc il n'y avait que des mains qui portent des √©l√©ments d√©j√† s√©lectionn√©s. Il y a un pr√©fabriqu√© avec de petites poign√©es devant la cam√©ra, dans lequel tous les objets sont d√©j√† pr√©sents (cam√©ra, couteau, hache, etc.). Lorsque vous s√©lectionnez un objet pendant le jeu, celui que vous souhaitez s'allume et ceux inutiles s'√©teignent.</font></font><br><br><img src="https://habrastorage.org/webt/kp/my/wh/kpmywhdleoxjlpvbey5nxq6iexa.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un point int√©ressant √©tait li√© √† l'animation des personnages qui parlaient. </font><font style="vertical-align: inherit;">La technique est primitive, mais j'y ai pens√© moi-m√™me, fier, oui. </font><font style="vertical-align: inherit;">Au d√©but, je pensais que lors de la communication des personnages, je devrais commencer l'animation de l'ouverture de la m√¢choire dans un ordre al√©atoire avec chaque phrase. </font><font style="vertical-align: inherit;">Mais il m'est alors venu √† l'esprit qu'un script pouvait lire le niveau de volume de la bande sonore au moment de la lecture et transf√©rer ce niveau √† une valeur flottante, qui est d√©j√† responsable de la position de la m√¢choire du h√©ros. </font><font style="vertical-align: inherit;">En fin de compte, la m√¢choire s'est automatiquement ouverte lors de la prononciation des mots au rythme du fichier son. </font><font style="vertical-align: inherit;">Cela a grandement simplifi√© la t√¢che, m√™me si cela semblait trop "machine".</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Optimisation </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'optimisation est une partie tr√®s importante du d√©veloppement, dont d√©pend la fluidit√© du jeu sur diff√©rents mat√©riels. Je vais aborder l'optimisation de la composante visuelle du projet. Il existe plusieurs m√©thodes utiles pour cela: des groupes de lods, l'abattage est occlus, l'√©cr√™tage des objets √† distance. Le groupe LOD doit √™tre utilis√© dans le cas d'objets ¬´lourds¬ª √† haute teneur en poly√©thyl√®ne. Pour ce faire, cr√©ez plusieurs maillages avec un nombre diff√©rent de polygones. Plus l'appareil photo est √©loign√© du sujet, plus le mod√®le est simplifi√© dans le cadre. Par exemple, pour 35MM, les lods ont √©t√© utilis√©s dans des mod√®les de voitures, des personnages et certains arbres. Habituellement, 2 √† 3 filons ont √©t√© fabriqu√©s, parmi lesquels chaque maille suivante avait presque 2 fois moins de polygones. Pour plus de clart√©: le mod√®le de voiture d'origine se compose de 15 mille polygones, le premier LOD a d√©j√† environ 9 tonnes.(le nombre de nervures diminue, les petites pi√®ces telles que les charni√®res, les pi√®ces int√©rieures sont enlev√©es), le deuxi√®me LOD atteint d√©j√† 5 tonnes (les poign√©es de porte, les r√©troviseurs √† l'int√©rieur de la cabine sont enlev√©s, la g√©om√©trie devient encore plus simple). Plus loin dans la m√™me veine. Pour les lods, au fait, une astuce int√©ressante a √©t√© utilis√©e. Lorsque nous pr√©parons des lightmaps pour un objet avec des lods, nous devons cuire pour les deux objets. Afin de r√©duire le temps de cuisson et d'√©conomiser la m√©moire syst√®me, j'ai utilis√© un script qui transf√©rait automatiquement la lightmap affect√©e avec toutes les coordonn√©es de l'objet parent (z√©ro LOD) √† tous les autres lods.une astuce int√©ressante a √©t√© utilis√©e. Lorsque nous pr√©parons des lightmaps pour un objet avec des lods, nous devons cuire pour les deux objets. Afin de r√©duire le temps de cuisson et d'√©conomiser la m√©moire syst√®me, j'ai utilis√© un script qui transf√©rait automatiquement la lightmap affect√©e avec toutes les coordonn√©es de l'objet parent (z√©ro LOD) √† tous les autres lods.une astuce int√©ressante a √©t√© utilis√©e. Lorsque nous pr√©parons des lightmaps pour un objet avec des lods, nous devons cuire pour les deux objets. Afin de r√©duire le temps de cuisson et d'√©conomiser la m√©moire syst√®me, j'ai utilis√© un script qui transf√©rait automatiquement la lightmap affect√©e avec toutes les coordonn√©es de l'objet parent (z√©ro LOD) √† tous les autres lods.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La deuxi√®me m√©thode d'optimisation est la suppression d'occlusion. Il s'agit d'un m√©canisme dans lequel tout ce qui n'est pas dans le champ de vision de la cam√©ra ou qui est ferm√© par un autre objet est coup√©. Par exemple, lorsque nous entrons dans la pi√®ce, derri√®re le mur, nous ne voyons plus beaucoup d'objets dans la rue, et donc il n'est pas n√©cessaire de d√©penser des ressources pour les rendre.</font></font><br><br><img src="https://habrastorage.org/webt/j1/_y/tk/j1_ytkv-3hkd3m8m-xbewf8thzw.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un autre moyen utile de simplifier le rendu consiste √† d√©couper des objets √† distance. C'est la premi√®re option que j'ai rencontr√©e depuis l'√©poque du projet ¬´Light¬ª. Un script est accroch√© √† la cam√©ra qui ajuste sa distance de rendu pour chaque couche. Dans mon cas, trois cat√©gories de couches ont √©t√© sp√©cialement cr√©√©es, avec de petits objets (articles m√©nagers, marteaux, briques et petits d√©bris), de tailles moyennes et l√©g√®rement sup√©rieures √† la moyenne (th√©i√®res, buissons, pots de fleurs, petits lampadaires, etc.). Trois cat√©gories ont √©t√© affect√©es √† des distances: 40, 80 et 120 m√®tres. Une fois au-del√† de la distance sp√©cifi√©e, la cam√©ra a arr√™t√© le rendu de l'objet correspondant. L'option est tr√®s pratique et efficace, car les petits accessoires ne peuvent plus √™tre vus de loin, et donc les rendre n'a aucun sens.</font></font><br><br><h4>  Son </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La plupart des sons du jeu proviennent de biblioth√®ques gratuites d'Internet. Habituellement, je t√©l√©charge les options n√©cessaires, puis les combine et les m√©lange dans Adobe Audition. En g√©n√©ral, il n'y a pas grand-chose √† dire sur cette partie du travail, car c'est un processus plut√¥t routinier, ennuyeux et qui ne m'attire pas particuli√®rement. Soit dit en passant, le travail consistant √† introduire des sons, √† marquer des sc√®nes coup√©es, √† ajuster des fichiers sonores pour que le son souhait√© soit lu au bon moment - tout cela a probablement pris un quart du temps total consacr√© au jeu. Le seul moment agr√©able a √©t√© l'introduction de la musique, sur laquelle le compositeur cool et extr√™mement talentueux Dmitry Nikolaev a travaill√©. Je suis tr√®s content de ce qu'il a fait, car dans l'ensemble, je ne savais pas exactement ce que je voulais entendre. Mais Dmitry ressentait tr√®s bien l'ambiance,qui a √©t√© d√©fini dans le projet et mis en ≈ìuvre sous la forme de l'atmosph√®re atmosph√©rique. Il s'est av√©r√© quelque chose de fantastique, myst√©rieux et m√©lodique.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Une autre √©tape int√©ressante a √©t√© de travailler avec des personnages de doublage. Malgr√© les critiques de l'ext√©rieur, je suis toujours satisfait du r√©sultat et je pense que les acteurs ont tr√®s bien fait leur travail. Soit dit en passant, les personnages principaux exprim√©s par Vsevolod Petrykin et Alexander Bragi, pour lesquels un grand merci √† eux.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En g√©n√©ral, il n'y avait pas de probl√®mes s√©rieux avec le son, bien que, apr√®s la sortie, un bug rare ait √©t√© d√©couvert que je ne pouvais toujours pas surmonter, car je ne comprenais toujours pas sa nature. </font><font style="vertical-align: inherit;">Parfois, une partie des sons cessait de jouer ou sonnait avec un fort effet d'√©cho. </font><font style="vertical-align: inherit;">Lorsque vous parlez √† un h√©ros, une voix peut soudainement dispara√Ætre et, de la m√™me mani√®re, r√©cup√©rer soudainement. </font><font style="vertical-align: inherit;">Il y avait des conjectures associ√©es √† une grande charge et √† un grand nombre de sons jou√©s en m√™me temps. </font><font style="vertical-align: inherit;">Il y avait √©galement des hypoth√®ses sur la connexion du bug avec les zones de r√©verb√©ration, mais ce n'est pas exact. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C‚Äôest probablement tout. </font><font style="vertical-align: inherit;">Cela fait longtemps depuis le d√©veloppement, certaines choses ont √©t√© oubli√©es, et certaines sont devenues compl√®tement hors de propos, mais j'esp√®re que l'article sera utile √† quelqu'un et qu'il pourra r√©pondre √† certaines questions. </font><font style="vertical-align: inherit;">Merci √† tous et bonne chance!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448340/">https://habr.com/ru/post/fr448340/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448330/index.html">Nombres al√©atoires et r√©seaux d√©centralis√©s: une application pratique</a></li>
<li><a href="../fr448332/index.html">Initier les adeptes de l'informatique: montrez votre force sur un r√©cif</a></li>
<li><a href="../fr448334/index.html">Quand la productivit√© d'une personne suscite l'int√©r√™t</a></li>
<li><a href="../fr448336/index.html">S√©minaire ¬´Nuages ‚Äã‚Äãhybrides - avantages et inconv√©nients: quoi pr√©parer pour les affaires et l'informatique¬ª - 25 avril, Moscou</a></li>
<li><a href="../fr448338/index.html">D√©composer les principes fondamentaux de C #: allouer de la m√©moire pour un type de r√©f√©rence sur la pile</a></li>
<li><a href="../fr448342/index.html">MyDrops - TWS √† faible co√ªt avec un bon son et Bluetooth fiable</a></li>
<li><a href="../fr448346/index.html">De GNU √† Doom: TechTrain 2019 annonc√©</a></li>
<li><a href="../fr448350/index.html">Impl√©mentation de dictionnaire en Python</a></li>
<li><a href="../fr448352/index.html">Boring Company va creuser un tunnel √† Las Vegas</a></li>
<li><a href="../fr448354/index.html">GraphQL Voyager comme outil de recherche de vuln√©rabilit√©s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>