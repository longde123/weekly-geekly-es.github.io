<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçø üöö üïπÔ∏è Plugins fantastiques, vol. 1. Th√©orie üë©üèø‚Äçü§ù‚Äçüë®üèæ üëáüèΩ üôáüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La vie avec un projet multi-modules n'est pas si simple. Pour √©viter la routine de cr√©ation d'un nouveau module, nous avons cr√©√© notre propre plug-in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Plugins fantastiques, vol. 1. Th√©orie</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hh/blog/463583/"><p>  La vie avec un projet multi-modules n'est pas si simple.  Pour √©viter la routine de cr√©ation d'un nouveau module, nous avons cr√©√© notre propre plug-in pour Android Studio.  Au cours de la mise en ≈ìuvre, nous avons rencontr√© un manque de documentation pratique, essay√© plusieurs approches et trouv√© de nombreux √©cueils.  Il s'est av√©r√© deux articles: "Th√©orie" et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Pratique"</a> .  Rencontrez-moi! </p><br><p><img src="https://habrastorage.org/webt/an/fg/dp/anfgdpffwxapeeei7coineoxdvk.png" alt="image"></p><a name="habracut"></a><br><h1 id="o-chem-budu-govorit">  De quoi vais-je parler? </h1><br><ul><li>  Pourquoi un plugin?  Pourquoi un plugin? <br><ul><li>  Etablir une liste de contr√¥le </li><li>  Liste des options d'automatisation </li></ul></li><li>  Bases du d√©veloppement de plugin <br><ul><li>  Actions </li><li>  D√©veloppement d'interface utilisateur dans les plugins </li><li>  Conclusions </li></ul></li><li>  Internes IDEA: composants, PSI <br><ul><li>  Unit√© interne IDEA </li><li>  PSI </li><li>  Conclusions </li></ul></li></ul><br><h1 id="zachem-plagin-pochemu-plagin">  Pourquoi un plugin?  Pourquoi un plugin? </h1><br><p>  Si vous d√©veloppez un projet Android multi-modules, alors vous savez quel genre de routine c'est de cr√©er un nouveau module √† chaque fois.  Vous devez cr√©er un module, y configurer Gradle, ajouter des d√©pendances, attendre la synchronisation, n'oubliez pas de corriger quelque chose dans le module d'application - tout cela prend beaucoup de temps.  Nous voulions automatiser la routine, et nous avons commenc√© par compiler une liste de contr√¥le de ce que nous faisons chaque fois que nous cr√©ons un nouveau module. </p><br><p>  1. Tout d'abord, nous cr√©ons le module lui-m√™me via le menu Fichier -&gt; Nouveau -&gt; Nouveau module -&gt; Biblioth√®que Android. </p><br><p><img src="https://habrastorage.org/webt/eo/nt/tk/eonttksy33ofpojuctkl8aoghuo.png" alt="image"></p><br><p>  2. Nous √©crivons les chemins d'acc√®s au module dans le fichier settings.gradle, car nous avons plusieurs types de modules - modules de base et modules de fonctionnalit√©s, qui se trouvent dans des dossiers diff√©rents. </p><br><div class="spoiler">  <b class="spoiler_title">Nous √©crivons des chemins vers les modules</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// settings.gradle include ':analytics project(':analytics').projectDir = new File(settingsDir, 'core/framework-metrics/analytics) ... include ':feature-worknear' project(':feature-worknear').projectDir = new File(settingsDir, 'feature/feature-worknear')</span></span></code> </pre> </div></div><br><p>  3. Nous changeons les constantes <em>compileSdk</em> , <em>minSdk</em> , <em>targetSdk</em> dans le <em>build.gradle</em> g√©n√©r√©: nous les rempla√ßons par les constantes d√©finies dans le root <em>build.gradle</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Changer les constantes dans build.gradle du nouveau module</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle ‚Ä¶ android { compileSdkVersion rootProject.ext.targetSdkVersion defaultConfig { minSdkVersion rootProject.ext.minSdkVersion targetSdkVersion rootProject.ext.targetSdkVersion ... } }</span></span></code> </pre> </div></div><br><p>  Remarque: nous avons r√©cemment supprim√© cette partie de notre travail dans notre plugin Gradle, ce qui permet de configurer tous les param√®tres n√©cessaires du fichier <em>build.gradle</em> sur plusieurs lignes. </p><br><p>  4. Puisque nous √©crivons tout le nouveau code dans Kotlin, nous connectons en standard deux plugins: <em>kotlin-android</em> et <em>kotlin-kapt</em> .  Si le module est en quelque sorte connect√© √† l'interface utilisateur, nous connectons √©galement le <em>module kotlin-android-extensions</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Connecter les plugins Kotlin</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle apply plugin: 'com.android.library' apply plugin: 'kotlin-android' apply plugin: 'kotlin-android-extensions' apply plugin: 'kotlin-kapt'</span></span></code> </pre></div></div><br><p>  5. Nous connectons les biblioth√®ques g√©n√©rales et les modules principaux.  Les modules principaux sont, par exemple, l'enregistreur, l'analytique, certains utilitaires g√©n√©raux et biblioth√®ques - RxJava, Moxy et bien d'autres. </p><br><div class="spoiler">  <b class="spoiler_title">Nous connectons des biblioth√®ques et des modules partag√©s</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle dependencies { def libraries = rootProject.ext.deps compileOnly project(':logger') compileOnly project(':analytics') ‚Ä¶ // Kotlin compileOnly libraries.kotlin // DI compileOnly libraries.toothpick kapt libraries.toothpickCompiler }</span></span></code> </pre></div></div><br><p>  6. Configurez kapt pour Toothpick.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le cure</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dent</a> est notre infrastructure DI de base.  Vous le savez tr√®s probablement: pour utiliser la g√©n√©ration de code plut√¥t que la r√©flexion dans la version, vous devez configurer le processeur d'annotation afin qu'il comprenne o√π trouver les usines pour les objets en cours de cr√©ation: </p><br><div class="spoiler">  <b class="spoiler_title">Configuration du processeur d'annotation pour Toothpick</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle defaultConfig { ... javaCompileOptions { annotationProcessorOptions { arguments = [ toothpick_registry_package_name: "ru.hh.feature_worknear" ] } } ...</span></span></code> </pre> </div></div><br><p>  Remarque: dans hh.ru, nous utilisons la premi√®re version de Toothpick, dans la seconde, nous avons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">supprim√© la possibilit√© d'utiliser la g√©n√©ration de code</a> . </p><br><p>  7. Nous configurons kapt pour Moxy √† l'int√©rieur du module cr√©√©.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Moxy</a> est notre framework principal pour cr√©er MVP dans une application, et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous devez le tordre un peu pour</a> qu'il puisse fonctionner dans un projet multi-module.  En particulier, enregistrez le package du module cr√©√© dans les arguments kapt: </p><br><div class="spoiler">  <b class="spoiler_title">Configuration de kapt pour Moxy</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Feature module build.gradle android { ... kapt { arguments { arg("moxyReflectorPackage", "ru.hh.feature_worknear") } } ...</span></span></code> </pre></div></div><br><p>  Remarque: nous sommes d√©j√† pass√©s √† la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nouvelle version de Moxy</a> , et cette partie de la g√©n√©ration de code a perdu de sa pertinence. </p><br><p>  8. Nous g√©n√©rons un tas de nouveaux fichiers.  Je ne parle pas des fichiers qui sont cr√©√©s automatiquement (AndroidManifest.xml, build.gradle, .gitignore), mais du cadre g√©n√©ral du nouveau module: interacteurs, r√©f√©rentiels, modules DI, pr√©sentateurs, fragments.  Il y a beaucoup de ces fichiers, ils ont la m√™me structure au d√©but, et les cr√©er est une routine. </p><br><p><img src="https://habrastorage.org/webt/j2/f5/sz/j2f5szalxm1nmgg4yj9kivxpdfs.png" alt="image"></p><br><p>  9. Nous connectons notre module cr√©√© au module d'application.  Dans cette √©tape, vous devez vous rappeler de configurer Toothpick dans le fichier build.gradle du module d'application.  Pour ce faire, nous ajoutons le package du module cr√©√© au processeur d'annotation d'arguments sp√©ciaux - <em>toothpick_registry_children_package_names</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Cure-dents de r√©glage</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// App module build.gradle defaultConfig { ‚Ä¶ javaCompileOptions { annotationProcessorOptions { arguments = [ toothpick_registry_package_name: "ru.hh.android", toothpick_registry_children_package_names: [ "ru.hh.analytics", "ru.hh.feature_worknear", ... ].join(",") ] } } ‚Ä¶</span></span></code> </pre></div></div><br><p>  Apr√®s cela, nous configurons Moxy dans le module d'application.  Nous avons une classe qui est marqu√©e avec l'annotation <strong>@RegisterMoxyReflectorPackages</strong> - nous y ajoutons le nom du package du module cr√©√©: </p><br><div class="spoiler">  <b class="spoiler_title">Configurer MoxyReflectorStub</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// App module file @RegisterMoxyReflectorPackages( "ru.hh.feature_force_update", "ru.hh.feature_profile", "ru.hh.feature_worknear" ... ) class MoxyReflectorStub</span></span></code> </pre> </div></div><br><p>  Et, au final, n'oubliez pas de connecter le module cr√©√© au bloc de <em>d√©pendances</em> du module d'application: </p><br><div class="spoiler">  <b class="spoiler_title">Ajout de d√©pendances</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Application module build.gradle dependencies { def libraries = rootProject.ext.deps implementation project(':logger') implementation project(':dependency-handler') implementation project(':common') implementation project(':analytics') implementation project(':feature_worknear') ...</span></span></code> </pre> </div></div><br><p>  Nous avons obtenu une liste de contr√¥le de neuf points. </p><br><p>  Puisqu'il y a de nombreux points, il est probable que l'on oublie quelque chose.  Et puis passez des heures √† vous demander ce qui s'est pass√© et pourquoi le projet ne va pas. </p><br><p>  Nous avons d√©cid√© que vous ne pouvez pas vivre comme √ßa et que vous devez changer quelque chose. </p><br><h2 id="varianty-avtomatizacii-chek-lista">  Liste des options d'automatisation </h2><br><p>  Apr√®s avoir compil√© la liste de contr√¥le, nous avons commenc√© √† chercher des options pour automatiser ses √©l√©ments. </p><br><p>  La premi√®re option √©tait une tentative de faire <strong>"Ctrl + C, Ctrl + V"</strong> .  Nous avons essay√© de trouver une impl√©mentation pour cr√©er le module de biblioth√®que Android, qui est disponible pour nous ¬´pr√™t √† l'emploi¬ª.  Dans le dossier avec Android Studio (pour MacOs: <em>/ Applications / Android \ Studio.app/Contents/plugins/android/lib/templates/gradle-projects/</em> ), vous pouvez trouver un dossier sp√©cial avec des mod√®les de ces projets que vous voyez lorsque vous s√©lectionnez Fichier - &gt; Nouveau -&gt; Nouveau module.  Nous avons essay√© de copier le mod√®le NewAndroidModule en changeant l'ID dans le fichier <em>template.xml.ftl</em> .  Ensuite, ils ont lanc√© l'IDE, commenc√© √† cr√©er un nouveau module, et ... Android Studio s'est √©cras√© parce que la liste des modules que vous voyez dans le menu pour cr√©er un nouveau module est cod√©e en dur, vous ne pouvez pas le changer avec un copier-coller primitif.  Lorsque vous essayez de prendre et d'ajouter, de supprimer ou de modifier un √©l√©ment, Android Studio se bloque simplement. </p><br><p><img src="https://habrastorage.org/webt/ym/ww/sw/ymwwsw1rzibvaxwrhkqkwd5fqyk.png" alt="image"></p><br><p>  La deuxi√®me option pour automatiser la liste de contr√¥le √©tait le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">moteur de mod√®le FreeMarker</a> .  Apr√®s une tentative de copier-coller infructueuse, nous avons d√©cid√© d'examiner de plus pr√®s les mod√®les de module et avons trouv√© des mod√®les FreeMarker sous le capot. </p><br><p>  Je ne vous dirai pas en d√©tail ce qu'est FreeMarker - il y a un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bon article de RedMadRobot</a> et une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vid√©o de MosDroid de Lesha Bykov</a> .  Mais en bref - c'est un moteur pour g√©n√©rer des fichiers en utilisant des mod√®les et des objets java Map-ki sp√©ciaux.  Vous nourrissez des mod√®les, des objets et FreeMarker g√©n√®re du code √† la sortie. </p><br><p>  Mais regardez √† nouveau la liste de contr√¥le: </p><br><p><img src="https://habrastorage.org/webt/nf/hl/81/nfhl811qacot1f4j_pt2fhsmm8k.png" alt="image"></p><br><p>  Si vous regardez de plus pr√®s, vous pouvez voir qu'il est divis√© en deux grands groupes de t√¢ches: </p><br><ul><li>  Les t√¢ches de g√©n√©ration d'un nouveau code (1, 3, 4, 5, 6, 7, 8) et </li><li>  T√¢ches de modification d'un code existant (2, 7, 8, 9) </li></ul><br><p>  Et si FreeMarker fait face aux t√¢ches du premier groupe avec fracas, alors il ne g√®re pas du tout le second.  √Ä titre d'exemple: dans l'impl√©mentation actuelle de l'int√©gration de FreeMarker dans Android Studio, lorsque vous essayez d'ins√©rer une ligne dans le fichier settings.gradle qui ne commence pas par le mot ¬´include¬ª, le <a href="">studio se bloque</a> .  Ici, nous avons attrap√© la tristesse et avons d√©cid√© d'abandonner l'utilisation de FreeMarker. </p><br><p>  Apr√®s un √©chec avec FreeMarker, l'id√©e est venue d'√©crire mon propre utilitaire de console pour effectuer une liste de contr√¥le.  Dans Intellij IDEA, il est possible d'utiliser un terminal, alors pourquoi pas?  √âcrivons un script sur le bash, total business: </p><br><p><img src="https://habrastorage.org/webt/t0/2h/ki/t02hki4jlkvs_7eaqisfbuqnyb0.png" alt="image"></p><br><p>  Mais comme nous voulons pouvoir configurer de mani√®re flexible le module cr√©√©, nous devrons entrer de nombreux drapeaux diff√©rents, ce qui ne sera pas tr√®s pratique pour imprimer dans la console. </p><br><p>  Apr√®s cela, nous avons pris du recul et nous sommes souvenus que nous travaillions √† l'int√©rieur d'Intellij IDEA.  Et comment est-il organis√©?  Il existe un certain noyau de classes, un moteur auquel de nombreux plug-ins sont attach√©s, qui ajoutent les fonctionnalit√©s dont nous avons besoin. </p><br><p>  Combien d'entre vous voient dans la capture d'√©cran plus de deux plugins connect√©s? </p><br><p><img src="https://habrastorage.org/webt/rf/fr/dm/rffrdmuui00uxtruelogjpor_le.png" alt="image"></p><br><div class="spoiler">  <b class="spoiler_title">O√π chercher? ..</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/0m/uw/ua/0muwuamgty0p8kri2ywhq3dsbaw.png" alt="image"></p></div></div><br><p>  Ici, ils sont connect√©s au moins trois.  Si vous travaillez avec Kotlin, le plugin Kotlin est activ√©.  Si vous travaillez dans un projet avec Gradle, le plugin Gradle est √©galement inclus.  Si vous travaillez dans un projet avec un syst√®me de contr√¥le de version - Git, SVN ou autre chose - vous avez le plug-in appropri√© inclus pour int√©grer ce VCS. </p><br><p>  Nous avons examin√© le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel officiel des plugins</a> JetBrains, et il s'est av√©r√© qu'il existe d√©j√† plus de 4000 plugins officiellement enregistr√©s!  Presque le monde entier √©crit des plugins, et ces plugins peuvent faire n'importe quoi: √† partir de l'int√©gration d'un langage de programmation dans IDEA et se terminant par des outils sp√©cifiques qui peuvent √™tre ex√©cut√©s √† partir d'IDEA. </p><br><p>  En bref, nous avons d√©cid√© d'√©crire notre propre plugin. </p><br><h1 id="osnovy-razrabotki-plaginov">  Bases du d√©veloppement de plugin </h1><br><p>  Nous passons aux bases du d√©veloppement de plugins.  Pour commencer, vous n'avez besoin que de trois choses: </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">IntelliJ IDEA</a> , minimum Community Edition (Vous pouvez travailler dans la version Ultimate, mais cela ne donnera pas d'avantages sp√©ciaux lors du d√©veloppement de plugins); </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le plugin DevKit</a> qui lui est connect√© est un plugin sp√©cial qui ajoute la possibilit√© d'√©crire d'autres plugins; </li><li>  Et tout langage JVM dans lequel vous souhaitez √©crire un plugin.  Cela pourrait √™tre Kotlin, Java, Groovy - n'importe quoi. </li></ol><br><p>  Nous commen√ßons par cr√©er un projet de plugin.  Nous s√©lectionnons <strong>Nouveau projet</strong> , <strong>pointons Gradle</strong> , nous cochons <strong>IntelliJ Platform Plugin</strong> et nous cr√©ons le projet. </p><br><p><img src="https://habrastorage.org/webt/je/rf/wd/jerfwdeqfmpzdef-_cypw4wahw8.png" alt="image"></p><br><p>  Remarque: Si vous ne voyez pas la case √† cocher Plugin de plateforme IntelliJ, cela signifie que vous n'avez pas install√© le plugin DevKit. </p><br><p>  Apr√®s avoir rempli les champs obligatoires, nous verrons une structure de plugin vide. </p><br><p><img src="https://habrastorage.org/webt/i2/sy/59/i2sy59dpr0pi8nlmhfyhson20h8.png" alt="image"></p><br><p>  Examinons-le de plus pr√®s.  Il se compose de: </p><br><ul><li>  Dossiers dans lesquels vous √©crirez le code du futur projet;  ( <em>main / java</em> , <em>main / kotlin</em> , etc.); </li><li>  fichier <em>build.gradle</em> , dans lequel vous d√©clarerez les d√©pendances de votre plugin sur certaines biblioth√®ques, et configurerez √©galement une chose telle que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em>gradle-intellij-plugin</em></a> . </li></ul><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em>gradle-intellij-plugin</em></a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em>Plugin</em></a> Gradle qui vous permet d'utiliser Gradle comme syst√®me de construction de plugins.  C'est pratique car presque tous les d√©veloppeurs Android connaissent Gradle et savent comment l'utiliser.  De plus, gradle-intellij-plugin ajoute des t√¢ches gradle utiles √† votre projet, en particulier: </p><br><ul><li>  runIde - cette t√¢che lance une instance IDEA distincte avec un plugin que vous d√©veloppez afin que vous puissiez le d√©boguer; </li><li>  buildPlugin - collecte l'archive zip de votre plugin afin que vous puissiez la distribuer localement ou via le r√©f√©rentiel IDEA officiel; </li><li>  verifyPlugin - cette t√¢che v√©rifie votre plugin pour les erreurs grossi√®res qui peuvent ne pas lui permettre de s'int√©grer dans Android Studio ou une autre IDEA. </li></ul><br><p>  Que <em>donne le plugin gradle-intellij</em> ?  Avec son aide, il devient plus facile d'ajouter des d√©pendances √† d'autres plugins, mais nous en parlerons un peu plus tard, mais pour l'instant je peux dire que <em>gradle-intellij-plugin</em> est votre fr√®re, utilisez-le. </p><br><p>  Retour √† la structure du plugin.  Le fichier le plus important de tout plugin est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em>plugin.xml</em></a> . </p><br><div class="spoiler">  <b class="spoiler_title">plugin.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">idea-plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>com.experiment.simple.plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>Hello, world<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vendor</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">email</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myemail@yourcompany.com"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">url</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.mycompany.com"</span></span></span><span class="hljs-tag">&gt;</span></span> My company <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vendor</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>&lt;![CDATA[ My first ever plugin - try to open Hello world dialog&lt;br&gt; ]]&gt;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span>com.intellij.modules.lang<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span>org.jetbrains.kotlin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span>org.intellij.groovy<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depends</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">idea-version</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">since-build</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"163"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">actions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"My actions"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyActionGroup"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"My actions"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">separator</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.experiment.actions.OpenHelloWorldAction"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.experiment.actions.OpenHelloWorldAction"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Show Hello world"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Open dialog"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add-to-group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">group-id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NewGroup"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">anchor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"last"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">actions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">idea-plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><p>  Il s'agit d'un fichier qui contient: </p><br><ul><li>  Les m√©tadonn√©es de votre plugin: identifiant, nom, description, informations sur le fournisseur, journal des modifications </li><li>  Description des d√©pendances sur d'autres plugins; </li><li>  Ici, vous pouvez √©galement sp√©cifier la version IDEA avec laquelle votre plugin fonctionnera correctement </li><li>  <em>Les actions</em> sont √©galement d√©crites ici. </li></ul><br><h3 id="actions">  Actions </h3><br><p>  Qu'est-ce que les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">actions</a> ?  Supposons que vous ouvrez un menu pour cr√©er un nouveau fichier.  En fait, chaque √©l√©ment de ce menu a √©t√© ajout√© par une sorte de plugin: </p><br><p><img src="https://habrastorage.org/webt/al/8y/kg/al8ykgojltbksqkuqu5l8cww4fw.png" alt="image"></p><br><p>  Les actions sont les points d'entr√©e de votre plugin pour les utilisateurs.  Chaque fois que l'utilisateur clique sur un √©l√©ment de menu, vous obtenez le contr√¥le √† l'int√©rieur du plugin, vous pouvez r√©pondre √† ce clic et faire ce qui est n√©cessaire. <br>  Comment les actions sont-elles cr√©√©es?  √âcrivons une action simple qui affichera une bo√Æte de dialogue avec le message "Bonjour tout le monde". </p><br><div class="spoiler">  <b class="spoiler_title">OpenHelloWorldAction</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OpenHelloWorldAction</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AnAction</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionPerformed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(actionEvent: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">AnActionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> project = actionEvent.project Messages.showMessageDialog( project, <span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span>, <span class="hljs-string"><span class="hljs-string">"Greeting"</span></span>, Messages.getInformationIcon() ) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">AnActionEvent</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.update(e) <span class="hljs-comment"><span class="hljs-comment">// TODO - Here we can update our action (for example, disable it) } override fun beforeActionPerformedUpdate(e: AnActionEvent) { super.beforeActionPerformedUpdate(e) // TODO - This method calls right before 'actionPerformed' } }</span></span></code> </pre> </div></div><br><p>  Pour cr√©er une action, nous cr√©ons d'abord une classe qui h√©rite de la classe <em>AnAction</em> .  Deuxi√®mement, nous devons red√©finir la m√©thode actionPerformed, d'o√π vient le param√®tre sp√©cial de la classe <em>AnActionEvent</em> .  Ce param√®tre contient des informations sur le contexte d'ex√©cution de votre action.  Le contexte fait r√©f√©rence au projet dans lequel vous travaillez, au fichier qui est maintenant ouvert dans l'√©diteur de code de l'utilisateur, aux √©l√©ments s√©lectionn√©s dans l'arborescence du projet et √† d'autres donn√©es pouvant vous aider dans le traitement de vos t√¢ches. </p><br><p>  Pour afficher la bo√Æte de dialogue "Hello, world", nous obtenons d'abord le projet (uniquement √† partir du param√®tre <em>AnActionEvent</em> ), puis utilisons la classe d'utilitaire <em>Messages</em> pour afficher la bo√Æte de dialogue. </p><br><p>  Quelles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fonctionnalit√©s suppl√©mentaires</a> avons-nous dans l'action?  Nous pouvons remplacer deux m√©thodes: <em>update</em> et <em>beforeActionPerformedUpdate</em> . </p><br><p>  La m√©thode de <em>mise √† jour</em> est appel√©e √† chaque fois que le contexte d'ex√©cution de votre action change.  Pourquoi cela peut vous √™tre utile: par exemple, pour mettre √† jour l'√©l√©ment de menu qui a √©t√© ajout√© par votre plugin.  Supposons que vous ayez √©crit une action qui ne peut fonctionner qu'avec des fichiers Kotlin et que l'utilisateur a maintenant ouvert le fichier Groovy.  Ensuite, dans la m√©thode de mise √† jour, vous pouvez rendre votre action inaccessible. </p><br><p>  La m√©thode <em>beforeActionPerformedUpdate est</em> similaire √† la m√©thode update, mais elle est appel√©e juste avant <em>actionPerformed</em> .  C'est la derni√®re occasion d'influencer votre action.  La documentation vous recommande de ne rien effectuer de ¬´lourd¬ª dans cette m√©thode afin qu'elle s'ex√©cute d√®s que possible. </p><br><p>  Vous pouvez √©galement lier des actions √† certains √©l√©ments de l'interface IDEA et leur d√©finir des combinaisons de touches par d√©faut pour l'appel - je vous recommande d'en lire plus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><h3 id="razrabotka-ui-v-plaginah">  D√©veloppement d'interface utilisateur dans les plugins </h3><br><p>  Si vous avez besoin de votre propre conception de bo√Æte de dialogue, vous devrez travailler dur.  Nous avons d√©velopp√© notre interface utilisateur parce que nous voulions avoir une interface graphique pratique dans laquelle il serait possible de marquer quelques ticks, d'avoir un s√©lecteur pour les valeurs d'√©num√©ration, etc. </p><br><p>  Le plugin DevKit pour le d√©veloppement de l'interface utilisateur ajoute certaines actions, telles que le <em>formulaire GUI</em> et la <em>bo√Æte de dialogue</em> .  Le premier cr√©e un formulaire vide pour nous, le second - un formulaire avec deux boutons: <em>Ok</em> et <em>Annuler</em> . </p><br><p><img src="https://habrastorage.org/webt/wd/bx/3r/wdbx3rhggovpfv-fey53fucs2aw.png" alt="image"></p><br><p>  D'accord, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">il y a un concepteur de formulaires</a> , mais il est ... moyen.  En comparaison, m√™me le concepteur de mise en page dans Android Studio semble confortable et bon.  L'interface utilisateur enti√®re est d√©velopp√©e sur une biblioth√®que telle que Java Swing.  Ce concepteur de formulaires g√©n√®re un fichier XML lisible par l'homme.  Si vous ne pouvez pas faire quelque chose dans le concepteur de formulaires (exemple: ins√©rer plusieurs contr√¥les dans la m√™me cellule de grille et masquer tous les contr√¥les sauf un), vous devez acc√©der √† ce fichier et le modifier - IDEA reprendra ces modifications. </p><br><p>  Presque chaque formulaire se compose de deux fichiers: le premier a l'extension <em>.form</em> , c'est juste le fichier XML, le second est la soi-disant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em>classe Bound</em></a> , qui peut √™tre √©crite en Java, Kotlin, mais tout ce que vous voulez.  Il agit comme un contr√¥leur de formulaire.  De fa√ßon inattendue, mais l'√©criture en Java est beaucoup plus facile que dans d'autres langages.  Parce que, par exemple, le r√©glage de Kotlin n'est pas encore aussi parfait.  Lorsque vous ajoutez de nouveaux composants en travaillant avec la classe Java, ces composants sont automatiquement ajout√©s √† la classe et lorsque vous modifiez le nom du composant dans le concepteur, il est automatiquement extrait.  Mais dans le cas de Kotlin, les composants ne sont pas ajout√©s - aucune int√©gration ne se produit, vous pouvez oublier quelque chose et ne pas comprendre pourquoi rien ne fonctionne. </p><br><h3 id="rezyumiruem-osnovy">  Nous r√©sumons les bases </h3><br><ul><li>  Pour cr√©er un plugin, vous aurez besoin: IDEA Community Edition, Plugin DevKit et Java qui lui sont connect√©s. </li><li>  gradle-intellij-plugin est votre fr√®re, il vous simplifiera grandement la vie, je vous recommande de l'utiliser. </li><li>  N'√©crivez pas votre propre interface utilisateur, sauf si cela est n√©cessaire.  Il existe de nombreuses classes d'utilitaires dans IDEA qui vous permettent de cr√©er votre propre interface utilisateur pr√™te √† l'emploi.  Si vous avez besoin de quelque chose de compliqu√©, pr√©parez-vous √† travailler dur. </li><li>  Le plugin peut avoir un nombre illimit√© d'actions.  Le m√™me plugin peut ajouter beaucoup de fonctionnalit√©s √† votre IDEA. </li></ul><br><h1 id="vnutrennosti-idea-komponenty-psi">  Internes IDEA: composants, PSI </h1><br><p>  Parlons des intestins d'IDEA, de la fa√ßon dont ils sont dispos√©s √† l'int√©rieur.  Je vous le dis pour que rien ne s'√©croule dans votre t√™te quand j'explique la partie pratique, et pour que vous compreniez d'o√π √ßa vient. </p><br><p>  Comment est organis√© IDEA?  Au premier niveau de la hi√©rarchie se trouve une classe telle que <a href=""><em>Application</em></a> .  Il s'agit d'une instance IDEA distincte.  Pour chaque instance IDEA, un objet de classe Application est cr√©√©.  Par exemple, si vous ex√©cutez AppCode, Intellij IDEA et Android Studio en m√™me temps, vous obtiendrez trois instances distinctes de la classe Application.  Cette classe est con√ßue pour g√©rer le flux d'entr√©e / sortie. </p><br><div class="spoiler">  <b class="spoiler_title">Placer l'application dans la hi√©rarchie</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/rw/_y/vm/rw_yvmpfn1hyekftipxwuq-qxn8.png" alt="image"></p></div></div><br><p>  Le niveau suivant est la classe <a href=""><em>Project</em></a> .  C'est le concept le plus proche de ce que vous voyez lors de l'ouverture d'un nouveau projet dans IDEA.  Le projet est g√©n√©ralement n√©cessaire pour obtenir d'autres composants dans IDEA: classes utilitaires, gestionnaires et bien plus encore. </p><br><div class="spoiler">  <b class="spoiler_title">Place du projet dans la hi√©rarchie</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/xv/ku/z6/xvkuz6ezzzd5w5_c9suloyafcza.png" alt="image"></p></div></div><br><p>  Le niveau de d√©tail suivant est la classe <a href=""><em>Module</em></a> .  En g√©n√©ral, un module est une hi√©rarchie de classes regroup√©es dans un dossier.  Mais ici, par modules, nous entendons les modules Maven, les modules Gradle.  Cette classe est n√©cessaire, d'une part, pour d√©terminer les d√©pendances entre les modules, et d'autre part, pour rechercher des classes √† l'int√©rieur de ces modules. </p><br><div class="spoiler">  <b class="spoiler_title">Placer le module dans une hi√©rarchie</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/zr/vs/ah/zrvsahicec7gak2sfqhox2ldts0.png" alt="image"></p></div></div><br><p>  Le niveau de d√©tail suivant est la classe <a href=""><em>VirtualFile</em></a> .  Il s'agit d'une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">abstraction sur le vrai fichier</a> qui se trouve sur votre disque.  Plusieurs instances de <em>VirtualFile</em> peuvent correspondre √† chaque fichier r√©el, mais elles sont toutes √©gales.  Dans le m√™me temps, si le fichier r√©el est supprim√©, <em>VirtualFile</em> ne sera pas supprim√© seul, mais deviendra simplement invalide. </p><br><div class="spoiler">  <b class="spoiler_title">VirtualFile Hierarchy Place</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/z8/4y/hq/z84yhqyl6tzv-1uwc_ersyhmqv0.png" alt="image"></p></div></div><br><p>  <em>Une</em> entit√© telle que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em>Document</em></a> est associ√©e √† chaque <em>VirtualFile</em> .  Il s'agit d'une abstraction sur le texte de votre fichier.  <em>Le document est</em> n√©cessaire pour que vous puissiez suivre les √©v√©nements li√©s aux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">changements dans le texte du fichier</a> : l'utilisateur a ins√©r√© une ligne, supprim√© une ligne, etc., etc. </p><br><div class="spoiler">  <b class="spoiler_title">Placer le document dans la hi√©rarchie</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/fr/nc/qg/frncqgrdpc3xgtnn_txrhlvdcv0.png" alt="image"></p></div></div><br><p>  Un peu √† c√¥t√© de cette hi√©rarchie se trouve la classe <a href=""><em>Editor</em></a> - c'est un √©diteur de code.  Chaque projet peut avoir un <em>√©diteur</em> .  Il est n√©cessaire pour que vous puissiez suivre les √©v√©nements li√©s √† l'√©diteur de code: l'utilisateur a mis en surbrillance la ligne o√π se trouve le curseur, etc. </p><br><div class="spoiler">  <b class="spoiler_title">Place de l'√©diteur dans la hi√©rarchie</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/fk/kj/l-/fkkjl-c-t5nyehcwt6j-ywdhwf0.png" alt="image"></p></div></div><br><p>  La derni√®re chose dont je voulais parler est <a href=""><em>PsiFile</em></a> .  C'est aussi une abstraction sur des fichiers r√©els, mais du point de vue de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">repr√©sentation des √©l√©ments de code</a> .  PSI signifie Program Structure Interface. </p><br><div class="spoiler">  <b class="spoiler_title">Place PsiFile dans la hi√©rarchie</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ho/kn/l0/hoknl08rk2giwbxure86b3pqcva.png" alt="image"></p></div></div><br><p>  Et en quoi consiste chaque programme?  Consid√©rez une classe Java r√©guli√®re. </p><br><div class="spoiler">  <b class="spoiler_title">Classe Java simple</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.experiment; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.inject.Inject; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomeClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> String injectedString; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">someMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(injectedString); } }</code> </pre> </div></div><br><p>  Il consiste √† sp√©cifier un package, des importations, des classes, des champs, des m√©thodes, des annotations, des mots-cl√©s, des types de donn√©es, des modificateurs, des identificateurs, des r√©f√©rences de m√©thode, des expressions et des jetons.  Et pour chaque √©l√©ment, il y a une abstraction de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em>PsiElement</em></a> .  Autrement dit, chacun de vos programmes se compose de <em>PsiElements</em> . </p><br><p><img src="https://habrastorage.org/webt/ps/oa/2t/psoa2timve59g__naf1rrskzfdm.png" alt="image"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PsiFile</a> , √† son tour, est une structure arborescente o√π chaque √©l√©ment peut avoir un parent et de nombreux descendants. </p><br><p><img src="https://habrastorage.org/webt/mi/4j/f2/mi4jf2mdcqjc1huurmu2ca0hsfi.png" alt="image"></p><br><p>  Je voudrais mentionner que PSI n'est pas √©gal √† un <strong>arbre de syntaxe abstraite</strong> .  Un arbre de syntaxe abstraite est un arbre de repr√©sentation de votre programme apr√®s que l'analyseur a pass√© votre programme, et il est <strong>d√©tach√©</strong> de tout langage de programmation.  PSI, au contraire, est <strong>li√©</strong> √† un langage de programmation sp√©cifique.  Lorsque vous travaillez avec une classe Java, vous traitez avec des PsiElements Java.  Lorsque vous travaillez avec une classe Groovy - avec Groovy PsiElements, etc.   ,         PSI-  -  ,      ,   , ‚Äì    . </p><br><p>      PSI ‚Äì   PSI-   IDEA.            ,    ,        ,   .         . </p><br><h3 id="rezyumiruem-chast-pro-vnutrennosti-idea">     IDEA </h3><br><ul><li> PSI      IDEA; </li><li> PSI-   IDEA,            ; </li><li>         PsiElement-. </li></ul><br><p>      ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> .            . </p><br><h2 id="dopolnitelnye-materialy-po-plaginostroeniyu">     </h2><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">     </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   ,    </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  Tool window</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">    </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">      IntelliJ IDEA</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">       IDEA</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">      IntelliJ IDEA</a> </li><li>   , , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>     .    ,     . </li><li>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  Droidcon Italy 2017</a> ,  ,   , ,        FreeMarker- .        ,      . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   KotlinConf</a> ,     Square       SQLDelight,        Java,   Kotlin. </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463583/">https://habr.com/ru/post/fr463583/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463573/index.html">La premi√®re puce pour centres de donn√©es bas√©e sur l'architecture Zen 2</a></li>
<li><a href="../fr463575/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 22. Troisi√®me CCNA: continuer √† √©tudier RIP</a></li>
<li><a href="../fr463577/index.html">Plasticit√© et r√©sistance: durcissement de l'interm√©tallique sans accent sur la luxation</a></li>
<li><a href="../fr463579/index.html">Windows: d√©couvrez qui est connect√© o√π</a></li>
<li><a href="../fr463581/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 23. Technologies avanc√©es de routage</a></li>
<li><a href="../fr463585/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 24. IPv6</a></li>
<li><a href="../fr463587/index.html">ConfigureAwait, qui est √† bl√¢mer et que faire?</a></li>
<li><a href="../fr463591/index.html">BlueKeep-2 - toutes les nouvelles versions de Windows sont d√©sormais vuln√©rables</a></li>
<li><a href="../fr463595/index.html">Nous contr√¥lons le focus ou une pinc√©e de C # et STM32 pour une webcam</a></li>
<li><a href="../fr463597/index.html">Utilisation de l'API contextuelle dans React pour cr√©er une conception d'application r√©active</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>