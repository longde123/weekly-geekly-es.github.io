<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ˜ â˜ğŸ» ğŸ‘©ğŸ¼â€ğŸ¤ Kembali ke layanan microser dengan Istio. Bagian 2 ğŸ¬ ğŸ± ğŸ–ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Catatan perev. : Bagian pertama dari seri ini dikhususkan untuk memperkenalkan Istio dan menunjukkannya dalam aksi. Sekarang kita akan berbicara tenta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kembali ke layanan microser dengan Istio. Bagian 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/440378/"><img src="https://habrastorage.org/webt/bj/j4/oy/bjj4oyjxqshrbjf5eks9sgsvbeg.png"><br><br>  <i><b>Catatan</b></i>  <i><b>perev.</b></i>  <i>: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagian pertama dari</a> seri ini dikhususkan untuk memperkenalkan Istio dan menunjukkannya dalam aksi.</i>  <i>Sekarang kita akan berbicara tentang aspek-aspek yang lebih kompleks dari konfigurasi dan penggunaan mesh layanan ini, dan khususnya, tentang perutean yang diatur secara halus dan manajemen lalu lintas jaringan.</i> <i><br><br></i>  <i>Kami juga mengingatkan Anda bahwa artikel tersebut menggunakan konfigurasi (manifes untuk Kubernetes dan Istio) dari repositori <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">istio-mastery</a> .</i> <i><a name="habracut"></a></i> <br><br><h2>  Manajemen lalu lintas </h2><br>  Dengan Istio, fitur baru muncul di kluster untuk menyediakan: <br><br><ul><li>  <b>Routing query dinamis</b> : peluncuran canary, pengujian A / B; </li><li>  <b>Penyeimbangan beban</b> : sederhana dan konsisten, berdasarkan hash; </li><li>  <b>Fall recovery</b> : timeout, retries, pemutus sirkuit; </li><li>  <b>Input kesalahan</b> : keterlambatan, gangguan permintaan, dll. </li></ul><br>  Dalam kelanjutan artikel, fitur-fitur ini akan ditampilkan sebagai contoh aplikasi yang dipilih dan konsep-konsep baru akan diperkenalkan di sepanjang jalan.  Konsep tersebut pertama adalah <code>DestinationRules</code> <i>(yaitu aturan tentang penerima lalu lintas / permintaan - kira-kira. Terjemahan)</i> , Dengan mana kami mengaktifkan pengujian A / B. <br><br><h2>  Pengujian A / B: DestinationRules in Practice </h2><br>  Pengujian A / B digunakan dalam kasus di mana ada dua versi aplikasi (biasanya mereka berbeda secara visual) dan kami tidak 100% yakin mana yang akan meningkatkan interaksi pengguna.  Karenanya, kami secara bersamaan meluncurkan kedua versi dan mengumpulkan metrik. <br><br>  Untuk menggunakan versi kedua frontend yang diperlukan untuk mendemonstrasikan pengujian A / B, jalankan perintah berikut: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/kube/ab-testing/sa-frontend-green-deployment.yaml deployment.extensions/sa-frontend-green created</code> </pre> <br>  Manifes penyebaran untuk "versi hijau" berbeda di dua tempat: <br><br><ol><li>  Gambar didasarkan pada tag lain - <code>istio-green</code> , </li><li>  Pod memiliki <code>version: green</code> label <code>version: green</code> . </li></ol><br>  Karena kedua penyebaran memiliki <code>app: sa-frontend</code> label, permintaan yang dialihkan oleh <code>sa-external-services</code> virtual <code>sa-external-services</code> ke layanan <code>sa-frontend</code> akan dialihkan ke semua instance dan beban akan didistribusikan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">algoritma round-robin</a> , yang akan mengarah pada situasi berikut: <br><br><img src="https://habrastorage.org/webt/p-/bi/mj/p-bimjrw8ywosk5q020d3loefsy.png"><br>  <i>File yang diminta tidak ditemukan</i> <br><br>  File-file ini tidak ditemukan karena mereka dipanggil secara berbeda di versi aplikasi yang berbeda.  Mari kita pastikan ini: <br><br><pre> <code class="bash hljs">$ curl --silent http://<span class="hljs-variable"><span class="hljs-variable">$EXTERNAL_IP</span></span>/ | tr <span class="hljs-string"><span class="hljs-string">'"'</span></span> <span class="hljs-string"><span class="hljs-string">'\n'</span></span> | grep main /static/css/main.c7071b22.css /static/js/main.059f8e9c.js $ curl --silent http://<span class="hljs-variable"><span class="hljs-variable">$EXTERNAL_IP</span></span>/ | tr <span class="hljs-string"><span class="hljs-string">'"'</span></span> <span class="hljs-string"><span class="hljs-string">'\n'</span></span> | grep main /static/css/main.f87cd8c9.css /static/js/main.f7659dbb.js</code> </pre> <br>  Ini berarti bahwa <code>index.html</code> , meminta satu versi file statis, dapat dikirim oleh load balancer ke pod yang memiliki versi berbeda, di mana, untuk alasan yang jelas, file seperti itu tidak ada.  Oleh karena itu, agar aplikasi berfungsi, kita perlu memberi batasan: " <b>versi aplikasi yang sama yang memberikan index.html juga harus melayani permintaan berikutnya</b> ." <br><br>  Kami akan mencapai tujuan tersebut dengan penyeimbangan beban berbasis hash yang konsisten <i>(Consistent Hash Loadbalancing)</i> .  Dalam hal ini, <b>permintaan dari satu klien dikirim ke instance backend yang sama</b> , yang digunakan properti yang telah ditentukan sebelumnya - misalnya, header HTTP.  Diimplementasikan menggunakan DestinationRules. <br><br><h2>  Aturan Aturan </h2><br>  Setelah <b>VirtualService telah</b> mengirim permintaan ke layanan yang diinginkan, menggunakan DestinationRules kita dapat menentukan kebijakan yang akan diterapkan pada lalu lintas yang ditujukan untuk instance layanan ini: <br><br><img src="https://habrastorage.org/webt/sd/be/iy/sdbeiy6vndddkdjifebk9a7-q2m.png"><br>  <i>Manajemen Lalu Lintas Sumber Daya Istio</i> <br><br>  <b>Catatan</b> : Efek sumber daya Istio pada lalu lintas jaringan disajikan di sini dengan cara yang disederhanakan.  Lebih tepatnya, keputusan untuk mengirim contoh permintaan dibuat oleh Utusan di Ingress Gateway dikonfigurasi dalam CRD. <br><br>  Dengan menggunakan Aturan Tujuan, kami dapat mengonfigurasi penyeimbangan muatan sehingga hash yang konsisten digunakan dan respons dari layanan yang sama dijamin untuk pengguna yang sama.  Konfigurasi berikut memungkinkan ini ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">destinationrule-sa-frontend.yaml</a> ) untuk mencapai ini: <br><br><pre> <code class="plaintext hljs">apiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: sa-frontend spec: host: sa-frontend trafficPolicy: loadBalancer: consistentHash: httpHeaderName: version # 1</code> </pre> <br>  1 - hash akan dihasilkan berdasarkan pada isi header <code>version</code> HTTP. <br><br>  Terapkan konfigurasi dengan perintah berikut: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/istio/ab-testing/destinationrule-sa-frontend.yaml destinationrule.networking.istio.io/sa-frontend created</code> </pre> <br>  Sekarang jalankan perintah di bawah ini dan pastikan Anda mendapatkan file yang Anda butuhkan saat menentukan <code>version</code> header: <br><br><pre> <code class="bash hljs">$ curl --silent -H <span class="hljs-string"><span class="hljs-string">"version: yogo"</span></span> http://<span class="hljs-variable"><span class="hljs-variable">$EXTERNAL_IP</span></span>/ | tr <span class="hljs-string"><span class="hljs-string">'"'</span></span> <span class="hljs-string"><span class="hljs-string">'\n'</span></span> | grep main</code> </pre> <br>  <b>Catatan</b> : Untuk menambahkan nilai yang berbeda dalam judul dan menguji hasilnya langsung di browser, Anda dapat menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ekstensi ini</a> untuk Chrome <i>(atau yang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ini</a> untuk Firefox - kira-kira Terjemahkan.)</i> . <br><br>  Secara umum, DestinationRules memiliki lebih banyak opsi di bidang penyeimbangan beban - periksa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi resmi untuk</a> detailnya. <br><br>  Sebelum mempelajari VirtualService lebih lanjut, kami akan menghapus "versi hijau" dari aplikasi dan aturan yang sesuai dalam arah lalu lintas dengan menjalankan perintah berikut: <br><br><pre> <code class="bash hljs">$ kubectl delete -f resource-manifests/kube/ab-testing/sa-frontend-green-deployment.yaml deployment.extensions â€œsa-frontend-greenâ€ deleted $ kubectl delete -f resource-manifests/istio/ab-testing/destinationrule-sa-frontend.yaml destinationrule.networking.istio.io â€œsa-frontendâ€ deleted</code> </pre> <br><h2>  Mirroring: Layanan Virtual dalam Praktek </h2><br>  Shadowing <i>("shielding")</i> atau Mirroring <i>("mirroring")</i> digunakan dalam kasus-kasus ketika kami ingin menguji perubahan dalam produksi tanpa mempengaruhi pengguna akhir: untuk ini kami menduplikasi ("mirror") permintaan untuk instance kedua, di mana perubahan yang diperlukan dibuat, dan lihat konsekuensinya.  <i>Sederhananya, ini adalah saat (a) kolega Anda memilih masalah yang paling kritis dan mengajukan permintaan dalam bentuk gumpalan tanah yang sangat besar sehingga tidak ada yang bisa benar-benar membuat ulasan untuknya.</i> <br><br>  Untuk menguji skenario ini dalam tindakan, buat instance SA-Logic kedua dengan bug ( <code>buggy</code> ) dengan menjalankan perintah berikut: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/kube/shadowing/sa-logic-service-buggy.yaml deployment.extensions/sa-logic-buggy created</code> </pre> <br>  Dan sekarang kita menjalankan perintah untuk memastikan bahwa semua instance dengan <code>app=sa-logic</code> memiliki label dengan versi yang sesuai: <br><br><pre> <code class="bash hljs">$ kubectl get pods -l app=sa-logic --show-labels NAME READY LABELS sa-logic-568498cb4d-2sjwj 2/2 app=sa-logic,version=v1 sa-logic-568498cb4d-p4f8c 2/2 app=sa-logic,version=v1 sa-logic-buggy-76dff55847-2fl66 2/2 app=sa-logic,version=v2 sa-logic-buggy-76dff55847-kx8zz 2/2 app=sa-logic,version=v2</code> </pre> <br>  Layanan <code>sa-logic</code> menargetkan pod dengan label <code>app=sa-logic</code> , sehingga semua permintaan akan didistribusikan di antara semua instance: <br><br><img src="https://habrastorage.org/webt/6d/po/v8/6dpov8tnmom1j_sr7tcedj7bufo.png"><br><br>  ... tapi kami ingin permintaan diarahkan ke instance dengan versi v1 dan dicerminkan ke instance dengan versi v2: <br><br><img src="https://habrastorage.org/webt/7u/n6/aj/7un6aj7gerw57imbzmwgkwgjajw.png"><br><br>  Kami akan mencapai ini melalui VirtualService dalam kombinasi dengan DestinationRule, di mana aturan akan menentukan himpunan bagian dan rute dari VirtualService ke subset tertentu. <br><br><h2>  Mendefinisikan Subset dalam Aturan Tujuan </h2><br>  <i>Subset</i> didefinisikan oleh konfigurasi berikut ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sa-logic-subset-destinationrule.yaml</a> ): <br><br><pre> <code class="plaintext hljs">apiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: sa-logic spec: host: sa-logic # 1 subsets: - name: v1 # 2 labels: version: v1 # 3 - name: v2 labels: version: v2</code> </pre> <br><ol><li>  Tuan <code>host</code> menentukan bahwa aturan ini hanya berlaku untuk kasus-kasus ketika rute menuju <code>sa-logic</code> ; </li><li>  Nama-nama himpunan bagian digunakan saat routing ke instance dari subset; </li><li>  Label menentukan pasangan nilai kunci yang harus dicocokkan oleh instance untuk menjadi bagian dari subset. </li></ol><br>  Terapkan konfigurasi dengan perintah berikut: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/istio/shadowing/sa-logic-subsets-destinationrule.yaml destinationrule.networking.istio.io/sa-logic created</code> </pre> <br>  Sekarang setelah himpunan bagian didefinisikan, Anda bisa melanjutkan dan mengkonfigurasi VirtualService untuk menerapkan aturan untuk permintaan ke s-logika sehingga mereka: <br><br><ol><li>  Diarahkan ke subset dari <code>v1</code> , </li><li>  Dicerminkan ke subset dari <code>v2</code> . </li></ol><br>  Manifes berikut memungkinkan Anda untuk mencapai rencana Anda ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sa-logic-subsets-shadowing-vs. Yaml</a> ): <br><br><pre> <code class="plaintext hljs">apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: sa-logic spec: hosts: - sa-logic http: - route: - destination: host: sa-logic subset: v1 mirror: host: sa-logic subset: v2</code> </pre> <br>  Tidak ada penjelasan yang diperlukan di sini, jadi lihat saja tindakannya: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/istio/shadowing/sa-logic-subsets-shadowing-vs.yaml virtualservice.networking.istio.io/sa-logic created</code> </pre> <br>  Tambahkan beban dengan memanggil perintah ini: <br><br><pre> <code class="bash hljs">$ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> curl -v http://<span class="hljs-variable"><span class="hljs-variable">$EXTERNAL_IP</span></span>/sentiment \ -H <span class="hljs-string"><span class="hljs-string">"Content-type: application/json"</span></span> \ -d <span class="hljs-string"><span class="hljs-string">'{"sentence": "I love yogobella"}'</span></span>; \ sleep .8; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br>  Mari kita lihat hasilnya di Grafana, di mana kita dapat melihat bahwa versi <code>buggy</code> macet untuk ~ 60% dari permintaan, tetapi tidak satu pun dari crash ini mempengaruhi pengguna akhir karena mereka memiliki layanan yang berfungsi. <br><br><img src="https://habrastorage.org/webt/x3/g6/so/x3g6so65q5jmyjj48-_kjf254de.png"><br>  <i>Keberhasilan tanggapan dari berbagai versi layanan sa-logic</i> <br><br>  Di sini kita melihat untuk pertama kalinya bagaimana VirtualService diterapkan ke Utusan layanan kami: ketika <code>sa-web-app</code> membuat permintaan untuk <code>sa-logic</code> , ia melewati Utusan sespan, yang - melalui VirtualService - dikonfigurasi untuk merutekan permintaan ke subset v1 dan mirror permintaan ke subset dari v2 dari layanan <code>sa-logic</code> . <br><br>  Saya tahu: Anda sudah punya waktu untuk berpikir bahwa Layanan Virtual itu sederhana.  Pada bagian selanjutnya, kami memperluas pandangan ini dengan fakta bahwa mereka juga benar-benar luar biasa. <br><br><h2>  Gulungan kenari </h2><br>  Canary Deployment adalah proses meluncurkan versi baru aplikasi untuk sejumlah kecil pengguna.  Ini digunakan untuk memastikan bahwa tidak ada masalah dalam rilis dan hanya setelah itu, sudah yakin dengan kualitas (rilis) yang cukup, untuk menyebar ke audiens yang lebih besar. <br><br>  Untuk mendemonstrasikan peluncuran kenari, kami akan terus bekerja dengan sub-bagian dari <code>buggy</code> dalam <code>sa-logic</code> . <br><br>  Jangan buang waktu dan segera kirim 20% pengguna ke versi dengan bug (itu akan mewakili peluncuran kenari kami), dan sisanya 80% untuk layanan normal.  Untuk melakukan ini, terapkan VirtualService berikut ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sa-logic-subsets-canary-vs.yaml</a> ): <br><br><pre> <code class="plaintext hljs">apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: sa-logic spec: hosts: - sa-logic http: - route: - destination: host: sa-logic subset: v1 weight: 80 # 1 - destination: host: sa-logic subset: v2 weight: 20 # 1</code> </pre> <br>  1 adalah bobot, yang menentukan persentase permintaan yang akan dikirim ke penerima atau sebagian dari penerima. <br><br>  Perbarui konfigurasi VirtualService sebelumnya untuk <code>sa-logic</code> perintah berikut: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/istio/canary/sa-logic-subsets-canary-vs.yaml virtualservice.networking.istio.io/sa-logic configured</code> </pre> <br>  ... dan segera lihat bahwa bagian dari permintaan macet: <br><br><pre> <code class="bash hljs">$ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> \ curl -i http://<span class="hljs-variable"><span class="hljs-variable">$EXTERNAL_IP</span></span>/sentiment \ -H <span class="hljs-string"><span class="hljs-string">"Content-type: application/json"</span></span> \ -d <span class="hljs-string"><span class="hljs-string">'{"sentence": "I love yogobella"}'</span></span> \ --silent -w <span class="hljs-string"><span class="hljs-string">"Time: %{time_total}s \t Status: %{http_code}\n"</span></span> \ -o /dev/null; sleep .1; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> Time: 0.153075s Status: 200 Time: 0.137581s Status: 200 Time: 0.139345s Status: 200 Time: 30.291806s Status: 500</code> </pre> <br>  Layanan Virtual mengaktifkan peluncuran kenari: dalam hal ini, kami mempersempit konsekuensi potensial dari masalah menjadi 20% dari basis pengguna.  Hebat!  Sekarang, dalam setiap kasus, ketika kita tidak yakin dengan kode kita (dengan kata lain, selalu ...), kita bisa menggunakan mirroring dan canary rollouts. <br><br><h2>  Timeout dan Retries </h2><br>  Tetapi tidak selalu bug ada dalam kode.  Dalam daftar " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">8 kesalahan dalam komputasi terdistribusi</a> " di tempat pertama muncul pendapat keliru bahwa "jaringan dapat diandalkan."  Pada kenyataannya, jaringan <b>tidak</b> dapat diandalkan, dan untuk alasan ini kita perlu waktu tunggu dan <i>coba lagi</i> . <br><br>  Untuk demonstrasi, kami akan terus menggunakan versi <code>sa-logic</code> ( <code>buggy</code> ), dan kami akan mensimulasikan jaringan yang tidak dapat diandalkan dengan kegagalan acak. <br><br>  Biarkan layanan kami dengan bug memiliki 1/3 peluang untuk tanggapan yang terlalu lama, 1/3 untuk penyelesaian dengan Kesalahan Server Internal, dan 1/3 untuk pengembalian halaman yang berhasil. <br><br>  Untuk mengurangi konsekuensi dari masalah tersebut dan menjadikan hidup lebih baik bagi pengguna, kami dapat: <br><br><ol><li>  tambahkan batas waktu jika layanan merespons lebih dari 8 detik, </li><li>  coba lagi jika permintaan gagal. </li></ol><br>  Untuk implementasi, kami akan menggunakan definisi sumber daya berikut ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sa-logic-retries-timeout-vs.yaml</a> ): <br><br><pre> <code class="plaintext hljs">apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: sa-logic spec: hosts: - sa-logic http: - route: - destination: host: sa-logic subset: v1 weight: 50 - destination: host: sa-logic subset: v2 weight: 50 timeout: 8s # 1 retries: attempts: 3 # 2 perTryTimeout: 3s # 3</code> </pre> <br><ol><li>  Batas waktu permintaan diatur ke 8 detik; </li><li>  Upaya permintaan berulang dilakukan 3 kali; </li><li>  Dan setiap upaya dianggap tidak berhasil jika waktu respons melebihi 3 detik. </li></ol><br>  Jadi kami telah mencapai optimasi, karena pengguna tidak perlu menunggu lebih dari 8 detik dan kami akan melakukan tiga upaya baru untuk mendapatkan jawaban jika terjadi kegagalan, meningkatkan peluang respons yang berhasil. <br><br>  Terapkan konfigurasi yang diperbarui dengan perintah berikut: <br><br><pre> <code class="bash hljs">$ kubectl apply -f resource-manifests/istio/retries/sa-logic-retries-timeouts-vs.yaml virtualservice.networking.istio.io/sa-logic configured</code> </pre> <br>  Dan periksa dalam grafik Grafana bahwa jumlah jawaban yang sukses sudah berakhir: <br><br><img src="https://habrastorage.org/webt/ee/l_/qs/eel_qsg8z2vwzjwi35xmqg6eiko.png"><br>  <i>Perbaikan dalam statistik respons yang berhasil setelah menambahkan batas waktu dan coba lagi</i> <br><br>  Sebelum melanjutkan ke bagian berikutnya <i>(atau lebih tepatnya, ke bagian selanjutnya dari artikel ini, karena tidak akan ada lagi percobaan dalam praktik ini - sekitar Terjemahan.)</i> , Hapus <code>sa-logic-buggy</code> dan VirtualService dengan menjalankan perintah berikut: <br><br><pre> <code class="bash hljs">$ kubectl delete deployment sa-logic-buggy deployment.extensions â€œsa-logic-buggyâ€ deleted $ kubectl delete virtualservice sa-logic virtualservice.networking.istio.io â€œsa-logicâ€ deleted</code> </pre> <br><h2>  Pemutus Sirkuit dan Pola Sekat </h2><br>  Kita berbicara tentang dua pola penting dalam arsitektur layanan mikro yang memungkinkan Anda untuk mencapai layanan <i>penyembuhan diri</i> . <br><br>  <b>Circuit Breaker</b> <i>("circuit breaker")</i> digunakan untuk menghentikan permintaan yang datang ke layanan yang dianggap tidak sehat dan memulihkannya sementara permintaan klien dialihkan ke contoh layanan yang sehat (yang meningkatkan persentase respons yang berhasil).  <i>(Catatan: Deskripsi pola yang lebih rinci dapat ditemukan, misalnya, di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .)</i> <br><br>  <b>Bulkhead</b> <i>("partisi")</i> mengisolasi kegagalan layanan dari kekalahan seluruh sistem.  Misalnya, layanan B rusak, dan layanan lain (klien layanan B) membuat permintaan untuk layanan B, sebagai akibatnya ia akan menggunakan kumpulan utangnya dan tidak akan dapat melayani permintaan lain (bahkan jika mereka tidak terkait dengan layanan B).  <i>(Catatan: Deskripsi pola yang lebih rinci dapat ditemukan, misalnya, di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .)</i> <br><br>  Saya akan menghilangkan detail penerapan pola-pola ini, karena mudah ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi resmi</a> , dan saya benar-benar ingin menunjukkan otentikasi dan otorisasi, yang akan dibahas pada bagian selanjutnya dari artikel ini. <br><br><h2>  PS dari penerjemah </h2><br>  Baca juga di blog kami: <br><br><ul><li>  â€œKembali ke layanan microser dengan Istioâ€: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bagian 1 (keakraban dengan fitur utama)</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bagian 3 (otentikasi dan otorisasi)</a> ; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Conduit - mesh layanan ringan untuk Kubernetes</a> "; </li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Apa itu service mesh dan mengapa saya membutuhkannya [untuk aplikasi cloud dengan layanan microser]?</a>  ". </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id440378/">https://habr.com/ru/post/id440378/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id440366/index.html">Siklus hidup sebuah artikel tentang HabrÃ©: kami menulis</a></li>
<li><a href="../id440370/index.html">Ketentuan layanan: 99% pengguna tidak memahaminya</a></li>
<li><a href="../id440372/index.html">Kompilator Pascal saya dan seni kontemporer Polandia</a></li>
<li><a href="../id440374/index.html">Fungsi Yandex mengirim email</a></li>
<li><a href="../id440376/index.html">20 game untuk mengajarkan pemrograman anak Anda</a></li>
<li><a href="../id440382/index.html">Apakah 200 baik atau buruk?</a></li>
<li><a href="../id440386/index.html">Membebaskan penanganan kesalahan dengan menghilangkan kesalahan</a></li>
<li><a href="../id440388/index.html">Interval: Evolusi C ++ yang Mendatang</a></li>
<li><a href="../id440390/index.html">Dunia beragam sistem embedded dan tempat Embox di dalamnya</a></li>
<li><a href="../id440392/index.html">WebRTC di situs Anda - tanpa bug dan tanpa anggaran</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>