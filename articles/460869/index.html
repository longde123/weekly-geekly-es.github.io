<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ú üßö üë©üèø‚Äçü§ù‚Äçüë©üèª Reconocimiento de objetos en tiempo real en iOS usando YOLOv3 üßîüèΩ ‚ÜòÔ∏è üëÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! 

 En este art√≠culo escribiremos un peque√±o programa para resolver el problema de detecci√≥n y reconocimiento de objetos (detecci√≥n de ob...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reconocimiento de objetos en tiempo real en iOS usando YOLOv3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460869/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/gr/ah/g9/grahg9mh7movhc2fcbn7m-yfoxu.png"></div><br>  Hola a todos! <br><br>  En este art√≠culo escribiremos un peque√±o programa para resolver el problema de detecci√≥n y reconocimiento de objetos (detecci√≥n de objetos) en tiempo real.  El programa se escribir√° en el lenguaje de programaci√≥n Swift para la plataforma iOS.  Para detectar objetos, utilizaremos una red neuronal convolucional con una arquitectura llamada YOLOv3.  En el art√≠culo, aprenderemos c√≥mo trabajar en iOS con redes neuronales usando el marco CoreML, un poco de comprensi√≥n de qu√© es la red YOLOv3 y c√≥mo usar y procesar los resultados de esta red.  Tambi√©n verificaremos el funcionamiento del programa y compararemos varias variaciones de YOLOv3: YOLOv3-tiny y YOLOv3-416. <br><br>  Las fuentes estar√°n disponibles al final del art√≠culo, por lo que todos podr√°n probar el funcionamiento de la red neuronal en su dispositivo. <br><a name="habracut"></a><br><h2>  Detecci√≥n de objetos </h2><br>  Para comenzar, comprenderemos brevemente cu√°l es la tarea de detectar objetos (detecci√≥n de objetos) en la imagen y qu√© herramientas se utilizan para esto hoy.  Entiendo que muchos est√°n bastante familiarizados con este tema, pero a√∫n me permito contar un poco al respecto. <br><br>  Ahora, muchas de las tareas en el campo de la visi√≥n por computadora se resuelven con la ayuda de redes neuronales convolucionales (Redes neuronales convolucionales), en adelante CNN.  Debido a su estructura, extraen caracter√≠sticas de la imagen.  Las CNN se utilizan en clasificaci√≥n, reconocimiento, segmentaci√≥n y muchas otras. <br><br>  Arquitecturas populares de CNN para el reconocimiento de objetos: <br><br><ul><li>  <b>R-CNN.</b>  Podemos decir el primer modelo para resolver este problema.  Funciona como un clasificador de imagen normal.  Se alimentan diferentes regiones de la imagen a la entrada de red y se hacen predicciones para ellas.  Muy lento ya que ejecuta una sola imagen varias miles de veces. </li><li>  <b>R-CNN r√°pido.</b>  Una versi√≥n mejorada y m√°s r√°pida de R-CNN funciona con un principio similar, pero primero se alimenta toda la imagen a la entrada de CNN, luego se generan regiones a partir de la representaci√≥n interna recibida.  Pero sigue siendo bastante lento para tareas en tiempo real. </li><li>  <b>R-CNN m√°s r√°pido.</b>  La principal diferencia con respecto a las anteriores es que, en lugar del algoritmo de b√∫squeda selectiva, utiliza una red neuronal para seleccionar regiones para "memorizarlas". </li><li>  <b>Yolo</b>  Un principio de funcionamiento completamente diferente en comparaci√≥n con los anteriores no utiliza regiones en absoluto.  El mas rapido.  Se discutir√°n m√°s detalles al respecto en el art√≠culo. </li><li>  <b>SSD</b>  Es similar en principio a YOLO, pero usa VGG16 como red para extraer funciones.  Tambi√©n bastante r√°pido y adecuado para el trabajo en tiempo real. </li><li>  <b>Feature Pyramid Networks (FPN).</b>  Otro tipo de red, como Single Shot Detector, debido a las caracter√≠sticas de extracci√≥n de caracter√≠sticas, es mejor que SSD reconoce objetos peque√±os. </li><li>  <b>RetinaNet.</b>  Utiliza una combinaci√≥n de FPN + ResNet y, gracias a una funci√≥n de error especial (p√©rdida focal), proporciona una mayor precisi√≥n. </li></ul><br>  En este art√≠culo, utilizaremos la arquitectura YOLO, es decir, su √∫ltima modificaci√≥n, YOLOv3. <br><br><h2>  ¬øPor qu√© YOLO? </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i4/fy/lq/i4fylqlbpgsp-mu3w6k96zd5e1u.jpeg"></div><br><br>  YOLO o You Only Look Once es la arquitectura muy popular de CNN, que se utiliza para reconocer m√∫ltiples objetos en una imagen.  Puede obtener informaci√≥n m√°s completa al respecto en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio web oficial</a> , all√≠ tambi√©n puede encontrar publicaciones que describen en detalle la teor√≠a y el componente matem√°tico de esta red, as√≠ como tambi√©n se describe el proceso de su capacitaci√≥n. <br><br>  La caracter√≠stica principal de esta arquitectura en comparaci√≥n con otras es que la mayor√≠a de los sistemas aplican CNN varias veces a diferentes regiones de la imagen; en YOLO, CNN se aplica una vez a toda la imagen a la vez.  La red divide la imagen en una especie de cuadr√≠cula y predice cuadros delimitadores y la probabilidad de que haya un objeto deseado para cada secci√≥n. <br><br>  Las ventajas de este enfoque es que la red mira la imagen completa a la vez y tiene en cuenta el contexto al detectar y reconocer un objeto.  YOLO tambi√©n es 1000 veces m√°s r√°pido que R-CNN y aproximadamente 100 veces m√°s r√°pido que Fast R-CNN.  En este art√≠culo, lanzaremos una red en un dispositivo m√≥vil para el procesamiento en l√≠nea, por lo que esta es la calidad m√°s importante para nosotros. <br><br>  Puede encontrar informaci√≥n m√°s detallada sobre la comparaci√≥n de arquitecturas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h4>  YOLOv3 </h4><br>  YOLOv3 es una versi√≥n avanzada de la arquitectura YOLO.  Consiste en 106 capas convolucionales y detecta mejor los objetos peque√±os en comparaci√≥n con su predecesor YOLOv2.  La caracter√≠stica principal de YOLOv3 es que hay tres capas en la salida, cada una de las cuales est√° dise√±ada para detectar objetos de diferentes tama√±os. <br>  La siguiente imagen muestra su estructura esquem√°tica: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cl/rf/_j/clrf_jqzkt1qfszivfchhxkujv4.png"></div><br><br>  <b>YOLOv3-tiny</b> : una versi√≥n recortada de la arquitectura YOLOv3, consta de menos capas (solo hay 2 capas de salida).  Predice peor los objetos m√°s peque√±os y est√° destinado a peque√±os conjuntos de datos.  Pero, debido a la estructura truncada, los pesos de la red ocupan una peque√±a cantidad de memoria (~ 35 MB) y produce un FPS m√°s alto.  Por lo tanto, dicha arquitectura es preferible para su uso en un dispositivo m√≥vil. <br><br><h2>  Estamos escribiendo un programa para el reconocimiento de objetos. </h2><br>  ¬°Comienza la parte divertida! <br><br>  Creemos una aplicaci√≥n que reconozca varios objetos en la imagen en tiempo real usando la c√°mara del tel√©fono.  Todo el c√≥digo se escribir√° en el lenguaje de programaci√≥n Swift 4.2 y se ejecutar√° en un dispositivo iOS. <br><br>  En este tutorial tomaremos una red preparada con escalas pre-entrenadas en un conjunto de datos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">COCO</a> .  Presenta 80 clases diferentes.  Por lo tanto, nuestra neurona podr√° reconocer 80 objetos diferentes. <br><br><h4>  De Darknet a CoreML </h4><br>  La arquitectura original de YOLOv3 se implementa utilizando el marco <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Darknet</a> . <br><br>  En iOS, a partir de la versi√≥n 11.0, existe una maravillosa biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CoreML</a> que le permite ejecutar modelos de aprendizaje autom√°tico directamente en el dispositivo.  Pero hay una limitaci√≥n: el <b>programa solo se puede ejecutar en un dispositivo con iOS 11 y superior.</b> <br><br>  El problema es que CoreML solo comprende el formato espec√≠fico del modelo <i>.coreml</i> .  Para las bibliotecas m√°s populares, como Tensorflow, Keras o XGBoost, es posible convertir directamente al formato CoreML.  Pero para Darknet no existe tal posibilidad.  Para convertir el modelo guardado y entrenado de Darknet a CoreML, puede usar varias opciones, por ejemplo, guardar Darknet a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ONNX</a> y luego convertirlo de ONNX a CoreML. <br><br>  Utilizaremos una forma m√°s simple y utilizaremos la implementaci√≥n Keras de YOLOv3.  El algoritmo de acci√≥n es el siguiente: cargue los pesos Darknet en el modelo Keras, gu√°rdelo en el formato Keras y convi√©rtalo directamente a CoreML. <br><br><ol><li>  <b>Descargar Darknet.</b>  Descargue los archivos del modelo entrenado Darknet-YOLOv3 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desde aqu√≠</a> .  En este art√≠culo, usar√© dos arquitecturas: YOLOv3-416 y YOLOv3-tiny.  Necesitaremos archivos cfg y pesos. </li><li>  <b>De Darknet a Keras.</b>  Primero, clone el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio</a> , vaya a la carpeta repo y ejecute el comando: <br><br><pre><code class="bash hljs">python convert.py yolov3.cfg yolov3.weights yolo.h5</code> </pre> <br>  donde yolov3.cfg y yolov3.weights descargaron archivos Darknet.  Como resultado, deber√≠amos tener un archivo con la extensi√≥n <i>.h5</i> : este es el modelo YOLOv3 guardado en formato Keras. </li><li>  <b>De Keras a CoreML.</b>  El √∫ltimo paso qued√≥.  Para convertir el modelo a CoreML, debe ejecutar el script python (primero debe instalar la biblioteca coremltools para python): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> coremltools coreml_model = coremltools.converters.keras.convert( <span class="hljs-string"><span class="hljs-string">'yolo.h5'</span></span>, input_names=<span class="hljs-string"><span class="hljs-string">'image'</span></span>, image_input_names=<span class="hljs-string"><span class="hljs-string">'image'</span></span>, input_name_shape_dict={<span class="hljs-string"><span class="hljs-string">'image'</span></span>: [<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">416</span></span>, <span class="hljs-number"><span class="hljs-number">416</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>]}, <span class="hljs-comment"><span class="hljs-comment">#      image_scale=1/255.) coreml_model.input_description['image'] = 'Input image' coreml_model.save('yolo.mlmodel')</span></span></code> </pre> </li></ol><br>  Los pasos que se describen arriba deben realizarse para los dos modelos YOLOv3-416 y YOLOv3-tiny. <br>  Cuando hicimos todo esto, tenemos dos archivos: yolo.mlmodel y yolo-tiny.mlmodel.  Ahora puede comenzar a escribir el c√≥digo de la aplicaci√≥n en s√≠. <br><br><h4>  Crear una aplicaci√≥n para iOS </h4><br>  No describir√© todo el c√≥digo de la aplicaci√≥n, puede verlo en el enlace del repositorio que se proporcionar√° al final del art√≠culo.  Perm√≠tanme decir que tenemos tres UIViewController-a: OnlineViewController, PhotoViewController y SettingsViewController.  El primero es la salida de la c√°mara y la detecci√≥n en l√≠nea de objetos para cada cuadro.  En el segundo, puede tomar una foto o seleccionar una imagen de la galer√≠a y probar la red en estas im√°genes.  El tercero contiene la configuraci√≥n, puede elegir el modelo YOLOv3-416 o YOLOv3-min√∫sculo, as√≠ como elegir los umbrales IoU (intersecci√≥n sobre uni√≥n) y la confianza del objeto (la probabilidad de que haya un objeto en la secci√≥n de imagen actual). <br><br>  <b>Cargando modelos en CoreML</b> <br><br>  Despu√©s de convertir el modelo entrenado del formato Darknet a CoreML, tenemos un archivo con la extensi√≥n <i>.mlmodel</i> .  En mi caso, cre√© dos archivos: <i>yolo.mlmodel</i> y <i>yolo-tiny.mlmodel</i> , para los modelos YOLOv3-416 y YOLOv3-tiny, respectivamente.  Ahora puede cargar estos archivos en un proyecto en Xcode. <br><br>  Creamos la clase ModelProvider; almacenar√° el modelo y los m√©todos actuales para invocar asincr√≥nicamente la red neuronal para su ejecuci√≥n.  El modelo se carga de esta manera: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: YOLOType)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.model = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">YOLO</span></span>(type: type) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">assertionFailure</span></span>(<span class="hljs-string"><span class="hljs-string">"error creating model"</span></span>) } }</code> </pre><br>  La clase YOLO es directamente responsable de cargar archivos <i>.mlmodel</i> y manejar los resultados del modelo.  Descargar archivos de modelo: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url: <span class="hljs-type"><span class="hljs-type">URL?</span></span> = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.type = type <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> type { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .v3_Tiny: url = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.url(forResource: <span class="hljs-string"><span class="hljs-string">"yolo-tiny"</span></span>, withExtension:<span class="hljs-string"><span class="hljs-string">"mlmodelc"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors = tiny_anchors <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .v3_416: url = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.url(forResource: <span class="hljs-string"><span class="hljs-string">"yolo"</span></span>, withExtension:<span class="hljs-string"><span class="hljs-string">"mlmodelc"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors = anchors_416 } <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> modelURL = url <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">YOLOError</span></span>.modelFileNotFound } <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { model = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">MLModel</span></span>(contentsOf: modelURL) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">YOLOError</span></span>.modelCreationError }</code> </pre><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de proveedor de modelo completo.</b> <div class="spoiler_text"><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UIKit <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CoreML protocol ModelProviderDelegate: class { func show(predictions: [YOLO.Prediction]?, stat: ModelProvider.Statistics, error: YOLOError?) } @available(macOS 10.13, iOS 11.0, tvOS 11.0, watchOS 4.0, *) class ModelProvider { struct Statistics { var timeForFrame: Float var fps: Float } static let shared = ModelProvider(modelType: Settings.shared.modelType) var model: YOLO! weak var delegate: ModelProviderDelegate? var predicted = 0 var timeOfFirstFrameInSecond = CACurrentMediaTime() init(modelType type: YOLOType) { loadModel(type: type) } func reloadModel(type: YOLOType) { loadModel(type: type) } private func loadModel(type: YOLOType) { do { self.model = try YOLO(type: type) } catch { assertionFailure("error creating model") } } func predict(frame: UIImage) { DispatchQueue.global().async { do { let startTime = CACurrentMediaTime() let predictions = try self.model.predict(frame: frame) let elapsed = CACurrentMediaTime() - startTime self.showResultOnMain(predictions: predictions, elapsed: Float(elapsed), error: nil) } catch let error as YOLOError { self.showResultOnMain(predictions: nil, elapsed: -1, error: error) } catch { self.showResultOnMain(predictions: nil, elapsed: -1, error: YOLOError.unknownError) } } } private func showResultOnMain(predictions: [YOLO.Prediction]?, elapsed: Float, error: YOLOError?) { if let delegate = self.delegate { DispatchQueue.main.async { let fps = self.measureFPS() delegate.show(predictions: predictions, stat: ModelProvider.Statistics(timeForFrame: elapsed, fps: fps), error: error) } } } private func measureFPS() -&gt; Float { predicted += 1 let elapsed = CACurrentMediaTime() - timeOfFirstFrameInSecond let currentFPSDelivered = Double(predicted) / elapsed if elapsed &gt; 1 { predicted = 0 timeOfFirstFrameInSecond = CACurrentMediaTime() } return Float(currentFPSDelivered) } }</code> </pre><br></div></div><br>  <b>Procesamiento de salida de red neuronal</b> <br><br>  Ahora veamos c√≥mo procesar las salidas de la red neuronal y obtener los cuadros delimitadores correspondientes.  En Xcode, si selecciona un archivo de modelo, puede ver cu√°les son y ver las capas de salida. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m_/3b/vz/m_3bvzkroynfyfkpv1fal-ydf_k.png"></div><br>  <i>Entrada y salida YOLOv3-tiny.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0l/nl/hy/0lnlhydblax7trhpzdte8bojc0y.png"></div><br>  <i>Entrada y salida YOLOv3-416.</i> <br><br>  Como puede ver en la imagen de arriba, tenemos tres para YOLOv3-416 y dos para capas de salida YOLOv3-diminutas en cada una de las cuales se predicen cuadros delimitadores para varios objetos. <br>  En este caso, esta es una matriz regular de n√∫meros, descubramos c√≥mo analizarla. <br><br>  El modelo YOLOv3 utiliza tres capas como salida para dividir la imagen en una cuadr√≠cula diferente, los tama√±os de celda de estas cuadr√≠culas tienen los siguientes valores: 8, 16 y 32. Supongamos que tenemos una imagen de 416x416 p√≠xeles de tama√±o, luego las matrices de salida (cuadr√≠culas) tendr√°n un tama√±o de 52x52 , 26x26 y 13x13 (416/8 = 52, 416/16 = 26 y 416/32 = 13).  En el caso de YOLOv3-tiny, todo es igual, pero en lugar de tres cuadr√≠culas, tenemos dos: 16 y 32, es decir, matrices de dimensiones 26x26 y 13x13. <br><br>  Despu√©s de iniciar el modelo CoreML cargado, obtenemos dos (o tres) objetos de la clase MLMultiArray en la salida.  Y si observa la propiedad de forma de estos objetos, veremos la siguiente imagen (para YOLOv3-tiny): <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="MJXp-mo" id="MJXp-Span-2" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-3">1</span><span class="MJXp-mo" id="MJXp-Span-4" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-5">1</span><span class="MJXp-mo" id="MJXp-Span-6" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-7">255</span><span class="MJXp-mo" id="MJXp-Span-8" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-9">26</span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-11">26</span><span class="MJXp-mo" id="MJXp-Span-12" style="margin-left: 0em; margin-right: 0em;">]</span><span class="MJXp-mspace" id="MJXp-Span-13" style="width: 0em; height: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-14" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-mn" id="MJXp-Span-15">1</span><span class="MJXp-mo" id="MJXp-Span-16" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-17">1</span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-19">255</span><span class="MJXp-mo" id="MJXp-Span-20" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-21">13</span><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-23">13</span><span class="MJXp-mo" id="MJXp-Span-24" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="76.867ex" height="6.033ex" viewBox="0 -832 33095.6 2597.7" role="img" focusable="false" style="vertical-align: -4.101ex; max-width: 638px;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(13126,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-31" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-31" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-2C" x="1724" y="0"></use><g transform="translate(2169,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-35" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-2C" x="3671" y="0"></use><g transform="translate(4116,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-36" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-2C" x="5117" y="0"></use><g transform="translate(5562,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-36" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-5D" x="6563" y="0"></use></g><g transform="translate(13126,-1433)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-31" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-31" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-2C" x="1724" y="0"></use><g transform="translate(2169,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-35" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-2C" x="3671" y="0"></use><g transform="translate(4116,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-33" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-2C" x="5117" y="0"></use><g transform="translate(5562,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-33" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-5D" x="6563" y="0"></use></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> [1, 1, 255, 26, 26] \\ [1, 1, 255, 13, 13] </script></p><br>  Como se esperaba, la dimensi√≥n de las matrices ser√° 26x26 y 13x13, pero ¬øqu√© significar√° el n√∫mero 255?  Como se mencion√≥ anteriormente, las capas de salida son matrices 52x52, 26x26 y 13x13.  El hecho es que cada elemento de esta matriz no es un n√∫mero, es un vector.  Es decir, la capa de salida es una matriz tridimensional.  Este vector tiene la dimensi√≥n B x (5 + C), donde B es el n√∫mero de cuadro delimitador en la celda, C es el n√∫mero de clases.  ¬øDe d√≥nde viene el n√∫mero 5?  La raz√≥n es esta: para cada cuadro-a, la probabilidad de que haya un objeto (confianza de objeto) se predice es un n√∫mero, y los cuatro restantes son x, y, ancho y alto para el cuadro-a predicho.  La siguiente figura muestra una representaci√≥n esquem√°tica de este vector: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3d/j3/rl/3dj3rlk_te-4x-pthae9mreq7k0.png"></div><br>  <i>Representaci√≥n esquem√°tica de la capa de salida (mapa de caracter√≠sticas).</i> <br><br>  Para nuestra red entrenada en 80 clases, se predice 3 recuadros delimitadores-a para cada celda de la cuadr√≠cula de partici√≥n, para cada uno de ellos: 80 probabilidades de clase + confianza del objeto + 4 n√∫meros responsables de la posici√≥n y el tama√±o de este recuadro-a.  Total: 3 x (5 + 80) = 255. <br><br>  Para obtener estos valores de la clase MLMultiArray, es mejor usar un puntero sin formato a una matriz de datos y aritm√©tica de direcciones: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pointer = <span class="hljs-type"><span class="hljs-type">UnsafeMutablePointer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Double</span></span>&gt;(<span class="hljs-type"><span class="hljs-type">OpaquePointer</span></span>(out.dataPointer)) <span class="hljs-comment"><span class="hljs-comment">//    if out.strides.count &lt; 3 { throw YOLOError.strideOutOfBounds } let channelStride = out.strides[out.strides.count-3].intValue let yStride = out.strides[out.strides.count-2].intValue let xStride = out.strides[out.strides.count-1].intValue func offset(ch: Int, x: Int, y: Int) -&gt; Int { //     return ch * channelStride + y * yStride + x * xStride }</span></span></code> </pre><br>  Ahora necesita procesar un vector de 255 elementos.  Para cada cuadro, necesita obtener una distribuci√≥n de probabilidad para 80 clases, puede hacerlo utilizando la funci√≥n softmax. <br><br><div class="spoiler">  <b class="spoiler_title">¬øQu√© es softmax?</b> <div class="spoiler_text">  La funci√≥n convierte un vector <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-25"><span class="MJXp-mtext" id="MJXp-Span-26">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-33">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.354ex" height="2.074ex" viewBox="0 -772.3 4027.5 892.8" role="img" focusable="false" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6D" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="1128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="1658" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="2019" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-62" x="2596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-62" x="3025" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-78" x="3455" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> \ mathbb x </script>  dimensi√≥n K en un vector de la misma dimensi√≥n, donde cada coordenada <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-34"><span class="MJXp-mtext" id="MJXp-Span-35">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41">b</span><span class="MJXp-msubsup" id="MJXp-Span-42"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-44" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.154ex" height="2.349ex" viewBox="0 -772.3 4371.8 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6D" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="1128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="1658" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="2019" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-62" x="2596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-62" x="3025" y="0"></use><g transform="translate(3455,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-69" x="809" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-3"> \ mathbb x_i </script>  el vector resultante est√° representado por un n√∫mero real en el intervalo [0,1] y la suma de las coordenadas es 1. <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-45"><span class="MJXp-mtext" id="MJXp-Span-46">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-47">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-49">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51">a</span><span class="MJXp-mo" id="MJXp-Span-52" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-53">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-55">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-56">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">b</span><span class="MJXp-mrow" id="MJXp-Span-60"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61">x</span></span><span class="MJXp-msubsup" id="MJXp-Span-62"><span class="MJXp-mo" id="MJXp-Span-63" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-64" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-65" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-66">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-67">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-69">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70">c</span><span class="MJXp-mrow" id="MJXp-Span-71"><span class="MJXp-msubsup" id="MJXp-Span-72"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-73" style="margin-right: 0.05em;">e</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-74" style="vertical-align: 0.5em;"><span class="MJXp-msubsup" id="MJXp-Span-75"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-76" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-77" style="vertical-align: -0.4em;">i</span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-78"><span class="MJXp-mtext" id="MJXp-Span-79">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-80">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81">u</span><span class="MJXp-msubsup" id="MJXp-Span-82"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-83" style="margin-right: 0.05em;">m</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-88"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-89">K</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mrow" id="MJXp-Span-84"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-85">k</span><span class="MJXp-mo" id="MJXp-Span-86">=</span><span class="MJXp-mn" id="MJXp-Span-87">1</span></span></span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-90"><span class="MJXp-msubsup" id="MJXp-Span-91"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-92" style="margin-right: 0.05em;">e</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-93" style="vertical-align: 0.5em;"><span class="MJXp-msubsup" id="MJXp-Span-94"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-95" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-96" style="vertical-align: -0.4em;">k</span></span></span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="41.144ex" height="3.037ex" viewBox="0 -890.8 17714.6 1307.5" role="img" focusable="false" style="vertical-align: -0.968ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-69" x="719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-67" x="1065" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6D" x="1545" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="2424" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-28" x="2953" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6D" x="3593" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="4471" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="5001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="5362" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-62" x="5939" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-62" x="6368" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-78" x="6798" y="0"></use><g transform="translate(7370,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-69" x="550" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-3D" x="8382" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-66" x="9688" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-72" x="10238" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="10690" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-63" x="11219" y="0"></use><g transform="translate(11653,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-65" x="0" y="0"></use><g transform="translate(466,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-69" x="809" y="-213"></use></g></g><g transform="translate(12868,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-75" x="719" y="0"></use><g transform="translate(1292,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-4B" x="1242" y="488"></use><g transform="translate(878,-327)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-3D" x="521" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-31" x="1300" y="0"></use></g></g><g transform="translate(3543,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-65" x="0" y="0"></use><g transform="translate(466,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6B" x="809" y="-213"></use></g></g></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-4"> \ sigma (\ mathbb {x}) _ i = \ frac {e ^ {x_i}} {\ sum_ {k = 1} ^ {K} {e ^ {x_k}}} </script></p>  donde K es la dimensi√≥n del vector. <br></div></div><br>  Funci√≥n Softmax en Swift: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">softmax</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> [Float])</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> len = vDSP_Length(x.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> = <span class="hljs-type"><span class="hljs-type">Int32</span></span>(x.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) vvexpf(&amp;x, x, &amp;<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sum: <span class="hljs-type"><span class="hljs-type">Float</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> vDSP_sve(x, <span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;sum, len) vDSP_vsdiv(x, <span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;sum, &amp;x, <span class="hljs-number"><span class="hljs-number">1</span></span>, len) }</code> </pre><br>  Para obtener las coordenadas y los tama√±os del cuadro delimitador-a, debe usar las f√≥rmulas: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-97"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98">x</span><span class="MJXp-mo" id="MJXp-Span-99" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-100">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-101">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-102">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-103">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-105">a</span><span class="MJXp-mo" id="MJXp-Span-106" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-107">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-108">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-110">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">x</span><span class="MJXp-mo" id="MJXp-Span-112" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-113" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-114"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-116" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-mspace" id="MJXp-Span-117" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">y</span><span class="MJXp-mo" id="MJXp-Span-119" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-120">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-124">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">a</span><span class="MJXp-mo" id="MJXp-Span-126" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-127">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">y</span><span class="MJXp-mo" id="MJXp-Span-132" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-133" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-134"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135" style="margin-right: 0.05em;">c</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-136" style="vertical-align: -0.4em;">y</span></span><span class="MJXp-mspace" id="MJXp-Span-137" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-138">w</span><span class="MJXp-mo" id="MJXp-Span-139" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-140"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-142" style="vertical-align: -0.4em;">w</span></span><span class="MJXp-msubsup" id="MJXp-Span-143"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-144" style="margin-right: 0.05em;">e</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-145" style="vertical-align: 0.5em;"><span class="MJXp-mtext" id="MJXp-Span-146">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-148">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-149">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150">w</span></span></span><span class="MJXp-mspace" id="MJXp-Span-151" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-152">h</span><span class="MJXp-mo" id="MJXp-Span-153" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-154"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-156" style="vertical-align: -0.4em;">h</span></span><span class="MJXp-msubsup" id="MJXp-Span-157"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158" style="margin-right: 0.05em;">e</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-159" style="vertical-align: 0.5em;"><span class="MJXp-mtext" id="MJXp-Span-160">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-163">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164">h</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="76.867ex" height="13.262ex" viewBox="0 -832 33095.6 5710.1" role="img" focusable="false" style="vertical-align: -11.33ex; max-width: 638px;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(11502,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-3D" x="850" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-73" x="2156" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-69" x="2626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-67" x="2971" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6D" x="3452" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="4330" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-28" x="4860" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="5499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="6076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="6605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-78" x="6967" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-29" x="7539" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-2B" x="8151" y="0"></use><g transform="translate(9152,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-78" x="613" y="-213"></use></g></g><g transform="translate(11604,-1433)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-79" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-3D" x="775" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-73" x="2081" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-69" x="2551" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-67" x="2896" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6D" x="3377" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="4255" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-28" x="4785" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="5424" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="6001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="6530" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-79" x="6892" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-29" x="7389" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-2B" x="8001" y="0"></use><g transform="translate(9002,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-79" x="613" y="-213"></use></g></g><g transform="translate(13787,-3064)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-77" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-3D" x="994" y="0"></use><g transform="translate(2050,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-77" x="712" y="-213"></use></g><g transform="translate(3160,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-65" x="0" y="0"></use><g transform="translate(466,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="930" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-77" x="1821" y="0"></use></g></g></g><g transform="translate(13956,-4593)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-3D" x="854" y="0"></use><g transform="translate(1910,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="712" y="-213"></use></g><g transform="translate(2921,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-65" x="0" y="0"></use><g transform="translate(466,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="930" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="1821" y="0"></use></g></g></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-5"> x = \ sigma (\ hat x) + c_x \\ y = \ sigma (\ hat y) + c_y \\ w = p_we ^ {\ hat w} \\ h = p_he ^ {\ hat h} </script></p><br>  donde <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-165"><span class="MJXp-mtext" id="MJXp-Span-166">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-167">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-168">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-169">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-170">x</span><span class="MJXp-mo" id="MJXp-Span-171" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-172">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-175">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176">y</span><span class="MJXp-mo" id="MJXp-Span-177" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-178">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-179">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-181">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">w</span><span class="MJXp-mo" id="MJXp-Span-183" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-184">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-186">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-187">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-188">h</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="24.546ex" height="2.419ex" viewBox="0 -780.1 10568.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="826" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="1356" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-78" x="1717" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-2C" x="2290" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="2985" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="3561" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="4091" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-79" x="4452" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-2C" x="4950" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="5645" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="6221" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="6751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-77" x="7112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-2C" x="7829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="8524" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="9101" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="9630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="9992" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> \ hat x, \ hat y, \ hat w, \ hat h </script>  - coordenadas pronosticadas x, y, ancho y alto, respectivamente, <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-189"><span class="MJXp-mtext" id="MJXp-Span-190">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-191">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-192">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-193">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-194">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195">a</span><span class="MJXp-mo" id="MJXp-Span-196" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-197">x</span><span class="MJXp-mo" id="MJXp-Span-198" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.999ex" height="2.66ex" viewBox="0 -832 4305 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-69" x="719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-67" x="1065" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6D" x="1545" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="2424" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-28" x="2953" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-78" x="3343" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-29" x="3915" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-7"> \ sigma (x) </script>  Es la funci√≥n sigmoidea y <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-199"><span class="MJXp-msubsup" id="MJXp-Span-200"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-201" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-202" style="vertical-align: -0.4em;">w</span></span><span class="MJXp-mo" id="MJXp-Span-203" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-204"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-206" style="vertical-align: -0.4em;">h</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.05ex" height="1.817ex" viewBox="-38.5 -520.7 2605 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-77" x="712" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-2C" x="1110" y="0"></use><g transform="translate(1555,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-68" x="712" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-8"> p_w, p_h </script>  - valores de anclajes (anclajes) para tres cajas.  Estos valores se determinan durante el entrenamiento y se establecen en el archivo Helpers.swift: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> anchors1: [<span class="hljs-type"><span class="hljs-type">Float</span></span>] = [<span class="hljs-number"><span class="hljs-number">116</span></span>,<span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">156</span></span>,<span class="hljs-number"><span class="hljs-number">198</span></span>, <span class="hljs-number"><span class="hljs-number">373</span></span>,<span class="hljs-number"><span class="hljs-number">326</span></span>] <span class="hljs-comment"><span class="hljs-comment">//     let anchors2: [Float] = [30,61, 62,45, 59,119] //     let anchors3: [Float] = [10,13, 16,30, 33,23] //    </span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ng/zf/pv/ngzfpvvch8bhnkdapz6url5ok-w.png"></div><br>  <i>Representaci√≥n esquem√°tica del c√°lculo de la posici√≥n de un cuadro delimitador.</i> <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo completo para procesar capas de salida.</b> <div class="spoiler_text"><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(output out: MLMultiArray, name: String)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; [<span class="hljs-type"><span class="hljs-type">Prediction</span></span>] { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> predictions = [<span class="hljs-type"><span class="hljs-type">Prediction</span></span>]() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> grid = out.shape[out.shape.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>].intValue <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gridSize = <span class="hljs-type"><span class="hljs-type">YOLO</span></span>.inputSize / <span class="hljs-type"><span class="hljs-type">Float</span></span>(grid) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> classesCount = labels.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(out.shape) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pointer = <span class="hljs-type"><span class="hljs-type">UnsafeMutablePointer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Double</span></span>&gt;(<span class="hljs-type"><span class="hljs-type">OpaquePointer</span></span>(out.dataPointer)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> &lt; <span class="hljs-number"><span class="hljs-number">3</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">YOLOError</span></span>.strideOutOfBounds } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> channelStride = out.strides[out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">3</span></span>].intValue <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> yStride = out.strides[out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">2</span></span>].intValue <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> xStride = out.strides[out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>].intValue <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ch: Int, x: Int, y: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ch * channelStride + y * yStride + x * xStride } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; grid { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; grid { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> box_i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; <span class="hljs-type"><span class="hljs-type">YOLO</span></span>.boxesPerCell { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> boxOffset = box_i * (classesCount + <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bbx = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bby = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">1</span></span>, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bbw = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">2</span></span>, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bbh = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">3</span></span>, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> confidence = sigmoid(<span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">4</span></span>, x: x, y: y)])) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> confidence &lt; confidenceThreshold { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> x_pos = (sigmoid(bbx) + <span class="hljs-type"><span class="hljs-type">Float</span></span>(x)) * gridSize <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> y_pos = (sigmoid(bby) + <span class="hljs-type"><span class="hljs-type">Float</span></span>(y)) * gridSize <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> width = exp(bbw) * <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors[name]![<span class="hljs-number"><span class="hljs-number">2</span></span> * box_i] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> height = exp(bbh) * <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors[name]![<span class="hljs-number"><span class="hljs-number">2</span></span> * box_i + <span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; <span class="hljs-number"><span class="hljs-number">80</span></span> { classes[<span class="hljs-built_in"><span class="hljs-built_in">c</span></span>] = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>, x: x, y: y)]) } softmax(&amp;classes) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (detectedClass, bestClassScore) = argmax(classes) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> confidenceInClass = bestClassScore * confidence <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> confidenceInClass &lt; confidenceThreshold { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> } predictions.append(<span class="hljs-type"><span class="hljs-type">Prediction</span></span>(classIndex: detectedClass, score: confidenceInClass, rect: <span class="hljs-type"><span class="hljs-type">CGRect</span></span>(x: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(x_pos - width / <span class="hljs-number"><span class="hljs-number">2</span></span>), y: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(y_pos - height / <span class="hljs-number"><span class="hljs-number">2</span></span>), width: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(width), height: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(height)))) } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> predictions }</code> </pre><br></div></div><br>  <b>Supresi√≥n no m√°xima</b> <br><br>  Una vez que haya recibido las coordenadas y los tama√±os de los cuadros delimitadores y las probabilidades correspondientes para todos los objetos encontrados en la imagen, puede comenzar a dibujarlos en la parte superior de la imagen.  ¬°Pero hay un problema!  Tal situaci√≥n puede surgir cuando se predicen varias cajas con probabilidades bastante altas para un objeto.  ¬øQu√© hacer en este caso?  Aqu√≠ un algoritmo bastante simple llamado supresi√≥n no m√°xima viene en nuestra ayuda. <br><br>  El algoritmo es el siguiente: <br><br><ol><li>  Estamos buscando un cuadro delimitador con la mayor probabilidad de pertenecer al objeto. </li><li>  Revisamos todos los cuadros delimitadores que tambi√©n pertenecen a este objeto. </li><li>  Los eliminamos si Intersection over Union (IoU) con el primer cuadro delimitador es mayor que el umbral especificado. </li></ol><br>  IoU se calcula usando una f√≥rmula simple: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-207"><span class="MJXp-mtext" id="MJXp-Span-208">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-209">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-210">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-211">x</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212">t</span><span class="MJXp-mrow" id="MJXp-Span-213"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-215">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-216">U</span></span><span class="MJXp-mo" id="MJXp-Span-217" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-218">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-221">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-222">c</span><span class="MJXp-mrow" id="MJXp-Span-223"><span class="MJXp-mtext" id="MJXp-Span-224">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-225">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-227">x</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228">t</span><span class="MJXp-mrow" id="MJXp-Span-229"><span class="MJXp-mrow" id="MJXp-Span-230"><span class="MJXp-mo" id="MJXp-Span-231" style="margin-left: 0em; margin-right: 0em;">√Å</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-232">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-234">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-236">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-237">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-238">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-239">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-240">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-243">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-244">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-245">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-246">i</span><span class="MJXp-mrow" id="MJXp-Span-247"><span class="MJXp-mo" id="MJXp-Span-248" style="margin-left: 0em; margin-right: 0em;">√≥</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-249">n</span></span></span><span class="MJXp-mrow" id="MJXp-Span-250"><span class="MJXp-mtext" id="MJXp-Span-251">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-252">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-253">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-254">x</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-255">t</span><span class="MJXp-mrow" id="MJXp-Span-256"><span class="MJXp-mrow" id="MJXp-Span-257"><span class="MJXp-mo" id="MJXp-Span-258" style="margin-left: 0em; margin-right: 0em;">√Å</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-259">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-261">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-262">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-263">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-264">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-265">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-266">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-268">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-269">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-271">i</span><span class="MJXp-mrow" id="MJXp-Span-272"><span class="MJXp-mo" id="MJXp-Span-273" style="margin-left: 0em; margin-right: 0em;">√≥</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-274">n</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="63.972ex" height="2.539ex" viewBox="0 -832 27543.3 1093.4" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-65" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-78" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="1650" y="0"></use><g transform="translate(2012,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-49" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6F" x="504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-55" x="990" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMAIN-3D" x="4047" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-66" x="5353" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-72" x="5904" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="6355" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-63" x="6885" y="0"></use><g transform="translate(7318,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-65" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-78" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="1650" y="0"></use><g transform="translate(2012,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">√Å</text><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-72" x="674" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-65" x="1125" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="1592" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-64" x="2121" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-65" x="2645" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-69" x="3111" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6E" x="3457" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="4057" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-65" x="4419" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-72" x="4885" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-73" x="5337" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-65" x="5806" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-63" x="6273" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-63" x="6706" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-69" x="7140" y="0"></use><g transform="translate(7485,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">√≥</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6E" x="7900" y="0"></use></g></g><g transform="translate(17831,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-65" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-78" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-74" x="1650" y="0"></use><g transform="translate(2012,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">√Å</text><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-72" x="674" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-65" x="1125" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="1592" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-64" x="2121" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-65" x="2645" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="3111" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-73" x="3641" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6F" x="4110" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-63" x="4596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-69" x="5029" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-61" x="5375" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-63" x="5904" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-69" x="6338" y="0"></use><g transform="translate(6683,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">√≥</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhuBm2yzhkvjEBuYEYAK_GCJoYUSQ#MJMATHI-6E" x="7098" y="0"></use></g></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-9"> \ text {IoU} = \ frac {\ text {√Årea de intersecci√≥n}} {\ text {√Årea de asociaci√≥n}} </script></p><div class="spoiler">  <b class="spoiler_title">C√°lculo de IoU.</b> <div class="spoiler_text"><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IOU</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a: CGRect, b: CGRect)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Float</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> areaA = a.width * a.height <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> areaA &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> areaB = b.width * b.height <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> areaB &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> intersection = a.intersection(b) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> intersectionArea = intersection.width * intersection.height <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Float</span></span>(intersectionArea / (areaA + areaB - intersectionArea)) }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Supresi√≥n no m√°xima.</b> <div class="spoiler_text"><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nonMaxSuppression</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(boxes: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> [Prediction], threshold: Float)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> i &lt; boxes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = i + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> j &lt; boxes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> iou = <span class="hljs-type"><span class="hljs-type">YOLO</span></span>.<span class="hljs-type"><span class="hljs-type">IOU</span></span>(a: boxes[i].rect, b: boxes[j].rect) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> iou &gt; threshold { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> boxes[i].score &gt; boxes[j].score { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> boxes[i].classIndex == boxes[j].classIndex { boxes.remove(at: j) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { j += <span class="hljs-number"><span class="hljs-number">1</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> boxes[i].classIndex == boxes[j].classIndex { boxes.remove(at: i) j = i + <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { j += <span class="hljs-number"><span class="hljs-number">1</span></span> } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { j += <span class="hljs-number"><span class="hljs-number">1</span></span> } } i += <span class="hljs-number"><span class="hljs-number">1</span></span> } }</code> </pre><br></div></div><br>  Despu√©s de eso, trabajar directamente con los resultados de la predicci√≥n de la red neuronal puede considerarse completo.  A continuaci√≥n, debe escribir funciones y clases para obtener el metraje de la c√°mara, mostrar la imagen en la pantalla y representar los cuadros delimitadores predichos.  No describir√© todo este c√≥digo en este art√≠culo, pero se puede ver en el repositorio. <br><br>  Tambi√©n vale la pena mencionar que agregu√© un poco de suavizado de los cuadros delimitadores al procesar im√°genes en l√≠nea, en este caso es el promedio habitual de la posici√≥n y el tama√±o del cuadrado predicho en los √∫ltimos 30 cuadros. <br><br><h4>  Probar el programa </h4><br>  Ahora probamos la aplicaci√≥n. <br><br>  Perm√≠tame recordarle una vez m√°s: hay tres ViewControllers en la aplicaci√≥n, uno para procesar fotos o instant√°neas, uno para procesar una transmisi√≥n de video en l√≠nea y un tercero para configurar la red. <br><br>  Comencemos con el tercero.  En √©l puede elegir uno de los dos modelos YOLOv3-tiny o YOLOv3-416, elegir el umbral de confianza y el umbral de IoU, tambi√©n puede habilitar o deshabilitar el suavizado en l√≠nea. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sb/zq/tz/sbzqtzy6hai51objkormfzvtbuq.jpeg"></div><br>  Ahora veamos c√≥mo funciona la neurona entrenada con im√°genes reales, para esto tomamos una foto de la galer√≠a y la pasamos a trav√©s de la red.  La siguiente imagen muestra los resultados de YOLOv3-tiny con diferentes configuraciones. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nr/j3/fj/nrj3fjpw0yvxgl2cigujbcb-1p4.png"></div><br>  <i>Diferentes modos de funcionamiento de YOLOv3-tiny.</i>  <i>La imagen de la izquierda muestra el modo de operaci√≥n habitual.</i>  <i>En el medio: el umbral IoU = 1, es decir</i>  <i>como si faltara la supresi√≥n no m√°xima.</i>  <i>A la derecha hay un umbral bajo de confianza del objeto, es decir</i>  <i>Se muestran todos los cuadros delimitadores posibles.</i> <br><br>  El siguiente es el resultado de YOLOv3-416.  Puede notar que, en comparaci√≥n con YOLOv3-tiny, los marcos resultantes son m√°s correctos, as√≠ como tambi√©n se reconocen los objetos m√°s peque√±os en la imagen, lo que corresponde al trabajo de la tercera capa de salida. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wc/nj/xq/wcnjxqeygnuriffqpatmtvevyfo.png"></div><br>  <i>Imagen procesada con YOLOv3-416.</i> <br><br>  Cuando se activ√≥ el modo de operaci√≥n en l√≠nea, se proces√≥ cada fotograma y se realiz√≥ una predicci√≥n, se realizaron <b>pruebas en el iPhone XS,</b> por lo que el resultado fue bastante aceptable para ambas opciones de red.  <b>YOLOv3-tiny produce un promedio de 30 - 32 fps, YOLOv3-416 - de 23 a 25 fps.</b>  El dispositivo en el que se prob√≥ es bastante productivo, por lo que en modelos anteriores los resultados pueden diferir, en cuyo caso, por supuesto, es preferible usar YOLOv3-tiny.  Otro punto importante: yolo-tiny.mlmodel (YOLOv3-tiny) ocupa unos 35 MB, mientras que yolo.mlmodel (YOLOv3 -16) pesa unos 250 MB, lo que es una diferencia muy significativa. <br><br><h2>  Conclusi√≥n </h2><br>  Como resultado, se escribi√≥ una aplicaci√≥n para iOS que con la ayuda de una red neuronal puede reconocer objetos en la imagen.  Vimos c√≥mo trabajar con la biblioteca CoreML y c√≥mo usarla para ejecutar varios modelos previamente entrenados (por cierto, tambi√©n puedes entrenar con ella).  El problema de reconocimiento de objetos se resolvi√≥ utilizando la red YOLOv3.  En el iPhone XS, esta red (YOLOv3-tiny) es capaz de procesar im√°genes a una frecuencia de ~ 30 cuadros por segundo, lo cual es suficiente para la operaci√≥n en tiempo real. <br><br>  El c√≥digo completo de la aplicaci√≥n se puede ver en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/460869/">https://habr.com/ru/post/460869/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460859/index.html">IThink # 3 conferencia en Jarkov - basada en WWDC 2019</a></li>
<li><a href="../460861/index.html">Alcance y cierre l√©xico de JavaScript</a></li>
<li><a href="../460863/index.html">Detalles del accidente de Cloudflare 2 de julio de 2019</a></li>
<li><a href="../460865/index.html">La gente en la luna. Fuentes</a></li>
<li><a href="../460867/index.html">Sourcery para convertir autom√°ticamente a estructuras de objetos Realm</a></li>
<li><a href="../460873/index.html">Por qu√© Turok: Dinosaur Hunter para N64 est√° a√±os adelantado a su tiempo</a></li>
<li><a href="../460875/index.html">C√≥mo en QIWI llegamos a un estilo com√∫n de interacci√≥n entre View y ViewModel dentro de MVVM</a></li>
<li><a href="../460877/index.html">Kubernetes-adventure Dailymotion: construcci√≥n de infraestructura en las nubes + local</a></li>
<li><a href="../460879/index.html">DUMP Kazan 2019 - Conferencia de Desarrolladores de Tatarst√°n. Aceptamos solicitudes de informes.</a></li>
<li><a href="../460881/index.html">Dificultades para aplicar tecnolog√≠as OCR en sistemas DLP, o c√≥mo preparamos OCR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>