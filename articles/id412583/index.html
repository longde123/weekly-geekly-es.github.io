<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìï üåà ‚ôéÔ∏è Kami membongkar protokol ketel Redmond G200S dan menghubungkannya ke HomeAssistant üçÇ üöó üë®üèø‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Entri 
 Sudah ada artikel tentang Gicktime yang ditujukan untuk mengurai protokol ketel Redmond SkyKettle. Namun, di sana mereka berbicara tentang mod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kami membongkar protokol ketel Redmond G200S dan menghubungkannya ke HomeAssistant</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412583/"><h3>  Entri </h3><br>  Sudah ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> tentang Gicktime yang ditujukan untuk mengurai protokol ketel Redmond SkyKettle.  Namun, di sana mereka berbicara tentang model RK-M171S, di sini kita akan berbicara tentang G200S yang lebih fungsional.  Dalam model ini, protokol interaksi telah berubah, karena itu pendekatan penulis artikel sebelumnya tidak lagi berfungsi, dan fungsi tambahan lampu malam dan indikasi suhu saat ini dalam warna telah muncul. <br><br>  Pada artikel ini, saya akan mempresentasikan hasil analisis protokol dengan contoh kode python (jika ada yang ingin mengembangkan modul / aplikasi mereka untuk mengendalikan teko teh).  Juga di akhir artikel adalah tautan ke modul yang sudah jadi untuk menghubungkan teko ke HomeAssistant (ini adalah pengalaman pertama saya dalam menulis dengan python setelah mengambil kursus online, sehingga modul ini dapat dan bahkan perlu ditingkatkan). <br><br>  Semua orang yang tertarik, selamat datang di kucing. <br><a name="habracut"></a><br><h3>  Masalah dan Tugas </h3><br>  Teko ini memiliki satu minus besar (kecuali yang ditunjukkan oleh penulis artikel pertama): segera setelah teko dihapus dari dudukan, waktu saat ini diatur ulang dan, akibatnya, jadwal tidak dapat digunakan untuk merebus teko.  Menurut ide-ide penulis penciptaan ini, setiap kali setelah mengembalikan ketel ke dudukan, Anda harus meluncurkan aplikasi miliknya dan menyinkronkan ketel dengan smartphone.  Jadi alih-alih memfasilitasi tugas rutin, teknologi "pintar" melatih kita untuk melakukan tindakan tambahan.  Tapi itu semua berubah ketika HomeAssistant muncul di rumah.  Kemudian saya memutuskan untuk memahami protokolnya. <br><br><h3>  Alat-alatnya </h3><br>  Jujur saya mencoba mendekompilasi dan mengurai aplikasi asli, tetapi gagal.  Alat yang saya gunakan tidak memungkinkan saya untuk memahami logika ketel.  Semua prosedur dan fungsi diperoleh dengan "kurva", tanpa nama (berdasarkan tipe a, b, c, dll.).  Mungkin saya tidak memiliki pengalaman dan keterampilan yang cukup.  Pada akhirnya, saya pergi dengan cara yang sama seperti penulis artikel sebelumnya.  Satu-satunya perbedaan yang signifikan adalah saya menggunakan mode interaktif utilitas gatttool.  Keuntungannya adalah mode ini menghilangkan semua jenis "ras", yang ditulis oleh penulis artikel pertama. <br><br>  Karena HomeAssistant ditulis dengan python, kami akan menulis semua perintah lebih lanjut.  Untuk menggunakan mode operasi gatttool interaktif dalam python, pexpect library akan membantu kami, yang memungkinkan Anda untuk menelurkan esensi dari aplikasi pihak ketiga dan memantau hasilnya (terkenal bengkok). <br><br><h3>  Berlatih </h3><br>  Saya akan kembali mengirim artikel pertama tentang deskripsi umum protokol pertukaran kepada penulis artikel, jadi tanpa basa-basi lagi, kami akan melanjutkan ke perintah kontrol. <br><br><ol><li>  <b>Instalasi dan pemutusan</b> <br><br>  Membangun koneksi: <br><br><pre><code class="python hljs">child = pexpect.spawn(<span class="hljs-string"><span class="hljs-string">"gatttool -I -t random -b "</span></span> + mac, ignore_sighup=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>, timeout=<span class="hljs-number"><span class="hljs-number">3</span></span>) child.sendline(<span class="hljs-string"><span class="hljs-string">"connect"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'Connection successful.*\[LE\]&gt;'</span></span>, timeout=<span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre> <br>  Di sini mac adalah alamat poppy dari poci teh. <br><br>  Kami memutuskan koneksi: <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"exit"</span></span>)</code> </pre> </li><li>  <b>Berlangganan Notifikasi</b> <br><br>  Setelah membuat koneksi, pertama-tama, kita perlu berlangganan untuk menerima notifikasi dari ketel.  Tanpa ini, teko akan memahami perintah, tetapi tidak akan dapat menjawab apa pun kecuali teks "Berhasil". <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-cmd 0x000c 0100"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> </li><li>  <b>Login</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"ff"</span></span> + key + <span class="hljs-string"><span class="hljs-string">"aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) connectedStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = connectedStr.split()[<span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-comment"><span class="hljs-comment"># parse: 00 - no 01 - yes child.expect(r'\[LE\]&gt;')</span></span></code> </pre> <br>  Selanjutnya, iter adalah variabel hex integer iteratif dari 0 hingga 64 (dari 0 hingga 100 dalam sistem desimal).  Setelah setiap perintah (berhasil dan tidak berhasil), variabel ini harus ditingkatkan sebesar 1; ketika mencapai 64, kembali diatur ke 0;  key - hex 8 bytes kunci otorisasi (misalnya: ffffffffffffffff). <br><br>  Contoh jawaban: <br><blockquote>  nilai: 55 00 ff 01 aa </blockquote>  Byte keempat (01) berarti ketel telah mengizinkan Anda, jika tidak maka jawabannya adalah 00. <br></li><li>  <b>Beberapa sihir jalanan</b> <br>  Setelah otorisasi, permintaan "ajaib" selalu dikirimkan, yang intinya tidak jelas bagi saya.  Ada teori yang diperlukan untuk "menahan" keadaan yang terhubung.  Diduga, jika Anda tidak mengirimkannya, maka pemutusan terjadi dalam satu detik, dan Anda harus memulai dari awal lagi.  Jika Anda mengirimnya, maka batas waktu meningkat secara signifikan, mencapai sekitar selusin detik.  Andal mengkonfirmasi ini, saya tidak bisa. <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"01aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Contoh jawaban: <br><blockquote>  nilai: 55 01 01 02 1d aa </blockquote><br>  Dalam semua percobaan saya, jawabannya selalu seperti ini. <br><br>  <b>UPD:</b> dalam komentar mereka menyarankan bahwa itu sama sekali bukan sihir, tetapi hanya meminta versi perangkat lunak, sehingga versi ini terkandung dalam respons.  Dengan demikian, permintaan ini secara umum dapat dihapus sebagai tidak perlu. <br></li><li>  <b>Sinkronkan</b> <br>  Perintah yang menyinkronkan waktu dalam teko dengan jam server.  Dia memiliki satu efek lagi.  Dalam ketel, dimungkinkan untuk menunjukkan suhu saat ini dalam mode siaga dengan mem-flash LED warna tertentu.  Fungsi ini hanya berfungsi setelah sinkronisasi.  Untuk deskripsi fungsi itu sendiri, lihat paragraf 11. <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"6e"</span></span> + timeNow + tmz + <span class="hljs-string"><span class="hljs-string">"0000aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Di sini tmz adalah zona waktu dalam format hex terbalik (misalnya, menerjemahkan zona waktu +3 ke dalam detik, kemudian ke dalam format hex dan dapatkan hex (3 * 60 * 60) = 2a30, dibagi berpasangan dan output 302a dalam urutan terbalik).  Saya tidak tahu apa yang harus dilakukan dengan zona waktu negatif, saya belum mengujinya, tetapi ada kecurigaan bahwa byte tmz berikutnya bertanggung jawab untuk ini.  Di sini timeNow adalah waktu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">unixtime</a> saat ini dalam format hex terbalik.  Algoritmanya sama: kita mendapatkan waktu saat ini dalam detik, menerjemahkannya ke HEX, membaginya menjadi berpasangan dan mengeluarkannya dalam satu baris dalam urutan terbalik. <br><br>  Contoh jawaban: <br><blockquote>  nilai: 55 02 6e 00 aa </blockquote>  Dalam semua percobaan saya, jawabannya selalu seperti ini. <br></li><li>  <b>Statistik</b> <br>  Ketel memiliki meteran listrik yang dikonsumsi, total waktu operasi dan jumlah start.  Jika seseorang tidak membutuhkan data ini, Anda dapat melewati item ini dengan aman. <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"4700aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) Watts = hexToDec(str(statusStr.split()[<span class="hljs-number"><span class="hljs-number">11</span></span>] + statusStr.split()[<span class="hljs-number"><span class="hljs-number">10</span></span>] + statusStr.split()[<span class="hljs-number"><span class="hljs-number">9</span></span>])) alltime = round(self._Watts/<span class="hljs-number"><span class="hljs-number">2200</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>) child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"5000aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) times = hexToDec(str(statusStr.split()[<span class="hljs-number"><span class="hljs-number">7</span></span>] + statusStr.split()[<span class="hljs-number"><span class="hljs-number">6</span></span>])) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Watt - mengembalikan energi yang dikonsumsi dalam Wh * h, alltime - jam kerja ketel, kali - jumlah awal ketel.  hexToDec - fungsi untuk mengkonversi ke format desimal. <br></li><li>  <b>Baca mode operasi saat ini</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"06aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = statusStr.split() status = str(answer[<span class="hljs-number"><span class="hljs-number">11</span></span>]) temp = hexToDec(str(answer[<span class="hljs-number"><span class="hljs-number">8</span></span>])) mode = str(answer[<span class="hljs-number"><span class="hljs-number">3</span></span>])</code> </pre> <br>  Contoh jawaban: <br><blockquote>  nilai: 55 04 06 00 00 00 00 01 2a 1e 00 00 00 00 00 00 00 80 00 00 aa </blockquote>  Bita keempat adalah mode operasi (mode): 00 - pendidihan, 01 - pemanasan hingga suhu, 03 - malam hari.  Byte keenam adalah suhu heksadesimal yang perlu dipanaskan dalam mode pemanasan, dalam mode didih adalah 00. Byte kesembilan adalah suhu arus hex dari air (2a = 42 Celcius).  Byte kedua belas adalah keadaan teko: 00 - off, 02 - on.  Byte ketujuh belas adalah durasi ketel setelah mencapai suhu yang diinginkan, secara default adalah 80 dalam hex (tampaknya, ini adalah semacam unit relatif, tentu bukan detik). <br></li><li>  <b>Rekam mode operasi saat ini</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"05"</span></span> + mode + <span class="hljs-string"><span class="hljs-string">"00"</span></span> + temp + <span class="hljs-string"><span class="hljs-string">"00000000000000000000"</span></span> + howMuchBoil + <span class="hljs-string"><span class="hljs-string">"0000aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = statusStr.split()[<span class="hljs-number"><span class="hljs-number">3</span></span>] child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Mode parameter: 00 - pendidihan, 01 - pemanasan hingga suhu, 03 - malam hari.  Parameter temp adalah suhu heksadesimal yang perlu dipanaskan dalam mode ‚Äúpemanasan‚Äù, dalam mode didih adalah 00. Parameter howMuchBoil adalah durasi ketel setelah mencapai suhu yang diinginkan, standarnya adalah 80 heksadesimal (tampaknya, ini adalah beberapa unit relatif , tentu saja bukan detik). <br><br>  Contoh jawaban: <br><blockquote>  nilai: 55 05 05 01 aa </blockquote>  Byte keempat dari respons menunjukkan keberhasilan pengaturan: 01 - berhasil, 00 - tidak berhasil. <br></li><li>  <b>Jalankan mode operasi saat ini</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"03aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = self.child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = statusStr.split()[<span class="hljs-number"><span class="hljs-number">3</span></span>] child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Contoh jawaban: <br><blockquote>  nilai: 55 06 03 01 aa </blockquote>  Byte keempat dari respons menunjukkan keberhasilan inklusi: 01 - berhasil, 00 - tidak berhasil. <br></li><li>  <b>Hentikan mode operasi saat ini</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"04aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = self.child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) answer = statusStr.split()[<span class="hljs-number"><span class="hljs-number">3</span></span>] child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Contoh jawaban: <br><blockquote>  nilai: 55 07 04 01 aa </blockquote>  Byte keempat dari respons menunjukkan keberhasilan shutdown: 01 - berhasil, 00 - tidak berhasil. <br></li><li>  <b>Tampilkan suhu saat ini dalam warna dalam kondisi idle</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"37c8c8"</span></span> + onoff + <span class="hljs-string"><span class="hljs-string">"aa"</span></span>) <span class="hljs-comment"><span class="hljs-comment"># 00 - off, 01 - on child.expect("value: ") child.expect("\r\n") child.expect(r'\[LE\]&gt;')</span></span></code> </pre> <br>  Parameter onoff adalah 01 untuk mengaktifkan fungsi, atau 00 untuk menonaktifkan fungsi. <br><br>  Contoh jawaban: <br><blockquote>  nilai: 55 08 37 00 aa </blockquote>  Dalam semua percobaan saya, jawabannya selalu seperti ini. <br></li><li>  <b>Rekam palet warna dari berbagai mode operasi</b> <br>  Palet korespondensi antara warna LED dan suhu diatur dalam mode tampilan suhu saat ini dan mode pemanasan dan pendidihan, serta palet warna dalam mode lampu malam. <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"32"</span></span> + boilOrLight + scale_from + rand + rgb1 + scale_mid + rand + rgb_mid + scale_to + rand + rgb2 + <span class="hljs-string"><span class="hljs-string">"aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Parameter boilOrLight adalah 00 jika kita mengatur mode tampilan suhu saat ini atau 01 jika kita mengatur mode malam.  Parameter scale_from menunjukkan awal rentang perubahan warna dan sama dengan 00 dalam mode lampu malam dan 28 dalam mode tampilan suhu saat ini (28 adalah 40 dalam format desimal dan dari suhu ini perubahan warna yang halus akan dimulai).  Parameter scale_mid adalah tengah kisaran dan 32 dalam mode lampu malam dan 46 dalam mode tampilan suhu saat ini.  Parameter scale_to menunjukkan akhir rentang warna dan 64 dalam kedua mode.  Parameter rgb1 adalah warna hex dari awal palet.  Parameter rgb_mid adalah warna hex tengah palet (saya menghitungnya sebagai tengah antara ujung kiri dan kanan, tetapi secara teoritis Anda dapat menentukan warna apa pun, ini hanya akan mempengaruhi kecantikan dan kehalusan perubahan warna).  Parameter rgb2 adalah warna hex dari ujung palet.  Parameter rand adalah parameter tertentu, nilai yang saya tidak mengerti persis, mungkin entah bagaimana terkait dengan kecerahan warna (contoh nilai: e5, cc). <br><br>  Contoh jawaban: <br><blockquote>  nilai: 55 09 32 00 aa </blockquote>  Dalam semua percobaan saya, jawabannya selalu seperti ini. <br></li><li>  <b>Baca palet warna dari berbagai mode operasi</b> <br><br><pre> <code class="python hljs">child.sendline(<span class="hljs-string"><span class="hljs-string">"char-write-req 0x000e 55"</span></span> + iter + <span class="hljs-string"><span class="hljs-string">"33"</span></span> + boilOrLight + <span class="hljs-string"><span class="hljs-string">"aa"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"value: "</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) statusStr = self.child.before[<span class="hljs-number"><span class="hljs-number">0</span></span>:].decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) child.expect(<span class="hljs-string"><span class="hljs-string">r'\[LE\]&gt;'</span></span>)</code> </pre> <br>  Parameter boilOrLight bisa 00 - jika kita mengatur mode tampilan suhu saat ini atau 01 - jika kita mengatur mode malam. <br><br>  Contoh jawaban: <br><blockquote>  nilai: 55 10 33 01 00 7f 00 00 ff 32 7f 00 ff 00 64 7f ff 00 00 aa </blockquote>  Di sini, byte keenam, kesebelas dan keenambelas (7f) adalah parameter rand dari item 12. Byte kelima adalah scale_from, byte kesepuluh adalah scale_mid, byte kelima belas adalah scale_to.  Byte ketujuh + delapan + kesembilan adalah rgb_from.  Byte kedua belas + ketiga belas + empat belas adalah rgb_mid.  Ketujuh Belas + Delapan Belas + byte kesembilan - rgb_to. <br></li></ol><br><h3>  Kesimpulan </h3><br>  Jika gatttool tidak ingin terhubung ke teko (ini mungkin pertama kali Anda terhubung ke perangkat yang tidak dikenal), maka cobalah mencari teko menggunakan os sebelum menghubungkan modul: <br><br><pre> <code class="bash hljs">sudo hciconfig device reset sudo timeout 1 hcitool lescan</code> </pre> <br><br>  perangkat - id perangkat bluetooth Anda (misalnya, hci0).  Pastikan alamat poppy ketel Anda ada dalam daftar perangkat yang ditemukan.  Setelah itu: <br><br><pre> <code class="bash hljs">sudo hcitool lewladd mac sudo hcitool lerladd mac</code> </pre> <br><br>  mac - alamat poppy dari teko Anda <br><br>  <b>UPD6</b> : Secara signifikan meningkatkan modul ketel: <br>  1. Mentransfer modul dari platform ke mode integrasi <br>  2. Setelah menambahkan, Anda akan secara otomatis memiliki 3 elemen: pemanas air (suhu saat ini, suhu target, perebusan dan pemanasan), sensor (waktu sinkronisasi, energi yang dihabiskan, jam operasi, jumlah start) dan cahaya (dapat digunakan sebagai lampu malam dan memilih warna apa pun) cahaya latar) <br>  3. Modul sekarang tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">GitHub</a> . <br>  4. Modul ini mendukung instalasi melalui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">HACS</a> <br>  5. Contoh konfigurasi: <br><pre> <code class="plaintext hljs">r4s_kettler: device: 'hci0' mac: 'FF:FF:FF:FF:FF:FF' password: 'ffffffffffffffff'</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Tangkapan layar dari versi baru</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8j/gc/th/8jgcthd3i8cff7ebzchka-rsdyc.jpeg" alt="gambar"><br><img src="https://habrastorage.org/webt/bk/m7/yn/bkm7ynlfqahggnahmhfpbjb3ghe.jpeg" alt="gambar"><br><img src="https://habrastorage.org/webt/uk/wg/ve/ukwgvelc6s_evw1zzucwu_gly4w.jpeg" alt="gambar"><br><img src="https://habrastorage.org/webt/hj/wl/ft/hjwlft8f2k7yv1qjafxn2iqtcay.jpeg" alt="gambar"><br></div></div><br><br>  <b>UPD7</b> : <b>Menghapus</b> informasi yang tidak relevan </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id412583/">https://habr.com/ru/post/id412583/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id412571/index.html">Kisah sukses Kubernetes dalam produksi. Bagian 9: Cluster CERN dan 210 K8</a></li>
<li><a href="../id412573/index.html">Apa yang salah dengan Geektimes kembali ke Habr</a></li>
<li><a href="../id412575/index.html">Setiap tahun, musik pop menjadi semakin monoton, karena orang yang sama mengarangnya</a></li>
<li><a href="../id412579/index.html">Marvel: Infinity War atau Cara mengumpulkan data untuk proyek Anda dalam beberapa menit</a></li>
<li><a href="../id412581/index.html">Dari Zaman Batu ke Perang Dunia II: bagaimana robot digunakan untuk meneliti artefak sejarah</a></li>
<li><a href="../id412587/index.html">Wayang + Hiera. Peras maksimal</a></li>
<li><a href="../id412589/index.html">25 perpustakaan Android menghibur. Musim Semi 2018</a></li>
<li><a href="../id412591/index.html">Membangun jetpack: 29 Mei adalah Hari Peringatan Wendell Moore</a></li>
<li><a href="../id412593/index.html">Produk Baru, Platform, dan All-as-a-Service: HPE Webinar</a></li>
<li><a href="../id412595/index.html">Laporan Club of Rome 2018, Bab 1.1.2: ‚ÄúPembiayaan‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>