<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöî ‚ûø üíé Introdu√ß√£o aos microsservi√ßos no Spring Boot üë©üèø‚Äçü§ù‚Äçüë©üèæ ‚ö™Ô∏è üï∫üèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal! 

 Neste artigo, demonstraremos os componentes b√°sicos para a cria√ß√£o de microsservi√ßos RESTful usando o registro de servi√ßos Consul, Spr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Introdu√ß√£o aos microsservi√ßos no Spring Boot</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/413567/">  Ol√° pessoal! <br><br>  Neste artigo, demonstraremos os componentes b√°sicos para a cria√ß√£o de microsservi√ßos RESTful usando o registro de servi√ßos Consul, Spring Boot para todos os andaimes, inje√ß√£o de depend√™ncia, Maven para montagem, bem como Spring REST e a API Java RESTful Jersey / JaxRS. <br><br>  As principais vantagens dos microsservi√ßos: <br><br><ul><li>  Os microsservi√ßos ajudam a afrouxar seu c√≥digo </li></ul><br><ul><li>  Os microsservi√ßos permitem que diferentes equipes trabalhem em pequenos componentes usando tecnologias independentes, proporcionando uma implanta√ß√£o mais segura e frequente.O Spring Boot suporta v√°rias implementa√ß√µes para criar uma API REST </li></ul><br><ul><li>  A descoberta e a chamada de servi√ßos n√£o dependem da plataforma de servi√ßo </li></ul><br><ul><li>  Swagger cria documenta√ß√£o API robusta e interface de chamada </li></ul><br>  Se voc√™ ainda n√£o est√° usando microsservi√ßos, n√£o conseguiu entrar na fase dos primeiros seguidores na curva de percep√ß√£o da tecnologia, e provavelmente √© o momento certo para come√ßar. <br><br><img src="https://habrastorage.org/webt/o_/ze/uu/o_zeuux9s9xpxbxjvitgdmiqox4.png"><a name="habracut"></a><br><br>  Nas √∫ltimas duas d√©cadas, a empresa se tornou muito flex√≠vel em nosso processo SDLC, mas nossos aplicativos, em geral, ainda permanecem monol√≠ticos, com enormes frascos que suportam todas as APIs e vers√µes do mercado.  Atualmente, por√©m, h√° um desejo por mais processos Lean, DevOps, e a funcionalidade est√° se tornando "sem servidor".  A refatora√ß√£o para microsservi√ßos pode reduzir o emaranhado de c√≥digo e recursos, tornar os conjuntos menores, as libera√ß√µes s√£o mais seguras e as APIs s√£o mais est√°veis. <br><br>  Neste artigo, criaremos um aplicativo simples de gerenciamento de portf√≥lio do mercado de a√ß√µes que os clientes podem chamar para avaliar seu portf√≥lio de a√ß√µes (cota√ß√µes e valores).  O microsservi√ßo de portf√≥lio recuperar√° o portf√≥lio do cliente, o enviar√° ao microsservi√ßo de pre√ßos para aplicar os pre√ßos mais recentes e, em seguida, retornar√° o portf√≥lio totalmente valorizado e subtotalizado, demonstrando tudo isso por meio de uma chamada de descanso. <br><br><img src="https://habrastorage.org/webt/qe/ea/aw/qeeaawb8mapjtsibfyw3nro_ue8.png"><br><br>  Antes de come√ßarmos a trabalhar na cria√ß√£o de nossos microsservi√ßos, vamos preparar nosso ambiente configurando o Consul. <br><br><h3>  Download Consul </h3><br>  Usaremos o Consul Hashicorp para descobrir servi√ßos; acesse <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.consul.io/downloads.html</a> e baixe o Consul para Windows, Linux, Mac, etc.  Isso fornecer√° um arquivo execut√°vel que voc√™ precisar√° adicionar ao seu caminho. <br><br><h3>  Iniciar Consul </h3><br>  No prompt de comando, iniciando o Consul no modo dev: <br><br><pre><code class="bash hljs">consul agent -dev</code> </pre> <br>  Para verificar se est√° em execu√ß√£o, acesse o navegador e acesse a interface do consul <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: // localhost: 8500</a> .  Se tudo correr bem, o c√¥nsul deve informar que est√° vivo e bem.  Ao clicar no servi√ßo de consul (√† esquerda), voc√™ receber√° informa√ß√µes adicionais (√† direita). <br><br><img src="https://habrastorage.org/webt/9p/4m/2t/9p4m2taqogtv6ahb3dnpmvvt2oc.png"><br><br>  Se, no momento, houver algum problema, adicione o Consul ao caminho de execu√ß√£o e as portas 8500 e 8600 estar√£o dispon√≠veis. <br><br><h3>  Criar um aplicativo SpringBoot </h3><br>  Usaremos o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Spring Initializr</a> , que est√° integrado na maioria dos IDEs, para montar nossos aplicativos SpringBoot.  As capturas de tela abaixo usam o IntelliJ IDEA. <br><br>  Selecione "Arquivo / Novo projeto" para abrir um novo modelo de projeto e, em seguida, "Spring Initializr". <br><br><img src="https://habrastorage.org/webt/xb/j5/3t/xbj53tf_bfr5dauohwqmv9gkdmm.png"><br><br>  Em geral, voc√™ pode configurar o andaime sem um IDE preenchendo um formul√°rio on-line na p√°gina <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">inicial</a> do SpringBoot Initializr, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">start.spring.io</a> , que criar√° um arquivo zip para o seu projeto vazio, pronto para download. <br><br>  Clique em "Avan√ßar" e preencha os metadados do projeto.  Use a seguinte configura√ß√£o: <br><br><img src="https://habrastorage.org/webt/l0/_p/zk/l0_pzkpsppbplfrusj7suogqmyk.png"><br><br>  Clique em ‚ÄúNext‚Äù para selecionar as depend√™ncias e digite ‚ÄúJersey‚Äù e ‚ÄúConsul Discovery‚Äù na busca de depend√™ncias.  Adicione estas depend√™ncias: <br><br><img src="https://habrastorage.org/webt/jt/t8/l8/jtt8l89pauvzyu_oo_riav_na4e.png"><br><br>  Clique em ‚ÄúNext‚Äù para indicar o nome do projeto e sua localiza√ß√£o.  Mantenha o nome padr√£o "portfolio" e especifique o local preferido do projeto, depois clique em "finish" para criar e abrir o projeto: <br><br><img src="https://habrastorage.org/webt/un/xl/gh/unxlgh-ufplppxqhuyfyfdoug5g.png"><br><br>  Podemos usar o application.properties gerado, mas o SpringBoot tamb√©m reconhece o formato YAML, que √© um pouco mais f√°cil de visualizar, ent√£o vamos renome√°-lo para application.yml. <br><br>  Chamamos o microsservi√ßo de "servi√ßo de portf√≥lio".  Podemos especificar uma porta ou usar a porta 0 para que o aplicativo use uma porta dispon√≠vel.  No nosso caso, usaremos 57116. Se voc√™ hospedar este servi√ßo como um cont√™iner do Docker, poder√° mape√°-lo para qualquer porta que selecionar.  Nomeie o aplicativo e especifique nossa porta adicionando o seguinte ao nosso application.yml: <br><br><pre> <code class="bash hljs">spring: application: name: portfolio-service server: port: 57116</code> </pre><br>  Para disponibilizar nosso servi√ßo, adicione anota√ß√£o √† nossa classe de aplicativo SpringBoot.  Abra o aplicativo PortfolioApplication e adicione @EnableDiscoveryClient acima da declara√ß√£o da classe. <br><br>  Confirme as importa√ß√µes.  A classe deve ficar assim: <br><br><pre> <code class="bash hljs">package com.restms.demo.portfolio; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; . . . @SpringBootApplication @EnableDiscoveryClient public class PortfolioApplication { public static void main(String[] args) { SpringApplication.run(PortfolioApplication.class, args); } }</code> </pre><br>  (Para demonstrar como os microsservi√ßos podem consistir em plataformas independentes, usaremos Jersey para este servi√ßo e Spring REST para o pr√≥ximo). <br>  Para configurar o servi√ßo web RESTful em Jersey, precisamos especificar a classe de configura√ß√£o ResourceConfig.  Adicione a classe JerseyConfig (para demonstra√ß√£o, vamos salv√°-la no mesmo pacote da nossa classe de aplicativo).  Deve ficar assim, mais o pacote correto e importar: <br><br><pre> <code class="bash hljs">@Configuration @ApplicationPath(<span class="hljs-string"><span class="hljs-string">"portfolios"</span></span>) public class JerseyConfig extends ResourceConfig { public <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JerseyConfig</span></span></span></span>() { register(PortfolioImpl.class); } }</code> </pre><br>  Observe que ele herda de ResourceConfig para design√°-lo como uma classe de configura√ß√£o de Jersey.  O atributo @ApplicationPath ("portfolios") define o contexto da chamada, o que significa que as chamadas devem come√ßar com o elemento do caminho "portfolioios".  (Se voc√™ omitir, o contexto padr√£o √© "/"). <br><br>  A classe PortfolioImpl atender√° duas solicita√ß√µes: portfolios / customer / {customer-id} retorna todos os portf√≥lios e portfolios / customer / {customer-id} / portfolio / {portfolio-id} retorna um portf√≥lio.  Uma carteira consiste em um conjunto de tickers e o n√∫mero de a√ß√µes detidas por esse ticker.  (Para demonstra√ß√£o, existem tr√™s clientes com identificadores 0, 1 e 2, cada um dos quais possui tr√™s portf√≥lios com identificadores 0, 1 e 2). <br><br>  Seu IDE solicitar√° que voc√™ crie o PortfolioImpl;  fa√ßa agora.  Para demonstrar, adicione-o ao mesmo pacote.  Digite o c√≥digo abaixo e confirme todas as importa√ß√µes: <br><br><pre> <code class="bash hljs">@Component @Path(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) public class PortfolioImpl implements InitializingBean { private Object[][][][] clientPortfolios; @GET @Path(<span class="hljs-string"><span class="hljs-string">"customer/{customer-id}"</span></span>) @Produces(MediaType.APPLICATION_JSON) // a portfolio consists of an array of arrays, each containing an array of // stock ticker and associated shares public Object[][][] getPortfolios(@PathParam(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) int customerId) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> clientPortfolios[customerId]; } @GET @Path(<span class="hljs-string"><span class="hljs-string">"customer/{customer-id}/portfolio/{portfolio-id}"</span></span>) @Produces(MediaType.APPLICATION_JSON) public Object[][] getPortfolio(@PathParam(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) int customerId, @PathParam(<span class="hljs-string"><span class="hljs-string">"portfolio-id"</span></span>) int portfolioId) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> getPortfolios(customerId)[portfolioId]; } @Override public void afterPropertiesSet() throws Exception { Object[][][][] clientPortfolios = { { // 3 customers, 3 portfolios each {new Object[]{<span class="hljs-string"><span class="hljs-string">"JPM"</span></span>, 10201}, new Object[]{<span class="hljs-string"><span class="hljs-string">"GE"</span></span>, 20400}, new Object[]{<span class="hljs-string"><span class="hljs-string">"UTX"</span></span>, 38892}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"KO"</span></span>, 12449}, new Object[]{<span class="hljs-string"><span class="hljs-string">"JPM"</span></span>, 23454}, new Object[]{<span class="hljs-string"><span class="hljs-string">"MRK"</span></span>, 45344}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"WMT"</span></span>, 39583}, new Object[]{<span class="hljs-string"><span class="hljs-string">"DIS"</span></span>, 95867}, new Object[]{<span class="hljs-string"><span class="hljs-string">"TRV"</span></span>, 384756}}, }, { {new Object[]{<span class="hljs-string"><span class="hljs-string">"GE"</span></span>, 38475}, new Object[]{<span class="hljs-string"><span class="hljs-string">"MCD"</span></span>, 12395}, new Object[]{<span class="hljs-string"><span class="hljs-string">"IBM"</span></span>, 91234}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"VZ"</span></span>, 22342}, new Object[]{<span class="hljs-string"><span class="hljs-string">"AXP"</span></span>, 385432}, new Object[]{<span class="hljs-string"><span class="hljs-string">"UTX"</span></span>, 23432}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"IBM"</span></span>, 18343}, new Object[]{<span class="hljs-string"><span class="hljs-string">"DIS"</span></span>, 45673}, new Object[]{<span class="hljs-string"><span class="hljs-string">"AAPL"</span></span>, 23456}}, }, { {new Object[]{<span class="hljs-string"><span class="hljs-string">"AXP"</span></span>, 34543}, new Object[]{<span class="hljs-string"><span class="hljs-string">"TRV"</span></span>, 55322}, new Object[]{<span class="hljs-string"><span class="hljs-string">"NKE"</span></span>, 45642}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"CVX"</span></span>, 44332}, new Object[]{<span class="hljs-string"><span class="hljs-string">"JPM"</span></span>, 12453}, new Object[]{<span class="hljs-string"><span class="hljs-string">"JNJ"</span></span>, 45433}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"MRK"</span></span>, 32346}, new Object[]{<span class="hljs-string"><span class="hljs-string">"UTX"</span></span>, 46532}, new Object[]{<span class="hljs-string"><span class="hljs-string">"TRV"</span></span>, 45663}}, } }; this.clientPortfolios = clientPortfolios; } }</code> </pre><br>  A anota√ß√£o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">componente</a> designa isso como a classe do componente Spring e a exp√µe como um ponto de extremidade.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">As</a> anota√ß√µes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">caminho</a> sobre a declara√ß√£o de classe declaram que a classe √© acessada atrav√©s do elemento de caminho "/", e duas chamadas de API suportadas est√£o dispon√≠veis atrav√©s de portfolios / customer / {customer-id} e portfolios / customer / {customer-id} / portfolio / {portfolio- id}, como vemos nas anota√ß√µes do m√©todo.  Observe que o caminho ("/") √© o padr√£o, mas o deixamos para refer√™ncia.  Os m√©todos s√£o designados como HTTP GET via @GETannotation.  Nosso m√©todo √© projetado para retornar uma matriz e anotado para retornar Json, portanto, ele retorna uma matriz Json.  Observe como as anota√ß√µes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Path</a> Param s√£o usadas na assinatura do m√©todo para extrair os par√¢metros exibidos das consultas exibidas. <br><br>  (Para nossa demonstra√ß√£o, retornamos valores codificados. √â claro que, na pr√°tica, a implementa√ß√£o consultar√° o banco de dados ou outro servi√ßo ou fonte de dados em vez do c√≥digo r√≠gido.) <br>  Agora crie um projeto e execute-o.  Se voc√™ usar o IntelliJ, ele criar√° um execut√°vel padr√£o, ent√£o basta clicar na seta verde ‚Äúexecutar‚Äù.  Voc√™ tamb√©m pode usar <br><br><pre> <code class="bash hljs">mvn spring-boot:run</code> </pre> <br>  Ou voc√™ pode executar a instala√ß√£o do maven e executar o aplicativo usando java -jar, apontando para o jar gerado no diret√≥rio de destino: <br><br><pre> <code class="bash hljs">java -jar target\portfolio-0.0.1-SNAPSHOT.jar</code> </pre> <br>  Agora, devemos ver esse servi√ßo no Consul, ent√£o vamos voltar ao nosso navegador, fa√ßa o download <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: // localhost: 8500 / ui / # / dc1 / services</a> (ou atualize se voc√™ j√° estiver l√°). <br><br><img src="https://habrastorage.org/webt/bs/ab/2v/bsab2vs-dswpzy7nmpevmtphdma.png"><br><br>  Hmm, n√≥s vemos nosso servi√ßo l√°, mas ele √© exibido como com falha.  Isso ocorre porque o Consul espera um sinal de batimento card√≠aco "saud√°vel" de nosso servi√ßo. <br>  Para gerar sinais de pulsa√ß√£o, podemos adicionar uma depend√™ncia do servi√ßo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Spring Actuator</a> ao pom do nosso aplicativo. <br><br><pre> <code class="bash hljs">&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt;</code> </pre><br>  Enquanto estamos no pom, observe que h√° uma vers√£o conflitante com Jersey entre o iniciador do Consul e o iniciador de Jersey.  Para facilitar isso, designe o iniciante de Jersey como o primeiro v√≠cio. <br><br>  Seu pom agora deve conter as seguintes depend√™ncias: <br><br><pre> <code class="bash hljs">&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jersey&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt;</code> </pre><br>  Ao reiniciar o Consul, o servi√ßo Portf√≥lio exibe um feliz: <br><br><img src="https://habrastorage.org/webt/uf/oq/qr/ufoqqrtcnxnlwazqy-ozrp1lceo.png"><br><br>  Agora, no servi√ßo de portf√≥lio, existem dois n√≥s de transmiss√£o: um deles √© a implementa√ß√£o do servi√ßo de portf√≥lio e o outro √© a pulsa√ß√£o. <br><br>  Vamos verificar a porta que foi atribu√≠da.  Voc√™ pode ver isso na sa√≠da do aplicativo: <br><br><pre> <code class="bash hljs">INFO 19792 --- [ main] sbcetTomcatEmbeddedServletContainer : Tomcat started on port(s): 57116 (http)</code> </pre> <br>  Voc√™ tamb√©m pode ver a porta diretamente na interface do usu√°rio do Consul.  Clique em ‚Äúatendimento ao cliente‚Äù e selecione o link ‚ÄúAtendimento 'atendimento ao cliente' verificar link‚Äù, que exibe a porta de servi√ßo, neste caso 57116. <br><br><img src="https://habrastorage.org/webt/s_/up/ce/s_upceczzu0xupqioariurhawz8.png"><br><br>  Solicite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: // localhost: 57116 / portfolios / customer / 1 / portfolio / 2</a> e voc√™ ver√° a matriz json [["IBM", 18343], ["DIS", 45673], ["AAPL", 23456]] <br><br>  Nosso primeiro microsservi√ßo est√° aberto para neg√≥cios! <br><br><h3>  Servi√ßo de pre√ßos </h3><br>  Em seguida, criaremos nosso servi√ßo de pre√ßos, desta vez usando o Spring RestController em vez de Jersey. <br><br>  O servi√ßo de precifica√ß√£o aceitar√° o identificador do cliente e o identificador do portf√≥lio como par√¢metros e usar√° o RestTemplate para solicitar servi√ßos do portf√≥lio, receber cota√ß√µes e a√ß√µes e retornar pre√ßos atuais.  (N√£o preciso dizer que esses valores s√£o not√≠cias falsas, portanto, n√£o os use para tomar decis√µes comerciais!) <br><br>  Crie um novo projeto usando as seguintes informa√ß√µes: <br><br><img src="https://habrastorage.org/webt/gz/sy/sm/gzsysm7_cgynyxucuhgrcfoxhbs.png"><br><br>  Desta vez, selecione as depend√™ncias da Web, Consul Discovery e Actuator: <br><br><img src="https://habrastorage.org/webt/1l/ke/ov/1lkeovxzix2pxqwmodb2efdw-zu.png"><br><br>  Deixe o nome padr√£o do projeto "pricing" e crie o projeto no diret√≥rio de sua escolha. <br><br>  Desta vez, usaremos application.properties em vez de application.yml. <br>  Defina o nome e a porta em application.properties como: <br><br><pre> <code class="bash hljs">spring.application.name=pricing server.port=57216</code> </pre> <br>  Anote o aplicativo Pricing com @EnableDiscoveryClient.  A classe deve ficar assim, mais o pacote e a importa√ß√£o. <br><br><pre> <code class="bash hljs">@SpringBootApplication @EnableDiscoveryClient public class PricingApplication { public static void main(String[] args) { SpringApplication.run(PricingApplication.class, args); } }</code> </pre><br>  Em seguida, criaremos a classe PricingEndpoint.  Aqui darei um exemplo mais detalhado, pois demonstra v√°rias fun√ß√µes importantes, incluindo a descoberta de servi√ßos (pesquisa de servi√ßo de portf√≥lio) e o uso do RestTemplate para consulta: <br><br><pre> <code class="bash hljs">@RestController @RequestMapping(<span class="hljs-string"><span class="hljs-string">"/pricing"</span></span>) public class PricingEndpoint implements InitializingBean { @Autowired DiscoveryClient client; Map&lt;String, Double&gt; pricingMap = new HashMap&lt;&gt;(); RestTemplate restTemplate = new RestTemplate(); @GetMapping(<span class="hljs-string"><span class="hljs-string">"/customer/{customer-id}/portfolio/{portfolio-id}"</span></span>) public List&lt;String&gt; getPricedPortfolio( @PathVariable(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) Integer customerId, @PathVariable(<span class="hljs-string"><span class="hljs-string">"portfolio-id"</span></span>) Integer portfolioId) { List&lt;ServiceInstance&gt; instances = client.getInstances(<span class="hljs-string"><span class="hljs-string">"portfolio-service"</span></span>); ServiceInstance instance = instances.stream() .findFirst() .orElseThrow(() -&gt; new RuntimeException(<span class="hljs-string"><span class="hljs-string">"not found"</span></span>)); String url = String.format(<span class="hljs-string"><span class="hljs-string">"%s/portfolios/customer/%d/portfolio/%d"</span></span>, instance.getUri(), customerId, portfolioId); // query <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the portfolios, returned as an array of List // of size 2, containing a ticker and a position (<span class="hljs-comment"><span class="hljs-comment"># of shares) Object[] portfolio = restTemplate.getForObject(url, Object[].class); // Look up the share prices, and return a list of Strings, formatted as // ticker, shares, price, total List&lt;String&gt; collect = Arrays.stream(portfolio).map(position -&gt; { String ticker = ((List&lt;String&gt;) position).get(0); int shares = ((List&lt;Integer&gt;) position).get(1); double price = getPrice(ticker); double total = shares * price; return String.format("%s %d %f %f", ticker, shares, price, total); }).collect(Collectors.toList()); return collect; } private double getPrice(String ticker) { return pricingMap.get(ticker); } @Override public void afterPropertiesSet() throws Exception { pricingMap.put("MMM",201.81); pricingMap.put("AXP",85.11); pricingMap.put("AAPL",161.04); pricingMap.put("BA",236.32); pricingMap.put("CAT",118.02); pricingMap.put("CVX",111.31); pricingMap.put("CSCO",31.7); pricingMap.put("KO",46.00); pricingMap.put("DIS",101.92); pricingMap.put("XOM",78.7); pricingMap.put("GE",24.9); pricingMap.put("GS",217.62); pricingMap.put("HD",155.82); pricingMap.put("IBM",144.29); pricingMap.put("INTC",35.66); pricingMap.put("JNJ",130.8); pricingMap.put("JPM",89.75); pricingMap.put("MCD",159.81); pricingMap.put("MRK",63.89); pricingMap.put("MSFT",73.65); pricingMap.put("NKE",52.78); pricingMap.put("PFE",33.92); pricingMap.put("PG",92.79); pricingMap.put("TRV",117.00); pricingMap.put("UTX",110.12); pricingMap.put("UNH",198.00); pricingMap.put("VZ",47.05); pricingMap.put("V",103.34); pricingMap.put("WMT", 80.05); } }</span></span></code> </pre><br>  Para encontrar um servi√ßo de portf√≥lio, precisamos ter acesso ao DiscoveryClient.  √â f√°cil obter isso com a anota√ß√£o @Autowired da Spring. <br><br><pre> <code class="bash hljs">@Autowired DiscoveryClient client;</code> </pre><br>  Essa inst√¢ncia do DiscoveryClient √© usada para procurar o servi√ßo na chamada: <br><br><pre> <code class="bash hljs">List&lt;ServiceInstance&gt; instances = client.getInstances(<span class="hljs-string"><span class="hljs-string">"portfolio-service"</span></span>); ServiceInstance instance = instances.stream().findFirst().orElseThrow(() -&gt; new RuntimeException(<span class="hljs-string"><span class="hljs-string">"not found"</span></span>));</code> </pre><br>  Ap√≥s a localiza√ß√£o do servi√ßo, podemos us√°-lo para atender a nossa solicita√ß√£o, que compomos de acordo com a chamada API criada em nosso servi√ßo de portf√≥lio. <br><br><pre> <code class="bash hljs">String url = String.format(<span class="hljs-string"><span class="hljs-string">"%s/portfolios/customer/%d/portfolio/%d"</span></span>, instance.getUri(), customerId, portfolioId);</code> </pre><br>  Finalmente, usamos RestTemplate para executar nossa solicita√ß√£o GET. <br><br><pre> <code class="bash hljs">Object[] portfolio = restTemplate.getForObject(url, Object[].class);</code> </pre> <br>  Observe que, para os controladores Rest (e tamb√©m para o Spring MVC Request Controller), as vari√°veis ‚Äã‚Äãde caminho s√£o recuperadas usando a anota√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Path</a> Variable, ao contr√°rio de Jersey, que, como vimos, usa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Path</a> Param. <br><br>  Isso conclui nossos pre√ßos com o Spring RestController. <br><br><h3>  A documenta√ß√£o </h3><br>  Resolvemos todos esses problemas para criar nossos microsservi√ßos, mas eles n√£o trar√£o benef√≠cios suficientes se n√£o dermos ao mundo conhecimento sobre como us√°-los. <br><br>  Para fazer isso, usamos a ferramenta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Swagger</a> conveniente e f√°cil de usar, que n√£o apenas documenta nossas chamadas de API, mas tamb√©m fornece um cliente Web conveniente para cham√°-las. <br><br>  Primeiro, vamos especificar o Swagger em nosso pom: <br><br><pre> <code class="bash hljs">&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;version&gt;2.7.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;version&gt;2.7.0&lt;/version&gt; &lt;/dependency&gt;</code> </pre><br>  Ent√£o precisamos dizer ao Swagger quais de nossas aulas queremos documentar.  Vamos apresentar a nova classe SwaggerConfig que cont√©m a especifica√ß√£o Swagger. <br><br><pre> <code class="bash hljs">@Configuration @EnableSwagger2 public class SwaggerConfig { @Bean public Docket <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">api</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> new Docket(DocumentationType.SWAGGER_2) .select() .apis(RequestHandlerSelectors.any()) .paths(PathSelectors.regex(<span class="hljs-string"><span class="hljs-string">"/pricing.*"</span></span>)) .build(); } }</code> </pre><br>  Vamos ver o que essa classe faz.  Primeiro, designamos isso como uma configura√ß√£o do Swagger com a anota√ß√£o @ EnableSwagger2. <br><br>  Em seguida, criamos um componente Docket que informa ao Swagger quais APIs devem ser exibidas.  No exemplo acima, pedimos ao Swagger para demonstrar qualquer caminho que comece com "/ pricing".  Uma alternativa seria especificar classes para documenta√ß√£o, e n√£o para caminhos: <br><br><pre> <code class="bash hljs">.apis(RequestHandlerSelectors.basePackage(<span class="hljs-string"><span class="hljs-string">"com.restms.demo"</span></span>)) .paths(PathSelectors.any())</code> </pre><br>  Reinicie o microservice de pre√ßo e chame <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http: // localhost: 57216 / swagger-ui.html</a> no navegador <br><br><img src="https://habrastorage.org/webt/8x/0k/gk/8x0kgk8hxs_dpijzolsmxk8rdva.png"><br><br>  Clique em Listar opera√ß√µes para visualizar as opera√ß√µes do servi√ßo em detalhes. <br>  Clique em Expandir opera√ß√µes para criar uma solicita√ß√£o com base no formul√°rio.  Defina alguns par√¢metros, clique em "Experimente!"  e aguarde a resposta: <br><br><img src="https://habrastorage.org/webt/rf/0_/iu/rf0_ius_kz3fljd74-aaqhzwsia.png"><br><br>  Voc√™ pode adicionar muito mais cores adicionando anota√ß√µes do Swagger aos seus m√©todos. <br>  Por exemplo, decore o m√©todo PricingImpl.getPricedPortfolio existente usando a anota√ß√£o @ApiOperation, como mostrado abaixo: <br><br><pre> <code class="bash hljs">@ApiOperation(value = <span class="hljs-string"><span class="hljs-string">"Retrieves a fully priced portfolio"</span></span>, notes = <span class="hljs-string"><span class="hljs-string">"Retrieves fully priced portfolio given customer id and portfolio id"</span></span>) @GetMapping(<span class="hljs-string"><span class="hljs-string">"/customer/{customer-id}/portfolio/{portfolio-id}"</span></span>) public List&lt;String&gt; getPricedPortfolio(@PathVariable(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) Integer customerId, @PathVariable(<span class="hljs-string"><span class="hljs-string">"portfolio-id"</span></span>) Integer portfolioId)</code> </pre> <br>  Recarregue e atualize o swagger-ui para ver a nova documenta√ß√£o atualizada: <br><br><img src="https://habrastorage.org/webt/1z/vy/bj/1zvybjvfyh6zmjxd7gahn5_tlyi.png"><br><br>  E isso n√£o √© tudo o que voc√™ pode fazer com o Swagger, portanto, verifique a documenta√ß√£o. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Yuri Dvorzhetsky</a> , professor do nosso curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Desenvolvedor no Spring Framework",</a> falar√° mais sobre o trabalho do Spring Boot: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zgd9SfSxO0Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><i>Artigo original</i></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt413567/">https://habr.com/ru/post/pt413567/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt413557/index.html">NewSQL: SQL n√£o vai a lugar nenhum</a></li>
<li><a href="../pt413559/index.html">Degrada√ß√£o da Web ou como tornar a Web leg√≠vel para humanos</a></li>
<li><a href="../pt413561/index.html">Velocidade da √°rvore de express√£o Linq compilada</a></li>
<li><a href="../pt413563/index.html">4 maneiras de importar um pacote para o Go</a></li>
<li><a href="../pt413565/index.html">An√°lise de hackers do Kubernetes - backdoor via kubelet</a></li>
<li><a href="../pt413569/index.html">Desmontagem das baterias de √≠on de l√≠tio 18650 da f√°brica</a></li>
<li><a href="../pt413571/index.html">Edi√ß√£o 25: treinamento em TI - problemas e desafios atuais das principais empresas</a></li>
<li><a href="../pt413575/index.html">BricsCAD Shape - CAD 3D gr√°tis da Bricsys</a></li>
<li><a href="../pt413577/index.html">[An√∫ncio] Hubs para a competi√ß√£o no CodinGame.com em sete cidades da R√∫ssia</a></li>
<li><a href="../pt413579/index.html">Vamos colocar uma palavra sobre decomposi√ß√£o de c√≥digo: programa√ß√£o contextual</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>