<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦗 🎥 🚵 WSGI服务器的性能分析：第二部分 🐦 🏑 💃🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="本文是Kevin Goldberg的文章“ Python WSGI服务器的性能分析：第2部分”的译文。 



 引言 
 在WSGI的作者看来 ，在本系列的第一部分中 ，您遇到了WSGI和六种最受欢迎​​的服务器。 在这一部分中，将向您显示分析这些服务器性能的结果。 为此，创建了一个特殊的测试沙箱...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>WSGI服务器的性能分析：第二部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427217/">  <i>本文是Kevin Goldberg的文章“ Python WSGI服务器的性能分析：第2部分”的译文。</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eee/5ee/9d4/eee5ee9d43f8a092b0c299c5e12bd661.jpg" alt="图片"><br><br><h2> 引言 </h2><br> 在<b>WSGI</b>的作者<b>看来</b> ，在本系列的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">第一部分中</a> ，您遇到了<b>WSGI</b>和六种最受欢迎​​的服务器。 在这一部分中，将向您显示分析这些服务器性能的结果。 为此，创建了一个特殊的测试沙箱。 <br><a name="habracut"></a><br><h2> 参赛者 </h2><br> 由于时间限制，研究仅限于六台WSGI服务器。 该项目的所有启动说明<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">都托管在GitHub上</a> 。 也许随着时间的推移，该项目将会扩展，并将介绍其他WSGI服务器的性能分析。 但是现在，我们将讨论六台服务器： <br><br><ol><li>  <b>Bjoern</b>称自己为“超快速WSGI服务器”，并称其为“最快，最小和最轻的WSGI服务器”。 我们创建了一个使用大多数默认库设置的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">小型应用程序</a> 。 </li><li>  <b>CherryPy</b>是一个非常流行且稳定的框架和WSGI服务器。 这个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">小脚本</a>用于通过<b>CherryPy</b>为我们的示例应用程序提供服务。 </li><li>  <b>Gunicorn的</b>灵感来自Ruby的<b>Unicorn</b>服务器（因此得名）。 他谦虚地声称它“简单实施，易于使用且相当快”。 与<b>Bjoern</b>和<b>CherryPy</b>不同， <b>Gunicorn</b>是独立服务器。 我们使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此命令</a>创建了它。 参数“ WORKER_COUNT”设置为可用处理器核心数量的两倍加一个。 这是根据<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Gunicorn文档中的</a>建议完成的。 </li><li>  <b>Meinheld</b>是一种高性能WSGI兼容的Web服务器，该服务器声称是轻量级的。 根据服务器站点上显示的示例，我们创建<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">了应用程序</a> 。 </li><li>  <b>mod_wsgi</b>由与<b>mod_python</b>相同的创建者创建。 与<b>mod_python</b>一样，它仅适用于Apache。 但是，它确实包含一个名为<b>“ mod_wsgi express”</b>的工具，该工具可以创建最小的Apache实例。 我们使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此命令</a>配置并使用了<b>mod_wsgi express</b> 。 为了匹配<b>Gunicorn</b> ，我们调整了<b>mod_wsgi</b>来创建工人数量是处理器核心的两倍。 </li><li>  <b>uWSGI</b>是功能齐全的应用程序服务器。 通常， <b>uWSGI</b>与代理服务器配对（例如：Nginx）。 但是，为了更好地评估每个服务器的性能，我们尝试仅使用裸服务器，并为每个可用处理器核心<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">创建了两个工作</a>服务器。 </li></ol><br><h2> 基准测试 </h2><br> 为了使测试尽可能客观，创建了一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Docker</a>容器以将被测试服务器与系统其余部分隔离。 另外，使用Docker容器可确保每次启动都从头开始。 <br><br><h3> 伺服器： </h3><br><ul><li> 隔离在Docker容器中。 </li><li> 分配了2个处理器内核。 </li><li> 容器的RAM限制为512 MB。 </li></ul><br><h3> 测试： </h3><br><ul><li> 现代HTTP基准测试工具<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">wrk进行</a>了测试。 </li><li> 对服务器进行了随机测试，同时连接的数量从100增加到10,000。 </li><li>  <b>wrk</b>仅限于Docker未使用的两个CPU内核。 </li><li> 每次测试持续30秒，并重复4次。 </li></ul><br><h3> 指标： </h3><br><ul><li> 持久性请求，错误和延迟的平均数量由<b>wrk</b>提供。 </li><li> 监视内置在Docker中，显示了CPU和RAM的使用水平。 </li><li> 丢弃最高和最低读数，并对其余值取平均值。 </li><li> 出于好奇，我们将完整脚本发送到<a href="">GitHub</a> 。 </li></ul><br><h2> 结果 </h2><br> 所有初始性能指标<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">都包含在项目存储库中</a> ，并且还提供了一个<a href="">CSV</a>摘要<a href="">文件</a> 。 此外，为了可视化，在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Google文档</a>环境中创建了图形。 <br><br><h3>  RPS与同时连接数 </h3><br> 该图显示了并发请求的平均数量； 数字越高越好。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e09/5b5/cc4/e095b5cc4e7e7455183ddd0a50d64250.png" alt="图片"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a5/666/b22/6a5666b22ae59edff617647a06bfa7b4.png" alt="图片"><br><br><ul><li>  Bjoern：明显的赢家。 </li><li>  CherryPy：尽管他是用纯Python编写的，但他还是表现最好的人。 </li><li>  Meinheld：鉴于容器资源稀缺，因此性能出色。 </li><li>  mod_wsgi：不是最快的，但是性能是一致且足够的。 </li><li>  Gunicorn：在较低的负载下表现良好，但存在大量连接问题。 </li><li>  uWSGI：沮丧，结果不佳。 </li></ul><br>  <b>获奖者：比约恩</b> <br><br><h4> 比约恩 </h4><br> 根据不断提出的要求， <b>Bjoern</b>无疑是赢家。 但是，考虑到这个数字比竞争对手高得多，我们有些怀疑。 我们不确定<b>Bjoern</b>真的会如此惊人。 最初，我们按字母顺序测试服务器，然后认为<b>Bjoern</b>获得了不公平的优势。 但是，即使按照随机服务器顺序启动服务器并重新测试之后，结果仍然相同。 <br><br><h4>  uWSGI </h4><br> 我们对<b>uWSGI的测试</b>结果感到失望。 我们希望他能带头。 在测试期间，我们注意到<b>uWSGI</b>日志在屏幕上打印，并且最初我们通过服务器所做的额外工作来解释性能不足的问题。 但是，即使添加了“ <b>--disable-logging</b> ”选项之后， <b>uWSGI</b>仍然是最慢的服务器。 <br><br> 如<b>uWSGI</b>手册中所述，它通常与代理服务器（例如Nginx）连接。 但是，我们不确定这能否解释这么大的差异。 <br><br><h3> 延误 </h3><br> 延迟是请求与其响应之间经过的时间。 数字越小越好。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e03/5c2/6b0/e035c26b0593b256add7d8ce564913ae.png" alt="图片"><br><br><ul><li>  CherryPy：很好地处理了负载。 </li><li>  Bjoern：通常较低的延迟，但在较少的并发连接下效果更好。 </li><li> 独角兽：良好且稳定。 </li><li>  mod_wsgi：即使同时进行大量连接，也具有平均性能。 </li><li>  Meinheld：总体而言，可接受的性能。 </li><li>  uWSGI：uWSGI再次排在最后。 </li></ul><br>  <b>获奖者：CherryPy</b> <br><br><h3>  RAM使用 </h3><br> 此指标显示内存需求和每个服务器的“亮度”。 数字越小越好。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a38/138/59b/a3813859b6d73db89c186759941add94.png" alt="图片"><br><br><ul><li>  Bjoern：非常轻。 它仅使用9 MB的RAM来处理10,000个并发请求。 </li><li>  Meinheld：与<b>Bjoern</b>相同。 </li><li>  Gunicorn：熟练地应对高负载，而内存消耗却很少。 </li><li>  CherryPy：最初需要少量的RAM，但随着负载的增加，其使用量迅速增加。 </li><li>  mod_wsgi：在较低级别上，它是最密集的内存之一，但仍保持一致。 </li><li>  uWSGI：显然，我们正在测试的版本在内存消耗方面存在问题。 </li></ul><br>  <b>优胜者：Bjoern和Meinheld</b> <br><br><h3> 错误数 </h3><br> 服务器崩溃，被中断或请求超时时，将发生错误。 越低越好。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/282/e05/371/282e0537118fd5d98f4284ed084bd427.png" alt="图片"><br><br> 对于每个服务器，我们计算了请求总数与错误总数之比： <br><br><ul><li>  CherryPy：即使有大量连接，错误率也约为0。 </li><li>  Bjoern：发生错误，但是已被处理的请求数所抵消。 </li><li>  mod_wsgi：可以正常工作，可接受的错误率为6％。 </li><li>  Gunicorn：错误率为9％。 </li><li>  uWSGI：由于它处理的请求数量很少，因此错误率仅为34％。 </li><li>  Meinheld：在更高的负载下会下降，在最苛刻的测试中会抛出10,000多个错误。 </li></ul><br>  <b>获奖者：CherryPy</b> <br><br><h3>  CPU使用率 </h3><br> 如果服务器运行良好，则高CPU使用率不是好是坏。 但是，这提供了有关服务器的一些有趣信息。 由于使用了两个CPU内核，因此最大可能的使用率为200％。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/73c/cf7/87f/73ccf787f03745d453ceaa5f4310a921.png" alt="图片"><br><br><ul><li>  Bjoern：单线程服务器，其始终使用100％CPU证明了这一点。 </li><li>  CherryPy：多线程，但停留在150％。 这可能是由于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Python GIL</a>所致。 </li><li>  Gunicorn：使用多个进程，并在较低级别上充分利用CPU资源。 </li><li>  Meinheld：使用诸如Bjoern之类的CPU资源的单线程服务器。 </li><li>  mod_wsgi：多线程服务器，在所有测量中均使用所有CPU内核 </li><li>  uWSGI：CPU使用率非常低。  CPU消耗不超过50％。 这是uWSGI配置不正确的证据。 </li></ul><br>  <b>WINNER：不，因为这更多地是对行为的观察而不是对性能的比较。</b> <br><br><h2> 结论 </h2><br> 总结一下！ 您可以从每个服务器的结果中得出一些一般性想法： <br><br><ul><li>  Bjoern：证明自己是“超快速，超轻量级WSGI服务器”。 </li><li>  CherryPy：高性能，低内存消耗和低错误率。 对于纯Python来说还不错。 </li><li>  Gunicorn：一个适合中等负载的好服务器。 </li><li>  Meinheld：效果很好，所需资源最少。 但是，要承受更高的负载。 </li><li>  mod_wsgi：与Apache集成并且运行良好。 </li><li>  uWSGI：非常失望。 我们错误地配置了<b>uWSGI</b> ，或者我们安装的版本存在基本错误。 </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN427217/">https://habr.com/ru/post/zh-CN427217/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN427205/index.html">Habrakvest，以纪念Mail.Ru集团成立20周年：获奖者和答案</a></li>
<li><a href="../zh-CN427207/index.html">受到批评的Rockstar员工坚持为公司工作100小时</a></li>
<li><a href="../zh-CN427209/index.html">GeoPuzzle-一步步打造世界</a></li>
<li><a href="../zh-CN427211/index.html">电子是台式机的闪光灯</a></li>
<li><a href="../zh-CN427215/index.html">微服务需要发展，而不是从它们开始</a></li>
<li><a href="../zh-CN427219/index.html">MPI中无用的延迟无阻塞消息传递：针对那些“有点儿”的人的轻便分析和教程</a></li>
<li><a href="../zh-CN427221/index.html">我在实现人工智能梦想的过程中实现了什么</a></li>
<li><a href="../zh-CN427223/index.html">首席开发人员的职责是什么</a></li>
<li><a href="../zh-CN427225/index.html">Oracle数据库18c XE发布</a></li>
<li><a href="../zh-CN427227/index.html">我们如何通过遥控器制作棋盘游戏-第2部分</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>