<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêæ üö¥üèª üë©üèæ‚Äçüè´ √âcriture d'un chargeur de wasm pour Ghidra. Partie 1: √©nonc√© du probl√®me et configuration de l'environnement üö∂ üìë üç§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cette semaine, la NSA ( National Security Agency ) a soudainement fait un cadeau √† l'humanit√©, ouvrant les sources de son framework de reverse enginee...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>√âcriture d'un chargeur de wasm pour Ghidra. Partie 1: √©nonc√© du probl√®me et configuration de l'environnement</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443318/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/xy/1q/jm/xy1qjmpn0nactzdrq1laun9brhm.png"></div><br>  Cette semaine, la NSA ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">National Security Agency</a> ) a soudainement fait un cadeau √† l'humanit√©, ouvrant les sources de son framework de reverse engineering logiciel.  La communaut√© des ing√©nieurs invers√©s et des experts en s√©curit√© avec un grand enthousiasme a commenc√© √† explorer le nouveau jouet.  Selon les commentaires, c'est un outil vraiment incroyable, capable de rivaliser avec les solutions existantes, telles que IDA Pro, R2 et JEB.  L'outil s'appelle Ghidra et les ressources professionnelles regorgent d'impressions de chercheurs.  En fait, ils avaient une bonne raison: tous les jours, les organisations gouvernementales ne donnent pas acc√®s √† leurs outils internes.  Moi-m√™me en tant qu'ing√©nieur invers√© professionnel et analyste de logiciels malveillants ne pouvait pas passer aussi bien.  J'ai d√©cid√© de passer un week-end ou deux et d'avoir une premi√®re impression de l'outil.  J'avais un peu jou√© avec le d√©montage et d√©cid√© de v√©rifier l'extensibilit√© de l'outil.  Dans cette s√©rie d'articles, je vais expliquer le d√©veloppement du module compl√©mentaire Ghidra, qui charge le format personnalis√©, utilis√© pour r√©soudre la t√¢che CTF.  Comme c'est un grand framework et que j'ai choisi une t√¢che assez compliqu√©e, je vais diviser l'article en plusieurs parties. <br><br>  √Ä la fin de cette partie, j'esp√®re configurer un environnement de d√©veloppement et construire un module minimal, qui sera capable de reconna√Ætre le format du fichier WebAssembly et proposera le bon d√©sassembleur pour le traiter. <br><a name="habracut"></a><br>  Commen√ßons par la description de la t√¢che.  L'ann√©e derni√®re, la soci√©t√© de s√©curit√© FireEye a organis√© un concours CTF, nomm√© flare-on.  Pendant le concours, les chercheurs ont d√ª r√©soudre douze t√¢ches li√©es √† la r√©tro-ing√©nierie.  L'une des t√¢ches consistait √† rechercher l'application Web, construite avec WebAssembly.  C'est un format ex√©cutable relativement nouveau, et pour autant que je sache, il n'y a pas d'outils parfaits pour y faire face.  Pendant le d√©fi, j'ai essay√© plusieurs outils pour essayer de le vaincre.  Il s'agissait de scripts simples de github et de d√©compilateurs connus, tels que IDA pro et JEB.  √âtonnamment, je me suis arr√™t√© sur Chrome, qui fournit un assez bon d√©monteur et d√©bogueur pour WebAssembly.  Mon objectif est de r√©soudre le d√©fi avec le ghidra.  Je vais d√©crire l'√©tude aussi compl√®tement que possible et donner toutes les informations possibles pour reproduire mes √©tapes.  Peut-√™tre qu'en tant que personne qui n'a pas beaucoup d'exp√©rience avec l'instrument, je pourrais entrer dans des d√©tails inutiles, mais c'est comme √ßa. <br><br>  La t√¢che que je vais utiliser pour l'√©tude peut √™tre t√©l√©charg√©e sur le <a href="">site du</a> d√©fi flareon5.  Il y a le fichier 05_web2point0.7z: archive chiffr√©e avec un mot effrayant <b>infect√©</b> .  Il y a trois fichiers dans l'archive: index.html, main.js et test.wasm.  Ouvrons le fichier index.html dans un navigateur et v√©rifions le r√©sultat: <br><br><img src="https://habrastorage.org/webt/5z/o2/fd/5zo2fdf7jjndo2tmhesju4go7io.png"><br><br>  Eh bien, c'est avec √ßa que je vais travailler.  Commen√ßons par l'√©tude html, d'autant plus que c'est la partie la plus simple du d√©fi.  Le code html ne contient rien sauf le chargement du script main.js. <br><br><pre><code class="javascript hljs">&lt;!DOCTYPE html&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"./main.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Le script ne fait rien de compliqu√© non plus, m√™me s'il semble un peu plus bavard.  Il charge simplement le fichier test.wasm et l'utilise pour cr√©er une instance WebAssembly.  Il lit ensuite le param√®tre ¬´q¬ª de l'url et le passe √† la correspondance de m√©thode, export√©e par l'instance.  Si la cha√Æne dans le param√®tre est incorrecte, le script affiche l'image que nous avons vue ci-dessus, en termes de d√©veloppeurs FireEye appel√©s "Pile of poo". <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Uint8Array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextEncoder().encode(getParameterByName(<span class="hljs-string"><span class="hljs-string">"q"</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pa = wasm_alloc(instance, <span class="hljs-number"><span class="hljs-number">0x200</span></span>); wasm_write(instance, pa, a); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pb = wasm_alloc(instance, <span class="hljs-number"><span class="hljs-number">0x200</span></span>); wasm_write(instance, pb, b); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instance.exports.Match(pa, a.byteLength, pb, b.byteLength) == <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// PARTY POPPER document.getElementById("container").innerText = "√∞≈∏≈Ω‚Ä∞"; } else { // PILE OF POO document.getElementById("container").innerText = "√∞≈∏'"; }</span></span></code> </pre><br>  La solution de la t√¢che consiste √† trouver la valeur du param√®tre q qui fait que la fonction ¬´match¬ª renvoie ¬´True¬ª.  Pour ce faire, je vais d√©monter le fichier test.wasm et analyser l'algorithme de la fonction Match. <br><br>  Il n'y a pas de surprise et je vais essayer de le faire √† Ghidra.  Mais je dois d'abord l'installer.  L'installation peut (et doit) √™tre t√©l√©charg√©e √† partir de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://ghidra-sre.org/</a> .  Comme il est √©crit en Java, il n'y a presque pas d'exigences particuli√®res √† l'installation, il ne n√©cessite aucun effort particulier pour l'installation.  Tout ce dont vous avez besoin est de d√©compresser l'archive et d'ex√©cuter l'application.  La seule chose requise est de mettre √† jour JDK et JRE vers la version 11. <br><br>  Cr√©ons un nouveau projet ghidra ( <b>Fichier-&gt; Nouveau projet</b> ), et appelons-le ¬´wasm¬ª / <br><br><img src="https://habrastorage.org/webt/yt/1j/2s/yt1j2sgpytbsoyhsschjdit4v7m.png"><br><br>  Ajoutez ensuite pour projeter le fichier test.wasm ( <b>Fichier ‚Üí Importer un fichier</b> ) et voyez comment ghidra peut y faire face <br><br><img src="https://habrastorage.org/webt/up/wq/jq/upwqjqan-5cooznznqw5pcks-pw.png"><br><br>  Eh bien, √ßa ne peut rien faire.  Il ne reconna√Æt pas le format et ne peut rien d√©monter, il est donc absolument impuissant de faire face √† cette t√¢che.  Enfin, nous sommes arriv√©s au sujet de l'article.  Il n'y a plus rien √† faire, mais √©crire un module, qui est capable de charger un fichier wasm, de l'analyser et de d√©monter son code. <br><br>  J'ai tout d'abord √©tudi√© toute la documentation disponible.  En fait, il n'y a qu'un seul document appropri√©, montrant le processus de d√©veloppement des modules compl√©mentaires: slides GhidraAdvancedDevelopment.  Je vais suivre le document, en donnant une description au coup par coup. <br><br>  Malheureusement, le d√©veloppement de modules compl√©mentaires n√©cessite l'utilisation d'Eclipse.  Toute mon exp√©rience avec eclipse est le d√©veloppement de deux jeux gdx pour Android en 2012. Cela avait √©t√© deux semaines pleines de douleur et de souffrance, apr√®s quoi je l'ai effac√© de mon esprit.  J'esp√®re qu'apr√®s 7 ans de d√©veloppement, c'est mieux qu'avant. <br><br>  T√©l√©chargeons et installons eclipse depuis le site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">officiel</a> . <br><br>  Ensuite, installez l'extension pour le d√©veloppement ghidra: <br><br>  Allez √† l' <b>aide d'</b> Eclipse <b>‚Üí dans le</b> menu <b>Installer un nouveau logiciel</b> , cliquez sur le bouton <b>Ajouter</b> et choisissez GhidraDev.zip dans / Extensions / Eclipse / GhidraDev /.  Installez-le et red√©marrez l'extension.  L'extension, ajoute des mod√®les au nouveau menu du projet, permet de d√©boguer les modules de l'√©clipse et de compiler le module vers le package de distribution. <br><br>  Comme il r√©sulte des documents des d√©veloppeurs, les √©tapes suivantes doivent √™tre effectu√©es pour ajouter un module de traitement du nouveau format binaire: <br><br><ul><li>  Cr√©er des classes, d√©crivant les structures de donn√©es </li><li>  D√©velopper le chargeur.  Le chargeur doit √™tre h√©rit√© de la classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AbstractLibrarySupportLoader</a> .  Il lit toutes les donn√©es n√©cessaires du fichier, v√©rifie l'int√©grit√© des donn√©es et convertit les donn√©es binaires en repr√©sentation interne, les pr√©parant √† l'analyse <br></li><li>  D√©velopper l'analyseur.  Analyzer est h√©rit√© de la classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AbstractAnalyzer</a> .  Il prend les structures de donn√©es pr√©par√©es par le chargeur et les annote (je ne sais pas vraiment ce que cela signifie, mais j'esp√®re comprendre pendant le d√©veloppement) <br></li><li>  Ajoutez un processeur.  Ghidra a une abstraction: Processeur.  Il est √©crit dans un langage d√©claratif interne et d√©crit l'ensemble d'instructions, la disposition de la m√©moire et d'autres caract√©ristiques architecturales.  Je vais couvrir ce sujet, en √©crivant le d√©monteur. <br></li></ul><br>  Maintenant, quand nous avons toute la th√©orie n√©cessaire, il est temps de cr√©er le projet de module.  Gr√¢ce √† l'extension d'√©clipse GhidraDev pr√©c√©demment install√©e, nous avons le mod√®le de module directement dans le <b>menu Fichier-&gt; Nouveau projet</b> . <br><br><img src="https://habrastorage.org/webt/ir/z3/77/irz377yf_rcsginnfb-e8-ee-ga.png"><br><br>  L'assistant demande quels composants sont requis.  Comme cela a √©t√© d√©crit pr√©c√©demment, nous aurions besoin de deux d'entre eux: chargeur et analyseur. <br><br><img src="https://habrastorage.org/webt/vf/cc/j1/vfccj1djknkxefjuc1bg9pysycs.png"><br><br>  L'assistant cr√©e le squelette du projet avec toutes les parties n√©cessaires: analyseur vide dans le fichier WasmAnalyzer.java, chargeur vide dans le fichier WasmLoader.java et squelette de langue dans le r√©pertoire / data / languages. <br><br><img src="https://habrastorage.org/webt/bu/3q/uw/bu3quwuupe-0heogbta81hrub7c.png"><br><br>  Commen√ßons par le chargeur.  Comme il a √©t√© mentionn√©, il doit √™tre h√©rit√© de la classe AbstractLibrarySupportLoader et dispose de trois m√©thodes √† surcharger: <br><br><ul><li>  getName - cette m√©thode doit √™tre le nom interne du chargeur.  Ghidra l'utilise √† divers endroits, par exemple, pour lier le chargeur au processeur </li><li>  findSupportedLoadSpecs - rappel, ex√©cut√©, lorsque l'utilisateur a choisi le fichier √† importer.  Dans ce rappel, le chargeur doit d√©cider s'il est capable de traiter le fichier et de renvoyer l'instance de la classe LoadSpec, indiquant √† l'utilisateur comment le fichier peut √™tre trait√© </li><li>  load - rappel, ex√©cut√©, apr√®s le fichier charg√© par l'utilisateur.  Dans cette m√©thode, le chargeur analyse la structure des fichiers et les charge dans ghidra.  Le d√©crira plus en d√©tail dans le prochain article </li></ul><br>  La premi√®re et la m√©thode la plus simple est getName, elle retourne simplement le nom du chargeur <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"WebAssembly"</span></span>; }</code> </pre><br>  La deuxi√®me m√©thode √† impl√©menter est findSupportedLoadSpecs.  Il est appel√© par outil lors de l'importation du fichier et doit v√©rifier si le chargeur est capable de traiter le fichier.  Si sa m√©thode est capable retourne l'objet de la classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LoadSpec</a> , indiquant quel objet est utilis√© pour charger le fichier et quel processeur d√©sassemble son code. <br><br>  La m√©thode d√©marre √† partir de la v√©rification du format.  Comme il r√©sulte de la <a href="">sp√©cification</a> , les huit premiers octets du fichier wasm doivent √™tre la signature ¬´\ 0asm¬ª et la version. <br><br>  Pour analyser l'en-t√™te, j'ai cr√©√© la classe WasmHeader, impl√©mentant l'interface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">StructConverter</a> , qui est l'interface de base pour d√©crire les donn√©es structur√©es.  Le constructeur du WasmHeader re√ßoit l'objet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BinaryReader</a> - abstraction, utilis√© pour lire les donn√©es de la source binaire en cours d'analyse.  Le constructeur l'utilise pour lire l'en-t√™te du fichier d'entr√©e <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] magic; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> [] version; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WasmHeader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BinaryReader reader)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ magic = reader.readNextByteArray(WASM_MAGIC_BASE.length()); version = reader.readNextByteArray(WASM_VERSION_LENGTH); }</code> </pre><br>  Le chargeur utilise cet objet pour v√©rifier la signature du fichier.  Ensuite, en cas de succ√®s, recherche le processeur appropri√©.  Il appelle la requ√™te de m√©thode de la classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">QueryOpinionService</a> et lui transmet le nom du chargeur (¬´Webassembly¬ª).  OpinionService recherche le processeur associ√© √† ce chargeur et le renvoie. <br><br><pre> <code class="java hljs">List&lt;QueryResult&gt; queries = QueryOpinionService.query(getName(), MACHINE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>);</code> </pre><br>  Bien s√ªr, il ne renvoie rien, car ghidra ne conna√Æt pas le processeur, appel√© WebAssembly et il doit le d√©finir.  Comme je l'ai d√©j√† dit, l'assistant a cr√©√© le squelette de la langue dans le r√©pertoire data / languages. <br><br><img src="https://habrastorage.org/webt/ck/hq/0d/ckhq0d4gena4dbalhjufpwv9kbs.png"><br><br>  Au stade actuel, il existe deux fichiers qui pourraient √™tre int√©ressants: Webassembly.opinion et Wbassembly.ldefs.  Le fichier .opinon d√©finit la correspondance entre le chargeur et le processeur. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">opinions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constraint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loader</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"WebAssembly"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">compilerSpecID</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constraint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">primary</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">processor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constraint</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">opinions</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Il contient du xml simple avec peu d'attributs.  Il est n√©cessaire de d√©finir le nom du chargeur dans l'attribut ¬´chargeur¬ª et le nom du processeur dans l'attribut ¬´processeur¬ª, les deux sont ¬´Webassembly¬ª.  √Ä cette √©tape, je remplirai d'autres param√®tres avec les valeurs al√©atoires.  D√®s que j'en saurai plus sur l'architecture du processeur Webassembly, je les changerai en valeurs correctes. <br><br>  Le fichier .ldefs d√©crit les fonctionnalit√©s du processeur, qui devrait ex√©cuter le code √† partir du fichier. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">language_definitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">language</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">processor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">endian</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"little"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">variant</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slafile</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly.sla"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">processorspec</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly.pspec"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wasm:LE:16:default"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Webassembly Language Module<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">compiler</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">spec</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly.cspec"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">language</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">language_definitions</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Le ¬´processeur¬ª d'attributs doit √™tre le m√™me que le processeur d'attributs du fichier .opinion.  Laissons les autres champs intacts.  Mais rappelez-vous la prochaine fois qu'il est possible de d√©finir la morsure du registre (attribut "taille"), le fichier d√©crivant l'architecture du processeur "processorspec" et le fichier, contenant la description du code en langage d√©claratif sp√©cial "slafile".  Il sera utile de travailler sur le d√©montage. <br><br>  Maintenant, il est temps de revenir au chargeur et de retourner les sp√©cifications du chargeur. <br><br>  Tout est pr√™t pour le test.  Le plugin pour GhidraDev a ajout√© l'option d'ex√©cution ¬´ <b>Ex√©cuter ‚Üí Ex√©cuter en tant que ‚Üí Ghidra</b> ¬ª pour √©clipser: <br><br><img src="https://habrastorage.org/webt/j5/z-/ft/j5z-ft7xxiy1equy99ahzrt6d7a.png"><br><br>  Il ex√©cute ghidra en mode d√©bogage et y d√©ploie le module, offrant une excellente occasion de travailler avec l'outil et en m√™me temps d'utiliser le d√©bogueur pour corriger les erreurs dans le module en cours de d√©veloppement.  Mais √† ce stade simple, il n'y a aucune raison d'utiliser un d√©bogueur.  Comme pr√©c√©demment, je vais cr√©er un nouveau projet, importer un fichier et voir si mes efforts ont port√© leurs fruits.  Contrairement √† la derni√®re fois, le fichier est reconnu comme WebAssembly, et le chargeur propose le processeur correspondant pour lui.  Cela signifie que tout fonctionne, et mon module est capable de reconna√Ætre le format. <br><br><img src="https://habrastorage.org/webt/zs/np/vd/zsnpvdvzqx5ecg7xdlz86dzres0.png"><br><br>  Dans le prochain article, je vais √©tendre le chargeur et le faire non seulement reconna√Ætre, mais aussi d√©crire la structure du fichier wasm.  Je pense qu'√† ce stade, apr√®s la mise en place de l'environnement, ce sera facile √† faire. <br><br>  Le code du module est disponible sur le d√©p√¥t <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr443318/">https://habr.com/ru/post/fr443318/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr443306/index.html">Huit lois de d√©nomination dans la conception UX (partie 1)</a></li>
<li><a href="../fr443308/index.html">Mythes de la physique moderne. Lois sur la conservation</a></li>
<li><a href="../fr443310/index.html">Revue du gadget de bien-√™tre f√©minin Bellabeat</a></li>
<li><a href="../fr443312/index.html">Gestion de la m√©moire Python</a></li>
<li><a href="../fr443314/index.html">Qu'est-ce que la cordentit√©? [Traduction de l'article]</a></li>
<li><a href="../fr443320/index.html">Syst√®me de gestion √©lectronique des documents "Vizier"</a></li>
<li><a href="../fr443322/index.html">GitLab 11.8 publi√© avec SAST pour JavaScript, GitLab Pages pour les sous-groupes et suivi des bogues</a></li>
<li><a href="../fr443324/index.html">Python contre Scala pour Apache Spark - r√©f√©rence attendue avec un r√©sultat inattendu</a></li>
<li><a href="../fr443326/index.html">Python et Arduino. Simple, rapide et beau</a></li>
<li><a href="../fr443330/index.html">Security Week 11: RSA 2019 et un avenir meilleur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>