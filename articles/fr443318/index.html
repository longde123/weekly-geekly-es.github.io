<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐾 🚴🏻 👩🏾‍🏫 Écriture d'un chargeur de wasm pour Ghidra. Partie 1: énoncé du problème et configuration de l'environnement 🚶 📑 🍤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cette semaine, la NSA ( National Security Agency ) a soudainement fait un cadeau à l'humanité, ouvrant les sources de son framework de reverse enginee...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Écriture d'un chargeur de wasm pour Ghidra. Partie 1: énoncé du problème et configuration de l'environnement</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443318/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/xy/1q/jm/xy1qjmpn0nactzdrq1laun9brhm.png"></div><br>  Cette semaine, la NSA ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">National Security Agency</a> ) a soudainement fait un cadeau à l'humanité, ouvrant les sources de son framework de reverse engineering logiciel.  La communauté des ingénieurs inversés et des experts en sécurité avec un grand enthousiasme a commencé à explorer le nouveau jouet.  Selon les commentaires, c'est un outil vraiment incroyable, capable de rivaliser avec les solutions existantes, telles que IDA Pro, R2 et JEB.  L'outil s'appelle Ghidra et les ressources professionnelles regorgent d'impressions de chercheurs.  En fait, ils avaient une bonne raison: tous les jours, les organisations gouvernementales ne donnent pas accès à leurs outils internes.  Moi-même en tant qu'ingénieur inversé professionnel et analyste de logiciels malveillants ne pouvait pas passer aussi bien.  J'ai décidé de passer un week-end ou deux et d'avoir une première impression de l'outil.  J'avais un peu joué avec le démontage et décidé de vérifier l'extensibilité de l'outil.  Dans cette série d'articles, je vais expliquer le développement du module complémentaire Ghidra, qui charge le format personnalisé, utilisé pour résoudre la tâche CTF.  Comme c'est un grand framework et que j'ai choisi une tâche assez compliquée, je vais diviser l'article en plusieurs parties. <br><br>  À la fin de cette partie, j'espère configurer un environnement de développement et construire un module minimal, qui sera capable de reconnaître le format du fichier WebAssembly et proposera le bon désassembleur pour le traiter. <br><a name="habracut"></a><br>  Commençons par la description de la tâche.  L'année dernière, la société de sécurité FireEye a organisé un concours CTF, nommé flare-on.  Pendant le concours, les chercheurs ont dû résoudre douze tâches liées à la rétro-ingénierie.  L'une des tâches consistait à rechercher l'application Web, construite avec WebAssembly.  C'est un format exécutable relativement nouveau, et pour autant que je sache, il n'y a pas d'outils parfaits pour y faire face.  Pendant le défi, j'ai essayé plusieurs outils pour essayer de le vaincre.  Il s'agissait de scripts simples de github et de décompilateurs connus, tels que IDA pro et JEB.  Étonnamment, je me suis arrêté sur Chrome, qui fournit un assez bon démonteur et débogueur pour WebAssembly.  Mon objectif est de résoudre le défi avec le ghidra.  Je vais décrire l'étude aussi complètement que possible et donner toutes les informations possibles pour reproduire mes étapes.  Peut-être qu'en tant que personne qui n'a pas beaucoup d'expérience avec l'instrument, je pourrais entrer dans des détails inutiles, mais c'est comme ça. <br><br>  La tâche que je vais utiliser pour l'étude peut être téléchargée sur le <a href="">site du</a> défi flareon5.  Il y a le fichier 05_web2point0.7z: archive chiffrée avec un mot effrayant <b>infecté</b> .  Il y a trois fichiers dans l'archive: index.html, main.js et test.wasm.  Ouvrons le fichier index.html dans un navigateur et vérifions le résultat: <br><br><img src="https://habrastorage.org/webt/5z/o2/fd/5zo2fdf7jjndo2tmhesju4go7io.png"><br><br>  Eh bien, c'est avec ça que je vais travailler.  Commençons par l'étude html, d'autant plus que c'est la partie la plus simple du défi.  Le code html ne contient rien sauf le chargement du script main.js. <br><br><pre><code class="javascript hljs">&lt;!DOCTYPE html&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"./main.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  Le script ne fait rien de compliqué non plus, même s'il semble un peu plus bavard.  Il charge simplement le fichier test.wasm et l'utilise pour créer une instance WebAssembly.  Il lit ensuite le paramètre «q» de l'url et le passe à la correspondance de méthode, exportée par l'instance.  Si la chaîne dans le paramètre est incorrecte, le script affiche l'image que nous avons vue ci-dessus, en termes de développeurs FireEye appelés "Pile of poo". <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Uint8Array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextEncoder().encode(getParameterByName(<span class="hljs-string"><span class="hljs-string">"q"</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pa = wasm_alloc(instance, <span class="hljs-number"><span class="hljs-number">0x200</span></span>); wasm_write(instance, pa, a); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pb = wasm_alloc(instance, <span class="hljs-number"><span class="hljs-number">0x200</span></span>); wasm_write(instance, pb, b); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instance.exports.Match(pa, a.byteLength, pb, b.byteLength) == <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// PARTY POPPER document.getElementById("container").innerText = "ðŸŽ‰"; } else { // PILE OF POO document.getElementById("container").innerText = "ðŸ'"; }</span></span></code> </pre><br>  La solution de la tâche consiste à trouver la valeur du paramètre q qui fait que la fonction «match» renvoie «True».  Pour ce faire, je vais démonter le fichier test.wasm et analyser l'algorithme de la fonction Match. <br><br>  Il n'y a pas de surprise et je vais essayer de le faire à Ghidra.  Mais je dois d'abord l'installer.  L'installation peut (et doit) être téléchargée à partir de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://ghidra-sre.org/</a> .  Comme il est écrit en Java, il n'y a presque pas d'exigences particulières à l'installation, il ne nécessite aucun effort particulier pour l'installation.  Tout ce dont vous avez besoin est de décompresser l'archive et d'exécuter l'application.  La seule chose requise est de mettre à jour JDK et JRE vers la version 11. <br><br>  Créons un nouveau projet ghidra ( <b>Fichier-&gt; Nouveau projet</b> ), et appelons-le «wasm» / <br><br><img src="https://habrastorage.org/webt/yt/1j/2s/yt1j2sgpytbsoyhsschjdit4v7m.png"><br><br>  Ajoutez ensuite pour projeter le fichier test.wasm ( <b>Fichier → Importer un fichier</b> ) et voyez comment ghidra peut y faire face <br><br><img src="https://habrastorage.org/webt/up/wq/jq/upwqjqan-5cooznznqw5pcks-pw.png"><br><br>  Eh bien, ça ne peut rien faire.  Il ne reconnaît pas le format et ne peut rien démonter, il est donc absolument impuissant de faire face à cette tâche.  Enfin, nous sommes arrivés au sujet de l'article.  Il n'y a plus rien à faire, mais écrire un module, qui est capable de charger un fichier wasm, de l'analyser et de démonter son code. <br><br>  J'ai tout d'abord étudié toute la documentation disponible.  En fait, il n'y a qu'un seul document approprié, montrant le processus de développement des modules complémentaires: slides GhidraAdvancedDevelopment.  Je vais suivre le document, en donnant une description au coup par coup. <br><br>  Malheureusement, le développement de modules complémentaires nécessite l'utilisation d'Eclipse.  Toute mon expérience avec eclipse est le développement de deux jeux gdx pour Android en 2012. Cela avait été deux semaines pleines de douleur et de souffrance, après quoi je l'ai effacé de mon esprit.  J'espère qu'après 7 ans de développement, c'est mieux qu'avant. <br><br>  Téléchargeons et installons eclipse depuis le site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">officiel</a> . <br><br>  Ensuite, installez l'extension pour le développement ghidra: <br><br>  Allez à l' <b>aide d'</b> Eclipse <b>→ dans le</b> menu <b>Installer un nouveau logiciel</b> , cliquez sur le bouton <b>Ajouter</b> et choisissez GhidraDev.zip dans / Extensions / Eclipse / GhidraDev /.  Installez-le et redémarrez l'extension.  L'extension, ajoute des modèles au nouveau menu du projet, permet de déboguer les modules de l'éclipse et de compiler le module vers le package de distribution. <br><br>  Comme il résulte des documents des développeurs, les étapes suivantes doivent être effectuées pour ajouter un module de traitement du nouveau format binaire: <br><br><ul><li>  Créer des classes, décrivant les structures de données </li><li>  Développer le chargeur.  Le chargeur doit être hérité de la classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AbstractLibrarySupportLoader</a> .  Il lit toutes les données nécessaires du fichier, vérifie l'intégrité des données et convertit les données binaires en représentation interne, les préparant à l'analyse <br></li><li>  Développer l'analyseur.  Analyzer est hérité de la classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AbstractAnalyzer</a> .  Il prend les structures de données préparées par le chargeur et les annote (je ne sais pas vraiment ce que cela signifie, mais j'espère comprendre pendant le développement) <br></li><li>  Ajoutez un processeur.  Ghidra a une abstraction: Processeur.  Il est écrit dans un langage déclaratif interne et décrit l'ensemble d'instructions, la disposition de la mémoire et d'autres caractéristiques architecturales.  Je vais couvrir ce sujet, en écrivant le démonteur. <br></li></ul><br>  Maintenant, quand nous avons toute la théorie nécessaire, il est temps de créer le projet de module.  Grâce à l'extension d'éclipse GhidraDev précédemment installée, nous avons le modèle de module directement dans le <b>menu Fichier-&gt; Nouveau projet</b> . <br><br><img src="https://habrastorage.org/webt/ir/z3/77/irz377yf_rcsginnfb-e8-ee-ga.png"><br><br>  L'assistant demande quels composants sont requis.  Comme cela a été décrit précédemment, nous aurions besoin de deux d'entre eux: chargeur et analyseur. <br><br><img src="https://habrastorage.org/webt/vf/cc/j1/vfccj1djknkxefjuc1bg9pysycs.png"><br><br>  L'assistant crée le squelette du projet avec toutes les parties nécessaires: analyseur vide dans le fichier WasmAnalyzer.java, chargeur vide dans le fichier WasmLoader.java et squelette de langue dans le répertoire / data / languages. <br><br><img src="https://habrastorage.org/webt/bu/3q/uw/bu3quwuupe-0heogbta81hrub7c.png"><br><br>  Commençons par le chargeur.  Comme il a été mentionné, il doit être hérité de la classe AbstractLibrarySupportLoader et dispose de trois méthodes à surcharger: <br><br><ul><li>  getName - cette méthode doit être le nom interne du chargeur.  Ghidra l'utilise à divers endroits, par exemple, pour lier le chargeur au processeur </li><li>  findSupportedLoadSpecs - rappel, exécuté, lorsque l'utilisateur a choisi le fichier à importer.  Dans ce rappel, le chargeur doit décider s'il est capable de traiter le fichier et de renvoyer l'instance de la classe LoadSpec, indiquant à l'utilisateur comment le fichier peut être traité </li><li>  load - rappel, exécuté, après le fichier chargé par l'utilisateur.  Dans cette méthode, le chargeur analyse la structure des fichiers et les charge dans ghidra.  Le décrira plus en détail dans le prochain article </li></ul><br>  La première et la méthode la plus simple est getName, elle retourne simplement le nom du chargeur <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"WebAssembly"</span></span>; }</code> </pre><br>  La deuxième méthode à implémenter est findSupportedLoadSpecs.  Il est appelé par outil lors de l'importation du fichier et doit vérifier si le chargeur est capable de traiter le fichier.  Si sa méthode est capable retourne l'objet de la classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LoadSpec</a> , indiquant quel objet est utilisé pour charger le fichier et quel processeur désassemble son code. <br><br>  La méthode démarre à partir de la vérification du format.  Comme il résulte de la <a href="">spécification</a> , les huit premiers octets du fichier wasm doivent être la signature «\ 0asm» et la version. <br><br>  Pour analyser l'en-tête, j'ai créé la classe WasmHeader, implémentant l'interface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">StructConverter</a> , qui est l'interface de base pour décrire les données structurées.  Le constructeur du WasmHeader reçoit l'objet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BinaryReader</a> - abstraction, utilisé pour lire les données de la source binaire en cours d'analyse.  Le constructeur l'utilise pour lire l'en-tête du fichier d'entrée <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] magic; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> [] version; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WasmHeader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BinaryReader reader)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ magic = reader.readNextByteArray(WASM_MAGIC_BASE.length()); version = reader.readNextByteArray(WASM_VERSION_LENGTH); }</code> </pre><br>  Le chargeur utilise cet objet pour vérifier la signature du fichier.  Ensuite, en cas de succès, recherche le processeur approprié.  Il appelle la requête de méthode de la classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">QueryOpinionService</a> et lui transmet le nom du chargeur («Webassembly»).  OpinionService recherche le processeur associé à ce chargeur et le renvoie. <br><br><pre> <code class="java hljs">List&lt;QueryResult&gt; queries = QueryOpinionService.query(getName(), MACHINE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>);</code> </pre><br>  Bien sûr, il ne renvoie rien, car ghidra ne connaît pas le processeur, appelé WebAssembly et il doit le définir.  Comme je l'ai déjà dit, l'assistant a créé le squelette de la langue dans le répertoire data / languages. <br><br><img src="https://habrastorage.org/webt/ck/hq/0d/ckhq0d4gena4dbalhjufpwv9kbs.png"><br><br>  Au stade actuel, il existe deux fichiers qui pourraient être intéressants: Webassembly.opinion et Wbassembly.ldefs.  Le fichier .opinon définit la correspondance entre le chargeur et le processeur. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">opinions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constraint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loader</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"WebAssembly"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">compilerSpecID</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constraint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">primary</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">processor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constraint</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">opinions</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Il contient du xml simple avec peu d'attributs.  Il est nécessaire de définir le nom du chargeur dans l'attribut «chargeur» et le nom du processeur dans l'attribut «processeur», les deux sont «Webassembly».  À cette étape, je remplirai d'autres paramètres avec les valeurs aléatoires.  Dès que j'en saurai plus sur l'architecture du processeur Webassembly, je les changerai en valeurs correctes. <br><br>  Le fichier .ldefs décrit les fonctionnalités du processeur, qui devrait exécuter le code à partir du fichier. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">language_definitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">language</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">processor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">endian</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"little"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">variant</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slafile</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly.sla"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">processorspec</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly.pspec"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wasm:LE:16:default"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Webassembly Language Module<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">compiler</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">spec</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly.cspec"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">language</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">language_definitions</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Le «processeur» d'attributs doit être le même que le processeur d'attributs du fichier .opinion.  Laissons les autres champs intacts.  Mais rappelez-vous la prochaine fois qu'il est possible de définir la morsure du registre (attribut "taille"), le fichier décrivant l'architecture du processeur "processorspec" et le fichier, contenant la description du code en langage déclaratif spécial "slafile".  Il sera utile de travailler sur le démontage. <br><br>  Maintenant, il est temps de revenir au chargeur et de retourner les spécifications du chargeur. <br><br>  Tout est prêt pour le test.  Le plugin pour GhidraDev a ajouté l'option d'exécution « <b>Exécuter → Exécuter en tant que → Ghidra</b> » pour éclipser: <br><br><img src="https://habrastorage.org/webt/j5/z-/ft/j5z-ft7xxiy1equy99ahzrt6d7a.png"><br><br>  Il exécute ghidra en mode débogage et y déploie le module, offrant une excellente occasion de travailler avec l'outil et en même temps d'utiliser le débogueur pour corriger les erreurs dans le module en cours de développement.  Mais à ce stade simple, il n'y a aucune raison d'utiliser un débogueur.  Comme précédemment, je vais créer un nouveau projet, importer un fichier et voir si mes efforts ont porté leurs fruits.  Contrairement à la dernière fois, le fichier est reconnu comme WebAssembly, et le chargeur propose le processeur correspondant pour lui.  Cela signifie que tout fonctionne, et mon module est capable de reconnaître le format. <br><br><img src="https://habrastorage.org/webt/zs/np/vd/zsnpvdvzqx5ecg7xdlz86dzres0.png"><br><br>  Dans le prochain article, je vais étendre le chargeur et le faire non seulement reconnaître, mais aussi décrire la structure du fichier wasm.  Je pense qu'à ce stade, après la mise en place de l'environnement, ce sera facile à faire. <br><br>  Le code du module est disponible sur le dépôt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr443318/">https://habr.com/ru/post/fr443318/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr443306/index.html">Huit lois de dénomination dans la conception UX (partie 1)</a></li>
<li><a href="../fr443308/index.html">Mythes de la physique moderne. Lois sur la conservation</a></li>
<li><a href="../fr443310/index.html">Revue du gadget de bien-être féminin Bellabeat</a></li>
<li><a href="../fr443312/index.html">Gestion de la mémoire Python</a></li>
<li><a href="../fr443314/index.html">Qu'est-ce que la cordentité? [Traduction de l'article]</a></li>
<li><a href="../fr443320/index.html">Système de gestion électronique des documents "Vizier"</a></li>
<li><a href="../fr443322/index.html">GitLab 11.8 publié avec SAST pour JavaScript, GitLab Pages pour les sous-groupes et suivi des bogues</a></li>
<li><a href="../fr443324/index.html">Python contre Scala pour Apache Spark - référence attendue avec un résultat inattendu</a></li>
<li><a href="../fr443326/index.html">Python et Arduino. Simple, rapide et beau</a></li>
<li><a href="../fr443330/index.html">Security Week 11: RSA 2019 et un avenir meilleur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>