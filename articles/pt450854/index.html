<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèπ üõÄüèø üéÅ Experi√™ncia no desenvolvimento de um ativo Unity para encontrar um caminho no espa√ßo 3D üçÉ üå≤ üßùüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bem-vindo √† equipe de algoritmos graciosos! 

 Como experimento, decidimos manter ‚Äúdi√°rios‚Äù de desenvolvedores nos quais compartilharemos experi√™ncias...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Experi√™ncia no desenvolvimento de um ativo Unity para encontrar um caminho no espa√ßo 3D</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450854/">  Bem-vindo √† equipe de algoritmos graciosos! <br><br>  Como experimento, decidimos manter ‚Äúdi√°rios‚Äù de desenvolvedores nos quais compartilharemos experi√™ncias e destacaremos alguns resultados interessantes de nossos experimentos.  Este √© o nosso artigo de estreia no projeto "Pathfinder 3D" - um ativo para o mecanismo de jogo Unity, que permite pesquisar caminhos no espa√ßo tridimensional.  Nele, falaremos sobre o caminho desde a origem da id√©ia at√© um produto completo e sobre alguns dos problemas que encontramos.  Este material ser√° √∫til para pessoas que desejam iniciar seu projeto e apoi√°-lo no futuro, bem como para aqueles que desejam implementar uma busca por um caminho no espa√ßo. <br><a name="habracut"></a><br>  Uma equipe de duas pessoas come√ßou a trabalhar no ativo.  O primeiro teve alguns desenvolvimentos que permitiram acelerar o processo de encontrar o caminho mais curto em gr√°ficos complexos o suficiente para funcionar em tempo real e o desejo de encontrar uma aplica√ß√£o pr√°tica para eles, o segundo possu√≠a alguma experi√™ncia em trabalhar com o Unity e estava procurando uma ideia para uma startup.  Como eles frequentemente se comunicam, n√£o √© de surpreender que em algum momento surgiu a id√©ia da possibilidade de criar um ativo para procurar um caminho no espa√ßo tridimensional. <br><br>  Ao estudar o cat√°logo de ativos do Unity, foram encontradas muitas solu√ß√µes para encontrar o caminho no espa√ßo bidimensional, mas n√£o um no tridimensional.  Tornou-se √≥bvio que essa era uma grande oportunidade para entrar no mercado de complementos de software Unity, principalmente considerando a visibilidade e o entretenimento do resultado esperado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sl/g0/mm/slg0mmebuga20hyrv4hiic-j2ho.jpeg"></div><br>  O objetivo era implementar diretamente a busca por um caminho no espa√ßo tridimensional e os recursos t√≠picos das solu√ß√µes existentes para encontrar um caminho no espa√ßo bidimensional.  Come√ßamos a trabalhar: desenvolvemos diretamente o mecanismo de busca de caminhos, as segundas classes e m√©todos para gerenciar o processo de busca de caminhos, interfaces de configura√ß√£o, cenas de teste, documenta√ß√£o, o site do projeto e tamb√©m est√°vamos envolvidos no registro e configura√ß√£o de contas de servi√ßo necess√°rias para a venda do ativo. <br><br>  Logo ap√≥s o in√≠cio do trabalho, ficou claro que era necess√°rio algum recurso comum para a equipe fazer anota√ß√µes: uma lista de tarefas e problemas que precisavam ser resolvidos, informa√ß√µes sobre as decis√µes tomadas, id√©ias e resultados de pesquisa interessantes no futuro.  Ap√≥s analisar as solu√ß√µes existentes, paramos no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Trello</a> , devido √† sua funcionalidade, simplicidade, conveni√™ncia e apar√™ncia agrad√°vel.  Como a pr√°tica demonstrou, este servi√ßo √© muito conveniente para equipes pequenas.  Se a equipe tiver mais de 5 pessoas, recomendamos o uso de um sistema completo de gerenciamento de projetos. <br><br>  A seguir, descrevemos as decis√µes tomadas durante o desenvolvimento da primeira vers√£o do ativo e a l√≥gica que seguimos ao tom√°-las.  As pessoas que t√™m experi√™ncia com o Unity e est√£o familiarizadas com os algoritmos de localiza√ß√£o de caminhos entender√£o imediatamente onde os problemas surgir√£o no futuro.  Nesses locais, usamos uma solu√ß√£o simples para reduzir o tempo de desenvolvimento at√© que a primeira vers√£o de trabalho do ativo fosse recebida, para n√£o ficarmos atolados, porque o entusiasmo √© limitado e inconstante.  Assim, lidamos com um dos motivos mais comuns para fechar essas startups, por causa dos quais muitos projetos morrem sem nascer.  Todas as √°reas problem√°ticas foram corrigidas ap√≥s a publica√ß√£o do ativo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jk/ri/sp/jkrisph5ng_tz1slmdzfttxdoie.gif"></div><br>  Para encontrar o caminho, o algoritmo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">A * (estrela A)</a> foi escolhido devido √† sua alta velocidade de opera√ß√£o em grandes espa√ßos abertos.  A maioria dos algoritmos de busca de caminho funciona em gr√°ficos representados por uma matriz discreta.  Seria poss√≠vel construir essa matriz antecipadamente, mas o processo √∫nico de sua constru√ß√£o no espa√ßo tridimensional com obst√°culos parecia na √©poca uma tarefa bastante dif√≠cil.  Al√©m disso, n√£o ficou claro como fazer isso sem sacrificar o desempenho, pois no in√≠cio do trabalho no ativo n√£o havia experi√™ncia com processos em segundo plano e multithreading no Unity, bem como com multithreading em geral.  O gr√°fico foi formado em tempo real, sondando o espa√ßo com raios f√≠sicos (Physics.BoxCast) na dire√ß√£o da pesquisa.  As trajet√≥rias encontradas foram reduzidas a quebradas com menos pontos intermedi√°rios e depois suavizadas por splines. <br><br>  A principal dificuldade era a impossibilidade de usar os m√©todos f√≠sicos do mecanismo de forma ass√≠ncrona, pois eles podem trabalhar exclusivamente no segmento principal.  Em cenas n√£o muito complexas, o uso da fun√ß√£o de busca ao mesmo tempo por n√£o mais de vinte agentes n√£o afetou significativamente a taxa de quadros.  Para se livrar de raros rebaixamentos fortes do FPS, a carga computacional foi espa√ßada no tempo usando corotinas.  Isso atrasou a pesquisa, mas n√£o significativamente. <br><br>  Antes de enviar um ativo para modera√ß√£o, √© necess√°rio colocar o c√≥digo em ordem e elaborar documenta√ß√£o detalhada, de acordo com os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">requisitos</a> , registrar e configurar o correio de suporte.  Tamb√©m √© aconselh√°vel criar um site do projeto no qual not√≠cias e demonstra√ß√µes de desenvolvimento sejam exibidas convenientemente.  Essa ser√° uma grande vantagem, tanto durante a aprova√ß√£o da modera√ß√£o, quanto no estudo de seu ativo pelo usu√°rio antes da compra.  Os servi√ßos de hospedagem e correio foram solicitados por n√≥s √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">BeGet</a> , pois na √©poca ofereciam as ofertas mais vantajosas e nos custavam 1000r / ano. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7u/h4/7q/7uh47qdtjz_vkhribjsh19_xcc8.png"></div><br>  A modera√ß√£o de ativos durou 22 dias e passou pela primeira vez, pois abordamos com muito cuidado a documenta√ß√£o e o design da p√°gina de ativos na loja Unity.  Ap√≥s a publica√ß√£o, o ativo caiu imediatamente em primeiro lugar na categoria Script / AI.  A partir desse momento, come√ßaram a chegar cartas ao correio de suporte pedindo ajuda para resolver certos problemas.  √Äs vezes, alguns por dia, √†s vezes n√£o um m√™s.  Se voc√™ calcula a m√©dia, por um m√™s 2 pessoas fizeram perguntas, correspond√™ncias com as quais levaram um total de 2-3 horas.  N√£o tanto, mas lembre-se de que, independentemente da sua carga de trabalho atual, voc√™ precisa responder muito rapidamente para que usu√°rios irritados n√£o escrevam cr√≠ticas ruins sobre o produto, mas, pelo contr√°rio, entusiasmados com o suporte de qualidade, deixem coment√°rios positivos.  Al√©m disso, muitas perguntas chegam ao correio como "seu ativo funcionar√° se ...".  Tais cartas tamb√©m n√£o devem ser ignoradas, porque este √© um potencial comprador que pode sair. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x8/3b/kd/x83bkdcsm3bxsxmeor0yhe8xij0.jpeg"></div><br>  Como as reclama√ß√µes dos primeiros compradores foram recebidas, ficou claro que muitos usu√°rios usam ativos em cenas complexas que t√™m a configura√ß√£o de um labirinto ou outra cavidade conectada.  Nesses projetos, nosso esquema de busca de caminhos, com base na verifica√ß√£o de colis√µes, e mesmo no fluxo principal, n√£o foi suficientemente eficaz.  Portanto, come√ßamos a implementar a constru√ß√£o inicial do gr√°fico para que fosse poss√≠vel procurar o caminho no fluxo lateral sem usar f√≠sica e acessar objetos de cena. <br><br>  A discretiza√ß√£o do espa√ßo tridimensional o divide em cubos.  O armazenamento de informa√ß√µes sobre todos os cubos de parti√ß√£o √© redundante e consome muita mem√≥ria.  Portanto, √© l√≥gico armazenar apenas as coordenadas das c√©lulas intransit√°veis, o que foi feito. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2k/kl/5p/2kkl5pn7lgswpe_7bwixkioulpw.jpeg"></div><br>  Os obst√°culos do jogo s√£o figuras poligonais e consistem em tri√¢ngulos.  Para explicar os obst√°culos no gr√°fico de pesquisa, voc√™ deve encontrar todos os cubos da parti√ß√£o que cruzam qualquer tri√¢ngulo de qualquer obst√°culo.  J√° nesta fase, havia a possibilidade de remover dinamicamente e adicionar obst√°culos ao palco, e n√£o apenas as coordenadas dos cubos ocupados foram salvas, mas tamb√©m os identificadores dos obst√°culos que estavam neles.  Agora √© poss√≠vel criar um gr√°fico de navega√ß√£o antes do in√≠cio do processo do jogo e, devido √† elimina√ß√£o de um grande n√∫mero de c√°lculos complexos durante a busca por um caminho, mais de duzentos agentes poderiam faz√™-lo simultaneamente sem sacrificar o desempenho. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6o/yn/bd/6oynbdbckmzfhtzu289blvzhqcu.jpeg"></div><br>  Outro problema conhecido por n√≥s tamb√©m se fez sentir: o algoritmo A * e suas modifica√ß√µes funcionam extremamente mal em espa√ßos confinados em gr√°ficos de alta pot√™ncia.  Como o algoritmo deles prefere a dire√ß√£o da rota para se aproximar do ponto de destino, qualquer conflito que leva ao alvo diminui bastante a busca por um caminho, pois antes de escolher uma dire√ß√£o diferente de "brotamento", o algoritmo primeiro "preenche" todo o espa√ßo dentro do beco sem sa√≠da. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ff/ph/is/ffphis2un_0wdpsehrnwra1fiha.gif"></div><br>  Nessas situa√ß√µes, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">algoritmo de busca por ondas (algoritmo de Lee)</a> mostra-se muito eficaz devido ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">menor n√∫mero de opera√ß√µes</a> necess√°rias para "preencher" o espa√ßo.  Portanto, foi adicionado ao ativo como uma alternativa.  Ao testar em um palco que √© um labirinto, o tempo de pesquisa para o caminho foi reduzido em mais de 30 vezes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eq/lt/nd/eqltndonsivsvukp1t6lhn_awmo.jpeg"></div><br>  Para agilizar o processamento preliminar da cena e encontrar o caminho para o ativo, foi adicionada a possibilidade de execu√ß√£o paralela de processos, mas a efici√™ncia do paralelismo foi extremamente baixa, devido ao fato de que, ao trabalhar com um cont√™iner que armazena as coordenadas das c√©lulas ocupadas, √© necess√°rio sincronizar os fluxos, que foram realizados usando mutexes, uma vez que cole√ß√µes competitivas e muitas outras ferramentas para garantir a sincroniza√ß√£o eficiente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">foram implementadas</a> apenas no padr√£o .NET Framework 4.5 e no Unity, a vers√£o .NE foi usada at√© a vers√£o 2018.  T Framework 3.5.  Tentamos resolver esse problema usando as ferramentas dispon√≠veis, mas eles tinham um desempenho muito med√≠ocre e s√≥ obtivemos o resultado desejado depois de mudar para a vers√£o 2018 do Unity.  O uso de cole√ß√µes competitivas tamb√©m abriu a possibilidade de realizar a mudan√ßa din√¢mica de obst√°culos no cen√°rio. <br><br>  Em um certo est√°gio, come√ßaram a surgir diverg√™ncias na equipe em rela√ß√£o √† distribui√ß√£o de lucros, e uma terceira pessoa entrou na equipe, que introduziu um sistema para avaliar o investimento de tempo de cada membro da equipe e tamb√©m come√ßou a se envolver em inspe√ß√£o e teste de c√≥digo, o que melhorava significativamente a qualidade do produto. <br><br>  O sistema para estimar custos de tempo no momento √© feito na forma de uma tabela do Excel e √© um sistema automatizado no qual uma vez por m√™s √© necess√°rio inserir informa√ß√µes sobre vendas e tarefas conclu√≠das no m√™s passado.  Os membros da equipe precisam avaliar quanto tempo precisariam para resolver um problema espec√≠fico.  Assim, ao avaliar a complexidade do tempo das tarefas, a velocidade de cada participante √© levada em considera√ß√£o.  Uma superestima√ß√£o ou subestima√ß√£o anormal por um dos participantes imediatamente se torna evidente a partir das estat√≠sticas acumuladas de suas avalia√ß√µes anteriores.  E, na falta de uma explica√ß√£o satisfat√≥ria, esse problema √© decidido por toda a equipe.  Essa abordagem mostrou-se boa por seis meses de uso e permitiu coletar estat√≠sticas interessantes.  N√£o encontramos uma solu√ß√£o gratuita pronta para fornecer os recursos descritos.  Portanto, no momento, para equipes pequenas, a implementa√ß√£o na forma de tabelas do Excel nos parece √≥tima.  Para equipes relativamente grandes, voc√™ provavelmente precisar√° projetar seu banco de dados, desenvolver a parte do servidor e o cliente ou implementar uma extens√£o para um dos sistemas de gerenciamento de projetos existentes. <br><br>  <strong>Para resumir.</strong>  Um ano se passou desde o in√≠cio do desenvolvimento para a primeira vers√£o com a funcionalidade m√≠nima necess√°ria e desempenho suficiente para uso em projetos reais.  Mais seis meses foram gastos na melhoria do desempenho e na implementa√ß√£o do trabalho multithread do ativo.  No momento, estimamos os custos de tempo para este projeto em 1065 horas-homem (essa √© uma estimativa bastante otimista), e o lucro m√©dio do m√™s √© de 9,5 t.  √â f√°cil calcular que o custo m√©dio de uma hora de trabalho no momento √© de cerca de 160 rublos, o que n√£o √© muito.  No entanto, o principal neste evento √© a experi√™ncia adquirida por cada participante.  Incluindo experi√™ncia de trabalho em equipe e experi√™ncia em suporte a produtos de software.  O projeto pode ser considerado bem-sucedido. <br><br>  Agora, nossa equipe come√ßou a implementar funcionalidades √∫teis adicionais: verifica√ß√£o de acessibilidade algor√≠tmica;  a capacidade de atribuir objetos de jogo a portais;  suporte din√¢mico de obst√°culos;  Navega√ß√£o local entre agentes para evitar colis√µes e planejar rotas locais. <br><br>  Esperamos que este material ajude algu√©m a levar seu projeto para a linha de chegada. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt450854/">https://habr.com/ru/post/pt450854/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt450840/index.html">A √∫ltima lanterna est√° cansada ou o piscar salvar√° a Bielorr√∫ssia (atual. Spinner?)</a></li>
<li><a href="../pt450844/index.html">Introdu√ß√£o ao mapeamento de exemplo</a></li>
<li><a href="../pt450846/index.html">As maravilhas do empacotamento da Microsoft: o kernel Linux no Windows 10 e o mecanismo IE dentro do Chromium Edge</a></li>
<li><a href="../pt450848/index.html">Sobre o f√≥sforo amarelo e a natureza em p√¢nico do homem</a></li>
<li><a href="../pt450850/index.html">Rumo a um futuro melhor para compiladores inteligentes</a></li>
<li><a href="../pt450858/index.html">Encontro de rede de c√≥digo aberto - agora em Yandex.Cloud # 3.2019</a></li>
<li><a href="../pt450860/index.html">Tomada inteligente REDMOND SkyPort 100S</a></li>
<li><a href="../pt450862/index.html">@Pythonetc Abril de 2019</a></li>
<li><a href="../pt450864/index.html">Dicas e truques do meu canal de telegrama @pythonetc, abril de 2019</a></li>
<li><a href="../pt450868/index.html">Relat√≥rios de v√≠deo do Meetup de automa√ß√£o de controle de qualidade da FunTech</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>